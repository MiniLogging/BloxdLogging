/*! For license information please see cmhiow.11.87639c96.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{13170:(w,p,e)=>{"use strict";var r=e(13177),I=e(13182),d=e(13186);e.g.__TYPEDARRAY_POOL||(e.g.__TYPEDARRAY_POOL={UINT8:I([32,0]),UINT16:I([32,0]),UINT32:I([32,0]),INT8:I([32,0]),INT16:I([32,0]),INT32:I([32,0]),FLOAT:I([32,0]),DOUBLE:I([32,0]),DATA:I([32,0]),UINT8C:I([32,0]),BUFFER:I([32,0])});var f="undefined"!==typeof Uint8ClampedArray,q=e.g.__TYPEDARRAY_POOL;q.UINT8C||(q.UINT8C=I([32,0])),q.BUFFER||(q.BUFFER=I([32,0]));var E=q.DATA,j=q.BUFFER;function X(w){if(w){var p=w.length||w.byteLength,e=r.log2(p);E[e].push(w)}}function k(w){w=r.nextPow2(w);var p=r.log2(w),e=E[p];return e.length>0?e.pop():new ArrayBuffer(w)}function m(w){return new Uint8Array(k(w),0,w)}function J(w){return new Uint16Array(k(2*w),0,w)}function K(w){return new Uint32Array(k(4*w),0,w)}function y(w){return new Int8Array(k(w),0,w)}function c(w){return new Int16Array(k(2*w),0,w)}function s(w){return new Int32Array(k(4*w),0,w)}function O(w){return new Float32Array(k(4*w),0,w)}function a(w){return new Float64Array(k(8*w),0,w)}function A(w){return f?new Uint8ClampedArray(k(w),0,w):m(w)}function z(w){return new DataView(k(w),0,w)}p.free=function(w){if(d(w))j[r.log2(w.length)].push(w);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(w)&&(w=w.buffer),!w)return;var p=w.length||w.byteLength,e=0|r.log2(p);E[e].push(w)}},p.freeUint8=p.freeUint16=p.freeUint32=p.freeInt8=p.freeInt16=p.freeInt32=p.freeFloat32=p.freeFloat=p.freeFloat64=p.freeDouble=p.freeUint8Clamped=p.freeDataView=function(w){X(w.buffer)},p.freeArrayBuffer=X,p.freeBuffer=function(w){j[r.log2(w.length)].push(w)},p.malloc=function(w,p){if(void 0===p||"arraybuffer"===p)return k(w);switch(p){case"uint8":return m(w);case"uint16":return J(w);case"uint32":return K(w);case"int8":return y(w);case"int16":return c(w);case"int32":return s(w);case"float":case"float32":return O(w);case"double":case"float64":return a(w);case"uint8_clamped":return A(w);case"buffer":throw"Buffer not supported";case"data":case"dataview":return z(w);default:return null}return null},p.mallocArrayBuffer=k,p.mallocUint8=m,p.mallocUint16=J,p.mallocUint32=K,p.mallocInt8=y,p.mallocInt16=c,p.mallocInt32=s,p.mallocFloat32=p.mallocFloat=O,p.mallocFloat64=p.mallocDouble=a,p.mallocUint8Clamped=A,p.mallocDataView=z,p.clearCache=function(){for(var w=0;w<32;++w)q.UINT8[w].length=0,q.UINT16[w].length=0,q.UINT32[w].length=0,q.INT8[w].length=0,q.INT16[w].length=0,q.INT32[w].length=0,q.FLOAT[w].length=0,q.DOUBLE[w].length=0,q.UINT8C[w].length=0,E[w].length=0,j[w].length=0}},13265:(w,p,e)=>{w.exports=I;var r=e(11968);function I(w,p){if(!(this instanceof I))return new I(w,p);var e=r.create();r.add(e,w,p),this.base=r.min(r.create(),w,e),this.aX=r.clone(p),this.max=r.max(r.create(),w,e),this.mag=r.length(this.aX)}var d=I.prototype;d.width=function(){return this.aX[0]},d.height=function(){return this.aX[1]},d.depth=function(){return this.aX[2]},d.x0=function(){return this.base[0]},d.y0=function(){return this.base[1]},d.z0=function(){return this.base[2]},d.x1=function(){return this.max[0]},d.y1=function(){return this.max[1]},d.z1=function(){return this.max[2]},d.translate=function(w){return r.add(this.max,this.max,w),r.add(this.base,this.base,w),this},d.setPosition=function(w){return r.add(this.max,w,this.aX),r.k(this.base,w),this},d.expand=function(w){var p=r.create(),e=r.create();return r.max(p,w.max,this.max),r.min(e,w.base,this.base),r.Je(p,p,e),new I(e,p)},d.intersects=function(w){return!(w.base[0]>this.max[0])&&(!(w.base[1]>this.max[1])&&(!(w.base[2]>this.max[2])&&(!(w.max[0]<this.base[0])&&(!(w.max[1]<this.base[1])&&!(w.max[2]<this.base[2])))))},d.touches=function(w){var p=this.union(w);return null!==p&&(0==p.width()||0==p.height()||0==p.depth())},d.union=function(w){if(!this.intersects(w))return null;var p=Math.max(w.base[0],this.base[0]),e=Math.max(w.base[1],this.base[1]),r=Math.max(w.base[2],this.base[2]);return new I([p,e,r],[Math.min(w.max[0],this.max[0])-p,Math.min(w.max[1],this.max[1])-e,Math.min(w.max[2],this.max[2])-r])}},13177:(w,p)=>{"use strict";function e(w){var p=32;return(w&=-w)&&p--,65535&w&&(p-=16),16711935&w&&(p-=8),252645135&w&&(p-=4),858993459&w&&(p-=2),1431655765&w&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(w){return(w>0)-(w<0)},p.abs=function(w){var p=w>>31;return(w^p)-p},p.min=function(w,p){return p^(w^p)&-(w<p)},p.max=function(w,p){return w^(w^p)&-(w<p)},p.isPow2=function(w){return!(w&w-1)&&!!w},p.log2=function(w){var p,e;return p=(w>65535)<<4,p|=e=((w>>>=p)>255)<<3,p|=e=((w>>>=e)>15)<<2,(p|=e=((w>>>=e)>3)<<1)|(w>>>=e)>>1},p.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},p.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},p.countTrailingZeros=e,p.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},p.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},p.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var r=new Array(256);!function(w){for(var p=0;p<256;++p){var e=p,r=p,I=7;for(e>>>=1;e;e>>>=1)r<<=1,r|=1&e,--I;w[p]=r<<I&255}}(r),p.reverse=function(w){return r[255&w]<<24|r[w>>>8&255]<<16|r[w>>>16&255]<<8|r[w>>>24&255]},p.interleave2=function(w,p){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(w,p){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>p&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},p.interleave3=function(w,p,e){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},p.deinterleave3=function(w,p){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>p&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},p.nextCombination=function(w){var p=w|w-1;return p+1|(~p&-~p)-1>>>e(w)+1}},13162:(w,p,e)=>{"use strict";w.exports=function(w,p,e){switch(arguments.length){case 1:return r=[],j(I=w,I,X,!0),r;case 2:return"function"===typeof p?j(w,w,p,!0):function(w,p){return r=[],j(w,p,X,!1),r}(w,p);case 3:return j(w,p,e,!1);default:throw new Error("box-intersect: Invalid arguments")}var I};var r,I=e(13170),d=e(13188),f=e(13201);function q(w,p){for(var e=0;e<w;++e)if(!(p[e]<=p[e+w]))return!0;return!1}function E(w,p,e,r){for(var I=0,d=0,f=0,E=w.length;f<E;++f){var j=w[f];if(!q(p,j)){for(var X=0;X<2*p;++X)e[I++]=j[X];r[d++]=f}}return d}function j(w,p,e,r){var q=w.length,j=p.length;if(!(q<=0||j<=0)){var X=w[0].length>>>1;if(!(X<=0)){var k,m=I.mallocDouble(2*X*q),J=I.mallocInt32(q);if((q=E(w,X,m,J))>0){if(1===X&&r)d.init(q),k=d.sweepComplete(X,e,0,q,m,J,0,q,m,J);else{var K=I.mallocDouble(2*X*j),y=I.mallocInt32(j);(j=E(p,X,K,y))>0&&(d.init(q+j),k=1===X?d.sweepBipartite(X,e,0,q,m,J,0,j,K,y):f(X,e,r,q,m,J,j,K,y),I.free(K),I.free(y))}I.free(m),I.free(J)}return k}}}function X(w,p){r.push([w,p])}},13203:(w,p)=>{"use strict";var e="d",r="ax",I="fp",d="es",f="rs",q="re",E="rb",j="bs",X="be",k="bb",m=[e,r,"vv",f,q,E,"ri",j,X,k,"bi"];function J(w){var p="bruteForce"+(w?"Full":"Partial"),r=[],f=m.slice();w||f.splice(3,0,I);var q=["function "+p+"("+f.join()+"){"];function E(p,I){var f=function(w,p,r){var I="bruteForce"+(w?"Red":"Blue")+(p?"Flip":"")+(r?"Full":""),f=["function ",I,"(",m.join(),"){","var ",d,"=2*",e,";"],q="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",E="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(r?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return w?f.push(q,"Q",":",E):f.push(E,"Q",":",q),r?f.push("if(y1<x0||x1<y0)continue;"):p?f.push("if(y0<=x0||x1<y0)continue;"):f.push("if(y0<x0||x1<y0)continue;"),f.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),p?f.push("yi,xi"):f.push("xi,yi"),f.push(");if(rv!==void 0)return rv;}}}"),{name:I,code:f.join("")}}(p,I,w);r.push(f.code),q.push("return "+f.name+"("+m.join()+");")}q.push("if(re-rs>be-bs){"),w?(E(!0,!1),q.push("}else{"),E(!1,!1)):(q.push("if(fp){"),E(!0,!0),q.push("}else{"),E(!0,!1),q.push("}}else{if(fp){"),E(!1,!0),q.push("}else{"),E(!1,!1),q.push("}")),q.push("}}return "+p);var j=r.join("")+q.join("");return new Function(j)()}p.partial=J(!1),p.full=J(!0)},13201:(w,p,e)=>{"use strict";w.exports=function(w,p,e,d,X,N,U,v,R){!function(w,p){var e=8*I.log2(p+1)*(w+1)|0,d=I.nextPow2(A*e);M.length<d&&(r.free(M),M=r.mallocInt32(d));var f=I.nextPow2(z*e);i.length<f&&(r.free(i),i=r.mallocDouble(f))}(w,d+U);var V,b=0,h=2*w;t(b++,0,0,d,0,U,e?16:0,-1/0,1/0),e||t(b++,0,0,U,0,d,1,-1/0,1/0);for(;b>0;){var P=(b-=1)*A,u=M[P],Y=M[P+1],L=M[P+2],W=M[P+3],F=M[P+4],H=M[P+5],B=b*z,D=i[B],T=i[B+1],Z=1&H,G=!!(16&H),g=X,o=N,C=v,Q=R;if(Z&&(g=v,o=R,C=X,Q=N),!(2&H&&Y>=(L=c(w,u,Y,L,g,o,T)))&&!(4&H&&(Y=s(w,u,Y,L,g,o,D))>=L)){var x=L-Y,S=F-W;if(G){if(w*x*(x+S)<J){if(void 0!==(V=E.scanComplete(w,u,p,Y,L,g,o,W,F,C,Q)))return V;continue}}else{if(w*Math.min(x,S)<k){if(void 0!==(V=f(w,u,p,Z,Y,L,g,o,W,F,C,Q)))return V;continue}if(w*x*S<m){if(void 0!==(V=E.scanBipartite(w,u,p,Z,Y,L,g,o,W,F,C,Q)))return V;continue}}var ww=K(w,u,Y,L,g,o,D,T);if(Y<ww)if(w*(ww-Y)<k){if(void 0!==(V=q(w,u+1,p,Y,ww,g,o,W,F,C,Q)))return V}else if(u===w-2){if(void 0!==(V=Z?E.sweepBipartite(w,p,W,F,C,Q,Y,ww,g,o):E.sweepBipartite(w,p,Y,ww,g,o,W,F,C,Q)))return V}else t(b++,u+1,Y,ww,W,F,Z,-1/0,1/0),t(b++,u+1,W,F,Y,ww,1^Z,-1/0,1/0);if(ww<L){var pw=j(w,u,W,F,C,Q),ew=C[h*pw+u],rw=y(w,u,pw,F,C,Q,ew);if(rw<F&&t(b++,u,ww,L,rw,F,(4|Z)+(G?16:0),ew,T),W<pw&&t(b++,u,ww,L,W,pw,(2|Z)+(G?16:0),D,ew),pw+1===rw){if(void 0!==(V=G?l(w,u,p,ww,L,g,o,pw,C,Q[pw]):n(w,u,p,Z,ww,L,g,o,pw,C,Q[pw])))return V}else if(pw<rw){var Iw;if(G){if(ww<(Iw=O(w,u,ww,L,g,o,ew))){var dw=y(w,u,ww,Iw,g,o,ew);if(u===w-2){if(ww<dw&&void 0!==(V=E.sweepComplete(w,p,ww,dw,g,o,pw,rw,C,Q)))return V;if(dw<Iw&&void 0!==(V=E.sweepBipartite(w,p,dw,Iw,g,o,pw,rw,C,Q)))return V}else ww<dw&&t(b++,u+1,ww,dw,pw,rw,16,-1/0,1/0),dw<Iw&&(t(b++,u+1,dw,Iw,pw,rw,0,-1/0,1/0),t(b++,u+1,pw,rw,dw,Iw,1,-1/0,1/0))}}else ww<(Iw=Z?a(w,u,ww,L,g,o,ew):O(w,u,ww,L,g,o,ew))&&(u===w-2?V=Z?E.sweepBipartite(w,p,pw,rw,C,Q,ww,Iw,g,o):E.sweepBipartite(w,p,ww,Iw,g,o,pw,rw,C,Q):(t(b++,u+1,ww,Iw,pw,rw,Z,-1/0,1/0),t(b++,u+1,pw,rw,ww,Iw,1^Z,-1/0,1/0)))}}}}};var r=e(13170),I=e(13177),d=e(13203),f=d.partial,q=d.full,E=e(13188),j=e(13209),X=e(13215),k=128,m=1<<22,J=1<<22,K=X("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),y=X("lo===p0",["p0"]),c=X("lo<p0",["p0"]),s=X("hi<=p0",["p0"]),O=X("lo<=p0&&p0<=hi",["p0"]),a=X("lo<p0&&p0<=hi",["p0"]),A=6,z=2,M=r.mallocInt32(1024),i=r.mallocDouble(1024);function t(w,p,e,r,I,d,f,q,E){var j=A*w;M[j]=p,M[j+1]=e,M[j+2]=r,M[j+3]=I,M[j+4]=d,M[j+5]=f;var X=z*w;i[X]=q,i[X+1]=E}function n(w,p,e,r,I,d,f,q,E,j,X){var k=2*w,m=E*k,J=j[m+p];w:for(var K=I,y=I*k;K<d;++K,y+=k){var c=f[y+p],s=f[y+p+w];if(!(J<c||s<J)&&(!r||J!==c)){for(var O,a=q[K],A=p+1;A<w;++A){c=f[y+A],s=f[y+A+w];var z=j[m+A],M=j[m+A+w];if(s<z||M<c)continue w}if(void 0!==(O=r?e(X,a):e(a,X)))return O}}}function l(w,p,e,r,I,d,f,q,E,j){var X=2*w,k=q*X,m=E[k+p];w:for(var J=r,K=r*X;J<I;++J,K+=X){var y=f[J];if(y!==j){var c=d[K+p],s=d[K+p+w];if(!(m<c||s<m)){for(var O=p+1;O<w;++O){c=d[K+O],s=d[K+O+w];var a=E[k+O],A=E[k+O+w];if(s<a||A<c)continue w}var z=e(y,j);if(void 0!==z)return z}}}}},13209:(w,p,e)=>{"use strict";w.exports=function(w,p,e,f,q,E){if(f<=e+1)return e;var j=e,X=f,k=f+e>>>1,m=2*w,J=k,K=q[m*k+p];for(;j<X;){if(X-j<I){d(w,p,j,X,q,E),K=q[m*k+p];break}var y=X-j,c=Math.random()*y+j|0,s=q[m*c+p],O=Math.random()*y+j|0,a=q[m*O+p],A=Math.random()*y+j|0,z=q[m*A+p];s<=a?z>=a?(J=O,K=a):s>=z?(J=c,K=s):(J=A,K=z):a>=z?(J=O,K=a):z>=s?(J=c,K=s):(J=A,K=z);for(var M=m*(X-1),i=m*J,t=0;t<m;++t,++M,++i){var n=q[M];q[M]=q[i],q[i]=n}var l=E[X-1];E[X-1]=E[J],E[J]=l;for(M=m*(X-1),i=m*(J=r(w,p,j,X-1,q,E,K)),t=0;t<m;++t,++M,++i){n=q[M];q[M]=q[i],q[i]=n}l=E[X-1];if(E[X-1]=E[J],E[J]=l,k<J){for(X=J-1;j<X&&q[m*(X-1)+p]===K;)X-=1;X+=1}else{if(!(J<k))break;for(j=J+1;j<X&&q[m*j+p]===K;)j+=1}}return r(w,p,e,k,q,E,q[m*k+p])};var r=e(13215)("lo<p0",["p0"]),I=8;function d(w,p,e,r,I,d){for(var f=2*w,q=f*(e+1)+p,E=e+1;E<r;++E,q+=f)for(var j=I[q],X=E,k=f*(E-1);X>e&&I[k+p]>j;--X,k-=f){for(var m=k,J=k+f,K=0;K<f;++K,++m,++J){var y=I[m];I[m]=I[J],I[J]=y}var c=d[X];d[X]=d[X-1],d[X-1]=c}}},13215:w=>{"use strict";w.exports=function(w,e){var r="abcdef".split("").concat(e),I=[];w.indexOf("lo")>=0&&I.push("lo=e[k+n]");w.indexOf("hi")>=0&&I.push("hi=e[k+o]");return r.push(p.replace("_",I.join()).replace("$",w)),Function.apply(void 0,r)};var p="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13194:w=>{"use strict";w.exports=function(w,r){r<=4*p?e(0,r-1,w):j(0,r-1,w)};var p=32;function e(w,p,e){for(var r=2*(w+1),I=w+1;I<=p;++I){for(var d=e[r++],f=e[r++],q=I,E=r-2;q-- >w;){var j=e[E-2],X=e[E-1];if(j<d)break;if(j===d&&X<f)break;e[E]=j,e[E+1]=X,E-=2}e[E]=d,e[E+1]=f}}function r(w,p,e){p*=2;var r=e[w*=2],I=e[w+1];e[w]=e[p],e[w+1]=e[p+1],e[p]=r,e[p+1]=I}function I(w,p,e){p*=2,e[w*=2]=e[p],e[w+1]=e[p+1]}function d(w,p,e,r){p*=2,e*=2;var I=r[w*=2],d=r[w+1];r[w]=r[p],r[w+1]=r[p+1],r[p]=r[e],r[p+1]=r[e+1],r[e]=I,r[e+1]=d}function f(w,p,e,r,I){p*=2,I[w*=2]=I[p],I[p]=e,I[w+1]=I[p+1],I[p+1]=r}function q(w,p,e){p*=2;var r=e[w*=2],I=e[p];return!(r<I)&&(r!==I||e[w+1]>e[p+1])}function E(w,p,e,r){var I=r[w*=2];return I<p||I===p&&r[w+1]<e}function j(w,X,k){var m=(X-w+1)/6|0,J=w+m,K=X-m,y=w+X>>1,c=y-m,s=y+m,O=J,a=c,A=y,z=s,M=K,i=w+1,t=X-1,n=0;q(O,a,k)&&(n=O,O=a,a=n),q(z,M,k)&&(n=z,z=M,M=n),q(O,A,k)&&(n=O,O=A,A=n),q(a,A,k)&&(n=a,a=A,A=n),q(O,z,k)&&(n=O,O=z,z=n),q(A,z,k)&&(n=A,A=z,z=n),q(a,M,k)&&(n=a,a=M,M=n),q(a,A,k)&&(n=a,a=A,A=n),q(z,M,k)&&(n=z,z=M,M=n);for(var l=k[2*a],N=k[2*a+1],U=k[2*z],v=k[2*z+1],R=2*O,V=2*A,b=2*M,h=2*J,P=2*y,u=2*K,Y=0;Y<2;++Y){var L=k[R+Y],W=k[V+Y],F=k[b+Y];k[h+Y]=L,k[P+Y]=W,k[u+Y]=F}I(c,w,k),I(s,X,k);for(var H=i;H<=t;++H)if(E(H,l,N,k))H!==i&&r(H,i,k),++i;else if(!E(H,U,v,k))for(;;){if(E(t,U,v,k)){E(t,l,N,k)?(d(H,i,t,k),++i,--t):(r(H,t,k),--t);break}if(--t<H)break}f(w,i-1,l,N,k),f(X,t+1,U,v,k),i-2-w<=p?e(w,i-2,k):j(w,i-2,k),X-(t+2)<=p?e(t+2,X,k):j(t+2,X,k),t-i<=p?e(i,t,k):j(i,t,k)}},13188:(w,p,e)=>{"use strict";w.exports={init:function(w){var p=I.nextPow2(w);E.length<p&&(r.free(E),E=r.mallocInt32(p));j.length<p&&(r.free(j),j=r.mallocInt32(p));X.length<p&&(r.free(X),X=r.mallocInt32(p));k.length<p&&(r.free(k),k=r.mallocInt32(p));m.length<p&&(r.free(m),m=r.mallocInt32(p));J.length<p&&(r.free(J),J=r.mallocInt32(p));var e=8*p;K.length<e&&(r.free(K),K=r.mallocDouble(e))},sweepBipartite:function(w,p,e,r,I,q,m,J,s,O){for(var a=0,A=2*w,z=w-1,M=A-1,i=e;i<r;++i){var t=q[i],n=A*i;K[a++]=I[n+z],K[a++]=-(t+1),K[a++]=I[n+M],K[a++]=t}for(i=m;i<J;++i){t=O[i]+f;var l=A*i;K[a++]=s[l+z],K[a++]=-t,K[a++]=s[l+M],K[a++]=t}var N=a>>>1;d(K,N);var U=0,v=0;for(i=0;i<N;++i){var R=0|K[2*i+1];if(R>=f)y(X,k,v--,R=R-f|0);else if(R>=0)y(E,j,U--,R);else if(R<=-f){R=-R-f|0;for(var V=0;V<U;++V){if(void 0!==(b=p(E[V],R)))return b}c(X,k,v++,R)}else{R=-R-1|0;for(V=0;V<v;++V){var b;if(void 0!==(b=p(R,X[V])))return b}c(E,j,U++,R)}}},sweepComplete:function(w,p,e,r,I,f,q,s,O,a){for(var A=0,z=2*w,M=w-1,i=z-1,t=e;t<r;++t){var n=f[t]+1<<1,l=z*t;K[A++]=I[l+M],K[A++]=-n,K[A++]=I[l+i],K[A++]=n}for(t=q;t<s;++t){n=a[t]+1<<1;var N=z*t;K[A++]=O[N+M],K[A++]=1|-n,K[A++]=O[N+i],K[A++]=1|n}var U=A>>>1;d(K,U);var v=0,R=0,V=0;for(t=0;t<U;++t){var b=0|K[2*t+1],h=1&b;if(t<U-1&&b>>1===K[2*t+3]>>1&&(h=2,t+=1),b<0){for(var P=-(b>>1)-1,u=0;u<V;++u){if(void 0!==(Y=p(m[u],P)))return Y}if(0!==h)for(u=0;u<v;++u){if(void 0!==(Y=p(E[u],P)))return Y}if(1!==h)for(u=0;u<R;++u){var Y;if(void 0!==(Y=p(X[u],P)))return Y}0===h?c(E,j,v++,P):1===h?c(X,k,R++,P):2===h&&c(m,J,V++,P)}else{P=(b>>1)-1;0===h?y(E,j,v--,P):1===h?y(X,k,R--,P):2===h&&y(m,J,V--,P)}}},scanBipartite:function(w,p,e,r,I,q,X,k,m,J,s,O){var a=0,A=2*w,z=p,M=p+w,i=1,t=1;r?t=f:i=f;for(var n=I;n<q;++n){var l=n+i,N=A*n;K[a++]=X[N+z],K[a++]=-l,K[a++]=X[N+M],K[a++]=l}for(n=m;n<J;++n){l=n+t;var U=A*n;K[a++]=s[U+z],K[a++]=-l}var v=a>>>1;d(K,v);var R=0;for(n=0;n<v;++n){var V=0|K[2*n+1];if(V<0){var b=!1;if((l=-V)>=f?(b=!r,l-=f):(b=!!r,l-=1),b)c(E,j,R++,l);else{var h=O[l],P=A*l,u=s[P+p+1],Y=s[P+p+1+w];w:for(var L=0;L<R;++L){var W=E[L],F=A*W;if(!(Y<X[F+p+1]||X[F+p+1+w]<u)){for(var H=p+2;H<w;++H)if(s[P+H+w]<X[F+H]||X[F+H+w]<s[P+H])continue w;var B,D=k[W];if(void 0!==(B=r?e(h,D):e(D,h)))return B}}}}else y(E,j,R--,V-i)}},scanComplete:function(w,p,e,r,I,q,j,X,k,m,J){for(var y=0,c=2*w,s=p,O=p+w,a=r;a<I;++a){var A=a+f,z=c*a;K[y++]=q[z+s],K[y++]=-A,K[y++]=q[z+O],K[y++]=A}for(a=X;a<k;++a){A=a+1;var M=c*a;K[y++]=m[M+s],K[y++]=-A}var i=y>>>1;d(K,i);var t=0;for(a=0;a<i;++a){var n=0|K[2*a+1];if(n<0){if((A=-n)>=f)E[t++]=A-f;else{var l=J[A-=1],N=c*A,U=m[N+p+1],v=m[N+p+1+w];w:for(var R=0;R<t;++R){var V=E[R],b=j[V];if(b===l)break;var h=c*V;if(!(v<q[h+p+1]||q[h+p+1+w]<U)){for(var P=p+2;P<w;++P)if(m[N+P+w]<q[h+P]||q[h+P+w]<m[N+P])continue w;var u=e(b,l);if(void 0!==u)return u}}}}else{for(A=n-f,R=t-1;R>=0;--R)if(E[R]===A){for(P=R+1;P<t;++P)E[P-1]=E[P];break}--t}}}};var r=e(13170),I=e(13177),d=e(13194),f=1<<28,q=1024,E=r.mallocInt32(q),j=r.mallocInt32(q),X=r.mallocInt32(q),k=r.mallocInt32(q),m=r.mallocInt32(q),J=r.mallocInt32(q),K=r.mallocDouble(8192);function y(w,p,e,r){var I=p[r],d=w[e-1];w[I]=d,p[d]=I}function c(w,p,e,r){w[e]=r,p[r]=e}},13182:w=>{"use strict";function p(w,e,r){var I=0|w[r];if(I<=0)return[];var d,f=new Array(I);if(r===w.length-1)for(d=0;d<I;++d)f[d]=e;else for(d=0;d<I;++d)f[d]=p(w,e,r+1);return f}w.exports=function(w,e){switch("undefined"===typeof e&&(e=0),typeof w){case"number":if(w>0)return function(w,p){var e,r;for(e=new Array(w),r=0;r<w;++r)e[r]=p;return e}(0|w,e);break;case"object":if("number"===typeof w.length)return p(w,e,0)}return[]}},13127:(w,p,e)=>{w.exports=function(){var w=this;this.components={},this.comps=this.components;var p=this.components,e=1,I={},d=[],f=[],q={timeout:!1,removals:[],multiComps:[]};function E(w,e){var r=p[e],d=I[e],f=d.hash[w];f&&(d.remove(w),r.ip&&(r.multi?(f.forEach((p=>{p&&r.ip(w,p)})),f.length=0):r.ip(w,f)),q.removals.push(d),j())}function j(){q.timeout||(q.timeout=!0,setTimeout(X,1))}function X(){q.timeout=!1,k()}function k(){q.multiComps.length&&function(w){for(var p=0;p<w.length;p++){var{entID:e,data:r}=w[p],I=r.hash[e];if(I){for(var d=0;d<I.length;d++)I[d]||(I.splice(d,1),d--);0===I.length&&(r.remove(e),q.removals.push(r))}}w.length=0}(q.multiComps),q.removals.length&&function(w){for(var p=0;p<w.length;p++){w[p].flush()}w.length=0}(q.removals)}this.hk=I,this._systems=d,this._renderSystems=f,this.MX=function(p){var r=e++;return Array.isArray(p)&&p.forEach((p=>w.jj(r,p))),r},this.deleteEntity=function(p){return Object.keys(I).forEach((w=>{I[w].hash[p]&&E(p,w)})),w},this.WX=function(w){if(!w)throw new Error("Missing component definition");var e=w.name;if(!e)throw new Error("Component definition must have a name property.");if("string"!==typeof e)throw new Error("Component name must be a string.");if(""===e)throw new Error("Component name must be a non-empty string.");if(I[e])throw new Error(`Component ${e} already exists.`);var q={};return q.name=e,q.multi=!!w.multi,q.order=isNaN(w.order)?99:w.order,q.stateConstructor=w.stateConstructor||null,q.state=w.state||{},q.JE=w.JE||null,q.ip=w.ip||null,q.system=w.system||null,q.zE=w.zE||null,p[e]=q,I[e]=new r,I[e]._pendingMultiCleanup=!1,I[e]._multiCleanupIDs=q.multi?[]:null,q.system&&(d.push(e),d.sort(((w,e)=>p[w].order-p[e].order))),q.zE&&(f.push(e),f.sort(((w,e)=>p[w].order-p[e].order))),e},this.overwriteComponent=function(w,e){var r=p[w];if(!r)throw new Error(`Unknown component: ${w}`);if(!e)throw new Error("Missing component definition");if(r.name!==e.name)throw new Error("Overwriting component must use the same name property.");var q={};q.name=w,q.multi=!!e.multi,q.order=isNaN(e.order)?99:e.order,q.state=e.state||{},q.JE=e.JE||null,q.ip=e.ip||null,q.system=e.system||null,q.zE=e.zE||null,p[w]=q,I[w]._pendingMultiCleanup=!1,I[w]._multiCleanupIDs=q.multi?[]:null;var E=d.indexOf(w);q.system&&E<0&&d.push(w),!q.system&&E>=0&&d.splice(E,1),d.sort(((w,e)=>p[w].order-p[e].order));var j=f.indexOf(w);q.zE&&j<0&&f.push(w),!q.zE&&j>=0&&f.splice(j,1),f.sort(((w,e)=>p[w].order-p[e].order));var X=q.state;return this.fX(w).forEach((w=>{for(var p in X)p in w||(w[p]=X[p]);q.JE&&q.JE(w.aE,w)})),w},this.deleteComponent=function(e){var r=I[e];if(!r)throw new Error(`Unknown component: ${e}`);r.flush(),r.list.forEach((w=>{w&&E(w.aE||w[0].aE,e)}));var q=d.indexOf(e),j=f.indexOf(e);return q>-1&&d.splice(q,1),j>-1&&f.splice(j,1),I[e].dispose(),delete I[e],delete p[e],w},this.jj=function(w,e,r){var d,f=p[e],q=I[e];if(!q)throw new Error(`Unknown component: ${e}.`);if(q.hash[w]&&!f.multi)throw new Error(`Entity ${w} already has component: ${e}.`);if(f.stateConstructor){if(!(d=new f.stateConstructor).hasOwnProperty("aE"))throw new Error(`Component ${f.name} stateConstructor type does not have property __id`)}else d=Object.assign({},{aE:w},f.state,r);if(d.aE=w,f.multi){var E=q.hash[w];E||(E=[],q.add(w,E)),E.push(d)}else q.add(w,d);return f.JE&&f.JE(w,d),this},this.Oj=function(w,p){var e=I[p];if(!e)throw new Error(`Unknown component: ${p}.`);return!!e.hash[w]},this.Jj=function(p,e){if(!I[e])throw new Error(`Unknown component: ${e}.`);return E(p,e),w},this.getState=function(w,p){var e=I[p];if(!e)throw new Error(`Unknown component: ${p}.`);return e.hash[w]},this.fX=function(w){var p=I[w];if(!p)throw new Error(`Unknown component: ${w}.`);return k(),p.list},this.vJ=function(w){if(!I[w])throw new Error(`Unknown component: ${w}.`);var p=I[w].hash;return w=>p[w]},this.bJ=function(w){if(!I[w])throw new Error(`Unknown component: ${w}.`);var p=I[w].hash;return w=>!!p[w]},this.jE=function(e){k();for(var r=0;r<d.length;r++){var f=d[r],q=p[f],E=I[f];q.system(e,E.list),k()}return w},this.render=function(e){k();for(var r=0;r<f.length;r++){var d=f[r],q=p[d],E=I[d];q.zE(e,E.list),k()}return w},this.removeMultiComponent=function(e,r,d){var f=p[r],E=I[r];if(!E)throw new Error(`Unknown component: ${r}.`);if(!f.multi)throw new Error("removeMultiComponent called on non-multi component");return function(w,p,e,r){var I=e.hash[w];if(I){var d=I[r];d&&(I[r]=null,p.ip&&p.ip(w,d),q.multiComps.push({entID:w,data:e}),j())}}(e,f,E,d),w}};var r=e(13130)},13130:w=>{function p(w,p){var e=w._map[p];if(delete w.hash[p],delete w._map[p],e===w.list.length-1)w.list.pop();else{var r=w.list.pop();if(w.list[e]=r,null===r||null===r[0]){var I=w.list.length;for(var d in w._map)if(w._map[d]===I)return void(w._map[d]=e)}else{var f=r.aE||r[0].aE;w._map[f]=e}}}w.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(w,p){if("number"===typeof this._map[w]){var e=this._map[w];this.hash[w]=p,this.list[e]=p}else this._map[w]=this.list.length,this.hash[w]=p,this.list.push(p)}remove(w){var p=this._map[w];this.hash[w]=null,this.list[p]=null,this._pendingRemovals.push(w)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var w=0;w<this._pendingRemovals.length;w++){var e=this._pendingRemovals[w];null===this.hash[e]&&p(this,e)}this._pendingRemovals.length=0}}},13087:w=>{"use strict";var p,e="object"===typeof Reflect?Reflect:null,r=function(w,p,e){return Function.prototype.apply.call(w,p,e)};p=e&&"function"===typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var I=Number.isNaN||function(w){return w!==w};function d(){d.init.call(this)}w.exports=d,w.exports.once=function(w,p){return new Promise((function(e,r){function I(e){w.removeListener(p,d),r(e)}function d(){"function"===typeof w.removeListener&&w.removeListener("error",I),e([].slice.call(arguments))}y(w,p,d,{once:!0}),"error"!==p&&function(w,p,e){"function"===typeof w.on&&y(w,"error",p,e)}(w,I,{once:!0})}))},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var f=10;function q(w){if("function"!==typeof w)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function E(w){return void 0===w._maxListeners?d.defaultMaxListeners:w._maxListeners}function j(w,p,e,r){var I,d,f,j;if(q(e),void 0===(d=w._events)?(d=w._events=Object.create(null),w._eventsCount=0):(void 0!==d.newListener&&(w.emit("newListener",p,e.listener?e.listener:e),d=w._events),f=d[p]),void 0===f)f=d[p]=e,++w._eventsCount;else if("function"===typeof f?f=d[p]=r?[e,f]:[f,e]:r?f.unshift(e):f.push(e),(I=E(w))>0&&f.length>I&&!f.warned){f.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");X.name="MaxListenersExceededWarning",X.i=w,X.type=p,X.count=f.length,j=X,console&&console.warn&&console.warn(j)}return w}function X(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(w,p,e){var r={fired:!1,wrapFn:void 0,target:w,type:p,listener:e},I=X.bind(r);return I.listener=e,r.wrapFn=I,I}function m(w,p,e){var r=w._events;if(void 0===r)return[];var I=r[p];return void 0===I?[]:"function"===typeof I?e?[I.listener||I]:[I]:e?function(w){for(var p=new Array(w.length),e=0;e<p.length;++e)p[e]=w[e].listener||w[e];return p}(I):K(I,I.length)}function J(w){var p=this._events;if(void 0!==p){var e=p[w];if("function"===typeof e)return 1;if(void 0!==e)return e.length}return 0}function K(w,p){for(var e=new Array(p),r=0;r<p;++r)e[r]=w[r];return e}function y(w,p,e,r){if("function"===typeof w.on)r.once?w.once(p,e):w.on(p,e);else{if("function"!==typeof w.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w);w.addEventListener(p,(function I(d){r.once&&w.removeEventListener(p,I),e(d)}))}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(w){if("number"!==typeof w||w<0||I(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");f=w}}),d.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(w){if("number"!==typeof w||w<0||I(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},d.prototype.getMaxListeners=function(){return E(this)},d.prototype.emit=function(w){for(var p=[],e=1;e<arguments.length;e++)p.push(arguments[e]);var I="error"===w,d=this._events;if(void 0!==d)I=I&&void 0===d.error;else if(!I)return!1;if(I){var f;if(p.length>0&&(f=p[0]),f instanceof Error)throw f;var q=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw q.context=f,q}var E=d[w];if(void 0===E)return!1;if("function"===typeof E)r(E,this,p);else{var j=E.length,X=K(E,j);for(e=0;e<j;++e)r(X[e],this,p)}return!0},d.prototype.addListener=function(w,p){return j(this,w,p,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(w,p){return j(this,w,p,!0)},d.prototype.once=function(w,p){return q(p),this.on(w,k(this,w,p)),this},d.prototype.prependOnceListener=function(w,p){return q(p),this.prependListener(w,k(this,w,p)),this},d.prototype.removeListener=function(w,p){var e,r,I,d,f;if(q(p),void 0===(r=this._events))return this;if(void 0===(e=r[w]))return this;if(e===p||e.listener===p)0===--this._eventsCount?this._events=Object.create(null):(delete r[w],r.removeListener&&this.emit("removeListener",w,e.listener||p));else if("function"!==typeof e){for(I=-1,d=e.length-1;d>=0;d--)if(e[d]===p||e[d].listener===p){f=e[d].listener,I=d;break}if(I<0)return this;0===I?e.shift():function(w,p){for(;p+1<w.length;p++)w[p]=w[p+1];w.pop()}(e,I),1===e.length&&(r[w]=e[0]),void 0!==r.removeListener&&this.emit("removeListener",w,f||p)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(w){var p,e,r;if(void 0===(e=this._events))return this;if(void 0===e.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==e[w]&&(0===--this._eventsCount?this._events=Object.create(null):delete e[w]),this;if(0===arguments.length){var I,d=Object.keys(e);for(r=0;r<d.length;++r)"removeListener"!==(I=d[r])&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(p=e[w]))this.removeListener(w,p);else if(void 0!==p)for(r=p.length-1;r>=0;r--)this.removeListener(w,p[r]);return this},d.prototype.listeners=function(w){return m(this,w,!0)},d.prototype.rawListeners=function(w){return m(this,w,!1)},d.listenerCount=function(w,p){return"function"===typeof w.listenerCount?w.listenerCount(p):J.call(w,p)},d.prototype.listenerCount=J,d.prototype.eventNames=function(){return this._eventsCount>0?p(this._events):[]}},13398:w=>{"use strict";w.exports=function(w,p,e,r,I,d){var f=+p[0],q=+p[1],E=+p[2],j=+e[0],X=+e[1],k=+e[2],m=Math.sqrt(j*j+X*X+k*k);if(0===m)throw new Error("Can't raycast along a zero vector");return function(w,p,e,r,I,d,f,q,E,j){for(var X=0,k=Math.floor,m=0|k(p),J=0|k(e),K=0|k(r),y=I>0?1:-1,c=d>0?1:-1,s=f>0?1:-1,O=Math.abs(1/I),a=Math.abs(1/d),A=Math.abs(1/f),z=O<1/0?O*(y>0?m+1-p:p-m):1/0,M=a<1/0?a*(c>0?J+1-e:e-J):1/0,i=A<1/0?A*(s>0?K+1-r:r-K):1/0,t=-1;X<=q;){var n=w(m,J,K);if(n)return E&&(E[0]=p+X*I,E[1]=e+X*d,E[2]=r+X*f),j&&(j[0]=j[1]=j[2]=0,0===t&&(j[0]=-y),1===t&&(j[1]=-c),2===t&&(j[2]=-s)),n;z<M?z<i?(m+=y,X=z,z+=O,t=0):(K+=s,X=i,i+=A,t=2):M<i?(J+=c,X=M,M+=a,t=1):(K+=s,X=i,i+=A,t=2)}return E&&(E[0]=p+X*I,E[1]=e+X*d,E[2]=r+X*f),j&&(j[0]=j[1]=j[2]=0),0}(w,f,q,E,j/=m,X/=m,k/=m,r="undefined"===typeof r?64:+r,I,d)}},13440:(w,p,e)=>{"use strict";e.d(p,{c:()=>d});var r=e(13087);function I(){this.vm=!1,this.stopPropagation=!1,this.Rm=!1,this.disabled=!1}class d{constructor(w,p){this.version="0.7.0";var e=Object.assign({},new I,p||{});this.element=w||document,this.vm=!!e.vm,this.stopPropagation=!!e.stopPropagation,this.Rm=!!e.Rm,this.disabled=!!e.disabled,this.filterEvents=(w,p)=>!0,this.down=new r.EventEmitter,this.up=new r.EventEmitter,this.state={},this.Sj={dx:0,dy:0,AJ:0,xj:0,zJ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?q(this):document.addEventListener("DOMContentLoaded",(w=>{q(this)}),{once:!0})}bind(w){for(var p=arguments.length,e=new Array(p>1?p-1:0),r=1;r<p;r++)e[r-1]=arguments[r];e.forEach((p=>{var e=this._keyBindmap[p]||[];e.includes(w)||(e.push(w),this._keyBindmap[p]=e)})),this.state[w]=!!this.state[w],this.pressCount[w]=this.pressCount[w]||0,this.releaseCount[w]=this.releaseCount[w]||0}unbind(w){for(var p in this._keyBindmap){var e=this._keyBindmap[p],r=e.indexOf(w);r>-1&&e.splice(r,1)}}getBindings(){var w={};for(var p in this._keyBindmap){this._keyBindmap[p].forEach((e=>{w[e]=w[e]||[],w[e].push(p)}))}return w}jE(){f(this.Sj),f(this.pressCount),f(this.releaseCount)}}function f(w){for(var p in w)w[p]=0}function q(w){window.addEventListener("keydown",K.bind(null,w,!0),!1),window.addEventListener("keyup",K.bind(null,w,!1),!1);var p={passive:!0};w.element.addEventListener("touchstart",k.bind(void 0,w),{passive:!1}),w.element.addEventListener("touchend",J.bind(void 0,w),p),w.element.addEventListener("mousedown",y.bind(null,w,!0),p),window.document.addEventListener("mouseup",y.bind(null,w,!1),p),w.element.addEventListener("touchmove",c.bind(null,w),p),w.element.addEventListener("mousemove",c.bind(null,w),p),window.PointerEvent,w.element.addEventListener("wheel",s.bind(null,w),p),w.element.addEventListener("contextmenu",O.bind(null,w),!1),window.addEventListener("blur",a.bind(null,w),!1)}var E=0,j=0,X=null;function k(w,p){p.preventDefault(),m(p)}function m(w){let p=!1;for(let e=0;e<w.touches.length;++e)if(w.touches[e].identifier===X){p=!0;break}if(!p){const p=w.changedTouches[0];E=p.clientX,j=p.clientY,X=p.identifier}}function J(w,p){for(var e=p.changedTouches,r=0;r<e.length;++r)e[r].identifier===X&&(X=null)}function K(w,p,e){A(e.code,p,w,e)}function y(w,p,e){if("pointerId"in e)if(p){if(null!==w._touches.currID)return;w._touches.currID=e.pointerId}else{if(w._touches.currID!==e.pointerId)return;w._touches.currID=null}return A("Mouse"+("button"in e?e.button+1:1),p,w,e),!1}function c(w,p){var e=p.movementX||p.mozMovementX||0,r=p.movementY||p.mozMovementY||0;if(p.touches&&0===(e|r)){var I=function(w){m(w);for(let p=0;p<w.changedTouches.length;++p)if(w.changedTouches[p].identifier==X){const e=w.changedTouches[p],r=[e.clientX-E,e.clientY-j];return E=e.clientX,j=e.clientY,r}return console.error(`Did not find touch id ${X}`),[0,0]}(p);e=I[0],r=I[1]}w.Sj.dx+=e,w.Sj.dy+=r}function s(w,p){var e=1;switch(p.deltaMode){case 0:e=1;break;case 1:e=12;break;case 2:e=w.element.clientHeight||window.innerHeight}w.Sj.AJ+=(p.deltaX||0)*e,w.Sj.xj+=(p.deltaY||0)*e,w.Sj.zJ+=(p.deltaZ||0)*e}function O(w,p){if(!w.Rm)return p.preventDefault(),!1}function a(w){for(var p in w._keyStates)w._keyStates[p]&&(/^Mouse\d/.test(p)||A(p,!1,w,{code:p,note:"7ir557mgx7y",preventDefault:()=>{},stopPropagation:()=>{}}))}function A(w,p,e,r){var I=e._keyBindmap[w];I&&(z(e._keyStates[w],p)&&(e._keyStates[w]=p,I.forEach((w=>{(!e.filterEvents||e.filterEvents(r,w))&&function(w,p,e,r){var I=p?e.pressCount:e.releaseCount;I[w]=(I[w]||0)+1;var d=e._bindPressCount[w]||0;(d+=p?1:-1)<0&&(d=0);e._bindPressCount[w]=d;var f=e.state[w];if(z(f,d)){e.state[w]=d>0;var q=p?e.down:e.up;e.disabled||q.emit(w,r)}}(w,p,e,r)}))),"button"in r||(e.vm&&!r.defaultPrevented&&r.preventDefault(),e.stopPropagation&&r.stopPropagation()))}function z(w,p){return w?!p:p}},12030:w=>{w.exports=function(w,p,e){return w[0]=p[0]+e[0],w[1]=p[1]+e[1],w[2]=p[2]+e[2],w}},11982:(w,p,e)=>{w.exports=function(w,p){var e=r(w[0],w[1],w[2]),f=r(p[0],p[1],p[2]);I(e,e),I(f,f);var q=d(e,f);return q>1?0:Math.acos(q)};var r=e(11990),I=e(11995),d=e(11998)},12077:w=>{w.exports=function(w,p){return w[0]=Math.ceil(p[0]),w[1]=Math.ceil(p[1]),w[2]=Math.ceil(p[2]),w}},11979:w=>{w.exports=function(w){var p=new Float32Array(3);return p[0]=w[0],p[1]=w[1],p[2]=w[2],p}},12006:w=>{w.exports=function(w,p){return w[0]=p[0],w[1]=p[1],w[2]=p[2],w}},11974:w=>{w.exports=function(){var w=new Float32Array(3);return w[0]=0,w[1]=0,w[2]=0,w}},12155:w=>{w.exports=function(w,p,e){var r=p[0],I=p[1],d=p[2],f=e[0],q=e[1],E=e[2];return w[0]=I*E-d*q,w[1]=d*f-r*E,w[2]=r*q-I*f,w}},12100:(w,p,e)=>{w.exports=e(12094)},12094:w=>{w.exports=function(w,p){var e=p[0]-w[0],r=p[1]-w[1],I=p[2]-w[2];return Math.sqrt(e*e+r*r+I*I)}},12060:(w,p,e)=>{w.exports=e(12053)},12053:w=>{w.exports=function(w,p,e){return w[0]=p[0]/e[0],w[1]=p[1]/e[1],w[2]=p[2]/e[2],w}},11998:w=>{w.exports=function(w,p){return w[0]*p[0]+w[1]*p[1]+w[2]*p[2]}},11972:w=>{w.exports=1e-6},12016:(w,p,e)=>{w.exports=function(w,p){var e=w[0],I=w[1],d=w[2],f=p[0],q=p[1],E=p[2];return Math.abs(e-f)<=r*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(I-q)<=r*Math.max(1,Math.abs(I),Math.abs(q))&&Math.abs(d-E)<=r*Math.max(1,Math.abs(d),Math.abs(E))};var r=e(11972)},12021:w=>{w.exports=function(w,p){return w[0]===p[0]&&w[1]===p[1]&&w[2]===p[2]}},12073:w=>{w.exports=function(w,p){return w[0]=Math.floor(p[0]),w[1]=Math.floor(p[1]),w[2]=Math.floor(p[2]),w}},12192:(w,p,e)=>{w.exports=function(w,p,e,I,d,f){var q,E;p||(p=3);e||(e=0);E=I?Math.min(I*p+e,w.length):w.length;for(q=e;q<E;q+=p)r[0]=w[q],r[1]=w[q+1],r[2]=w[q+2],d(r,r,f),w[q]=r[0],w[q+1]=r[1],w[q+2]=r[2];return w};var r=e(11974)()},11990:w=>{w.exports=function(w,p,e){var r=new Float32Array(3);return r[0]=w,r[1]=p,r[2]=e,r}},11968:(w,p,e)=>{w.exports={EPSILON:e(11972),create:e(11974),clone:e(11979),angle:e(11982),pE:e(11990),k:e(12006),set:e(12012),equals:e(12016),exactEquals:e(12021),add:e(12030),Je:e(12036),sub:e(12040),multiply:e(12044),mul:e(12050),divide:e(12053),div:e(12060),min:e(12065),max:e(12068),floor:e(12073),ceil:e(12077),round:e(12079),scale:e(12083),eE:e(12090),distance:e(12094),j:e(12100),squaredDistance:e(12109),sqrDist:e(12114),length:e(12121),len:e(12130),squaredLength:e(12138),rE:e(12140),negate:e(12143),inverse:e(12149),normalize:e(11995),dot:e(11998),cross:e(12155),Qq:e(12158),random:e(12161),transformMat4:e(12165),transformMat3:e(12168),transformQuat:e(12177),IE:e(12179),dE:e(12181),fE:e(12189),forEach:e(12192)}},12149:w=>{w.exports=function(w,p){return w[0]=1/p[0],w[1]=1/p[1],w[2]=1/p[2],w}},12130:(w,p,e)=>{w.exports=e(12121)},12121:w=>{w.exports=function(w){var p=w[0],e=w[1],r=w[2];return Math.sqrt(p*p+e*e+r*r)}},12158:w=>{w.exports=function(w,p,e,r){var I=p[0],d=p[1],f=p[2];return w[0]=I+r*(e[0]-I),w[1]=d+r*(e[1]-d),w[2]=f+r*(e[2]-f),w}},12068:w=>{w.exports=function(w,p,e){return w[0]=Math.max(p[0],e[0]),w[1]=Math.max(p[1],e[1]),w[2]=Math.max(p[2],e[2]),w}},12065:w=>{w.exports=function(w,p,e){return w[0]=Math.min(p[0],e[0]),w[1]=Math.min(p[1],e[1]),w[2]=Math.min(p[2],e[2]),w}},12050:(w,p,e)=>{w.exports=e(12044)},12044:w=>{w.exports=function(w,p,e){return w[0]=p[0]*e[0],w[1]=p[1]*e[1],w[2]=p[2]*e[2],w}},12143:w=>{w.exports=function(w,p){return w[0]=-p[0],w[1]=-p[1],w[2]=-p[2],w}},11995:w=>{w.exports=function(w,p){var e=p[0],r=p[1],I=p[2],d=e*e+r*r+I*I;d>0&&(d=1/Math.sqrt(d),w[0]=p[0]*d,w[1]=p[1]*d,w[2]=p[2]*d);return w}},12161:w=>{w.exports=function(w,p){p=p||1;var e=2*Math.random()*Math.PI,r=2*Math.random()-1,I=Math.sqrt(1-r*r)*p;return w[0]=Math.cos(e)*I,w[1]=Math.sin(e)*I,w[2]=r*p,w}},12179:w=>{w.exports=function(w,p,e,r){var I=e[1],d=e[2],f=p[1]-I,q=p[2]-d,E=Math.sin(r),j=Math.cos(r);return w[0]=p[0],w[1]=I+f*j-q*E,w[2]=d+f*E+q*j,w}},12181:w=>{w.exports=function(w,p,e,r){var I=e[0],d=e[2],f=p[0]-I,q=p[2]-d,E=Math.sin(r),j=Math.cos(r);return w[0]=I+q*E+f*j,w[1]=p[1],w[2]=d+q*j-f*E,w}},12189:w=>{w.exports=function(w,p,e,r){var I=e[0],d=e[1],f=p[0]-I,q=p[1]-d,E=Math.sin(r),j=Math.cos(r);return w[0]=I+f*j-q*E,w[1]=d+f*E+q*j,w[2]=p[2],w}},12079:w=>{w.exports=function(w,p){return w[0]=Math.round(p[0]),w[1]=Math.round(p[1]),w[2]=Math.round(p[2]),w}},12083:w=>{w.exports=function(w,p,e){return w[0]=p[0]*e,w[1]=p[1]*e,w[2]=p[2]*e,w}},12090:w=>{w.exports=function(w,p,e,r){return w[0]=p[0]+e[0]*r,w[1]=p[1]+e[1]*r,w[2]=p[2]+e[2]*r,w}},12012:w=>{w.exports=function(w,p,e,r){return w[0]=p,w[1]=e,w[2]=r,w}},12114:(w,p,e)=>{w.exports=e(12109)},12140:(w,p,e)=>{w.exports=e(12138)},12109:w=>{w.exports=function(w,p){var e=p[0]-w[0],r=p[1]-w[1],I=p[2]-w[2];return e*e+r*r+I*I}},12138:w=>{w.exports=function(w){var p=w[0],e=w[1],r=w[2];return p*p+e*e+r*r}},12040:(w,p,e)=>{w.exports=e(12036)},12036:w=>{w.exports=function(w,p,e){return w[0]=p[0]-e[0],w[1]=p[1]-e[1],w[2]=p[2]-e[2],w}},12168:w=>{w.exports=function(w,p,e){var r=p[0],I=p[1],d=p[2];return w[0]=r*e[0]+I*e[3]+d*e[6],w[1]=r*e[1]+I*e[4]+d*e[7],w[2]=r*e[2]+I*e[5]+d*e[8],w}},12165:w=>{w.exports=function(w,p,e){var r=p[0],I=p[1],d=p[2],f=e[3]*r+e[7]*I+e[11]*d+e[15];return f=f||1,w[0]=(e[0]*r+e[4]*I+e[8]*d+e[12])/f,w[1]=(e[1]*r+e[5]*I+e[9]*d+e[13])/f,w[2]=(e[2]*r+e[6]*I+e[10]*d+e[14])/f,w}},12177:w=>{w.exports=function(w,p,e){var r=p[0],I=p[1],d=p[2],f=e[0],q=e[1],E=e[2],j=e[3],X=j*r+q*d-E*I,k=j*I+E*r-f*d,m=j*d+f*I-q*r,J=-f*r-q*I-E*d;return w[0]=X*j+J*-f+k*-E-m*-q,w[1]=k*j+J*-q+m*-f-X*-E,w[2]=m*j+J*-E+X*-q-k*-f,w}},13114:w=>{"use strict";w.exports=function(w){for(var p=new Array(w),e=0;e<w;++e)p[e]=e;return p}},13186:w=>{w.exports=function(w){return null!=w&&null!=w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}},13407:(w,p,e)=>{"use strict";e.d(p,{b:()=>r});class r{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.fk=!1,this.qk=!1,this.Ik=30,this.dk=0,this.yk=!1,this.fullscreen=!1,this.jk=function(w){},this.Xk=function(){},this.Jk=function(){},this.Up=function(){},this.kk=function(w){},this.onFullscreenChanged=function(w){},j((()=>{!function(w,p){w._nowObject=performance||Date,w._lastTick=0,w._renderAccum=0,w._rt=0,w._frameCB=q.bind(null,w),requestAnimationFrame(w._frameCB),p>0&&(w._intervalCB=f.bind(null,w),w._interval=setInterval(w._intervalCB,Math.max(p,1e3/w.Ik/2)))}(this,p),function(w,p){if(!p)return;var e=!1,r=!1;document.addEventListener("pointerlockchange",(r=>{e=document.pointerLockElement===p,w.kk(e)})),document.addEventListener("fullscreenchange",(e=>{r=document.fullscreenElement===p,w.onFullscreenChanged(r)})),Object.defineProperty(w,"yk",{get:()=>e,set:w=>{w&&!e?E(p):e&&!w&&function(w){w.exitPointerLock&&w.exitPointerLock()}(document)}}),Object.defineProperty(w,"fullscreen",{get:()=>r,set:w=>{w&&!r?p.requestFullscreen():r&&!w&&document.exitFullscreen()}}),p.addEventListener("click",(I=>{w.fk&&!e&&E(p),w.qk&&!r&&p.requestFullscreen()}));var I=()=>w.Up();if(window.ResizeObserver){new ResizeObserver(I).observe(p)}else window.addEventListener("resize",I)}(this,w),this.Jk()}))}}var I=3,d=20;function f(w){for(var p=1e3/w.Ik,e=w._nowObject.now()+d,r=0;w._nowObject.now()>=w._lastTick+p&&w._nowObject.now()<e&&++r<=I;)w.jk(p),w._lastTick+=p;var f=5*(p+5),q=w._nowObject.now();if(q-w._lastTick>f)for(;q>=w._lastTick+p;)w._lastTick+=p}function q(w){requestAnimationFrame(w._frameCB),f(w);var p=w._nowObject.now(),e=p-w._rt;if(w._rt=p,w.dk>0){w._renderAccum+=e;var r=1e3/w.dk;if(w._renderAccum<r)return;w._renderAccum=Math.min(w._renderAccum-r,r)}var I=1e3/w.Ik,d=(p-w._lastTick)/I;w.Xk(e,d,I)}function E(w){w.requestPointerLock&&w.requestPointerLock()}var j=w=>{if("loading"===document.readyState){var p=()=>{document.removeEventListener("readystatechange",p),w()};document.addEventListener("readystatechange",p)}else setTimeout(w,1)}},13105:(w,p,e)=>{var r=e(13114),I=e(13116),d="undefined"!==typeof Float64Array;function f(w,p){return w[0]-p[0]}function q(){var w,p=this.stride,e=new Array(p.length);for(w=0;w<e.length;++w)e[w]=[Math.abs(p[w]),w];e.sort(f);var r=new Array(e.length);for(w=0;w<r.length;++w)r[w]=e[w][1];return r}function E(w,p){var e=["View",p,"d",w].join("");p<0&&(e="View_Nil"+w);var I="generic"===w;if(-1===p){var d="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(d)()}if(0===p){d="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(I?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(I?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",d)(j[w][0])}d=["'use strict'"];var f=r(p),E=f.map((function(w){return"i"+w})),X="this.offset+"+f.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),k=f.map((function(w){return"b"+w})).join(","),m=f.map((function(w){return"c"+w})).join(",");d.push("function "+e+"(a,"+k+","+m+",d){this.data=a","this.shape=["+k+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+w+"'","proto.dimension="+p),d.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+f.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===p?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),p<4?(d.push("function "+e+"_order(){"),2===p?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+e+"_set("+E.join(",")+",v){"),I?d.push("return this.data.set("+X+",v)}"):d.push("return this.data["+X+"]=v}"),d.push("proto.get=function "+e+"_get("+E.join(",")+"){"),I?d.push("return this.data.get("+X+")}"):d.push("return this.data["+X+"]}"),d.push("proto.index=function "+e+"_index(",E.join(),"){return "+X+"}"),d.push("proto.hi=function "+e+"_hi("+E.join(",")+"){return new "+e+"(this.data,"+f.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+f.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var J=f.map((function(w){return"a"+w+"=this.shape["+w+"]"})),K=f.map((function(w){return"c"+w+"=this.stride["+w+"]"}));d.push("proto.lo=function "+e+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+K.join(","));for(var y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'&&i"+y+">=0){d=i"+y+"|0;b+=c"+y+"*d;a"+y+"-=d}");d.push("return new "+e+"(this.data,"+f.map((function(w){return"a"+w})).join(",")+","+f.map((function(w){return"c"+w})).join(",")+",b)}"),d.push("proto.step=function "+e+"_step("+E.join(",")+"){var "+f.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+f.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'){d=i"+y+"|0;if(d<0){c+=b"+y+"*(a"+y+"-1);a"+y+"=ceil(-a"+y+"/d)}else{a"+y+"=ceil(a"+y+"/d)}b"+y+"*=d}");d.push("return new "+e+"(this.data,"+f.map((function(w){return"a"+w})).join(",")+","+f.map((function(w){return"b"+w})).join(",")+",c)}");var c=new Array(p),s=new Array(p);for(y=0;y<p;++y)c[y]="a[i"+y+"]",s[y]="b[i"+y+"]";d.push("proto.transpose=function "+e+"_transpose("+E+"){"+E.map((function(w,p){return w+"=("+w+"===undefined?"+p+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+c.join(",")+","+s.join(",")+",this.offset)}"),d.push("proto.pick=function "+e+"_pick("+E+"){var a=[],b=[],c=this.offset");for(y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+f.map((function(w){return"shape["+w+"]"})).join(",")+","+f.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(j[w],q)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,p,e,r){if(void 0===w)return(0,j.array[0])([]);"number"===typeof w&&(w=[w]),void 0===p&&(p=[w.length]);var f=p.length;if(void 0===e){e=new Array(f);for(var q=f-1,X=1;q>=0;--q)e[q]=X,X*=p[q]}if(void 0===r){r=0;for(q=0;q<f;++q)e[q]<0&&(r-=(p[q]-1)*e[q])}for(var k=function(w){if(I(w))return"buffer";if(d)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),m=j[k];m.length<=f+1;)m.push(E(k,m.length-1));return(0,m[f+1])(w,p,e,r)}},13116:w=>{function p(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(p(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&p(w.slice(0,0))}(w)||!!w._isBuffer)}},13269:w=>{"use strict";var p=[],e=[],r=[],I=[],d=[],f=[],q=[],E=[],j=[],X=[],k=[],m=[];w.exports=function(w,J,K,y,c,s){for(var O=q,a=j,A=X,z=m,M=0;M<3;M++)O[M]=+K[M],A[M]=+J.max[M],a[M]=+J.base[M];s||(s=1e-10);var i=function(w,q,j,X,m,J){var K=p,y=e,c=r,s=I,O=d,a=f,A=E,z=Math.floor,M=0,i=0,t=0,n=0,l=0;if(N(),0===t)return 0;for(n=R();i<=t;){if(U(n)&&v())return M;n=R()}for(M+=t,l=0;l<3;l++)X[l]+=j[l],m[l]+=j[l];return M;function N(){if(i=0,0!==(t=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2])))for(var w=0;w<3;w++){var p=j[w]>=0;s[w]=p?1:-1;var e=p?m[w]:X[w];K[w]=p?X[w]:m[w],y[w]=V(e,s[w]),c[w]=b(K[w],s[w]),A[w]=j[w]/t,O[w]=Math.abs(1/A[w]);var r=p?y[w]+1-e:e-y[w];a[w]=O[w]<1/0?O[w]*r:1/0}}function U(p){for(var e=s[0],r=0===p?y[0]:c[0],I=y[0]+e,d=s[1],f=1===p?y[1]:c[1],q=y[1]+d,E=s[2],j=2===p?y[2]:c[2],X=y[2]+E,k=r;k!=I;k+=e)for(var m=f;m!=q;m+=d)for(var J=j;J!=X;J+=E)if(w(k,m,J))return!0;return!1}function v(){M+=i;var w=s[n],p=i/t,e=k;for(l=0;l<3;l++){var r=j[l]*p;X[l]+=r,m[l]+=r,e[l]=j[l]-r}if(w>0?m[n]=Math.round(m[n]):X[n]=Math.round(X[n]),q(M,n,w,e))return!0;for(l=0;l<3;l++)j[l]=e[l];return N(),0===t}function R(){var w=a[0]<a[1]?a[0]<a[2]?0:2:a[1]<a[2]?1:2,p=a[w]-i;for(i=a[w],y[w]+=s[w],a[w]+=O[w],l=0;l<3;l++)K[l]+=p*A[l],c[l]=b(K[l],s[l]);return w}function V(w,p){return z(w-p*J)}function b(w,p){return z(w+p*J)}}(w,y,O,a,A,s);if(!c){for(M=0;M<3;M++)z[M]=K[M]>0?A[M]-J.max[M]:a[M]-J.base[M];J.translate(z)}return i}},13442:(w,p,e)=>{"use strict";e.d(p,{b:()=>k});var r=e(13265),I=e(11968);class d{constructor(w,p,e,d,f,q,E){this.IX=new r(w.base,w.aX),this.XI=p,this.friction=e,this.restitution=d,this.Dq=f,this.HJ=q,this.Tq=!!E,this.OX=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.UK=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.hj=I.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=I.create(),this._impulses=I.create(),this._sleepFrameCount=10}loadFromCopy(w){I.k(this.IX.base,w.IX.base),I.k(this.IX.aX,w.IX.aX),I.k(this.IX.max,w.IX.max),this.IX.mag=w.IX.mag,this.XI=w.XI,this.friction=w.friction,this.restitution=w.restitution,this.Dq=w.Dq,this.HJ=w.HJ,this.Tq=w.Tq,this.OX=w.OX,this.fluidDrag=w.fluidDrag,this.UK=w.UK,this.preventFallOffEdge=w.preventFallOffEdge,this.rolledBackLastTick=w.rolledBackLastTick,I.k(this.hj,w.hj),I.k(this.resting,w.resting),this.inFluid=w.inFluid,this._ratioInFluid=w._ratioInFluid,I.k(this._forces,w._forces),I.k(this._impulses,w._impulses),this._sleepFrameCount=w._sleepFrameCount}setPosition(w){f(w),I.Je(w,w,this.IX.base),this.IX.translate(w),this.Yj()}up(){return I.clone(this.IX.base)}applyForce(w){f(w),I.add(this._forces,this._forces,w),this.Yj()}applyImpulse(w){f(w),I.add(this._impulses,this._impulses,w),this.Yj()}Yj(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var f=w=>{};var q=e(13265),E=e(11968),j=e(13269);function X(){this.OX=.1,this.fluidDrag=.4,this.Cq=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function k(w,p,e){w=Object.assign(new X,w),this.gravity=w.gravity||[0,-10,0],this.OX=w.OX||.1,this.Cq=w.Cq||2,this.fluidDrag=w.fluidDrag||.4,this.minBounceImpulse=w.minBounceImpulse,this.bodies=[],this.XJ=w.XJ,this.testSolid=p,this.testFluid=e}k.prototype.oJ=function(w,p,e,r,I,f){w=w||new q([0,0,0],[1,1,1]),"undefined"==typeof p&&(p=1),"undefined"==typeof e&&(e=1),"undefined"==typeof r&&(r=0),"undefined"==typeof I&&(I=1);var E=new d(w,p,e,r,I,f);return this.bodies.push(E),E},k.prototype.CJ=function(w){var p=this.bodies.indexOf(w);p<0||(this.bodies.splice(p,1),w.IX=w.HJ=null)};var m=E.create(),J=E.create(),K=E.create(),y=E.create(),c=E.create(),s=E.create(),O=E.create(),a=new q([0,0,0],[1,1,1]),A=new d(a,1,1,0,1,(()=>{}),!1);function z(w,p,e){return p=e,p*=1-(1-w.ratioInFluid)**2}k.prototype.jE=function(w){w/=1e3;var p=L(0,E.squaredLength(this.gravity));this.bodies.forEach((e=>function(w,p,e,r){E.k(c,p.resting),w.XJ&&A.loadFromCopy(p);if(p.XI<=0)return E.set(p.hj,0,0,0),E.set(p._forces,0,0,0),void E.set(p._impulses,0,0,0);var I=r||0===p.Dq;if(function(w,p,e,r){if(p._sleepFrameCount>0)return!1;if(r)return!0;var I=!1,d=.5*e*e*p.Dq;return E.scale(Y,w.gravity,d),j(w.testSolid,p.IX,Y,(function(){return I=!0,!0}),!0),I}(w,p,e,I))return;p._sleepFrameCount--,function(w,p){var e=p.IX,r=Math.floor(e.base[0]),I=Math.floor(e.base[2]),d=Math.floor(e.base[1]),f=Math.floor(e.max[1]);if(!w.testFluid(r,d,I))return p.inFluid=!1,void(p.ratioInFluid=0);var q=1,j=d+1;for(;j<=f&&w.testFluid(r,j,I);)q++,j++;var X=(d+q-e.base[1])/e.aX[1];X>1&&(X=1);var k=e.aX[0]*e.aX[1]*e.aX[2]*X,m=i;E.scale(m,w.gravity,-w.Cq*k*p.Dq),p.applyForce(m),p.inFluid=!0,p.ratioInFluid=X}(w,p),F(p._forces),F(p._impulses),F(p.hj),F(p.resting),E.scale(m,p._forces,1/p.XI),E.eE(m,m,w.gravity,p.Dq),E.scale(J,p._impulses,1/p.XI),E.eE(J,J,m,e),E.add(p.hj,p.hj,J),p.friction&&(t(w,0,p,J,e),t(w,1,p,J,e),t(w,2,p,J,e));var d=p.fluidDrag>=0?p.fluidDrag:w.fluidDrag,f=p.OX>=0?p.OX:w.OX,q=f,X=f;p.inFluid&&(q=z(p,q,p.fluidDragHoriz>=0?p.fluidDragHoriz:d),X=z(p,X,p.fluidDragVert>=0?p.fluidDragVert:d));q=Math.max(1-q*e/p.XI,0),X=Math.max(1-X*e/p.XI,0),E.set(M,q,X,q),E.multiply(p.hj,p.hj,M),E.scale(K,p.hj,e),E.set(p._forces,0,0,0),E.set(p._impulses,0,0,0),p.Tq&&W(N,p.IX);E.k(s,K),E.set(O,0,0,0),p.preventFallOffEdge&&function(w,p,e,r){if(!p.resting[1]||e[1]>0)return;var I=h;W(I,p.IX);for(var d=0;d<3;d+=2){E.set(b,0,0,0),b[d]=e[d];var f=!0;(f=(f=(f=(f=f&&!u(w,I.base[0]+b[0]+1e-5,I.base[1],I.base[2]+b[2]+1e-5))&&!u(w,I.max[0]+b[0]-1e-5,I.base[1],I.base[2]+b[2]+1e-5))&&!u(w,I.base[0]+b[0]+1e-5,I.base[1],I.max[2]+b[2]-1e-5))&&!u(w,I.max[0]+b[0]-1e-5,I.base[1],I.max[2]+b[2]-1e-5))?(r[d]=e[d]>0?1:-1,e[d]=0):0===d&&(E.set(P,e[0],0,0),l(w,I,P,r,p.slideOnCollision))}}(w,p,K,O);l(w,p.IX,K,p.resting,p.slideOnCollision),p.Tq&&function(w,p,e,r){if(p.resting[1]>=0&&!p.inFluid)return;var I=0!==p.resting[0],d=0!==p.resting[2];if(!I&&!d)return;var f=Math.abs(r[0]/r[2]),q=4;if(!I&&f>q)return;if(!d&&f<1/q)return;E.add(v,e.base,r);var X=w.testSolid;j(X,e,r,(function(w,p,e,r){if(1!==p)return!0;r[p]=0}));var k=e.base[1],m=p.inFluid?1.951:1.001,J=Math.floor(k+m)-k;E.set(R,0,J,0);var K=!1;if(j(X,e,R,(function(w,p,e,r){return K=!0,!0})),K)return;E.Je(V,v,e.base),V[1]=0,l(w,e,V,U,!0);var y=L(e.base[0],v[0]),c=L(e.base[2],v[2]);if(I&&!y&&(!c||!d))return;if(d&&(!y||!I)&&!c)return;var s=!0;if(s=s&&!u(w,e.base[0]+1e-5,e.base[1],e.base[2]+1e-5),s=s&&!u(w,e.max[0]-1e-5,e.base[1],e.base[2]+1e-5),s=s&&!u(w,e.base[0]+1e-5,e.base[1],e.max[2]-1e-5),s=s&&!u(w,e.max[0]-1e-5,e.base[1],e.max[2]-1e-5),s)return;W(p.IX,e),p.resting[0]=U[0],p.resting[2]=U[2],p.UK&&p.UK()}(w,p,N,s);for(var k=0;k<3;++k)p.resting[k]=p.resting[k]||O[k],y[k]=0,p.resting[k]&&(c[k]||(y[k]=-p.hj[k]),p.hj[k]=0);var a=E.length(y);a>.001&&(E.scale(y,y,p.XI),p.HJ&&p.HJ(y),p.restitution>0&&a>w.minBounceImpulse&&(E.scale(y,y,p.restitution),p.applyImpulse(y)));var n=E.squaredLength(p.hj);n>1e-5&&p.Yj();w.XJ&&w.XJ(p)?(p.loadFromCopy(A),p.rolledBackLastTick=!0):p.rolledBackLastTick=!1}(this,e,w,p)))};var M=E.create([0,0,0]);var i=E.create();function t(w,p,e,r,I){var d=e.resting[p],f=r[p];if(!e.alwaysApplyHorizFriction||1!==p){if(0===d)return;if(d*f<=0)return}E.k(n,e.hj),n[p]=0;var q=E.length(n);if(!L(q,0)){var j=Math.abs(e.friction*w.gravity[p]*I),X=q>j?(q-j)/q:0;e.hj[(p+1)%3]*=X,e.hj[(p+2)%3]*=X}}var n=E.create();function l(w,p,e,r,I){return E.set(r,0,0,0),j(w.testSolid,p,e,(function(w,p,e,d){r[p]=e,d[p]=0,I||(d[0]=0,d[1]=0,d[2]=0)}))}var N=new q([],[]),U=E.create(),v=E.create(),R=E.create(),V=E.create();var b=E.create(),h=new q([],[]),P=E.create();function u(w,p,e,r){return w.testSolid(Math.floor(p),Math.floor(e-1),Math.floor(r))}var Y=E.create();function L(w,p){return Math.abs(w-p)<1e-5}function W(w,p){for(var e=0;e<3;e++)w.base[e]=p.base[e],w.max[e]=p.max[e],w.aX[e]=p.aX[e]}var F=function(w){}},11868:function(w,p){!function(w){"use strict";var p=function(w,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,p){w.__proto__=p}||function(w,p){for(var e in p)Object.prototype.hasOwnProperty.call(p,e)&&(w[e]=p[e])},p(w,e)};function e(w,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=w}p(w,e),w.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function r(w,p,e,r){var I,d=arguments.length,f=d<3?p:null===r?r=Object.getOwnPropertyDescriptor(p,e):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(w,p,e,r);else for(var q=w.length-1;q>=0;q--)(I=w[q])&&(f=(d<3?I(f):d>3?I(p,e,f):I(p,e))||f);return d>3&&f&&Object.defineProperty(p,e,f),f}function I(w,p,e){if(e||2===arguments.length)for(var r,I=0,d=p.length;I<d;I++)!r&&I in p||(r||(r=Array.prototype.slice.call(p,0,I)),r[I]=p[I]);return w.concat(r||Array.prototype.slice.call(p))}var d,f=255,q=213;w.OPERATION=void 0,(d=w.OPERATION||(w.OPERATION={}))[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR";var E=function(){function p(w,p,e){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=w,this.setParent(p,e)}return p.prototype.setParent=function(w,p,e){var r=this;if(this.indexes||(this.indexes=this.ref instanceof Vw?this.ref._definition.indexes:{}),this.parent=w,this.parentIndex=e,p)if(this.root=p,this.ref instanceof Vw){var I=this.ref._definition;for(var d in I.schema){var f=this.ref[d];if(f&&f.$changes){var q=I.indexes[d];f.$changes.setParent(this.ref,p,q)}}}else"object"===typeof this.ref&&this.ref.forEach((function(w,p){if(w instanceof Vw){var e=w.$changes,I=r.ref.$changes.indexes[p];e.setParent(r.ref,r.root,I)}}))},p.prototype.operation=function(w){this.changes.set(--this.currentCustomOperation,w)},p.prototype.change=function(p,e){void 0===e&&(e=w.OPERATION.ADD);var r="number"===typeof p?p:this.indexes[p];this.assertValidIndex(r,p);var I=this.changes.get(r);I&&I.op!==w.OPERATION.DELETE&&I.op!==w.OPERATION.TOUCH||this.changes.set(r,{op:I&&I.op===w.OPERATION.DELETE?w.OPERATION.DELETE_AND_ADD:e,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},p.prototype.touch=function(p){var e="number"===typeof p?p:this.indexes[p];this.assertValidIndex(e,p),this.changes.has(e)||this.changes.set(e,{op:w.OPERATION.TOUCH,index:e}),this.allChanges.add(e),this.touchParents()},p.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},p.prototype.getType=function(w){if(this.ref._definition)return(p=this.ref._definition).schema[p.fieldsByIndex[w]];var p,e=(p=this.parent._definition).schema[p.fieldsByIndex[this.parentIndex]];return Object.values(e)[0]},p.prototype.getChildrenFilter=function(){var w=this.parent._definition.childFilters;return w&&w[this.parentIndex]},p.prototype.getValue=function(w){return this.ref.getByIndex(w)},p.prototype.delete=function(p){var e="number"===typeof p?p:this.indexes[p];if(void 0!==e){var r=this.getValue(e);this.changes.set(e,{op:w.OPERATION.DELETE,index:e}),this.allChanges.delete(e),delete this.caches[e],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(p," (").concat(e,")"))},p.prototype.discard=function(p,e){var r=this;void 0===p&&(p=!1),void 0===e&&(e=!1),this.ref instanceof Vw||this.changes.forEach((function(p){if(p.op===w.OPERATION.DELETE){var e=r.ref.getIndex(p.index);delete r.indexes[e]}})),this.changes.clear(),this.changed=p,e&&this.allChanges.clear(),this.currentCustomOperation=0},p.prototype.discardAll=function(){var w=this;this.changes.forEach((function(p){var e=w.getValue(p.index);e&&e.$changes&&e.$changes.discardAll()})),this.discard()},p.prototype.cache=function(w,p){this.caches[w]=p},p.prototype.clone=function(){return new p(this.ref,this.parent,this.root)},p.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},p.prototype.assertValidIndex=function(w,p){if(void 0===w)throw new Error('ChangeTree: missing index for field "'.concat(p,'"'))},p}();function j(w,p,e,r){return w[p]||(w[p]=[]),w[p].push(e),null===r||void 0===r||r.forEach((function(w,p){return e(w,p)})),function(){return k(w[p],w[p].indexOf(e))}}function X(p){var e=this,r="string"!==typeof this.$changes.getType();this.$items.forEach((function(I,d){p.push({refId:e.$changes.refId,op:w.OPERATION.DELETE,field:d,value:void 0,previousValue:I}),r&&e.$changes.root.removeRef(I.$changes.refId)}))}function k(w,p){if(-1===p||p>=w.length)return!1;for(var e=w.length-1,r=p;r<e;r++)w[r]=w[r+1];return w.length=e,!0}var m=function(w,p){var e=w.toString(),r=p.toString();return e<r?-1:e>r?1:0};function J(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,p){return"symbol"===typeof p||isNaN(p)?w[p]:w.at(p)},set:function(w,p,e){if("symbol"===typeof p||isNaN(p))w[p]=e;else{var r=Array.from(w.$items.keys()),I=parseInt(r[p]||p);void 0===e||null===e?w.deleteAt(I):w.setAt(I,e)}return!0},deleteProperty:function(w,p){return"number"===typeof p?w.deleteAt(p):delete w[p],!0}})}var K=function(){function p(){for(var w=[],p=0;p<arguments.length;p++)w[p]=arguments[p];this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,w)}return p.prototype.JE=function(p,e){return void 0===e&&(e=!0),j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,p,e?this.$items:void 0)},p.prototype.ip=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,p)},p.is=function(w){return Array.isArray(w)||void 0!==w.array},Object.defineProperty(p.prototype,"length",{get:function(){return this.$items.size},set:function(w){0===w?this.clear():this.splice(w,this.length-w)},enumerable:!1,configurable:!0}),p.prototype.push=function(){for(var w,p=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.forEach((function(e){w=p.$refId++,p.setAt(w,e)})),w},p.prototype.pop=function(){var w=Array.from(this.$indexes.values()).pop();if(void 0!==w){this.$changes.delete(w),this.$indexes.delete(w);var p=this.$items.get(w);return this.$items.delete(w),p}},p.prototype.at=function(w){var p=Array.from(this.$items.keys())[w];return this.$items.get(p)},p.prototype.setAt=function(p,e){var r,I;if(void 0!==e&&null!==e){if(this.$items.get(p)!==e){void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,p);var d=null!==(I=null===(r=this.$changes.indexes[p])||void 0===r?void 0:r.op)&&void 0!==I?I:w.OPERATION.ADD;this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,e),this.$changes.change(p,d)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},p.prototype.deleteAt=function(w){var p=Array.from(this.$items.keys())[w];return void 0!==p&&this.$deleteAt(p)},p.prototype.$deleteAt=function(w){return this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&X.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.concat=function(){for(var w,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new(p.bind.apply(p,I([void 0],(w=Array.from(this.$items.values())).concat.apply(w,e),!1)))},p.prototype.join=function(w){return Array.from(this.$items.values()).join(w)},p.prototype.reverse=function(){var w=this,p=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(e,r){w.setAt(p[r],e)})),this},p.prototype.shift=function(){var w=Array.from(this.$items.keys()).shift();if(void 0!==w){var p=this.$items.get(w);return this.$deleteAt(w),p}},p.prototype.slice=function(w,e){var r=new p;return r.push.apply(r,Array.from(this.$items.values()).slice(w,e)),r},p.prototype.sort=function(w){var p=this;void 0===w&&(w=m);var e=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(w).forEach((function(w,r){p.setAt(e[r],w)})),this},p.prototype.splice=function(w,p){void 0===p&&(p=this.length-w);for(var e=Array.from(this.$items.keys()),r=[],I=w;I<w+p;I++)r.push(this.$items.get(e[I])),this.$deleteAt(e[I]);return r},p.prototype.unshift=function(){for(var w=this,p=[],e=0;e<arguments.length;e++)p[e]=arguments[e];var r=this.length,I=p.length,d=Array.from(this.$items.values());return p.forEach((function(p,e){w.setAt(e,p)})),d.forEach((function(p,e){w.setAt(I+e,p)})),r+I},p.prototype.indexOf=function(w,p){return Array.from(this.$items.values()).indexOf(w,p)},p.prototype.lastIndexOf=function(w,p){return void 0===p&&(p=this.length-1),Array.from(this.$items.values()).lastIndexOf(w,p)},p.prototype.every=function(w,p){return Array.from(this.$items.values()).every(w,p)},p.prototype.some=function(w,p){return Array.from(this.$items.values()).some(w,p)},p.prototype.forEach=function(w,p){Array.from(this.$items.values()).forEach(w,p)},p.prototype.map=function(w,p){return Array.from(this.$items.values()).map(w,p)},p.prototype.filter=function(w,p){return Array.from(this.$items.values()).filter(w,p)},p.prototype.reduce=function(w,p){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},p.prototype.reduceRight=function(w,p){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},p.prototype.find=function(w,p){return Array.from(this.$items.values()).find(w,p)},p.prototype.findIndex=function(w,p){return Array.from(this.$items.values()).findIndex(w,p)},p.prototype.fill=function(w,p,e){throw new Error("ArraySchema#fill() not implemented")},p.prototype.copyWithin=function(w,p,e){throw new Error("ArraySchema#copyWithin() not implemented")},p.prototype.toString=function(){return this.$items.toString()},p.prototype.toLocaleString=function(){return this.$items.toLocaleString()},p.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},p.prototype.includes=function(w,p){return Array.from(this.$items.values()).includes(w,p)},p.prototype.flatMap=function(w,p){throw new Error("ArraySchema#flatMap() is not supported.")},p.prototype.flat=function(w){throw new Error("ArraySchema#flat() is not supported.")},p.prototype.findLast=function(){var w=Array.from(this.$items.values());return w.findLast.apply(w,arguments)},p.prototype.findLastIndex=function(){var w=Array.from(this.$items.values());return w.findLastIndex.apply(w,arguments)},p.prototype.setIndex=function(w,p){this.$indexes.set(w,p)},p.prototype.getIndex=function(w){return this.$indexes.get(w)},p.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},p.prototype.deleteByIndex=function(w){var p=this.$indexes.get(w);this.$items.delete(p),this.$indexes.delete(w)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){return this.toArray().map((function(w){return"function"===typeof w.toJSON?w.toJSON():w}))},p.prototype.clone=function(w){return w?new(p.bind.apply(p,I([void 0],Array.from(this.$items.values()),!1))):new(p.bind.apply(p,I([void 0],this.map((function(w){return w.$changes?w.clone():w})),!1)))},p}();function y(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,p){return"symbol"!==typeof p&&"undefined"===typeof w[p]?w.get(p):w[p]},set:function(w,p,e){return"symbol"!==typeof p&&-1===p.indexOf("$")&&"JE"!==p&&"ip"!==p&&"onChange"!==p?w.set(p,e):w[p]=e,!0},deleteProperty:function(w,p){return w.delete(p),!0}})}var c=function(){function p(w){var e=this;if(this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w)if(w instanceof Map||w instanceof p)w.forEach((function(w,p){return e.set(p,w)}));else for(var r in w)this.set(r,w[r])}return p.prototype.JE=function(p,e){return void 0===e&&(e=!0),j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,p,e?this.$items:void 0)},p.prototype.ip=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,p)},p.is=function(w){return void 0!==w.map},p.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(p.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.set=function(p,e){if(void 0===e||null===e)throw new Error("MapSchema#set('".concat(p,"', ").concat(e,"): trying to set ").concat(e," value on '").concat(p,"'."));p=p.toString();var r="undefined"!==typeof this.$changes.indexes[p],I=r?this.$changes.indexes[p]:this.$refId++,d=r?w.OPERATION.REPLACE:w.OPERATION.ADD,f=void 0!==e.$changes;if(f&&e.$changes.setParent(this,this.$changes.root,I),r){if(!f&&this.$items.get(p)===e)return;f&&this.$items.get(p)!==e&&(d=w.OPERATION.ADD)}else this.$changes.indexes[p]=I,this.$indexes.set(I,p);return this.$items.set(p,e),this.$changes.change(p,d),this},p.prototype.get=function(w){return this.$items.get(w)},p.prototype.delete=function(w){return this.$changes.delete(w),this.$items.delete(w)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&X.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(w){return this.$items.has(w)},p.prototype.forEach=function(w){this.$items.forEach(w)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(w,p){this.$indexes.set(w,p)},p.prototype.getIndex=function(w){return this.$indexes.get(w)},p.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},p.prototype.deleteByIndex=function(w){var p=this.$indexes.get(w);this.$items.delete(p),this.$indexes.delete(w)},p.prototype.toJSON=function(){var w={};return this.forEach((function(p,e){w[e]="function"===typeof p.toJSON?p.toJSON():p})),w},p.prototype.clone=function(w){var e;return w?e=Object.assign(new p,this):(e=new p,this.forEach((function(w,p){w.$changes?e.set(p,w.clone()):e.set(p,w)}))),e},p}(),s={};function O(w,p){s[w]=p}function a(w){return s[w]}var A=function(){function w(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return w.create=function(p){var e=new w;return e.schema=Object.assign({},p&&p.schema||{}),e.indexes=Object.assign({},p&&p.indexes||{}),e.fieldsByIndex=Object.assign({},p&&p.fieldsByIndex||{}),e.descriptors=Object.assign({},p&&p.descriptors||{}),e.deprecated=Object.assign({},p&&p.deprecated||{}),e},w.prototype.addField=function(w,p){var e=this.getNextFieldIndex();this.fieldsByIndex[e]=w,this.indexes[w]=e,this.schema[w]=Array.isArray(p)?{array:p[0]}:p},w.prototype.hasField=function(w){return void 0!==this.indexes[w]},w.prototype.addFilter=function(w,p){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[w]]=p,this.indexesWithFilters.push(this.indexes[w]),!0},w.prototype.addChildrenFilter=function(w,p){var e=this.indexes[w],r=this.schema[w];if(a(Object.keys(r)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[e]=p,!0;console.warn("@filterChildren: field '".concat(w,"' can't have children. Ignoring filter."))},w.prototype.getChildrenFilter=function(w){return this.childFilters&&this.childFilters[this.indexes[w]]},w.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},w}();function z(w){return w._context&&w._context.useFilters}var M=function(){function w(){this.types={},this.schemas=new Map,this.useFilters=!1}return w.prototype.has=function(w){return this.schemas.has(w)},w.prototype.get=function(w){return this.types[w]},w.prototype.add=function(w,p){void 0===p&&(p=this.schemas.size),w._definition=A.create(w._definition),w._typeid=p,this.types[p]=w,this.schemas.set(w,p)},w.create=function(p){return void 0===p&&(p={}),function(e){return p.context||(p.context=new w),t(e,p)}},w}(),i=new M;function t(w,p){return void 0===p&&(p={}),function(e,r){var d=p.context||i,f=e.constructor;if(f._context=d,!w)throw new Error("".concat(f.name,': @type() reference provided for "').concat(r,"\" is undefined. Make sure you don't have any circular dependencies."));d.has(f)||d.add(f);var q=f._definition;if(q.addField(r,w),q.descriptors[r]){if(q.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(r,"' definition on '").concat(f.name,"'.\nCheck @type() annotation"))}catch(s){var E=s.stack.split("\n")[4].trim();throw new Error("".concat(s.message," ").concat(E))}}var j=K.is(w),X=!j&&c.is(w);if("string"!==typeof w&&!Vw.is(w)){var k=Object.values(w)[0];"string"===typeof k||d.has(k)||d.add(k)}if(p.manual)q.descriptors[r]={enumerable:!0,configurable:!0,writable:!0};else{var m="_".concat(r);q.descriptors[m]={enumerable:!1,configurable:!1,writable:!0},q.descriptors[r]={get:function(){return this[m]},set:function(w){w!==this[m]&&(void 0!==w&&null!==w?(!j||w instanceof K||(w=new(K.bind.apply(K,I([void 0],w,!1)))),!X||w instanceof c||(w=new c(w)),void 0===w.$proxy&&(X?w=y(w):j&&(w=J(w))),this.$changes.change(r),w.$changes&&w.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this[m]&&this.$changes.delete(r),this[m]=w)},enumerable:!0,configurable:!0}}}}function n(w){return function(p,e){var r=p.constructor;r._definition.addFilter(e,w)&&(r._context.useFilters=!0)}}function l(w){return function(p,e){var r=p.constructor;r._definition.addChildrenFilter(e,w)&&(r._context.useFilters=!0)}}function N(w){return void 0===w&&(w=!0),function(p,e){var r=p.constructor._definition;r.deprecated[e]=!0,w&&(r.descriptors[e]={get:function(){throw new Error("".concat(e," is deprecated."))},set:function(w){},enumerable:!1,configurable:!0})}}function U(w,p,e){for(var r in void 0===e&&(e={}),e.context||(e.context=w._context||e.context||i),p)t(p[r],e)(w.prototype,r);return w}function v(w){for(var p=0,e=0,r=0,I=w.length;r<I;r++)(p=w.charCodeAt(r))<128?e+=1:p<2048?e+=2:p<55296||p>=57344?e+=3:(r++,e+=4);return e}function R(w,p,e){for(var r=0,I=0,d=e.length;I<d;I++)(r=e.charCodeAt(I))<128?w[p++]=r:r<2048?(w[p++]=192|r>>6,w[p++]=128|63&r):r<55296||r>=57344?(w[p++]=224|r>>12,w[p++]=128|r>>6&63,w[p++]=128|63&r):(I++,r=65536+((1023&r)<<10|1023&e.charCodeAt(I)),w[p++]=240|r>>18,w[p++]=128|r>>12&63,w[p++]=128|r>>6&63,w[p++]=128|63&r)}function V(w,p){w.push(255&p)}function b(w,p){w.push(255&p)}function h(w,p){w.push(255&p),w.push(p>>8&255)}function P(w,p){w.push(255&p),w.push(p>>8&255)}function u(w,p){w.push(255&p),w.push(p>>8&255),w.push(p>>16&255),w.push(p>>24&255)}function Y(w,p){var e=p>>24,r=p>>16,I=p>>8,d=p;w.push(255&d),w.push(255&I),w.push(255&r),w.push(255&e)}function L(w,p){var e=Math.floor(p/Math.pow(2,32));Y(w,p>>>0),Y(w,e)}function W(w,p){var e=p/Math.pow(2,32)|0;Y(w,p>>>0),Y(w,e)}function F(w,p){Z(w,p)}function H(w,p){G(w,p)}var B=new Int32Array(2),D=new Float32Array(B.buffer),T=new Float64Array(B.buffer);function Z(w,p){D[0]=p,u(w,B[0])}function G(w,p){T[0]=p,u(w,B[0]),u(w,B[1])}function g(w,p){return b(w,p?1:0)}function o(w,p){p||(p="");var e=v(p),r=0;if(e<32)w.push(160|e),r=1;else if(e<256)w.push(217),b(w,e),r=2;else if(e<65536)w.push(218),P(w,e),r=3;else{if(!(e<4294967296))throw new Error("String too long");w.push(219),Y(w,e),r=5}return R(w,w.length,p),r+e}function C(w,p){return isNaN(p)?C(w,0):isFinite(p)?p!==(0|p)?(w.push(203),G(w,p),9):p>=0?p<128?(b(w,p),1):p<256?(w.push(204),b(w,p),2):p<65536?(w.push(205),P(w,p),3):p<4294967296?(w.push(206),Y(w,p),5):(w.push(207),W(w,p),9):p>=-32?(w.push(224|p+32),1):p>=-128?(w.push(208),V(w,p),2):p>=-32768?(w.push(209),h(w,p),3):p>=-2147483648?(w.push(210),u(w,p),5):(w.push(211),L(w,p),9):C(w,p>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Q=Object.freeze({__proto__:null,utf8Write:R,int8:V,uint8:b,int16:h,uint16:P,int32:u,uint32:Y,int64:L,uint64:W,float32:F,float64:H,writeFloat32:Z,writeFloat64:G,boolean:g,string:o,number:C});function x(w,p,e){for(var r="",I=0,d=p,f=p+e;d<f;d++){var q=w[d];0!==(128&q)?192!==(224&q)?224!==(240&q)?240!==(248&q)?console.error("Invalid byte "+q.toString(16)):(I=(7&q)<<18|(63&w[++d])<<12|(63&w[++d])<<6|63&w[++d])>=65536?(I-=65536,r+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):r+=String.fromCharCode(I):r+=String.fromCharCode((15&q)<<12|(63&w[++d])<<6|63&w[++d]):r+=String.fromCharCode((31&q)<<6|63&w[++d]):r+=String.fromCharCode(q)}return r}function S(w,p){return ww(w,p)<<24>>24}function ww(w,p){return w[p.offset++]}function pw(w,p){return ew(w,p)<<16>>16}function ew(w,p){return w[p.offset++]|w[p.offset++]<<8}function rw(w,p){return w[p.offset++]|w[p.offset++]<<8|w[p.offset++]<<16|w[p.offset++]<<24}function Iw(w,p){return rw(w,p)>>>0}function dw(w,p){return mw(w,p)}function fw(w,p){return Jw(w,p)}function qw(w,p){var e=Iw(w,p);return rw(w,p)*Math.pow(2,32)+e}function Ew(w,p){var e=Iw(w,p);return Iw(w,p)*Math.pow(2,32)+e}var jw=new Int32Array(2),Xw=new Float32Array(jw.buffer),kw=new Float64Array(jw.buffer);function mw(w,p){return jw[0]=rw(w,p),Xw[0]}function Jw(w,p){return jw[0]=rw(w,p),jw[1]=rw(w,p),kw[0]}function Kw(w,p){return ww(w,p)>0}function yw(w,p){var e,r=w[p.offset++];r<192?e=31&r:217===r?e=ww(w,p):218===r?e=ew(w,p):219===r&&(e=Iw(w,p));var I=x(w,p.offset,e);return p.offset+=e,I}function cw(w,p){var e=w[p.offset];return e<192&&e>160||217===e||218===e||219===e}function sw(w,p){var e=w[p.offset++];return e<128?e:202===e?mw(w,p):203===e?Jw(w,p):204===e?ww(w,p):205===e?ew(w,p):206===e?Iw(w,p):207===e?Ew(w,p):208===e?S(w,p):209===e?pw(w,p):210===e?rw(w,p):211===e?qw(w,p):e>223?-1*(255-e+1):void 0}function Ow(w,p){var e=w[p.offset];return e<128||e>=202&&e<=211}function aw(w,p){return w[p.offset]<160}function Aw(w,p){return w[p.offset-1]===f&&(w[p.offset]<128||w[p.offset]>=202&&w[p.offset]<=211)}var zw=Object.freeze({__proto__:null,int8:S,uint8:ww,int16:pw,uint16:ew,int32:rw,uint32:Iw,float32:dw,float64:fw,int64:qw,uint64:Ew,readFloat32:mw,readFloat64:Jw,boolean:Kw,string:yw,stringCheck:cw,number:sw,numberCheck:Ow,arrayCheck:aw,switchStructureCheck:Aw}),Mw=function(){function p(w){var p=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return p.add(w)}))}return p.prototype.JE=function(p,e){return void 0===e&&(e=!0),j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,p,e?this.$items:void 0)},p.prototype.ip=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,p)},p.is=function(w){return void 0!==w.collection},p.prototype.add=function(w){var p=this.$refId++;return void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,p),this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,w),this.$changes.change(p),p},p.prototype.at=function(w){var p=Array.from(this.$items.keys())[w];return this.$items.get(p)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(w){for(var p,e,r=this.$items.entries();(e=r.next())&&!e.done;)if(w===e.value[1]){p=e.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&X.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(w){return Array.from(this.$items.values()).some((function(p){return p===w}))},p.prototype.forEach=function(w){var p=this;this.$items.forEach((function(e,r,I){return w(e,r,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(w,p){this.$indexes.set(w,p)},p.prototype.getIndex=function(w){return this.$indexes.get(w)},p.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},p.prototype.deleteByIndex=function(w){var p=this.$indexes.get(w);this.$items.delete(p),this.$indexes.delete(w)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var w=[];return this.forEach((function(p,e){w.push("function"===typeof p.toJSON?p.toJSON():p)})),w},p.prototype.clone=function(w){var e;return w?e=Object.assign(new p,this):(e=new p,this.forEach((function(w){w.$changes?e.add(w.clone()):e.add(w)}))),e},p}(),iw=function(){function p(w){var p=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return p.add(w)}))}return p.prototype.JE=function(p,e){return void 0===e&&(e=!0),j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,p,e?this.$items:void 0)},p.prototype.ip=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,p)},p.is=function(w){return void 0!==w.set},p.prototype.add=function(p){var e,r;if(this.has(p))return!1;var I=this.$refId++;void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,I);var d=null!==(r=null===(e=this.$changes.indexes[I])||void 0===e?void 0:e.op)&&void 0!==r?r:w.OPERATION.ADD;return this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,p),this.$changes.change(I,d),I},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(w){for(var p,e,r=this.$items.entries();(e=r.next())&&!e.done;)if(w===e.value[1]){p=e.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&X.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(w){for(var p,e=this.$items.values(),r=!1;(p=e.next())&&!p.done;)if(w===p.value){r=!0;break}return r},p.prototype.forEach=function(w){var p=this;this.$items.forEach((function(e,r,I){return w(e,r,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(w,p){this.$indexes.set(w,p)},p.prototype.getIndex=function(w){return this.$indexes.get(w)},p.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},p.prototype.deleteByIndex=function(w){var p=this.$indexes.get(w);this.$items.delete(p),this.$indexes.delete(w)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var w=[];return this.forEach((function(p,e){w.push("function"===typeof p.toJSON?p.toJSON():p)})),w},p.prototype.clone=function(w){var e;return w?e=Object.assign(new p,this):(e=new p,this.forEach((function(w){w.$changes?e.add(w.clone()):e.add(w)}))),e},p}(),tw=function(){function w(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return w.prototype.addRefId=function(w){this.refIds.has(w)||(this.refIds.add(w),this.containerIndexes.set(w,new Set))},w.get=function(p){return void 0===p.$filterState&&(p.$filterState=new w),p.$filterState},w}(),nw=function(){function w(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return w.prototype.getNextUniqueId=function(){return this.nextUniqueId++},w.prototype.addRef=function(w,p,e){void 0===e&&(e=!0),this.refs.set(w,p),e&&(this.refCounts[w]=(this.refCounts[w]||0)+1)},w.prototype.removeRef=function(w){this.refCounts[w]=this.refCounts[w]-1,this.deletedRefs.add(w)},w.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},w.prototype.garbageCollectDeletedRefs=function(){var w=this;this.deletedRefs.forEach((function(p){if(!(w.refCounts[p]>0)){var e=w.refs.get(p);if(e instanceof Vw)for(var r in e._definition.schema)"string"!==typeof e._definition.schema[r]&&e[r]&&e[r].$changes&&w.removeRef(e[r].$changes.refId);else{var I=e.$changes.parent._definition,d=I.schema[I.fieldsByIndex[e.$changes.parentIndex]];"function"===typeof Object.values(d)[0]&&Array.from(e.values()).forEach((function(p){return w.removeRef(p.$changes.refId)}))}w.refs.delete(p),delete w.refCounts[p]}})),this.deletedRefs.clear()},w}(),lw=function(w){function p(){return null!==w&&w.apply(this,arguments)||this}return e(p,w),p}(Error);function Nw(w,p,e,r){var I,d=!1;switch(p){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":I="number",isNaN(w)&&console.log('trying to encode "NaN" in '.concat(e.constructor.name,"#").concat(r));break;case"string":I="string",d=!0;break;case"boolean":return}if(typeof w!==I&&(!d||d&&null!==w)){var f="'".concat(JSON.stringify(w),"'").concat(w&&w.constructor&&" (".concat(w.constructor.name,")")||"");throw new lw("a '".concat(I,"' was expected, but ").concat(f," was provided in ").concat(e.constructor.name,"#").concat(r))}}function Uw(w,p,e,r){if(!(w instanceof p))throw new lw("a '".concat(p.name,"' was expected, but '").concat(w.constructor.name,"' was provided in ").concat(e.constructor.name,"#").concat(r))}function vw(w,p,e,r,I){Nw(e,w,r,I);var d=Q[w];if(!d)throw new lw("a '".concat(w,"' was expected, but ").concat(e," was provided in ").concat(r.constructor.name,"#").concat(I));d(p,e)}function Rw(w,p,e){return zw[w](p,e)}var Vw=function(){function p(){for(var w=[],p=0;p<arguments.length;p++)w[p]=arguments[p];Object.defineProperties(this,{$changes:{value:new E(this,void 0,new nw),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var e=this._definition.descriptors;e&&Object.defineProperties(this,e),w[0]&&this.assign(w[0])}return p.onError=function(w){console.error(w)},p.is=function(w){return w._definition&&void 0!==w._definition.schema},p.prototype.onChange=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,p)},p.prototype.ip=function(p){return j(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,p)},p.prototype.assign=function(w){return Object.assign(this,w),this},Object.defineProperty(p.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),p.prototype.setDirty=function(w,p){this.$changes.change(w,p)},p.prototype.listen=function(w,p,e){var r=this;return void 0===e&&(e=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[w]||(this.$callbacks[w]=[]),this.$callbacks[w].push(p),e&&void 0!==this[w]&&p(this[w],void 0),function(){return k(r.$callbacks[w],r.$callbacks[w].indexOf(p))}},p.prototype.decode=function(e,r,I){var d;void 0===r&&(r={offset:0}),void 0===I&&(I=this);var q=[],E=this.$changes.root,j=e.length,X=0;for(E.refs.set(X,this);r.offset<j;){var k=e[r.offset++];if(k!=f){var m=I.$changes,J=void 0!==I._definition,y=J?k>>6<<6:k;if(y!==w.OPERATION.CLEAR){var s=J?k%(y||255):sw(e,r),O=J?I._definition.fieldsByIndex[s]:"",A=m.getType(s),z=void 0,M=void 0,i=void 0;if(J?M=I["_".concat(O)]:(M=I.getByIndex(s),(y&w.OPERATION.ADD)===w.OPERATION.ADD?(i=I instanceof c?yw(e,r):s,I.setIndex(s,i)):i=I.getIndex(s)),(y&w.OPERATION.DELETE)===w.OPERATION.DELETE&&(y!==w.OPERATION.DELETE_AND_ADD&&I.deleteByIndex(s),M&&M.$changes&&E.removeRef(M.$changes.refId),z=null),void 0!==O){if(y===w.OPERATION.DELETE);else if(p.is(A)){var t=sw(e,r);if(z=E.refs.get(t),y!==w.OPERATION.REPLACE){var n=this.getSchemaType(e,r,A);z||((z=this.createTypeInstance(n)).$changes.refId=t,M&&(z.$callbacks=M.$callbacks,M.$changes.refId&&t!==M.$changes.refId&&E.removeRef(M.$changes.refId))),E.addRef(t,z,z!==M)}}else if("string"===typeof A)z=Rw(A,e,r);else{var l=a(Object.keys(A)[0]),N=sw(e,r),U=E.refs.has(N)?M||E.refs.get(N):new l.constructor;if((z=U.clone(!0)).$changes.refId=N,M&&(z.$callbacks=M.$callbacks,M.$changes.refId&&N!==M.$changes.refId)){E.removeRef(M.$changes.refId);for(var v=M.entries(),R=void 0;(R=v.next())&&!R.done;){var V=(d=R.value)[0],b=d[1];q.push({refId:N,op:w.OPERATION.DELETE,field:V,value:void 0,previousValue:b})}}E.addRef(N,z,U!==M)}if(null!==z&&void 0!==z)if(z.$changes&&z.$changes.setParent(m.ref,m.root,s),I instanceof p)I[O]=z;else if(I instanceof c)V=i,I.$items.set(V,z),I.$changes.allChanges.add(s);else if(I instanceof K)I.setAt(s,z);else if(I instanceof Mw){var h=I.add(z);I.setIndex(s,h)}else I instanceof iw&&!1!==(h=I.add(z))&&I.setIndex(s,h);M!==z&&q.push({refId:X,op:y,field:O,dynamicIndex:i,value:z,previousValue:M})}else{console.warn("@colyseus/schema: definition mismatch");for(var P={offset:r.offset};r.offset<j&&(!Aw(e,r)||(P.offset=r.offset+1,!E.refs.has(sw(e,P))));)r.offset++}}else I.clear(q)}else{X=sw(e,r);var u=E.refs.get(X);if(!u)throw new Error('"refId" not found: '.concat(X));I=u}}return this._triggerChanges(q),E.garbageCollectDeletedRefs(),q},p.prototype.encode=function(e,r,I){void 0===e&&(e=!1),void 0===r&&(r=[]),void 0===I&&(I=!1);for(var d=this.$changes,q=new WeakSet,E=[d],j=1,X=0;X<j;X++){var k=E[X],m=k.ref,J=m instanceof p;k.ensureRefId(),q.add(k),k!==d&&(k.changed||e)&&(b(r,f),C(r,k.refId));for(var K=e?Array.from(k.allChanges):Array.from(k.changes.values()),y=0,s=K.length;y<s;y++){var O=e?{op:w.OPERATION.ADD,index:K[y]}:K[y],A=O.index,z=J?m._definition.fieldsByIndex&&m._definition.fieldsByIndex[A]:A,M=r.length;if(O.op!==w.OPERATION.TOUCH)if(J)b(r,A|O.op);else{if(b(r,O.op),O.op===w.OPERATION.CLEAR)continue;C(r,A)}if(J||(O.op&w.OPERATION.ADD)!=w.OPERATION.ADD||m instanceof c&&o(r,k.ref.$indexes.get(A)),O.op!==w.OPERATION.DELETE){var i=k.getType(A),t=k.getValue(A);if(t&&t.$changes&&!q.has(t.$changes)&&(E.push(t.$changes),t.$changes.ensureRefId(),j++),O.op!==w.OPERATION.TOUCH){if(p.is(i))Uw(t,i,m,z),C(r,t.$changes.refId),(O.op&w.OPERATION.ADD)===w.OPERATION.ADD&&this.tryEncodeTypeId(r,i,t.constructor);else if("string"===typeof i)vw(i,r,t,m,z);else{var n=a(Object.keys(i)[0]);Uw(m["_".concat(z)],n.constructor,m,z),C(r,t.$changes.refId)}I&&k.cache(A,r.slice(M))}}}e||I||k.discard()}return r},p.prototype.encodeAll=function(w){return this.encode(!0,[],w)},p.prototype.applyFilters=function(e,r){var I,d;void 0===r&&(r=!1);for(var q=this,E=new Set,j=tw.get(e),X=[this.$changes],k=1,m=[],J=function(J){var K=X[J];if(E.has(K.refId))return"continue";var y=K.ref,s=y instanceof p;b(m,f),C(m,K.refId);var O=j.refIds.has(K),a=r||!O;j.addRefId(K);var A=j.containerIndexes.get(K),z=a?Array.from(K.allChanges):Array.from(K.changes.values());!r&&s&&y._definition.indexesWithFilters&&y._definition.indexesWithFilters.forEach((function(p){!A.has(p)&&K.allChanges.has(p)&&(a?z.push(p):z.push({op:w.OPERATION.ADD,index:p}))}));for(var M=0,i=z.length;M<i;M++){var t=a?{op:w.OPERATION.ADD,index:z[M]}:z[M];if(t.op!==w.OPERATION.CLEAR){var n=t.index;if(t.op!==w.OPERATION.DELETE){var l=K.getValue(n),N=K.getType(n);if(s){if((U=y._definition.filters&&y._definition.filters[n])&&!U.call(y,e,l,q)){l&&l.$changes&&E.add(l.$changes.refId);continue}}else{var U,v=K.parent;if((U=K.getChildrenFilter())&&!U.call(v,e,y.$indexes.get(n),l,q)){l&&l.$changes&&E.add(l.$changes.refId);continue}}if(l.$changes&&(X.push(l.$changes),k++),t.op!==w.OPERATION.TOUCH)if(t.op===w.OPERATION.ADD||s)m.push.apply(m,null!==(I=K.caches[n])&&void 0!==I?I:[]),A.add(n);else if(A.has(n))m.push.apply(m,null!==(d=K.caches[n])&&void 0!==d?d:[]);else{if(A.add(n),b(m,w.OPERATION.ADD),C(m,n),y instanceof c){var R=K.ref.$indexes.get(n);o(m,R)}l.$changes?C(m,l.$changes.refId):Q[N](m,l)}else l.$changes&&!s&&(b(m,w.OPERATION.ADD),C(m,n),y instanceof c&&(R=K.ref.$indexes.get(n),o(m,R)),C(m,l.$changes.refId))}else s?b(m,t.op|n):(b(m,t.op),C(m,n))}else b(m,t.op)}},K=0;K<k;K++)J(K);return m},p.prototype.clone=function(){var w,p=new this.constructor,e=this._definition.schema;for(var r in e)"object"===typeof this[r]&&"function"===typeof(null===(w=this[r])||void 0===w?void 0:w.clone)?p[r]=this[r].clone():p[r]=this[r];return p},p.prototype.toJSON=function(){var w=this._definition.schema,p=this._definition.deprecated,e={};for(var r in w)p[r]||null===this[r]||"undefined"===typeof this[r]||(e[r]="function"===typeof this[r].toJSON?this[r].toJSON():this["_".concat(r)]);return e},p.prototype.discardAllChanges=function(){this.$changes.discardAll()},p.prototype.getByIndex=function(w){return this[this._definition.fieldsByIndex[w]]},p.prototype.deleteByIndex=function(w){this[this._definition.fieldsByIndex[w]]=void 0},p.prototype.tryEncodeTypeId=function(w,p,e){p._typeid!==e._typeid&&(b(w,q),C(w,e._typeid))},p.prototype.getSchemaType=function(w,p,e){var r;return w[p.offset]===q&&(p.offset++,r=this.constructor._context.get(sw(w,p))),r||e},p.prototype.createTypeInstance=function(w){var p=new w;return p.$changes.root=this.$changes.root,p},p.prototype._triggerChanges=function(e){for(var r,I,d,f,q,E,j,X,k,m=new Set,J=this.$changes.root.refs,K=function(K){var y=e[K],c=y.refId,s=J.get(c),O=s.$callbacks;if((y.op&w.OPERATION.DELETE)===w.OPERATION.DELETE&&y.previousValue instanceof p&&(null===(I=null===(r=y.previousValue.$callbacks)||void 0===r?void 0:r[w.OPERATION.DELETE])||void 0===I||I.forEach((function(w){return w()}))),!O)return"continue";if(s instanceof p){if(!m.has(c))try{null===(d=null===O||void 0===O?void 0:O[w.OPERATION.REPLACE])||void 0===d||d.forEach((function(w){return w()}))}catch(a){p.onError(a)}try{O.hasOwnProperty(y.field)&&(null===(f=O[y.field])||void 0===f||f.forEach((function(w){return w(y.value,y.previousValue)})))}catch(a){p.onError(a)}}else y.op===w.OPERATION.ADD&&void 0===y.previousValue?null===(q=O[w.OPERATION.ADD])||void 0===q||q.forEach((function(w){var p;return w(y.value,null!==(p=y.dynamicIndex)&&void 0!==p?p:y.field)})):y.op===w.OPERATION.DELETE?void 0!==y.previousValue&&(null===(E=O[w.OPERATION.DELETE])||void 0===E||E.forEach((function(w){var p;return w(y.previousValue,null!==(p=y.dynamicIndex)&&void 0!==p?p:y.field)}))):y.op===w.OPERATION.DELETE_AND_ADD&&(void 0!==y.previousValue&&(null===(j=O[w.OPERATION.DELETE])||void 0===j||j.forEach((function(w){var p;return w(y.previousValue,null!==(p=y.dynamicIndex)&&void 0!==p?p:y.field)}))),null===(X=O[w.OPERATION.ADD])||void 0===X||X.forEach((function(w){var p;return w(y.value,null!==(p=y.dynamicIndex)&&void 0!==p?p:y.field)}))),y.value!==y.previousValue&&(null===(k=O[w.OPERATION.REPLACE])||void 0===k||k.forEach((function(w){var p;return w(y.value,null!==(p=y.dynamicIndex)&&void 0!==p?p:y.field)})));m.add(c)},y=0;y<e.length;y++)K(y)},p._definition=A.create(),p}();function bw(w){for(var p=[w.$changes],e=1,r={},I=r,d=function(w){var e=p[w];e.changes.forEach((function(w){var p=e.ref,r=w.index,d=p._definition?p._definition.fieldsByIndex[r]:p.$indexes.get(r);I[d]=e.getValue(r)}))},f=0;f<e;f++)d(f);return r}var hw={context:new M},Pw=function(w){function p(){return null!==w&&w.apply(this,arguments)||this}return e(p,w),r([t("string",hw)],p.prototype,"name",void 0),r([t("string",hw)],p.prototype,"type",void 0),r([t("number",hw)],p.prototype,"referencedType",void 0),p}(Vw),uw=function(w){function p(){var p=null!==w&&w.apply(this,arguments)||this;return p.fields=new K,p}return e(p,w),r([t("number",hw)],p.prototype,"id",void 0),r([t([Pw],hw)],p.prototype,"fields",void 0),p}(Vw),Yw=function(w){function p(){var p=null!==w&&w.apply(this,arguments)||this;return p.types=new K,p}return e(p,w),p.encode=function(w){var e=w.constructor,r=new p;r.rootType=e._typeid;var I=function(w,p){for(var e in p){var I=new Pw;I.name=e;var d=void 0;if("string"===typeof p[e])d=p[e];else{var f=p[e],q=void 0;Vw.is(f)?(d="ref",q=p[e]):"string"===typeof f[d=Object.keys(f)[0]]?d+=":"+f[d]:q=f[d],I.referencedType=q?q._typeid:-1}I.type=d,w.fields.push(I)}r.types.push(w)},d=e._context.types;for(var f in d){var q=new uw;q.id=Number(f),I(q,d[f]._definition.schema)}return r.encodeAll()},p.decode=function(w,r){var I=new M,d=new p;d.decode(w,r);var f=d.types.reduce((function(w,p){var r=function(w){function p(){return null!==w&&w.apply(this,arguments)||this}return e(p,w),p}(Vw),d=p.id;return w[d]=r,I.add(r,d),w}),{});d.types.forEach((function(w){var p=f[w.id];w.fields.forEach((function(w){var e;if(void 0!==w.referencedType){var r=w.type,d=f[w.referencedType];if(!d){var q=w.type.split(":");r=q[0],d=q[1]}"ref"===r?t(d,{context:I})(p.prototype,w.name):t(((e={})[r]=d,e),{context:I})(p.prototype,w.name)}else t(w.type,{context:I})(p.prototype,w.name)}))}));var q=f[d.rootType],E=new q;for(var j in q._definition.schema){var X=q._definition.schema[j];"string"!==typeof X&&(E[j]="function"===typeof X?new X:new(a(Object.keys(X)[0]).constructor))}return E},r([t([uw],hw)],p.prototype,"types",void 0),r([t("number",hw)],p.prototype,"rootType",void 0),p}(Vw);O("map",{constructor:c}),O("array",{constructor:K}),O("set",{constructor:iw}),O("collection",{constructor:Mw}),w.ArraySchema=K,w.CollectionSchema=Mw,w.Context=M,w.MapSchema=c,w.Reflection=Yw,w.ReflectionField=Pw,w.ReflectionType=uw,w.Schema=Vw,w.SchemaDefinition=A,w.SetSchema=iw,w.decode=zw,w.defineTypes=U,w.deprecated=N,w.dumpChanges=bw,w.encode=Q,w.filter=n,w.filterChildren=l,w.hasFilter=z,w.registerType=O,w.type=t,Object.defineProperty(w,"__esModule",{value:!0})}(p)},13315:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13312:(w,p,e)=>{var r=e(13315),I=e(13317),d=Object.hasOwnProperty,f=Object.create(null);for(var q in r)d.call(r,q)&&(f[r[q]]=q);var E=w.exports={to:{},get:{}};function j(w,p,e){return Math.min(Math.max(p,w),e)}function X(w){var p=Math.round(w).toString(16).toUpperCase();return p.length<2?"0"+p:p}E.get=function(w){var p,e;switch(w.substring(0,3).toLowerCase()){case"hsl":p=E.get.hsl(w),e="hsl";break;case"hwb":p=E.get.hwb(w),e="hwb";break;default:p=E.get.rgb(w),e="rgb"}return p?{model:e,value:p}:null},E.get.rgb=function(w){if(!w)return null;var p,e,I,f=[0,0,0,1];if(p=w.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(I=p[2],p=p[1],e=0;e<3;e++){var q=2*e;f[e]=parseInt(p.slice(q,q+2),16)}I&&(f[3]=parseInt(I,16)/255)}else if(p=w.match(/^#([a-f0-9]{3,4})$/i)){for(I=(p=p[1])[3],e=0;e<3;e++)f[e]=parseInt(p[e]+p[e],16);I&&(f[3]=parseInt(I+I,16)/255)}else if(p=w.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(e=0;e<3;e++)f[e]=parseInt(p[e+1],0);p[4]&&(p[5]?f[3]=.01*parseFloat(p[4]):f[3]=parseFloat(p[4]))}else{if(!(p=w.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(p=w.match(/^(\w+)$/))?"transparent"===p[1]?[0,0,0,0]:d.call(r,p[1])?((f=r[p[1]])[3]=1,f):null:null;for(e=0;e<3;e++)f[e]=Math.round(2.55*parseFloat(p[e+1]));p[4]&&(p[5]?f[3]=.01*parseFloat(p[4]):f[3]=parseFloat(p[4]))}for(e=0;e<3;e++)f[e]=j(f[e],0,255);return f[3]=j(f[3],0,1),f},E.get.hsl=function(w){if(!w)return null;var p=w.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var e=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,j(parseFloat(p[2]),0,100),j(parseFloat(p[3]),0,100),j(isNaN(e)?1:e,0,1)]}return null},E.get.hwb=function(w){if(!w)return null;var p=w.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var e=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,j(parseFloat(p[2]),0,100),j(parseFloat(p[3]),0,100),j(isNaN(e)?1:e,0,1)]}return null},E.to.hex=function(){var w=I(arguments);return"#"+X(w[0])+X(w[1])+X(w[2])+(w[3]<1?X(Math.round(255*w[3])):"")},E.to.rgb=function(){var w=I(arguments);return w.length<4||1===w[3]?"rgb("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+")":"rgba("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+", "+w[3]+")"},E.to.rgb.percent=function(){var w=I(arguments),p=Math.round(w[0]/255*100),e=Math.round(w[1]/255*100),r=Math.round(w[2]/255*100);return w.length<4||1===w[3]?"rgb("+p+"%, "+e+"%, "+r+"%)":"rgba("+p+"%, "+e+"%, "+r+"%, "+w[3]+")"},E.to.hsl=function(){var w=I(arguments);return w.length<4||1===w[3]?"hsl("+w[0]+", "+w[1]+"%, "+w[2]+"%)":"hsla("+w[0]+", "+w[1]+"%, "+w[2]+"%, "+w[3]+")"},E.to.hwb=function(){var w=I(arguments),p="";return w.length>=4&&1!==w[3]&&(p=", "+w[3]),"hwb("+w[0]+", "+w[1]+"%, "+w[2]+"%"+p+")"},E.to.keyword=function(w){return f[w.slice(0,3)]}},13304:(w,p,e)=>{const r=e(13312),I=e(13329),d=["keyword","gray","hex"],f={};for(const J of Object.keys(I))f[[...I[J].labels].sort().join("")]=J;const q={};function E(w,p){if(!(this instanceof E))return new E(w,p);if(p&&p in d&&(p=null),p&&!(p in I))throw new Error("Unknown model: "+p);let e,j;if(null==w)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(w instanceof E)this.model=w.model,this.color=[...w.color],this.valpha=w.valpha;else if("string"===typeof w){const p=r.get(w);if(null===p)throw new Error("Unable to parse color from string: "+w);this.model=p.model,j=I[this.model].channels,this.color=p.value.slice(0,j),this.valpha="number"===typeof p.value[j]?p.value[j]:1}else if(w.length>0){this.model=p||"rgb",j=I[this.model].channels;const e=Array.prototype.slice.call(w,0,j);this.color=m(e,j),this.valpha="number"===typeof w[j]?w[j]:1}else if("number"===typeof w)this.model="rgb",this.color=[w>>16&255,w>>8&255,255&w],this.valpha=1;else{this.valpha=1;const p=Object.keys(w);"alpha"in w&&(p.splice(p.indexOf("alpha"),1),this.valpha="number"===typeof w.alpha?w.alpha:0);const r=p.sort().join("");if(!(r in f))throw new Error("Unable to parse color from object: "+JSON.stringify(w));this.model=f[r];const{labels:d}=I[this.model],q=[];for(e=0;e<d.length;e++)q.push(w[d[e]]);this.color=m(q)}if(q[this.model])for(j=I[this.model].channels,e=0;e<j;e++){const w=q[this.model][e];w&&(this.color[e]=w(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}E.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(w){let p=this.model in r.to?this:this.rgb();p=p.round("number"===typeof w?w:1);const e=1===p.valpha?p.color:[...p.color,this.valpha];return r.to[p.model](e)},percentString(w){const p=this.rgb().round("number"===typeof w?w:1),e=1===p.valpha?p.color:[...p.color,this.valpha];return r.to.rgb.percent(e)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const w={},{channels:p}=I[this.model],{labels:e}=I[this.model];for(let r=0;r<p;r++)w[e[r]]=this.color[r];return 1!==this.valpha&&(w.alpha=this.valpha),w},unitArray(){const w=this.rgb().color;return w[0]/=255,w[1]/=255,w[2]/=255,1!==this.valpha&&w.push(this.valpha),w},unitObject(){const w=this.rgb().object();return w.r/=255,w.g/=255,w.b/=255,1!==this.valpha&&(w.alpha=this.valpha),w},round(w){return w=Math.max(w||0,0),new E([...this.color.map(j(w)),this.valpha],this.model)},alpha(w){return void 0!==w?new E([...this.color,Math.max(0,Math.min(1,w))],this.model):this.valpha},red:X("rgb",0,k(255)),green:X("rgb",1,k(255)),blue:X("rgb",2,k(255)),hue:X(["hsl","hsv","hsl","hwb","hcg"],0,(w=>(w%360+360)%360)),saturationl:X("hsl",1,k(100)),lightness:X("hsl",2,k(100)),saturationv:X("hsv",1,k(100)),value:X("hsv",2,k(100)),chroma:X("hcg",1,k(100)),gray:X("hcg",2,k(100)),white:X("hwb",1,k(100)),wblack:X("hwb",2,k(100)),cyan:X("cmyk",0,k(100)),magenta:X("cmyk",1,k(100)),yellow:X("cmyk",2,k(100)),black:X("cmyk",3,k(100)),x:X("xyz",0,k(95.047)),y:X("xyz",1,k(100)),z:X("xyz",2,k(108.833)),l:X("lab",0,k(100)),a:X("lab",1),b:X("lab",2),keyword(w){return void 0!==w?new E(w):I[this.model].keyword(this.color)},hex(w){return void 0!==w?new E(w):r.to.hex(this.rgb().round().color)},hexa(w){if(void 0!==w)return new E(w);const p=this.rgb().round().color;let e=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===e.length&&(e="0"+e),r.to.hex(p)+e},rgbNumber(){const w=this.rgb().color;return(255&w[0])<<16|(255&w[1])<<8|255&w[2]},luminosity(){const w=this.rgb().color,p=[];for(const[e,r]of w.entries()){const w=r/255;p[e]=w<=.04045?w/12.92:((w+.055)/1.055)**2.4}return.2126*p[0]+.7152*p[1]+.0722*p[2]},contrast(w){const p=this.luminosity(),e=w.luminosity();return p>e?(p+.05)/(e+.05):(e+.05)/(p+.05)},level(w){const p=this.contrast(w);return p>=7?"AAA":p>=4.5?"AA":""},isDark(){const w=this.rgb().color;return(2126*w[0]+7152*w[1]+722*w[2])/1e4<128},isLight(){return!this.isDark()},negate(){const w=this.rgb();for(let p=0;p<3;p++)w.color[p]=255-w.color[p];return w},lighten(w){const p=this.hsl();return p.color[2]+=p.color[2]*w,p},darken(w){const p=this.hsl();return p.color[2]-=p.color[2]*w,p},saturate(w){const p=this.hsl();return p.color[1]+=p.color[1]*w,p},desaturate(w){const p=this.hsl();return p.color[1]-=p.color[1]*w,p},whiten(w){const p=this.hwb();return p.color[1]+=p.color[1]*w,p},blacken(w){const p=this.hwb();return p.color[2]+=p.color[2]*w,p},grayscale(){const w=this.rgb().color,p=.3*w[0]+.59*w[1]+.11*w[2];return E.rgb(p,p,p)},fade(w){return this.alpha(this.valpha-this.valpha*w)},opaquer(w){return this.alpha(this.valpha+this.valpha*w)},rotate(w){const p=this.hsl();let e=p.color[0];return e=(e+w)%360,e=e<0?360+e:e,p.color[0]=e,p},mix(w,p){if(!w||!w.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof w);const e=w.rgb(),r=this.rgb(),I=void 0===p?.5:p,d=2*I-1,f=e.alpha()-r.alpha(),q=((d*f===-1?d:(d+f)/(1+d*f))+1)/2,j=1-q;return E.rgb(q*e.red()+j*r.red(),q*e.green()+j*r.green(),q*e.blue()+j*r.blue(),e.alpha()*I+r.alpha()*(1-I))}};for(const J of Object.keys(I)){if(d.includes(J))continue;const{channels:w}=I[J];E.prototype[J]=function(){if(this.model===J)return new E(this);for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];return p.length>0?new E(p,J):new E([...(r=I[this.model][J].raw(this.color),Array.isArray(r)?r:[r]),this.valpha],J);var r},E[J]=function(){for(var p=arguments.length,e=new Array(p),r=0;r<p;r++)e[r]=arguments[r];let I=e[0];return"number"===typeof I&&(I=m(e,w)),new E(I,J)}}function j(w){return function(p){return function(w,p){return Number(w.toFixed(p))}(p,w)}}function X(w,p,e){w=Array.isArray(w)?w:[w];for(const r of w)(q[r]||(q[r]=[]))[p]=e;return w=w[0],function(r){let I;return void 0!==r?(e&&(r=e(r)),I=this[w](),I.color[p]=r,I):(I=this[w]().color[p],e&&(I=e(I)),I)}}function k(w){return function(p){return Math.max(0,Math.min(w,p))}}function m(w,p){for(let e=0;e<p;e++)"number"!==typeof w[e]&&(w[e]=0);return w}w.exports=E},13336:(w,p,e)=>{const r=e(13341),I={};for(const f of Object.keys(r))I[r[f]]=f;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};w.exports=d;for(const f of Object.keys(d)){if(!("channels"in d[f]))throw new Error("missing channels property: "+f);if(!("labels"in d[f]))throw new Error("missing channel labels property: "+f);if(d[f].labels.length!==d[f].channels)throw new Error("channel and label counts mismatch: "+f);const{channels:w,labels:p}=d[f];delete d[f].channels,delete d[f].labels,Object.defineProperty(d[f],"channels",{value:w}),Object.defineProperty(d[f],"labels",{value:p})}d.rgb.hsl=function(w){const p=w[0]/255,e=w[1]/255,r=w[2]/255,I=Math.min(p,e,r),d=Math.max(p,e,r),f=d-I;let q,E;d===I?q=0:p===d?q=(e-r)/f:e===d?q=2+(r-p)/f:r===d&&(q=4+(p-e)/f),q=Math.min(60*q,360),q<0&&(q+=360);const j=(I+d)/2;return E=d===I?0:j<=.5?f/(d+I):f/(2-d-I),[q,100*E,100*j]},d.rgb.hsv=function(w){let p,e,r,I,d;const f=w[0]/255,q=w[1]/255,E=w[2]/255,j=Math.max(f,q,E),X=j-Math.min(f,q,E),k=function(w){return(j-w)/6/X+.5};return 0===X?(I=0,d=0):(d=X/j,p=k(f),e=k(q),r=k(E),f===j?I=r-e:q===j?I=1/3+p-r:E===j&&(I=2/3+e-p),I<0?I+=1:I>1&&(I-=1)),[360*I,100*d,100*j]},d.rgb.hwb=function(w){const p=w[0],e=w[1];let r=w[2];const I=d.rgb.hsl(w)[0],f=1/255*Math.min(p,Math.min(e,r));return r=1-1/255*Math.max(p,Math.max(e,r)),[I,100*f,100*r]},d.rgb.cmyk=function(w){const p=w[0]/255,e=w[1]/255,r=w[2]/255,I=Math.min(1-p,1-e,1-r);return[100*((1-p-I)/(1-I)||0),100*((1-e-I)/(1-I)||0),100*((1-r-I)/(1-I)||0),100*I]},d.rgb.keyword=function(w){const p=I[w];if(p)return p;let e,d=1/0;for(const I of Object.keys(r)){const p=r[I],E=(q=p,((f=w)[0]-q[0])**2+(f[1]-q[1])**2+(f[2]-q[2])**2);E<d&&(d=E,e=I)}var f,q;return e},d.keyword.rgb=function(w){return r[w]},d.rgb.xyz=function(w){let p=w[0]/255,e=w[1]/255,r=w[2]/255;p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92;return[100*(.4124*p+.3576*e+.1805*r),100*(.2126*p+.7152*e+.0722*r),100*(.0193*p+.1192*e+.9505*r)]},d.rgb.lab=function(w){const p=d.rgb.xyz(w);let e=p[0],r=p[1],I=p[2];e/=95.047,r/=100,I/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,I=I>.008856?I**(1/3):7.787*I+16/116;return[116*r-16,500*(e-r),200*(r-I)]},d.hsl.rgb=function(w){const p=w[0]/360,e=w[1]/100,r=w[2]/100;let I,d,f;if(0===e)return f=255*r,[f,f,f];I=r<.5?r*(1+e):r+e-r*e;const q=2*r-I,E=[0,0,0];for(let j=0;j<3;j++)d=p+1/3*-(j-1),d<0&&d++,d>1&&d--,f=6*d<1?q+6*(I-q)*d:2*d<1?I:3*d<2?q+(I-q)*(2/3-d)*6:q,E[j]=255*f;return E},d.hsl.hsv=function(w){const p=w[0];let e=w[1]/100,r=w[2]/100,I=e;const d=Math.max(r,.01);r*=2,e*=r<=1?r:2-r,I*=d<=1?d:2-d;return[p,100*(0===r?2*I/(d+I):2*e/(r+e)),100*((r+e)/2)]},d.hsv.rgb=function(w){const p=w[0]/60,e=w[1]/100;let r=w[2]/100;const I=Math.floor(p)%6,d=p-Math.floor(p),f=255*r*(1-e),q=255*r*(1-e*d),E=255*r*(1-e*(1-d));switch(r*=255,I){case 0:return[r,E,f];case 1:return[q,r,f];case 2:return[f,r,E];case 3:return[f,q,r];case 4:return[E,f,r];case 5:return[r,f,q]}},d.hsv.hsl=function(w){const p=w[0],e=w[1]/100,r=w[2]/100,I=Math.max(r,.01);let d,f;f=(2-e)*r;const q=(2-e)*I;return d=e*I,d/=q<=1?q:2-q,d=d||0,f/=2,[p,100*d,100*f]},d.hwb.rgb=function(w){const p=w[0]/360;let e=w[1]/100,r=w[2]/100;const I=e+r;let d;I>1&&(e/=I,r/=I);const f=Math.floor(6*p),q=1-r;d=6*p-f,0!==(1&f)&&(d=1-d);const E=e+d*(q-e);let j,X,k;switch(f){default:case 6:case 0:j=q,X=E,k=e;break;case 1:j=E,X=q,k=e;break;case 2:j=e,X=q,k=E;break;case 3:j=e,X=E,k=q;break;case 4:j=E,X=e,k=q;break;case 5:j=q,X=e,k=E}return[255*j,255*X,255*k]},d.cmyk.rgb=function(w){const p=w[0]/100,e=w[1]/100,r=w[2]/100,I=w[3]/100;return[255*(1-Math.min(1,p*(1-I)+I)),255*(1-Math.min(1,e*(1-I)+I)),255*(1-Math.min(1,r*(1-I)+I))]},d.xyz.rgb=function(w){const p=w[0]/100,e=w[1]/100,r=w[2]/100;let I,d,f;return I=3.2406*p+-1.5372*e+-.4986*r,d=-.9689*p+1.8758*e+.0415*r,f=.0557*p+-.204*e+1.057*r,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,I=Math.min(Math.max(0,I),1),d=Math.min(Math.max(0,d),1),f=Math.min(Math.max(0,f),1),[255*I,255*d,255*f]},d.xyz.lab=function(w){let p=w[0],e=w[1],r=w[2];p/=95.047,e/=100,r/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*e-16,500*(p-e),200*(e-r)]},d.lab.xyz=function(w){let p,e,r;e=(w[0]+16)/116,p=w[1]/500+e,r=e-w[2]/200;const I=e**3,d=p**3,f=r**3;return e=I>.008856?I:(e-16/116)/7.787,p=d>.008856?d:(p-16/116)/7.787,r=f>.008856?f:(r-16/116)/7.787,p*=95.047,e*=100,r*=108.883,[p,e,r]},d.lab.lch=function(w){const p=w[0],e=w[1],r=w[2];let I;I=360*Math.atan2(r,e)/2/Math.PI,I<0&&(I+=360);return[p,Math.sqrt(e*e+r*r),I]},d.lch.lab=function(w){const p=w[0],e=w[1],r=w[2]/360*2*Math.PI;return[p,e*Math.cos(r),e*Math.sin(r)]},d.rgb.ansi16=function(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[e,r,I]=w;let f=null===p?d.rgb.hsv(w)[2]:p;if(f=Math.round(f/50),0===f)return 30;let q=30+(Math.round(I/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===f&&(q+=60),q},d.hsv.ansi16=function(w){return d.rgb.ansi16(d.hsv.rgb(w),w[2])},d.rgb.ansi256=function(w){const p=w[0],e=w[1],r=w[2];if(p===e&&e===r)return p<8?16:p>248?231:Math.round((p-8)/247*24)+232;return 16+36*Math.round(p/255*5)+6*Math.round(e/255*5)+Math.round(r/255*5)},d.ansi16.rgb=function(w){let p=w%10;if(0===p||7===p)return w>50&&(p+=3.5),p=p/10.5*255,[p,p,p];const e=.5*(1+~~(w>50));return[(1&p)*e*255,(p>>1&1)*e*255,(p>>2&1)*e*255]},d.ansi256.rgb=function(w){if(w>=232){const p=10*(w-232)+8;return[p,p,p]}let p;w-=16;return[Math.floor(w/36)/5*255,Math.floor((p=w%36)/6)/5*255,p%6/5*255]},d.rgb.hex=function(w){const p=(((255&Math.round(w[0]))<<16)+((255&Math.round(w[1]))<<8)+(255&Math.round(w[2]))).toString(16).toUpperCase();return"000000".substring(p.length)+p},d.hex.rgb=function(w){const p=w.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!p)return[0,0,0];let e=p[0];3===p[0].length&&(e=e.split("").map((w=>w+w)).join(""));const r=parseInt(e,16);return[r>>16&255,r>>8&255,255&r]},d.rgb.hcg=function(w){const p=w[0]/255,e=w[1]/255,r=w[2]/255,I=Math.max(Math.max(p,e),r),d=Math.min(Math.min(p,e),r),f=I-d;let q,E;return q=f<1?d/(1-f):0,E=f<=0?0:I===p?(e-r)/f%6:I===e?2+(r-p)/f:4+(p-e)/f,E/=6,E%=1,[360*E,100*f,100*q]},d.hsl.hcg=function(w){const p=w[1]/100,e=w[2]/100,r=e<.5?2*p*e:2*p*(1-e);let I=0;return r<1&&(I=(e-.5*r)/(1-r)),[w[0],100*r,100*I]},d.hsv.hcg=function(w){const p=w[1]/100,e=w[2]/100,r=p*e;let I=0;return r<1&&(I=(e-r)/(1-r)),[w[0],100*r,100*I]},d.hcg.rgb=function(w){const p=w[0]/360,e=w[1]/100,r=w[2]/100;if(0===e)return[255*r,255*r,255*r];const I=[0,0,0],d=p%1*6,f=d%1,q=1-f;let E=0;switch(Math.floor(d)){case 0:I[0]=1,I[1]=f,I[2]=0;break;case 1:I[0]=q,I[1]=1,I[2]=0;break;case 2:I[0]=0,I[1]=1,I[2]=f;break;case 3:I[0]=0,I[1]=q,I[2]=1;break;case 4:I[0]=f,I[1]=0,I[2]=1;break;default:I[0]=1,I[1]=0,I[2]=q}return E=(1-e)*r,[255*(e*I[0]+E),255*(e*I[1]+E),255*(e*I[2]+E)]},d.hcg.hsv=function(w){const p=w[1]/100,e=p+w[2]/100*(1-p);let r=0;return e>0&&(r=p/e),[w[0],100*r,100*e]},d.hcg.hsl=function(w){const p=w[1]/100,e=w[2]/100*(1-p)+.5*p;let r=0;return e>0&&e<.5?r=p/(2*e):e>=.5&&e<1&&(r=p/(2*(1-e))),[w[0],100*r,100*e]},d.hcg.hwb=function(w){const p=w[1]/100,e=p+w[2]/100*(1-p);return[w[0],100*(e-p),100*(1-e)]},d.hwb.hcg=function(w){const p=w[1]/100,e=1-w[2]/100,r=e-p;let I=0;return r<1&&(I=(e-r)/(1-r)),[w[0],100*r,100*I]},d.apple.rgb=function(w){return[w[0]/65535*255,w[1]/65535*255,w[2]/65535*255]},d.rgb.apple=function(w){return[w[0]/255*65535,w[1]/255*65535,w[2]/255*65535]},d.gray.rgb=function(w){return[w[0]/100*255,w[0]/100*255,w[0]/100*255]},d.gray.hsl=function(w){return[0,0,w[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(w){return[0,100,w[0]]},d.gray.cmyk=function(w){return[0,0,0,w[0]]},d.gray.lab=function(w){return[w[0],0,0]},d.gray.hex=function(w){const p=255&Math.round(w[0]/100*255),e=((p<<16)+(p<<8)+p).toString(16).toUpperCase();return"000000".substring(e.length)+e},d.rgb.gray=function(w){return[(w[0]+w[1]+w[2])/3/255*100]}},13329:(w,p,e)=>{const r=e(13336),I=e(13343),d={};Object.keys(r).forEach((w=>{d[w]={},Object.defineProperty(d[w],"channels",{value:r[w].channels}),Object.defineProperty(d[w],"labels",{value:r[w].labels});const p=I(w);Object.keys(p).forEach((e=>{const r=p[e];d[w][e]=function(w){const p=function(){for(var p=arguments.length,e=new Array(p),r=0;r<p;r++)e[r]=arguments[r];const I=e[0];if(void 0===I||null===I)return I;I.length>1&&(e=I);const d=w(e);if("object"===typeof d)for(let w=d.length,f=0;f<w;f++)d[f]=Math.round(d[f]);return d};return"conversion"in w&&(p.conversion=w.conversion),p}(r),d[w][e].raw=function(w){const p=function(){for(var p=arguments.length,e=new Array(p),r=0;r<p;r++)e[r]=arguments[r];const I=e[0];return void 0===I||null===I?I:(I.length>1&&(e=I),w(e))};return"conversion"in w&&(p.conversion=w.conversion),p}(r)}))})),w.exports=d},13343:(w,p,e)=>{const r=e(13336);function I(w){const p=function(){const w={},p=Object.keys(r);for(let e=p.length,r=0;r<e;r++)w[p[r]]={distance:-1,parent:null};return w}(),e=[w];for(p[w].distance=0;e.length;){const w=e.pop(),I=Object.keys(r[w]);for(let r=I.length,d=0;d<r;d++){const r=I[d],f=p[r];-1===f.distance&&(f.distance=p[w].distance+1,f.parent=w,e.unshift(r))}}return p}function d(w,p){return function(e){return p(w(e))}}function f(w,p){const e=[p[w].parent,w];let I=r[p[w].parent][w],f=p[w].parent;for(;p[f].parent;)e.unshift(p[f].parent),I=d(r[p[f].parent][f],I),f=p[f].parent;return I.conversion=e,I}w.exports=function(w){const p=I(w),e={},r=Object.keys(p);for(let I=r.length,d=0;d<I;d++){const w=r[d];null!==p[w].parent&&(e[w]=f(w,p))}return e}},13341:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11873:function(w,p,e){"use strict";var r=this&&this.__createBinding||(Object.create?function(w,p,e,r){void 0===r&&(r=e);var I=Object.getOwnPropertyDescriptor(p,e);I&&!("get"in I?!p.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return p[e]}}),Object.defineProperty(w,r,I)}:function(w,p,e,r){void 0===r&&(r=e),w[r]=p[e]}),I=this&&this.__setModuleDefault||(Object.create?function(w,p){Object.defineProperty(w,"default",{enumerable:!0,value:p})}:function(w,p){w.default=p}),d=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var p={};if(null!=w)for(var e in w)"default"!==e&&Object.prototype.hasOwnProperty.call(w,e)&&r(p,w,e);return I(p,w),p},f=this&&this.__awaiter||function(w,p,e,r){return new(e||(e=Promise))((function(I,d){function f(w){try{E(r.next(w))}catch(p){d(p)}}function q(w){try{E(r.throw(w))}catch(p){d(p)}}function E(w){var p;w.done?I(w.value):(p=w.value,p instanceof e?p:new e((function(w){w(p)}))).then(f,q)}E((r=r.apply(w,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Auth=p.Platform=void 0;const q=d(e(11810)),E=e(11879),j="colyseus-auth-token";!function(w){w.ios="ios",w.android="android"}(p.Platform||(p.Platform={}));p.Auth=class{constructor(w){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=w.replace("ws","http"),(0,E.getItem)(j,(w=>this.token=w))}get hasToken(){return!!this.token}login(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,void 0,void 0,(function*(){const p=Object.assign({},w);this.hasToken&&(p.token=this.token);const e=yield this.request("post","/auth",p);this.token=e.token,(0,E.setItem)(j,this.token);for(let w in e)this.hasOwnProperty(w)&&(this[w]=e[w]);return this.registerPingService(),this}))}save(){return f(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(w){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:w})}))}acceptFriendRequest(w){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:w})}))}declineFriendRequest(w){return f(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:w})}))}blockUser(w){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:w})}))}unblockUser(w){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:w})}))}request(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return f(this,void 0,void 0,(function*(){I.Accept="application/json",this.hasToken&&(I.Authorization="Bearer "+this.token);const d=[];for(const w in e)d.push(`${w}=${e[w]}`);const f=d.length>0?`?${d.join("&")}`:"",E={headers:I};return r&&(E.body=r),(yield q[w](`${this.endpoint}${p}${f}`,E)).data}))}logout(){this.token=void 0,(0,E.removeItem)(j),this.unregisterPingService()}registerPingService(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),w)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11807:function(w,p,e){"use strict";var r,I=this&&this.__awaiter||function(w,p,e,r){return new(e||(e=Promise))((function(I,d){function f(w){try{E(r.next(w))}catch(p){d(p)}}function q(w){try{E(r.throw(w))}catch(p){d(p)}}function E(w){var p;w.done?I(w.value):(p=w.value,p instanceof e?p:new e((function(w){w(p)}))).then(f,q)}E((r=r.apply(w,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Client=p.MatchMakeError=void 0;const d=e(11810),f=e(11818),q=e(11826);class E extends Error{constructor(w,p){super(w),this.code=p,Object.setPrototypeOf(this,E.prototype)}}p.MatchMakeError=E;const j="undefined"!==typeof window&&"undefined"!==typeof(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";p.Client=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;if("string"===typeof w){const p=new URL(w),e="https:"===p.protocol||"wss:"===p.protocol,r=Number(p.port||(e?443:80));this.settings={hostname:p.hostname,pathname:"/"!==p.pathname?p.pathname:"",port:r,secure:e}}else void 0===w.port&&(w.port=w.secure?443:80),void 0===w.pathname&&(w.pathname=""),this.settings=w}joinOrCreate(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",w,p,e)}))}create(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",w,p,e)}))}join(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",w,p,e)}))}joinById(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",w,p,e)}))}reconnect(w,p){return I(this,void 0,void 0,(function*(){if("string"===typeof w&&"string"===typeof p)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[e,r]=w.split(":");return yield this.createMatchMakeRequest("reconnect",e,{reconnectionToken:r},p)}))}getAvailableRooms(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return I(this,void 0,void 0,(function*(){return(yield(0,d.get)(this.getHttpEndpoint(`${w}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(w,p,e){return I(this,void 0,void 0,(function*(){const r=this.createRoom(w.room.name,p);r.roomId=w.room.roomId,r.sessionId=w.sessionId;const d={sessionId:r.sessionId};w.reconnectionToken&&(d.reconnectionToken=w.reconnectionToken);const q=e||r;return r.connect(this.buildEndpoint(w.room,d),w.devMode&&(()=>I(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${r.roomId}'...`);let e=0;const d=()=>I(this,void 0,void 0,(function*(){e++;try{yield this.consumeSeatReservation(w,p,q),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${r.roomId}'`)}catch(I){e<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${e} out of 8)`),setTimeout(d,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(d,2e3)}))),q),new Promise(((w,p)=>{const e=(w,e)=>p(new f.ServerError(w,e));q.onError.once(e),q.onJoin.once((()=>{q.onError.remove(e),w(q)}))}))}))}createMatchMakeRequest(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;return I(this,void 0,void 0,(function*(){const I=(yield(0,d.post)(this.getHttpEndpoint(`${w}/${p}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})).data;if(I.error)throw new E(I.error,I.code);return"reconnect"===w&&(I.reconnectionToken=e.reconnectionToken),yield this.consumeSeatReservation(I,r,f)}))}createRoom(w,p){return new q.Room(w,p)}buildEndpoint(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=[];for(const I in p)p.hasOwnProperty(I)&&e.push(`${I}=${p[I]}`);let r=this.settings.secure?"wss://":"ws://";return w.publicAddress?r+=`${w.publicAddress}`:r+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${r}/${w.processId}/${w.roomId}?${e.join("&")}`}getHttpEndpoint(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${w}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11835:(w,p,e)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.Connection=void 0;const r=e(11837);p.Connection=class{constructor(){this.events={},this.transport=new r.WebSocketTransport(this.events)}send(w){this.transport.send(w)}connect(w){this.transport.connect(w)}close(w,p){this.transport.close(w,p)}get isOpen(){return this.transport.isOpen}}},11843:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.utf8Length=p.utf8Read=p.ErrorCode=p.Protocol=void 0,function(w){w[w.HANDSHAKE=9]="HANDSHAKE",w[w.JOIN_ROOM=10]="JOIN_ROOM",w[w.ERROR=11]="ERROR",w[w.LEAVE_ROOM=12]="LEAVE_ROOM",w[w.ROOM_DATA=13]="ROOM_DATA",w[w.ROOM_STATE=14]="ROOM_STATE",w[w.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",w[w.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",w[w.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(p.Protocol||(p.Protocol={})),function(w){w[w.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",w[w.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",w[w.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",w[w.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",w[w.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",w[w.AUTH_FAILED=4215]="AUTH_FAILED",w[w.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(p.ErrorCode||(p.ErrorCode={})),p.utf8Read=function(w,p){const e=w[p++];for(var r="",I=0,d=p,f=p+e;d<f;d++){var q=w[d];if(0!==(128&q))if(192!==(224&q))if(224!==(240&q)){if(240!==(248&q))throw new Error("Invalid byte "+q.toString(16));(I=(7&q)<<18|(63&w[++d])<<12|(63&w[++d])<<6|63&w[++d])>=65536?(I-=65536,r+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):r+=String.fromCharCode(I)}else r+=String.fromCharCode((15&q)<<12|(63&w[++d])<<6|63&w[++d]);else r+=String.fromCharCode((31&q)<<6|63&w[++d]);else r+=String.fromCharCode(q)}return r},p.utf8Length=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",p=0,e=0;for(let r=0,I=w.length;r<I;r++)p=w.charCodeAt(r),p<128?e+=1:p<2048?e+=2:p<55296||p>=57344?e+=3:(r++,e+=4);return e+1}},11826:function(w,p,e){"use strict";var r=this&&this.__createBinding||(Object.create?function(w,p,e,r){void 0===r&&(r=e);var I=Object.getOwnPropertyDescriptor(p,e);I&&!("get"in I?!p.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return p[e]}}),Object.defineProperty(w,r,I)}:function(w,p,e,r){void 0===r&&(r=e),w[r]=p[e]}),I=this&&this.__setModuleDefault||(Object.create?function(w,p){Object.defineProperty(w,"default",{enumerable:!0,value:p})}:function(w,p){w.default=p}),d=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var p={};if(null!=w)for(var e in w)"default"!==e&&Object.prototype.hasOwnProperty.call(w,e)&&r(p,w,e);return I(p,w),p};Object.defineProperty(p,"__esModule",{value:!0}),p.Room=void 0;const f=d(e(11830)),q=e(11835),E=e(11843),j=e(11847),X=e(11852),k=e(11859),m=e(11868),J=e(11818);class K{constructor(w,p){this.onStateChange=(0,k.createSignal)(),this.onError=(0,k.createSignal)(),this.onLeave=(0,k.createSignal)(),this.onJoin=(0,k.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,X.createNanoEvents)(),this.roomId=null,this.name=w,p&&(this.serializer=new((0,j.getSerializer)("schema")),this.rootSchema=p,this.serializer.state=new p),this.onError(((w,p)=>{var e;return null===(e=console.warn)||void 0===e?void 0:e.call(console,`colyseus.js - onError => (${w}) ${p}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const r=new q.Connection;e.connection=r,r.events.onmessage=K.prototype.onMessageCallback.bind(e),r.events.onclose=function(w){var r;if(!e.hasJoined)return null===(r=console.warn)||void 0===r||r.call(console,`Room connection was closed unexpectedly (${w.code}): ${w.reason}`),void e.onError.invoke(w.code,w.reason);w.code===J.CloseCode.DEVMODE_RESTART&&p?p():(e.onLeave.invoke(w.code),e.destroy())},r.events.onerror=function(w){var p;null===(p=console.warn)||void 0===p||p.call(console,`Room, onError (${w.code}): ${w.reason}`),e.onError.invoke(w.code,w.reason)},r.connect(w)}leave(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((p=>{this.onLeave((w=>p(w))),this.connection?w?this.connection.send([E.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(J.CloseCode.CONSENTED)}))}onMessage(w,p){return this.onMessageHandlers.on(this.getMessageHandlerKey(w),p)}send(w,p){const e=[E.Protocol.ROOM_DATA];let r;if("string"===typeof w?m.encode.string(e,w):m.encode.number(e,w),void 0!==p){const w=f.encode(p);r=new Uint8Array(e.length+w.byteLength),r.set(new Uint8Array(e),0),r.set(new Uint8Array(w),e.length)}else r=new Uint8Array(e);this.connection.send(r.buffer)}sendBytes(w,p){const e=[E.Protocol.ROOM_DATA_BYTES];let r;"string"===typeof w?m.encode.string(e,w):m.encode.number(e,w),r=new Uint8Array(e.length+(p.byteLength||p.length)),r.set(new Uint8Array(e),0),r.set(new Uint8Array(p),e.length),this.connection.send(r.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(w){const p=Array.from(new Uint8Array(w.data)),e=p[0];if(e===E.Protocol.JOIN_ROOM){let w=1;const e=(0,E.utf8Read)(p,w);if(w+=(0,E.utf8Length)(e),this.serializerId=(0,E.utf8Read)(p,w),w+=(0,E.utf8Length)(this.serializerId),!this.serializer){const w=(0,j.getSerializer)(this.serializerId);this.serializer=new w}p.length>w&&this.serializer.handshake&&this.serializer.handshake(p,{offset:w}),this.reconnectionToken=`${this.roomId}:${e}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([E.Protocol.JOIN_ROOM])}else if(e===E.Protocol.ERROR){const w={offset:1},e=m.decode.number(p,w),r=m.decode.string(p,w);this.onError.invoke(e,r)}else if(e===E.Protocol.LEAVE_ROOM)this.leave();else if(e===E.Protocol.ROOM_DATA_SCHEMA){const w={offset:1},e=this.serializer.getState().constructor._context.get(m.decode.number(p,w)),r=new e;r.decode(p,w),this.dispatchMessage(e,r)}else if(e===E.Protocol.ROOM_STATE)p.shift(),this.setState(p);else if(e===E.Protocol.ROOM_STATE_PATCH)p.shift(),this.patch(p);else if(e===E.Protocol.ROOM_DATA){const e={offset:1},r=m.decode.stringCheck(p,e)?m.decode.string(p,e):m.decode.number(p,e),I=p.length>e.offset?f.decode(w.data,e.offset):void 0;this.dispatchMessage(r,I)}else if(e===E.Protocol.ROOM_DATA_BYTES){const w={offset:1},e=m.decode.stringCheck(p,w)?m.decode.string(p,w):m.decode.number(p,w);this.dispatchMessage(e,new Uint8Array(p.slice(w.offset)))}}setState(w){this.serializer.setState(w),this.onStateChange.invoke(this.serializer.getState())}patch(w){this.serializer.patch(w),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(w,p){var e;const r=this.getMessageHandlerKey(w);this.onMessageHandlers.events[r]?this.onMessageHandlers.emit(r,p):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",w,p):null===(e=console.warn)||void 0===e||e.call(console,`colyseus.js: onMessage() not registered for type '${w}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(w){switch(typeof w){case"function":return`$${w._typeid}`;case"string":return w;case"number":return`i${w}`;default:throw new Error("invalid message type.")}}}p.Room=K},11879:(w,p)=>{"use strict";let e;function r(){return e||(e="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(w,p){this.cache[w]=p},getItem:function(w){this.cache[w]},removeItem:function(w){delete this.cache[w]}}),e}Object.defineProperty(p,"__esModule",{value:!0}),p.getItem=p.removeItem=p.setItem=void 0,p.setItem=function(w,p){r().setItem(w,p)},p.removeItem=function(w){r().removeItem(w)},p.getItem=function(w,p){const e=r().getItem(w);"undefined"!==typeof Promise&&e instanceof Promise?e.then((w=>p(w))):p(e)}},11852:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createNanoEvents=void 0;p.createNanoEvents=()=>({emit(w){let p=this.events[w]||[];for(var e=arguments.length,r=new Array(e>1?e-1:0),I=1;I<e;I++)r[I-1]=arguments[I];for(let d=0,f=p.length;d<f;d++)p[d](...r)},events:{},on(w,p){var e;return(null===(e=this.events[w])||void 0===e?void 0:e.push(p))||(this.events[w]=[p]),()=>{var e;this.events[w]=null===(e=this.events[w])||void 0===e?void 0:e.filter((w=>p!==w))}}})},11859:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createSignal=p.EventEmitter=void 0;class e{constructor(){this.handlers=[]}register(w){return this.handlers.push(w),this}invoke(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];this.handlers.forEach((w=>w.apply(this,p)))}invokeAsync(){for(var w=arguments.length,p=new Array(w),e=0;e<w;e++)p[e]=arguments[e];return Promise.all(this.handlers.map((w=>w.apply(this,p))))}remove(w){const p=this.handlers.indexOf(w);this.handlers[p]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}p.EventEmitter=e,p.createSignal=function(){const w=new e;function p(p){return w.register(p,null===this)}return p.once=p=>{const e=function(){for(var r=arguments.length,I=new Array(r),d=0;d<r;d++)I[d]=arguments[d];p.apply(this,I),w.remove(e)};w.register(e)},p.remove=p=>w.remove(p),p.invoke=function(){return w.invoke(...arguments)},p.invokeAsync=function(){return w.invokeAsync(...arguments)},p.clear=()=>w.clear(),p}},11818:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.ServerError=p.CloseCode=void 0,function(w){w[w.CONSENTED=4e3]="CONSENTED",w[w.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(p.CloseCode||(p.CloseCode={}));class e extends Error{constructor(w,p){super(p),this.name="ServerError",this.code=w}}p.ServerError=e},11795:(w,p,e)=>{"use strict";p.e=void 0,e(11803);var r=e(11807);Object.defineProperty(p,"e",{enumerable:!0,get:function(){return r.Client}});var I=e(11843);var d=e(11826);var f=e(11873);const q=e(11884);const E=e(11890),j=e(11847);(0,j.registerSerializer)("schema",q.SchemaSerializer),(0,j.registerSerializer)("none",E.NoneSerializer)},11803:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=w=>null!==w&&"object"===typeof w&&w.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11830:(w,p)=>{"use strict";function e(w,p){if(this._offset=p,w instanceof ArrayBuffer)this._buffer=w,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(w))throw new Error("Invalid argument");this._buffer=w.buffer,this._view=new DataView(this._buffer,w.byteOffset,w.byteLength)}}Object.defineProperty(p,"__esModule",{value:!0}),p.decode=p.encode=void 0,e.prototype._array=function(w){for(var p=new Array(w),e=0;e<w;e++)p[e]=this._parse();return p},e.prototype._map=function(w){for(var p={},e=0;e<w;e++)p[this._parse()]=this._parse();return p},e.prototype._str=function(w){var p=function(w,p,e){for(var r="",I=0,d=p,f=p+e;d<f;d++){var q=w.getUint8(d);if(0!==(128&q))if(192!==(224&q))if(224!==(240&q)){if(240!==(248&q))throw new Error("Invalid byte "+q.toString(16));(I=(7&q)<<18|(63&w.getUint8(++d))<<12|(63&w.getUint8(++d))<<6|63&w.getUint8(++d))>=65536?(I-=65536,r+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):r+=String.fromCharCode(I)}else r+=String.fromCharCode((15&q)<<12|(63&w.getUint8(++d))<<6|63&w.getUint8(++d));else r+=String.fromCharCode((31&q)<<6|63&w.getUint8(++d));else r+=String.fromCharCode(q)}return r}(this._view,this._offset,w);return this._offset+=w,p},e.prototype._bin=function(w){var p=this._buffer.slice(this._offset,this._offset+w);return this._offset+=w,p},e.prototype._parse=function(){var w,p=this._view.getUint8(this._offset++),e=0,r=0,I=0,d=0;if(p<192)return p<128?p:p<144?this._map(15&p):p<160?this._array(15&p):this._str(31&p);if(p>223)return-1*(255-p+1);switch(p){case 192:return null;case 194:return!1;case 195:return!0;case 196:return e=this._view.getUint8(this._offset),this._offset+=1,this._bin(e);case 197:return e=this._view.getUint16(this._offset),this._offset+=2,this._bin(e);case 198:return e=this._view.getUint32(this._offset),this._offset+=4,this._bin(e);case 199:if(e=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,-1===r){var f=this._view.getUint32(this._offset);return I=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*I+d)+f/1e6)}return[r,this._bin(e)];case 200:return e=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(e)];case 201:return e=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(e)];case 202:return w=this._view.getFloat32(this._offset),this._offset+=4,w;case 203:return w=this._view.getFloat64(this._offset),this._offset+=8,w;case 204:return w=this._view.getUint8(this._offset),this._offset+=1,w;case 205:return w=this._view.getUint16(this._offset),this._offset+=2,w;case 206:return w=this._view.getUint32(this._offset),this._offset+=4,w;case 207:return I=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,I+d;case 208:return w=this._view.getInt8(this._offset),this._offset+=1,w;case 209:return w=this._view.getInt16(this._offset),this._offset+=2,w;case 210:return w=this._view.getInt32(this._offset),this._offset+=4,w;case 211:return I=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,I+d;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,-1===r?(w=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*w)):[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(I=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(I+d)):-1===r?(I=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&I)+d)+(I>>>2)/1e6)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return e=this._view.getUint8(this._offset),this._offset+=1,this._str(e);case 218:return e=this._view.getUint16(this._offset),this._offset+=2,this._str(e);case 219:return e=this._view.getUint32(this._offset),this._offset+=4,this._str(e);case 220:return e=this._view.getUint16(this._offset),this._offset+=2,this._array(e);case 221:return e=this._view.getUint32(this._offset),this._offset+=4,this._array(e);case 222:return e=this._view.getUint16(this._offset),this._offset+=2,this._map(e);case 223:return e=this._view.getUint32(this._offset),this._offset+=4,this._map(e)}throw new Error("Could not parse")},p.decode=function(w){var p=new e(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),r=p._parse();if(p._offset!==w.byteLength)throw new Error(w.byteLength-p._offset+" trailing bytes");return r};function r(w,p,e){for(var r=0,I=0,d=e.length;I<d;I++)(r=e.charCodeAt(I))<128?w.setUint8(p++,r):r<2048?(w.setUint8(p++,192|r>>6),w.setUint8(p++,128|63&r)):r<55296||r>=57344?(w.setUint8(p++,224|r>>12),w.setUint8(p++,128|r>>6&63),w.setUint8(p++,128|63&r)):(I++,r=65536+((1023&r)<<10|1023&e.charCodeAt(I)),w.setUint8(p++,240|r>>18),w.setUint8(p++,128|r>>12&63),w.setUint8(p++,128|r>>6&63),w.setUint8(p++,128|63&r))}function I(w,p,e){var r=typeof e,d=0,f=0,q=0,E=0,j=0,X=0;if("string"===r){if(j=function(w){for(var p=0,e=0,r=0,I=w.length;r<I;r++)(p=w.charCodeAt(r))<128?e+=1:p<2048?e+=2:p<55296||p>=57344?e+=3:(r++,e+=4);return e}(e),j<32)w.push(160|j),X=1;else if(j<256)w.push(217,j),X=2;else if(j<65536)w.push(218,j>>8,j),X=3;else{if(!(j<4294967296))throw new Error("String too long");w.push(219,j>>24,j>>16,j>>8,j),X=5}return p.push({_str:e,_length:j,_offset:w.length}),X+j}if("number"===r)return Math.floor(e)===e&&isFinite(e)?e>=0?e<128?(w.push(e),1):e<256?(w.push(204,e),2):e<65536?(w.push(205,e>>8,e),3):e<4294967296?(w.push(206,e>>24,e>>16,e>>8,e),5):(q=e/Math.pow(2,32)|0,E=e>>>0,w.push(207,q>>24,q>>16,q>>8,q,E>>24,E>>16,E>>8,E),9):e>=-32?(w.push(e),1):e>=-128?(w.push(208,e),2):e>=-32768?(w.push(209,e>>8,e),3):e>=-2147483648?(w.push(210,e>>24,e>>16,e>>8,e),5):(q=Math.floor(e/Math.pow(2,32)),E=e>>>0,w.push(211,q>>24,q>>16,q>>8,q,E>>24,E>>16,E>>8,E),9):(w.push(203),p.push({_float:e,_length:8,_offset:w.length}),9);if("object"===r){if(null===e)return w.push(192),1;if(Array.isArray(e)){if((j=e.length)<16)w.push(144|j),X=1;else if(j<65536)w.push(220,j>>8,j),X=3;else{if(!(j<4294967296))throw new Error("Array too large");w.push(221,j>>24,j>>16,j>>8,j),X=5}for(d=0;d<j;d++)X+=I(w,p,e[d]);return X}if(e instanceof Date){var k=e.getTime(),m=Math.floor(k/1e3),J=1e6*(k-1e3*m);return m>=0&&J>=0&&m<=17179869183?0===J&&m<=4294967295?(w.push(214,255,m>>24,m>>16,m>>8,m),6):(q=m/4294967296,E=4294967295&m,w.push(215,255,J>>22,J>>14,J>>6,q,E>>24,E>>16,E>>8,E),10):(q=Math.floor(m/4294967296),E=m>>>0,w.push(199,12,255,J>>24,J>>16,J>>8,J,q>>24,q>>16,q>>8,q,E>>24,E>>16,E>>8,E),15)}if(e instanceof ArrayBuffer){if((j=e.byteLength)<256)w.push(196,j),X=2;else if(j<65536)w.push(197,j>>8,j),X=3;else{if(!(j<4294967296))throw new Error("Buffer too large");w.push(198,j>>24,j>>16,j>>8,j),X=5}return p.push({_bin:e,_length:j,_offset:w.length}),X+j}if("function"===typeof e.toJSON)return I(w,p,e.toJSON());var K=[],y="",c=Object.keys(e);for(d=0,f=c.length;d<f;d++)void 0!==e[y=c[d]]&&"function"!==typeof e[y]&&K.push(y);if((j=K.length)<16)w.push(128|j),X=1;else if(j<65536)w.push(222,j>>8,j),X=3;else{if(!(j<4294967296))throw new Error("Object too large");w.push(223,j>>24,j>>16,j>>8,j),X=5}for(d=0;d<j;d++)X+=I(w,p,y=K[d]),X+=I(w,p,e[y]);return X}if("boolean"===r)return w.push(e?195:194),1;if("undefined"===r)return w.push(192),1;if("function"===typeof e.toJSON)return I(w,p,e.toJSON());throw new Error("Could not encode")}p.encode=function(w){var p=[],e=[],d=I(p,e,w),f=new ArrayBuffer(d),q=new DataView(f),E=0,j=0,X=-1;e.length>0&&(X=e[0]._offset);for(var k,m=0,J=0,K=0,y=p.length;K<y;K++)if(q.setUint8(j+K,p[K]),K+1===X){if(m=(k=e[E])._length,J=j+X,k._bin)for(var c=new Uint8Array(k._bin),s=0;s<m;s++)q.setUint8(J+s,c[s]);else k._str?r(q,J,k._str):void 0!==k._float&&q.setFloat64(J,k._float);j+=m,e[++E]&&(X=e[E]._offset)}return f}},11890:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.NoneSerializer=void 0;p.NoneSerializer=class{setState(w){}getState(){return null}patch(w){}teardown(){}handshake(w){}}},11884:(w,p,e)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.SchemaSerializer=void 0;const r=e(11868);p.SchemaSerializer=class{setState(w){return this.state.decode(w)}getState(){return this.state}patch(w){return this.state.decode(w)}teardown(){var w,p;null===(p=null===(w=this.state)||void 0===w?void 0:w.$changes)||void 0===p||p.root.clearRefs()}handshake(w,p){if(this.state){(new r.Reflection).decode(w,p)}else this.state=r.Reflection.decode(w,p)}}},11847:(w,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.getSerializer=p.registerSerializer=void 0;const e={};p.registerSerializer=function(w,p){e[w]=p},p.getSerializer=function(w){const p=e[w];if(!p)throw new Error("missing serializer: "+w);return p}},11837:function(w,p,e){"use strict";var r=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(p,"__esModule",{value:!0}),p.WebSocketTransport=void 0;const I=r(e(11839)),d=globalThis.WebSocket||I.default;p.WebSocketTransport=class{constructor(w){this.events=w}send(w){w instanceof ArrayBuffer?this.ws.send(w):Array.isArray(w)&&this.ws.send(new Uint8Array(w).buffer)}connect(w){this.ws=new d(w,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(w,p){this.ws.close(w,p)}get isOpen(){return this.ws.readyState===d.OPEN}}},11839:w=>{"use strict";w.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12228:w=>{"use strict";w.exports=function(w){for(var p=new Array(w),e=0;e<w;++e)p[e]=e;return p}},12237:w=>{function p(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(p(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&p(w.slice(0,0))}(w)||!!w._isBuffer)}},12219:(w,p,e)=>{var r=e(12228),I=e(12237),d="undefined"!==typeof Float64Array;function f(w,p){return w[0]-p[0]}function q(){var w,p=this.stride,e=new Array(p.length);for(w=0;w<e.length;++w)e[w]=[Math.abs(p[w]),w];e.sort(f);var r=new Array(e.length);for(w=0;w<r.length;++w)r[w]=e[w][1];return r}function E(w,p){var e=["View",p,"d",w].join("");p<0&&(e="View_Nil"+w);var I="generic"===w;if(-1===p){var d="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(d)()}if(0===p){d="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(I?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(I?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",d)(j[w][0])}d=["'use strict'"];var f=r(p),E=f.map((function(w){return"i"+w})),X="this.offset+"+f.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),k=f.map((function(w){return"b"+w})).join(","),m=f.map((function(w){return"c"+w})).join(",");d.push("function "+e+"(a,"+k+","+m+",d){this.data=a","this.shape=["+k+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+w+"'","proto.dimension="+p),d.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+f.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===p?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),p<4?(d.push("function "+e+"_order(){"),2===p?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+e+"_set("+E.join(",")+",v){"),I?d.push("return this.data.set("+X+",v)}"):d.push("return this.data["+X+"]=v}"),d.push("proto.get=function "+e+"_get("+E.join(",")+"){"),I?d.push("return this.data.get("+X+")}"):d.push("return this.data["+X+"]}"),d.push("proto.index=function "+e+"_index(",E.join(),"){return "+X+"}"),d.push("proto.hi=function "+e+"_hi("+E.join(",")+"){return new "+e+"(this.data,"+f.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+f.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var J=f.map((function(w){return"a"+w+"=this.shape["+w+"]"})),K=f.map((function(w){return"c"+w+"=this.stride["+w+"]"}));d.push("proto.lo=function "+e+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+K.join(","));for(var y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'&&i"+y+">=0){d=i"+y+"|0;b+=c"+y+"*d;a"+y+"-=d}");d.push("return new "+e+"(this.data,"+f.map((function(w){return"a"+w})).join(",")+","+f.map((function(w){return"c"+w})).join(",")+",b)}"),d.push("proto.step=function "+e+"_step("+E.join(",")+"){var "+f.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+f.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'){d=i"+y+"|0;if(d<0){c+=b"+y+"*(a"+y+"-1);a"+y+"=ceil(-a"+y+"/d)}else{a"+y+"=ceil(a"+y+"/d)}b"+y+"*=d}");d.push("return new "+e+"(this.data,"+f.map((function(w){return"a"+w})).join(",")+","+f.map((function(w){return"b"+w})).join(",")+",c)}");var c=new Array(p),s=new Array(p);for(y=0;y<p;++y)c[y]="a[i"+y+"]",s[y]="b[i"+y+"]";d.push("proto.transpose=function "+e+"_transpose("+E+"){"+E.map((function(w,p){return w+"=("+w+"===undefined?"+p+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+c.join(",")+","+s.join(",")+",this.offset)}"),d.push("proto.pick=function "+e+"_pick("+E+"){var a=[],b=[],c=this.offset");for(y=0;y<p;++y)d.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+f.map((function(w){return"shape["+w+"]"})).join(",")+","+f.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(j[w],q)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,p,e,r){if(void 0===w)return(0,j.array[0])([]);"number"===typeof w&&(w=[w]),void 0===p&&(p=[w.length]);var f=p.length;if(void 0===e){e=new Array(f);for(var q=f-1,X=1;q>=0;--q)e[q]=X,X*=p[q]}if(void 0===r){r=0;for(q=0;q<f;++q)e[q]<0&&(r-=(p[q]-1)*e[q])}for(var k=function(w){if(I(w))return"buffer";if(d)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),m=j[k];m.length<=f+1;)m.push(E(k,m.length-1));return(0,m[f+1])(w,p,e,r)}},13284:w=>{var p;self,p=()=>(()=>{"use strict";var w={d:(p,e)=>{for(var r in e)w.o(e,r)&&!w.o(p,r)&&Object.defineProperty(p,r,{enumerable:!0,get:e[r]})},o:(w,p)=>Object.prototype.hasOwnProperty.call(w,p)},p={};w.d(p,{default:()=>b});var e,r=function(w,p){var e=p.x-w.x,r=p.y-w.y;return Math.sqrt(e*e+r*r)},I=function(w){return w*(Math.PI/180)},d=new Map,f=function(w){d.has(w)&&clearTimeout(d.get(w)),d.set(w,setTimeout(w,100))},q=function(w,p,e){for(var r,I=p.split(/[ ,]+/g),d=0;d<I.length;d+=1)r=I[d],w.addEventListener?w.addEventListener(r,e,!1):w.attachEvent&&w.attachEvent(r,e)},E=function(w,p,e){for(var r,I=p.split(/[ ,]+/g),d=0;d<I.length;d+=1)r=I[d],w.removeEventListener?w.removeEventListener(r,e):w.detachEvent&&w.detachEvent(r,e)},j=function(w){return w.preventDefault(),w.type.match(/^touch/)?w.changedTouches:w},X=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},k=function(w,p){p.top||p.right||p.bottom||p.left?(w.style.top=p.top,w.style.right=p.right,w.style.bottom=p.bottom,w.style.left=p.left):(w.style.left=p.x+"px",w.style.top=p.y+"px")},m=function(w,p,e){var r=J(w);for(var I in r)if(r.hasOwnProperty(I))if("string"==typeof p)r[I]=p+" "+e;else{for(var d="",f=0,q=p.length;f<q;f+=1)d+=p[f]+" "+e+", ";r[I]=d.slice(0,-2)}return r},J=function(w){var p={};return p[w]="",["webkit","Moz","o"].forEach((function(e){p[e+w.charAt(0).toUpperCase()+w.slice(1)]=""})),p},K=function(w,p){for(var e in p)p.hasOwnProperty(e)&&(w[e]=p[e]);return w},y=function(w,p){if(w.length)for(var e=0,r=w.length;e<r;e+=1)p(w[e]);else p(w)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,s=window.matchMedia("(any-hover: none)").matches,O=!!("ontouchstart"in window),a=!!window.PointerEvent,A=!!window.MSPointerEvent,z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},M={start:"mousedown",move:"mousemove",end:"mouseup"},i={};function t(){}c&&!s?e=z:a?e={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:A?e={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:O?(e=z,i=M):e=M,t.prototype.on=function(w,p){var e,r=this,I=w.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var d=0;d<I.length;d+=1)e=I[d],r._handlers_[e]=r._handlers_[e]||[],r._handlers_[e].push(p);return r},t.prototype.off=function(w,p){var e=this;return e._handlers_=e._handlers_||{},void 0===w?e._handlers_={}:void 0===p?e._handlers_[w]=null:e._handlers_[w]&&e._handlers_[w].indexOf(p)>=0&&e._handlers_[w].splice(e._handlers_[w].indexOf(p),1),e},t.prototype.trigger=function(w,p){var e,r=this,I=w.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var d=0;d<I.length;d+=1)e=I[d],r._handlers_[e]&&r._handlers_[e].length&&r._handlers_[e].forEach((function(w){w.call(r,{type:e,target:r},p)}))},t.prototype.config=function(w){var p=this;p.options=p.defaults||{},w&&(p.options=function(w,p){var e={};for(var r in w)w.hasOwnProperty(r)&&p.hasOwnProperty(r)?e[r]=p[r]:w.hasOwnProperty(r)&&(e[r]=w[r]);return e}(p.options,w))},t.prototype.bindEvt=function(w,p){var r=this;return r._domHandlers_=r._domHandlers_||{},r._domHandlers_[p]=function(){"function"==typeof r["on"+p]?r["on"+p].apply(r,arguments):console.warn('[WARNING] : Missing "on'+p+'" handler.')},q(w,e[p],r._domHandlers_[p]),i[p]&&q(w,i[p],r._domHandlers_[p]),r},t.prototype.unbindEvt=function(w,p){var r=this;return r._domHandlers_=r._domHandlers_||{},E(w,e[p],r._domHandlers_[p]),i[p]&&E(w,i[p],r._domHandlers_[p]),delete r._domHandlers_[p],this};const n=t;function l(w,p){return this.identifier=p.identifier,this.position=p.position,this.frontPosition=p.frontPosition,this.collection=w,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(p),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}l.prototype=new n,l.constructor=l,l.id=0,l.prototype.buildEl=function(w){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var w=this.options.fadeTime+"ms",p=function(){var w=J("borderRadius");for(var p in w)w.hasOwnProperty(p)&&(w[p]="50%");return w}(),e=m("transition","opacity",w),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},K(r.el,e),"circle"===this.options.shape&&K(r.back,p),K(r.front,p),this.applyStyles(r),this},l.prototype.applyStyles=function(w){for(var p in this.ui)if(this.ui.hasOwnProperty(p))for(var e in w[p])this.ui[p].style[e]=w[p][e];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(w){var p=this;return p.options.dataOnly||(clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.addToDom(),p.restCallback(),setTimeout((function(){p.ui.el.style.opacity=1}),0),p.showTimeout=setTimeout((function(){p.trigger("shown",p.instance),"function"==typeof w&&w.call(this)}),p.options.fadeTime)),p},l.prototype.hide=function(w){var p=this;if(p.options.dataOnly)return p;if(p.ui.el.style.opacity=p.options.restOpacity,clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.removeTimeout=setTimeout((function(){var e="dynamic"===p.options.mode?"none":"block";p.ui.el.style.display=e,"function"==typeof w&&w.call(p),p.trigger("hidden",p.instance)}),p.options.fadeTime),p.options.restJoystick){var e=p.options.restJoystick,r={};r.x=!0===e||!1!==e.x?0:p.instance.frontPosition.x,r.y=!0===e||!1!==e.y?0:p.instance.frontPosition.y,p.setPosition(w,r)}return p},l.prototype.setPosition=function(w,p){var e=this;e.frontPosition={x:p.x,y:p.y};var r=e.options.fadeTime+"ms",I={};I.front=m("transition",["transform"],r);var d={front:{}};d.front={transform:"translate("+e.frontPosition.x+"px,"+e.frontPosition.y+"px)"},e.applyStyles(I),e.applyStyles(d),e.restTimeout=setTimeout((function(){"function"==typeof w&&w.call(e),e.restCallback()}),e.options.fadeTime)},l.prototype.restCallback=function(){var w=this,p={};p.front=m("transition","none",""),w.applyStyles(p),w.trigger("rested",w.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(w){var p,e,r,I=w.angle.radian,d=Math.PI/4,f=Math.PI/2;if(I>d&&I<3*d&&!w.lockX?p="up":I>-d&&I<=d&&!w.lockY?p="left":I>3*-d&&I<=-d&&!w.lockX?p="down":w.lockY||(p="right"),w.lockY||(e=I>-f&&I<f?"left":"right"),w.lockX||(r=I>0?"up":"down"),w.force>this.options.threshold){var q,E={};for(q in this.direction)this.direction.hasOwnProperty(q)&&(E[q]=this.direction[q]);var j={};for(q in this.direction={x:e,y:r,angle:p},w.direction=this.direction,E)E[q]===this.direction[q]&&(j[q]=!0);if(j.x&&j.y&&j.angle)return w;j.x&&j.y||this.trigger("plain",w),j.x||this.trigger("plain:"+e,w),j.y||this.trigger("plain:"+r,w),j.angle||this.trigger("dir dir:"+p,w)}else this.resetDirection();return w};const N=l;function U(w,p){var e=this;e.nipples=[],e.idles=[],e.actives=[],e.ids=[],e.pressureIntervals={},e.manager=w,e.id=U.id,U.id+=1,e.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},e.config(p),"static"!==e.options.mode&&"semi"!==e.options.mode||(e.options.multitouch=!1),e.options.multitouch||(e.options.maxNumberOfNipples=1);var r=getComputedStyle(e.options.zone.parentElement);return r&&"flex"===r.display&&(e.parentIsFlex=!0),e.updateBox(),e.prepareNipples(),e.Vm(),e.begin(),e.nipples}U.prototype=new n,U.constructor=U,U.id=0,U.prototype.prepareNipples=function(){var w=this,p=w.nipples;p.on=w.on.bind(w),p.off=w.off.bind(w),p.options=w.options,p.destroy=w.destroy.bind(w),p.ids=w.ids,p.id=w.id,p.processOnMove=w.processOnMove.bind(w),p.processOnEnd=w.processOnEnd.bind(w),p.get=function(w){if(void 0===w)return p[0];for(var e=0,r=p.length;e<r;e+=1)if(p[e].identifier===w)return p[e];return!1}},U.prototype.Vm=function(){var w=this;w.bindEvt(w.options.zone,"start"),w.options.zone.style.touchAction="none",w.options.zone.style.msTouchAction="none"},U.prototype.begin=function(){var w=this,p=w.options;if("static"===p.mode){var e=w.createNipple(p.position,w.manager.getIdentifier());e.add(),w.idles.push(e)}},U.prototype.createNipple=function(w,p){var e=this,r=e.manager.scroll,I={},d=e.options,f=e.parentIsFlex?r.x:r.x+e.box.left,q=e.parentIsFlex?r.y:r.y+e.box.top;if(w.x&&w.y)I={x:w.x-f,y:w.y-q};else if(w.top||w.right||w.bottom||w.left){var E=document.createElement("DIV");E.style.display="hidden",E.style.top=w.top,E.style.right=w.right,E.style.bottom=w.bottom,E.style.left=w.left,E.style.position="absolute",d.zone.appendChild(E);var j=E.getBoundingClientRect();d.zone.removeChild(E),I=w,w={x:j.left+r.x,y:j.top+r.y}}var X=new N(e,{color:d.color,size:d.size,threshold:d.threshold,fadeTime:d.fadeTime,dataOnly:d.dataOnly,restJoystick:d.restJoystick,restOpacity:d.restOpacity,mode:d.mode,identifier:p,position:w,zone:d.zone,frontPosition:{x:0,y:0},shape:d.shape});return d.dataOnly||(k(X.ui.el,I),k(X.ui.front,X.frontPosition)),e.nipples.push(X),e.trigger("added "+X.identifier+":added",X),e.manager.trigger("added "+X.identifier+":added",X),e.bindNipple(X),X},U.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},U.prototype.bindNipple=function(w){var p,e=this,r=function(w,r){p=w.type+" "+r.id+":"+w.type,e.trigger(p,r)};w.on("destroyed",e.onDestroyed.bind(e)),w.on("shown hidden rested dir plain",r),w.on("dir:up dir:right dir:down dir:left",r),w.on("plain:up plain:right plain:down plain:left",r)},U.prototype.pressureFn=function(w,p,e){var r=this,I=0;clearInterval(r.pressureIntervals[e]),r.pressureIntervals[e]=setInterval(function(){var e=w.force||w.pressure||w.webkitForce||0;e!==I&&(p.trigger("pressure",e),r.trigger("pressure "+p.identifier+":pressure",e),I=e)}.bind(r),100)},U.prototype.onstart=function(w){var p=this,e=p.options,r=w;return w=j(w),p.updateBox(),y(w,(function(I){p.actives.length<e.maxNumberOfNipples?p.processOnStart(I):r.type.match(/^touch/)&&(Object.keys(p.manager.ids).forEach((function(e){if(Object.values(r.touches).findIndex((function(w){return w.identifier===e}))<0){var I=[w[0]];I.identifier=e,p.processOnEnd(I)}})),p.actives.length<e.maxNumberOfNipples&&p.processOnStart(I))})),p.manager.bindDocument(),!1},U.prototype.processOnStart=function(w){var p,e=this,I=e.options,d=e.manager.getIdentifier(w),f=w.force||w.pressure||w.webkitForce||0,q={x:w.pageX,y:w.pageY},E=e.getOrCreate(d,q);E.identifier!==d&&e.manager.removeIdentifier(E.identifier),E.identifier=d;var j=function(p){p.trigger("start",p),e.trigger("start "+p.id+":start",p),p.show(),f>0&&e.pressureFn(w,p,p.identifier),e.processOnMove(w)};if((p=e.idles.indexOf(E))>=0&&e.idles.splice(p,1),e.actives.push(E),e.ids.push(E.identifier),"semi"!==I.mode)j(E);else{if(!(r(q,E.position)<=I.catchDistance))return E.destroy(),void e.processOnStart(w);j(E)}return E},U.prototype.getOrCreate=function(w,p){var e,r=this,I=r.options;return/(semi|static)/.test(I.mode)?(e=r.idles[0])?(r.idles.splice(0,1),e):"semi"===I.mode?r.createNipple(p,w):(console.warn("Coudln't find the needed nipple."),!1):e=r.createNipple(p,w)},U.prototype.processOnMove=function(w){var p=this,e=p.options,d=p.manager.getIdentifier(w),f=p.nipples.get(d),q=p.manager.scroll;if(function(w){return isNaN(w.buttons)?0!==w.pressure:0!==w.buttons}(w)){if(!f)return console.error("Found zombie joystick with ID "+d),void p.manager.removeIdentifier(d);if(e.dynamicPage){var E=f.el.getBoundingClientRect();f.position={x:q.x+E.left,y:q.y+E.top}}f.identifier=d;var j=f.options.size/2,X={x:w.pageX,y:w.pageY};e.lockX&&(X.y=f.position.y),e.lockY&&(X.x=f.position.x);var k,m,J,K,y,c,s,O,a,A,z=r(X,f.position),M=(k=X,J=(m=f.position).x-k.x,K=m.y-k.y,function(w){return w*(180/Math.PI)}(Math.atan2(K,J))),i=I(M),t=z/j,n={distance:z,position:X};if("circle"===f.options.shape?(y=Math.min(z,j),s=f.position,O=y,A={x:0,y:0},a=I(a=M),A.x=s.x-O*Math.cos(a),A.y=s.y-O*Math.sin(a),c=A):(c=function(w,p,e){return{x:Math.min(Math.max(w.x,p.x-e),p.x+e),y:Math.min(Math.max(w.y,p.y-e),p.y+e)}}(X,f.position,j),y=r(c,f.position)),e.follow){if(z>j){var l=X.x-c.x,N=X.y-c.y;f.position.x+=l,f.position.y+=N,f.el.style.top=f.position.y-(p.box.top+q.y)+"px",f.el.style.left=f.position.x-(p.box.left+q.x)+"px",z=r(X,f.position)}}else X=c,z=y;var U=X.x-f.position.x,v=X.y-f.position.y;f.frontPosition={x:U,y:v},e.dataOnly||(f.ui.front.style.transform="translate("+U+"px,"+v+"px)");var R={identifier:f.identifier,position:X,force:t,pressure:w.force||w.pressure||w.webkitForce||0,distance:z,angle:{radian:i,degree:M},vector:{x:U/j,y:-v/j},raw:n,instance:f,lockX:e.lockX,lockY:e.lockY};(R=f.computeDirection(R)).angle={radian:I(180-M),degree:180-M},f.trigger("move",R),p.trigger("move "+f.id+":move",R)}else this.processOnEnd(w)},U.prototype.processOnEnd=function(w){var p=this,e=p.options,r=p.manager.getIdentifier(w),I=p.nipples.get(r),d=p.manager.removeIdentifier(I.identifier);I&&(e.dataOnly||I.hide((function(){"dynamic"===e.mode&&(I.trigger("removed",I),p.trigger("removed "+I.id+":removed",I),p.manager.trigger("removed "+I.id+":removed",I),I.destroy())})),clearInterval(p.pressureIntervals[I.identifier]),I.resetDirection(),I.trigger("end",I),p.trigger("end "+I.id+":end",I),p.ids.indexOf(I.identifier)>=0&&p.ids.splice(p.ids.indexOf(I.identifier),1),p.actives.indexOf(I)>=0&&p.actives.splice(p.actives.indexOf(I),1),/(semi|static)/.test(e.mode)?p.idles.push(I):p.nipples.indexOf(I)>=0&&p.nipples.splice(p.nipples.indexOf(I),1),p.manager.unbindDocument(),/(semi|static)/.test(e.mode)&&(p.manager.ids[d.id]=d.identifier))},U.prototype.onDestroyed=function(w,p){var e=this;e.nipples.indexOf(p)>=0&&e.nipples.splice(e.nipples.indexOf(p),1),e.actives.indexOf(p)>=0&&e.actives.splice(e.actives.indexOf(p),1),e.idles.indexOf(p)>=0&&e.idles.splice(e.idles.indexOf(p),1),e.ids.indexOf(p.identifier)>=0&&e.ids.splice(e.ids.indexOf(p.identifier),1),e.manager.removeIdentifier(p.identifier),e.manager.unbindDocument()},U.prototype.destroy=function(){var w=this;for(var p in w.unbindEvt(w.options.zone,"start"),w.nipples.forEach((function(w){w.destroy()})),w.pressureIntervals)w.pressureIntervals.hasOwnProperty(p)&&clearInterval(w.pressureIntervals[p]);w.trigger("destroyed",w.nipples),w.manager.unbindDocument(),w.off()};const v=U;function R(w){var p=this;p.ids={},p.index=0,p.collections=[],p.scroll=X(),p.config(w),p.prepareCollections();var e=function(){var w;p.collections.forEach((function(e){e.forEach((function(e){w=e.el.getBoundingClientRect(),e.position={x:p.scroll.x+w.left,y:p.scroll.y+w.top}}))}))};q(window,"resize",(function(){f(e)}));var r=function(){p.scroll=X()};return q(window,"scroll",(function(){f(r)})),p.collections}R.prototype=new n,R.constructor=R,R.prototype.prepareCollections=function(){var w=this;w.collections.create=w.create.bind(w),w.collections.on=w.on.bind(w),w.collections.off=w.off.bind(w),w.collections.destroy=w.destroy.bind(w),w.collections.get=function(p){var e;return w.collections.every((function(w){return!(e=w.get(p))})),e}},R.prototype.create=function(w){return this.createCollection(w)},R.prototype.createCollection=function(w){var p=this,e=new v(p,w);return p.bindCollection(e),p.collections.push(e),e},R.prototype.bindCollection=function(w){var p,e=this,r=function(w,r){p=w.type+" "+r.id+":"+w.type,e.trigger(p,r)};w.on("destroyed",e.onDestroyed.bind(e)),w.on("shown hidden rested dir plain",r),w.on("dir:up dir:right dir:down dir:left",r),w.on("plain:up plain:right plain:down plain:left",r)},R.prototype.bindDocument=function(){var w=this;w.binded||(w.bindEvt(document,"move").bindEvt(document,"end"),w.binded=!0)},R.prototype.unbindDocument=function(w){var p=this;Object.keys(p.ids).length&&!0!==w||(p.unbindEvt(document,"move").unbindEvt(document,"end"),p.binded=!1)},R.prototype.getIdentifier=function(w){var p;return w?void 0===(p=void 0===w.identifier?w.pointerId:w.identifier)&&(p=this.latest||0):p=this.index,void 0===this.ids[p]&&(this.ids[p]=this.index,this.index+=1),this.latest=p,this.ids[p]},R.prototype.removeIdentifier=function(w){var p={};for(var e in this.ids)if(this.ids[e]===w){p.id=e,p.identifier=this.ids[e],delete this.ids[e];break}return p},R.prototype.onmove=function(w){return this.onAny("move",w),!1},R.prototype.onend=function(w){return this.onAny("end",w),!1},R.prototype.oncancel=function(w){return this.onAny("end",w),!1},R.prototype.onAny=function(w,p){var e,r=this,I="processOn"+w.charAt(0).toUpperCase()+w.slice(1);p=j(p);var d=function(w,p,e){e.ids.indexOf(p)>=0&&(e[I](w),w._found_=!0)};return y(p,(function(w){e=r.getIdentifier(w),y(r.collections,d.bind(null,w,e)),w._found_||r.removeIdentifier(e)})),!1},R.prototype.destroy=function(){var w=this;w.unbindDocument(!0),w.ids={},w.index=0,w.collections.forEach((function(w){w.destroy()})),w.off()},R.prototype.onDestroyed=function(w,p){var e=this;if(e.collections.indexOf(p)<0)return!1;e.collections.splice(e.collections.indexOf(p),1)};var V=new R;const b={create:function(w){return V.create(w)},factory:V};return p.default})(),w.exports=p()},12257:(w,p,e)=>{"use strict";const{Deflate:r,deflate:I,deflateRaw:d,gzip:f}=e(12265),{Inflate:q,inflate:E,inflateRaw:j,ungzip:X}=e(12320),k=e(12299);w.exports.Deflate=r,w.exports.deflate=I,w.exports.deflateRaw=d,w.exports.gzip=f,w.exports.Inflate=q,w.exports.inflate=E,w.exports.inflateRaw=j,w.exports.ungzip=X,w.exports.constants=k},12265:(w,p,e)=>{"use strict";const r=e(12272),I=e(12306),d=e(12309),f=e(12291),q=e(12311),E=Object.prototype.toString,{Z_NO_FLUSH:j,Z_SYNC_FLUSH:X,Z_FULL_FLUSH:k,Z_FINISH:m,Z_OK:J,Z_STREAM_END:K,Z_DEFAULT_COMPRESSION:y,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:s}=e(12299);function O(w){this.options=I.assign({level:y,method:s,Ww:16384,windowBits:15,memLevel:8,strategy:c},w||{});let p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.jp="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0;let e=r.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(e!==J)throw new Error(f[e]);if(p.header&&r.deflateSetHeader(this.strm,p.header),p.dictionary){let w;if(w="string"===typeof p.dictionary?d.string2buf(p.dictionary):"[object ArrayBuffer]"===E.call(p.dictionary)?new Uint8Array(p.dictionary):p.dictionary,e=r.deflateSetDictionary(this.strm,w),e!==J)throw new Error(f[e]);this._dict_set=!0}}function a(w,p){const e=new O(p);if(e.push(w,!0),e.err)throw e.jp||f[e.err];return e.result}O.prototype.push=function(w,p){const e=this.strm,I=this.options.Ww;let f,q;if(this.ended)return!1;for(q=p===~~p?p:!0===p?m:j,"string"===typeof w?e.input=d.string2buf(w):"[object ArrayBuffer]"===E.call(w)?e.input=new Uint8Array(w):e.input=w,e.next_in=0,e.avail_in=e.input.length;;)if(0===e.avail_out&&(e.output=new Uint8Array(I),e.next_out=0,e.avail_out=I),(q===X||q===k)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(f=r.deflate(e,q),f===K)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),f=r.deflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===J;if(0!==e.avail_out){if(q>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(0===e.avail_in)break}else this.onData(e.output)}return!0},O.prototype.onData=function(w){this.chunks.push(w)},O.prototype.onEnd=function(w){w===J&&(this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.jp=this.strm.jp},w.exports.Deflate=O,w.exports.deflate=a,w.exports.deflateRaw=function(w,p){return(p=p||{}).raw=!0,a(w,p)},w.exports.gzip=function(w,p){return(p=p||{}).gzip=!0,a(w,p)},w.exports.constants=e(12299)},12320:(w,p,e)=>{"use strict";const r=e(12323),I=e(12306),d=e(12309),f=e(12291),q=e(12311),E=e(12332),j=Object.prototype.toString,{Z_NO_FLUSH:X,Z_FINISH:k,Z_OK:m,Z_STREAM_END:J,Z_NEED_DICT:K,Z_STREAM_ERROR:y,Z_DATA_ERROR:c,Z_MEM_ERROR:s}=e(12299);function O(w){this.options=I.assign({Ww:65536,windowBits:15,to:""},w||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,0===p.windowBits&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||w&&w.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&0===(15&p.windowBits)&&(p.windowBits|=15),this.err=0,this.jp="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0;let e=r.inflateInit2(this.strm,p.windowBits);if(e!==m)throw new Error(f[e]);if(this.header=new E,r.inflateGetHeader(this.strm,this.header),p.dictionary&&("string"===typeof p.dictionary?p.dictionary=d.string2buf(p.dictionary):"[object ArrayBuffer]"===j.call(p.dictionary)&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(e=r.inflateSetDictionary(this.strm,p.dictionary),e!==m)))throw new Error(f[e])}function a(w,p){const e=new O(p);if(e.push(w),e.err)throw e.jp||f[e.err];return e.result}O.prototype.push=function(w,p){const e=this.strm,I=this.options.Ww,f=this.options.dictionary;let q,E,O;if(this.ended)return!1;for(E=p===~~p?p:!0===p?k:X,"[object ArrayBuffer]"===j.call(w)?e.input=new Uint8Array(w):e.input=w,e.next_in=0,e.avail_in=e.input.length;;){for(0===e.avail_out&&(e.output=new Uint8Array(I),e.next_out=0,e.avail_out=I),q=r.inflate(e,E),q===K&&f&&(q=r.inflateSetDictionary(e,f),q===m?q=r.inflate(e,E):q===c&&(q=K));e.avail_in>0&&q===J&&e.state.wrap>0&&0!==w[e.next_in];)r.inflateReset(e),q=r.inflate(e,E);switch(q){case y:case c:case K:case s:return this.onEnd(q),this.ended=!0,!1}if(O=e.avail_out,e.next_out&&(0===e.avail_out||q===J))if("string"===this.options.to){let w=d.utf8border(e.output,e.next_out),p=e.next_out-w,r=d.buf2string(e.output,w);e.next_out=p,e.avail_out=I-p,p&&e.output.set(e.output.subarray(w,w+p),0),this.onData(r)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(q!==m||0!==O){if(q===J)return q=r.inflateEnd(this.strm),this.onEnd(q),this.ended=!0,!0;if(0===e.avail_in)break}}return!0},O.prototype.onData=function(w){this.chunks.push(w)},O.prototype.onEnd=function(w){w===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.jp=this.strm.jp},w.exports.Inflate=O,w.exports.inflate=a,w.exports.inflateRaw=function(w,p){return(p=p||{}).raw=!0,a(w,p)},w.exports.ungzip=a,w.exports.constants=e(12299)},12306:w=>{"use strict";const p=(w,p)=>Object.prototype.hasOwnProperty.call(w,p);w.exports.assign=function(w){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if("object"!==typeof r)throw new TypeError(r+"must be non-object");for(const e in r)p(r,e)&&(w[e]=r[e])}}return w},w.exports.flattenChunks=w=>{let p=0;for(let r=0,I=w.length;r<I;r++)p+=w[r].length;const e=new Uint8Array(p);for(let r=0,I=0,d=w.length;r<d;r++){let p=w[r];e.set(p,I),I+=p.length}return e}},12309:w=>{"use strict";let p=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){p=!1}const e=new Uint8Array(256);for(let I=0;I<256;I++)e[I]=I>=252?6:I>=248?5:I>=240?4:I>=224?3:I>=192?2:1;e[254]=e[254]=1,w.exports.string2buf=w=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(w);let p,e,r,I,d,f=w.length,q=0;for(I=0;I<f;I++)e=w.charCodeAt(I),55296===(64512&e)&&I+1<f&&(r=w.charCodeAt(I+1),56320===(64512&r)&&(e=65536+(e-55296<<10)+(r-56320),I++)),q+=e<128?1:e<2048?2:e<65536?3:4;for(p=new Uint8Array(q),d=0,I=0;d<q;I++)e=w.charCodeAt(I),55296===(64512&e)&&I+1<f&&(r=w.charCodeAt(I+1),56320===(64512&r)&&(e=65536+(e-55296<<10)+(r-56320),I++)),e<128?p[d++]=e:e<2048?(p[d++]=192|e>>>6,p[d++]=128|63&e):e<65536?(p[d++]=224|e>>>12,p[d++]=128|e>>>6&63,p[d++]=128|63&e):(p[d++]=240|e>>>18,p[d++]=128|e>>>12&63,p[d++]=128|e>>>6&63,p[d++]=128|63&e);return p};w.exports.buf2string=(w,r)=>{const I=r||w.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(w.subarray(0,r));let d,f;const q=new Array(2*I);for(f=0,d=0;d<I;){let p=w[d++];if(p<128){q[f++]=p;continue}let r=e[p];if(r>4)q[f++]=65533,d+=r-1;else{for(p&=2===r?31:3===r?15:7;r>1&&d<I;)p=p<<6|63&w[d++],r--;r>1?q[f++]=65533:p<65536?q[f++]=p:(p-=65536,q[f++]=55296|p>>10&1023,q[f++]=56320|1023&p)}}return((w,e)=>{if(e<65534&&w.subarray&&p)return String.fromCharCode.apply(null,w.length===e?w:w.subarray(0,e));let r="";for(let p=0;p<e;p++)r+=String.fromCharCode(w[p]);return r})(q,f)},w.exports.utf8border=(w,p)=>{(p=p||w.length)>w.length&&(p=w.length);let r=p-1;for(;r>=0&&128===(192&w[r]);)r--;return r<0||0===r?p:r+e[w[r]]>p?r:p}},12278:w=>{"use strict";w.exports=(w,p,e,r)=>{let I=65535&w,d=w>>>16&65535,f=0;for(;0!==e;){f=e>2e3?2e3:e,e-=f;do{I=I+p[r++]|0,d=d+I|0}while(--f);I%=65521,d%=65521}return I|d<<16}},12299:w=>{"use strict";w.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12284:w=>{"use strict";const p=new Uint32Array((()=>{let w,p=[];for(var e=0;e<256;e++){w=e;for(var r=0;r<8;r++)w=1&w?3988292384^w>>>1:w>>>1;p[e]=w}return p})());w.exports=(w,e,r,I)=>{const d=p,f=I+r;w^=-1;for(let p=I;p<f;p++)w=w>>>8^d[255&(w^e[p])];return~w}},12272:(w,p,e)=>{"use strict";const{_tr_init:r,_tr_stored_block:I,_tr_flush_block:d,_tr_tally:f,_tr_align:q}=e(12275),E=e(12278),j=e(12284),X=e(12291),{Z_NO_FLUSH:k,Z_PARTIAL_FLUSH:m,Z_FULL_FLUSH:J,Z_FINISH:K,Z_BLOCK:y,Z_OK:c,Z_STREAM_END:s,Z_STREAM_ERROR:O,Z_DATA_ERROR:a,Z_BUF_ERROR:A,Z_DEFAULT_COMPRESSION:z,Z_FILTERED:M,Z_HUFFMAN_ONLY:i,Z_RLE:t,Z_FIXED:n,Z_DEFAULT_STRATEGY:l,Z_UNKNOWN:N,Z_DEFLATED:U}=e(12299),v=258,R=262,V=103,b=113,h=666,P=(w,p)=>(w.jp=X[p],p),u=w=>(w<<1)-(w>4?9:0),Y=w=>{let p=w.length;for(;--p>=0;)w[p]=0};let L=(w,p,e)=>(p<<w.hash_shift^e)&w.hash_mask;const W=w=>{const p=w.state;let e=p.pending;e>w.avail_out&&(e=w.avail_out),0!==e&&(w.output.set(p.pending_buf.subarray(p.pending_out,p.pending_out+e),w.next_out),w.next_out+=e,p.pending_out+=e,w.total_out+=e,w.avail_out-=e,p.pending-=e,0===p.pending&&(p.pending_out=0))},F=(w,p)=>{d(w,w.block_start>=0?w.block_start:-1,w.strstart-w.block_start,p),w.block_start=w.strstart,W(w.strm)},H=(w,p)=>{w.pending_buf[w.pending++]=p},B=(w,p)=>{w.pending_buf[w.pending++]=p>>>8&255,w.pending_buf[w.pending++]=255&p},D=(w,p,e,r)=>{let I=w.avail_in;return I>r&&(I=r),0===I?0:(w.avail_in-=I,p.set(w.input.subarray(w.next_in,w.next_in+I),e),1===w.state.wrap?w.adler=E(w.adler,p,I,e):2===w.state.wrap&&(w.adler=j(w.adler,p,I,e)),w.next_in+=I,w.total_in+=I,I)},T=(w,p)=>{let e,r,I=w.max_chain_length,d=w.strstart,f=w.prev_length,q=w.nice_match;const E=w.strstart>w.w_size-R?w.strstart-(w.w_size-R):0,j=w.window,X=w.w_mask,k=w.prev,m=w.strstart+v;let J=j[d+f-1],K=j[d+f];w.prev_length>=w.good_match&&(I>>=2),q>w.lookahead&&(q=w.lookahead);do{if(e=p,j[e+f]===K&&j[e+f-1]===J&&j[e]===j[d]&&j[++e]===j[d+1]){d+=2,e++;do{}while(j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&j[++d]===j[++e]&&d<m);if(r=v-(m-d),d=m-v,r>f){if(w.match_start=p,f=r,r>=q)break;J=j[d+f-1],K=j[d+f]}}}while((p=k[p&X])>E&&0!==--I);return f<=w.lookahead?f:w.lookahead},Z=w=>{const p=w.w_size;let e,r,I,d,f;do{if(d=w.window_size-w.lookahead-w.strstart,w.strstart>=p+(p-R)){w.window.set(w.window.subarray(p,p+p),0),w.match_start-=p,w.strstart-=p,w.block_start-=p,r=w.hash_size,e=r;do{I=w.head[--e],w.head[e]=I>=p?I-p:0}while(--r);r=p,e=r;do{I=w.prev[--e],w.prev[e]=I>=p?I-p:0}while(--r);d+=p}if(0===w.strm.avail_in)break;if(r=D(w.strm,w.window,w.strstart+w.lookahead,d),w.lookahead+=r,w.lookahead+w.insert>=3)for(f=w.strstart-w.insert,w.ins_h=w.window[f],w.ins_h=L(w,w.ins_h,w.window[f+1]);w.insert&&(w.ins_h=L(w,w.ins_h,w.window[f+3-1]),w.prev[f&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=f,f++,w.insert--,!(w.lookahead+w.insert<3)););}while(w.lookahead<R&&0!==w.strm.avail_in)},G=(w,p)=>{let e,r;for(;;){if(w.lookahead<R){if(Z(w),w.lookahead<R&&p===k)return 1;if(0===w.lookahead)break}if(e=0,w.lookahead>=3&&(w.ins_h=L(w,w.ins_h,w.window[w.strstart+3-1]),e=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),0!==e&&w.strstart-e<=w.w_size-R&&(w.match_length=T(w,e)),w.match_length>=3)if(r=f(w,w.strstart-w.match_start,w.match_length-3),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=3){w.match_length--;do{w.strstart++,w.ins_h=L(w,w.ins_h,w.window[w.strstart+3-1]),e=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart}while(0!==--w.match_length);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=L(w,w.ins_h,w.window[w.strstart+1]);else r=f(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(r&&(F(w,!1),0===w.strm.avail_out))return 1}return w.insert=w.strstart<2?w.strstart:2,p===K?(F(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(F(w,!1),0===w.strm.avail_out)?1:2},g=(w,p)=>{let e,r,I;for(;;){if(w.lookahead<R){if(Z(w),w.lookahead<R&&p===k)return 1;if(0===w.lookahead)break}if(e=0,w.lookahead>=3&&(w.ins_h=L(w,w.ins_h,w.window[w.strstart+3-1]),e=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=2,0!==e&&w.prev_length<w.max_lazy_match&&w.strstart-e<=w.w_size-R&&(w.match_length=T(w,e),w.match_length<=5&&(w.strategy===M||3===w.match_length&&w.strstart-w.match_start>4096)&&(w.match_length=2)),w.prev_length>=3&&w.match_length<=w.prev_length){I=w.strstart+w.lookahead-3,r=f(w,w.strstart-1-w.prev_match,w.prev_length-3),w.lookahead-=w.prev_length-1,w.prev_length-=2;do{++w.strstart<=I&&(w.ins_h=L(w,w.ins_h,w.window[w.strstart+3-1]),e=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart)}while(0!==--w.prev_length);if(w.match_available=0,w.match_length=2,w.strstart++,r&&(F(w,!1),0===w.strm.avail_out))return 1}else if(w.match_available){if(r=f(w,0,w.window[w.strstart-1]),r&&F(w,!1),w.strstart++,w.lookahead--,0===w.strm.avail_out)return 1}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(r=f(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<2?w.strstart:2,p===K?(F(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(F(w,!1),0===w.strm.avail_out)?1:2};function o(w,p,e,r,I){this.good_length=w,this.max_lazy=p,this.nice_length=e,this.max_chain=r,this.func=I}const C=[new o(0,0,0,0,((w,p)=>{let e=65535;for(e>w.pending_buf_size-5&&(e=w.pending_buf_size-5);;){if(w.lookahead<=1){if(Z(w),0===w.lookahead&&p===k)return 1;if(0===w.lookahead)break}w.strstart+=w.lookahead,w.lookahead=0;const r=w.block_start+e;if((0===w.strstart||w.strstart>=r)&&(w.lookahead=w.strstart-r,w.strstart=r,F(w,!1),0===w.strm.avail_out))return 1;if(w.strstart-w.block_start>=w.w_size-R&&(F(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,p===K?(F(w,!0),0===w.strm.avail_out?3:4):(w.strstart>w.block_start&&(F(w,!1),w.strm.avail_out),1)})),new o(4,4,8,4,G),new o(4,5,16,8,G),new o(4,6,32,32,G),new o(4,4,16,16,g),new o(8,16,32,32,g),new o(8,16,128,128,g),new o(8,32,128,256,g),new o(32,128,258,1024,g),new o(32,258,258,4096,g)];function Q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=U,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const x=w=>{if(!w||!w.state)return P(w,O);w.total_in=w.total_out=0,w.data_type=N;const p=w.state;return p.pending=0,p.pending_out=0,p.wrap<0&&(p.wrap=-p.wrap),p.status=p.wrap?42:b,w.adler=2===p.wrap?0:1,p.last_flush=k,r(p),c},S=w=>{const p=x(w);var e;return p===c&&((e=w.state).window_size=2*e.w_size,Y(e.head),e.max_lazy_match=C[e.level].max_lazy,e.good_match=C[e.level].good_length,e.nice_match=C[e.level].nice_length,e.max_chain_length=C[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),p},ww=(w,p,e,r,I,d)=>{if(!w)return O;let f=1;if(p===z&&(p=6),r<0?(f=0,r=-r):r>15&&(f=2,r-=16),I<1||I>9||e!==U||r<8||r>15||p<0||p>9||d<0||d>n)return P(w,O);8===r&&(r=9);const q=new Q;return w.state=q,q.strm=w,q.wrap=f,q.gzhead=null,q.w_bits=r,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=I+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+3-1)/3),q.window=new Uint8Array(2*q.w_size),q.head=new Uint16Array(q.hash_size),q.prev=new Uint16Array(q.w_size),q.lit_bufsize=1<<I+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new Uint8Array(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=p,q.strategy=d,q.method=e,S(w)};w.exports.deflateInit=(w,p)=>ww(w,p,U,15,8,l),w.exports.deflateInit2=ww,w.exports.deflateReset=S,w.exports.deflateResetKeep=x,w.exports.deflateSetHeader=(w,p)=>w&&w.state?2!==w.state.wrap?O:(w.state.gzhead=p,c):O,w.exports.deflate=(w,p)=>{let e,r;if(!w||!w.state||p>y||p<0)return w?P(w,O):O;const d=w.state;if(!w.output||!w.input&&0!==w.avail_in||d.status===h&&p!==K)return P(w,0===w.avail_out?A:O);d.strm=w;const E=d.last_flush;if(d.last_flush=p,42===d.status)if(2===d.wrap)w.adler=0,H(d,31),H(d,139),H(d,8),d.gzhead?(H(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),H(d,255&d.gzhead.time),H(d,d.gzhead.time>>8&255),H(d,d.gzhead.time>>16&255),H(d,d.gzhead.time>>24&255),H(d,9===d.level?2:d.strategy>=i||d.level<2?4:0),H(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(H(d,255&d.gzhead.extra.length),H(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(w.adler=j(w.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(H(d,0),H(d,0),H(d,0),H(d,0),H(d,0),H(d,9===d.level?2:d.strategy>=i||d.level<2?4:0),H(d,3),d.status=b);else{let p=U+(d.w_bits-8<<4)<<8,e=-1;e=d.strategy>=i||d.level<2?0:d.level<6?1:6===d.level?2:3,p|=e<<6,0!==d.strstart&&(p|=32),p+=31-p%31,d.status=b,B(d,p),0!==d.strstart&&(B(d,w.adler>>>16),B(d,65535&w.adler)),w.adler=1}if(69===d.status)if(d.gzhead.extra){for(e=d.pending;d.gzindex<(65535&d.gzhead.extra.length)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),W(w),e=d.pending,d.pending!==d.pending_buf_size));)H(d,255&d.gzhead.extra[d.gzindex]),d.gzindex++;d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){e=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),W(w),e=d.pending,d.pending===d.pending_buf_size)){r=1;break}r=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,H(d,r)}while(0!==r);d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),0===r&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){e=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),W(w),e=d.pending,d.pending===d.pending_buf_size)){r=1;break}r=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,H(d,r)}while(0!==r);d.gzhead.hcrc&&d.pending>e&&(w.adler=j(w.adler,d.pending_buf,d.pending-e,e)),0===r&&(d.status=V)}else d.status=V;if(d.status===V&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&W(w),d.pending+2<=d.pending_buf_size&&(H(d,255&w.adler),H(d,w.adler>>8&255),w.adler=0,d.status=b)):d.status=b),0!==d.pending){if(W(w),0===w.avail_out)return d.last_flush=-1,c}else if(0===w.avail_in&&u(p)<=u(E)&&p!==K)return P(w,A);if(d.status===h&&0!==w.avail_in)return P(w,A);if(0!==w.avail_in||0!==d.lookahead||p!==k&&d.status!==h){let e=d.strategy===i?((w,p)=>{let e;for(;;){if(0===w.lookahead&&(Z(w),0===w.lookahead)){if(p===k)return 1;break}if(w.match_length=0,e=f(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++,e&&(F(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,p===K?(F(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(F(w,!1),0===w.strm.avail_out)?1:2})(d,p):d.strategy===t?((w,p)=>{let e,r,I,d;const q=w.window;for(;;){if(w.lookahead<=v){if(Z(w),w.lookahead<=v&&p===k)return 1;if(0===w.lookahead)break}if(w.match_length=0,w.lookahead>=3&&w.strstart>0&&(I=w.strstart-1,r=q[I],r===q[++I]&&r===q[++I]&&r===q[++I])){d=w.strstart+v;do{}while(r===q[++I]&&r===q[++I]&&r===q[++I]&&r===q[++I]&&r===q[++I]&&r===q[++I]&&r===q[++I]&&r===q[++I]&&I<d);w.match_length=v-(d-I),w.match_length>w.lookahead&&(w.match_length=w.lookahead)}if(w.match_length>=3?(e=f(w,1,w.match_length-3),w.lookahead-=w.match_length,w.strstart+=w.match_length,w.match_length=0):(e=f(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++),e&&(F(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,p===K?(F(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(F(w,!1),0===w.strm.avail_out)?1:2})(d,p):C[d.level].func(d,p);if(3!==e&&4!==e||(d.status=h),1===e||3===e)return 0===w.avail_out&&(d.last_flush=-1),c;if(2===e&&(p===m?q(d):p!==y&&(I(d,0,0,!1),p===J&&(Y(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),W(w),0===w.avail_out))return d.last_flush=-1,c}return p!==K?c:d.wrap<=0?s:(2===d.wrap?(H(d,255&w.adler),H(d,w.adler>>8&255),H(d,w.adler>>16&255),H(d,w.adler>>24&255),H(d,255&w.total_in),H(d,w.total_in>>8&255),H(d,w.total_in>>16&255),H(d,w.total_in>>24&255)):(B(d,w.adler>>>16),B(d,65535&w.adler)),W(w),d.wrap>0&&(d.wrap=-d.wrap),0!==d.pending?c:s)},w.exports.deflateEnd=w=>{if(!w||!w.state)return O;const p=w.state.status;return 42!==p&&69!==p&&73!==p&&91!==p&&p!==V&&p!==b&&p!==h?P(w,O):(w.state=null,p===b?P(w,a):c)},w.exports.deflateSetDictionary=(w,p)=>{let e=p.length;if(!w||!w.state)return O;const r=w.state,I=r.wrap;if(2===I||1===I&&42!==r.status||r.lookahead)return O;if(1===I&&(w.adler=E(w.adler,p,e,0)),r.wrap=0,e>=r.w_size){0===I&&(Y(r.head),r.strstart=0,r.block_start=0,r.insert=0);let w=new Uint8Array(r.w_size);w.set(p.subarray(e-r.w_size,e),0),p=w,e=r.w_size}const d=w.avail_in,f=w.next_in,q=w.input;for(w.avail_in=e,w.next_in=0,w.input=p,Z(r);r.lookahead>=3;){let w=r.strstart,p=r.lookahead-2;do{r.ins_h=L(r,r.ins_h,r.window[w+3-1]),r.prev[w&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=w,w++}while(--p);r.strstart=w,r.lookahead=2,Z(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,w.next_in=f,w.input=q,w.avail_in=d,r.wrap=I,c},w.exports.deflateInfo="pako deflate (from Nodeca project)"},12332:w=>{"use strict";w.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12326:w=>{"use strict";w.exports=function(w,p){let e,r,I,d,f,q,E,j,X,k,m,J,K,y,c,s,O,a,A,z,M,i,t,n;const l=w.state;e=w.next_in,t=w.input,r=e+(w.avail_in-5),I=w.next_out,n=w.output,d=I-(p-w.avail_out),f=I+(w.avail_out-257),q=l.dmax,E=l.wsize,j=l.whave,X=l.wnext,k=l.window,m=l.hold,J=l.bits,K=l.lencode,y=l.distcode,c=(1<<l.lenbits)-1,s=(1<<l.distbits)-1;w:do{J<15&&(m+=t[e++]<<J,J+=8,m+=t[e++]<<J,J+=8),O=K[m&c];p:for(;;){if(a=O>>>24,m>>>=a,J-=a,a=O>>>16&255,0===a)n[I++]=65535&O;else{if(!(16&a)){if(0===(64&a)){O=K[(65535&O)+(m&(1<<a)-1)];continue p}if(32&a){l.mode=12;break w}w.jp="invalid literal/length code",l.mode=30;break w}A=65535&O,a&=15,a&&(J<a&&(m+=t[e++]<<J,J+=8),A+=m&(1<<a)-1,m>>>=a,J-=a),J<15&&(m+=t[e++]<<J,J+=8,m+=t[e++]<<J,J+=8),O=y[m&s];e:for(;;){if(a=O>>>24,m>>>=a,J-=a,a=O>>>16&255,!(16&a)){if(0===(64&a)){O=y[(65535&O)+(m&(1<<a)-1)];continue e}w.jp="invalid distance code",l.mode=30;break w}if(z=65535&O,a&=15,J<a&&(m+=t[e++]<<J,J+=8,J<a&&(m+=t[e++]<<J,J+=8)),z+=m&(1<<a)-1,z>q){w.jp="invalid distance too far back",l.mode=30;break w}if(m>>>=a,J-=a,a=I-d,z>a){if(a=z-a,a>j&&l.sane){w.jp="invalid distance too far back",l.mode=30;break w}if(M=0,i=k,0===X){if(M+=E-a,a<A){A-=a;do{n[I++]=k[M++]}while(--a);M=I-z,i=n}}else if(X<a){if(M+=E+X-a,a-=X,a<A){A-=a;do{n[I++]=k[M++]}while(--a);if(M=0,X<A){a=X,A-=a;do{n[I++]=k[M++]}while(--a);M=I-z,i=n}}}else if(M+=X-a,a<A){A-=a;do{n[I++]=k[M++]}while(--a);M=I-z,i=n}for(;A>2;)n[I++]=i[M++],n[I++]=i[M++],n[I++]=i[M++],A-=3;A&&(n[I++]=i[M++],A>1&&(n[I++]=i[M++]))}else{M=I-z;do{n[I++]=n[M++],n[I++]=n[M++],n[I++]=n[M++],A-=3}while(A>2);A&&(n[I++]=n[M++],A>1&&(n[I++]=n[M++]))}break}}break}}while(e<r&&I<f);A=J>>3,e-=A,J-=A<<3,m&=(1<<J)-1,w.next_in=e,w.next_out=I,w.avail_in=e<r?r-e+5:5-(e-r),w.avail_out=I<f?f-I+257:257-(I-f),l.hold=m,l.bits=J}},12323:(w,p,e)=>{"use strict";const r=e(12278),I=e(12284),d=e(12326),f=e(12329),{Z_FINISH:q,Z_BLOCK:E,Z_TREES:j,Z_OK:X,Z_STREAM_END:k,Z_NEED_DICT:m,Z_STREAM_ERROR:J,Z_DATA_ERROR:K,Z_MEM_ERROR:y,Z_BUF_ERROR:c,Z_DEFLATED:s}=e(12299),O=12,a=30,A=w=>(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24);function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const M=w=>{if(!w||!w.state)return J;const p=w.state;return w.total_in=w.total_out=p.total=0,w.jp="",p.wrap&&(w.adler=1&p.wrap),p.mode=1,p.last=0,p.havedict=0,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(852),p.distcode=p.distdyn=new Int32Array(592),p.sane=1,p.back=-1,X},i=w=>{if(!w||!w.state)return J;const p=w.state;return p.wsize=0,p.whave=0,p.wnext=0,M(w)},t=(w,p)=>{let e;if(!w||!w.state)return J;const r=w.state;return p<0?(e=0,p=-p):(e=1+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?J:(null!==r.window&&r.wbits!==p&&(r.window=null),r.wrap=e,r.wbits=p,i(w))},n=(w,p)=>{if(!w)return J;const e=new z;w.state=e,e.window=null;const r=t(w,p);return r!==X&&(w.state=null),r};let l,N,U=!0;const v=w=>{if(U){l=new Int32Array(512),N=new Int32Array(32);let p=0;for(;p<144;)w.lens[p++]=8;for(;p<256;)w.lens[p++]=9;for(;p<280;)w.lens[p++]=7;for(;p<288;)w.lens[p++]=8;for(f(1,w.lens,0,288,l,0,w.work,{bits:9}),p=0;p<32;)w.lens[p++]=5;f(2,w.lens,0,32,N,0,w.work,{bits:5}),U=!1}w.lencode=l,w.lenbits=9,w.distcode=N,w.distbits=5},R=(w,p,e,r)=>{let I;const d=w.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),r>=d.wsize?(d.window.set(p.subarray(e-d.wsize,e),0),d.wnext=0,d.whave=d.wsize):(I=d.wsize-d.wnext,I>r&&(I=r),d.window.set(p.subarray(e-r,e-r+I),d.wnext),(r-=I)?(d.window.set(p.subarray(e-r,e),0),d.wnext=r,d.whave=d.wsize):(d.wnext+=I,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=I))),0};w.exports.inflateReset=i,w.exports.inflateReset2=t,w.exports.inflateResetKeep=M,w.exports.inflateInit=w=>n(w,15),w.exports.inflateInit2=n,w.exports.inflate=(w,p)=>{let e,z,M,i,t,n,l,N,U,V,b,h,P,u,Y,L,W,F,H,B,D,T,Z=0;const G=new Uint8Array(4);let g,o;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!w||!w.state||!w.output||!w.input&&0!==w.avail_in)return J;e=w.state,e.mode===O&&(e.mode=13),t=w.next_out,M=w.output,l=w.avail_out,i=w.next_in,z=w.input,n=w.avail_in,N=e.hold,U=e.bits,V=n,b=l,T=X;w:for(;;)switch(e.mode){case 1:if(0===e.wrap){e.mode=13;break}for(;U<16;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(2&e.wrap&&35615===N){e.check=0,G[0]=255&N,G[1]=N>>>8&255,e.check=I(e.check,G,2,0),N=0,U=0,e.mode=2;break}if(e.flags=0,e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&N)<<8)+(N>>8))%31){w.jp="incorrect header check",e.mode=a;break}if((15&N)!==s){w.jp="unknown compression method",e.mode=a;break}if(N>>>=4,U-=4,D=8+(15&N),0===e.wbits)e.wbits=D;else if(D>e.wbits){w.jp="invalid window size",e.mode=a;break}e.dmax=1<<e.wbits,w.adler=e.check=1,e.mode=512&N?10:O,N=0,U=0;break;case 2:for(;U<16;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(e.flags=N,(255&e.flags)!==s){w.jp="unknown compression method",e.mode=a;break}if(57344&e.flags){w.jp="unknown header flags set",e.mode=a;break}e.head&&(e.head.text=N>>8&1),512&e.flags&&(G[0]=255&N,G[1]=N>>>8&255,e.check=I(e.check,G,2,0)),N=0,U=0,e.mode=3;case 3:for(;U<32;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.head&&(e.head.time=N),512&e.flags&&(G[0]=255&N,G[1]=N>>>8&255,G[2]=N>>>16&255,G[3]=N>>>24&255,e.check=I(e.check,G,4,0)),N=0,U=0,e.mode=4;case 4:for(;U<16;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.head&&(e.head.xflags=255&N,e.head.os=N>>8),512&e.flags&&(G[0]=255&N,G[1]=N>>>8&255,e.check=I(e.check,G,2,0)),N=0,U=0,e.mode=5;case 5:if(1024&e.flags){for(;U<16;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.length=N,e.head&&(e.head.extra_len=N),512&e.flags&&(G[0]=255&N,G[1]=N>>>8&255,e.check=I(e.check,G,2,0)),N=0,U=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(1024&e.flags&&(h=e.length,h>n&&(h=n),h&&(e.head&&(D=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(z.subarray(i,i+h),D)),512&e.flags&&(e.check=I(e.check,z,h,i)),n-=h,i+=h,e.length-=h),e.length))break w;e.length=0,e.mode=7;case 7:if(2048&e.flags){if(0===n)break w;h=0;do{D=z[i+h++],e.head&&D&&e.length<65536&&(e.head.name+=String.fromCharCode(D))}while(D&&h<n);if(512&e.flags&&(e.check=I(e.check,z,h,i)),n-=h,i+=h,D)break w}else e.head&&(e.head.name=null);e.length=0,e.mode=8;case 8:if(4096&e.flags){if(0===n)break w;h=0;do{D=z[i+h++],e.head&&D&&e.length<65536&&(e.head.comment+=String.fromCharCode(D))}while(D&&h<n);if(512&e.flags&&(e.check=I(e.check,z,h,i)),n-=h,i+=h,D)break w}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(512&e.flags){for(;U<16;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(N!==(65535&e.check)){w.jp="header crc mismatch",e.mode=a;break}N=0,U=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),w.adler=e.check=0,e.mode=O;break;case 10:for(;U<32;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}w.adler=e.check=A(N),N=0,U=0,e.mode=11;case 11:if(0===e.havedict)return w.next_out=t,w.avail_out=l,w.next_in=i,w.avail_in=n,e.hold=N,e.bits=U,m;w.adler=e.check=1,e.mode=O;case O:if(p===E||p===j)break w;case 13:if(e.last){N>>>=7&U,U-=7&U,e.mode=27;break}for(;U<3;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}switch(e.last=1&N,N>>>=1,U-=1,3&N){case 0:e.mode=14;break;case 1:if(v(e),e.mode=20,p===j){N>>>=2,U-=2;break w}break;case 2:e.mode=17;break;case 3:w.jp="invalid block type",e.mode=a}N>>>=2,U-=2;break;case 14:for(N>>>=7&U,U-=7&U;U<32;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if((65535&N)!==(N>>>16^65535)){w.jp="invalid stored block lengths",e.mode=a;break}if(e.length=65535&N,N=0,U=0,e.mode=15,p===j)break w;case 15:e.mode=16;case 16:if(h=e.length,h){if(h>n&&(h=n),h>l&&(h=l),0===h)break w;M.set(z.subarray(i,i+h),t),n-=h,i+=h,l-=h,t+=h,e.length-=h;break}e.mode=O;break;case 17:for(;U<14;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(e.nlen=257+(31&N),N>>>=5,U-=5,e.ndist=1+(31&N),N>>>=5,U-=5,e.ncode=4+(15&N),N>>>=4,U-=4,e.nlen>286||e.ndist>30){w.jp="too many length or distance symbols",e.mode=a;break}e.have=0,e.mode=18;case 18:for(;e.have<e.ncode;){for(;U<3;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.lens[C[e.have++]]=7&N,N>>>=3,U-=3}for(;e.have<19;)e.lens[C[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,g={bits:e.lenbits},T=f(0,e.lens,0,19,e.lencode,0,e.work,g),e.lenbits=g.bits,T){w.jp="invalid code lengths set",e.mode=a;break}e.have=0,e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;Z=e.lencode[N&(1<<e.lenbits)-1],Y=Z>>>24,L=Z>>>16&255,W=65535&Z,!(Y<=U);){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(W<16)N>>>=Y,U-=Y,e.lens[e.have++]=W;else{if(16===W){for(o=Y+2;U<o;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(N>>>=Y,U-=Y,0===e.have){w.jp="invalid bit length repeat",e.mode=a;break}D=e.lens[e.have-1],h=3+(3&N),N>>>=2,U-=2}else if(17===W){for(o=Y+3;U<o;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}N>>>=Y,U-=Y,D=0,h=3+(7&N),N>>>=3,U-=3}else{for(o=Y+7;U<o;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}N>>>=Y,U-=Y,D=0,h=11+(127&N),N>>>=7,U-=7}if(e.have+h>e.nlen+e.ndist){w.jp="invalid bit length repeat",e.mode=a;break}for(;h--;)e.lens[e.have++]=D}}if(e.mode===a)break;if(0===e.lens[256]){w.jp="invalid code -- missing end-of-block",e.mode=a;break}if(e.lenbits=9,g={bits:e.lenbits},T=f(1,e.lens,0,e.nlen,e.lencode,0,e.work,g),e.lenbits=g.bits,T){w.jp="invalid literal/lengths set",e.mode=a;break}if(e.distbits=6,e.distcode=e.distdyn,g={bits:e.distbits},T=f(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,g),e.distbits=g.bits,T){w.jp="invalid distances set",e.mode=a;break}if(e.mode=20,p===j)break w;case 20:e.mode=21;case 21:if(n>=6&&l>=258){w.next_out=t,w.avail_out=l,w.next_in=i,w.avail_in=n,e.hold=N,e.bits=U,d(w,b),t=w.next_out,M=w.output,l=w.avail_out,i=w.next_in,z=w.input,n=w.avail_in,N=e.hold,U=e.bits,e.mode===O&&(e.back=-1);break}for(e.back=0;Z=e.lencode[N&(1<<e.lenbits)-1],Y=Z>>>24,L=Z>>>16&255,W=65535&Z,!(Y<=U);){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(L&&0===(240&L)){for(F=Y,H=L,B=W;Z=e.lencode[B+((N&(1<<F+H)-1)>>F)],Y=Z>>>24,L=Z>>>16&255,W=65535&Z,!(F+Y<=U);){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}N>>>=F,U-=F,e.back+=F}if(N>>>=Y,U-=Y,e.back+=Y,e.length=W,0===L){e.mode=26;break}if(32&L){e.back=-1,e.mode=O;break}if(64&L){w.jp="invalid literal/length code",e.mode=a;break}e.extra=15&L,e.mode=22;case 22:if(e.extra){for(o=e.extra;U<o;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.length+=N&(1<<e.extra)-1,N>>>=e.extra,U-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=23;case 23:for(;Z=e.distcode[N&(1<<e.distbits)-1],Y=Z>>>24,L=Z>>>16&255,W=65535&Z,!(Y<=U);){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(0===(240&L)){for(F=Y,H=L,B=W;Z=e.distcode[B+((N&(1<<F+H)-1)>>F)],Y=Z>>>24,L=Z>>>16&255,W=65535&Z,!(F+Y<=U);){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}N>>>=F,U-=F,e.back+=F}if(N>>>=Y,U-=Y,e.back+=Y,64&L){w.jp="invalid distance code",e.mode=a;break}e.offset=W,e.extra=15&L,e.mode=24;case 24:if(e.extra){for(o=e.extra;U<o;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}e.offset+=N&(1<<e.extra)-1,N>>>=e.extra,U-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){w.jp="invalid distance too far back",e.mode=a;break}e.mode=25;case 25:if(0===l)break w;if(h=b-l,e.offset>h){if(h=e.offset-h,h>e.whave&&e.sane){w.jp="invalid distance too far back",e.mode=a;break}h>e.wnext?(h-=e.wnext,P=e.wsize-h):P=e.wnext-h,h>e.length&&(h=e.length),u=e.window}else u=M,P=t-e.offset,h=e.length;h>l&&(h=l),l-=h,e.length-=h;do{M[t++]=u[P++]}while(--h);0===e.length&&(e.mode=21);break;case 26:if(0===l)break w;M[t++]=e.length,l--,e.mode=21;break;case 27:if(e.wrap){for(;U<32;){if(0===n)break w;n--,N|=z[i++]<<U,U+=8}if(b-=l,w.total_out+=b,e.total+=b,b&&(w.adler=e.check=e.flags?I(e.check,M,b,t-b):r(e.check,M,b,t-b)),b=l,(e.flags?N:A(N))!==e.check){w.jp="incorrect data check",e.mode=a;break}N=0,U=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;U<32;){if(0===n)break w;n--,N+=z[i++]<<U,U+=8}if(N!==(4294967295&e.total)){w.jp="incorrect length check",e.mode=a;break}N=0,U=0}e.mode=29;case 29:T=k;break w;case a:T=K;break w;case 31:return y;default:return J}return w.next_out=t,w.avail_out=l,w.next_in=i,w.avail_in=n,e.hold=N,e.bits=U,(e.wsize||b!==w.avail_out&&e.mode<a&&(e.mode<27||p!==q))&&R(w,w.output,w.next_out,b-w.avail_out)?(e.mode=31,y):(V-=w.avail_in,b-=w.avail_out,w.total_in+=V,w.total_out+=b,e.total+=b,e.wrap&&b&&(w.adler=e.check=e.flags?I(e.check,M,b,w.next_out-b):r(e.check,M,b,w.next_out-b)),w.data_type=e.bits+(e.last?64:0)+(e.mode===O?128:0)+(20===e.mode||15===e.mode?256:0),(0===V&&0===b||p===q)&&T===X&&(T=c),T)},w.exports.inflateEnd=w=>{if(!w||!w.state)return J;let p=w.state;return p.window&&(p.window=null),w.state=null,X},w.exports.inflateGetHeader=(w,p)=>{if(!w||!w.state)return J;const e=w.state;return 0===(2&e.wrap)?J:(e.head=p,p.done=!1,X)},w.exports.inflateSetDictionary=(w,p)=>{const e=p.length;let I,d,f;return w&&w.state?(I=w.state,0!==I.wrap&&11!==I.mode?J:11===I.mode&&(d=1,d=r(d,p,e,0),d!==I.check)?K:(f=R(w,p,e,e),f?(I.mode=31,y):(I.havedict=1,X))):J},w.exports.inflateInfo="pako inflate (from Nodeca project)"},12329:w=>{"use strict";const p=15,e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),I=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);w.exports=(w,f,q,E,j,X,k,m)=>{const J=m.bits;let K,y,c,s,O,a,A=0,z=0,M=0,i=0,t=0,n=0,l=0,N=0,U=0,v=0,R=null,V=0;const b=new Uint16Array(16),h=new Uint16Array(16);let P,u,Y,L=null,W=0;for(A=0;A<=p;A++)b[A]=0;for(z=0;z<E;z++)b[f[q+z]]++;for(t=J,i=p;i>=1&&0===b[i];i--);if(t>i&&(t=i),0===i)return j[X++]=20971520,j[X++]=20971520,m.bits=1,0;for(M=1;M<i&&0===b[M];M++);for(t<M&&(t=M),N=1,A=1;A<=p;A++)if(N<<=1,N-=b[A],N<0)return-1;if(N>0&&(0===w||1!==i))return-1;for(h[1]=0,A=1;A<p;A++)h[A+1]=h[A]+b[A];for(z=0;z<E;z++)0!==f[q+z]&&(k[h[f[q+z]]++]=z);if(0===w?(R=L=k,a=19):1===w?(R=e,V-=257,L=r,W-=257,a=256):(R=I,L=d,a=-1),v=0,z=0,A=M,O=X,n=t,l=0,c=-1,U=1<<t,s=U-1,1===w&&U>852||2===w&&U>592)return 1;for(;;){P=A-l,k[z]<a?(u=0,Y=k[z]):k[z]>a?(u=L[W+k[z]],Y=R[V+k[z]]):(u=96,Y=0),K=1<<A-l,y=1<<n,M=y;do{y-=K,j[O+(v>>l)+y]=P<<24|u<<16|Y}while(0!==y);for(K=1<<A-1;v&K;)K>>=1;if(0!==K?(v&=K-1,v+=K):v=0,z++,0===--b[A]){if(A===i)break;A=f[q+k[z]]}if(A>t&&(v&s)!==c){for(0===l&&(l=t),O+=M,n=A-l,N=1<<n;n+l<i&&(N-=b[n+l],!(N<=0));)n++,N<<=1;if(U+=1<<n,1===w&&U>852||2===w&&U>592)return 1;c=v&s,j[c]=t<<24|n<<16|O-X}}return 0!==v&&(j[O+v]=A-l<<24|64<<16),m.bits=t,0}},12291:w=>{"use strict";w.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12275:w=>{"use strict";function p(w){let p=w.length;for(;--p>=0;)w[p]=0}const e=256,r=286,I=30,d=15,f=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),E=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X=new Array(576);p(X);const k=new Array(60);p(k);const m=new Array(512);p(m);const J=new Array(256);p(J);const K=new Array(29);p(K);const y=new Array(I);function c(w,p,e,r,I){this.static_tree=w,this.extra_bits=p,this.extra_base=e,this.elems=r,this.max_length=I,this.has_stree=w&&w.length}let s,O,a;function A(w,p){this.dyn_tree=w,this.max_code=0,this.stat_desc=p}p(y);const z=w=>w<256?m[w]:m[256+(w>>>7)],M=(w,p)=>{w.pending_buf[w.pending++]=255&p,w.pending_buf[w.pending++]=p>>>8&255},i=(w,p,e)=>{w.bi_valid>16-e?(w.bi_buf|=p<<w.bi_valid&65535,M(w,w.bi_buf),w.bi_buf=p>>16-w.bi_valid,w.bi_valid+=e-16):(w.bi_buf|=p<<w.bi_valid&65535,w.bi_valid+=e)},t=(w,p,e)=>{i(w,e[2*p],e[2*p+1])},n=(w,p)=>{let e=0;do{e|=1&w,w>>>=1,e<<=1}while(--p>0);return e>>>1},l=(w,p,e)=>{const r=new Array(16);let I,f,q=0;for(I=1;I<=d;I++)r[I]=q=q+e[I-1]<<1;for(f=0;f<=p;f++){let p=w[2*f+1];0!==p&&(w[2*f]=n(r[p]++,p))}},N=w=>{let p;for(p=0;p<r;p++)w.dyn_ltree[2*p]=0;for(p=0;p<I;p++)w.dyn_dtree[2*p]=0;for(p=0;p<19;p++)w.bl_tree[2*p]=0;w.dyn_ltree[512]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0},U=w=>{w.bi_valid>8?M(w,w.bi_buf):w.bi_valid>0&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0},v=(w,p,e,r)=>{const I=2*p,d=2*e;return w[I]<w[d]||w[I]===w[d]&&r[p]<=r[e]},R=(w,p,e)=>{const r=w.heap[e];let I=e<<1;for(;I<=w.heap_len&&(I<w.heap_len&&v(p,w.heap[I+1],w.heap[I],w.depth)&&I++,!v(p,r,w.heap[I],w.depth));)w.heap[e]=w.heap[I],e=I,I<<=1;w.heap[e]=r},V=(w,p,r)=>{let I,d,E,j,X=0;if(0!==w.last_lit)do{I=w.pending_buf[w.d_buf+2*X]<<8|w.pending_buf[w.d_buf+2*X+1],d=w.pending_buf[w.l_buf+X],X++,0===I?t(w,d,p):(E=J[d],t(w,E+e+1,p),j=f[E],0!==j&&(d-=K[E],i(w,d,j)),I--,E=z(I),t(w,E,r),j=q[E],0!==j&&(I-=y[E],i(w,I,j)))}while(X<w.last_lit);t(w,256,p)},b=(w,p)=>{const e=p.dyn_tree,r=p.stat_desc.static_tree,I=p.stat_desc.has_stree,f=p.stat_desc.elems;let q,E,j,X=-1;for(w.heap_len=0,w.heap_max=573,q=0;q<f;q++)0!==e[2*q]?(w.heap[++w.heap_len]=X=q,w.depth[q]=0):e[2*q+1]=0;for(;w.heap_len<2;)j=w.heap[++w.heap_len]=X<2?++X:0,e[2*j]=1,w.depth[j]=0,w.opt_len--,I&&(w.static_len-=r[2*j+1]);for(p.max_code=X,q=w.heap_len>>1;q>=1;q--)R(w,e,q);j=f;do{q=w.heap[1],w.heap[1]=w.heap[w.heap_len--],R(w,e,1),E=w.heap[1],w.heap[--w.heap_max]=q,w.heap[--w.heap_max]=E,e[2*j]=e[2*q]+e[2*E],w.depth[j]=(w.depth[q]>=w.depth[E]?w.depth[q]:w.depth[E])+1,e[2*q+1]=e[2*E+1]=j,w.heap[1]=j++,R(w,e,1)}while(w.heap_len>=2);w.heap[--w.heap_max]=w.heap[1],((w,p)=>{const e=p.dyn_tree,r=p.max_code,I=p.stat_desc.static_tree,f=p.stat_desc.has_stree,q=p.stat_desc.extra_bits,E=p.stat_desc.extra_base,j=p.stat_desc.max_length;let X,k,m,J,K,y,c=0;for(J=0;J<=d;J++)w.bl_count[J]=0;for(e[2*w.heap[w.heap_max]+1]=0,X=w.heap_max+1;X<573;X++)k=w.heap[X],J=e[2*e[2*k+1]+1]+1,J>j&&(J=j,c++),e[2*k+1]=J,k>r||(w.bl_count[J]++,K=0,k>=E&&(K=q[k-E]),y=e[2*k],w.opt_len+=y*(J+K),f&&(w.static_len+=y*(I[2*k+1]+K)));if(0!==c){do{for(J=j-1;0===w.bl_count[J];)J--;w.bl_count[J]--,w.bl_count[J+1]+=2,w.bl_count[j]--,c-=2}while(c>0);for(J=j;0!==J;J--)for(k=w.bl_count[J];0!==k;)m=w.heap[--X],m>r||(e[2*m+1]!==J&&(w.opt_len+=(J-e[2*m+1])*e[2*m],e[2*m+1]=J),k--)}})(w,p),l(e,X,w.bl_count)},h=(w,p,e)=>{let r,I,d=-1,f=p[1],q=0,E=7,j=4;for(0===f&&(E=138,j=3),p[2*(e+1)+1]=65535,r=0;r<=e;r++)I=f,f=p[2*(r+1)+1],++q<E&&I===f||(q<j?w.bl_tree[2*I]+=q:0!==I?(I!==d&&w.bl_tree[2*I]++,w.bl_tree[32]++):q<=10?w.bl_tree[34]++:w.bl_tree[36]++,q=0,d=I,0===f?(E=138,j=3):I===f?(E=6,j=3):(E=7,j=4))},P=(w,p,e)=>{let r,I,d=-1,f=p[1],q=0,E=7,j=4;for(0===f&&(E=138,j=3),r=0;r<=e;r++)if(I=f,f=p[2*(r+1)+1],!(++q<E&&I===f)){if(q<j)do{t(w,I,w.bl_tree)}while(0!==--q);else 0!==I?(I!==d&&(t(w,I,w.bl_tree),q--),t(w,16,w.bl_tree),i(w,q-3,2)):q<=10?(t(w,17,w.bl_tree),i(w,q-3,3)):(t(w,18,w.bl_tree),i(w,q-11,7));q=0,d=I,0===f?(E=138,j=3):I===f?(E=6,j=3):(E=7,j=4)}};let u=!1;const Y=(w,p,e,r)=>{i(w,0+(r?1:0),3),((w,p,e,r)=>{U(w),r&&(M(w,e),M(w,~e)),w.pending_buf.set(w.window.subarray(p,p+e),w.pending),w.pending+=e})(w,p,e,!0)};w.exports._tr_init=w=>{u||((()=>{let w,p,e,j,A;const z=new Array(16);for(e=0,j=0;j<28;j++)for(K[j]=e,w=0;w<1<<f[j];w++)J[e++]=j;for(J[e-1]=j,A=0,j=0;j<16;j++)for(y[j]=A,w=0;w<1<<q[j];w++)m[A++]=j;for(A>>=7;j<I;j++)for(y[j]=A<<7,w=0;w<1<<q[j]-7;w++)m[256+A++]=j;for(p=0;p<=d;p++)z[p]=0;for(w=0;w<=143;)X[2*w+1]=8,w++,z[8]++;for(;w<=255;)X[2*w+1]=9,w++,z[9]++;for(;w<=279;)X[2*w+1]=7,w++,z[7]++;for(;w<=287;)X[2*w+1]=8,w++,z[8]++;for(l(X,287,z),w=0;w<I;w++)k[2*w+1]=5,k[2*w]=n(w,5);s=new c(X,f,257,r,d),O=new c(k,q,0,I,d),a=new c(new Array(0),E,0,19,7)})(),u=!0),w.l_desc=new A(w.dyn_ltree,s),w.d_desc=new A(w.dyn_dtree,O),w.bl_desc=new A(w.bl_tree,a),w.bi_buf=0,w.bi_valid=0,N(w)},w.exports._tr_stored_block=Y,w.exports._tr_flush_block=(w,p,r,I)=>{let d,f,q=0;w.level>0?(2===w.strm.data_type&&(w.strm.data_type=(w=>{let p,r=4093624447;for(p=0;p<=31;p++,r>>>=1)if(1&r&&0!==w.dyn_ltree[2*p])return 0;if(0!==w.dyn_ltree[18]||0!==w.dyn_ltree[20]||0!==w.dyn_ltree[26])return 1;for(p=32;p<e;p++)if(0!==w.dyn_ltree[2*p])return 1;return 0})(w)),b(w,w.l_desc),b(w,w.d_desc),q=(w=>{let p;for(h(w,w.dyn_ltree,w.l_desc.max_code),h(w,w.dyn_dtree,w.d_desc.max_code),b(w,w.bl_desc),p=18;p>=3&&0===w.bl_tree[2*j[p]+1];p--);return w.opt_len+=3*(p+1)+5+5+4,p})(w),d=w.opt_len+3+7>>>3,f=w.static_len+3+7>>>3,f<=d&&(d=f)):d=f=r+5,r+4<=d&&-1!==p?Y(w,p,r,I):4===w.strategy||f===d?(i(w,2+(I?1:0),3),V(w,X,k)):(i(w,4+(I?1:0),3),((w,p,e,r)=>{let I;for(i(w,p-257,5),i(w,e-1,5),i(w,r-4,4),I=0;I<r;I++)i(w,w.bl_tree[2*j[I]+1],3);P(w,w.dyn_ltree,p-1),P(w,w.dyn_dtree,e-1)})(w,w.l_desc.max_code+1,w.d_desc.max_code+1,q+1),V(w,w.dyn_ltree,w.dyn_dtree)),N(w),I&&U(w)},w.exports._tr_tally=(w,p,r)=>(w.pending_buf[w.d_buf+2*w.last_lit]=p>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&p,w.pending_buf[w.l_buf+w.last_lit]=255&r,w.last_lit++,0===p?w.dyn_ltree[2*r]++:(w.matches++,p--,w.dyn_ltree[2*(J[r]+e+1)]++,w.dyn_dtree[2*z(p)]++),w.last_lit===w.lit_bufsize-1),w.exports._tr_align=w=>{i(w,2,3),t(w,256,X),(w=>{16===w.bi_valid?(M(w,w.bi_buf),w.bi_buf=0,w.bi_valid=0):w.bi_valid>=8&&(w.pending_buf[w.pending++]=255&w.bi_buf,w.bi_buf>>=8,w.bi_valid-=8)})(w)}},12311:w=>{"use strict";w.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.jp="",this.state=null,this.data_type=2,this.adler=0}},11960:w=>{function p(w,p,e){for(var r=w.length,I=-1/0,d=1/0,f=0;f<r;f++){var q=(e[0][f]-w[f])/p[f],E=(e[1][f]-w[f])/p[f];if(q>E){var j=q;q=E,E=j}if(E<I||q>d)return 1/0;q>I&&(I=q),E<d&&(d=E)}return I>d?1/0:I}w.exports=function(w,e,r,I){var d=p(e,r,I);if(d===1/0)w=null;else{w=w||[];for(var f=0;f<e.length;f++)w[f]=e[f]+r[f]*d}return w},w.exports.distance=p},13367:(w,p,e)=>{"use strict";e.d(p,{c:()=>f});var r=e(29);const I=r.useLayoutEffect;const d=function(w){var p=(0,r.useRef)(w);return I((function(){p.current=w})),p};var f=function(w){var p=d(w);(0,r.fp)((function(){var w=function(w){var e;if(null!=p.current&&(e=p.current(w)),w.defaultPrevented&&(w.returnValue=""),"string"===typeof e)return w.returnValue=e,e};return window.addEventListener("beforeunload",w),function(){window.removeEventListener("beforeunload",w)}}),[])}},13317:(w,p,e)=>{"use strict";var r=e(13321),I=Array.prototype.concat,d=Array.prototype.slice,f=w.exports=function(w){for(var p=[],e=0,f=w.length;e<f;e++){var q=w[e];r(q)?p=I.call(p,d.call(q)):p.push(q)}return p};f.wrap=function(w){return function(){return w(f(arguments))}}},13321:w=>{w.exports=function(w){return!(!w||"string"===typeof w)&&(w instanceof Array||Array.isArray(w)||w.length>=0&&(w.splice instanceof Function||Object.getOwnPropertyDescriptor(w,w.length-1)&&"String"!==w.constructor.name))}},12211:(w,p,e)=>{var r=e(12214);function I(w){for(var p,e,I=0,d=w.length,f=0;f<w.length;){for(p=w[f],e=0;f<d&&w[f]===p;)++f,++e;I+=r.log2(e)/7|0,I+=r.log2(p>>>0)/7|0,I+=2}return I}p.size=I,p.encode=function(w,p){p||(p=new Uint8Array(I(w)));for(var e,r,d=0,f=p.length,q=0;q<w.length;){for(e=w[q],r=0;q<w.length&&w[q]===e;)++q,++r;for(;d<f&&r>=128;)p[d++]=128+(127&r),r>>>=7;if(d>=f)throw new Error("RLE buffer overflow");for(p[d++]=r,e>>>=0;d<f&&e>=128;)p[d++]=128+(127&e),e>>>=7;if(d>=f)throw new Error("RLE buffer overflow");p[d++]=e}return p},p.decode=function(w,p){for(var e,r,I,d,f=p.length,q=w.length,E=0,j=0;j<q;){for(e=0,r=0;j<q&&w[j]>=128;)e+=(127&w[j++])<<r,r+=7;if(e+=w[j++]<<r,j>=q)throw new Error("RLE buffer underrun");if(E+e>f)throw new Error("Chunk buffer overflow");for(I=0,r=0;j<q&&w[j]>=128;)I+=(127&w[j++])<<r,r+=7;if(j>=q)throw new Error("RLE buffer underrun");for(I+=w[j++]<<r,d=0;d<e;++d)p[E++]=I}return p}},12214:(w,p)=>{"use strict";function e(w){var p=32;return(w&=-w)&&p--,65535&w&&(p-=16),16711935&w&&(p-=8),252645135&w&&(p-=4),858993459&w&&(p-=2),1431655765&w&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(w){return(w>0)-(w<0)},p.abs=function(w){var p=w>>31;return(w^p)-p},p.min=function(w,p){return p^(w^p)&-(w<p)},p.max=function(w,p){return w^(w^p)&-(w<p)},p.isPow2=function(w){return!(w&w-1)&&!!w},p.log2=function(w){var p,e;return p=(w>65535)<<4,p|=e=((w>>>=p)>255)<<3,p|=e=((w>>>=e)>15)<<2,(p|=e=((w>>>=e)>3)<<1)|(w>>>=e)>>1},p.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},p.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},p.countTrailingZeros=e,p.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},p.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},p.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var r=new Array(256);!function(w){for(var p=0;p<256;++p){var e=p,r=p,I=7;for(e>>>=1;e;e>>>=1)r<<=1,r|=1&e,--I;w[p]=r<<I&255}}(r),p.reverse=function(w){return r[255&w]<<24|r[w>>>8&255]<<16|r[w>>>16&255]<<8|r[w>>>24&255]},p.interleave2=function(w,p){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(w,p){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>p&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},p.interleave3=function(w,p,e){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},p.deinterleave3=function(w,p){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>p&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},p.nextCombination=function(w){var p=w|w-1;return p+1|(~p&-~p)-1>>>e(w)+1}},12253:w=>{"use strict";w.exports=function(w,p,e,r){var I=self||window;try{try{var d;try{d=new I.Blob([w])}catch(j){(d=new(I.BlobBuilder||I.WebKitBlobBuilder||I.MozBlobBuilder||I.MSBlobBuilder)).append(w),d=d.getBlob()}var f=I.URL||I.webkitURL,q=f.createObjectURL(d),E=new I[p](q,e);return f.revokeObjectURL(q),E}catch(j){return new I[p]("data:application/javascript,".concat(encodeURIComponent(w)),e)}}catch(j){if(!r)throw Error("Inline worker is not supported");return new I[p](r,e)}}},11952:(w,p,e)=>{"use strict";function r(w,p,e,r,I){var d={};return Object.keys(r).forEach((function(w){d[w]=r[w]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=e.slice().reverse().reduce((function(e,r){return r(w,p,e)||e}),d),I&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(I):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(w,p,d),d=null),d}e.d(p,{d:()=>r})},11949:(w,p,e)=>{"use strict";function r(w,p,e,r){e&&Object.defineProperty(w,p,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(r):void 0})}e.d(p,{d:()=>r})},13355:(w,p,e)=>{"use strict";e.d(p,{d:()=>f,g:()=>k,j:()=>q,k:()=>d,n:()=>E,q:()=>I,r:()=>j,v:()=>X});var r=e(11482);class I{constructor(){this._easingMode=I.EASINGMODE_EASEIN}setEasingMode(w){const p=Math.min(Math.max(w,0),2);this._easingMode=p}getEasingMode(){return this._easingMode}easeInCore(w){throw new Error("You must implement this method")}ease(w){switch(this._easingMode){case I.EASINGMODE_EASEIN:return this.easeInCore(w);case I.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-w)}return w>=.5?.5*(1-this.easeInCore(2*(1-w)))+.5:.5*this.easeInCore(2*w)}}I.EASINGMODE_EASEIN=0,I.EASINGMODE_EASEOUT=1,I.EASINGMODE_EASEINOUT=2;class d extends I{easeInCore(w){return w=Math.max(0,Math.min(1,w)),1-Math.sqrt(1-w*w)}}class f extends I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=w}easeInCore(w){const p=Math.max(0,this.amplitude);return Math.pow(w,3)-w*p*Math.sin(3.141592653589793*w)}}class q extends I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=w,this.bounciness=p}easeInCore(w){const p=Math.max(0,this.bounces);let e=this.bounciness;e<=1&&(e=1.001);const r=Math.pow(e,p),I=1-e,d=(1-r)/I+.5*r,f=w*d,q=Math.log(-f*(1-e)+1)/Math.log(e),E=Math.floor(q),j=E+1,X=(1-Math.pow(e,E))/(I*d),k=.5*(X+(1-Math.pow(e,j))/(I*d)),m=w-k,J=k-X;return-Math.pow(1/e,p-E)/(J*J)*(m-J)*(m+J)}}class E extends I{easeInCore(w){return w*w*w}}class j extends I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=w,this.springiness=p}easeInCore(w){let p;const e=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return p=0==r?w:(Math.exp(r*w)-1)/(Math.exp(r)-1),p*Math.sin((6.283185307179586*e+1.5707963267948966)*w)}}class X extends I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=w}easeInCore(w){return this.exponent<=0?w:(Math.exp(this.exponent*w)-1)/(Math.exp(this.exponent)-1)}}class k extends I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=w,this.y1=p,this.x2=e,this.y2=r}easeInCore(w){return r.e.Interpolate(w,this.x1,this.y1,this.x2,this.y2)}}},12794:(w,p,e)=>{"use strict";e.d(p,{e:()=>f});var r=e(11023),I=e(11030),d=e(11331);class f extends d.b{get _matrix(){return this._compose(),this.om}set _matrix(w){(w.updateFlag!==this.om.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.om.X(w),this._markAsDirtyAndDecompose())}constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(w,p.iw(),!1),this.name=w,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=p,this.om=(null===I||void 0===I?void 0:I.clone())??r.b.Identity(),this._restMatrix=d??this.om.clone(),this._bindMatrix=f??this.om.clone(),this._index=q,this._absoluteMatrix=new r.b,this._absoluteBindMatrix=new r.b,this._absoluteInverseBindMatrix=new r.b,this._finalMatrix=new r.b,p.bones.push(this),this.setParent(e,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(w){this.setParent(w)}setParent(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==w){if(this.parent){const w=this.parent.children.indexOf(this);-1!==w&&this.parent.children.splice(w,1)}this._parentNode=w,this.parent&&this.parent.children.push(this),p&&this._updateAbsoluteBindMatrices(),this.kX()}}getLocalMatrix(){return this._compose(),this.om}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(w){this._restMatrix.X(w)}setRestPose(w){this.setRestMatrix(w)}getBindPose(){return this.getBindMatrix()}setBindMatrix(w){this.Ze(w)}setBindPose(w){this.setBindMatrix(w)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const w=r.d.ne[0],p=r.d.Quaternion[0],e=r.d.ne[1];this.getRestMatrix().decompose(w,p,e),this._linkedTransformNode.position.X(e),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??r.c.Identity(),this._linkedTransformNode.rotationQuaternion.X(p),this._linkedTransformNode.Ne.X(w)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(w){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=w,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.NE}set position(w){this._decompose(),this.NE.X(w),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(w){this.setRotation(w)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(w){this.setRotationQuaternion(w)}get Ne(){return this.getScale()}set Ne(w){this.setScale(w)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=r.k.Zero(),this._localRotation=r.c.Zero(),this.NE=r.k.Zero()),this.om.decompose(this._localScaling,this._localRotation,this.NE))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,r.b.ComposeToRef(this._localScaling,this._localRotation,this.NE,this.om)):this._needToCompose=!1)}Ze(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.X(w),p&&this._updateAbsoluteBindMatrices(),e?this._matrix=w:this.kX()}_updateAbsoluteBindMatrices(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(w||(w=this._bindMatrix),this.parent?w.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.X(w),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),p)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}kX(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.kX(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.kX(),this._needToDecompose=!0}_updatePosition(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this.getLocalMatrix();if(0==p)I?(d.addAtIndex(12,w.x),d.addAtIndex(13,w.y),d.addAtIndex(14,w.z)):d.setTranslationFromFloats(w.x,w.y,w.z);else{let p=null;e&&(p=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=f._TmpMats[0],E=f._TmpVecs[0];this.parent?e&&p?(q.X(this.parent.getAbsoluteMatrix()),q.multiplyToRef(p,q)):q.X(this.parent.getAbsoluteMatrix()):r.b.IdentityToRef(q),I&&q.setTranslationFromFloats(0,0,0),q.invert(),r.k.TransformCoordinatesToRef(w,q,E),I?(d.addAtIndex(12,E.x),d.addAtIndex(13,E.y),d.addAtIndex(14,E.z)):d.setTranslationFromFloats(E.x,E.y,E.z)}this._markAsDirtyAndDecompose()}translate(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,p,e,!0)}setPosition(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,p,e,!1)}setAbsolutePosition(w,p){this.setPosition(w,1,p)}scale(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getLocalMatrix(),q=f._TmpMats[0];r.b.ScalingToRef(w,p,e,q),q.multiplyToRef(d,d),q.invert();for(const r of this.children){const I=r.getLocalMatrix();I.multiplyToRef(q,I),I.multiplyAtIndex(12,w),I.multiplyAtIndex(13,p),I.multiplyAtIndex(14,e),r._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),I)for(const r of this.children)r.scale(w,p,e,I)}setScale(w){this._decompose(),this._localScaling.X(w),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(w){this._decompose(),w.X(this._localScaling)}setYawPitchRoll(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0;if(0===I){const q=f._TmpQuat;return r.c.RotationYawPitchRollToRef(w,p,e,q),void this.setRotationQuaternion(q,I,d)}const q=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,d))return;const E=f._TmpMats[1];r.b.RotationYawPitchRollToRef(w,p,e,E),q.multiplyToRef(E,E),this._rotateWithMatrix(E,I,d)}rotate(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;const d=f._TmpMats[0];d.setTranslationFromFloats(0,0,0),r.b.RotationAxisToRef(w,p,d),this._rotateWithMatrix(d,e,I)}setAxisAngle(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;if(0===e){const d=f._TmpQuat;return r.c.RotationAxisToRef(w,p,d),void this.setRotationQuaternion(d,e,I)}const d=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,I))return;const q=f._TmpMats[1];r.b.RotationAxisToRef(w,p,q),d.multiplyToRef(q,q),this._rotateWithMatrix(q,e,I)}setRotation(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(w.y,w.x,w.z,p,e)}setRotationQuaternion(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===p)return this._decompose(),this._localRotation.X(w),void this._markAsDirtyAndCompose();const I=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,e))return;const d=f._TmpMats[1];r.b.FromQuaternionToRef(w,d),I.multiplyToRef(d,d),this._rotateWithMatrix(d,p,e)}setRotationMatrix(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===p){const I=f._TmpQuat;return r.c.FromRotationMatrixToRef(w,I),void this.setRotationQuaternion(I,p,e)}const I=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,e))return;const d=f._TmpMats[1];d.X(w),I.multiplyToRef(w,d),this._rotateWithMatrix(d,p,e)}_rotateWithMatrix(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const r=this.getLocalMatrix(),I=r.m[12],d=r.m[13],q=r.m[14],E=this.getParent(),j=f._TmpMats[3],X=f._TmpMats[4];E&&1==p?(e?(j.X(e.getWorldMatrix()),E.getAbsoluteMatrix().multiplyToRef(j,j)):j.X(E.getAbsoluteMatrix()),X.X(j),X.invert(),r.multiplyToRef(j,r),r.multiplyToRef(w,r),r.multiplyToRef(X,r)):1==p&&e?(j.X(e.getWorldMatrix()),X.X(j),X.invert(),r.multiplyToRef(j,r),r.multiplyToRef(w,r),r.multiplyToRef(X,r)):r.multiplyToRef(w,r),r.setTranslationFromFloats(I,d,q),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(w,p){const e=f._TmpMats[2];return w.X(this.getAbsoluteMatrix()),p?(w.multiplyToRef(p.getWorldMatrix(),w),r.b.ScalingToRef(p.Ne.x,p.Ne.y,p.Ne.z,e)):r.b.IdentityToRef(e),w.invert(),!isNaN(w.m[0])&&(e.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyToRef(e,w),!0)}up(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.k.Zero();return this.getPositionToRef(w,p,e),e}getPositionToRef(){let w=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const w=this.getLocalMatrix();p.x=w.m[12],p.y=w.m[13],p.z=w.m[14]}else{let e=null;w&&(e=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let r=f._TmpMats[0];w&&e?(r.X(this.getAbsoluteMatrix()),r.multiplyToRef(e,r)):r=this.getAbsoluteMatrix(),p.x=r.m[12],p.y=r.m[13],p.z=r.m[14]}}getAbsolutePosition(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=r.k.Zero();return this.getPositionToRef(1,w,p),p}getAbsolutePositionToRef(w,p){this.getPositionToRef(1,w,p)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.om.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.X(this.om);const w=this._skeleton.getPoseMatrix();w&&this._absoluteMatrix.multiplyToRef(w,this._absoluteMatrix)}const w=this.children,p=w.length;for(let e=0;e<p;e++)w[e].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}ej(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.k.Zero();return this.getDirectionToRef(w,p,e),e}getDirectionToRef(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,I=null;p&&(I=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=f._TmpMats[0];d.X(this.getAbsoluteMatrix()),p&&I&&d.multiplyToRef(I,d),r.k.TransformNormalToRef(w,d,e),e.normalize()}getRotation(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.k.Zero();return this.getRotationToRef(w,p,e),e}getRotationToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;const r=f._TmpQuat;this.getRotationQuaternionToRef(w,p,r),r.toEulerAnglesToRef(e)}getRotationQuaternion(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.c.Identity();return this.getRotationQuaternionToRef(w,p,e),e}getRotationQuaternionToRef(){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),p.X(this._localRotation);else{const e=f._TmpMats[0],r=this.getAbsoluteMatrix();w?r.multiplyToRef(w.getWorldMatrix(),e):e.X(r),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.decompose(void 0,p,void 0)}}getRotationMatrix(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0;const e=r.b.Identity();return this.getRotationMatrixToRef(w,p,e),e}getRotationMatrixToRef(){let w=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(p);else{const e=f._TmpMats[0],r=this.getAbsoluteMatrix();w?r.multiplyToRef(w.getWorldMatrix(),e):e.X(r),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.getRotationMatrixToRef(p)}}getAbsolutePositionFromLocal(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.k.Zero();return this.getAbsolutePositionFromLocalToRef(w,p,e),e}getAbsolutePositionFromLocalToRef(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,I=null;p&&(I=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=f._TmpMats[0];d.X(this.getAbsoluteMatrix()),p&&I&&d.multiplyToRef(I,d),r.k.TransformCoordinatesToRef(w,d,e)}getLocalPositionFromAbsolute(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=r.k.Zero();return this.getLocalPositionFromAbsoluteToRef(w,p,e),e}getLocalPositionFromAbsoluteToRef(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,I=null;p&&(I=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=f._TmpMats[0];d.X(this.getAbsoluteMatrix()),p&&I&&d.multiplyToRef(I,d),d.invert(),r.k.TransformCoordinatesToRef(w,d,e)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const w=this._skeleton.bones.indexOf(this);if(-1!==w&&this._skeleton.bones.splice(w,1),this._parentNode&&this._parentNode.children){const w=this._parentNode.children,p=w.indexOf(this);-1!==p&&w.splice(p,1)}super.dispose()}}f._TmpVecs=(0,I.d)(2,r.k.Zero),f._TmpQuat=r.c.Identity(),f._TmpMats=(0,I.d)(5,r.b.Identity)},13352:(w,p,e)=>{"use strict";e.d(p,{c:()=>b});var r=e(11207),I=e(11213),d=e(11056),f=e(11023),q=e(11063),E=e(11331),j=e(11370),X=e(11611),k=e(11088),m=e(11027);class J{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(w){this._idleRotationSpeed=w}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(w){this._idleRotationWaitTime=w}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(w){this._idleRotationSpinupTime=w}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(w){this._attachedCamera=w;const p=this._attachedCamera.iw();this._onPrePointerObservableObserver=p.onPrePointerObservable.add((w=>{w.type!==X.c.POINTERDOWN?w.type===X.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const w=k.b.Now;let p=0;null!=this._lastFrameTime&&(p=w-this._lastFrameTime),this._lastFrameTime=w,this._applyUserInteraction();const e=w-this._lastInteractionTime-this._idleRotationWaitTime,r=Math.max(Math.min(e/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*r,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(p/1e3))}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.iw();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(w){this._lastInteractionTime=w??k.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<m.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let w=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(w=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?w:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=k.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var K=e(13355),y=e(11713);class c{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(w){if(this._autoTransitionRange===w)return;this._autoTransitionRange=w;const p=this._attachedCamera;p&&(w?this._onMeshTargetChangedObserver=p.onMeshTargetChangedObservable.add((w=>{if(w&&(w.ke(!0),w.getBoundingInfo)){const p=w.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*p,this.upperRadiusTransitionRange=.05*p}})):this._onMeshTargetChangedObserver&&p.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(w){this._attachedCamera=w,this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(w){return!!this._attachedCamera&&(this._attachedCamera.radius===w&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(w){if(!this._attachedCamera)return;this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=y.c.CreateAnimation("radius",y.c.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const p=y.c.TransitionTo("radius",this._attachedCamera.radius+w,this._attachedCamera,this._attachedCamera.iw(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));p&&this._animatables.push(p)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}c.EasingFunction=new K.d(.3),c.EasingMode=K.q.EASINGMODE_EASEOUT;class s{constructor(){this.onTargetFramingAnimationEndObservable=new d.d,this._mode=s.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(w){this._mode=w}get mode(){return this._mode}set radiusScale(w){this._radiusScale=w}get radiusScale(){return this._radiusScale}set positionScale(w){this._positionScale=w}get positionScale(){return this._positionScale}set defaultElevation(w){this._defaultElevation=w}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(w){this._elevationReturnTime=w}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(w){this._elevationReturnWaitTime=w}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(w){this._framingTime=w}get framingTime(){return this._framingTime}init(){}attach(w){this._attachedCamera=w;const p=this._attachedCamera.iw();s.EasingFunction.setEasingMode(s.EasingMode),this._onPrePointerObservableObserver=p.onPrePointerObservable.add((w=>{w.type!==X.c.POINTERDOWN?w.type===X.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=w.onMeshTargetChangedObservable.add((w=>{w&&w.getBoundingInfo&&this.zoomOnMesh(w,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.iw();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.ke(!0);const r=w.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,p,e)}zoomOnMeshHierarchy(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.ke(!0);const r=w.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,p,e)}zoomOnMeshesHierarchy(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new f.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let d=0;d<w.length;d++){const p=w[d].getHierarchyBoundingVectors(!0);f.k.CheckExtends(p.min,r,I),f.k.CheckExtends(p.max,r,I)}this.zoomOnBoundingInfo(r,I,p,e)}zoomOnBoundingInfo(w,p){let e,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const d=w.y,q=d+(p.y-d)*this._positionScale,E=p.Je(w).scale(.5);if(!isFinite(q))return!1;if(r)e=new f.k(0,q,0);else{const p=w.add(E);e=new f.k(p.x,q,p.z)}this._vectorTransition||(this._vectorTransition=y.c.CreateAnimation("target",y.c.ANIMATIONTYPE_VECTOR3,60,s.EasingFunction)),this._betaIsAnimating=!0;let j=y.c.TransitionTo("target",e,this._attachedCamera,this._attachedCamera.iw(),60,this._vectorTransition,this._framingTime);j&&this._animatables.push(j);let X=0;if(this._mode===s.FitFrustumSidesMode){const e=this._calculateLowerRadiusFromModelBoundingSphere(w,p);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=E.length()+this._attachedCamera.ge),X=e}else this._mode===s.IgnoreBoundsSizeMode&&(X=this._calculateLowerRadiusFromModelBoundingSphere(w,p),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ge));if(this.autoCorrectCameraLimitsAndSensibility){const e=p.Je(w).length();this._attachedCamera.panningSensibility=5e3/e,this._attachedCamera.wheelPrecision=100/X}return this._radiusTransition||(this._radiusTransition=y.c.CreateAnimation("radius",y.c.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),j=y.c.TransitionTo("radius",X,this._attachedCamera,this._attachedCamera.iw(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),I&&I(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),j&&this._animatables.push(j),!0}_calculateLowerRadiusFromModelBoundingSphere(w,p){const e=this._attachedCamera;if(!e)return 0;let r=e._calculateLowerRadiusFromModelBoundingSphere(w,p,this._radiusScale);return e.lowerRadiusLimit&&this._mode===s.IgnoreBoundsSizeMode&&(r=r<e.lowerRadiusLimit?e.lowerRadiusLimit:r),e.upperRadiusLimit&&(r=r>e.upperRadiusLimit?e.upperRadiusLimit:r),r}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const w=k.b.Now-this._lastInteractionTime,p=.5*Math.PI-this._defaultElevation,e=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>e&&w>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=y.c.CreateAnimation("beta",y.c.ANIMATIONTYPE_FLOAT,60,s.EasingFunction));const w=y.c.TransitionTo("beta",p,this._attachedCamera,this._attachedCamera.iw(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));w&&this._animatables.push(w)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=k.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}s.EasingFunction=new K.v,s.EasingMode=K.q.EASINGMODE_EASEINOUT,s.IgnoreBoundsSizeMode=0,s.FitFrustumSidesMode=1;var O=e(11374),a=e(11561),A=e(12785),z=e(11071);class M{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(w){w=z.g.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),e=p.getInputElement();let r=0,I=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=d=>{var f,q;const E=d.event,j="touch"===E.pointerType;if(d.type!==X.c.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const k=E.target;if(this._altKey=E.altKey,this._ctrlKey=E.ctrlKey,this._metaKey=E.metaKey,this._shiftKey=E.shiftKey,this._buttonsPressed=E.buttons,p.isPointerLock){const w=E.movementX,p=E.movementY;this.onTouch(null,w,p),this._pointA=null,this._pointB=null}else{if(d.type!==X.c.POINTERDOWN&&d.type!==X.c.POINTERDOUBLETAP&&j&&(null===(f=this._pointA)||void 0===f?void 0:f.pointerId)!==E.pointerId&&(null===(q=this._pointB)||void 0===q?void 0:q.pointerId)!==E.pointerId)return;if(d.type!==X.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!j)if(d.type===X.c.POINTERDOUBLETAP)this.onDoubleTap(E.pointerType);else if(d.type!==X.c.POINTERUP||this._currentMousePointerIdDown!==E.pointerId&&!j){if(d.type===X.c.POINTERMOVE)if(w||E.preventDefault(),this._pointA&&null===this._pointB){const w=E.clientX-this._pointA.x,p=E.clientY-this._pointA.y;this._pointA.x=E.clientX,this._pointA.y=E.clientY,this.onTouch(this._pointA,w,p)}else if(this._pointA&&this._pointB){const w=this._pointA.pointerId===E.pointerId?this._pointA:this._pointB;w.x=E.clientX,w.y=E.clientY;const p=this._pointA.x-this._pointB.x,e=this._pointA.y-this._pointB.y,f=p*p+e*e,q={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:E.pointerId,type:d.type};this.onMultiTouch(this._pointA,this._pointB,r,f,I,q),I=q,r=f}}else{try{null===k||void 0===k||k.releasePointerCapture(E.pointerId)}catch(m){}j||(this._pointB=null),p._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==E.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==E.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==r||I)&&(this.onMultiTouch(this._pointA,this._pointB,r,0,I,null),r=0,I=null),this._currentMousePointerIdDown=-1,this.onButtonUp(E),w||E.preventDefault()}else{try{null===k||void 0===k||k.setPointerCapture(E.pointerId)}catch(m){}if(null===this._pointA)this._pointA={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType};else{if(null!==this._pointB)return;this._pointB={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType}}-1!==this._currentMousePointerIdDown||j||(this._currentMousePointerIdDown=E.pointerId),this.onButtonDown(E),w||(E.preventDefault(),e&&e.focus())}}},this._observer=this.camera.iw()._inputManager._addCameraPointerObserver(this._pointerInput,X.c.POINTERDOWN|X.c.POINTERUP|X.c.POINTERMOVE|X.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,r=0,I=null,this.onLostFocus()},this._contextMenuBind=w=>this.onContextMenu(w),e&&e.addEventListener("contextmenu",this._contextMenuBind,!1);const d=this.camera.iw().getEngine().getHostWindow();d&&z.g.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}Sk(){if(this._onLostFocus){const w=this.camera.iw().getEngine().getHostWindow();w&&z.g.UnregisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.iw()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const w=this.camera.iw().getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(w){}onTouch(w,p,e){}onMultiTouch(w,p,e,r,I,d){}onContextMenu(w){w.preventDefault()}onButtonDown(w){}onButtonUp(w){}onLostFocus(){}}(0,r.c)([(0,I.J)()],M.prototype,"buttons",void 0);class i extends M{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(w,p){if(0!==this.panningSensibility&&w&&p){const e=p.x-w.x,r=p.y-w.y;this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility}}_computePinchZoom(w,p){const e=this.camera.radius||i.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=e*Math.sqrt(w)/Math.sqrt(p):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(p-w)*e*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(p-w)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(w,p,e){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility):(this.camera.inertialAlphaOffset-=p/this.angularSensibilityX,this.camera.inertialBetaOffset-=e/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(w,p,e,r,I,d){0===e&&null===I||0===r&&null===d||(this.multiTouchPanAndZoom?(this._computePinchZoom(e,r),this._computeMultiTouchPanning(I,d)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(r)-Math.sqrt(e))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(e,r),this._isPinching=!0):this._computeMultiTouchPanning(I,d)):this.multiTouchPanning?this._computeMultiTouchPanning(I,d):this.pinchZoom&&this._computePinchZoom(e,r))}onButtonDown(w){this._isPanClick=w.button===this.camera._panningMouseButton}onButtonUp(w){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}i.MinimumRadiusForPinch=.001,(0,r.c)([(0,I.J)()],i.prototype,"buttons",void 0),(0,r.c)([(0,I.J)()],i.prototype,"angularSensibilityX",void 0),(0,r.c)([(0,I.J)()],i.prototype,"angularSensibilityY",void 0),(0,r.c)([(0,I.J)()],i.prototype,"pinchPrecision",void 0),(0,r.c)([(0,I.J)()],i.prototype,"pinchDeltaPercentage",void 0),(0,r.c)([(0,I.J)()],i.prototype,"useNaturalPinchZoom",void 0),(0,r.c)([(0,I.J)()],i.prototype,"pinchZoom",void 0),(0,r.c)([(0,I.J)()],i.prototype,"panningSensibility",void 0),(0,r.c)([(0,I.J)()],i.prototype,"multiTouchPanning",void 0),(0,r.c)([(0,I.J)()],i.prototype,"multiTouchPanAndZoom",void 0),A.b.ArcRotateCameraPointersInput=i;var t=e(11619);class n{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(w){w=z.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.iw(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const e=p.event;if(!e.metaKey)if(p.type===t.c.KEYDOWN){if(this._ctrlPressed=e.ctrlKey,this._altPressed=e.altKey,-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),e.preventDefault&&(w||e.preventDefault())}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){const p=this._keys.indexOf(e.keyCode);p>=0&&this._keys.splice(p,1),e.preventDefault&&(w||e.preventDefault())}})))}Sk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let p=0;p<this._keys.length;p++){const e=this._keys[p];-1!==this.keysLeft.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX-=1/this.panningSensibility:w.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset+=1/this.zoomingSensibility:w.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX+=1/this.panningSensibility:w.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset-=1/this.zoomingSensibility:w.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(e)&&w.useInputToRestoreState&&w.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,r.c)([(0,I.J)()],n.prototype,"keysUp",void 0),(0,r.c)([(0,I.J)()],n.prototype,"keysDown",void 0),(0,r.c)([(0,I.J)()],n.prototype,"keysLeft",void 0),(0,r.c)([(0,I.J)()],n.prototype,"keysRight",void 0),(0,r.c)([(0,I.J)()],n.prototype,"keysReset",void 0),(0,r.c)([(0,I.J)()],n.prototype,"panningSensibility",void 0),(0,r.c)([(0,I.J)()],n.prototype,"zoomingSensibility",void 0),(0,r.c)([(0,I.J)()],n.prototype,"useAltToZoom",void 0),(0,r.c)([(0,I.J)()],n.prototype,"angularSpeed",void 0),A.b.ArcRotateCameraKeyboardMoveInput=n;var l=e(11292),N=e(11623);class U{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new f.k(0,0,0),this._globalOffset=new f.k(0,0,0),this._inertialPanning=f.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(w,p){let e=0;const r=.01*w*this.wheelDeltaPercentage*p;return e=w>0?r/(1+this.wheelDeltaPercentage):r*(1+this.wheelDeltaPercentage),e}attachControl(w){w=z.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==X.c.POINTERWHEEL)return;const e=p.event;let r=0;const I=e.deltaMode===N.c.DOM_DELTA_LINE?40:1,d=-e.deltaY*I;if(this.customComputeDeltaFromMouseWheel)r=this.customComputeDeltaFromMouseWheel(d,this,e);else if(this.wheelDeltaPercentage){if(r=this._computeDeltaFromMouseWheelLegacyEvent(d,this.camera.radius),r>0){let w=this.camera.radius,p=this.camera.inertialRadiusOffset+r;for(let e=0;e<20&&!(w<=p)&&!(Math.abs(p*this.camera.inertia)<.001);e++)w-=p,p*=this.camera.inertia;w=(0,q.Clamp)(w,0,Number.MAX_VALUE),r=this._computeDeltaFromMouseWheelLegacyEvent(d,w)}}else r=d/(40*this.wheelPrecision);r&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(r)):this.camera.inertialRadiusOffset+=r),e.preventDefault&&(w||e.preventDefault())},this._observer=this.camera.iw()._inputManager._addCameraPointerObserver(this._wheel,X.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Pe(0)}Sk(){this._observer&&(this.camera.iw()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const w=this.camera;0+w.inertialAlphaOffset+w.inertialBetaOffset+w.inertialRadiusOffset&&(this._updateHitPlane(),w.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(w.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const w=this.camera,p=w.target.Je(w.position);this._hitPlane=l.e.FromPositionAndNormal(w.target,p)}_getPosition(){const w=this.camera,p=w.iw(),e=p.createPickingRay(p.pointerX,p.pointerY,f.b.Identity(),w,!1);0===w.targetScreenOffset.x&&0===w.targetScreenOffset.y||(this._viewOffset.set(w.targetScreenOffset.x,w.targetScreenOffset.y,0),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),this._globalOffset=f.k.TransformNormal(this._viewOffset,w._cameraTransformMatrix),e.origin.addInPlace(this._globalOffset));let r=0;return this._hitPlane&&(r=e.intersectsPlane(this._hitPlane)??0),e.origin.addInPlace(e.direction.scaleInPlace(r))}_zoomToMouse(w){const p=this.camera,e=1-p.inertia;if(p.lowerRadiusLimit){const r=p.lowerRadiusLimit??0;p.radius-(p.inertialRadiusOffset+w)/e<r&&(w=(p.radius-r)*e-p.inertialRadiusOffset)}if(p.upperRadiusLimit){const r=p.upperRadiusLimit??0;p.radius-(p.inertialRadiusOffset+w)/e>r&&(w=(p.radius-r)*e-p.inertialRadiusOffset)}const r=w/e/p.radius,I=this._getPosition(),d=f.d.ne[6];I.subtractToRef(p.target,d),d.scaleInPlace(r),d.scaleInPlace(e),this._inertialPanning.addInPlace(d),p.inertialRadiusOffset+=w}_zeroIfClose(w){Math.abs(w.x)<m.c&&(w.x=0),Math.abs(w.y)<m.c&&(w.y=0),Math.abs(w.z)<m.c&&(w.z=0)}}(0,r.c)([(0,I.J)()],U.prototype,"wheelPrecision",void 0),(0,r.c)([(0,I.J)()],U.prototype,"zoomToMouseLocation",void 0),(0,r.c)([(0,I.J)()],U.prototype,"wheelDeltaPercentage",void 0),A.b.ArcRotateCameraMouseWheelInput=U;class v extends A.c{constructor(w){super(w)}addMouseWheel(){return this.add(new U),this}addPointers(){return this.add(new i),this}addKeyboard(){return this.add(new n),this}}var R=e(11038);function V(w,p){return isNaN(w)?p:w}E.b.AddNodeConstructor("ArcRotateCamera",((w,p)=>()=>new b(w,0,0,1,f.k.Zero(),p)));class b extends a.d{get target(){return this._target}set target(w){this.setTarget(w)}get targetHost(){return this._targetHost}set targetHost(w){w&&this.setTarget(w)}getTarget(){return this.target}get position(){return this._position}set position(w){this.setPosition(w)}set upVector(w){this._upToYMatrix||(this._yToUpMatrix=new f.b,this._upToYMatrix=new f.b,this._upVector=f.k.Zero()),w.normalize(),this._upVector.X(w),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){f.b.RotationAlignToRef(f.k.UpReadOnly,this._upVector,this._yToUpMatrix),f.b.RotationAlignToRef(this._upVector,f.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityX:0}set angularSensibilityX(w){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityX=w)}get angularSensibilityY(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityY:0}set angularSensibilityY(w){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityY=w)}get pinchPrecision(){const w=this.inputs.attached.pointers;return w?w.pinchPrecision:0}set pinchPrecision(w){const p=this.inputs.attached.pointers;p&&(p.pinchPrecision=w)}get pinchDeltaPercentage(){const w=this.inputs.attached.pointers;return w?w.pinchDeltaPercentage:0}set pinchDeltaPercentage(w){const p=this.inputs.attached.pointers;p&&(p.pinchDeltaPercentage=w)}get useNaturalPinchZoom(){const w=this.inputs.attached.pointers;return!!w&&w.useNaturalPinchZoom}set useNaturalPinchZoom(w){const p=this.inputs.attached.pointers;p&&(p.useNaturalPinchZoom=w)}get panningSensibility(){const w=this.inputs.attached.pointers;return w?w.panningSensibility:0}set panningSensibility(w){const p=this.inputs.attached.pointers;p&&(p.panningSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const p=this.inputs.attached.keyboard;p&&(p.keysUp=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const p=this.inputs.attached.keyboard;p&&(p.keysDown=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const p=this.inputs.attached.keyboard;p&&(p.keysRight=w)}get wheelPrecision(){const w=this.inputs.attached.mousewheel;return w?w.wheelPrecision:0}set wheelPrecision(w){const p=this.inputs.attached.mousewheel;p&&(p.wheelPrecision=w)}get zoomToMouseLocation(){const w=this.inputs.attached.mousewheel;return!!w&&w.zoomToMouseLocation}set zoomToMouseLocation(w){const p=this.inputs.attached.mousewheel;p&&(p.zoomToMouseLocation=w)}get wheelDeltaPercentage(){const w=this.inputs.attached.mousewheel;return w?w.wheelDeltaPercentage:0}set wheelDeltaPercentage(w){const p=this.inputs.attached.mousewheel;p&&(p.wheelDeltaPercentage=w)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(w){w!==this.useBouncingBehavior&&(w?(this._bouncingBehavior=new c,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(w){w!==this.useFramingBehavior&&(w?(this._framingBehavior=new s,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(w){w!==this.useAutoRotationBehavior&&(w?(this._autoRotationBehavior=new J,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(w,p,e,r,I,q){var E;let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(w,f.k.Zero(),q,j),E=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=f.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=f.g.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new f.b,this.panningAxis=new f.k(1,1,0),this._transformedDirection=new f.k,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new d.d,this.checkCollisions=!1,this.collisionRadius=new f.k(.5,.5,.5),this._previousPosition=f.k.Zero(),this._collisionVelocity=f.k.Zero(),this._newPosition=f.k.Zero(),this._computationVector=f.k.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new f.k(NaN,NaN,NaN),this._goalTargetScreenOffset=new f.g(NaN,NaN),this._onCollisionPositionChange=function(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e?(E.setPosition(p),E.HJ&&E.HJ(e)):E._previousPosition.X(E._position);const r=Math.cos(E.alpha),I=Math.sin(E.alpha),d=Math.cos(E.beta);let f=Math.sin(E.beta);0===f&&(f=1e-4);const q=E._getTargetPosition();E._computationVector.te(E.radius*r*f,E.radius*d,E.radius*I*f),q.addToRef(E._computationVector,E._newPosition),E._position.X(E._newPosition);let j=E.upVector;E.allowUpsideDown&&E.beta<0&&(j=j.clone(),j=j.negate()),E._computeViewMatrix(E._position,q,j),E._viewMatrix.addAtIndex(12,E.targetScreenOffset.x),E._viewMatrix.addAtIndex(13,E.targetScreenOffset.y),E._collisionTriggered=!1},this._target=f.k.Zero(),I&&this.setTarget(I),this.alpha=p,this.beta=e,this.radius=r,this.getViewMatrix(),this.inputs=new v(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new f.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=f.g.Zero()}_updateCache(w){w||super._updateCache(),this._cache._target.X(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.X(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const w=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?w.addToRef(this._targetBoundingCenter,this._target):this._target.X(w)}const w=this._getLockedTargetPosition();return w||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>m.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,d=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=d?this._currentInterpolationFactor=d:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=V(w,this._goalAlpha),this._goalBeta=V(p,this._goalBeta),this._goalRadius=V(e,this._goalRadius),this._goalTarget.set(V(r.x,this._goalTarget.x),V(r.y,this._goalTarget.y),V(r.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(V(I.x,this._goalTargetScreenOffset.x),V(I.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,q.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,q.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,q.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,q.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const I=arguments;p=z.g.BackCompatCameraNoPreventDefault(I),this._useCtrlForPanning=e,this._panningMouseButton=r,"boolean"===typeof I[0]&&(I.length>1&&(this._useCtrlForPanning=I[1]),I.length>2&&(this._panningMouseButton=I[2])),this.inputs.attachElement(p),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Sk(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let w=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){w=!0;const p=this.invertRotation?-1:1,e=this._calculateHandednessMultiplier();let r=this.inertialAlphaOffset*e;this.beta<0&&(r*=-1),this.alpha+=r*p,this.beta+=this.inertialBetaOffset*p,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<m.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<m.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*m.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){w=!0;const p=new f.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),p.multiplyInPlace(this.panningAxis),f.k.TransformNormalToRef(p,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const w=this.upVector,p=f.k.CrossToRef(this._transformedDirection,w,this._transformedDirection);f.k.CrossToRef(w,p,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);f.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.X(this._transformedDirection)}else{if(this.parent){const w=f.d.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(w),w.transposeToRef(w),f.k.TransformCoordinatesToRef(this._transformedDirection,w,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*m.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*m.c&&(this.inertialPanningY=0)}if(w)this.stopInterpolation();else if(this._isInterpolating){let w=!1;const p=this._scene.getEngine().getDeltaTime()/1e3,e=1-Math.pow(2,-p/this._currentInterpolationFactor),r=V(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const p=f.d.ne[0].set(V(this._goalTarget.x,this._target.x),V(this._goalTarget.y,this._target.y),V(this._goalTarget.z,this._target.z));f.k.LerpToRef(this.target,p,e,this._target),10*f.k.Distance(this.target,p)/r<m.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.X(p),this.setTarget(this.target,!1,!0,!0)):w=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const p=f.c.RotationAlphaBetaGammaToRef(V(this._goalAlpha,this.alpha),V(this._goalBeta,this.beta),0,f.d.Quaternion[0]),r=f.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,f.d.Quaternion[1]),I=f.c.SlerpToRef(r,p,e,f.d.Quaternion[2]);I.normalize();const d=I.toAlphaBetaGammaToRef(f.d.ne[0]);if(this.alpha=d.x,this.beta=d.y,I.isApprox(p,m.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const w=p.toAlphaBetaGammaToRef(f.d.ne[0]);this.alpha=w.x,this.beta=w.y}else w=!0}if(isNaN(this._goalRadius)||(this.radius+=(r-this.radius)*e,Math.abs(r/this.radius-1)<m.c?(this._goalRadius=NaN,this.radius=r):w=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const p=f.d.Vector2[0].set(V(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),V(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));f.g.LerpToRef(this.targetScreenOffset,p,e,this.targetScreenOffset),f.g.Distance(this.targetScreenOffset,p)<m.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.X(p)):w=!0}this._isInterpolating=w}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const w=this.alpha;var p,e;this.alpha=function(w){let p=Math.PI/2;return 0===w.x&&0===w.z||(p=Math.acos(w.x/Math.sqrt(Math.pow(w.x,2)+Math.pow(w.z,2)))),w.z<0&&(p=2*Math.PI-p),p}(this._computationVector),this.beta=(p=this._computationVector.y,e=this.radius,Math.acos(p/e));const r=Math.round((w-this.alpha)/(2*Math.PI));this.alpha+=2*r*Math.PI,this._checkLimits()}setPosition(w){this._position.equals(w)||(this._position.X(w),this.rebuildAnglesAndRadius())}setTarget(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r=this.overrideCloneAlphaBetaRadius??r,w.ke)p&&w.getBoundingInfo?this._targetBoundingCenter=w.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,w.ke(),this._targetHost=w,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const p=w,r=this._getTargetPosition();if(r&&!e&&r.equals(p))return;this._targetHost=null,this._target=p,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}r||this.rebuildAnglesAndRadius()}_getViewMatrix(){const w=Math.cos(this.alpha),p=Math.sin(this.alpha),e=Math.cos(this.beta);let r=Math.sin(this.beta);0===r&&(r=1e-4),0===this.radius&&(this.radius=1e-4);const I=this._getTargetPosition();if(this._computationVector.te(this.radius*w*r,this.radius*e,this.radius*p*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),I.addToRef(this._computationVector,this._newPosition),this.iw().collisionsEnabled&&this.checkCollisions){const w=this.iw().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,w.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.X(this._newPosition);let w=this.upVector;this.allowUpsideDown&&r<0&&(w=w.negate()),this._computeViewMatrix(this._position,I,w),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.X(I),this._viewMatrix}zoomOn(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w||this.iw().meshes;const e=j.c.MinMax(w);let r=this._calculateLowerRadiusFromModelBoundingSphere(e.min,e.max);if(r=Math.max(Math.min(r,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=r*this.zoomOnFactor,this.mode===O.d.ORTHOGRAPHIC_CAMERA){const w=this.iw().getEngine().getAspectRatio(this),p=r*this.zoomOnFactor/2;this.orthoLeft=-p*w,this.orthoRight=p*w,this.orthoBottom=-p,this.orthoTop=p}this.focusOn({min:e.min,max:e.max,distance:r},p)}focusOn(w){let p,e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===w.min){const r=w||this.iw().meshes;p=j.c.MinMax(r),e=f.k.Distance(p.min,p.max)}else{p=w,e=w.distance}this._target=j.c.Center(p),r||(this.maxZ=2*e)}createRigCamera(w,p){let e=0;switch(this.cameraRigMode){case O.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.d.RIG_MODE_VR:e=this._cameraRigParams.stereoHalfAngle*(0===p?1:-1);break;case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===p?-1:1)}const r=new b(w,this.alpha+e,this.beta,this.radius,this._target,this.iw());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r.upVector=this.upVector,r.mode=this.mode,r.orthoLeft=this.orthoLeft,r.orthoRight=this.orthoRight,r.orthoBottom=this.orthoBottom,r.orthoTop=this.orthoTop,r}_updateRigCameras(){const w=this._rigCameras[0],p=this._rigCameras[1];switch(w.beta=p.beta=this.beta,this.cameraRigMode){case O.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.d.RIG_MODE_VR:w.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:w.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=f.k.Distance(w,p),I=this.iw().getEngine().getAspectRatio(this),d=Math.tan(this.fov/2),q=d*I,E=.5*r*e,j=E*Math.sqrt(1+1/(q*q)),X=E*Math.sqrt(1+1/(d*d));return Math.max(j,X)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,r.c)([(0,I.J)()],b.prototype,"alpha",void 0),(0,r.c)([(0,I.J)()],b.prototype,"beta",void 0),(0,r.c)([(0,I.J)()],b.prototype,"radius",void 0),(0,r.c)([(0,I.J)()],b.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,r.c)([(0,I.G)("target")],b.prototype,"_target",void 0),(0,r.c)([(0,I.v)("targetHost")],b.prototype,"_targetHost",void 0),(0,r.c)([(0,I.J)()],b.prototype,"inertialAlphaOffset",void 0),(0,r.c)([(0,I.J)()],b.prototype,"inertialBetaOffset",void 0),(0,r.c)([(0,I.J)()],b.prototype,"inertialRadiusOffset",void 0),(0,r.c)([(0,I.J)()],b.prototype,"lowerAlphaLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"upperAlphaLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"lowerBetaLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"upperBetaLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"lowerRadiusLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"upperRadiusLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"lowerTargetYLimit",void 0),(0,r.c)([(0,I.J)()],b.prototype,"inertialPanningX",void 0),(0,r.c)([(0,I.J)()],b.prototype,"inertialPanningY",void 0),(0,r.c)([(0,I.J)()],b.prototype,"pinchToPanMaxDistance",void 0),(0,r.c)([(0,I.J)()],b.prototype,"panningDistanceLimit",void 0),(0,r.c)([(0,I.G)()],b.prototype,"panningOriginTarget",void 0),(0,r.c)([(0,I.J)()],b.prototype,"panningInertia",void 0),(0,r.c)([(0,I.J)()],b.prototype,"zoomToMouseLocation",null),(0,r.c)([(0,I.J)()],b.prototype,"zoomOnFactor",void 0),(0,r.c)([(0,I.E)()],b.prototype,"targetScreenOffset",void 0),(0,r.c)([(0,I.J)()],b.prototype,"allowUpsideDown",void 0),(0,r.c)([(0,I.J)()],b.prototype,"useInputToRestoreState",void 0),(0,r.c)([(0,I.J)()],b.prototype,"restoreStateInterpolationFactor",void 0),(0,R.d)("BABYLON.ArcRotateCamera",b)},12785:(w,p,e)=>{"use strict";e.d(p,{b:()=>f,c:()=>q});var r=e(11081),I=e(11301),d=e(11374),f={};class q{constructor(w){this.attachedToElement=!1,this.attached={},this.camera=w,this.checkInputs=()=>{}}add(w){const p=w.getSimpleName();this.attached[p]?r.c.Warn("camera input of type "+p+" already exists on camera"):(this.attached[p]=w,w.camera=this.camera,w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w))),this.attachedToElement&&w.attachControl(this.noPreventDefault))}remove(w){for(const p in this.attached){const e=this.attached[p];if(e===w)return e.Sk(),e.camera=null,delete this.attached[p],void this.rebuildInputCheck()}}removeByType(w){for(const p in this.attached){const e=this.attached[p];e.getClassName()===w&&(e.Sk(),e.camera=null,delete this.attached[p],this.rebuildInputCheck())}}_addCheckInputs(w){const p=this.checkInputs;return()=>{p(),w()}}attachInput(w){this.attachedToElement&&w.attachControl(this.noPreventDefault)}attachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){w=!d.d.ForceAttachControlToAlwaysPreventDefault&&w,this.attachedToElement=!0,this.noPreventDefault=w;for(const p in this.attached)this.attached[p].attachControl(w)}}detachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const p in this.attached)this.attached[p].Sk(),w&&(this.attached[p].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const w in this.attached){const p=this.attached[w];p.checkInputs&&(this.checkInputs=this._addCheckInputs(p.checkInputs.bind(p)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(w){const p={};for(const e in this.attached){const w=this.attached[e],r=I.e.Serialize(w);p[w.getClassName()]=r}w.inputsmgr=p}parse(w){const p=w.inputsmgr;if(p){this.clear();for(const w in p){const e=f[w];if(e){const r=p[w],d=I.e.Parse((()=>new e),r,null);this.add(d)}}}else for(const e in this.attached){const p=f[this.attached[e].getClassName()];if(p){const r=I.e.Parse((()=>new p),w,null);this.remove(this.attached[e]),this.add(r)}}}}},12777:(w,p,e)=>{"use strict";e.d(p,{d:()=>M});var r=e(11207),I=e(11213),d=e(11023),f=e(11561),q=e(12785),E=e(11619),j=e(11071);class X{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(w){w=j.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.iw(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const e=p.event;if(!e.metaKey)if(p.type===E.c.KEYDOWN){if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),w||e.preventDefault()}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){const p=this._keys.indexOf(e.keyCode);p>=0&&this._keys.splice(p,1),w||e.preventDefault()}})))}Sk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let p=0;p<this._keys.length;p++){const e=this._keys[p],r=w._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(e)?w._localDirection.te(-r,0,0):-1!==this.keysUp.indexOf(e)?w._localDirection.te(0,0,r):-1!==this.keysRight.indexOf(e)?w._localDirection.te(r,0,0):-1!==this.keysDown.indexOf(e)?w._localDirection.te(0,0,-r):-1!==this.keysUpward.indexOf(e)?w._localDirection.te(0,r,0):-1!==this.keysDownward.indexOf(e)?w._localDirection.te(0,-r,0):-1!==this.keysRotateLeft.indexOf(e)?(w._localDirection.te(0,0,0),w.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(e)?(w._localDirection.te(0,0,0),w.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(e)?(w._localDirection.te(0,0,0),w.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(e)&&(w._localDirection.te(0,0,0),w.cameraRotation.x+=this._getLocalRotation()),w.iw().useRightHandedSystem&&(w._localDirection.z*=-1),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),d.k.TransformNormalToRef(w._localDirection,w._cameraTransformMatrix,w._transformedDirection),w.cameraDirection.addInPlace(w._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const w=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*w}}(0,r.c)([(0,I.J)()],X.prototype,"keysUp",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysUpward",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysDown",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysDownward",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysLeft",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysRight",void 0),(0,r.c)([(0,I.J)()],X.prototype,"rotationSpeed",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysRotateLeft",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysRotateRight",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysRotateUp",void 0),(0,r.c)([(0,I.J)()],X.prototype,"keysRotateDown",void 0),q.b.FreeCameraKeyboardMoveInput=X;var k=e(11056),m=e(11611);class J{constructor(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=w,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new k.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(w){w=j.g.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),e=p.getInputElement();this._pointerInput||(this._pointerInput=r=>{const I=r.event,d="touch"===I.pointerType;if(!this.touchEnabled&&d)return;if(r.type!==m.c.POINTERMOVE&&-1===this.buttons.indexOf(I.button))return;const f=I.target;if(r.type===m.c.POINTERDOWN){if(d&&-1!==this._activePointerId||!d&&-1!==this._currentActiveButton)return;this._activePointerId=I.pointerId;try{null===f||void 0===f||f.setPointerCapture(I.pointerId)}catch(q){}-1===this._currentActiveButton&&(this._currentActiveButton=I.button),this._previousPosition={x:I.clientX,y:I.clientY},w||(I.preventDefault(),e&&e.focus()),p.isPointerLock&&this._onMouseMove&&this._onMouseMove(r.event)}else if(r.type===m.c.POINTERUP){if(d&&this._activePointerId!==I.pointerId||!d&&this._currentActiveButton!==I.button)return;try{null===f||void 0===f||f.releasePointerCapture(I.pointerId)}catch(q){}this._currentActiveButton=-1,this._previousPosition=null,w||I.preventDefault(),this._activePointerId=-1}else if(r.type===m.c.POINTERMOVE&&(this._activePointerId===I.pointerId||!d))if(p.isPointerLock&&this._onMouseMove)this._onMouseMove(r.event);else if(this._previousPosition){const p=this.camera._calculateHandednessMultiplier(),e=(I.clientX-this._previousPosition.x)*p,r=I.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=r/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:r}),this._previousPosition={x:I.clientX,y:I.clientY},w||I.preventDefault()}}),this._onMouseMove=e=>{if(!p.isPointerLock)return;const r=this.camera._calculateHandednessMultiplier(),I=e.movementX*r;this.camera.cameraRotation.y+=I/this.angularSensibility;const d=e.movementY;this.camera.cameraRotation.x+=d/this.angularSensibility,this._previousPosition=null,w||e.preventDefault()},this._observer=this.camera.iw()._inputManager._addCameraPointerObserver(this._pointerInput,m.c.POINTERDOWN|m.c.POINTERUP|m.c.POINTERMOVE),e&&(this._contextMenuBind=w=>this.onContextMenu(w),e.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(w){w.preventDefault()}Sk(){if(this._observer){if(this.camera.iw()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,r.c)([(0,I.J)()],J.prototype,"buttons",void 0),(0,r.c)([(0,I.J)()],J.prototype,"angularSensibility",void 0),q.b.FreeCameraMouseInput=J;var K,y=e(11623);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new k.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(w){w=j.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==m.c.POINTERWHEEL)return;const e=p.event,r=e.deltaMode===y.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*r*e.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*r*e.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*r*e.deltaZ/this._normalize,e.preventDefault&&(w||e.preventDefault())},this._observer=this.camera.iw()._inputManager._addCameraPointerObserver(this._wheel,m.c.POINTERWHEEL)}Sk(){this._observer&&(this.camera.iw()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,r.c)([(0,I.J)()],c.prototype,"wheelPrecisionX",void 0),(0,r.c)([(0,I.J)()],c.prototype,"wheelPrecisionY",void 0),(0,r.c)([(0,I.J)()],c.prototype,"wheelPrecisionZ",void 0),function(w){w[w.MoveRelative=0]="MoveRelative",w[w.RotateRelative=1]="RotateRelative",w[w.MoveScene=2]="MoveScene"}(K||(K={}));class s extends c{constructor(){super(...arguments),this._moveRelative=d.k.Zero(),this._rotateRelative=d.k.Zero(),this._moveScene=d.k.Zero(),this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(w){null===w&&this._wheelXAction!==K.MoveRelative||(this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=w)}get wheelXMoveRelative(){return this._wheelXAction!==K.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(w){null===w&&this._wheelYAction!==K.MoveRelative||(this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=w)}get wheelYMoveRelative(){return this._wheelYAction!==K.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(w){null===w&&this._wheelZAction!==K.MoveRelative||(this._wheelZAction=K.MoveRelative,this._wheelZActionCoordinate=w)}get wheelZMoveRelative(){return this._wheelZAction!==K.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(w){null===w&&this._wheelXAction!==K.RotateRelative||(this._wheelXAction=K.RotateRelative,this._wheelXActionCoordinate=w)}get wheelXRotateRelative(){return this._wheelXAction!==K.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(w){null===w&&this._wheelYAction!==K.RotateRelative||(this._wheelYAction=K.RotateRelative,this._wheelYActionCoordinate=w)}get wheelYRotateRelative(){return this._wheelYAction!==K.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(w){null===w&&this._wheelZAction!==K.RotateRelative||(this._wheelZAction=K.RotateRelative,this._wheelZActionCoordinate=w)}get wheelZRotateRelative(){return this._wheelZAction!==K.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(w){null===w&&this._wheelXAction!==K.MoveScene||(this._wheelXAction=K.MoveScene,this._wheelXActionCoordinate=w)}get wheelXMoveScene(){return this._wheelXAction!==K.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(w){null===w&&this._wheelYAction!==K.MoveScene||(this._wheelYAction=K.MoveScene,this._wheelYActionCoordinate=w)}get wheelYMoveScene(){return this._wheelYAction!==K.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(w){null===w&&this._wheelZAction!==K.MoveScene||(this._wheelZAction=K.MoveScene,this._wheelZActionCoordinate=w)}get wheelZMoveScene(){return this._wheelZAction!==K.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Pe(0),this._rotateRelative.Pe(0),this._moveScene.Pe(0),this._updateCamera(),this.camera.iw().useRightHandedSystem&&(this._moveRelative.z*=-1);const w=d.b.Zero();this.camera.getViewMatrix().invertToRef(w);const p=d.k.Zero();d.k.TransformNormalToRef(this._moveRelative,w,p),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(p),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(w,p,e){if(0===w)return;if(null===p||null===e)return;let r=null;switch(p){case K.MoveRelative:r=this._moveRelative;break;case K.RotateRelative:r=this._rotateRelative;break;case K.MoveScene:r=this._moveScene}switch(e){case 0:r.set(w,0,0);break;case 1:r.set(0,w,0);break;case 2:r.set(0,0,w)}}}(0,r.c)([(0,I.J)()],s.prototype,"wheelXMoveRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelYMoveRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelZMoveRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelXRotateRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelYRotateRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelZRotateRelative",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelXMoveScene",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelYMoveScene",null),(0,r.c)([(0,I.J)()],s.prototype,"wheelZMoveScene",null),q.b.FreeCameraMouseWheelInput=s;class O{constructor(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=w,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=j.g.IsSafari()}attachControl(w){w=j.g.BackCompatCameraNoPreventDefault(arguments);let p=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=e=>{const r=e.event,I="mouse"===r.pointerType||this._isSafari&&"undefined"===typeof r.pointerType;if(this.allowMouse||!I)if(e.type===m.c.POINTERDOWN){if(w||r.preventDefault(),this._pointerPressed.push(r.pointerId),1!==this._pointerPressed.length)return;p={x:r.clientX,y:r.clientY}}else if(e.type===m.c.POINTERUP){w||r.preventDefault();const e=this._pointerPressed.indexOf(r.pointerId);if(-1===e)return;if(this._pointerPressed.splice(e,1),0!=e)return;p=null,this._offsetX=null,this._offsetY=null}else if(e.type===m.c.POINTERMOVE){if(w||r.preventDefault(),!p)return;if(0!=this._pointerPressed.indexOf(r.pointerId))return;this._offsetX=r.clientX-p.x,this._offsetY=-(r.clientY-p.y)}}),this._observer=this.camera.iw()._inputManager._addCameraPointerObserver(this._pointerInput,m.c.POINTERDOWN|m.c.POINTERUP|m.c.POINTERMOVE),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.addEventListener("blur",this._onLostFocus)}}Sk(){if(this._pointerInput){if(this._observer&&(this.camera.iw()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const w=this.camera,p=w._calculateHandednessMultiplier();w.cameraRotation.y=p*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)w.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const p=w._computeLocalCameraSpeed(),e=new d.k(0,0,0!==this.touchMoveSensibility?p*this._offsetY/this.touchMoveSensibility:0);d.b.RotationYawPitchRollToRef(w.rotation.y,w.rotation.x,0,w._cameraRotationMatrix),w.cameraDirection.addInPlace(d.k.TransformCoordinates(e,w._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,r.c)([(0,I.J)()],O.prototype,"touchAngularSensibility",void 0),(0,r.c)([(0,I.J)()],O.prototype,"touchMoveSensibility",void 0),q.b.FreeCameraTouchInput=O;class a extends q.c{constructor(w){super(w),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new X),this}addMouse(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new J(w),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new s,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new O),this}clear(){super.clear(),this._mouseInput=null}}var A=e(11038),z=e(11132);class M extends f.d{get angularSensibility(){const w=this.inputs.attached.mouse;return w?w.angularSensibility:0}set angularSensibility(w){const p=this.inputs.attached.mouse;p&&(p.angularSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const p=this.inputs.attached.keyboard;p&&(p.keysUp=w)}get keysUpward(){const w=this.inputs.attached.keyboard;return w?w.keysUpward:[]}set keysUpward(w){const p=this.inputs.attached.keyboard;p&&(p.keysUpward=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const p=this.inputs.attached.keyboard;p&&(p.keysDown=w)}get keysDownward(){const w=this.inputs.attached.keyboard;return w?w.keysDownward:[]}set keysDownward(w){const p=this.inputs.attached.keyboard;p&&(p.keysDownward=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const p=this.inputs.attached.keyboard;p&&(p.keysRight=w)}get keysRotateLeft(){const w=this.inputs.attached.keyboard;return w?w.keysRotateLeft:[]}set keysRotateLeft(w){const p=this.inputs.attached.keyboard;p&&(p.keysRotateLeft=w)}get keysRotateRight(){const w=this.inputs.attached.keyboard;return w?w.keysRotateRight:[]}set keysRotateRight(w){const p=this.inputs.attached.keyboard;p&&(p.keysRotateRight=w)}get keysRotateUp(){const w=this.inputs.attached.keyboard;return w?w.keysRotateUp:[]}set keysRotateUp(w){const p=this.inputs.attached.keyboard;p&&(p.keysRotateUp=w)}get keysRotateDown(){const w=this.inputs.attached.keyboard;return w?w.keysRotateDown:[]}set keysRotateDown(w){const p=this.inputs.attached.keyboard;p&&(p.keysRotateDown=w)}constructor(w,p,e){var r;super(w,p,e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),r=this,this.ellipsoid=new d.k(.5,1,.5),this.ellipsoidOffset=new d.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=d.k.Zero(),this._diffPosition=d.k.Zero(),this._newPosition=d.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r._newPosition.X(p),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>z.d.CollisionsEpsilon&&(r.position.addToRef(r._diffPosition,r._deferredPositionUpdate),r._deferOnly?r._deferredUpdated=!0:r.position.X(r._deferredPositionUpdate),r.HJ&&e&&r.HJ(e))},this.inputs=new a(this),this.inputs.addKeyboard().addMouse()}attachControl(w,p){p=j.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(p)}Sk(){this.inputs.detachElement(),this.cameraDirection=new d.k(0,0,0),this.cameraRotation=new d.g(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(w){this._collisionMask=isNaN(w)?-1:w}_collideWithWorld(w){let p;p=this.parent?d.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,p.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const e=this.iw().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let r=w;this.applyGravity&&(r=w.add(this.iw().gravity)),e.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.k.Zero(),this._transformedDirection=d.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(w){this._needMoveForGravity=w}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.iw().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Xd"}}(0,r.c)([(0,I.G)()],M.prototype,"ellipsoid",void 0),(0,r.c)([(0,I.G)()],M.prototype,"ellipsoidOffset",void 0),(0,r.c)([(0,I.J)()],M.prototype,"checkCollisions",void 0),(0,r.c)([(0,I.J)()],M.prototype,"applyGravity",void 0),(0,A.d)("BABYLON.FreeCamera",M)},13416:(w,p,e)=>{"use strict";e.d(p,{c:()=>d});var r=e(11376),I=e(13421);class d{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=e,this.Ok=[],this._maxBlockCapacity=p||64,this._selectionContent=new r.b(1024),this._creationFunc=w}update(w,p,e){I.e._CreateBlocks(w,p,e,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}tX(w){for(let p=0;p<this.LX.length;p++){this.LX[p].addEntry(w)}}iX(w){for(let p=0;p<this.LX.length;p++){this.LX[p].removeEntry(w)}}select(w,p){this._selectionContent.reset();for(let e=0;e<this.LX.length;e++){this.LX[e].select(w,this._selectionContent,p)}return p?this._selectionContent.concat(this.Ok):this._selectionContent.concatWithNoDuplicate(this.Ok),this._selectionContent}intersects(w,p,e){this._selectionContent.reset();for(let r=0;r<this.LX.length;r++){this.LX[r].intersects(w,p,this._selectionContent,e)}return e?this._selectionContent.concat(this.Ok):this._selectionContent.concatWithNoDuplicate(this.Ok),this._selectionContent}intersectsRay(w){this._selectionContent.reset();for(let p=0;p<this.LX.length;p++){this.LX[p].intersectsRay(w,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ok),this._selectionContent}}d.CreationFuncForMeshes=(w,p)=>{const e=w.getBoundingInfo();!w.isBlocked&&e.boundingBox.intersectsMinMax(p.Mk,p.ik)&&p.entries.push(w)},d.CreationFuncForSubMeshes=(w,p)=>{w.getBoundingInfo().boundingBox.intersectsMinMax(p.Mk,p.ik)&&p.entries.push(w)}},13421:(w,p,e)=>{"use strict";e.d(p,{e:()=>d});var r=e(11023),I=e(11273);class d{constructor(w,p,e,r,I,d){this.entries=[],this.tk=new Array,this._capacity=e,this._depth=r,this._maxDepth=I,this._creationFunc=d,this._minPoint=w,this._maxPoint=p,this.tk.push(w.clone()),this.tk.push(p.clone()),this.tk.push(w.clone()),this.tk[2].x=p.x,this.tk.push(w.clone()),this.tk[3].y=p.y,this.tk.push(w.clone()),this.tk[4].z=p.z,this.tk.push(p.clone()),this.tk[5].z=w.z,this.tk.push(p.clone()),this.tk[6].x=w.x,this.tk.push(p.clone()),this.tk[7].y=w.y}get eq(){return this._capacity}get Mk(){return this._minPoint}get ik(){return this._maxPoint}addEntry(w){if(this.LX)for(let p=0;p<this.LX.length;p++){this.LX[p].addEntry(w)}else this._creationFunc(w,this),this.entries.length>this.eq&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(w){if(this.LX){for(let p=0;p<this.LX.length;p++){this.LX[p].removeEntry(w)}return}const p=this.entries.indexOf(w);p>-1&&this.entries.splice(p,1)}addEntries(w){for(let p=0;p<w.length;p++){const e=w[p];this.addEntry(e)}}select(w,p,e){if(I.d.IsInFrustum(this.tk,w)){if(this.LX){for(let r=0;r<this.LX.length;r++){this.LX[r].select(w,p,e)}return}e?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersects(w,p,e,r){if(I.d.IntersectsSphere(this._minPoint,this._maxPoint,w,p)){if(this.LX){for(let I=0;I<this.LX.length;I++){this.LX[I].intersects(w,p,e,r)}return}r?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}}intersectsRay(w,p){if(w.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.LX){for(let e=0;e<this.LX.length;e++){this.LX[e].intersectsRay(w,p)}return}p.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){d._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(w,p,e,I,f,q,E,j){E.LX=new Array;const X=new r.k((p.x-w.x)/2,(p.y-w.y)/2,(p.z-w.z)/2);for(let r=0;r<2;r++)for(let p=0;p<2;p++)for(let k=0;k<2;k++){const m=w.add(X.multiplyByFloats(r,p,k)),J=w.add(X.multiplyByFloats(r+1,p+1,k+1)),K=new d(m,J,I,f+1,q,j);K.addEntries(e),E.LX.push(K)}}}},13427:(w,p,e)=>{"use strict";e.d(p,{d:()=>X});var r=e(11590),I=e(11023),d=e(11333),f=e(12527),q=e(11408),E=e(13416),j=e(11051);r.c.prototype.createOrUpdateSelectionOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=this._getComponent(q.d.NAME_OCTREE);e||(e=new X(this),this.je(e)),this.ck||(this.ck=new E.c(E.c.CreationFuncForMeshes,w,p));const r=this.getWorldExtends();return this.ck.update(r.min,r.max,this.meshes),this.ck},Object.defineProperty(r.c.prototype,"selectionOctree",{get:function(){return this.ck},enumerable:!0,configurable:!0}),d.b.prototype.createOrUpdateSubmeshesOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const e=this.iw();let r=e._getComponent(q.d.NAME_OCTREE);r||(r=new X(e),e.je(r)),this._submeshesOctree||(this._submeshesOctree=new E.c(E.c.CreationFuncForSubMeshes,w,p)),this.ke(!0);const I=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(I.minimumWorld,I.maximumWorld,this.oe),this._submeshesOctree};class X{constructor(w){this.name=q.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new f.c(I.k.Zero(),new I.k(1,1,1)),(w=w||j.d.LastCreatedScene)&&(this.yp=w,this.yp.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yp.getActiveSubMeshCandidates=w=>this.getActiveSubMeshCandidates(w),this.yp.getCollidingSubMeshCandidates=(w,p)=>this.getCollidingSubMeshCandidates(w,p),this.yp.getIntersectingSubMeshCandidates=(w,p)=>this.getIntersectingSubMeshCandidates(w,p))}register(){this.yp.onMeshRemovedObservable.add((w=>{const p=this.yp.selectionOctree;if(void 0!==p&&null!==p){const e=p.Ok.indexOf(w);-1!==e&&p.Ok.splice(e,1)}})),this.yp.onMeshImportedObservable.add((w=>{const p=this.yp.selectionOctree;void 0!==p&&null!==p&&p.tX(w)}))}getActiveMeshCandidates(){var w;return(null===(w=this.yp.ck)||void 0===w?void 0:w.select(this.yp.frustumPlanes))||this.yp._getDefaultMeshCandidates()}getActiveSubMeshCandidates(w){if(w._submeshesOctree&&w.useOctreeForRenderingSelection){return w._submeshesOctree.select(this.yp.frustumPlanes)}return this.yp._getDefaultSubMeshCandidates(w)}getIntersectingSubMeshCandidates(w,p){if(w._submeshesOctree&&w.useOctreeForPicking){f.c.TransformToRef(p,w.getWorldMatrix(),this._tempRay);return w._submeshesOctree.intersectsRay(this._tempRay)}return this.yp._getDefaultSubMeshCandidates(w)}getCollidingSubMeshCandidates(w,p){if(w._submeshesOctree&&w.useOctreeForCollisions){const e=p._velocityWorldLength+Math.max(p._radius.x,p._radius.y,p._radius.z);return w._submeshesOctree.intersects(p._basePointWorld,e)}return this.yp._getDefaultSubMeshCandidates(w)}rebuild(){}dispose(){}}},12527:(w,p,e)=>{"use strict";e.d(p,{c:()=>J});var r=e(11590),I=e(11374),d=e(11027),f=e(11023),q=e(11030),E=e(11256),j=e(11354),X=e(11051),k=e(11632);const m={internalPickerForMesh:void 0};class J{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.c;this.origin=w,this.direction=p,this.length=e,this.epsilon=r}clone(){return new J(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=J._TmpVector3[0].te(w.x-e,w.y-e,w.z-e),I=J._TmpVector3[1].te(p.x+e,p.y+e,p.z+e);let d,f,q,E,j=0,X=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<r.x||this.origin.x>I.x)return!1}else if(d=1/this.direction.x,f=(r.x-this.origin.x)*d,q=(I.x-this.origin.x)*d,q===-1/0&&(q=1/0),f>q&&(E=f,f=q,q=E),j=Math.max(f,j),X=Math.min(q,X),j>X)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<r.y||this.origin.y>I.y)return!1}else if(d=1/this.direction.y,f=(r.y-this.origin.y)*d,q=(I.y-this.origin.y)*d,q===-1/0&&(q=1/0),f>q&&(E=f,f=q,q=E),j=Math.max(f,j),X=Math.min(q,X),j>X)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<r.z||this.origin.z>I.z)return!1}else if(d=1/this.direction.z,f=(r.z-this.origin.z)*d,q=(I.z-this.origin.z)*d,q===-1/0&&(q=1/0),f>q&&(E=f,f=q,q=E),j=Math.max(f,j),X=Math.min(q,X),j>X)return!1;return!0}intersectsBox(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(w.minimum,w.maximum,p)}intersectsSphere(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=w.center.x-this.origin.x,r=w.center.y-this.origin.y,I=w.center.z-this.origin.z,d=e*e+r*r+I*I,f=w.radius+p,q=f*f;if(d<=q)return!0;const E=e*this.direction.x+r*this.direction.y+I*this.direction.z;if(E<0)return!1;return d-E*E<=q}intersectsTriangle(w,p,e){const r=J._TmpVector3[0],I=J._TmpVector3[1],d=J._TmpVector3[2],q=J._TmpVector3[3],j=J._TmpVector3[4];p.subtractToRef(w,r),e.subtractToRef(w,I),f.k.CrossToRef(this.direction,I,d);const X=f.k.Dot(r,d);if(0===X)return null;const k=1/X;this.origin.subtractToRef(w,q);const m=f.k.Dot(q,d)*k;if(m<-this.epsilon||m>1+this.epsilon)return null;f.k.CrossToRef(q,r,j);const K=f.k.Dot(this.direction,j)*k;if(K<-this.epsilon||m+K>1+this.epsilon)return null;const y=f.k.Dot(I,j)*k;return y>this.length?null:new E.c(1-m-K,m,y)}intersectsPlane(w){let p;const e=f.k.Dot(w.dp,this.direction);if(Math.abs(e)<9.99999997475243e-7)return null;{const r=f.k.Dot(w.dp,this.origin);return p=(-w.d-r)/e,p<0?p<-9.99999997475243e-7?null:0:p}}intersectsAxis(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(w){case"y":{const w=(this.origin.y-p)/this.direction.y;return w>0?null:new f.k(this.origin.x+this.direction.x*-w,p,this.origin.z+this.direction.z*-w)}case"x":{const w=(this.origin.x-p)/this.direction.x;return w>0?null:new f.k(p,this.origin.y+this.direction.y*-w,this.origin.z+this.direction.z*-w)}case"z":{const w=(this.origin.z-p)/this.direction.z;return w>0?null:new f.k(this.origin.x+this.direction.x*-w,this.origin.y+this.direction.y*-w,p)}default:return null}}intersectsMesh(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=f.d.Matrix[0];return w.getWorldMatrix().invertToRef(q),this._tmpRay?J.TransformToRef(this,q,this._tmpRay):this._tmpRay=J.Transform(this,q),w.intersects(this._tmpRay,p,e,r,I,d)}intersectsMeshes(w,p,e){e?e.length=0:e=[];for(let r=0;r<w.length;r++){const I=this.intersectsMesh(w[r],p);I.hit&&e.push(I)}return e.sort(this._comparePickingInfo),e}_comparePickingInfo(w,p){return w.distance<p.distance?-1:w.distance>p.distance?1:0}intersectionSegment(w,p,e){const r=this.origin,I=f.d.ne[0],d=f.d.ne[1],q=f.d.ne[2],E=f.d.ne[3];p.subtractToRef(w,I),this.direction.scaleToRef(J._Rayl,q),r.addToRef(q,d),w.subtractToRef(r,E);const j=f.k.Dot(I,I),X=f.k.Dot(I,q),k=f.k.Dot(q,q),m=f.k.Dot(I,E),K=f.k.Dot(q,E),y=j*k-X*X;let c,s,O=y,a=y;y<J._Smallnum?(c=0,O=1,s=K,a=k):(c=X*K-k*m,s=j*K-X*m,c<0?(c=0,s=K,a=k):c>O&&(c=O,s=K+X,a=k)),s<0?(s=0,-m<0?c=0:-m>j?c=O:(c=-m,O=j)):s>a&&(s=a,-m+X<0?c=0:-m+X>j?c=O:(c=-m+X,O=j));const A=Math.abs(c)<J._Smallnum?0:c/O,z=Math.abs(s)<J._Smallnum?0:s/a,M=f.d.ne[4];q.scaleToRef(z,M);const i=f.d.ne[5];I.scaleToRef(A,i),i.addInPlace(E);const t=f.d.ne[6];i.subtractToRef(M,t);return z>0&&z<=this.length&&t.lengthSquared()<e*e?i.length():-1}update(w,p,e,r,I,d,q){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){J._RayDistant||(J._RayDistant=J.Zero()),J._RayDistant.unprojectRayToRef(w,p,e,r,f.b.IdentityReadOnly,d,q);const E=f.d.Matrix[0];I.invertToRef(E),J.TransformToRef(J._RayDistant,E,this)}else this.unprojectRayToRef(w,p,e,r,I,d,q);return this}static Zero(){return new J(f.k.Zero(),f.k.Zero())}static CreateNew(w,p,e,r,I,d,f){return J.Zero().update(w,p,e,r,I,d,f)}static CreateNewFromTo(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.IdentityReadOnly;const r=new J(new f.k(0,0,0),new f.k(0,0,0));return J.CreateFromToToRef(w,p,r,e)}static CreateFromToToRef(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.b.IdentityReadOnly;e.origin.X(w);const I=p.subtractToRef(w,e.direction),d=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);return e.length=d,e.direction.normalize(),J.TransformToRef(e,r,e)}static Transform(w,p){const e=new J(new f.k(0,0,0),new f.k(0,0,0));return J.TransformToRef(w,p,e),e}static TransformToRef(w,p,e){f.k.TransformCoordinatesToRef(w.origin,p,e.origin),f.k.TransformNormalToRef(w.direction,p,e.direction),e.length=w.length,e.epsilon=w.epsilon;const r=e.direction,I=r.length();if(0!==I&&1!==I){const w=1/I;r.x*=w,r.y*=w,r.z*=w,e.length*=I}return e}unprojectRayToRef(w,p,e,r,I,d,q){const E=f.d.Matrix[0];I.multiplyToRef(d,E),E.multiplyToRef(q,E),E.invert();const j=X.d.LastCreatedEngine,k=f.d.ne[0];k.x=w/e*2-1,k.y=-(p/r*2-1),k.z=null!==j&&void 0!==j&&j.useReverseDepthBuffer?1:null!==j&&void 0!==j&&j.isNDCHalfZRange?0:-1;const m=f.d.ne[1].te(k.x,k.y,1-1e-8),J=f.d.ne[2],K=f.d.ne[3];f.k._UnprojectFromInvertedMatrixToRef(k,E,J),f.k._UnprojectFromInvertedMatrixToRef(m,E,K),this.origin.X(J),K.subtractToRef(J,this.direction),this.direction.normalize()}}function K(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=J.Zero();return y(w,p,e,r,f,I,d),f}function y(w,p,e,r,I,d){let q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const j=w.getEngine();if(!d&&!(d=w.activeCamera))return w;const X=d.viewport,k=j.getRenderHeight(),{x:m,y:J,width:K,height:y}=X.toGlobal(j.getRenderWidth(),k),c=1/j.getHardwareScalingLevel();return p=p*c-m,e=e*c-(k-J-y),I.update(p,e,K,y,r||f.b.IdentityReadOnly,q?f.b.IdentityReadOnly:d.getViewMatrix(),d.getProjectionMatrix(),E),w}function c(w,p,e,r,I){if(!j.d)return w;const d=w.getEngine();if(!I&&!(I=w.activeCamera))throw new Error("Active camera not set");const q=I.viewport,E=d.getRenderHeight(),{x:X,y:k,width:m,height:J}=q.toGlobal(d.getRenderWidth(),E),K=f.b.Identity(),y=1/d.getHardwareScalingLevel();return p=p*y-X,e=e*y-(E-k-J),r.update(p,e,m,J,K,K,I.getProjectionMatrix()),w}function s(w,p,e,r,I,d,f,q){const E=p(r,e.enableDistantPicking),j=e.intersects(E,I,f,d,r,q);return j&&j.hit?!I&&null!=w&&j.distance>=w.distance?null:j:null}function O(w,p,e,r,I,d){let q=null;const E=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),X=w.cameraToUseForPointers||w.activeCamera,k=m.internalPickerForMesh||s;for(let j=0;j<w.meshes.length;j++){const m=w.meshes[j];if(e){if(!e(m,-1))continue}else if(!m.isEnabled()||!m.isVisible||!m.kj)continue;const J=E&&m.isWorldMatrixCameraDependent(),K=m.ke(J,X);if(m.hasThinInstances&&m.thinInstanceEnablePicking){const w=k(q,p,m,K,!0,!0,d);if(w){if(I)return w;const E=f.d.Matrix[1],j=m.thinInstanceGetWorldMatrices();for(let w=0;w<j.length;w++){if(e&&!e(m,w))continue;j[w].multiplyToRef(K,E);const f=k(q,p,m,E,r,I,d,!0);if(f&&(q=f,q.thinInstanceIndex=w,r))return q}}}else{const w=k(q,p,m,K,r,I,d);if(w&&(q=w,r))return q}}return q||new j.d}function a(w,p,e,r){if(!j.d)return null;const I=[],d=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),q=w.cameraToUseForPointers||w.activeCamera,E=m.internalPickerForMesh||s;for(let j=0;j<w.meshes.length;j++){const X=w.meshes[j];if(e){if(!e(X,-1))continue}else if(!X.isEnabled()||!X.isVisible||!X.kj)continue;const k=d&&X.isWorldMatrixCameraDependent(),m=X.ke(k,q);if(X.hasThinInstances&&X.thinInstanceEnablePicking){if(E(null,p,X,m,!0,!0,r)){const w=f.d.Matrix[1],d=X.thinInstanceGetWorldMatrices();for(let f=0;f<d.length;f++){if(e&&!e(X,f))continue;d[f].multiplyToRef(m,w);const q=E(null,p,X,w,!1,!1,r,!0);q&&(q.thinInstanceIndex=f,I.push(q))}}}else{const w=E(null,p,X,m,!1,!1,r);w&&I.push(w)}}return I}function A(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;r||(r=w.getWorldMatrix()),p.length=e,I?p.origin.X(I):p.origin.X(w.position);const d=f.d.ne[2];d.set(0,0,w._scene.useRightHandedSystem?-1:1);const q=f.d.ne[3];return f.k.TransformNormalToRef(d,r,q),f.k.NormalizeToRef(q,p.direction),p}var z,M;J._TmpVector3=(0,q.d)(6,f.k.Zero),J._RayDistant=J.Zero(),J._Smallnum=1e-8,J._Rayl=1e9,z=r.c,(M=I.d)&&(M.prototype.getForwardRay=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;return A(this,new J(f.k.Zero(),f.k.Zero(),w),w,p,e)},M.prototype.getForwardRayToRef=function(w){return A(this,w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),z&&(k.e._IsPickingAvailable=!0,z.prototype.createPickingRay=function(w,p,e,r){return K(this,w,p,e,r,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),r.c.prototype.createPickingRayToRef=function(w,p,e,r,I){return y(this,w,p,e,r,I,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},r.c.prototype.createPickingRayInCameraSpace=function(w,p,e){return function(w,p,e,r){const I=J.Zero();return c(w,p,e,I,r),I}(this,w,p,e)},r.c.prototype.createPickingRayInCameraSpaceToRef=function(w,p,e,r){return c(this,w,p,e,r)},r.c.prototype.pickWithBoundingInfo=function(w,p,e,r,I){return function(w,p,e,r,I,d){if(!j.d)return null;const q=O(w,(r=>(w._tempPickingRay||(w._tempPickingRay=J.Zero()),y(w,p,e,r,w._tempPickingRay,d||null),w._tempPickingRay)),r,I,!0);return q&&(q.ray=K(w,p,e,f.b.Identity(),d||null)),q}(this,w,p,e,r,I)},r.c.prototype.Xe=function(w,p,e,r,I,d){return function(w,p,e,r,I,d,q){const E=O(w,((r,I)=>(w._tempPickingRay||(w._tempPickingRay=J.Zero()),y(w,p,e,r,w._tempPickingRay,d||null,!1,I),w._tempPickingRay)),r,I,!1,q);return E&&(E.ray=K(w,p,e,f.b.Identity(),d||null)),E}(this,w,p,e,r,I,d)},r.c.prototype.pickWithRay=function(w,p,e,r){return function(w,p,e,r,I){const d=O(w,(e=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=f.b.Identity()),e.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=J.Zero()),J.TransformToRef(p,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),e,r,!1,I);return d&&(d.ray=p),d}(this,w,p,e,r)},r.c.prototype.multiPick=function(w,p,e,r,I){return function(w,p,e,r,I,d){return a(w,(r=>K(w,p,e,r,I||null)),r,d)}(this,w,p,e,r,I)},r.c.prototype.multiPickWithRay=function(w,p,e){return function(w,p,e,r){return a(w,(e=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=f.b.Identity()),e.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=J.Zero()),J.TransformToRef(p,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),e,r)}(this,w,p,e)}},12835:(w,p,e)=>{"use strict";var r=e(11161),I=e(11081),d=e(11107),f=e(11190),q=e(11132),E=e(11173);q.d.prototype._partialLoadFile=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(w,(w=>{e[p]=w,e._internalCount++,6===e._internalCount&&r(e)}),void 0,void 0,!0,((w,p)=>{I&&w&&I(w.status+" "+w.statusText,p)}))},q.d.prototype._cascadeLoadFiles=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=[];I._internalCount=0;for(let d=0;d<6;d++)this._partialLoadFile(e[d],d,I,p,r)},q.d.prototype._cascadeLoadImgs=function(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5?arguments[5]:void 0;const f=[];f._internalCount=0;for(let q=0;q<6;q++)this._partialLoadImg(r[q],q,f,w,p,e,I,d)},q.d.prototype._partialLoadImg=function(w,p,e,r,I,q){let E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0;const X=(0,f.b)();(0,d.u)(w,(w=>{e[p]=w,e._internalCount++,r&&r.removePendingData(X),6===e._internalCount&&q&&q(I,e)}),((w,p)=>{r&&r.removePendingData(X),E&&E(w,p)}),r?r.offlineProvider:null,j),r&&r.addPendingData(X)},q.d.prototype.createCubeTextureBase=function(w,p,e,d){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,s=arguments.length>14&&void 0!==arguments[14]&&arguments[14],O=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const a=K||new r.d(this,7);a.isCube=!0,a.url=w,a.generateMipMaps=!d,a._lodGenerationScale=m,a._lodGenerationOffset=J,a._useSRGBBuffer=!!s&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!d),a!==K&&(a.label=w.substring(0,60)),this._doNotHandleContextLost||(a._extension=X,a._files=e,a._buffer=O);const A=w;this._transformTextureUrl&&!K&&(w=this._transformTextureUrl(w));const z=X??function(w){const p=w.split("?")[0],e=p.lastIndexOf(".");return e>-1?p.substring(e).toLowerCase():""}(w),M=(0,E.b)(z),i=(w,p)=>{a.dispose(),q?q(w,p):w&&I.c.Warn(w)},t=(r,q)=>{w===A?r&&i(r.status+" "+r.statusText,q):(I.c.Warn(`Failed to load ${w}, falling back to the ${A}`),this.createCubeTextureBase(A,p,e,!!d,f,i,j,X,k,m,J,a,y,c,s,O))};if(M)M.then((r=>{const I=w=>{y&&y(a,w),r.loadCubeData(w,a,k,f,((w,p)=>{i(w,p)}))};O?I(O):e&&6===e.length?r.supportCascades?this._cascadeLoadFiles(p,(w=>I(w.map((w=>new Uint8Array(w))))),e,i):i("Textures type does not support cascades."):this._loadFile(w,(w=>I(new Uint8Array(w))),void 0,void 0,!0,t)}));else{if(!e||0===e.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(p,a,((w,p)=>{c&&c(w,p)}),e,i)}return this._internalTexturesCache.push(a),a}},13434:(w,p,e)=>{"use strict";e(11081);var r=e(11411);e(11161),e(11240),e(11047),e(11464),e(11419);r.e},12867:(w,p,e)=>{"use strict";e.d(p,{b:()=>I});var r=e(11038);class I{constructor(w){this.value=this._toInt(w)}_toInt(w){return 0|w}add(w){return new I(this.value+w.value)}Je(w){return new I(this.value-w.value)}multiply(w){return new I(Math.imul(this.value,w.value))}divide(w){return new I(this.value/w.value)}getClassName(){return I.ClassName}equals(w){return this.value===w.value}static FromValue(w){return new I(w)}toString(){return this.value.toString()}}I.ClassName="FlowGraphInteger",(0,r.d)("FlowGraphInteger",I)},12878:(w,p,e)=>{"use strict";e.d(p,{e:()=>I,g:()=>d});var r=e(11023);class I{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.gm=w}get m(){return this.gm}transformVector(w){return this.transformVectorToRef(w,new r.g)}transformVectorToRef(w,p){return p.x=w.x*this.gm[0]+w.y*this.gm[1],p.y=w.x*this.gm[2]+w.y*this.gm[3],p}ze(){return this.toArray()}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<4;p++)w[p]=this.gm[p];return w}ye(w){for(let p=0;p<4;p++)this.gm[p]=w[p];return this}multiplyToRef(w,p){const e=w.gm,r=this.gm,I=p.gm;return I[0]=e[0]*r[0]+e[1]*r[2],I[1]=e[0]*r[1]+e[1]*r[3],I[2]=e[2]*r[0]+e[3]*r[2],I[3]=e[2]*r[1]+e[3]*r[3],p}multiply(w){return this.multiplyToRef(w,new I)}divideToRef(w,p){const e=this.gm,r=w.gm,I=p.gm;return I[0]=e[0]/r[0],I[1]=e[1]/r[1],I[2]=e[2]/r[2],I[3]=e[3]/r[3],p}divide(w){return this.divideToRef(w,new I)}addToRef(w,p){const e=this.gm,r=w.m,I=p.m;return I[0]=e[0]+r[0],I[1]=e[1]+r[1],I[2]=e[2]+r[2],I[3]=e[3]+r[3],p}add(w){return this.addToRef(w,new I)}subtractToRef(w,p){const e=this.gm,r=w.m,I=p.m;return I[0]=e[0]-r[0],I[1]=e[1]-r[1],I[2]=e[2]-r[2],I[3]=e[3]-r[3],p}Je(w){return this.subtractToRef(w,new I)}transpose(){const w=this.gm;return new I([w[0],w[2],w[1],w[3]])}determinant(){const w=this.gm;return w[0]*w[3]-w[1]*w[2]}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const p=this.gm,e=1/w;return new I([p[3]*e,-p[1]*e,-p[2]*e,p[0]*e])}equals(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.gm,r=w.m;return 0===p?e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]:Math.abs(e[0]-r[0])<p&&Math.abs(e[1]-r[1])<p&&Math.abs(e[2]-r[2])<p&&Math.abs(e[3]-r[3])<p}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.gm.join(", ")})`}}class d{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.gm=w}get m(){return this.gm}transformVector(w){return this.transformVectorToRef(w,new r.k)}transformVectorToRef(w,p){const e=this.gm;return p.x=w.x*e[0]+w.y*e[1]+w.z*e[2],p.y=w.x*e[3]+w.y*e[4]+w.z*e[5],p.z=w.x*e[6]+w.y*e[7]+w.z*e[8],p}multiplyToRef(w,p){const e=w.gm,r=this.gm,I=p.m;return I[0]=e[0]*r[0]+e[1]*r[3]+e[2]*r[6],I[1]=e[0]*r[1]+e[1]*r[4]+e[2]*r[7],I[2]=e[0]*r[2]+e[1]*r[5]+e[2]*r[8],I[3]=e[3]*r[0]+e[4]*r[3]+e[5]*r[6],I[4]=e[3]*r[1]+e[4]*r[4]+e[5]*r[7],I[5]=e[3]*r[2]+e[4]*r[5]+e[5]*r[8],I[6]=e[6]*r[0]+e[7]*r[3]+e[8]*r[6],I[7]=e[6]*r[1]+e[7]*r[4]+e[8]*r[7],I[8]=e[6]*r[2]+e[7]*r[5]+e[8]*r[8],p}multiply(w){return this.multiplyToRef(w,new d)}divideToRef(w,p){const e=this.gm,r=w.m,I=p.m;return I[0]=e[0]/r[0],I[1]=e[1]/r[1],I[2]=e[2]/r[2],I[3]=e[3]/r[3],I[4]=e[4]/r[4],I[5]=e[5]/r[5],I[6]=e[6]/r[6],I[7]=e[7]/r[7],I[8]=e[8]/r[8],p}divide(w){return this.divideToRef(w,new d)}addToRef(w,p){const e=this.gm,r=w.m,I=p.m;return I[0]=e[0]+r[0],I[1]=e[1]+r[1],I[2]=e[2]+r[2],I[3]=e[3]+r[3],I[4]=e[4]+r[4],I[5]=e[5]+r[5],I[6]=e[6]+r[6],I[7]=e[7]+r[7],I[8]=e[8]+r[8],p}add(w){return this.addToRef(w,new d)}subtractToRef(w,p){const e=this.gm,r=w.m,I=p.m;return I[0]=e[0]-r[0],I[1]=e[1]-r[1],I[2]=e[2]-r[2],I[3]=e[3]-r[3],I[4]=e[4]-r[4],I[5]=e[5]-r[5],I[6]=e[6]-r[6],I[7]=e[7]-r[7],I[8]=e[8]-r[8],p}Je(w){return this.subtractToRef(w,new d)}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<9;p++)w[p]=this.gm[p];return w}ze(){return this.toArray()}ye(w){for(let p=0;p<9;p++)this.gm[p]=w[p];return this}transpose(){const w=this.gm;return new d([w[0],w[3],w[6],w[1],w[4],w[7],w[2],w[5],w[8]])}determinant(){const w=this.gm;return w[0]*(w[4]*w[8]-w[5]*w[7])-w[1]*(w[3]*w[8]-w[5]*w[6])+w[2]*(w[3]*w[7]-w[4]*w[6])}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const p=this.gm,e=1/w;return new d([(p[4]*p[8]-p[5]*p[7])*e,(p[2]*p[7]-p[1]*p[8])*e,(p[1]*p[5]-p[2]*p[4])*e,(p[5]*p[6]-p[3]*p[8])*e,(p[0]*p[8]-p[2]*p[6])*e,(p[2]*p[3]-p[0]*p[5])*e,(p[3]*p[7]-p[4]*p[6])*e,(p[1]*p[6]-p[0]*p[7])*e,(p[0]*p[4]-p[1]*p[3])*e])}equals(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.gm,r=w.m;return 0===p?e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]:Math.abs(e[0]-r[0])<p&&Math.abs(e[1]-r[1])<p&&Math.abs(e[2]-r[2])<p&&Math.abs(e[3]-r[3])<p&&Math.abs(e[4]-r[4])<p&&Math.abs(e[5]-r[5])<p&&Math.abs(e[6]-r[6])<p&&Math.abs(e[7]-r[7])<p&&Math.abs(e[8]-r[8])<p}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.gm.join(", ")})`}}},12887:(w,p,e)=>{"use strict";var r;function I(w,p,e,r){switch(p){case"Animation":return r?w.animations.find((w=>w.uniqueId===e))??null:w.animations[e]??null;case"AnimationGroup":return r?w.animationGroups.find((w=>w.uniqueId===e))??null:w.animationGroups[e]??null;case"Mesh":return r?w.meshes.find((w=>w.uniqueId===e))??null:w.meshes[e]??null;case"Material":return r?w.materials.find((w=>w.uniqueId===e))??null:w.materials[e]??null;case"hX":return r?w.cameras.find((w=>w.uniqueId===e))??null:w.cameras[e]??null;case"Light":return r?w.lights.find((w=>w.uniqueId===e))??null:w.lights[e]??null;default:return null}}e.d(p,{e:()=>I}),function(w){w.Animation="Animation",w.AnimationGroup="AnimationGroup",w.Mesh="Mesh",w.Material="Material",w.hX="hX",w.Light="Light"}(r||(r={}))},12912:(w,p,e)=>{"use strict";e.d(p,{d:()=>I});var r=e(12920);class I extends r.c{constructor(w,p){if(super(w),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),p)for(const e of p)this._eventsSignalOutputs[e]=this._registerSignalOutput(e+"Event")}_executeOnTick(w){}_startPendingTasks(w){w._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(w),this._resetAfterCanceled(w)),this._preparePendingTasks(w),w._addPendingBlock(this),this.out._activateSignal(w),w._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(w){w._deleteExecutionVariable(this,"_initialized"),w._removePendingBlock(this)}}},12893:(w,p,e)=>{"use strict";e.d(p,{e:()=>j});var r=e(11190),I=e(11038),d=e(12899),f=e(11056),q=e(12861);class E extends d.c{constructor(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.defaultValue,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(w,p,e),this.richType=r,this._defaultValue=I,this._optional=d,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new f.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(w){this._isDisabled!==w&&(this._isDisabled=w,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(w,p){p._getConnectionValue(this)!==w&&(p._setConnectionValue(this,w),this.onValueChangedObservable.notifyObservers(w))}resetToDefaultValue(w){w._setConnectionValue(this,this._defaultValue)}connectTo(w){this._isDisabled||super.connectTo(w)}_getValueOrDefault(w){const p=w._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(p):p}getValue(w){if(1===this.connectionType){w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(w);const p=this._getValueOrDefault(w);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}const p=this.isConnected()?this._connectedPoint[0].getValue(w):this._getValueOrDefault(w);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.richType={},this.richType.serialize(w.richType),w.optional=this._optional,(0,q.g)("defaultValue",this._defaultValue,w)}}(0,I.d)("FlowGraphDataConnection",E);class j{constructor(w){var p;this.config=w,this.uniqueId=(0,r.b)(),this.name=(null===(p=this.config)||void 0===p?void 0:p.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(w){}registerDataInput(w,p,e){const r=new E(w,0,this,p,e);return this.dataInputs.push(r),r}registerDataOutput(w,p,e){const r=new E(w,1,this,p,e);return this.dataOutputs.push(r),r}getDataInput(w){return this.dataInputs.find((p=>p.name===w))}getDataOutput(w){return this.dataOutputs.find((p=>p.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.g;if(w.uniqueId=this.uniqueId,w.config={},this.config){const e=this.config,r=Object.keys(e);for(const I of r)p(I,e[I],w.config)}w.dataInputs=[],w.dataOutputs=[],w.className=this.getClassName();for(const e of this.dataInputs){const p={};e.serialize(p),w.dataInputs.push(p)}for(const e of this.dataOutputs){const p={};e.serialize(p),w.dataOutputs.push(p)}}deserialize(w){}_log(w,p,e){var r;null===(r=w.logger)||void 0===r||r.addLogItem({action:p,payload:e,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12899:(w,p,e)=>{"use strict";e.d(p,{c:()=>d});var r,I=e(11190);!function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(r||(r={}));class d{constructor(w,p,e){this._ownerBlock=e,this._connectedPoint=[],this.uniqueId=(0,I.b)(),this.connectedPointIds=[],this.name=w,this._connectionType=p}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(w){if(this._connectionType===w._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||w._isSingularConnection()&&w._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(w),w._connectedPoint.push(this)}disconnectFrom(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this._connectedPoint.indexOf(w),r=w._connectedPoint.indexOf(this);-1!==e&&-1!==r&&(p&&this._connectedPoint.splice(e,1),w._connectedPoint.splice(r,1))}disconnectFromAll(){for(const w of this._connectedPoint)this.disconnectFrom(w,!1);this._connectedPoint.length=0}dispose(){for(const w of this._connectedPoint)this.disconnectFrom(w)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.uniqueId=this.uniqueId,w.name=this.name,w._connectionType=this._connectionType,w.connectedPointIds=[],w.className=this.getClassName();for(const p of this._connectedPoint)w.connectedPointIds.push(p.uniqueId)}getClassName(){return"FGConnection"}deserialize(w){this.uniqueId=w.uniqueId,this.name=w.name,this._connectionType=w._connectionType,this.connectedPointIds=w.connectedPointIds}}},12854:(w,p,e)=>{"use strict";e.d(p,{c:()=>a});var r,I=e(11056),d=e(11207),f=e(11213),q=e(11190),E=e(12861),j=e(12887),X=e(11081);!function(w){w.ExecuteBlock="ExecuteBlock",w.ExecuteEvent="ExecuteEvent",w.TriggerConnection="TriggerConnection",w.ContextVariableSet="ContextVariableSet",w.GlobalVariableSet="GlobalVariableSet",w.GlobalVariableDelete="GlobalVariableDelete",w.GlobalVariableGet="GlobalVariableGet",w.AddConnection="AddConnection",w.GetConnectionValue="GetConnectionValue",w.SetConnectionValue="SetConnectionValue",w.ActivateSignal="ActivateSignal",w.ContextVariableGet="ContextVariableGet"}(r||(r={}));class k{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(w){if(w.time||(w.time=Date.now()),this.log.push(w),this.logToConsole){var p;const e=null===(p=w.payload)||void 0===p?void 0:p.value;"object"===typeof e&&e.getClassName?X.c.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(e.getClassName())}: ${e.toString()}`):X.c.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(w.payload)}`)}}getItemsOfType(w){return this.log.filter((p=>p.action===w))}}class m{get enableLogging(){return this._enableLogging}set enableLogging(w){this._enableLogging!==w&&(this._enableLogging=w,this._enableLogging?(this.logger=new k,this.logger.logToConsole=!0):this.logger=null)}constructor(w){this.uniqueId=(0,q.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new I.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=w,this.assetsContext=w.assetsContext??w.yp}hasVariable(w){return w in this._userVariables}setVariable(w,p){var e;this._userVariables[w]=p,null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:w,value:p}})}getAsset(w,p){return(0,j.e)(this.assetsContext,w,p)}getVariable(w){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:w,value:this._userVariables[w]}}),this._userVariables[w]}get userVariables(){return this._userVariables}iw(){return this._configuration.yp}_getUniqueIdPrefixedName(w,p){return`${w.uniqueId}_${p}`}_getGlobalContextVariable(w,p){var e;return null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:w,defaultValue:p,possibleValue:this._globalContextVariables[w]}}),this._hasGlobalContextVariable(w)?this._globalContextVariables[w]:p}_setGlobalContextVariable(w,p){var e;null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:w,value:p}}),this._globalContextVariables[w]=p}_deleteGlobalContextVariable(w){var p;null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:w}}),delete this._globalContextVariables[w]}_hasGlobalContextVariable(w){return w in this._globalContextVariables}_setExecutionVariable(w,p,e){this._executionVariables[this._getUniqueIdPrefixedName(w,p)]=e}_getExecutionVariable(w,p,e){return this._hasExecutionVariable(w,p)?this._executionVariables[this._getUniqueIdPrefixedName(w,p)]:e}_deleteExecutionVariable(w,p){delete this._executionVariables[this._getUniqueIdPrefixedName(w,p)]}_hasExecutionVariable(w,p){return this._getUniqueIdPrefixedName(w,p)in this._executionVariables}_hasConnectionValue(w){return w.uniqueId in this._connectionValues}_setConnectionValue(w,p){var e;this._connectionValues[w.uniqueId]=p,null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:w.uniqueId,value:p}})}_setConnectionValueByKey(w,p){this._connectionValues[w]=p}_getConnectionValue(w){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:w.uniqueId,value:this._connectionValues[w.uniqueId]}}),this._connectionValues[w.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(w){this._pendingBlocks.includes(w)||(this._pendingBlocks.push(w),this._pendingBlocks.sort(((w,p)=>w.priority-p.priority)))}_removePendingBlock(w){const p=this._pendingBlocks.indexOf(w);-1!==p&&this._pendingBlocks.splice(p,1)}_clearPendingBlocks(){for(const w of this._pendingBlocks)w._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(w){var p;this.onNodeExecutedObservable.notifyObservers(w),null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:w.getClassName(),uniqueId:w.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(w){this._setGlobalContextVariable("timeSinceStart",w.timeSinceStart),this._setGlobalContextVariable("deltaTime",w.deltaTime);for(const e of this._pendingBlocks){var p;null===(p=e._executeOnTick)||void 0===p||p.call(e,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.g;w.uniqueId=this.uniqueId,w._userVariables={};for(const r in this._userVariables)p(r,this._userVariables[r],w._userVariables);w._connectionValues={};for(const r in this._connectionValues)p(r,this._connectionValues[r],w._connectionValues);var e;this.assetsContext!==this.iw()&&(w._assetsContext={meshes:this.assetsContext.meshes.map((w=>w.id)),materials:this.assetsContext.materials.map((w=>w.id)),textures:this.assetsContext.textures.map((w=>w.name)),animations:this.assetsContext.animations.map((w=>w.name)),lights:this.assetsContext.lights.map((w=>w.id)),cameras:this.assetsContext.cameras.map((w=>w.id)),fJ:null===(e=this.assetsContext.fJ)||void 0===e?void 0:e.map((w=>w.name)),skeletons:this.assetsContext.skeletons.map((w=>w.id)),tm:this.assetsContext.tm.map((w=>w.name)),geometries:this.assetsContext.geometries.map((w=>w.id)),multiMaterials:this.assetsContext.multiMaterials.map((w=>w.id)),transformNodes:this.assetsContext.transformNodes.map((w=>w.id))})}getClassName(){return"FlowGraphContext"}}(0,d.c)([(0,f.J)()],m.prototype,"uniqueId",void 0);var J=e(12891),K=e(11611);class y{constructor(w){this.onEventTriggeredObservable=new I.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=w,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.ue.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const w=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:w}}),this._startingTime+=w})),this._meshPickedObserver=this._scene.onPointerObservable.add((w=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:w})}),K.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((w=>{const p=w.pointerId,e=w.mesh,r=this._pointerUnderMeshState[p];!r&&e?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:p,mesh:e}}):r&&!e?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:p,mesh:r}}):r&&e&&r!==e&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:p,mesh:r,over:e}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:p,mesh:e,out:r}})),this._pointerUnderMeshState[p]=e}),K.c.POINTERMOVE)}dispose(){var w,p,e,r,I;null===(w=this._sceneDisposeObserver)||void 0===w||w.remove(),null===(p=this._sceneReadyObserver)||void 0===p||p.remove(),null===(e=this._sceneOnBeforeRenderObserver)||void 0===e||e.remove(),null===(r=this._meshPickedObserver)||void 0===r||r.remove(),null===(I=this._meshUnderPointerObserver)||void 0===I||I.remove(),this.onEventTriggeredObservable.clear()}}var c,s=e(12905);!function(w){w[w.Stopped=0]="Stopped",w[w.Started=1]="Started"}(c||(c={}));class O{get state(){return this._state}set state(w){this._state=w,this.onStateChangedObservable.notifyObservers(w)}constructor(w){this.onStateChangedObservable=new I.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=w.yp,this._sceneEventCoordinator=new y(this._scene),this._coordinator=w.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((w=>{for(const p of this._executionContexts){const e=this._getContextualOrder(w.type,p);for(const r of e)if(!r._executeEvent(p,w.payload))break}switch(w.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const p of this._executionContexts)p._notifyOnTick(w.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const w=new m({yp:this._scene,coordinator:this._coordinator});return this._executionContexts.push(w),w}getContext(w){return this._executionContexts[w]}addEventBlock(w){if("PointerOver"!==w.type&&"PointerOut"!==w.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==w.type&&this._eventBlocks[w.type].push(w),1===this.state)for(const p of this._executionContexts)w._startPendingTasks(p);else this.onStateChangedObservable.addOnce((p=>{if(1===p)for(const e of this._executionContexts)w._startPendingTasks(e)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((w=>{1===w&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const w of this._executionContexts)for(const p in this._eventBlocks){const e=this._getContextualOrder(p,w);for(const p of e)p._startPendingTasks(w)}}_getContextualOrder(w,p){const e=this._eventBlocks[w].sort(((w,p)=>p.initPriority-w.initPriority));if("MeshPick"===w){const w=[];for(const r of e){const I=r.asset.getValue(p);let d=0;for(;d<e.length;d++){const w=e[d].asset.getValue(p);if(I&&w&&(0,s.k)(I,w))break}w.splice(d,0,r)}return w}return e}dispose(){var w;if(0!==this.state){this.state=0;for(const w of this._executionContexts)w._clearPendingBlocks();this._executionContexts.length=0;for(const w in this._eventBlocks)this._eventBlocks[w].length=0;null===(w=this._eventObserver)||void 0===w||w.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(w){const p=[],e=new Set;for(const r in this._eventBlocks)for(const w of this._eventBlocks[r])p.push(w),e.add(w.uniqueId);for(;p.length>0;){const r=p.pop();w(r);for(const w of r.dataInputs)for(const r of w._connectedPoint)e.has(r._ownerBlock.uniqueId)||(p.push(r._ownerBlock),e.add(r._ownerBlock.uniqueId));if(r instanceof J.b)for(const w of r.signalOutputs)for(const r of w._connectedPoint)e.has(r._ownerBlock.uniqueId)||(p.push(r._ownerBlock),e.add(r._ownerBlock.uniqueId))}}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1?arguments[1]:void 0;w.allBlocks=[],this.visitAllBlocks((p=>{const e={};p.serialize(e),w.allBlocks.push(e)})),w.executionContexts=[];for(const e of this._executionContexts){const r={};e.serialize(r,p),w.executionContexts.push(r)}}}class a{constructor(w){this.config=w,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.yp.ue.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.yp.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const w=this._executeOnNextFrame.slice(0);if(w.length)for(const p of w){this.notifyCustomEvent(p.id,p.data,!1);const w=this._executeOnNextFrame.findIndex((w=>w.uniqueId===p.uniqueId));-1!==w&&this._executeOnNextFrame.splice(w,1)}}));(a.SceneCoordinators.get(this.config.yp)??[]).push(this)}createGraph(){const w=new O({yp:this.config.yp,coordinator:this});return this._flowGraphs.push(w),w}removeGraph(w){const p=this._flowGraphs.indexOf(w);-1!==p&&(w.dispose(),this._flowGraphs.splice(p,1))}start(){for(const w of this._flowGraphs)w.start()}dispose(){var w,p;for(const I of this._flowGraphs)I.dispose();this._flowGraphs.length=0,null===(w=this._disposeObserver)||void 0===w||w.remove(),null===(p=this._onBeforeRenderObserver)||void 0===p||p.remove();const e=a.SceneCoordinators.get(this.config.yp)??[],r=e.indexOf(this);-1!==r&&e.splice(r,1)}serialize(w,p){w._flowGraphs=[];for(const e of this._flowGraphs){const r={};e.serialize(r,p),w._flowGraphs.push(r)}w.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(w){let p=this._customEventsMap.get(w);return p||(p=new I.d,this._customEventsMap.set(w,p)),p}notifyCustomEvent(w,p){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:w,data:p,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(w)){const p=this._eventExecutionCounter.get(w);if(this._eventExecutionCounter.set(w,p+1),p>=a.MaxEventTypeExecutionPerFrame)return void(p===a.MaxEventTypeExecutionPerFrame&&X.c.Warn(`FlowGraphCoordinator: Too many executions of event "${w}".`))}else this._eventExecutionCounter.set(w,1);const e=this._customEventsMap.get(w);e&&e.notifyObservers(p)}}a.MaxEventsPerType=30,a.MaxEventTypeExecutionPerFrame=30,a.SceneCoordinators=new Map},12909:(w,p,e)=>{"use strict";e.d(p,{d:()=>I});var r=e(12912);class I extends r.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(w){w._notifyExecuteNode(this),this.done._activateSignal(w)}}},12891:(w,p,e)=>{"use strict";e.d(p,{b:()=>q});var r=e(12893),I=e(12899),d=e(11038);class f extends I.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(w){super.connectTo(w),this._connectedPoint.sort(((w,p)=>p.priority-w.priority))}_activateSignal(w){var p;if(null===(p=w.logger)||void 0===p||p.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(w,this),w._increaseExecutionId();else for(const e of this._connectedPoint)e._activateSignal(w)}}(0,d.d)("FlowGraphSignalConnection",f);class q extends r.e{constructor(w){super(w),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(w){const p=new f(w,0,this);return this.signalInputs.push(p),p}_registerSignalOutput(w){const p=new f(w,1,this);return this.signalOutputs.push(p),p}_unregisterSignalInput(w){const p=this.signalInputs.findIndex((p=>p.name===w));-1!==p&&(this.signalInputs[p].dispose(),this.signalInputs.splice(p,1))}_unregisterSignalOutput(w){const p=this.signalOutputs.findIndex((p=>p.name===w));-1!==p&&(this.signalOutputs[p].dispose(),this.signalOutputs.splice(p,1))}_reportError(w,p){this.error.payload="string"===typeof p?new Error(p):p,this.error._activateSignal(w)}getSignalInput(w){return this.signalInputs.find((p=>p.name===w))}getSignalOutput(w){return this.signalOutputs.find((p=>p.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.signalInputs=[],w.signalOutputs=[];for(const p of this.signalInputs){const e={};p.serialize(e),w.signalInputs.push(e)}for(const p of this.signalOutputs){const e={};p.serialize(e),w.signalOutputs.push(e)}}deserialize(w){for(let p=0;p<w.signalInputs.length;p++){const e=this.getSignalInput(w.signalInputs[p].name);if(!e)throw new Error("Could not find signal input with name "+w.signalInputs[p].name+" in block "+w.className);e.deserialize(w.signalInputs[p])}for(let p=0;p<w.signalOutputs.length;p++){const e=this.getSignalOutput(w.signalOutputs[p].name);if(!e)throw new Error("Could not find signal output with name "+w.signalOutputs[p].name+" in block "+w.className);e.deserialize(w.signalOutputs[p])}}getClassName(){return"FlowGraphExecutionBlock"}}},12920:(w,p,e)=>{"use strict";e.d(p,{c:()=>I});var r=e(12891);class I extends r.b{constructor(w){super(w),this.out=this._registerSignalOutput("out")}}},12872:(w,p,e)=>{"use strict";e.d(p,{C:()=>y,E:()=>n,H:()=>l,L:()=>t,N:()=>i,c:()=>j,g:()=>m,h:()=>M,i:()=>c,m:()=>s,n:()=>O,o:()=>k,p:()=>z,s:()=>X,v:()=>J,z:()=>K});var r,I=e(11023),d=e(11308),f=e(12867),q=e(12878);!function(w){w.Any="any",w.String="string",w.Number="number",w.Boolean="boolean",w.Object="object",w.Integer="FlowGraphInteger",w.Vector2="Vector2",w.ne="ne",w.Vector4="Vector4",w.Quaternion="Quaternion",w.Matrix="Matrix",w.Matrix2D="Matrix2D",w.Matrix3D="Matrix3D",w.pd="pd",w.ed="ed"}(r||(r={}));class E{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=w,this.defaultValue=p,this.animationType=e}serialize(w){w.typeName=this.typeName,w.defaultValue=this.defaultValue}}const j=new E("any",void 0),X=new E("string",""),k=new E("number",0,0),m=new E("boolean",!1),J=new E("Vector2",I.g.Zero(),5),K=new E("ne",I.k.Zero(),1),y=new E("Vector4",I.o.Zero()),c=new E("Matrix",I.b.Identity(),3),s=new E("Matrix2D",new q.e),O=new E("Matrix3D",new q.g),a=new E("pd",d.b.Black(),4),A=new E("ed",new d.e(0,0,0,0),7),z=new E("Quaternion",I.c.Identity(),2);z.typeTransformer=w=>{if(w.getClassName){if("Vector4"===w.getClassName())return I.c.Ve(w.ze());if("ne"===w.getClassName())return I.c.FromEulerVector(w);if("Matrix"===w.getClassName())return I.c.FromRotationMatrix(w)}return w};const M=new E("FlowGraphInteger",new f.b(0),0);function i(w){const p=w;switch(typeof w){case"string":return X;case"number":return k;case"boolean":return m;case"object":if(p.getClassName)switch(p.getClassName()){case"Vector2":return J;case"ne":return K;case"Vector4":return y;case"Matrix":return c;case"pd":return a;case"ed":return A;case"Quaternion":return z;case"FlowGraphInteger":return M;case"Matrix2D":return s;case"Matrix3D":return O}return j;default:return j}}function t(w){switch(w){case"string":return X;case"number":return k;case"boolean":return m;case"Vector2":return J;case"ne":return K;case"Vector4":return y;case"Matrix":return c;case"pd":return a;case"ed":return A;case"Quaternion":return z;case"FlowGraphInteger":return M;case"Matrix2D":return s;case"Matrix3D":return O;default:return j}}function n(w){switch(w){case"number":default:return 0;case"Vector2":return 5;case"ne":return 1;case"Matrix":return 3;case"pd":return 4;case"ed":return 7;case"Quaternion":return 2}}function l(w){switch(w){case 0:return k;case 5:return J;case 1:return K;case 3:return c;case 4:return a;case 7:return A;case 2:return z;default:return j}}},12861:(w,p,e)=>{"use strict";e.d(p,{c:()=>X,g:()=>j,k:()=>k});var r=e(11308),I=e(11023),d=e(12867),f=e(12872),q=e(12878);function E(w){return"Vector2"===w||"ne"===w||"Vector4"===w||"Quaternion"===w||"pd"===w||"ed"===w}function j(w,p,e){var r;const I=(null===p||void 0===p||null===(r=p.getClassName)||void 0===r?void 0:r.call(p))??"";if(E(I)||function(w){return"Matrix"===w||"Matrix2D"===w||"Matrix3D"===w}(I))e[w]={value:p.ze(),className:I};else if("FlowGraphInteger"===I)e[w]={value:p.value,className:I};else if(I&&(p.id||p.name))e[w]={id:p.id,name:p.name,className:I};else{if("object"===typeof p)throw new Error(`Could not serialize value ${p}`);e[w]=p}}function X(w,p,e,j){const k=p[w];let m;const J=(null===k||void 0===k?void 0:k.type)??(null===k||void 0===k?void 0:k.className);if(function(w){return"Mesh"===w||"AbstractMesh"===w||"GroundMesh"===w||"InstanceMesh"===w||"LinesMesh"===w||"GoldbergMesh"===w||"GreasedLineMesh"===w||"TrailMesh"===w}(J)){let w=j.meshes.filter((w=>k.id?w.id===k.id:w.name===k.name));0===w.length&&(w=j.transformNodes.filter((w=>k.id?w.id===k.id:w.name===k.name))),m=k.uniqueId?w.find((w=>w.uniqueId===k.uniqueId)):w[0]}else if(E(J))m=function(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===w)return I.g.Ve(p);if("ne"===w)return e&&(p[2]*=-1),I.k.Ve(p);if("Vector4"===w)return I.o.Ve(p);if("Quaternion"===w)return e&&(p[2]*=-1,p[3]*=-1),I.c.Ve(p);if("pd"===w)return new r.b(p[0],p[1],p[2]);if("ed"===w)return new r.e(p[0],p[1],p[2],p[3]);throw new Error(`Unknown vector class name ${w}`)}(J,k.value);else if(function(w){return"AnimationGroup"===w}(J)){const w=j.animationGroups.filter((w=>w.name===k.name));m=1===w.length?w[0]:w.find((w=>w.uniqueId===k.uniqueId))}else m="Matrix"===J?I.b.Ve(k.value):"Matrix2D"===J?new q.e(k.value):"Matrix3D"===J?new q.g(k.value):"FlowGraphInteger"===J?d.b.FromValue(k.value):"number"===J||"string"===J||"boolean"===J?k.value[0]:k&&void 0!==k.value?k.value:Array.isArray(k)?k.reduce(((w,p)=>p.eventData?(w[p.id]={type:(0,f.L)(p.type)},"undefined"!==typeof p.value&&(w[p.id].value=X("value",p,e,j)),w):w),{}):k;return m}function k(w){return"FlowGraphJsonPointerParserBlock"===w}},12905:(w,p,e)=>{"use strict";function r(w,p){return!(!w.parent||w.parent!==p&&!r(w.parent,p))}function I(w){if(w.getClassName)return w.getClassName()}function d(w,p){return w===p&&("Vector2"===w||"ne"===w||"Vector4"===w||"Quaternion"===w)}function f(w,p){return w===p&&("Matrix"===w||"Matrix2D"===w||"Matrix3D"===w)}function q(w,p){return"FlowGraphInteger"===w&&"FlowGraphInteger"===p}function E(w,p){const e="number"===typeof w||"number"===typeof(null===w||void 0===w?void 0:w.value);return e&&!p?!isNaN(j(w)):e}function j(w){return"number"===typeof w?w:w.value}e.d(p,{c:()=>q,d:()=>f,h:()=>d,i:()=>I,k:()=>r,n:()=>j,o:()=>E})},12244:(w,p,e)=>{"use strict";e.r(p),e.d(p,{SceneInstrumentation:()=>d});var r=e(11071),I=e(11496);class d{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(w){w!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=w,w?(this._onBeforeActiveMeshesEvaluationObserver=this.yp.onBeforeActiveMeshesEvaluationObservable.add((()=>{r.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yp.onAfterActiveMeshesEvaluationObservable.add((()=>{r.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(w){w!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=w,w?(this._onBeforeRenderTargetsRenderObserver=this.yp.onBeforeRenderTargetsRenderObservable.add((()=>{r.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yp.onAfterRenderTargetsRenderObservable.add((()=>{r.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(w){w!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=w,w?(this._onBeforeParticlesRenderingObserver=this.yp.onBeforeParticlesRenderingObservable.add((()=>{r.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yp.onAfterParticlesRenderingObservable.add((()=>{r.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(w){w!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=w,this.yp.spriteManagers&&(w?(this._onBeforeSpritesRenderingObserver=this.yp.onBeforeSpritesRenderingObservable.add((()=>{r.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yp.onAfterSpritesRenderingObservable.add((()=>{r.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(w){w!==this._capturePhysicsTime&&this.yp.onBeforePhysicsObservable&&(this._capturePhysicsTime=w,w?(this._onBeforePhysicsObserver=this.yp.onBeforePhysicsObservable.add((()=>{r.g.StartPerformanceCounter("kd"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yp.onAfterPhysicsObservable.add((()=>{r.g.EndPerformanceCounter("kd"),this._physicsTime.endMonitoring()}))):(this.yp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(w){w!==this._captureAnimationsTime&&(this._captureAnimationsTime=w,w?this._onAfterAnimationsObserver=this.yp.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(w){this._captureFrameTime=w}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(w){this._captureInterFrameTime=w}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(w){w!==this._captureRenderTime&&(this._captureRenderTime=w,w?(this._onBeforeDrawPhaseObserver=this.yp.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),r.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yp.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),r.g.EndPerformanceCounter("Main render")}))):(this.yp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(w){w!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=w,w?(this._onBeforeCameraRenderObserver=this.yp.onBeforeCameraRenderObservable.add((w=>{this._cameraRenderTime.beginMonitoring(),r.g.StartPerformanceCounter(`Rendering camera ${w.name}`)})),this._onAfterCameraRenderObserver=this.yp.onAfterCameraRenderObservable.add((w=>{this._cameraRenderTime.endMonitoring(!1),r.g.EndPerformanceCounter(`Rendering camera ${w.name}`)}))):(this.yp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yp.getEngine()._drawCalls}constructor(w){this.yp=w,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new I.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new I.d,this._captureFrameTime=!1,this._frameTime=new I.d,this._captureRenderTime=!1,this._renderTime=new I.d,this._captureInterFrameTime=!1,this._interFrameTime=new I.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new I.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new I.d,this._capturePhysicsTime=!1,this._physicsTime=new I.d,this._captureAnimationsTime=!1,this._animationsTime=new I.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new I.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=w.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(r.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yp.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=w.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(r.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Km(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Km(),this._captureParticlesRenderTime&&this._particlesRenderTime.Km(),this._captureSpritesRenderTime&&this._spritesRenderTime.Km(),this._captureRenderTime&&this._renderTime.Km(),this._captureCameraRenderTime&&this._cameraRenderTime.Km()}))}dispose(){this._disposed||(this.yp.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yp.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yp=null,this._disposed=!0)}}},12848:(w,p,e)=>{"use strict";e.d(p,{d:()=>X});var r=e(11207),I=e(11213),d=e(11023),f=e(11331),q=e(11729),E=e(11786),j=e(11038);f.b.AddNodeConstructor("Light_Type_1",((w,p)=>()=>new X(w,d.k.Zero(),p)));class X extends E.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(w){this._shadowFrustumSize=w,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(w){this._shadowOrthoScale=w,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(w){this._orthoLeft=w}get orthoRight(){return this._orthoRight}set orthoRight(w){this._orthoRight=w}get orthoTop(){return this._orthoTop}set orthoTop(w){this._orthoTop=w}get orthoBottom(){return this._orthoBottom}set orthoBottom(w){this._orthoBottom=w}constructor(w,p,e){super(w,e),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=p.scale(-1),this.direction=p}getClassName(){return"sd"}getTypeID(){return q.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(w,p,e){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(w):this._setDefaultAutoExtendShadowProjectionMatrix(w,p,e)}_setDefaultFixedFrustumShadowProjectionMatrix(w){const p=this.iw().activeCamera;p&&d.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:p.ge,void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,w,this.iw().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(w,p,e){const r=this.iw().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const w=d.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let r=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let f=0;f<e.length;f++){const q=e[f];if(!q)continue;const E=q.getBoundingInfo().boundingBox;for(let e=0;e<E.vectorsWorld.length;e++)d.k.TransformCoordinatesToRef(E.vectorsWorld[e],p,w),w.x<this._orthoLeft&&(this._orthoLeft=w.x),w.y<this._orthoBottom&&(this._orthoBottom=w.y),w.x>this._orthoRight&&(this._orthoRight=w.x),w.y>this._orthoTop&&(this._orthoTop=w.y),this.autoCalcShadowZBounds&&(w.z<r&&(r=w.z),w.z>I&&(I=w.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=r,this._shadowMaxZ=I)}const I=this._orthoRight-this._orthoLeft,f=this._orthoTop-this._orthoBottom,q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===r||void 0===r?void 0:r.ge)||0,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===r||void 0===r?void 0:r.maxZ)||1e4,j=this.iw().getEngine().useReverseDepthBuffer;d.b.OrthoOffCenterLHToRef(this._orthoLeft-I*this.shadowOrthoScale,this._orthoRight+I*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,j?E:q,j?q:E,w,this.iw().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,p){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,p),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,p),this)}transferToNodeMaterialEffect(w,p){return this.computeTransformedInformation()?(w.setFloat3(p,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(w.setFloat3(p,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(w){const p=this._scene.getEngine();return!p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}getDepthMaxZ(w){const p=this._scene.getEngine();return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}prepareLightSpecificDefines(w,p){w["DIRLIGHT"+p]=!0}}(0,r.c)([(0,I.J)()],X.prototype,"shadowFrustumSize",null),(0,r.c)([(0,I.J)()],X.prototype,"shadowOrthoScale",null),(0,r.c)([(0,I.J)()],X.prototype,"autoUpdateExtends",void 0),(0,r.c)([(0,I.J)()],X.prototype,"autoCalcShadowZBounds",void 0),(0,r.c)([(0,I.J)("orthoLeft")],X.prototype,"_orthoLeft",void 0),(0,r.c)([(0,I.J)("orthoRight")],X.prototype,"_orthoRight",void 0),(0,r.c)([(0,I.J)("orthoTop")],X.prototype,"_orthoTop",void 0),(0,r.c)([(0,I.J)("orthoBottom")],X.prototype,"_orthoBottom",void 0),(0,j.d)("BABYLON.DirectionalLight",X)},13361:(w,p,e)=>{"use strict";e.d(p,{b:()=>X});var r=e(11207),I=e(11213),d=e(11023),f=e(11308),q=e(11331),E=e(11729),j=e(11038);q.b.AddNodeConstructor("Light_Type_3",((w,p)=>()=>new X(w,d.k.Zero(),p)));class X extends E.b{constructor(w,p,e){super(w,e),this.groundColor=new f.b(0,0,0),this.direction=p||d.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ad"}setDirectionToTarget(w){return this.direction=d.k.Normalize(w.Je(d.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(w,p){const e=d.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",e.x,e.y,e.z,0,p),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Se),p),this}transferToNodeMaterialEffect(w,p){const e=d.k.Normalize(this.direction);return w.setFloat3(p,e.x,e.y,e.z),this}ke(){return this._worldMatrix||(this._worldMatrix=d.b.Identity()),this._worldMatrix}getTypeID(){return E.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(w,p){w["HEMILIGHT"+p]=!0}}(0,r.c)([(0,I.j)()],X.prototype,"groundColor",void 0),(0,r.c)([(0,I.G)()],X.prototype,"direction",void 0),(0,j.d)("BABYLON.HemisphericLight",X)},12818:(w,p,e)=>{"use strict";e.d(p,{e:()=>k});var r=e(11207),I=e(11213),d=e(11023),f=e(11331),q=e(11729),E=e(11786),j=e(11511),X=e(11038);f.b.AddNodeConstructor("Light_Type_2",((w,p)=>()=>new k(w,d.k.Zero(),d.k.Zero(),0,0,p)));class k extends E.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(w){this._iesProfileTexture!==w&&(this._iesProfileTexture=w,this._iesProfileTexture&&k._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(w){this._angle=w,this._cosHalfAngle=Math.cos(.5*w),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(w){this._innerAngle=w,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(w){this._shadowAngleScale=w,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(w){this._projectionTextureLightNear=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(w){this._projectionTextureLightFar=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(w){this._projectionTextureUpDirection=w,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(w){this._projectionTexture!==w&&(this._projectionTexture=w,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(k._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):k._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(w){return void 0!==w.onGeneratedObservable}static _IsTexture(w){return void 0!==w.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(w){this._projectionTextureProjectionLightMatrix=w,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(w,p,e,r,I,f){super(w,f),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=d.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=d.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=d.k.Zero(),this._projectionTextureViewLightMatrix=d.b.Zero(),this._projectionTextureProjectionLightMatrix=d.b.Zero(),this._projectionTextureScalingMatrix=d.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=p,this.direction=e,this.angle=r,this.exponent=I}getClassName(){return"SpotLight"}getTypeID(){return q.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(w){super._setDirection(w),this._projectionTextureViewLightDirty=!0}_setPosition(w){super._setPosition(w),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(w,p,e){const r=this.iw().activeCamera;if(!r)return;this._shadowAngleScale=this._shadowAngleScale||1;const I=this._shadowAngleScale*this._angle,f=void 0!==this.shadowMinZ?this.shadowMinZ:r.ge,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,E=this.iw().getEngine().useReverseDepthBuffer;d.b.PerspectiveFovLHToRef(I,1,E?q:f,E?f:q,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,E)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),d.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const w=this.projectionTextureLightFar,p=this.projectionTextureLightNear,e=w/(w-p),r=-e*p,I=1/Math.tan(this._angle/2);d.b.FromValuesToRef(I/1,0,0,0,0,I,0,0,0,0,e,1,0,0,r,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof j.e){const w=this._projectionTexture.uScale/2,p=this._projectionTexture.vScale/2;d.b.FromValuesToRef(w,0,0,0,0,p,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(w,p){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),w.setMatrix("textureProjectionMatrix"+p,this._projectionTextureMatrix),w.setTexture("projectionLightTexture"+p,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&w.setTexture("iesLightTexture"+p,this._iesProfileTexture),this}transferToEffect(w,p){let e;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,p),e=d.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,p),e=d.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",e.x,e.y,e.z,this._cosHalfAngle,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,p),this}transferToNodeMaterialEffect(w,p){let e;return e=this.computeTransformedInformation()?d.k.Normalize(this.transformedDirection):d.k.Normalize(this.direction),this.iw().useRightHandedSystem?w.setFloat3(p,-e.x,-e.y,-e.z):w.setFloat3(p,e.x,e.y,e.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(w){const p=this._scene.getEngine(),e=void 0!==this.shadowMinZ?this.shadowMinZ:(null===w||void 0===w?void 0:w.ge)??0;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?e:this._scene.getEngine().isNDCHalfZRange?0:e}getDepthMaxZ(w){const p=this._scene.getEngine(),e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===w||void 0===w?void 0:w.maxZ)??1e4;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:e}prepareLightSpecificDefines(w,p){w["SPOTLIGHT"+p]=!0,w["PROJECTEDLIGHTTEXTURE"+p]=!(!this.projectionTexture||!this.projectionTexture.isReady()),w["IESLIGHTTEXTURE"+p]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,r.c)([(0,I.J)()],k.prototype,"angle",null),(0,r.c)([(0,I.J)()],k.prototype,"innerAngle",null),(0,r.c)([(0,I.J)()],k.prototype,"shadowAngleScale",null),(0,r.c)([(0,I.J)()],k.prototype,"exponent",void 0),(0,r.c)([(0,I.J)()],k.prototype,"projectionTextureLightNear",null),(0,r.c)([(0,I.J)()],k.prototype,"projectionTextureLightFar",null),(0,r.c)([(0,I.J)()],k.prototype,"projectionTextureUpDirection",null),(0,r.c)([(0,I.C)("projectedLightTexture")],k.prototype,"_projectionTexture",void 0),(0,X.d)("BABYLON.SpotLight",k)},12513:(w,p,e)=>{"use strict";e.d(p,{c:()=>f,d:()=>d,h:()=>q});const r={},I={};function d(w,p){r[w]=p}function f(w,p){I[w]=p}function q(w){return I[w]?I[w]:null}},12419:(w,p,e)=>{"use strict";e.d(p,{e:()=>i,f:()=>P});var r,I=e(11071),d=e(11056),f=e(11590),q=e(11051),E=e(11081),j=e(11397),X=e(11107),k=e(11113),m=e(11190),J=e(11132),K=e(11099);!function(w){w[w.Clean=0]="Clean",w[w.Stop=1]="Stop",w[w.Sync=2]="Sync",w[w.NoSync=3]="NoSync"}(r||(r={}));const y=new d.d,c={};let s=!1;function O(){return c[".babylon"]}function a(w,p){const e=c[w];return e||(E.c.Warn("Unable to find a plugin to load "+w+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),p?O():void 0)}function A(w,p,e){let r="Unable to load from "+(w.rawData?"binary data":w.url);return p?r+=`: ${p}`:e&&(r+=`: ${e}`),r}async function z(w,p,e,r,I,d,f,q,E){var j;const k="data:"===(m=w.url).substring(0,5)?m.substring(5):null;var m;if(w.rawData&&!f)throw"When using ArrayBufferView to load data the file extension must be provided.";const s=k||f?"":function(w){const p=w.indexOf("?");-1!==p&&(w=w.substring(0,p));const e=w.lastIndexOf(".");return w.substring(e,w.length).toLowerCase()}(w.url);let A=f?a(f,!0):k?function(w){for(const p in c){const e=c[p].plugin;if(e.canDirectLoad&&e.canDirectLoad(w))return c[p]}return O()}(w.url):a(s,!1);if(!A&&s){if(w.url&&!w.url.startsWith("blob:")){const p=await async function(w,p){const e=p.method||"GET";return await new Promise(((r,I)=>{const d=new K.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const w={};if(p.responseHeaders)for(const e of p.responseHeaders)w[e]=d.getResponseHeader(e)||"";r({response:d.response,headerValues:w})}else I(`Unable to fetch data from ${w}. Error code: ${d.status}`)})),d.open(e,w),d.send()}))}(w.url,{method:"HEAD",responseHeaders:["Content-Type"]}),e=p.headerValues?p.headerValues["Content-Type"]:"";e&&(A=function(w){for(const p in c){const e=c[p];if(e.mimeType===w)return e}}(e))}A||(A=O())}if(!A)throw new Error(`No plugin or fallback for ${f??w.url}`);if(!1===(null===E||void 0===E||null===(j=E[A.plugin.name])||void 0===j?void 0:j.enabled))throw new Error(`The '${A.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(w.rawData&&!A.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(w=>{if(A.plugin.createPlugin){const p=A.plugin.createPlugin(E??{});return p instanceof Promise?(p.then(w).catch((w=>{I("Error instantiating plugin.",w)})),null):(w(p),p)}return w(A.plugin),A.plugin})((E=>{var j;if(!E)throw`The loader plugin corresponding to the '${f}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(y.notifyObservers(E),k&&(E.canDirectLoad&&E.canDirectLoad(w.url)||!(0,X.n)(w.url))){if(E.directLoad){const w=E.directLoad(p,k);w instanceof Promise?w.then((w=>{e(E,w)})).catch((w=>{I("Error in directLoad of _loadData: "+w,w)})):e(E,w)}else e(E,k);return}const m=A.isBinary,K=(w,r)=>{p.K?I("Scene has been disposed"):e(E,w,r)};let c=null,s=!1;null===(j=E.ue)||void 0===j||j.add((()=>{s=!0,c&&(c.abort(),c=null),d()}));const O=()=>{if(s)return;const e=(w,p)=>{I(null===w||void 0===w?void 0:w.statusText,p)};if(!E.loadFile&&w.rawData)throw"Plugin does not support loading ArrayBufferView.";c=E.loadFile?E.loadFile(p,w.rawData||w.file||w.url,w.rootUrl,K,r,m,e,q):p._loadFile(w.file||w.url,K,r,!0,m,e)},a=p.getEngine();let z=a.enableOfflineSupport;if(z){let e=!1;for(const r of p.disableOfflineSupportExceptionRules)if(r.test(w.url)){e=!0;break}z=!e}z&&J.d.OfflineProviderFactory?p.offlineProvider=J.d.OfflineProviderFactory(w.url,O,a.disableManifestCheck):O()}))}function M(w,p){let e,r,d=null,f=null;if(p)if(p.name)e=`file:${p.name}`,r=p.name,d=p;else if(ArrayBuffer.isView(p))e="",r=(0,m.b)(),f=p;else if(p.startsWith("data:"))e=p,r="";else if(w){const d=p;if("/"===d.substring(0,1))return I.g.Error("Wrong sceneFilename parameter"),null;e=w+d,r=d}else e=p,r=I.g.GetFilename(p),w=I.g.GetFolderPath(p);else e=w,r=I.g.GetFilename(w),w=I.g.GetFolderPath(w);return{url:e,rootUrl:w,name:r,file:d,rawData:f}}function i(w){if("string"===typeof w.extensions){const p=w.extensions;c[p.toLowerCase()]={plugin:w,isBinary:!1}}else{const p=w.extensions,e=Object.keys(p);for(const r of e)c[r.toLowerCase()]={plugin:w,isBinary:p[r].isBinary,mimeType:p[r].mimeType}}}async function t(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.d.LastCreatedScene,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!r)return E.c.Error("No scene available to import mesh to"),null;const J=M(p,e);if(!J)return null;const K={};r.addPendingData(K);const y=()=>{r.removePendingData(K)},c=(w,p)=>{const e=A(J,w,p);f?f(r,e,new k.l(e,k.i.SceneLoaderError,p)):E.c.Error(e),y()},s=d?w=>{try{d(w)}catch(p){c("Error in onProgress callback: "+p,p)}}:void 0,O=(w,p,e,d,f,q,E,j)=>{if(r.importedMeshesFiles.push(J.url),I)try{I(w,p,e,d,f,q,E,j)}catch(X){c("Error in onSuccess callback: "+X,X)}r.removePendingData(K)};return await z(J,r,((p,e,I)=>{if(p.rewriteRootURL&&(J.rootUrl=p.rewriteRootURL(J.rootUrl,I)),p.importMesh){const I=[],d=[],f=[];if(!p.importMesh(w,r,e,J.rootUrl,I,d,f,c))return;r.loadingPluginName=p.name,O(I,d,f,[],[],[],[],[])}else{p.importMeshAsync(w,r,e,J.rootUrl,s,J.name).then((w=>{r.loadingPluginName=p.name,O(w.meshes,w.tm,w.skeletons,w.animationGroups,w.transformNodes,w.geometries,w.lights,w.spriteManagers)})).catch((w=>{c(w.message,w)}))}}),s,c,y,j,X,m)}async function n(w,p,e,r,I,d,f,q){return await new Promise(((E,j)=>{try{t(w,p,e,r,((w,p,e,r,I,d,f,q)=>{E({meshes:w,tm:p,skeletons:e,animationGroups:r,transformNodes:I,geometries:d,lights:f,spriteManagers:q})}),I,((w,p,e)=>{j(e||new Error(p))}),d,f,q).catch(j)}catch(k){j(k)}}))}async function l(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedEngine,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};e?await U(w,p,new f.c(e),r,d,E,j,X,k):I.g.Error("No engine available")}async function N(w,p,e,r,I,d,f){return await new Promise(((q,E)=>{l(w,p,e,(w=>{q(w)}),r,((w,p,e)=>{E(e||new Error(p))}),I,d,f)}))}async function U(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return E.c.Error("No scene available to append to"),null;const J=M(w,p);if(!J)return null;const K={};e.addPendingData(K);const y=()=>{e.removePendingData(K)};j.d.ShowLoadingScreen&&!s&&(s=!0,e.getEngine().displayLoadingUI(),e.executeWhenReady((()=>{e.getEngine().hideLoadingUI(),s=!1})));const c=(w,p)=>{const r=A(J,w,p);d?d(e,r,new k.l(r,k.i.SceneLoaderError,p)):E.c.Error(r),y()},O=I?w=>{try{I(w)}catch(p){c("Error in onProgress callback",p)}}:void 0,a=()=>{if(r)try{r(e)}catch(w){c("Error in onSuccess callback",w)}e.removePendingData(K)};return await z(J,e,((w,p)=>{if(w.load){if(!w.load(e,p,J.rootUrl,c))return;e.loadingPluginName=w.name,a()}else{w.loadAsync(e,p,J.rootUrl,O,J.name).then((()=>{e.loadingPluginName=w.name,a()})).catch((w=>{c(w.message,w)}))}}),O,c,y,f,X,m)}async function v(w,p,e,r,I,d,f){return await new Promise(((q,E)=>{try{U(w,p,e,(w=>{q(w)}),r,((w,p,e)=>{E(e||new Error(p))}),I,d,f).catch(E)}catch(k){E(k)}}))}async function R(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return E.c.Error("No scene available to load asset container to"),null;const m=M(w,p);if(!m)return null;const J={};e.addPendingData(J);const K=()=>{e.removePendingData(J)},y=(w,p)=>{const r=A(m,w,p);d?d(e,r,new k.l(r,k.i.SceneLoaderError,p)):E.c.Error(r),K()},c=I?w=>{try{I(w)}catch(p){y("Error in onProgress callback",p)}}:void 0,s=w=>{if(r)try{r(w)}catch(p){y("Error in onSuccess callback",p)}e.removePendingData(J)};return await z(m,e,((w,p)=>{if(w.loadAssetContainer){const r=w.loadAssetContainer(e,p,m.rootUrl,y);if(!r)return;r.populateRootNodes(),e.loadingPluginName=w.name,s(r)}else if(w.loadAssetContainerAsync){w.loadAssetContainerAsync(e,p,m.rootUrl,c,m.name).then((p=>{p.populateRootNodes(),e.loadingPluginName=w.name,s(p)})).catch((w=>{y(w.message,w)}))}else y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,y,K,f,j,X)}async function V(w,p,e,r,I,d,f){return await new Promise(((q,E)=>{try{R(w,p,e,(w=>{q(w)}),r,((w,p,e)=>{E(e||new Error(p))}),I,d,f).catch(E)}catch(k){E(k)}}))}async function b(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.d.LastCreatedScene,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!e)return void E.c.Error("No scene available to load animations to");if(r){for(const r of e.animatables)r.reset();e.stopAllAnimations();const w=e.animationGroups.slice();for(const e of w)e.dispose();const p=e.getNodes();for(const e of p)e.animations&&(e.animations=[])}else switch(I){case 0:const w=e.animationGroups.slice();for(const p of w)p.dispose();break;case 1:for(const p of e.animationGroups)p.stop();break;case 2:for(const p of e.animationGroups)p.reset(),p.restart();break;case 3:break;default:return void E.c.Error("Unknown animation group loading mode value '"+I+"'")}const K=e.animatables.length;await R(w,p,e,(w=>{w.mergeAnimationsTo(e,e.animatables.slice(K),d),w.dispose(),e.onAnimationFileImportedObservable.notifyObservers(e),f&&f(e)}),j,X,k,m,J)}async function h(w,p,e,r,I,d,f,q,E,j){return await new Promise(((X,m)=>{try{b(w,p,e,r,I,d,(w=>{X(w)}),f,((w,p,e)=>{m(e||new Error(p))}),q,E,j).catch(m)}catch(k){m(k)}}))}class P{static get ForceFullSceneLoadingForIncremental(){return j.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(w){j.d.ForceFullSceneLoadingForIncremental=w}static get ShowLoadingScreen(){return j.d.ShowLoadingScreen}static set ShowLoadingScreen(w){j.d.ShowLoadingScreen=w}static get loggingLevel(){return j.d.loggingLevel}static set loggingLevel(w){j.d.loggingLevel=w}static get CleanBoneMatrixWeights(){return j.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(w){j.d.CleanBoneMatrixWeights=w}static GetDefaultPlugin(){return O()}static GetPluginForExtension(w){var p;return null===(p=a(w,!0))||void 0===p?void 0:p.plugin}static IsPluginForExtensionAvailable(w){return function(w){return!!c[w]}(w)}static RegisterPlugin(w){i(w)}static ImportMesh(w,p,e,r,I,d,f,E,j){t(w,p,e,r,I,d,f,E,j).catch((w=>null===f||void 0===f?void 0:f(q.d.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportMeshAsync(w,p,e,r,I,d,f){return await n(w,p,e,r,I,d,f)}static Load(w,p,e,r,I,d,f,E){l(w,p,e,r,I,d,f,E).catch((w=>null===d||void 0===d?void 0:d(q.d.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAsync(w,p,e,r,I,d){return await N(w,p,e,r,I,d)}static Append(w,p,e,r,I,d,f,E){U(w,p,e,r,I,d,f,E).catch((w=>null===d||void 0===d?void 0:d(e??q.d.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async AppendAsync(w,p,e,r,I,d){return await v(w,p,e,r,I,d)}static LoadAssetContainer(w,p,e,r,I,d,f,E){R(w,p,e,r,I,d,f,E).catch((w=>null===d||void 0===d?void 0:d(e??q.d.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAssetContainerAsync(w,p,e,r,I,d){return await V(w,p,e,r,I,d)}static ImportAnimations(w,p,e,r,I,d,f,E,j,X,k){b(w,p,e,r,I,d,f,E,j,X,k).catch((w=>null===j||void 0===j?void 0:j(e??q.d.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportAnimationsAsync(w,p,e,r,I,d,f,q,E,j,X){return await h(w,p,e,r,I,d,q,j,X)}}P.NO_LOGGING=0,P.MINIMAL_LOGGING=1,P.SUMMARY_LOGGING=2,P.DETAILED_LOGGING=3,P.OnPluginActivatedObservable=y},12830:(w,p,e)=>{"use strict";e.d(p,{b:()=>m});var r=e(11207),I=e(11213),d=e(11071),f=e(11023),q=e(11494),E=e(11511),j=e(11038),X=e(11056),k=e(11301);e(12835);class m extends q.b{set boundingBoxSize(w){if(this._boundingBoxSize&&this._boundingBoxSize.equals(w))return;this._boundingBoxSize=w;const p=this.iw();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(w){this._rotationY=w,this.setReflectionTextureMatrix(f.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(w,p,e){let r="";for(const I of w)r+=I;return new m(r,p,null,e,w)}static CreateFromPrefilteredData(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=p.useDelayedTextureLoading;p.useDelayedTextureLoading=!1;const d=new m(w,p,null,!1,null,null,null,void 0,!0,e,r);return p.useDelayedTextureLoading=I,d}constructor(w,p){var e;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,m=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]&&arguments[10],y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,s=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;super(p),this.onLoadObservable=new X.d,this.boundingBoxPosition=f.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new f.b,this._buffer=null,this.name=w,this.url=w,this._noMipmap=I,this.ie=!1,this.isCube=!0,this._textureMatrix=f.b.Identity(),this.coordinatesMode=E.e.CUBIC_MODE;let a=null,A=null;null===r||Array.isArray(r)?(this._noMipmap=I,this._format=k,this._createPolynomials=K,a=r,this._loaderOptions=s,this._useSRGBBuffer=O,this._lodScale=y,this._lodOffset=c):(a=r.extensions??null,this._noMipmap=r.noMipmap??!1,d=r.files??null,A=r.buffer??null,this._format=r.format??5,m=r.prefiltered??!1,J=r.forcedExtension??null,this._createPolynomials=r.createPolynomials??!1,this._lodScale=r.lodScale??.8,this._lodOffset=r.lodOffset??0,this._loaderOptions=r.loaderOptions,this._useSRGBBuffer=r.useSRGBBuffer,q=r.G??null,j=r.onError??null),(w||d)&&this.updateURL(w,J,q,m,j,a,null===(e=this.iw())||void 0===e?void 0:e.useDelayedTextureLoading,d,A)}getClassName(){return"CubeTexture"}updateURL(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,p&&(this._forcedExtension=p);const j=w.lastIndexOf("."),X=p||(j>-1?w.substring(j).toLowerCase():""),k=0===X.indexOf(".dds"),m=0===X.indexOf(".env"),J=0===X.indexOf(".basis");if(m?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),q)this._files=q;else if(J||m||k||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,d){for(let p=0;p<d.length;p++)this._files.push(w+d[p]);this._extensions=d}this._buffer=E,f?(this.delayLoadState=4,this._delayedOnLoad=e,this._delayedOnError=I):this._loadTexture(e,I)}delayLoad(w){4===this.delayLoadState&&(w&&(this._forcedExtension=w),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(w){var p,e;if(w.updateFlag===this._textureMatrix.updateFlag)return;w.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(e=this.iw())||void 0===e||e.markAllMaterialsAsDirty(1,(w=>-1!==w.getActiveTextures().indexOf(this))));if(this._textureMatrix=w,null===(p=this.iw())||void 0===p||!p.useRightHandedSystem)return;const r=f.d.ne[0],I=f.d.Quaternion[0],d=f.d.ne[1];this._textureMatrix.decompose(r,I,d),I.z*=-1,I.w*=-1,f.b.ComposeToRef(r,I,d,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var w;return null!==(w=this.iw())&&void 0!==w&&w.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.iw(),r=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const I=()=>{var p;(this.onLoadObservable.notifyObservers(this),r)&&(r.dispose(),null===(p=this.iw())||void 0===p||p.markAllMaterialsAsDirty(1));w&&w()},f=(w,e)=>{this._loadingError=!0,this._errorObject={message:w,exception:e},p&&p(w,e),E.e.OnTextureLoadErrorObservable.notifyObservers(this)};var q;this._texture?this._texture.isReady?d.g.SetImmediate((()=>I())):this._texture.onLoadedObservable.add((()=>I())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,e,this._lodScale,this._lodOffset,w,f,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,e,this._files,this._noMipmap,w,f,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(q=this._texture)||void 0===q||q.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(w,p,e){const r=k.e.Parse((()=>{let r=!1;return w.prefiltered&&(r=w.prefiltered),new m(e+(w.url??w.name),p,w.extensions,!1,w.files||null,null,null,void 0,r,w.forcedExtension)}),w,p);if(w.boundingBoxPosition&&(r.boundingBoxPosition=f.k.Ve(w.boundingBoxPosition)),w.boundingBoxSize&&(r.boundingBoxSize=f.k.Ve(w.boundingBoxSize)),w.animations)for(let I=0;I<w.animations.length;I++){const p=w.animations[I],e=(0,j.c)("BABYLON.Animation");e&&r.animations.push(e.Parse(p))}return r}clone(){let w=0;const p=k.e.Clone((()=>{const p=new m(this.url,this.iw()||this._getEngine(),this._extensions,this._noMipmap,this._files);return w=p.uniqueId,p}),this);return p.uniqueId=w,p}}(0,r.c)([(0,I.J)()],m.prototype,"url",void 0),(0,r.c)([(0,I.G)()],m.prototype,"boundingBoxPosition",void 0),(0,r.c)([(0,I.G)()],m.prototype,"boundingBoxSize",null),(0,r.c)([(0,I.J)("rotationY")],m.prototype,"rotationY",null),(0,r.c)([(0,I.J)("files")],m.prototype,"_files",void 0),(0,r.c)([(0,I.J)("forcedExtension")],m.prototype,"_forcedExtension",void 0),(0,r.c)([(0,I.J)("extensions")],m.prototype,"_extensions",void 0),(0,r.c)([(0,I.t)("textureMatrix")],m.prototype,"_textureMatrix",void 0),(0,r.c)([(0,I.t)("textureMatrixRefraction")],m.prototype,"_textureMatrixRefraction",void 0),E.e._CubeTextureParser=m.Parse,(0,j.d)("BABYLON.CubeTexture",m)},13369:(w,p,e)=>{"use strict";e.d(p,{d:()=>E});var r=e(11081),I=e(11511),d=e(11194),f=e(11416),q=e(11161);f.ThinEngine.prototype.createDynamicTexture=function(w,p,e,r){const I=new q.d(this,4);return I.baseWidth=w,I.baseHeight=p,e&&(w=this.needPOTTextures?(0,d.f)(w,this._caps.maxTextureSize):w,p=this.needPOTTextures?(0,d.f)(p,this._caps.maxTextureSize):p),I.width=w,I.height=p,I.isReady=!1,I.generateMipMaps=e,I.samplingMode=r,this.updateTextureSamplingMode(r,I),this._internalTexturesCache.push(I),I},f.ThinEngine.prototype.updateDynamicTexture=function(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!w)return;const f=this._gl,q=f.TEXTURE_2D,E=this._bindTextureDirectly(q,w,!0,d);this._unpackFlipY(void 0===e?w.invertY:e),r&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const j=this._getWebGLTextureType(w.type),X=this._getInternalFormat(I||w.format),k=this._getRGBABufferInternalSizedFormat(w.type,X);f.texImage2D(q,0,k,X,j,p),w.generateMipMaps&&f.generateMipmap(q),E||this._bindTextureDirectly(q,null),r&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),I&&(w.format=I),w._dynamicTextureSource=p,w._premulAlpha=r,w.invertY=e||!1,w.isReady=!0};class E extends I.e{constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,q=arguments.length>6?arguments[6]:void 0;const E=!e||e._isScene;super(null,E?e:null===e||void 0===e?void 0:e.yp,E?!r:e,q,d,void 0,void 0,void 0,void 0,f),this.name=w,this.wrapU=I.e.CLAMP_ADDRESSMODE,this.wrapV=I.e.CLAMP_ADDRESSMODE,this._generateMipMaps=r;const j=this._getEngine();if(!j)return;if(p.getContext)this._canvas=p,this._ownCanvas=!1,this._texture=j.createDynamicTexture(this._canvas.width,this._canvas.height,r,d);else{this._canvas=j.createCanvas(1,1),this._ownCanvas=!0;const w=p;w.width||0===w.width?this._texture=j.createDynamicTexture(w.width,w.height,r,d):this._texture=j.createDynamicTexture(p,p,r,d)}const X=this.getSize();this._canvas.width!==X.width&&(this._canvas.width=X.width),this._canvas.height!==X.height&&(this._canvas.height=X.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(w){this._canvas.width=w.width,this._canvas.height=w.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(w.width,w.height,this._generateMipMaps,this.samplingMode)}scale(w){const p=this.getSize();p.width*=w,p.height*=w,this._recreate(p)}scaleTo(w,p){const e=this.getSize();e.width=w,e.height=p,this._recreate(e)}getContext(){return this._context}clear(w){const p=this.getSize();w&&(this._context.fillStyle=w),this._context.clearRect(0,0,p.width,p.height)}update(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===w||w,p,this._format||void 0,void 0,e)}drawText(w,p,e,r,I,d,f){let q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const E=this.getSize();if(d&&(this._context.fillStyle=d,this._context.fillRect(0,0,E.width,E.height)),this._context.font=r,null===p||void 0===p){const e=this._context.measureText(w);p=(E.width-e.width)/2}if(null===e||void 0===e){const w=parseInt(r.replace(/\D/g,""));e=E.height/2+w/3.65}this._context.fillStyle=I||"",this._context.fillText(w,p,e),q&&this.update(f)}dispose(){var w,p;(super.dispose(),this._ownCanvas)&&(null===(w=this._canvas)||void 0===w||null===(p=w.remove)||void 0===p||p.call(w));this._canvas=null,this._context=null}clone(){const w=this.iw();if(!w)return this;const p=this.getSize(),e=new E(this.name,p,w,this._generateMipMaps);return e.ie=this.ie,e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e}serialize(){const w=this.iw();w&&!w.isReady()&&r.c.Warn("The scene must be ready before serializing the dynamic texture");const p=super.serialize();return E._IsCanvasElement(this._canvas)&&(p.base64String=this._canvas.toDataURL()),p.invertY=this._invertY,p.samplingMode=this.samplingMode,p}static _IsCanvasElement(w){return void 0!==w.toDataURL}_rebuild(){this.update()}}},12733:(w,p,e)=>{"use strict";e.d(p,{e:()=>I});var r=e(11511);class I extends r.e{get depth(){return this._depth}constructor(w,p,e,I,d,f){let q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:r.e.TRILINEAR_SAMPLINGMODE,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10?arguments[10]:void 0;super(null,f,!q,E),this.format=d,this._texture=f.getEngine().createRawTexture2DArray(w,p,e,I,d,q,E,j,null,X,k),this._depth=I,this.is2DArray=!0}update(w){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(w,p,e,r,d){return new I(w,p,e,r,5,d,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12529:(w,p,e)=>{"use strict";e.d(p,{d:()=>q,h:()=>E,i:()=>d,k:()=>f});var r=e(11063),I=e(11023);function d(w,p){return`{X: ${w.x.toFixed(p)} Y: ${w.y.toFixed(p)}}`}function f(w,p){return`{X: ${w._x.toFixed(p)} Y: ${w._y.toFixed(p)} Z: ${w._z.toFixed(p)}}`}function q(w,p){return 2*Math.acos((0,r.Clamp)(I.c.Dot(w,p)))}function E(w,p){const e=new I.c;return function(w,p,e){const d=I.k.Cross(w,p),f=Math.acos((0,r.Clamp)(I.k.Dot(w,p),-1,1));I.c.RotationAxisToRef(d,f,e)}(w,p,e),e}},12362:(w,p,e)=>{"use strict";e.d(p,{e:()=>j});var r=e(11023),I=e(11308),d=e(11370),f=e(11337),q=e(11400);e(12369);function E(w){let p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],d=[];let E=[];const j=w.width||w.size||1,X=w.height||w.size||1,k=w.depth||w.size||1,m=w.wrap||!1;let J=void 0===w.topBaseAt?1:w.topBaseAt,K=void 0===w.bottomBaseAt?0:w.bottomBaseAt;J=(J+4)%4,K=(K+4)%4;let y=[2,0,3,1][J],c=[2,0,1,3][K],s=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(m){p=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],s=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let w=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],e=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const r=[17,18,19,16],I=[22,23,20,21];for(;y>0;)w.unshift(w.pop()),r.unshift(r.pop()),y--;for(;c>0;)e.unshift(e.pop()),I.unshift(I.pop()),c--;w=w.flat(),e=e.flat(),s=s.concat(w).concat(e),p.push(r[0],r[2],r[3],r[0],r[1],r[2]),p.push(I[0],I[2],I[3],I[0],I[1],I[2])}const O=[j/2,X/2,k/2];E=s.reduce(((w,p,e)=>w.concat(p*O[e%3])),[]);const a=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,A=w.faceUV||new Array(6),z=w.faceColors,M=[];for(let f=0;f<6;f++)void 0===A[f]&&(A[f]=new r.o(0,0,1,1)),z&&void 0===z[f]&&(z[f]=new I.e(1,1,1,1));for(let r=0;r<6;r++)if(d.push(A[r].z,q.b?1-A[r].w:A[r].w),d.push(A[r].x,q.b?1-A[r].w:A[r].w),d.push(A[r].x,q.b?1-A[r].y:A[r].y),d.push(A[r].z,q.b?1-A[r].y:A[r].y),z)for(let w=0;w<4;w++)M.push(z[r].r,z[r].g,z[r].b,z[r].a);f.b._ComputeSides(a,E,p,e,d,w.frontUVs,w.backUVs);const i=new f.b;if(i.indices=p,i.nw=E,i.lw=e,i.Uw=d,z){const w=a===f.b.DOUBLESIDE?M.concat(M):M;i.Nw=w}return i}function j(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new d.c(w,e);p.sideOrientation=d.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return E(p).Vw(r,p.updatable),r}f.b.CreateBox=E,d.c.CreateBox=function(w,p){return j(w,{size:p,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12522:(w,p,e)=>{"use strict";e.d(p,{c:()=>q});var r=e(11370),I=e(11337),d=e(11400);function f(w){const p=[],e=[],r=[],f=[],q=w.radius||.5,E=w.tessellation||64,j=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,X=0===w.sideOrientation?0:w.sideOrientation||I.b.DEFAULTSIDE;p.push(0,0,0),f.push(.5,.5);const k=2*Math.PI*j,m=1===j?k/E:k/(E-1);let J=0;for(let I=0;I<E;I++){const w=Math.cos(J),e=Math.sin(J),r=(w+1)/2,I=(1-e)/2;p.push(q*w,q*e,0),f.push(r,d.b?1-I:I),J+=m}1===j&&(p.push(p[3],p[4],p[5]),f.push(f[2],d.b?1-f[3]:f[3]));const K=p.length/3;for(let I=1;I<K-1;I++)e.push(I+1,0,I);I.b.ComputeNormals(p,e,r),I.b._ComputeSides(X,p,e,r,f,w.frontUVs,w.backUVs);const y=new I.b;return y.indices=e,y.nw=p,y.lw=r,y.Uw=f,y}function q(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(w,e);p.sideOrientation=r.c._GetDefaultSideOrientation(p.sideOrientation),I._originalBuilderSideOrientation=p.sideOrientation;return f(p).Vw(I,p.updatable),I}I.b.CreateDisc=f,r.c.CreateDisc=function(w,p,e){return q(w,{radius:p,tessellation:e,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12369:(w,p,e)=>{"use strict";e.d(p,{e:()=>c,c:()=>O,g:()=>s});var r=e(11023),I=e(11308),d=e(11370),f=e(11337),q=e(11232);d.c._GroundMeshParser=(w,p)=>E.Parse(w,p);class E extends d.c{constructor(w,p){super(w,p),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=w,this._subdivisionsY=w,this.subdivide(w);const e=this;e.createOrUpdateSubmeshesOctree&&e.createOrUpdateSubmeshesOctree(p)}getHeightAtCoordinates(w,p){const e=this.getWorldMatrix(),I=r.d.Matrix[5];e.invertToRef(I);const d=r.d.ne[8];if(r.k.TransformCoordinatesFromFloatsToRef(w,0,p,I,d),w=d.x,p=d.z,w<this._minX||w>=this._maxX||p<=this._minZ||p>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(w,p),q=-(f.x*w+f.z*p+f.w)/f.y;return r.k.TransformCoordinatesFromFloatsToRef(0,q,0,e,d),d.y}getNormalAtCoordinates(w,p){const e=new r.k(0,1,0);return this.getNormalAtCoordinatesToRef(w,p,e),e}getNormalAtCoordinatesToRef(w,p,e){const I=this.getWorldMatrix(),d=r.d.Matrix[5];I.invertToRef(d);const f=r.d.ne[8];if(r.k.TransformCoordinatesFromFloatsToRef(w,0,p,d,f),w=f.x,p=f.z,w<this._minX||w>this._maxX||p<this._minZ||p>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(w,p);return r.k.TransformNormalFromFloatsToRef(q.x,q.y,q.z,I,e),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(w,p){const e=Math.floor((w+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(p+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),I=this._heightQuads[r*this._subdivisionsX+e];let d;return d=p<I.slope.x*w+I.slope.y?I.facet1:I.facet2,d}_initHeightQuads(){const w=this._subdivisionsX,p=this._subdivisionsY;this._heightQuads=[];for(let e=0;e<p;e++)for(let p=0;p<w;p++){const I={slope:r.g.Zero(),facet1:new r.o(0,0,0,0),facet2:new r.o(0,0,0,0)};this._heightQuads[e*w+p]=I}return this}_computeHeightQuads(){const w=this.getVerticesData(q.e.PositionKind);if(!w)return this;const p=r.d.ne[3],e=r.d.ne[2],I=r.d.ne[1],d=r.d.ne[0],f=r.d.ne[4],E=r.d.ne[5],j=r.d.ne[6],X=r.d.ne[7],k=r.d.ne[8];let m=0,J=0,K=0,y=0,c=0,s=0,O=0;const a=this._subdivisionsX,A=this._subdivisionsY;for(let q=0;q<A;q++)for(let A=0;A<a;A++){m=3*A,J=q*(a+1)*3,K=(q+1)*(a+1)*3,p.x=w[J+m],p.y=w[J+m+1],p.z=w[J+m+2],e.x=w[J+m+3],e.y=w[J+m+4],e.z=w[J+m+5],I.x=w[K+m],I.y=w[K+m+1],I.z=w[K+m+2],d.x=w[K+m+3],d.y=w[K+m+4],d.z=w[K+m+5],y=(d.z-p.z)/(d.x-p.x),c=p.z-y*p.x,e.subtractToRef(p,f),I.subtractToRef(p,E),d.subtractToRef(p,j),r.k.CrossToRef(j,E,X),r.k.CrossToRef(f,j,k),X.normalize(),k.normalize(),s=-(X.x*p.x+X.y*p.y+X.z*p.z),O=-(k.x*e.x+k.y*e.y+k.z*e.z);const z=this._heightQuads[q*a+A];z.slope.te(y,c),z.facet1.te(X.x,X.y,X.z,s),z.facet2.te(k.x,k.y,k.z,O)}return this}serialize(w){super.serialize(w),w.subdivisionsX=this._subdivisionsX,w.subdivisionsY=this._subdivisionsY,w.minX=this._minX,w.maxX=this._maxX,w.ge=this._minZ,w.maxZ=this._maxZ,w.width=this._width,w.height=this._height}static Parse(w,p){const e=new E(w.name,p);return e._subdivisionsX=w.subdivisionsX||1,e._subdivisionsY=w.subdivisionsY||1,e._minX=w.minX,e._maxX=w.maxX,e._minZ=w.ge,e._maxZ=w.maxZ,e._width=w.width,e._height=w.height,e}}var j=e(11071),X=e(11051),k=e(11027),m=e(11400);function J(w){const p=[],e=[],I=[],d=[];let q,E;const j=w.width||w.size||1,X=w.height||w.size||1,k=0|(w.subdivisionsX||w.subdivisions||1),J=0|(w.subdivisionsY||w.subdivisions||1);for(q=0;q<=J;q++)for(E=0;E<=k;E++){const w=new r.k(E*j/k-j/2,0,(J-q)*X/J-X/2),p=new r.k(0,1,0);e.push(w.x,w.y,w.z),I.push(p.x,p.y,p.z),d.push(E/k,m.b?q/J:1-q/J)}for(q=0;q<J;q++)for(E=0;E<k;E++)p.push(E+1+(q+1)*(k+1)),p.push(E+1+q*(k+1)),p.push(E+q*(k+1)),p.push(E+(q+1)*(k+1)),p.push(E+1+(q+1)*(k+1)),p.push(E+q*(k+1));const K=new f.b;return K.indices=p,K.nw=e,K.lw=I,K.Uw=d,K}function K(w){const p=void 0!==w.xmin&&null!==w.xmin?w.xmin:-1,e=void 0!==w.zmin&&null!==w.zmin?w.zmin:-1,I=void 0!==w.xmax&&null!==w.xmax?w.xmax:1,d=void 0!==w.zmax&&null!==w.zmax?w.zmax:1,q=w.subdivisions||{w:1,h:1},E=w.precision||{w:1,h:1},j=[],X=[],k=[],m=[];let J,K,y,c;q.h=q.h<1?1:q.h,q.w=q.w<1?1:q.w,E.w=E.w<1?1:E.w,E.h=E.h<1?1:E.h;const s=(I-p)/q.w,O=(d-e)/q.h;function a(w,p,e,I){const d=X.length/3,f=E.w+1;for(J=0;J<E.h;J++)for(K=0;K<E.w;K++){const w=[d+K+J*f,d+(K+1)+J*f,d+(K+1)+(J+1)*f,d+K+(J+1)*f];j.push(w[1]),j.push(w[2]),j.push(w[3]),j.push(w[0]),j.push(w[1]),j.push(w[3])}const q=r.k.Zero(),y=new r.k(0,1,0);for(J=0;J<=E.h;J++)for(q.z=J*(I-p)/E.h+p,K=0;K<=E.w;K++)q.x=K*(e-w)/E.w+w,q.y=0,X.push(q.x,q.y,q.z),k.push(y.x,y.y,y.z),m.push(K/E.w,J/E.h)}for(y=0;y<q.h;y++)for(c=0;c<q.w;c++)a(p+c*s,e+y*O,p+(c+1)*s,e+(y+1)*O);const A=new f.b;return A.indices=j,A.nw=X,A.lw=k,A.Uw=m,A}function y(w){const p=[],e=[],d=[],q=[];let E,j;const X=w.colorFilter||new I.b(.3,.59,.11),m=w.alphaFilter||0;let J=!1;if(w.minHeight>w.maxHeight){J=!0;const p=w.maxHeight;w.maxHeight=w.minHeight,w.minHeight=p}for(E=0;E<=w.subdivisions;E++)for(j=0;j<=w.subdivisions;j++){const p=new r.k(j*w.width/w.subdivisions-w.width/2,0,(w.subdivisions-E)*w.height/w.subdivisions-w.height/2),I=4*(((p.x+w.width/2)/w.width*(w.bufferWidth-1)|0)+((1-(p.z+w.height/2)/w.height)*(w.bufferHeight-1)|0)*w.bufferWidth);let f=w.buffer[I]/255,K=w.buffer[I+1]/255,y=w.buffer[I+2]/255;const c=w.buffer[I+3]/255;J&&(f=1-f,K=1-K,y=1-y);const s=f*X.r+K*X.g+y*X.b;p.y=c>=m?w.minHeight+(w.maxHeight-w.minHeight)*s:w.minHeight-k.c,w.heightBuffer&&(w.heightBuffer[E*(w.subdivisions+1)+j]=p.y),e.push(p.x,p.y,p.z),d.push(0,0,0),q.push(j/w.subdivisions,1-E/w.subdivisions)}for(E=0;E<w.subdivisions;E++)for(j=0;j<w.subdivisions;j++){const r=j+1+(E+1)*(w.subdivisions+1),I=j+1+E*(w.subdivisions+1),d=j+E*(w.subdivisions+1),f=j+(E+1)*(w.subdivisions+1),q=e[3*r+1]>=w.minHeight,X=e[3*I+1]>=w.minHeight,k=e[3*d+1]>=w.minHeight;q&&X&&k&&(p.push(r),p.push(I),p.push(d));e[3*f+1]>=w.minHeight&&q&&k&&(p.push(f),p.push(r),p.push(d))}f.b.ComputeNormals(e,p,d);const K=new f.b;return K.indices=p,K.nw=e,K.lw=d,K.Uw=q,K}function c(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=new E(w,arguments.length>2?arguments[2]:void 0);e._setReady(!1),e._subdivisionsX=p.subdivisionsX||p.subdivisions||1,e._subdivisionsY=p.subdivisionsY||p.subdivisions||1,e._width=p.width||1,e._height=p.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ;return J(p).Vw(e,p.updatable),e._setReady(!0),e}function s(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new d.c(w,e);return K(p).Vw(r,p.updatable),r}function O(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=e.width||10,f=e.height||10,q=e.subdivisions||1,k=e.minHeight||0,m=e.maxHeight||1,J=e.colorFilter||new I.b(.3,.59,.11),K=e.alphaFilter||0,c=e.updatable,s=e.onReady;r=r||X.d.LastCreatedScene;const O=new E(w,r);let a;O._subdivisionsX=q,O._subdivisionsY=q,O._width=d,O._height=f,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ,O._setReady(!1),e.passHeightBufferInCallback&&(a=new Float32Array((q+1)*(q+1)));const A=(w,p,e)=>{y({width:d,height:f,subdivisions:q,minHeight:k,maxHeight:m,colorFilter:J,buffer:w,bufferWidth:p,bufferHeight:e,alphaFilter:K,heightBuffer:a}).Vw(O,c),s&&s(O,a),O._setReady(!0)};if("string"===typeof p){const w=w=>{var p;const e=w.width,I=w.height;if(r.K)return;const d=null===(p=r)||void 0===p?void 0:p.getEngine().resizeImageBitmap(w,e,I);A(d,e,I)};j.g.LoadImage(p,w,e.onError?e.onError:()=>{},r.offlineProvider)}else A(p.data,p.width,p.height);return O}f.b.CreateGround=J,f.b.CreateTiledGround=K,f.b.CreateGroundFromHeightMap=y,d.c.CreateGround=(w,p,e,r,I,d)=>c(w,{width:p,height:e,subdivisions:r,updatable:d},I),d.c.CreateTiledGround=(w,p,e,r,I,d,f,q,E)=>s(w,{xmin:p,zmin:e,xmax:r,zmax:I,subdivisions:d,precision:f,updatable:E},q),d.c.CreateGroundFromHeightMap=(w,p,e,r,I,d,f,q,E,j,X)=>O(w,p,{width:e,height:r,subdivisions:I,minHeight:d,maxHeight:f,updatable:E,onReady:j,alphaFilter:X},q)},13062:(w,p,e)=>{"use strict";e.d(p,{c:()=>J,e:()=>k,i:()=>m});var r=e(11023),I=e(11370),d=e(11337),f=e(11735),q=e(11232),E=e(11081);function j(w){const p=[],e=[],r=w.lines,I=w.Nw,f=[];let q=0;for(let d=0;d<r.length;d++){const w=r[d];for(let r=0;r<w.length;r++){const{x:E,y:j,z:X}=w[r];if(e.push(E,j,X),I){const w=I[d],{r:p,g:e,b:q,a:E}=w[r];f.push(p,e,q,E)}r>0&&(p.push(q-1),p.push(q)),q++}}const E=new d.b;return E.indices=p,E.nw=e,I&&(E.Nw=f),E}function X(w){const p=w.dashSize||3,e=w.gapSize||1,I=w.dashNb||200,f=w.points,q=[],E=[],j=r.k.Zero();let X=0,k=0,m=0,J=0,K=0,y=0,c=0;for(c=0;c<f.length-1;c++)f[c+1].subtractToRef(f[c],j),X+=j.length();for(m=X/I,J=p*m/(p+e),c=0;c<f.length-1;c++){f[c+1].subtractToRef(f[c],j),k=Math.floor(j.length()/m),j.normalize();for(let w=0;w<k;w++)K=m*w,q.push(f[c].x+K*j.x,f[c].y+K*j.y,f[c].z+K*j.z),q.push(f[c].x+(K+J)*j.x,f[c].y+(K+J)*j.y,f[c].z+(K+J)*j.z),E.push(y,y+1),y+=2}const s=new d.b;return s.nw=q,s.indices=E,s}function k(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=p.instance,I=p.lines,d=p.Nw;if(r){const w=r.getVerticesData(q.e.PositionKind);let p,e;d&&(p=r.getVerticesData(q.e.ColorKind));let f=0,E=0;for(let r=0;r<I.length;r++){const q=I[r];for(let I=0;I<q.length;I++)w[f]=q[I].x,w[f+1]=q[I].y,w[f+2]=q[I].z,d&&p&&(e=d[r],p[E]=e[I].r,p[E+1]=e[I].g,p[E+2]=e[I].b,p[E+3]=e[I].a,E+=4),f+=3}return r.updateVerticesData(q.e.PositionKind,w,!1,!1),d&&p&&r.updateVerticesData(q.e.ColorKind,p,!1,!1),r.refreshBoundingInfo(),r}const E=!!d,X=new f.d(w,e,null,void 0,void 0,E,p.useVertexAlpha,p.material);return j(p).Vw(X,p.updatable),X}function m(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=p.Nw?[p.Nw]:null;return k(w,{lines:[p.points],updatable:p.updatable,instance:p.instance,Nw:r,useVertexAlpha:p.useVertexAlpha,material:p.material},e)}function J(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=p.points,q=p.instance,j=p.gapSize||1,k=p.dashSize||3;if(q){const w=w=>{const p=r.k.Zero(),e=w.length/6;let I=0,f=0,E=0,j=0,X=0,k=0,m=0,J=0;for(m=0;m<d.length-1;m++)d[m+1].subtractToRef(d[m],p),I+=p.length();E=I/e;const K=q._creationDataStorage.dashSize;for(j=K*E/(K+q._creationDataStorage.gapSize),m=0;m<d.length-1;m++)for(d[m+1].subtractToRef(d[m],p),f=Math.floor(p.length()/E),p.normalize(),J=0;J<f&&k<w.length;)X=E*J,w[k]=d[m].x+X*p.x,w[k+1]=d[m].y+X*p.y,w[k+2]=d[m].z+X*p.z,w[k+3]=d[m].x+(X+j)*p.x,w[k+4]=d[m].y+(X+j)*p.y,w[k+5]=d[m].z+(X+j)*p.z,k+=6,J++;for(;k<w.length;)w[k]=d[m].x,w[k+1]=d[m].y,w[k+2]=d[m].z,k+=3};return(p.dashNb||p.dashSize||p.gapSize||p.useVertexAlpha||p.material)&&E.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),q.updateMeshPositions(w,!1),q}const m=new f.d(w,e,null,void 0,void 0,void 0,p.useVertexAlpha,p.material);return X(p).Vw(m,p.updatable),m._creationDataStorage=new I.e,m._creationDataStorage.dashSize=k,m._creationDataStorage.gapSize=j,m}d.b.CreateLineSystem=j,d.b.CreateDashedLines=X,I.c.Bj=function(w,p){return m(w,{points:p,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},I.c.CreateDashedLines=function(w,p,e,r,I){return J(w,{points:p,dashSize:e,gapSize:r,dashNb:I,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12422:(w,p,e)=>{"use strict";e.d(p,{d:()=>q,g:()=>E});var r=e(11370),I=e(11337),d=e(11400);function f(w){const p=[],e=[],r=[],f=[],q=void 0!==w.width?w.width:void 0!==w.size?w.size:1,E=void 0!==w.height?w.height:void 0!==w.size?w.size:1,j=0===w.sideOrientation?0:w.sideOrientation||I.b.DEFAULTSIDE,X=q/2,k=E/2;e.push(-X,-k,0),r.push(0,0,-1),f.push(0,d.b?1:0),e.push(X,-k,0),r.push(0,0,-1),f.push(1,d.b?1:0),e.push(X,k,0),r.push(0,0,-1),f.push(1,d.b?0:1),e.push(-X,k,0),r.push(0,0,-1),f.push(0,d.b?0:1),p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),I.b._ComputeSides(j,e,p,r,f,w.frontUVs,w.backUVs);const m=new I.b;return m.indices=p,m.nw=e,m.lw=r,m.Uw=f,m}function q(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new r.c(w,e);p.sideOrientation=r.c._GetDefaultSideOrientation(p.sideOrientation),I._originalBuilderSideOrientation=p.sideOrientation;return f(p).Vw(I,p.updatable),p.sourcePlane&&(I.translate(p.sourcePlane.dp,-p.sourcePlane.d),I.setDirection(p.sourcePlane.dp.scale(-1))),I}const E={Tj:q};I.b.Tj=f,r.c.Tj=(w,p,e,r,I)=>q(w,{size:p,width:p,height:p,sideOrientation:I,updatable:r},e)},12504:(w,p,e)=>{"use strict";e.d(p,{b:()=>E});var r=e(11023),I=e(11370),d=e(11337),f=e(11400);function q(w){const p=0|(w.segments||32),e=w.diameterX||w.diameter||1,I=w.diameterY||w.diameter||1,q=w.diameterZ||w.diameter||1,E=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,j=w.slice&&w.slice<=0?1:w.slice||1,X=0===w.sideOrientation?0:w.sideOrientation||d.b.DEFAULTSIDE,k=!!w.dedupTopBottomIndices,m=new r.k(e/2,I/2,q/2),J=2+p,K=2*J,y=[],c=[],s=[],O=[];for(let d=0;d<=J;d++){const w=d/J,p=w*Math.PI*j;for(let e=0;e<=K;e++){const I=e/K,d=I*Math.PI*2*E,q=r.b.RotationZ(-p),j=r.b.RotationY(d),X=r.k.TransformCoordinates(r.k.Up(),q),k=r.k.TransformCoordinates(X,j),J=k.multiply(m),y=k.divide(m).normalize();c.push(J.x,J.y,J.z),s.push(y.x,y.y,y.z),O.push(I,f.b?1-w:w)}if(d>0){const w=c.length/3;for(let p=w-2*(K+1);p+K+2<w;p++)k?(d>1&&(y.push(p),y.push(p+1),y.push(p+K+1)),(d<J||j<1)&&(y.push(p+K+1),y.push(p+1),y.push(p+K+2))):(y.push(p),y.push(p+1),y.push(p+K+1),y.push(p+K+1),y.push(p+1),y.push(p+K+2))}}d.b._ComputeSides(X,c,y,s,O,w.frontUVs,w.backUVs);const a=new d.b;return a.indices=y,a.nw=c,a.lw=s,a.Uw=O,a}function E(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return q(p).Vw(r,p.updatable),r}d.b.CreateSphere=q,I.c.CreateSphere=(w,p,e,r,I,d)=>E(w,{segments:p,diameterX:e,diameterY:e,diameterZ:e,sideOrientation:d,updatable:I},r)},13380:(w,p,e)=>{"use strict";e.d(p,{d:()=>q});var r=e(11755),I=e(12840),d=e(11772),f=e(11337);class q{static get Configuration(){return{get decoder(){return I.b.DefaultConfiguration},set decoder(w){I.b.DefaultConfiguration=w}}}static set Configuration(w){I.b.DefaultConfiguration=w.decoder}static get DecoderAvailable(){return(0,r.h)(I.b.DefaultConfiguration)}static get Default(){return q._Default??(q._Default=new q),q._Default}static ResetDefault(w){q._Default&&(w||q._Default.dispose(),q._Default=null)}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.DefaultNumWorkers;const p="number"===typeof w?{...I.b.DefaultConfiguration,numWorkers:w}:{...I.b.DefaultConfiguration,...w};this._decoder=new I.b(p)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(w,p,e){return this._decoder.decodeMeshToMeshDataAsync(w,p,e)}async decodeMeshToGeometryAsync(w,p,e,r){return await this._decoder.decodeMeshToGeometryAsync(w,p,e,r)}async _decodeMeshToGeometryForGltfAsync(w,p,e,r,I,d){return await this._decoder._decodeMeshToGeometryForGltfAsync(w,p,e,r,I,d)}async decodeMeshAsync(w,p){const e=await this._decoder.decodeMeshToMeshDataAsync(w,p),r=new f.b;e.indices&&(r.indices=e.indices);for(const I of e.attributes){const w=d.e.GetFloatData(I.data,I.size,d.e.GetDataType(I.data),I.byteOffset,I.byteStride,I.normalized,e.totalVertices);r.set(w,I.kind)}return r}}q.DefaultNumWorkers=(0,r.f)(),q._Default=null},12840:(w,p,e)=>{"use strict";e.d(p,{b:()=>j});var r=e(11755),I=e(11071),d=e(11391),f=e(11772),q=e(11081),E=e(11765);class j extends r.b{static get DefaultAvailable(){return(0,r.h)(j.DefaultConfiguration)}static get Default(){return j._Default??(j._Default=new j),j._Default}static ResetDefault(w){j._Default&&(w||j._Default.dispose(),j._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(w,p){return{module:await(p||DracoDecoderModule)({wasmBinary:w})}}_getWorkerContent(){return`${E.e}(${E.i})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultConfiguration)}decodeMeshToMeshDataAsync(w,p,e){const r=w instanceof ArrayBuffer?new Int8Array(w):new Int8Array(w.buffer,w.byteOffset,w.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async w=>await new Promise(((I,d)=>{w.push(((w,f)=>{let E=null;const j=[],X=p=>{w.removeEventListener("error",X),w.removeEventListener("message",k),d(p),f()},k=p=>{const r=p.data;switch(r.id){case"indices":E=r.data;break;case"attribute":j.push({kind:r.kind,data:r.data,size:r.size,byteOffset:r.byteOffset,byteStride:r.byteStride,normalized:(d=r.kind,m=r.normalized,e&&void 0!==e[d]?(m!==e[d]&&q.c.Warn(`Normalized flag from Draco data (${m}) does not match normalized flag from glTF accessor (${e[d]}). Using flag from glTF accessor.`),e[d]):m)});break;case"decodeMeshDone":w.removeEventListener("error",X),w.removeEventListener("message",k),I({indices:E,attributes:j,totalVertices:r.totalVertices}),f()}var d,m};w.addEventListener("error",X),w.addEventListener("message",k);const m=r.slice();w.postMessage({id:"decodeMesh",dataView:m,attributes:p},[m.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((w=>{let e=null;const I=[],d=(0,E.e)(w.module,r,p,(w=>{e=w}),((w,p,e,r,d,f)=>{I.push({kind:w,data:p,size:e,byteOffset:r,byteStride:d,normalized:f})}));return{indices:e,attributes:I,totalVertices:d}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(w,p,e,r){const I=await this.decodeMeshToMeshDataAsync(e,r),q=new d.d(w,p);I.indices&&q.setIndices(I.indices);for(const d of I.attributes)q.setVerticesBuffer(new f.e(p.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),I.totalVertices);return q}async _decodeMeshToGeometryForGltfAsync(w,p,e,r,I,q){const E=await this.decodeMeshToMeshDataAsync(e,r,I),j=new d.d(w,p);q&&(j._boundingInfo=q,j.useBoundingInfoFromGeometry=!0),E.indices&&j.setIndices(E.indices);for(const d of E.attributes)j.setVerticesBuffer(new f.e(p.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),E.totalVertices);return j}}j.DefaultConfiguration={wasmUrl:`${I.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${I.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${I.g._DefaultCdnUrl}/draco_decoder_gltf.js`},j._Default=null},13053:(w,p,e)=>{"use strict";e.d(p,{d:()=>qw});var r=e(11023),I=e(11370),d=e(11232),f=e(11337),q=e(11400);function E(w){let p=w.pathArray;const e=w.closeArray||!1,r=w.closePath||!1,I=w.invertUV||!1,E=Math.floor(p[0].length/2);let j=w.offset||E;j=j>E?E:Math.floor(j);const X=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,k=w.Uw,m=w.Nw,J=[],K=[],y=[],c=[],s=[],O=[],a=[],A=[];let z;const M=[],i=[];let t,n,l;if(p.length<2){const w=[],e=[];for(n=0;n<p[0].length-j;n++)w.push(p[0][n]),e.push(p[0][n+j]);p=[w,e]}let N=0;const U=r?1:0,v=e?1:0;let R,V,b,h,P,u;for(z=p[0].length,t=0;t<p.length+v;t++){for(a[t]=0,s[t]=[0],R=t===p.length?p[0]:p[t],V=R.length,z=z<V?z:V,l=0;l<V;)J.push(R[l].x,R[l].y,R[l].z),l>0&&(b=R[l].Je(R[l-1]).length(),h=b+a[t],s[t].push(h),a[t]=h),l++;r&&(l--,J.push(R[0].x,R[0].y,R[0].z),b=R[l].Je(R[0]).length(),h=b+a[t],s[t].push(h),a[t]=h),M[t]=V+U,i[t]=N,N+=V+U}let Y,L,W=null,F=null;for(n=0;n<z+U;n++)for(A[n]=0,O[n]=[0],t=0;t<p.length-1+v;t++)P=p[t],u=t===p.length-1?p[0]:p[t+1],n===z?(W=P[0],F=u[0]):(W=P[n],F=u[n]),b=F.Je(W).length(),h=b+A[n],O[n].push(h),A[n]=h;if(k)for(t=0;t<k.length;t++)c.push(k[t].x,q.b?1-k[t].y:k[t].y);else for(t=0;t<p.length+v;t++)for(n=0;n<z+U;n++)Y=0!=a[t]?s[t][n]/a[t]:0,L=0!=A[n]?O[n][t]/A[n]:0,I?c.push(L,Y):c.push(Y,q.b?1-L:L);t=0;let H=0,B=M[t]-1,D=M[t+1]-1,T=B<D?B:D,Z=i[1]-i[0];const G=M.length-1;for(;H<=T&&t<G;)K.push(H,H+Z,H+1),K.push(H+Z+1,H+1,H+Z),H+=1,H===T&&(t++,Z=i[t+1]-i[t],B=M[t]-1,D=M[t+1]-1,H=i[t],T=B<D?B+H:D+H);if(f.b.ComputeNormals(J,K,y),r){let w=0,e=0;for(t=0;t<p.length;t++){w=3*i[t],e=t+1<p.length?3*(i[t+1]-1):y.length-3,y[w]=.5*(y[w]+y[e]),y[w+1]=.5*(y[w+1]+y[e+1]),y[w+2]=.5*(y[w+2]+y[e+2]);const r=Math.sqrt(y[w]*y[w]+y[w+1]*y[w+1]+y[w+2]*y[w+2]);y[w]/=r,y[w+1]/=r,y[w+2]/=r,y[e]=y[w],y[e+1]=y[w+1],y[e+2]=y[w+2]}}if(e){let w=3*i[0],e=3*i[p.length];for(n=0;n<z+U;n++){y[w]=.5*(y[w]+y[e]),y[w+1]=.5*(y[w+1]+y[e+1]),y[w+2]=.5*(y[w+2]+y[e+2]);const p=Math.sqrt(y[w]*y[w]+y[w+1]*y[w+1]+y[w+2]*y[w+2]);y[w]/=p,y[w+1]/=p,y[w+2]/=p,y[e]=y[w],y[e+1]=y[w+1],y[e+2]=y[w+2],w+=3,e+=3}}f.b._ComputeSides(X,J,K,y,c,w.frontUVs,w.backUVs);let g=null;if(m){g=new Float32Array(4*m.length);for(let w=0;w<m.length;w++)g[4*w]=m[w].r,g[4*w+1]=m[w].g,g[4*w+2]=m[w].b,g[4*w+3]=m[w].a}const o=new f.b,C=new Float32Array(J),Q=new Float32Array(y),x=new Float32Array(c);return o.indices=K,o.nw=C,o.lw=Q,o.Uw=x,g&&o.set(g,d.e.ColorKind),r&&(o._idx=i),o}function j(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=p.pathArray,X=p.closeArray,k=p.closePath,m=I.c._GetDefaultSideOrientation(p.sideOrientation),J=p.instance,K=p.updatable;if(J){const w=r.d.ne[0].Pe(Number.MAX_VALUE),e=r.d.ne[1].Pe(-Number.MAX_VALUE),E=p=>{let r=j[0].length;const d=J;let f=0;const q=d._originalBuilderSideOrientation===I.c.DOUBLESIDE?2:1;for(let I=1;I<=q;++I)for(let q=0;q<j.length;++q){const I=j[q],E=I.length;r=r<E?r:E;for(let d=0;d<r;++d){const r=I[d];p[f]=r.x,p[f+1]=r.y,p[f+2]=r.z,w.minimizeInPlaceFromFloats(r.x,r.y,r.z),e.maximizeInPlaceFromFloats(r.x,r.y,r.z),f+=3}if(d._creationDataStorage&&d._creationDataStorage.closePath){const w=I[0];p[f]=w.x,p[f+1]=w.y,p[f+2]=w.z,f+=3}}},X=J.getVerticesData(d.e.PositionKind);if(E(X),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(w,e,J._worldMatrix):J.buildBoundingInfo(w,e,J._worldMatrix),J.updateVerticesData(d.e.PositionKind,X,!1,!1),p.Nw){const w=J.getVerticesData(d.e.ColorKind);for(let e=0,r=0;e<p.Nw.length;e++,r+=4){const I=p.Nw[e];w[r]=I.r,w[r+1]=I.g,w[r+2]=I.b,w[r+3]=I.a}J.updateVerticesData(d.e.ColorKind,w,!1,!1)}if(p.Uw){const w=J.getVerticesData(d.e.UVKind);for(let e=0;e<p.Uw.length;e++)w[2*e]=p.Uw[e].x,w[2*e+1]=q.b?1-p.Uw[e].y:p.Uw[e].y;J.updateVerticesData(d.e.UVKind,w,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){const w=J.Ke(),p=J.getVerticesData(d.e.NormalKind),e=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(f.b.ComputeNormals(X,w,p,e),J._creationDataStorage&&J._creationDataStorage.closePath){let w=0,e=0;for(let r=0;r<j.length;r++)w=3*J._creationDataStorage.idx[r],e=r+1<j.length?3*(J._creationDataStorage.idx[r+1]-1):p.length-3,p[w]=.5*(p[w]+p[e]),p[w+1]=.5*(p[w+1]+p[e+1]),p[w+2]=.5*(p[w+2]+p[e+2]),p[e]=p[w],p[e+1]=p[w+1],p[e+2]=p[w+2]}J.areNormalsFrozen||J.updateVerticesData(d.e.NormalKind,p,!1,!1)}return J}{const r=new I.c(w,e);r._originalBuilderSideOrientation=m,r._creationDataStorage=new I.e;const d=E(p);return k&&(r._creationDataStorage.idx=d._idx),r._creationDataStorage.closePath=k,r._creationDataStorage.closeArray=X,d.Vw(r,K),r}}f.b.CreateRibbon=E,I.c.CreateRibbon=function(w,p){return j(w,{pathArray:p,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var X=e(12522),k=e(12362),m=e(11308);function J(w){const p=w.pattern||I.c.NO_FLIP,e=w.tileWidth||w.tileSize||1,r=w.tileHeight||w.tileSize||1,d=w.alignHorizontal||0,q=w.alignVertical||0,E=w.width||w.size||1,j=Math.floor(E/e);let X=E-j*e;const k=w.height||w.size||1,m=Math.floor(k/r);let J=k-m*r;const K=e*j/2,y=r*m/2;let c=0,s=0,O=0,a=0,A=0,z=0;if(X>0||J>0){switch(O=-K,a=-y,A=K,z=y,d){case I.c.CENTER:X/=2,O-=X,A+=X;break;case I.c.LEFT:A+=X,c=-X/2;break;case I.c.RIGHT:O-=X,c=X/2}switch(q){case I.c.CENTER:J/=2,a-=J,z+=J;break;case I.c.BOTTOM:z+=J,s=-J/2;break;case I.c.TOP:a-=J,s=J/2}}const M=[],i=[],t=[];t[0]=[0,0,1,0,1,1,0,1],t[1]=[0,0,1,0,1,1,0,1],p!==I.c.ROTATE_TILE&&p!==I.c.ROTATE_ROW||(t[1]=[1,1,0,1,0,0,1,0]),p!==I.c.FLIP_TILE&&p!==I.c.FLIP_ROW||(t[1]=[1,0,0,0,0,1,1,1]),p!==I.c.FLIP_N_ROTATE_TILE&&p!==I.c.FLIP_N_ROTATE_ROW||(t[1]=[0,1,1,1,1,0,0,0]);let n=[];const l=[],N=[];let U=0;for(let f=0;f<m;f++)for(let w=0;w<j;w++)M.push(w*e-K+c,f*r-y+s,0),M.push((w+1)*e-K+c,f*r-y+s,0),M.push((w+1)*e-K+c,(f+1)*r-y+s,0),M.push(w*e-K+c,(f+1)*r-y+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),n=p===I.c.FLIP_TILE||p===I.c.ROTATE_TILE||p===I.c.FLIP_N_ROTATE_TILE?n.concat(t[(w%2+f%2)%2]):p===I.c.FLIP_ROW||p===I.c.ROTATE_ROW||p===I.c.FLIP_N_ROTATE_ROW?n.concat(t[f%2]):n.concat(t[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),U+=4;if(X>0||J>0){const w=J>0&&(q===I.c.CENTER||q===I.c.TOP),f=J>0&&(q===I.c.CENTER||q===I.c.BOTTOM),E=X>0&&(d===I.c.CENTER||d===I.c.RIGHT),k=X>0&&(d===I.c.CENTER||d===I.c.LEFT);let t,v,R,V,b=[];if(w&&E&&(M.push(O+c,a+s,0),M.push(-K+c,a+s,0),M.push(-K+c,a+J+s,0),M.push(O+c,a+J+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,t=1-X/e,v=1-J/r,R=1,V=1,b=[t,v,R,v,R,V,t,V],p===I.c.ROTATE_ROW&&(b=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),p===I.c.FLIP_ROW&&(b=[1-t,v,1-R,v,1-R,V,1-t,V]),p===I.c.FLIP_N_ROTATE_ROW&&(b=[t,1-v,R,1-v,R,1-V,t,1-V]),n=n.concat(b),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&k&&(M.push(K+c,a+s,0),M.push(A+c,a+s,0),M.push(A+c,a+J+s,0),M.push(K+c,a+J+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,t=0,v=1-J/r,R=X/e,V=1,b=[t,v,R,v,R,V,t,V],(p===I.c.ROTATE_ROW||p===I.c.ROTATE_TILE&&j%2===0)&&(b=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),(p===I.c.FLIP_ROW||p===I.c.FLIP_TILE&&j%2===0)&&(b=[1-t,v,1-R,v,1-R,V,1-t,V]),(p===I.c.FLIP_N_ROTATE_ROW||p===I.c.FLIP_N_ROTATE_TILE&&j%2===0)&&(b=[t,1-v,R,1-v,R,1-V,t,1-V]),n=n.concat(b),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&E&&(M.push(O+c,y+s,0),M.push(-K+c,y+s,0),M.push(-K+c,z+s,0),M.push(O+c,z+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,t=1-X/e,v=0,R=1,V=J/r,b=[t,v,R,v,R,V,t,V],(p===I.c.ROTATE_ROW&&m%2===1||p===I.c.ROTATE_TILE&&m%1===0)&&(b=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),(p===I.c.FLIP_ROW&&m%2===1||p===I.c.FLIP_TILE&&m%2===0)&&(b=[1-t,v,1-R,v,1-R,V,1-t,V]),(p===I.c.FLIP_N_ROTATE_ROW&&m%2===1||p===I.c.FLIP_N_ROTATE_TILE&&m%2===0)&&(b=[t,1-v,R,1-v,R,1-V,t,1-V]),n=n.concat(b),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&k&&(M.push(K+c,y+s,0),M.push(A+c,y+s,0),M.push(A+c,z+s,0),M.push(K+c,z+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,t=0,v=0,R=X/e,V=J/r,b=[t,v,R,v,R,V,t,V],(p===I.c.ROTATE_ROW&&m%2===1||p===I.c.ROTATE_TILE&&(m+j)%2===1)&&(b=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),(p===I.c.FLIP_ROW&&m%2===1||p===I.c.FLIP_TILE&&(m+j)%2===1)&&(b=[1-t,v,1-R,v,1-R,V,1-t,V]),(p===I.c.FLIP_N_ROTATE_ROW&&m%2===1||p===I.c.FLIP_N_ROTATE_TILE&&(m+j)%2===1)&&(b=[t,1-v,R,1-v,R,1-V,t,1-V]),n=n.concat(b),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w){const w=[];t=0,v=1-J/r,R=1,V=1,w[0]=[t,v,R,v,R,V,t,V],w[1]=[t,v,R,v,R,V,t,V],p!==I.c.ROTATE_TILE&&p!==I.c.ROTATE_ROW||(w[1]=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),p!==I.c.FLIP_TILE&&p!==I.c.FLIP_ROW||(w[1]=[1-t,v,1-R,v,1-R,V,1-t,V]),p!==I.c.FLIP_N_ROTATE_TILE&&p!==I.c.FLIP_N_ROTATE_ROW||(w[1]=[t,1-v,R,1-v,R,1-V,t,1-V]);for(let r=0;r<j;r++)M.push(r*e-K+c,a+s,0),M.push((r+1)*e-K+c,a+s,0),M.push((r+1)*e-K+c,a+J+s,0),M.push(r*e-K+c,a+J+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,n=p===I.c.FLIP_TILE||p===I.c.ROTATE_TILE||p===I.c.FLIP_N_ROTATE_TILE?n.concat(w[(r+1)%2]):p===I.c.FLIP_ROW||p===I.c.ROTATE_ROW||p===I.c.FLIP_N_ROTATE_ROW?n.concat(w[1]):n.concat(w[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(f){const w=[];t=0,v=0,R=1,V=J/r,w[0]=[t,v,R,v,R,V,t,V],w[1]=[t,v,R,v,R,V,t,V],p!==I.c.ROTATE_TILE&&p!==I.c.ROTATE_ROW||(w[1]=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),p!==I.c.FLIP_TILE&&p!==I.c.FLIP_ROW||(w[1]=[1-t,v,1-R,v,1-R,V,1-t,V]),p!==I.c.FLIP_N_ROTATE_TILE&&p!==I.c.FLIP_N_ROTATE_ROW||(w[1]=[t,1-v,R,1-v,R,1-V,t,1-V]);for(let r=0;r<j;r++)M.push(r*e-K+c,z-J+s,0),M.push((r+1)*e-K+c,z-J+s,0),M.push((r+1)*e-K+c,z+s,0),M.push(r*e-K+c,z+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,n=p===I.c.FLIP_TILE||p===I.c.ROTATE_TILE||p===I.c.FLIP_N_ROTATE_TILE?n.concat(w[(r+m)%2]):p===I.c.FLIP_ROW||p===I.c.ROTATE_ROW||p===I.c.FLIP_N_ROTATE_ROW?n.concat(w[m%2]):n.concat(w[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const w=[];t=1-X/e,v=0,R=1,V=1,w[0]=[t,v,R,v,R,V,t,V],w[1]=[t,v,R,v,R,V,t,V],p!==I.c.ROTATE_TILE&&p!==I.c.ROTATE_ROW||(w[1]=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),p!==I.c.FLIP_TILE&&p!==I.c.FLIP_ROW||(w[1]=[1-t,v,1-R,v,1-R,V,1-t,V]),p!==I.c.FLIP_N_ROTATE_TILE&&p!==I.c.FLIP_N_ROTATE_ROW||(w[1]=[t,1-v,R,1-v,R,1-V,t,1-V]);for(let e=0;e<m;e++)M.push(O+c,e*r-y+s,0),M.push(O+X+c,e*r-y+s,0),M.push(O+X+c,(e+1)*r-y+s,0),M.push(O+c,(e+1)*r-y+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,n=p===I.c.FLIP_TILE||p===I.c.ROTATE_TILE||p===I.c.FLIP_N_ROTATE_TILE?n.concat(w[(e+1)%2]):p===I.c.FLIP_ROW||p===I.c.ROTATE_ROW||p===I.c.FLIP_N_ROTATE_ROW?n.concat(w[e%2]):n.concat(w[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const w=[];t=0,v=0,R=X/r,V=1,w[0]=[t,v,R,v,R,V,t,V],w[1]=[t,v,R,v,R,V,t,V],p!==I.c.ROTATE_TILE&&p!==I.c.ROTATE_ROW||(w[1]=[1-t,1-v,1-R,1-v,1-R,1-V,1-t,1-V]),p!==I.c.FLIP_TILE&&p!==I.c.FLIP_ROW||(w[1]=[1-t,v,1-R,v,1-R,V,1-t,V]),p!==I.c.FLIP_N_ROTATE_TILE&&p!==I.c.FLIP_N_ROTATE_ROW||(w[1]=[t,1-v,R,1-v,R,1-V,t,1-V]);for(let e=0;e<m;e++)M.push(A-X+c,e*r-y+s,0),M.push(A+c,e*r-y+s,0),M.push(A+c,(e+1)*r-y+s,0),M.push(A-X+c,(e+1)*r-y+s,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,n=p===I.c.FLIP_TILE||p===I.c.ROTATE_TILE||p===I.c.FLIP_N_ROTATE_TILE?n.concat(w[(e+j)%2]):p===I.c.FLIP_ROW||p===I.c.ROTATE_ROW||p===I.c.FLIP_N_ROTATE_ROW?n.concat(w[e%2]):n.concat(w[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),i.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const v=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE;f.b._ComputeSides(v,M,N,i,n,w.frontUVs,w.backUVs);const R=new f.b;R.indices=N,R.nw=M,R.lw=i,R.Uw=n;const V=v===f.b.DOUBLESIDE?l.concat(l):l;return R.Nw=V,R}function K(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return J(p).Vw(r,p.updatable),r}function y(w){const p=w.faceUV||new Array(6),e=w.faceColors,d=w.pattern||I.c.NO_FLIP,E=w.width||w.size||1,j=w.height||w.size||1,X=w.depth||w.size||1,k=w.tileWidth||w.tileSize||1,K=w.tileHeight||w.tileSize||1,y=w.alignHorizontal||0,c=w.alignVertical||0,s=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE;for(let I=0;I<6;I++)void 0===p[I]&&(p[I]=new r.o(0,0,1,1)),e&&void 0===e[I]&&(e[I]=new m.e(1,1,1,1));const O=E/2,a=j/2,A=X/2,z=[];for(let r=0;r<2;r++)z[r]=J({pattern:d,tileWidth:k,tileHeight:K,width:E,height:j,alignVertical:c,alignHorizontal:y,sideOrientation:s});for(let r=2;r<4;r++)z[r]=J({pattern:d,tileWidth:k,tileHeight:K,width:X,height:j,alignVertical:c,alignHorizontal:y,sideOrientation:s});let M=c;c===I.c.BOTTOM?M=I.c.TOP:c===I.c.TOP&&(M=I.c.BOTTOM);for(let r=4;r<6;r++)z[r]=J({pattern:d,tileWidth:k,tileHeight:K,width:E,height:X,alignVertical:M,alignHorizontal:y,sideOrientation:s});let i=[],t=[],n=[],l=[];const N=[],U=[],v=[],R=[];let V=0,b=0;for(let I=0;I<6;I++){const w=z[I].nw.length;U[I]=[],v[I]=[];for(let p=0;p<w/3;p++)U[I].push(new r.k(z[I].nw[3*p],z[I].nw[3*p+1],z[I].nw[3*p+2])),v[I].push(new r.k(z[I].lw[3*p],z[I].lw[3*p+1],z[I].lw[3*p+2]));V=z[I].Uw.length,R[I]=[];for(let e=0;e<V;e+=2)R[I][e]=p[I].x+(p[I].z-p[I].x)*z[I].Uw[e],R[I][e+1]=p[I].y+(p[I].w-p[I].y)*z[I].Uw[e+1],q.b&&(R[I][e+1]=1-R[I][e+1]);if(n=n.concat(R[I]),l=l.concat(z[I].indices.map((w=>w+b))),b+=U[I].length,e)for(let p=0;p<4;p++)N.push(e[I].r,e[I].g,e[I].b,e[I].a)}const h=new r.k(0,0,A),P=r.b.RotationY(Math.PI);i=U[0].map((w=>r.k.TransformNormal(w,P).add(h))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]),t=v[0].map((w=>r.k.TransformNormal(w,P))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]),i=i.concat(U[1].map((w=>w.Je(h))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),t=t.concat(v[1].map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]));const u=new r.k(O,0,0),Y=r.b.RotationY(-Math.PI/2);i=i.concat(U[2].map((w=>r.k.TransformNormal(w,Y).add(u))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),t=t.concat(v[2].map((w=>r.k.TransformNormal(w,Y))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]));const L=r.b.RotationY(Math.PI/2);i=i.concat(U[3].map((w=>r.k.TransformNormal(w,L).Je(u))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),t=t.concat(v[3].map((w=>r.k.TransformNormal(w,L))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]));const W=new r.k(0,a,0),F=r.b.RotationX(Math.PI/2);i=i.concat(U[4].map((w=>r.k.TransformNormal(w,F).add(W))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),t=t.concat(v[4].map((w=>r.k.TransformNormal(w,F))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[]));const H=r.b.RotationX(-Math.PI/2);i=i.concat(U[5].map((w=>r.k.TransformNormal(w,H).Je(W))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),t=t.concat(v[5].map((w=>r.k.TransformNormal(w,H))).map((w=>[w.x,w.y,w.z])).reduce(((w,p)=>w.concat(p)),[])),f.b._ComputeSides(s,i,l,t,n);const B=new f.b;if(B.indices=l,B.nw=i,B.lw=t,B.Uw=n,e){const w=s===f.b.DOUBLESIDE?N.concat(N):N;B.Nw=w}return B}function c(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return y(p).Vw(r,p.updatable),r}f.b.CreateTiledPlane=J;f.b.CreateTiledBox=y;var s=e(12504),O=e(11590),a=e(11358);function A(w){const p=w.height||2;let e=0===w.diameterTop?0:w.diameterTop||w.diameter||1,d=0===w.diameterBottom?0:w.diameterBottom||w.diameter||1;e=e||1e-5,d=d||1e-5;const E=0|(w.tessellation||24),j=0|(w.subdivisions||1),X=!!w.hasRings,k=!!w.enclose,J=0===w.cap?0:w.cap||I.c.CAP_ALL,K=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,y=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,c=w.faceUV||new Array(3),s=w.faceColors,O=2+(1+(1!==K&&k?2:0))*(X?j:1);let A;for(A=0;A<O;A++)s&&void 0===s[A]&&(s[A]=new m.e(1,1,1,1));for(A=0;A<O;A++)c&&void 0===c[A]&&(c[A]=new r.o(0,0,1,1));const z=[],M=[],i=[],t=[],n=[],l=2*Math.PI*K/E;let N,U,v;const R=(d-e)/2/p,V=r.k.Zero(),b=r.k.Zero(),h=r.k.Zero(),P=r.k.Zero(),u=r.k.Zero(),Y=a.b.Y;let L,W,F,H=1,B=1,D=0,T=0;for(L=0;L<=j;L++)for(U=L/j,v=(U*(e-d)+d)/2,H=X&&0!==L&&L!==j?2:1,F=0;F<H;F++){for(X&&(B+=F),k&&(B+=2*F),W=0;W<=E;W++)N=W*l,V.x=Math.cos(-N)*v,V.y=-p/2+U*p,V.z=Math.sin(-N)*v,0===e&&L===j?(b.x=i[i.length-3*(E+1)],b.y=i[i.length-3*(E+1)+1],b.z=i[i.length-3*(E+1)+2]):(b.x=V.x,b.z=V.z,b.y=Math.sqrt(b.x*b.x+b.z*b.z)*R,b.normalize()),0===W&&(h.X(V),P.X(b)),M.push(V.x,V.y,V.z),i.push(b.x,b.y,b.z),T=X?D!==B?c[B].y:c[B].w:c[B].y+(c[B].w-c[B].y)*U,t.push(c[B].x+(c[B].z-c[B].x)*W/E,q.b?1-T:T),s&&n.push(s[B].r,s[B].g,s[B].b,s[B].a);1!==K&&k&&(M.push(V.x,V.y,V.z),M.push(0,V.y,0),M.push(0,V.y,0),M.push(h.x,h.y,h.z),r.k.CrossToRef(Y,b,u),u.normalize(),i.push(u.x,u.y,u.z,u.x,u.y,u.z),r.k.CrossToRef(P,Y,u),u.normalize(),i.push(u.x,u.y,u.z,u.x,u.y,u.z),T=X?D!==B?c[B+1].y:c[B+1].w:c[B+1].y+(c[B+1].w-c[B+1].y)*U,t.push(c[B+1].x,q.b?1-T:T),t.push(c[B+1].z,q.b?1-T:T),T=X?D!==B?c[B+2].y:c[B+2].w:c[B+2].y+(c[B+2].w-c[B+2].y)*U,t.push(c[B+2].x,q.b?1-T:T),t.push(c[B+2].z,q.b?1-T:T),s&&(n.push(s[B+1].r,s[B+1].g,s[B+1].b,s[B+1].a),n.push(s[B+1].r,s[B+1].g,s[B+1].b,s[B+1].a),n.push(s[B+2].r,s[B+2].g,s[B+2].b,s[B+2].a),n.push(s[B+2].r,s[B+2].g,s[B+2].b,s[B+2].a))),D!==B&&(D=B)}const Z=1!==K&&k?E+4:E;for(L=0,B=0;B<j;B++){let w=0,p=0,e=0,r=0;for(W=0;W<E;W++)w=L*(Z+1)+W,p=(L+1)*(Z+1)+W,e=L*(Z+1)+(W+1),r=(L+1)*(Z+1)+(W+1),z.push(w,p,e),z.push(r,e,p);1!==K&&k&&(z.push(w+2,p+2,e+2),z.push(r+2,e+2,p+2),z.push(w+4,p+4,e+4),z.push(r+4,e+4,p+4)),L=X?L+2:L+1}const G=w=>{const I=w?e/2:d/2;if(0===I)return;let f,j,X;const k=w?c[O-1]:c[0];let m=null;s&&(m=w?s[O-1]:s[0]);const J=M.length/3,y=w?p/2:-p/2,a=new r.k(0,y,0);M.push(a.x,a.y,a.z),i.push(0,w?1:-1,0);const A=k.y+.5*(k.w-k.y);t.push(k.x+.5*(k.z-k.x),q.b?1-A:A),m&&n.push(m.r,m.g,m.b,m.a);const l=new r.g(.5,.5);for(X=0;X<=E;X++){f=2*Math.PI*X*K/E;const p=Math.cos(-f),e=Math.sin(-f);j=new r.k(p*I,y,e*I);const d=new r.g(p*l.x+.5,e*l.y+.5);M.push(j.x,j.y,j.z),i.push(0,w?1:-1,0);const J=k.y+(k.w-k.y)*d.y;t.push(k.x+(k.z-k.x)*d.x,q.b?1-J:J),m&&n.push(m.r,m.g,m.b,m.a)}for(X=0;X<E;X++)w?(z.push(J),z.push(J+(X+2)),z.push(J+(X+1))):(z.push(J),z.push(J+(X+1)),z.push(J+(X+2)))};J!==I.c.CAP_START&&J!==I.c.CAP_ALL||G(!1),J!==I.c.CAP_END&&J!==I.c.CAP_ALL||G(!0),f.b._ComputeSides(y,M,z,i,t,w.frontUVs,w.backUVs);const g=new f.b;return g.indices=z,g.nw=M,g.lw=i,g.Uw=t,s&&(g.Nw=n),g}function z(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return A(p).Vw(r,p.updatable),r}function M(w){const p=[],e=[],I=[],d=[],E=w.diameter||1,j=w.thickness||.5,X=0|(w.tessellation||16),k=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,m=X+1;for(let f=0;f<=X;f++){const w=f/X,k=f*Math.PI*2/X-Math.PI/2,J=r.b.Translation(E/2,0,0).multiply(r.b.RotationY(k));for(let E=0;E<=X;E++){const k=1-E/X,K=E*Math.PI*2/X+Math.PI,y=Math.cos(K),c=Math.sin(K);let s=new r.k(y,c,0),O=s.scale(j/2);const a=new r.g(w,k);O=r.k.TransformCoordinates(O,J),s=r.k.TransformNormal(s,J),e.push(O.x,O.y,O.z),I.push(s.x,s.y,s.z),d.push(a.x,q.b?1-a.y:a.y);const A=(f+1)%m,z=(E+1)%m;p.push(f*m+E),p.push(f*m+z),p.push(A*m+E),p.push(f*m+z),p.push(A*m+z),p.push(A*m+E)}}f.b._ComputeSides(k,e,p,I,d,w.frontUVs,w.backUVs);const J=new f.b;return J.indices=p,J.nw=e,J.lw=I,J.Uw=d,J}function i(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return M(p).Vw(r,p.updatable),r}f.b.CreateCylinder=A,I.c.CreateCylinder=(w,p,e,r,d,f,q,E,j)=>{void 0!==q&&q instanceof O.c||(void 0!==q&&(j=E||I.c.DEFAULTSIDE,E=q),q=f,f=1);return z(w,{height:p,diameterTop:e,diameterBottom:r,tessellation:d,subdivisions:f,sideOrientation:j,updatable:E},q)};function t(w){const p=[],e=[],I=[],d=[],E=w.radius||2,j=w.tube||.5,X=w.radialSegments||32,k=w.tubularSegments||32,m=w.p||2,J=w.q||3,K=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,y=w=>{const p=Math.cos(w),e=Math.sin(w),I=J/m*w,d=Math.cos(I),f=E*(2+d)*.5*p,q=E*(2+d)*e*.5,j=E*Math.sin(I)*.5;return new r.k(f,q,j)};let c,s;for(c=0;c<=X;c++){const w=c%X/X*2*m*Math.PI,p=y(w),I=y(w+.01),f=I.Je(p);let E=I.add(p);const J=r.k.Cross(f,E);for(E=r.k.Cross(J,f),J.normalize(),E.normalize(),s=0;s<k;s++){const w=s%k/k*2*Math.PI,r=-j*Math.cos(w),I=j*Math.sin(w);e.push(p.x+r*E.x+I*J.x),e.push(p.y+r*E.y+I*J.y),e.push(p.z+r*E.z+I*J.z),d.push(c/X),d.push(q.b?1-s/k:s/k)}}for(c=0;c<X;c++)for(s=0;s<k;s++){const w=(s+1)%k,e=c*k+s,r=(c+1)*k+s,I=(c+1)*k+w,d=c*k+w;p.push(d),p.push(r),p.push(e),p.push(d),p.push(I),p.push(r)}f.b.ComputeNormals(e,p,I),f.b._ComputeSides(K,e,p,I,d,w.frontUVs,w.backUVs);const O=new f.b;return O.indices=p,O.nw=e,O.lw=I,O.Uw=d,O}function n(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return t(p).Vw(r,p.updatable),r}f.b.CreateTorus=M,I.c.CreateTorus=(w,p,e,r,I,d,f)=>i(w,{diameter:p,thickness:e,tessellation:r,sideOrientation:f,updatable:d},I);f.b.CreateTorusKnot=t,I.c.CreateTorusKnot=(w,p,e,r,I,d,f,q,E,j)=>n(w,{radius:p,tube:e,radialSegments:r,tubularSegments:I,p:d,q:f,sideOrientation:j,updatable:E},q);var l=e(13062),N=e(11747),U=e(11482);function v(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=p.path,d=p.shape,f=p.scale||1,q=p.rotation||0,E=0===p.cap?0:p.cap||I.c.NO_CAP,j=p.updatable,X=I.c._GetDefaultSideOrientation(p.sideOrientation),k=p.instance||null,m=p.invertUV||!1,J=p.closeShape||!1,K=p.closePath||!1,y=p.capFunction||null;return V(w,d,r,f,q,null,null,K,J,E,!1,e,!!j,X,k,m,p.frontUVs||null,p.backUVs||null,p.firstNormal||null,!!p.adjustFrame,y)}function R(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=p.path,d=p.shape,f=p.scaleFunction||(()=>1),q=p.rotationFunction||(()=>0),E=p.closePath||p.ribbonCloseArray||!1,j=p.closeShape||p.ribbonClosePath||!1,X=0===p.cap?0:p.cap||I.c.NO_CAP,k=p.updatable,m=p.firstNormal||null,J=p.adjustFrame||!1,K=I.c._GetDefaultSideOrientation(p.sideOrientation),y=p.instance,c=p.invertUV||!1,s=p.capFunction||null;return V(w,d,r,null,null,f,q,E,j,X,!0,e,!!k,K,y||null,c,p.frontUVs||null,p.backUVs||null,m,J,s||null)}function V(w,p,e,d,f,q,E,X,k,m,J,K,y,c,s,O,a,A,z,M,i){const t=(w,p,e,d,f,q,E,j,X,k,m)=>{const J=e.getTangents(),K=e.getNormals(),y=e.getBinormals(),c=e.getDistances();if(m)for(let I=0;I<J.length;I++)if(0==J[I].x&&0==J[I].y&&0==J[I].z&&J[I].X(J[I-1]),0==K[I].x&&0==K[I].y&&0==K[I].z&&K[I].X(K[I-1]),0==y[I].x&&0==y[I].y&&0==y[I].z&&y[I].X(y[I-1]),I>0){let w=J[I-1];r.k.Dot(w,J[I])<0&&J[I].scaleInPlace(-1),w=K[I-1],r.k.Dot(w,K[I])<0&&K[I].scaleInPlace(-1),w=y[I-1],r.k.Dot(w,y[I])<0&&y[I].scaleInPlace(-1)}let s=0;const O=k&&j?j:()=>null!==q?q:0,a=k&&E?E:()=>null!==f?f:1;let A=X===I.c.NO_CAP||X===I.c.CAP_END?0:2;const z=r.d.Matrix[0];for(let I=0;I<p.length;I++){const e=[],f=O(I,c[I]),q=a(I,c[I]);r.b.RotationAxisToRef(J[I],s,z);for(let d=0;d<w.length;d++){const f=J[I].scale(w[d].z).add(K[I].scale(w[d].x)).add(y[I].scale(w[d].y)),E=r.k.Zero();r.k.TransformCoordinatesToRef(f,z,E),E.scaleInPlace(q).addInPlace(p[I]),e[d]=E}d[A]=e,s+=f,A++}const M=i||(w=>{const p=Array(),e=r.k.Zero();let I;for(I=0;I<w.length;I++)e.addInPlace(w[I]);for(e.scaleInPlace(1/w.length),I=0;I<w.length;I++)p.push(e);return p});switch(X){case I.c.NO_CAP:break;case I.c.CAP_START:d[0]=M(d[2]),d[1]=d[2];break;case I.c.CAP_END:d[A]=d[A-1],d[A+1]=M(d[A-1]);break;case I.c.CAP_ALL:d[0]=M(d[2]),d[1]=d[2],d[A]=d[A-1],d[A+1]=M(d[A-1])}return d};let n,l;if(s){const w=s._creationDataStorage;return n=z?w.path3D.update(e,z):w.path3D.update(e),l=t(p,e,w.path3D,w.pathArray,d,f,q,E,w.cap,J,M),s=j("",{pathArray:l,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:s},K||void 0)}n=z?new U.o(e,z):new U.o(e);l=t(p,e,n,new Array,d,f,q,E,m=m<0||m>3?0:m,J,M);const N=j(w,{pathArray:l,closeArray:X,closePath:k,updatable:y,sideOrientation:c,invertUV:O,frontUVs:a||void 0,backUVs:A||void 0},K);return N._creationDataStorage.pathArray=l,N._creationDataStorage.path3D=n,N._creationDataStorage.cap=m,N}function b(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=p.arc?p.arc<=0||p.arc>1?1:p.arc:1,f=void 0===p.closed||p.closed,q=p.shape,E=p.radius||1,X=p.tessellation||64,k=p.clip||0,m=p.updatable,J=I.c._GetDefaultSideOrientation(p.sideOrientation),K=p.cap||I.c.NO_CAP,y=2*Math.PI,c=[],s=p.invertUV||!1;let O=0,a=0;const A=y/X*d;let z,M;for(O=0;O<=X-k;O++){for(M=[],K!=I.c.CAP_START&&K!=I.c.CAP_ALL||(M.push(new r.k(0,q[0].y,0)),M.push(new r.k(Math.cos(O*A)*q[0].x*E,q[0].y,Math.sin(O*A)*q[0].x*E))),a=0;a<q.length;a++)z=new r.k(Math.cos(O*A)*q[a].x*E,q[a].y,Math.sin(O*A)*q[a].x*E),M.push(z);K!=I.c.CAP_END&&K!=I.c.CAP_ALL||(M.push(new r.k(Math.cos(O*A)*q[q.length-1].x*E,q[q.length-1].y,Math.sin(O*A)*q[q.length-1].x*E)),M.push(new r.k(0,q[q.length-1].y,0))),c.push(M)}return j(w,{pathArray:c,closeArray:f,sideOrientation:J,updatable:m,invertUV:s,frontUVs:p.frontUVs,backUVs:p.backUVs},e)}I.c.ExtrudeShape=function(w,p,e,r,d,f){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0,X=arguments.length>9?arguments[9]:void 0;return v(w,{shape:p,path:e,scale:r,rotation:d,cap:0===f?0:f||I.c.NO_CAP,sideOrientation:j,instance:X,updatable:E},q)},I.c.ExtrudeShapeCustom=(w,p,e,r,d,f,q,E,j,X,k,m)=>R(w,{shape:p,path:e,scaleFunction:r,rotationFunction:d,ribbonCloseArray:f,ribbonClosePath:q,cap:0===E?0:E||I.c.NO_CAP,sideOrientation:k,instance:m,updatable:X},j);I.c.CreateLathe=(w,p,e,r,I,d,f)=>b(w,{shape:p,radius:e,tessellation:r,sideOrientation:f,updatable:d},I);var h=e(12422),P=e(12369);function u(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=p.path;let f=p.instance,q=1;void 0!==p.radius?q=p.radius:f&&(q=f._creationDataStorage.radius);const E=p.tessellation||64,X=p.radiusFunction||null;let k=p.cap||I.c.NO_CAP;const m=p.invertUV||!1,J=p.updatable,K=I.c._GetDefaultSideOrientation(p.sideOrientation);p.arc=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1;const y=(w,p,e,d,f,q,E,j)=>{const X=p.getTangents(),k=p.getNormals(),m=p.getDistances(),J=2*Math.PI/f*j,K=q||(()=>d);let y,c,s,O;const a=r.d.Matrix[0];let A=E===I.c.NO_CAP||E===I.c.CAP_END?0:2;for(let I=0;I<w.length;I++){c=K(I,m[I]),y=Array(),s=k[I];for(let p=0;p<f;p++)r.b.RotationAxisToRef(X[I],J*p,a),O=y[p]?y[p]:r.k.Zero(),r.k.TransformCoordinatesToRef(s,a,O),O.scaleInPlace(c).addInPlace(w[I]),y[p]=O;e[A]=y,A++}const z=(p,e)=>{const r=Array();for(let I=0;I<p;I++)r.push(w[e]);return r};switch(E){case I.c.NO_CAP:break;case I.c.CAP_START:e[0]=z(f,0),e[1]=e[2].slice(0);break;case I.c.CAP_END:e[A]=e[A-1].slice(0),e[A+1]=z(f,w.length-1);break;case I.c.CAP_ALL:e[0]=z(f,0),e[1]=e[2].slice(0),e[A]=e[A-1].slice(0),e[A+1]=z(f,w.length-1)}return e};let c,s;if(f){const w=f._creationDataStorage,e=p.arc||w.arc;return c=w.path3D.update(d),s=y(d,c,w.pathArray,q,w.tessellation,X,w.cap,e),f=j("",{pathArray:s,instance:f}),w.path3D=c,w.pathArray=s,w.arc=e,w.radius=q,f}c=new U.o(d);k=k<0||k>3?0:k,s=y(d,c,new Array,q,E,X,k,p.arc);const O=j(w,{pathArray:s,closePath:!0,closeArray:!1,updatable:J,sideOrientation:K,invertUV:m,frontUVs:p.frontUVs,backUVs:p.backUVs},e);return O._creationDataStorage.pathArray=s,O._creationDataStorage.path3D=c,O._creationDataStorage.tessellation=E,O._creationDataStorage.cap=k,O._creationDataStorage.arc=p.arc,O._creationDataStorage.radius=q,O}function Y(w){const p=[];p[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},p[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},p[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},p[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},p[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},p[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},p[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},p[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},p[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},p[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},p[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},p[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},p[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},p[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},p[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const e=w.type&&(w.type<0||w.type>=p.length)?0:w.type||0,I=w.size,d=w.sizeX||I||1,E=w.sizeY||I||1,j=w.sizeZ||I||1,X=w.custom||p[e],k=X.face.length,J=w.faceUV||new Array(k),K=w.faceColors,y=void 0===w.flat||w.flat,c=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,s=[],O=[],a=[],A=[],z=[];let M=0,i=0;const t=[];let n,l,N,U,v,R,V=0,b=0;if(y)for(b=0;b<k;b++)K&&void 0===K[b]&&(K[b]=new m.e(1,1,1,1)),J&&void 0===J[b]&&(J[b]=new r.o(0,0,1,1));if(y)for(b=0;b<k;b++){const w=X.face[b].length;for(N=2*Math.PI/w,U=.5*Math.tan(N/2),v=.5,V=0;V<w;V++)s.push(X.vertex[X.face[b][V]][0]*d,X.vertex[X.face[b][V]][1]*E,X.vertex[X.face[b][V]][2]*j),t.push(M),M++,n=J[b].x+(J[b].z-J[b].x)*(.5+U),l=J[b].y+(J[b].w-J[b].y)*(v-.5),A.push(n,q.b?1-l:l),R=U*Math.cos(N)-v*Math.sin(N),v=U*Math.sin(N)+v*Math.cos(N),U=R,K&&z.push(K[b].r,K[b].g,K[b].b,K[b].a);for(V=0;V<w-2;V++)O.push(t[0+i],t[V+2+i],t[V+1+i]);i+=w}else{for(V=0;V<X.vertex.length;V++)s.push(X.vertex[V][0]*d,X.vertex[V][1]*E,X.vertex[V][2]*j),A.push(0,q.b?1:0);for(b=0;b<k;b++)for(V=0;V<X.face[b].length-2;V++)O.push(X.face[b][0],X.face[b][V+2],X.face[b][V+1])}f.b.ComputeNormals(s,O,a),f.b._ComputeSides(c,s,O,a,A,w.frontUVs,w.backUVs);const h=new f.b;return h.nw=s,h.indices=O,h.lw=a,h.Uw=A,K&&y&&(h.Nw=z),h}function L(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return Y(p).Vw(r,p.updatable),r}I.c.CreateTube=(w,p,e,r,I,d,f,q,E,j)=>u(w,{path:p,radius:e,tessellation:r,radiusFunction:I,arc:1,cap:d,updatable:q,sideOrientation:E,instance:j},f);function W(w){const p=w.sideOrientation||f.b.DEFAULTSIDE,e=w.radius||1,I=void 0===w.flat||w.flat,d=0|(w.subdivisions||4),E=w.radiusX||e,j=w.radiusY||e,X=w.radiusZ||e,k=(1+Math.sqrt(5))/2,m=[-1,k,-0,1,k,0,-1,-k,0,1,-k,0,0,-1,-k,0,1,-k,0,-1,k,0,1,k,k,0,1,k,0,-1,-k,0,1,-k,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],K=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],s=[],O=[],a=[],A=[];let z=0;const M=new Array(3),i=new Array(3);let t;for(t=0;t<3;t++)M[t]=r.k.Zero(),i[t]=r.g.Zero();for(let f=0;f<20;f++){for(t=0;t<3;t++){const w=J[3*f+t];M[t].te(m[3*K[w]],m[3*K[w]+1],m[3*K[w]+2]),M[t].normalize(),i[t].te(.134765625*y[2*w]+.05859375+-.0390625*c[f],.2333984375*y[2*w+1]+.025390625+.01953125*c[f])}const w=(w,p,e,f)=>{const k=r.k.Lerp(M[0],M[2],p/d),m=r.k.Lerp(M[1],M[2],p/d),J=d===p?M[2]:r.k.Lerp(k,m,w/(d-p));let K;if(J.normalize(),I){const w=r.k.Lerp(M[0],M[2],f/d),p=r.k.Lerp(M[1],M[2],f/d);K=r.k.Lerp(w,p,e/(d-f))}else K=new r.k(J.x,J.y,J.z);K.x/=E,K.y/=j,K.z/=X,K.normalize();const y=r.g.Lerp(i[0],i[2],p/d),c=r.g.Lerp(i[1],i[2],p/d),t=d===p?i[2]:r.g.Lerp(y,c,w/(d-p));O.push(J.x*E,J.y*j,J.z*X),a.push(K.x,K.y,K.z),A.push(t.x,q.b?1-t.y:t.y),s.push(z),z++};for(let p=0;p<d;p++)for(let e=0;e+p<d;e++)w(e,p,e+1/3,p+1/3),w(e+1,p,e+1/3,p+1/3),w(e,p+1,e+1/3,p+1/3),e+p+1<d&&(w(e+1,p,e+2/3,p+2/3),w(e+1,p+1,e+2/3,p+2/3),w(e,p+1,e+2/3,p+2/3))}f.b._ComputeSides(p,O,s,a,A,w.frontUVs,w.backUVs);const n=new f.b;return n.indices=s,n.nw=O,n.lw=a,n.Uw=A,n}function F(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new I.c(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),r._originalBuilderSideOrientation=p.sideOrientation;return W(p).Vw(r,p.updatable),r}f.b.CreatePolyhedron=Y,I.c.CreatePolyhedron=(w,p,e)=>L(w,p,e);f.b.CreateIcoSphere=W,I.c.CreateIcoSphere=(w,p,e)=>F(w,p,e);var H=e(11063);const B=new r.k(1,0,0),D=new r.k(-1,0,0),T=new r.k(0,1,0),Z=new r.k(0,-1,0),G=new r.k(0,0,1),g=new r.k(0,0,-1);class o{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.k.Zero(),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.k.Up(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.g.Zero(),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=w,this.dp=p,this.uv=e,this.vertexIdx=I,this.vertexIdxForBones=d,this.localPositionOverride=f,this.localNormalOverride=q,this.matrixIndicesOverride=E,this.matrixWeightsOverride=j}clone(){var w,p,e,r;return new o(this.position.clone(),this.dp.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(w=this.localPositionOverride)||void 0===w?void 0:w.slice(),null===(p=this.localNormalOverride)||void 0===p?void 0:p.slice(),null===(e=this.matrixIndicesOverride)||void 0===e?void 0:e.slice(),null===(r=this.matrixWeightsOverride)||void 0===r?void 0:r.slice())}}function C(w,p,e){var E,j,X,k,m;const J=!!p.skeleton,K=!(null===(E=p.morphTargetManager)||void 0===E||!E.numTargets),y=e.localMode||J,c=p.Ke(),s=J||K?p.sE(!0,!0):p.getVerticesData(d.e.PositionKind),O=J||K?p.getNormalsData(!0,!0):p.getVerticesData(d.e.NormalKind),a=y?J?p.getVerticesData(d.e.PositionKind):s:null,A=y?J?p.getVerticesData(d.e.NormalKind):O:null,z=p.getVerticesData(d.e.UVKind),M=J?p.getVerticesData(d.e.MatricesIndicesKind):null,i=J?p.getVerticesData(d.e.MatricesWeightsKind):null,t=J?p.getVerticesData(d.e.MatricesIndicesExtraKind):null,n=J?p.getVerticesData(d.e.MatricesWeightsExtraKind):null,l=e.position||r.k.Zero();let N=e.dp||r.k.Up();const U=e.size||r.k.One(),v=e.angle||0;if(!N){const w=new r.k(0,0,1),e=p.iw().activeCamera,I=r.k.TransformCoordinates(w,e.getWorldMatrix());N=e.globalPosition.Je(I)}const R=-Math.atan2(N.z,N.x)-Math.PI/2,V=Math.sqrt(N.x*N.x+N.z*N.z),b=Math.atan2(N.y,V),h=new f.b;h.indices=[],h.nw=[],h.lw=[],h.Uw=[],h.matricesIndices=J?[]:null,h.matricesWeights=J?[]:null,h.matricesIndicesExtra=t?[]:null,h.matricesWeightsExtra=n?[]:null;let P=0;const u=(w,p)=>{const I=new o;if(!c||!s||!O)return I;const d=c[w];if(I.vertexIdx=3*d,I.vertexIdxForBones=4*d,I.position=new r.k(s[3*d],s[3*d+1],s[3*d+2]),r.k.TransformCoordinatesToRef(I.position,p,I.position),I.dp=new r.k(O[3*d],O[3*d+1],O[3*d+2]),r.k.TransformNormalToRef(I.dp,p,I.dp),e.captureUVS&&z){const w=z[2*d+1];I.uv=new r.g(z[2*d],q.b?1-w:w)}return I},Y=[0,0,0,0],L=(w,p)=>{if(0===w.length)return w;const e=.5*Math.abs(r.k.Dot(U,p)),I=(w,p,e,r)=>{for(let I=0;I<r;++I)if(w[e+I]===p)return e+I;return-1},d=(w,d)=>{const f=r.k.GetClipFactor(w.position,d.position,p,e);let q=Y,E=Y;if(M&&i){const p=w.matrixIndicesOverride?0:w.vertexIdxForBones,e=w.matrixIndicesOverride??M,r=w.matrixWeightsOverride??i,j=d.matrixIndicesOverride?0:d.vertexIdxForBones,X=d.matrixIndicesOverride??M,k=d.matrixWeightsOverride??i;q=[0,0,0,0],E=[0,0,0,0];let m=0;for(let w=0;w<4;++w)if(r[p+w]>0){const d=I(X,e[p+w],j,4);q[m]=e[p+w],E[m]=(0,H.Lerp)(r[p+w],d>=0?k[d]:0,f),m++}for(let w=0;w<4&&m<4;++w){const r=X[j+w];-1===I(e,r,p,4)&&(q[m]=r,E[m]=(0,H.Lerp)(0,k[j+w],f),m++)}const J=E[0]+E[1]+E[2]+E[3];E[0]/=J,E[1]/=J,E[2]/=J,E[3]/=J}const j=w.localPositionOverride?w.localPositionOverride[0]:(null===a||void 0===a?void 0:a[w.vertexIdx])??0,X=w.localPositionOverride?w.localPositionOverride[1]:(null===a||void 0===a?void 0:a[w.vertexIdx+1])??0,k=w.localPositionOverride?w.localPositionOverride[2]:(null===a||void 0===a?void 0:a[w.vertexIdx+2])??0,m=d.localPositionOverride?d.localPositionOverride[0]:(null===a||void 0===a?void 0:a[d.vertexIdx])??0,J=d.localPositionOverride?d.localPositionOverride[1]:(null===a||void 0===a?void 0:a[d.vertexIdx+1])??0,K=d.localPositionOverride?d.localPositionOverride[2]:(null===a||void 0===a?void 0:a[d.vertexIdx+2])??0,y=w.localNormalOverride?w.localNormalOverride[0]:(null===A||void 0===A?void 0:A[w.vertexIdx])??0,c=w.localNormalOverride?w.localNormalOverride[1]:(null===A||void 0===A?void 0:A[w.vertexIdx+1])??0,s=w.localNormalOverride?w.localNormalOverride[2]:(null===A||void 0===A?void 0:A[w.vertexIdx+2])??0,O=y+((d.localNormalOverride?d.localNormalOverride[0]:(null===A||void 0===A?void 0:A[d.vertexIdx])??0)-y)*f,z=c+((d.localNormalOverride?d.localNormalOverride[1]:(null===A||void 0===A?void 0:A[d.vertexIdx+1])??0)-c)*f,t=s+((d.localNormalOverride?d.localNormalOverride[2]:(null===A||void 0===A?void 0:A[d.vertexIdx+2])??0)-s)*f,n=Math.sqrt(O*O+z*z+t*t);return new o(r.k.Lerp(w.position,d.position,f),r.k.Lerp(w.dp,d.dp,f).normalize(),r.g.Lerp(w.uv,d.uv,f),-1,-1,a?[j+(m-j)*f,X+(J-X)*f,k+(K-k)*f]:null,A?[O/n,z/n,t/n]:null,q,E)};let f=null;w.length>3&&(f=[]);for(let q=0;q<w.length;q+=3){let I=0,E=null,j=null,X=null,k=null;const m=r.k.Dot(w[q].position,p)-e>0,J=r.k.Dot(w[q+1].position,p)-e>0,K=r.k.Dot(w[q+2].position,p)-e>0;switch(I=(m?1:0)+(J?1:0)+(K?1:0),I){case 0:w.length>3?(f.push(w[q]),f.push(w[q+1]),f.push(w[q+2])):f=w;break;case 1:if(f=f??new Array,m&&(E=w[q+1],j=w[q+2],X=d(w[q],E),k=d(w[q],j)),J){E=w[q],j=w[q+2],X=d(w[q+1],E),k=d(w[q+1],j),f.push(X),f.push(j.clone()),f.push(E.clone()),f.push(j.clone()),f.push(X.clone()),f.push(k);break}K&&(E=w[q],j=w[q+1],X=d(w[q+2],E),k=d(w[q+2],j)),E&&j&&X&&k&&(f.push(E.clone()),f.push(j.clone()),f.push(X),f.push(k),f.push(X.clone()),f.push(j.clone()));break;case 2:f=f??new Array,m||(E=w[q].clone(),j=d(E,w[q+1]),X=d(E,w[q+2]),f.push(E),f.push(j),f.push(X)),J||(E=w[q+1].clone(),j=d(E,w[q+2]),X=d(E,w[q]),f.push(E),f.push(j),f.push(X)),K||(E=w[q+2].clone(),j=d(E,w[q]),X=d(E,w[q+1]),f.push(E),f.push(j),f.push(X))}}return f},W=p instanceof I.c?p:null,F=null===W||void 0===W?void 0:W._thinInstanceDataStorage.matrixData,C=(null===W||void 0===W?void 0:W.xe)||1,Q=r.d.Matrix[0];Q.X(r.b.IdentityReadOnly);for(let I=0;I<C;++I){if(null!==W&&void 0!==W&&W.hasThinInstances&&F){const w=16*I;Q.setRowFromFloats(0,F[w+0],F[w+1],F[w+2],F[w+3]),Q.setRowFromFloats(1,F[w+4],F[w+5],F[w+6],F[w+7]),Q.setRowFromFloats(2,F[w+8],F[w+9],F[w+10],F[w+11]),Q.setRowFromFloats(3,F[w+12],F[w+13],F[w+14],F[w+15])}const w=r.b.RotationYawPitchRoll(R,b,v).multiply(r.b.Translation(l.x,l.y,l.z)),d=r.b.Invert(w),f=p.getWorldMatrix(),E=Q.multiply(f).multiply(d),j=new Array(3);for(let p=0;p<c.length;p+=3){let w=j;if(w[0]=u(p,E),w[1]=u(p+1,E),w[2]=u(p+2,E),!(e.cullBackFaces&&-w[0].dp.z<=0&&-w[1].dp.z<=0&&-w[2].dp.z<=0)&&(w=L(w,B),w&&(w=L(w,D),w&&(w=L(w,T),w&&(w=L(w,Z),w&&(w=L(w,G),w&&(w=L(w,g),w)))))))for(let p=0;p<w.length;p++){const r=w[p];if(h.indices.push(P),y?(r.localPositionOverride?(h.nw[3*P]=r.localPositionOverride[0],h.nw[3*P+1]=r.localPositionOverride[1],h.nw[3*P+2]=r.localPositionOverride[2]):a&&(h.nw[3*P]=a[r.vertexIdx],h.nw[3*P+1]=a[r.vertexIdx+1],h.nw[3*P+2]=a[r.vertexIdx+2]),r.localNormalOverride?(h.lw[3*P]=r.localNormalOverride[0],h.lw[3*P+1]=r.localNormalOverride[1],h.lw[3*P+2]=r.localNormalOverride[2]):A&&(h.lw[3*P]=A[r.vertexIdx],h.lw[3*P+1]=A[r.vertexIdx+1],h.lw[3*P+2]=A[r.vertexIdx+2])):(r.position.toArray(h.nw,3*P),r.dp.toArray(h.lw,3*P)),h.matricesIndices&&h.matricesWeights&&(r.matrixIndicesOverride?(h.matricesIndices[4*P]=r.matrixIndicesOverride[0],h.matricesIndices[4*P+1]=r.matrixIndicesOverride[1],h.matricesIndices[4*P+2]=r.matrixIndicesOverride[2],h.matricesIndices[4*P+3]=r.matrixIndicesOverride[3]):(M&&(h.matricesIndices[4*P]=M[r.vertexIdxForBones],h.matricesIndices[4*P+1]=M[r.vertexIdxForBones+1],h.matricesIndices[4*P+2]=M[r.vertexIdxForBones+2],h.matricesIndices[4*P+3]=M[r.vertexIdxForBones+3]),t&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*P]=t[r.vertexIdxForBones],h.matricesIndicesExtra[4*P+1]=t[r.vertexIdxForBones+1],h.matricesIndicesExtra[4*P+2]=t[r.vertexIdxForBones+2],h.matricesIndicesExtra[4*P+3]=t[r.vertexIdxForBones+3])),r.matrixWeightsOverride?(h.matricesWeights[4*P]=r.matrixWeightsOverride[0],h.matricesWeights[4*P+1]=r.matrixWeightsOverride[1],h.matricesWeights[4*P+2]=r.matrixWeightsOverride[2],h.matricesWeights[4*P+3]=r.matrixWeightsOverride[3]):(i&&(h.matricesWeights[4*P]=i[r.vertexIdxForBones],h.matricesWeights[4*P+1]=i[r.vertexIdxForBones+1],h.matricesWeights[4*P+2]=i[r.vertexIdxForBones+2],h.matricesWeights[4*P+3]=i[r.vertexIdxForBones+3]),n&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*P]=n[r.vertexIdxForBones],h.matricesWeightsExtra[4*P+1]=n[r.vertexIdxForBones+1],h.matricesWeightsExtra[4*P+2]=n[r.vertexIdxForBones+2],h.matricesWeightsExtra[4*P+3]=n[r.vertexIdxForBones+3]))),e.captureUVS)r.uv.toArray(h.Uw,2*P);else{h.Uw.push(.5+r.position.x/U.x);const w=.5+r.position.y/U.y;h.Uw.push(q.b?1-w:w)}P++}}}0===h.indices.length&&(h.indices=null),0===h.nw.length&&(h.nw=null),0===h.lw.length&&(h.lw=null),0===h.Uw.length&&(h.Uw=null),0===(null===(j=h.matricesIndices)||void 0===j?void 0:j.length)&&(h.matricesIndices=null),0===(null===(X=h.matricesWeights)||void 0===X?void 0:X.length)&&(h.matricesWeights=null),0===(null===(k=h.matricesIndicesExtra)||void 0===k?void 0:k.length)&&(h.matricesIndicesExtra=null),0===(null===(m=h.matricesWeightsExtra)||void 0===m?void 0:m.length)&&(h.matricesWeightsExtra=null);const x=new I.c(w,p.iw());return h.Vw(x),y?(x.skeleton=p.skeleton,x.parent=p):(x.position=l.clone(),x.rotation=new r.k(b,R,v)),x.ke(!0),x.refreshBoundingInfo(!0,!0),x}function Q(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const p=0|Math.max(w.subdivisions?w.subdivisions:2,1),e=0|Math.max(w.tessellation?w.tessellation:16,3),I=Math.max(w.height?w.height:1,0),d=Math.max(w.radius?w.radius:.25,0),E=0|Math.max(w.capSubdivisions?w.capSubdivisions:6,1),j=e,X=p,k=Math.max(w.radiusTop?w.radiusTop:d,0),m=Math.max(w.radiusBottom?w.radiusBottom:d,0),J=I-(k+m),K=2*Math.PI,y=Math.max(w.topCapSubdivisions?w.topCapSubdivisions:E,1),c=Math.max(w.bottomCapSubdivisions?w.bottomCapSubdivisions:E,1),s=Math.acos((m-k)/I);let O=[];const a=[],A=[],z=[];let M=0;const i=[],t=.5*J,n=.5*Math.PI;let l,N;const U=r.k.Zero(),v=r.k.Zero(),R=Math.cos(s),V=Math.sin(s),b=new r.g(k*V,t+k*R).Je(new r.g(m*V,m*R-t)).length(),h=k*s+b+m*(n-s);let P=0;for(N=0;N<=y;N++){const w=[],p=n-s*(N/y);P+=k*s/y;const e=Math.cos(p),r=Math.sin(p),I=e*k;for(l=0;l<=j;l++){const p=l/j,d=p*K+0,f=Math.sin(d),E=Math.cos(d);v.x=I*f,v.y=t+r*k,v.z=I*E,a.push(v.x,v.y,v.z),U.set(e*f,r,e*E),A.push(U.x,U.y,U.z),z.push(p,q.b?P/h:1-P/h),w.push(M),M++}i.push(w)}const u=I-k-m+R*k-R*m,Y=V*(m-k)/u;for(N=1;N<=X;N++){const w=[];P+=b/X;const p=V*(N*(m-k)/X+k);for(l=0;l<=j;l++){const e=l/j,r=e*K+0,I=Math.sin(r),d=Math.cos(r);v.x=p*I,v.y=t+R*k-N*u/X,v.z=p*d,a.push(v.x,v.y,v.z),U.set(I,Y,d).normalize(),A.push(U.x,U.y,U.z),z.push(e,q.b?P/h:1-P/h),w.push(M),M++}i.push(w)}for(N=1;N<=c;N++){const w=[],p=n-s-(Math.PI-s)*(N/c);P+=m*s/c;const e=Math.cos(p),r=Math.sin(p),I=e*m;for(l=0;l<=j;l++){const p=l/j,d=p*K+0,f=Math.sin(d),E=Math.cos(d);v.x=I*f,v.y=r*m-t,v.z=I*E,a.push(v.x,v.y,v.z),U.set(e*f,r,e*E),A.push(U.x,U.y,U.z),z.push(p,q.b?P/h:1-P/h),w.push(M),M++}i.push(w)}for(l=0;l<j;l++)for(N=0;N<y+X+c;N++){const w=i[N][l],p=i[N+1][l],e=i[N+1][l+1],r=i[N][l+1];O.push(w),O.push(p),O.push(r),O.push(p),O.push(e),O.push(r)}if(O=O.reverse(),w.orientation&&!w.orientation.equals(r.k.Up())){const p=new r.b;w.orientation.clone().scale(.5*Math.PI).cross(r.k.Up()).toQuaternion().toRotationMatrix(p);const e=r.k.Zero();for(let w=0;w<a.length;w+=3)e.set(a[w],a[w+1],a[w+2]),r.k.TransformCoordinatesToRef(e.clone(),p,e),a[w]=e.x,a[w+1]=e.y,a[w+2]=e.z}const L=new f.b;return L.nw=a,L.lw=A,L.Uw=z,L.indices=O,L}function x(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:r.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new I.c(w,e);return Q(p).Vw(d,p.updatable),d}I.c.CreateDecal=(w,p,e,r,I,d)=>C(w,p,{position:e,dp:r,size:I,angle:d});I.c.CreateCapsule=(w,p,e)=>x(w,p,e),f.b.CreateCapsule=Q;var S=e(11081),ww=e(11027);class pw{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=w,this.y=p,w!==Math.floor(w)&&(w=Math.floor(w),S.c.Warn("x is not an integer, floor(x) used")),p!==Math.floor(p)&&(p=Math.floor(p),S.c.Warn("y is not an integer, floor(y) used"))}clone(){return new pw(this.x,this.y)}rotate60About(w){const p=this.x;return this.x=w.x+w.y-this.y,this.y=p+this.y-w.x,this}rotateNeg60About(w){const p=this.x;return this.x=p+this.y-w.y,this.y=w.x+w.y-p,this}rotate120(w,p){w!==Math.floor(w)&&(w=Math.floor(w),S.c.Warn("m not an integer only floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),S.c.Warn("n not an integer only floor(n) used"));const e=this.x;return this.x=w-e-this.y,this.y=p+e,this}rotateNeg120(w,p){w!==Math.floor(w)&&(w=Math.floor(w),S.c.Warn("m is not an integer, floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),S.c.Warn("n is not an integer,   floor(n) used"));const e=this.x;return this.x=this.y-p,this.y=w+p-e-this.y,this}toCartesianOrigin(w,p){const e=r.k.Zero();return e.x=w.x+2*this.x*p+this.y*p,e.y=w.y+Math.sqrt(3)*this.y*p,e}static Zero(){return new pw(0,0)}}class ew{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new rw("icosahedron","Regular",[[0,ww.g,-1],[-ww.g,1,0],[-1,0,-ww.g],[1,0,-ww.g],[ww.g,1,0],[0,ww.g,1],[-1,0,ww.g],[-ww.g,-1,0],[0,-ww.g,-1],[ww.g,-1,0],[1,0,ww.g],[0,-ww.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let w=12;const p={},e=this.m,r=this.n;let I,d,f,q,E,j=e,X=1,k=0;0!==r&&(j=(0,H.HighestCommonFactor)(e,r)),X=e/j,k=r/j;const m=pw.Zero(),J=new pw(e,r),K=new pw(-r,e+r),y=pw.Zero(),c=pw.Zero(),s=pw.Zero();let O,a,A,z,M=[];const i=[],t=this.vertByDist,n=(e,r,I,d)=>{O=e+"|"+I,a=r+"|"+d,O in p||a in p?O in p&&!(a in p)?p[a]=p[O]:a in p&&!(O in p)&&(p[O]=p[a]):(p[O]=w,p[a]=w,w++),t[I][0]>2?i[p[O]]=[-t[I][0],t[I][1],p[O]]:i[p[O]]=[M[t[I][0]],t[I][1],p[O]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let l=0;l<20;l++){if(M=this.IDATA.face[l],f=M[2],q=M[1],E=M[0],A=m.x+"|"+m.y,O=l+"|"+A,O in p||(p[O]=f,i[f]=[M[t[A][0]],t[A][1]]),A=J.x+"|"+J.y,O=l+"|"+A,O in p||(p[O]=q,i[q]=[M[t[A][0]],t[A][1]]),A=K.x+"|"+K.y,O=l+"|"+A,O in p||(p[O]=E,i[E]=[M[t[A][0]],t[A][1]]),I=this.IDATA.edgematch[l][0],d=this.IDATA.edgematch[l][1],"B"===d)for(let w=1;w<j;w++)c.x=e-w*(X+k),c.y=r+w*X,s.x=-w*k,s.y=w*(X+k),A=c.x+"|"+c.y,z=s.x+"|"+s.y,n(l,I,A,z);if("O"===d)for(let w=1;w<j;w++)s.x=-w*k,s.y=w*(X+k),y.x=w*X,y.y=w*k,A=s.x+"|"+s.y,z=y.x+"|"+y.y,n(l,I,A,z);if(I=this.IDATA.edgematch[l][2],d=this.IDATA.edgematch[l][3],d&&"A"===d)for(let w=1;w<j;w++)y.x=w*X,y.y=w*k,c.x=e-(j-w)*(X+k),c.y=r+(j-w)*X,A=y.x+"|"+y.y,z=c.x+"|"+c.y,n(l,I,A,z);for(let e=0;e<this.vertices.length;e++)A=this.vertices[e].x+"|"+this.vertices[e].y,O=l+"|"+A,O in p||(p[O]=w++,t[A][0]>2?i[p[O]]=[-t[A][0],t[A][1],p[O]]:i[p[O]]=[M[t[A][0]],t[A][1],p[O]])}this.closestTo=i,this.vecToidx=p}calcCoeffs(){const w=this.m,p=this.n,e=Math.sqrt(3)/3,r=w*w+p*p+w*p;this.coau=(w+p)/r,this.cobu=-p/r,this.coav=-e*(w-p)/r,this.cobv=e*(2*w+p)/r}createInnerFacets(){const w=this.m,p=this.n;for(let e=0;e<p+w+1;e++)for(let w=this.min[e];w<this.max[e]+1;w++)w<this.max[e]&&w<this.max[e+1]+1&&this.innerFacets.push(["|"+w+"|"+e,"|"+w+"|"+(e+1),"|"+(w+1)+"|"+e]),e>0&&w<this.max[e-1]&&w+1<this.max[e]+1&&this.innerFacets.push(["|"+w+"|"+e,"|"+(w+1)+"|"+e,"|"+(w+1)+"|"+(e-1)])}edgeVecsABOB(){const w=this.m,p=this.n,e=new pw(-p,w+p);for(let r=1;r<w+p;r++){const w=new pw(this.min[r],r),p=new pw(this.min[r-1],r-1),I=new pw(this.min[r+1],r+1),d=w.clone(),f=p.clone(),q=I.clone();d.rotate60About(e),f.rotate60About(e),q.rotate60About(e);const E=new pw(this.max[d.y],d.y),j=new pw(this.max[d.y-1],d.y-1),X=new pw(this.max[d.y-1]-1,d.y-1);d.x===E.x&&d.y===E.y||(d.x!==j.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,j,X]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,X,E])):d.y===q.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,p,j]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([w,j,I])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,p,j]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,j,E])))}}mapABOBtoOBOA(){const w=new pw(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const e=[];for(let r=0;r<3;r++)w.x=this.isoVecsABOB[p][r].x,w.y=this.isoVecsABOB[p][r].y,0===this.vertexTypes[p][r]&&w.rotateNeg120(this.m,this.n),e.push(w.clone());this.isoVecsOBOA.push(e)}}mapABOBtoBAOA(){const w=new pw(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const e=[];for(let r=0;r<3;r++)w.x=this.isoVecsABOB[p][r].x,w.y=this.isoVecsABOB[p][r].y,1===this.vertexTypes[p][r]&&w.rotate120(this.m,this.n),e.push(w.clone());this.isoVecsBAOA.push(e)}}MapToFace(w,p){const e=this.IDATA.face[w],I=e[2],d=e[1],f=e[0],q=r.k.Ve(this.IDATA.vertex[I]),E=r.k.Ve(this.IDATA.vertex[d]),j=r.k.Ve(this.IDATA.vertex[f]),X=E.Je(q),k=j.Je(q),m=X.scale(this.coau).add(k.scale(this.cobu)),J=X.scale(this.coav).add(k.scale(this.cobv)),K=[];let y,c=r.d.ne[0];for(let r=0;r<this.cartesian.length;r++)c=m.scale(this.cartesian[r].x).add(J.scale(this.cartesian[r].y)).add(q),K[r]=[c.x,c.y,c.z],y=w+"|"+this.vertices[r].x+"|"+this.vertices[r].y,p.vertex[this.vecToidx[y]]=[c.x,c.y,c.z]}build(w,p){const e=[],r=pw.Zero(),I=new pw(w,p),d=new pw(-p,w+p);e.push(r,I,d);for(let A=p;A<w+1;A++)for(let p=0;p<w+1-A;p++)e.push(new pw(p,A));if(p>0){const r=(0,H.HighestCommonFactor)(w,p),I=w/r,d=p/r;for(let q=1;q<r;q++)e.push(new pw(q*I,q*d)),e.push(new pw(-q*d,q*(I+d))),e.push(new pw(w-q*(I+d),p+q*I));const f=w/p;for(let q=1;q<p;q++)for(let r=0;r<q*f;r++)e.push(new pw(r,q)),e.push(new pw(r,q).rotate120(w,p)),e.push(new pw(r,q).rotateNeg120(w,p))}e.sort(((w,p)=>w.x-p.x)),e.sort(((w,p)=>w.y-p.y));const f=new Array(w+p+1),q=new Array(w+p+1);for(let A=0;A<f.length;A++)f[A]=1/0,q[A]=-1/0;let E=0,j=0;const X=e.length;for(let A=0;A<X;A++)j=e[A].x,E=e[A].y,f[E]=Math.min(j,f[E]),q[E]=Math.max(j,q[E]);const k=(e,r)=>{const I=e.clone();return"A"===r&&I.rotateNeg120(w,p),"B"===r&&I.rotate120(w,p),I.x<0?I.y:I.x+I.y},m=[],J=[],K=[],y=[],c={},s=[];let O=-1,a=-1;for(let A=0;A<X;A++)m[A]=e[A].toCartesianOrigin(new pw(0,0),.5),J[A]=k(e[A],"O"),K[A]=k(e[A],"A"),y[A]=k(e[A],"B"),J[A]===K[A]&&K[A]===y[A]?(O=3,a=J[A]):J[A]===K[A]?(O=4,a=J[A]):K[A]===y[A]?(O=5,a=K[A]):y[A]===J[A]&&(O=6,a=J[A]),J[A]<K[A]&&J[A]<y[A]&&(O=2,a=J[A]),K[A]<J[A]&&K[A]<y[A]&&(O=1,a=K[A]),y[A]<K[A]&&y[A]<J[A]&&(O=0,a=y[A]),s.push([O,a,e[A].x,e[A].y]);s.sort(((w,p)=>w[2]-p[2])),s.sort(((w,p)=>w[3]-p[3])),s.sort(((w,p)=>w[1]-p[1])),s.sort(((w,p)=>w[0]-p[0]));for(let A=0;A<s.length;A++)c[s[A][2]+"|"+s[A][3]]=[s[A][0],s[A][1],A];return this.m=w,this.n=p,this.vertices=e,this.vertByDist=c,this.cartesian=m,this.min=f,this.max=q,this}}class rw{constructor(w,p,e,r){this.name=w,this.category=p,this.vertex=e,this.face=r}}class Iw extends rw{innerToData(w,p){for(let e=0;e<p.innerFacets.length;e++)this.face.push(p.innerFacets[e].map((e=>p.vecToidx[w+e])))}mapABOBtoDATA(w,p){const e=p.IDATA.edgematch[w][0];for(let r=0;r<p.isoVecsABOB.length;r++){const I=[];for(let d=0;d<3;d++)0===p.vertexTypes[r][d]?I.push(w+"|"+p.isoVecsABOB[r][d].x+"|"+p.isoVecsABOB[r][d].y):I.push(e+"|"+p.isoVecsABOB[r][d].x+"|"+p.isoVecsABOB[r][d].y);this.face.push([p.vecToidx[I[0]],p.vecToidx[I[1]],p.vecToidx[I[2]]])}}mapOBOAtoDATA(w,p){const e=p.IDATA.edgematch[w][0];for(let r=0;r<p.isoVecsOBOA.length;r++){const I=[];for(let d=0;d<3;d++)1===p.vertexTypes[r][d]?I.push(w+"|"+p.isoVecsOBOA[r][d].x+"|"+p.isoVecsOBOA[r][d].y):I.push(e+"|"+p.isoVecsOBOA[r][d].x+"|"+p.isoVecsOBOA[r][d].y);this.face.push([p.vecToidx[I[0]],p.vecToidx[I[1]],p.vecToidx[I[2]]])}}mapBAOAtoDATA(w,p){const e=p.IDATA.edgematch[w][2];for(let r=0;r<p.isoVecsBAOA.length;r++){const I=[];for(let d=0;d<3;d++)1===p.vertexTypes[r][d]?I.push(w+"|"+p.isoVecsBAOA[r][d].x+"|"+p.isoVecsBAOA[r][d].y):I.push(e+"|"+p.isoVecsBAOA[r][d].x+"|"+p.isoVecsBAOA[r][d].y);this.face.push([p.vecToidx[I[0]],p.vecToidx[I[1]],p.vecToidx[I[2]]])}}orderData(w){const p=[];for(let d=0;d<13;d++)p[d]=[];const e=w.closestTo;for(let d=0;d<e.length;d++)e[d][0]>-1?e[d][1]>0&&p[e[d][0]].push([d,e[d][1]]):p[12].push([d,e[d][0]]);const r=[];for(let d=0;d<12;d++)r[d]=d;let I=12;for(let d=0;d<12;d++){p[d].sort(((w,p)=>w[1]-p[1]));for(let w=0;w<p[d].length;w++)r[p[d][w][0]]=I++}for(let d=0;d<p[12].length;d++)r[p[12][d][0]]=I++;for(let d=0;d<this.vertex.length;d++)this.vertex[d].push(r[d]);this.vertex.sort(((w,p)=>w[3]-p[3]));for(let d=0;d<this.vertex.length;d++)this.vertex[d].pop();for(let d=0;d<this.face.length;d++)for(let w=0;w<this.face[d].length;w++)this.face[d][w]=r[this.face[d][w]];this.sharedNodes=p[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(w,p){const e=[],r=[];let I=p.pop();r.push(I);let d=this.face[I].indexOf(w);d=(d+2)%3;let f=this.face[I][d];e.push(f);let q=0;for(;p.length>0;)I=p[q],this.face[I].indexOf(f)>-1?(d=(this.face[I].indexOf(f)+1)%3,f=this.face[I][d],e.push(f),r.push(I),p.splice(q,1),q=0):q++;return this.adjacentFaces.push(e),r}toGoldbergPolyhedronData(){const w=new rw("GeoDual","Goldberg",[],[]);w.name="GD dual";const p=this.vertex.length,e=new Array(p);for(let E=0;E<p;E++)e[E]=[];for(let E=0;E<this.face.length;E++)for(let w=0;w<3;w++)e[this.face[E][w]].push(E);let r=0,I=0,d=0,f=[],q=[];this.adjacentFaces=[];for(let E=0;E<e.length;E++){w.face[E]=this.setOrder(E,e[E].concat([]));for(const p of e[E]){r=0,I=0,d=0,f=this.face[p];for(let w=0;w<3;w++)q=this.vertex[f[w]],r+=q[0],I+=q[1],d+=q[2];w.vertex[p]=[r/3,I/3,d/3]}}return w}static BuildGeodesicData(w){const p=new Iw("Geodesic-m-n","Geodesic",[[0,ww.g,-1],[-ww.g,1,0],[-1,0,-ww.g],[1,0,-ww.g],[ww.g,1,0],[0,ww.g,1],[-1,0,ww.g],[-ww.g,-1,0],[0,-ww.g,-1],[ww.g,-1,0],[1,0,ww.g],[0,-ww.g,1]],[]);w.setIndices(),w.calcCoeffs(),w.createInnerFacets(),w.edgeVecsABOB(),w.mapABOBtoOBOA(),w.mapABOBtoBAOA();for(let e=0;e<w.IDATA.face.length;e++)w.MapToFace(e,p),p.innerToData(e,w),"B"===w.IDATA.edgematch[e][1]&&p.mapABOBtoDATA(e,w),"O"===w.IDATA.edgematch[e][1]&&p.mapOBOAtoDATA(e,w),"A"===w.IDATA.edgematch[e][3]&&p.mapBAOAtoDATA(e,w);p.orderData(w);return p.vertex=p.vertex.map((function(w){const p=w[0],e=w[1],r=w[2],I=Math.sqrt(p*p+e*e+r*r);return w[0]*=1/I,w[1]*=1/I,w[2]*=1/I,w})),p}}I.c._GoldbergMeshParser=(w,p)=>dw.Parse(w,p);class dw extends I.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(w,p){return void 0===p?(w>this.goldbergData.nbUnsharedFaces-1&&(S.c.Warn("Maximum number of unshared faces used"),w=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+w):(w>11&&(S.c.Warn("Last pole used"),w=11),p>this.goldbergData.nbFacesAtPole-1&&(S.c.Warn("Maximum number of faces at a pole used"),p=this.goldbergData.nbFacesAtPole-1),12+w*this.goldbergData.nbFacesAtPole+p)}_changeGoldbergFaceColors(w){for(let e=0;e<w.length;e++){const p=w[e][0],r=w[e][1],I=w[e][2];for(let w=p;w<r+1;w++)this.goldbergData.faceColors[w]=I}const p=[];for(let e=0;e<12;e++)for(let w=0;w<5;w++)p.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let w=0;w<6;w++)p.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return p}setGoldbergFaceColors(w){const p=this._changeGoldbergFaceColors(w);this.uw(d.e.ColorKind,p)}updateGoldbergFaceColors(w){const p=this._changeGoldbergFaceColors(w);this.updateVerticesData(d.e.ColorKind,p)}_changeGoldbergFaceUVs(w){const p=this.getVerticesData(d.e.UVKind);for(let e=0;e<w.length;e++){const r=w[e][0],I=w[e][1],d=w[e][2],f=w[e][3],q=w[e][4],E=[],j=[];let X,k;for(let w=0;w<5;w++)X=d.x+f*Math.cos(q+w*Math.PI/2.5),k=d.y+f*Math.sin(q+w*Math.PI/2.5),X<0&&(X=0),X>1&&(X=1),E.push(X,k);for(let w=0;w<6;w++)X=d.x+f*Math.cos(q+w*Math.PI/3),k=d.y+f*Math.sin(q+w*Math.PI/3),X<0&&(X=0),X>1&&(X=1),j.push(X,k);for(let w=r;w<Math.min(12,I+1);w++)for(let e=0;e<5;e++)p[10*w+2*e]=E[2*e],p[10*w+2*e+1]=E[2*e+1];for(let w=Math.max(12,r);w<I+1;w++)for(let e=0;e<6;e++)p[12*w-24+2*e]=j[2*e],p[12*w-23+2*e]=j[2*e+1]}return p}setGoldbergFaceUVs(w){const p=this._changeGoldbergFaceUVs(w);this.uw(d.e.UVKind,p)}updateGoldbergFaceUVs(w){const p=this._changeGoldbergFaceUVs(w);this.updateVerticesData(d.e.UVKind,p)}placeOnGoldbergFaceAt(w,p,e){const I=r.k.RotationFromAxis(this.goldbergData.faceXaxis[p],this.goldbergData.faceYaxis[p],this.goldbergData.faceZaxis[p]);w.rotation=I,w.position=this.goldbergData.faceCenters[p].add(this.goldbergData.faceXaxis[p].scale(e.x)).add(this.goldbergData.faceYaxis[p].scale(e.y)).add(this.goldbergData.faceZaxis[p].scale(e.z))}serialize(w){super.serialize(w),w.type="GoldbergMesh";const p={};if(p.adjacentFaces=this.goldbergData.adjacentFaces,p.nbSharedFaces=this.goldbergData.nbSharedFaces,p.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,p.nbFaces=this.goldbergData.nbFaces,p.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){p.faceColors=[];for(const w of this.goldbergData.faceColors)p.faceColors.push(w.ze())}if(this.goldbergData.faceCenters){p.faceCenters=[];for(const w of this.goldbergData.faceCenters)p.faceCenters.push(w.ze())}if(this.goldbergData.faceZaxis){p.faceZaxis=[];for(const w of this.goldbergData.faceZaxis)p.faceZaxis.push(w.ze())}if(this.goldbergData.faceYaxis){p.faceYaxis=[];for(const w of this.goldbergData.faceYaxis)p.faceYaxis.push(w.ze())}if(this.goldbergData.faceXaxis){p.faceXaxis=[];for(const w of this.goldbergData.faceXaxis)p.faceXaxis.push(w.ze())}w.goldbergData=p}static Parse(w,p){const e=w.goldbergData;e.faceColors=e.faceColors.map((w=>m.e.Ve(w))),e.faceCenters=e.faceCenters.map((w=>r.k.Ve(w))),e.faceZaxis=e.faceZaxis.map((w=>r.k.Ve(w))),e.faceXaxis=e.faceXaxis.map((w=>r.k.Ve(w))),e.faceYaxis=e.faceYaxis.map((w=>r.k.Ve(w)));const I=new dw(w.name,p);return I.goldbergData=e,I}}var fw=e(11744);const qw={CreateBox:k.e,CreateTiledBox:c,CreateSphere:s.b,CreateDisc:X.c,CreateIcoSphere:F,CreateRibbon:j,CreateCylinder:z,CreateTorus:i,CreateTorusKnot:n,CreateLineSystem:l.e,Bj:l.i,CreateDashedLines:l.c,ExtrudeShape:v,ExtrudeShapeCustom:R,CreateLathe:b,CreateTiledPlane:K,Tj:h.d,CreateGround:P.e,CreateTiledGround:P.g,CreateGroundFromHeightMap:P.c,CreatePolygon:N.d,ExtrudePolygon:N.g,CreateTube:u,CreatePolyhedron:L,CreateGeodesic:function(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=p.m||1;r!==Math.floor(r)&&(r=Math.floor(r),S.c.Warn("m not an integer only floor(m) used"));let I=p.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),S.c.Warn("n not an integer only floor(n) used")),I>r){const w=I;I=r,r=w,S.c.Warn("n > m therefore m and n swapped")}const d=new ew;return d.build(r,I),L(w,{custom:Iw.BuildGeodesicData(d),size:p.size,sizeX:p.sizeX,sizeY:p.sizeY,sizeZ:p.sizeZ,faceUV:p.faceUV,faceColors:p.faceColors,flat:p.flat,updatable:p.updatable,sideOrientation:p.sideOrientation,frontUVs:p.frontUVs,backUVs:p.backUVs},e)},CreateGoldberg:function(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=p.size,E=p.sizeX||d||1,j=p.sizeY||d||1,X=p.sizeZ||d||1;let k=p.m||1;k!==Math.floor(k)&&(k=Math.floor(k),S.c.Warn("m not an integer only floor(m) used"));let J=p.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),S.c.Warn("n not an integer only floor(n) used")),J>k){const w=J;J=k,k=w,S.c.Warn("n > m therefore m and n swapped")}const K=new ew;K.build(k,J);const y=Iw.BuildGeodesicData(K),c=y.toGoldbergPolyhedronData(),s=new dw(w,e);p.sideOrientation=I.c._GetDefaultSideOrientation(p.sideOrientation),s._originalBuilderSideOrientation=p.sideOrientation;(function(w,p){const e=w.size,I=w.sizeX||e||1,d=w.sizeY||e||1,E=w.sizeZ||e||1,j=0===w.sideOrientation?0:w.sideOrientation||f.b.DEFAULTSIDE,X=[],k=[],m=[],J=[];let K=1/0,y=-1/0,c=1/0,s=-1/0;for(let r=0;r<p.vertex.length;r++)K=Math.min(K,p.vertex[r][0]*I),y=Math.max(y,p.vertex[r][0]*I),c=Math.min(c,p.vertex[r][1]*d),s=Math.max(s,p.vertex[r][1]*d);let O=0;for(let f=0;f<p.face.length;f++){const w=p.face[f],e=r.k.Ve(p.vertex[w[0]]),j=r.k.Ve(p.vertex[w[2]]),a=r.k.Ve(p.vertex[w[1]]),A=j.Je(e),z=a.Je(e),M=r.k.Cross(z,A).normalize();for(let r=0;r<w.length;r++){m.push(M.x,M.y,M.z);const e=p.vertex[w[r]];X.push(e[0]*I,e[1]*d,e[2]*E);const f=(e[1]*d-c)/(s-c);J.push((e[0]*I-K)/(y-K),q.b?1-f:f)}for(let p=0;p<w.length-2;p++)k.push(O,O+p+2,O+p+1);O+=w.length}f.b._ComputeSides(j,X,k,m,J);const a=new f.b;return a.nw=X,a.indices=k,a.lw=m,a.Uw=J,a})(p,c).Vw(s,p.updatable),s.goldbergData.nbSharedFaces=y.sharedNodes,s.goldbergData.nbUnsharedFaces=y.poleNodes,s.goldbergData.adjacentFaces=y.adjacentFaces,s.goldbergData.nbFaces=s.goldbergData.nbSharedFaces+s.goldbergData.nbUnsharedFaces,s.goldbergData.nbFacesAtPole=(s.goldbergData.nbUnsharedFaces-12)/12;for(let I=0;I<y.vertex.length;I++)s.goldbergData.faceCenters.push(r.k.Ve(y.vertex[I])),s.goldbergData.faceCenters[I].x*=E,s.goldbergData.faceCenters[I].y*=j,s.goldbergData.faceCenters[I].z*=X,s.goldbergData.faceColors.push(new m.e(1,1,1,1));for(let I=0;I<c.face.length;I++){const w=c.face[I],p=r.k.Ve(c.vertex[w[0]]),e=r.k.Ve(c.vertex[w[2]]),d=r.k.Ve(c.vertex[w[1]]),f=e.Je(p),q=d.Je(p),E=r.k.Cross(q,f).normalize(),j=r.k.Cross(q,E).normalize();s.goldbergData.faceXaxis.push(q.normalize()),s.goldbergData.faceYaxis.push(E),s.goldbergData.faceZaxis.push(j)}return s},CreateDecal:C,CreateCapsule:x,CreateText:fw.g}},12436:(w,p,e)=>{"use strict";e.d(p,{c:()=>qp});var r=e(11023),I=e(11648);class d extends I.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var f=e(11308),q=(e(11448),e(11038));class E{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this._targetStopDuration!==w&&(this._targetStopDuration=w)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){this._noiseTexture!==w&&(this._noiseTexture=w,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(w){this._isAnimationSheetEnabled!=w&&(this._isAnimationSheetEnabled=w,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){this._useLogarithmicDepth=w&&this.iw().getEngine().getCaps().fragmentDepthSupported}iw(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(w){switch(w){case E.BLENDMODE_MULTIPLYADD:return;case E.BLENDMODE_ADD:w=1;break;case E.BLENDMODE_ONEONE:w=6;break;case E.BLENDMODE_STANDARD:w=2;break;case E.BLENDMODE_MULTIPLY:w=4;break;case E.BLENDMODE_SUBTRACT:w=3}this._engine.setAlphaMode(w)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:r.k.Zero()}set direction1(w){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=w)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:r.k.Zero()}set direction2(w){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=w)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:r.k.Zero()}set minEmitBox(w){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=w)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:r.k.Zero()}set maxEmitBox(w){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=w)}get billboardMode(){return this._billboardMode}set billboardMode(w){this._billboardMode!==w&&(this._billboardMode=w,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(w){this._isBillboardBased!==w&&(this._isBillboardBased=w,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(w){this._attachImageProcessingConfiguration(w)}_attachImageProcessingConfiguration(w){w!==this._imageProcessingConfiguration&&(!w&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=w)}_reset(){}_removeGradientAndTexture(w,p,e){if(!p)return this;let r=0;for(const I of p){if(I.gradient===w){p.splice(r,1);break}r++}return e&&e.dispose(),this}constructor(w){this.animations=[],this.renderingGroupId=0,this.i=r.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new r.k(10,10,10),this.onAnimationEnd=null,this.blendMode=E.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new r.g(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Lj=new r.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=r.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new f.e(1,1,1,1),this.color2=new f.e(1,1,1,1),this.colorDead=new f.e(0,0,0,1),this.textureMask=new f.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new d,this.id=w,this.name=w}createPointEmitter(w,p){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new r.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new r.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new r.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new r.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new r.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new r.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(w,p,e,r){throw new Error("Method not implemented.")}}E.BLENDMODE_ONEONE=0,E.BLENDMODE_STANDARD=1,E.BLENDMODE_ADD=2,E.BLENDMODE_MULTIPLY=3,E.BLENDMODE_MULTIPLYADD=4,E.BLENDMODE_SUBTRACT=-1,(0,q.d)("BABYLON.BaseParticleSystem",E);var j=e(11063),X=e(11086);class k{constructor(){this.direction1=new r.k(0,1,0),this.direction2=new r.k(0,1,0),this.minEmitBox=new r.k(-.5,-.5,-.5),this.maxEmitBox=new r.k(.5,.5,.5)}startDirectionFunction(w,p,e,I){const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),f=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);if(I)return p.x=d,p.y=f,void(p.z=q);r.k.TransformNormalFromFloatsToRef(d,f,q,w,p)}startPositionFunction(w,p,e,I){const d=(0,j.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),f=(0,j.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),q=(0,j.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(I)return p.x=d,p.y=f,void(p.z=q);r.k.TransformCoordinatesFromFloatsToRef(d,f,q,w,p)}clone(){const w=new k;return X.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2),w.setVector3("minEmitBox",this.minEmitBox),w.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3),w.addUniform("minEmitBox",3),w.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.ze(),w.direction2=this.direction2.ze(),w.minEmitBox=this.minEmitBox.ze(),w.maxEmitBox=this.maxEmitBox.ze(),w}parse(w){r.k.FromArrayToRef(w.direction1,0,this.direction1),r.k.FromArrayToRef(w.direction2,0,this.direction2),r.k.FromArrayToRef(w.minEmitBox,0,this.minEmitBox),r.k.FromArrayToRef(w.maxEmitBox,0,this.maxEmitBox)}}class m{get radius(){return this._radius}set radius(w){this._radius=w,this._buildHeight()}get angle(){return this._angle}set angle(w){this._angle=w,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=e,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=p,this.radius=w}startDirectionFunction(w,p,e,I){I?r.d.ne[0].X(e.NE).normalize():e.position.subtractToRef(w.getTranslation(),r.d.ne[0]).normalize();const d=(0,j.RandomRange)(0,this.directionRandomizer),f=(0,j.RandomRange)(0,this.directionRandomizer),q=(0,j.RandomRange)(0,this.directionRandomizer);p.x=r.d.ne[0].x+d,p.y=r.d.ne[0].y+f,p.z=r.d.ne[0].z+q,p.normalize()}startPositionFunction(w,p,e,I){const d=(0,j.RandomRange)(0,2*Math.PI);let f;this.emitFromSpawnPointOnly?f=1e-4:(f=(0,j.RandomRange)(0,this.heightRange),f=1-f*f);let q=this._radius-(0,j.RandomRange)(0,this._radius*this.radiusRange);q*=f;const E=q*Math.sin(d),X=q*Math.cos(d),k=f*this._height;if(I)return p.x=E,p.y=k,void(p.z=X);r.k.TransformCoordinatesFromFloatsToRef(E,k,X,w,p)}clone(){const w=new m(this._radius,this._angle,this.directionRandomizer);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat2("radius",this._radius,this.radiusRange),w.setFloat("coneAngle",this._angle),w.setFloat2("height",this._height,this.heightRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",2),w.addUniform("coneAngle",1),w.addUniform("height",2),w.addUniform("directionRandomizer",1)}getEffectDefines(){let w="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(w+="\n#define CONEEMITTERSPAWNPOINT"),w}getClassName(){return"ConeParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this._radius,w.angle=this._angle,w.directionRandomizer=this.directionRandomizer,w.radiusRange=this.radiusRange,w.heightRange=this.heightRange,w.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,w}parse(w){this.radius=w.radius,this.angle=w.angle,this.directionRandomizer=w.directionRandomizer,this.radiusRange=void 0!==w.radiusRange?w.radiusRange:1,this.heightRange=void 0!==w.radiusRange?w.heightRange:1,this.emitFromSpawnPointOnly=void 0!==w.emitFromSpawnPointOnly&&w.emitFromSpawnPointOnly}}class J extends m{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0);super(w,p),this.direction1=e,this.direction2=I}startDirectionFunction(w,p){const e=(0,j.RandomRange)(this.direction1.x,this.direction2.x),I=(0,j.RandomRange)(this.direction1.y,this.direction2.y),d=(0,j.RandomRange)(this.direction1.z,this.direction2.z);r.k.TransformNormalFromFloatsToRef(e,I,d,w,p)}clone(){const w=new J(this.radius,this.angle,this.direction1,this.direction2);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.ze(),w.direction2=this.direction2.ze(),w}parse(w){super.parse(w),this.direction1.X(w.direction1),this.direction2.X(w.direction2)}}class K{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=w,this.height=p,this.radiusRange=e,this.directionRandomizer=I,this._tempVector=r.k.Zero()}startDirectionFunction(w,p,e,I,d){e.position.subtractToRef(w.getTranslation(),this._tempVector),this._tempVector.normalize(),r.k.TransformNormalToRef(this._tempVector,d,this._tempVector);const f=(0,j.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=f,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),I?p.X(this._tempVector):r.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w,p)}startPositionFunction(w,p,e,I){const d=(0,j.RandomRange)(-this.height/2,this.height/2),f=(0,j.RandomRange)(0,2*Math.PI),q=(0,j.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),E=Math.sqrt(q)*this.radius,X=E*Math.cos(f),k=E*Math.sin(f);I?p.te(X,d,k):r.k.TransformCoordinatesFromFloatsToRef(X,d,k,w,p)}clone(){const w=new K(this.radius,this.directionRandomizer);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.height=this.height,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.height=w.height,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class y extends K{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r.k(0,1,0);super(w,p,e),this.direction1=I,this.direction2=d}startDirectionFunction(w,p,e,I){const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),f=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);I?p.te(d,f,q):r.k.TransformNormalFromFloatsToRef(d,f,q,w,p)}clone(){const w=new y(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.ze(),w.direction2=this.direction2.ze(),w}parse(w){super.parse(w),r.k.FromArrayToRef(w.direction1,0,this.direction1),r.k.FromArrayToRef(w.direction2,0,this.direction2)}}class c{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=p,this.directionRandomizer=e}startDirectionFunction(w,p,e,I){const d=e.position.Je(w.getTranslation()).normalize(),f=(0,j.RandomRange)(0,this.directionRandomizer),q=(0,j.RandomRange)(0,this.directionRandomizer),E=(0,j.RandomRange)(0,this.directionRandomizer);d.x+=f,d.y+=q,d.z+=E,d.normalize(),I?p.X(d):r.k.TransformNormalFromFloatsToRef(d.x,d.y,d.z,w,p)}startPositionFunction(w,p,e,I){const d=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),f=(0,j.RandomRange)(0,1),q=(0,j.RandomRange)(0,2*Math.PI),E=Math.acos(2*f-1),X=d*Math.cos(q)*Math.sin(E),k=d*Math.cos(E),m=d*Math.sin(q)*Math.sin(E);I?p.te(X,Math.abs(k),m):r.k.TransformCoordinatesFromFloatsToRef(X,Math.abs(k),m,w,p)}clone(){const w=new c(this.radius,this.directionRandomizer);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class s{constructor(){this.direction1=new r.k(0,1,0),this.direction2=new r.k(0,1,0)}startDirectionFunction(w,p,e,I){const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),f=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);I?p.te(d,f,q):r.k.TransformNormalFromFloatsToRef(d,f,q,w,p)}startPositionFunction(w,p,e,I){I?p.te(0,0,0):r.k.TransformCoordinatesFromFloatsToRef(0,0,0,w,p)}clone(){const w=new s;return X.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.ze(),w.direction2=this.direction2.ze(),w}parse(w){r.k.FromArrayToRef(w.direction1,0,this.direction1),r.k.FromArrayToRef(w.direction2,0,this.direction2)}}class O{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=p,this.directionRandomizer=e}startDirectionFunction(w,p,e,I){const d=e.position.Je(w.getTranslation()).normalize(),f=(0,j.RandomRange)(0,this.directionRandomizer),q=(0,j.RandomRange)(0,this.directionRandomizer),E=(0,j.RandomRange)(0,this.directionRandomizer);d.x+=f,d.y+=q,d.z+=E,d.normalize(),I?p.X(d):r.k.TransformNormalFromFloatsToRef(d.x,d.y,d.z,w,p)}startPositionFunction(w,p,e,I){const d=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),f=(0,j.RandomRange)(0,1),q=(0,j.RandomRange)(0,2*Math.PI),E=Math.acos(2*f-1),X=d*Math.cos(q)*Math.sin(E),k=d*Math.cos(E),m=d*Math.sin(q)*Math.sin(E);I?p.te(X,k,m):r.k.TransformCoordinatesFromFloatsToRef(X,k,m,w,p)}clone(){const w=new O(this.radius,this.directionRandomizer);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class a extends O{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.k(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0);super(w),this.direction1=p,this.direction2=e}startDirectionFunction(w,p){const e=(0,j.RandomRange)(this.direction1.x,this.direction2.x),I=(0,j.RandomRange)(this.direction1.y,this.direction2.y),d=(0,j.RandomRange)(this.direction1.z,this.direction2.z);r.k.TransformNormalFromFloatsToRef(e,I,d,w,p)}clone(){const w=new a(this.radius,this.direction1,this.direction2);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.ze(),w.direction2=this.direction2.ze(),w}parse(w){super.parse(w),this.direction1.X(w.direction1),this.direction2.X(w.direction2)}}class A{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(w,p,e,I){const d=r.d.ne[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,e,d);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,e,d);const w=r.d.ne[1];d.subtractToRef(e.position,w),w.scaleToRef(1/e.lifeTime,d)}else d.set(0,0,0);I?p.X(d):r.k.TransformNormalToRef(d,w,p)}startPositionFunction(w,p,e,I){const d=r.d.ne[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,e,d):d.set(0,0,0),I?p.X(d):r.k.TransformCoordinatesToRef(d,w,p)}clone(){const w=new A;return X.d.DeepCopy(this,w),w}applyToShader(w){}buildUniformLayout(w){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.particlePositionGenerator=this.particlePositionGenerator,w.particleDestinationGenerator=this.particleDestinationGenerator,w}parse(w){w.particlePositionGenerator&&(this.particlePositionGenerator=w.particlePositionGenerator),w.particleDestinationGenerator&&(this.particleDestinationGenerator=w.particleDestinationGenerator)}}var z=e(11232);class M{get mesh(){return this._mesh}set mesh(w){this._mesh!==w&&(this._mesh=w,w?(this._indices=w.Ke(),this._positions=w.getVerticesData(z.e.PositionKind),this._normals=w.getVerticesData(z.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=r.k.Zero(),this._mesh=null,this.direction1=new r.k(0,1,0),this.direction2=new r.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=w}startDirectionFunction(w,p,e,I){if(this.useMeshNormalsForDirection&&this._normals)return void r.k.TransformNormalToRef(this._storedNormal,w,p);const d=(0,j.RandomRange)(this.direction1.x,this.direction2.x),f=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);I?p.te(d,f,q):r.k.TransformNormalFromFloatsToRef(d,f,q,w,p)}startPositionFunction(w,p,e,I){if(!this._indices||!this._positions)return;const d=3*(Math.random()*(this._indices.length/3)|0),f=Math.random(),q=Math.random()*(1-f),E=1-f-q,j=this._indices[d],X=this._indices[d+1],k=this._indices[d+2],m=r.d.ne[0],J=r.d.ne[1],K=r.d.ne[2],y=r.d.ne[3];r.k.FromArrayToRef(this._positions,3*j,m),r.k.FromArrayToRef(this._positions,3*X,J),r.k.FromArrayToRef(this._positions,3*k,K),y.x=f*m.x+q*J.x+E*K.x,y.y=f*m.y+q*J.y+E*K.y,y.z=f*m.z+q*J.z+E*K.z,I?p.te(y.x,y.y,y.z):r.k.TransformCoordinatesFromFloatsToRef(y.x,y.y,y.z,w,p),this.useMeshNormalsForDirection&&this._normals&&(r.k.FromArrayToRef(this._normals,3*j,m),r.k.FromArrayToRef(this._normals,3*X,J),r.k.FromArrayToRef(this._normals,3*k,K),this._storedNormal.x=f*m.x+q*J.x+E*K.x,this._storedNormal.y=f*m.y+q*J.y+E*K.y,this._storedNormal.z=f*m.z+q*J.z+E*K.z)}clone(){const w=new M(this.mesh);return X.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var w;const p={};return p.type=this.getClassName(),p.direction1=this.direction1.ze(),p.direction2=this.direction2.ze(),p.meshId=null===(w=this.mesh)||void 0===w?void 0:w.id,p.useMeshNormalsForDirection=this.useMeshNormalsForDirection,p}parse(w,p){r.k.FromArrayToRef(w.direction1,0,this.direction1),r.k.FromArrayToRef(w.direction2,0,this.direction2),w.meshId&&p&&(this.mesh=p.getLastMeshById(w.meshId)),this.useMeshNormalsForDirection=w.useMeshNormalsForDirection}}class i{_isUbo(w){return void 0!==w.addUniform}constructor(w){this._isUbo(w)?(this.setMatrix3x3=w.updateMatrix3x3.bind(w),this.setMatrix2x2=w.updateMatrix2x2.bind(w),this.setFloat=w.updateFloat.bind(w),this.setFloat2=w.updateFloat2.bind(w),this.setFloat3=w.updateFloat3.bind(w),this.setFloat4=w.updateFloat4.bind(w),this.setFloatArray=w.updateFloatArray.bind(w),this.setArray=w.updateArray.bind(w),this.setIntArray=w.updateIntArray.bind(w),this.setMatrix=w.Ze.bind(w),this.setMatrices=w.updateMatrices.bind(w),this.setVector3=w.updateVector3.bind(w),this.setVector4=w.updateVector4.bind(w),this.setColor3=w.updateColor3.bind(w),this.setColor4=w.updateColor4.bind(w),this.setDirectColor4=w.updateDirectColor4.bind(w),this.setInt=w.updateInt.bind(w),this.setInt2=w.updateInt2.bind(w),this.setInt3=w.updateInt3.bind(w),this.setInt4=w.updateInt4.bind(w)):(this.setMatrix3x3=w.setMatrix3x3.bind(w),this.setMatrix2x2=w.setMatrix2x2.bind(w),this.setFloat=w.setFloat.bind(w),this.setFloat2=w.setFloat2.bind(w),this.setFloat3=w.setFloat3.bind(w),this.setFloat4=w.setFloat4.bind(w),this.setFloatArray=w.setFloatArray.bind(w),this.setArray=w.setArray.bind(w),this.setIntArray=w.setIntArray.bind(w),this.setMatrix=w.setMatrix.bind(w),this.setMatrices=w.setMatrices.bind(w),this.setVector3=w.setVector3.bind(w),this.setVector4=w.setVector4.bind(w),this.setColor3=w.setColor3.bind(w),this.setColor4=w.setColor4.bind(w),this.setDirectColor4=w.setDirectColor4.bind(w),this.setInt=w.setInt.bind(w),this.setInt2=w.setInt2.bind(w),this.setInt3=w.setInt3.bind(w),this.setInt4=w.setInt4.bind(w))}}var t=e(11146);const n="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";t.e.ShadersStore[n]||(t.e.ShadersStore[n]=l);const N="gpuUpdateParticlesVertexShader",U="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";t.e.ShadersStore[N]||(t.e.ShadersStore[N]=U);(0,q.d)("BABYLON.WebGL2ParticleSystem",class{constructor(w,p){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=w,this._engine=p,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var w;return(null===(w=this._updateEffect)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof A&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=w,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new i(this._updateEffect)}createVertexBuffers(w,p){this._updateVAO.push(this._createUpdateVAO(w)),this._renderVAO.push(this._engine.recordVertexArrayObject(p,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=p}createParticleBuffer(w){return w}bindDrawBuffers(w,p,e){e?this._engine.bindBuffers(this._renderVertexBuffers,e,p):this._engine.bindVertexArrayObject(this._renderVAO[w],null)}preUpdateParticleBuffer(){const w=this._engine;if(this._engine.enableEffect(this._updateEffect),!w.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(w,p,e){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[w],null);const r=this._engine;r.bindTransformFeedbackBuffer(p.getBuffer()),r.setRasterizerState(!1),r.beginTransformFeedback(!0),r.drawArraysType(3,0,e),r.endTransformFeedback(),r.setRasterizerState(!0),r.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let w=0;w<this._updateVAO.length;w++)this._engine.releaseVertexArrayObject(this._updateVAO[w]);this._updateVAO.length=0;for(let w=0;w<this._renderVAO.length;w++)this._engine.releaseVertexArrayObject(this._renderVAO[w]);this._renderVAO.length=0}_createUpdateVAO(w){const p={};p.position=w.createVertexBuffer("position",0,3);let e=3;p.age=w.createVertexBuffer("age",e,1),e+=1,p.size=w.createVertexBuffer("size",e,3),e+=3,p.life=w.createVertexBuffer("life",e,1),e+=1,p.seed=w.createVertexBuffer("seed",e,4),e+=4,p.direction=w.createVertexBuffer("direction",e,3),e+=3,this._parent.particleEmitterType instanceof A&&(p.initialPosition=w.createVertexBuffer("initialPosition",e,3),e+=3),this._parent._colorGradientsTexture||(p.color=w.createVertexBuffer("color",e,4),e+=4),this._parent._isBillboardBased||(p.initialDirection=w.createVertexBuffer("initialDirection",e,3),e+=3),this._parent.noiseTexture&&(p.noiseCoordinates1=w.createVertexBuffer("noiseCoordinates1",e,3),e+=3,p.noiseCoordinates2=w.createVertexBuffer("noiseCoordinates2",e,3),e+=3),this._parent._angularSpeedGradientsTexture?(p.angle=w.createVertexBuffer("angle",e,1),e+=1):(p.angle=w.createVertexBuffer("angle",e,2),e+=2),this._parent._isAnimationSheetEnabled&&(p.cellIndex=w.createVertexBuffer("cellIndex",e,1),e+=1,this._parent.spriteRandomStartCell&&(p.cellStartOffset=w.createVertexBuffer("cellStartOffset",e,1),e+=1));const r=this._engine.recordVertexArrayObject(p,null,this._updateEffect);return this._engine.bindArrayBuffer(null),r}});class v{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3?arguments[3]:void 0;this._engine=w,this._label=r,this._engine._storageBuffers.push(this),this._create(p,e)}_create(w,p){this._bufferSize=w,this._creationFlags=p,this._buffer=this._engine.createStorageBuffer(w,p,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(w,p,e){this._buffer&&this._engine.updateStorageBuffer(this._buffer,w,p,e)}async read(w,p,e,r){return await this._engine.readFromStorageBuffer(this._buffer,w,p,e,r)}dispose(){const w=this._engine._storageBuffers,p=w.indexOf(this);-1!==p&&(w[p]=w[w.length-1],w.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=e(11207),V=e(11213),b=e(11301),h=e(11511),P=e(11640),u=e(11081),Y=e(11164),L=e(11496);class W{constructor(){this._gpuTimeInFrameId=-1,this.counter=new L.d}_addDuration(w,p){w<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==w?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(p,!1),this._gpuTimeInFrameId=w):this.counter.addCount(p,!1))}}var F=e(11127);class H{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=w,this._engine=p,this.uniqueId=P.c.UniqueId,p.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new W),this._engine.getCaps().supportComputeShaders?r.bindingsMapping?(this._context=p.createComputeContext(),this._shaderPath=e,this._options={bindingsMapping:{},defines:[],...r}):u.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):u.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this._bindings[w];this._bindings[w]={type:e?0:4,object:p,indexInGroupEntries:null===r||void 0===r?void 0:r.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!r||r.object!==p||r.type!==this._bindings[w].type)}setStorageTexture(w,p){const e=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==p),this._bindings[w]={type:1,object:p,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setExternalTexture(w,p){const e=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==p),this._bindings[w]={type:6,object:p,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setVideoTexture(w,p){return!!p.externalTexture&&(this.setExternalTexture(w,p.externalTexture),!0)}setUniformBuffer(w,p){const e=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==p),this._bindings[w]={type:H._BufferIsDataBuffer(p)?7:2,object:p,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setStorageBuffer(w,p){const e=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==p),this._bindings[w]={type:H._BufferIsDataBuffer(p)?7:3,object:p,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setTextureSampler(w,p){const e=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!e||!p.compareSampler(e.object)),this._bindings[w]={type:5,object:p,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}isReady(){let w=this._effect;for(const I in this._bindings){const w=this._bindings[I],p=w.type,e=w.object;switch(p){case 0:case 4:case 1:if(!e.isReady())return!1;break;case 6:if(!e.isReady())return!1;break}}const p=[],e=this._shaderPath;if(this._options.defines)for(let I=0;I<this._options.defines.length;I++)p.push(this._options.defines[I]);const r=p.join("\n");return this._cachedDefines!==r&&(this._cachedDefines=r,w=this._engine.createComputeEffect(e,{defines:r,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=w),!!w.isReady()}dispatch(w,p,e){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,w,p,e,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const e=H._BufferIsDataBuffer(w)?w:w.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,e,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const p in this._bindings){const e=this._bindings[p];if(!this._options.bindingsMapping[p])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+p+"'");switch(e.type){case 0:{const r=this._samplers[p],I=e.object;var w;if(!r||!I._texture||!r.compareSampler(I._texture))this._samplers[p]=(new Y.e).setParameters(I.wrapU,I.wrapV,I.wrapR,I.anisotropicFilteringLevel,I._texture.samplingMode,null===(w=I._texture)||void 0===w?void 0:w._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const w=e.object;w.getBuffer()!==e.buffer&&(e.buffer=w.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((I=>{(0,F.g)((()=>this.dispatch(w,p,e)),I,void 0,r)}))}serialize(){const w=b.e.Serialize(this);w.options=this._options,w.shaderPath=this._shaderPath,w.Vm={},w.textures={};for(const p in this._bindings){const e=this._bindings[p],r=e.object;switch(e.type){case 0:case 4:case 1:{const I=r.serialize();I&&(w.textures[p]=I,w.Vm[p]={type:e.type});break}}}return w}static Parse(w,p,e){const r=b.e.Parse((()=>new H(w.name,p.getEngine(),w.shaderPath,w.options)),w,p,e);for(const I in w.textures){const d=w.Vm[I],f=h.e.Parse(w.textures[I],p,e);0===d.type?r.setTexture(I,f):4===d.type?r.setTexture(I,f,!1):r.setStorageTexture(I,f)}return r}static _BufferIsDataBuffer(w){return void 0!==w.underlyingResource}}(0,R.c)([(0,V.J)()],H.prototype,"name",void 0),(0,R.c)([(0,V.J)()],H.prototype,"fastMode",void 0),(0,q.d)("BABYLON.ComputeShader",H);var B=e(11288);const D="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";t.e.ShadersStoreWGSL[D]||(t.e.ShadersStoreWGSL[D]=T);(0,q.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(w,p){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=w,this._engine=p}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var w;return(null===(w=this._updateComputeShader)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){var p;const e={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(e.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(e.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(e.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(e.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(e.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(e.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(e.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new H("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:e,defines:w.split("\n")}),null===(p=this._simParamsComputeShader)||void 0===p||p.dispose(),this._simParamsComputeShader=new B.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new i(this._simParamsComputeShader)}createVertexBuffers(w,p){this._renderVertexBuffers.push(p)}createParticleBuffer(w){const p=new v(this._engine,4*w.length,11,"ComputeShaderParticleSystemBuffer");return p.update(w),this._bufferComputeShader.push(p),p.getBuffer()}bindDrawBuffers(w,p,e){this._engine.bindBuffers(this._renderVertexBuffers[w],e,p)}preUpdateParticleBuffer(){}updateParticleBuffer(w,p,e){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[w]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^w]),this._updateComputeShader.dispatch(Math.ceil(e/64))}releaseBuffers(){var w;for(let p=0;p<this._bufferComputeShader.length;++p)this._bufferComputeShader[p].dispose();this._bufferComputeShader.length=0,null===(w=this._simParamsComputeShader)||void 0===w||w.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Z{constructor(w,p,e){this.gradient=w,this.color1=p,this.color2=e}getColorToRef(w){this.color2?f.e.LerpToRef(this.color1,this.color2,Math.random(),w):w.X(this.color1)}}class G{constructor(w,p){this.gradient=w,this.color=p}}class g{constructor(w,p,e){this.gradient=w,this.factor1=p,this.factor2=e}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class o{static GetCurrentGradient(w,p,e){if(p[0].gradient>w)return void e(p[0],p[0],1);for(let I=0;I<p.length-1;I++){const r=p[I],d=p[I+1];if(w>=r.gradient&&w<=d.gradient){return void e(r,d,(w-r.gradient)/(d.gradient-r.gradient))}}const r=p.length-1;e(p[r],p[r],1)}}var C=e(11056),Q=e(11546),x=e(11051);class S{constructor(w){this.particleSystem=w,this.position=r.k.Zero(),this.direction=r.k.Zero(),this.color=new f.e(0,0,0,0),this.colorStep=new f.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new r.g(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new f.e(0,0,0,0),this._currentColor2=new f.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let w=this.age,p=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===p?(p=1,w=this._randomCellOffset):w+=this._randomCellOffset);const e=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let r;r=this._initialSpriteCellLoop?(0,j.Clamp)(w*p%this.lifeTime/this.lifeTime):(0,j.Clamp)(w*p/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+r*e|0}_inheritParticleInfoToSubEmitter(w){if(w.particleSystem.i.position){const p=w.particleSystem.i;if(p.position.X(this.position),w.inheritDirection){const w=r.d.ne[0];this.direction.normalizeToRef(w),p.setDirection(w,0,Math.PI/2)}}else{w.particleSystem.i.X(this.position)}this.direction.scaleToRef(w.inheritedVelocityAmount/2,r.d.ne[0]),w.particleSystem._inheritedVelocityOffset.X(r.d.ne[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const w of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(w)}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(w){w.position.X(this.position),this._initialDirection?w._initialDirection?w._initialDirection.X(this._initialDirection):w._initialDirection=this._initialDirection.clone():w._initialDirection=null,w.direction.X(this.direction),this.NE&&(w.NE?w.NE.X(this.NE):w.NE=this.NE.clone()),w.color.X(this.color),w.colorStep.X(this.colorStep),w.lifeTime=this.lifeTime,w.age=this.age,w._randomCellOffset=this._randomCellOffset,w.size=this.size,w.scale.X(this.scale),w.angle=this.angle,w.angularSpeed=this.angularSpeed,w.particleSystem=this.particleSystem,w.cellIndex=this.cellIndex,w.id=this.id,w._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(w._currentColorGradient=this._currentColorGradient,w._currentColor1.X(this._currentColor1),w._currentColor2.X(this._currentColor2)),this._currentSizeGradient&&(w._currentSizeGradient=this._currentSizeGradient,w._currentSize1=this._currentSize1,w._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(w._currentAngularSpeedGradient=this._currentAngularSpeedGradient,w._currentAngularSpeed1=this._currentAngularSpeed1,w._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(w._currentVelocityGradient=this._currentVelocityGradient,w._currentVelocity1=this._currentVelocity1,w._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(w._currentLimitVelocityGradient=this._currentLimitVelocityGradient,w._currentLimitVelocity1=this._currentLimitVelocity1,w._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(w._currentDragGradient=this._currentDragGradient,w._currentDrag1=this._currentDrag1,w._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(w._initialStartSpriteCellId=this._initialStartSpriteCellId,w._initialEndSpriteCellId=this._initialEndSpriteCellId,w._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(w.remapData&&this.remapData?w.remapData.X(this.remapData):w.remapData=new r.o(0,0,0,0)),this._randomNoiseCoordinates1&&(w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.X(this._randomNoiseCoordinates1),w._randomNoiseCoordinates2.X(this._randomNoiseCoordinates2)):(w._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),w._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var ww=e(11286),pw=(e(11446),e(11320)),ew=e(11310),rw=e(11603);function Iw(w,p){const e=(0,j.RandomRange)(0,1);f.e.LerpToRef(p.color1,p.color2,e,w.color),p.colorDead.subtractToRef(w.color,p._colorDiff),p._colorDiff.scaleToRef(1/w.lifeTime,w.colorStep)}function dw(w,p){w._currentColorGradient=p._colorGradients[0],w._currentColorGradient.getColorToRef(w.color),w._currentColor1.X(w.color),p._colorGradients.length>1?p._colorGradients[1].getColorToRef(w._currentColor2):w._currentColor2.X(w.color)}function fw(w,p){const e=p._colorGradients;o.GetCurrentGradient(p._ratio,e,((p,e,r)=>{p!==w._currentColorGradient&&(w._currentColor1.X(w._currentColor2),e.getColorToRef(w._currentColor2),w._currentColorGradient=p),f.e.LerpToRef(w._currentColor1,w._currentColor2,r,w.color)}))}function qw(w,p){w.colorStep.scaleToRef(p._scaledUpdateSpeed,p._scaledColorStep),w.color.addInPlace(p._scaledColorStep),w.color.a<0&&(w.color.a=0)}function Ew(w,p){o.GetCurrentGradient(p._ratio,p._angularSpeedGradients,((p,e,r)=>{p!==w._currentAngularSpeedGradient&&(w._currentAngularSpeed1=w._currentAngularSpeed2,w._currentAngularSpeed2=e.getFactor(),w._currentAngularSpeedGradient=p),w.angularSpeed=(0,j.Lerp)(w._currentAngularSpeed1,w._currentAngularSpeed2,r)}))}function jw(w,p){w.angle+=w.angularSpeed*p._scaledUpdateSpeed}function Xw(w,p){p.particleEmitterType.startDirectionFunction(p._emitterWorldMatrix,w.direction,w,p.isLocal,p._emitterInverseWorldMatrix)}function kw(w,p){p.startDirectionFunction(p._emitterWorldMatrix,w.direction,w,p.isLocal)}function mw(w,p){w._currentVelocityGradient=p._velocityGradients[0],w._currentVelocity1=w._currentVelocityGradient.getFactor(),p._velocityGradients.length>1?w._currentVelocity2=p._velocityGradients[1].getFactor():w._currentVelocity2=w._currentVelocity1}function Jw(w,p){w._currentLimitVelocityGradient=p._limitVelocityGradients[0],w._currentLimitVelocity1=w._currentLimitVelocityGradient.getFactor(),p._limitVelocityGradients.length>1?w._currentLimitVelocity2=p._limitVelocityGradients[1].getFactor():w._currentLimitVelocity2=w._currentLimitVelocity1}function Kw(w,p){o.GetCurrentGradient(p._ratio,p._velocityGradients,((e,r,I)=>{e!==w._currentVelocityGradient&&(w._currentVelocity1=w._currentVelocity2,w._currentVelocity2=r.getFactor(),w._currentVelocityGradient=e),p._directionScale*=(0,j.Lerp)(w._currentVelocity1,w._currentVelocity2,I)}))}function yw(w,p){o.GetCurrentGradient(p._ratio,p._limitVelocityGradients,((e,r,I)=>{e!==w._currentLimitVelocityGradient&&(w._currentLimitVelocity1=w._currentLimitVelocity2,w._currentLimitVelocity2=r.getFactor(),w._currentLimitVelocityGradient=e);const d=(0,j.Lerp)(w._currentLimitVelocity1,w._currentLimitVelocity2,I);w.direction.length()>d&&w.direction.scaleInPlace(p.limitVelocityDamping)}))}function cw(w,p){w.direction.scaleToRef(p._directionScale,p._scaledDirection)}function sw(w,p){p.particleEmitterType.startPositionFunction(p._emitterWorldMatrix,w.position,w,p.isLocal)}function Ow(w,p){p.startPositionFunction(p._emitterWorldMatrix,w.position,w,p.isLocal)}function aw(w,p){w.NE?w.NE.X(w.position):w.NE=w.position.clone(),r.k.TransformCoordinatesToRef(w.NE,p._emitterWorldMatrix,w.position)}function Aw(w,p){p.isLocal&&w.NE?(w.NE.addInPlace(p._scaledDirection),r.k.TransformCoordinatesToRef(w.NE,p._emitterWorldMatrix,w.position)):w.position.addInPlace(p._scaledDirection)}function zw(w,p){w._currentDragGradient=p._dragGradients[0],w._currentDrag1=w._currentDragGradient.getFactor(),p._dragGradients.length>1?w._currentDrag2=p._dragGradients[1].getFactor():w._currentDrag2=w._currentDrag1}function Mw(w,p){o.GetCurrentGradient(p._ratio,p._dragGradients,((e,r,I)=>{e!==w._currentDragGradient&&(w._currentDrag1=w._currentDrag2,w._currentDrag2=r.getFactor(),w._currentDragGradient=e);const d=(0,j.Lerp)(w._currentDrag1,w._currentDrag2,I);p._scaledDirection.scaleInPlace(1-d)}))}function iw(w,p){w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.te(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2.te(Math.random(),Math.random(),Math.random())):(w._randomNoiseCoordinates1=new r.k(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2=new r.k(Math.random(),Math.random(),Math.random()))}function tw(w,p){const e=p._noiseTextureData,I=p._noiseTextureSize;if(e&&I&&w._randomNoiseCoordinates1){const d=p._fetchR(w._randomNoiseCoordinates1.x,w._randomNoiseCoordinates1.y,I.width,I.height,e),f=p._fetchR(w._randomNoiseCoordinates1.z,w._randomNoiseCoordinates2.x,I.width,I.height,e),q=p._fetchR(w._randomNoiseCoordinates2.y,w._randomNoiseCoordinates2.z,I.width,I.height,e),E=r.d.ne[0],j=r.d.ne[1];E.te((2*d-1)*p.noiseStrength.x,(2*f-1)*p.noiseStrength.y,(2*q-1)*p.noiseStrength.z),E.scaleToRef(p._tempScaledUpdateSpeed,j),w.direction.addInPlace(j)}}function nw(w,p){p.gravity.scaleToRef(p._tempScaledUpdateSpeed,p._scaledGravity),w.direction.addInPlace(p._scaledGravity)}function lw(w,p){w.size=(0,j.RandomRange)(p.minSize,p.maxSize),w.scale.te((0,j.RandomRange)(p.minScaleX,p.maxScaleX),(0,j.RandomRange)(p.minScaleY,p.maxScaleY))}function Nw(w,p){w._currentSizeGradient=p._sizeGradients[0],w._currentSize1=w._currentSizeGradient.getFactor(),w.size=w._currentSize1,p._sizeGradients.length>1?w._currentSize2=p._sizeGradients[1].getFactor():w._currentSize2=w._currentSize1,w.scale.te((0,j.RandomRange)(p.minScaleX,p.maxScaleX),(0,j.RandomRange)(p.minScaleY,p.maxScaleY))}function Uw(w,p){const e=p._actualFrame/p.targetStopDuration;o.GetCurrentGradient(e,p._startSizeGradients,((e,r,I)=>{e!==p._currentStartSizeGradient&&(p._currentStartSize1=p._currentStartSize2,p._currentStartSize2=r.getFactor(),p._currentStartSizeGradient=e);const d=(0,j.Lerp)(p._currentStartSize1,p._currentStartSize2,I);w.scale.scaleInPlace(d)}))}function vw(w,p){o.GetCurrentGradient(p._ratio,p._sizeGradients,((p,e,r)=>{p!==w._currentSizeGradient&&(w._currentSize1=w._currentSize2,w._currentSize2=e.getFactor(),w._currentSizeGradient=p),w.size=(0,j.Lerp)(w._currentSize1,w._currentSize2,r)}))}function Rw(w,p){w.remapData=new r.o(0,1,0,1)}function Vw(w,p){p._colorRemapGradients&&p._colorRemapGradients.length>0&&o.GetCurrentGradient(p._ratio,p._colorRemapGradients,((p,e,r)=>{const I=(0,j.Lerp)(p.factor1,e.factor1,r),d=(0,j.Lerp)(p.factor2,e.factor2,r);w.remapData.x=I,w.remapData.y=d-I})),p._alphaRemapGradients&&p._alphaRemapGradients.length>0&&o.GetCurrentGradient(p._ratio,p._alphaRemapGradients,((p,e,r)=>{const I=(0,j.Lerp)(p.factor1,e.factor1,r),d=(0,j.Lerp)(p.factor2,e.factor2,r);w.remapData.z=I,w.remapData.w=d-I}))}function bw(w,p){const e=(0,j.Clamp)(p._actualFrame/p.targetStopDuration);o.GetCurrentGradient(e,p._lifeTimeGradients,((p,r)=>{const I=p,d=r,f=I.getFactor(),q=d.getFactor(),E=(e-I.gradient)/(d.gradient-I.gradient);w.lifeTime=(0,j.Lerp)(f,q,E)})),p._emitPower=(0,j.RandomRange)(p.minEmitPower,p.maxEmitPower)}function hw(w,p){w.lifeTime=(0,j.RandomRange)(p.minLifeTime,p.maxLifeTime),p._emitPower=(0,j.RandomRange)(p.minEmitPower,p.maxEmitPower)}function Pw(w,p){0===p._emitPower?(w._initialDirection?w._initialDirection.X(w.direction):w._initialDirection=w.direction.clone(),w.direction.set(0,0,0)):(w._initialDirection=null,w.direction.scaleInPlace(p._emitPower)),w.direction.addInPlace(p._inheritedVelocityOffset)}function uw(w,p){w.angularSpeed=(0,j.RandomRange)(p.minAngularSpeed,p.maxAngularSpeed),w.angle=(0,j.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function Yw(w,p){w._currentAngularSpeedGradient=p._angularSpeedGradients[0],w.angularSpeed=w._currentAngularSpeedGradient.getFactor(),w._currentAngularSpeed1=w.angularSpeed,p._angularSpeedGradients.length>1?w._currentAngularSpeed2=p._angularSpeedGradients[1].getFactor():w._currentAngularSpeed2=w._currentAngularSpeed1,w.angle=(0,j.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function Lw(w,p){w._initialStartSpriteCellId=p.startSpriteCellID,w._initialEndSpriteCellId=p.endSpriteCellID,w._initialSpriteCellLoop=p.spriteCellLoop}function Ww(w,p){w.previousItem=p.previousItem,w.nextItem=p,p.previousItem&&(p.previousItem.nextItem=w),p.previousItem=w}function Fw(w,p){w.previousItem=p,w.nextItem=p.nextItem,p.nextItem&&(p.nextItem.previousItem=w),p.nextItem=w}function Hw(w,p){let e=p;for(;e.nextItem;)e=e.nextItem;w.previousItem=e,w.nextItem=e.nextItem,e.nextItem=w}function Bw(w){w.previousItem&&(w.previousItem.nextItem=w.nextItem),w.nextItem&&(w.nextItem.previousItem=w.previousItem)}class Dw extends E{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(w){this._startDirectionFunction!==w&&(this._startDirectionFunction=w,this._directionProcessing.process=w?kw:Xw)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(w){this._startPositionFunction!==w&&(this._startPositionFunction=w,this._positionCreation.process=w?Ow:sw)}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}get K(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(w){this._useRampGradients!==w&&(this._useRampGradients=w,this._resetEffect(),w?(this._rampCreation={process:Rw,previousItem:null,nextItem:null},Fw(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Vw,previousItem:null,nextItem:null},Fw(this._remapGradientProcessing,this._gravityProcessing)):(Bw(this._rampCreation),Bw(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(w){this._isLocal!==w&&(this._isLocal=w,w?(this._isLocalCreation={process:aw,previousItem:null,nextItem:null},Fw(this._isLocalCreation,this._positionCreation)):Bw(this._isLocalCreation))}get particles(){return this.lm}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w,w?(this._sheetCreation={process:Lw,previousItem:null,nextItem:null},Fw(this._sheetCreation,this._colorCreation)):Bw(this._sheetCreation),this._reset())}getActiveCount(){return this.lm.length}getClassName(){return"fd"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[p])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new ww.b(this._engine),this._customWrappers[p].effect=w,this._customWrappers[p].drawContext&&(this._customWrappers[p].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){if(this.noiseTexture!==w){if(this._noiseTexture=w,!w)return Bw(this._noiseCreation),void Bw(this._noiseProcessing);this._noiseCreation={process:iw,previousItem:null,nextItem:null},Fw(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:tw,previousItem:null,nextItem:null},Fw(this._noiseProcessing,this._positionProcessing)}}constructor(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(w),this._emitterInverseWorldMatrix=r.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new r.k,this.ue=new C.d,this.onStoppedObservable=new C.d,this.onStartedObservable=new C.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.lm=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new f.e(0,0,0,0),this._colorDiff=new f.e(0,0,0,0),this._scaledDirection=r.k.Zero(),this._scaledGravity=r.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=w=>{},this.recycleParticle=w=>{const p=this.lm.pop();p!==w&&p.copyTo(w),this._stockParticles.push(p)},this._createParticle=()=>{let w;return 0!==this._stockParticles.length?(w=this._stockParticles.pop(),w._reset()):w=new S(this),this._prepareParticle(w),w},this.paused=!1,this._shadersLoaded=!1,this._capacity=p,this._epsilon=q,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=r.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||x.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.tm.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:hw,previousItem:null,nextItem:null},this._positionCreation={process:sw,previousItem:null,nextItem:null},Fw(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Xw,previousItem:null,nextItem:null},Fw(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Pw,previousItem:null,nextItem:null},Fw(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:lw,previousItem:null,nextItem:null},Fw(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:uw,previousItem:null,nextItem:null},Fw(this._angleCreation,this._sizeCreation),this._colorCreation={process:Iw,previousItem:null,nextItem:null},Fw(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,E||(this._colorProcessing={process:qw,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:jw,previousItem:null,nextItem:null},Fw(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:cw,previousItem:null,nextItem:null},Fw(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Aw,previousItem:null,nextItem:null},Fw(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:nw,previousItem:null,nextItem:null},Fw(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=d,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ww.b(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new k,this.updateFunction=w=>{var p;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(p=this.noiseTexture.getContent())||void 0===p||p.then((w=>{this._noiseTextureData=w})));const e=w===this.lm;for(let r=0;r<w.length;r++){const p=w[r];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const I=p.age;if(p.age+=this._tempScaledUpdateSpeed,p.age>p.lifeTime){const w=p.age-I,e=p.lifeTime-I;this._tempScaledUpdateSpeed=e*this._tempScaledUpdateSpeed/w,p.age=p.lifeTime}this._ratio=p.age/p.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let d=this._updateQueueStart;for(;d;)d.process(p,this),d=d.nextItem;if(this._isAnimationSheetEnabled&&!E&&p.updateCellIndex(),p._inheritParticleInfoToSubEmitters(),p.age>=p.lifeTime){if(this._emitFromParticle(p),p._attachedSubEmitters){for(const w of p._attachedSubEmitters)w.particleSystem.disposeOnStop=!0,w.particleSystem.stop();p._attachedSubEmitters=null}this.recycleParticle(p),e&&r--}else;}}}serialize(w){throw new Error("Method not implemented.")}clone(w,p){throw new Error("Method not implemented.")}_addFactorGradient(w,p,e,r){const I=new g(p,e,r);w.push(I),w.sort(((w,p)=>w.gradient<p.gradient?-1:w.gradient>p.gradient?1:0))}_removeFactorGradient(w,p){if(!w)return;let e=0;for(const r of w){if(r.gradient===p){w.splice(e,1);break}e++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=bw:this._lifeTimeCreation.process=hw}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Uw,previousItem:null,nextItem:null},Fw(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Bw(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this.targetStopDuration!==w&&(this._targetStopDuration=w,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(w,p,e){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,w,p,e),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(w){return this._removeFactorGradient(this._lifeTimeGradients,w),this._syncLifeTimeCreation(),this}addSizeGradient(w,p,e){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Nw,this._sizeGradientProcessing={process:vw,previousItem:null,nextItem:null},Ww(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,w,p,e),this}removeSizeGradient(w){var p;return this._removeFactorGradient(this._sizeGradients,w),0===(null===(p=this._sizeGradients)||void 0===p?void 0:p.length)&&(Bw(this._sizeGradientProcessing),this._sizeCreation.process=lw),this}addColorRemapGradient(w,p,e){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,w,p,e),this}removeColorRemapGradient(w){return this._removeFactorGradient(this._colorRemapGradients,w),this}addAlphaRemapGradient(w,p,e){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,w,p,e),this}removeAlphaRemapGradient(w){return this._removeFactorGradient(this._alphaRemapGradients,w),this}addAngularSpeedGradient(w,p,e){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Yw,this._angularSpeedGradientProcessing={process:Ew,previousItem:null,nextItem:null},Ww(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,w,p,e),this}removeAngularSpeedGradient(w){var p;return this._removeFactorGradient(this._angularSpeedGradients,w),0===(null===(p=this._angularSpeedGradients)||void 0===p?void 0:p.length)&&(this._angleCreation.process=uw,Bw(this._angularSpeedGradientProcessing)),this}addVelocityGradient(w,p,e){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:mw,previousItem:null,nextItem:null},Fw(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Kw,previousItem:null,nextItem:null},Ww(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,w,p,e),this}removeVelocityGradient(w){var p;return this._removeFactorGradient(this._velocityGradients,w),0===(null===(p=this._velocityGradients)||void 0===p?void 0:p.length)&&(Bw(this._velocityCreation),Bw(this._velocityGradientProcessing)),this}addLimitVelocityGradient(w,p,e){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Jw,previousItem:null,nextItem:null},Fw(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:yw,previousItem:null,nextItem:null},Fw(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,w,p,e),this}removeLimitVelocityGradient(w){var p;return this._removeFactorGradient(this._limitVelocityGradients,w),0===(null===(p=this._limitVelocityGradients)||void 0===p?void 0:p.length)&&(Bw(this._limitVelocityCreation),Bw(this._limitVelocityGradientProcessing)),this}addDragGradient(w,p,e){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:zw,previousItem:null,nextItem:null},Ww(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Mw,previousItem:null,nextItem:null},Ww(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,w,p,e),this}removeDragGradient(w){var p;return this._removeFactorGradient(this._dragGradients,w),0===(null===(p=this._dragGradients)||void 0===p?void 0:p.length)&&(Bw(this._dragCreation),Bw(this._dragGradientProcessing)),this}addEmitRateGradient(w,p,e){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,w,p,e),this}removeEmitRateGradient(w){return this._removeFactorGradient(this._emitRateGradients,w),this}addStartSizeGradient(w,p,e){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,w,p,e),this._syncStartSizeCreation(),this}removeStartSizeGradient(w){return this._removeFactorGradient(this._startSizeGradients,w),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const w=new Uint8Array(4*this._rawTextureWidth),p=f.h.pd[0];for(let e=0;e<this._rawTextureWidth;e++){const r=e/this._rawTextureWidth;o.GetCurrentGradient(r,this._rampGradients,((r,I,d)=>{f.b.LerpToRef(r.color,I.color,d,p),w[4*e]=255*p.r,w[4*e+1]=255*p.g,w[4*e+2]=255*p.b,w[4*e+3]=255}))}this._rampGradientsTexture=Q.b.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((w,p)=>w.gradient<p.gradient?-1:w.gradient>p.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(w,p){this._rampGradients||(this._rampGradients=[]);const e=new G(w,p);return this._rampGradients.push(e),this._syncRampGradientTexture(),this}removeRampGradient(w){return this._removeGradientAndTexture(w,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(w,p,e){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=dw,this._colorProcessing.process=fw);const r=new Z(w,p,e);return this._colorGradients.push(r),this._colorGradients.sort(((w,p)=>w.gradient<p.gradient?-1:w.gradient>p.gradient?1:0)),this}removeColorGradient(w){if(!this._colorGradients)return this;let p=0;for(const e of this._colorGradients){if(e.gradient===w){this._colorGradients.splice(p,1);break}p++}return 0===this._colorGradients.length&&(this._colorCreation.process=Iw,this._colorProcessing.process=qw),this}resetDrawCache(){if(this._drawWrappers){for(const w of this._drawWrappers)if(w)for(const p of w)null===p||void 0===p||p.dispose();this._drawWrappers=[]}}_fetchR(w,p,e,r,I){return I[4*(((w=.5*Math.abs(w)+.5)*e%e|0)+((p=.5*Math.abs(p)+.5)*r%r|0)*e)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const w=this._engine,p=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*p),this._vertexBuffer=new z.b(w,this._vertexData,!0,p);let e=0;const r=this._vertexBuffer.createVertexBuffer(z.e.PositionKind,e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.e.PositionKind]=r,e+=3;const I=this._vertexBuffer.createVertexBuffer(z.e.ColorKind,e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.e.ColorKind]=I,e+=4;const d=this._vertexBuffer.createVertexBuffer("angle",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=d,e+=1;const f=this._vertexBuffer.createVertexBuffer("size",e,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=f,e+=2,this._isAnimationSheetEnabled){const w=this._vertexBuffer.createVertexBuffer("cellIndex",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=w,e+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const w=this._vertexBuffer.createVertexBuffer("direction",e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=w,e+=3}if(this._useRampGradients){const w=this._vertexBuffer.createVertexBuffer("remapData",e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=w,e+=4}let q;if(this._useInstancing){const p=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new z.b(w,p,!1,2),q=this._spriteBuffer.createVertexBuffer("offset",0,2)}else q=this._vertexBuffer.createVertexBuffer("offset",e,2,this._vertexBufferSize,this._useInstancing),e+=2;this._vertexBuffers.offset=q,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const w=[],p=[];let e=0;for(let r=0;r<this._capacity;r++)w.push(e),w.push(e+1),w.push(e+2),w.push(e),w.push(e+2),w.push(e+3),p.push(e,e+1,e+1,e+2,e+2,e+3,e+3,e,e,e+3),e+=4;this._indexBuffer=this._engine.createIndexBuffer(w),this._linesIndexBuffer=this._engine.createIndexBuffer(p)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(w)setTimeout((()=>{this.start(0)}),w);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var p;-1!==(null===(p=this.i)||void 0===p?void 0:p.getClassName().indexOf("Mesh"))&&this.i.ke(!0);const w=this.noiseTexture;if(w&&w.onGeneratedObservable)w.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let p=0;p<this.preWarmCycles;p++)this.animate(!0),w.render()}))}));else for(let p=0;p<this.preWarmCycles;p++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(w))}_postStop(w){}reset(){this._stockParticles.length=0,this.lm.length=0}_appendParticleVertex(w,p,e,I){let d=w*this._vertexBufferSize;if(this._vertexData[d++]=p.position.x+this.Lj.x,this._vertexData[d++]=p.position.y+this.Lj.y,this._vertexData[d++]=p.position.z+this.Lj.z,this._vertexData[d++]=p.color.r,this._vertexData[d++]=p.color.g,this._vertexData[d++]=p.color.b,this._vertexData[d++]=p.color.a,this._vertexData[d++]=p.angle,this._vertexData[d++]=p.scale.x*p.size,this._vertexData[d++]=p.scale.y*p.size,this._isAnimationSheetEnabled&&(this._vertexData[d++]=p.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[d++]=p.direction.x,this._vertexData[d++]=p.direction.y,this._vertexData[d++]=p.direction.z);else if(p._initialDirection){let w=p._initialDirection;this.isLocal&&(r.k.TransformNormalToRef(w,this._emitterWorldMatrix,r.d.ne[0]),w=r.d.ne[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[d++]=w.x,this._vertexData[d++]=w.y,this._vertexData[d++]=w.z}else{let w=p.direction;this.isLocal&&(r.k.TransformNormalToRef(w,this._emitterWorldMatrix,r.d.ne[0]),w=r.d.ne[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[d++]=w.x,this._vertexData[d++]=w.y,this._vertexData[d++]=w.z}this._useRampGradients&&p.remapData&&(this._vertexData[d++]=p.remapData.x,this._vertexData[d++]=p.remapData.y,this._vertexData[d++]=p.remapData.z,this._vertexData[d++]=p.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===e?e=this._epsilon:1===e&&(e=1-this._epsilon),0===I?I=this._epsilon:1===I&&(I=1-this._epsilon)),this._vertexData[d++]=e,this._vertexData[d++]=I)}_prepareParticle(w){}_createNewOnes(w){let p;for(let e=0;e<w&&this.lm.length!==this._capacity;e++){p=this._createParticle(),this.lm.push(p);let w=this._createQueueStart;for(;w;)w.process(p,this),w=w.nextItem;p._inheritParticleInfoToSubEmitters()}}_update(w){if(this._alive=this.lm.length>0,this.i.position){const w=this.i;this._emitterWorldMatrix=w.getWorldMatrix()}else{const w=this.i;this._emitterWorldMatrix=r.b.Translation(w.x,w.y,w.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.lm),this._createNewOnes(w)}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=[z.e.PositionKind,z.e.ColorKind,"angle","offset","size"];return w&&r.push("cellIndex"),p||r.push("direction"),e&&r.push("remapData"),r}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,pw.b)(r),w&&r.push("particlesInfos"),p&&r.push("logarithmicDepthConstant"),e&&(r.push("vFogInfos"),r.push("vFogColor")),r}fillDefines(w,p){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pw.l)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&w.push("#define FOG")),this._isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),p===E.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&w.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case 2:w.push("#define BILLBOARDY");break;case 8:case 9:w.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&w.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:w.push("#define BILLBOARDMODE_ALL")}e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,p,e){p.push(...Dw._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),w.push(...Dw._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,rw.f)(w,this._imageProcessingConfigurationDefines),(0,rw.d)(e,this._imageProcessingConfigurationDefines))}_getWrapper(w){const p=this._getCustomDrawWrapper(w);if(null!==p&&void 0!==p&&p.effect)return p;const e=[];this.fillDefines(e,w);const r=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let I=this._drawWrappers[r];I||(I=this._drawWrappers[r]=[]);let d=I[w];d||(d=new ww.b(this._engine),d.drawContext&&(d.drawContext.useInstancing=this._useInstancing),I[w]=d);const f=e.join("\n");if(d.defines!==f){const w=[],p=[],e=[];this.fillUniformsAttributesAndSamplerNames(p,w,e),d.setEffect(this._engine.createEffect("particles",w,p,e,f,void 0,void 0,void 0,void 0,this._shaderLanguage),f)}return d}animate(){var w;let p,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!e&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this.manualEmitCount>-1)p=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let w=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const p=this._actualFrame/this.targetStopDuration;o.GetCurrentGradient(p,this._emitRateGradients,((p,e,r)=>{p!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=e.getFactor(),this._currentEmitRateGradient=p),w=(0,j.Lerp)(this._currentEmitRate1,this._currentEmitRate2,r)}))}p=w*this._scaledUpdateSpeed|0,this._newPartsExcess+=w*this._scaledUpdateSpeed-p}if(this._newPartsExcess>1&&(p+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?p=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(p),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){let w=0;for(let p=0;p<this.lm.length;p++){const e=this.lm[p];this._appendParticleVertices(w,e),w+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.lm.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(w,p){this._appendParticleVertex(w++,p,0,0),this._useInstancing||(this._appendParticleVertex(w++,p,1,0),this._appendParticleVertex(w++,p,1,1),this._appendParticleVertex(w++,p,0,1))}rebuild(){var w;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(w=this._spriteBuffer)||void 0===w||w._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Dw.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(e.bind(e,12617)),Promise.resolve().then(e.bind(e,12557))])):await Promise.all([Promise.resolve().then(e.bind(e,12543)),Promise.resolve().then(e.bind(e,12538))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==E.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(E.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(E.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(w){const p=this._getWrapper(w),e=p.effect,I=this._engine;I.enableEffect(p);const d=this.defaultViewMatrix??this._scene.getViewMatrix();if(e.setTexture("diffuseSampler",this.particleTexture),e.setMatrix("view",d),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();e.setFloat3("particlesInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,this.spriteCellWidth/w.width)}if(e.setVector2("translationPivot",this.translationPivot),e.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;e.setVector3("eyePosition",w.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),e.setTexture("rampSampler",this._rampGradientsTexture));const f=e.defines;var q,E,j,X,k,m;(this._scene&&((0,pw.e)(e,this,this._scene),this.applyFog&&(0,ew.e)(this._scene,void 0,e)),f.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(r.d.Matrix[0]),e.setMatrix("invView",r.d.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?I.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,e):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,e)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?I.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBuffer:this._indexBuffer,e):I.bindBuffers(this._vertexBuffers,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null,e);(this.useLogarithmicDepth&&this._scene&&(0,ew.i)(f,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(w),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),this._useInstancing)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?I.drawElementsType(6,0,10,this.lm.length):I.drawArraysType(7,0,4,this.lm.length):null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?I.drawElementsType(1,0,10*this.lm.length):I.drawElementsType(0,0,6*this.lm.length);return this.lm.length}render(){if(!this.isReady()||!this.lm.length)return 0;const w=this._engine;w.setState&&(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0));let p=0;return p=this.blendMode===E.BLENDMODE_MULTIPLYADD?this._render(E.BLENDMODE_MULTIPLY)+this._render(E.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),p}_onDispose(){}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(p,e),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const w=this._scene.tm.indexOf(this);w>-1&&this._scene.tm.splice(w,1),this._scene._activeParticleSystems.dispose()}this.ue.notifyObservers(this),this.ue.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Dw.ForceGLSL=!1;var Tw,Zw=e(11094);!function(w){w[w.ATTACHED=0]="ATTACHED",w[w.END=1]="END"}(Tw||(Tw={}));class Gw{constructor(w){if(this.particleSystem=w,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!w.i||!w.i.dispose){const p=(0,q.c)("BABYLON.AbstractMesh");w.i=new p("SubemitterSystemEmitter",w.iw()),w._disposeEmitterOnDispose=!0}}clone(){let w=this.particleSystem.i;if(w){if(w instanceof r.k)w=w.clone();else if(-1!==w.getClassName().indexOf("Mesh")){w=new((0,q.c)("BABYLON.Mesh"))("",w.iw()),w.isVisible=!1}}else w=new r.k;const p=new Gw(this.particleSystem.clone(this.particleSystem.name,w));return p.particleSystem.name+="Clone",p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem._disposeEmitterOnDispose=!0,p.particleSystem.disposeOnStop=!0,p}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem=this.particleSystem.serialize(w),p}static _ParseParticleSystem(w,p,e){throw(0,Zw.c)("ParseParticle")}static Parse(w,p,e){const r=w.particleSystem,I=new Gw(Gw._ParseParticleSystem(r,p,e,!0));return I.type=w.type,I.inheritDirection=w.inheritDirection,I.inheritedVelocityAmount=w.inheritedVelocityAmount,I.particleSystem._isSubEmitter=!0,I}dispose(){this.particleSystem.dispose()}}var gw=e(11132);function ow(w,p){const e=new s;return e.direction1=w,e.direction2=p,e}function Cw(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Qw(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function xw(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.k(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0);return new a(w,p,e)}function Sw(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function wp(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r.k(0,1,0);return new y(w,p,e,I,d)}function pp(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new m(w,p)}function ep(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0);return new J(w,p,e,I)}const rp=r.k.Zero(),Ip=r.k.Zero(),dp=r.k.Zero();class fp{constructor(){this.strength=0,this.position=r.k.Zero()}_processParticle(w,p){this.position.subtractToRef(w.position,rp);const e=rp.lengthSquared()+1;rp.normalize().scaleToRef(this.strength/e,Ip),Ip.scaleToRef(p._tempScaledUpdateSpeed,dp),w.direction.addInPlace(dp)}serialize(){return{position:this.position.ze(),strength:this.strength}}}class qp extends Dw{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=w=>{if(!this._subEmitters||0===this._subEmitters.length)return;const p=Math.floor(Math.random()*this._subEmitters.length);for(const e of this._subEmitters[p])if(1===e.type){const p=e.clone();w._inheritParticleInfoToSubEmitter(p),p.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(p.particleSystem),p.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(w,p){const e=ow(w,p);return this.particleEmitterType=e,e}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w,this._flowMapUpdate&&(Bw(this._flowMapUpdate),this._flowMapUpdate=null),w&&(this._flowMapUpdate={process:w=>{var p;const e=null===(p=this.iw())||void 0===p?void 0:p.getTransformMatrix();this._flowMap._processParticle(w,this.flowMapStrength*this._tempScaledUpdateSpeed,e)},previousItem:null,nextItem:null},Fw(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(w){this._attractors.push(w),1===this._attractors.length&&(this._attractorUpdate={process:w=>{for(const p of this._attractors)p._processParticle(w,this)},previousItem:null,nextItem:null},Fw(this._attractorUpdate,this._directionProcessing))}removeAttractor(w){const p=this._attractors.indexOf(w);-1!==p&&this._attractors.splice(p,1),0===this._attractors.length&&Bw(this._attractorUpdate)}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(w)}createHemisphericEmitter(){const w=Cw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=Qw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=Sw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r.k(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=ep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,p,e,r){const I=new k;return this.particleEmitterType=I,this.direction1=w,this.direction2=p,this.minEmitBox=e,this.maxEmitBox=r,I}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const w of this.subEmitters)w instanceof qp?this._subEmitters.push([new Gw(w)]):w instanceof Gw?this._subEmitters.push([w]):w instanceof Array&&this._subEmitters.push(w)}_stopSubEmitters(){if(this.activeSubSystems){for(const w of this.activeSubSystems)w.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const w=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==w&&this._rootParticleSystem.activeSubSystems.splice(w,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(w){w&&this._stopSubEmitters()}_prepareParticle(w){if(this._subEmitters&&this._subEmitters.length>0){const p=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];w._attachedSubEmitters=[];for(const e of p)if(0===e.type){const p=e.clone();w._attachedSubEmitters.push(p),p.particleSystem.start()}}}_onDispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),w&&this.particles)for(const e of this.particles)if(e._attachedSubEmitters)for(let w=e._attachedSubEmitters.length-1;w>=0;w-=1)e._attachedSubEmitters[w].dispose();if(p&&this.activeSubSystems)for(let e=this.activeSubSystems.length-1;e>=0;e-=1)this.activeSubSystems[e].dispose();if(this._subEmitters&&this._subEmitters.length){for(let w=0;w<this._subEmitters.length;w++)for(const p of this._subEmitters[w])p.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.i&&this.i.dispose&&this.i.dispose(!0)}static _Parse(w,p,e,I){let d;d=e instanceof gw.d?null:e;const E=(0,q.c)("BABYLON.Texture");if(E&&d&&(w.texture?p.particleTexture=E.Parse(w.texture,d,I):w.textureName&&(p.particleTexture=new E(I+w.textureName,d,!1,void 0===w.invertY||w.invertY),p.particleTexture.name=w.textureName)),w.emitterId||0===w.emitterId||void 0!==w.i?w.emitterId&&d?p.i=d.getLastMeshById(w.emitterId):p.i=r.k.Ve(w.i):p.i=r.k.Zero(),p.isLocal=!!w.isLocal,void 0!==w.renderingGroupId&&(p.renderingGroupId=w.renderingGroupId),void 0!==w.isBillboardBased&&(p.isBillboardBased=w.isBillboardBased),void 0!==w.billboardMode&&(p.billboardMode=w.billboardMode),void 0!==w.useLogarithmicDepth&&(p.useLogarithmicDepth=w.useLogarithmicDepth),w.animations){for(let e=0;e<w.animations.length;e++){const r=w.animations[e],I=(0,q.c)("BABYLON.Animation");I&&p.animations.push(I.Parse(r))}p.beginAnimationOnStart=w.beginAnimationOnStart,p.beginAnimationFrom=w.beginAnimationFrom,p.beginAnimationTo=w.beginAnimationTo,p.beginAnimationLoop=w.beginAnimationLoop}if(w.autoAnimate&&d&&d.beginAnimation(p,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),p.startDelay=0|w.startDelay,p.minAngularSpeed=w.minAngularSpeed,p.maxAngularSpeed=w.maxAngularSpeed,p.minSize=w.minSize,p.maxSize=w.maxSize,w.minScaleX&&(p.minScaleX=w.minScaleX,p.maxScaleX=w.maxScaleX,p.minScaleY=w.minScaleY,p.maxScaleY=w.maxScaleY),void 0!==w.preWarmCycles&&(p.preWarmCycles=w.preWarmCycles,p.preWarmStepOffset=w.preWarmStepOffset),void 0!==w.minInitialRotation&&(p.minInitialRotation=w.minInitialRotation,p.maxInitialRotation=w.maxInitialRotation),p.minLifeTime=w.minLifeTime,p.maxLifeTime=w.maxLifeTime,p.minEmitPower=w.minEmitPower,p.maxEmitPower=w.maxEmitPower,p.emitRate=w.emitRate,p.gravity=r.k.Ve(w.gravity),w.noiseStrength&&(p.noiseStrength=r.k.Ve(w.noiseStrength)),p.color1=f.e.Ve(w.color1),p.color2=f.e.Ve(w.color2),p.colorDead=f.e.Ve(w.colorDead),p.updateSpeed=w.updateSpeed,p.targetStopDuration=w.targetStopDuration,p.blendMode=w.blendMode,w.colorGradients)for(const r of w.colorGradients)p.addColorGradient(r.gradient,f.e.Ve(r.color1),r.color2?f.e.Ve(r.color2):void 0);if(w.rampGradients){for(const e of w.rampGradients)p.addRampGradient(e.gradient,f.b.Ve(e.color));p.useRampGradients=w.useRampGradients}if(w.colorRemapGradients)for(const r of w.colorRemapGradients)p.addColorRemapGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.alphaRemapGradients)for(const r of w.alphaRemapGradients)p.addAlphaRemapGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.sizeGradients)for(const r of w.sizeGradients)p.addSizeGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.angularSpeedGradients)for(const r of w.angularSpeedGradients)p.addAngularSpeedGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.velocityGradients)for(const r of w.velocityGradients)p.addVelocityGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.dragGradients)for(const r of w.dragGradients)p.addDragGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.emitRateGradients)for(const r of w.emitRateGradients)p.addEmitRateGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.startSizeGradients)for(const r of w.startSizeGradients)p.addStartSizeGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.lifeTimeGradients)for(const r of w.lifeTimeGradients)p.addLifeTimeGradient(r.gradient,void 0!==r.factor1?r.factor1:r.factor,r.factor2);if(w.limitVelocityGradients){for(const e of w.limitVelocityGradients)p.addLimitVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);p.limitVelocityDamping=w.limitVelocityDamping}if(w.noiseTexture&&d){const e=(0,q.c)("BABYLON.ProceduralTexture");p.noiseTexture=e.Parse(w.noiseTexture,d,I)}let j;if(w.particleEmitterType){switch(w.particleEmitterType.type){case"SphereParticleEmitter":j=new O;break;case"SphereDirectedParticleEmitter":j=new a;break;case"ConeEmitter":case"ConeParticleEmitter":j=new m;break;case"ConeDirectedParticleEmitter":j=new J;break;case"CylinderParticleEmitter":j=new K;break;case"CylinderDirectedParticleEmitter":j=new y;break;case"HemisphericParticleEmitter":j=new c;break;case"PointParticleEmitter":j=new s;break;case"MeshParticleEmitter":j=new M;break;case"CustomParticleEmitter":j=new A;break;default:j=new k}j.parse(w.particleEmitterType,d)}else j=new k,j.parse(w,d);p.particleEmitterType=j,p.startSpriteCellID=w.startSpriteCellID,p.endSpriteCellID=w.endSpriteCellID,p.spriteCellLoop=w.spriteCellLoop??!0,p.spriteCellWidth=w.spriteCellWidth,p.spriteCellHeight=w.spriteCellHeight,p.spriteCellChangeSpeed=w.spriteCellChangeSpeed,p.spriteRandomStartCell=w.spriteRandomStartCell,p.disposeOnStop=w.disposeOnStop??!1,p.manualEmitCount=w.manualEmitCount??-1}static Parse(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const q=w.name;let E,j,X=null,k=null;if(p instanceof gw.d?E=p:(j=p,E=j.getEngine()),w.customShader&&E.createEffectForParticles){k=w.customShader;const p=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";X=E.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,p)}const m=new qp(q,d||w.eq,p,X,w.isAnimationSheetEnabled);if(m.customShader=k,m._rootUrl=e,w.id&&(m.id=w.id),w.subEmitters){m.subEmitters=[];for(const r of w.subEmitters){const w=[];for(const I of r)w.push(Gw.Parse(I,p,e));m.subEmitters.push(w)}}if(w.attractors)for(const f of w.attractors){const w=new fp;w.position=r.k.Ve(f.position),w.strength=f.strength,m.addAttractor(w)}return qp._Parse(w,m,p,e),w.textureMask&&(m.textureMask=f.e.Ve(w.textureMask)),w.Lj&&(m.Lj=r.k.Ve(w.Lj)),w.preventAutoStart&&(m.preventAutoStart=w.preventAutoStart),I||m.preventAutoStart||m.start(),m}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};if(qp._Serialize(p,this,w),p.textureMask=this.textureMask.ze(),p.customShader=this.customShader,p.preventAutoStart=this.preventAutoStart,p.Lj=this.Lj.ze(),this.subEmitters){p.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const e of this._subEmitters){const r=[];for(const p of e)r.push(p.serialize(w));p.subEmitters.push(r)}}if(this._attractors&&this._attractors.length){p.attractors=[];for(const w of this._attractors)p.attractors.push(w.serialize())}return p}static _Serialize(w,p,e){if(w.name=p.name,w.id=p.id,w.eq=p.getCapacity(),w.disposeOnStop=p.disposeOnStop,w.manualEmitCount=p.manualEmitCount,p.i.position){const e=p.i;w.emitterId=e.id}else{const e=p.i;w.i=e.ze()}p.particleEmitterType&&(w.particleEmitterType=p.particleEmitterType.serialize()),p.particleTexture&&(e?w.texture=p.particleTexture.serialize():(w.textureName=p.particleTexture.name,w.invertY=!!p.particleTexture._invertY)),w.isLocal=p.isLocal,b.e.AppendSerializedAnimations(p,w),w.beginAnimationOnStart=p.beginAnimationOnStart,w.beginAnimationFrom=p.beginAnimationFrom,w.beginAnimationTo=p.beginAnimationTo,w.beginAnimationLoop=p.beginAnimationLoop,w.startDelay=p.startDelay,w.renderingGroupId=p.renderingGroupId,w.isBillboardBased=p.isBillboardBased,w.billboardMode=p.billboardMode,w.minAngularSpeed=p.minAngularSpeed,w.maxAngularSpeed=p.maxAngularSpeed,w.minSize=p.minSize,w.maxSize=p.maxSize,w.minScaleX=p.minScaleX,w.maxScaleX=p.maxScaleX,w.minScaleY=p.minScaleY,w.maxScaleY=p.maxScaleY,w.minEmitPower=p.minEmitPower,w.maxEmitPower=p.maxEmitPower,w.minLifeTime=p.minLifeTime,w.maxLifeTime=p.maxLifeTime,w.emitRate=p.emitRate,w.gravity=p.gravity.ze(),w.noiseStrength=p.noiseStrength.ze(),w.color1=p.color1.ze(),w.color2=p.color2.ze(),w.colorDead=p.colorDead.ze(),w.updateSpeed=p.updateSpeed,w.targetStopDuration=p.targetStopDuration,w.blendMode=p.blendMode,w.preWarmCycles=p.preWarmCycles,w.preWarmStepOffset=p.preWarmStepOffset,w.minInitialRotation=p.minInitialRotation,w.maxInitialRotation=p.maxInitialRotation,w.startSpriteCellID=p.startSpriteCellID,w.spriteCellLoop=p.spriteCellLoop,w.endSpriteCellID=p.endSpriteCellID,w.spriteCellChangeSpeed=p.spriteCellChangeSpeed,w.spriteCellWidth=p.spriteCellWidth,w.spriteCellHeight=p.spriteCellHeight,w.spriteRandomStartCell=p.spriteRandomStartCell,w.isAnimationSheetEnabled=p.isAnimationSheetEnabled,w.useLogarithmicDepth=p.useLogarithmicDepth;const r=p.getColorGradients();if(r){w.colorGradients=[];for(const p of r){const e={gradient:p.gradient,color1:p.color1.ze()};p.color2?e.color2=p.color2.ze():e.color2=p.color1.ze(),w.colorGradients.push(e)}}const I=p.getRampGradients();if(I){w.rampGradients=[];for(const p of I){const e={gradient:p.gradient,color:p.color.ze()};w.rampGradients.push(e)}w.useRampGradients=p.useRampGradients}const d=p.getColorRemapGradients();if(d){w.colorRemapGradients=[];for(const p of d){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.colorRemapGradients.push(e)}}const f=p.getAlphaRemapGradients();if(f){w.alphaRemapGradients=[];for(const p of f){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.alphaRemapGradients.push(e)}}const q=p.getSizeGradients();if(q){w.sizeGradients=[];for(const p of q){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.sizeGradients.push(e)}}const E=p.getAngularSpeedGradients();if(E){w.angularSpeedGradients=[];for(const p of E){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.angularSpeedGradients.push(e)}}const j=p.getVelocityGradients();if(j){w.velocityGradients=[];for(const p of j){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.velocityGradients.push(e)}}const X=p.getDragGradients();if(X){w.dragGradients=[];for(const p of X){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.dragGradients.push(e)}}const k=p.getEmitRateGradients();if(k){w.emitRateGradients=[];for(const p of k){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.emitRateGradients.push(e)}}const m=p.getStartSizeGradients();if(m){w.startSizeGradients=[];for(const p of m){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.startSizeGradients.push(e)}}const J=p.getLifeTimeGradients();if(J){w.lifeTimeGradients=[];for(const p of J){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.lifeTimeGradients.push(e)}}const K=p.getLimitVelocityGradients();if(K){w.limitVelocityGradients=[];for(const p of K){const e={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?e.factor2=p.factor2:e.factor2=p.factor1,w.limitVelocityGradients.push(e)}w.limitVelocityDamping=p.limitVelocityDamping}p.noiseTexture&&(w.noiseTexture=p.noiseTexture.serialize())}clone(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={...this._customWrappers};let I=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){I=this.customShader;const w=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",p=d.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,w);r[0]?r[0].effect=p:this.setCustomEffect(p,0)}const f=this.serialize(e),q=qp.Parse(f,this._scene||this._engine,this._rootUrl);return q.name=w,q.customShader=I,q._customWrappers=r,void 0===p&&(p=this.i),this.noiseTexture&&(q.noiseTexture=this.noiseTexture.clone()),q.i=p,this.preventAutoStart||q.start(),q}}qp.BILLBOARDMODE_Y=2,qp.BILLBOARDMODE_ALL=7,qp.BILLBOARDMODE_STRETCHED=8,qp.BILLBOARDMODE_STRETCHED_LOCAL=9,Gw._ParseParticleSystem=qp.Parse;var Ep=e(11593),jp=e(11590),Xp=e(11411);Xp.e.prototype.createTransformFeedback=function(){const w=this._gl.createTransformFeedback();if(!w)throw new Error("Unable to create Transform Feedback");return w},Xp.e.prototype.deleteTransformFeedback=function(w){this._gl.deleteTransformFeedback(w)},Xp.e.prototype.bindTransformFeedback=function(w){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,w)},Xp.e.prototype.beginTransformFeedback=function(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(w?this._gl.POINTS:this._gl.TRIANGLES)},Xp.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Xp.e.prototype.setTranformFeedbackVaryings=function(w,p){this._gl.transformFeedbackVaryings(w,p,this._gl.INTERLEAVED_ATTRIBS)},Xp.e.prototype.bindTransformFeedbackBuffer=function(w){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w?w.underlyingResource:null)},Xp.e.prototype.readTransformFeedbackBuffer=function(w){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w)};const kp="clipPlaneFragmentDeclaration2",mp="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";t.e.IncludesShadersStore[kp]||(t.e.IncludesShadersStore[kp]=mp);e(12445),e(12449),e(12451),e(12456),e(12461),e(12468),e(12470),e(12475);const Jp="gpuRenderParticlesPixelShader",Kp="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";t.e.ShadersStore[Jp]||(t.e.ShadersStore[Jp]=Kp);const yp="clipPlaneVertexDeclaration2",cp="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";t.e.IncludesShadersStore[yp]||(t.e.IncludesShadersStore[yp]=cp);e(12478),e(12483),e(12488),e(12496);const sp="gpuRenderParticlesVertexShader",Op="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";t.e.ShadersStore[sp]||(t.e.ShadersStore[sp]=Op);class ap extends E{static get IsSupported(){if(!x.d.LastCreatedEngine)return!1;const w=x.d.LastCreatedEngine.getCaps();return w.supportTransformFeedbacks||w.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(w){this._maxActiveParticleCount=Math.min(w,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(w){this.maxActiveParticleCount=w}createPointEmitter(w,p){const e=ow(w,p);return this.particleEmitterType=e,e}createHemisphericEmitter(){const w=Cw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=Qw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=Sw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new r.k(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=ep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.k(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,p,e,r){const I=new k;return this.particleEmitterType=I,this.direction1=w,this.direction2=p,this.minEmitBox=e,this.maxEmitBox=r,I}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w)}isReady(){if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==qp.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(qp.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(qp.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";w?setTimeout((()=>{this.start(0)}),w):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var w;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[p])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new ww.b(this._engine),this._customWrappers[p].effect=w}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(w,p,e){return super._removeGradientAndTexture(w,p,e),this._releaseBuffers(),this}addColorGradient(w,p){this._colorGradients||(this._colorGradients=[]);const e=new Z(w,p);return this._colorGradients.push(e),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(w&&this._colorGradients.sort(((w,p)=>w.gradient<p.gradient?-1:w.gradient>p.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(w){return this._removeGradientAndTexture(w,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const p in this._drawWrappers){var w;null===(w=this._drawWrappers[p].drawContext)||void 0===w||w.reset()}}_addFactorGradient(w,p,e){const r=new g(p,e);w.push(r),this._releaseBuffers()}addSizeGradient(w,p){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,w,p),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(w){return this._removeGradientAndTexture(w,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(w,p){if(!w)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&w.sort(((w,p)=>w.gradient<p.gradient?-1:w.gradient>p.gradient?1:0));const e=this;e[p]&&(e[p].dispose(),e[p]=null)}addAngularSpeedGradient(w,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,w,p),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(w){return this._removeGradientAndTexture(w,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(w,p){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,w,p),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(w){return this._removeGradientAndTexture(w,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(w,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,w,p),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(w){return this._removeGradientAndTexture(w,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(w,p){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,w,p),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(w){return this._removeGradientAndTexture(w,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(w){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(w),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ue=new C.d,this.onStoppedObservable=new C.d,this.onStartedObservable=new C.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=r.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||x.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.tm.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,q.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,q.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,q.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,q.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ww.b(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers={0:new ww.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(p=p??{}).randomTextureSize||delete p.randomTextureSize;const f={eq:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...p},E=p;isFinite(E)&&(f.eq=E),this._capacity=f.eq,this._maxActiveParticleCount=f.eq,this._currentActiveCount=0,this._isAnimationSheetEnabled=d,this.particleEmitterType=new k;const j=Math.min(this._engine.getCaps().maxTextureSize,f.randomTextureSize);let X=[];for(let r=0;r<j;++r)X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random());this._randomTexture=new Q.b(new Float32Array(X),j,1,5,e,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,X=[];for(let r=0;r<j;++r)X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random());this._randomTexture2=new Q.b(new Float32Array(X),j,1,5,e,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=j}_reset(){this._releaseBuffers()}_createVertexBuffers(w,p,e){const r={};r.position=p.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let I=3;r.age=p.createVertexBuffer("age",I,1,this._attributesStrideSize,!0),I+=1,r.size=p.createVertexBuffer("size",I,3,this._attributesStrideSize,!0),I+=3,r.life=p.createVertexBuffer("life",I,1,this._attributesStrideSize,!0),I+=1,I+=4,this.billboardMode===qp.BILLBOARDMODE_STRETCHED&&(r.direction=p.createVertexBuffer("direction",I,3,this._attributesStrideSize,!0)),I+=3,this._platform.alignDataInBuffer&&(I+=1),this.particleEmitterType instanceof A&&(I+=3,this._platform.alignDataInBuffer&&(I+=1)),this._colorGradientsTexture||(r.color=p.createVertexBuffer("color",I,4,this._attributesStrideSize,!0),I+=4),this._isBillboardBased||(r.initialDirection=p.createVertexBuffer("initialDirection",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),this.noiseTexture&&(r.noiseCoordinates1=p.createVertexBuffer("noiseCoordinates1",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1),r.noiseCoordinates2=p.createVertexBuffer("noiseCoordinates2",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),r.angle=p.createVertexBuffer("angle",I,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?I++:I+=2,this._isAnimationSheetEnabled&&(r.cellIndex=p.createVertexBuffer("cellIndex",I,1,this._attributesStrideSize,!0),I+=1,this.spriteRandomStartCell&&(r.cellStartOffset=p.createVertexBuffer("cellStartOffset",I,1,this._attributesStrideSize,!0),I+=1)),r.offset=e.createVertexBuffer("offset",0,2),r.uv=e.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(r),this._platform.createVertexBuffers(w,r),this.resetDrawCache()}_initialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!w)return;const p=this._engine,e=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof A&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const I=this.particleEmitterType instanceof A,d=r.d.ne[0];let f=0;for(let r=0;r<this._capacity;r++)if(e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),I?(this.particleEmitterType.particleDestinationGenerator(r,null,d),e.push(d.x),e.push(d.y),e.push(d.z)):(e.push(0),e.push(0),e.push(0)),this._platform.alignDataInBuffer&&e.push(0),f+=16,I&&(this.particleEmitterType.particlePositionGenerator(r,null,d),e.push(d.x),e.push(d.y),e.push(d.z),this._platform.alignDataInBuffer&&e.push(0),f+=4),this._colorGradientsTexture||(e.push(0),e.push(0),e.push(0),e.push(0),f+=4),this.isBillboardBased||(e.push(0),e.push(0),e.push(0),this._platform.alignDataInBuffer&&e.push(0),f+=4),this.noiseTexture&&(e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),f+=8),e.push(0),f+=1,this._angularSpeedGradientsTexture||(e.push(0),f+=1),this._isAnimationSheetEnabled&&(e.push(0),f+=1,this.spriteRandomStartCell&&(e.push(0),f+=1)),this._platform.alignDataInBuffer){let w=3-(f+3&3);for(f+=w;w-- >0;)e.push(0)}const q=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),E=this._platform.createParticleBuffer(e),j=this._platform.createParticleBuffer(e);this._buffer0=new z.b(p,E,!1,this._attributesStrideSize),this._buffer1=new z.b(p,j,!1,this._attributesStrideSize),this._spriteBuffer=new z.b(p,q,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let w=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(w+="\n#define BILLBOARD"),this._colorGradientsTexture&&(w+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(w+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(w+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(w+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(w+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(w+="\n#define DRAGGRADIENTS"),this._flowMap&&(w+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(w+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(w+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(w+="\n#define NOISE"),this.isLocal&&(w+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===w||(this._cachedUpdateDefines=w,this._updateBuffer=this._platform.createUpdateBuffer(w)),this._platform.isUpdateBufferReady()}_getWrapper(w){const p=this._getCustomDrawWrapper(w);if(null!==p&&void 0!==p&&p.effect)return p;const e=[];this.fillDefines(e,w);let r=this._drawWrappers[w];r||(r=new ww.b(this._engine),r.drawContext&&(r.drawContext.useInstancing=!0),this._drawWrappers[w]=r);const I=e.join("\n");if(r.defines!==I){const w=[],p=[],e=[];this.fillUniformsAttributesAndSamplerNames(p,w,e),r.setEffect(this._engine.createEffect("gpuRenderParticles",w,p,e,I),I)}return r}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=[z.e.PositionKind,"age","life","size","angle"];return w||I.push(z.e.ColorKind),p&&I.push("cellIndex"),e||I.push("initialDirection"),r&&I.push("direction"),I.push("offset",z.e.UVKind),I}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=["emitterWM","Lj","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,pw.b)(r),w&&r.push("sheetInfos"),p&&r.push("logarithmicDepthConstant"),e&&(r.push("vFogInfos"),r.push("vFogColor")),r}fillDefines(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pw.l)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==jp.c.FOGMODE_NONE&&w.push("#define FOG")),p===qp.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this.isLocal&&w.push("#define LOCAL"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case qp.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case qp.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case qp.BILLBOARDMODE_ALL:w.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&w.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,p,e){p.push(...ap._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===qp.BILLBOARDMODE_STRETCHED)),w.push(...ap._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ep.e.PrepareUniforms(w,this._imageProcessingConfigurationDefines),Ep.e.PrepareSamplers(e,this._imageProcessingConfigurationDefines))}animate(){var w;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(p?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(w,p){const e=this[p];if(!w||!w.length||e)return;const r=new Float32Array(this._rawTextureWidth);for(let I=0;I<this._rawTextureWidth;I++){const p=I/this._rawTextureWidth;o.GetCurrentGradient(p,w,((w,p,e)=>{r[I]=(0,j.Lerp)(w.factor1,p.factor1,e)}))}this[p]=Q.b.CreateRTexture(r,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[p].name=p.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const w=new Uint8Array(4*this._rawTextureWidth),p=f.h.ed[0];for(let e=0;e<this._rawTextureWidth;e++){const r=e/this._rawTextureWidth;o.GetCurrentGradient(r,this._colorGradients,((r,I,d)=>{f.e.LerpToRef(r.color1,I.color1,d,p),w[4*e]=255*p.r,w[4*e+1]=255*p.g,w[4*e+2]=255*p.b,w[4*e+3]=255*p.a}))}this._colorGradientsTexture=Q.b.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(w,p){var e,I,d,f;const q=this._getWrapper(w),E=q.effect;this._engine.enableEffect(q);const j=(null===(e=this._scene)||void 0===e?void 0:e.getViewMatrix())||r.b.IdentityReadOnly;if(E.setMatrix("view",j),E.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),E.setTexture("diffuseSampler",this.particleTexture),E.setVector2("translationPivot",this.translationPivot),E.setVector3("Lj",this.Lj),this.isLocal&&E.setMatrix("emitterWM",p),this._colorGradientsTexture?E.setTexture("colorGradientSampler",this._colorGradientsTexture):E.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();E.setFloat3("sheetInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,w.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;E.setVector3("eyePosition",w.globalPosition)}const X=E.defines;if(this._scene&&((0,pw.e)(E,this,this._scene),this.applyFog&&(0,ew.e)(this._scene,void 0,E)),X.indexOf("#define BILLBOARDMODE_ALL")>=0){const w=j.clone();w.invert(),E.setMatrix("invView",w)}return this.useLogarithmicDepth&&this._scene&&(0,ew.i)(X,E,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(E),this._setEngineBasedOnBlendMode(w),this._platform.bindDrawBuffers(this._targetIndex,E,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(E),null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(f=this._scene)&&void 0!==f&&f.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(w){if(!this.i||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!w)if(this.i.position){w=this.i.getWorldMatrix()}else{const p=this.i;w=r.d.Matrix[0],r.b.TranslationToRef(p.x,p.y,p.z,w)}const p=this._engine,e=p.getDepthWrite();if(p.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const w=this.iw();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",w.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",w),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const I=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=I,p.setDepthWrite(e)}render(){let w,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!p&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let w=0;w<this.preWarmCycles;w++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const w=0|this._accumulatedCount;this._accumulatedCount-=w,this._currentActiveCount+=w}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.i.position){w=this.i.getWorldMatrix()}else{const p=this.i;w=r.d.Matrix[0],r.b.TranslationToRef(p.x,p.y,p.z,w)}const I=this._engine;this.updateInAnimate||this._update(w);let d=0;return p||e||(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0),d=this.blendMode===qp.BLENDMODE_MULTIPLYADD?this._render(qp.BLENDMODE_MULTIPLY,w)+this._render(qp.BLENDMODE_ADD,w):this._render(this.blendMode,w),this._engine.setAlphaMode(0)),d}rebuild(){const w=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(w,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,w()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const p in this._drawWrappers){this._drawWrappers[p].dispose()}if(this._drawWrappers={},this._scene){const w=this._scene.tm.indexOf(this);w>-1&&this._scene.tm.splice(w,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let p=0;p<this._renderVertexBuffers.length;++p){const w=this._renderVertexBuffers[p];for(const p in w)w[p].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ue.notifyObservers(this),this.ue.clear()}clone(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={...this._customWrappers};let I=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){I=this.customShader;const w=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";r[0]=d.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,w,void 0,void 0,void 0,this)}const f=this.serialize(e),q=ap.Parse(f,this._scene||this._engine,this._rootUrl);return q.name=w,q.customShader=I,q._customWrappers=r,void 0===p&&(p=this.i),this.noiseTexture&&(q.noiseTexture=this.noiseTexture.clone()),q.i=p,q}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return qp._Serialize(p,this,w),p.activeParticleCount=this.activeParticleCount,p.randomTextureSize=this._randomTextureSize,p.customShader=this.customShader,p}static Parse(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0;const d=w.name;let f,q;p instanceof gw.d?f=p:(q=p,f=q.getEngine());const E=new ap(d,{eq:I||w.eq,randomTextureSize:w.randomTextureSize},p,null,w.isAnimationSheetEnabled);if(E._rootUrl=e,w.customShader&&f.createEffectForParticles){const p=w.customShader,e=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",r=f.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,e,void 0,void 0,void 0,E);E.setCustomEffect(r,0),E.customShader=p}return w.id&&(E.id=w.id),w.activeParticleCount&&(E.activeParticleCount=w.activeParticleCount),qp._Parse(w,E,p,e),w.preventAutoStart&&(E.preventAutoStart=w.preventAutoStart),r||E.preventAutoStart||E.start(),E}}var Ap=e(11071),zp=e(12504),Mp=e(11710);class ip{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(w){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const p of this.systems)p.i=w;this._emitterNode=w}setEmitterAsSphere(w,p,e){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:w,renderingGroupId:p};const r=(0,zp.b)("emitterSphere",{diameter:w.diameter,segments:w.segments},e);r.renderingGroupId=p;const I=new Mp.c("emitterSphereMaterial",e);I.emissiveColor=w.color,r.material=I;for(const d of this.systems)d.i=r;this._emitterNode=r}start(w){for(const p of this.systems)w&&(p.i=w),p.start()}dispose(){for(const w of this.systems)w.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={systems:[]};for(const e of this.systems)p.systems.push(e.serialize(w));return this._emitterNode&&(p.i=this._emitterCreationOptions),p}static Parse(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;const I=new ip,d=this.BaseAssetsUrl+"/textures/";p=p||x.d.LastCreatedScene;for(const f of w.systems)I.systems.push(e?ap.Parse(f,p,d,!0,r):qp.Parse(f,p,d,!0,r));if(w.i){const e=w.i.options;if("Sphere"===w.i.kind)I.setEmitterAsSphere({diameter:e.diameter,segments:e.segments,color:f.b.Ve(e.color)},w.i.renderingGroupId,p)}return I}}ip.BaseAssetsUrl="https://assets.babylonjs.com/particles";var tp=e(11099);class np{static CreateDefault(w){let p,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,r=arguments.length>2?arguments[2]:void 0;p=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ap("default system",{eq:e},r):new qp("default system",e,r),p.i=w;const I=Ap.g.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return p.particleTexture=new h.e(I,p.iw()),p.createConeEmitter(.1,Math.PI/4),p.color1=new f.e(1,1,1,1),p.color2=new f.e(1,1,1,1),p.colorDead=new f.e(1,1,1,0),p.minSize=.1,p.maxSize=.1,p.minEmitPower=2,p.maxEmitPower=2,p.updateSpeed=1/60,p.emitRate=30,p}static CreateAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;p||(p=x.d.LastCreatedScene);const I={};return p.addPendingData(I),new Promise(((d,f)=>{if(e&&!ap.IsSupported)return p.removePendingData(I),f("Particle system with GPU is not supported.");Ap.g.LoadFile(`${np.BaseAssetsUrl}/systems/${w}.json`,(w=>{p.removePendingData(I);const f=JSON.parse(w.toString());return d(ip.Parse(f,p,e,r))}),void 0,void 0,void 0,(()=>(p.removePendingData(I),f(`An error occurred with the creation of your particle system. Check if your type '${w}' exists.`))))}))}static ExportSet(w){const p=new ip;for(const e of w)p.systems.push(e);return p}static ParseFromFileAsync(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5?arguments[5]:void 0;return new Promise(((f,q)=>{const E=new tp.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const p=JSON.parse(E.responseText);let q;q=r?ap.Parse(p,e,I,!1,d):qp.Parse(p,e,I,!1,d),w&&(q.name=w),f(q)}else q("Unable to load the particle system")})),E.open("GET",p),E.send()}))}static ParseFromSnippetAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",I=arguments.length>4?arguments[4]:void 0;if("_BLANK"===w){const w=this.CreateDefault(null);return w.start(),Promise.resolve(w)}return new Promise(((d,f)=>{const q=new tp.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const f=JSON.parse(JSON.parse(q.responseText).jsonPayload),E=JSON.parse(f.particleSystem);let j;j=e?ap.Parse(E,p,r,!1,I):qp.Parse(E,p,r,!1,I),j.snippetId=w,d(j)}else f("Unable to load the snippet "+w)})),q.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),q.send()}))}}np.BaseAssetsUrl=ip.BaseAssetsUrl,np.SnippetUrl="https://snippet.babylonjs.com",np.CreateFromSnippetAsync=np.ParseFromSnippetAsync;var lp=e(11370),Np=e(11408),Up=e(12513);(0,Up.d)(Np.d.NAME_PARTICLESYSTEM,((w,p,e,r)=>{const I=(0,Up.h)(Np.d.NAME_PARTICLESYSTEM);if(I&&void 0!==w.tm&&null!==w.tm)for(let d=0,f=w.tm.length;d<f;d++){const f=w.tm[d];e.tm.push(I(f,p,r))}})),(0,Up.c)(Np.d.NAME_PARTICLESYSTEM,((w,p,e)=>{if(w.activeParticleCount){return ap.Parse(w,p,e)}return qp.Parse(w,p,e)})),gw.d.prototype.createEffectForParticles=function(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,X=arguments.length>9?arguments[9]:void 0,k=[],m=[];const J=[];return E?E.fillUniformsAttributesAndSamplerNames(m,k,J):(k=qp._GetAttributeNamesOrOptions(),m=qp._GetEffectCreationOptions()),-1===I.indexOf(" BILLBOARD")&&(I+="\n#define BILLBOARD\n"),null!==E&&void 0!==E&&E.isAnimationSheetEnabled&&-1===I.indexOf(" ANIMATESHEET")&&(I+="\n#define ANIMATESHEET\n"),-1===r.indexOf("diffuseSampler")&&r.push("diffuseSampler"),this.createEffect({vertex:X??(null===E||void 0===E?void 0:E.vertexShaderName)??"particles",fragmentElement:w},k,m.concat(p),J.concat(r),I,d,f,q,void 0,j,(async()=>{0===j?await Promise.resolve().then(e.bind(e,12543)):await Promise.resolve().then(e.bind(e,12617))}))},lp.c.prototype.getEmittedParticleSystems=function(){const w=[];for(let p=0;p<this.iw().tm.length;p++){const e=this.iw().tm[p];e.i===this&&w.push(e)}return w},lp.c.prototype.getHierarchyEmittedParticleSystems=function(){const w=[],p=this.getDescendants();p.push(this);for(let e=0;e<this.iw().tm.length;e++){const r=this.iw().tm[e],I=r.i;I.position&&-1!==p.indexOf(I)&&w.push(r)}return w};e(11265),e(11275),e(11333);e(11337),e(12522),e(11358),e(11227),e(11404);e(11478);var vp;e(12527),e(11494);!function(w){w[w.Color=2]="Color",w[w.UV=1]="UV",w[w.Random=0]="Random",w[w.Stated=3]="Stated"}(vp||(vp={}));var Rp=e(11502);const Vp=new r.k(0,0,0),bp=new r.k(0,0,0),hp=new r.k(0,0,0);class Pp{constructor(w,p,e){this.width=w,this.height=p,this.data=e}processFlowable(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;if(!e)return;e instanceof r.b?r.k.TransformCoordinatesToRef(w.position,e,hp):(hp.x=e.x,hp.y=e.y,hp.z=e.z);const I=.5*hp.x+.5,d=1-(.5*hp.y+.5),f=Math.floor(I*this.width),q=Math.floor(d*this.height);if(f<0||f>=this.width||q<0||q>=this.height)return;const E=4*(q*this.width+f),j=this.data[E]/255*2-1,X=this.data[E+1]/255*2-1,k=this.data[E+2]/255*2-1,m=this.data[E+3]/255;Vp.set(j,X,k),Vp.scaleToRef(p*m,bp),w.direction.addInPlace(bp)}_processParticle(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;this.processFlowable(w,p,e)}static async FromUrlAsync(w){return await new Promise(((p,e)=>{const r=document.createElement("canvas"),I=r.getContext("2d");let d=null;const f=new Image;f.crossOrigin="anonymous",f.src=w,f.onerror=p=>{e(new Error(`Failed to load image: ${w} : ${p}`))},f.onload=()=>{r.width=f.width,r.height=f.height,I.drawImage(f,0,0),d=I.getImageData(0,0,r.width,r.height),p(new Pp(r.width,r.height,d.data))}}))}static async ExtractFromTextureAsync(w){return await new Promise(((p,e)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{const e=await this.ExtractFromTextureAsync(w);p(e)}catch(r){e(r)}}));const r=w.getSize();Rp.i.GetTextureDataAsync(w,r.width,r.height).then((w=>{p(new Pp(r.width,r.height,new Uint8ClampedArray(w)))})).catch(e)}))}}var up,Yp,Lp,Wp,Fp,Hp,Bp,Dp,Tp;!function(w){w[w.Int=1]="Int",w[w.Float=2]="Float",w[w.Vector2=4]="Vector2",w[w.ne=8]="ne",w[w.Matrix=16]="Matrix",w[w.Particle=32]="Particle",w[w.Texture=64]="Texture",w[w.ed=128]="ed",w[w.FloatGradient=256]="FloatGradient",w[w.Vector2Gradient=512]="Vector2Gradient",w[w.Vector3Gradient=1024]="Vector3Gradient",w[w.Color4Gradient=2048]="Color4Gradient",w[w.System=4096]="System",w[w.AutoDetect=8192]="AutoDetect",w[w.BasedOnInput=16384]="BasedOnInput",w[w.Undefined=32768]="Undefined",w[w.All=65535]="All"}(up||(up={})),function(w){w[w.Compatible=0]="Compatible",w[w.TypeIncompatible=1]="TypeIncompatible",w[w.HierarchyIssue=2]="HierarchyIssue"}(Yp||(Yp={})),function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(Lp||(Lp={}));class Zp{get direction(){return this._direction}get type(){if(this._type===up.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===up.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(w){this._type=w}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((w=>w.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(w,p,e){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=up.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new C.d,this.onDisconnectionObservable=new C.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=p,this.name=w,this._direction=e}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(w){var p;return this.isConnected?null!==(p=this._connectedPoint)&&void 0!==p&&p._storedFunction?this._connectedPoint._storedFunction(w):this._connectedPoint._storedValue:this.value}canConnectTo(w){return 0===this.checkCompatibilityState(w)}checkCompatibilityState(w){const p=this._ownerBlock,e=w.ownerBlock;if(this.type!==w.type&&w.innerType!==up.AutoDetect)return w.acceptedConnectionPointTypes&&-1!==w.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(w.excludedConnectionPointTypes&&-1!==w.excludedConnectionPointTypes.indexOf(this.type))return 1;let r=e,I=p;return 0===this.direction&&(r=p,I=e),r.isAnAncestorOf(I)?2:0}connectTo(w){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(w))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${w.ownerBlock.name}".${w.name}`;return this._endpoints.push(w),w._connectedPoint=this,this.onConnectionObservable.notifyObservers(w),w.onConnectionObservable.notifyObservers(this),this}disconnectFrom(w){const p=this._endpoints.indexOf(w);return-1===p||(this._endpoints.splice(p,1),w._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(w),w.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(w){let p=1;for(;p<up.All;)w&p||this.excludedConnectionPointTypes.push(p),p<<=1}serialize(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const p={};return p.name=this.name,p.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.ze?(p.valueType="BABYLON."+this.value.getClassName(),p.value=this.value.ze()):(p.valueType="number",p.value=this.value)),w&&this.connectedPoint&&(p.inputName=this.name,p.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,p.targetConnectionName=this.connectedPoint.name,p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),p}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Gp{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(w){this._name=w}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(w){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new C.d,this.ue=new C.d,this.onInputChangedObservable=new C.d,this.visibleOnFrame=!1,this._name=w,this.uniqueId=P.c.UniqueId}_inputRename(w){return w}_outputRename(w){return w}isAnAncestorOf(w){for(const p of this._outputs)if(p.hasEndpoints)for(const e of p.endpoints){if(e.ownerBlock===w)return!0;if(e.ownerBlock.isAnAncestorOf(w))return!0}return!1}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const p of this._outputs)if(p.hasEndpoints)for(const e of p.endpoints)if(e.ownerBlock.isAnAncestorOfType(w))return!0;return!1}getInputByName(w){const p=this._inputs.filter((p=>p.name===w));return p.length?p[0]:null}_linkConnectionTypes(w,p){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[p]._acceptedConnectionPointType=this._inputs[w]:(this._inputs[w]._linkedConnectionSource=this._inputs[p],this._inputs[w]._isMainLinkSource=!0),this._inputs[p]._linkedConnectionSource=this._inputs[w]}registerInput(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;const f=new Zp(w,this,0);return f.type=p,f.isOptional=e,f.defaultValue=r,f.value=r,f.valueMin=I,f.valueMax=d,this._inputs.push(f),this.onInputChangedObservable.notifyObservers(f),this}registerOutput(w,p,e){return(e=e??new Zp(w,this,1)).type=p,this._outputs.push(e),this}_build(w){}_customBuildStep(w){}build(w){if(this._buildId===w.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((w=>w.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=w.buildId;for(const p of this._inputs){if(!p.connectedPoint){p.isOptional||w.notConnectedNonOptionalInputs.push(p);continue}const e=p.connectedPoint.ownerBlock;e&&e!==this&&!e.isSystem&&e.build(w)}return this._customBuildStep(w),w.verbose&&u.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(w),this.onBuildObservable.notifyObservers(this),!1}serialize(){const w={};w.customType="BABYLON."+this.getClassName(),w.id=this.uniqueId,w.name=this.name,w.visibleOnFrame=this.visibleOnFrame,w.inputs=[],w.outputs=[];for(const p of this.inputs)w.inputs.push(p.serialize());for(const p of this.outputs)w.outputs.push(p.serialize(!1));return w}_deserialize(w){this._name=w.name,this.comments=w.comments,this.visibleOnFrame=!!w.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(w)}_deserializePortDisplayNamesAndExposedOnFrame(w){const p=w.inputs,e=w.outputs;if(p)for(const r of p){const w=this.inputs.find((w=>w.name===r.name));if(!w)return;if(r.displayName&&(w.displayName=r.displayName),r.isExposedOnFrame&&(w.isExposedOnFrame=r.isExposedOnFrame,w.exposedPortPosition=r.exposedPortPosition),void 0!==r.value&&null!==r.value)if("number"===r.valueType)w.value=r.value;else{const p=(0,q.c)(r.valueType);p&&(w.value=p.Ve(r.value))}}if(e)for(let r=0;r<e.length;r++){const w=e[r];w.displayName&&(this.outputs[r].displayName=w.displayName),w.isExposedOnFrame&&(this.outputs[r].isExposedOnFrame=w.isExposedOnFrame,this.outputs[r].exposedPortPosition=w.exposedPortPosition)}}clone(){const w=this.serialize(),p=(0,q.c)(w.customType);if(p){const e=new p;return e._deserialize(w),e}return null}dispose(){this.ue.notifyObservers(this),this.ue.clear();for(const w of this.inputs)w.dispose();for(const w of this.outputs)w.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function gp(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",r=arguments.length>3?arguments[3]:void 0;return(I,d)=>{let f=I._propStore;f||(f=[],I._propStore=f),f.push({propertyName:d,displayName:w,type:p,groupName:e,options:r??{},className:I.getClassName()})}}(0,R.c)([(0,V.J)("comment")],Gp.prototype,"comments",void 0),function(w){w[w.Boolean=0]="Boolean",w[w.Float=1]="Float",w[w.Int=2]="Int",w[w.Vector2=3]="Vector2",w[w.List=4]="List",w[w.ed=5]="ed",w[w.SamplingMode=6]="SamplingMode",w[w.TextureFormat=7]="TextureFormat",w[w.TextureType=8]="TextureType"}(Wp||(Wp={})),function(w){w[w.None=0]="None",w[w.Position=1]="Position",w[w.Direction=2]="Direction",w[w.Age=3]="Age",w[w.Lifetime=4]="Lifetime",w[w.Color=5]="Color",w[w.ScaledDirection=6]="ScaledDirection",w[w.Scale=7]="Scale",w[w.AgeGradient=8]="AgeGradient",w[w.Angle=9]="Angle",w[w.SpriteCellIndex=16]="SpriteCellIndex",w[w.SpriteCellStart=17]="SpriteCellStart",w[w.SpriteCellEnd=18]="SpriteCellEnd"}(Fp||(Fp={})),function(w){w[w.None=0]="None",w[w.Time=1]="Time",w[w.Delta=2]="Delta",w[w.Emitter=3]="Emitter"}(Hp||(Hp={}));class op{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let w="";for(const p of this.notConnectedNonOptionalInputs)w+=`input ${p.name} from block ${p.ownerBlock.name}[${p.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(w)throw"Build of Node Particle System Set failed:\n"+w}adapt(w,p){const e=w.getConnectedValue(this)||0;if(w.type===p)return e;switch(p){case up.Vector2:return new r.g(e,e);case up.ne:return new r.k(e,e,e);case up.ed:return new f.e(e,e,e,e)}return null}getContextualValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case Fp.Position:return this.particleContext.position;case Fp.Direction:return this.particleContext.direction;case Fp.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Fp.Color:return this.particleContext.color;case Fp.Age:return this.particleContext.age;case Fp.Lifetime:return this.particleContext.lifeTime;case Fp.Angle:return this.particleContext.angle;case Fp.Scale:return this.particleContext.scale;case Fp.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Fp.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Fp.SpriteCellIndex:return this.particleContext.cellIndex;case Fp.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.i.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.i.absolutePosition:this.systemContext.i:null}getSystemValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case Hp.Time:return this.systemContext._actualFrame;case Hp.Delta:return this.systemContext._scaledUpdateSpeed;case Hp.Emitter:if(this.isEmitterTransformNode){return this.systemContext.i.absolutePosition}return this.systemContext.i}return null}}function Cp(w,p,e){const r=new op;r.yp=p;const I=w.createSystem(r);return I.canStart=()=>!0,I.i=e.clone(),I.disposeOnStop=!0,I.start(),I}class Qp extends Gp{constructor(w){super(w),this.blendMode=E.BLENDMODE_ONEONE,this.eq=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",up.Particle),this.registerInput("texture",up.Texture),this.registerInput("onStart",up.System,!0),this.registerInput("onEnd",up.System,!0),this.registerOutput("system",up.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(w){w.eq=this.eq,w.buildId=this._buildId++,this.build(w);const p=this.particle.getConnectedValue(w);return p.particleTexture=this.texture.getConnectedValue(w),p.emitRate=this.emitRate,p.blendMode=this.blendMode,p.name=this.name,p._nodeGenerated=!0,p._targetStopDuration=this.targetStopDuration,p.startDelay=this.startDelay,this.system._storedValue=this,p.canStart=()=>!this.doNoStart,p.onStartedObservable.add((e=>{const r=this.onStart.getConnectedValue(w);r&&e.onStartedObservable.addOnce((()=>{w.systemContext=p;const e=Cp(r,w.yp,w.emitterPosition);this.ue.addOnce((()=>{e.dispose()}))}));const I=this.onEnd.getConnectedValue(w);I&&e.onStoppedObservable.addOnce((()=>{w.systemContext=p;const e=Cp(I,w.yp,w.emitterPosition);this.ue.addOnce((()=>{e.dispose()}))}))})),this.ue.addOnce((()=>{p.dispose()})),p}serialize(){const w=super.serialize();return w.eq=this.eq,w.emitRate=this.emitRate,w.blendMode=this.blendMode,w.doNoStart=this.doNoStart,w.targetStopDuration=this.targetStopDuration,w.startDelay=this.startDelay,w}_deserialize(w){super._deserialize(w),this.eq=w.eq,this.emitRate=w.emitRate,this.doNoStart=!!w.doNoStart,void 0!==w.blendMode&&(this.blendMode=w.blendMode),void 0!==w.targetStopDuration&&(this.targetStopDuration=w.targetStopDuration),void 0!==w.startDelay&&(this.startDelay=w.startDelay)}}(0,R.c)([gp("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:E.BLENDMODE_ONEONE},{label:"Standard",value:E.BLENDMODE_STANDARD},{label:"Add",value:E.BLENDMODE_ADD},{label:"Multiply",value:E.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:E.BLENDMODE_MULTIPLYADD}]})],Qp.prototype,"blendMode",void 0),(0,R.c)([gp("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Qp.prototype,"eq",void 0),(0,R.c)([gp("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qp.prototype,"emitRate",void 0),(0,R.c)([gp("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qp.prototype,"targetStopDuration",void 0),(0,R.c)([gp("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qp.prototype,"startDelay",void 0),(0,R.c)([gp("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Qp.prototype,"doNoStart",void 0),(0,q.d)("BABYLON.SystemBlock",Qp);class xp extends Gp{get type(){if(this._type===up.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=up.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=up.Vector2,this._type;case"ne":return this._type=up.ne,this._type;case"ed":return this._type=up.ed,this._type;case"Matrix":return this._type=up.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Fp.None&&this._systemSource!==Hp.None}get systemSource(){return this._systemSource}set systemSource(w){if(this._systemSource=w,w!==Hp.None){switch(this._contextualSource=Fp.None,this._type=up.Float,w){case Hp.Time:case Hp.Delta:this._type=up.Float;break;case Hp.Emitter:this._type=up.ne}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Fp.None}get contextualValue(){return this._contextualSource}set contextualValue(w){if(this._contextualSource=w,w!==Fp.None){switch(this._systemSource=Hp.None,w){case Fp.Scale:this._type=up.Vector2;break;case Fp.Position:case Fp.Direction:case Fp.ScaledDirection:this._type=up.ne;break;case Fp.Color:this._type=up.ed;break;case Fp.Age:case Fp.Lifetime:case Fp.Angle:case Fp.AgeGradient:this._type=up.Float;break;case Fp.SpriteCellEnd:case Fp.SpriteCellStart:case Fp.SpriteCellIndex:this._type=up.Int}this.output&&(this.output.type=this._type)}}constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:up.AutoDetect;super(w),this._type=up.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new C.d,this._systemSource=Hp.None,this._contextualSource=Fp.None,this._type=p,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",p)}get value(){return this._storedValue}set value(w){this.type===up.Float&&this.min!==this.max&&(w=Math.max(this.min,w),w=Math.min(this.max,w)),this._storedValue=w,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(w){this._valueCallback=w}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case up.Int:case up.Float:this.value=0;break;case up.Vector2:this.value=r.g.Zero();break;case up.ne:this.value=r.k.Zero();break;case up.ed:this.value=new f.e(1,1,1,1);break;case up.Matrix:this.value=r.b.Identity()}}_build(w){super._build(w),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=w=>w.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=w=>w.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const w=super.serialize();return w.type=this.type,w.contextualValue=this.contextualValue,w.systemSource=this.systemSource,w.min=this.min,w.max=this.max,w.groupInInspector=this.groupInInspector,w.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.ze?(w.valueType="BABYLON."+this._storedValue.getClassName(),w.value=this._storedValue.ze()):(w.valueType="number",w.value=this._storedValue)),w}_deserialize(w){if(super._deserialize(w),this._type=w.type,this.contextualValue=w.contextualValue,this.systemSource=w.systemSource||Hp.None,this.min=w.min||0,this.max=w.max||0,this.groupInInspector=w.groupInInspector||"",void 0!==w.displayInInspector&&(this.displayInInspector=w.displayInInspector),w.valueType)if("number"===w.valueType)this._storedValue=w.value;else{const p=(0,q.c)(w.valueType);p&&(this._storedValue=p.Ve(w.value))}}}(0,q.d)("BABYLON.ParticleInputBlock",xp);class Sp extends Gp{get url(){return this._url}set url(w){this._url!==w&&(this._cachedData=null,this._url=w,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(w){this._textureDataUrl!==w&&(this._cachedData=null,this._textureDataUrl=w,this._url="",this._sourceTexture=null)}set sourceTexture(w){this._sourceTexture!==w&&(this._cachedData=null,this._sourceTexture=w,this._url="",this._textureDataUrl="")}constructor(w){super(w),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",up.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const w=this.texture._storedValue;return await new Promise(((p,e)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),p(this._cachedData)}catch(w){e(w)}}));const r=w.getSize();Rp.i.GetTextureDataAsync(w,r.width,r.height).then((e=>{this._cachedData={width:r.width,height:r.height,data:new Uint8ClampedArray(e)},w.dispose(),p(this._cachedData)})).catch(e)}))}_build(w){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new h.e(this._textureDataUrl,w.yp):this.texture._storedValue=new h.e(this._url,w.yp):this.texture._storedValue=null}serialize(){const w=super.serialize();return w.url=this.url,w.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(w.textureDataUrl=this.textureDataUrl),w}_deserialize(w){super._deserialize(w),this.url=w.url,this.serializedCachedData=!!w.serializedCachedData,w.textureDataUrl&&(this.textureDataUrl=w.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,q.d)("BABYLON.ParticleTextureSourceBlock",Sp);class we extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("position",up.ne),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.position.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.position.X(this.position.getConnectedValue(w))},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}}(0,q.d)("BABYLON.UpdatePositionBlock",we),function(w){w[w.Add=0]="Add",w[w.Subtract=1]="Subtract",w[w.Multiply=2]="Multiply",w[w.Divide=3]="Divide",w[w.Max=4]="Max",w[w.Min=5]="Min"}(Bp||(Bp={}));class pe extends Gp{constructor(w){super(w),this.operation=Bp.Add,this.registerInput("left",up.AutoDetect),this.registerInput("right",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this.output._typeConnectionSource=this.left;const p=[up.Matrix,up.Particle,up.Texture,up.System,up.FloatGradient,up.Color4Gradient,up.Vector2Gradient,up.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...p),this.right.excludedConnectionPointTypes.push(...p),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(w){let p;const e=this.left,I=this.right;if(!e.isConnected||!I.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const d=e.type===up.Float||e.type===up.Int,q=I.type===up.Float||I.type===up.Int,E=d&&q;switch(this.operation){case Bp.Add:p=E?w=>e.getConnectedValue(w)+I.getConnectedValue(w):d?w=>w.adapt(e,I.type).add(I.getConnectedValue(w)):w=>e.getConnectedValue(w).add(w.adapt(I,e.type));break;case Bp.Subtract:p=E?w=>e.getConnectedValue(w)-I.getConnectedValue(w):d?w=>w.adapt(e,I.type).Je(I.getConnectedValue(w)):w=>e.getConnectedValue(w).Je(w.adapt(I,e.type));break;case Bp.Multiply:p=E?w=>e.getConnectedValue(w)*I.getConnectedValue(w):d?w=>w.adapt(e,I.type).multiply(I.getConnectedValue(w)):w=>e.getConnectedValue(w).multiply(w.adapt(I,e.type));break;case Bp.Divide:p=E?w=>e.getConnectedValue(w)/I.getConnectedValue(w):d?w=>w.adapt(e,I.type).divide(I.getConnectedValue(w)):w=>e.getConnectedValue(w).divide(w.adapt(I,e.type));break;case Bp.Min:if(E)p=w=>Math.min(e.getConnectedValue(w),I.getConnectedValue(w));else{const[w,q]=d?[I,e]:[e,I];switch(w.type){case up.Vector2:p=p=>r.g.Minimize(w.getConnectedValue(p),p.adapt(q,w.type));break;case up.ne:p=p=>r.k.Minimize(w.getConnectedValue(p),p.adapt(q,w.type));break;case up.ed:p=p=>{const e=w.getConnectedValue(p),{r:r,g:I,b:d,a:E}=p.adapt(q,w.type);return new f.e(Math.min(e.r,r),Math.min(e.g,I),Math.min(e.b,d),Math.min(e.a,E))}}}break;case Bp.Max:if(!E){const[w,q]=d?[I,e]:[e,I];switch(w.type){case up.Vector2:p=p=>r.g.Maximize(w.getConnectedValue(p),p.adapt(q,w.type));break;case up.ne:p=p=>r.k.Maximize(w.getConnectedValue(p),p.adapt(q,w.type));break;case up.ed:p=p=>{const e=w.getConnectedValue(p),{r:r,g:I,b:d,a:E}=p.adapt(q,w.type);return new f.e(Math.max(e.r,r),Math.min(e.g,I),Math.min(e.b,d),Math.min(e.a,E))}}break}p=w=>Math.max(e.getConnectedValue(w),I.getConnectedValue(w))}this.output._storedFunction=w=>e.type===up.Int?0|p(w):p(w)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===up.Int||this.left.type===up.Float&&this.right.type!==up.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[w,p]of[[this.left,this.right],[this.right,this.left]])w.acceptedConnectionPointTypes=[up.Int,up.Float],p.isConnected&&(w.acceptedConnectionPointTypes.push(p.type),p.type!==up.Int&&p.type!==up.Float||w.acceptedConnectionPointTypes.push(up.Vector2,up.ne,up.ed))}dispose(){super.dispose();for(const w of this._connectionObservers)w.remove();this._connectionObservers.length=0}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,R.c)([gp("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Bp.Add},{label:"Subtract",value:Bp.Subtract},{label:"Multiply",value:Bp.Multiply},{label:"Divide",value:Bp.Divide},{label:"Max",value:Bp.Max},{label:"Min",value:Bp.Min}]})],pe.prototype,"operation",void 0),(0,q.d)("BABYLON.ParticleMathBlock",pe);class ee extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("direction1",up.ne,!0,new r.k(0,1,0)),this.registerInput("direction2",up.ne,!0,new r.k(0,1,0)),this.registerInput("minEmitBox",up.ne,!0,new r.k(-.5,-.5,-.5)),this.registerInput("maxEmitBox",up.ne,!0,new r.k(.5,.5,.5)),this.registerOutput("output",up.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const p=this.particle.getConnectedValue(w);p._directionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.direction1.getConnectedValue(w),d=this.direction2.getConnectedValue(w),f=(0,j.RandomRange)(I.x,d.x),q=(0,j.RandomRange)(I.y,d.y),E=(0,j.RandomRange)(I.z,d.z);w.isEmitterTransformNode?r.k.TransformNormalFromFloatsToRef(f,q,E,w.emitterWorldMatrix,e.direction):e.direction.te(f,q,E)},p._positionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.minEmitBox.getConnectedValue(w),d=this.maxEmitBox.getConnectedValue(w),f=(0,j.RandomRange)(I.x,d.x),q=(0,j.RandomRange)(I.y,d.y),E=(0,j.RandomRange)(I.z,d.z);w.isEmitterTransformNode?r.k.TransformCoordinatesFromFloatsToRef(f,q,E,w.emitterWorldMatrix,e.position):(e.position.te(f,q,E),e.position.addInPlace(w.emitterPosition))},this.output._storedValue=p}}(0,q.d)("BABYLON.BoxShapeBlock",ee);class re extends Gp{constructor(w){super(w),this.registerInput("emitPower",up.Float,!0,1),this.registerInput("lifeTime",up.Float,!0,1),this.registerInput("color",up.ed,!0,new f.e(1,1,1,1)),this.registerInput("scale",up.Vector2,!0,new r.g(1,1)),this.registerInput("angle",up.Float,!0,0),this.registerOutput("particle",up.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(w){const p=new qp(this.name,w.eq,w.yp,null,!1,void 0,!0);p.particleEmitterType=new s,p._lifeTimeCreation.process=(p,e)=>{w.particleContext=p,p.lifeTime=this.lifeTime.getConnectedValue(w),e._emitPower=this.emitPower.getConnectedValue(w)},p._colorCreation.process=p=>{w.particleContext=p,p.color.X(this.color.getConnectedValue(w))},p._sizeCreation.process=p=>{w.particleContext=p,p.size=1,p.scale.X(this.scale.getConnectedValue(w))},p._angleCreation.process=p=>{w.particleContext=p,p.angle=this.angle.getConnectedValue(w)},this.particle._storedValue=p}}(0,q.d)("BABYLON.CreateParticleBlock",re);class Ie{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const w=[];for(const p of this.attachedBlocks)p.isInput&&w.push(p);return w}constructor(w){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new C.d,this.name=w}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(w)&&this.attachedBlocks.push(w);for(const e of w.inputs){const r=e.connectedPoint;if(r){const e=r.ownerBlock;e!==w&&this._initializeBlock(e,p)}}}async buildAsync(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((e=>{const r=new ip;for(const w of this._systemBlocks)this._initializeBlock(w);for(const I of this.systemBlocks){const e=new op;e.buildId=this._buildId++,e.yp=w,e.verbose=p;const d=I.createSystem(e);e.emitErrors(),r.systems.push(d)}this.onBuildObservable.notifyObservers(this),e(r)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const w=new Qp("Particle system"),p=new we("Update position");p.output.connectTo(w.particle);const e=new xp("Position");e.contextualValue=Fp.Position;const r=new xp("Scaled direction");r.contextualValue=Fp.ScaledDirection;const I=new pe("Add");I.operation=Bp.Add,e.output.connectTo(I.left),r.output.connectTo(I.right),I.output.connectTo(p.position);const d=new re("Create particle"),f=new ee("Box shape");d.particle.connectTo(f.particle),f.output.connectTo(p.particle);const q=new Sp("Texture");q.texture.connectTo(w.texture),q.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(w)}removeBlock(w){const p=this.attachedBlocks.indexOf(w);if(p>-1&&this.attachedBlocks.splice(p,1),w.isSystem){const p=this._systemBlocks.indexOf(w);p>-1&&this._systemBlocks.splice(p,1)}}parseSerializedObject(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p||this.clear();const e={};for(const r of w.LX){const w=(0,q.c)(r.customType);if(w){const p=new w;p._deserialize(r),e[r.id]=p,this.attachedBlocks.push(p),p.isSystem&&this._systemBlocks.push(p)}}for(const r of this.attachedBlocks)if(r.isTeleportOut){const w=r,p=w._tempEntryPointUniqueId;if(p){const r=e[p];r&&r.attachToEndpoint(w)}}for(let r=0;r<w.LX.length;r++){const I=w.LX[r],d=e[I.id];d&&(d.inputs.length&&I.inputs.some((w=>w.targetConnectionName))&&!p||this._restoreConnections(d,w,e))}if(w.locations||w.editorData&&w.editorData.locations){const r=w.locations||w.editorData.locations;for(const w of r)e[w.lI]&&(w.lI=e[w.lI].uniqueId);p&&this.editorData&&this.editorData.locations&&r.concat(this.editorData.locations),w.locations?this.editorData={locations:r}:(this.editorData=w.editorData,this.editorData.locations=r);const I=[];for(const w in e)I[w]=e[w].uniqueId;this.editorData.map=I}this.comment=w.comment}_restoreConnections(w,p,e){for(const r of w.outputs)for(const I of p.LX){const d=e[I.id];if(d)for(const f of I.inputs)if(e[f.targetBlockId]!==w||f.targetConnectionName!==r.name);else{const w=d.getInputByName(f.inputName);if(!w||w.isConnected)continue;r.connectTo(w,!0),this._restoreConnections(d,p,e)}}}serialize(w){const p=w?{}:b.e.Serialize(this);p.editorData=JSON.parse(JSON.stringify(this.editorData));let e=[];w?e=w:p.customType="BABYLON.NodeParticleSystemSet",p.LX=[];for(const r of e)p.LX.push(r.serialize());if(!w)for(const r of this.attachedBlocks)-1===e.indexOf(r)&&p.LX.push(r.serialize());return p}dispose(){for(const w of this.attachedBlocks)w.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(w){const p=new Ie(w);return p.setToDefault(),p}static Parse(w){const p=b.e.Parse((()=>new Ie(w.name)),w,null);return p.parseSerializedObject(w),p}static ParseFromSnippetAsync(w,p){return"_BLANK"===w?Promise.resolve(Ie.CreateDefault("blank")):new Promise(((e,r)=>{const I=new tp.b;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){const f=JSON.parse(JSON.parse(I.responseText).jsonPayload),q=JSON.parse(f.nodeParticle);p||(p=b.e.Parse((()=>new Ie(w)),q,null)),p.parseSerializedObject(q),p.snippetId=w;try{e(p)}catch(d){r(d)}}else r("Unable to load the snippet "+w)})),I.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),I.send()}))}}Ie.EditorURL=`${Ap.g._DefaultCdnUrl}/v${gw.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Ie.SnippetUrl="https://snippet.babylonjs.com",(0,R.c)([(0,V.J)()],Ie.prototype,"name",void 0),(0,R.c)([(0,V.J)("comment")],Ie.prototype,"comment",void 0),function(w){w[w.None=0]="None",w[w.PerParticle=1]="PerParticle",w[w.PerSystem=2]="PerSystem"}(Dp||(Dp={}));class de extends Gp{constructor(w){super(w),this._currentLockId=-2,this.lockMode=Dp.PerParticle,this.registerInput("min",up.AutoDetect,!0,0),this.registerInput("max",up.AutoDetect,!0,1),this.registerOutput("output",up.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(up.Float|up.Int|up.Vector2|up.ne|up.ed),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(up.Float|up.Int|up.Vector2|up.ne|up.ed),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=up.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case up.AutoDetect:case up.Int:case up.Float:w=w=>{const p=this.min.getConnectedValue(w)||0,e=this.max.getConnectedValue(w)||1;return p+Math.random()*(e-p)};break;case up.Vector2:w=w=>{const p=this.min.getConnectedValue(w)||r.g.Zero(),e=this.max.getConnectedValue(w)||r.g.One();return new r.g(p.x+Math.random()*(e.x-p.x),p.y+Math.random()*(e.y-p.y))};break;case up.ne:w=w=>{const p=this.min.getConnectedValue(w)||r.k.Zero(),e=this.max.getConnectedValue(w)||r.k.One();return new r.k(p.x+Math.random()*(e.x-p.x),p.y+Math.random()*(e.y-p.y),p.z+Math.random()*(e.z-p.z))};break;case up.ed:w=w=>{const p=this.min.getConnectedValue(w)||new f.e(0,0,0,0),e=this.max.getConnectedValue(w)||new f.e(1,1,1,1);return new f.e(p.x+Math.random()*(e.x-p.x),p.y+Math.random()*(e.y-p.y),p.z+Math.random()*(e.z-p.z),p.w+Math.random()*(e.w-p.w))}}this.output._storedFunction=p=>{var e;let r=0;switch(this.lockMode){case Dp.PerParticle:r=(null===(e=p.particleContext)||void 0===e?void 0:e.id)||-1;break;case Dp.PerSystem:r=p.buildId||0}return this._currentLockId!==r&&(this.lockMode!==Dp.None&&(this._currentLockId=r),this.output._storedValue=w(p)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),this.lockMode=w.lockMode}}(0,R.c)([gp("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Dp.None},{label:"Per particle",value:Dp.PerParticle},{label:"Per system",value:Dp.PerSystem}]})],de.prototype,"lockMode",void 0),(0,q.d)("BABYLON.ParticleRandomBlock",de);class fe extends Gp{constructor(w){super(w),this._currentLockId=-2,this.lockMode=Dp.PerParticle,this.registerInput("min",up.AutoDetect),this.registerInput("max",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const p=[up.Matrix,up.Particle,up.Texture,up.System,up.FloatGradient,up.Color4Gradient,up.Vector2Gradient,up.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...p),this.max.excludedConnectionPointTypes.push(...p)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case up.Float:case up.Int:w=w=>{const p=this.min.getConnectedValue(w),e=this.max.getConnectedValue(w);return Math.random()*(e-p)+p};break;case up.Vector2:w=w=>{const p=this.min.getConnectedValue(w),e=this.max.getConnectedValue(w);return new r.g(Math.random()*(e.x-p.x)+p.x,Math.random()*(e.y-p.y)+p.y)};break;case up.ne:w=w=>{const p=this.min.getConnectedValue(w),e=this.max.getConnectedValue(w);return new r.k(Math.random()*(e.x-p.x)+p.x,Math.random()*(e.y-p.y)+p.y,Math.random()*(e.z-p.z)+p.z)};break;case up.ed:w=w=>{const p=this.min.getConnectedValue(w),e=this.max.getConnectedValue(w);return new f.e(Math.random()*(e.r-p.r)+p.r,Math.random()*(e.g-p.g)+p.g,Math.random()*(e.b-p.b)+p.b,Math.random()*(e.a-p.a)+p.a)}}this.output._storedFunction=p=>{var e;let r=0;switch(this.lockMode){case Dp.PerParticle:r=(null===(e=p.particleContext)||void 0===e?void 0:e.id)||-1;break;case Dp.PerSystem:r=p.buildId||0}return this._currentLockId!==r&&(this.lockMode!==Dp.None&&(this._currentLockId=r),this.output._storedValue=w(p)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),void 0!==w.lockMode&&(this.lockMode=w.lockMode)}}(0,R.c)([gp("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Dp.None},{label:"Per particle",value:Dp.PerParticle},{label:"Per system",value:Dp.PerSystem}]})],fe.prototype,"lockMode",void 0),(0,q.d)("BABYLON.RandomRangeBlock",fe);(0,q.d)("BABYLON.ParticleLerpBlock",class extends Gp{constructor(w){super(w),this.registerInput("left",up.AutoDetect),this.registerInput("right",up.AutoDetect),this.registerInput("gradient",up.Float,!0,0,0,1),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(up.Float|up.Int|up.Vector2|up.ne|up.ed)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const w=(w,p,e)=>(1-w)*p+w*e;this.output._storedFunction=p=>{const e=this.left.getConnectedValue(p),I=this.right.getConnectedValue(p),d=this.gradient.getConnectedValue(p);switch(this.left.type){case up.Int:case up.Float:return w(d,e,I);case up.Vector2:return new r.g(w(d,e.x,I.x),w(d,e.y,I.y));case up.ne:return new r.k(w(d,e.x,I.x),w(d,e.y,I.y),w(d,e.z,I.z));case up.ed:return new f.e(w(d,e.r,I.r),w(d,e.g,I.g),w(d,e.b,I.b),w(d,e.a,I.a))}return 0}}});(0,q.d)("BABYLON.UpdateDirectionBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("direction",up.ne),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.direction.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.direction.X(this.direction.getConnectedValue(w))},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}});(0,q.d)("BABYLON.UpdateColorBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("color",up.ed),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.color.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.color.X(this.color.getConnectedValue(w))},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}});(0,q.d)("BABYLON.UpdateScaleBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("scale",up.Vector2),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.scale.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.scale.X(this.scale.getConnectedValue(w))},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}});(0,q.d)("BABYLON.UpdateAngleBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("angle",up.Float),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.angle.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.angle=this.angle.getConnectedValue(w)},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}});(0,q.d)("BABYLON.BasicPositionUpdateBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(w){const p=this.particle.getConnectedValue(w),e={process:e=>{w.particleContext=e,w.systemContext=p,e.direction.scaleToRef(p._directionScale,p._scaledDirection),e.position.addInPlace(p._scaledDirection)},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e,this.output._storedValue=p}});(0,q.d)("BABYLON.BasicSpriteUpdateBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(w){const p=this.particle.getConnectedValue(w),e={process:e=>{w.particleContext=e,w.systemContext=p,e.updateCellIndex()},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e,this.output._storedValue=p}});(0,q.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("cellIndex",up.Int),this.registerOutput("output",up.Particle),this.cellIndex.acceptedConnectionPointTypes=[up.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(w){const p=this.particle.getConnectedValue(w);if(this.output._storedValue=p,!this.cellIndex.isConnected)return;const e={process:e=>{w.particleContext=e,w.systemContext=p,e.cellIndex=Math.floor(this.cellIndex.getConnectedValue(w))},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e}});class qe extends Gp{constructor(w){super(w),this.strength=1,this.registerInput("particle",up.Particle),this.registerInput("flowMap",up.Texture),this.registerOutput("output",up.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(w){var p;const e=this.particle.getConnectedValue(w),r=w.yp;let I;(null===(p=this.flowMap.connectedPoint)||void 0===p?void 0:p.ownerBlock).extractTextureContentAsync().then((w=>{w&&(I=new Pp(w.width,w.height,w.data))}));const d={process:w=>{const p=r.getTransformMatrix();I&&I._processParticle(w,this.strength*e._tempScaledUpdateSpeed,p)},previousItem:null,nextItem:null};e._updateQueueStart?Hw(d,e._updateQueueStart):e._updateQueueStart=d,this.output._storedValue=e}serialize(){const w=super.serialize();return w.strength=this.strength,w}_deserialize(w){super._deserialize(w),this.strength=w.strength}}(0,R.c)([gp("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qe.prototype,"strength",void 0),(0,q.d)("BABYLON.UpdateFlowMapBlock",qe);(0,q.d)("BABYLON.SphereShapeBlock",class extends Gp{constructor(w){super(w),this.registerInput("input",up.Particle),this.registerInput("radius",up.Float,!0,1),this.registerInput("radiusRange",up.Float,!0,1,0,1),this.registerInput("directionRandomizer",up.Float,!0,0,0,1),this.registerOutput("output",up.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(w){const p=this.input.getConnectedValue(w);p._directionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.directionRandomizer.getConnectedValue(w),d=e.position.Je(w.emitterPosition).normalize(),f=(0,j.RandomRange)(0,I),q=(0,j.RandomRange)(0,I),E=(0,j.RandomRange)(0,I);d.x+=f,d.y+=q,d.z+=E,d.normalize(),w.isEmitterTransformNode?r.k.TransformNormalFromFloatsToRef(f,q,E,w.emitterWorldMatrix,e.direction):e.direction.te(f,q,E)},p._positionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.radius.getConnectedValue(w),d=this.radiusRange.getConnectedValue(w),f=I-(0,j.RandomRange)(0,I*d),q=(0,j.RandomRange)(0,1),E=(0,j.RandomRange)(0,2*Math.PI),X=Math.acos(2*q-1),k=f*Math.cos(E)*Math.sin(X),m=f*Math.cos(X),J=f*Math.sin(E)*Math.sin(X);w.isEmitterTransformNode?r.k.TransformCoordinatesFromFloatsToRef(k,m,J,w.emitterWorldMatrix,e.position):(e.position.te(k,m,J),e.position.addInPlace(w.emitterPosition))},this.output._storedValue=p}});(0,q.d)("BABYLON.PointShapeBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("direction1",up.ne,!0,new r.k(0,1,0)),this.registerInput("direction2",up.ne,!0,new r.k(0,1,0)),this.registerOutput("output",up.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const p=this.particle.getConnectedValue(w);p._directionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.direction1.getConnectedValue(w),d=this.direction2.getConnectedValue(w),f=(0,j.RandomRange)(I.x,d.x),q=(0,j.RandomRange)(I.y,d.y),E=(0,j.RandomRange)(I.z,d.z);w.isEmitterTransformNode?r.k.TransformNormalFromFloatsToRef(f,q,E,w.emitterWorldMatrix,e.direction):e.direction.te(f,q,E)},p._positionCreation.process=e=>{w.systemContext=p,w.isEmitterTransformNode?r.k.TransformCoordinatesFromFloatsToRef(0,0,0,w.emitterWorldMatrix,e.position):e.position.X(w.emitterPosition)},this.output._storedValue=p}});(0,q.d)("BABYLON.CustomShapeBlock",class extends Gp{constructor(w){super(w),this.registerInput("particle",up.Particle),this.registerInput("position",up.ne,!0,new r.k(0,0,0)),this.registerInput("direction",up.ne,!0,new r.k(0,1,0)),this.registerOutput("output",up.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const p=this.particle.getConnectedValue(w);p._directionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.direction.getConnectedValue(w);w.isEmitterTransformNode?r.k.TransformNormalToRef(I,w.emitterWorldMatrix,e.direction):e.direction.X(I)},p._positionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.position.getConnectedValue(w);w.isEmitterTransformNode?r.k.TransformCoordinatesToRef(I,w.emitterWorldMatrix,e.position):(e.position.X(I),e.position.addInPlace(w.emitterPosition))},this.output._storedValue=p}});(0,q.d)("BABYLON.CylinderShapeBlock",class extends Gp{constructor(w){super(w),this._tempVector=r.k.Zero(),this.registerInput("particle",up.Particle),this.registerInput("radius",up.Float,!0,1),this.registerInput("height",up.Float,!0,1,0),this.registerInput("radiusRange",up.Float,!0,1,0,1),this.registerInput("directionRandomizer",up.Float,!0,0,0,1),this.registerOutput("output",up.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const p=this.particle.getConnectedValue(w);p._directionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.directionRandomizer.getConnectedValue(w);e.position.subtractToRef(w.emitterPosition,this._tempVector),this._tempVector.normalize(),w.isEmitterTransformNode&&r.k.TransformNormalToRef(this._tempVector,w.emitterInverseWorldMatrix,this._tempVector);const d=(0,j.RandomRange)(-I/2,I/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*I,this._tempVector.y=d,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),w.isEmitterTransformNode?r.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w.emitterWorldMatrix,e.direction):e.direction.X(this._tempVector)},p._positionCreation.process=e=>{w.particleContext=e,w.systemContext=p;const I=this.height.getConnectedValue(w),d=this.radiusRange.getConnectedValue(w),f=this.radius.getConnectedValue(w),q=(0,j.RandomRange)(-I/2,I/2),E=(0,j.RandomRange)(0,2*Math.PI),X=(0,j.RandomRange)((1-d)*(1-d),1),k=Math.sqrt(X)*f,m=k*Math.cos(E),J=k*Math.sin(E);w.isEmitterTransformNode?r.k.TransformCoordinatesFromFloatsToRef(m,q,J,w.emitterWorldMatrix,e.position):(e.position.te(m,q,J),e.position.addInPlace(w.emitterPosition))},this.output._storedValue=p}});class Ee extends Gp{constructor(w){super(w),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",up.Particle),this.registerOutput("output",up.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const p=this.particle.getConnectedValue(w);p._isAnimationSheetEnabled=!0,p.spriteCellWidth=this.width,p.spriteCellHeight=this.height,p.startSpriteCellID=this.start,p.endSpriteCellID=this.end,p.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=p}serialize(){const w=super.serialize();return w.width=this.width,w.height=this.height,w.start=this.start,w.end=this.end,w.randomStartCell=this.randomStartCell,w}_deserialize(w){super._deserialize(w),this.width=w.width,this.height=w.height,this.start=w.start,this.end=w.end,this.randomStartCell=w.randomStartCell}}(0,R.c)([gp("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ee.prototype,"start",void 0),(0,R.c)([gp("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ee.prototype,"end",void 0),(0,R.c)([gp("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ee.prototype,"width",void 0),(0,R.c)([gp("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ee.prototype,"height",void 0),(0,R.c)([gp("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ee.prototype,"loop",void 0),(0,R.c)([gp("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ee.prototype,"randomStartCell",void 0),(0,q.d)("BABYLON.SetupSpriteSheetBlock",Ee);class je extends Gp{constructor(w){super(w),this.reference=0,this.registerInput("value",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case up.Float:return up.FloatGradient;case up.Vector2:return up.Vector2Gradient;case up.ne:return up.Vector3Gradient;case up.ed:return up.Color4Gradient}return w},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(up.Float|up.Vector2|up.ne|up.ed)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=w=>null}serialize(){const w=super.serialize();return w.reference=this.reference,w}_deserialize(w){super._deserialize(w),this.reference=w.reference}}(0,R.c)([gp("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],je.prototype,"reference",void 0),(0,q.d)("BABYLON.ParticleGradientValueBlock",je);(0,q.d)("BABYLON.ParticleGradientBlock",class extends Gp{constructor(w){super(w),this._entryCount=1,this.registerInput("gradient",up.Float,!0,1,0,1),this.registerInput("value0",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case up.FloatGradient:return up.Float;case up.Vector2Gradient:return up.Vector2;case up.Vector3Gradient:return up.ne;case up.Color4Gradient:return up.ed}return w},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(up.FloatGradient|up.Vector2Gradient|up.Vector3Gradient|up.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(w){this._inputs[w].onConnectionObservable.add((()=>{this._entryCount>w||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),up.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const w=[];for(let e=1;e<this._inputs.length;e++){var p;if(this._inputs[e].isConnected)w.push(null===(p=this._inputs[e].connectedPoint)||void 0===p?void 0:p.ownerBlock)}w.sort(((w,p)=>w.reference-p.reference)),this.output._storedFunction=p=>{const e=this.gradient.getConnectedValue(p);if(1===w.length)return w[0].value.getConnectedValue(p);let I=null;for(let d=w.length-1;d>=0;d--){const q=w[d];if(q.reference<=e){const w=q.value.getConnectedValue(p);if(I){const d=I.value.getConnectedValue(p),E=I.reference,X=q.reference,k=Math.max(0,Math.min(1,(e-X)/(E-X)));switch(this.output.type){case up.Float:return(0,j.Lerp)(w,d,k);case up.Vector2:return r.g.Lerp(w,d,k);case up.ne:return r.k.Lerp(w,d,k);case up.ed:return f.e.Lerp(w,d,k)}}return w}I=q}return 0}}});(0,q.d)("BABYLON.ParticleConverterBlock",class extends Gp{constructor(w){super(w),this.registerInput("color ",up.ed,!0),this.registerInput("xyz ",up.ne,!0),this.registerInput("xy ",up.Vector2,!0),this.registerInput("zw ",up.Vector2,!0),this.registerInput("x ",up.Float,!0),this.registerInput("y ",up.Float,!0),this.registerInput("z ",up.Float,!0),this.registerInput("w ",up.Float,!0),this.registerOutput("color",up.ed),this.registerOutput("xyz",up.ne),this.registerOutput("xy",up.Vector2),this.registerOutput("zw",up.Vector2),this.registerOutput("x",up.Float),this.registerOutput("y",up.Float),this.registerOutput("z",up.Float),this.registerOutput("w",up.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(w){return"color "===w?"colorIn":"xyz "===w?"xyzIn":"xy "===w?"xyIn":"zw "===w?"zwIn":"x "===w?"xIn":"y "===w?"yIn":"z "===w?"zIn":"w "===w?"wIn":w}_outputRename(w){switch(w){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return w}}_build(w){super._build(w);const p=this.xIn,e=this.yIn,I=this.zIn,d=this.wIn,q=this.xyIn,E=this.zwIn,j=this.xyzIn,X=this.colorIn,k=this.colorOut,m=this.xyzOut,J=this.xyOut,K=this.zwOut,y=this.xOut,c=this.yOut,s=this.zOut,O=this.wOut,a=w=>{if(X.isConnected)return X.getConnectedValue(w);let r=0,k=0,m=0,J=0;if(p.isConnected&&(r=p.getConnectedValue(w)),e.isConnected&&(k=e.getConnectedValue(w)),I.isConnected&&(m=I.getConnectedValue(w)),d.isConnected&&(J=d.getConnectedValue(w)),q.isConnected){const p=q.getConnectedValue(w);p&&(r=p.x,k=p.y)}if(E.isConnected){const p=E.getConnectedValue(w);p&&(m=p.x,J=p.y)}if(j.isConnected){const p=j.getConnectedValue(w);p&&(r=p.x,k=p.y,m=p.z)}return new f.e(r,k,m,J)};k._storedFunction=w=>a(w),m._storedFunction=w=>{const p=a(w);return new r.k(p.r,p.g,p.b)},J._storedFunction=w=>{const p=a(w);return new r.g(p.r,p.g)},K._storedFunction=w=>{const p=a(w);return new r.g(p.b,p.a)},y._storedFunction=w=>a(w).r,c._storedFunction=w=>a(w).g,s._storedFunction=w=>a(w).b,O._storedFunction=w=>a(w).a}}),function(w){w[w.Cos=0]="Cos",w[w.Sin=1]="Sin",w[w.Abs=2]="Abs",w[w.Exp=3]="Exp",w[w.Exp2=4]="Exp2",w[w.Round=5]="Round",w[w.Floor=6]="Floor",w[w.Ceiling=7]="Ceiling",w[w.Sqrt=8]="Sqrt",w[w.Log=9]="Log",w[w.Tan=10]="Tan",w[w.ArcTan=11]="ArcTan",w[w.ArcCos=12]="ArcCos",w[w.ArcSin=13]="ArcSin",w[w.Sign=14]="Sign",w[w.Negate=15]="Negate",w[w.OneMinus=16]="OneMinus",w[w.Reciprocal=17]="Reciprocal",w[w.ToDegrees=18]="ToDegrees",w[w.ToRadians=19]="ToRadians",w[w.Fract=20]="Fract"}(Tp||(Tp={}));class Xe extends Gp{constructor(w){super(w),this.operation=Tp.Cos,this.registerInput("input",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(up.Float|up.Int|up.Vector2|up.ne|up.ed)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);let p=null;switch(this.operation){case Tp.Cos:p=w=>Math.cos(w);break;case Tp.Sin:p=w=>Math.sin(w);break;case Tp.Abs:p=w=>Math.abs(w);break;case Tp.Exp:p=w=>Math.exp(w);break;case Tp.Exp2:p=w=>Math.pow(2,w);break;case Tp.Round:p=w=>Math.round(w);break;case Tp.Floor:p=w=>Math.floor(w);break;case Tp.Ceiling:p=w=>Math.ceil(w);break;case Tp.Sqrt:p=w=>Math.sqrt(w);break;case Tp.Log:p=w=>Math.log(w);break;case Tp.Tan:p=w=>Math.tan(w);break;case Tp.ArcTan:p=w=>Math.atan(w);break;case Tp.ArcCos:p=w=>Math.acos(w);break;case Tp.ArcSin:p=w=>Math.asin(w);break;case Tp.Sign:p=w=>Math.sign(w);break;case Tp.Negate:p=w=>-w;break;case Tp.OneMinus:p=w=>1-w;break;case Tp.Reciprocal:p=w=>1/w;break;case Tp.ToRadians:p=w=>w*Math.PI/180;break;case Tp.ToDegrees:p=w=>180*w/Math.PI;break;case Tp.Fract:p=w=>w>=0?w-Math.floor(w):w-Math.ceil(w)}if(!p)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case up.Int:case up.Float:this.output._storedFunction=w=>{const e=this.input.getConnectedValue(w);return p(e)};break;case up.Vector2:this.output._storedFunction=w=>{const e=this.input.getConnectedValue(w);return new r.g(p(e.x),p(e.y))};break;case up.ne:this.output._storedFunction=w=>{const e=this.input.getConnectedValue(w);return new r.k(p(e.x),p(e.y),p(e.z))};break;case up.ed:this.output._storedFunction=w=>{const e=this.input.getConnectedValue(w);return new f.e(p(e.r),p(e.g),p(e.b),p(e.a))}}return this}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,R.c)([gp("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Tp.Cos},{label:"Sin",value:Tp.Sin},{label:"Abs",value:Tp.Abs},{label:"Exp",value:Tp.Exp},{label:"Exp2",value:Tp.Exp2},{label:"Round",value:Tp.Round},{label:"Floor",value:Tp.Floor},{label:"Ceiling",value:Tp.Ceiling},{label:"Sqrt",value:Tp.Sqrt},{label:"Log",value:Tp.Log},{label:"Tan",value:Tp.Tan},{label:"ArcTan",value:Tp.ArcTan},{label:"ArcCos",value:Tp.ArcCos},{label:"ArcSin",value:Tp.ArcSin},{label:"Sign",value:Tp.Sign},{label:"Negate",value:Tp.Negate},{label:"OneMinus",value:Tp.OneMinus},{label:"Reciprocal",value:Tp.Reciprocal},{label:"ToDegrees",value:Tp.ToDegrees},{label:"ToRadians",value:Tp.ToRadians},{label:"Fract",value:Tp.Fract}]})],Xe.prototype,"operation",void 0),(0,q.d)("BABYLON.ParticleTrigonometryBlock",Xe);var ke,me=e(12529);class Je extends Gp{constructor(w){super(w),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(up.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(up.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(up.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(up.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(up.System),this._inputs[0].excludedConnectionPointTypes.push(up.Particle),this._inputs[0].excludedConnectionPointTypes.push(up.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const p=w=>{const p=this.input.getConnectedValue(w);if(this.log.length>=this.stackSize)return p;if(null===p||void 0===p)return this.log.push(["null",""]),p;switch(this.input.type){case up.Vector2:this.log.push([(0,me.i)(p,4),p.toString()]);break;case up.ne:this.log.push([(0,me.k)(p,4),p.toString()]);break;case up.ed:this.log.push([`{R: ${p.r.toFixed(4)} G: ${p.g.toFixed(4)} B: ${p.b.toFixed(4)} A: ${p.a.toFixed(4)}}`,p.toString()]);break;default:this.log.push([p.toString(),p.toString()])}return p};this.output.isConnected?this.output._storedFunction=p:this.output._storedValue=p(w)}serialize(){const w=super.serialize();return w.stackSize=this.stackSize,w}_deserialize(w){super._deserialize(w),this.stackSize=w.stackSize}}(0,R.c)([gp("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Je.prototype,"stackSize",void 0),(0,q.d)("BABYLON.ParticleDebugBlock",Je);(0,q.d)("BABYLON.ParticleElbowBlock",class extends Gp{constructor(w){super(w),this.registerInput("input",up.AutoDetect),this.registerOutput("output",up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const p=this._outputs[0],e=this._inputs[0];p._storedFunction=w=>e.getConnectedValue(w)}});(0,q.d)("BABYLON.ParticleTeleportInBlock",class extends Gp{get endpoints(){return this._endpoints}constructor(w){super(w),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",up.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const p of this.endpoints)if(p.isAnAncestorOfType(w))return!0;return!1}isAnAncestorOf(w){for(const p of this.endpoints){if(p===w)return!0;if(p.isAnAncestorOf(w))return!0}return!1}attachToEndpoint(w){w.detach(),this._endpoints.push(w),w._entryPoint=this,w._outputs[0]._typeConnectionSource=this._inputs[0],w._tempEntryPointUniqueId=null,w.name="> "+this.name}detachFromEndpoint(w){const p=this._endpoints.indexOf(w);-1!==p&&(this._endpoints.splice(p,1),w._outputs[0]._typeConnectionSource=null,w._entryPoint=null)}_build(){for(const w of this._endpoints)w.output._storedFunction=w=>this.input.getConnectedValue(w)}});(0,q.d)("BABYLON.ParticleTeleportOutBlock",class extends Gp{constructor(w){super(w),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",up.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(w){this.entryPoint&&this.entryPoint.build(w)}clone(){const w=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(w),w}serialize(){var w;const p=super.serialize();return p.entryPoint=(null===(w=this.entryPoint)||void 0===w?void 0:w.uniqueId)??"",p}_deserialize(w){super._deserialize(w),this._tempEntryPointUniqueId=w.entryPoint}}),function(w){w[w.Equal=0]="Equal",w[w.NotEqual=1]="NotEqual",w[w.LessThan=2]="LessThan",w[w.GreaterThan=3]="GreaterThan",w[w.LessOrEqual=4]="LessOrEqual",w[w.GreaterOrEqual=5]="GreaterOrEqual",w[w.Xor=6]="Xor",w[w.Or=7]="Or",w[w.And=8]="And"}(ke||(ke={}));class Ke extends Gp{constructor(w){super(w),this.test=ke.Equal,this.epsilon=0,this.registerInput("left",up.Float),this.registerInput("right",up.Float,!0,0),this.registerInput("ifTrue",up.AutoDetect,!0,1),this.registerInput("ifFalse",up.AutoDetect,!0,0),this.registerOutput("output",up.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=up.Float,this._inputs[0].acceptedConnectionPointTypes.push(up.Int),this._inputs[1].acceptedConnectionPointTypes.push(up.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const w=w=>{const p=this.left.getConnectedValue(w),e=this.right.getConnectedValue(w);let r=!1;switch(this.test){case ke.Equal:r=(0,j.WithinEpsilon)(p,e,this.epsilon);break;case ke.NotEqual:r=!(0,j.WithinEpsilon)(p,e,this.epsilon);break;case ke.LessThan:r=p<e+this.epsilon;break;case ke.GreaterThan:r=p>e-this.epsilon;break;case ke.LessOrEqual:r=p<=e+this.epsilon;break;case ke.GreaterOrEqual:r=p>=e-this.epsilon;break;case ke.Xor:r=!!p&&!e||!p&&!!e;break;case ke.Or:r=!!p||!!e;break;case ke.And:r=!!p&&!!e}return r};this.output._storedFunction=p=>w(p)?this.ifTrue.getConnectedValue(p):this.ifFalse.getConnectedValue(p)}serialize(){const w=super.serialize();return w.test=this.test,w.epsilon=this.epsilon,w}_deserialize(w){super._deserialize(w),this.test=w.test,void 0!==w.epsilon&&(this.epsilon=w.epsilon)}}(0,R.c)([gp("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ke.Equal},{label:"NotEqual",value:ke.NotEqual},{label:"LessThan",value:ke.LessThan},{label:"GreaterThan",value:ke.GreaterThan},{label:"LessOrEqual",value:ke.LessOrEqual},{label:"GreaterOrEqual",value:ke.GreaterOrEqual},{label:"Xor",value:ke.Xor},{label:"Or",value:ke.Or},{label:"And",value:ke.And}]})],Ke.prototype,"test",void 0),(0,R.c)([gp("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ke.prototype,"epsilon",void 0),(0,q.d)("BABYLON.ParticleConditionBlock",Ke);class ye extends Gp{constructor(w){super(w),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",up.Particle),this.registerInput("condition",up.Float,!0,0),this.registerInput("system",up.System),this.registerOutput("output",up.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){this._triggerCount=0;const p=this.input.getConnectedValue(w),e={process:e=>{if(w.particleContext=e,w.systemContext=p,0!==this.condition.getConnectedValue(w)&&(0===this.limit||this._triggerCount<this.limit)){const r=(new Date).getTime();if(this._previousOne&&r-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=r;const I=this.system.getConnectedValue(w);if(I){const r=Cp(I,w.yp,e.position);r.ue.addOnce((()=>{this._triggerCount--})),p.ue.addOnce((()=>{r.dispose()}))}}},previousItem:null,nextItem:null};p._updateQueueStart?Hw(e,p._updateQueueStart):p._updateQueueStart=e,this.output._storedValue=p}serialize(){const w=super.serialize();return w.limit=this.limit,w.delay=this.delay,w}_deserialize(w){super._deserialize(w),void 0!==w.limit&&(this.limit=w.limit),void 0!==w.delay&&(this.delay=w.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,R.c)([gp("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ye.prototype,"limit",void 0),(0,R.c)([gp("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ye.prototype,"delay",void 0),(0,q.d)("BABYLON.ParticleTriggerBlock",ye);e(12538),e(12543),e(12557),e(12617)},12602:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12565:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12640:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneVertex",d="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12622:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12608:(w,p,e)=>{"use strict";var r=e(11146);const I="fogFragment",d="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12596:(w,p,e)=>{"use strict";var r=e(11146);const I="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12642:(w,p,e)=>{"use strict";var r=e(11146);const I="fogVertex",d="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12631:(w,p,e)=>{"use strict";var r=e(11146);const I="fogVertexDeclaration",d="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12585:(w,p,e)=>{"use strict";var r=e(11146);const I="helperFunctions",d="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12571:(w,p,e)=>{"use strict";var r=e(11146);const I="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12593:(w,p,e)=>{"use strict";var r=e(11146);const I="imageProcessingFunctions",d="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12577:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12604:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12649:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";r.e.IncludesShadersStoreWGSL[I]||(r.e.IncludesShadersStoreWGSL[I]=d)},12557:(w,p,e)=>{"use strict";e.r(p),e.d(p,{particlesPixelShaderWGSL:()=>f});var r=e(11146);e(12565),e(12571),e(12577),e(12585),e(12593),e(12596),e(12602),e(12604),e(12608);const I="particlesPixelShader",d="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";r.e.ShadersStoreWGSL[I]||(r.e.ShadersStoreWGSL[I]=d);const f={name:I,shader:d}},12617:(w,p,e)=>{"use strict";e.r(p),e.d(p,{particlesVertexShaderWGSL:()=>f});var r=e(11146);e(12622),e(12631),e(12577),e(12640),e(12642),e(12649);const I="particlesVertexShader",d="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";r.e.ShadersStoreWGSL[I]||(r.e.ShadersStoreWGSL[I]=d);const f={name:I,shader:d}},12468:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12540:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12483:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneVertex",d="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12548:(w,p,e)=>{"use strict";var r=e(11146);const I="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12475:(w,p,e)=>{"use strict";var r=e(11146);const I="fogFragment",d="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12461:(w,p,e)=>{"use strict";var r=e(11146);const I="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12488:(w,p,e)=>{"use strict";var r=e(11146);const I="fogVertex",d="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12478:(w,p,e)=>{"use strict";var r=e(11146);const I="fogVertexDeclaration",d="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12451:(w,p,e)=>{"use strict";var r=e(11146);const I="helperFunctions",d="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12445:(w,p,e)=>{"use strict";var r=e(11146);const I="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12456:(w,p,e)=>{"use strict";var r=e(11146);const I="imageProcessingFunctions",d="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12449:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12470:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12496:(w,p,e)=>{"use strict";var r=e(11146);const I="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";r.e.IncludesShadersStore[I]||(r.e.IncludesShadersStore[I]=d)},12538:(w,p,e)=>{"use strict";e.r(p),e.d(p,{particlesPixelShader:()=>f});var r=e(11146);e(12540),e(12445),e(12449),e(12451),e(12456),e(12461),e(12468),e(12470),e(12475);const I="particlesPixelShader",d="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";r.e.ShadersStore[I]||(r.e.ShadersStore[I]=d);const f={name:I,shader:d}},12543:(w,p,e)=>{"use strict";e.r(p),e.d(p,{particlesVertexShader:()=>f});var r=e(11146);e(12548),e(12478),e(12449),e(12483),e(12488),e(12496);const I="particlesVertexShader",d="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";r.e.ShadersStore[I]||(r.e.ShadersStore[I]=d);const f={name:I,shader:d}},12926:(w,p,e)=>{"use strict";e.r(p),e.d(p,{FlowGraphGLTFDataProvider:()=>d});var r=e(12893),I=e(12872);class d extends r.e{constructor(w){var p,e;super();const r=w.glTF,d=(null===(p=r.animations)||void 0===p?void 0:p.map((w=>w._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",I.c,d);const f=(null===(e=r.nodes)||void 0===e?void 0:e.map((w=>w._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",I.c,f)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12810:(w,p,e)=>{"use strict";e.d(p,{b:()=>c,e:()=>K,g:()=>J,i:()=>y});var r=e(11023),I=e(11552),d=e(11308),f=e(12818);const q=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class E{constructor(w,p){this._gltf=w,this._infoTree=p}convert(w){let p,e=this._gltf,r=this._infoTree;if(!w.startsWith("/"))throw new Error("Path must start with a /");const I=w.split("/");if(I.shift(),I[I.length-1].includes(".length")){const w=I[I.length-1].split(".");I.pop(),I.push(...w)}let d=!1;for(const E of I){const I="length"===E;if(I&&!r.__array__)throw new Error(`Path ${w} is invalid`);if(r.__ignoreObjectTree__&&(d=!0),r.__array__&&!I)r=r.__array__;else if(r=r[E],!r)throw new Error(`Path ${w} is invalid`);if(!d)if(void 0===e){if(!q.find((p=>p.regex.test(w))))throw new Error(`Path ${w} is invalid`)}else if(!I){var f;e=null===(f=e)||void 0===f?void 0:f[E]}(r.__target__||I)&&(p=e)}return{object:p,info:r}}}function j(w,p,e,r){const I=X(w,p);return r?I[e][r]:I[e]}function X(w,p,e){var r,d;return null===(r=w._data)||void 0===r||null===(d=r[(null===e||void 0===e?void 0:e.fillMode)??I.c.MATERIAL_TriangleFillMode])||void 0===d?void 0:d.babylonMaterial}function k(w,p){return{offset:{componentsCount:2,type:"Vector2",get:(e,I,d)=>{const f=j(e,d,w,p);return new r.g(null===f||void 0===f?void 0:f.uOffset,null===f||void 0===f?void 0:f.vOffset)},getTarget:X,set:(e,r,I,d)=>{const f=j(r,d,w,p);f.uOffset=e.x,f.vOffset=e.y},getPropertyName:[()=>`${w}${p?"."+p:""}.uOffset`,()=>`${w}${p?"."+p:""}.vOffset`]},rotation:{type:"number",get:(e,r,I)=>{var d;return null===(d=j(e,I,w,p))||void 0===d?void 0:d.wAng},getTarget:X,set:(e,r,I,d)=>j(r,d,w,p).wAng=e,getPropertyName:[()=>`${w}${p?"."+p:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(e,I,d)=>{const f=j(e,d,w,p);return new r.g(null===f||void 0===f?void 0:f.uScale,null===f||void 0===f?void 0:f.vScale)},getTarget:X,set:(e,r,I,d)=>{const f=j(r,d,w,p);f.uScale=e.x,f.vScale=e.y},getPropertyName:[()=>`${w}${p?"."+p:""}.uScale`,()=>`${w}${p?"."+p:""}.vScale`]}}}const m={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:w=>{var p,e;return new r.g((null===(p=w._babylonCamera)||void 0===p?void 0:p.orthoLeft)??0,(null===(e=w._babylonCamera)||void 0===e?void 0:e.orthoRight)??0)},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.orthoLeft=w.x,p._babylonCamera.orthoRight=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:w=>{var p,e;return new r.g((null===(p=w._babylonCamera)||void 0===p?void 0:p.orthoBottom)??0,(null===(e=w._babylonCamera)||void 0===e?void 0:e.orthoTop)??0)},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.orthoBottom=w.x,p._babylonCamera.orthoTop=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.maxZ},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.ge},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.ge=w)},getTarget:w=>w,getPropertyName:[()=>"ge"]}},perspective:{aspectRatio:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.getEngine().getAspectRatio(w._babylonCamera)},getTarget:w=>w,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.fov},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.fov=w)},getTarget:w=>w,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.maxZ},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var p;return null===(p=w._babylonCamera)||void 0===p?void 0:p.ge},set:(w,p)=>{p._babylonCamera&&(p._babylonCamera.ge=w)},getTarget:w=>w,getPropertyName:[()=>"ge"]}}}},nodes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ne",get:w=>{var p;return null===(p=w._babylonTransformNode)||void 0===p?void 0:p.position},set:(w,p)=>{var e;return null===(e=p._babylonTransformNode)||void 0===e?void 0:e.position.X(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:w=>{var p;return null===(p=w._babylonTransformNode)||void 0===p?void 0:p.rotationQuaternion},set:(w,p)=>{var e,r;return null===(e=p._babylonTransformNode)||void 0===e||null===(r=e.rotationQuaternion)||void 0===r?void 0:r.X(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ne",get:w=>{var p;return null===(p=w._babylonTransformNode)||void 0===p?void 0:p.Ne},set:(w,p)=>{var e;return null===(e=p._babylonTransformNode)||void 0===e?void 0:e.Ne.X(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"Ne"]},weights:{length:{type:"number",get:w=>w._numMorphTargets,getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(w,p)=>{var e,r;return void 0!==p?null===(e=w._primitiveBabylonMeshes)||void 0===e||null===(r=e[0].morphTargetManager)||void 0===r?void 0:r.getTarget(p).influence:void 0},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(w,p)=>[0],getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:w=>{var p,e,I;return r.b.Compose(null===(p=w._babylonTransformNode)||void 0===p?void 0:p.Ne,null===(e=w._babylonTransformNode)||void 0===e?void 0:e.rotationQuaternion,null===(I=w._babylonTransformNode)||void 0===I?void 0:I.position)},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:w=>{var p,e,I,d;const f=r.b.Identity();let q=w.parent;for(;q&&q.parent;)q=q.parent;const E=(null===(p=w._babylonTransformNode)||void 0===p?void 0:p.position._isDirty)||(null===(e=w._babylonTransformNode)||void 0===e||null===(I=e.rotationQuaternion)||void 0===I?void 0:I._isDirty)||(null===(d=w._babylonTransformNode)||void 0===d?void 0:d.Ne._isDirty);if(q){var j;const p=null===(j=q._babylonTransformNode)||void 0===j?void 0:j.ke(!0).invert();var X,k;if(p)null===(X=w._babylonTransformNode)||void 0===X||null===(k=X.ke(E))||void 0===k||k.multiplyToRef(p,f)}else w._babylonTransformNode&&f.X(w._babylonTransformNode.ke(E));return f},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:w=>{var p,e;return null===(p=w._babylonTransformNode)||void 0===p||null===(e=p.getChildren((w=>w instanceof f.e),!0)[0])||void 0===e?void 0:e.Se},getTarget:w=>{var p;return null===(p=w._babylonTransformNode)||void 0===p?void 0:p.getChildren((w=>w instanceof f.e),!0)[0]},set:(w,p)=>{if(p._babylonTransformNode){const e=p._babylonTransformNode.getChildren((w=>w instanceof f.e),!0)[0];e&&(e.Se=w)}}},color:{type:"pd",get:w=>{var p,e;return null===(p=w._babylonTransformNode)||void 0===p||null===(e=p.getChildren((w=>w instanceof f.e),!0)[0])||void 0===e?void 0:e.br},getTarget:w=>{var p;return null===(p=w._babylonTransformNode)||void 0===p?void 0:p.getChildren((w=>w instanceof f.e),!0)[0]},set:(w,p)=>{if(p._babylonTransformNode){const e=p._babylonTransformNode.getChildren((w=>w instanceof f.e),!0)[0];e&&(e.br=w)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"pd",get:(w,p,e)=>X(w,p,e).emissiveColor,set:(w,p,e,r)=>X(p,e,r).emissiveColor.X(w),getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:k("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(w,p,e)=>{var r;return null===(r=j(w,e,"bumpTexture"))||void 0===r?void 0:r.level},set:(w,p,e,r)=>{const I=j(p,r,"bumpTexture");I&&(I.level=w)},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:k("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(w,p,e)=>X(w,p,e).ambientTextureStrength,set:(w,p,e,r)=>{const I=X(p,e,r);I&&(I.ambientTextureStrength=w)},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:k("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ed",get:(w,p,e)=>{const r=X(w,p,e);return d.e.FromColor3(r.albedoColor,r.alpha)},set:(w,p,e,r)=>{const I=X(p,e,r);I.albedoColor.set(w.r,w.g,w.b),I.alpha=w.a},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:k("albedoTexture")}},metallicFactor:{type:"number",get:(w,p,e)=>X(w,p,e).metallic,set:(w,p,e,r)=>{const I=X(p,e,r);I&&(I.metallic=w)},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(w,p,e)=>X(w,p,e).roughness,set:(w,p,e,r)=>{const I=X(p,e,r);I&&(I.roughness=w)},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:k("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(w,p,e)=>X(w,p,e).anisotropy.Se,set:(w,p,e,r)=>{X(p,e,r).anisotropy.Se=w},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(w,p,e)=>X(w,p,e).anisotropy.angle,set:(w,p,e,r)=>{X(p,e,r).anisotropy.angle=w},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:k("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(w,p,e)=>X(w,p,e).clearCoat.Se,set:(w,p,e,r)=>{X(p,e,r).clearCoat.Se=w},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(w,p,e)=>X(w,p,e).clearCoat.roughness,set:(w,p,e,r)=>{X(p,e,r).clearCoat.roughness=w},getTarget:(w,p,e)=>X(w,p,e),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:k("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(w,p,e)=>{var r;return null===(r=X(w,p,e).clearCoat.bumpTexture)||void 0===r?void 0:r.level},getTarget:X,set:(w,p,e,r)=>X(p,e,r).clearCoat.bumpTexture.level=w},extensions:{KHR_texture_transform:k("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:k("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(w,p,e)=>X(w,p,e).subSurface.dispersion,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.dispersion=w}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(w,p,e)=>X(w,p,e).emissiveIntensity,getTarget:X,set:(w,p,e,r)=>X(p,e,r).emissiveIntensity=w}},KHR_materials_ior:{ior:{type:"number",get:(w,p,e)=>X(w,p,e).indexOfRefraction,getTarget:X,set:(w,p,e,r)=>X(p,e,r).indexOfRefraction=w}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(w,p,e)=>X(w,p,e).iridescence.Se,getTarget:X,set:(w,p,e,r)=>X(p,e,r).iridescence.Se=w},iridescenceIor:{type:"number",get:(w,p,e)=>X(w,p,e).iridescence.indexOfRefraction,getTarget:X,set:(w,p,e,r)=>X(p,e,r).iridescence.indexOfRefraction=w},iridescenceTexture:{extensions:{KHR_texture_transform:k("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(w,p,e)=>X(w,p,e).iridescence.maximumThickness,getTarget:X,set:(w,p,e,r)=>X(p,e,r).iridescence.maximumThickness=w},iridescenceThicknessMinimum:{type:"number",get:(w,p,e)=>X(w,p,e).iridescence.minimumThickness,getTarget:X,set:(w,p,e,r)=>X(p,e,r).iridescence.minimumThickness=w},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:k("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"pd",get:(w,p,e)=>X(w,p,e).sheen.color,getTarget:X,set:(w,p,e,r)=>X(p,e,r).sheen.color.X(w)},sheenColorTexture:{extensions:{KHR_texture_transform:k("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(w,p,e)=>X(w,p,e).sheen.Se,getTarget:X,set:(w,p,e,r)=>X(p,e,r).sheen.Se=w},sheenRoughnessTexture:{extensions:{KHR_texture_transform:k("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(w,p,e)=>X(w,p,e).metallicF0Factor,getTarget:X,set:(w,p,e,r)=>X(p,e,r).metallicF0Factor=w,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"pd",get:(w,p,e)=>X(w,p,e).metallicReflectanceColor,getTarget:X,set:(w,p,e,r)=>X(p,e,r).metallicReflectanceColor.X(w),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:k("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:k("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(w,p,e)=>X(w,p,e).subSurface.refractionIntensity,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.refractionIntensity=w,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(w,p,e)=>X(w,p,e).subSurface.translucencyIntensity,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.translucencyIntensity=w},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"pd",get:(w,p,e)=>X(w,p,e).subSurface.translucencyColor,getTarget:X,set:(w,p,e,r)=>{var I;return w&&(null===(I=X(p,e,r).subSurface.translucencyColor)||void 0===I?void 0:I.X(w))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"pd",get:(w,p,e)=>X(w,p,e).subSurface.tintColor,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.tintColor.X(w)},attenuationDistance:{type:"number",get:(w,p,e)=>X(w,p,e).subSurface.tintColorAtDistance,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.tintColorAtDistance=w},thicknessFactor:{type:"number",get:(w,p,e)=>X(w,p,e).subSurface.maximumThickness,getTarget:X,set:(w,p,e,r)=>X(p,e,r).subSurface.maximumThickness=w},thicknessTexture:{extensions:{KHR_texture_transform:k("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,color:{type:"pd",get:w=>{var p;return null===(p=w._babylonLight)||void 0===p?void 0:p.br},set:(w,p)=>{var e;return null===(e=p._babylonLight)||void 0===e?void 0:e.br.X(w)},getTarget:w=>w._babylonLight,getPropertyName:[w=>"diffuse"]},Se:{type:"number",get:w=>{var p;return null===(p=w._babylonLight)||void 0===p?void 0:p.Se},set:(w,p)=>p._babylonLight?p._babylonLight.Se=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"intensity"]},range:{type:"number",get:w=>{var p;return null===(p=w._babylonLight)||void 0===p?void 0:p.range},set:(w,p)=>p._babylonLight?p._babylonLight.range=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"range"]},spot:{innerConeAngle:{type:"number",get:w=>{var p;return null===(p=w._babylonLight)||void 0===p?void 0:p.innerAngle},set:(w,p)=>p._babylonLight?p._babylonLight.innerAngle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"innerConeAngle"]},outerConeAngle:{type:"number",get:w=>{var p;return null===(p=w._babylonLight)||void 0===p?void 0:p.angle},set:(w,p)=>p._babylonLight?p._babylonLight.angle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTexture)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,Se:{type:"number",get:w=>{var p;return null===(p=w._babylonTexture)||void 0===p?void 0:p.level},set:(w,p)=>{p._babylonTexture&&(p._babylonTexture.level=w)},getTarget:w=>w._babylonTexture},rotation:{type:"Quaternion",get:w=>{var p;return w._babylonTexture&&r.c.FromRotationMatrix(null===(p=w._babylonTexture)||void 0===p?void 0:p.getReflectionTextureMatrix())},set:(w,p)=>{var e;p._babylonTexture&&(null!==(e=p._babylonTexture.iw())&&void 0!==e&&e.useRightHandedSystem||(w=r.c.Inverse(w)),r.b.FromQuaternionToRef(w,p._babylonTexture.getReflectionTextureMatrix()))},getTarget:w=>w._babylonTexture}}}}},animations:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>{var p;return null===(p=w.primitives[0]._instanceData)||void 0===p?void 0:p.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function J(w){return new E(w,m)}function K(w){const p=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let e=m;for(const r of p)r&&(e=e[r]);if(e&&e.type&&e.get)return e}function y(w,p){const e=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let r=m;for(const I of e)I&&(r=r[I]);r&&r.type&&r.get&&(r.interpolation=p)}function c(w,p){const e=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let r=m;for(const I of e)if(I){if(!r[I]){if("?"===I){r.__ignoreObjectTree__=!0;continue}r[I]={},"__array__"===I&&(r[I].__target__=!0)}r=r[I]}Object.assign(r,p)}},12821:(w,p,e)=>{"use strict";e.r(p),e.d(p,{AnimationPropertyInfo:()=>j,TransformNodeAnimationPropertyInfo:()=>X,WeightAnimationPropertyInfo:()=>k,getQuaternion:()=>q,getVector3:()=>f,getWeights:()=>E});var r=e(11713),I=e(11023),d=e(12810);function f(w,p,e,r){return I.k.Ve(p,e).scaleInPlace(r)}function q(w,p,e,r){return I.c.Ve(p,e).scaleInPlace(r)}function E(w,p,e,r){const I=new Array(w._numMorphTargets);for(let d=0;d<I.length;d++)I[d]=p[e++]*r;return I}class j{constructor(w,p,e,r){this.type=w,this.name=p,this.getValue=e,this.getStride=r}_buildAnimation(w,p,e){const I=new r.c(w,this.name,p,this.type);return I.setKeys(e),I}}class X extends j{buildAnimations(w,p,e,r){const I=[];return I.push({babylonAnimatable:w._babylonTransformNode,babylonAnimation:this._buildAnimation(p,e,r)}),I}}class k extends j{buildAnimations(w,p,e,I){const d=[];if(w._numMorphTargets)for(let f=0;f<w._numMorphTargets;f++){const q=new r.c(`${p}_${f}`,this.name,e,this.type);if(q.setKeys(I.map((w=>({frame:w.frame,inTangent:w.inTangent?w.inTangent[f]:void 0,value:w.value[f],outTangent:w.outTangent?w.outTangent[f]:void 0,interpolation:w.interpolation})))),w._primitiveBabylonMeshes)for(const p of w._primitiveBabylonMeshes)if(p.morphTargetManager){const w=p.morphTargetManager.getTarget(f),e=q.clone();w.animations.push(e),d.push({babylonAnimatable:w,babylonAnimation:e})}}return d}}(0,d.i)("/nodes/{}/translation",[new X(r.c.ANIMATIONTYPE_VECTOR3,"position",f,(()=>3))]),(0,d.i)("/nodes/{}/rotation",[new X(r.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",q,(()=>4))]),(0,d.i)("/nodes/{}/scale",[new X(r.c.ANIMATIONTYPE_VECTOR3,"Ne",f,(()=>3))]),(0,d.i)("/nodes/{}/weights",[new k(r.c.ANIMATIONTYPE_FLOAT,"influence",E,(w=>w._numMorphTargets))])},12774:(w,p,e)=>{"use strict";class r{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((w,p)=>{this._resolve=w,this._reject=p}))}}var I=e(11023),d=e(11308),f=e(11071),q=e(11374),E=e(12777),j=e(12794),X=e(11056),k=e(11546),m=e(11713),J=e(11716),K=e(11051),y=e(11081),c=e(11086);class s{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(w){this._useTextureToStoreBoneMatrices=w,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(w,p,e){this.name=w,this.id=p,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=I.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new X.d,this.bones=[],this._scene=e||K.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((w=>!w.getParent()))}getTransformMatrices(w){if(this.needInitialSkinMatrix){if(!w)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return w._bonesTransformMatrices||this.prepare(!0),w._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(w){return this.needInitialSkinMatrix&&w._transformMatrixTexture?w._transformMatrixTexture:this._transformMatrixTexture}iw(){return this._scene}toString(w){let p=`Name: ${this.name}, nBones: ${this.bones.length}`;if(p+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,w){p+=", Ranges: {";let w=!0;for(const e in this._ranges)w&&(p+=", ",w=!1),p+=e;p+="}"}return p}getBoneIndexByName(w){for(let p=0,e=this.bones.length;p<e;p++)if(this.bones[p].name===w)return p;return-1}createAnimationRange(w,p,e){if(!this._ranges[w]){this._ranges[w]=new J.c(w,p,e);for(let r=0,I=this.bones.length;r<I;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(w,p,e)}}deleteAnimationRange(w){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let e=0,r=this.bones.length;e<r;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].deleteRange(w,p);this._ranges[w]=null}getAnimationRange(w){return this._ranges[w]||null}getAnimationRanges(){const w=[];let p;for(p in this._ranges)w.push(this._ranges[p]);return w}copyAnimationRange(w,p){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[p]||!w.getAnimationRange(p))return!1;let r=!0;const I=this._getHighestAnimationFrame()+1,d={},f=w.bones;let q,E;for(E=0,q=f.length;E<q;E++)d[f[E].name]=f[E];this.bones.length!==f.length&&(y.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${f.length}`),r=!1);const j=e&&this.dimensionsAtRest&&w.dimensionsAtRest?this.dimensionsAtRest.divide(w.dimensionsAtRest):null;for(E=0,q=this.bones.length;E<q;E++){const w=this.bones[E].name,f=d[w];f?r=r&&this.bones[E].copyAnimationRange(f,p,I,e,j):(y.c.Warn("copyAnimationRange: not same rig, missing source bone "+w),r=!1)}const X=w.getAnimationRange(p);return X&&(this._ranges[p]=new J.c(p,X.from+I,X.to+I)),r}returnToRest(){for(const w of this.bones)-1!==w._index&&w.returnToRest()}_getHighestAnimationFrame(){let w=0;for(let p=0,e=this.bones.length;p<e;p++)if(this.bones[p].animations[0]){const e=this.bones[p].animations[0].getHighestFrame();w<e&&(w=e)}return w}beginAnimation(w,p,e,r){const I=this.getAnimationRange(w);return I?this._scene.beginAnimation(this,I.from,I.to,p,e,r):null}static MakeAnimationAdditive(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const r=w.getAnimationRange(e);if(!r)return null;const I=w._scene.getAllAnimatablesByTarget(w);let d=null;for(let q=0;q<I.length;q++){const w=I[q];if(w.fromFrame===(null===r||void 0===r?void 0:r.from)&&w.toFrame===(null===r||void 0===r?void 0:r.to)){d=w;break}}const f=w.getAnimatables();for(let q=0;q<f.length;q++){const w=f[q].animations;if(w)for(let r=0;r<w.length;r++)m.c.MakeAnimationAdditive(w[r],p,e)}return d&&(d.isAdditive=!0),w}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(w){this._meshesWithPoseMatrix.push(w)}_unregisterMeshWithPoseMatrix(w){const p=this._meshesWithPoseMatrix.indexOf(w);p>-1&&this._meshesWithPoseMatrix.splice(p,1)}_computeTransformMatrices(w,p){this.onBeforeComputeObservable.notifyObservers(this);for(let e=0;e<this.bones.length;e++){const r=this.bones[e];r._childUpdateId++;const I=r.getParent();if(I?r.getLocalMatrix().multiplyToRef(I.getFinalMatrix(),r.getFinalMatrix()):p?r.getLocalMatrix().multiplyToRef(p,r.getFinalMatrix()):r.getFinalMatrix().X(r.getLocalMatrix()),-1!==r._index){const p=null===r._index?e:r._index;r.getAbsoluteInverseBindMatrix().multiplyToArray(r.getFinalMatrix(),w,16*p)}}this._identity.copyToArray(w,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const w=this.iw().getRenderId();if(this._currentRenderId===w)return;this._currentRenderId=w}if(this._numBonesWithLinkedTransformNode>0)for(const w of this.bones)if(w._linkedTransformNode){const p=w._linkedTransformNode;w.position=p.position,p.rotationQuaternion?w.rotationQuaternion=p.rotationQuaternion:w.rotation=p.rotation,w.Ne=p.Ne}if(this.needInitialSkinMatrix)for(const w of this._meshesWithPoseMatrix){const p=w.getPoseMatrix();let e=this._isDirty;if(w._bonesTransformMatrices&&w._bonesTransformMatrices.length===16*(this.bones.length+1)||(w._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),e=!0),e){if(this._synchronizedWithMesh!==w){this._synchronizedWithMesh=w;for(const w of this.bones)if(!w.getParent()){w.getBindMatrix().multiplyToRef(p,I.d.Matrix[1]),w._updateAbsoluteBindMatrices(I.d.Matrix[1])}if(this.isUsingTextureForMatrices){const p=4*(this.bones.length+1);w._transformMatrixTexture&&w._transformMatrixTexture.getSize().width===p||(w._transformMatrixTexture&&w._transformMatrixTexture.dispose(),w._transformMatrixTexture=k.b.CreateRGBATexture(w._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(w._bonesTransformMatrices,p),this.isUsingTextureForMatrices&&w._transformMatrixTexture&&w._transformMatrixTexture.update(w._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=k.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let w=0;w<this.bones.length;w++)this._animatables.push(this.bones[w])}return this._animatables}clone(w,p){const e=new s(w,p||w,this._scene);e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let r=0;r<this.bones.length;r++){const w=this.bones[r];let p=null;const I=w.getParent();if(I){const w=this.bones.indexOf(I);p=e.bones[w]}const d=new j.e(w.name,e,p,w.getBindMatrix().clone(),w.getRestMatrix().clone());d._index=w._index,w._linkedTransformNode&&d.linkTransformNode(w._linkedTransformNode),c.d.DeepCopy(w.animations,d.animations)}if(this._ranges){e._ranges={};for(const w in this._ranges){const p=this._ranges[w];p&&(e._ranges[w]=p.clone())}}return this._isDirty=!0,e.prepare(!0),e}enableBlending(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const p of this.bones)for(const e of p.animations)e.enableBlending=!0,e.blendingSpeed=w}dispose(){if(this._meshesWithPoseMatrix.length=0,this.iw().stopAnimation(this),this.iw().removeSkeleton(this),this._parentContainer){const w=this._parentContainer.skeletons.indexOf(this);w>-1&&this._parentContainer.skeletons.splice(w,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const w={};w.name=this.name,w.id=this.id,this.dimensionsAtRest&&(w.dimensionsAtRest=this.dimensionsAtRest.ze()),w.bones=[],w.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){var p;const r=this.bones[e],I=r.getParent(),d={parentBoneIndex:I?this.bones.indexOf(I):-1,index:r.getIndex(),name:r.name,id:r.id,matrix:r.getBindMatrix().ze(),rest:r.getRestMatrix().ze(),linkedTransformNodeId:null===(p=r.getTransformNode())||void 0===p?void 0:p.id};w.bones.push(d),r.length&&(d.length=r.length),r.metadata&&(d.metadata=r.metadata),r.animations&&r.animations.length>0&&(d.animation=r.animations[0].serialize()),w.ranges=[];for(const p in this._ranges){const e=this._ranges[p];if(!e)continue;const r={};r.name=p,r.from=e.from,r.to=e.to,w.ranges.push(r)}}return w}static Parse(w,p){const e=new s(w.name,w.id,p);let r;for(w.dimensionsAtRest&&(e.dimensionsAtRest=I.k.Ve(w.dimensionsAtRest)),e.needInitialSkinMatrix=w.needInitialSkinMatrix,r=0;r<w.bones.length;r++){const p=w.bones[r],d=w.bones[r].index;let f=null;p.parentBoneIndex>-1&&(f=e.bones[p.parentBoneIndex]);const q=p.rest?I.b.Ve(p.rest):null,E=new j.e(p.name,e,f,I.b.Ve(p.matrix),q,null,d);void 0!==p.id&&null!==p.id&&(E.id=p.id),p.length&&(E.length=p.length),p.metadata&&(E.metadata=p.metadata),p.animation&&E.animations.push(m.c.Parse(p.animation)),void 0!==p.linkedTransformNodeId&&null!==p.linkedTransformNodeId&&(e._hasWaitingData=!0,E._waitingTransformNodeId=p.linkedTransformNodeId)}if(w.ranges)for(r=0;r<w.ranges.length;r++){const p=w.ranges[r];e.createAnimationRange(p.name,p.from,p.to)}return e}computeAbsoluteMatrices(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||w)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(w)}getPoseMatrix(){let w=null;return this._meshesWithPoseMatrix.length>0&&(w=this._meshesWithPoseMatrix[0].getPoseMatrix()),w}sortBones(){const w=[],p=new Array(this.bones.length);for(let e=0;e<this.bones.length;e++)this._sortBones(e,w,p);this.bones=w}_sortBones(w,p,e){if(e[w])return;e[w]=!0;const r=this.bones[w];if(!r)return;void 0===r._index&&(r._index=w);const I=r.getParent();I&&this._sortBones(this.bones.indexOf(I),p,e),p.push(r)}setCurrentPoseAsRest(){for(const w of this.bones)w.setCurrentPoseAsRest()}}var O=e(11203),a=e(11564),A=e(11511),z=e(11325),M=e(11232),i=e(11391),t=e(11333),n=e(11370),l=e(11723),N=e(11376),U=e(12733);class v{set areUpdatesFrozen(w){w?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new N.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,w||(w=K.d.LastCreatedScene),this._scene=w,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const w=this._scene.getEngine().getCaps();this._canUseTextureForTargets=w.canUseGLVertexID&&w.textureFloat&&w.maxVertexTextureImageUnits>0&&w.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return v.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?v.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(w){this._numMaxInfluencers!==w&&(this._numMaxInfluencers=w,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(w){this._useTextureToStoreTargets!==w&&(this._useTextureToStoreTargets=w,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var w;return v.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(w=this._scene)&&void 0!==w&&w.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(w){return this._activeTargets.data[w]}getTarget(w){return this._targets[w]}getTargetByName(w){for(const p of this._targets)if(p.name===w)return p;return null}addTarget(w){this._targets.push(w),this._targetInfluenceChangedObservers.push(w.onInfluenceChanged.add((w=>{this.areUpdatesFrozen&&w&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(w)}))),this._targetDataLayoutChangedObservers.push(w._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(w){const p=this._targets.indexOf(w);p>=0&&(this._targets.splice(p,1),w.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(p,1)[0]),w._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(p,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(w)}_bind(w){w.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),w.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),w.setTexture("morphTargets",this._targetStoreTexture),w.setInt("morphTargetCount",this.numInfluencers)}clone(){const w=new v(this._scene);for(const p of this._targets)w.addTarget(p.clone());return w.enablePositionMorphing=this.enablePositionMorphing,w.enableNormalMorphing=this.enableNormalMorphing,w.enableTangentMorphing=this.enableTangentMorphing,w.enableUVMorphing=this.enableUVMorphing,w.enableUV2Morphing=this.enableUV2Morphing,w.enableColorMorphing=this.enableColorMorphing,w}serialize(){const w={};w.id=this.uniqueId,w.targets=[];for(const p of this._targets)w.targets.push(p.serialize());return w}_syncActiveTargets(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const p=!!this._targetStoreTexture,e=this.isUsingTextureForTargets;(this._mustSynchronize||p!==e)&&(this._mustSynchronize=!1,this.synchronize());let r=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let I=-1;for(const d of this._targets)if(I++,0!==d.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=v.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(d),this._morphTargetTextureIndices[r]=I,this._tempInfluences[r++]=d.influence}this._morphTargetTextureIndices.length!==r&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,r)),this._influences&&this._influences.length===r||(this._influences=new Float32Array(r));for(let d=0;d<r;d++)this._influences[d]=this._tempInfluences[d];if(w&&this._scene)for(const d of this._scene.meshes)d.morphTargetManager===this&&(e?d._markSubMeshesAsAttributesDirty():d._syncGeometryWithMorphTargetManager())}synchronize(){var w;if(!this._scene||this.areUpdatesFrozen)return;const p=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(w=this._targetStoreTexture)||void 0===w||w.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>p.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const e of this._targets){this._supportsPositions=this._supportsPositions&&e.hasPositions,this._supportsNormals=this._supportsNormals&&e.hasNormals,this._supportsTangents=this._supportsTangents&&e.hasTangents,this._supportsUVs=this._supportsUVs&&e.hasUVs,this._supportsUV2s=this._supportsUV2s&&e.hasUV2s,this._supportsColors=this._supportsColors&&e.hasColors;const w=e.vertexCount;if(0===this._vertexCount)this._vertexCount=w;else if(this._vertexCount!==w)return void y.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${e.name}": ${w}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const w=p.getCaps().maxTextureSize;this._textureWidth>w&&(this._textureHeight=Math.ceil(this._textureWidth/w),this._textureWidth=w);const e=this._targets.length,r=new Float32Array(e*this._textureWidth*this._textureHeight*4);let I=0;for(let p=0;p<e;p++){const w=this._targets[p],e=w.getPositions(),d=w.getNormals(),f=w.getUVs(),q=w.getTangents(),E=w.getUV2s(),j=w.getColors();I=p*this._textureWidth*this._textureHeight*4;for(let p=0;p<this._vertexCount;p++)this._supportsPositions&&e&&(r[I]=e[3*p],r[I+1]=e[3*p+1],r[I+2]=e[3*p+2],I+=4),this._supportsNormals&&d&&(r[I]=d[3*p],r[I+1]=d[3*p+1],r[I+2]=d[3*p+2],I+=4),this._supportsUVs&&f&&(r[I]=f[2*p],r[I+1]=f[2*p+1],I+=4),this._supportsTangents&&q&&(r[I]=q[3*p],r[I+1]=q[3*p+1],r[I+2]=q[3*p+2],I+=4),this._supportsUV2s&&E&&(r[I]=E[2*p],r[I+1]=E[2*p+1],I+=4),this._supportsColors&&j&&(r[I]=j[4*p],r[I+1]=j[4*p+1],r[I+2]=j[4*p+2],r[I+3]=j[4*p+3],I+=4)}this._targetStoreTexture=U.e.CreateRGBATexture(r,this._textureWidth,this._textureHeight,e,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const e of this._scene.meshes)e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const w=this._parentContainer.morphTargetManagers.indexOf(this);w>-1&&this._parentContainer.morphTargetManagers.splice(w,1),this._parentContainer=null}for(const w of this._targets)this._scene.stopAnimation(w)}}static Parse(w,p){const e=new v(p);for(const r of w.targets)e.addTarget(l.e.Parse(r,p));return e}}v.EnableTextureStorage=!0,v.MaxActiveMorphTargetsInVertexAttributeMode=8,v.ConstantTargetCountForTextureMode=0;var R=e(12796),V=e(11107),b=e(11265);const h=new Map,P=h;function u(w,p,e){Y(w)&&y.c.Warn(`Extension with the name '${w}' already exists`),h.set(w,{isGLTFExtension:p,factory:e})}function Y(w){return h.delete(w)}var L=e(12810),W=e(11778),F=e(11247);class H{static Get(w,p,e){if(!p||void 0==e||!p[e])throw new Error(`${w}: Failed to find index (${e})`);return p[e]}static TryGet(w,p){return w&&void 0!=p&&w[p]?w[p]:null}static Assign(w){if(w)for(let p=0;p<w.length;p++)w[p].index=p}}function B(w){if(w.min&&w.max){const p=w.min,e=w.max,r=I.d.ne[0].te(p[0],p[1],p[2]),d=I.d.ne[1].te(e[0],e[1],e[2]);if(w.normalized&&5126!==w.componentType){let p=1;switch(w.componentType){case 5120:p=127;break;case 5121:p=255;break;case 5122:p=32767;break;case 5123:p=65535}const e=1/p;r.scaleInPlace(e),d.scaleInPlace(e)}return new b.b(r,d)}return null}class D{static RegisterExtension(w,p){u(w,!1,p)}static UnregisterExtension(w){return Y(w)}get Ge(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(w){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=w}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((w=>w.dispose&&w.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(w,p,e,r,I,d){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=p,this._assetContainer=e,this._loadData(r);let d=null;if(w){const p={};if(this._gltf.nodes)for(const w of this._gltf.nodes)w.name&&(p[w.name]=w.index);d=(w instanceof Array?w:[w]).map((w=>{const e=p[w];if(void 0===e)throw new Error(`Failed to find node '${w}'`);return e}))}return await this._loadAsync(I,f,d,(()=>({meshes:this._getMeshes(),tm:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=w,this._loadData(p),await this._loadAsync(e,I,null,(()=>{}))}async _loadAsync(w,p,e,r){return await Promise.resolve().then((async()=>{this._rootUrl=w,this._uniqueRootUrl=!w.startsWith("file:")&&p?w:`${w}${Date.now()}/`,this._fileName=p,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const I=`${R.l[R.l.LOADING]} => ${R.l[R.l.READY]}`,d=`${R.l[R.l.LOADING]} => ${R.l[R.l.COMPLETE]}`;this._parent._startPerformanceCounter(I),this._parent._startPerformanceCounter(d),this._parent._setState(R.l.LOADING),this._extensionsOnLoading();const q=new Array;if(!this.parent.loadOnlyMaterials)if(e)q.push(this.loadSceneAsync("/nodes",{nodes:e,index:-1}));else if(void 0!=this._gltf.yp||this._gltf.scenes&&this._gltf.scenes[0]){const w=H.Get("/scene",this._gltf.scenes,this._gltf.yp||0);q.push(this.loadSceneAsync(`/scenes/${w.index}`,w))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let w=0;w<this._gltf.materials.length;++w){const p=this._gltf.materials[w],e="/materials/"+w,r=O.b.TriangleFillMode;q.push(this._loadMaterialAsync(e,p,null,r,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&q.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&q.push(this._compileShadowGeneratorsAsync());const E=Promise.all(q).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.yE(!0);for(const w of this._babylonScene.materials){const p=w;void 0!==p.maxSimultaneousLights&&(p.maxSimultaneousLights=Math.max(p.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(R.l.READY),this._skipStartAnimationStep||this._startAnimations(),r()}));return await E.then((w=>(this._parent._endPerformanceCounter(I),f.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(d),this._parent._setState(R.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(w=>{this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()}))})),w)))})).catch((w=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()),w}))}_loadData(w){if(this._gltf=w.json,this._setupData(),w.bin){const p=this._gltf.buffers;if(p&&p[0]&&!p[0].uri){const e=p[0];(e.byteLength<w.bin.byteLength-3||e.byteLength>w.bin.byteLength)&&y.c.Warn(`Binary buffer length (${e.byteLength}) from JSON does not match chunk length (${w.bin.byteLength})`),this._bin=w.bin}else y.c.Warn("Unexpected BIN chunk")}}_setupData(){if(H.Assign(this._gltf.accessors),H.Assign(this._gltf.animations),H.Assign(this._gltf.buffers),H.Assign(this._gltf.bufferViews),H.Assign(this._gltf.cameras),H.Assign(this._gltf.images),H.Assign(this._gltf.materials),H.Assign(this._gltf.meshes),H.Assign(this._gltf.nodes),H.Assign(this._gltf.samplers),H.Assign(this._gltf.scenes),H.Assign(this._gltf.skins),H.Assign(this._gltf.textures),this._gltf.nodes){const w={};for(const e of this._gltf.nodes)if(e.children)for(const p of e.children)w[p]=e.index;const p=this._createRootNode();for(const e of this._gltf.nodes){const r=w[e.index];e.parent=void 0===r?p:this._gltf.nodes[r]}}}async _loadExtensionsAsync(){const w=[];if(P.forEach(((p,e)=>{var r;!1===(null===(r=this.parent.extensionOptions[e])||void 0===r?void 0:r.enabled)?p.isGLTFExtension&&this.isExtensionUsed(e)&&y.c.Warn(`Extension ${e} is used but has been explicitly disabled.`):p.isGLTFExtension&&!this.isExtensionUsed(e)||w.push((async()=>{const w=await p.factory(this);return w.name!==e&&y.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${w.name} !== ${e}`),this._parent.onExtensionLoadedObservable.notifyObservers(w),w})())})),this._extensions.push(...await Promise.all(w)),this._extensions.sort(((w,p)=>(w.order||Number.MAX_VALUE)-(p.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((w=>w.name===e&&w.enabled))){var p;if(!1===(null===(p=this.parent.extensionOptions[e])||void 0===p?void 0:p.enabled))throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new n.c("__root__",this._babylonScene);this._rootBabylonMesh=w,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.yE(!1);const p={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case R.h.AUTO:this._babylonScene.useRightHandedSystem||(p.rotation=[0,1,0,0],p.scale=[1,1,-1],D._LoadTransform(p,this._rootBabylonMesh));break;case R.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(w),p}loadSceneAsync(w,p){const e=this._extensionsLoadSceneAsync(w,p);if(e)return e;const r=new Array;if(this.logOpen(`${w} ${p.name||""}`),p.nodes)for(const I of p.nodes){const p=H.Get(`${w}/nodes/${I}`,this._gltf.nodes,I);r.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(w=>{w.parent=this._rootBabylonMesh})))}for(const I of this._postSceneLoadActions)I();return r.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(r).then((()=>{}))}_forEachPrimitive(w,p){if(w._primitiveBabylonMeshes)for(const e of w._primitiveBabylonMeshes)p(e)}_getGeometries(){const w=[],p=this._gltf.nodes;if(p)for(const e of p)this._forEachPrimitive(e,(p=>{const e=p.me;e&&-1===w.indexOf(e)&&w.push(e)}));return w}_getMeshes(){const w=[];this._rootBabylonMesh instanceof t.b&&w.push(this._rootBabylonMesh);const p=this._gltf.nodes;if(p)for(const e of p)this._forEachPrimitive(e,(p=>{w.push(p)}));return w}_getTransformNodes(){const w=[],p=this._gltf.nodes;if(p)for(const e of p)e._babylonTransformNode&&"dd"===e._babylonTransformNode.getClassName()&&w.push(e._babylonTransformNode),e._babylonTransformNodeForSkin&&w.push(e._babylonTransformNodeForSkin);return w}_getSkeletons(){const w=[],p=this._gltf.skins;if(p)for(const e of p)e._data&&w.push(e._data.babylonSkeleton);return w}_getAnimationGroups(){const w=[],p=this._gltf.animations;if(p)for(const e of p)e._babylonAnimationGroup&&w.push(e._babylonAnimationGroup);return w}_startAnimations(){switch(this._parent.animationStartMode){case R.f.NONE:break;case R.f.FIRST:{const w=this._getAnimationGroups();0!==w.length&&w[0].start(!0);break}case R.f.ALL:{const w=this._getAnimationGroups();for(const p of w)p.start(!0);break}default:return void y.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const r=this._extensionsLoadNodeAsync(w,p,e);if(r)return r;if(p._babylonTransformNode)throw new Error(`${w}: Invalid recursive node hierarchy`);const I=new Array;this.logOpen(`${w} ${p.name||""}`);const d=r=>{if(D.AddPointerMetadata(r,w),D._LoadTransform(p,r),void 0!=p.camera){const e=H.Get(`${w}/camera`,this._gltf.cameras,p.camera);I.push(this.loadCameraAsync(`/cameras/${e.index}`,e,(w=>{w.parent=r,this._babylonScene.useRightHandedSystem||(r.Ne.x=-1)})))}if(p.children)for(const e of p.children){const p=H.Get(`${w}/children/${e}`,this._gltf.nodes,e);I.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(w=>{w.parent=r})))}e(r)},f=void 0!=p.mesh,q=this._parent.loadSkins&&void 0!=p.skin;if(!f||q){const w=p.name||`node${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new z.e(w,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==p.mesh?p._babylonTransformNode=e:p._babylonTransformNodeForSkin=e,d(e)}if(f)if(q){const e=H.Get(`${w}/mesh`,this._gltf.meshes,p.mesh);I.push(this._loadMeshAsync(`/meshes/${e.index}`,p,e,(e=>{const r=p._babylonTransformNodeForSkin;e.metadata=(0,W.c)(r.metadata,e.metadata||{});const d=H.Get(`${w}/skin`,this._gltf.skins,p.skin);I.push(this._loadSkinAsync(`/skins/${d.index}`,p,d,(w=>{this._forEachPrimitive(p,(p=>{p.skeleton=w})),this._postSceneLoadActions.push((()=>{if(void 0!=d.skeleton){const w=H.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;p.index===w.index?e.parent=r.parent:e.parent=w._babylonTransformNode}else e.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:r,skinnedNode:e})}))})))})))}else{const e=H.Get(`${w}/mesh`,this._gltf.meshes,p.mesh);I.push(this._loadMeshAsync(`/meshes/${e.index}`,p,e,d))}return this.logClose(),Promise.all(I).then((()=>(this._forEachPrimitive(p,(w=>{const p=w;!p.isAnInstance&&p.me&&p.me.useBoundingInfoFromGeometry?w.hw():w.refreshBoundingInfo(!0,!0)})),p._babylonTransformNode)))}_loadMeshAsync(w,p,e,r){const I=e.primitives;if(!I||!I.length)throw new Error(`${w}: Primitives are missing`);void 0==I[0].index&&H.Assign(I);const d=new Array;this.logOpen(`${w} ${e.name||""}`);const f=p.name||`node${p.index}`;if(1===I.length){const r=e.primitives[0];d.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${r.index}`,f,p,e,r,(w=>{p._babylonTransformNode=w,p._primitiveBabylonMeshes=[w]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,p._babylonTransformNode=new z.e(f,this._babylonScene),p._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._primitiveBabylonMeshes=[];for(const r of I)d.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${r.index}`,`${f}_primitive${r.index}`,p,e,r,(w=>{w.parent=p._babylonTransformNode,p._primitiveBabylonMeshes.push(w)})))}return r(p._babylonTransformNode),this.logClose(),Promise.all(d).then((()=>p._babylonTransformNode))}_loadMeshPrimitiveAsync(w,p,e,r,I,d){const f=this._extensionsLoadMeshPrimitiveAsync(w,p,e,r,I,d);if(f)return f;this.logOpen(`${w}`);const q=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==e.skin&&!r.primitives[0].targets;let E,j;if(q&&I._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,E=I._instanceData.babylonSourceMesh.createInstance(p),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j=I._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new n.c(p,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.sideOrientation=this._babylonScene.useRightHandedSystem?O.b.CounterClockWiseSideOrientation:O.b.ClockWiseSideOrientation,this._createMorphTargets(w,e,r,I,f),d.push(this._loadVertexDataAsync(w,I,f).then((async p=>await this._loadMorphTargetsAsync(w,I,f,p).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,p.Vw(f),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const X=D._GetDrawMode(w,I.mode);if(void 0==I.material){let w=this._defaultBabylonMaterialData[X];w||(w=this._createDefaultMaterial("__GLTFLoader._default",X),this._parent.onMaterialLoadedObservable.notifyObservers(w),this._defaultBabylonMaterialData[X]=w),f.material=w}else if(!this.parent.skipMaterials){const p=H.Get(`${w}/material`,this._gltf.materials,I.material);d.push(this._loadMaterialAsync(`/materials/${p.index}`,p,f,X,(w=>{f.material=w})))}j=Promise.all(d),q&&(I._instanceData={babylonSourceMesh:f,promise:j}),E=f}return D.AddPointerMetadata(E,w),this._parent.onMeshLoadedObservable.notifyObservers(E),d(E),this.logClose(),j.then((()=>E))}_loadVertexDataAsync(w,p,e){const r=this._extensionsLoadVertexDataAsync(w,p,e);if(r)return r;const I=p.attributes;if(!I)throw new Error(`${w}: Attributes are missing`);const d=new Array,f=new i.d(e.name,this._babylonScene);if(void 0==p.indices)e.isUnIndexed=!0;else{const e=H.Get(`${w}/indices`,this._gltf.accessors,p.indices);d.push(this._loadIndicesAccessorAsync(`/accessors/${e.index}`,e).then((w=>{f.setIndices(w)})))}const q=(p,r,q)=>{if(void 0==I[p])return;e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(r)&&e._delayInfo.push(r);const E=H.Get(`${w}/attributes/${p}`,this._gltf.accessors,I[p]);d.push(this._loadVertexAccessorAsync(`/accessors/${E.index}`,E,r).then((w=>{if(w.getKind()===M.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!e.skeleton){const w=B(E);w&&(f._boundingInfo=w,f.useBoundingInfoFromGeometry=!0)}f.setVerticesBuffer(w,E.count)}))),r==M.e.MatricesIndicesExtraKind&&(e.numBoneInfluencers=8),q&&q(E)};return q("POSITION",M.e.PositionKind),q("NORMAL",M.e.NormalKind),q("TANGENT",M.e.TangentKind),q("TEXCOORD_0",M.e.UVKind),q("TEXCOORD_1",M.e.UV2Kind),q("TEXCOORD_2",M.e.UV3Kind),q("TEXCOORD_3",M.e.UV4Kind),q("TEXCOORD_4",M.e.UV5Kind),q("TEXCOORD_5",M.e.UV6Kind),q("JOINTS_0",M.e.MatricesIndicesKind),q("WEIGHTS_0",M.e.MatricesWeightsKind),q("JOINTS_1",M.e.MatricesIndicesExtraKind),q("WEIGHTS_1",M.e.MatricesWeightsExtraKind),q("COLOR_0",M.e.ColorKind,(w=>{"VEC4"===w.type&&(e.hasVertexAlpha=!0)})),Promise.all(d).then((()=>f))}_createMorphTargets(w,p,e,r,I){if(!r.targets||!this._parent.loadMorphTargets)return;if(void 0==p._numMorphTargets)p._numMorphTargets=r.targets.length;else if(r.targets.length!==p._numMorphTargets)throw new Error(`${w}: Primitives do not have the same number of targets`);const d=e.extras?e.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,I.morphTargetManager=new v(this._babylonScene),I.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.morphTargetManager.areUpdatesFrozen=!0;for(let f=0;f<r.targets.length;f++){const w=p.weights?p.weights[f]:e.weights?e.weights[f]:0,r=d?d[f]:`morphTarget${f}`;I.morphTargetManager.addTarget(new l.e(r,w,I.iw()))}}_loadMorphTargetsAsync(w,p,e,r){if(!p.targets||!this._parent.loadMorphTargets)return Promise.resolve();const I=new Array,d=e.morphTargetManager;for(let f=0;f<d.numTargets;f++){const e=d.getTarget(f);I.push(this._loadMorphTargetVertexDataAsync(`${w}/targets/${f}`,r,p.targets[f],e))}return Promise.all(I).then((()=>{d.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(w,p,e,r){const I=new Array,d=(r,d,f)=>{if(void 0==e[r])return;const q=p.getVertexBuffer(d);if(!q)return;const E=H.Get(`${w}/${r}`,this._gltf.accessors,e[r]);I.push(this._loadFloatAccessorAsync(`/accessors/${E.index}`,E).then((w=>{f(q,w)})))};return d("POSITION",M.e.PositionKind,((w,p)=>{const e=new Float32Array(p.length);w.forEach(p.length,((w,r)=>{e[r]=p[r]+w})),r.setPositions(e)})),d("NORMAL",M.e.NormalKind,((w,p)=>{const e=new Float32Array(p.length);w.forEach(e.length,((w,r)=>{e[r]=p[r]+w})),r.setNormals(e)})),d("TANGENT",M.e.TangentKind,((w,p)=>{const e=new Float32Array(p.length/3*4);let I=0;w.forEach(p.length/3*4,((w,r)=>{(r+1)%4!==0&&(e[I]=p[I]+w,I++)})),r.setTangents(e)})),d("TEXCOORD_0",M.e.UVKind,((w,p)=>{const e=new Float32Array(p.length);w.forEach(p.length,((w,r)=>{e[r]=p[r]+w})),r.setUVs(e)})),d("TEXCOORD_1",M.e.UV2Kind,((w,p)=>{const e=new Float32Array(p.length);w.forEach(p.length,((w,r)=>{e[r]=p[r]+w})),r.setUV2s(e)})),d("COLOR_0",M.e.ColorKind,((p,e)=>{let I=null;const d=p.getSize();if(3===d){I=new Float32Array(e.length/3*4),p.forEach(e.length,((w,p)=>{const r=Math.floor(p/3),d=p%3;I[4*r+d]=e[3*r+d]+w}));for(let w=0;w<e.length/3;++w)I[4*w+3]=1}else{if(4!==d)throw new Error(`${w}: Invalid number of components (${d}) for COLOR_0 attribute`);I=new Float32Array(e.length),p.forEach(e.length,((w,p)=>{I[p]=e[p]+w}))}r.setColors(I)})),await Promise.all(I).then((()=>{}))}static _LoadTransform(w,p){if(void 0!=w.skin)return;let e=I.k.Zero(),r=I.c.Identity(),d=I.k.One();if(w.matrix){I.b.Ve(w.matrix).decompose(d,r,e)}else w.translation&&(e=I.k.Ve(w.translation)),w.rotation&&(r=I.c.Ve(w.rotation)),w.scale&&(d=I.k.Ve(w.scale));p.position=e,p.rotationQuaternion=r,p.Ne=d}_loadSkinAsync(w,p,e,r){if(!this._parent.loadSkins)return Promise.resolve();const I=this._extensionsLoadSkinAsync(w,p,e);if(I)return I;if(e._data)return r(e._data.babylonSkeleton),e._data.promise;const d=`skeleton${e.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new s(e.name||d,d,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(w,e,f);const q=this._loadSkinInverseBindMatricesDataAsync(w,e).then((w=>{this._updateBoneMatrices(f,w)}));return e._data={babylonSkeleton:f,promise:q},r(f),q}_loadBones(w,p,e){if(void 0==p.skeleton||this._parent.alwaysComputeSkeletonRootNode){const e=this._findSkeletonRootNode(`${w}/joints`,p.joints);if(e)if(void 0===p.skeleton)p.skeleton=e.index;else{const r=(w,p)=>{for(;p.parent;p=p.parent)if(p.parent===w)return!0;return!1},I=H.Get(`${w}/skeleton`,this._gltf.nodes,p.skeleton);I===e||r(I,e)||(y.c.Warn(`${w}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),p.skeleton=e.index)}else y.c.Warn(`${w}: Failed to find common root`)}const r={};for(const I of p.joints){const d=H.Get(`${w}/joints/${I}`,this._gltf.nodes,I);this._loadBone(d,p,e,r)}}_findSkeletonRootNode(w,p){if(0===p.length)return null;const e={};for(const I of p){const p=[];let r=H.Get(`${w}/${I}`,this._gltf.nodes,I);for(;-1!==r.index;)p.unshift(r),r=r.parent;e[I]=p}let r=null;for(let I=0;;++I){let w=e[p[0]];if(I>=w.length)return r;const d=w[I];for(let f=1;f<p.length;++f)if(w=e[p[f]],I>=w.length||d!==w[I])return r;r=d}}_loadBone(w,p,e,r){w._isJoint=!0;let I=r[w.index];if(I)return I;let d=null;w.index!==p.skeleton&&(w.parent&&-1!==w.parent.index?d=this._loadBone(w.parent,p,e,r):void 0!==p.skeleton&&y.c.Warn(`/skins/${p.index}/skeleton: Skeleton node is not a common root`));const f=p.joints.indexOf(w.index);return I=new j.e(w.name||`joint${w.index}`,e,d,this._getNodeMatrix(w),null,null,f),r[w.index]=I,this._postSceneLoadActions.push((()=>{I.linkTransformNode(w._babylonTransformNode)})),I}_loadSkinInverseBindMatricesDataAsync(w,p){if(void 0==p.inverseBindMatrices)return Promise.resolve(null);const e=H.Get(`${w}/inverseBindMatrices`,this._gltf.accessors,p.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${e.index}`,e)}_updateBoneMatrices(w,p){for(const e of w.bones){const w=I.b.Identity(),r=e._index;p&&-1!==r&&(I.b.FromArrayToRef(p,16*r,w),w.invertToRef(w));const d=e.getParent();d&&w.multiplyToRef(d.getAbsoluteInverseBindMatrix(),w),e.Ze(w,!1,!1),e._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(w){return w.matrix?I.b.Ve(w.matrix):I.b.Compose(w.scale?I.k.Ve(w.scale):I.k.One(),w.rotation?I.c.Ve(w.rotation):I.c.Identity(),w.translation?I.k.Ve(w.translation):I.k.Zero())}loadCameraAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const r=this._extensionsLoadCameraAsync(w,p,e);if(r)return r;const d=new Array;this.logOpen(`${w} ${p.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new E.d(p.name||`camera${p.index}`,I.k.Zero(),this._babylonScene,!1);switch(f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonCamera=f,f.setTarget(new I.k(0,0,-1)),p.type){case"perspective":{const e=p.perspective;if(!e)throw new Error(`${w}: Camera perspective properties are missing`);f.fov=e.yfov,f.ge=e.znear,f.maxZ=e.zfar||0;break}case"orthographic":if(!p.orthographic)throw new Error(`${w}: Camera orthographic properties are missing`);f.mode=q.d.ORTHOGRAPHIC_CAMERA,f.orthoLeft=-p.orthographic.xmag,f.orthoRight=p.orthographic.xmag,f.orthoBottom=-p.orthographic.ymag,f.orthoTop=p.orthographic.ymag,f.ge=p.orthographic.znear,f.maxZ=p.orthographic.zfar;break;default:throw new Error(`${w}: Invalid camera type (${p.type})`)}return D.AddPointerMetadata(f,w),this._parent.onCameraLoadedObservable.notifyObservers(f),e(f),this.logClose(),Promise.all(d).then((()=>f))}_loadAnimationsAsync(){const w=this._gltf.animations;if(!w)return Promise.resolve();const p=new Array;for(let e=0;e<w.length;e++){const r=w[e];p.push(this.loadAnimationAsync(`/animations/${r.index}`,r).then((w=>{0===w.targetedAnimations.length&&w.dispose()})))}return Promise.all(p).then((()=>{}))}loadAnimationAsync(w,p){const r=this._extensionsLoadAnimationAsync(w,p);return r||e.e(58).then(e.bind(e,14348)).then((e=>{let{AnimationGroup:r}=e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new r(p.name||`animation${p.index}`,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonAnimationGroup=I;const d=new Array;H.Assign(p.channels),H.Assign(p.samplers);for(const f of p.channels)d.push(this._loadAnimationChannelAsync(`${w}/channels/${f.index}`,w,p,f,((w,p)=>{w.animations=w.animations||[],w.animations.push(p),I.addTargetedAnimation(p,w)})));return Promise.all(d).then((()=>(I.normalize(0),I)))}))}async _loadAnimationChannelAsync(w,p,r,I,d){const f=this._extensionsLoadAnimationChannelAsync(w,p,r,I,d);if(f)return await f;if(void 0==I.target.node)return await Promise.resolve();const q=H.Get(`${w}/target/node`,this._gltf.nodes,I.target.node),E=I.target.path,j="weights"===E;if(j&&!q._numMorphTargets||!j&&!q._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!j&&!q._isJoint)return await Promise.resolve();let X;switch(await Promise.resolve().then(e.bind(e,12821)),E){case"translation":var k;X=null===(k=(0,L.e)("/nodes/{}/translation"))||void 0===k?void 0:k.interpolation;break;case"rotation":var m;X=null===(m=(0,L.e)("/nodes/{}/rotation"))||void 0===m?void 0:m.interpolation;break;case"scale":var J;X=null===(J=(0,L.e)("/nodes/{}/scale"))||void 0===J?void 0:J.interpolation;break;case"weights":var K;X=null===(K=(0,L.e)("/nodes/{}/weights"))||void 0===K?void 0:K.interpolation;break;default:throw new Error(`${w}/target/path: Invalid value (${I.target.path})`)}if(!X)throw new Error(`${w}/target/path: Could not find interpolation properties for target path (${I.target.path})`);const y={object:q,info:X};return await this._loadAnimationChannelFromTargetInfoAsync(w,p,r,I,y,d)}_loadAnimationChannelFromTargetInfoAsync(w,p,e,r,I,d){const f=this.parent.targetFps,q=1/f,E=H.Get(`${w}/sampler`,e.samplers,r.sampler);return this._loadAnimationSamplerAsync(`${p}/samplers/${r.sampler}`,E).then((w=>{let p=0;const E=I.object,j=I.info;for(const I of j){const j=I.getStride(E),X=w.input,k=w.output,m=new Array(X.length);let J=0;switch(w.interpolation){case"STEP":for(let w=0;w<X.length;w++){const p=I.getValue(E,k,J,1);J+=j,m[w]={frame:X[w]*f,value:p,interpolation:1}}break;case"CUBICSPLINE":for(let w=0;w<X.length;w++){const p=I.getValue(E,k,J,q);J+=j;const e=I.getValue(E,k,J,1);J+=j;const r=I.getValue(E,k,J,q);J+=j,m[w]={frame:X[w]*f,inTangent:p,value:e,outTangent:r}}break;case"LINEAR":for(let w=0;w<X.length;w++){const p=I.getValue(E,k,J,1);J+=j,m[w]={frame:X[w]*f,value:p}}}if(J>0){const w=`${e.name||`animation${e.index}`}_channel${r.index}_${p}`,q=I.buildAnimations(E,w,f,m);for(const e of q)p++,d(e.babylonAnimatable,e.babylonAnimation)}}}))}_loadAnimationSamplerAsync(w,p){if(p._data)return p._data;const e=p.interpolation||"LINEAR";switch(e){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${w}/interpolation: Invalid value (${p.interpolation})`)}const r=H.Get(`${w}/input`,this._gltf.accessors,p.input),I=H.Get(`${w}/output`,this._gltf.accessors,p.output);return p._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${r.index}`,r),this._loadFloatAccessorAsync(`/accessors/${I.index}`,I)]).then((w=>{let[p,r]=w;return{input:p,interpolation:e,output:r}})),p._data}loadBufferAsync(w,p,e,r){const I=this._extensionsLoadBufferAsync(w,p,e,r);if(I)return I;if(!p._data)if(p.uri)p._data=this.loadUriAsync(`${w}/uri`,p,p.uri);else{if(!this._bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);p._data=this._bin.readAsync(0,p.byteLength)}return p._data.then((p=>{try{return new Uint8Array(p.buffer,p.byteOffset+e,r)}catch(I){throw new Error(`${w}: ${I.message}`)}}))}loadBufferViewAsync(w,p){const e=this._extensionsLoadBufferViewAsync(w,p);if(e)return e;if(p._data)return p._data;const r=H.Get(`${w}/buffer`,this._gltf.buffers,p.buffer);return p._data=this.loadBufferAsync(`/buffers/${r.index}`,r,p.byteOffset||0,p.byteLength),p._data}_loadAccessorAsync(w,p,e){if(p._data)return p._data;const r=D._GetNumComponents(w,p.type),I=r*M.e.GetTypeByteLength(p.componentType),d=r*p.count;if(void 0==p.bufferView)p._data=Promise.resolve(new e(d));else{const f=H.Get(`${w}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((q=>{if(5126!==p.componentType||p.normalized||f.byteStride&&f.byteStride!==I){const w=new e(d);return M.e.ForEach(q,p.byteOffset||0,f.byteStride||I,r,p.componentType,w.length,p.normalized||!1,((p,e)=>{w[e]=p})),w}return D._GetTypedArray(w,p.componentType,q,p.byteOffset,d)}))}if(p.sparse){const d=p.sparse;p._data=p._data.then((f=>{const q=f,E=H.Get(`${w}/sparse/indices/bufferView`,this._gltf.bufferViews,d.indices.bufferView),j=H.Get(`${w}/sparse/values/bufferView`,this._gltf.bufferViews,d.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${E.index}`,E),this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)]).then((f=>{let[E,j]=f;const X=D._GetTypedArray(`${w}/sparse/indices`,d.indices.componentType,E,d.indices.byteOffset,d.count),k=r*d.count;let m;if(5126!==p.componentType||p.normalized){const f=D._GetTypedArray(`${w}/sparse/values`,p.componentType,j,d.values.byteOffset,k);m=new e(k),M.e.ForEach(f,0,I,r,p.componentType,m.length,p.normalized||!1,((w,p)=>{m[p]=w}))}else m=D._GetTypedArray(`${w}/sparse/values`,p.componentType,j,d.values.byteOffset,k);let J=0;for(let w=0;w<X.length;w++){let p=X[w]*r;for(let w=0;w<r;w++)q[p++]=m[J++]}return q}))}))}return p._data}_loadFloatAccessorAsync(w,p){return this._loadAccessorAsync(w,p,Float32Array)}_loadIndicesAccessorAsync(w,p){if("SCALAR"!==p.type)throw new Error(`${w}/type: Invalid value ${p.type}`);if(5121!==p.componentType&&5123!==p.componentType&&5125!==p.componentType)throw new Error(`${w}/componentType: Invalid value ${p.componentType}`);if(p._data)return p._data;if(p.sparse){const e=D._GetTypedArrayConstructor(`${w}/componentType`,p.componentType);p._data=this._loadAccessorAsync(w,p,e)}else{const e=H.Get(`${w}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>D._GetTypedArray(w,p.componentType,e,p.byteOffset,p.count)))}return p._data}_loadVertexBufferViewAsync(w){if(w._babylonBuffer)return w._babylonBuffer;const p=this._babylonScene.getEngine();return w._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((w=>new M.b(p,w,!1))),w._babylonBuffer}_loadVertexAccessorAsync(w,p,e){var r;if(null!==(r=p._babylonVertexBuffer)&&void 0!==r&&r[e])return p._babylonVertexBuffer[e];p._babylonVertexBuffer||(p._babylonVertexBuffer={});const I=this._babylonScene.getEngine();if(p.sparse||void 0==p.bufferView)p._babylonVertexBuffer[e]=this._loadFloatAccessorAsync(w,p).then((w=>new M.e(I,w,e,!1)));else{const r=H.Get(`${w}/bufferView`,this._gltf.bufferViews,p.bufferView);p._babylonVertexBuffer[e]=this._loadVertexBufferViewAsync(r).then((d=>{const f=D._GetNumComponents(w,p.type);return new M.e(I,d,e,!1,void 0,r.byteStride,void 0,p.byteOffset,f,p.componentType,p.normalized,!0,void 0,!0)}))}return p._babylonVertexBuffer[e]}_loadMaterialMetallicRoughnessPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return p&&(p.baseColorFactor?(e.albedoColor=d.b.Ve(p.baseColorFactor),e.alpha=p.baseColorFactor[3]):e.albedoColor=d.b.White(),e.metallic=void 0==p.metallicFactor?1:p.metallicFactor,e.roughness=void 0==p.roughnessFactor?1:p.roughnessFactor,p.baseColorTexture&&r.push(this.loadTextureInfoAsync(`${w}/baseColorTexture`,p.baseColorTexture,(w=>{w.name=`${e.name} (Base Color)`,e.albedoTexture=w}))),p.metallicRoughnessTexture&&(p.metallicRoughnessTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync(`${w}/metallicRoughnessTexture`,p.metallicRoughnessTexture,(w=>{w.name=`${e.name} (Metallic Roughness)`,e.metallicTexture=w}))),e.useMetallnessFromMetallicTextureBlue=!0,e.useRoughnessFromMetallicTextureGreen=!0,e.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(r).then((()=>{}))}_loadMaterialAsync(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const d=this._extensionsLoadMaterialAsync(w,p,e,r,I);if(d)return d;p._data=p._data||{};let f=p._data[r];if(!f){this.logOpen(`${w} ${p.name||""}`);const e=this.createMaterial(w,p,r);f={babylonMaterial:e,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(w,p,e)},p._data[r]=f,D.AddPointerMetadata(e,w),this._parent.onMaterialLoadedObservable.notifyObservers(e),this.logClose()}return e&&(f.babylonMeshes.push(e),e.ue.addOnce((()=>{const w=f.babylonMeshes.indexOf(e);-1!==w&&f.babylonMeshes.splice(w,1)}))),I(f.babylonMaterial),f.promise.then((()=>f.babylonMaterial))}_createDefaultMaterial(w,p){this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new a.d(w,this._babylonScene);return e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.fillMode=p,e.enableSpecularAntiAliasing=!0,e.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,e.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,e.transparencyMode=a.d.PBRMATERIAL_OPAQUE,e.metallic=1,e.roughness=1,e}createMaterial(w,p,e){const r=this._extensionsCreateMaterial(w,p,e);if(r)return r;const I=p.name||`material${p.index}`;return this._createDefaultMaterial(I,e)}loadMaterialPropertiesAsync(w,p,e){const r=this._extensionsLoadMaterialPropertiesAsync(w,p,e);if(r)return r;const I=new Array;return I.push(this.loadMaterialBasePropertiesAsync(w,p,e)),p.pbrMetallicRoughness&&I.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${w}/pbrMetallicRoughness`,p.pbrMetallicRoughness,e)),this.loadMaterialAlphaProperties(w,p,e),Promise.all(I).then((()=>{}))}loadMaterialBasePropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.emissiveColor=p.emissiveFactor?d.b.Ve(p.emissiveFactor):new d.b(0,0,0),p.doubleSided&&(e.ce=!1,e.twoSidedLighting=!0),p.normalTexture&&(p.normalTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync(`${w}/normalTexture`,p.normalTexture,(w=>{w.name=`${e.name} (Normal)`,e.bumpTexture=w}))),e.invertNormalMapX=!this._babylonScene.useRightHandedSystem,e.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=p.normalTexture.scale&&e.bumpTexture&&(e.bumpTexture.level=p.normalTexture.scale),e.forceIrradianceInFragment=!0),p.occlusionTexture&&(p.occlusionTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync(`${w}/occlusionTexture`,p.occlusionTexture,(w=>{w.name=`${e.name} (Occlusion)`,e.ambientTexture=w}))),e.useAmbientInGrayScale=!0,void 0!=p.occlusionTexture.strength&&(e.ambientTextureStrength=p.occlusionTexture.strength)),p.emissiveTexture&&r.push(this.loadTextureInfoAsync(`${w}/emissiveTexture`,p.emissiveTexture,(w=>{w.name=`${e.name} (Emissive)`,e.emissiveTexture=w}))),Promise.all(r).then((()=>{}))}loadMaterialAlphaProperties(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);switch(p.alphaMode||"OPAQUE"){case"OPAQUE":e.transparencyMode=a.d.PBRMATERIAL_OPAQUE,e.alpha=1;break;case"MASK":e.transparencyMode=a.d.PBRMATERIAL_ALPHATEST,e.alphaCutOff=void 0==p.alphaCutoff?.5:p.alphaCutoff,e.albedoTexture&&(e.albedoTexture.ie=!0);break;case"BLEND":e.transparencyMode=a.d.PBRMATERIAL_ALPHABLEND,e.albedoTexture&&(e.albedoTexture.ie=!0,e.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${w}/alphaMode: Invalid value (${p.alphaMode})`)}}loadTextureInfoAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const r=this._extensionsLoadTextureInfoAsync(w,p,e);if(r)return r;if(this.logOpen(`${w}`),p.texCoord>=6)throw new Error(`${w}/texCoord: Invalid value (${p.texCoord})`);const I=H.Get(`${w}/index`,this._gltf.textures,p.index);I._textureInfo=p;const d=this._loadTextureAsync(`/textures/${p.index}`,I,(r=>{r.coordinatesIndex=p.texCoord||0,D.AddPointerMetadata(r,w),this._parent.onTextureLoadedObservable.notifyObservers(r),e(r)}));return this.logClose(),d}_loadTextureAsync(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const r=this._extensionsLoadTextureAsync(w,p,e);if(r)return r;this.logOpen(`${w} ${p.name||""}`);const I=void 0==p.sampler?D.DefaultSampler:H.Get(`${w}/sampler`,this._gltf.samplers,p.sampler),d=H.Get(`${w}/source`,this._gltf.images,p.source),f=this._createTextureAsync(w,I,d,e,void 0,!p._textureInfo.nonColorData);return this.logClose(),f}_createTextureAsync(w,p,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const q=this._loadSampler(`/samplers/${p.index}`,p),E=new Array,j=new r;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X={noMipmap:q.noMipMaps,invertY:!1,samplingMode:q.samplingMode,G:()=>{this._disposed||j.resolve()},onError:(p,e)=>{this._disposed||j.reject(new Error(`${w}: ${e&&e.message?e.message:p||"Failed to load texture"}`))},mimeType:e.mimeType??(0,V.j)(e.uri??""),loaderOptions:d,useSRGBBuffer:!!f&&this._parent.useSRGBBuffers},k=new A.e(null,this._babylonScene,X);return k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.push(j.promise),E.push(this.loadImageAsync(`/images/${e.index}`,e).then((w=>{const p=e.uri||`${this._fileName}#image${e.index}`,r=`data:${this._uniqueRootUrl}${p}`;k.updateURL(r,w);const I=k.getInternalTexture();I&&(I.label=e.name)}))),k.wrapU=q.wrapU,k.wrapV=q.wrapV,I(k),this._parent.useGltfTextureNames&&(k.name=e.name||e.uri||`image${e.index}`),Promise.all(E).then((()=>k))}_loadSampler(w,p){return p._data||(p._data={noMipMaps:9728===p.minFilter||9729===p.minFilter,samplingMode:D._GetTextureSamplingMode(w,p),wrapU:D._GetTextureWrapMode(`${w}/wrapS`,p.wrapS),wrapV:D._GetTextureWrapMode(`${w}/wrapT`,p.wrapT)}),p._data}loadImageAsync(w,p){if(!p._data){if(this.logOpen(`${w} ${p.name||""}`),p.uri)p._data=this.loadUriAsync(`${w}/uri`,p,p.uri);else{const e=H.Get(`${w}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}this.logClose()}return p._data}loadUriAsync(w,p,e){const r=this._extensionsLoadUriAsync(w,p,e);if(r)return r;if(!D._ValidateUri(e))throw new Error(`${w}: '${e}' is invalid`);if((0,V.n)(e)){const p=new Uint8Array((0,V.d)(e));return this.log(`${w}: Decoded ${e.substring(0,64)}... (${p.length} bytes)`),Promise.resolve(p)}return this.log(`${w}: Loading ${e}`),this._parent.preprocessUrlAsync(this._rootUrl+e).then((p=>new Promise(((r,I)=>{this._parent._loadFile(this._babylonScene,p,(p=>{this._disposed||(this.log(`${w}: Loaded ${e} (${p.byteLength} bytes)`),r(new Uint8Array(p)))}),!0,(p=>{I(new V.q(`${w}: Failed to load '${e}'${p?": "+p.status+" "+p.statusText:""}`,p))}))}))))}static AddPointerMetadata(w,p){w.metadata=w.metadata||{};const e=w._internalMetadata=w._internalMetadata||{},r=e.Ge=e.Ge||{};(r.pointers=r.pointers||[]).push(p)}static _GetTextureWrapMode(w,p){switch(p=void 0==p?10497:p){case 33071:return A.e.CLAMP_ADDRESSMODE;case 33648:return A.e.MIRROR_ADDRESSMODE;case 10497:return A.e.WRAP_ADDRESSMODE;default:return y.c.Warn(`${w}: Invalid value (${p})`),A.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(w,p){const e=void 0==p.magFilter?9729:p.magFilter,r=void 0==p.minFilter?9987:p.minFilter;if(9729===e)switch(r){case 9728:return A.e.LINEAR_NEAREST;case 9729:return A.e.LINEAR_LINEAR;case 9984:return A.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return A.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return A.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return A.e.LINEAR_LINEAR_MIPLINEAR;default:return y.c.Warn(`${w}/minFilter: Invalid value (${r})`),A.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==e&&y.c.Warn(`${w}/magFilter: Invalid value (${e})`),r){case 9728:return A.e.NEAREST_NEAREST;case 9729:return A.e.NEAREST_LINEAR;case 9984:return A.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return A.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return A.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return A.e.NEAREST_LINEAR_MIPLINEAR;default:return y.c.Warn(`${w}/minFilter: Invalid value (${r})`),A.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(w,p){try{return(0,F.m)(p)}catch(e){throw new Error(`${w}: ${e.message}`)}}static _GetTypedArray(w,p,e,r,I){const d=e.buffer;r=e.byteOffset+(r||0);const f=D._GetTypedArrayConstructor(`${w}/componentType`,p),q=M.e.GetTypeByteLength(p);return r%q!==0?(y.c.Warn(`${w}: Copying buffer as byte offset (${r}) is not a multiple of component type byte length (${q})`),new f(d.slice(r,r+I*q),0)):new f(d,r,I)}static _GetNumComponents(w,p){switch(p){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${w}: Invalid type (${p})`)}static _ValidateUri(w){return f.g.IsBase64(w)||-1===w.indexOf("..")}static _GetDrawMode(w,p){switch(void 0==p&&(p=4),p){case 0:return O.b.PointListDrawMode;case 1:return O.b.LineListDrawMode;case 2:return O.b.LineLoopDrawMode;case 3:return O.b.LineStripDrawMode;case 4:return O.b.TriangleFillMode;case 5:return O.b.TriangleStripDrawMode;case 6:return O.b.TriangleFanDrawMode}throw new Error(`${w}: Invalid mesh primitive mode (${p})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const w=new Array;if(this._gltf.materials)for(const p of this._gltf.materials)if(p._data)for(const e in p._data){const r=p._data[e];for(const p of r.babylonMeshes){p.ke(!0);const e=r.babylonMaterial;w.push(e.forceCompilationAsync(p)),w.push(e.forceCompilationAsync(p,{useInstances:!0})),this._parent.useClipPlane&&(w.push(e.forceCompilationAsync(p,{clipPlane:!0})),w.push(e.forceCompilationAsync(p,{clipPlane:!0,useInstances:!0})))}}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const w=new Array,p=this._babylonScene.lights;for(const e of p){const p=e.getShadowGenerator();p&&w.push(p.forceCompilationAsync())}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(w){for(const p of this._extensions)p.enabled&&w(p)}_applyExtensions(w,p,e){for(const r of this._extensions)if(r.enabled){const I=`${r.name}.${p}`,d=w;d._activeLoaderExtensionFunctions=d._activeLoaderExtensionFunctions||{};const f=d._activeLoaderExtensionFunctions;if(!f[I]){f[I]=!0;try{const w=e(r);if(w)return w}finally{delete f[I]}}}return null}_extensionsOnLoading(){this._forEachExtensions((w=>w.onLoading&&w.onLoading()))}_extensionsOnReady(){this._forEachExtensions((w=>w.onReady&&w.onReady()))}_extensionsLoadSceneAsync(w,p){return this._applyExtensions(p,"loadScene",(e=>e.loadSceneAsync&&e.loadSceneAsync(w,p)))}_extensionsLoadNodeAsync(w,p,e){return this._applyExtensions(p,"loadNode",(r=>r.loadNodeAsync&&r.loadNodeAsync(w,p,e)))}_extensionsLoadCameraAsync(w,p,e){return this._applyExtensions(p,"loadCamera",(r=>r.loadCameraAsync&&r.loadCameraAsync(w,p,e)))}_extensionsLoadVertexDataAsync(w,p,e){return this._applyExtensions(p,"loadVertexData",(r=>r._loadVertexDataAsync&&r._loadVertexDataAsync(w,p,e)))}_extensionsLoadMeshPrimitiveAsync(w,p,e,r,I,d){return this._applyExtensions(I,"loadMeshPrimitive",(f=>f._loadMeshPrimitiveAsync&&f._loadMeshPrimitiveAsync(w,p,e,r,I,d)))}_extensionsLoadMaterialAsync(w,p,e,r,I){return this._applyExtensions(p,"loadMaterial",(d=>d._loadMaterialAsync&&d._loadMaterialAsync(w,p,e,r,I)))}_extensionsCreateMaterial(w,p,e){return this._applyExtensions(p,"createMaterial",(r=>r.createMaterial&&r.createMaterial(w,p,e)))}_extensionsLoadMaterialPropertiesAsync(w,p,e){return this._applyExtensions(p,"loadMaterialProperties",(r=>r.loadMaterialPropertiesAsync&&r.loadMaterialPropertiesAsync(w,p,e)))}_extensionsLoadTextureInfoAsync(w,p,e){return this._applyExtensions(p,"loadTextureInfo",(r=>r.loadTextureInfoAsync&&r.loadTextureInfoAsync(w,p,e)))}_extensionsLoadTextureAsync(w,p,e){return this._applyExtensions(p,"loadTexture",(r=>r._loadTextureAsync&&r._loadTextureAsync(w,p,e)))}_extensionsLoadAnimationAsync(w,p){return this._applyExtensions(p,"loadAnimation",(e=>e.loadAnimationAsync&&e.loadAnimationAsync(w,p)))}_extensionsLoadAnimationChannelAsync(w,p,e,r,I){return this._applyExtensions(e,"loadAnimationChannel",(d=>d._loadAnimationChannelAsync&&d._loadAnimationChannelAsync(w,p,e,r,I)))}_extensionsLoadSkinAsync(w,p,e){return this._applyExtensions(e,"loadSkin",(r=>r._loadSkinAsync&&r._loadSkinAsync(w,p,e)))}_extensionsLoadUriAsync(w,p,e){return this._applyExtensions(p,"loadUri",(r=>r._loadUriAsync&&r._loadUriAsync(w,p,e)))}_extensionsLoadBufferViewAsync(w,p){return this._applyExtensions(p,"loadBufferView",(e=>e.loadBufferViewAsync&&e.loadBufferViewAsync(w,p)))}_extensionsLoadBufferAsync(w,p,e,r){return this._applyExtensions(p,"loadBuffer",(I=>I.loadBufferAsync&&I.loadBufferAsync(w,p,e,r)))}static LoadExtensionAsync(w,p,e,r){if(!p.extensions)return null;const I=p.extensions[e];return I?r(`${w}/extensions/${e}`,I):null}static LoadExtraAsync(w,p,e,r){if(!p.extras)return null;const I=p.extras[e];return I?r(`${w}/extras/${e}`,I):null}isExtensionUsed(w){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(w)}logOpen(w){this._parent._logOpen(w)}logClose(){this._parent._logClose()}log(w){this._parent._log(w)}startPerformanceCounter(w){this._parent._startPerformanceCounter(w)}endPerformanceCounter(w){this._parent._endPerformanceCounter(w)}}D.DefaultSampler={index:-1},R.b._CreateGLTF2Loader=w=>new D(w);var T=e(12821),Z=e(11475),G=e(11301),g=e(12828),o=e(12830);class C extends o.b{constructor(w,p,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",w),this._texture=w.getEngine().createRawCubeTexture(p,e,r,I,d,f,q,E)}update(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,w,p,e,r,I)}updateRGBDAsync(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,g.j)(this._texture,w,p,e,r).then((()=>{}))}clone(){return G.e.Clone((()=>{const w=this.iw(),p=this._texture,e=new C(w,p._bufferViewArray,p.width,p.format,p.type,p.generateMipMaps,p.invertY,p.samplingMode,p._compression);return 13===p.source&&e.updateRGBDAsync(p._bufferViewArrayArray,p._sphericalPolynomial,p._lodGenerationScale,p._lodGenerationOffset),e}),this)}}const Q="EXT_lights_image_based";class x{constructor(w){this.name=Q,this._loader=w,this.enabled=this._loader.isExtensionUsed(Q)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.Ge.extensions;if(w&&w[this.name]){const p=w[this.name];this._lights=p.lights}}loadSceneAsync(w,p){return D.LoadExtensionAsync(w,p,this.name,(async(e,r)=>{this._loader._allMaterialsDirtyRequired=!0;const I=new Array;I.push(this._loader.loadSceneAsync(w,p)),this._loader.logOpen(`${e}`);const d=H.Get(`${e}/light`,this._lights,r.pe);return I.push(this._loadLightAsync(`/extensions/${this.name}/lights/${r.pe}`,d).then((w=>{this._loader.babylonScene.environmentTexture=w}))),this._loader.logClose(),await Promise.all(I).then((()=>{}))}))}_loadLightAsync(w,p){if(!p._loaded){const e=new Array;this._loader.logOpen(`${w}`);const r=new Array(p.specularImages.length);for(let I=0;I<p.specularImages.length;I++){const d=p.specularImages[I];r[I]=new Array(d.length);for(let p=0;p<d.length;p++){const f=`${w}/specularImages/${I}/${p}`;this._loader.logOpen(`${f}`);const q=d[p],E=H.Get(f,this._loader.Ge.images,q);e.push(this._loader.loadImageAsync(`/images/${q}`,E).then((w=>{r[I][p]=w}))),this._loader.logClose()}}this._loader.logClose(),p._loaded=Promise.all(e).then((async()=>{const e=new C(this._loader.babylonScene,null,p.specularImageSize);if(e.name=p.name||"environment",p._babylonTexture=e,void 0!=p.Se&&(e.level=p.Se),p.rotation){let w=I.c.Ve(p.rotation);this._loader.babylonScene.useRightHandedSystem||(w=I.c.Inverse(w)),I.b.FromQuaternionToRef(w,e.getReflectionTextureMatrix())}if(!p.irradianceCoefficients)throw new Error(`${w}: Irradiance coefficients are missing`);const d=Z.d.Ve(p.irradianceCoefficients);d.scaleInPlace(p.Se),d.convertIrradianceToLambertianRadiance();const f=Z.h.FromHarmonics(d),q=(r.length-1)/Math.log2(p.specularImageSize);return await e.updateRGBDAsync(r,f,q)}))}return p._loaded.then((()=>p._babylonTexture))}}Y(Q),u(Q,!0,(w=>new x(w)));e(11752);const S="EXT_mesh_gpu_instancing";class ww{constructor(w){this.name=S,this._loader=w,this.enabled=this._loader.isExtensionUsed(S)}dispose(){this._loader=null}loadNodeAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(w,r)=>{this._loader._disableInstancedMesh++;const d=this._loader.loadNodeAsync(`/nodes/${p.index}`,p,e);if(this._loader._disableInstancedMesh--,!p._primitiveBabylonMeshes)return await d;const f=new Array;let q=0;const E=p=>{if(void 0==r.attributes[p])return void f.push(Promise.resolve(null));const e=H.Get(`${w}/attributes/${p}`,this._loader.Ge.accessors,r.attributes[p]);if(f.push(this._loader._loadFloatAccessorAsync(`/accessors/${e.bufferView}`,e)),0===q)q=e.count;else if(q!==e.count)throw new Error(`${w}/attributes: Instance buffer accessors do not have the same count.`)};return E("TRANSLATION"),E("ROTATION"),E("SCALE"),await d.then((async w=>{const[e,r,d]=await Promise.all(f),E=new Float32Array(16*q);I.d.ne[0].te(0,0,0),I.d.Quaternion[0].te(0,0,0,1),I.d.ne[1].te(1,1,1);for(let p=0;p<q;++p)e&&I.k.FromArrayToRef(e,3*p,I.d.ne[0]),r&&I.c.FromArrayToRef(r,4*p,I.d.Quaternion[0]),d&&I.k.FromArrayToRef(d,3*p,I.d.ne[1]),I.b.ComposeToRef(I.d.ne[1],I.d.Quaternion[0],I.d.ne[0],I.d.Matrix[0]),I.d.Matrix[0].copyToArray(E,16*p);for(const I of p._primitiveBabylonMeshes)I.Lk("matrix",E,16,!0);return w}))}))}}Y(S),u(S,!0,(w=>new ww(w)));let pw=0,ew=null;class rw{static get Default(){return rw._Default||(rw._Default=new rw),rw._Default}constructor(){const w=rw.Configuration.decoder;this._decoderModulePromise=f.g.LoadBabylonScriptAsync(w.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(w,p,e,r,I){await this._decoderModulePromise,0===pw&&(MeshoptDecoder.useWorkers(1),pw=1);const d=await MeshoptDecoder.decodeGltfBufferAsync(p,e,w,r,I);return null!==ew&&clearTimeout(ew),ew=setTimeout((()=>{MeshoptDecoder.useWorkers(0),pw=0,ew=null}),1e3),d}}rw.Configuration={decoder:{url:`${f.g._DefaultCdnUrl}/meshopt_decoder.js`}},rw._Default=null;const Iw="EXT_meshopt_compression";class dw{constructor(w){this.name=Iw,this.enabled=w.isExtensionUsed(Iw),this._loader=w}dispose(){this._loader=null}loadBufferViewAsync(w,p){return D.LoadExtensionAsync(w,p,this.name,(async(e,r)=>{const I=p;if(I._meshOptData)return await I._meshOptData;const d=H.Get(`${w}/buffer`,this._loader.Ge.buffers,r.buffer);return I._meshOptData=this._loader.loadBufferAsync(`/buffers/${d.index}`,d,r.byteOffset||0,r.byteLength).then((async w=>await rw.Default.decodeGltfBufferAsync(w,r.count,r.byteStride,r.mode,r.filter))),await I._meshOptData}))}}Y(Iw),u(Iw,!0,(w=>new dw(w)));const fw="EXT_texture_webp";class qw{constructor(w){this.name=fw,this._loader=w,this.enabled=w.isExtensionUsed(fw)}dispose(){this._loader=null}_loadTextureAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=void 0==p.sampler?D.DefaultSampler:H.Get(`${w}/sampler`,this._loader.Ge.samplers,p.sampler),f=H.Get(`${r}/source`,this._loader.Ge.images,I.source);return await this._loader._createTextureAsync(w,d,f,(w=>{e(w)}),void 0,!p._textureInfo.nonColorData)}))}}Y(fw),u(fw,!0,(w=>new qw(w)));const Ew="EXT_texture_avif";class jw{constructor(w){this.name=Ew,this._loader=w,this.enabled=w.isExtensionUsed(Ew)}dispose(){this._loader=null}_loadTextureAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=void 0==p.sampler?D.DefaultSampler:H.Get(`${w}/sampler`,this._loader.Ge.samplers,p.sampler),f=H.Get(`${r}/source`,this._loader.Ge.images,I.source);return await this._loader._createTextureAsync(w,d,f,(w=>{e(w)}),void 0,!p._textureInfo.nonColorData)}))}}Y(Ew),u(Ew,!0,(w=>new jw(w)));var Xw=e(12818),kw=e(11729);const mw="EXT_lights_ies";class Jw{constructor(w){this.name=mw,this._loader=w,this.enabled=this._loader.isExtensionUsed(mw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.Ge.extensions;if(w&&w[this.name]){const p=w[this.name];this._lights=p.lights,H.Assign(this._lights)}}loadNodeAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,f)=>{let q,E;this._loader._allMaterialsDirtyRequired=!0;const j=await this._loader.loadNodeAsync(w,p,(w=>{E=H.Get(r,this._lights,f.pe);const p=E.name||w.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,q=new Xw.e(p,I.k.Zero(),I.k.Backward(),0,1,this._loader.babylonScene),q.angle=Math.PI/2,q.innerAngle=0,q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,E._babylonLight=q,q.falloffType=kw.b.FALLOFF_GLTF,q.br=f.color?d.b.Ve(f.color):d.b.White(),q.Se=f.multiplier||1,q.range=Number.MAX_VALUE,q.parent=w,this._loader._babylonLights.push(q),D.AddPointerMetadata(q,r),e(w)}));let X;if(E.uri)X=await this._loader.loadUriAsync(w,E,E.uri);else{const p=H.Get(`${w}/bufferView`,this._loader.Ge.bufferViews,E.bufferView);X=await this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}return q.iesProfileTexture=new A.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,X,!0,void 0,void 0,void 0,void 0,".ies"),j}))}}Y(mw),u(mw,!0,(w=>new Jw(w)));var Kw=e(12840);const yw="KHR_draco_mesh_compression";class cw{constructor(w){this.name=yw,this.useNormalizedFlagFromAccessor=!0,this._loader=w,this.enabled=Kw.b.DefaultAvailable&&this._loader.isExtensionUsed(yw)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{if(void 0!=p.mode&&4!==p.mode&&5!==p.mode)throw new Error(`${w}: Unsupported mode ${p.mode}`);const d={},f={},q=(w,r)=>{const q=I.attributes[w];if(void 0!=q&&(e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(r)&&e._delayInfo.push(r),d[r]=q,this.useNormalizedFlagFromAccessor)){const e=H.TryGet(this._loader.Ge.accessors,p.attributes[w]);e&&(f[r]=e.normalized||!1)}};q("POSITION",M.e.PositionKind),q("NORMAL",M.e.NormalKind),q("TANGENT",M.e.TangentKind),q("TEXCOORD_0",M.e.UVKind),q("TEXCOORD_1",M.e.UV2Kind),q("TEXCOORD_2",M.e.UV3Kind),q("TEXCOORD_3",M.e.UV4Kind),q("TEXCOORD_4",M.e.UV5Kind),q("TEXCOORD_5",M.e.UV6Kind),q("JOINTS_0",M.e.MatricesIndicesKind),q("WEIGHTS_0",M.e.MatricesWeightsKind),q("COLOR_0",M.e.ColorKind);const E=H.Get(r,this._loader.Ge.bufferViews,I.bufferView);return E._dracoBabylonGeometry||(E._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((async r=>{const I=this.dracoDecoder||Kw.b.Default,q=H.TryGet(this._loader.Ge.accessors,p.attributes.POSITION),E=this._loader.parent.alwaysComputeBoundingBox||e.skeleton||!q?null:B(q);return await I._decodeMeshToGeometryForGltfAsync(e.name,this._loader.babylonScene,r,d,f,E).catch((p=>{throw new Error(`${w}: ${p.message}`)}))}))),await E._dracoBabylonGeometry}))}}Y(yw),u(yw,!0,(w=>new cw(w)));var sw=e(12848),Ow=e(11207),aw=e(11213),Aw=e(11331),zw=e(11786),Mw=e(11038);Aw.b.AddNodeConstructor("Light_Type_0",((w,p)=>()=>new iw(w,I.k.Zero(),p)));class iw extends zw.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(w){this._shadowAngle=w,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(w){const p=this.needCube();if(this._direction=w,this.needCube()!==p&&this._shadowGenerators){const w=this._shadowGenerators.values();for(let p=w.next();!0!==p.done;p=w.next()){p.value.recreateShadowMap()}}}constructor(w,p,e){super(w,e),this._shadowAngle=Math.PI/2,this.position=p}getClassName(){return"PointLight"}getTypeID(){return kw.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(w){if(this.direction)return super.getShadowDirection(w);switch(w){case 0:return new I.k(1,0,0);case 1:return new I.k(-1,0,0);case 2:return new I.k(0,-1,0);case 3:return new I.k(0,1,0);case 4:return new I.k(0,0,1);case 5:return new I.k(0,0,-1)}return I.k.Zero()}_setDefaultShadowProjectionMatrix(w,p,e){const r=this.iw().activeCamera;if(!r)return;const d=void 0!==this.shadowMinZ?this.shadowMinZ:r.ge,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,q=this.iw().getEngine().useReverseDepthBuffer;I.b.PerspectiveFovLHToRef(this.shadowAngle,1,q?f:d,q?d:f,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,q)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,p){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,p):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,p),this}transferToNodeMaterialEffect(w,p){return this.computeTransformedInformation()?w.setFloat3(p,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):w.setFloat3(p,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(w,p){w["POINTLIGHT"+p]=!0}}(0,Ow.c)([(0,aw.J)()],iw.prototype,"shadowAngle",null),(0,Mw.d)("BABYLON.PointLight",iw);const tw="KHR_lights_punctual";class nw{constructor(w){this.name=tw,this._loader=w,this.enabled=this._loader.isExtensionUsed(tw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.Ge.extensions;if(w&&w[this.name]){const p=w[this.name];this._lights=p.lights,H.Assign(this._lights)}}loadNodeAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,f)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(w,p,(w=>{let p;const q=H.Get(r,this._lights,f.pe),E=q.name||w.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,q.type){case"directional":{const w=new sw.d(E,I.k.Backward(),this._loader.babylonScene);w.position.Pe(0),p=w;break}case"point":p=new iw(E,I.k.Zero(),this._loader.babylonScene);break;case"spot":{const w=new Xw.e(E,I.k.Zero(),I.k.Backward(),0,1,this._loader.babylonScene);w.angle=2*(q.spot&&q.spot.outerConeAngle||Math.PI/4),w.innerAngle=2*(q.spot&&q.spot.innerConeAngle||0),p=w;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${r}: Invalid light type (${q.type})`)}p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,q._babylonLight=p,p.falloffType=kw.b.FALLOFF_GLTF,p.br=q.color?d.b.Ve(q.color):d.b.White(),p.Se=void 0==q.Se?1:q.Se,p.range=void 0==q.range?Number.MAX_VALUE:q.range,p.parent=w,this._loader._babylonLights.push(p),D.AddPointerMetadata(p,r),e(w)})))))}}Y(tw),u(tw,!0,(w=>new nw(w)));const lw="KHR_materials_pbrSpecularGlossiness";class Nw{constructor(w){this.name=lw,this.order=200,this._loader=w,this.enabled=this._loader.isExtensionUsed(lw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialBasePropertiesAsync(w,p,e)),d.push(this._loadSpecularGlossinessPropertiesAsync(r,I,e)),this._loader.loadMaterialAlphaProperties(w,p,e),await Promise.all(d).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.metallic=null,e.roughness=null,p.diffuseFactor?(e.albedoColor=d.b.Ve(p.diffuseFactor),e.alpha=p.diffuseFactor[3]):e.albedoColor=d.b.White(),e.reflectivityColor=p.specularFactor?d.b.Ve(p.specularFactor):d.b.White(),e.microSurface=void 0==p.glossinessFactor?1:p.glossinessFactor,p.diffuseTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTexture`,p.diffuseTexture,(w=>{w.name=`${e.name} (Diffuse)`,e.albedoTexture=w}))),p.specularGlossinessTexture&&(r.push(this._loader.loadTextureInfoAsync(`${w}/specularGlossinessTexture`,p.specularGlossinessTexture,(w=>{w.name=`${e.name} (Specular Glossiness)`,e.reflectivityTexture=w,e.reflectivityTexture.ie=!0}))),e.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(r).then((()=>{}))}}Y(lw),u(lw,!0,(w=>new Nw(w)));const Uw="KHR_materials_unlit";class vw{constructor(w){this.name=Uw,this.order=210,this._loader=w,this.enabled=this._loader.isExtensionUsed(Uw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async()=>await this._loadUnlitPropertiesAsync(w,p,e)))}_loadUnlitPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;e.unlit=!0;const I=p.pbrMetallicRoughness;return I&&(I.baseColorFactor?(e.albedoColor=d.b.Ve(I.baseColorFactor),e.alpha=I.baseColorFactor[3]):e.albedoColor=d.b.White(),I.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/baseColorTexture`,I.baseColorTexture,(w=>{w.name=`${e.name} (Base Color)`,e.albedoTexture=w})))),p.doubleSided&&(e.ce=!1,e.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(w,p,e),Promise.all(r).then((()=>{}))}}Y(Uw),u(Uw,!0,(w=>new vw(w)));const Rw="KHR_materials_clearcoat";class Vw{constructor(w){this.name=Rw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Rw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadClearCoatPropertiesAsync(r,I,e)),await Promise.all(d)}))}_loadClearCoatPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.clearCoat.isEnabled=!0,e.clearCoat.useRoughnessFromMainTexture=!1,e.clearCoat.remapF0OnInterfaceChange=!1,void 0!=p.clearcoatFactor?e.clearCoat.Se=p.clearcoatFactor:e.clearCoat.Se=0,p.clearcoatTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatTexture`,p.clearcoatTexture,(w=>{w.name=`${e.name} (ClearCoat)`,e.clearCoat.texture=w}))),void 0!=p.clearcoatRoughnessFactor?e.clearCoat.roughness=p.clearcoatRoughnessFactor:e.clearCoat.roughness=0,p.clearcoatRoughnessTexture&&(p.clearcoatRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatRoughnessTexture`,p.clearcoatRoughnessTexture,(w=>{w.name=`${e.name} (ClearCoat Roughness)`,e.clearCoat.textureRoughness=w})))),p.clearcoatNormalTexture&&(p.clearcoatNormalTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatNormalTexture`,p.clearcoatNormalTexture,(w=>{w.name=`${e.name} (ClearCoat Normal)`,e.clearCoat.bumpTexture=w}))),e.invertNormalMapX=!e.iw().useRightHandedSystem,e.invertNormalMapY=e.iw().useRightHandedSystem,void 0!=p.clearcoatNormalTexture.scale&&(e.clearCoat.bumpTexture.level=p.clearcoatNormalTexture.scale)),Promise.all(r).then((()=>{}))}}Y(Rw),u(Rw,!0,(w=>new Vw(w)));const bw="KHR_materials_iridescence";class hw{constructor(w){this.name=bw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(bw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadIridescencePropertiesAsync(r,I,e)),await Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.iridescence.isEnabled=!0,e.iridescence.Se=p.iridescenceFactor??0,e.iridescence.indexOfRefraction=p.iridescenceIor??p.iridescenceIOR??1.3,e.iridescence.minimumThickness=p.iridescenceThicknessMinimum??100,e.iridescence.maximumThickness=p.iridescenceThicknessMaximum??400,p.iridescenceTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceTexture`,p.iridescenceTexture,(w=>{w.name=`${e.name} (Iridescence)`,e.iridescence.texture=w}))),p.iridescenceThicknessTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceThicknessTexture`,p.iridescenceThicknessTexture,(w=>{w.name=`${e.name} (Iridescence Thickness)`,e.iridescence.thicknessTexture=w}))),Promise.all(r).then((()=>{}))}}Y(bw),u(bw,!0,(w=>new hw(w)));const Pw="KHR_materials_anisotropy";class uw{constructor(w){this.name=Pw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(Pw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadIridescencePropertiesAsync(r,I,e)),await Promise.all(d)}))}async _loadIridescencePropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;e.anisotropy.isEnabled=!0,e.anisotropy.Se=p.anisotropyStrength??0,e.anisotropy.angle=p.anisotropyRotation??0,p.anisotropyTexture&&(p.anisotropyTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${w}/anisotropyTexture`,p.anisotropyTexture,(w=>{w.name=`${e.name} (Anisotropy Intensity)`,e.anisotropy.texture=w})))),await Promise.all(r)}}Y(Pw),u(Pw,!0,(w=>new uw(w)));const Yw="KHR_materials_emissive_strength";class Lw{constructor(w){this.name=Yw,this.order=170,this._loader=w,this.enabled=this._loader.isExtensionUsed(Yw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>await this._loader.loadMaterialPropertiesAsync(w,p,e).then((()=>{this._loadEmissiveProperties(r,I,e)}))))}_loadEmissiveProperties(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);void 0!==p.emissiveStrength&&(e.emissiveIntensity=p.emissiveStrength)}}Y(Yw),u(Yw,!0,(w=>new Lw(w)));const Ww="KHR_materials_sheen";class Fw{constructor(w){this.name=Ww,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Ww)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadSheenPropertiesAsync(r,I,e)),await Promise.all(d).then((()=>{}))}))}_loadSheenPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.sheen.isEnabled=!0,e.sheen.Se=1,void 0!=p.sheenColorFactor?e.sheen.color=d.b.Ve(p.sheenColorFactor):e.sheen.color=d.b.Black(),p.sheenColorTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/sheenColorTexture`,p.sheenColorTexture,(w=>{w.name=`${e.name} (Sheen Color)`,e.sheen.texture=w}))),void 0!==p.sheenRoughnessFactor?e.sheen.roughness=p.sheenRoughnessFactor:e.sheen.roughness=0,p.sheenRoughnessTexture&&(p.sheenRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${w}/sheenRoughnessTexture`,p.sheenRoughnessTexture,(w=>{w.name=`${e.name} (Sheen Roughness)`,e.sheen.textureRoughness=w})))),e.sheen.albedoScaling=!0,e.sheen.useRoughnessFromMainTexture=!1,Promise.all(r).then((()=>{}))}}Y(Ww),u(Ww,!0,(w=>new Fw(w)));var Hw=e(11552);const Bw="KHR_materials_specular";class Dw{constructor(w){this.name=Bw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Bw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;if(d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadSpecularPropertiesAsync(r,I,e)),I.extensions&&I.extensions.EXT_materials_specular_edge_color&&e instanceof a.d){I.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(e.brdf.dielectricSpecularModel=Hw.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,e.brdf.conductorSpecularModel=Hw.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(d).then((()=>{}))}))}_loadSpecularPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return void 0!==p.specularFactor&&(e.metallicF0Factor=p.specularFactor),void 0!==p.specularColorFactor&&(e.metallicReflectanceColor=d.b.Ve(p.specularColorFactor)),p.specularTexture&&(p.specularTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${w}/specularTexture`,p.specularTexture,(w=>{w.name=`${e.name} (Specular)`,e.metallicReflectanceTexture=w,e.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),p.specularColorTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/specularColorTexture`,p.specularColorTexture,(w=>{w.name=`${e.name} (Specular Color)`,e.reflectanceTexture=w}))),Promise.all(r).then((()=>{}))}}Y(Bw),u(Bw,!0,(w=>new Dw(w)));const Tw="KHR_materials_ior";class Zw{constructor(w){this.name=Tw,this.order=180,this._loader=w,this.enabled=this._loader.isExtensionUsed(Tw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadIorPropertiesAsync(r,I,e)),await Promise.all(d).then((()=>{}))}))}_loadIorPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);return void 0!==p.ior?e.indexOfRefraction=p.ior:e.indexOfRefraction=Zw._DEFAULT_IOR,Promise.resolve()}}Zw._DEFAULT_IOR=1.5,Y(Tw),u(Tw,!0,(w=>new Zw(w)));const Gw="KHR_materials_variants";class gw{constructor(w){this.name=Gw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Gw)}dispose(){this._loader=null}static GetAvailableVariants(w){const p=this._GetExtensionMetadata(w);return p?Object.keys(p.variants):[]}getAvailableVariants(w){return gw.GetAvailableVariants(w)}static SelectVariant(w,p){const e=this._GetExtensionMetadata(w);if(!e)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Gw} extension`);const r=w=>{const p=e.variants[w];if(p)for(const e of p)e.mesh.material=e.material};if(p instanceof Array)for(const I of p)r(I);else r(p);e.lastSelected=p}selectVariant(w,p){gw.SelectVariant(w,p)}static Reset(w){const p=this._GetExtensionMetadata(w);if(!p)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Gw} extension`);for(const e of p.original)e.mesh.material=e.material;p.lastSelected=null}reset(w){gw.Reset(w)}static GetLastSelectedVariant(w){const p=this._GetExtensionMetadata(w);if(!p)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Gw} extension`);return p.lastSelected}getLastSelectedVariant(w){return gw.GetLastSelectedVariant(w)}static _GetExtensionMetadata(w){var p,e;return(null===w||void 0===w||null===(p=w._internalMetadata)||void 0===p||null===(e=p.Ge)||void 0===e?void 0:e[Gw])||null}onLoading(){const w=this._loader.Ge.extensions;if(w&&w[this.name]){const p=w[this.name];this._variants=p.variants}}onReady(){const w=this._loader.rootBabylonMesh;if(w){var p;const e=this._loader.parent.extensionOptions[Gw];null!==e&&void 0!==e&&e.defaultVariant&&gw.SelectVariant(w,e.defaultVariant),null===e||void 0===e||null===(p=e.onLoaded)||void 0===p||p.call(e,{get variants(){return gw.GetAvailableVariants(w)},get selectedVariant(){const p=gw.GetLastSelectedVariant(w);return p?Array.isArray(p)?p[0]:p:gw.GetAvailableVariants(w)[0]},set selectedVariant(p){gw.SelectVariant(w,p)}})}}_loadMeshPrimitiveAsync(w,p,e,r,I,d){return D.LoadExtensionAsync(w,I,this.name,(async(f,q)=>{const E=new Array;return E.push(this._loader._loadMeshPrimitiveAsync(w,p,e,r,I,(p=>{if(d(p),p instanceof n.c){const e=D._GetDrawMode(w,I.mode),r=this._loader.rootBabylonMesh,d=r?r._internalMetadata=r._internalMetadata||{}:{},j=d.Ge=d.Ge||{},X=j[Gw]=j[Gw]||{lastSelected:null,original:[],variants:{}};X.original.push({mesh:p,material:p.material});for(let w=0;w<q.mappings.length;++w){const I=q.mappings[w],d=H.Get(`${f}/mappings/${w}/material`,this._loader.Ge.materials,I.material);E.push(this._loader._loadMaterialAsync(`#/materials/${I.material}`,d,p,e,(w=>{for(let e=0;e<I.variants.length;++e){const d=I.variants[e],f=H.Get(`/extensions/${Gw}/variants/${d}`,this._variants,d);X.variants[f.name]=X.variants[f.name]||[],X.variants[f.name].push({mesh:p,material:w}),p.onClonedObservable.add((w=>{const e=w;let I=null,d=e;do{if(d=d.parent,!d)return;I=gw._GetExtensionMetadata(d)}while(null===I);if(r&&I===gw._GetExtensionMetadata(r)){d._internalMetadata={};for(const w in r._internalMetadata)d._internalMetadata[w]=r._internalMetadata[w];d._internalMetadata.Ge=[];for(const w in r._internalMetadata.Ge)d._internalMetadata.Ge[w]=r._internalMetadata.Ge[w];d._internalMetadata.Ge[Gw]={lastSelected:null,original:[],variants:{}};for(const w of I.original)d._internalMetadata.Ge[Gw].original.push({mesh:w.mesh,material:w.material});for(const w in I.variants)if(Object.prototype.hasOwnProperty.call(I.variants,w)){d._internalMetadata.Ge[Gw].variants[w]=[];for(const p of I.variants[w])d._internalMetadata.Ge[Gw].variants[w].push({mesh:p.mesh,material:p.material})}I=d._internalMetadata.Ge[Gw]}for(const r of I.original)r.mesh===p&&(r.mesh=e);for(const r of I.variants[f.name])r.mesh===p&&(r.mesh=e)}))}})))}}}))),await Promise.all(E).then((w=>{let[p]=w;return p}))}))}}Y(Gw),u(Gw,!0,(w=>new gw(w)));var ow=e(11517);class Cw{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Hw.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(w,p){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Cw._GetDefaultOptions(),...w},this._scene=p,this._scene._transmissionHelper=this,this.onErrorObservable=new X.d,this._scene.ue.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(w){if(!Object.keys(w).filter((p=>this._options[p]!==w[p])).length)return;const p={...this._options,...w},e=this._options;this._options=p,p.renderSize===e.renderSize&&p.renderTargetTextureType===e.renderTargetTextureType&&p.generateMipmaps===e.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=p.samples,this._opaqueRenderTarget.lodGenerationScale=p.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=p.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(w){return!!w&&!!(w instanceof a.d&&w.subSurface.isRefractionEnabled)}_addMesh(w){this._materialObservers[w.uniqueId]=w.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),f.g.SetImmediate((()=>{this._shouldRenderAsTransmission(w.material)?(w.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(w)&&this._transparentMeshesCache.push(w)):-1===this._opaqueMeshesCache.indexOf(w)&&this._opaqueMeshesCache.push(w)}))}_removeMesh(w){w.onMaterialChangedObservable.remove(this._materialObservers[w.uniqueId]),delete this._materialObservers[w.uniqueId];let p=this._transparentMeshesCache.indexOf(w);-1!==p&&this._transparentMeshesCache.splice(p,1),p=this._opaqueMeshesCache.indexOf(w),-1!==p&&this._opaqueMeshesCache.splice(p,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(w){const p=this._transparentMeshesCache.indexOf(w),e=this._opaqueMeshesCache.indexOf(w);this._shouldRenderAsTransmission(w.material)?(w.material instanceof a.d&&(w.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==e?(this._opaqueMeshesCache.splice(e,1),this._transparentMeshesCache.push(w)):-1===p&&this._transparentMeshesCache.push(w)):-1!==p?(this._transparentMeshesCache.splice(p,1),this._opaqueMeshesCache.push(w)):-1===e&&this._opaqueMeshesCache.push(w)}_isRenderTargetValid(){var w;return null!==(null===(w=this._opaqueRenderTarget)||void 0===w?void 0:w.getInternalTexture())}_setupRenderTargets(){var w;let p;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ow.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(w=this._options.clearColor)||void 0===w?void 0:w.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((w=>{p=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?w.clearColor.X(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(w.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=p}));for(const e of this._transparentMeshesCache)this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Qw="KHR_materials_transmission";class xw{constructor(w){this.name=Qw,this.order=175,this._loader=w,this.enabled=this._loader.isExtensionUsed(Qw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadTransparentPropertiesAsync(r,p,e,I)),await Promise.all(d).then((()=>{}))}))}_loadTransparentPropertiesAsync(w,p,e,r){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const I=e;if(I.subSurface.isRefractionEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.useAlbedoToTintRefraction=!0,void 0===r.transmissionFactor)return I.subSurface.refractionIntensity=0,I.subSurface.isRefractionEnabled=!1,Promise.resolve();{var d;I.subSurface.refractionIntensity=r.transmissionFactor;const w=I.iw();if(I.subSurface.refractionIntensity&&!w._transmissionHelper)new Cw({},I.iw());else if(I.subSurface.refractionIntensity&&(null===(d=w._transmissionHelper)||void 0===d||!d._isRenderTargetValid())){var f;null===(f=w._transmissionHelper)||void 0===f||f._setupRenderTargets()}}return I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,r.transmissionTexture?(r.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/transmissionTexture`,r.transmissionTexture,void 0).then((w=>{w.name=`${e.name} (Transmission)`,I.subSurface.refractionIntensityTexture=w,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(Qw),u(Qw,!0,(w=>new xw(w)));const Sw="KHR_materials_diffuse_transmission";class wp{constructor(w){this.name=Sw,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(Sw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadTranslucentPropertiesAsync(r,p,e,I)),await Promise.all(d).then((()=>{}))}))}_loadTranslucentPropertiesAsync(w,p,e,r){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const I=e;if(I.subSurface.isTranslucencyEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,I.subSurface.useAlbedoToTintTranslucency=!1,void 0===r.diffuseTransmissionFactor)return I.subSurface.translucencyIntensity=0,I.subSurface.isTranslucencyEnabled=!1,Promise.resolve();I.subSurface.translucencyIntensity=r.diffuseTransmissionFactor;const f=new Array;return I.subSurface.useGltfStyleTextures=!0,r.diffuseTransmissionTexture&&(r.diffuseTransmissionTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionTexture`,r.diffuseTransmissionTexture).then((w=>{w.name=`${e.name} (Diffuse Transmission)`,I.subSurface.translucencyIntensityTexture=w})))),void 0!==r.diffuseTransmissionColorFactor?I.subSurface.translucencyColor=d.b.Ve(r.diffuseTransmissionColorFactor):I.subSurface.translucencyColor=d.b.White(),r.diffuseTransmissionColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionColorTexture`,r.diffuseTransmissionColorTexture).then((w=>{w.name=`${e.name} (Diffuse Transmission Color)`,I.subSurface.translucencyColorTexture=w}))),Promise.all(f).then((()=>{}))}}Y(Sw),u(Sw,!0,(w=>new wp(w)));const pp="KHR_materials_volume";class ep{constructor(w){this.name=pp,this.order=173,this._loader=w,this.enabled=this._loader.isExtensionUsed(pp),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadVolumePropertiesAsync(r,p,e,I)),await Promise.all(d).then((()=>{}))}))}_loadVolumePropertiesAsync(w,p,e,r){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);if(!e.subSurface.isRefractionEnabled&&!e.subSurface.isTranslucencyEnabled||!r.thicknessFactor)return Promise.resolve();e.subSurface.volumeIndexOfRefraction=e.indexOfRefraction;const I=void 0!==r.attenuationDistance?r.attenuationDistance:Number.MAX_VALUE;return e.subSurface.tintColorAtDistance=I,void 0!==r.attenuationColor&&3==r.attenuationColor.length&&e.subSurface.tintColor.te(r.attenuationColor[0],r.attenuationColor[1],r.attenuationColor[2]),e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=r.thicknessFactor,e.subSurface.useThicknessAsDepth=!0,r.thicknessTexture?(r.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/thicknessTexture`,r.thicknessTexture).then((w=>{w.name=`${e.name} (Thickness)`,e.subSurface.thicknessTexture=w,e.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Y(pp),u(pp,!0,(w=>new ep(w)));const rp="KHR_materials_dispersion";class Ip{constructor(w){this.name=rp,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(rp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadDispersionPropertiesAsync(r,p,e,I)),await Promise.all(d).then((()=>{}))}))}_loadDispersionPropertiesAsync(w,p,e,r){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);return e.subSurface.isRefractionEnabled&&r.dispersion?(e.subSurface.isDispersionEnabled=!0,e.subSurface.dispersion=r.dispersion,Promise.resolve()):Promise.resolve()}}Y(rp),u(rp,!0,(w=>new Ip(w)));const dp="EXT_materials_diffuse_roughness";class fp{constructor(w){this.name=dp,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(dp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(w,p,e)),d.push(this._loadDiffuseRoughnessPropertiesAsync(r,I,e)),await Promise.all(d).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(w,p,e){if(!(e instanceof a.d))throw new Error(`${w}: Material type not supported`);const r=new Array;return e.brdf.baseDiffuseModel=Hw.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=p.diffuseRoughnessFactor?e.baseDiffuseRoughness=p.diffuseRoughnessFactor:e.baseDiffuseRoughness=0,p.diffuseRoughnessTexture&&r.push(this._loader.loadTextureInfoAsync(`${w}/diffuseRoughnessTexture`,p.diffuseRoughnessTexture,(w=>{w.name=`${e.name} (Diffuse Roughness)`,e.baseDiffuseRoughnessTexture=w}))),Promise.all(r).then((()=>{}))}}Y(dp),u(dp,!0,(w=>new fp(w)));const qp="KHR_mesh_quantization";class Ep{constructor(w){this.name=qp,this.enabled=w.isExtensionUsed(qp)}dispose(){}}Y(qp),u(qp,!0,(w=>new Ep(w)));const jp="KHR_texture_basisu";class Xp{constructor(w){this.name=jp,this._loader=w,this.enabled=w.isExtensionUsed(jp)}dispose(){this._loader=null}_loadTextureAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>{const d=void 0==p.sampler?D.DefaultSampler:H.Get(`${w}/sampler`,this._loader.Ge.samplers,p.sampler),f=H.Get(`${r}/source`,this._loader.Ge.images,I.source);return await this._loader._createTextureAsync(w,d,f,(w=>{e(w)}),p._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!p._textureInfo.nonColorData)}))}}Y(jp),u(jp,!0,(w=>new Xp(w)));const kp="KHR_texture_transform";class mp{constructor(w){this.name=kp,this._loader=w,this.enabled=this._loader.isExtensionUsed(kp)}dispose(){this._loader=null}loadTextureInfoAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(r,I)=>await this._loader.loadTextureInfoAsync(w,p,(w=>{if(!(w instanceof A.e))throw new Error(`${r}: Texture type not supported`);I.offset&&(w.uOffset=I.offset[0],w.vOffset=I.offset[1]),w.uRotationCenter=0,w.vRotationCenter=0,I.rotation&&(w.wAng=-I.rotation),I.scale&&(w.uScale=I.scale[0],w.vScale=I.scale[1]),void 0!=I.texCoord&&(w.coordinatesIndex=I.texCoord),e(w)}))))}}Y(kp),u(kp,!0,(w=>new mp(w)));const Jp="KHR_xmp_json_ld";class Kp{constructor(w){this.name=Jp,this.order=100,this._loader=w,this.enabled=this._loader.isExtensionUsed(Jp)}dispose(){this._loader=null}onLoading(){var w,p,e;if(null===this._loader.rootBabylonMesh)return;const r=null===(w=this._loader.Ge.extensions)||void 0===w?void 0:w.KHR_xmp_json_ld,I=null===(p=this._loader.Ge.asset)||void 0===p||null===(e=p.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld;if(r&&I){const w=+I.packet;r.packets&&w<r.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=r.packets[w])}}}function yp(w,p,e,r){return d.b.Ve(p,e).scale(r)}function cp(w,p,e,r){return p[e]*r}function sp(w,p,e,r){return-p[e]*r}function Op(w,p,e,r){return p[e+1]*r}function ap(w,p,e,r){return p[e]*r*2}function Ap(w){return{scale:[new Mp(m.c.ANIMATIONTYPE_FLOAT,`${w}.uScale`,cp,(()=>2)),new Mp(m.c.ANIMATIONTYPE_FLOAT,`${w}.vScale`,Op,(()=>2))],offset:[new Mp(m.c.ANIMATIONTYPE_FLOAT,`${w}.uOffset`,cp,(()=>2)),new Mp(m.c.ANIMATIONTYPE_FLOAT,`${w}.vOffset`,Op,(()=>2))],rotation:[new Mp(m.c.ANIMATIONTYPE_FLOAT,`${w}.wAng`,sp,(()=>1))]}}Y(Jp),u(Jp,!0,(w=>new Kp(w)));class zp extends T.AnimationPropertyInfo{buildAnimations(w,p,e,r){return[{babylonAnimatable:w._babylonCamera,babylonAnimation:this._buildAnimation(p,e,r)}]}}class Mp extends T.AnimationPropertyInfo{buildAnimations(w,p,e,r){const I=[];for(const d in w._data)I.push({babylonAnimatable:w._data[d].babylonMaterial,babylonAnimation:this._buildAnimation(p,e,r)});return I}}class ip extends T.AnimationPropertyInfo{buildAnimations(w,p,e,r){return[{babylonAnimatable:w._babylonLight,babylonAnimation:this._buildAnimation(p,e,r)}]}}(0,L.i)("/cameras/{}/orthographic/xmag",[new zp(m.c.ANIMATIONTYPE_FLOAT,"orthoLeft",sp,(()=>1)),new zp(m.c.ANIMATIONTYPE_FLOAT,"orthoRight",Op,(()=>1))]),(0,L.i)("/cameras/{}/orthographic/ymag",[new zp(m.c.ANIMATIONTYPE_FLOAT,"orthoBottom",sp,(()=>1)),new zp(m.c.ANIMATIONTYPE_FLOAT,"orthoTop",Op,(()=>1))]),(0,L.i)("/cameras/{}/orthographic/zfar",[new zp(m.c.ANIMATIONTYPE_FLOAT,"maxZ",cp,(()=>1))]),(0,L.i)("/cameras/{}/orthographic/znear",[new zp(m.c.ANIMATIONTYPE_FLOAT,"ge",cp,(()=>1))]),(0,L.i)("/cameras/{}/perspective/yfov",[new zp(m.c.ANIMATIONTYPE_FLOAT,"fov",cp,(()=>1))]),(0,L.i)("/cameras/{}/perspective/zfar",[new zp(m.c.ANIMATIONTYPE_FLOAT,"maxZ",cp,(()=>1))]),(0,L.i)("/cameras/{}/perspective/znear",[new zp(m.c.ANIMATIONTYPE_FLOAT,"ge",cp,(()=>1))]),(0,L.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"albedoColor",yp,(()=>4)),new Mp(m.c.ANIMATIONTYPE_FLOAT,"alpha",(function(w,p,e,r){return p[e+3]*r}),(()=>4))]),(0,L.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"metallic",cp,(()=>1))]),(0,L.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"roughness",cp,(()=>1))]);const tp=Ap("albedoTexture");(0,L.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",tp.scale),(0,L.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",tp.offset),(0,L.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",tp.rotation);const np=Ap("metallicTexture");(0,L.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",np.scale),(0,L.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",np.offset),(0,L.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",np.rotation),(0,L.i)("/materials/{}/emissiveFactor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"emissiveColor",yp,(()=>3))]);const lp=Ap("bumpTexture");(0,L.i)("/materials/{}/normalTexture/scale",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cp,(()=>1))]),(0,L.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",lp.scale),(0,L.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",lp.offset),(0,L.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",lp.rotation),(0,L.i)("/materials/{}/occlusionTexture/strength",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cp,(()=>1))]);const Np=Ap("ambientTexture");(0,L.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Np.scale),(0,L.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Np.offset),(0,L.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Np.rotation);const Up=Ap("emissiveTexture");(0,L.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Up.scale),(0,L.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Up.offset),(0,L.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Up.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cp,(()=>1))]);const vp=Ap("anisotropy.texture");(0,L.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",vp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",vp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",vp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cp,(()=>1))]);const Rp=Ap("clearCoat.texture");(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Rp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Rp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Rp.rotation);const Vp=Ap("clearCoat.bumpTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Vp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Vp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Vp.rotation);const bp=Ap("clearCoat.textureRoughness");(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",bp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",bp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",bp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cp,(()=>1))]);const hp=Ap("iridescence.texture");(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hp.rotation);const Pp=Ap("iridescence.thicknessTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Pp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Pp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Pp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"sheen.color",yp,(()=>3))]),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",cp,(()=>1))]);const up=Ap("sheen.texture");(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",up.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",up.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",up.rotation);const Yp=Ap("sheen.textureRoughness");(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Yp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Yp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Yp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",yp,(()=>3))]);const Lp=Ap("metallicReflectanceTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Lp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Lp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Lp.rotation);const Wp=Ap("reflectanceTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Wp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Wp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Wp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cp,(()=>1))]);const Fp=Ap("subSurface.refractionIntensityTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Fp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Fp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Fp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",yp,(()=>3))]),(0,L.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cp,(()=>1))]),(0,L.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cp,(()=>1))]);const Hp=Ap("subSurface.thicknessTexture");(0,L.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Hp.scale),(0,L.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Hp.offset),(0,L.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Hp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Mp(m.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cp,(()=>1))]);const Bp=Ap("subSurface.translucencyIntensityTexture");(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Bp.scale),(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Bp.offset),(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Bp.rotation),(0,L.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Mp(m.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",yp,(()=>3))]);const Dp=Ap("subSurface.translucencyColorTexture");(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Dp.scale),(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Dp.offset),(0,L.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Dp.rotation),(0,L.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new ip(m.c.ANIMATIONTYPE_COLOR3,"diffuse",yp,(()=>3))]),(0,L.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ip(m.c.ANIMATIONTYPE_FLOAT,"intensity",cp,(()=>1))]),(0,L.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new ip(m.c.ANIMATIONTYPE_FLOAT,"range",cp,(()=>1))]),(0,L.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ip(m.c.ANIMATIONTYPE_FLOAT,"innerAngle",ap,(()=>1))]),(0,L.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ip(m.c.ANIMATIONTYPE_FLOAT,"angle",ap,(()=>1))]),(0,L.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new ip(m.c.ANIMATIONTYPE_COLOR3,"diffuse",yp,(()=>3))]),(0,L.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ip(m.c.ANIMATIONTYPE_FLOAT,"intensity",cp,(()=>1))]);const Tp="KHR_animation_pointer";class Zp{constructor(w){this.name=Tp,this._loader=w,this._pathToObjectConverter=(0,L.g)(this._loader.Ge)}get enabled(){return this._loader.isExtensionUsed(Tp)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(w,p,e,r,I){var d;const f=null===(d=r.target.extensions)||void 0===d?void 0:d.KHR_animation_pointer;if(!f||!this._pathToObjectConverter)return null;"pointer"!==r.target.path&&y.c.Warn(`${w}/target/path: Value (${r.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=r.target.node&&y.c.Warn(`${w}/target/node: Value (${r.target.node}) must not be present when using the ${this.name} extension`);const q=`${w}/extensions/${this.name}`,E=f.pointer;if(!E)throw new Error(`${q}: Pointer is missing`);try{const d=this._pathToObjectConverter.convert(E);if(!d.info.interpolation)throw new Error(`${q}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(w,p,e,r,{object:d.object,info:d.info.interpolation},I)}catch(j){return y.c.Warn(`${q}/pointer: Invalid pointer (${E}) skipped`),null}}}Y(Tp),u(Tp,!0,(w=>new Zp(w)));class Gp{constructor(w,p,e){this.frame=w,this.action=p,this.onlyOnce=e,this.isDone=!1}_clone(){return new Gp(this.frame,this.action,this.onlyOnce)}}var gp=e(11094),op=e(11132),Cp=e(11127);class Qp{get loop(){return this._loop}set loop(w){w!==this._loop&&(this._loop=w,this.updateOptions({loop:w}))}get currentTime(){var w;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(w=op.d.audioEngine)&&void 0!==w&&w.audioContext&&(this.isPlaying||this.isPaused)){const w=this.isPaused?0:op.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+w}return 0}get spatialSound(){return this._spatialSound}set spatialSound(w){if(w==this._spatialSound)return;const p=this.isPlaying;this.pause(),w?(this._spatialSound=w,this._updateSpatialParameters()):this._disableSpatialSound(),p&&this.play()}constructor(w,p,e){var r;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new X.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=I.k.Zero(),this._localDirection=new I.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=w,e=e||K.d.LastCreatedScene)if(this._scene=e,Qp._SceneComponentInitialization(e),this._readyToPlayCallback=d,this._customAttenuationFunction=(w,p,e,r,I)=>p<e?w*(1-p/e):0,q&&(this.autoplay=q.autoplay||!1,this._loop=q.loop||!1,void 0!==q.volume&&(this._volume=q.volume),this._spatialSound=q.spatialSound??!1,this.maxDistance=q.maxDistance??100,this.useCustomAttenuation=q.useCustomAttenuation??!1,this.rolloffFactor=q.rolloffFactor||1,this.refDistance=q.refDistance||1,this.distanceModel=q.distanceModel||"linear",this._playbackRate=q.playbackRate||1,this._streaming=q.streaming??!1,this._length=q.length,this._offset=q.offset),null!==(r=op.d.audioEngine)&&void 0!==r&&r.canUseWebAudio&&op.d.audioEngine.audioContext){this._soundGain=op.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let w=!0;if(p)try{"string"===typeof p?(this._urlType="String",this._url=p):p instanceof ArrayBuffer?this._urlType="ArrayBuffer":p instanceof HTMLMediaElement?this._urlType="MediaElement":p instanceof MediaStream?this._urlType="MediaStream":p instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(p)&&(this._urlType="Array");let e=[],r=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=op.d.audioEngine.audioContext.createMediaElementSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=op.d.audioEngine.audioContext.createMediaStreamSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":p.byteLength>0&&(r=!0,this._soundLoaded(p));break;case"AudioBuffer":this._audioBufferLoaded(p);break;case"String":e.push(p);case"Array":0===e.length&&(e=p);for(let w=0;w<e.length;w++){const p=e[w];if(r=q&&q.skipCodecCheck||-1!==p.indexOf(".mp3",p.length-4)&&op.d.audioEngine.isMP3supported||-1!==p.indexOf(".ogg",p.length-4)&&op.d.audioEngine.isOGGsupported||-1!==p.indexOf(".wav",p.length-4)||-1!==p.indexOf(".m4a",p.length-4)||-1!==p.indexOf(".mp4",p.length-4)||-1!==p.indexOf("blob:"),r){this._streaming?(this._htmlAudioElement=new Audio(p),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,f.g.SetCorsBehavior(p,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(p,(w=>{this._soundLoaded(w)}),void 0,!0,!0,(w=>{w&&y.c.Error("XHR "+w.status+" error on: "+p+"."),y.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:w=!1}w?r||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):y.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(E){y.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),op.d.audioEngine&&!op.d.audioEngine.WarnedWebAudioUnsupported&&(y.c.Error("Web Audio is not supported by your browser."),op.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var w;null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(w){var p;null!==(p=op.d.audioEngine)&&void 0!==p&&p.audioContext&&(this._audioBuffer=w,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(w){var p;null!==(p=op.d.audioEngine)&&void 0!==p&&p.audioContext&&op.d.audioEngine.audioContext.decodeAudioData(w,(w=>{this._audioBufferLoaded(w)}),(w=>{y.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+w)}))}setAudioBuffer(w){var p;null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&(this._audioBuffer=w,this._isReadyToPlay=!0)}updateOptions(w){w&&(this.loop=w.loop??this.loop,this.maxDistance=w.maxDistance??this.maxDistance,this.useCustomAttenuation=w.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=w.rolloffFactor??this.rolloffFactor,this.refDistance=w.refDistance??this.refDistance,this.distanceModel=w.distanceModel??this.distanceModel,this._playbackRate=w.playbackRate??this._playbackRate,this._length=w.length??void 0,this.spatialSound=w.spatialSound??this._spatialSound,this._setOffset(w.offset??void 0),this.setVolume(w.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var w;null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&op.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??op.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var w;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(w=this._soundPanner)||void 0===w||w.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var w;null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(w){var p;null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(w),this._isOutputConnected=!0)}setDirectionalCone(w,p,e){p<w?y.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=w,this._coneOuterAngle=p,this._coneOuterGain=e,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!=this._coneInnerAngle){var p;if(this._coneOuterAngle<w)return void y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w,null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!=this._coneOuterAngle){var p;if(w<this._coneInnerAngle)return void y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w,null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(w){var p;w.equals(this._position)||(this._position.X(w),null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(w){var p;this._localDirection=w,null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const w=this._connectedTransformNode.getWorldMatrix(),p=I.k.TransformNormal(this._localDirection,w);p.normalize(),this._soundPanner.orientationX.value=p.x,this._soundPanner.orientationY.value=p.y,this._soundPanner.orientationZ.value=p.z}updateDistanceFromListener(){var w;if(null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const w=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Je(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,w,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(w){this._customAttenuationFunction=w}play(w,p,e){var r;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(r=op.d.audioEngine)&&void 0!==r&&r.audioContext)try{var I,d;this._clearTimeoutsAndObservers();let r=w?(null===(I=op.d.audioEngine)||void 0===I?void 0:I.audioContext.currentTime)+w:null===(d=op.d.audioEngine)||void 0===d?void 0:d.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=op.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const w=()=>{var e;if(null!==(e=op.d.audioEngine)&&void 0!==e&&e.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=p??0;const e=this._htmlAudioElement.play();void 0!==e&&e.catch((()=>{var p,e;(null===(p=op.d.audioEngine)||void 0===p||p.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(e=op.d.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{w()})))}))}else{var r;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(r=op.d.audioEngine)||void 0===r?void 0:r.onAudioUnlockedObservable.addOnce((()=>{w()}))}};w()}}else{var f;const I=()=>{var I;if(null!==(I=op.d.audioEngine)&&void 0!==I&&I.audioContext){var d;if(e=e||this._length,void 0!==p&&this._setOffset(p),this._soundSource){const w=this._soundSource;w.onended=()=>{w.disconnect()}}if(this._soundSource=null===(d=op.d.audioEngine)||void 0===d?void 0:d.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var f;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==p&&(this._soundSource.loopStart=p),void 0!==e&&(this._soundSource.loopEnd=(0|p)+e),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},r=w?(null===(f=op.d.audioEngine)||void 0===f?void 0:f.audioContext.currentTime)+w:op.d.audioEngine.audioContext.currentTime;const I=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(r,I,this.loop?void 0:e)}}};"suspended"===(null===(f=op.d.audioEngine)||void 0===f?void 0:f.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var w;"suspended"===(null===(w=op.d.audioEngine)||void 0===w?void 0:w.audioContext.state)?(op.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=op.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{I()})))):I()}),500):I()}this._startTime=r,this.isPlaying=!0,this.isPaused=!1}catch(q){y.c.Error("Error while trying to play audio: "+this.name+", "+q.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(w){var p;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var e;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(e=this._streamingSource)||void 0===e||e.disconnect();this.isPlaying=!1}else if(null!==(p=op.d.audioEngine)&&void 0!==p&&p.audioContext&&this._soundSource){const p=w?op.d.audioEngine.audioContext.currentTime+w:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(p)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var w;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(w=op.d.audioEngine)&&void 0!==w&&w.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=op.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(w,p){var e;null!==(e=op.d.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._soundGain&&(p&&op.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(op.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,op.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(w,op.d.audioEngine.audioContext.currentTime+p)):this._soundGain.gain.value=w),this._volume=w}setPlaybackRate(w){this._playbackRate=w,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(w){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=w,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=w=>this._onRegisterAfterWorldMatrixUpdate(w),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(w){var p;if(w.getBoundingInfo){const p=w.getBoundingInfo();this.setPosition(p.boundingSphere.centerWorld)}else this.setPosition(w.absolutePosition);null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const w=()=>{(0,Cp.g)((()=>this._isReadyToPlay),(()=>{e._audioBuffer=this.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,this._offset,this._length)}),void 0,300)},p={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},e=new Qp(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,p);return this.useCustomAttenuation&&e.setAttenuationFunction(this._customAttenuationFunction),e.setPosition(this._position),e.setPlaybackRate(this._playbackRate),w(),e}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const w={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(w.connectedMeshId=this._connectedTransformNode.id),w.position=this._position.ze(),w.refDistance=this.refDistance,w.distanceModel=this.distanceModel,w.isDirectional=this._isDirectional,w.localDirectionToMesh=this._localDirection.ze(),w.coneInnerAngle=this._coneInnerAngle,w.coneOuterAngle=this._coneOuterAngle,w.coneOuterGain=this._coneOuterGain),w}static Parse(w,p,e,r){const d=w.name;let f;f=w.url?e+w.url:e+d;const q={autoplay:w.autoplay,loop:w.loop,volume:w.volume,spatialSound:w.spatialSound,maxDistance:w.maxDistance,rolloffFactor:w.rolloffFactor,refDistance:w.refDistance,distanceModel:w.distanceModel,playbackRate:w.playbackRate};let E;if(r){const w=()=>{(0,Cp.g)((()=>r._isReadyToPlay),(()=>{E._audioBuffer=r.getAudioBuffer(),E._isReadyToPlay=!0,E.autoplay&&E.play(0,E._offset,E._length)}),void 0,300)};E=new Qp(d,new ArrayBuffer(0),p,null,q),w()}else E=new Qp(d,f,p,(()=>{p.removePendingData(E)}),q),p.addPendingData(E);if(w.position){const p=I.k.Ve(w.position);E.setPosition(p)}if(w.isDirectional&&(E.setDirectionalCone(w.coneInnerAngle||360,w.coneOuterAngle||360,w.coneOuterGain||0),w.localDirectionToMesh)){const p=I.k.Ve(w.localDirectionToMesh);E.setLocalDirectionToMesh(p)}if(w.connectedMeshId){const e=p.getMeshById(w.connectedMeshId);e&&E.attachToMesh(e)}return w.metadata&&(E.metadata=w.metadata),E}_setOffset(w){this._offset!==w&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=w)}_clearTimeoutsAndObservers(){var w;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(w=op.d.audioEngine)||void 0===w||w.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Qp._SceneComponentInitialization=w=>{throw(0,gp.c)("AudioSceneComponent")},(0,Mw.d)("BABYLON.Sound",Qp);class xp{constructor(w,p,e){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],p.length!==e.length)throw new Error("Sounds length does not equal weights length");this.loop=w,this._weights=e;let r=0;for(const d of e)r+=d;const I=r>0?1/r:0;for(let d=0;d<this._weights.length;d++)this._weights[d]*=I;this._sounds=p;for(const d of this._sounds)d.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!==this._coneInnerAngle){if(this._coneOuterAngle<w)return void y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w;for(const p of this._sounds)p.directionalConeInnerAngle=w}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!==this._coneOuterAngle){if(w<this._coneInnerAngle)return void y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w;for(const p of this._sounds)p.directionalConeOuterAngle=w}}get volume(){return this._volume}set volume(w){if(w!==this._volume)for(const p of this._sounds)p.setVolume(w)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(w){if(!this.isPaused){this.stop();const w=Math.random();let p=0;for(let e=0;e<this._weights.length;e++)if(p+=this._weights[e],w<=p){this._currentIndex=e;break}}const p=this._sounds[this._currentIndex??0];p.isReady()?p.play(0,this.isPaused?void 0:w):p.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Sp{constructor(w){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(w=w||K.d.LastCreatedScene)&&(this._scene=w,this.soundCollection=[],this._options=p,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var w;null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&op.d.audioEngine.audioContext&&(this._outputAudioNode=op.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(op.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(op.d.audioEngine&&op.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(w){var p;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&w.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==w.soundTrackId&&(-1===w.soundTrackId?this._scene.mainSoundTrack.removeSound(w):this._scene.soundTracks&&this._scene.soundTracks[w.soundTrackId].removeSound(w)),this.soundCollection.push(w),w.soundTrackId=this.id}removeSound(w){const p=this.soundCollection.indexOf(w);-1!==p&&this.soundCollection.splice(p,1)}setVolume(w){var p;null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=w)}switchPanningModelToHRTF(){var w;if(null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var w;if(null!==(w=op.d.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToEqualPower()}connectToAnalyser(w){var p;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=w,null!==(p=op.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,op.d.audioEngine.masterGain))}}var we=e(11408),pe=e(11590),ee=e(11075);op.d.AudioEngineFactory=(w,p,e)=>new re(w,p,e);class re{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new X.d,this.onAudioLockedObservable=new X.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ee.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const r=document.createElement("audio");this._hostElement=w,this._audioContext=p,this._audioDestination=e;try{r&&r.canPlayType&&(r.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||r.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(I){}try{r&&r.canPlayType&&r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(I){}}lock(){this._triggerSuspendedState()}unlock(){var w,p;if("running"===(null===(w=this._audioContext)||void 0===w?void 0:w.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(p=this._audioContext)||void 0===p||p.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{y.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var w;null===(w=this._audioContext)||void 0===w||w.addEventListener("statechange",(()=>{var w;this.unlocked&&"running"!==(null===(w=this._audioContext)||void 0===w?void 0:w.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var w;return null!==(w=this._audioContext)&&void 0!==w&&w.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(w){this.canUseWebAudio=!1,y.c.Error("Web Audio: "+w.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(w){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const w=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",p=document.createElement("style");p.appendChild(document.createTextNode(w)),document.getElementsByTagName("head")[0].appendChild(p),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var w;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(w=this._audioContext)||void 0===w||w.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(w){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=w)}connectToAnalyser(w){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=w,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Ie=e(11088);(0,e(12513).d)(we.d.NAME_AUDIO,((w,p,e,r)=>{let I,d=[];if(e.fJ=e.fJ||[],void 0!==w.fJ&&null!==w.fJ)for(let q=0,E=w.fJ.length;q<E;q++){var f;const E=w.fJ[q];null!==(f=op.d.audioEngine)&&void 0!==f&&f.canUseWebAudio?(E.url||(E.url=E.name),d[E.url]?e.fJ.push(Qp.Parse(E,p,r,d[E.url])):(I=Qp.Parse(E,p,r),d[E.url]=I,e.fJ.push(I))):e.fJ.push(new Qp(E.name,null,p))}d=[]})),Object.defineProperty(pe.c.prototype,"mainSoundTrack",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),this._mainSoundTrack||(this._mainSoundTrack=new Sp(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),pe.c.prototype.getSoundByName=function(w){let p;for(p=0;p<this.mainSoundTrack.soundCollection.length;p++)if(this.mainSoundTrack.soundCollection[p].name===w)return this.mainSoundTrack.soundCollection[p];if(this.soundTracks)for(let e=0;e<this.soundTracks.length;e++)for(p=0;p<this.soundTracks[e].soundCollection.length;p++)if(this.soundTracks[e].soundCollection[p].name===w)return this.soundTracks[e].soundCollection[p];return null},Object.defineProperty(pe.c.prototype,"audioEnabled",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),w.audioEnabled},set:function(w){let p=this._getComponent(we.d.NAME_AUDIO);p||(p=new de(this),this.je(p)),w?p.enableAudio():p.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(pe.c.prototype,"headphone",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),w.headphone},set:function(w){let p=this._getComponent(we.d.NAME_AUDIO);p||(p=new de(this),this.je(p)),w?p.switchAudioModeForHeadphones():p.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(pe.c.prototype,"audioListenerPositionProvider",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),w.audioListenerPositionProvider},set:function(w){let p=this._getComponent(we.d.NAME_AUDIO);if(p||(p=new de(this),this.je(p)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");p.audioListenerPositionProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(pe.c.prototype,"audioListenerRotationProvider",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),w.audioListenerRotationProvider},set:function(w){let p=this._getComponent(we.d.NAME_AUDIO);if(p||(p=new de(this),this.je(p)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");p.audioListenerRotationProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(pe.c.prototype,"audioPositioningRefreshRate",{get:function(){let w=this._getComponent(we.d.NAME_AUDIO);return w||(w=new de(this),this.je(w)),w.audioPositioningRefreshRate},set:function(w){let p=this._getComponent(we.d.NAME_AUDIO);p||(p=new de(this),this.je(p)),p.audioPositioningRefreshRate=w},enumerable:!0,configurable:!0});class de{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(w){this.name=we.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new I.k,this._cachedCameraPosition=new I.k,this._lastCheck=0,this._invertMatrixTemp=new I.b,this._cameraDirectionTemp=new I.k,(w=w||K.d.LastCreatedScene)&&(this.yp=w,w.soundTracks=[],w.fJ=[])}register(){this.yp._afterRenderStage.registerStep(we.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(w){if(w.fJ=[],this.yp.soundTracks)for(let p=0;p<this.yp.soundTracks.length;p++){const e=this.yp.soundTracks[p];for(let p=0;p<e.soundCollection.length;p++)w.fJ.push(e.soundCollection[p].serialize())}}addFromContainer(w){if(w.fJ)for(const p of w.fJ)p.play(),p.autoplay=!0,this.yp.mainSoundTrack.addSound(p)}removeFromContainer(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(w.fJ)for(const e of w.fJ)e.stop(),e.autoplay=!1,this.yp.mainSoundTrack.removeSound(e),p&&e.dispose()}dispose(){const w=this.yp;if(w._mainSoundTrack&&w.mainSoundTrack.dispose(),w.soundTracks)for(let p=0;p<w.soundTracks.length;p++)w.soundTracks[p].dispose()}disableAudio(){const w=this.yp;let p;for(this._audioEnabled=!1,op.d.audioEngine&&op.d.audioEngine.audioContext&&op.d.audioEngine.audioContext.suspend(),p=0;p<w.mainSoundTrack.soundCollection.length;p++)w.mainSoundTrack.soundCollection[p].pause();if(w.soundTracks)for(p=0;p<w.soundTracks.length;p++)for(let e=0;e<w.soundTracks[p].soundCollection.length;e++)w.soundTracks[p].soundCollection[e].pause()}enableAudio(){const w=this.yp;let p;for(this._audioEnabled=!0,op.d.audioEngine&&op.d.audioEngine.audioContext&&op.d.audioEngine.audioContext.resume(),p=0;p<w.mainSoundTrack.soundCollection.length;p++)w.mainSoundTrack.soundCollection[p].isPaused&&w.mainSoundTrack.soundCollection[p].play();if(w.soundTracks)for(p=0;p<w.soundTracks.length;p++)for(let e=0;e<w.soundTracks[p].soundCollection.length;e++)w.soundTracks[p].soundCollection[e].isPaused&&w.soundTracks[p].soundCollection[e].play()}switchAudioModeForHeadphones(){const w=this.yp;if(this._headphone=!0,w.mainSoundTrack.switchPanningModelToHRTF(),w.soundTracks)for(let p=0;p<w.soundTracks.length;p++)w.soundTracks[p].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const w=this.yp;if(this._headphone=!1,w.mainSoundTrack.switchPanningModelToEqualPower(),w.soundTracks)for(let p=0;p<w.soundTracks.length;p++)w.soundTracks[p].switchPanningModelToEqualPower()}_afterRender(){const w=Ie.b.Now;if(this._lastCheck&&w-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=w;const p=this.yp;if(!this._audioEnabled||!p._mainSoundTrack||!p.soundTracks||0===p._mainSoundTrack.soundCollection.length&&1===p.soundTracks.length)return;const e=op.d.audioEngine;if(e&&e.audioContext){let w,r=p.activeCamera;if(p.activeCameras&&p.activeCameras.length>0&&(r=p.activeCameras[0]),this.audioListenerPositionProvider){const w=this.audioListenerPositionProvider();e.audioContext.listener.setPosition(w.x||0,w.y||0,w.z||0)}else r?this._cachedCameraPosition.equals(r.globalPosition)||(this._cachedCameraPosition.X(r.globalPosition),e.audioContext.listener.setPosition(r.globalPosition.x,r.globalPosition.y,r.globalPosition.z)):e.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const w=this.audioListenerRotationProvider();e.audioContext.listener.setOrientation(w.x||0,w.y||0,w.z||0,0,1,0)}else r?(r.rigCameras&&r.rigCameras.length>0&&(r=r.rigCameras[0]),r.getViewMatrix().invertToRef(this._invertMatrixTemp),I.k.TransformNormalToRef(de._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.X(this._cameraDirectionTemp),e.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):e.audioContext.listener.setOrientation(0,0,0,0,1,0);for(w=0;w<p.mainSoundTrack.soundCollection.length;w++){const e=p.mainSoundTrack.soundCollection[w];e.useCustomAttenuation&&e.updateDistanceFromListener()}if(p.soundTracks)for(w=0;w<p.soundTracks.length;w++)for(let e=0;e<p.soundTracks[w].soundCollection.length;e++){const r=p.soundTracks[w].soundCollection[e];r.useCustomAttenuation&&r.updateDistanceFromListener()}}}}de._CameraDirection=new I.k(0,0,-1),Qp._SceneComponentInitialization=w=>{let p=w._getComponent(we.d.NAME_AUDIO);p||(p=new de(w),w.je(p))};const fe="MSFT_audio_emitter";class qe{constructor(w){this.name=fe,this._loader=w,this.enabled=this._loader.isExtensionUsed(fe)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const w=this._loader.Ge.extensions;if(w&&w[this.name]){const p=w[this.name];this._clips=p.clips,this._emitters=p.emitters,H.Assign(this._clips),H.Assign(this._emitters)}}loadSceneAsync(w,p){return D.LoadExtensionAsync(w,p,this.name,(async(e,r)=>{const I=new Array;I.push(this._loader.loadSceneAsync(w,p));for(const w of r.emitters){const p=H.Get(`${e}/emitters`,this._emitters,w);if(void 0!=p.refDistance||void 0!=p.maxDistance||void 0!=p.rolloffFactor||void 0!=p.distanceModel||void 0!=p.innerAngle||void 0!=p.outerAngle)throw new Error(`${e}: Direction or Distance properties are not allowed on emitters attached to a scene`);I.push(this._loadEmitterAsync(`${e}/emitters/${p.index}`,p))}await Promise.all(I)}))}loadNodeAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(w,r)=>{const d=new Array,q=await this._loader.loadNodeAsync(w,p,(p=>{for(const e of r.emitters){const r=H.Get(`${w}/emitters`,this._emitters,e);d.push(this._loadEmitterAsync(`${w}/emitters/${r.index}`,r).then((()=>{for(const w of r._babylonSounds)w.attachToMesh(p),void 0==r.innerAngle&&void 0==r.outerAngle||(w.setLocalDirectionToMesh(I.k.Forward()),w.setDirectionalCone(2*f.g.ToDegrees(void 0==r.innerAngle?Math.PI:r.innerAngle),2*f.g.ToDegrees(void 0==r.outerAngle?Math.PI:r.outerAngle),0))})))}e(p)}));return await Promise.all(d),q}))}loadAnimationAsync(w,p){return D.LoadExtensionAsync(w,p,this.name,(async(e,r)=>{const I=await this._loader.loadAnimationAsync(w,p),d=new Array;H.Assign(r.events);for(const f of r.events)d.push(this._loadAnimationEventAsync(`${e}/events/${f.index}`,w,p,f,I));return await Promise.all(d),I}))}_loadClipAsync(w,p){if(p._objectURL)return p._objectURL;let e;if(p.uri)e=this._loader.loadUriAsync(w,p,p.uri);else{const r=H.Get(`${w}/bufferView`,this._loader.Ge.bufferViews,p.bufferView);e=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r)}return p._objectURL=e.then((w=>URL.createObjectURL(new Blob([w],{type:p.mimeType})))),p._objectURL}_loadEmitterAsync(w,p){if(p._babylonSounds=p._babylonSounds||[],!p._babylonData){const w=new Array,e=p.name||`emitter${p.index}`,r={loop:!1,autoplay:!1,volume:void 0==p.volume?1:p.volume};for(let d=0;d<p.clips.length;d++){const I=`/extensions/${this.name}/clips`,f=H.Get(I,this._clips,p.clips[d].clip);w.push(this._loadClipAsync(`${I}/${p.clips[d].clip}`,f).then((w=>{const I=p._babylonSounds[d]=new Qp(e,w,this._loader.babylonScene,null,r);I.refDistance=p.refDistance||1,I.maxDistance=p.maxDistance||256,I.rolloffFactor=p.rolloffFactor||1,I.distanceModel=p.distanceModel||"exponential"})))}const I=Promise.all(w).then((()=>{const w=p.clips.map((w=>w.weight||1)),e=new xp(p.loop||!1,p._babylonSounds,w);p.innerAngle&&(e.directionalConeInnerAngle=2*f.g.ToDegrees(p.innerAngle)),p.outerAngle&&(e.directionalConeOuterAngle=2*f.g.ToDegrees(p.outerAngle)),p.volume&&(e.volume=p.volume),p._babylonData.sound=e}));p._babylonData={loaded:I}}return p._babylonData.loaded}_getEventAction(w,p,e,r,I){switch(e){case"play":return w=>{const e=(I||0)+(w-r);p.play(e)};case"stop":return()=>{p.stop()};case"pause":return()=>{p.pause()};default:throw new Error(`${w}: Unsupported action ${e}`)}}_loadAnimationEventAsync(w,p,e,r,I){if(0==I.targetedAnimations.length)return Promise.resolve();const d=I.targetedAnimations[0],f=r.i,q=H.Get(`/extensions/${this.name}/emitters`,this._emitters,f);return this._loadEmitterAsync(w,q).then((()=>{const p=q._babylonData.sound;if(p){const e=new Gp(r.time,this._getEventAction(w,p,r.action,r.time,r.startOffset));d.animation.addEvent(e),I.onAnimationGroupEndObservable.add((()=>{p.stop()})),I.onAnimationGroupPauseObservable.add((()=>{p.pause()}))}}))}}Y(fe),u(fe,!0,(w=>new qe(w)));const Ee="MSFT_lod";class je{constructor(w){var p;this.name=Ee,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new X.d,this.onMaterialLODsLoadedObservable=new X.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=w,this.maxLODsToLoad=(null===(p=this._loader.parent.extensionOptions[Ee])||void 0===p?void 0:p.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Ee)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let w=0;w<this._nodePromiseLODs.length;w++){const p=Promise.all(this._nodePromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Node LOD ${w}`),this._loader.log(`Loaded node LOD ${w}`)),this.onNodeLODsLoadedObservable.notifyObservers(w),w!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${w+1}`),this._loadBufferLOD(this._nodeBufferLODs,w+1),this._nodeSignalLODs[w]&&this._nodeSignalLODs[w].resolve())}));this._loader._completePromises.push(p)}for(let w=0;w<this._materialPromiseLODs.length;w++){const p=Promise.all(this._materialPromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Material LOD ${w}`),this._loader.log(`Loaded material LOD ${w}`)),this.onMaterialLODsLoadedObservable.notifyObservers(w),w!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${w+1}`),this._loadBufferLOD(this._materialBufferLODs,w+1),this._materialSignalLODs[w]&&this._materialSignalLODs[w].resolve())}));this._loader._completePromises.push(p)}}loadSceneAsync(w,p){const e=this._loader.loadSceneAsync(w,p);return this._loadBufferLOD(this._bufferLODs,0),e}loadNodeAsync(w,p,e){return D.LoadExtensionAsync(w,p,this.name,(async(w,I)=>{let d;const f=this._getLODs(w,p,this._loader.Ge.nodes,I.ids);this._loader.logOpen(`${w}`);for(let p=0;p<f.length;p++){const w=f[p];0!==p&&(this._nodeIndexLOD=p,this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new r);const I=w=>{e(w),w.yE(!1)},q=this._loader.loadNodeAsync(`/nodes/${w.index}`,w,I).then((w=>{if(0!==p){const w=f[p-1];w._babylonTransformNode&&(this._disposeTransformNode(w._babylonTransformNode),delete w._babylonTransformNode)}return w.yE(!0),w}));this._nodePromiseLODs[p]=this._nodePromiseLODs[p]||[],0===p?d=q:(this._nodeIndexLOD=null,this._nodePromiseLODs[p].push(q))}return this._loader.logClose(),await d}))}_loadMaterialAsync(w,p,e,r,I){return this._nodeIndexLOD?null:D.LoadExtensionAsync(w,p,this.name,(async(w,d)=>{let f;const q=this._getLODs(w,p,this._loader.Ge.materials,d.ids);this._loader.logOpen(`${w}`);for(let p=0;p<q.length;p++){const w=q[p];0!==p&&(this._materialIndexLOD=p);const d=this._loader._loadMaterialAsync(`/materials/${w.index}`,w,e,r,(w=>{0===p&&I(w)})).then((w=>{if(0!==p){I(w);const e=q[p-1]._data;e[r]&&(this._disposeMaterials([e[r].babylonMaterial]),delete e[r])}return w}));this._materialPromiseLODs[p]=this._materialPromiseLODs[p]||[],0===p?f=d:(this._materialIndexLOD=null,this._materialPromiseLODs[p].push(d))}return this._loader.logClose(),await f}))}_loadUriAsync(w,p,e){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const I=this._nodeIndexLOD-1;return this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new r,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(w,p,e)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const I=this._materialIndexLOD-1;return this._materialSignalLODs[I]=this._materialSignalLODs[I]||new r,this._materialSignalLODs[I].promise.then((async()=>await this._loader.loadUriAsync(w,p,e)))}return null}loadBufferAsync(w,p,e,I){if(this._loader.parent.useRangeRequests&&!p.uri){if(!this._loader.bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);const p=async(w,p)=>{const d=e,f=d+I-1;let q=w[p];return q?(q.start=Math.min(q.start,d),q.end=Math.max(q.end,f)):(q={start:d,end:f,loaded:new r},w[p]=q),await q.loaded.promise.then((w=>new Uint8Array(w.buffer,w.byteOffset+e-q.start,I)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?p(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?p(this._materialBufferLODs,this._materialIndexLOD):p(this._bufferLODs,0)}return null}_loadBufferLOD(w,p){const e=w[p];e&&(this._loader.log(`Loading buffer range [${e.start}-${e.end}]`),this._loader.bin.readAsync(e.start,e.end-e.start+1).then((w=>{e.loaded.resolve(w)}),(w=>{e.loaded.reject(w)})))}_getLODs(w,p,e,r){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const I=[];for(let d=r.length-1;d>=0;d--)if(I.push(H.Get(`${w}/ids/${r[d]}`,e,r[d])),I.length===this.maxLODsToLoad)return I;return I.push(p),I}_disposeTransformNode(w){const p=[],e=w.material;e&&p.push(e);for(const I of w.getChildMeshes())I.material&&p.push(I.material);w.dispose();const r=p.filter((w=>this._loader.babylonScene.meshes.every((p=>p.material!=w))));this._disposeMaterials(r)}_disposeMaterials(w){const p={};for(const e of w){for(const w of e.getActiveTextures())p[w.uniqueId]=w;e.dispose()}for(const e in p)for(const w of this._loader.babylonScene.materials)w.hasTexture(p[e])&&delete p[e];for(const e in p)p[e].dispose()}}Y(Ee),u(Ee,!0,(w=>new je(w)));const Xe="MSFT_minecraftMesh";class ke{constructor(w){this.name=Xe,this._loader=w,this.enabled=this._loader.isExtensionUsed(Xe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtraAsync(w,p,this.name,(async(r,I)=>{if(I){if(!(e instanceof a.d))throw new Error(`${r}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(w,p,e);return e.needAlphaBlending()&&(e.forceDepthWrite=!0,e.separateCullingPass=!0),e.ce=e.forceDepthWrite,e.twoSidedLighting=!0,await I}}))}}Y(Xe),u(Xe,!0,(w=>new ke(w)));const me="MSFT_sRGBFactors";class Je{constructor(w){this.name=me,this._loader=w,this.enabled=this._loader.isExtensionUsed(me)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,p,e){return D.LoadExtraAsync(w,p,this.name,(async(r,I)=>{if(I){if(!(e instanceof a.d))throw new Error(`${r}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(w,p,e),d=e.iw().getEngine().useExactSrgbConversions;return e.albedoTexture||e.albedoColor.toLinearSpaceToRef(e.albedoColor,d),e.reflectivityTexture||e.reflectivityColor.toLinearSpaceToRef(e.reflectivityColor,d),await I}}))}}Y(me),u(me,!0,(w=>new Je(w)));var Ke=e(12854);const ye={};var ce=e(12909),se=e(12891),Oe=e(12861),ae=e(12872);function Ae(w,p){for(const e of w)for(const w of e.dataOutputs)if(w.uniqueId===p)return w;throw new Error("Could not find data out connection with unique id "+p)}function ze(w,p){for(const e of w)if(e instanceof se.b)for(const w of e.signalInputs)if(w.uniqueId===p)return w;throw new Error("Could not find signal in connection with unique id "+p)}async function Me(w,p){const r=await Promise.all(w.allBlocks.map((async w=>{const p=function(w){switch(w){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([e.e(58),e.e(59)]).then(e.bind(e,14353))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await e.e(60).then(e.bind(e,14362))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await e.e(61).then(e.bind(e,14364))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await e.e(62).then(e.bind(e,14367))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await e.e(63).then(e.bind(e,14372))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await e.e(64).then(e.bind(e,14379))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await e.e(65).then(e.bind(e,14386))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await e.e(66).then(e.bind(e,14388))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await e.e(67).then(e.bind(e,14392))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await e.e(75).then(e.bind(e,14418))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await e.e(76).then(e.bind(e,14425))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await e.e(77).then(e.bind(e,14428))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await e.e(78).then(e.bind(e,14432))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await e.e(79).then(e.bind(e,14441))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await e.e(80).then(e.bind(e,14449))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await e.e(81).then(e.bind(e,14457))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await e.e(82).then(e.bind(e,14461))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await e.e(83).then(e.bind(e,14467))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await e.e(84).then(e.bind(e,14473))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await e.e(85).then(e.bind(e,14477))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await e.e(86).then(e.bind(e,14482))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await e.e(87).then(e.bind(e,14487))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await e.e(88).then(e.bind(e,14493))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await e.e(89).then(e.bind(e,14501))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await e.e(90).then(e.bind(e,14509))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await e.e(91).then(e.bind(e,14513))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await e.e(92).then(e.bind(e,14521))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await e.e(93).then(e.bind(e,14523))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await e.e(72).then(e.bind(e,14529))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await e.e(94).then(e.bind(e,14534))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await e.e(95).then(e.bind(e,14539))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await e.e(96).then(e.bind(e,14542))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await e.e(73).then(e.bind(e,14546))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await e.e(68).then(e.bind(e,14395))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await e.e(74).then(e.bind(e,14551))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await e.e(69).then(e.bind(e,14411))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await e.e(70).then(e.bind(e,14414))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await e.e(71).then(e.bind(e,14553))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await e.e(97).then(e.bind(e,14559))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await e.e(98).then(e.bind(e,14564))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await e.e(99).then(e.bind(e,14572))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await e.e(100).then(e.bind(e,14577))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await e.e(101).then(e.bind(e,14584))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await e.e(102).then(e.bind(e,14590))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await e.e(103).then(e.bind(e,14597))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await e.e(104).then(e.bind(e,14599))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await e.e(105).then(e.bind(e,14601))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await e.e(106).then(e.bind(e,14607))).FlowGraphDataSwitchBlock;default:if(ye[w])return ye[w];throw new Error(`Unknown block name ${w}`)}}(w.className);return await p()})));return function(w,p,e){const r=p.coordinator.createGraph(),I=[],d=p.valueParseFunction??Oe.c;for(let f=0;f<w.allBlocks.length;f++){const q=te(w.allBlocks[f],{yp:p.coordinator.config.yp,pathConverter:p.pathConverter,assetsContainer:p.coordinator.config.yp,valueParseFunction:d},e[f]);I.push(q),q instanceof ce.d&&r.addEventBlock(q)}for(const f of I){for(const w of f.dataInputs)for(const p of w.connectedPointIds){const e=Ae(I,p);w.connectTo(e)}if(f instanceof se.b)for(const w of f.signalOutputs)for(const p of w.connectedPointIds){const e=ze(I,p);w.connectTo(e)}}for(const f of w.executionContexts)ie(f,{graph:r,valueParseFunction:d},w.rightHanded);return r}(w,p,r)}function ie(w,p,e){const r=p.graph.createContext();w.enableLogging&&(r.enableLogging=!0),r.treatDataAsRightHanded=e||!1;const I=p.valueParseFunction??Oe.c;r.uniqueId=w.uniqueId;const d=r.iw();if(w._assetsContext){var f,q,E,j,X,k,m,J,K,y;const p=w._assetsContext,e={meshes:null===(f=p.meshes)||void 0===f?void 0:f.map((w=>d.getMeshById(w))),lights:null===(q=p.lights)||void 0===q?void 0:q.map((w=>d.getLightByName(w))),cameras:null===(E=p.cameras)||void 0===E?void 0:E.map((w=>d.getCameraByName(w))),materials:null===(j=p.materials)||void 0===j?void 0:j.map((w=>d.getMaterialById(w))),textures:null===(X=p.textures)||void 0===X?void 0:X.map((w=>d.getTextureByName(w))),animations:null===(k=p.animations)||void 0===k?void 0:k.map((w=>d.animations.find((p=>p.name===w)))),skeletons:null===(m=p.skeletons)||void 0===m?void 0:m.map((w=>d.getSkeletonByName(w))),tm:null===(J=p.tm)||void 0===J?void 0:J.map((w=>d.getParticleSystemById(w))),animationGroups:null===(K=p.animationGroups)||void 0===K?void 0:K.map((w=>d.getAnimationGroupByName(w))),transformNodes:null===(y=p.transformNodes)||void 0===y?void 0:y.map((w=>d.getTransformNodeById(w))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],fJ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};r.assetsContext=e}for(const c in w._userVariables){const p=I(c,w._userVariables,r.assetsContext,d);r.userVariables[c]=p}for(const c in w._connectionValues){const p=I(c,w._connectionValues,r.assetsContext,d);r._setConnectionValueByKey(c,p)}return r}function te(w,p,e){const r={},I=p.valueParseFunction??Oe.c;if(w.config)for(const f in w.config)r[f]=I(f,w.config,p.assetsContainer||p.yp,p.yp);if((0,Oe.k)(w.className)){if(!p.pathConverter)throw new Error("Path converter is required for this block");r.pathConverter=p.pathConverter}const d=new e(r);d.uniqueId=w.uniqueId;for(let f=0;f<w.dataInputs.length;f++){const p=d.getDataInput(w.dataInputs[f].name);if(!p)throw new Error("Could not find data input with name "+w.dataInputs[f].name+" in block "+w.className);p.deserialize(w.dataInputs[f])}for(let f=0;f<w.dataOutputs.length;f++){const p=d.getDataOutput(w.dataOutputs[f].name);if(!p)throw new Error("Could not find data output with name "+w.dataOutputs[f].name+" in block "+w.className);p.deserialize(w.dataOutputs[f])}return d.metadata=w.metadata,d.deserialize&&d.deserialize(w),d}function ne(w){const[p,e]=w.split(":");return le({op:p,extension:e})}function le(w){var p;let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=w.extension?null===(p=Ue[w.extension])||void 0===p?void 0:p[w.op]:ve[w.op];if(!r&&(y.c.Warn(`No mapping found for operation ${w.op} and extension ${w.extension||"KHR_interactivity"}`),e)){const p={},e={flows:{}};if(w.inputValueSockets){p.values={};for(const e in w.inputValueSockets)p.values[e]={name:e}}return w.outputValueSockets&&(e.values={},Object.keys(w.outputValueSockets).forEach((w=>{e.values[w]={name:w}}))),{LX:[],inputs:p,outputs:e}}return r}function Ne(w,p,e){Ue[p]||(Ue[p]={}),Ue[p][w]=e}const Ue={BABYLON:{"flow/log":{LX:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},ve={"event/onStart":{LX:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{LX:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{LX:["FlowGraphSendCustomEventBlock"],extraProcessor(w,p,e,r,I){if("event/send"!==p.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=w.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const f=r.arrays.events[d],q=I[0];return q.config||(q.config={}),q.config.eventId=f.eventId,q.config.eventData=f.eventData,I}},"event/receive":{LX:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(w,p){var e;if(!w.configuration)return y.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const r=w.configuration.event;if(!r)return y.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const I=r.value[0];if("number"!==typeof I)return y.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(e=p.events)||void 0===e?void 0:e[I])?{valid:!0}:(y.c.Error(`Event with id ${I} not found`),{valid:!1,error:`Event with id ${I} not found`})},extraProcessor(w,p,e,r,I){if("event/receive"!==p.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const d=w.configuration.event.value[0];if("number"!==typeof d)throw new Error("Event id should be a number");const f=r.arrays.events[d],q=I[0];return q.config||(q.config={}),q.config.eventId=f.eventId,q.config.eventData=f.eventData,I}},"math/e":Re("FlowGraphEBlock"),"math/pi":Re("FlowGraphPIBlock"),"math/inf":Re("FlowGraphInfBlock"),"math/nan":Re("FlowGraphNaNBlock"),"math/abs":Re("FlowGraphAbsBlock"),"math/sign":Re("FlowGraphSignBlock"),"math/trunc":Re("FlowGraphTruncBlock"),"math/floor":Re("FlowGraphFloorBlock"),"math/ceil":Re("FlowGraphCeilBlock"),"math/round":{LX:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I){var d;return(d=I[0]).config||(d.config={}),I[0].config.roundHalfAwayFromZero=!0,I}},"math/fract":Re("FlowGraphFractBlock"),"math/neg":Re("FlowGraphNegationBlock"),"math/add":Re("FlowGraphAddBlock",["a","b"],!0),"math/sub":Re("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{LX:["FlowGraphMultiplyBlock"],extraProcessor(w,p,e,r,I){var d;(d=I[0]).config||(d.config={}),I[0].config.useMatrixPerComponent=!0,I[0].config.preventIntegerFloatArithmetic=!0;let f=-1;return Object.keys(w.values||{}).find((p=>{var e;return void 0!==(null===(e=w.values)||void 0===e?void 0:e[p].type)&&(f=w.values[p].type,!0)})),-1!==f&&(I[0].config.type=r.arrays.types[f].flowGraphType),I},validation:w=>w.values?Ve(w):{valid:!0}},"math/div":Re("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Re("FlowGraphModuloBlock",["a","b"]),"math/min":Re("FlowGraphMinBlock",["a","b"]),"math/max":Re("FlowGraphMaxBlock",["a","b"]),"math/clamp":Re("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Re("FlowGraphSaturateBlock"),"math/mix":Re("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Re("FlowGraphEqualityBlock",["a","b"]),"math/lt":Re("FlowGraphLessThanBlock",["a","b"]),"math/le":Re("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Re("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Re("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Re("FlowGraphIsNaNBlock"),"math/isinf":Re("FlowGraphIsInfBlock"),"math/select":{LX:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{LX:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Re("FlowGraphSinBlock"),"math/cos":Re("FlowGraphCosBlock"),"math/tan":Re("FlowGraphTanBlock"),"math/asin":Re("FlowGraphASinBlock"),"math/acos":Re("FlowGraphACosBlock"),"math/atan":Re("FlowGraphATanBlock"),"math/atan2":Re("FlowGraphATan2Block",["a","b"]),"math/sinh":Re("FlowGraphSinhBlock"),"math/cosh":Re("FlowGraphCoshBlock"),"math/tanh":Re("FlowGraphTanhBlock"),"math/asinh":Re("FlowGraphASinhBlock"),"math/acosh":Re("FlowGraphACoshBlock"),"math/atanh":Re("FlowGraphATanhBlock"),"math/exp":Re("FlowGraphExponentialBlock"),"math/log":Re("FlowGraphLogBlock"),"math/log2":Re("FlowGraphLog2Block"),"math/log10":Re("FlowGraphLog10Block"),"math/sqrt":Re("FlowGraphSquareRootBlock"),"math/cbrt":Re("FlowGraphCubeRootBlock"),"math/pow":Re("FlowGraphPowerBlock",["a","b"]),"math/length":Re("FlowGraphLengthBlock"),"math/normalize":Re("FlowGraphNormalizeBlock"),"math/dot":Re("FlowGraphDotBlock",["a","b"]),"math/cross":Re("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Re("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Re("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{LX:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{LX:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{LX:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{LX:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{LX:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{LX:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{LX:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Re("FlowGraphTransposeBlock"),"math/determinant":Re("FlowGraphDeterminantBlock"),"math/inverse":Re("FlowGraphInvertMatrixBlock"),"math/matmul":Re("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{LX:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ne",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I,d){const f=I[0].dataInputs.find((w=>"rotationQuaternion"===w.name));if(!f)throw new Error("Rotation quaternion input not found");return d._connectionValues[f.uniqueId]&&(d._connectionValues[f.uniqueId].type="Quaternion"),I}},"math/matDecompose":{LX:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ne"}}}},"math/quatConjugate":Re("FlowGraphConjugateBlock",["a"]),"math/quatMul":{LX:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I){var d;return(d=I[0]).config||(d.config={}),I[0].config.type="Quaternion",I}},"math/quatAngleBetween":Re("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{LX:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Re("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Re("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{LX:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I){var d;return(d=I[0]).config||(d.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract2x2":{LX:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{LX:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I){var d;return(d=I[0]).config||(d.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract3x3":{LX:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{LX:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I){var d;return(d=I[0]).config||(d.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract4x4":{LX:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{LX:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I,d){var f,q;(q=I[0]).config||(q.config={});const E=I[0].dataInputs[0];return I[0].config.valueType=(null===(f=d._connectionValues[E.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",I}},"math/and":{LX:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I,d){var f,q,E;(E=I[0]).config||(E.config={});const j=I[0].dataInputs[0],X=I[0].dataInputs[1];return I[0].config.valueType=(null===(f=d._connectionValues[j.uniqueId])||void 0===f?void 0:f.type)??(null===(q=d._connectionValues[X.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",I}},"math/or":{LX:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I,d){var f,q,E;(E=I[0]).config||(E.config={});const j=I[0].dataInputs[0],X=I[0].dataInputs[1];return I[0].config.valueType=(null===(f=d._connectionValues[j.uniqueId])||void 0===f?void 0:f.type)??(null===(q=d._connectionValues[X.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",I}},"math/xor":{LX:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,p,e,r,I,d){var f,q,E;(E=I[0]).config||(E.config={});const j=I[0].dataInputs[0],X=I[0].dataInputs[1];return I[0].config.valueType=(null===(f=d._connectionValues[j.uniqueId])||void 0===f?void 0:f.type)??(null===(q=d._connectionValues[X.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",I}},"math/asr":Re("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Re("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Re("FlowGraphLeadingZerosBlock"),"math/ctz":Re("FlowGraphTrailingZerosBlock"),"math/popcnt":Re("FlowGraphOneBitsCounterBlock"),"math/rad":Re("FlowGraphDegToRadBlock"),"math/deg":Re("FlowGraphRadToDegBlock"),"type/boolToInt":Re("FlowGraphBooleanToInt"),"type/boolToFloat":Re("FlowGraphBooleanToFloat"),"type/intToBool":Re("FlowGraphIntToBoolean"),"type/intToFloat":Re("FlowGraphIntToFloat"),"type/floatToInt":Re("FlowGraphFloatToInt"),"type/floatToBool":Re("FlowGraphFloatToBoolean"),"flow/sequence":{LX:["FlowGraphSequenceBlock"],extraProcessor(w,p,e,r,I){const d=I[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(w.flows||[]).length,d.signalOutputs.forEach(((w,p)=>{w.name="out_"+p})),I}},"flow/branch":{LX:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{LX:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(w){if(w.configuration&&w.configuration.cases){const p=w.configuration.cases.value;if(!p.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return y.c.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const e=new Set(p);w.configuration.cases.value=Array.from(e)}return{valid:!0}},extraProcessor(w,p,e,r,I){if("flow/switch"!==p.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return I[0].signalOutputs.forEach((w=>{"default"!==w.name&&(w.name="out_"+w.name)})),I}},"flow/while":{LX:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{LX:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(w,p,e,r,I){const d=I[0];return d.config||(d.config={}),d.config.incrementIndexWhenLoopDone=!0,I}},"flow/doN":{LX:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{LX:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(w,p,e,r,I){if("flow/multiGate"!==p.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const d=I[0];return d.config||(d.config={}),d.config.outputSignalCount=Object.keys(w.flows).length,d.signalOutputs.forEach(((w,p)=>{w.name="out_"+p})),I}},"flow/waitAll":{LX:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(w){var p,e;return"number"!==typeof(null===(p=w.configuration)||void 0===p||null===(e=p.inputFlows)||void 0===e?void 0:e.value[0])&&(w.configuration=w.configuration||{inputFlows:{value:[0]}},w.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{LX:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{LX:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{LX:["FlowGraphCancelDelayBlock"]},"variable/get":{LX:["FlowGraphGetVariableBlock"],validation(w){var p,e;return null!==(p=w.configuration)&&void 0!==p&&null!==(e=p.variable)&&void 0!==e&&e.value?{valid:!0}:(y.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,p)=>[p.getVariableName(w[0])]}}},"variable/set":{LX:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,p)=>[p.getVariableName(w[0])]}}},"variable/setMultiple":{LX:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(w,p)=>[w[0].map((w=>p.getVariableName(w)))]}},extraProcessor:(w,p,e,r,I)=>(I[0].dataInputs.forEach((w=>{w.name=r.getVariableName(+w.name)})),I)},"variable/interpolate":{LX:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(w,p)=>[p.getVariableName(w[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:w=>!0===w[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ue:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ue:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ue:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ue:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ue:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ue:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(w,p,e,r,I){var d,f,q;const E=I[0],j=null===(d=w.configuration)||void 0===d?void 0:d.variable.value[0];if("number"!==typeof j)throw y.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const X=r.arrays.staticVariables[j];"undefined"===typeof E.config.animationType.value&&(r.arrays.staticVariables,E.config.animationType.value=(0,ae.E)(X.type));const k=I[4];return k.config||(k.config={}),(f=k.config).variable||(f.variable={}),k.config.variable.value=r.getVariableName(j),(q=I[3]).config||(q.config={}),I}},"pointer/get":{LX:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ue:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Ue:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,p,e,r,I)=>(I.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),I)},"pointer/set":{LX:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ue:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Ue:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,p,e,r,I)=>(I.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),I)},"pointer/interpolate":{LX:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Ue:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Ue:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ue:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ue:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ue:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ue:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ue:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ue:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,p,e,r,I)=>(I.forEach((p=>{"FlowGraphJsonPointerParserBlock"===p.className?(p.config||(p.config={}),p.config.outputValue=!0):"FlowGraphInterpolationBlock"===p.className&&(p.config||(p.config={}),Object.keys(w.values||[]).forEach((e=>{var I;const d=null===(I=w.values)||void 0===I?void 0:I[e];if("value"===e&&d){const w=d.type;void 0!==w&&(p.config.animationType=r.arrays.types[w].flowGraphType)}})))})),I)},"animation/start":{LX:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ue:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(w,p)=>[w[0]*p._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(w,p)=>[w[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){const q=I[I.length-1];return q.config||(q.config={}),q.config.glTF=f,I}},"animation/stop":{LX:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ue:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){const q=I[I.length-1];return q.config||(q.config={}),q.config.glTF=f,I}},"animation/stopAt":{LX:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Ue:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(w,p)=>[w[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){const q=I[I.length-1];return q.config||(q.config={}),q.config.glTF=f,I}},"math/switch":{LX:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(w){if(w.configuration&&w.configuration.cases){const p=w.configuration.cases.value;if(!p.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return y.c.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const e=new Set(p);w.configuration.cases.value=Array.from(e)}return{valid:!0}},extraProcessor(w,p,e,r,I){const d=I[0];return d.dataInputs.forEach((w=>{"default"!==w.name&&"case"!==w.name&&(w.name="in_"+w.name)})),d.config||(d.config={}),d.config.treatCasesAsIntegers=!0,I}},"debug/log":{LX:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Re(w){let p=arguments.length>2?arguments[2]:void 0;return{LX:[w],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((w,p)=>(w[p]={name:p},w)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(w,e,r,I,d){var f;if(p){(f=d[0]).config||(f.config={}),d[0].config.preventIntegerFloatArithmetic=!0;let p=-1;Object.keys(w.values||{}).find((e=>{var r;return void 0!==(null===(r=w.values)||void 0===r?void 0:r[e].type)&&(p=w.values[e].type,!0)})),-1!==p&&(d[0].config.type=I.arrays.types[p].flowGraphType)}return d},validation:w=>p?Ve(w):{valid:!0}}}function Ve(w){if(w.values){const p=Object.keys(w.values).map((p=>w.values[p].type)).filter((w=>void 0!==w));if(!p.every((w=>w===p[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}ve["math/compose"]=ve["math/matCompose"],ve["math/decompose"]=ve["math/matDecompose"];var be=e(11190);const he={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ne",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Pe{constructor(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=w,this._gltf=p,this._animationTargetFps=e,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const w of this._interactivityGraph.types)this._types.push(he[w.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const w of this._interactivityGraph.declarations){const p=le(w);if(!p)throw y.c.Error(["No mapping found for declaration",w]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:p,fullOperationName:w.extension?w.op+":"+w.extension:w.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const w of this._interactivityGraph.variables){const p=this._parseVariable(w);this._staticVariables.push(p)}}_parseVariable(w,p){const e=this._types[w.type];if(!e)throw y.c.Error(["No type found for variable",w]),new Error("Error parsing variables");if(w.value&&w.value.length!==e.length)throw y.c.Error(["Invalid value length for variable",w,e]),new Error("Error parsing variables");const r=w.value||[];if(!r.length)switch(e.flowGraphType){case"boolean":r.push(!1);break;case"FlowGraphInteger":r.push(0);break;case"number":r.push(NaN);break;case"Vector2":r.push(NaN,NaN);break;case"ne":r.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":r.fill(NaN,0,4);break;case"Matrix":r.fill(NaN,0,16);break;case"Matrix3D":r.fill(NaN,0,9)}return"number"===e.elementType&&"string"===typeof r[0]&&(r[0]=parseFloat(r[0])),{type:e.flowGraphType,value:p?p(r,this):r}}_parseEvents(){if(this._interactivityGraph.events)for(const w of this._interactivityGraph.events){const p={eventId:w.id||"internalEvent_"+this._internalEventsCounter++};w.values&&(p.eventData=Object.keys(w.values).map((p=>{var e;const r=null===(e=w.values)||void 0===e?void 0:e[p];if(!r)throw y.c.Error(["No value found for event key",p]),new Error("Error parsing events");const I=this._types[r.type];if(!I)throw y.c.Error(["No type found for event value",r]),new Error("Error parsing events");const d="undefined"!==typeof r.value?this._parseVariable(r):void 0;return{id:p,type:I.flowGraphType,eventData:!0,value:d}}))),this._events.push(p)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const p of this._interactivityGraph.nodes){if("number"!==typeof p.declaration)throw y.c.Error(["No declaration found for node",p]),new Error("Error parsing nodes");const e=this._mappings[p.declaration];if(!e)throw y.c.Error(["No mapping found for node",p]),new Error("Error parsing nodes");if(e.flowGraphMapping.validation){const r=e.flowGraphMapping.validation(p,this._interactivityGraph,this._gltf);var w;if(!r.valid)throw new Error(`Error validating interactivity node ${null===(w=this._interactivityGraph.declarations)||void 0===w?void 0:w[p.declaration].op} - ${r.error}`)}const r=[];for(const w of e.flowGraphMapping.LX){const I=this._getEmptyBlock(w,e.fullOperationName);this._parseNodeConfiguration(p,I,e.flowGraphMapping,w),r.push(I)}this._nodes.push({LX:r,fullOperationName:e.fullOperationName})}}_getEmptyBlock(w,p){return{uniqueId:(0,be.b)(),className:w,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:p,metadata:{}}}_parseNodeConfiguration(w,p,e,r){const I=p.config;if(w.configuration){const p=Object.keys(w.configuration);for(const q of p){var d,f;const p=null===(d=w.configuration)||void 0===d?void 0:d[q];if(!p)throw y.c.Error(["No value found for node configuration",q]),new Error("Error parsing node configuration");const E=null===(f=e.configuration)||void 0===f?void 0:f[q];if(E&&E.Ue?E.Ue===r:0===e.LX.indexOf(r)){const w=(null===E||void 0===E?void 0:E.name)||q;p&&"undefined"!==typeof p.value||"undefined"===typeof(null===E||void 0===E?void 0:E.defaultValue)?p.value.length>=0?I[w]={value:1===p.value.length?p.value[0]:p.value}:y.c.Warn(["Invalid value for node configuration",p]):I[w]={value:E.defaultValue},E&&E.dataTransformer&&(I[w].value=E.dataTransformer([I[w].value],this)[0])}}}}_parseNodeConnections(w){for(let M=0;M<this._nodes.length;M++){var p;const i=null===(p=this._interactivityGraph.nodes)||void 0===p?void 0:p[M];if(!i)throw y.c.Error(["No node found for interactivity node",this._nodes[M]]),new Error("Error parsing node connections");const t=this._nodes[M],n=this._mappings[i.declaration];if(!n)throw y.c.Error(["No mapping found for node",i]),new Error("Error parsing node connections");const l=i.flows||{},N=Object.keys(l).sort();for(const w of N){var e,r,I,d;const p=l[w],j=null===(e=n.flowGraphMapping.outputs)||void 0===e||null===(r=e.flows)||void 0===r?void 0:r[w],X=(null===j||void 0===j?void 0:j.name)||w,k=this._createNewSocketConnection(X,!0);(j&&j.Ue&&t.LX.find((w=>w.className===j.Ue))||t.LX[0]).signalOutputs.push(k);const m=p.node,J=this._nodes[m];if(!J)throw y.c.Error(["No node found for input node id",m]),new Error("Error parsing node connections");const K=ne(J.fullOperationName);if(!K)throw y.c.Error(["No mapping found for input node",J]),new Error("Error parsing node connections");let c=null===(I=K.inputs)||void 0===I||null===(d=I.flows)||void 0===d?void 0:d[p.socket||"in"],s=!1;if(!c)for(const w in null===(f=K.inputs)||void 0===f?void 0:f.flows){var f,q,E;if(w.startsWith("[")&&w.endsWith("]"))s=!0,c=null===(q=K.inputs)||void 0===q||null===(E=q.flows)||void 0===E?void 0:E[w]}const O=c?s?c.name.replace("$1",p.socket||""):c.name:p.socket||"in",a=c&&c.Ue&&J.LX.find((w=>w.className===c.Ue))||J.LX[0];let A=a.signalInputs.find((w=>w.name===O));A||(A=this._createNewSocketConnection(O),a.signalInputs.push(A)),A.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(A.uniqueId)}const U=i.values||{},v=Object.keys(U);for(const p of v){var j,X;const e=U[p];let r=null===(j=n.flowGraphMapping.inputs)||void 0===j||null===(X=j.values)||void 0===X?void 0:X[p],I=!1;if(!r)for(const w in null===(k=n.flowGraphMapping.inputs)||void 0===k?void 0:k.values){var k,m,J;if(w.startsWith("[")&&w.endsWith("]"))I=!0,r=null===(m=n.flowGraphMapping.inputs)||void 0===m||null===(J=m.values)||void 0===J?void 0:J[w]}const d=r?I?r.name.replace("$1",p):r.name:p,f=this._createNewSocketConnection(d);if((r&&r.Ue&&t.LX.find((w=>w.className===r.Ue))||t.LX[0]).dataInputs.push(f),void 0!==e.value){const p=this._parseVariable(e,r&&r.dataTransformer);w._connectionValues[f.uniqueId]=p}else{if("undefined"===typeof e.node)throw y.c.Error(["Invalid value for value connection",e]),new Error("Error parsing node connections");{var K,c,s;const w=e.node,p=e.socket||"value",r=this._nodes[w];if(!r)throw y.c.Error(["No node found for output socket reference",e]),new Error("Error parsing node connections");const I=ne(r.fullOperationName);if(!I)throw y.c.Error(["No mapping found for output socket reference",e]),new Error("Error parsing node connections");let d=null===(K=I.outputs)||void 0===K||null===(c=K.values)||void 0===c?void 0:c[p],q=!1;if(!d)for(const e in null===(O=I.outputs)||void 0===O?void 0:O.values){var O,a,A;if(e.startsWith("[")&&e.endsWith("]"))q=!0,d=null===(a=I.outputs)||void 0===a||null===(A=a.values)||void 0===A?void 0:A[e]}const E=d?q?d.name.replace("$1",p):null===(s=d)||void 0===s?void 0:s.name:p,j=d&&d.Ue&&r.LX.find((w=>w.className===d.Ue))||r.LX[0];let X=j.dataOutputs.find((w=>w.name===E));X||(X=this._createNewSocketConnection(E,!0),j.dataOutputs.push(X)),f.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(f.uniqueId)}}}if(n.flowGraphMapping.interBlockConnectors)for(const w of n.flowGraphMapping.interBlockConnectors){const p=w.input,e=w.output,r=w.isVariable;this._connectFlowGraphNodes(p,e,t.LX[w.inputBlockIndex],t.LX[w.outputBlockIndex],r)}if(n.flowGraphMapping.extraProcessor){var z;const p=null===(z=this._interactivityGraph.declarations)||void 0===z?void 0:z[i.declaration];if(!p)throw y.c.Error(["No declaration found for extra processor",i]),new Error("Error parsing node connections");t.LX=n.flowGraphMapping.extraProcessor(i,p,n.flowGraphMapping,this,t.LX,w,this._gltf)}}}_createNewSocketConnection(w,p){return{uniqueId:(0,be.b)(),name:w,_connectionType:p?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(w,p,e,r,I){const d=I?e.dataInputs:e.signalInputs,f=I?r.dataOutputs:r.signalOutputs,q=d.find((p=>p.name===w))||this._createNewSocketConnection(w),E=f.find((w=>w.name===p))||this._createNewSocketConnection(p,!0);d.find((p=>p.name===w))||d.push(q),f.find((w=>w.name===p))||f.push(E),q.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(q.uniqueId)}getVariableName(w){return"staticVariable_"+w}serializeToFlowGraph(){const w={uniqueId:(0,be.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(w);for(let p=0;p<this._staticVariables.length;p++){const e=this._staticVariables[p];w._userVariables[this.getVariableName(p)]=e}return{rightHanded:!0,allBlocks:this._nodes.reduce(((w,p)=>w.concat(p.LX)),[]),executionContexts:[w]}}}const ue="KHR_interactivity";class Ye{constructor(w){this._loader=w,this.name=ue,this.enabled=this._loader.isExtensionUsed(ue),this._pathConverter=(0,L.g)(this._loader.Ge),w._skipStartAnimationStep=!0;const p=w.babylonScene;p&&function(w){(0,L.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!w.activeCamera)return new I.c(NaN,NaN,NaN,NaN);const p=I.c.FromRotationMatrix(w.activeCamera.getWorldMatrix()).normalize();return w.useRightHandedSystem||(p.w*=-1,p.x*=-1),p},type:"Quaternion",getTarget:()=>w.activeCamera}),(0,L.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!w.activeCamera)return new I.k(NaN,NaN,NaN);const p=w.activeCamera.getWorldMatrix().getTranslation();return w.useRightHandedSystem||(p.x*=-1),p},type:"ne",getTarget:()=>w.activeCamera}),(0,L.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:w=>{var p;return(null===(p=w._babylonAnimationGroup)||void 0===p?void 0:p.isPlaying)??!1},type:"boolean",getTarget:w=>w._babylonAnimationGroup}),(0,L.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:w=>{var p;return((null===(p=w._babylonAnimationGroup)||void 0===p?void 0:p.from)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,L.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:w=>{var p;return((null===(p=w._babylonAnimationGroup)||void 0===p?void 0:p.to)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,L.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:w=>{var p;return((null===(p=w._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,L.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:w=>{var p;return((null===(p=w._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup})}(p)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var w;if(!this._loader.babylonScene||!this._pathConverter)return;const p=this._loader.babylonScene,e=null===(w=this._loader.Ge.extensions)||void 0===w?void 0:w.KHR_interactivity;if(!e)return;const r=new Ke.c({yp:p});r.dispatchEventsSynchronously=!1;const I=e.graphs.map((w=>new Pe(w,this._loader.Ge,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(I.map((async w=>await Me(w,{coordinator:r,pathConverter:this._pathConverter})))),r.start()}}var Le;Le=async()=>(await Promise.resolve().then(e.bind(e,12926))).FlowGraphGLTFDataProvider,ye[`${ue}/${"FlowGraphGLTFDataProvider"}`]=Le,Y(ue),u(ue,!0,(w=>new Ye(w)));const We="KHR_node_visibility";(0,L.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:w=>{const p=w._babylonTransformNode;return!p||void 0===p.isVisible||p.isVisible},set:(w,p)=>{var e,r;null===(e=p._primitiveBabylonMeshes)||void 0===e||e.forEach((w=>{w.inheritVisibility=!0})),p._babylonTransformNode&&(p._babylonTransformNode.isVisible=w),null===(r=p._primitiveBabylonMeshes)||void 0===r||r.forEach((p=>{p.isVisible=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Fe{constructor(w){this.name=We,this._loader=w,this.enabled=w.isExtensionUsed(We)}async onReady(){var w;null===(w=this._loader.Ge.nodes)||void 0===w||w.forEach((w=>{var p,e,r,I;(null===(p=w._primitiveBabylonMeshes)||void 0===p||p.forEach((w=>{w.inheritVisibility=!0})),null!==(e=w.extensions)&&void 0!==e&&e.KHR_node_visibility)&&(!1===(null===(r=w.extensions)||void 0===r?void 0:r.KHR_node_visibility.visible)&&(w._babylonTransformNode&&(w._babylonTransformNode.isVisible=!1),null===(I=w._primitiveBabylonMeshes)||void 0===I||I.forEach((w=>{w.isVisible=!1}))))}))}dispose(){this._loader=null}}Y(We),u(We,!0,(w=>new Fe(w)));const He="KHR_node_selectability";Ne("event/onSelect",He,{LX:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ue:"FlowGraphGetVariableBlock",dataTransformer:w=>["pickedMesh_"+w[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Ue:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){var q,E,j,X,k,m;const J=I[I.length-1];J.config=J.config||{},J.config.glTF=f;const K=null===(q=w.configuration)||void 0===q||null===(E=q.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const y="pickedMesh_"+K;return I[1].config.variable=y,d._userVariables[y]={className:"Mesh",id:null===f||void 0===f||null===(j=f.nodes)||void 0===j||null===(X=j[K]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===f||void 0===f||null===(k=f.nodes)||void 0===k||null===(m=k[K]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},I}}),(0,L.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:w=>{const p=w._babylonTransformNode;return!p||void 0===p.kj||p.kj},set:(w,p)=>{var e;null===(e=p._primitiveBabylonMeshes)||void 0===e||e.forEach((p=>{p.kj=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"kj"],type:"boolean"});class Be{constructor(w){this.name=He,this._loader=w,this.enabled=w.isExtensionUsed(He)}async onReady(){var w;null===(w=this._loader.Ge.nodes)||void 0===w||w.forEach((w=>{var p,e,r;null!==(p=w.extensions)&&void 0!==p&&p.KHR_node_selectability&&!1===(null===(e=w.extensions)||void 0===e?void 0:e.KHR_node_selectability.selectable)&&(null===(r=w._babylonTransformNode)||void 0===r||r.getChildMeshes().forEach((w=>{w.kj=!1})))}))}dispose(){this._loader=null}}Y(He),u(He,!0,(w=>new Be(w)));const De="KHR_node_hoverability",Te="targetMeshPointerOver_";Ne("event/onHoverIn",De,{LX:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ue:"FlowGraphGetVariableBlock",dataTransformer:w=>[Te+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ue:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){var q,E,j,X,k,m;const J=I[I.length-1];J.config=J.config||{},J.config.glTF=f;const K=null===(q=w.configuration)||void 0===q||null===(E=q.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const y=Te+K;return I[1].config.variable=y,d._userVariables[y]={className:"Mesh",id:null===f||void 0===f||null===(j=f.nodes)||void 0===j||null===(X=j[K]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===f||void 0===f||null===(k=f.nodes)||void 0===k||null===(m=k[K]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},I}});const Ze="targetMeshPointerOut_";Ne("event/onHoverOut",De,{LX:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ue:"FlowGraphGetVariableBlock",dataTransformer:w=>[Ze+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ue:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,p,e,r,I,d,f){var q,E,j,X,k,m;const J=I[I.length-1];J.config=J.config||{},J.config.glTF=f;const K=null===(q=w.configuration)||void 0===q||null===(E=q.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const y=Ze+K;return I[1].config.variable=y,d._userVariables[y]={className:"Mesh",id:null===f||void 0===f||null===(j=f.nodes)||void 0===j||null===(X=j[K]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===f||void 0===f||null===(k=f.nodes)||void 0===k||null===(m=k[K]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},I}}),(0,L.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:w=>{const p=w._babylonTransformNode;return!p||void 0===p.pointerOverDisableMeshTesting||p.pointerOverDisableMeshTesting},set:(w,p)=>{var e;null===(e=p._primitiveBabylonMeshes)||void 0===e||e.forEach((p=>{p.pointerOverDisableMeshTesting=!w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Ge{constructor(w){this.name=De,this._loader=w,this.enabled=w.isExtensionUsed(De)}async onReady(){var w;null===(w=this._loader.Ge.nodes)||void 0===w||w.forEach((w=>{var p,e,r;null!==(p=w.extensions)&&void 0!==p&&p.KHR_node_hoverability&&!1===(null===(e=w.extensions)||void 0===e?void 0:e.KHR_node_hoverability.hoverable)&&(null===(r=w._babylonTransformNode)||void 0===r||r.getChildMeshes().forEach((w=>{w.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}Y(De),u(De,!0,(w=>new Ge(w)));const ge="ExtrasAsMetadata";class oe{_assignExtras(w,p){if(p.extras&&Object.keys(p.extras).length>0){const e=w.metadata=w.metadata||{};(e.Ge=e.Ge||{}).extras=p.extras}}constructor(w){this.name=ge,this.enabled=!0,this._loader=w}dispose(){this._loader=null}loadNodeAsync(w,p,e){return this._loader.loadNodeAsync(w,p,(w=>{this._assignExtras(w,p),e(w)}))}loadCameraAsync(w,p,e){return this._loader.loadCameraAsync(w,p,(w=>{this._assignExtras(w,p),e(w)}))}createMaterial(w,p,e){const r=this._loader.createMaterial(w,p,e);return this._assignExtras(r,p),r}}Y(ge),u(ge,!1,(w=>new oe(w)));e(12926)},12796:(w,p,e)=>{"use strict";e.d(p,{b:()=>V,f:()=>n,h:()=>t,l:()=>l});var r=e(11056),I=e(11071),d=e(12419),f=e(11370),q=e(11325),E=e(11333),j=e(11081),X=e(11051),k=e(11365),m=e(11729),J=e(11374),K=e(11304);class y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.tm=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.fJ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(w){this._environmentTexture=w}getNodes(){let w=[];w=w.concat(this.meshes),w=w.concat(this.lights),w=w.concat(this.cameras),w=w.concat(this.transformNodes);for(const p of this.skeletons)w=w.concat(p.bones);return w}}class c extends y{}class s{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const w=this.rootNodes;for(const r of w)r.dispose();w.length=0;const p=this.skeletons;for(const r of p)r.dispose();p.length=0;const e=this.animationGroups;for(const r of e)r.dispose();e.length=0}}class O extends y{constructor(w){super(),this._wasAddedToScene=!1,(w=w||X.d.LastCreatedScene)&&(this.yp=w,this.proceduralTextures=[],w.ue.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=w.getEngine().onContextRestoredObservable.add((()=>{for(const w of this.geometries)w._rebuild();for(const w of this.meshes)w._rebuild();for(const w of this.tm)w.rebuild();for(const w of this.textures)w._rebuild()})))}_topologicalSort(w){const p=new Map;for(const f of w)p.set(f.uniqueId,f);const e={dependsOn:new Map,dependedBy:new Map};for(const f of w){const w=f.uniqueId;e.dependsOn.set(w,new Set),e.dependedBy.set(w,new Set)}for(const f of w){const w=f.uniqueId,r=e.dependsOn.get(w);if(f instanceof k.b){const I=f.sourceMesh;p.has(I.uniqueId)&&(r.add(I.uniqueId),e.dependedBy.get(I.uniqueId).add(w))}const I=e.dependedBy.get(w);for(const d of f.getDescendants()){const r=d.uniqueId;if(p.has(r)){I.add(r);e.dependsOn.get(r).add(w)}}}const r=[],I=[];for(const f of w){const w=f.uniqueId;0===e.dependsOn.get(w).size&&(I.push(f),p.delete(w))}const d=I;for(;d.length>0;){const w=d.shift();r.push(w);const I=e.dependedBy.get(w.uniqueId);for(const r of Array.from(I.values())){const I=e.dependsOn.get(r);I.delete(w.uniqueId),0===I.size&&p.get(r)&&(d.push(p.get(r)),p.delete(r))}}return p.size>0&&(j.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),p.forEach((w=>{j.c.Error(w.name)}))),r}_addNodeAndDescendantsToList(w,p,e,r){if(e&&(!r||r(e))&&!p.has(e.uniqueId)){w.push(e),p.add(e.uniqueId);for(const I of e.getDescendants(!0))this._addNodeAndDescendantsToList(w,p,I,r)}}_isNodeInContainer(w){return w instanceof E.b&&-1!==this.meshes.indexOf(w)||(w instanceof q.e&&-1!==this.transformNodes.indexOf(w)||(w instanceof m.b&&-1!==this.lights.indexOf(w)||w instanceof J.d&&-1!==this.cameras.indexOf(w)))}_isValidHierarchy(){for(const w of this.meshes)if(w.parent&&!this._isNodeInContainer(w.parent))return j.c.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.transformNodes)if(w.parent&&!this._isNodeInContainer(w.parent))return j.c.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.lights)if(w.parent&&!this._isNodeInContainer(w.parent))return j.c.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.cameras)if(w.parent&&!this._isNodeInContainer(w.parent))return j.c.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(w){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||I.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const r={},d={},q=new s,E=[],j=[],X={doNotInstantiate:!0,...e},k=[],m=new Set;for(const I of this.transformNodes)null===I.parent&&this._addNodeAndDescendantsToList(k,m,I,X.predicate);for(const I of this.meshes)null===I.parent&&this._addNodeAndDescendantsToList(k,m,I,X.predicate);const J=this._topologicalSort(k),K=(e,I)=>{if(((p,e)=>{if(r[p.uniqueId]=e.uniqueId,d[e.uniqueId]=e,w&&(e.name=w(p.name)),e instanceof f.c){const w=e;if(w.morphTargetManager){const e=p.morphTargetManager;w.morphTargetManager=e.clone();for(let p=0;p<e.numTargets;p++){const I=e.getTarget(p),f=w.morphTargetManager.getTarget(p);r[I.uniqueId]=f.uniqueId,d[f.uniqueId]=f}}}})(e,I),e.parent){const w=r[e.parent.uniqueId],p=d[w];I.parent=p||e.parent}if(I.position&&e.position&&I.position.X(e.position),I.rotationQuaternion&&e.rotationQuaternion&&I.rotationQuaternion.X(e.rotationQuaternion),I.rotation&&e.rotation&&I.rotation.X(e.rotation),I.Ne&&e.Ne&&I.Ne.X(e.Ne),I.material){const f=I;if(f.material)if(p){const p=e.material;if(-1===j.indexOf(p)){let e=p.clone(w?w(p.name):"Clone of "+p.name);if(j.push(p),r[p.uniqueId]=e.uniqueId,d[e.uniqueId]=e,"MultiMaterial"===p.getClassName()){const I=p;for(const p of I.Ce)p&&(e=p.clone(w?w(p.name):"Clone of "+p.name),j.push(p),r[p.uniqueId]=e.uniqueId,d[e.uniqueId]=e);I.Ce=I.Ce.map((w=>w&&d[r[w.uniqueId]]))}}"InstancedMesh"!==f.getClassName()&&(f.material=d[r[p.uniqueId]])}else"MultiMaterial"===f.material.getClassName()?-1===this.yp.multiMaterials.indexOf(f.material)&&this.yp.addMultiMaterial(f.material):-1===this.yp.materials.indexOf(f.material)&&this.yp.addMaterial(f.material)}null===I.parent&&q.rootNodes.push(I)};for(const I of J)if("InstancedMesh"===I.getClassName()){const w=I,p=w.sourceMesh,e=r[p.uniqueId];K(w,("number"===typeof e?d[e]:p).createInstance(w.name))}else{let w=!0;"dd"===I.getClassName()||"Node"===I.getClassName()||I.skeleton||!I.getTotalVertices||0===I.getTotalVertices()?w=!1:X.doNotInstantiate&&(w="function"===typeof X.doNotInstantiate?!X.doNotInstantiate(I):!X.doNotInstantiate);const p=w?I.createInstance(`instance of ${I.name}`):I.clone(`Clone of ${I.name}`,null,!0);if(!p)throw new Error(`Could not clone or instantiate node on Asset Container ${I.name}`);K(I,p)}for(const I of this.skeletons){if(X.predicate&&!X.predicate(I))continue;const p=I.clone(w?w(I.name):"Clone of "+I.name);for(const w of this.meshes)if(w.skeleton===I&&!w.isAnInstance){const e=d[r[w.uniqueId]];if(!e||e.isAnInstance)continue;if(e.skeleton=p,-1!==E.indexOf(p))continue;E.push(p);for(const w of p.bones)w._linkedTransformNode&&(w._linkedTransformNode=d[r[w._linkedTransformNode.uniqueId]])}q.skeletons.push(p)}for(const I of this.animationGroups){if(X.predicate&&!X.predicate(I))continue;const p=I.clone(w?w(I.name):"Clone of "+I.name,(w=>d[r[w.uniqueId]]||w));q.animationGroups.push(p)}return q}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||I.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yp.environmentTexture=this.environmentTexture);for(const w of this.yp._serializableComponents)w.addFromContainer(this);this.yp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=[];for(const e of this.cameras)w&&!w(e)||(this.yp.addCamera(e),p.push(e));for(const e of this.lights)w&&!w(e)||(this.yp.addLight(e),p.push(e));for(const e of this.meshes)w&&!w(e)||(this.yp.tX(e),p.push(e));for(const e of this.skeletons)w&&!w(e)||this.yp.addSkeleton(e);for(const e of this.animations)w&&!w(e)||this.yp.addAnimation(e);for(const e of this.animationGroups)w&&!w(e)||this.yp.addAnimationGroup(e);for(const e of this.multiMaterials)w&&!w(e)||this.yp.addMultiMaterial(e);for(const e of this.materials)w&&!w(e)||this.yp.addMaterial(e);for(const e of this.morphTargetManagers)w&&!w(e)||this.yp.addMorphTargetManager(e);for(const e of this.geometries)w&&!w(e)||this.yp.addGeometry(e);for(const e of this.transformNodes)w&&!w(e)||(this.yp.addTransformNode(e),p.push(e));for(const e of this.actionManagers)w&&!w(e)||this.yp.addActionManager(e);for(const e of this.textures)w&&!w(e)||this.yp.addTexture(e);for(const e of this.reflectionProbes)w&&!w(e)||this.yp.addReflectionProbe(e);for(const e of p)e.parent&&-1===this.yp.getNodes().indexOf(e.parent)&&(e.setParent?e.setParent(null):e.parent=null)}removeAllFromScene(){this._isValidHierarchy()||I.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yp.environmentTexture&&(this.yp.environmentTexture=null);for(const w of this.yp._serializableComponents)w.removeFromContainer(this)}removeFromScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const p of this.cameras)w&&!w(p)||this.yp.removeCamera(p);for(const p of this.lights)w&&!w(p)||this.yp.removeLight(p);for(const p of this.meshes)w&&!w(p)||this.yp.iX(p,!0);for(const p of this.skeletons)w&&!w(p)||this.yp.removeSkeleton(p);for(const p of this.animations)w&&!w(p)||this.yp.removeAnimation(p);for(const p of this.animationGroups)w&&!w(p)||this.yp.removeAnimationGroup(p);for(const p of this.multiMaterials)w&&!w(p)||this.yp.removeMultiMaterial(p);for(const p of this.materials)w&&!w(p)||this.yp.removeMaterial(p);for(const p of this.morphTargetManagers)w&&!w(p)||this.yp.removeMorphTargetManager(p);for(const p of this.geometries)w&&!w(p)||this.yp.removeGeometry(p);for(const p of this.transformNodes)w&&!w(p)||this.yp.removeTransformNode(p);for(const p of this.actionManagers)w&&!w(p)||this.yp.removeActionManager(p);for(const p of this.textures)w&&!w(p)||this.yp.removeTexture(p);for(const p of this.reflectionProbes)w&&!w(p)||this.yp.removeReflectionProbe(p)}dispose(){const w=this.cameras.slice(0);for(const J of w)J.dispose();this.cameras.length=0;const p=this.lights.slice(0);for(const J of p)J.dispose();this.lights.length=0;const e=this.meshes.slice(0);for(const J of e)J.dispose();this.meshes.length=0;const r=this.skeletons.slice(0);for(const J of r)J.dispose();this.skeletons.length=0;const I=this.animationGroups.slice(0);for(const J of I)J.dispose();this.animationGroups.length=0;const d=this.multiMaterials.slice(0);for(const J of d)J.dispose();this.multiMaterials.length=0;const f=this.materials.slice(0);for(const J of f)J.dispose();this.materials.length=0;const q=this.geometries.slice(0);for(const J of q)J.dispose();this.geometries.length=0;const E=this.transformNodes.slice(0);for(const J of E)J.dispose();this.transformNodes.length=0;const j=this.actionManagers.slice(0);for(const J of j)J.dispose();this.actionManagers.length=0;const X=this.textures.slice(0);for(const J of X)J.dispose();this.textures.length=0;const k=this.reflectionProbes.slice(0);for(const J of k)J.dispose();this.reflectionProbes.length=0;const m=this.morphTargetManagers.slice(0);for(const J of m)J.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const J of this.yp._serializableComponents)J.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(w,p,e){if(w&&p)for(const r of w){let w=!0;if(e)for(const p of e)if(r===p){w=!1;break}w&&(p.push(r),r._parentContainer=this)}}moveAllFromScene(w){this._wasAddedToScene=!1,void 0===w&&(w=new c);for(const p in this)Object.prototype.hasOwnProperty.call(this,p)&&(this[p]=this[p]||("_environmentTexture"===p?null:[]),this._moveAssets(this.yp[p],this[p],w[p]));this.environmentTexture=this.yp.environmentTexture,this.removeAllFromScene()}createRootMesh(){const w=new f.c("assetContainerRootMesh",this.yp);for(const p of this.meshes)p.parent||w.addChild(p);return this.meshes.unshift(w),w}mergeAnimationsTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.d.LastCreatedScene,p=arguments.length>1?arguments[1]:void 0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!w)return j.c.Error("No scene available to merge animations to"),[];const r=e||(p=>{let e=null;const r=p.animations.length?p.animations[0].targetProperty:"",I=p.name.split(".").join("").split("_primitive")[0];switch(r){case"position":case"rotationQuaternion":e=w.getTransformNodeByName(p.name)||w.getTransformNodeByName(I);break;case"influence":e=w.getMorphTargetByName(p.name)||w.getMorphTargetByName(I);break;default:e=w.getNodeByName(p.name)||w.getNodeByName(I)}return e}),I=this.getNodes();for(const q of I){const w=r(q);if(null!==w){for(const p of q.animations){const e=w.animations.filter((w=>w.targetProperty===p.targetProperty));for(const p of e){const e=w.animations.indexOf(p,0);e>-1&&w.animations.splice(e,1)}}w.animations=w.animations.concat(q.animations)}}const d=[],f=this.animationGroups.slice();for(const q of f){d.push(q.clone(q.name,r));for(const w of q.animatables)w.stop()}for(const q of p){const p=r(q.target);p&&(w.beginAnimation(p,q.fromFrame,q.toFrame,q.loopAnimation,q.speedRatio,q.onAnimationEnd?q.onAnimationEnd:void 0,void 0,!0,void 0,q.onAnimationLoop?q.onAnimationLoop:void 0),w.stopAnimation(q.target))}return d}populateRootNodes(){this.rootNodes.length=0;for(const w of this.meshes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.transformNodes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.lights)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.cameras)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w)}addAllAssetsToContainer(w){if(!w)return;const p=[],e=new Set;for(p.push(w);p.length>0;){const w=p.pop();if(w instanceof f.c?(w.me&&-1===this.geometries.indexOf(w.me)&&this.geometries.push(w.me),this.meshes.push(w)):w instanceof k.b?this.meshes.push(w):w instanceof q.e?this.transformNodes.push(w):w instanceof m.b?this.lights.push(w):w instanceof J.d&&this.cameras.push(w),w instanceof E.b){if(w.material&&-1===this.materials.indexOf(w.material)){this.materials.push(w.material);for(const p of w.material.getActiveTextures())-1===this.textures.indexOf(p)&&this.textures.push(p)}w.skeleton&&-1===this.skeletons.indexOf(w.skeleton)&&this.skeletons.push(w.skeleton),w.morphTargetManager&&-1===this.morphTargetManagers.indexOf(w.morphTargetManager)&&this.morphTargetManagers.push(w.morphTargetManager)}for(const r of w.getChildren())e.has(r)||p.push(r);e.add(w)}this.populateRootNodes()}_getByTags(w,p,e){if(void 0===p)return w;const r=[];for(const I in w){const d=w[I];K.b&&K.b.MatchesQuery(d,p)&&(!e||e(d))&&r.push(d)}return r}getMeshesByTags(w,p){return this._getByTags(this.meshes,w,p)}getCamerasByTags(w,p){return this._getByTags(this.cameras,w,p)}getLightsByTags(w,p){return this._getByTags(this.lights,w,p)}getMaterialsByTags(w,p){return this._getByTags(this.materials,w,p).concat(this._getByTags(this.multiMaterials,w,p))}getTransformNodesByTags(w,p){return this._getByTags(this.transformNodes,w,p)}}var a=e(11116);class A{constructor(w){this.byteOffset=0,this.buffer=w}async loadAsync(w){const p=await this.buffer.readAsync(this.byteOffset,w);this._dataView=new DataView(p.buffer,p.byteOffset,p.byteLength),this._dataByteOffset=0}readUint32(){const w=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,w}readUint8Array(w){const p=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,w);return this._dataByteOffset+=w,this.byteOffset+=w,p}readString(w){return(0,a.j)(this.readUint8Array(w))}skipBytes(w){this._dataByteOffset+=w,this.byteOffset+=w}}var z=e(12802);const M="Z2xURg",i={name:"Ge",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:w=>-1!==w.indexOf("asset")&&-1!==w.indexOf("version")||w.startsWith("data:base64,"+M)||w.startsWith("data:;base64,"+M)||w.startsWith("data:application/octet-stream;base64,"+M)||w.startsWith("data:model/gltf-binary;base64,"+M)};var t,n,l,N=e(11107),U=e(11113);function v(w,p,e){try{return Promise.resolve(new Uint8Array(w,p,e))}catch(r){return Promise.reject(r)}}!function(w){w[w.AUTO=0]="AUTO",w[w.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(t||(t={})),function(w){w[w.NONE=0]="NONE",w[w.FIRST=1]="FIRST",w[w.ALL=2]="ALL"}(n||(n={})),function(w){w[w.LOADING=0]="LOADING",w[w.READY=1]="READY",w[w.COMPLETE=2]="COMPLETE"}(l||(l={}));class R{constructor(){this.coordinateSystemMode=t.AUTO,this.animationStartMode=n.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=w=>Promise.resolve(w),this.extensionOptions={}}X(w){w&&(this.onParsed=w.onParsed,this.coordinateSystemMode=w.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=w.animationStartMode??this.animationStartMode,this.loadNodeAnimations=w.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=w.loadSkins??this.loadSkins,this.loadMorphTargets=w.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=w.compileMaterials??this.compileMaterials,this.useClipPlane=w.useClipPlane??this.useClipPlane,this.compileShadowGenerators=w.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=w.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=w.useRangeRequests??this.useRangeRequests,this.createInstances=w.createInstances??this.createInstances,this.alwaysComputeBoundingBox=w.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=w.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=w.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=w.skipMaterials??this.skipMaterials,this.useSRGBBuffers=w.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=w.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=w.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=w.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=w.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=w.customRootNode,this.onMeshLoaded=w.onMeshLoaded,this.onSkinLoaded=w.onSkinLoaded,this.onTextureLoaded=w.onTextureLoaded,this.onMaterialLoaded=w.onMaterialLoaded,this.onCameraLoaded=w.onCameraLoaded,this.extensionOptions=w.extensionOptions??this.extensionOptions)}}class V extends R{constructor(w){super(),this.onParsedObservable=new r.d,this.onMeshLoadedObservable=new r.d,this.onSkinLoadedObservable=new r.d,this.onTextureLoadedObservable=new r.d,this.onMaterialLoadedObservable=new r.d,this.onCameraLoadedObservable=new r.d,this.onCompleteObservable=new r.d,this.onErrorObservable=new r.d,this.ue=new r.d,this.onExtensionLoadedObservable=new r.d,this.validate=!1,this.onValidatedObservable=new r.d,this._loader=null,this._state=null,this._requests=new Array,this.name=i.name,this.extensions=i.extensions,this.onLoaderStateChangedObservable=new r.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.X(w)}set onParsed(w){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),w&&(this._onParsedObserver=this.onParsedObservable.add(w))}set onMeshLoaded(w){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),w&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(w))}set onSkinLoaded(w){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),w&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((p=>w(p.node,p.skinnedNode))))}set onTextureLoaded(w){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),w&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(w))}set onMaterialLoaded(w){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),w&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(w))}set onCameraLoaded(w){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),w&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(w))}set onComplete(w){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(w)}set onError(w){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(w)}set onDispose(w){this._onDisposeObserver&&this.ue.remove(this._onDisposeObserver),this._onDisposeObserver=this.ue.add(w)}set onExtensionLoaded(w){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(w)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(w){this._loggingEnabled!==w&&(this._loggingEnabled=w,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(w){this._capturePerformanceCounters!==w&&(this._capturePerformanceCounters=w,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(w){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(w)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const w of this._requests)w.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=w=>Promise.resolve(w),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ue.notifyObservers(void 0),this.ue.clear()}loadFile(w,p,e,d,f,q,E,X){if(ArrayBuffer.isView(p))return this._loadBinary(w,p,e,d,E,X),null;this._progressCallback=f;const k=p.name||I.g.GetFilename(p);if(q){if(this.useRangeRequests){this.validate&&j.c.Warn("glTF validation is not supported when range requests are enabled");const e={abort:()=>{},onCompleteObservable:new r.d},I={readAsync:(e,r)=>new Promise(((I,d)=>{this._loadFile(w,p,(w=>{I(new Uint8Array(w))}),!0,(w=>{d(w)}),(w=>{w.setRequestHeader("Range",`bytes=${e}-${e+r-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new A(I)).then((w=>{e.onCompleteObservable.notifyObservers(e),d(w)}),E?w=>E(void 0,w):void 0),e}return this._loadFile(w,p,(p=>{this._validate(w,new Uint8Array(p,0,p.byteLength),e,k),this._unpackBinaryAsync(new A({readAsync:(w,e)=>v(p,w,e),byteLength:p.byteLength})).then((w=>{d(w)}),E?w=>E(void 0,w):void 0)}),!0,E)}return this._loadFile(w,p,(p=>{try{this._validate(w,p,e,k),d({json:this._parseJson(p)})}catch{E&&E()}}),!1,E)}_loadBinary(w,p,e,r,I,d){this._validate(w,new Uint8Array(p.buffer,p.byteOffset,p.byteLength),e,d),this._unpackBinaryAsync(new A({readAsync:(w,e)=>function(w,p,e){try{if(p<0||p>=w.byteLength)throw new RangeError("Offset is out of range.");if(p+e>w.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(w.buffer,w.byteOffset+p,e))}catch(r){return Promise.reject(r)}}(p,w,e),byteLength:p.byteLength})).then((w=>{r(w)}),I?w=>I(void 0,w):void 0)}importMeshAsync(w,p,e,r,I,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(e),this._loader.importMeshAsync(w,p,null,e,r,I,d))))}loadAsync(w,p,e,r,I){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(p),this._loader.loadAsync(w,p,e,r,I))))}loadAssetContainerAsync(w,p,e,r,I){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(p);const d=new O(w),f=[];this.onMaterialLoadedObservable.add((w=>{f.push(w)}));const q=[];this.onTextureLoadedObservable.add((w=>{q.push(w)}));const E=[];this.onCameraLoadedObservable.add((w=>{E.push(w)}));const j=[];return this.onMeshLoadedObservable.add((w=>{w.morphTargetManager&&j.push(w.morphTargetManager)})),this._loader.importMeshAsync(null,w,d,p,e,r,I).then((w=>(Array.prototype.push.apply(d.geometries,w.geometries),Array.prototype.push.apply(d.meshes,w.meshes),Array.prototype.push.apply(d.tm,w.tm),Array.prototype.push.apply(d.skeletons,w.skeletons),Array.prototype.push.apply(d.animationGroups,w.animationGroups),Array.prototype.push.apply(d.materials,f),Array.prototype.push.apply(d.textures,q),Array.prototype.push.apply(d.lights,w.lights),Array.prototype.push.apply(d.transformNodes,w.transformNodes),Array.prototype.push.apply(d.cameras,E),Array.prototype.push.apply(d.morphTargetManagers,j),d)))}))}canDirectLoad(w){return i.canDirectLoad(w)}directLoad(w,p){if(p.startsWith("base64,"+M)||p.startsWith(";base64,"+M)||p.startsWith("application/octet-stream;base64,"+M)||p.startsWith("model/gltf-binary;base64,"+M)){const e=(0,N.d)(p);return this._validate(w,new Uint8Array(e,0,e.byteLength)),this._unpackBinaryAsync(new A({readAsync:(w,p)=>v(e,w,p),byteLength:e.byteLength}))}return this._validate(w,p),Promise.resolve({json:this._parseJson(p)})}createPlugin(w){return new V(w[i.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((w,p)=>{this.onCompleteObservable.addOnce((()=>{w()})),this.onErrorObservable.addOnce((w=>{p(w)}))}))}_setState(w){this._state!==w&&(this._state=w,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(l[this._state]))}_loadFile(w,p,e,r,I,d){const f=w._loadFile(p,e,(w=>{this._onProgress(w,f)}),!0,r,I,d);return f.onCompleteObservable.add((()=>{f._lengthComputable=!0,f._total=f._loaded})),this._requests.push(f),f}_onProgress(w,p){if(!this._progressCallback)return;p._lengthComputable=w.lengthComputable,p._loaded=w.loaded,p._total=w.total;let e=!0,r=0,I=0;for(const d of this._requests){if(void 0===d._lengthComputable||void 0===d._loaded||void 0===d._total)return;e=e&&d._lengthComputable,r+=d._loaded,I+=d._total}this._progressCallback({lengthComputable:e,loaded:r,total:e?I:0})}_validate(w,p){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),z.e.ValidateAsync(p,e,r,(p=>this.preprocessUrlAsync(e+p).then((p=>w._loadFileAsync(p,void 0,!0,!0).then((w=>new Uint8Array(w,0,w.byteLength))))))).then((w=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(w),this.onValidatedObservable.clear()}),(w=>{this._endPerformanceCounter("Validate JSON"),I.g.Warn(`Failed to validate: ${w.message}`),this.onValidatedObservable.clear()})))}_getLoader(w){const p=w.json.asset||{};this._log(`Asset version: ${p.version}`),p.minVersion&&this._log(`Asset minimum version: ${p.minVersion}`),p.generator&&this._log(`Asset generator: ${p.generator}`);const e=V._parseVersion(p.version);if(!e)throw new Error("Invalid version: "+p.version);if(void 0!==p.minVersion){const w=V._parseVersion(p.minVersion);if(!w)throw new Error("Invalid minimum version: "+p.minVersion);if(V._compareVersion(w,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+p.minVersion)}const r={1:V._CreateGLTF1Loader,2:V._CreateGLTF2Loader}[e.major];if(!r)throw new Error("Unsupported version: "+p.version);return r(this)}_parseJson(w){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${w.length}`);const p=JSON.parse(w);return this._endPerformanceCounter("Parse JSON"),p}_unpackBinaryAsync(w){return this._startPerformanceCounter("Unpack Binary"),w.loadAsync(20).then((()=>{const p=w.readUint32();if(1179937895!==p)throw new U.l("Unexpected magic: "+p,U.i.GLTFLoaderUnexpectedMagicError);const e=w.readUint32();this.loggingEnabled&&this._log(`Binary version: ${e}`);const r=w.readUint32();let I;switch(this.useRangeRequests||r===w.buffer.byteLength||j.c.Warn(`Length in header does not match actual data length: ${r} != ${w.buffer.byteLength}`),e){case 1:I=this._unpackBinaryV1Async(w,r);break;case 2:I=this._unpackBinaryV2Async(w,r);break;default:throw new Error("Unsupported version: "+e)}return this._endPerformanceCounter("Unpack Binary"),I}))}_unpackBinaryV1Async(w,p){const e=w.readUint32(),r=w.readUint32();if(0!==r)throw new Error(`Unexpected content format: ${r}`);const I=p-w.byteOffset,d={json:this._parseJson(w.readString(e)),bin:null};if(0!==I){const p=w.byteOffset;d.bin={readAsync:(e,r)=>w.buffer.readAsync(p+e,r),byteLength:I}}return Promise.resolve(d)}_unpackBinaryV2Async(w,p){const e=1313821514,r=5130562,I=w.readUint32();if(w.readUint32()!==e)throw new Error("First chunk format is not JSON");return w.byteOffset+I===p?w.loadAsync(I).then((()=>({json:this._parseJson(w.readString(I)),bin:null}))):w.loadAsync(I+8).then((()=>{const d={json:this._parseJson(w.readString(I)),bin:null},f=()=>{const I=w.readUint32();switch(w.readUint32()){case e:throw new Error("Unexpected JSON chunk");case r:{const p=w.byteOffset;d.bin={readAsync:(e,r)=>w.buffer.readAsync(p+e,r),byteLength:I},w.skipBytes(I);break}default:w.skipBytes(I)}return w.byteOffset!==p?w.loadAsync(8).then(f):Promise.resolve(d)};return f()}))}static _parseVersion(w){if("1.0"===w||"1.0.1"===w)return{major:1,minor:0};const p=(w+"").match(/^(\d+)\.(\d+)/);return p?{major:parseInt(p[1]),minor:parseInt(p[2])}:null}static _compareVersion(w,p){return w.major>p.major?1:w.major<p.major?-1:w.minor>p.minor?1:w.minor<p.minor?-1:0}_logOpen(w){this._log(w),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(w){const p=V._logSpaces.substring(0,2*this._logIndentLevel);j.c.Log(`${p}${w}`)}_logDisabled(w){}_startPerformanceCounterEnabled(w){I.g.StartPerformanceCounter(w)}_startPerformanceCounterDisabled(w){}_endPerformanceCounterEnabled(w){I.g.EndPerformanceCounter(w)}_endPerformanceCounterDisabled(w){}}V.IncrementalLoading=!0,V.HomogeneousCoordinates=!1,V._logSpaces="                                ",(0,d.e)(new V)},12802:(w,p,e)=>{"use strict";e.d(p,{e:()=>f});var r=e(11071);function I(w,p,e,r){const I={externalResourceFunction:r};return e&&(I.uri="file:"===p?e:p+e),ArrayBuffer.isView(w)?GLTFValidator.validateBytes(w,I):GLTFValidator.validateString(w,I)}function d(){const w=[];onmessage=p=>{const e=p.data;switch(e.id){case"init":importScripts(e.url);break;case"validate":I(e.data,e.rootUrl,e.fileName,(p=>new Promise(((e,r)=>{const I=w.length;w.push({resolve:e,reject:r}),postMessage({id:"getExternalResource",index:I,uri:p})})))).then((w=>{postMessage({id:"validate.resolve",value:w})}),(w=>{postMessage({id:"validate.reject",reason:w})}));break;case"getExternalResource.resolve":w[e.index].resolve(e.value);break;case"getExternalResource.reject":w[e.index].reject(e.reason)}}}class f{static ValidateAsync(w,p,e,f){return"function"===typeof Worker?new Promise(((q,E)=>{const j=`${I}(${d})()`,X=URL.createObjectURL(new Blob([j],{type:"application/javascript"})),k=new Worker(X),m=w=>{k.removeEventListener("error",m),k.removeEventListener("message",J),E(w)},J=w=>{const p=w.data;switch(p.id){case"getExternalResource":f(p.uri).then((w=>{k.postMessage({id:"getExternalResource.resolve",index:p.index,value:w},[w.buffer])}),(w=>{k.postMessage({id:"getExternalResource.reject",index:p.index,reason:w})}));break;case"validate.resolve":k.removeEventListener("error",m),k.removeEventListener("message",J),q(p.value),k.terminate();break;case"validate.reject":k.removeEventListener("error",m),k.removeEventListener("message",J),E(p.reason),k.terminate()}};if(k.addEventListener("error",m),k.addEventListener("message",J),k.postMessage({id:"init",url:r.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(w)){const r=w.slice();k.postMessage({id:"validate",data:r,rootUrl:p,fileName:e},[r.buffer])}else k.postMessage({id:"validate",data:w,rootUrl:p,fileName:e})})):(this._LoadScriptPromise||(this._LoadScriptPromise=r.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>I(w,p,e,f))))}}f.Configuration={url:`${r.g._DefaultCdnUrl}/gltf_validator.js`}},13376:(w,p,e)=>{"use strict";e.d(p,{c:()=>i});var r=e(11207),I=e(11213),d=e(11301),f=e(11023),q=e(11648),E=e(11670),j=e(11232),X=e(11590),k=e(11038),m=e(11146);e(12540),e(12449),e(12461),e(12451),e(12468),e(12470),e(12475);const J="imageProcessingCompatibility",K="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";m.e.IncludesShadersStore[J]||(m.e.IncludesShadersStore[J]=K);const y="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";m.e.ShadersStore[y]||(m.e.ShadersStore[y]=c);e(12548),e(12478),e(12483),e(12496),e(12488);const s="skyVertexShader",O="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";m.e.ShadersStore[s]||(m.e.ShadersStore[s]=O);var a=e(11692),A=e(11320),z=e(11310);class M extends q.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class i extends E.b{constructor(w,p){super(w,p),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new f.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=f.k.Zero(),this.up=f.k.Up(),this.dithering=!1,this._cameraPosition=f.k.Zero(),this._skyOrientation=new f.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(w,p){const e=p._drawWrapper;if(this.isFrozen&&e.effect&&e._wasPreviouslyReady)return!0;p.materialDefines||(p.materialDefines=new M);const r=p.materialDefines,I=this.iw();if(this._isReadyForSubMesh(p))return!0;if((0,z.O)(w,I,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,r),(0,z.J)(w,r,!0,!1),r.IMAGEPROCESSINGPOSTPROCESS!==I.imageProcessingConfiguration.applyByPostProcess&&r.markAsMiscDirty(),r.DITHER!==this.dithering&&r.markAsMiscDirty(),r.isDirty){r.markAsProcessed(),I.resetCachedMaterial();const w=new a.c;r.FOG&&w.addFallback(1,"FOG"),r.IMAGEPROCESSINGPOSTPROCESS=I.imageProcessingConfiguration.applyByPostProcess,r.DITHER=this.dithering;const e=[j.e.PositionKind];r.VERTEXCOLOR&&e.push(j.e.ColorKind);const d="sky",f=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,A.b)(f);const q=r.toString();p.setEffect(I.getEngine().createEffect(d,e,f,[],q,w,this.onCompiled,this.onError),r,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(r._renderId=I.getRenderId(),e._wasPreviouslyReady=!0,!0)}bindForSubMesh(w,p,e){const r=this.iw(),I=e.materialDefines;if(!I)return;const d=e.effect;if(!d)return;this._activeEffect=d,this.bindOnlyWorldMatrix(w),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,d,e)&&((0,A.e)(d,this,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,z.i)(I,d,r)),r.fogEnabled&&p.applyFog&&r.fogMode!==X.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),(0,z.e)(r,p,this._activeEffect);const q=r.activeCamera;if(q){const w=q.getWorldMatrix();this._cameraPosition.x=w.m[12],this._cameraPosition.y=w.m[13],this._cameraPosition.z=w.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const w=Math.PI*(this.inclination-.5),p=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(p)*Math.cos(w),this.sunPosition.y=this.distance*Math.sin(-w),this.sunPosition.z=this.distance*Math.sin(p)*Math.cos(w),f.c.FromUnitVectorsToRef(f.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(p,this._activeEffect,e)}getAnimatables(){return[]}dispose(w){super.dispose(w)}clone(w){return d.e.Clone((()=>new i(w,this.iw())),this)}serialize(){const w=super.serialize();return w.customType="BABYLON.SkyMaterial",w}getClassName(){return"SkyMaterial"}static Parse(w,p,e){return d.e.Parse((()=>new i(w.name,p)),w,p,e)}}(0,r.c)([(0,I.J)()],i.prototype,"luminance",void 0),(0,r.c)([(0,I.J)()],i.prototype,"turbidity",void 0),(0,r.c)([(0,I.J)()],i.prototype,"rayleigh",void 0),(0,r.c)([(0,I.J)()],i.prototype,"mieCoefficient",void 0),(0,r.c)([(0,I.J)()],i.prototype,"mieDirectionalG",void 0),(0,r.c)([(0,I.J)()],i.prototype,"distance",void 0),(0,r.c)([(0,I.J)()],i.prototype,"inclination",void 0),(0,r.c)([(0,I.J)()],i.prototype,"azimuth",void 0),(0,r.c)([(0,I.G)()],i.prototype,"sunPosition",void 0),(0,r.c)([(0,I.J)()],i.prototype,"useSunPosition",void 0),(0,r.c)([(0,I.G)()],i.prototype,"cameraOffset",void 0),(0,r.c)([(0,I.G)()],i.prototype,"up",void 0),(0,r.c)([(0,I.J)()],i.prototype,"dithering",void 0),(0,k.d)("BABYLON.SkyMaterial",i)},11810:(w,p,e)=>{"use strict";function r(w,p){p.headers=w.headers||{},p.statusMessage=w.statusText,p.statusCode=w.status,p.data=w.response}function I(w,p,e){return new Promise((function(I,d){e=e||{};var f,q,E,j=new XMLHttpRequest,X=e.body,k=e.headers||{};for(f in e.timeout&&(j.timeout=e.timeout),j.ontimeout=j.onerror=function(w){w.timeout="timeout"==w.type,d(w)},j.open(w,p.href||p),j.onload=function(){for(E=j.getAllResponseHeaders().trim().split(/[\r\n]+/),r(j,j);q=E.shift();)q=q.split(": "),j.headers[q.shift().toLowerCase()]=q.join(": ");if((q=j.headers["content-type"])&&~q.indexOf("application/json"))try{j.data=JSON.parse(j.data,e.reviver)}catch(w){return r(j,w),d(w)}(j.status>=400?d:I)(j)},typeof FormData<"u"&&X instanceof FormData||X&&"object"==typeof X&&(k["content-type"]="application/json",X=JSON.stringify(X)),j.withCredentials=!!e.withCredentials,k)j.setRequestHeader(f,k[f]);j.send(X)}))}e.r(p),e.d(p,{del:()=>E,get:()=>d,patch:()=>q,post:()=>f,put:()=>j,send:()=>I});var d=I.bind(I,"GET"),f=I.bind(I,"POST"),q=I.bind(I,"PATCH"),E=I.bind(I,"DELETE"),j=I.bind(I,"PUT")},13488:(w,p,e)=>{"use strict";e.d(p,{c:()=>k});const r=.5*(Math.sqrt(3)-1),I=(3-Math.sqrt(3))/6,d=1/3,f=1/6,q=(Math.sqrt(5)-1)/4,E=(5-Math.sqrt(5))/20,j=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),X=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const k=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const p="function"==typeof w?w:function(w){let p=0,e=0,r=0,I=1;const d=function(){let w=4022871197;return function(p){p=p.toString();for(let e=0;e<p.length;e++){w+=p.charCodeAt(e);let r=.02519603282416938*w;w=r>>>0,r-=w,r*=w,w=r>>>0,r-=w,w+=4294967296*r}return 2.3283064365386963e-10*(w>>>0)}}();p=d(" "),e=d(" "),r=d(" "),p-=d(w),p<0&&(p+=1);e-=d(w),e<0&&(e+=1);r-=d(w),r<0&&(r+=1);return function(){const w=2091639*p+2.3283064365386963e-10*I;return p=e,e=r,r=w-(I=0|w)}}(w);this.p=function(w){const p=new Uint8Array(256);for(let e=0;e<256;e++)p[e]=e;for(let e=0;e<255;e++){const r=e+~~(w()*(256-e)),I=p[e];p[e]=p[r],p[r]=I}return p}(p),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(w,p){const e=this.permMod12,d=this.perm;let f=0,q=0,E=0;const X=(w+p)*r,k=Math.floor(w+X),m=Math.floor(p+X),J=(k+m)*I,K=w-(k-J),y=p-(m-J);let c,s;K>y?(c=1,s=0):(c=0,s=1);const O=K-c+I,a=y-s+I,A=K-1+2*I,z=y-1+2*I,M=255&k,i=255&m;let t=.5-K*K-y*y;if(t>=0){const w=3*e[M+d[i]];t*=t,f=t*t*(j[w]*K+j[w+1]*y)}let n=.5-O*O-a*a;if(n>=0){const w=3*e[M+c+d[i+s]];n*=n,q=n*n*(j[w]*O+j[w+1]*a)}let l=.5-A*A-z*z;if(l>=0){const w=3*e[M+1+d[i+1]];l*=l,E=l*l*(j[w]*A+j[w+1]*z)}return 70*(f+q+E)}noise3D(w,p,e){const r=this.permMod12,I=this.perm;let q,E,X,k;const m=(w+p+e)*d,J=Math.floor(w+m),K=Math.floor(p+m),y=Math.floor(e+m),c=(J+K+y)*f,s=w-(J-c),O=p-(K-c),a=e-(y-c);let A,z,M,i,t,n;s>=O?O>=a?(A=1,z=0,M=0,i=1,t=1,n=0):s>=a?(A=1,z=0,M=0,i=1,t=0,n=1):(A=0,z=0,M=1,i=1,t=0,n=1):O<a?(A=0,z=0,M=1,i=0,t=1,n=1):s<a?(A=0,z=1,M=0,i=0,t=1,n=1):(A=0,z=1,M=0,i=1,t=1,n=0);const l=s-A+f,N=O-z+f,U=a-M+f,v=s-i+2*f,R=O-t+2*f,V=a-n+2*f,b=s-1+.5,h=O-1+.5,P=a-1+.5,u=255&J,Y=255&K,L=255&y;let W=.6-s*s-O*O-a*a;if(W<0)q=0;else{const w=3*r[u+I[Y+I[L]]];W*=W,q=W*W*(j[w]*s+j[w+1]*O+j[w+2]*a)}let F=.6-l*l-N*N-U*U;if(F<0)E=0;else{const w=3*r[u+A+I[Y+z+I[L+M]]];F*=F,E=F*F*(j[w]*l+j[w+1]*N+j[w+2]*U)}let H=.6-v*v-R*R-V*V;if(H<0)X=0;else{const w=3*r[u+i+I[Y+t+I[L+n]]];H*=H,X=H*H*(j[w]*v+j[w+1]*R+j[w+2]*V)}let B=.6-b*b-h*h-P*P;if(B<0)k=0;else{const w=3*r[u+1+I[Y+1+I[L+1]]];B*=B,k=B*B*(j[w]*b+j[w+1]*h+j[w+2]*P)}return 32*(q+E+X+k)}noise4D(w,p,e,r){const I=this.perm;let d,f,j,k,m;const J=(w+p+e+r)*q,K=Math.floor(w+J),y=Math.floor(p+J),c=Math.floor(e+J),s=Math.floor(r+J),O=(K+y+c+s)*E,a=w-(K-O),A=p-(y-O),z=e-(c-O),M=r-(s-O);let i=0,t=0,n=0,l=0;a>A?i++:t++,a>z?i++:n++,a>M?i++:l++,A>z?t++:n++,A>M?t++:l++,z>M?n++:l++;const N=i>=3?1:0,U=t>=3?1:0,v=n>=3?1:0,R=l>=3?1:0,V=i>=2?1:0,b=t>=2?1:0,h=n>=2?1:0,P=l>=2?1:0,u=i>=1?1:0,Y=t>=1?1:0,L=n>=1?1:0,W=l>=1?1:0,F=a-N+E,H=A-U+E,B=z-v+E,D=M-R+E,T=a-V+2*E,Z=A-b+2*E,G=z-h+2*E,g=M-P+2*E,o=a-u+3*E,C=A-Y+3*E,Q=z-L+3*E,x=M-W+3*E,S=a-1+4*E,ww=A-1+4*E,pw=z-1+4*E,ew=M-1+4*E,rw=255&K,Iw=255&y,dw=255&c,fw=255&s;let qw=.6-a*a-A*A-z*z-M*M;if(qw<0)d=0;else{const w=I[rw+I[Iw+I[dw+I[fw]]]]%32*4;qw*=qw,d=qw*qw*(X[w]*a+X[w+1]*A+X[w+2]*z+X[w+3]*M)}let Ew=.6-F*F-H*H-B*B-D*D;if(Ew<0)f=0;else{const w=I[rw+N+I[Iw+U+I[dw+v+I[fw+R]]]]%32*4;Ew*=Ew,f=Ew*Ew*(X[w]*F+X[w+1]*H+X[w+2]*B+X[w+3]*D)}let jw=.6-T*T-Z*Z-G*G-g*g;if(jw<0)j=0;else{const w=I[rw+V+I[Iw+b+I[dw+h+I[fw+P]]]]%32*4;jw*=jw,j=jw*jw*(X[w]*T+X[w+1]*Z+X[w+2]*G+X[w+3]*g)}let Xw=.6-o*o-C*C-Q*Q-x*x;if(Xw<0)k=0;else{const w=I[rw+u+I[Iw+Y+I[dw+L+I[fw+W]]]]%32*4;Xw*=Xw,k=Xw*Xw*(X[w]*o+X[w+1]*C+X[w+2]*Q+X[w+3]*x)}let kw=.6-S*S-ww*ww-pw*pw-ew*ew;if(kw<0)m=0;else{const w=I[rw+1+I[Iw+1+I[dw+1+I[fw+1]]]]%32*4;kw*=kw,m=kw*kw*(X[w]*S+X[w+1]*ww+X[w+2]*pw+X[w+3]*ew)}return 27*(d+f+j+k+m)}}}}]);