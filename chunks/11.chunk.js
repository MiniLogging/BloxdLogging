/*! For license information please see 9frq29.11.4a450a4b.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{13123:(Z,c,L)=>{"use strict";var k=L(13128),N=L(13131),R=L(13135);L.g.__TYPEDARRAY_POOL||(L.g.__TYPEDARRAY_POOL={UINT8:N([32,0]),UINT16:N([32,0]),UINT32:N([32,0]),INT8:N([32,0]),INT16:N([32,0]),INT32:N([32,0]),FLOAT:N([32,0]),DOUBLE:N([32,0]),DATA:N([32,0]),UINT8C:N([32,0]),BUFFER:N([32,0])});var G="undefined"!==typeof Uint8ClampedArray,V=L.g.__TYPEDARRAY_POOL;V.UINT8C||(V.UINT8C=N([32,0])),V.BUFFER||(V.BUFFER=N([32,0]));var p=V.DATA,J=V.BUFFER;function z(Z){if(Z){var c=Z.length||Z.byteLength,L=k.log2(c);p[L].push(Z)}}function i(Z){Z=k.nextPow2(Z);var c=k.log2(Z),L=p[c];return L.length>0?L.pop():new ArrayBuffer(Z)}function t(Z){return new Uint8Array(i(Z),0,Z)}function E(Z){return new Uint16Array(i(2*Z),0,Z)}function x(Z){return new Uint32Array(i(4*Z),0,Z)}function q(Z){return new Int8Array(i(Z),0,Z)}function O(Z){return new Int16Array(i(2*Z),0,Z)}function w(Z){return new Int32Array(i(4*Z),0,Z)}function M(Z){return new Float32Array(i(4*Z),0,Z)}function P(Z){return new Float64Array(i(8*Z),0,Z)}function j(Z){return G?new Uint8ClampedArray(i(Z),0,Z):t(Z)}function o(Z){return new DataView(i(Z),0,Z)}c.free=function(Z){if(R(Z))J[k.log2(Z.length)].push(Z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Z)&&(Z=Z.buffer),!Z)return;var c=Z.length||Z.byteLength,L=0|k.log2(c);p[L].push(Z)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(Z){z(Z.buffer)},c.freeArrayBuffer=z,c.freeBuffer=function(Z){J[k.log2(Z.length)].push(Z)},c.malloc=function(Z,c){if(void 0===c||"arraybuffer"===c)return i(Z);switch(c){case"uint8":return t(Z);case"uint16":return E(Z);case"uint32":return x(Z);case"int8":return q(Z);case"int16":return O(Z);case"int32":return w(Z);case"float":case"float32":return M(Z);case"double":case"float64":return P(Z);case"uint8_clamped":return j(Z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return o(Z);default:return null}return null},c.mallocArrayBuffer=i,c.mallocUint8=t,c.mallocUint16=E,c.mallocUint32=x,c.mallocInt8=q,c.mallocInt16=O,c.mallocInt32=w,c.mallocFloat32=c.mallocFloat=M,c.mallocFloat64=c.mallocDouble=P,c.mallocUint8Clamped=j,c.mallocDataView=o,c.clearCache=function(){for(var Z=0;Z<32;++Z)V.UINT8[Z].length=0,V.UINT16[Z].length=0,V.UINT32[Z].length=0,V.INT8[Z].length=0,V.INT16[Z].length=0,V.INT32[Z].length=0,V.FLOAT[Z].length=0,V.DOUBLE[Z].length=0,V.UINT8C[Z].length=0,p[Z].length=0,J[Z].length=0}},13214:(Z,c,L)=>{Z.exports=N;var k=L(11980);function N(Z,c){if(!(this instanceof N))return new N(Z,c);var L=k.create();k.add(L,Z,c),this.base=k.min(k.create(),Z,L),this.QJ=k.clone(c),this.max=k.max(k.create(),Z,L),this.mag=k.length(this.QJ)}var R=N.prototype;R.width=function(){return this.QJ[0]},R.height=function(){return this.QJ[1]},R.depth=function(){return this.QJ[2]},R.x0=function(){return this.base[0]},R.y0=function(){return this.base[1]},R.z0=function(){return this.base[2]},R.x1=function(){return this.max[0]},R.y1=function(){return this.max[1]},R.z1=function(){return this.max[2]},R.translate=function(Z){return k.add(this.max,this.max,Z),k.add(this.base,this.base,Z),this},R.setPosition=function(Z){return k.add(this.max,Z,this.QJ),k.i(this.base,Z),this},R.expand=function(Z){var c=k.create(),L=k.create();return k.max(c,Z.max,this.max),k.min(L,Z.base,this.base),k.yL(c,c,L),new N(L,c)},R.intersects=function(Z){return!(Z.base[0]>this.max[0])&&(!(Z.base[1]>this.max[1])&&(!(Z.base[2]>this.max[2])&&(!(Z.max[0]<this.base[0])&&(!(Z.max[1]<this.base[1])&&!(Z.max[2]<this.base[2])))))},R.touches=function(Z){var c=this.union(Z);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},R.union=function(Z){if(!this.intersects(Z))return null;var c=Math.max(Z.base[0],this.base[0]),L=Math.max(Z.base[1],this.base[1]),k=Math.max(Z.base[2],this.base[2]);return new N([c,L,k],[Math.min(Z.max[0],this.max[0])-c,Math.min(Z.max[1],this.max[1])-L,Math.min(Z.max[2],this.max[2])-k])}},13128:(Z,c)=>{"use strict";function L(Z){var c=32;return(Z&=-Z)&&c--,65535&Z&&(c-=16),16711935&Z&&(c-=8),252645135&Z&&(c-=4),858993459&Z&&(c-=2),1431655765&Z&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(Z){return(Z>0)-(Z<0)},c.abs=function(Z){var c=Z>>31;return(Z^c)-c},c.min=function(Z,c){return c^(Z^c)&-(Z<c)},c.max=function(Z,c){return Z^(Z^c)&-(Z<c)},c.isPow2=function(Z){return!(Z&Z-1)&&!!Z},c.log2=function(Z){var c,L;return c=(Z>65535)<<4,c|=L=((Z>>>=c)>255)<<3,c|=L=((Z>>>=L)>15)<<2,(c|=L=((Z>>>=L)>3)<<1)|(Z>>>=L)>>1},c.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},c.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},c.countTrailingZeros=L,c.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},c.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},c.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var k=new Array(256);!function(Z){for(var c=0;c<256;++c){var L=c,k=c,N=7;for(L>>>=1;L;L>>>=1)k<<=1,k|=1&L,--N;Z[c]=k<<N&255}}(k),c.reverse=function(Z){return k[255&Z]<<24|k[Z>>>8&255]<<16|k[Z>>>16&255]<<8|k[Z>>>24&255]},c.interleave2=function(Z,c){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(Z,c){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>c&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},c.interleave3=function(Z,c,L){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},c.deinterleave3=function(Z,c){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>c&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},c.nextCombination=function(Z){var c=Z|Z-1;return c+1|(~c&-~c)-1>>>L(Z)+1}},13114:(Z,c,L)=>{"use strict";Z.exports=function(Z,c,L){switch(arguments.length){case 1:return k=[],J(N=Z,N,z,!0),k;case 2:return"function"===typeof c?J(Z,Z,c,!0):function(Z,c){return k=[],J(Z,c,z,!1),k}(Z,c);case 3:return J(Z,c,L,!1);default:throw new Error("box-intersect: Invalid arguments")}var N};var k,N=L(13123),R=L(13139),G=L(13151);function V(Z,c){for(var L=0;L<Z;++L)if(!(c[L]<=c[L+Z]))return!0;return!1}function p(Z,c,L,k){for(var N=0,R=0,G=0,p=Z.length;G<p;++G){var J=Z[G];if(!V(c,J)){for(var z=0;z<2*c;++z)L[N++]=J[z];k[R++]=G}}return R}function J(Z,c,L,k){var V=Z.length,J=c.length;if(!(V<=0||J<=0)){var z=Z[0].length>>>1;if(!(z<=0)){var i,t=N.mallocDouble(2*z*V),E=N.mallocInt32(V);if((V=p(Z,z,t,E))>0){if(1===z&&k)R.init(V),i=R.sweepComplete(z,L,0,V,t,E,0,V,t,E);else{var x=N.mallocDouble(2*z*J),q=N.mallocInt32(J);(J=p(c,z,x,q))>0&&(R.init(V+J),i=1===z?R.sweepBipartite(z,L,0,V,t,E,0,J,x,q):G(z,L,k,V,t,E,J,x,q),N.free(x),N.free(q))}N.free(t),N.free(E)}return i}}}function z(Z,c){k.push([Z,c])}},13156:(Z,c)=>{"use strict";var L="d",k="ax",N="fp",R="es",G="rs",V="re",p="rb",J="bs",z="be",i="bb",t=[L,k,"vv",G,V,p,"ri",J,z,i,"bi"];function E(Z){var c="bruteForce"+(Z?"Full":"Partial"),k=[],G=t.slice();Z||G.splice(3,0,N);var V=["function "+c+"("+G.join()+"){"];function p(c,N){var G=function(Z,c,k){var N="bruteForce"+(Z?"Red":"Blue")+(c?"Flip":"")+(k?"Full":""),G=["function ",N,"(",t.join(),"){","var ",R,"=2*",L,";"],V="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",p="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(k?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Z?G.push(V,"Q",":",p):G.push(p,"Q",":",V),k?G.push("if(y1<x0||x1<y0)continue;"):c?G.push("if(y0<=x0||x1<y0)continue;"):G.push("if(y0<x0||x1<y0)continue;"),G.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?G.push("yi,xi"):G.push("xi,yi"),G.push(");if(rv!==void 0)return rv;}}}"),{name:N,code:G.join("")}}(c,N,Z);k.push(G.code),V.push("return "+G.name+"("+t.join()+");")}V.push("if(re-rs>be-bs){"),Z?(p(!0,!1),V.push("}else{"),p(!1,!1)):(V.push("if(fp){"),p(!0,!0),V.push("}else{"),p(!0,!1),V.push("}}else{if(fp){"),p(!1,!0),V.push("}else{"),p(!1,!1),V.push("}")),V.push("}}return "+c);var J=k.join("")+V.join("");return new Function(J)()}c.partial=E(!1),c.full=E(!0)},13151:(Z,c,L)=>{"use strict";Z.exports=function(Z,c,L,R,z,e,H,l,W){!function(Z,c){var L=8*N.log2(c+1)*(Z+1)|0,R=N.nextPow2(j*L);u.length<R&&(k.free(u),u=k.mallocInt32(R));var G=N.nextPow2(o*L);X.length<G&&(k.free(X),X=k.mallocDouble(G))}(Z,R+H);var T,I=0,d=2*Z;h(I++,0,0,R,0,H,L?16:0,-1/0,1/0),L||h(I++,0,0,H,0,R,1,-1/0,1/0);for(;I>0;){var Q=(I-=1)*j,r=u[Q],f=u[Q+1],S=u[Q+2],s=u[Q+3],m=u[Q+4],A=u[Q+5],b=I*o,F=X[b],U=X[b+1],K=1&A,n=!!(16&A),g=z,y=e,v=l,Y=W;if(K&&(g=l,y=W,v=z,Y=e),!(2&A&&f>=(S=O(Z,r,f,S,g,y,U)))&&!(4&A&&(f=w(Z,r,f,S,g,y,F))>=S)){var a=S-f,C=m-s;if(n){if(Z*a*(a+C)<E){if(void 0!==(T=p.scanComplete(Z,r,c,f,S,g,y,s,m,v,Y)))return T;continue}}else{if(Z*Math.min(a,C)<i){if(void 0!==(T=G(Z,r,c,K,f,S,g,y,s,m,v,Y)))return T;continue}if(Z*a*C<t){if(void 0!==(T=p.scanBipartite(Z,r,c,K,f,S,g,y,s,m,v,Y)))return T;continue}}var ZZ=x(Z,r,f,S,g,y,F,U);if(f<ZZ)if(Z*(ZZ-f)<i){if(void 0!==(T=V(Z,r+1,c,f,ZZ,g,y,s,m,v,Y)))return T}else if(r===Z-2){if(void 0!==(T=K?p.sweepBipartite(Z,c,s,m,v,Y,f,ZZ,g,y):p.sweepBipartite(Z,c,f,ZZ,g,y,s,m,v,Y)))return T}else h(I++,r+1,f,ZZ,s,m,K,-1/0,1/0),h(I++,r+1,s,m,f,ZZ,1^K,-1/0,1/0);if(ZZ<S){var cZ=J(Z,r,s,m,v,Y),LZ=v[d*cZ+r],kZ=q(Z,r,cZ,m,v,Y,LZ);if(kZ<m&&h(I++,r,ZZ,S,kZ,m,(4|K)+(n?16:0),LZ,U),s<cZ&&h(I++,r,ZZ,S,s,cZ,(2|K)+(n?16:0),F,LZ),cZ+1===kZ){if(void 0!==(T=n?D(Z,r,c,ZZ,S,g,y,cZ,v,Y[cZ]):B(Z,r,c,K,ZZ,S,g,y,cZ,v,Y[cZ])))return T}else if(cZ<kZ){var NZ;if(n){if(ZZ<(NZ=M(Z,r,ZZ,S,g,y,LZ))){var RZ=q(Z,r,ZZ,NZ,g,y,LZ);if(r===Z-2){if(ZZ<RZ&&void 0!==(T=p.sweepComplete(Z,c,ZZ,RZ,g,y,cZ,kZ,v,Y)))return T;if(RZ<NZ&&void 0!==(T=p.sweepBipartite(Z,c,RZ,NZ,g,y,cZ,kZ,v,Y)))return T}else ZZ<RZ&&h(I++,r+1,ZZ,RZ,cZ,kZ,16,-1/0,1/0),RZ<NZ&&(h(I++,r+1,RZ,NZ,cZ,kZ,0,-1/0,1/0),h(I++,r+1,cZ,kZ,RZ,NZ,1,-1/0,1/0))}}else ZZ<(NZ=K?P(Z,r,ZZ,S,g,y,LZ):M(Z,r,ZZ,S,g,y,LZ))&&(r===Z-2?T=K?p.sweepBipartite(Z,c,cZ,kZ,v,Y,ZZ,NZ,g,y):p.sweepBipartite(Z,c,ZZ,NZ,g,y,cZ,kZ,v,Y):(h(I++,r+1,ZZ,NZ,cZ,kZ,K,-1/0,1/0),h(I++,r+1,cZ,kZ,ZZ,NZ,1^K,-1/0,1/0)))}}}}};var k=L(13123),N=L(13128),R=L(13156),G=R.partial,V=R.full,p=L(13139),J=L(13160),z=L(13165),i=128,t=1<<22,E=1<<22,x=z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),q=z("lo===p0",["p0"]),O=z("lo<p0",["p0"]),w=z("hi<=p0",["p0"]),M=z("lo<=p0&&p0<=hi",["p0"]),P=z("lo<p0&&p0<=hi",["p0"]),j=6,o=2,u=k.mallocInt32(1024),X=k.mallocDouble(1024);function h(Z,c,L,k,N,R,G,V,p){var J=j*Z;u[J]=c,u[J+1]=L,u[J+2]=k,u[J+3]=N,u[J+4]=R,u[J+5]=G;var z=o*Z;X[z]=V,X[z+1]=p}function B(Z,c,L,k,N,R,G,V,p,J,z){var i=2*Z,t=p*i,E=J[t+c];Z:for(var x=N,q=N*i;x<R;++x,q+=i){var O=G[q+c],w=G[q+c+Z];if(!(E<O||w<E)&&(!k||E!==O)){for(var M,P=V[x],j=c+1;j<Z;++j){O=G[q+j],w=G[q+j+Z];var o=J[t+j],u=J[t+j+Z];if(w<o||u<O)continue Z}if(void 0!==(M=k?L(z,P):L(P,z)))return M}}}function D(Z,c,L,k,N,R,G,V,p,J){var z=2*Z,i=V*z,t=p[i+c];Z:for(var E=k,x=k*z;E<N;++E,x+=z){var q=G[E];if(q!==J){var O=R[x+c],w=R[x+c+Z];if(!(t<O||w<t)){for(var M=c+1;M<Z;++M){O=R[x+M],w=R[x+M+Z];var P=p[i+M],j=p[i+M+Z];if(w<P||j<O)continue Z}var o=L(q,J);if(void 0!==o)return o}}}}},13160:(Z,c,L)=>{"use strict";Z.exports=function(Z,c,L,G,V,p){if(G<=L+1)return L;var J=L,z=G,i=G+L>>>1,t=2*Z,E=i,x=V[t*i+c];for(;J<z;){if(z-J<N){R(Z,c,J,z,V,p),x=V[t*i+c];break}var q=z-J,O=Math.random()*q+J|0,w=V[t*O+c],M=Math.random()*q+J|0,P=V[t*M+c],j=Math.random()*q+J|0,o=V[t*j+c];w<=P?o>=P?(E=M,x=P):w>=o?(E=O,x=w):(E=j,x=o):P>=o?(E=M,x=P):o>=w?(E=O,x=w):(E=j,x=o);for(var u=t*(z-1),X=t*E,h=0;h<t;++h,++u,++X){var B=V[u];V[u]=V[X],V[X]=B}var D=p[z-1];p[z-1]=p[E],p[E]=D;for(u=t*(z-1),X=t*(E=k(Z,c,J,z-1,V,p,x)),h=0;h<t;++h,++u,++X){B=V[u];V[u]=V[X],V[X]=B}D=p[z-1];if(p[z-1]=p[E],p[E]=D,i<E){for(z=E-1;J<z&&V[t*(z-1)+c]===x;)z-=1;z+=1}else{if(!(E<i))break;for(J=E+1;J<z&&V[t*J+c]===x;)J+=1}}return k(Z,c,L,i,V,p,V[t*i+c])};var k=L(13165)("lo<p0",["p0"]),N=8;function R(Z,c,L,k,N,R){for(var G=2*Z,V=G*(L+1)+c,p=L+1;p<k;++p,V+=G)for(var J=N[V],z=p,i=G*(p-1);z>L&&N[i+c]>J;--z,i-=G){for(var t=i,E=i+G,x=0;x<G;++x,++t,++E){var q=N[t];N[t]=N[E],N[E]=q}var O=R[z];R[z]=R[z-1],R[z-1]=O}}},13165:Z=>{"use strict";Z.exports=function(Z,L){var k="abcdef".split("").concat(L),N=[];Z.indexOf("lo")>=0&&N.push("lo=e[k+n]");Z.indexOf("hi")>=0&&N.push("hi=e[k+o]");return k.push(c.replace("_",N.join()).replace("$",Z)),Function.apply(void 0,k)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13145:Z=>{"use strict";Z.exports=function(Z,k){k<=4*c?L(0,k-1,Z):J(0,k-1,Z)};var c=32;function L(Z,c,L){for(var k=2*(Z+1),N=Z+1;N<=c;++N){for(var R=L[k++],G=L[k++],V=N,p=k-2;V-- >Z;){var J=L[p-2],z=L[p-1];if(J<R)break;if(J===R&&z<G)break;L[p]=J,L[p+1]=z,p-=2}L[p]=R,L[p+1]=G}}function k(Z,c,L){c*=2;var k=L[Z*=2],N=L[Z+1];L[Z]=L[c],L[Z+1]=L[c+1],L[c]=k,L[c+1]=N}function N(Z,c,L){c*=2,L[Z*=2]=L[c],L[Z+1]=L[c+1]}function R(Z,c,L,k){c*=2,L*=2;var N=k[Z*=2],R=k[Z+1];k[Z]=k[c],k[Z+1]=k[c+1],k[c]=k[L],k[c+1]=k[L+1],k[L]=N,k[L+1]=R}function G(Z,c,L,k,N){c*=2,N[Z*=2]=N[c],N[c]=L,N[Z+1]=N[c+1],N[c+1]=k}function V(Z,c,L){c*=2;var k=L[Z*=2],N=L[c];return!(k<N)&&(k!==N||L[Z+1]>L[c+1])}function p(Z,c,L,k){var N=k[Z*=2];return N<c||N===c&&k[Z+1]<L}function J(Z,z,i){var t=(z-Z+1)/6|0,E=Z+t,x=z-t,q=Z+z>>1,O=q-t,w=q+t,M=E,P=O,j=q,o=w,u=x,X=Z+1,h=z-1,B=0;V(M,P,i)&&(B=M,M=P,P=B),V(o,u,i)&&(B=o,o=u,u=B),V(M,j,i)&&(B=M,M=j,j=B),V(P,j,i)&&(B=P,P=j,j=B),V(M,o,i)&&(B=M,M=o,o=B),V(j,o,i)&&(B=j,j=o,o=B),V(P,u,i)&&(B=P,P=u,u=B),V(P,j,i)&&(B=P,P=j,j=B),V(o,u,i)&&(B=o,o=u,u=B);for(var D=i[2*P],e=i[2*P+1],H=i[2*o],l=i[2*o+1],W=2*M,T=2*j,I=2*u,d=2*E,Q=2*q,r=2*x,f=0;f<2;++f){var S=i[W+f],s=i[T+f],m=i[I+f];i[d+f]=S,i[Q+f]=s,i[r+f]=m}N(O,Z,i),N(w,z,i);for(var A=X;A<=h;++A)if(p(A,D,e,i))A!==X&&k(A,X,i),++X;else if(!p(A,H,l,i))for(;;){if(p(h,H,l,i)){p(h,D,e,i)?(R(A,X,h,i),++X,--h):(k(A,h,i),--h);break}if(--h<A)break}G(Z,X-1,D,e,i),G(z,h+1,H,l,i),X-2-Z<=c?L(Z,X-2,i):J(Z,X-2,i),z-(h+2)<=c?L(h+2,z,i):J(h+2,z,i),h-X<=c?L(X,h,i):J(X,h,i)}},13139:(Z,c,L)=>{"use strict";Z.exports={init:function(Z){var c=N.nextPow2(Z);p.length<c&&(k.free(p),p=k.mallocInt32(c));J.length<c&&(k.free(J),J=k.mallocInt32(c));z.length<c&&(k.free(z),z=k.mallocInt32(c));i.length<c&&(k.free(i),i=k.mallocInt32(c));t.length<c&&(k.free(t),t=k.mallocInt32(c));E.length<c&&(k.free(E),E=k.mallocInt32(c));var L=8*c;x.length<L&&(k.free(x),x=k.mallocDouble(L))},sweepBipartite:function(Z,c,L,k,N,V,t,E,w,M){for(var P=0,j=2*Z,o=Z-1,u=j-1,X=L;X<k;++X){var h=V[X],B=j*X;x[P++]=N[B+o],x[P++]=-(h+1),x[P++]=N[B+u],x[P++]=h}for(X=t;X<E;++X){h=M[X]+G;var D=j*X;x[P++]=w[D+o],x[P++]=-h,x[P++]=w[D+u],x[P++]=h}var e=P>>>1;R(x,e);var H=0,l=0;for(X=0;X<e;++X){var W=0|x[2*X+1];if(W>=G)q(z,i,l--,W=W-G|0);else if(W>=0)q(p,J,H--,W);else if(W<=-G){W=-W-G|0;for(var T=0;T<H;++T){if(void 0!==(I=c(p[T],W)))return I}O(z,i,l++,W)}else{W=-W-1|0;for(T=0;T<l;++T){var I;if(void 0!==(I=c(W,z[T])))return I}O(p,J,H++,W)}}},sweepComplete:function(Z,c,L,k,N,G,V,w,M,P){for(var j=0,o=2*Z,u=Z-1,X=o-1,h=L;h<k;++h){var B=G[h]+1<<1,D=o*h;x[j++]=N[D+u],x[j++]=-B,x[j++]=N[D+X],x[j++]=B}for(h=V;h<w;++h){B=P[h]+1<<1;var e=o*h;x[j++]=M[e+u],x[j++]=1|-B,x[j++]=M[e+X],x[j++]=1|B}var H=j>>>1;R(x,H);var l=0,W=0,T=0;for(h=0;h<H;++h){var I=0|x[2*h+1],d=1&I;if(h<H-1&&I>>1===x[2*h+3]>>1&&(d=2,h+=1),I<0){for(var Q=-(I>>1)-1,r=0;r<T;++r){if(void 0!==(f=c(t[r],Q)))return f}if(0!==d)for(r=0;r<l;++r){if(void 0!==(f=c(p[r],Q)))return f}if(1!==d)for(r=0;r<W;++r){var f;if(void 0!==(f=c(z[r],Q)))return f}0===d?O(p,J,l++,Q):1===d?O(z,i,W++,Q):2===d&&O(t,E,T++,Q)}else{Q=(I>>1)-1;0===d?q(p,J,l--,Q):1===d?q(z,i,W--,Q):2===d&&q(t,E,T--,Q)}}},scanBipartite:function(Z,c,L,k,N,V,z,i,t,E,w,M){var P=0,j=2*Z,o=c,u=c+Z,X=1,h=1;k?h=G:X=G;for(var B=N;B<V;++B){var D=B+X,e=j*B;x[P++]=z[e+o],x[P++]=-D,x[P++]=z[e+u],x[P++]=D}for(B=t;B<E;++B){D=B+h;var H=j*B;x[P++]=w[H+o],x[P++]=-D}var l=P>>>1;R(x,l);var W=0;for(B=0;B<l;++B){var T=0|x[2*B+1];if(T<0){var I=!1;if((D=-T)>=G?(I=!k,D-=G):(I=!!k,D-=1),I)O(p,J,W++,D);else{var d=M[D],Q=j*D,r=w[Q+c+1],f=w[Q+c+1+Z];Z:for(var S=0;S<W;++S){var s=p[S],m=j*s;if(!(f<z[m+c+1]||z[m+c+1+Z]<r)){for(var A=c+2;A<Z;++A)if(w[Q+A+Z]<z[m+A]||z[m+A+Z]<w[Q+A])continue Z;var b,F=i[s];if(void 0!==(b=k?L(d,F):L(F,d)))return b}}}}else q(p,J,W--,T-X)}},scanComplete:function(Z,c,L,k,N,V,J,z,i,t,E){for(var q=0,O=2*Z,w=c,M=c+Z,P=k;P<N;++P){var j=P+G,o=O*P;x[q++]=V[o+w],x[q++]=-j,x[q++]=V[o+M],x[q++]=j}for(P=z;P<i;++P){j=P+1;var u=O*P;x[q++]=t[u+w],x[q++]=-j}var X=q>>>1;R(x,X);var h=0;for(P=0;P<X;++P){var B=0|x[2*P+1];if(B<0){if((j=-B)>=G)p[h++]=j-G;else{var D=E[j-=1],e=O*j,H=t[e+c+1],l=t[e+c+1+Z];Z:for(var W=0;W<h;++W){var T=p[W],I=J[T];if(I===D)break;var d=O*T;if(!(l<V[d+c+1]||V[d+c+1+Z]<H)){for(var Q=c+2;Q<Z;++Q)if(t[e+Q+Z]<V[d+Q]||V[d+Q+Z]<t[e+Q])continue Z;var r=L(I,D);if(void 0!==r)return r}}}}else{for(j=B-G,W=h-1;W>=0;--W)if(p[W]===j){for(Q=W+1;Q<h;++Q)p[Q-1]=p[Q];break}--h}}}};var k=L(13123),N=L(13128),R=L(13145),G=1<<28,V=1024,p=k.mallocInt32(V),J=k.mallocInt32(V),z=k.mallocInt32(V),i=k.mallocInt32(V),t=k.mallocInt32(V),E=k.mallocInt32(V),x=k.mallocDouble(8192);function q(Z,c,L,k){var N=c[k],R=Z[L-1];Z[N]=R,c[R]=N}function O(Z,c,L,k){Z[L]=k,c[k]=L}},13131:Z=>{"use strict";function c(Z,L,k){var N=0|Z[k];if(N<=0)return[];var R,G=new Array(N);if(k===Z.length-1)for(R=0;R<N;++R)G[R]=L;else for(R=0;R<N;++R)G[R]=c(Z,L,k+1);return G}Z.exports=function(Z,L){switch("undefined"===typeof L&&(L=0),typeof Z){case"number":if(Z>0)return function(Z,c){var L,k;for(L=new Array(Z),k=0;k<Z;++k)L[k]=c;return L}(0|Z,L);break;case"object":if("number"===typeof Z.length)return c(Z,L,0)}return[]}},13087:(Z,c,L)=>{Z.exports=function(){var Z=this;this.components={},this.comps=this.components;var c=this.components,L=1,N={},R=[],G=[],V={timeout:!1,removals:[],multiComps:[]};function p(Z,L){var k=c[L],R=N[L],G=R.hash[Z];G&&(R.remove(Z),k.Nc&&(k.multi?(G.forEach((c=>{c&&k.Nc(Z,c)})),G.length=0):k.Nc(Z,G)),V.removals.push(R),J())}function J(){V.timeout||(V.timeout=!0,setTimeout(z,1))}function z(){V.timeout=!1,i()}function i(){V.multiComps.length&&function(Z){for(var c=0;c<Z.length;c++){var{entID:L,data:k}=Z[c],N=k.hash[L];if(N){for(var R=0;R<N.length;R++)N[R]||(N.splice(R,1),R--);0===N.length&&(k.remove(L),V.removals.push(k))}}Z.length=0}(V.multiComps),V.removals.length&&function(Z){for(var c=0;c<Z.length;c++){Z[c].flush()}Z.length=0}(V.removals)}this.Cz=N,this._systems=R,this._renderSystems=G,this.SJ=function(c){var k=L++;return Array.isArray(c)&&c.forEach((c=>Z.Bp(k,c))),k},this.deleteEntity=function(c){return Object.keys(N).forEach((Z=>{N[Z].hash[c]&&p(c,Z)})),Z},this.cz=function(Z){if(!Z)throw new Error("Missing component definition");var L=Z.name;if(!L)throw new Error("Component definition must have a name property.");if("string"!==typeof L)throw new Error("Component name must be a string.");if(""===L)throw new Error("Component name must be a non-empty string.");if(N[L])throw new Error(`Component ${L} already exists.`);var V={};return V.name=L,V.multi=!!Z.multi,V.order=isNaN(Z.order)?99:Z.order,V.stateConstructor=Z.stateConstructor||null,V.state=Z.state||{},V.eV=Z.eV||null,V.Nc=Z.Nc||null,V.system=Z.system||null,V.rV=Z.rV||null,c[L]=V,N[L]=new k,N[L]._pendingMultiCleanup=!1,N[L]._multiCleanupIDs=V.multi?[]:null,V.system&&(R.push(L),R.sort(((Z,L)=>c[Z].order-c[L].order))),V.rV&&(G.push(L),G.sort(((Z,L)=>c[Z].order-c[L].order))),L},this.overwriteComponent=function(Z,L){var k=c[Z];if(!k)throw new Error(`Unknown component: ${Z}`);if(!L)throw new Error("Missing component definition");if(k.name!==L.name)throw new Error("Overwriting component must use the same name property.");var V={};V.name=Z,V.multi=!!L.multi,V.order=isNaN(L.order)?99:L.order,V.state=L.state||{},V.eV=L.eV||null,V.Nc=L.Nc||null,V.system=L.system||null,V.rV=L.rV||null,c[Z]=V,N[Z]._pendingMultiCleanup=!1,N[Z]._multiCleanupIDs=V.multi?[]:null;var p=R.indexOf(Z);V.system&&p<0&&R.push(Z),!V.system&&p>=0&&R.splice(p,1),R.sort(((Z,L)=>c[Z].order-c[L].order));var J=G.indexOf(Z);V.rV&&J<0&&G.push(Z),!V.rV&&J>=0&&G.splice(J,1),G.sort(((Z,L)=>c[Z].order-c[L].order));var z=V.state;return this.oJ(Z).forEach((Z=>{for(var c in z)c in Z||(Z[c]=z[c]);V.eV&&V.eV(Z.dV,Z)})),Z},this.deleteComponent=function(L){var k=N[L];if(!k)throw new Error(`Unknown component: ${L}`);k.flush(),k.list.forEach((Z=>{Z&&p(Z.dV||Z[0].dV,L)}));var V=R.indexOf(L),J=G.indexOf(L);return V>-1&&R.splice(V,1),J>-1&&G.splice(J,1),N[L].dispose(),delete N[L],delete c[L],Z},this.Bp=function(Z,L,k){var R,G=c[L],V=N[L];if(!V)throw new Error(`Unknown component: ${L}.`);if(V.hash[Z]&&!G.multi)throw new Error(`Entity ${Z} already has component: ${L}.`);if(G.stateConstructor){if(!(R=new G.stateConstructor).hasOwnProperty("dV"))throw new Error(`Component ${G.name} stateConstructor type does not have property __id`)}else R=Object.assign({},{dV:Z},G.state,k);if(R.dV=Z,G.multi){var p=V.hash[Z];p||(p=[],V.add(Z,p)),p.push(R)}else V.add(Z,R);return G.eV&&G.eV(Z,R),this},this.rp=function(Z,c){var L=N[c];if(!L)throw new Error(`Unknown component: ${c}.`);return!!L.hash[Z]},this.lp=function(c,L){if(!N[L])throw new Error(`Unknown component: ${L}.`);return p(c,L),Z},this.getState=function(Z,c){var L=N[c];if(!L)throw new Error(`Unknown component: ${c}.`);return L.hash[Z]},this.oJ=function(Z){var c=N[Z];if(!c)throw new Error(`Unknown component: ${Z}.`);return i(),c.list},this.yt=function(Z){if(!N[Z])throw new Error(`Unknown component: ${Z}.`);var c=N[Z].hash;return Z=>c[Z]},this.Ct=function(Z){if(!N[Z])throw new Error(`Unknown component: ${Z}.`);var c=N[Z].hash;return Z=>!!c[Z]},this.XV=function(L){i();for(var k=0;k<R.length;k++){var G=R[k],V=c[G],p=N[G];V.system(L,p.list),i()}return Z},this.render=function(L){i();for(var k=0;k<G.length;k++){var R=G[k],V=c[R],p=N[R];V.rV(L,p.list),i()}return Z},this.removeMultiComponent=function(L,k,R){var G=c[k],p=N[k];if(!p)throw new Error(`Unknown component: ${k}.`);if(!G.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Z,c,L,k){var N=L.hash[Z];if(N){var R=N[k];R&&(N[k]=null,c.Nc&&c.Nc(Z,R),V.multiComps.push({entID:Z,data:L}),J())}}(L,G,p,R),Z}};var k=L(13090)},13090:Z=>{function c(Z,c){var L=Z._map[c];if(delete Z.hash[c],delete Z._map[c],L===Z.list.length-1)Z.list.pop();else{var k=Z.list.pop();if(Z.list[L]=k,null===k||null===k[0]){var N=Z.list.length;for(var R in Z._map)if(Z._map[R]===N)return void(Z._map[R]=L)}else{var G=k.dV||k[0].dV;Z._map[G]=L}}}Z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Z,c){if("number"===typeof this._map[Z]){var L=this._map[Z];this.hash[Z]=c,this.list[L]=c}else this._map[Z]=this.list.length,this.hash[Z]=c,this.list.push(c)}remove(Z){var c=this._map[Z];this.hash[Z]=null,this.list[c]=null,this._pendingRemovals.push(Z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Z=0;Z<this._pendingRemovals.length;Z++){var L=this._pendingRemovals[Z];null===this.hash[L]&&c(this,L)}this._pendingRemovals.length=0}}},13049:Z=>{"use strict";var c,L="object"===typeof Reflect?Reflect:null,k=function(Z,c,L){return Function.prototype.apply.call(Z,c,L)};c=L&&"function"===typeof L.ownKeys?L.ownKeys:Object.getOwnPropertySymbols?function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:function(Z){return Object.getOwnPropertyNames(Z)};var N=Number.isNaN||function(Z){return Z!==Z};function R(){R.init.call(this)}Z.exports=R,Z.exports.once=function(Z,c){return new Promise((function(L,k){function N(L){Z.removeListener(c,R),k(L)}function R(){"function"===typeof Z.removeListener&&Z.removeListener("error",N),L([].slice.call(arguments))}q(Z,c,R,{once:!0}),"error"!==c&&function(Z,c,L){"function"===typeof Z.on&&q(Z,"error",c,L)}(Z,N,{once:!0})}))},R.EventEmitter=R,R.prototype._events=void 0,R.prototype._eventsCount=0,R.prototype._maxListeners=void 0;var G=10;function V(Z){if("function"!==typeof Z)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Z)}function p(Z){return void 0===Z._maxListeners?R.defaultMaxListeners:Z._maxListeners}function J(Z,c,L,k){var N,R,G,J;if(V(L),void 0===(R=Z._events)?(R=Z._events=Object.create(null),Z._eventsCount=0):(void 0!==R.newListener&&(Z.emit("newListener",c,L.listener?L.listener:L),R=Z._events),G=R[c]),void 0===G)G=R[c]=L,++Z._eventsCount;else if("function"===typeof G?G=R[c]=k?[L,G]:[G,L]:k?G.unshift(L):G.push(L),(N=p(Z))>0&&G.length>N&&!G.warned){G.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.j=Z,z.type=c,z.count=G.length,J=z,console&&console.warn&&console.warn(J)}return Z}function z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function i(Z,c,L){var k={fired:!1,wrapFn:void 0,target:Z,type:c,listener:L},N=z.bind(k);return N.listener=L,k.wrapFn=N,N}function t(Z,c,L){var k=Z._events;if(void 0===k)return[];var N=k[c];return void 0===N?[]:"function"===typeof N?L?[N.listener||N]:[N]:L?function(Z){for(var c=new Array(Z.length),L=0;L<c.length;++L)c[L]=Z[L].listener||Z[L];return c}(N):x(N,N.length)}function E(Z){var c=this._events;if(void 0!==c){var L=c[Z];if("function"===typeof L)return 1;if(void 0!==L)return L.length}return 0}function x(Z,c){for(var L=new Array(c),k=0;k<c;++k)L[k]=Z[k];return L}function q(Z,c,L,k){if("function"===typeof Z.on)k.once?Z.once(c,L):Z.on(c,L);else{if("function"!==typeof Z.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Z);Z.addEventListener(c,(function N(R){k.once&&Z.removeEventListener(c,N),L(R)}))}}Object.defineProperty(R,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(Z){if("number"!==typeof Z||Z<0||N(Z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Z+".");G=Z}}),R.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},R.prototype.setMaxListeners=function(Z){if("number"!==typeof Z||Z<0||N(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this},R.prototype.getMaxListeners=function(){return p(this)},R.prototype.emit=function(Z){for(var c=[],L=1;L<arguments.length;L++)c.push(arguments[L]);var N="error"===Z,R=this._events;if(void 0!==R)N=N&&void 0===R.error;else if(!N)return!1;if(N){var G;if(c.length>0&&(G=c[0]),G instanceof Error)throw G;var V=new Error("Unhandled error."+(G?" ("+G.message+")":""));throw V.context=G,V}var p=R[Z];if(void 0===p)return!1;if("function"===typeof p)k(p,this,c);else{var J=p.length,z=x(p,J);for(L=0;L<J;++L)k(z[L],this,c)}return!0},R.prototype.addListener=function(Z,c){return J(this,Z,c,!1)},R.prototype.on=R.prototype.addListener,R.prototype.prependListener=function(Z,c){return J(this,Z,c,!0)},R.prototype.once=function(Z,c){return V(c),this.on(Z,i(this,Z,c)),this},R.prototype.prependOnceListener=function(Z,c){return V(c),this.prependListener(Z,i(this,Z,c)),this},R.prototype.removeListener=function(Z,c){var L,k,N,R,G;if(V(c),void 0===(k=this._events))return this;if(void 0===(L=k[Z]))return this;if(L===c||L.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete k[Z],k.removeListener&&this.emit("removeListener",Z,L.listener||c));else if("function"!==typeof L){for(N=-1,R=L.length-1;R>=0;R--)if(L[R]===c||L[R].listener===c){G=L[R].listener,N=R;break}if(N<0)return this;0===N?L.shift():function(Z,c){for(;c+1<Z.length;c++)Z[c]=Z[c+1];Z.pop()}(L,N),1===L.length&&(k[Z]=L[0]),void 0!==k.removeListener&&this.emit("removeListener",Z,G||c)}return this},R.prototype.off=R.prototype.removeListener,R.prototype.removeAllListeners=function(Z){var c,L,k;if(void 0===(L=this._events))return this;if(void 0===L.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==L[Z]&&(0===--this._eventsCount?this._events=Object.create(null):delete L[Z]),this;if(0===arguments.length){var N,R=Object.keys(L);for(k=0;k<R.length;++k)"removeListener"!==(N=R[k])&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=L[Z]))this.removeListener(Z,c);else if(void 0!==c)for(k=c.length-1;k>=0;k--)this.removeListener(Z,c[k]);return this},R.prototype.listeners=function(Z){return t(this,Z,!0)},R.prototype.rawListeners=function(Z){return t(this,Z,!1)},R.listenerCount=function(Z,c){return"function"===typeof Z.listenerCount?Z.listenerCount(c):E.call(Z,c)},R.prototype.listenerCount=E,R.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},13349:Z=>{"use strict";Z.exports=function(Z,c,L,k,N,R){var G=+c[0],V=+c[1],p=+c[2],J=+L[0],z=+L[1],i=+L[2],t=Math.sqrt(J*J+z*z+i*i);if(0===t)throw new Error("Can't raycast along a zero vector");return function(Z,c,L,k,N,R,G,V,p,J){for(var z=0,i=Math.floor,t=0|i(c),E=0|i(L),x=0|i(k),q=N>0?1:-1,O=R>0?1:-1,w=G>0?1:-1,M=Math.abs(1/N),P=Math.abs(1/R),j=Math.abs(1/G),o=M<1/0?M*(q>0?t+1-c:c-t):1/0,u=P<1/0?P*(O>0?E+1-L:L-E):1/0,X=j<1/0?j*(w>0?x+1-k:k-x):1/0,h=-1;z<=V;){var B=Z(t,E,x);if(B)return p&&(p[0]=c+z*N,p[1]=L+z*R,p[2]=k+z*G),J&&(J[0]=J[1]=J[2]=0,0===h&&(J[0]=-q),1===h&&(J[1]=-O),2===h&&(J[2]=-w)),B;o<u?o<X?(t+=q,z=o,o+=M,h=0):(x+=w,z=X,X+=j,h=2):u<X?(E+=O,z=u,u+=P,h=1):(x+=w,z=X,X+=j,h=2)}return p&&(p[0]=c+z*N,p[1]=L+z*R,p[2]=k+z*G),J&&(J[0]=J[1]=J[2]=0),0}(Z,G,V,p,J/=t,z/=t,i/=t,k="undefined"===typeof k?64:+k,N,R)}},13383:(Z,c,L)=>{"use strict";L.d(c,{c:()=>R});var k=L(13049);function N(){this.Ui=!1,this.stopPropagation=!1,this.Ki=!1,this.disabled=!1}class R{constructor(Z,c){this.version="0.7.0";var L=Object.assign({},new N,c||{});this.element=Z||document,this.Ui=!!L.Ui,this.stopPropagation=!!L.stopPropagation,this.Ki=!!L.Ki,this.disabled=!!L.disabled,this.filterEvents=(Z,c)=>!0,this.down=new k.EventEmitter,this.up=new k.EventEmitter,this.state={},this.qJ={dx:0,dy:0,St:0,xJ:0,st:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?V(this):document.addEventListener("DOMContentLoaded",(Z=>{V(this)}),{once:!0})}bind(Z){for(var c=arguments.length,L=new Array(c>1?c-1:0),k=1;k<c;k++)L[k-1]=arguments[k];L.forEach((c=>{var L=this._keyBindmap[c]||[];L.includes(Z)||(L.push(Z),this._keyBindmap[c]=L)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}unbind(Z){for(var c in this._keyBindmap){var L=this._keyBindmap[c],k=L.indexOf(Z);k>-1&&L.splice(k,1)}}getBindings(){var Z={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((L=>{Z[L]=Z[L]||[],Z[L].push(c)}))}return Z}XV(){G(this.qJ),G(this.pressCount),G(this.releaseCount)}}function G(Z){for(var c in Z)Z[c]=0}function V(Z){window.addEventListener("keydown",x.bind(null,Z,!0),!1),window.addEventListener("keyup",x.bind(null,Z,!1),!1);var c={passive:!0};Z.element.addEventListener("touchstart",i.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",E.bind(void 0,Z),c),Z.element.addEventListener("mousedown",q.bind(null,Z,!0),c),window.document.addEventListener("mouseup",q.bind(null,Z,!1),c),Z.element.addEventListener("touchmove",O.bind(null,Z),c),Z.element.addEventListener("mousemove",O.bind(null,Z),c),window.PointerEvent,Z.element.addEventListener("wheel",w.bind(null,Z),c),Z.element.addEventListener("contextmenu",M.bind(null,Z),!1),window.addEventListener("blur",P.bind(null,Z),!1)}var p=0,J=0,z=null;function i(Z,c){c.preventDefault(),t(c)}function t(Z){let c=!1;for(let L=0;L<Z.touches.length;++L)if(Z.touches[L].identifier===z){c=!0;break}if(!c){const c=Z.changedTouches[0];p=c.clientX,J=c.clientY,z=c.identifier}}function E(Z,c){for(var L=c.changedTouches,k=0;k<L.length;++k)L[k].identifier===z&&(z=null)}function x(Z,c,L){j(L.code,c,Z,L)}function q(Z,c,L){if("pointerId"in L)if(c){if(null!==Z._touches.currID)return;Z._touches.currID=L.pointerId}else{if(Z._touches.currID!==L.pointerId)return;Z._touches.currID=null}return j("Mouse"+("button"in L?L.button+1:1),c,Z,L),!1}function O(Z,c){var L=c.movementX||c.mozMovementX||0,k=c.movementY||c.mozMovementY||0;if(c.touches&&0===(L|k)){var N=function(Z){t(Z);for(let c=0;c<Z.changedTouches.length;++c)if(Z.changedTouches[c].identifier==z){const L=Z.changedTouches[c],k=[L.clientX-p,L.clientY-J];return p=L.clientX,J=L.clientY,k}return console.error(`Did not find touch id ${z}`),[0,0]}(c);L=N[0],k=N[1]}Z.qJ.dx+=L,Z.qJ.dy+=k}function w(Z,c){var L=1;switch(c.deltaMode){case 0:L=1;break;case 1:L=12;break;case 2:L=Z.element.clientHeight||window.innerHeight}Z.qJ.St+=(c.deltaX||0)*L,Z.qJ.xJ+=(c.deltaY||0)*L,Z.qJ.st+=(c.deltaZ||0)*L}function M(Z,c){if(!Z.Ki)return c.preventDefault(),!1}function P(Z){for(var c in Z._keyStates)Z._keyStates[c]&&(/^Mouse\d/.test(c)||j(c,!1,Z,{code:c,note:"2agm4nzwdjp",preventDefault:()=>{},stopPropagation:()=>{}}))}function j(Z,c,L,k){var N=L._keyBindmap[Z];N&&(o(L._keyStates[Z],c)&&(L._keyStates[Z]=c,N.forEach((Z=>{(!L.filterEvents||L.filterEvents(k,Z))&&function(Z,c,L,k){var N=c?L.pressCount:L.releaseCount;N[Z]=(N[Z]||0)+1;var R=L._bindPressCount[Z]||0;(R+=c?1:-1)<0&&(R=0);L._bindPressCount[Z]=R;var G=L.state[Z];if(o(G,R)){L.state[Z]=R>0;var V=c?L.down:L.up;L.disabled||V.emit(Z,k)}}(Z,c,L,k)}))),"button"in k||(L.Ui&&!k.defaultPrevented&&k.preventDefault(),L.stopPropagation&&k.stopPropagation()))}function o(Z,c){return Z?!c:c}},12049:Z=>{Z.exports=function(Z,c,L){return Z[0]=c[0]+L[0],Z[1]=c[1]+L[1],Z[2]=c[2]+L[2],Z}},12006:(Z,c,L)=>{Z.exports=function(Z,c){var L=k(Z[0],Z[1],Z[2]),G=k(c[0],c[1],c[2]);N(L,L),N(G,G);var V=R(L,G);return V>1?0:Math.acos(V)};var k=L(12013),N=L(12016),R=L(12023)},12099:Z=>{Z.exports=function(Z,c){return Z[0]=Math.ceil(c[0]),Z[1]=Math.ceil(c[1]),Z[2]=Math.ceil(c[2]),Z}},12004:Z=>{Z.exports=function(Z){var c=new Float32Array(3);return c[0]=Z[0],c[1]=Z[1],c[2]=Z[2],c}},12027:Z=>{Z.exports=function(Z,c){return Z[0]=c[0],Z[1]=c[1],Z[2]=c[2],Z}},11998:Z=>{Z.exports=function(){var Z=new Float32Array(3);return Z[0]=0,Z[1]=0,Z[2]=0,Z}},12190:Z=>{Z.exports=function(Z,c,L){var k=c[0],N=c[1],R=c[2],G=L[0],V=L[1],p=L[2];return Z[0]=N*p-R*V,Z[1]=R*G-k*p,Z[2]=k*V-N*G,Z}},12140:(Z,c,L)=>{Z.exports=L(12131)},12131:Z=>{Z.exports=function(Z,c){var L=c[0]-Z[0],k=c[1]-Z[1],N=c[2]-Z[2];return Math.sqrt(L*L+k*k+N*N)}},12079:(Z,c,L)=>{Z.exports=L(12073)},12073:Z=>{Z.exports=function(Z,c,L){return Z[0]=c[0]/L[0],Z[1]=c[1]/L[1],Z[2]=c[2]/L[2],Z}},12023:Z=>{Z.exports=function(Z,c){return Z[0]*c[0]+Z[1]*c[1]+Z[2]*c[2]}},11989:Z=>{Z.exports=1e-6},12041:(Z,c,L)=>{Z.exports=function(Z,c){var L=Z[0],N=Z[1],R=Z[2],G=c[0],V=c[1],p=c[2];return Math.abs(L-G)<=k*Math.max(1,Math.abs(L),Math.abs(G))&&Math.abs(N-V)<=k*Math.max(1,Math.abs(N),Math.abs(V))&&Math.abs(R-p)<=k*Math.max(1,Math.abs(R),Math.abs(p))};var k=L(11989)},12043:Z=>{Z.exports=function(Z,c){return Z[0]===c[0]&&Z[1]===c[1]&&Z[2]===c[2]}},12090:Z=>{Z.exports=function(Z,c){return Z[0]=Math.floor(c[0]),Z[1]=Math.floor(c[1]),Z[2]=Math.floor(c[2]),Z}},12246:(Z,c,L)=>{Z.exports=function(Z,c,L,N,R,G){var V,p;c||(c=3);L||(L=0);p=N?Math.min(N*c+L,Z.length):Z.length;for(V=L;V<p;V+=c)k[0]=Z[V],k[1]=Z[V+1],k[2]=Z[V+2],R(k,k,G),Z[V]=k[0],Z[V+1]=k[1],Z[V+2]=k[2];return Z};var k=L(11998)()},12013:Z=>{Z.exports=function(Z,c,L){var k=new Float32Array(3);return k[0]=Z,k[1]=c,k[2]=L,k}},11980:(Z,c,L)=>{Z.exports={EPSILON:L(11989),create:L(11998),clone:L(12004),angle:L(12006),qV:L(12013),i:L(12027),set:L(12033),equals:L(12041),exactEquals:L(12043),add:L(12049),yL:L(12053),sub:L(12061),multiply:L(12063),mul:L(12068),divide:L(12073),div:L(12079),min:L(12083),max:L(12088),floor:L(12090),ceil:L(12099),round:L(12108),scale:L(12116),OV:L(12123),distance:L(12131),k:L(12140),squaredDistance:L(12143),sqrDist:L(12147),length:L(12155),len:L(12163),squaredLength:L(12167),wV:L(12174),negate:L(12180),inverse:L(12183),normalize:L(12016),dot:L(12023),cross:L(12190),iV:L(12193),random:L(12197),transformMat4:L(12205),transformMat3:L(12214),transformQuat:L(12223),MV:L(12229),PV:L(12232),jV:L(12241),forEach:L(12246)}},12183:Z=>{Z.exports=function(Z,c){return Z[0]=1/c[0],Z[1]=1/c[1],Z[2]=1/c[2],Z}},12163:(Z,c,L)=>{Z.exports=L(12155)},12155:Z=>{Z.exports=function(Z){var c=Z[0],L=Z[1],k=Z[2];return Math.sqrt(c*c+L*L+k*k)}},12193:Z=>{Z.exports=function(Z,c,L,k){var N=c[0],R=c[1],G=c[2];return Z[0]=N+k*(L[0]-N),Z[1]=R+k*(L[1]-R),Z[2]=G+k*(L[2]-G),Z}},12088:Z=>{Z.exports=function(Z,c,L){return Z[0]=Math.max(c[0],L[0]),Z[1]=Math.max(c[1],L[1]),Z[2]=Math.max(c[2],L[2]),Z}},12083:Z=>{Z.exports=function(Z,c,L){return Z[0]=Math.min(c[0],L[0]),Z[1]=Math.min(c[1],L[1]),Z[2]=Math.min(c[2],L[2]),Z}},12068:(Z,c,L)=>{Z.exports=L(12063)},12063:Z=>{Z.exports=function(Z,c,L){return Z[0]=c[0]*L[0],Z[1]=c[1]*L[1],Z[2]=c[2]*L[2],Z}},12180:Z=>{Z.exports=function(Z,c){return Z[0]=-c[0],Z[1]=-c[1],Z[2]=-c[2],Z}},12016:Z=>{Z.exports=function(Z,c){var L=c[0],k=c[1],N=c[2],R=L*L+k*k+N*N;R>0&&(R=1/Math.sqrt(R),Z[0]=c[0]*R,Z[1]=c[1]*R,Z[2]=c[2]*R);return Z}},12197:Z=>{Z.exports=function(Z,c){c=c||1;var L=2*Math.random()*Math.PI,k=2*Math.random()-1,N=Math.sqrt(1-k*k)*c;return Z[0]=Math.cos(L)*N,Z[1]=Math.sin(L)*N,Z[2]=k*c,Z}},12229:Z=>{Z.exports=function(Z,c,L,k){var N=L[1],R=L[2],G=c[1]-N,V=c[2]-R,p=Math.sin(k),J=Math.cos(k);return Z[0]=c[0],Z[1]=N+G*J-V*p,Z[2]=R+G*p+V*J,Z}},12232:Z=>{Z.exports=function(Z,c,L,k){var N=L[0],R=L[2],G=c[0]-N,V=c[2]-R,p=Math.sin(k),J=Math.cos(k);return Z[0]=N+V*p+G*J,Z[1]=c[1],Z[2]=R+V*J-G*p,Z}},12241:Z=>{Z.exports=function(Z,c,L,k){var N=L[0],R=L[1],G=c[0]-N,V=c[1]-R,p=Math.sin(k),J=Math.cos(k);return Z[0]=N+G*J-V*p,Z[1]=R+G*p+V*J,Z[2]=c[2],Z}},12108:Z=>{Z.exports=function(Z,c){return Z[0]=Math.round(c[0]),Z[1]=Math.round(c[1]),Z[2]=Math.round(c[2]),Z}},12116:Z=>{Z.exports=function(Z,c,L){return Z[0]=c[0]*L,Z[1]=c[1]*L,Z[2]=c[2]*L,Z}},12123:Z=>{Z.exports=function(Z,c,L,k){return Z[0]=c[0]+L[0]*k,Z[1]=c[1]+L[1]*k,Z[2]=c[2]+L[2]*k,Z}},12033:Z=>{Z.exports=function(Z,c,L,k){return Z[0]=c,Z[1]=L,Z[2]=k,Z}},12147:(Z,c,L)=>{Z.exports=L(12143)},12174:(Z,c,L)=>{Z.exports=L(12167)},12143:Z=>{Z.exports=function(Z,c){var L=c[0]-Z[0],k=c[1]-Z[1],N=c[2]-Z[2];return L*L+k*k+N*N}},12167:Z=>{Z.exports=function(Z){var c=Z[0],L=Z[1],k=Z[2];return c*c+L*L+k*k}},12061:(Z,c,L)=>{Z.exports=L(12053)},12053:Z=>{Z.exports=function(Z,c,L){return Z[0]=c[0]-L[0],Z[1]=c[1]-L[1],Z[2]=c[2]-L[2],Z}},12214:Z=>{Z.exports=function(Z,c,L){var k=c[0],N=c[1],R=c[2];return Z[0]=k*L[0]+N*L[3]+R*L[6],Z[1]=k*L[1]+N*L[4]+R*L[7],Z[2]=k*L[2]+N*L[5]+R*L[8],Z}},12205:Z=>{Z.exports=function(Z,c,L){var k=c[0],N=c[1],R=c[2],G=L[3]*k+L[7]*N+L[11]*R+L[15];return G=G||1,Z[0]=(L[0]*k+L[4]*N+L[8]*R+L[12])/G,Z[1]=(L[1]*k+L[5]*N+L[9]*R+L[13])/G,Z[2]=(L[2]*k+L[6]*N+L[10]*R+L[14])/G,Z}},12223:Z=>{Z.exports=function(Z,c,L){var k=c[0],N=c[1],R=c[2],G=L[0],V=L[1],p=L[2],J=L[3],z=J*k+V*R-p*N,i=J*N+p*k-G*R,t=J*R+G*N-V*k,E=-G*k-V*N-p*R;return Z[0]=z*J+E*-G+i*-p-t*-V,Z[1]=i*J+E*-V+t*-G-z*-p,Z[2]=t*J+E*-p+z*-V-i*-G,Z}},13078:Z=>{"use strict";Z.exports=function(Z){for(var c=new Array(Z),L=0;L<Z;++L)c[L]=L;return c}},13135:Z=>{Z.exports=function(Z){return null!=Z&&null!=Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}},13352:(Z,c,L)=>{"use strict";L.d(c,{e:()=>k});class k{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.uz=!1,this.Xz=!1,this.jz=30,this.oz=0,this.Iz=!1,this.fullscreen=!1,this.Bz=function(Z){},this.Dz=function(){},this.Wz=function(){},this.Rc=function(){},this.ez=function(Z){},this.onFullscreenChanged=function(Z){},J((()=>{!function(Z,c){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=V.bind(null,Z),requestAnimationFrame(Z._frameCB),c>0&&(Z._intervalCB=G.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(c,1e3/Z.jz/2)))}(this,c),function(Z,c){if(!c)return;var L=!1,k=!1;document.addEventListener("pointerlockchange",(k=>{L=document.pointerLockElement===c,Z.ez(L)})),document.addEventListener("fullscreenchange",(L=>{k=document.fullscreenElement===c,Z.onFullscreenChanged(k)})),Object.defineProperty(Z,"Iz",{get:()=>L,set:Z=>{Z&&!L?p(c):L&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:()=>k,set:Z=>{Z&&!k?c.requestFullscreen():k&&!Z&&document.exitFullscreen()}}),c.addEventListener("click",(N=>{Z.uz&&!L&&p(c),Z.Xz&&!k&&c.requestFullscreen()}));var N=()=>Z.Rc();if(window.ResizeObserver){new ResizeObserver(N).observe(c)}else window.addEventListener("resize",N)}(this,Z),this.Wz()}))}}var N=3,R=20;function G(Z){for(var c=1e3/Z.jz,L=Z._nowObject.now()+R,k=0;Z._nowObject.now()>=Z._lastTick+c&&Z._nowObject.now()<L&&++k<=N;)Z.Bz(c),Z._lastTick+=c;var G=5*(c+5),V=Z._nowObject.now();if(V-Z._lastTick>G)for(;V>=Z._lastTick+c;)Z._lastTick+=c}function V(Z){requestAnimationFrame(Z._frameCB),G(Z);var c=Z._nowObject.now(),L=c-Z._rt;if(Z._rt=c,Z.oz>0){Z._renderAccum+=L;var k=1e3/Z.oz;if(Z._renderAccum<k)return;Z._renderAccum=Math.min(Z._renderAccum-k,k)}var N=1e3/Z.jz,R=(c-Z._lastTick)/N;Z.Dz(L,R,N)}function p(Z){Z.requestPointerLock&&Z.requestPointerLock()}var J=Z=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),Z()};document.addEventListener("readystatechange",c)}else setTimeout(Z,1)}},13069:(Z,c,L)=>{var k=L(13078),N=L(13080),R="undefined"!==typeof Float64Array;function G(Z,c){return Z[0]-c[0]}function V(){var Z,c=this.stride,L=new Array(c.length);for(Z=0;Z<L.length;++Z)L[Z]=[Math.abs(c[Z]),Z];L.sort(G);var k=new Array(L.length);for(Z=0;Z<k.length;++Z)k[Z]=L[Z][1];return k}function p(Z,c){var L=["View",c,"d",Z].join("");c<0&&(L="View_Nil"+Z);var N="generic"===Z;if(-1===c){var R="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(R)()}if(0===c){R="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",R)(J[Z][0])}R=["'use strict'"];var G=k(c),p=G.map((function(Z){return"i"+Z})),z="this.offset+"+G.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),i=G.map((function(Z){return"b"+Z})).join(","),t=G.map((function(Z){return"c"+Z})).join(",");R.push("function "+L+"(a,"+i+","+t+",d){this.data=a","this.shape=["+i+"]","this.stride=["+t+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+Z+"'","proto.dimension="+c),R.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+G.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===c?R.push("proto.order=[0]"):(R.push("Object.defineProperty(proto,'order',{get:"),c<4?(R.push("function "+L+"_order(){"),2===c?R.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&R.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):R.push("ORDER})")),R.push("proto.set=function "+L+"_set("+p.join(",")+",v){"),N?R.push("return this.data.set("+z+",v)}"):R.push("return this.data["+z+"]=v}"),R.push("proto.get=function "+L+"_get("+p.join(",")+"){"),N?R.push("return this.data.get("+z+")}"):R.push("return this.data["+z+"]}"),R.push("proto.index=function "+L+"_index(",p.join(),"){return "+z+"}"),R.push("proto.hi=function "+L+"_hi("+p.join(",")+"){return new "+L+"(this.data,"+G.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+G.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var E=G.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),x=G.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));R.push("proto.lo=function "+L+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+x.join(","));for(var q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");R.push("return new "+L+"(this.data,"+G.map((function(Z){return"a"+Z})).join(",")+","+G.map((function(Z){return"c"+Z})).join(",")+",b)}"),R.push("proto.step=function "+L+"_step("+p.join(",")+"){var "+G.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+G.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");R.push("return new "+L+"(this.data,"+G.map((function(Z){return"a"+Z})).join(",")+","+G.map((function(Z){return"b"+Z})).join(",")+",c)}");var O=new Array(c),w=new Array(c);for(q=0;q<c;++q)O[q]="a[i"+q+"]",w[q]="b[i"+q+"]";R.push("proto.transpose=function "+L+"_transpose("+p+"){"+p.map((function(Z,c){return Z+"=("+Z+"===undefined?"+c+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+O.join(",")+","+w.join(",")+",this.offset)}"),R.push("proto.pick=function "+L+"_pick("+p+"){var a=[],b=[],c=this.offset");for(q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return R.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),R.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+G.map((function(Z){return"shape["+Z+"]"})).join(",")+","+G.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",R.join("\n"))(J[Z],V)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,c,L,k){if(void 0===Z)return(0,J.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===c&&(c=[Z.length]);var G=c.length;if(void 0===L){L=new Array(G);for(var V=G-1,z=1;V>=0;--V)L[V]=z,z*=c[V]}if(void 0===k){k=0;for(V=0;V<G;++V)L[V]<0&&(k-=(c[V]-1)*L[V])}for(var i=function(Z){if(N(Z))return"buffer";if(R)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),t=J[i];t.length<=G+1;)t.push(p(i,t.length-1));return(0,t[G+1])(Z,c,L,k)}},13080:Z=>{function c(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(c(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&c(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},13218:Z=>{"use strict";var c=[],L=[],k=[],N=[],R=[],G=[],V=[],p=[],J=[],z=[],i=[],t=[];Z.exports=function(Z,E,x,q,O,w){for(var M=V,P=J,j=z,o=t,u=0;u<3;u++)M[u]=+x[u],j[u]=+E.max[u],P[u]=+E.base[u];w||(w=1e-10);var X=function(Z,V,J,z,t,E){var x=c,q=L,O=k,w=N,M=R,P=G,j=p,o=Math.floor,u=0,X=0,h=0,B=0,D=0;if(e(),0===h)return 0;for(B=W();X<=h;){if(H(B)&&l())return u;B=W()}for(u+=h,D=0;D<3;D++)z[D]+=J[D],t[D]+=J[D];return u;function e(){if(X=0,0!==(h=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2])))for(var Z=0;Z<3;Z++){var c=J[Z]>=0;w[Z]=c?1:-1;var L=c?t[Z]:z[Z];x[Z]=c?z[Z]:t[Z],q[Z]=T(L,w[Z]),O[Z]=I(x[Z],w[Z]),j[Z]=J[Z]/h,M[Z]=Math.abs(1/j[Z]);var k=c?q[Z]+1-L:L-q[Z];P[Z]=M[Z]<1/0?M[Z]*k:1/0}}function H(c){for(var L=w[0],k=0===c?q[0]:O[0],N=q[0]+L,R=w[1],G=1===c?q[1]:O[1],V=q[1]+R,p=w[2],J=2===c?q[2]:O[2],z=q[2]+p,i=k;i!=N;i+=L)for(var t=G;t!=V;t+=R)for(var E=J;E!=z;E+=p)if(Z(i,t,E))return!0;return!1}function l(){u+=X;var Z=w[B],c=X/h,L=i;for(D=0;D<3;D++){var k=J[D]*c;z[D]+=k,t[D]+=k,L[D]=J[D]-k}if(Z>0?t[B]=Math.round(t[B]):z[B]=Math.round(z[B]),V(u,B,Z,L))return!0;for(D=0;D<3;D++)J[D]=L[D];return e(),0===h}function W(){var Z=P[0]<P[1]?P[0]<P[2]?0:2:P[1]<P[2]?1:2,c=P[Z]-X;for(X=P[Z],q[Z]+=w[Z],P[Z]+=M[Z],D=0;D<3;D++)x[D]+=c*j[D],O[D]=I(x[D],w[D]);return Z}function T(Z,c){return o(Z-c*E)}function I(Z,c){return o(Z+c*E)}}(Z,q,M,P,j,w);if(!O){for(u=0;u<3;u++)o[u]=x[u]>0?j[u]-E.max[u]:P[u]-E.base[u];E.translate(o)}return X}},13388:(Z,c,L)=>{"use strict";L.d(c,{c:()=>i});var k=L(13214),N=L(11980);class R{constructor(Z,c,L,R,G,V,p){this.jJ=new k(Z.base,Z.QJ),this.IN=c,this.friction=L,this.restitution=R,this.NV=G,this.VE=V,this.RV=!!p,this.dJ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.gE=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.ap=N.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=N.create(),this._impulses=N.create(),this._sleepFrameCount=10}loadFromCopy(Z){N.i(this.jJ.base,Z.jJ.base),N.i(this.jJ.QJ,Z.jJ.QJ),N.i(this.jJ.max,Z.jJ.max),this.jJ.mag=Z.jJ.mag,this.IN=Z.IN,this.friction=Z.friction,this.restitution=Z.restitution,this.NV=Z.NV,this.VE=Z.VE,this.RV=Z.RV,this.dJ=Z.dJ,this.fluidDrag=Z.fluidDrag,this.gE=Z.gE,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,N.i(this.ap,Z.ap),N.i(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,N.i(this._forces,Z._forces),N.i(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}setPosition(Z){G(Z),N.yL(Z,Z,this.jJ.base),this.jJ.translate(Z),this.cJ()}Gc(){return N.clone(this.jJ.base)}applyForce(Z){G(Z),N.add(this._forces,this._forces,Z),this.cJ()}applyImpulse(Z){G(Z),N.add(this._impulses,this._impulses,Z),this.cJ()}cJ(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var G=Z=>{};var V=L(13214),p=L(11980),J=L(13218);function z(){this.dJ=.1,this.fluidDrag=.4,this.zV=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function i(Z,c,L){Z=Object.assign(new z,Z),this.gravity=Z.gravity||[0,-10,0],this.dJ=Z.dJ||.1,this.zV=Z.zV||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.et=Z.et,this.testSolid=c,this.testFluid=L}i.prototype.xE=function(Z,c,L,k,N,G){Z=Z||new V([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof L&&(L=1),"undefined"==typeof k&&(k=0),"undefined"==typeof N&&(N=1);var p=new R(Z,c,L,k,N,G);return this.bodies.push(p),p},i.prototype.qE=function(Z){var c=this.bodies.indexOf(Z);c<0||(this.bodies.splice(c,1),Z.jJ=Z.VE=null)};var t=p.create(),E=p.create(),x=p.create(),q=p.create(),O=p.create(),w=p.create(),M=p.create(),P=new V([0,0,0],[1,1,1]),j=new R(P,1,1,0,1,(()=>{}),!1);function o(Z,c,L){return c=L,c*=1-(1-Z.ratioInFluid)**2}i.prototype.XV=function(Z){Z/=1e3;var c=S(0,p.squaredLength(this.gravity));this.bodies.forEach((L=>function(Z,c,L,k){p.i(O,c.resting),Z.et&&j.loadFromCopy(c);if(c.IN<=0)return p.set(c.ap,0,0,0),p.set(c._forces,0,0,0),void p.set(c._impulses,0,0,0);var N=k||0===c.NV;if(function(Z,c,L,k){if(c._sleepFrameCount>0)return!1;if(k)return!0;var N=!1,R=.5*L*L*c.NV;return p.scale(f,Z.gravity,R),J(Z.testSolid,c.jJ,f,(function(){return N=!0,!0}),!0),N}(Z,c,L,N))return;c._sleepFrameCount--,function(Z,c){var L=c.jJ,k=Math.floor(L.base[0]),N=Math.floor(L.base[2]),R=Math.floor(L.base[1]),G=Math.floor(L.max[1]);if(!Z.testFluid(k,R,N))return c.inFluid=!1,void(c.ratioInFluid=0);var V=1,J=R+1;for(;J<=G&&Z.testFluid(k,J,N);)V++,J++;var z=(R+V-L.base[1])/L.QJ[1];z>1&&(z=1);var i=L.QJ[0]*L.QJ[1]*L.QJ[2]*z,t=X;p.scale(t,Z.gravity,-Z.zV*i*c.NV),c.applyForce(t),c.inFluid=!0,c.ratioInFluid=z}(Z,c),m(c._forces),m(c._impulses),m(c.ap),m(c.resting),p.scale(t,c._forces,1/c.IN),p.OV(t,t,Z.gravity,c.NV),p.scale(E,c._impulses,1/c.IN),p.OV(E,E,t,L),p.add(c.ap,c.ap,E),c.friction&&(h(Z,0,c,E,L),h(Z,1,c,E,L),h(Z,2,c,E,L));var R=c.fluidDrag>=0?c.fluidDrag:Z.fluidDrag,G=c.dJ>=0?c.dJ:Z.dJ,V=G,z=G;c.inFluid&&(V=o(c,V,c.fluidDragHoriz>=0?c.fluidDragHoriz:R),z=o(c,z,c.fluidDragVert>=0?c.fluidDragVert:R));V=Math.max(1-V*L/c.IN,0),z=Math.max(1-z*L/c.IN,0),p.set(u,V,z,V),p.multiply(c.ap,c.ap,u),p.scale(x,c.ap,L),p.set(c._forces,0,0,0),p.set(c._impulses,0,0,0),c.RV&&s(e,c.jJ);p.i(w,x),p.set(M,0,0,0),c.preventFallOffEdge&&function(Z,c,L,k){if(!c.resting[1]||L[1]>0)return;var N=d;s(N,c.jJ);for(var R=0;R<3;R+=2){p.set(I,0,0,0),I[R]=L[R];var G=!0;(G=(G=(G=(G=G&&!r(Z,N.base[0]+I[0]+1e-5,N.base[1],N.base[2]+I[2]+1e-5))&&!r(Z,N.max[0]+I[0]-1e-5,N.base[1],N.base[2]+I[2]+1e-5))&&!r(Z,N.base[0]+I[0]+1e-5,N.base[1],N.max[2]+I[2]-1e-5))&&!r(Z,N.max[0]+I[0]-1e-5,N.base[1],N.max[2]+I[2]-1e-5))?(k[R]=L[R]>0?1:-1,L[R]=0):0===R&&(p.set(Q,L[0],0,0),D(Z,N,Q,k,c.slideOnCollision))}}(Z,c,x,M);D(Z,c.jJ,x,c.resting,c.slideOnCollision),c.RV&&function(Z,c,L,k){if(c.resting[1]>=0&&!c.inFluid)return;var N=0!==c.resting[0],R=0!==c.resting[2];if(!N&&!R)return;var G=Math.abs(k[0]/k[2]),V=4;if(!N&&G>V)return;if(!R&&G<1/V)return;p.add(l,L.base,k);var z=Z.testSolid;J(z,L,k,(function(Z,c,L,k){if(1!==c)return!0;k[c]=0}));var i=L.base[1],t=c.inFluid?1.951:1.001,E=Math.floor(i+t)-i;p.set(W,0,E,0);var x=!1;if(J(z,L,W,(function(Z,c,L,k){return x=!0,!0})),x)return;p.yL(T,l,L.base),T[1]=0,D(Z,L,T,H,!0);var q=S(L.base[0],l[0]),O=S(L.base[2],l[2]);if(N&&!q&&(!O||!R))return;if(R&&(!q||!N)&&!O)return;var w=!0;if(w=w&&!r(Z,L.base[0]+1e-5,L.base[1],L.base[2]+1e-5),w=w&&!r(Z,L.max[0]-1e-5,L.base[1],L.base[2]+1e-5),w=w&&!r(Z,L.base[0]+1e-5,L.base[1],L.max[2]-1e-5),w=w&&!r(Z,L.max[0]-1e-5,L.base[1],L.max[2]-1e-5),w)return;s(c.jJ,L),c.resting[0]=H[0],c.resting[2]=H[2],c.gE&&c.gE()}(Z,c,e,w);for(var i=0;i<3;++i)c.resting[i]=c.resting[i]||M[i],q[i]=0,c.resting[i]&&(O[i]||(q[i]=-c.ap[i]),c.ap[i]=0);var P=p.length(q);P>.001&&(p.scale(q,q,c.IN),c.VE&&c.VE(q),c.restitution>0&&P>Z.minBounceImpulse&&(p.scale(q,q,c.restitution),c.applyImpulse(q)));var B=p.squaredLength(c.ap);B>1e-5&&c.cJ();Z.et&&Z.et(c)?(c.loadFromCopy(j),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,L,Z,c)))};var u=p.create([0,0,0]);var X=p.create();function h(Z,c,L,k,N){var R=L.resting[c],G=k[c];if(!L.alwaysApplyHorizFriction||1!==c){if(0===R)return;if(R*G<=0)return}p.i(B,L.ap),B[c]=0;var V=p.length(B);if(!S(V,0)){var J=Math.abs(L.friction*Z.gravity[c]*N),z=V>J?(V-J)/V:0;L.ap[(c+1)%3]*=z,L.ap[(c+2)%3]*=z}}var B=p.create();function D(Z,c,L,k,N){return p.set(k,0,0,0),J(Z.testSolid,c,L,(function(Z,c,L,R){k[c]=L,R[c]=0,N||(R[0]=0,R[1]=0,R[2]=0)}))}var e=new V([],[]),H=p.create(),l=p.create(),W=p.create(),T=p.create();var I=p.create(),d=new V([],[]),Q=p.create();function r(Z,c,L,k){return Z.testSolid(Math.floor(c),Math.floor(L-1),Math.floor(k))}var f=p.create();function S(Z,c){return Math.abs(Z-c)<1e-5}function s(Z,c){for(var L=0;L<3;L++)Z.base[L]=c.base[L],Z.max[L]=c.max[L],Z.QJ[L]=c.QJ[L]}var m=function(Z){}},11880:function(Z,c){!function(Z){"use strict";var c=function(Z,L){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,c){Z.__proto__=c}||function(Z,c){for(var L in c)Object.prototype.hasOwnProperty.call(c,L)&&(Z[L]=c[L])},c(Z,L)};function L(Z,L){if("function"!==typeof L&&null!==L)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function k(){this.constructor=Z}c(Z,L),Z.prototype=null===L?Object.create(L):(k.prototype=L.prototype,new k)}function k(Z,c,L,k){var N,R=arguments.length,G=R<3?c:null===k?k=Object.getOwnPropertyDescriptor(c,L):k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)G=Reflect.decorate(Z,c,L,k);else for(var V=Z.length-1;V>=0;V--)(N=Z[V])&&(G=(R<3?N(G):R>3?N(c,L,G):N(c,L))||G);return R>3&&G&&Object.defineProperty(c,L,G),G}function N(Z,c,L){if(L||2===arguments.length)for(var k,N=0,R=c.length;N<R;N++)!k&&N in c||(k||(k=Array.prototype.slice.call(c,0,N)),k[N]=c[N]);return Z.concat(k||Array.prototype.slice.call(c))}var R,G=255,V=213;Z.OPERATION=void 0,(R=Z.OPERATION||(Z.OPERATION={}))[R.ADD=128]="ADD",R[R.REPLACE=0]="REPLACE",R[R.DELETE=64]="DELETE",R[R.DELETE_AND_ADD=192]="DELETE_AND_ADD",R[R.TOUCH=1]="TOUCH",R[R.CLEAR=10]="CLEAR";var p=function(){function c(Z,c,L){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(c,L)}return c.prototype.setParent=function(Z,c,L){var k=this;if(this.indexes||(this.indexes=this.ref instanceof TZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=L,c)if(this.root=c,this.ref instanceof TZ){var N=this.ref._definition;for(var R in N.schema){var G=this.ref[R];if(G&&G.$changes){var V=N.indexes[R];G.$changes.setParent(this.ref,c,V)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,c){if(Z instanceof TZ){var L=Z.$changes,N=k.ref.$changes.indexes[c];L.setParent(k.ref,k.root,N)}}))},c.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},c.prototype.change=function(c,L){void 0===L&&(L=Z.OPERATION.ADD);var k="number"===typeof c?c:this.indexes[c];this.assertValidIndex(k,c);var N=this.changes.get(k);N&&N.op!==Z.OPERATION.DELETE&&N.op!==Z.OPERATION.TOUCH||this.changes.set(k,{op:N&&N.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:L,index:k}),this.allChanges.add(k),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var L="number"===typeof c?c:this.indexes[c];this.assertValidIndex(L,c),this.changes.has(L)||this.changes.set(L,{op:Z.OPERATION.TOUCH,index:L}),this.allChanges.add(L),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(Z){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[Z]];var c,L=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(L)[0]},c.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},c.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},c.prototype.delete=function(c){var L="number"===typeof c?c:this.indexes[c];if(void 0!==L){var k=this.getValue(L);this.changes.set(L,{op:Z.OPERATION.DELETE,index:L}),this.allChanges.delete(L),delete this.caches[L],k&&k.$changes&&(k.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(L,")"))},c.prototype.discard=function(c,L){var k=this;void 0===c&&(c=!1),void 0===L&&(L=!1),this.ref instanceof TZ||this.changes.forEach((function(c){if(c.op===Z.OPERATION.DELETE){var L=k.ref.getIndex(c.index);delete k.indexes[L]}})),this.changes.clear(),this.changed=c,L&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(c){var L=Z.getValue(c.index);L&&L.$changes&&L.$changes.discardAll()})),this.discard()},c.prototype.cache=function(Z,c){this.caches[Z]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(Z,c){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function J(Z,c,L,k){return Z[c]||(Z[c]=[]),Z[c].push(L),null===k||void 0===k||k.forEach((function(Z,c){return L(Z,c)})),function(){return i(Z[c],Z[c].indexOf(L))}}function z(c){var L=this,k="string"!==typeof this.$changes.getType();this.$items.forEach((function(N,R){c.push({refId:L.$changes.refId,op:Z.OPERATION.DELETE,field:R,value:void 0,previousValue:N}),k&&L.$changes.root.removeRef(N.$changes.refId)}))}function i(Z,c){if(-1===c||c>=Z.length)return!1;for(var L=Z.length-1,k=c;k<L;k++)Z[k]=Z[k+1];return Z.length=L,!0}var t=function(Z,c){var L=Z.toString(),k=c.toString();return L<k?-1:L>k?1:0};function E(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,c){return"symbol"===typeof c||isNaN(c)?Z[c]:Z.at(c)},set:function(Z,c,L){if("symbol"===typeof c||isNaN(c))Z[c]=L;else{var k=Array.from(Z.$items.keys()),N=parseInt(k[c]||c);void 0===L||null===L?Z.deleteAt(N):Z.setAt(N,L)}return!0},deleteProperty:function(Z,c){return"number"===typeof c?Z.deleteAt(c):delete Z[c],!0}})}var x=function(){function c(){for(var Z=[],c=0;c<arguments.length;c++)Z[c]=arguments[c];this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return c.prototype.eV=function(c,L){return void 0===L&&(L=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,c,L?this.$items:void 0)},c.prototype.Nc=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,c)},c.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var Z,c=this,L=[],k=0;k<arguments.length;k++)L[k]=arguments[k];return L.forEach((function(L){Z=c.$refId++,c.setAt(Z,L)})),Z},c.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var c=this.$items.get(Z);return this.$items.delete(Z),c}},c.prototype.at=function(Z){var c=Array.from(this.$items.keys())[Z];return this.$items.get(c)},c.prototype.setAt=function(c,L){var k,N;if(void 0!==L&&null!==L){if(this.$items.get(c)!==L){void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,c);var R=null!==(N=null===(k=this.$changes.indexes[c])||void 0===k?void 0:k.op)&&void 0!==N?N:Z.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,L),this.$changes.change(c,R)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(Z){var c=Array.from(this.$items.keys())[Z];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&z.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var Z,L=[],k=0;k<arguments.length;k++)L[k]=arguments[k];return new(c.bind.apply(c,N([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,L),!1)))},c.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},c.prototype.reverse=function(){var Z=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(L,k){Z.setAt(c[k],L)})),this},c.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var c=this.$items.get(Z);return this.$deleteAt(Z),c}},c.prototype.slice=function(Z,L){var k=new c;return k.push.apply(k,Array.from(this.$items.values()).slice(Z,L)),k},c.prototype.sort=function(Z){var c=this;void 0===Z&&(Z=t);var L=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,k){c.setAt(L[k],Z)})),this},c.prototype.splice=function(Z,c){void 0===c&&(c=this.length-Z);for(var L=Array.from(this.$items.keys()),k=[],N=Z;N<Z+c;N++)k.push(this.$items.get(L[N])),this.$deleteAt(L[N]);return k},c.prototype.unshift=function(){for(var Z=this,c=[],L=0;L<arguments.length;L++)c[L]=arguments[L];var k=this.length,N=c.length,R=Array.from(this.$items.values());return c.forEach((function(c,L){Z.setAt(L,c)})),R.forEach((function(c,L){Z.setAt(N+L,c)})),k+N},c.prototype.indexOf=function(Z,c){return Array.from(this.$items.values()).indexOf(Z,c)},c.prototype.lastIndexOf=function(Z,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,c)},c.prototype.every=function(Z,c){return Array.from(this.$items.values()).every(Z,c)},c.prototype.some=function(Z,c){return Array.from(this.$items.values()).some(Z,c)},c.prototype.forEach=function(Z,c){Array.from(this.$items.values()).forEach(Z,c)},c.prototype.map=function(Z,c){return Array.from(this.$items.values()).map(Z,c)},c.prototype.filter=function(Z,c){return Array.from(this.$items.values()).filter(Z,c)},c.prototype.reduce=function(Z,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(Z,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(Z,c){return Array.from(this.$items.values()).find(Z,c)},c.prototype.findIndex=function(Z,c){return Array.from(this.$items.values()).findIndex(Z,c)},c.prototype.fill=function(Z,c,L){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(Z,c,L){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(Z,c){return Array.from(this.$items.values()).includes(Z,c)},c.prototype.flatMap=function(Z,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},c.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},c.prototype.setIndex=function(Z,c){this.$indexes.set(Z,c)},c.prototype.getIndex=function(Z){return this.$indexes.get(Z)},c.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},c.prototype.deleteByIndex=function(Z){var c=this.$indexes.get(Z);this.$items.delete(c),this.$indexes.delete(Z)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},c.prototype.clone=function(Z){return Z?new(c.bind.apply(c,N([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,N([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},c}();function q(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,c){return"symbol"!==typeof c&&"undefined"===typeof Z[c]?Z.get(c):Z[c]},set:function(Z,c,L){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"eV"!==c&&"Nc"!==c&&"onChange"!==c?Z.set(c,L):Z[c]=L,!0},deleteProperty:function(Z,c){return Z.delete(c),!0}})}var O=function(){function c(Z){var L=this;if(this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof c)Z.forEach((function(Z,c){return L.set(c,Z)}));else for(var k in Z)this.set(k,Z[k])}return c.prototype.eV=function(c,L){return void 0===L&&(L=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,c,L?this.$items:void 0)},c.prototype.Nc=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,c)},c.is=function(Z){return void 0!==Z.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,L){if(void 0===L||null===L)throw new Error("MapSchema#set('".concat(c,"', ").concat(L,"): trying to set ").concat(L," value on '").concat(c,"'."));c=c.toString();var k="undefined"!==typeof this.$changes.indexes[c],N=k?this.$changes.indexes[c]:this.$refId++,R=k?Z.OPERATION.REPLACE:Z.OPERATION.ADD,G=void 0!==L.$changes;if(G&&L.$changes.setParent(this,this.$changes.root,N),k){if(!G&&this.$items.get(c)===L)return;G&&this.$items.get(c)!==L&&(R=Z.OPERATION.ADD)}else this.$changes.indexes[c]=N,this.$indexes.set(N,c);return this.$items.set(c,L),this.$changes.change(c,R),this},c.prototype.get=function(Z){return this.$items.get(Z)},c.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&z.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Z){return this.$items.has(Z)},c.prototype.forEach=function(Z){this.$items.forEach(Z)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Z,c){this.$indexes.set(Z,c)},c.prototype.getIndex=function(Z){return this.$indexes.get(Z)},c.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},c.prototype.deleteByIndex=function(Z){var c=this.$indexes.get(Z);this.$items.delete(c),this.$indexes.delete(Z)},c.prototype.toJSON=function(){var Z={};return this.forEach((function(c,L){Z[L]="function"===typeof c.toJSON?c.toJSON():c})),Z},c.prototype.clone=function(Z){var L;return Z?L=Object.assign(new c,this):(L=new c,this.forEach((function(Z,c){Z.$changes?L.set(c,Z.clone()):L.set(c,Z)}))),L},c}(),w={};function M(Z,c){w[Z]=c}function P(Z){return w[Z]}var j=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(c){var L=new Z;return L.schema=Object.assign({},c&&c.schema||{}),L.indexes=Object.assign({},c&&c.indexes||{}),L.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),L.descriptors=Object.assign({},c&&c.descriptors||{}),L.deprecated=Object.assign({},c&&c.deprecated||{}),L},Z.prototype.addField=function(Z,c){var L=this.getNextFieldIndex();this.fieldsByIndex[L]=Z,this.indexes[Z]=L,this.schema[Z]=Array.isArray(c)?{array:c[0]}:c},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=c,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,c){var L=this.indexes[Z],k=this.schema[Z];if(P(Object.keys(k)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[L]=c,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function o(Z){return Z._context&&Z._context.useFilters}var u=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,c){void 0===c&&(c=this.schemas.size),Z._definition=j.create(Z._definition),Z._typeid=c,this.types[c]=Z,this.schemas.set(Z,c)},Z.create=function(c){return void 0===c&&(c={}),function(L){return c.context||(c.context=new Z),h(L,c)}},Z}(),X=new u;function h(Z,c){return void 0===c&&(c={}),function(L,k){var R=c.context||X,G=L.constructor;if(G._context=R,!Z)throw new Error("".concat(G.name,': @type() reference provided for "').concat(k,"\" is undefined. Make sure you don't have any circular dependencies."));R.has(G)||R.add(G);var V=G._definition;if(V.addField(k,Z),V.descriptors[k]){if(V.deprecated[k])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(k,"' definition on '").concat(G.name,"'.\nCheck @type() annotation"))}catch(w){var p=w.stack.split("\n")[4].trim();throw new Error("".concat(w.message," ").concat(p))}}var J=x.is(Z),z=!J&&O.is(Z);if("string"!==typeof Z&&!TZ.is(Z)){var i=Object.values(Z)[0];"string"===typeof i||R.has(i)||R.add(i)}if(c.manual)V.descriptors[k]={enumerable:!0,configurable:!0,writable:!0};else{var t="_".concat(k);V.descriptors[t]={enumerable:!1,configurable:!1,writable:!0},V.descriptors[k]={get:function(){return this[t]},set:function(Z){Z!==this[t]&&(void 0!==Z&&null!==Z?(!J||Z instanceof x||(Z=new(x.bind.apply(x,N([void 0],Z,!1)))),!z||Z instanceof O||(Z=new O(Z)),void 0===Z.$proxy&&(z?Z=q(Z):J&&(Z=E(Z))),this.$changes.change(k),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[k])):this[t]&&this.$changes.delete(k),this[t]=Z)},enumerable:!0,configurable:!0}}}}function B(Z){return function(c,L){var k=c.constructor;k._definition.addFilter(L,Z)&&(k._context.useFilters=!0)}}function D(Z){return function(c,L){var k=c.constructor;k._definition.addChildrenFilter(L,Z)&&(k._context.useFilters=!0)}}function e(Z){return void 0===Z&&(Z=!0),function(c,L){var k=c.constructor._definition;k.deprecated[L]=!0,Z&&(k.descriptors[L]={get:function(){throw new Error("".concat(L," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function H(Z,c,L){for(var k in void 0===L&&(L={}),L.context||(L.context=Z._context||L.context||X),c)h(c[k],L)(Z.prototype,k);return Z}function l(Z){for(var c=0,L=0,k=0,N=Z.length;k<N;k++)(c=Z.charCodeAt(k))<128?L+=1:c<2048?L+=2:c<55296||c>=57344?L+=3:(k++,L+=4);return L}function W(Z,c,L){for(var k=0,N=0,R=L.length;N<R;N++)(k=L.charCodeAt(N))<128?Z[c++]=k:k<2048?(Z[c++]=192|k>>6,Z[c++]=128|63&k):k<55296||k>=57344?(Z[c++]=224|k>>12,Z[c++]=128|k>>6&63,Z[c++]=128|63&k):(N++,k=65536+((1023&k)<<10|1023&L.charCodeAt(N)),Z[c++]=240|k>>18,Z[c++]=128|k>>12&63,Z[c++]=128|k>>6&63,Z[c++]=128|63&k)}function T(Z,c){Z.push(255&c)}function I(Z,c){Z.push(255&c)}function d(Z,c){Z.push(255&c),Z.push(c>>8&255)}function Q(Z,c){Z.push(255&c),Z.push(c>>8&255)}function r(Z,c){Z.push(255&c),Z.push(c>>8&255),Z.push(c>>16&255),Z.push(c>>24&255)}function f(Z,c){var L=c>>24,k=c>>16,N=c>>8,R=c;Z.push(255&R),Z.push(255&N),Z.push(255&k),Z.push(255&L)}function S(Z,c){var L=Math.floor(c/Math.pow(2,32));f(Z,c>>>0),f(Z,L)}function s(Z,c){var L=c/Math.pow(2,32)|0;f(Z,c>>>0),f(Z,L)}function m(Z,c){K(Z,c)}function A(Z,c){n(Z,c)}var b=new Int32Array(2),F=new Float32Array(b.buffer),U=new Float64Array(b.buffer);function K(Z,c){F[0]=c,r(Z,b[0])}function n(Z,c){U[0]=c,r(Z,b[0]),r(Z,b[1])}function g(Z,c){return I(Z,c?1:0)}function y(Z,c){c||(c="");var L=l(c),k=0;if(L<32)Z.push(160|L),k=1;else if(L<256)Z.push(217),I(Z,L),k=2;else if(L<65536)Z.push(218),Q(Z,L),k=3;else{if(!(L<4294967296))throw new Error("String too long");Z.push(219),f(Z,L),k=5}return W(Z,Z.length,c),k+L}function v(Z,c){return isNaN(c)?v(Z,0):isFinite(c)?c!==(0|c)?(Z.push(203),n(Z,c),9):c>=0?c<128?(I(Z,c),1):c<256?(Z.push(204),I(Z,c),2):c<65536?(Z.push(205),Q(Z,c),3):c<4294967296?(Z.push(206),f(Z,c),5):(Z.push(207),s(Z,c),9):c>=-32?(Z.push(224|c+32),1):c>=-128?(Z.push(208),T(Z,c),2):c>=-32768?(Z.push(209),d(Z,c),3):c>=-2147483648?(Z.push(210),r(Z,c),5):(Z.push(211),S(Z,c),9):v(Z,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Y=Object.freeze({__proto__:null,utf8Write:W,int8:T,uint8:I,int16:d,uint16:Q,int32:r,uint32:f,int64:S,uint64:s,float32:m,float64:A,writeFloat32:K,writeFloat64:n,boolean:g,string:y,number:v});function a(Z,c,L){for(var k="",N=0,R=c,G=c+L;R<G;R++){var V=Z[R];0!==(128&V)?192!==(224&V)?224!==(240&V)?240!==(248&V)?console.error("Invalid byte "+V.toString(16)):(N=(7&V)<<18|(63&Z[++R])<<12|(63&Z[++R])<<6|63&Z[++R])>=65536?(N-=65536,k+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):k+=String.fromCharCode(N):k+=String.fromCharCode((15&V)<<12|(63&Z[++R])<<6|63&Z[++R]):k+=String.fromCharCode((31&V)<<6|63&Z[++R]):k+=String.fromCharCode(V)}return k}function C(Z,c){return ZZ(Z,c)<<24>>24}function ZZ(Z,c){return Z[c.offset++]}function cZ(Z,c){return LZ(Z,c)<<16>>16}function LZ(Z,c){return Z[c.offset++]|Z[c.offset++]<<8}function kZ(Z,c){return Z[c.offset++]|Z[c.offset++]<<8|Z[c.offset++]<<16|Z[c.offset++]<<24}function NZ(Z,c){return kZ(Z,c)>>>0}function RZ(Z,c){return tZ(Z,c)}function GZ(Z,c){return EZ(Z,c)}function VZ(Z,c){var L=NZ(Z,c);return kZ(Z,c)*Math.pow(2,32)+L}function pZ(Z,c){var L=NZ(Z,c);return NZ(Z,c)*Math.pow(2,32)+L}var JZ=new Int32Array(2),zZ=new Float32Array(JZ.buffer),iZ=new Float64Array(JZ.buffer);function tZ(Z,c){return JZ[0]=kZ(Z,c),zZ[0]}function EZ(Z,c){return JZ[0]=kZ(Z,c),JZ[1]=kZ(Z,c),iZ[0]}function xZ(Z,c){return ZZ(Z,c)>0}function qZ(Z,c){var L,k=Z[c.offset++];k<192?L=31&k:217===k?L=ZZ(Z,c):218===k?L=LZ(Z,c):219===k&&(L=NZ(Z,c));var N=a(Z,c.offset,L);return c.offset+=L,N}function OZ(Z,c){var L=Z[c.offset];return L<192&&L>160||217===L||218===L||219===L}function wZ(Z,c){var L=Z[c.offset++];return L<128?L:202===L?tZ(Z,c):203===L?EZ(Z,c):204===L?ZZ(Z,c):205===L?LZ(Z,c):206===L?NZ(Z,c):207===L?pZ(Z,c):208===L?C(Z,c):209===L?cZ(Z,c):210===L?kZ(Z,c):211===L?VZ(Z,c):L>223?-1*(255-L+1):void 0}function MZ(Z,c){var L=Z[c.offset];return L<128||L>=202&&L<=211}function PZ(Z,c){return Z[c.offset]<160}function jZ(Z,c){return Z[c.offset-1]===G&&(Z[c.offset]<128||Z[c.offset]>=202&&Z[c.offset]<=211)}var oZ=Object.freeze({__proto__:null,int8:C,uint8:ZZ,int16:cZ,uint16:LZ,int32:kZ,uint32:NZ,float32:RZ,float64:GZ,int64:VZ,uint64:pZ,readFloat32:tZ,readFloat64:EZ,boolean:xZ,string:qZ,stringCheck:OZ,number:wZ,numberCheck:MZ,arrayCheck:PZ,switchStructureCheck:jZ}),uZ=function(){function c(Z){var c=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return c.add(Z)}))}return c.prototype.eV=function(c,L){return void 0===L&&(L=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,c,L?this.$items:void 0)},c.prototype.Nc=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,c)},c.is=function(Z){return void 0!==Z.collection},c.prototype.add=function(Z){var c=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,Z),this.$changes.change(c),c},c.prototype.at=function(Z){var c=Array.from(this.$items.keys())[Z];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(Z){for(var c,L,k=this.$items.entries();(L=k.next())&&!L.done;)if(Z===L.value[1]){c=L.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&z.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(c){return c===Z}))},c.prototype.forEach=function(Z){var c=this;this.$items.forEach((function(L,k,N){return Z(L,k,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Z,c){this.$indexes.set(Z,c)},c.prototype.getIndex=function(Z){return this.$indexes.get(Z)},c.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},c.prototype.deleteByIndex=function(Z){var c=this.$indexes.get(Z);this.$items.delete(c),this.$indexes.delete(Z)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var Z=[];return this.forEach((function(c,L){Z.push("function"===typeof c.toJSON?c.toJSON():c)})),Z},c.prototype.clone=function(Z){var L;return Z?L=Object.assign(new c,this):(L=new c,this.forEach((function(Z){Z.$changes?L.add(Z.clone()):L.add(Z)}))),L},c}(),XZ=function(){function c(Z){var c=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return c.add(Z)}))}return c.prototype.eV=function(c,L){return void 0===L&&(L=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,c,L?this.$items:void 0)},c.prototype.Nc=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,c)},c.is=function(Z){return void 0!==Z.set},c.prototype.add=function(c){var L,k;if(this.has(c))return!1;var N=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,N);var R=null!==(k=null===(L=this.$changes.indexes[N])||void 0===L?void 0:L.op)&&void 0!==k?k:Z.OPERATION.ADD;return this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,c),this.$changes.change(N,R),N},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(Z){for(var c,L,k=this.$items.entries();(L=k.next())&&!L.done;)if(Z===L.value[1]){c=L.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&z.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Z){for(var c,L=this.$items.values(),k=!1;(c=L.next())&&!c.done;)if(Z===c.value){k=!0;break}return k},c.prototype.forEach=function(Z){var c=this;this.$items.forEach((function(L,k,N){return Z(L,k,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Z,c){this.$indexes.set(Z,c)},c.prototype.getIndex=function(Z){return this.$indexes.get(Z)},c.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},c.prototype.deleteByIndex=function(Z){var c=this.$indexes.get(Z);this.$items.delete(c),this.$indexes.delete(Z)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var Z=[];return this.forEach((function(c,L){Z.push("function"===typeof c.toJSON?c.toJSON():c)})),Z},c.prototype.clone=function(Z){var L;return Z?L=Object.assign(new c,this):(L=new c,this.forEach((function(Z){Z.$changes?L.add(Z.clone()):L.add(Z)}))),L},c}(),hZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(c){return void 0===c.$filterState&&(c.$filterState=new Z),c.$filterState},Z}(),BZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,c,L){void 0===L&&(L=!0),this.refs.set(Z,c),L&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(c){if(!(Z.refCounts[c]>0)){var L=Z.refs.get(c);if(L instanceof TZ)for(var k in L._definition.schema)"string"!==typeof L._definition.schema[k]&&L[k]&&L[k].$changes&&Z.removeRef(L[k].$changes.refId);else{var N=L.$changes.parent._definition,R=N.schema[N.fieldsByIndex[L.$changes.parentIndex]];"function"===typeof Object.values(R)[0]&&Array.from(L.values()).forEach((function(c){return Z.removeRef(c.$changes.refId)}))}Z.refs.delete(c),delete Z.refCounts[c]}})),this.deletedRefs.clear()},Z}(),DZ=function(Z){function c(){return null!==Z&&Z.apply(this,arguments)||this}return L(c,Z),c}(Error);function eZ(Z,c,L,k){var N,R=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":N="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(L.constructor.name,"#").concat(k));break;case"string":N="string",R=!0;break;case"boolean":return}if(typeof Z!==N&&(!R||R&&null!==Z)){var G="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new DZ("a '".concat(N,"' was expected, but ").concat(G," was provided in ").concat(L.constructor.name,"#").concat(k))}}function HZ(Z,c,L,k){if(!(Z instanceof c))throw new DZ("a '".concat(c.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(L.constructor.name,"#").concat(k))}function lZ(Z,c,L,k,N){eZ(L,Z,k,N);var R=Y[Z];if(!R)throw new DZ("a '".concat(Z,"' was expected, but ").concat(L," was provided in ").concat(k.constructor.name,"#").concat(N));R(c,L)}function WZ(Z,c,L){return oZ[Z](c,L)}var TZ=function(){function c(){for(var Z=[],c=0;c<arguments.length;c++)Z[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new p(this,void 0,new BZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var L=this._definition.descriptors;L&&Object.defineProperties(this,L),Z[0]&&this.assign(Z[0])}return c.onError=function(Z){console.error(Z)},c.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},c.prototype.onChange=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,c)},c.prototype.Nc=function(c){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,c)},c.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(Z,c){this.$changes.change(Z,c)},c.prototype.listen=function(Z,c,L){var k=this;return void 0===L&&(L=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(c),L&&void 0!==this[Z]&&c(this[Z],void 0),function(){return i(k.$callbacks[Z],k.$callbacks[Z].indexOf(c))}},c.prototype.decode=function(L,k,N){var R;void 0===k&&(k={offset:0}),void 0===N&&(N=this);var V=[],p=this.$changes.root,J=L.length,z=0;for(p.refs.set(z,this);k.offset<J;){var i=L[k.offset++];if(i!=G){var t=N.$changes,E=void 0!==N._definition,q=E?i>>6<<6:i;if(q!==Z.OPERATION.CLEAR){var w=E?i%(q||255):wZ(L,k),M=E?N._definition.fieldsByIndex[w]:"",j=t.getType(w),o=void 0,u=void 0,X=void 0;if(E?u=N["_".concat(M)]:(u=N.getByIndex(w),(q&Z.OPERATION.ADD)===Z.OPERATION.ADD?(X=N instanceof O?qZ(L,k):w,N.setIndex(w,X)):X=N.getIndex(w)),(q&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(q!==Z.OPERATION.DELETE_AND_ADD&&N.deleteByIndex(w),u&&u.$changes&&p.removeRef(u.$changes.refId),o=null),void 0!==M){if(q===Z.OPERATION.DELETE);else if(c.is(j)){var h=wZ(L,k);if(o=p.refs.get(h),q!==Z.OPERATION.REPLACE){var B=this.getSchemaType(L,k,j);o||((o=this.createTypeInstance(B)).$changes.refId=h,u&&(o.$callbacks=u.$callbacks,u.$changes.refId&&h!==u.$changes.refId&&p.removeRef(u.$changes.refId))),p.addRef(h,o,o!==u)}}else if("string"===typeof j)o=WZ(j,L,k);else{var D=P(Object.keys(j)[0]),e=wZ(L,k),H=p.refs.has(e)?u||p.refs.get(e):new D.constructor;if((o=H.clone(!0)).$changes.refId=e,u&&(o.$callbacks=u.$callbacks,u.$changes.refId&&e!==u.$changes.refId)){p.removeRef(u.$changes.refId);for(var l=u.entries(),W=void 0;(W=l.next())&&!W.done;){var T=(R=W.value)[0],I=R[1];V.push({refId:e,op:Z.OPERATION.DELETE,field:T,value:void 0,previousValue:I})}}p.addRef(e,o,H!==u)}if(null!==o&&void 0!==o)if(o.$changes&&o.$changes.setParent(t.ref,t.root,w),N instanceof c)N[M]=o;else if(N instanceof O)T=X,N.$items.set(T,o),N.$changes.allChanges.add(w);else if(N instanceof x)N.setAt(w,o);else if(N instanceof uZ){var d=N.add(o);N.setIndex(w,d)}else N instanceof XZ&&!1!==(d=N.add(o))&&N.setIndex(w,d);u!==o&&V.push({refId:z,op:q,field:M,dynamicIndex:X,value:o,previousValue:u})}else{console.warn("@colyseus/schema: definition mismatch");for(var Q={offset:k.offset};k.offset<J&&(!jZ(L,k)||(Q.offset=k.offset+1,!p.refs.has(wZ(L,Q))));)k.offset++}}else N.clear(V)}else{z=wZ(L,k);var r=p.refs.get(z);if(!r)throw new Error('"refId" not found: '.concat(z));N=r}}return this._triggerChanges(V),p.garbageCollectDeletedRefs(),V},c.prototype.encode=function(L,k,N){void 0===L&&(L=!1),void 0===k&&(k=[]),void 0===N&&(N=!1);for(var R=this.$changes,V=new WeakSet,p=[R],J=1,z=0;z<J;z++){var i=p[z],t=i.ref,E=t instanceof c;i.ensureRefId(),V.add(i),i!==R&&(i.changed||L)&&(I(k,G),v(k,i.refId));for(var x=L?Array.from(i.allChanges):Array.from(i.changes.values()),q=0,w=x.length;q<w;q++){var M=L?{op:Z.OPERATION.ADD,index:x[q]}:x[q],j=M.index,o=E?t._definition.fieldsByIndex&&t._definition.fieldsByIndex[j]:j,u=k.length;if(M.op!==Z.OPERATION.TOUCH)if(E)I(k,j|M.op);else{if(I(k,M.op),M.op===Z.OPERATION.CLEAR)continue;v(k,j)}if(E||(M.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||t instanceof O&&y(k,i.ref.$indexes.get(j)),M.op!==Z.OPERATION.DELETE){var X=i.getType(j),h=i.getValue(j);if(h&&h.$changes&&!V.has(h.$changes)&&(p.push(h.$changes),h.$changes.ensureRefId(),J++),M.op!==Z.OPERATION.TOUCH){if(c.is(X))HZ(h,X,t,o),v(k,h.$changes.refId),(M.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(k,X,h.constructor);else if("string"===typeof X)lZ(X,k,h,t,o);else{var B=P(Object.keys(X)[0]);HZ(t["_".concat(o)],B.constructor,t,o),v(k,h.$changes.refId)}N&&i.cache(j,k.slice(u))}}}L||N||i.discard()}return k},c.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},c.prototype.applyFilters=function(L,k){var N,R;void 0===k&&(k=!1);for(var V=this,p=new Set,J=hZ.get(L),z=[this.$changes],i=1,t=[],E=function(E){var x=z[E];if(p.has(x.refId))return"continue";var q=x.ref,w=q instanceof c;I(t,G),v(t,x.refId);var M=J.refIds.has(x),P=k||!M;J.addRefId(x);var j=J.containerIndexes.get(x),o=P?Array.from(x.allChanges):Array.from(x.changes.values());!k&&w&&q._definition.indexesWithFilters&&q._definition.indexesWithFilters.forEach((function(c){!j.has(c)&&x.allChanges.has(c)&&(P?o.push(c):o.push({op:Z.OPERATION.ADD,index:c}))}));for(var u=0,X=o.length;u<X;u++){var h=P?{op:Z.OPERATION.ADD,index:o[u]}:o[u];if(h.op!==Z.OPERATION.CLEAR){var B=h.index;if(h.op!==Z.OPERATION.DELETE){var D=x.getValue(B),e=x.getType(B);if(w){if((H=q._definition.filters&&q._definition.filters[B])&&!H.call(q,L,D,V)){D&&D.$changes&&p.add(D.$changes.refId);continue}}else{var H,l=x.parent;if((H=x.getChildrenFilter())&&!H.call(l,L,q.$indexes.get(B),D,V)){D&&D.$changes&&p.add(D.$changes.refId);continue}}if(D.$changes&&(z.push(D.$changes),i++),h.op!==Z.OPERATION.TOUCH)if(h.op===Z.OPERATION.ADD||w)t.push.apply(t,null!==(N=x.caches[B])&&void 0!==N?N:[]),j.add(B);else if(j.has(B))t.push.apply(t,null!==(R=x.caches[B])&&void 0!==R?R:[]);else{if(j.add(B),I(t,Z.OPERATION.ADD),v(t,B),q instanceof O){var W=x.ref.$indexes.get(B);y(t,W)}D.$changes?v(t,D.$changes.refId):Y[e](t,D)}else D.$changes&&!w&&(I(t,Z.OPERATION.ADD),v(t,B),q instanceof O&&(W=x.ref.$indexes.get(B),y(t,W)),v(t,D.$changes.refId))}else w?I(t,h.op|B):(I(t,h.op),v(t,B))}else I(t,h.op)}},x=0;x<i;x++)E(x);return t},c.prototype.clone=function(){var Z,c=new this.constructor,L=this._definition.schema;for(var k in L)"object"===typeof this[k]&&"function"===typeof(null===(Z=this[k])||void 0===Z?void 0:Z.clone)?c[k]=this[k].clone():c[k]=this[k];return c},c.prototype.toJSON=function(){var Z=this._definition.schema,c=this._definition.deprecated,L={};for(var k in Z)c[k]||null===this[k]||"undefined"===typeof this[k]||(L[k]="function"===typeof this[k].toJSON?this[k].toJSON():this["_".concat(k)]);return L},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},c.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},c.prototype.tryEncodeTypeId=function(Z,c,L){c._typeid!==L._typeid&&(I(Z,V),v(Z,L._typeid))},c.prototype.getSchemaType=function(Z,c,L){var k;return Z[c.offset]===V&&(c.offset++,k=this.constructor._context.get(wZ(Z,c))),k||L},c.prototype.createTypeInstance=function(Z){var c=new Z;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(L){for(var k,N,R,G,V,p,J,z,i,t=new Set,E=this.$changes.root.refs,x=function(x){var q=L[x],O=q.refId,w=E.get(O),M=w.$callbacks;if((q.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&q.previousValue instanceof c&&(null===(N=null===(k=q.previousValue.$callbacks)||void 0===k?void 0:k[Z.OPERATION.DELETE])||void 0===N||N.forEach((function(Z){return Z()}))),!M)return"continue";if(w instanceof c){if(!t.has(O))try{null===(R=null===M||void 0===M?void 0:M[Z.OPERATION.REPLACE])||void 0===R||R.forEach((function(Z){return Z()}))}catch(P){c.onError(P)}try{M.hasOwnProperty(q.field)&&(null===(G=M[q.field])||void 0===G||G.forEach((function(Z){return Z(q.value,q.previousValue)})))}catch(P){c.onError(P)}}else q.op===Z.OPERATION.ADD&&void 0===q.previousValue?null===(V=M[Z.OPERATION.ADD])||void 0===V||V.forEach((function(Z){var c;return Z(q.value,null!==(c=q.dynamicIndex)&&void 0!==c?c:q.field)})):q.op===Z.OPERATION.DELETE?void 0!==q.previousValue&&(null===(p=M[Z.OPERATION.DELETE])||void 0===p||p.forEach((function(Z){var c;return Z(q.previousValue,null!==(c=q.dynamicIndex)&&void 0!==c?c:q.field)}))):q.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==q.previousValue&&(null===(J=M[Z.OPERATION.DELETE])||void 0===J||J.forEach((function(Z){var c;return Z(q.previousValue,null!==(c=q.dynamicIndex)&&void 0!==c?c:q.field)}))),null===(z=M[Z.OPERATION.ADD])||void 0===z||z.forEach((function(Z){var c;return Z(q.value,null!==(c=q.dynamicIndex)&&void 0!==c?c:q.field)}))),q.value!==q.previousValue&&(null===(i=M[Z.OPERATION.REPLACE])||void 0===i||i.forEach((function(Z){var c;return Z(q.value,null!==(c=q.dynamicIndex)&&void 0!==c?c:q.field)})));t.add(O)},q=0;q<L.length;q++)x(q)},c._definition=j.create(),c}();function IZ(Z){for(var c=[Z.$changes],L=1,k={},N=k,R=function(Z){var L=c[Z];L.changes.forEach((function(Z){var c=L.ref,k=Z.index,R=c._definition?c._definition.fieldsByIndex[k]:c.$indexes.get(k);N[R]=L.getValue(k)}))},G=0;G<L;G++)R(G);return k}var dZ={context:new u},QZ=function(Z){function c(){return null!==Z&&Z.apply(this,arguments)||this}return L(c,Z),k([h("string",dZ)],c.prototype,"name",void 0),k([h("string",dZ)],c.prototype,"type",void 0),k([h("number",dZ)],c.prototype,"referencedType",void 0),c}(TZ),rZ=function(Z){function c(){var c=null!==Z&&Z.apply(this,arguments)||this;return c.fields=new x,c}return L(c,Z),k([h("number",dZ)],c.prototype,"id",void 0),k([h([QZ],dZ)],c.prototype,"fields",void 0),c}(TZ),fZ=function(Z){function c(){var c=null!==Z&&Z.apply(this,arguments)||this;return c.types=new x,c}return L(c,Z),c.encode=function(Z){var L=Z.constructor,k=new c;k.rootType=L._typeid;var N=function(Z,c){for(var L in c){var N=new QZ;N.name=L;var R=void 0;if("string"===typeof c[L])R=c[L];else{var G=c[L],V=void 0;TZ.is(G)?(R="ref",V=c[L]):"string"===typeof G[R=Object.keys(G)[0]]?R+=":"+G[R]:V=G[R],N.referencedType=V?V._typeid:-1}N.type=R,Z.fields.push(N)}k.types.push(Z)},R=L._context.types;for(var G in R){var V=new rZ;V.id=Number(G),N(V,R[G]._definition.schema)}return k.encodeAll()},c.decode=function(Z,k){var N=new u,R=new c;R.decode(Z,k);var G=R.types.reduce((function(Z,c){var k=function(Z){function c(){return null!==Z&&Z.apply(this,arguments)||this}return L(c,Z),c}(TZ),R=c.id;return Z[R]=k,N.add(k,R),Z}),{});R.types.forEach((function(Z){var c=G[Z.id];Z.fields.forEach((function(Z){var L;if(void 0!==Z.referencedType){var k=Z.type,R=G[Z.referencedType];if(!R){var V=Z.type.split(":");k=V[0],R=V[1]}"ref"===k?h(R,{context:N})(c.prototype,Z.name):h(((L={})[k]=R,L),{context:N})(c.prototype,Z.name)}else h(Z.type,{context:N})(c.prototype,Z.name)}))}));var V=G[R.rootType],p=new V;for(var J in V._definition.schema){var z=V._definition.schema[J];"string"!==typeof z&&(p[J]="function"===typeof z?new z:new(P(Object.keys(z)[0]).constructor))}return p},k([h([rZ],dZ)],c.prototype,"types",void 0),k([h("number",dZ)],c.prototype,"rootType",void 0),c}(TZ);M("map",{constructor:O}),M("array",{constructor:x}),M("set",{constructor:XZ}),M("collection",{constructor:uZ}),Z.ArraySchema=x,Z.CollectionSchema=uZ,Z.Context=u,Z.MapSchema=O,Z.Reflection=fZ,Z.ReflectionField=QZ,Z.ReflectionType=rZ,Z.Schema=TZ,Z.SchemaDefinition=j,Z.SetSchema=XZ,Z.decode=oZ,Z.defineTypes=H,Z.deprecated=e,Z.dumpChanges=IZ,Z.encode=Y,Z.filter=B,Z.filterChildren=D,Z.hasFilter=o,Z.registerType=M,Z.type=h,Object.defineProperty(Z,"__esModule",{value:!0})}(c)},13260:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13251:(Z,c,L)=>{var k=L(13260),N=L(13264),R=Object.hasOwnProperty,G=Object.create(null);for(var V in k)R.call(k,V)&&(G[k[V]]=V);var p=Z.exports={to:{},get:{}};function J(Z,c,L){return Math.min(Math.max(c,Z),L)}function z(Z){var c=Math.round(Z).toString(16).toUpperCase();return c.length<2?"0"+c:c}p.get=function(Z){var c,L;switch(Z.substring(0,3).toLowerCase()){case"hsl":c=p.get.hsl(Z),L="hsl";break;case"hwb":c=p.get.hwb(Z),L="hwb";break;default:c=p.get.rgb(Z),L="rgb"}return c?{model:L,value:c}:null},p.get.rgb=function(Z){if(!Z)return null;var c,L,N,G=[0,0,0,1];if(c=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(N=c[2],c=c[1],L=0;L<3;L++){var V=2*L;G[L]=parseInt(c.slice(V,V+2),16)}N&&(G[3]=parseInt(N,16)/255)}else if(c=Z.match(/^#([a-f0-9]{3,4})$/i)){for(N=(c=c[1])[3],L=0;L<3;L++)G[L]=parseInt(c[L]+c[L],16);N&&(G[3]=parseInt(N+N,16)/255)}else if(c=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(L=0;L<3;L++)G[L]=parseInt(c[L+1],0);c[4]&&(c[5]?G[3]=.01*parseFloat(c[4]):G[3]=parseFloat(c[4]))}else{if(!(c=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=Z.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:R.call(k,c[1])?((G=k[c[1]])[3]=1,G):null:null;for(L=0;L<3;L++)G[L]=Math.round(2.55*parseFloat(c[L+1]));c[4]&&(c[5]?G[3]=.01*parseFloat(c[4]):G[3]=parseFloat(c[4]))}for(L=0;L<3;L++)G[L]=J(G[L],0,255);return G[3]=J(G[3],0,1),G},p.get.hsl=function(Z){if(!Z)return null;var c=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var L=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,J(parseFloat(c[2]),0,100),J(parseFloat(c[3]),0,100),J(isNaN(L)?1:L,0,1)]}return null},p.get.hwb=function(Z){if(!Z)return null;var c=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var L=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,J(parseFloat(c[2]),0,100),J(parseFloat(c[3]),0,100),J(isNaN(L)?1:L,0,1)]}return null},p.to.hex=function(){var Z=N(arguments);return"#"+z(Z[0])+z(Z[1])+z(Z[2])+(Z[3]<1?z(Math.round(255*Z[3])):"")},p.to.rgb=function(){var Z=N(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},p.to.rgb.percent=function(){var Z=N(arguments),c=Math.round(Z[0]/255*100),L=Math.round(Z[1]/255*100),k=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+c+"%, "+L+"%, "+k+"%)":"rgba("+c+"%, "+L+"%, "+k+"%, "+Z[3]+")"},p.to.hsl=function(){var Z=N(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},p.to.hwb=function(){var Z=N(arguments),c="";return Z.length>=4&&1!==Z[3]&&(c=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+c+")"},p.to.keyword=function(Z){return G[Z.slice(0,3)]}},13247:(Z,c,L)=>{const k=L(13251),N=L(13270),R=["keyword","gray","hex"],G={};for(const E of Object.keys(N))G[[...N[E].labels].sort().join("")]=E;const V={};function p(Z,c){if(!(this instanceof p))return new p(Z,c);if(c&&c in R&&(c=null),c&&!(c in N))throw new Error("Unknown model: "+c);let L,J;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof p)this.model=Z.model,this.color=[...Z.color],this.valpha=Z.valpha;else if("string"===typeof Z){const c=k.get(Z);if(null===c)throw new Error("Unable to parse color from string: "+Z);this.model=c.model,J=N[this.model].channels,this.color=c.value.slice(0,J),this.valpha="number"===typeof c.value[J]?c.value[J]:1}else if(Z.length>0){this.model=c||"rgb",J=N[this.model].channels;const L=Array.prototype.slice.call(Z,0,J);this.color=t(L,J),this.valpha="number"===typeof Z[J]?Z[J]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;const c=Object.keys(Z);"alpha"in Z&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);const k=c.sort().join("");if(!(k in G))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=G[k];const{labels:R}=N[this.model],V=[];for(L=0;L<R.length;L++)V.push(Z[R[L]]);this.color=t(V)}if(V[this.model])for(J=N[this.model].channels,L=0;L<J;L++){const Z=V[this.model][L];Z&&(this.color[L]=Z(this.color[L]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}p.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Z){let c=this.model in k.to?this:this.rgb();c=c.round("number"===typeof Z?Z:1);const L=1===c.valpha?c.color:[...c.color,this.valpha];return k.to[c.model](L)},percentString(Z){const c=this.rgb().round("number"===typeof Z?Z:1),L=1===c.valpha?c.color:[...c.color,this.valpha];return k.to.rgb.percent(L)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Z={},{channels:c}=N[this.model],{labels:L}=N[this.model];for(let k=0;k<c;k++)Z[L[k]]=this.color[k];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray(){const Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject(){const Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round(Z){return Z=Math.max(Z||0,0),new p([...this.color.map(J(Z)),this.valpha],this.model)},alpha(Z){return void 0!==Z?new p([...this.color,Math.max(0,Math.min(1,Z))],this.model):this.valpha},red:z("rgb",0,i(255)),green:z("rgb",1,i(255)),blue:z("rgb",2,i(255)),hue:z(["hsl","hsv","hsl","hwb","hcg"],0,(Z=>(Z%360+360)%360)),saturationl:z("hsl",1,i(100)),lightness:z("hsl",2,i(100)),saturationv:z("hsv",1,i(100)),value:z("hsv",2,i(100)),chroma:z("hcg",1,i(100)),gray:z("hcg",2,i(100)),white:z("hwb",1,i(100)),wblack:z("hwb",2,i(100)),cyan:z("cmyk",0,i(100)),magenta:z("cmyk",1,i(100)),yellow:z("cmyk",2,i(100)),black:z("cmyk",3,i(100)),x:z("xyz",0,i(95.047)),y:z("xyz",1,i(100)),z:z("xyz",2,i(108.833)),l:z("lab",0,i(100)),a:z("lab",1),b:z("lab",2),keyword(Z){return void 0!==Z?new p(Z):N[this.model].keyword(this.color)},hex(Z){return void 0!==Z?new p(Z):k.to.hex(this.rgb().round().color)},hexa(Z){if(void 0!==Z)return new p(Z);const c=this.rgb().round().color;let L=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===L.length&&(L="0"+L),k.to.hex(c)+L},rgbNumber(){const Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity(){const Z=this.rgb().color,c=[];for(const[L,k]of Z.entries()){const Z=k/255;c[L]=Z<=.04045?Z/12.92:((Z+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(Z){const c=this.luminosity(),L=Z.luminosity();return c>L?(c+.05)/(L+.05):(L+.05)/(c+.05)},level(Z){const c=this.contrast(Z);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Z=this.rgb();for(let c=0;c<3;c++)Z.color[c]=255-Z.color[c];return Z},lighten(Z){const c=this.hsl();return c.color[2]+=c.color[2]*Z,c},darken(Z){const c=this.hsl();return c.color[2]-=c.color[2]*Z,c},saturate(Z){const c=this.hsl();return c.color[1]+=c.color[1]*Z,c},desaturate(Z){const c=this.hsl();return c.color[1]-=c.color[1]*Z,c},whiten(Z){const c=this.hwb();return c.color[1]+=c.color[1]*Z,c},blacken(Z){const c=this.hwb();return c.color[2]+=c.color[2]*Z,c},grayscale(){const Z=this.rgb().color,c=.3*Z[0]+.59*Z[1]+.11*Z[2];return p.rgb(c,c,c)},fade(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate(Z){const c=this.hsl();let L=c.color[0];return L=(L+Z)%360,L=L<0?360+L:L,c.color[0]=L,c},mix(Z,c){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);const L=Z.rgb(),k=this.rgb(),N=void 0===c?.5:c,R=2*N-1,G=L.alpha()-k.alpha(),V=((R*G===-1?R:(R+G)/(1+R*G))+1)/2,J=1-V;return p.rgb(V*L.red()+J*k.red(),V*L.green()+J*k.green(),V*L.blue()+J*k.blue(),L.alpha()*N+k.alpha()*(1-N))}};for(const E of Object.keys(N)){if(R.includes(E))continue;const{channels:Z}=N[E];p.prototype[E]=function(){if(this.model===E)return new p(this);for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];return c.length>0?new p(c,E):new p([...(k=N[this.model][E].raw(this.color),Array.isArray(k)?k:[k]),this.valpha],E);var k},p[E]=function(){for(var c=arguments.length,L=new Array(c),k=0;k<c;k++)L[k]=arguments[k];let N=L[0];return"number"===typeof N&&(N=t(L,Z)),new p(N,E)}}function J(Z){return function(c){return function(Z,c){return Number(Z.toFixed(c))}(c,Z)}}function z(Z,c,L){Z=Array.isArray(Z)?Z:[Z];for(const k of Z)(V[k]||(V[k]=[]))[c]=L;return Z=Z[0],function(k){let N;return void 0!==k?(L&&(k=L(k)),N=this[Z](),N.color[c]=k,N):(N=this[Z]().color[c],L&&(N=L(N)),N)}}function i(Z){return function(c){return Math.max(0,Math.min(Z,c))}}function t(Z,c){for(let L=0;L<c;L++)"number"!==typeof Z[L]&&(Z[L]=0);return Z}Z.exports=p},13277:(Z,c,L)=>{const k=L(13279),N={};for(const G of Object.keys(k))N[k[G]]=G;const R={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=R;for(const G of Object.keys(R)){if(!("channels"in R[G]))throw new Error("missing channels property: "+G);if(!("labels"in R[G]))throw new Error("missing channel labels property: "+G);if(R[G].labels.length!==R[G].channels)throw new Error("channel and label counts mismatch: "+G);const{channels:Z,labels:c}=R[G];delete R[G].channels,delete R[G].labels,Object.defineProperty(R[G],"channels",{value:Z}),Object.defineProperty(R[G],"labels",{value:c})}R.rgb.hsl=function(Z){const c=Z[0]/255,L=Z[1]/255,k=Z[2]/255,N=Math.min(c,L,k),R=Math.max(c,L,k),G=R-N;let V,p;R===N?V=0:c===R?V=(L-k)/G:L===R?V=2+(k-c)/G:k===R&&(V=4+(c-L)/G),V=Math.min(60*V,360),V<0&&(V+=360);const J=(N+R)/2;return p=R===N?0:J<=.5?G/(R+N):G/(2-R-N),[V,100*p,100*J]},R.rgb.hsv=function(Z){let c,L,k,N,R;const G=Z[0]/255,V=Z[1]/255,p=Z[2]/255,J=Math.max(G,V,p),z=J-Math.min(G,V,p),i=function(Z){return(J-Z)/6/z+.5};return 0===z?(N=0,R=0):(R=z/J,c=i(G),L=i(V),k=i(p),G===J?N=k-L:V===J?N=1/3+c-k:p===J&&(N=2/3+L-c),N<0?N+=1:N>1&&(N-=1)),[360*N,100*R,100*J]},R.rgb.hwb=function(Z){const c=Z[0],L=Z[1];let k=Z[2];const N=R.rgb.hsl(Z)[0],G=1/255*Math.min(c,Math.min(L,k));return k=1-1/255*Math.max(c,Math.max(L,k)),[N,100*G,100*k]},R.rgb.cmyk=function(Z){const c=Z[0]/255,L=Z[1]/255,k=Z[2]/255,N=Math.min(1-c,1-L,1-k);return[100*((1-c-N)/(1-N)||0),100*((1-L-N)/(1-N)||0),100*((1-k-N)/(1-N)||0),100*N]},R.rgb.keyword=function(Z){const c=N[Z];if(c)return c;let L,R=1/0;for(const N of Object.keys(k)){const c=k[N],p=(V=c,((G=Z)[0]-V[0])**2+(G[1]-V[1])**2+(G[2]-V[2])**2);p<R&&(R=p,L=N)}var G,V;return L},R.keyword.rgb=function(Z){return k[Z]},R.rgb.xyz=function(Z){let c=Z[0]/255,L=Z[1]/255,k=Z[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,L=L>.04045?((L+.055)/1.055)**2.4:L/12.92,k=k>.04045?((k+.055)/1.055)**2.4:k/12.92;return[100*(.4124*c+.3576*L+.1805*k),100*(.2126*c+.7152*L+.0722*k),100*(.0193*c+.1192*L+.9505*k)]},R.rgb.lab=function(Z){const c=R.rgb.xyz(Z);let L=c[0],k=c[1],N=c[2];L/=95.047,k/=100,N/=108.883,L=L>.008856?L**(1/3):7.787*L+16/116,k=k>.008856?k**(1/3):7.787*k+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*k-16,500*(L-k),200*(k-N)]},R.hsl.rgb=function(Z){const c=Z[0]/360,L=Z[1]/100,k=Z[2]/100;let N,R,G;if(0===L)return G=255*k,[G,G,G];N=k<.5?k*(1+L):k+L-k*L;const V=2*k-N,p=[0,0,0];for(let J=0;J<3;J++)R=c+1/3*-(J-1),R<0&&R++,R>1&&R--,G=6*R<1?V+6*(N-V)*R:2*R<1?N:3*R<2?V+(N-V)*(2/3-R)*6:V,p[J]=255*G;return p},R.hsl.hsv=function(Z){const c=Z[0];let L=Z[1]/100,k=Z[2]/100,N=L;const R=Math.max(k,.01);k*=2,L*=k<=1?k:2-k,N*=R<=1?R:2-R;return[c,100*(0===k?2*N/(R+N):2*L/(k+L)),100*((k+L)/2)]},R.hsv.rgb=function(Z){const c=Z[0]/60,L=Z[1]/100;let k=Z[2]/100;const N=Math.floor(c)%6,R=c-Math.floor(c),G=255*k*(1-L),V=255*k*(1-L*R),p=255*k*(1-L*(1-R));switch(k*=255,N){case 0:return[k,p,G];case 1:return[V,k,G];case 2:return[G,k,p];case 3:return[G,V,k];case 4:return[p,G,k];case 5:return[k,G,V]}},R.hsv.hsl=function(Z){const c=Z[0],L=Z[1]/100,k=Z[2]/100,N=Math.max(k,.01);let R,G;G=(2-L)*k;const V=(2-L)*N;return R=L*N,R/=V<=1?V:2-V,R=R||0,G/=2,[c,100*R,100*G]},R.hwb.rgb=function(Z){const c=Z[0]/360;let L=Z[1]/100,k=Z[2]/100;const N=L+k;let R;N>1&&(L/=N,k/=N);const G=Math.floor(6*c),V=1-k;R=6*c-G,0!==(1&G)&&(R=1-R);const p=L+R*(V-L);let J,z,i;switch(G){default:case 6:case 0:J=V,z=p,i=L;break;case 1:J=p,z=V,i=L;break;case 2:J=L,z=V,i=p;break;case 3:J=L,z=p,i=V;break;case 4:J=p,z=L,i=V;break;case 5:J=V,z=L,i=p}return[255*J,255*z,255*i]},R.cmyk.rgb=function(Z){const c=Z[0]/100,L=Z[1]/100,k=Z[2]/100,N=Z[3]/100;return[255*(1-Math.min(1,c*(1-N)+N)),255*(1-Math.min(1,L*(1-N)+N)),255*(1-Math.min(1,k*(1-N)+N))]},R.xyz.rgb=function(Z){const c=Z[0]/100,L=Z[1]/100,k=Z[2]/100;let N,R,G;return N=3.2406*c+-1.5372*L+-.4986*k,R=-.9689*c+1.8758*L+.0415*k,G=.0557*c+-.204*L+1.057*k,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,N=Math.min(Math.max(0,N),1),R=Math.min(Math.max(0,R),1),G=Math.min(Math.max(0,G),1),[255*N,255*R,255*G]},R.xyz.lab=function(Z){let c=Z[0],L=Z[1],k=Z[2];c/=95.047,L/=100,k/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,L=L>.008856?L**(1/3):7.787*L+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*L-16,500*(c-L),200*(L-k)]},R.lab.xyz=function(Z){let c,L,k;L=(Z[0]+16)/116,c=Z[1]/500+L,k=L-Z[2]/200;const N=L**3,R=c**3,G=k**3;return L=N>.008856?N:(L-16/116)/7.787,c=R>.008856?R:(c-16/116)/7.787,k=G>.008856?G:(k-16/116)/7.787,c*=95.047,L*=100,k*=108.883,[c,L,k]},R.lab.lch=function(Z){const c=Z[0],L=Z[1],k=Z[2];let N;N=360*Math.atan2(k,L)/2/Math.PI,N<0&&(N+=360);return[c,Math.sqrt(L*L+k*k),N]},R.lch.lab=function(Z){const c=Z[0],L=Z[1],k=Z[2]/360*2*Math.PI;return[c,L*Math.cos(k),L*Math.sin(k)]},R.rgb.ansi16=function(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[L,k,N]=Z;let G=null===c?R.rgb.hsv(Z)[2]:c;if(G=Math.round(G/50),0===G)return 30;let V=30+(Math.round(N/255)<<2|Math.round(k/255)<<1|Math.round(L/255));return 2===G&&(V+=60),V},R.hsv.ansi16=function(Z){return R.rgb.ansi16(R.hsv.rgb(Z),Z[2])},R.rgb.ansi256=function(Z){const c=Z[0],L=Z[1],k=Z[2];if(c===L&&L===k)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(L/255*5)+Math.round(k/255*5)},R.ansi16.rgb=function(Z){let c=Z%10;if(0===c||7===c)return Z>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const L=.5*(1+~~(Z>50));return[(1&c)*L*255,(c>>1&1)*L*255,(c>>2&1)*L*255]},R.ansi256.rgb=function(Z){if(Z>=232){const c=10*(Z-232)+8;return[c,c,c]}let c;Z-=16;return[Math.floor(Z/36)/5*255,Math.floor((c=Z%36)/6)/5*255,c%6/5*255]},R.rgb.hex=function(Z){const c=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},R.hex.rgb=function(Z){const c=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let L=c[0];3===c[0].length&&(L=L.split("").map((Z=>Z+Z)).join(""));const k=parseInt(L,16);return[k>>16&255,k>>8&255,255&k]},R.rgb.hcg=function(Z){const c=Z[0]/255,L=Z[1]/255,k=Z[2]/255,N=Math.max(Math.max(c,L),k),R=Math.min(Math.min(c,L),k),G=N-R;let V,p;return V=G<1?R/(1-G):0,p=G<=0?0:N===c?(L-k)/G%6:N===L?2+(k-c)/G:4+(c-L)/G,p/=6,p%=1,[360*p,100*G,100*V]},R.hsl.hcg=function(Z){const c=Z[1]/100,L=Z[2]/100,k=L<.5?2*c*L:2*c*(1-L);let N=0;return k<1&&(N=(L-.5*k)/(1-k)),[Z[0],100*k,100*N]},R.hsv.hcg=function(Z){const c=Z[1]/100,L=Z[2]/100,k=c*L;let N=0;return k<1&&(N=(L-k)/(1-k)),[Z[0],100*k,100*N]},R.hcg.rgb=function(Z){const c=Z[0]/360,L=Z[1]/100,k=Z[2]/100;if(0===L)return[255*k,255*k,255*k];const N=[0,0,0],R=c%1*6,G=R%1,V=1-G;let p=0;switch(Math.floor(R)){case 0:N[0]=1,N[1]=G,N[2]=0;break;case 1:N[0]=V,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=G;break;case 3:N[0]=0,N[1]=V,N[2]=1;break;case 4:N[0]=G,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=V}return p=(1-L)*k,[255*(L*N[0]+p),255*(L*N[1]+p),255*(L*N[2]+p)]},R.hcg.hsv=function(Z){const c=Z[1]/100,L=c+Z[2]/100*(1-c);let k=0;return L>0&&(k=c/L),[Z[0],100*k,100*L]},R.hcg.hsl=function(Z){const c=Z[1]/100,L=Z[2]/100*(1-c)+.5*c;let k=0;return L>0&&L<.5?k=c/(2*L):L>=.5&&L<1&&(k=c/(2*(1-L))),[Z[0],100*k,100*L]},R.hcg.hwb=function(Z){const c=Z[1]/100,L=c+Z[2]/100*(1-c);return[Z[0],100*(L-c),100*(1-L)]},R.hwb.hcg=function(Z){const c=Z[1]/100,L=1-Z[2]/100,k=L-c;let N=0;return k<1&&(N=(L-k)/(1-k)),[Z[0],100*k,100*N]},R.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},R.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},R.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},R.gray.hsl=function(Z){return[0,0,Z[0]]},R.gray.hsv=R.gray.hsl,R.gray.hwb=function(Z){return[0,100,Z[0]]},R.gray.cmyk=function(Z){return[0,0,0,Z[0]]},R.gray.lab=function(Z){return[Z[0],0,0]},R.gray.hex=function(Z){const c=255&Math.round(Z[0]/100*255),L=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(L.length)+L},R.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},13270:(Z,c,L)=>{const k=L(13277),N=L(13284),R={};Object.keys(k).forEach((Z=>{R[Z]={},Object.defineProperty(R[Z],"channels",{value:k[Z].channels}),Object.defineProperty(R[Z],"labels",{value:k[Z].labels});const c=N(Z);Object.keys(c).forEach((L=>{const k=c[L];R[Z][L]=function(Z){const c=function(){for(var c=arguments.length,L=new Array(c),k=0;k<c;k++)L[k]=arguments[k];const N=L[0];if(void 0===N||null===N)return N;N.length>1&&(L=N);const R=Z(L);if("object"===typeof R)for(let Z=R.length,G=0;G<Z;G++)R[G]=Math.round(R[G]);return R};return"conversion"in Z&&(c.conversion=Z.conversion),c}(k),R[Z][L].raw=function(Z){const c=function(){for(var c=arguments.length,L=new Array(c),k=0;k<c;k++)L[k]=arguments[k];const N=L[0];return void 0===N||null===N?N:(N.length>1&&(L=N),Z(L))};return"conversion"in Z&&(c.conversion=Z.conversion),c}(k)}))})),Z.exports=R},13284:(Z,c,L)=>{const k=L(13277);function N(Z){const c=function(){const Z={},c=Object.keys(k);for(let L=c.length,k=0;k<L;k++)Z[c[k]]={distance:-1,parent:null};return Z}(),L=[Z];for(c[Z].distance=0;L.length;){const Z=L.pop(),N=Object.keys(k[Z]);for(let k=N.length,R=0;R<k;R++){const k=N[R],G=c[k];-1===G.distance&&(G.distance=c[Z].distance+1,G.parent=Z,L.unshift(k))}}return c}function R(Z,c){return function(L){return c(Z(L))}}function G(Z,c){const L=[c[Z].parent,Z];let N=k[c[Z].parent][Z],G=c[Z].parent;for(;c[G].parent;)L.unshift(c[G].parent),N=R(k[c[G].parent][G],N),G=c[G].parent;return N.conversion=L,N}Z.exports=function(Z){const c=N(Z),L={},k=Object.keys(c);for(let N=k.length,R=0;R<N;R++){const Z=k[R];null!==c[Z].parent&&(L[Z]=G(Z,c))}return L}},13279:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11884:function(Z,c,L){"use strict";var k=this&&this.__createBinding||(Object.create?function(Z,c,L,k){void 0===k&&(k=L);var N=Object.getOwnPropertyDescriptor(c,L);N&&!("get"in N?!c.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return c[L]}}),Object.defineProperty(Z,k,N)}:function(Z,c,L,k){void 0===k&&(k=L),Z[k]=c[L]}),N=this&&this.__setModuleDefault||(Object.create?function(Z,c){Object.defineProperty(Z,"default",{enumerable:!0,value:c})}:function(Z,c){Z.default=c}),R=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var c={};if(null!=Z)for(var L in Z)"default"!==L&&Object.prototype.hasOwnProperty.call(Z,L)&&k(c,Z,L);return N(c,Z),c},G=this&&this.__awaiter||function(Z,c,L,k){return new(L||(L=Promise))((function(N,R){function G(Z){try{p(k.next(Z))}catch(c){R(c)}}function V(Z){try{p(k.throw(Z))}catch(c){R(c)}}function p(Z){var c;Z.done?N(Z.value):(c=Z.value,c instanceof L?c:new L((function(Z){Z(c)}))).then(G,V)}p((k=k.apply(Z,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=c.Platform=void 0;const V=R(L(11812)),p=L(11892),J="colyseus-auth-token";!function(Z){Z.ios="ios",Z.android="android"}(c.Platform||(c.Platform={}));c.Auth=class{constructor(Z){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=Z.replace("ws","http"),(0,p.getItem)(J,(Z=>this.token=Z))}get hasToken(){return!!this.token}login(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G(this,void 0,void 0,(function*(){const c=Object.assign({},Z);this.hasToken&&(c.token=this.token);const L=yield this.request("post","/auth",c);this.token=L.token,(0,p.setItem)(J,this.token);for(let Z in L)this.hasOwnProperty(Z)&&(this[Z]=L[Z]);return this.registerPingService(),this}))}save(){return G(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(Z){return G(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:Z})}))}acceptFriendRequest(Z){return G(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:Z})}))}declineFriendRequest(Z){return G(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:Z})}))}blockUser(Z){return G(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:Z})}))}unblockUser(Z){return G(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:Z})}))}request(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return G(this,void 0,void 0,(function*(){N.Accept="application/json",this.hasToken&&(N.Authorization="Bearer "+this.token);const R=[];for(const Z in L)R.push(`${Z}=${L[Z]}`);const G=R.length>0?`?${R.join("&")}`:"",p={headers:N};return k&&(p.body=k),(yield V[Z](`${this.endpoint}${c}${G}`,p)).data}))}logout(){this.token=void 0,(0,p.removeItem)(J),this.unregisterPingService()}registerPingService(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),Z)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11807:function(Z,c,L){"use strict";var k,N=this&&this.__awaiter||function(Z,c,L,k){return new(L||(L=Promise))((function(N,R){function G(Z){try{p(k.next(Z))}catch(c){R(c)}}function V(Z){try{p(k.throw(Z))}catch(c){R(c)}}function p(Z){var c;Z.done?N(Z.value):(c=Z.value,c instanceof L?c:new L((function(Z){Z(c)}))).then(G,V)}p((k=k.apply(Z,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const R=L(11812),G=L(11821),V=L(11826);class p extends Error{constructor(Z,c){super(Z),this.code=c,Object.setPrototypeOf(this,p.prototype)}}c.MatchMakeError=p;const J="undefined"!==typeof window&&"undefined"!==typeof(null===(k=null===window||void 0===window?void 0:window.location)||void 0===k?void 0:k.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;if("string"===typeof Z){const c=new URL(Z),L="https:"===c.protocol||"wss:"===c.protocol,k=Number(c.port||(L?443:80));this.settings={hostname:c.hostname,pathname:"/"!==c.pathname?c.pathname:"",port:k,secure:L}}else void 0===Z.port&&(Z.port=Z.secure?443:80),void 0===Z.pathname&&(Z.pathname=""),this.settings=Z}joinOrCreate(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Z,c,L)}))}create(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Z,c,L)}))}join(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Z,c,L)}))}joinById(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Z,c,L)}))}reconnect(Z,c){return N(this,void 0,void 0,(function*(){if("string"===typeof Z&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[L,k]=Z.split(":");return yield this.createMatchMakeRequest("reconnect",L,{reconnectionToken:k},c)}))}getAvailableRooms(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return N(this,void 0,void 0,(function*(){return(yield(0,R.get)(this.getHttpEndpoint(`${Z}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Z,c,L){return N(this,void 0,void 0,(function*(){const k=this.createRoom(Z.room.name,c);k.roomId=Z.room.roomId,k.sessionId=Z.sessionId;const R={sessionId:k.sessionId};Z.reconnectionToken&&(R.reconnectionToken=Z.reconnectionToken);const V=L||k;return k.connect(this.buildEndpoint(Z.room,R),Z.devMode&&(()=>N(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${k.roomId}'...`);let L=0;const R=()=>N(this,void 0,void 0,(function*(){L++;try{yield this.consumeSeatReservation(Z,c,V),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${k.roomId}'`)}catch(N){L<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${L} out of 8)`),setTimeout(R,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(R,2e3)}))),V),new Promise(((Z,c)=>{const L=(Z,L)=>c(new G.ServerError(Z,L));V.onError.once(L),V.onJoin.once((()=>{V.onError.remove(L),Z(V)}))}))}))}createMatchMakeRequest(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;return N(this,void 0,void 0,(function*(){const N=(yield(0,R.post)(this.getHttpEndpoint(`${Z}/${c}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(L)})).data;if(N.error)throw new p(N.error,N.code);return"reconnect"===Z&&(N.reconnectionToken=L.reconnectionToken),yield this.consumeSeatReservation(N,k,G)}))}createRoom(Z,c){return new V.Room(Z,c)}buildEndpoint(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=[];for(const N in c)c.hasOwnProperty(N)&&L.push(`${N}=${c[N]}`);let k=this.settings.secure?"wss://":"ws://";return Z.publicAddress?k+=`${Z.publicAddress}`:k+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${k}/${Z.processId}/${Z.roomId}?${L.join("&")}`}getHttpEndpoint(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${Z}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11834:(Z,c,L)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const k=L(11843);c.Connection=class{constructor(){this.events={},this.transport=new k.WebSocketTransport(this.events)}send(Z){this.transport.send(Z)}connect(Z){this.transport.connect(Z)}close(Z,c){this.transport.close(Z,c)}get isOpen(){return this.transport.isOpen}}},11858:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(Z,c){const L=Z[c++];for(var k="",N=0,R=c,G=c+L;R<G;R++){var V=Z[R];if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(N=(7&V)<<18|(63&Z[++R])<<12|(63&Z[++R])<<6|63&Z[++R])>=65536?(N-=65536,k+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):k+=String.fromCharCode(N)}else k+=String.fromCharCode((15&V)<<12|(63&Z[++R])<<6|63&Z[++R]);else k+=String.fromCharCode((31&V)<<6|63&Z[++R]);else k+=String.fromCharCode(V)}return k},c.utf8Length=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,L=0;for(let k=0,N=Z.length;k<N;k++)c=Z.charCodeAt(k),c<128?L+=1:c<2048?L+=2:c<55296||c>=57344?L+=3:(k++,L+=4);return L+1}},11826:function(Z,c,L){"use strict";var k=this&&this.__createBinding||(Object.create?function(Z,c,L,k){void 0===k&&(k=L);var N=Object.getOwnPropertyDescriptor(c,L);N&&!("get"in N?!c.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return c[L]}}),Object.defineProperty(Z,k,N)}:function(Z,c,L,k){void 0===k&&(k=L),Z[k]=c[L]}),N=this&&this.__setModuleDefault||(Object.create?function(Z,c){Object.defineProperty(Z,"default",{enumerable:!0,value:c})}:function(Z,c){Z.default=c}),R=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var c={};if(null!=Z)for(var L in Z)"default"!==L&&Object.prototype.hasOwnProperty.call(Z,L)&&k(c,Z,L);return N(c,Z),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const G=R(L(11831)),V=L(11834),p=L(11858),J=L(11867),z=L(11872),i=L(11874),t=L(11880),E=L(11821);class x{constructor(Z,c){this.onStateChange=(0,i.createSignal)(),this.onError=(0,i.createSignal)(),this.onLeave=(0,i.createSignal)(),this.onJoin=(0,i.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,z.createNanoEvents)(),this.roomId=null,this.name=Z,c&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((Z,c)=>{var L;return null===(L=console.warn)||void 0===L?void 0:L.call(console,`colyseus.js - onError => (${Z}) ${c}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const k=new V.Connection;L.connection=k,k.events.onmessage=x.prototype.onMessageCallback.bind(L),k.events.onclose=function(Z){var k;if(!L.hasJoined)return null===(k=console.warn)||void 0===k||k.call(console,`Room connection was closed unexpectedly (${Z.code}): ${Z.reason}`),void L.onError.invoke(Z.code,Z.reason);Z.code===E.CloseCode.DEVMODE_RESTART&&c?c():(L.onLeave.invoke(Z.code),L.destroy())},k.events.onerror=function(Z){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${Z.code}): ${Z.reason}`),L.onError.invoke(Z.code,Z.reason)},k.connect(Z)}leave(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((Z=>c(Z))),this.connection?Z?this.connection.send([p.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(E.CloseCode.CONSENTED)}))}onMessage(Z,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),c)}send(Z,c){const L=[p.Protocol.ROOM_DATA];let k;if("string"===typeof Z?t.encode.string(L,Z):t.encode.number(L,Z),void 0!==c){const Z=G.encode(c);k=new Uint8Array(L.length+Z.byteLength),k.set(new Uint8Array(L),0),k.set(new Uint8Array(Z),L.length)}else k=new Uint8Array(L);this.connection.send(k.buffer)}sendBytes(Z,c){const L=[p.Protocol.ROOM_DATA_BYTES];let k;"string"===typeof Z?t.encode.string(L,Z):t.encode.number(L,Z),k=new Uint8Array(L.length+(c.byteLength||c.length)),k.set(new Uint8Array(L),0),k.set(new Uint8Array(c),L.length),this.connection.send(k.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Z){const c=Array.from(new Uint8Array(Z.data)),L=c[0];if(L===p.Protocol.JOIN_ROOM){let Z=1;const L=(0,p.utf8Read)(c,Z);if(Z+=(0,p.utf8Length)(L),this.serializerId=(0,p.utf8Read)(c,Z),Z+=(0,p.utf8Length)(this.serializerId),!this.serializer){const Z=(0,J.getSerializer)(this.serializerId);this.serializer=new Z}c.length>Z&&this.serializer.handshake&&this.serializer.handshake(c,{offset:Z}),this.reconnectionToken=`${this.roomId}:${L}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([p.Protocol.JOIN_ROOM])}else if(L===p.Protocol.ERROR){const Z={offset:1},L=t.decode.number(c,Z),k=t.decode.string(c,Z);this.onError.invoke(L,k)}else if(L===p.Protocol.LEAVE_ROOM)this.leave();else if(L===p.Protocol.ROOM_DATA_SCHEMA){const Z={offset:1},L=this.serializer.getState().constructor._context.get(t.decode.number(c,Z)),k=new L;k.decode(c,Z),this.dispatchMessage(L,k)}else if(L===p.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(L===p.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(L===p.Protocol.ROOM_DATA){const L={offset:1},k=t.decode.stringCheck(c,L)?t.decode.string(c,L):t.decode.number(c,L),N=c.length>L.offset?G.decode(Z.data,L.offset):void 0;this.dispatchMessage(k,N)}else if(L===p.Protocol.ROOM_DATA_BYTES){const Z={offset:1},L=t.decode.stringCheck(c,Z)?t.decode.string(c,Z):t.decode.number(c,Z);this.dispatchMessage(L,new Uint8Array(c.slice(Z.offset)))}}setState(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}patch(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Z,c){var L;const k=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[k]?this.onMessageHandlers.emit(k,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,c):null===(L=console.warn)||void 0===L||L.call(console,`colyseus.js: onMessage() not registered for type '${Z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Z){switch(typeof Z){case"function":return`$${Z._typeid}`;case"string":return Z;case"number":return`i${Z}`;default:throw new Error("invalid message type.")}}}c.Room=x},11892:(Z,c)=>{"use strict";let L;function k(){return L||(L="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(Z,c){this.cache[Z]=c},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),L}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(Z,c){k().setItem(Z,c)},c.removeItem=function(Z){k().removeItem(Z)},c.getItem=function(Z,c){const L=k().getItem(Z);"undefined"!==typeof Promise&&L instanceof Promise?L.then((Z=>c(Z))):c(L)}},11872:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(Z){let c=this.events[Z]||[];for(var L=arguments.length,k=new Array(L>1?L-1:0),N=1;N<L;N++)k[N-1]=arguments[N];for(let R=0,G=c.length;R<G;R++)c[R](...k)},events:{},on(Z,c){var L;return(null===(L=this.events[Z])||void 0===L?void 0:L.push(c))||(this.events[Z]=[c]),()=>{var L;this.events[Z]=null===(L=this.events[Z])||void 0===L?void 0:L.filter((Z=>c!==Z))}}})},11874:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class L{constructor(){this.handlers=[]}register(Z){return this.handlers.push(Z),this}invoke(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];this.handlers.forEach((Z=>Z.apply(this,c)))}invokeAsync(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];return Promise.all(this.handlers.map((Z=>Z.apply(this,c))))}remove(Z){const c=this.handlers.indexOf(Z);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=L,c.createSignal=function(){const Z=new L;function c(c){return Z.register(c,null===this)}return c.once=c=>{const L=function(){for(var k=arguments.length,N=new Array(k),R=0;R<k;R++)N[R]=arguments[R];c.apply(this,N),Z.remove(L)};Z.register(L)},c.remove=c=>Z.remove(c),c.invoke=function(){return Z.invoke(...arguments)},c.invokeAsync=function(){return Z.invokeAsync(...arguments)},c.clear=()=>Z.clear(),c}},11821:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class L extends Error{constructor(Z,c){super(c),this.name="ServerError",this.code=Z}}c.ServerError=L},11800:(Z,c,L)=>{"use strict";c.c=void 0,L(11805);var k=L(11807);Object.defineProperty(c,"c",{enumerable:!0,get:function(){return k.Client}});var N=L(11858);var R=L(11826);var G=L(11884);const V=L(11895);const p=L(11897),J=L(11867);(0,J.registerSerializer)("schema",V.SchemaSerializer),(0,J.registerSerializer)("none",p.NoneSerializer)},11805:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Z=>null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11831:(Z,c)=>{"use strict";function L(Z,c){if(this._offset=c,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,L.prototype._array=function(Z){for(var c=new Array(Z),L=0;L<Z;L++)c[L]=this._parse();return c},L.prototype._map=function(Z){for(var c={},L=0;L<Z;L++)c[this._parse()]=this._parse();return c},L.prototype._str=function(Z){var c=function(Z,c,L){for(var k="",N=0,R=c,G=c+L;R<G;R++){var V=Z.getUint8(R);if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(N=(7&V)<<18|(63&Z.getUint8(++R))<<12|(63&Z.getUint8(++R))<<6|63&Z.getUint8(++R))>=65536?(N-=65536,k+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):k+=String.fromCharCode(N)}else k+=String.fromCharCode((15&V)<<12|(63&Z.getUint8(++R))<<6|63&Z.getUint8(++R));else k+=String.fromCharCode((31&V)<<6|63&Z.getUint8(++R));else k+=String.fromCharCode(V)}return k}(this._view,this._offset,Z);return this._offset+=Z,c},L.prototype._bin=function(Z){var c=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,c},L.prototype._parse=function(){var Z,c=this._view.getUint8(this._offset++),L=0,k=0,N=0,R=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return L=this._view.getUint8(this._offset),this._offset+=1,this._bin(L);case 197:return L=this._view.getUint16(this._offset),this._offset+=2,this._bin(L);case 198:return L=this._view.getUint32(this._offset),this._offset+=4,this._bin(L);case 199:if(L=this._view.getUint8(this._offset),k=this._view.getInt8(this._offset+1),this._offset+=2,-1===k){var G=this._view.getUint32(this._offset);return N=this._view.getInt32(this._offset+4),R=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*N+R)+G/1e6)}return[k,this._bin(L)];case 200:return L=this._view.getUint16(this._offset),k=this._view.getInt8(this._offset+2),this._offset+=3,[k,this._bin(L)];case 201:return L=this._view.getUint32(this._offset),k=this._view.getInt8(this._offset+4),this._offset+=5,[k,this._bin(L)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return N=this._view.getUint32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,N+R;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return N=this._view.getInt32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,N+R;case 212:return k=this._view.getInt8(this._offset),this._offset+=1,0===k?void(this._offset+=1):[k,this._bin(1)];case 213:return k=this._view.getInt8(this._offset),this._offset+=1,[k,this._bin(2)];case 214:return k=this._view.getInt8(this._offset),this._offset+=1,-1===k?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[k,this._bin(4)];case 215:return k=this._view.getInt8(this._offset),this._offset+=1,0===k?(N=this._view.getInt32(this._offset)*Math.pow(2,32),R=this._view.getUint32(this._offset+4),this._offset+=8,new Date(N+R)):-1===k?(N=this._view.getUint32(this._offset),R=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&N)+R)+(N>>>2)/1e6)):[k,this._bin(8)];case 216:return k=this._view.getInt8(this._offset),this._offset+=1,[k,this._bin(16)];case 217:return L=this._view.getUint8(this._offset),this._offset+=1,this._str(L);case 218:return L=this._view.getUint16(this._offset),this._offset+=2,this._str(L);case 219:return L=this._view.getUint32(this._offset),this._offset+=4,this._str(L);case 220:return L=this._view.getUint16(this._offset),this._offset+=2,this._array(L);case 221:return L=this._view.getUint32(this._offset),this._offset+=4,this._array(L);case 222:return L=this._view.getUint16(this._offset),this._offset+=2,this._map(L);case 223:return L=this._view.getUint32(this._offset),this._offset+=4,this._map(L)}throw new Error("Could not parse")},c.decode=function(Z){var c=new L(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),k=c._parse();if(c._offset!==Z.byteLength)throw new Error(Z.byteLength-c._offset+" trailing bytes");return k};function k(Z,c,L){for(var k=0,N=0,R=L.length;N<R;N++)(k=L.charCodeAt(N))<128?Z.setUint8(c++,k):k<2048?(Z.setUint8(c++,192|k>>6),Z.setUint8(c++,128|63&k)):k<55296||k>=57344?(Z.setUint8(c++,224|k>>12),Z.setUint8(c++,128|k>>6&63),Z.setUint8(c++,128|63&k)):(N++,k=65536+((1023&k)<<10|1023&L.charCodeAt(N)),Z.setUint8(c++,240|k>>18),Z.setUint8(c++,128|k>>12&63),Z.setUint8(c++,128|k>>6&63),Z.setUint8(c++,128|63&k))}function N(Z,c,L){var k=typeof L,R=0,G=0,V=0,p=0,J=0,z=0;if("string"===k){if(J=function(Z){for(var c=0,L=0,k=0,N=Z.length;k<N;k++)(c=Z.charCodeAt(k))<128?L+=1:c<2048?L+=2:c<55296||c>=57344?L+=3:(k++,L+=4);return L}(L),J<32)Z.push(160|J),z=1;else if(J<256)Z.push(217,J),z=2;else if(J<65536)Z.push(218,J>>8,J),z=3;else{if(!(J<4294967296))throw new Error("String too long");Z.push(219,J>>24,J>>16,J>>8,J),z=5}return c.push({_str:L,_length:J,_offset:Z.length}),z+J}if("number"===k)return Math.floor(L)===L&&isFinite(L)?L>=0?L<128?(Z.push(L),1):L<256?(Z.push(204,L),2):L<65536?(Z.push(205,L>>8,L),3):L<4294967296?(Z.push(206,L>>24,L>>16,L>>8,L),5):(V=L/Math.pow(2,32)|0,p=L>>>0,Z.push(207,V>>24,V>>16,V>>8,V,p>>24,p>>16,p>>8,p),9):L>=-32?(Z.push(L),1):L>=-128?(Z.push(208,L),2):L>=-32768?(Z.push(209,L>>8,L),3):L>=-2147483648?(Z.push(210,L>>24,L>>16,L>>8,L),5):(V=Math.floor(L/Math.pow(2,32)),p=L>>>0,Z.push(211,V>>24,V>>16,V>>8,V,p>>24,p>>16,p>>8,p),9):(Z.push(203),c.push({_float:L,_length:8,_offset:Z.length}),9);if("object"===k){if(null===L)return Z.push(192),1;if(Array.isArray(L)){if((J=L.length)<16)Z.push(144|J),z=1;else if(J<65536)Z.push(220,J>>8,J),z=3;else{if(!(J<4294967296))throw new Error("Array too large");Z.push(221,J>>24,J>>16,J>>8,J),z=5}for(R=0;R<J;R++)z+=N(Z,c,L[R]);return z}if(L instanceof Date){var i=L.getTime(),t=Math.floor(i/1e3),E=1e6*(i-1e3*t);return t>=0&&E>=0&&t<=17179869183?0===E&&t<=4294967295?(Z.push(214,255,t>>24,t>>16,t>>8,t),6):(V=t/4294967296,p=4294967295&t,Z.push(215,255,E>>22,E>>14,E>>6,V,p>>24,p>>16,p>>8,p),10):(V=Math.floor(t/4294967296),p=t>>>0,Z.push(199,12,255,E>>24,E>>16,E>>8,E,V>>24,V>>16,V>>8,V,p>>24,p>>16,p>>8,p),15)}if(L instanceof ArrayBuffer){if((J=L.byteLength)<256)Z.push(196,J),z=2;else if(J<65536)Z.push(197,J>>8,J),z=3;else{if(!(J<4294967296))throw new Error("Buffer too large");Z.push(198,J>>24,J>>16,J>>8,J),z=5}return c.push({_bin:L,_length:J,_offset:Z.length}),z+J}if("function"===typeof L.toJSON)return N(Z,c,L.toJSON());var x=[],q="",O=Object.keys(L);for(R=0,G=O.length;R<G;R++)void 0!==L[q=O[R]]&&"function"!==typeof L[q]&&x.push(q);if((J=x.length)<16)Z.push(128|J),z=1;else if(J<65536)Z.push(222,J>>8,J),z=3;else{if(!(J<4294967296))throw new Error("Object too large");Z.push(223,J>>24,J>>16,J>>8,J),z=5}for(R=0;R<J;R++)z+=N(Z,c,q=x[R]),z+=N(Z,c,L[q]);return z}if("boolean"===k)return Z.push(L?195:194),1;if("undefined"===k)return Z.push(192),1;if("function"===typeof L.toJSON)return N(Z,c,L.toJSON());throw new Error("Could not encode")}c.encode=function(Z){var c=[],L=[],R=N(c,L,Z),G=new ArrayBuffer(R),V=new DataView(G),p=0,J=0,z=-1;L.length>0&&(z=L[0]._offset);for(var i,t=0,E=0,x=0,q=c.length;x<q;x++)if(V.setUint8(J+x,c[x]),x+1===z){if(t=(i=L[p])._length,E=J+z,i._bin)for(var O=new Uint8Array(i._bin),w=0;w<t;w++)V.setUint8(E+w,O[w]);else i._str?k(V,E,i._str):void 0!==i._float&&V.setFloat64(E,i._float);J+=t,L[++p]&&(z=L[p]._offset)}return G}},11897:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(Z){}getState(){return null}patch(Z){}teardown(){}handshake(Z){}}},11895:(Z,c,L)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const k=L(11880);c.SchemaSerializer=class{setState(Z){return this.state.decode(Z)}getState(){return this.state}patch(Z){return this.state.decode(Z)}teardown(){var Z,c;null===(c=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===c||c.root.clearRefs()}handshake(Z,c){if(this.state){(new k.Reflection).decode(Z,c)}else this.state=k.Reflection.decode(Z,c)}}},11867:(Z,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const L={};c.registerSerializer=function(Z,c){L[Z]=c},c.getSerializer=function(Z){const c=L[Z];if(!c)throw new Error("missing serializer: "+Z);return c}},11843:function(Z,c,L){"use strict";var k=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const N=k(L(11849)),R=globalThis.WebSocket||N.default;c.WebSocketTransport=class{constructor(Z){this.events=Z}send(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}connect(Z){this.ws=new R(Z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Z,c){this.ws.close(Z,c)}get isOpen(){return this.ws.readyState===R.OPEN}}},11849:Z=>{"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12267:Z=>{"use strict";Z.exports=function(Z){for(var c=new Array(Z),L=0;L<Z;++L)c[L]=L;return c}},12271:Z=>{function c(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(c(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&c(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},12264:(Z,c,L)=>{var k=L(12267),N=L(12271),R="undefined"!==typeof Float64Array;function G(Z,c){return Z[0]-c[0]}function V(){var Z,c=this.stride,L=new Array(c.length);for(Z=0;Z<L.length;++Z)L[Z]=[Math.abs(c[Z]),Z];L.sort(G);var k=new Array(L.length);for(Z=0;Z<k.length;++Z)k[Z]=L[Z][1];return k}function p(Z,c){var L=["View",c,"d",Z].join("");c<0&&(L="View_Nil"+Z);var N="generic"===Z;if(-1===c){var R="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(R)()}if(0===c){R="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",R)(J[Z][0])}R=["'use strict'"];var G=k(c),p=G.map((function(Z){return"i"+Z})),z="this.offset+"+G.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),i=G.map((function(Z){return"b"+Z})).join(","),t=G.map((function(Z){return"c"+Z})).join(",");R.push("function "+L+"(a,"+i+","+t+",d){this.data=a","this.shape=["+i+"]","this.stride=["+t+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+Z+"'","proto.dimension="+c),R.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+G.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===c?R.push("proto.order=[0]"):(R.push("Object.defineProperty(proto,'order',{get:"),c<4?(R.push("function "+L+"_order(){"),2===c?R.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&R.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):R.push("ORDER})")),R.push("proto.set=function "+L+"_set("+p.join(",")+",v){"),N?R.push("return this.data.set("+z+",v)}"):R.push("return this.data["+z+"]=v}"),R.push("proto.get=function "+L+"_get("+p.join(",")+"){"),N?R.push("return this.data.get("+z+")}"):R.push("return this.data["+z+"]}"),R.push("proto.index=function "+L+"_index(",p.join(),"){return "+z+"}"),R.push("proto.hi=function "+L+"_hi("+p.join(",")+"){return new "+L+"(this.data,"+G.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+G.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var E=G.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),x=G.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));R.push("proto.lo=function "+L+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+x.join(","));for(var q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");R.push("return new "+L+"(this.data,"+G.map((function(Z){return"a"+Z})).join(",")+","+G.map((function(Z){return"c"+Z})).join(",")+",b)}"),R.push("proto.step=function "+L+"_step("+p.join(",")+"){var "+G.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+G.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");R.push("return new "+L+"(this.data,"+G.map((function(Z){return"a"+Z})).join(",")+","+G.map((function(Z){return"b"+Z})).join(",")+",c)}");var O=new Array(c),w=new Array(c);for(q=0;q<c;++q)O[q]="a[i"+q+"]",w[q]="b[i"+q+"]";R.push("proto.transpose=function "+L+"_transpose("+p+"){"+p.map((function(Z,c){return Z+"=("+Z+"===undefined?"+c+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+O.join(",")+","+w.join(",")+",this.offset)}"),R.push("proto.pick=function "+L+"_pick("+p+"){var a=[],b=[],c=this.offset");for(q=0;q<c;++q)R.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return R.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),R.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+G.map((function(Z){return"shape["+Z+"]"})).join(",")+","+G.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",R.join("\n"))(J[Z],V)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,c,L,k){if(void 0===Z)return(0,J.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===c&&(c=[Z.length]);var G=c.length;if(void 0===L){L=new Array(G);for(var V=G-1,z=1;V>=0;--V)L[V]=z,z*=c[V]}if(void 0===k){k=0;for(V=0;V<G;++V)L[V]<0&&(k-=(c[V]-1)*L[V])}for(var i=function(Z){if(N(Z))return"buffer";if(R)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),t=J[i];t.length<=G+1;)t.push(p(i,t.length-1));return(0,t[G+1])(Z,c,L,k)}},13229:Z=>{var c;self,c=()=>(()=>{"use strict";var Z={d:(c,L)=>{for(var k in L)Z.o(L,k)&&!Z.o(c,k)&&Object.defineProperty(c,k,{enumerable:!0,get:L[k]})},o:(Z,c)=>Object.prototype.hasOwnProperty.call(Z,c)},c={};Z.d(c,{default:()=>I});var L,k=function(Z,c){var L=c.x-Z.x,k=c.y-Z.y;return Math.sqrt(L*L+k*k)},N=function(Z){return Z*(Math.PI/180)},R=new Map,G=function(Z){R.has(Z)&&clearTimeout(R.get(Z)),R.set(Z,setTimeout(Z,100))},V=function(Z,c,L){for(var k,N=c.split(/[ ,]+/g),R=0;R<N.length;R+=1)k=N[R],Z.addEventListener?Z.addEventListener(k,L,!1):Z.attachEvent&&Z.attachEvent(k,L)},p=function(Z,c,L){for(var k,N=c.split(/[ ,]+/g),R=0;R<N.length;R+=1)k=N[R],Z.removeEventListener?Z.removeEventListener(k,L):Z.detachEvent&&Z.detachEvent(k,L)},J=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},i=function(Z,c){c.top||c.right||c.bottom||c.left?(Z.style.top=c.top,Z.style.right=c.right,Z.style.bottom=c.bottom,Z.style.left=c.left):(Z.style.left=c.x+"px",Z.style.top=c.y+"px")},t=function(Z,c,L){var k=E(Z);for(var N in k)if(k.hasOwnProperty(N))if("string"==typeof c)k[N]=c+" "+L;else{for(var R="",G=0,V=c.length;G<V;G+=1)R+=c[G]+" "+L+", ";k[N]=R.slice(0,-2)}return k},E=function(Z){var c={};return c[Z]="",["webkit","Moz","o"].forEach((function(L){c[L+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),c},x=function(Z,c){for(var L in c)c.hasOwnProperty(L)&&(Z[L]=c[L]);return Z},q=function(Z,c){if(Z.length)for(var L=0,k=Z.length;L<k;L+=1)c(Z[L]);else c(Z)},O="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,w=window.matchMedia("(any-hover: none)").matches,M=!!("ontouchstart"in window),P=!!window.PointerEvent,j=!!window.MSPointerEvent,o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},u={start:"mousedown",move:"mousemove",end:"mouseup"},X={};function h(){}O&&!w?L=o:P?L={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:j?L={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:M?(L=o,X=u):L=u,h.prototype.on=function(Z,c){var L,k=this,N=Z.split(/[ ,]+/g);k._handlers_=k._handlers_||{};for(var R=0;R<N.length;R+=1)L=N[R],k._handlers_[L]=k._handlers_[L]||[],k._handlers_[L].push(c);return k},h.prototype.off=function(Z,c){var L=this;return L._handlers_=L._handlers_||{},void 0===Z?L._handlers_={}:void 0===c?L._handlers_[Z]=null:L._handlers_[Z]&&L._handlers_[Z].indexOf(c)>=0&&L._handlers_[Z].splice(L._handlers_[Z].indexOf(c),1),L},h.prototype.trigger=function(Z,c){var L,k=this,N=Z.split(/[ ,]+/g);k._handlers_=k._handlers_||{};for(var R=0;R<N.length;R+=1)L=N[R],k._handlers_[L]&&k._handlers_[L].length&&k._handlers_[L].forEach((function(Z){Z.call(k,{type:L,target:k},c)}))},h.prototype.config=function(Z){var c=this;c.options=c.defaults||{},Z&&(c.options=function(Z,c){var L={};for(var k in Z)Z.hasOwnProperty(k)&&c.hasOwnProperty(k)?L[k]=c[k]:Z.hasOwnProperty(k)&&(L[k]=Z[k]);return L}(c.options,Z))},h.prototype.bindEvt=function(Z,c){var k=this;return k._domHandlers_=k._domHandlers_||{},k._domHandlers_[c]=function(){"function"==typeof k["on"+c]?k["on"+c].apply(k,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},V(Z,L[c],k._domHandlers_[c]),X[c]&&V(Z,X[c],k._domHandlers_[c]),k},h.prototype.unbindEvt=function(Z,c){var k=this;return k._domHandlers_=k._domHandlers_||{},p(Z,L[c],k._domHandlers_[c]),X[c]&&p(Z,X[c],k._domHandlers_[c]),delete k._domHandlers_[c],this};const B=h;function D(Z,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=D.id,D.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}D.prototype=new B,D.constructor=D,D.id=0,D.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},D.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",c=function(){var Z=E("borderRadius");for(var c in Z)Z.hasOwnProperty(c)&&(Z[c]="50%");return Z}(),L=t("transition","opacity",Z),k={};return k.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},k.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},k.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},x(k.el,L),"circle"===this.options.shape&&x(k.back,c),x(k.front,c),this.applyStyles(k),this},D.prototype.applyStyles=function(Z){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var L in Z[c])this.ui[c].style[L]=Z[c][L];return this},D.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},D.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},D.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},D.prototype.show=function(Z){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof Z&&Z.call(this)}),c.options.fadeTime)),c},D.prototype.hide=function(Z){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var L="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=L,"function"==typeof Z&&Z.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var L=c.options.restJoystick,k={};k.x=!0===L||!1!==L.x?0:c.instance.frontPosition.x,k.y=!0===L||!1!==L.y?0:c.instance.frontPosition.y,c.setPosition(Z,k)}return c},D.prototype.setPosition=function(Z,c){var L=this;L.frontPosition={x:c.x,y:c.y};var k=L.options.fadeTime+"ms",N={};N.front=t("transition",["transform"],k);var R={front:{}};R.front={transform:"translate("+L.frontPosition.x+"px,"+L.frontPosition.y+"px)"},L.applyStyles(N),L.applyStyles(R),L.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(L),L.restCallback()}),L.options.fadeTime)},D.prototype.restCallback=function(){var Z=this,c={};c.front=t("transition","none",""),Z.applyStyles(c),Z.trigger("rested",Z.instance)},D.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},D.prototype.computeDirection=function(Z){var c,L,k,N=Z.angle.radian,R=Math.PI/4,G=Math.PI/2;if(N>R&&N<3*R&&!Z.lockX?c="up":N>-R&&N<=R&&!Z.lockY?c="left":N>3*-R&&N<=-R&&!Z.lockX?c="down":Z.lockY||(c="right"),Z.lockY||(L=N>-G&&N<G?"left":"right"),Z.lockX||(k=N>0?"up":"down"),Z.force>this.options.threshold){var V,p={};for(V in this.direction)this.direction.hasOwnProperty(V)&&(p[V]=this.direction[V]);var J={};for(V in this.direction={x:L,y:k,angle:c},Z.direction=this.direction,p)p[V]===this.direction[V]&&(J[V]=!0);if(J.x&&J.y&&J.angle)return Z;J.x&&J.y||this.trigger("plain",Z),J.x||this.trigger("plain:"+L,Z),J.y||this.trigger("plain:"+k,Z),J.angle||this.trigger("dir dir:"+c,Z)}else this.resetDirection();return Z};const e=D;function H(Z,c){var L=this;L.nipples=[],L.idles=[],L.actives=[],L.ids=[],L.pressureIntervals={},L.manager=Z,L.id=H.id,H.id+=1,L.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},L.config(c),"static"!==L.options.mode&&"semi"!==L.options.mode||(L.options.multitouch=!1),L.options.multitouch||(L.options.maxNumberOfNipples=1);var k=getComputedStyle(L.options.zone.parentElement);return k&&"flex"===k.display&&(L.parentIsFlex=!0),L.updateBox(),L.prepareNipples(),L.ni(),L.begin(),L.nipples}H.prototype=new B,H.constructor=H,H.id=0,H.prototype.prepareNipples=function(){var Z=this,c=Z.nipples;c.on=Z.on.bind(Z),c.off=Z.off.bind(Z),c.options=Z.options,c.destroy=Z.destroy.bind(Z),c.ids=Z.ids,c.id=Z.id,c.processOnMove=Z.processOnMove.bind(Z),c.processOnEnd=Z.processOnEnd.bind(Z),c.get=function(Z){if(void 0===Z)return c[0];for(var L=0,k=c.length;L<k;L+=1)if(c[L].identifier===Z)return c[L];return!1}},H.prototype.ni=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},H.prototype.begin=function(){var Z=this,c=Z.options;if("static"===c.mode){var L=Z.createNipple(c.position,Z.manager.getIdentifier());L.add(),Z.idles.push(L)}},H.prototype.createNipple=function(Z,c){var L=this,k=L.manager.scroll,N={},R=L.options,G=L.parentIsFlex?k.x:k.x+L.box.left,V=L.parentIsFlex?k.y:k.y+L.box.top;if(Z.x&&Z.y)N={x:Z.x-G,y:Z.y-V};else if(Z.top||Z.right||Z.bottom||Z.left){var p=document.createElement("DIV");p.style.display="hidden",p.style.top=Z.top,p.style.right=Z.right,p.style.bottom=Z.bottom,p.style.left=Z.left,p.style.position="absolute",R.zone.appendChild(p);var J=p.getBoundingClientRect();R.zone.removeChild(p),N=Z,Z={x:J.left+k.x,y:J.top+k.y}}var z=new e(L,{color:R.color,size:R.size,threshold:R.threshold,fadeTime:R.fadeTime,dataOnly:R.dataOnly,restJoystick:R.restJoystick,restOpacity:R.restOpacity,mode:R.mode,identifier:c,position:Z,zone:R.zone,frontPosition:{x:0,y:0},shape:R.shape});return R.dataOnly||(i(z.ui.el,N),i(z.ui.front,z.frontPosition)),L.nipples.push(z),L.trigger("added "+z.identifier+":added",z),L.manager.trigger("added "+z.identifier+":added",z),L.bindNipple(z),z},H.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},H.prototype.bindNipple=function(Z){var c,L=this,k=function(Z,k){c=Z.type+" "+k.id+":"+Z.type,L.trigger(c,k)};Z.on("destroyed",L.onDestroyed.bind(L)),Z.on("shown hidden rested dir plain",k),Z.on("dir:up dir:right dir:down dir:left",k),Z.on("plain:up plain:right plain:down plain:left",k)},H.prototype.pressureFn=function(Z,c,L){var k=this,N=0;clearInterval(k.pressureIntervals[L]),k.pressureIntervals[L]=setInterval(function(){var L=Z.force||Z.pressure||Z.webkitForce||0;L!==N&&(c.trigger("pressure",L),k.trigger("pressure "+c.identifier+":pressure",L),N=L)}.bind(k),100)},H.prototype.onstart=function(Z){var c=this,L=c.options,k=Z;return Z=J(Z),c.updateBox(),q(Z,(function(N){c.actives.length<L.maxNumberOfNipples?c.processOnStart(N):k.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(L){if(Object.values(k.touches).findIndex((function(Z){return Z.identifier===L}))<0){var N=[Z[0]];N.identifier=L,c.processOnEnd(N)}})),c.actives.length<L.maxNumberOfNipples&&c.processOnStart(N))})),c.manager.bindDocument(),!1},H.prototype.processOnStart=function(Z){var c,L=this,N=L.options,R=L.manager.getIdentifier(Z),G=Z.force||Z.pressure||Z.webkitForce||0,V={x:Z.pageX,y:Z.pageY},p=L.getOrCreate(R,V);p.identifier!==R&&L.manager.removeIdentifier(p.identifier),p.identifier=R;var J=function(c){c.trigger("start",c),L.trigger("start "+c.id+":start",c),c.show(),G>0&&L.pressureFn(Z,c,c.identifier),L.processOnMove(Z)};if((c=L.idles.indexOf(p))>=0&&L.idles.splice(c,1),L.actives.push(p),L.ids.push(p.identifier),"semi"!==N.mode)J(p);else{if(!(k(V,p.position)<=N.catchDistance))return p.destroy(),void L.processOnStart(Z);J(p)}return p},H.prototype.getOrCreate=function(Z,c){var L,k=this,N=k.options;return/(semi|static)/.test(N.mode)?(L=k.idles[0])?(k.idles.splice(0,1),L):"semi"===N.mode?k.createNipple(c,Z):(console.warn("Coudln't find the needed nipple."),!1):L=k.createNipple(c,Z)},H.prototype.processOnMove=function(Z){var c=this,L=c.options,R=c.manager.getIdentifier(Z),G=c.nipples.get(R),V=c.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!G)return console.error("Found zombie joystick with ID "+R),void c.manager.removeIdentifier(R);if(L.dynamicPage){var p=G.el.getBoundingClientRect();G.position={x:V.x+p.left,y:V.y+p.top}}G.identifier=R;var J=G.options.size/2,z={x:Z.pageX,y:Z.pageY};L.lockX&&(z.y=G.position.y),L.lockY&&(z.x=G.position.x);var i,t,E,x,q,O,w,M,P,j,o=k(z,G.position),u=(i=z,E=(t=G.position).x-i.x,x=t.y-i.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(x,E))),X=N(u),h=o/J,B={distance:o,position:z};if("circle"===G.options.shape?(q=Math.min(o,J),w=G.position,M=q,j={x:0,y:0},P=N(P=u),j.x=w.x-M*Math.cos(P),j.y=w.y-M*Math.sin(P),O=j):(O=function(Z,c,L){return{x:Math.min(Math.max(Z.x,c.x-L),c.x+L),y:Math.min(Math.max(Z.y,c.y-L),c.y+L)}}(z,G.position,J),q=k(O,G.position)),L.follow){if(o>J){var D=z.x-O.x,e=z.y-O.y;G.position.x+=D,G.position.y+=e,G.el.style.top=G.position.y-(c.box.top+V.y)+"px",G.el.style.left=G.position.x-(c.box.left+V.x)+"px",o=k(z,G.position)}}else z=O,o=q;var H=z.x-G.position.x,l=z.y-G.position.y;G.frontPosition={x:H,y:l},L.dataOnly||(G.ui.front.style.transform="translate("+H+"px,"+l+"px)");var W={identifier:G.identifier,position:z,force:h,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:o,angle:{radian:X,degree:u},vector:{x:H/J,y:-l/J},raw:B,instance:G,lockX:L.lockX,lockY:L.lockY};(W=G.computeDirection(W)).angle={radian:N(180-u),degree:180-u},G.trigger("move",W),c.trigger("move "+G.id+":move",W)}else this.processOnEnd(Z)},H.prototype.processOnEnd=function(Z){var c=this,L=c.options,k=c.manager.getIdentifier(Z),N=c.nipples.get(k),R=c.manager.removeIdentifier(N.identifier);N&&(L.dataOnly||N.hide((function(){"dynamic"===L.mode&&(N.trigger("removed",N),c.trigger("removed "+N.id+":removed",N),c.manager.trigger("removed "+N.id+":removed",N),N.destroy())})),clearInterval(c.pressureIntervals[N.identifier]),N.resetDirection(),N.trigger("end",N),c.trigger("end "+N.id+":end",N),c.ids.indexOf(N.identifier)>=0&&c.ids.splice(c.ids.indexOf(N.identifier),1),c.actives.indexOf(N)>=0&&c.actives.splice(c.actives.indexOf(N),1),/(semi|static)/.test(L.mode)?c.idles.push(N):c.nipples.indexOf(N)>=0&&c.nipples.splice(c.nipples.indexOf(N),1),c.manager.unbindDocument(),/(semi|static)/.test(L.mode)&&(c.manager.ids[R.id]=R.identifier))},H.prototype.onDestroyed=function(Z,c){var L=this;L.nipples.indexOf(c)>=0&&L.nipples.splice(L.nipples.indexOf(c),1),L.actives.indexOf(c)>=0&&L.actives.splice(L.actives.indexOf(c),1),L.idles.indexOf(c)>=0&&L.idles.splice(L.idles.indexOf(c),1),L.ids.indexOf(c.identifier)>=0&&L.ids.splice(L.ids.indexOf(c.identifier),1),L.manager.removeIdentifier(c.identifier),L.manager.unbindDocument()},H.prototype.destroy=function(){var Z=this;for(var c in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(c)&&clearInterval(Z.pressureIntervals[c]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};const l=H;function W(Z){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=z(),c.config(Z),c.prepareCollections();var L=function(){var Z;c.collections.forEach((function(L){L.forEach((function(L){Z=L.el.getBoundingClientRect(),L.position={x:c.scroll.x+Z.left,y:c.scroll.y+Z.top}}))}))};V(window,"resize",(function(){G(L)}));var k=function(){c.scroll=z()};return V(window,"scroll",(function(){G(k)})),c.collections}W.prototype=new B,W.constructor=W,W.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(c){var L;return Z.collections.every((function(Z){return!(L=Z.get(c))})),L}},W.prototype.create=function(Z){return this.createCollection(Z)},W.prototype.createCollection=function(Z){var c=this,L=new l(c,Z);return c.bindCollection(L),c.collections.push(L),L},W.prototype.bindCollection=function(Z){var c,L=this,k=function(Z,k){c=Z.type+" "+k.id+":"+Z.type,L.trigger(c,k)};Z.on("destroyed",L.onDestroyed.bind(L)),Z.on("shown hidden rested dir plain",k),Z.on("dir:up dir:right dir:down dir:left",k),Z.on("plain:up plain:right plain:down plain:left",k)},W.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},W.prototype.unbindDocument=function(Z){var c=this;Object.keys(c.ids).length&&!0!==Z||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},W.prototype.getIdentifier=function(Z){var c;return Z?void 0===(c=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},W.prototype.removeIdentifier=function(Z){var c={};for(var L in this.ids)if(this.ids[L]===Z){c.id=L,c.identifier=this.ids[L],delete this.ids[L];break}return c},W.prototype.onmove=function(Z){return this.onAny("move",Z),!1},W.prototype.onend=function(Z){return this.onAny("end",Z),!1},W.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},W.prototype.onAny=function(Z,c){var L,k=this,N="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);c=J(c);var R=function(Z,c,L){L.ids.indexOf(c)>=0&&(L[N](Z),Z._found_=!0)};return q(c,(function(Z){L=k.getIdentifier(Z),q(k.collections,R.bind(null,Z,L)),Z._found_||k.removeIdentifier(L)})),!1},W.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},W.prototype.onDestroyed=function(Z,c){var L=this;if(L.collections.indexOf(c)<0)return!1;L.collections.splice(L.collections.indexOf(c),1)};var T=new W;const I={create:function(Z){return T.create(Z)},factory:T};return c.default})(),Z.exports=c()},12287:(Z,c,L)=>{"use strict";const{Deflate:k,deflate:N,deflateRaw:R,gzip:G}=L(12293),{Inflate:V,inflate:p,inflateRaw:J,ungzip:z}=L(12348),i=L(12334);Z.exports.Deflate=k,Z.exports.deflate=N,Z.exports.deflateRaw=R,Z.exports.gzip=G,Z.exports.Inflate=V,Z.exports.inflate=p,Z.exports.inflateRaw=J,Z.exports.ungzip=z,Z.exports.constants=i},12293:(Z,c,L)=>{"use strict";const k=L(12297),N=L(12337),R=L(12339),G=L(12329),V=L(12342),p=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:z,Z_FULL_FLUSH:i,Z_FINISH:t,Z_OK:E,Z_STREAM_END:x,Z_DEFAULT_COMPRESSION:q,Z_DEFAULT_STRATEGY:O,Z_DEFLATED:w}=L(12334);function M(Z){this.options=N.assign({level:q,method:w,SZ:16384,windowBits:15,memLevel:8,strategy:O},Z||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.Wc="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let L=k.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(L!==E)throw new Error(G[L]);if(c.header&&k.deflateSetHeader(this.strm,c.header),c.dictionary){let Z;if(Z="string"===typeof c.dictionary?R.string2buf(c.dictionary):"[object ArrayBuffer]"===p.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,L=k.deflateSetDictionary(this.strm,Z),L!==E)throw new Error(G[L]);this._dict_set=!0}}function P(Z,c){const L=new M(c);if(L.push(Z,!0),L.err)throw L.Wc||G[L.err];return L.result}M.prototype.push=function(Z,c){const L=this.strm,N=this.options.SZ;let G,V;if(this.ended)return!1;for(V=c===~~c?c:!0===c?t:J,"string"===typeof Z?L.input=R.string2buf(Z):"[object ArrayBuffer]"===p.call(Z)?L.input=new Uint8Array(Z):L.input=Z,L.next_in=0,L.avail_in=L.input.length;;)if(0===L.avail_out&&(L.output=new Uint8Array(N),L.next_out=0,L.avail_out=N),(V===z||V===i)&&L.avail_out<=6)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else{if(G=k.deflate(L,V),G===x)return L.next_out>0&&this.onData(L.output.subarray(0,L.next_out)),G=k.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===E;if(0!==L.avail_out){if(V>0&&L.next_out>0)this.onData(L.output.subarray(0,L.next_out)),L.avail_out=0;else if(0===L.avail_in)break}else this.onData(L.output)}return!0},M.prototype.onData=function(Z){this.chunks.push(Z)},M.prototype.onEnd=function(Z){Z===E&&(this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.Wc=this.strm.Wc},Z.exports.Deflate=M,Z.exports.deflate=P,Z.exports.deflateRaw=function(Z,c){return(c=c||{}).raw=!0,P(Z,c)},Z.exports.gzip=function(Z,c){return(c=c||{}).gzip=!0,P(Z,c)},Z.exports.constants=L(12334)},12348:(Z,c,L)=>{"use strict";const k=L(12355),N=L(12337),R=L(12339),G=L(12329),V=L(12342),p=L(12371),J=Object.prototype.toString,{Z_NO_FLUSH:z,Z_FINISH:i,Z_OK:t,Z_STREAM_END:E,Z_NEED_DICT:x,Z_STREAM_ERROR:q,Z_DATA_ERROR:O,Z_MEM_ERROR:w}=L(12334);function M(Z){this.options=N.assign({SZ:65536,windowBits:15,to:""},Z||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||Z&&Z.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.Wc="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let L=k.inflateInit2(this.strm,c.windowBits);if(L!==t)throw new Error(G[L]);if(this.header=new p,k.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=R.string2buf(c.dictionary):"[object ArrayBuffer]"===J.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(L=k.inflateSetDictionary(this.strm,c.dictionary),L!==t)))throw new Error(G[L])}function P(Z,c){const L=new M(c);if(L.push(Z),L.err)throw L.Wc||G[L.err];return L.result}M.prototype.push=function(Z,c){const L=this.strm,N=this.options.SZ,G=this.options.dictionary;let V,p,M;if(this.ended)return!1;for(p=c===~~c?c:!0===c?i:z,"[object ArrayBuffer]"===J.call(Z)?L.input=new Uint8Array(Z):L.input=Z,L.next_in=0,L.avail_in=L.input.length;;){for(0===L.avail_out&&(L.output=new Uint8Array(N),L.next_out=0,L.avail_out=N),V=k.inflate(L,p),V===x&&G&&(V=k.inflateSetDictionary(L,G),V===t?V=k.inflate(L,p):V===O&&(V=x));L.avail_in>0&&V===E&&L.state.wrap>0&&0!==Z[L.next_in];)k.inflateReset(L),V=k.inflate(L,p);switch(V){case q:case O:case x:case w:return this.onEnd(V),this.ended=!0,!1}if(M=L.avail_out,L.next_out&&(0===L.avail_out||V===E))if("string"===this.options.to){let Z=R.utf8border(L.output,L.next_out),c=L.next_out-Z,k=R.buf2string(L.output,Z);L.next_out=c,L.avail_out=N-c,c&&L.output.set(L.output.subarray(Z,Z+c),0),this.onData(k)}else this.onData(L.output.length===L.next_out?L.output:L.output.subarray(0,L.next_out));if(V!==t||0!==M){if(V===E)return V=k.inflateEnd(this.strm),this.onEnd(V),this.ended=!0,!0;if(0===L.avail_in)break}}return!0},M.prototype.onData=function(Z){this.chunks.push(Z)},M.prototype.onEnd=function(Z){Z===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.Wc=this.strm.Wc},Z.exports.Inflate=M,Z.exports.inflate=P,Z.exports.inflateRaw=function(Z,c){return(c=c||{}).raw=!0,P(Z,c)},Z.exports.ungzip=P,Z.exports.constants=L(12334)},12337:Z=>{"use strict";const c=(Z,c)=>Object.prototype.hasOwnProperty.call(Z,c);Z.exports.assign=function(Z){const L=Array.prototype.slice.call(arguments,1);for(;L.length;){const k=L.shift();if(k){if("object"!==typeof k)throw new TypeError(k+"must be non-object");for(const L in k)c(k,L)&&(Z[L]=k[L])}}return Z},Z.exports.flattenChunks=Z=>{let c=0;for(let k=0,N=Z.length;k<N;k++)c+=Z[k].length;const L=new Uint8Array(c);for(let k=0,N=0,R=Z.length;k<R;k++){let c=Z[k];L.set(c,N),N+=c.length}return L}},12339:Z=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(k){c=!1}const L=new Uint8Array(256);for(let N=0;N<256;N++)L[N]=N>=252?6:N>=248?5:N>=240?4:N>=224?3:N>=192?2:1;L[254]=L[254]=1,Z.exports.string2buf=Z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);let c,L,k,N,R,G=Z.length,V=0;for(N=0;N<G;N++)L=Z.charCodeAt(N),55296===(64512&L)&&N+1<G&&(k=Z.charCodeAt(N+1),56320===(64512&k)&&(L=65536+(L-55296<<10)+(k-56320),N++)),V+=L<128?1:L<2048?2:L<65536?3:4;for(c=new Uint8Array(V),R=0,N=0;R<V;N++)L=Z.charCodeAt(N),55296===(64512&L)&&N+1<G&&(k=Z.charCodeAt(N+1),56320===(64512&k)&&(L=65536+(L-55296<<10)+(k-56320),N++)),L<128?c[R++]=L:L<2048?(c[R++]=192|L>>>6,c[R++]=128|63&L):L<65536?(c[R++]=224|L>>>12,c[R++]=128|L>>>6&63,c[R++]=128|63&L):(c[R++]=240|L>>>18,c[R++]=128|L>>>12&63,c[R++]=128|L>>>6&63,c[R++]=128|63&L);return c};Z.exports.buf2string=(Z,k)=>{const N=k||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,k));let R,G;const V=new Array(2*N);for(G=0,R=0;R<N;){let c=Z[R++];if(c<128){V[G++]=c;continue}let k=L[c];if(k>4)V[G++]=65533,R+=k-1;else{for(c&=2===k?31:3===k?15:7;k>1&&R<N;)c=c<<6|63&Z[R++],k--;k>1?V[G++]=65533:c<65536?V[G++]=c:(c-=65536,V[G++]=55296|c>>10&1023,V[G++]=56320|1023&c)}}return((Z,L)=>{if(L<65534&&Z.subarray&&c)return String.fromCharCode.apply(null,Z.length===L?Z:Z.subarray(0,L));let k="";for(let c=0;c<L;c++)k+=String.fromCharCode(Z[c]);return k})(V,G)},Z.exports.utf8border=(Z,c)=>{(c=c||Z.length)>Z.length&&(c=Z.length);let k=c-1;for(;k>=0&&128===(192&Z[k]);)k--;return k<0||0===k?c:k+L[Z[k]]>c?k:c}},12313:Z=>{"use strict";Z.exports=(Z,c,L,k)=>{let N=65535&Z,R=Z>>>16&65535,G=0;for(;0!==L;){G=L>2e3?2e3:L,L-=G;do{N=N+c[k++]|0,R=R+N|0}while(--G);N%=65521,R%=65521}return N|R<<16}},12334:Z=>{"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12322:Z=>{"use strict";const c=new Uint32Array((()=>{let Z,c=[];for(var L=0;L<256;L++){Z=L;for(var k=0;k<8;k++)Z=1&Z?3988292384^Z>>>1:Z>>>1;c[L]=Z}return c})());Z.exports=(Z,L,k,N)=>{const R=c,G=N+k;Z^=-1;for(let c=N;c<G;c++)Z=Z>>>8^R[255&(Z^L[c])];return~Z}},12297:(Z,c,L)=>{"use strict";const{_tr_init:k,_tr_stored_block:N,_tr_flush_block:R,_tr_tally:G,_tr_align:V}=L(12306),p=L(12313),J=L(12322),z=L(12329),{Z_NO_FLUSH:i,Z_PARTIAL_FLUSH:t,Z_FULL_FLUSH:E,Z_FINISH:x,Z_BLOCK:q,Z_OK:O,Z_STREAM_END:w,Z_STREAM_ERROR:M,Z_DATA_ERROR:P,Z_BUF_ERROR:j,Z_DEFAULT_COMPRESSION:o,Z_FILTERED:u,Z_HUFFMAN_ONLY:X,Z_RLE:h,Z_FIXED:B,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:e,Z_DEFLATED:H}=L(12334),l=258,W=262,T=103,I=113,d=666,Q=(Z,c)=>(Z.Wc=z[c],c),r=Z=>(Z<<1)-(Z>4?9:0),f=Z=>{let c=Z.length;for(;--c>=0;)Z[c]=0};let S=(Z,c,L)=>(c<<Z.hash_shift^L)&Z.hash_mask;const s=Z=>{const c=Z.state;let L=c.pending;L>Z.avail_out&&(L=Z.avail_out),0!==L&&(Z.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+L),Z.next_out),Z.next_out+=L,c.pending_out+=L,Z.total_out+=L,Z.avail_out-=L,c.pending-=L,0===c.pending&&(c.pending_out=0))},m=(Z,c)=>{R(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,c),Z.block_start=Z.strstart,s(Z.strm)},A=(Z,c)=>{Z.pending_buf[Z.pending++]=c},b=(Z,c)=>{Z.pending_buf[Z.pending++]=c>>>8&255,Z.pending_buf[Z.pending++]=255&c},F=(Z,c,L,k)=>{let N=Z.avail_in;return N>k&&(N=k),0===N?0:(Z.avail_in-=N,c.set(Z.input.subarray(Z.next_in,Z.next_in+N),L),1===Z.state.wrap?Z.adler=p(Z.adler,c,N,L):2===Z.state.wrap&&(Z.adler=J(Z.adler,c,N,L)),Z.next_in+=N,Z.total_in+=N,N)},U=(Z,c)=>{let L,k,N=Z.max_chain_length,R=Z.strstart,G=Z.prev_length,V=Z.nice_match;const p=Z.strstart>Z.w_size-W?Z.strstart-(Z.w_size-W):0,J=Z.window,z=Z.w_mask,i=Z.prev,t=Z.strstart+l;let E=J[R+G-1],x=J[R+G];Z.prev_length>=Z.good_match&&(N>>=2),V>Z.lookahead&&(V=Z.lookahead);do{if(L=c,J[L+G]===x&&J[L+G-1]===E&&J[L]===J[R]&&J[++L]===J[R+1]){R+=2,L++;do{}while(J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&J[++R]===J[++L]&&R<t);if(k=l-(t-R),R=t-l,k>G){if(Z.match_start=c,G=k,k>=V)break;E=J[R+G-1],x=J[R+G]}}}while((c=i[c&z])>p&&0!==--N);return G<=Z.lookahead?G:Z.lookahead},K=Z=>{const c=Z.w_size;let L,k,N,R,G;do{if(R=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=c+(c-W)){Z.window.set(Z.window.subarray(c,c+c),0),Z.match_start-=c,Z.strstart-=c,Z.block_start-=c,k=Z.hash_size,L=k;do{N=Z.head[--L],Z.head[L]=N>=c?N-c:0}while(--k);k=c,L=k;do{N=Z.prev[--L],Z.prev[L]=N>=c?N-c:0}while(--k);R+=c}if(0===Z.strm.avail_in)break;if(k=F(Z.strm,Z.window,Z.strstart+Z.lookahead,R),Z.lookahead+=k,Z.lookahead+Z.insert>=3)for(G=Z.strstart-Z.insert,Z.ins_h=Z.window[G],Z.ins_h=S(Z,Z.ins_h,Z.window[G+1]);Z.insert&&(Z.ins_h=S(Z,Z.ins_h,Z.window[G+3-1]),Z.prev[G&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=G,G++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<W&&0!==Z.strm.avail_in)},n=(Z,c)=>{let L,k;for(;;){if(Z.lookahead<W){if(K(Z),Z.lookahead<W&&c===i)return 1;if(0===Z.lookahead)break}if(L=0,Z.lookahead>=3&&(Z.ins_h=S(Z,Z.ins_h,Z.window[Z.strstart+3-1]),L=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==L&&Z.strstart-L<=Z.w_size-W&&(Z.match_length=U(Z,L)),Z.match_length>=3)if(k=G(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=S(Z,Z.ins_h,Z.window[Z.strstart+3-1]),L=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=S(Z,Z.ins_h,Z.window[Z.strstart+1]);else k=G(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(k&&(m(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,c===x?(m(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(m(Z,!1),0===Z.strm.avail_out)?1:2},g=(Z,c)=>{let L,k,N;for(;;){if(Z.lookahead<W){if(K(Z),Z.lookahead<W&&c===i)return 1;if(0===Z.lookahead)break}if(L=0,Z.lookahead>=3&&(Z.ins_h=S(Z,Z.ins_h,Z.window[Z.strstart+3-1]),L=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==L&&Z.prev_length<Z.max_lazy_match&&Z.strstart-L<=Z.w_size-W&&(Z.match_length=U(Z,L),Z.match_length<=5&&(Z.strategy===u||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){N=Z.strstart+Z.lookahead-3,k=G(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=N&&(Z.ins_h=S(Z,Z.ins_h,Z.window[Z.strstart+3-1]),L=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,k&&(m(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if(k=G(Z,0,Z.window[Z.strstart-1]),k&&m(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(k=G(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,c===x?(m(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(m(Z,!1),0===Z.strm.avail_out)?1:2};function y(Z,c,L,k,N){this.good_length=Z,this.max_lazy=c,this.nice_length=L,this.max_chain=k,this.func=N}const v=[new y(0,0,0,0,((Z,c)=>{let L=65535;for(L>Z.pending_buf_size-5&&(L=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(K(Z),0===Z.lookahead&&c===i)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;const k=Z.block_start+L;if((0===Z.strstart||Z.strstart>=k)&&(Z.lookahead=Z.strstart-k,Z.strstart=k,m(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-W&&(m(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,c===x?(m(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(m(Z,!1),Z.strm.avail_out),1)})),new y(4,4,8,4,n),new y(4,5,16,8,n),new y(4,6,32,32,n),new y(4,4,16,16,g),new y(8,16,32,32,g),new y(8,16,128,128,g),new y(8,32,128,256,g),new y(32,128,258,1024,g),new y(32,258,258,4096,g)];function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=H,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=Z=>{if(!Z||!Z.state)return Q(Z,M);Z.total_in=Z.total_out=0,Z.data_type=e;const c=Z.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:I,Z.adler=2===c.wrap?0:1,c.last_flush=i,k(c),O},C=Z=>{const c=a(Z);var L;return c===O&&((L=Z.state).window_size=2*L.w_size,f(L.head),L.max_lazy_match=v[L.level].max_lazy,L.good_match=v[L.level].good_length,L.nice_match=v[L.level].nice_length,L.max_chain_length=v[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=2,L.match_available=0,L.ins_h=0),c},ZZ=(Z,c,L,k,N,R)=>{if(!Z)return M;let G=1;if(c===o&&(c=6),k<0?(G=0,k=-k):k>15&&(G=2,k-=16),N<1||N>9||L!==H||k<8||k>15||c<0||c>9||R<0||R>B)return Q(Z,M);8===k&&(k=9);const V=new Y;return Z.state=V,V.strm=Z,V.wrap=G,V.gzhead=null,V.w_bits=k,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=N+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+3-1)/3),V.window=new Uint8Array(2*V.w_size),V.head=new Uint16Array(V.hash_size),V.prev=new Uint16Array(V.w_size),V.lit_bufsize=1<<N+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new Uint8Array(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=c,V.strategy=R,V.method=L,C(Z)};Z.exports.deflateInit=(Z,c)=>ZZ(Z,c,H,15,8,D),Z.exports.deflateInit2=ZZ,Z.exports.deflateReset=C,Z.exports.deflateResetKeep=a,Z.exports.deflateSetHeader=(Z,c)=>Z&&Z.state?2!==Z.state.wrap?M:(Z.state.gzhead=c,O):M,Z.exports.deflate=(Z,c)=>{let L,k;if(!Z||!Z.state||c>q||c<0)return Z?Q(Z,M):M;const R=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||R.status===d&&c!==x)return Q(Z,0===Z.avail_out?j:M);R.strm=Z;const p=R.last_flush;if(R.last_flush=c,42===R.status)if(2===R.wrap)Z.adler=0,A(R,31),A(R,139),A(R,8),R.gzhead?(A(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),A(R,255&R.gzhead.time),A(R,R.gzhead.time>>8&255),A(R,R.gzhead.time>>16&255),A(R,R.gzhead.time>>24&255),A(R,9===R.level?2:R.strategy>=X||R.level<2?4:0),A(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(A(R,255&R.gzhead.extra.length),A(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(Z.adler=J(Z.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(A(R,0),A(R,0),A(R,0),A(R,0),A(R,0),A(R,9===R.level?2:R.strategy>=X||R.level<2?4:0),A(R,3),R.status=I);else{let c=H+(R.w_bits-8<<4)<<8,L=-1;L=R.strategy>=X||R.level<2?0:R.level<6?1:6===R.level?2:3,c|=L<<6,0!==R.strstart&&(c|=32),c+=31-c%31,R.status=I,b(R,c),0!==R.strstart&&(b(R,Z.adler>>>16),b(R,65535&Z.adler)),Z.adler=1}if(69===R.status)if(R.gzhead.extra){for(L=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),s(Z),L=R.pending,R.pending!==R.pending_buf_size));)A(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(73===R.status)if(R.gzhead.name){L=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),s(Z),L=R.pending,R.pending===R.pending_buf_size)){k=1;break}k=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,A(R,k)}while(0!==k);R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),0===k&&(R.gzindex=0,R.status=91)}else R.status=91;if(91===R.status)if(R.gzhead.comment){L=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),s(Z),L=R.pending,R.pending===R.pending_buf_size)){k=1;break}k=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,A(R,k)}while(0!==k);R.gzhead.hcrc&&R.pending>L&&(Z.adler=J(Z.adler,R.pending_buf,R.pending-L,L)),0===k&&(R.status=T)}else R.status=T;if(R.status===T&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&s(Z),R.pending+2<=R.pending_buf_size&&(A(R,255&Z.adler),A(R,Z.adler>>8&255),Z.adler=0,R.status=I)):R.status=I),0!==R.pending){if(s(Z),0===Z.avail_out)return R.last_flush=-1,O}else if(0===Z.avail_in&&r(c)<=r(p)&&c!==x)return Q(Z,j);if(R.status===d&&0!==Z.avail_in)return Q(Z,j);if(0!==Z.avail_in||0!==R.lookahead||c!==i&&R.status!==d){let L=R.strategy===X?((Z,c)=>{let L;for(;;){if(0===Z.lookahead&&(K(Z),0===Z.lookahead)){if(c===i)return 1;break}if(Z.match_length=0,L=G(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,L&&(m(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,c===x?(m(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(m(Z,!1),0===Z.strm.avail_out)?1:2})(R,c):R.strategy===h?((Z,c)=>{let L,k,N,R;const V=Z.window;for(;;){if(Z.lookahead<=l){if(K(Z),Z.lookahead<=l&&c===i)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(N=Z.strstart-1,k=V[N],k===V[++N]&&k===V[++N]&&k===V[++N])){R=Z.strstart+l;do{}while(k===V[++N]&&k===V[++N]&&k===V[++N]&&k===V[++N]&&k===V[++N]&&k===V[++N]&&k===V[++N]&&k===V[++N]&&N<R);Z.match_length=l-(R-N),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(L=G(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(L=G(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),L&&(m(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,c===x?(m(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(m(Z,!1),0===Z.strm.avail_out)?1:2})(R,c):v[R.level].func(R,c);if(3!==L&&4!==L||(R.status=d),1===L||3===L)return 0===Z.avail_out&&(R.last_flush=-1),O;if(2===L&&(c===t?V(R):c!==q&&(N(R,0,0,!1),c===E&&(f(R.head),0===R.lookahead&&(R.strstart=0,R.block_start=0,R.insert=0))),s(Z),0===Z.avail_out))return R.last_flush=-1,O}return c!==x?O:R.wrap<=0?w:(2===R.wrap?(A(R,255&Z.adler),A(R,Z.adler>>8&255),A(R,Z.adler>>16&255),A(R,Z.adler>>24&255),A(R,255&Z.total_in),A(R,Z.total_in>>8&255),A(R,Z.total_in>>16&255),A(R,Z.total_in>>24&255)):(b(R,Z.adler>>>16),b(R,65535&Z.adler)),s(Z),R.wrap>0&&(R.wrap=-R.wrap),0!==R.pending?O:w)},Z.exports.deflateEnd=Z=>{if(!Z||!Z.state)return M;const c=Z.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==T&&c!==I&&c!==d?Q(Z,M):(Z.state=null,c===I?Q(Z,P):O)},Z.exports.deflateSetDictionary=(Z,c)=>{let L=c.length;if(!Z||!Z.state)return M;const k=Z.state,N=k.wrap;if(2===N||1===N&&42!==k.status||k.lookahead)return M;if(1===N&&(Z.adler=p(Z.adler,c,L,0)),k.wrap=0,L>=k.w_size){0===N&&(f(k.head),k.strstart=0,k.block_start=0,k.insert=0);let Z=new Uint8Array(k.w_size);Z.set(c.subarray(L-k.w_size,L),0),c=Z,L=k.w_size}const R=Z.avail_in,G=Z.next_in,V=Z.input;for(Z.avail_in=L,Z.next_in=0,Z.input=c,K(k);k.lookahead>=3;){let Z=k.strstart,c=k.lookahead-2;do{k.ins_h=S(k,k.ins_h,k.window[Z+3-1]),k.prev[Z&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=Z,Z++}while(--c);k.strstart=Z,k.lookahead=2,K(k)}return k.strstart+=k.lookahead,k.block_start=k.strstart,k.insert=k.lookahead,k.lookahead=0,k.match_length=k.prev_length=2,k.match_available=0,Z.next_in=G,Z.input=V,Z.avail_in=R,k.wrap=N,O},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},12371:Z=>{"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12360:Z=>{"use strict";Z.exports=function(Z,c){let L,k,N,R,G,V,p,J,z,i,t,E,x,q,O,w,M,P,j,o,u,X,h,B;const D=Z.state;L=Z.next_in,h=Z.input,k=L+(Z.avail_in-5),N=Z.next_out,B=Z.output,R=N-(c-Z.avail_out),G=N+(Z.avail_out-257),V=D.dmax,p=D.wsize,J=D.whave,z=D.wnext,i=D.window,t=D.hold,E=D.bits,x=D.lencode,q=D.distcode,O=(1<<D.lenbits)-1,w=(1<<D.distbits)-1;Z:do{E<15&&(t+=h[L++]<<E,E+=8,t+=h[L++]<<E,E+=8),M=x[t&O];c:for(;;){if(P=M>>>24,t>>>=P,E-=P,P=M>>>16&255,0===P)B[N++]=65535&M;else{if(!(16&P)){if(0===(64&P)){M=x[(65535&M)+(t&(1<<P)-1)];continue c}if(32&P){D.mode=12;break Z}Z.Wc="invalid literal/length code",D.mode=30;break Z}j=65535&M,P&=15,P&&(E<P&&(t+=h[L++]<<E,E+=8),j+=t&(1<<P)-1,t>>>=P,E-=P),E<15&&(t+=h[L++]<<E,E+=8,t+=h[L++]<<E,E+=8),M=q[t&w];L:for(;;){if(P=M>>>24,t>>>=P,E-=P,P=M>>>16&255,!(16&P)){if(0===(64&P)){M=q[(65535&M)+(t&(1<<P)-1)];continue L}Z.Wc="invalid distance code",D.mode=30;break Z}if(o=65535&M,P&=15,E<P&&(t+=h[L++]<<E,E+=8,E<P&&(t+=h[L++]<<E,E+=8)),o+=t&(1<<P)-1,o>V){Z.Wc="invalid distance too far back",D.mode=30;break Z}if(t>>>=P,E-=P,P=N-R,o>P){if(P=o-P,P>J&&D.sane){Z.Wc="invalid distance too far back",D.mode=30;break Z}if(u=0,X=i,0===z){if(u+=p-P,P<j){j-=P;do{B[N++]=i[u++]}while(--P);u=N-o,X=B}}else if(z<P){if(u+=p+z-P,P-=z,P<j){j-=P;do{B[N++]=i[u++]}while(--P);if(u=0,z<j){P=z,j-=P;do{B[N++]=i[u++]}while(--P);u=N-o,X=B}}}else if(u+=z-P,P<j){j-=P;do{B[N++]=i[u++]}while(--P);u=N-o,X=B}for(;j>2;)B[N++]=X[u++],B[N++]=X[u++],B[N++]=X[u++],j-=3;j&&(B[N++]=X[u++],j>1&&(B[N++]=X[u++]))}else{u=N-o;do{B[N++]=B[u++],B[N++]=B[u++],B[N++]=B[u++],j-=3}while(j>2);j&&(B[N++]=B[u++],j>1&&(B[N++]=B[u++]))}break}}break}}while(L<k&&N<G);j=E>>3,L-=j,E-=j<<3,t&=(1<<E)-1,Z.next_in=L,Z.next_out=N,Z.avail_in=L<k?k-L+5:5-(L-k),Z.avail_out=N<G?G-N+257:257-(N-G),D.hold=t,D.bits=E}},12355:(Z,c,L)=>{"use strict";const k=L(12313),N=L(12322),R=L(12360),G=L(12364),{Z_FINISH:V,Z_BLOCK:p,Z_TREES:J,Z_OK:z,Z_STREAM_END:i,Z_NEED_DICT:t,Z_STREAM_ERROR:E,Z_DATA_ERROR:x,Z_MEM_ERROR:q,Z_BUF_ERROR:O,Z_DEFLATED:w}=L(12334),M=12,P=30,j=Z=>(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24);function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const u=Z=>{if(!Z||!Z.state)return E;const c=Z.state;return Z.total_in=Z.total_out=c.total=0,Z.Wc="",c.wrap&&(Z.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,z},X=Z=>{if(!Z||!Z.state)return E;const c=Z.state;return c.wsize=0,c.whave=0,c.wnext=0,u(Z)},h=(Z,c)=>{let L;if(!Z||!Z.state)return E;const k=Z.state;return c<0?(L=0,c=-c):(L=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?E:(null!==k.window&&k.wbits!==c&&(k.window=null),k.wrap=L,k.wbits=c,X(Z))},B=(Z,c)=>{if(!Z)return E;const L=new o;Z.state=L,L.window=null;const k=h(Z,c);return k!==z&&(Z.state=null),k};let D,e,H=!0;const l=Z=>{if(H){D=new Int32Array(512),e=new Int32Array(32);let c=0;for(;c<144;)Z.lens[c++]=8;for(;c<256;)Z.lens[c++]=9;for(;c<280;)Z.lens[c++]=7;for(;c<288;)Z.lens[c++]=8;for(G(1,Z.lens,0,288,D,0,Z.work,{bits:9}),c=0;c<32;)Z.lens[c++]=5;G(2,Z.lens,0,32,e,0,Z.work,{bits:5}),H=!1}Z.lencode=D,Z.lenbits=9,Z.distcode=e,Z.distbits=5},W=(Z,c,L,k)=>{let N;const R=Z.state;return null===R.window&&(R.wsize=1<<R.wbits,R.wnext=0,R.whave=0,R.window=new Uint8Array(R.wsize)),k>=R.wsize?(R.window.set(c.subarray(L-R.wsize,L),0),R.wnext=0,R.whave=R.wsize):(N=R.wsize-R.wnext,N>k&&(N=k),R.window.set(c.subarray(L-k,L-k+N),R.wnext),(k-=N)?(R.window.set(c.subarray(L-k,L),0),R.wnext=k,R.whave=R.wsize):(R.wnext+=N,R.wnext===R.wsize&&(R.wnext=0),R.whave<R.wsize&&(R.whave+=N))),0};Z.exports.inflateReset=X,Z.exports.inflateReset2=h,Z.exports.inflateResetKeep=u,Z.exports.inflateInit=Z=>B(Z,15),Z.exports.inflateInit2=B,Z.exports.inflate=(Z,c)=>{let L,o,u,X,h,B,D,e,H,T,I,d,Q,r,f,S,s,m,A,b,F,U,K=0;const n=new Uint8Array(4);let g,y;const v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return E;L=Z.state,L.mode===M&&(L.mode=13),h=Z.next_out,u=Z.output,D=Z.avail_out,X=Z.next_in,o=Z.input,B=Z.avail_in,e=L.hold,H=L.bits,T=B,I=D,U=z;Z:for(;;)switch(L.mode){case 1:if(0===L.wrap){L.mode=13;break}for(;H<16;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(2&L.wrap&&35615===e){L.check=0,n[0]=255&e,n[1]=e>>>8&255,L.check=N(L.check,n,2,0),e=0,H=0,L.mode=2;break}if(L.flags=0,L.head&&(L.head.done=!1),!(1&L.wrap)||(((255&e)<<8)+(e>>8))%31){Z.Wc="incorrect header check",L.mode=P;break}if((15&e)!==w){Z.Wc="unknown compression method",L.mode=P;break}if(e>>>=4,H-=4,F=8+(15&e),0===L.wbits)L.wbits=F;else if(F>L.wbits){Z.Wc="invalid window size",L.mode=P;break}L.dmax=1<<L.wbits,Z.adler=L.check=1,L.mode=512&e?10:M,e=0,H=0;break;case 2:for(;H<16;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(L.flags=e,(255&L.flags)!==w){Z.Wc="unknown compression method",L.mode=P;break}if(57344&L.flags){Z.Wc="unknown header flags set",L.mode=P;break}L.head&&(L.head.text=e>>8&1),512&L.flags&&(n[0]=255&e,n[1]=e>>>8&255,L.check=N(L.check,n,2,0)),e=0,H=0,L.mode=3;case 3:for(;H<32;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.head&&(L.head.time=e),512&L.flags&&(n[0]=255&e,n[1]=e>>>8&255,n[2]=e>>>16&255,n[3]=e>>>24&255,L.check=N(L.check,n,4,0)),e=0,H=0,L.mode=4;case 4:for(;H<16;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.head&&(L.head.xflags=255&e,L.head.os=e>>8),512&L.flags&&(n[0]=255&e,n[1]=e>>>8&255,L.check=N(L.check,n,2,0)),e=0,H=0,L.mode=5;case 5:if(1024&L.flags){for(;H<16;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.length=e,L.head&&(L.head.extra_len=e),512&L.flags&&(n[0]=255&e,n[1]=e>>>8&255,L.check=N(L.check,n,2,0)),e=0,H=0}else L.head&&(L.head.extra=null);L.mode=6;case 6:if(1024&L.flags&&(d=L.length,d>B&&(d=B),d&&(L.head&&(F=L.head.extra_len-L.length,L.head.extra||(L.head.extra=new Uint8Array(L.head.extra_len)),L.head.extra.set(o.subarray(X,X+d),F)),512&L.flags&&(L.check=N(L.check,o,d,X)),B-=d,X+=d,L.length-=d),L.length))break Z;L.length=0,L.mode=7;case 7:if(2048&L.flags){if(0===B)break Z;d=0;do{F=o[X+d++],L.head&&F&&L.length<65536&&(L.head.name+=String.fromCharCode(F))}while(F&&d<B);if(512&L.flags&&(L.check=N(L.check,o,d,X)),B-=d,X+=d,F)break Z}else L.head&&(L.head.name=null);L.length=0,L.mode=8;case 8:if(4096&L.flags){if(0===B)break Z;d=0;do{F=o[X+d++],L.head&&F&&L.length<65536&&(L.head.comment+=String.fromCharCode(F))}while(F&&d<B);if(512&L.flags&&(L.check=N(L.check,o,d,X)),B-=d,X+=d,F)break Z}else L.head&&(L.head.comment=null);L.mode=9;case 9:if(512&L.flags){for(;H<16;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(e!==(65535&L.check)){Z.Wc="header crc mismatch",L.mode=P;break}e=0,H=0}L.head&&(L.head.hcrc=L.flags>>9&1,L.head.done=!0),Z.adler=L.check=0,L.mode=M;break;case 10:for(;H<32;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}Z.adler=L.check=j(e),e=0,H=0,L.mode=11;case 11:if(0===L.havedict)return Z.next_out=h,Z.avail_out=D,Z.next_in=X,Z.avail_in=B,L.hold=e,L.bits=H,t;Z.adler=L.check=1,L.mode=M;case M:if(c===p||c===J)break Z;case 13:if(L.last){e>>>=7&H,H-=7&H,L.mode=27;break}for(;H<3;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}switch(L.last=1&e,e>>>=1,H-=1,3&e){case 0:L.mode=14;break;case 1:if(l(L),L.mode=20,c===J){e>>>=2,H-=2;break Z}break;case 2:L.mode=17;break;case 3:Z.Wc="invalid block type",L.mode=P}e>>>=2,H-=2;break;case 14:for(e>>>=7&H,H-=7&H;H<32;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if((65535&e)!==(e>>>16^65535)){Z.Wc="invalid stored block lengths",L.mode=P;break}if(L.length=65535&e,e=0,H=0,L.mode=15,c===J)break Z;case 15:L.mode=16;case 16:if(d=L.length,d){if(d>B&&(d=B),d>D&&(d=D),0===d)break Z;u.set(o.subarray(X,X+d),h),B-=d,X+=d,D-=d,h+=d,L.length-=d;break}L.mode=M;break;case 17:for(;H<14;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(L.nlen=257+(31&e),e>>>=5,H-=5,L.ndist=1+(31&e),e>>>=5,H-=5,L.ncode=4+(15&e),e>>>=4,H-=4,L.nlen>286||L.ndist>30){Z.Wc="too many length or distance symbols",L.mode=P;break}L.have=0,L.mode=18;case 18:for(;L.have<L.ncode;){for(;H<3;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.lens[v[L.have++]]=7&e,e>>>=3,H-=3}for(;L.have<19;)L.lens[v[L.have++]]=0;if(L.lencode=L.lendyn,L.lenbits=7,g={bits:L.lenbits},U=G(0,L.lens,0,19,L.lencode,0,L.work,g),L.lenbits=g.bits,U){Z.Wc="invalid code lengths set",L.mode=P;break}L.have=0,L.mode=19;case 19:for(;L.have<L.nlen+L.ndist;){for(;K=L.lencode[e&(1<<L.lenbits)-1],f=K>>>24,S=K>>>16&255,s=65535&K,!(f<=H);){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(s<16)e>>>=f,H-=f,L.lens[L.have++]=s;else{if(16===s){for(y=f+2;H<y;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(e>>>=f,H-=f,0===L.have){Z.Wc="invalid bit length repeat",L.mode=P;break}F=L.lens[L.have-1],d=3+(3&e),e>>>=2,H-=2}else if(17===s){for(y=f+3;H<y;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}e>>>=f,H-=f,F=0,d=3+(7&e),e>>>=3,H-=3}else{for(y=f+7;H<y;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}e>>>=f,H-=f,F=0,d=11+(127&e),e>>>=7,H-=7}if(L.have+d>L.nlen+L.ndist){Z.Wc="invalid bit length repeat",L.mode=P;break}for(;d--;)L.lens[L.have++]=F}}if(L.mode===P)break;if(0===L.lens[256]){Z.Wc="invalid code -- missing end-of-block",L.mode=P;break}if(L.lenbits=9,g={bits:L.lenbits},U=G(1,L.lens,0,L.nlen,L.lencode,0,L.work,g),L.lenbits=g.bits,U){Z.Wc="invalid literal/lengths set",L.mode=P;break}if(L.distbits=6,L.distcode=L.distdyn,g={bits:L.distbits},U=G(2,L.lens,L.nlen,L.ndist,L.distcode,0,L.work,g),L.distbits=g.bits,U){Z.Wc="invalid distances set",L.mode=P;break}if(L.mode=20,c===J)break Z;case 20:L.mode=21;case 21:if(B>=6&&D>=258){Z.next_out=h,Z.avail_out=D,Z.next_in=X,Z.avail_in=B,L.hold=e,L.bits=H,R(Z,I),h=Z.next_out,u=Z.output,D=Z.avail_out,X=Z.next_in,o=Z.input,B=Z.avail_in,e=L.hold,H=L.bits,L.mode===M&&(L.back=-1);break}for(L.back=0;K=L.lencode[e&(1<<L.lenbits)-1],f=K>>>24,S=K>>>16&255,s=65535&K,!(f<=H);){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(S&&0===(240&S)){for(m=f,A=S,b=s;K=L.lencode[b+((e&(1<<m+A)-1)>>m)],f=K>>>24,S=K>>>16&255,s=65535&K,!(m+f<=H);){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}e>>>=m,H-=m,L.back+=m}if(e>>>=f,H-=f,L.back+=f,L.length=s,0===S){L.mode=26;break}if(32&S){L.back=-1,L.mode=M;break}if(64&S){Z.Wc="invalid literal/length code",L.mode=P;break}L.extra=15&S,L.mode=22;case 22:if(L.extra){for(y=L.extra;H<y;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.length+=e&(1<<L.extra)-1,e>>>=L.extra,H-=L.extra,L.back+=L.extra}L.was=L.length,L.mode=23;case 23:for(;K=L.distcode[e&(1<<L.distbits)-1],f=K>>>24,S=K>>>16&255,s=65535&K,!(f<=H);){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(0===(240&S)){for(m=f,A=S,b=s;K=L.distcode[b+((e&(1<<m+A)-1)>>m)],f=K>>>24,S=K>>>16&255,s=65535&K,!(m+f<=H);){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}e>>>=m,H-=m,L.back+=m}if(e>>>=f,H-=f,L.back+=f,64&S){Z.Wc="invalid distance code",L.mode=P;break}L.offset=s,L.extra=15&S,L.mode=24;case 24:if(L.extra){for(y=L.extra;H<y;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}L.offset+=e&(1<<L.extra)-1,e>>>=L.extra,H-=L.extra,L.back+=L.extra}if(L.offset>L.dmax){Z.Wc="invalid distance too far back",L.mode=P;break}L.mode=25;case 25:if(0===D)break Z;if(d=I-D,L.offset>d){if(d=L.offset-d,d>L.whave&&L.sane){Z.Wc="invalid distance too far back",L.mode=P;break}d>L.wnext?(d-=L.wnext,Q=L.wsize-d):Q=L.wnext-d,d>L.length&&(d=L.length),r=L.window}else r=u,Q=h-L.offset,d=L.length;d>D&&(d=D),D-=d,L.length-=d;do{u[h++]=r[Q++]}while(--d);0===L.length&&(L.mode=21);break;case 26:if(0===D)break Z;u[h++]=L.length,D--,L.mode=21;break;case 27:if(L.wrap){for(;H<32;){if(0===B)break Z;B--,e|=o[X++]<<H,H+=8}if(I-=D,Z.total_out+=I,L.total+=I,I&&(Z.adler=L.check=L.flags?N(L.check,u,I,h-I):k(L.check,u,I,h-I)),I=D,(L.flags?e:j(e))!==L.check){Z.Wc="incorrect data check",L.mode=P;break}e=0,H=0}L.mode=28;case 28:if(L.wrap&&L.flags){for(;H<32;){if(0===B)break Z;B--,e+=o[X++]<<H,H+=8}if(e!==(4294967295&L.total)){Z.Wc="incorrect length check",L.mode=P;break}e=0,H=0}L.mode=29;case 29:U=i;break Z;case P:U=x;break Z;case 31:return q;default:return E}return Z.next_out=h,Z.avail_out=D,Z.next_in=X,Z.avail_in=B,L.hold=e,L.bits=H,(L.wsize||I!==Z.avail_out&&L.mode<P&&(L.mode<27||c!==V))&&W(Z,Z.output,Z.next_out,I-Z.avail_out)?(L.mode=31,q):(T-=Z.avail_in,I-=Z.avail_out,Z.total_in+=T,Z.total_out+=I,L.total+=I,L.wrap&&I&&(Z.adler=L.check=L.flags?N(L.check,u,I,Z.next_out-I):k(L.check,u,I,Z.next_out-I)),Z.data_type=L.bits+(L.last?64:0)+(L.mode===M?128:0)+(20===L.mode||15===L.mode?256:0),(0===T&&0===I||c===V)&&U===z&&(U=O),U)},Z.exports.inflateEnd=Z=>{if(!Z||!Z.state)return E;let c=Z.state;return c.window&&(c.window=null),Z.state=null,z},Z.exports.inflateGetHeader=(Z,c)=>{if(!Z||!Z.state)return E;const L=Z.state;return 0===(2&L.wrap)?E:(L.head=c,c.done=!1,z)},Z.exports.inflateSetDictionary=(Z,c)=>{const L=c.length;let N,R,G;return Z&&Z.state?(N=Z.state,0!==N.wrap&&11!==N.mode?E:11===N.mode&&(R=1,R=k(R,c,L,0),R!==N.check)?x:(G=W(Z,c,L,L),G?(N.mode=31,q):(N.havedict=1,z))):E},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},12364:Z=>{"use strict";const c=15,L=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),k=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),R=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=(Z,G,V,p,J,z,i,t)=>{const E=t.bits;let x,q,O,w,M,P,j=0,o=0,u=0,X=0,h=0,B=0,D=0,e=0,H=0,l=0,W=null,T=0;const I=new Uint16Array(16),d=new Uint16Array(16);let Q,r,f,S=null,s=0;for(j=0;j<=c;j++)I[j]=0;for(o=0;o<p;o++)I[G[V+o]]++;for(h=E,X=c;X>=1&&0===I[X];X--);if(h>X&&(h=X),0===X)return J[z++]=20971520,J[z++]=20971520,t.bits=1,0;for(u=1;u<X&&0===I[u];u++);for(h<u&&(h=u),e=1,j=1;j<=c;j++)if(e<<=1,e-=I[j],e<0)return-1;if(e>0&&(0===Z||1!==X))return-1;for(d[1]=0,j=1;j<c;j++)d[j+1]=d[j]+I[j];for(o=0;o<p;o++)0!==G[V+o]&&(i[d[G[V+o]]++]=o);if(0===Z?(W=S=i,P=19):1===Z?(W=L,T-=257,S=k,s-=257,P=256):(W=N,S=R,P=-1),l=0,o=0,j=u,M=z,B=h,D=0,O=-1,H=1<<h,w=H-1,1===Z&&H>852||2===Z&&H>592)return 1;for(;;){Q=j-D,i[o]<P?(r=0,f=i[o]):i[o]>P?(r=S[s+i[o]],f=W[T+i[o]]):(r=96,f=0),x=1<<j-D,q=1<<B,u=q;do{q-=x,J[M+(l>>D)+q]=Q<<24|r<<16|f}while(0!==q);for(x=1<<j-1;l&x;)x>>=1;if(0!==x?(l&=x-1,l+=x):l=0,o++,0===--I[j]){if(j===X)break;j=G[V+i[o]]}if(j>h&&(l&w)!==O){for(0===D&&(D=h),M+=u,B=j-D,e=1<<B;B+D<X&&(e-=I[B+D],!(e<=0));)B++,e<<=1;if(H+=1<<B,1===Z&&H>852||2===Z&&H>592)return 1;O=l&w,J[O]=h<<24|B<<16|M-z}}return 0!==l&&(J[M+l]=j-D<<24|64<<16),t.bits=h,0}},12329:Z=>{"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12306:Z=>{"use strict";function c(Z){let c=Z.length;for(;--c>=0;)Z[c]=0}const L=256,k=286,N=30,R=15,G=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),V=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),p=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z=new Array(576);c(z);const i=new Array(60);c(i);const t=new Array(512);c(t);const E=new Array(256);c(E);const x=new Array(29);c(x);const q=new Array(N);function O(Z,c,L,k,N){this.static_tree=Z,this.extra_bits=c,this.extra_base=L,this.elems=k,this.max_length=N,this.has_stree=Z&&Z.length}let w,M,P;function j(Z,c){this.dyn_tree=Z,this.max_code=0,this.stat_desc=c}c(q);const o=Z=>Z<256?t[Z]:t[256+(Z>>>7)],u=(Z,c)=>{Z.pending_buf[Z.pending++]=255&c,Z.pending_buf[Z.pending++]=c>>>8&255},X=(Z,c,L)=>{Z.bi_valid>16-L?(Z.bi_buf|=c<<Z.bi_valid&65535,u(Z,Z.bi_buf),Z.bi_buf=c>>16-Z.bi_valid,Z.bi_valid+=L-16):(Z.bi_buf|=c<<Z.bi_valid&65535,Z.bi_valid+=L)},h=(Z,c,L)=>{X(Z,L[2*c],L[2*c+1])},B=(Z,c)=>{let L=0;do{L|=1&Z,Z>>>=1,L<<=1}while(--c>0);return L>>>1},D=(Z,c,L)=>{const k=new Array(16);let N,G,V=0;for(N=1;N<=R;N++)k[N]=V=V+L[N-1]<<1;for(G=0;G<=c;G++){let c=Z[2*G+1];0!==c&&(Z[2*G]=B(k[c]++,c))}},e=Z=>{let c;for(c=0;c<k;c++)Z.dyn_ltree[2*c]=0;for(c=0;c<N;c++)Z.dyn_dtree[2*c]=0;for(c=0;c<19;c++)Z.bl_tree[2*c]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},H=Z=>{Z.bi_valid>8?u(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},l=(Z,c,L,k)=>{const N=2*c,R=2*L;return Z[N]<Z[R]||Z[N]===Z[R]&&k[c]<=k[L]},W=(Z,c,L)=>{const k=Z.heap[L];let N=L<<1;for(;N<=Z.heap_len&&(N<Z.heap_len&&l(c,Z.heap[N+1],Z.heap[N],Z.depth)&&N++,!l(c,k,Z.heap[N],Z.depth));)Z.heap[L]=Z.heap[N],L=N,N<<=1;Z.heap[L]=k},T=(Z,c,k)=>{let N,R,p,J,z=0;if(0!==Z.last_lit)do{N=Z.pending_buf[Z.d_buf+2*z]<<8|Z.pending_buf[Z.d_buf+2*z+1],R=Z.pending_buf[Z.l_buf+z],z++,0===N?h(Z,R,c):(p=E[R],h(Z,p+L+1,c),J=G[p],0!==J&&(R-=x[p],X(Z,R,J)),N--,p=o(N),h(Z,p,k),J=V[p],0!==J&&(N-=q[p],X(Z,N,J)))}while(z<Z.last_lit);h(Z,256,c)},I=(Z,c)=>{const L=c.dyn_tree,k=c.stat_desc.static_tree,N=c.stat_desc.has_stree,G=c.stat_desc.elems;let V,p,J,z=-1;for(Z.heap_len=0,Z.heap_max=573,V=0;V<G;V++)0!==L[2*V]?(Z.heap[++Z.heap_len]=z=V,Z.depth[V]=0):L[2*V+1]=0;for(;Z.heap_len<2;)J=Z.heap[++Z.heap_len]=z<2?++z:0,L[2*J]=1,Z.depth[J]=0,Z.opt_len--,N&&(Z.static_len-=k[2*J+1]);for(c.max_code=z,V=Z.heap_len>>1;V>=1;V--)W(Z,L,V);J=G;do{V=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],W(Z,L,1),p=Z.heap[1],Z.heap[--Z.heap_max]=V,Z.heap[--Z.heap_max]=p,L[2*J]=L[2*V]+L[2*p],Z.depth[J]=(Z.depth[V]>=Z.depth[p]?Z.depth[V]:Z.depth[p])+1,L[2*V+1]=L[2*p+1]=J,Z.heap[1]=J++,W(Z,L,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],((Z,c)=>{const L=c.dyn_tree,k=c.max_code,N=c.stat_desc.static_tree,G=c.stat_desc.has_stree,V=c.stat_desc.extra_bits,p=c.stat_desc.extra_base,J=c.stat_desc.max_length;let z,i,t,E,x,q,O=0;for(E=0;E<=R;E++)Z.bl_count[E]=0;for(L[2*Z.heap[Z.heap_max]+1]=0,z=Z.heap_max+1;z<573;z++)i=Z.heap[z],E=L[2*L[2*i+1]+1]+1,E>J&&(E=J,O++),L[2*i+1]=E,i>k||(Z.bl_count[E]++,x=0,i>=p&&(x=V[i-p]),q=L[2*i],Z.opt_len+=q*(E+x),G&&(Z.static_len+=q*(N[2*i+1]+x)));if(0!==O){do{for(E=J-1;0===Z.bl_count[E];)E--;Z.bl_count[E]--,Z.bl_count[E+1]+=2,Z.bl_count[J]--,O-=2}while(O>0);for(E=J;0!==E;E--)for(i=Z.bl_count[E];0!==i;)t=Z.heap[--z],t>k||(L[2*t+1]!==E&&(Z.opt_len+=(E-L[2*t+1])*L[2*t],L[2*t+1]=E),i--)}})(Z,c),D(L,z,Z.bl_count)},d=(Z,c,L)=>{let k,N,R=-1,G=c[1],V=0,p=7,J=4;for(0===G&&(p=138,J=3),c[2*(L+1)+1]=65535,k=0;k<=L;k++)N=G,G=c[2*(k+1)+1],++V<p&&N===G||(V<J?Z.bl_tree[2*N]+=V:0!==N?(N!==R&&Z.bl_tree[2*N]++,Z.bl_tree[32]++):V<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,V=0,R=N,0===G?(p=138,J=3):N===G?(p=6,J=3):(p=7,J=4))},Q=(Z,c,L)=>{let k,N,R=-1,G=c[1],V=0,p=7,J=4;for(0===G&&(p=138,J=3),k=0;k<=L;k++)if(N=G,G=c[2*(k+1)+1],!(++V<p&&N===G)){if(V<J)do{h(Z,N,Z.bl_tree)}while(0!==--V);else 0!==N?(N!==R&&(h(Z,N,Z.bl_tree),V--),h(Z,16,Z.bl_tree),X(Z,V-3,2)):V<=10?(h(Z,17,Z.bl_tree),X(Z,V-3,3)):(h(Z,18,Z.bl_tree),X(Z,V-11,7));V=0,R=N,0===G?(p=138,J=3):N===G?(p=6,J=3):(p=7,J=4)}};let r=!1;const f=(Z,c,L,k)=>{X(Z,0+(k?1:0),3),((Z,c,L,k)=>{H(Z),k&&(u(Z,L),u(Z,~L)),Z.pending_buf.set(Z.window.subarray(c,c+L),Z.pending),Z.pending+=L})(Z,c,L,!0)};Z.exports._tr_init=Z=>{r||((()=>{let Z,c,L,J,j;const o=new Array(16);for(L=0,J=0;J<28;J++)for(x[J]=L,Z=0;Z<1<<G[J];Z++)E[L++]=J;for(E[L-1]=J,j=0,J=0;J<16;J++)for(q[J]=j,Z=0;Z<1<<V[J];Z++)t[j++]=J;for(j>>=7;J<N;J++)for(q[J]=j<<7,Z=0;Z<1<<V[J]-7;Z++)t[256+j++]=J;for(c=0;c<=R;c++)o[c]=0;for(Z=0;Z<=143;)z[2*Z+1]=8,Z++,o[8]++;for(;Z<=255;)z[2*Z+1]=9,Z++,o[9]++;for(;Z<=279;)z[2*Z+1]=7,Z++,o[7]++;for(;Z<=287;)z[2*Z+1]=8,Z++,o[8]++;for(D(z,287,o),Z=0;Z<N;Z++)i[2*Z+1]=5,i[2*Z]=B(Z,5);w=new O(z,G,257,k,R),M=new O(i,V,0,N,R),P=new O(new Array(0),p,0,19,7)})(),r=!0),Z.l_desc=new j(Z.dyn_ltree,w),Z.d_desc=new j(Z.dyn_dtree,M),Z.bl_desc=new j(Z.bl_tree,P),Z.bi_buf=0,Z.bi_valid=0,e(Z)},Z.exports._tr_stored_block=f,Z.exports._tr_flush_block=(Z,c,k,N)=>{let R,G,V=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=(Z=>{let c,k=4093624447;for(c=0;c<=31;c++,k>>>=1)if(1&k&&0!==Z.dyn_ltree[2*c])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(c=32;c<L;c++)if(0!==Z.dyn_ltree[2*c])return 1;return 0})(Z)),I(Z,Z.l_desc),I(Z,Z.d_desc),V=(Z=>{let c;for(d(Z,Z.dyn_ltree,Z.l_desc.max_code),d(Z,Z.dyn_dtree,Z.d_desc.max_code),I(Z,Z.bl_desc),c=18;c>=3&&0===Z.bl_tree[2*J[c]+1];c--);return Z.opt_len+=3*(c+1)+5+5+4,c})(Z),R=Z.opt_len+3+7>>>3,G=Z.static_len+3+7>>>3,G<=R&&(R=G)):R=G=k+5,k+4<=R&&-1!==c?f(Z,c,k,N):4===Z.strategy||G===R?(X(Z,2+(N?1:0),3),T(Z,z,i)):(X(Z,4+(N?1:0),3),((Z,c,L,k)=>{let N;for(X(Z,c-257,5),X(Z,L-1,5),X(Z,k-4,4),N=0;N<k;N++)X(Z,Z.bl_tree[2*J[N]+1],3);Q(Z,Z.dyn_ltree,c-1),Q(Z,Z.dyn_dtree,L-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,V+1),T(Z,Z.dyn_ltree,Z.dyn_dtree)),e(Z),N&&H(Z)},Z.exports._tr_tally=(Z,c,k)=>(Z.pending_buf[Z.d_buf+2*Z.last_lit]=c>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&c,Z.pending_buf[Z.l_buf+Z.last_lit]=255&k,Z.last_lit++,0===c?Z.dyn_ltree[2*k]++:(Z.matches++,c--,Z.dyn_ltree[2*(E[k]+L+1)]++,Z.dyn_dtree[2*o(c)]++),Z.last_lit===Z.lit_bufsize-1),Z.exports._tr_align=Z=>{X(Z,2,3),h(Z,256,z),(Z=>{16===Z.bi_valid?(u(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(Z)}},12342:Z=>{"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Wc="",this.state=null,this.data_type=2,this.adler=0}},11970:Z=>{function c(Z,c,L){for(var k=Z.length,N=-1/0,R=1/0,G=0;G<k;G++){var V=(L[0][G]-Z[G])/c[G],p=(L[1][G]-Z[G])/c[G];if(V>p){var J=V;V=p,p=J}if(p<N||V>R)return 1/0;V>N&&(N=V),p<R&&(R=p)}return N>R?1/0:N}Z.exports=function(Z,L,k,N){var R=c(L,k,N);if(R===1/0)Z=null;else{Z=Z||[];for(var G=0;G<L.length;G++)Z[G]=L[G]+k[G]*R}return Z},Z.exports.distance=c},13311:(Z,c,L)=>{"use strict";L.d(c,{d:()=>G});var k=L(37);const N=k.useLayoutEffect;const R=function(Z){var c=(0,k.useRef)(Z);return N((function(){c.current=Z})),c};var G=function(Z){var c=R(Z);(0,k.jc)((function(){var Z=function(Z){var L;if(null!=c.current&&(L=c.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof L)return Z.returnValue=L,L};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},13264:(Z,c,L)=>{"use strict";var k=L(13267),N=Array.prototype.concat,R=Array.prototype.slice,G=Z.exports=function(Z){for(var c=[],L=0,G=Z.length;L<G;L++){var V=Z[L];k(V)?c=N.call(c,R.call(V)):c.push(V)}return c};G.wrap=function(Z){return function(){return Z(G(arguments))}}},13267:Z=>{Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},12254:(Z,c,L)=>{var k=L(12259);function N(Z){for(var c,L,N=0,R=Z.length,G=0;G<Z.length;){for(c=Z[G],L=0;G<R&&Z[G]===c;)++G,++L;N+=k.log2(L)/7|0,N+=k.log2(c>>>0)/7|0,N+=2}return N}c.size=N,c.encode=function(Z,c){c||(c=new Uint8Array(N(Z)));for(var L,k,R=0,G=c.length,V=0;V<Z.length;){for(L=Z[V],k=0;V<Z.length&&Z[V]===L;)++V,++k;for(;R<G&&k>=128;)c[R++]=128+(127&k),k>>>=7;if(R>=G)throw new Error("RLE buffer overflow");for(c[R++]=k,L>>>=0;R<G&&L>=128;)c[R++]=128+(127&L),L>>>=7;if(R>=G)throw new Error("RLE buffer overflow");c[R++]=L}return c},c.decode=function(Z,c){for(var L,k,N,R,G=c.length,V=Z.length,p=0,J=0;J<V;){for(L=0,k=0;J<V&&Z[J]>=128;)L+=(127&Z[J++])<<k,k+=7;if(L+=Z[J++]<<k,J>=V)throw new Error("RLE buffer underrun");if(p+L>G)throw new Error("Chunk buffer overflow");for(N=0,k=0;J<V&&Z[J]>=128;)N+=(127&Z[J++])<<k,k+=7;if(J>=V)throw new Error("RLE buffer underrun");for(N+=Z[J++]<<k,R=0;R<L;++R)c[p++]=N}return c}},12259:(Z,c)=>{"use strict";function L(Z){var c=32;return(Z&=-Z)&&c--,65535&Z&&(c-=16),16711935&Z&&(c-=8),252645135&Z&&(c-=4),858993459&Z&&(c-=2),1431655765&Z&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(Z){return(Z>0)-(Z<0)},c.abs=function(Z){var c=Z>>31;return(Z^c)-c},c.min=function(Z,c){return c^(Z^c)&-(Z<c)},c.max=function(Z,c){return Z^(Z^c)&-(Z<c)},c.isPow2=function(Z){return!(Z&Z-1)&&!!Z},c.log2=function(Z){var c,L;return c=(Z>65535)<<4,c|=L=((Z>>>=c)>255)<<3,c|=L=((Z>>>=L)>15)<<2,(c|=L=((Z>>>=L)>3)<<1)|(Z>>>=L)>>1},c.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},c.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},c.countTrailingZeros=L,c.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},c.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},c.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var k=new Array(256);!function(Z){for(var c=0;c<256;++c){var L=c,k=c,N=7;for(L>>>=1;L;L>>>=1)k<<=1,k|=1&L,--N;Z[c]=k<<N&255}}(k),c.reverse=function(Z){return k[255&Z]<<24|k[Z>>>8&255]<<16|k[Z>>>16&255]<<8|k[Z>>>24&255]},c.interleave2=function(Z,c){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(Z,c){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>c&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},c.interleave3=function(Z,c,L){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},c.deinterleave3=function(Z,c){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>c&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},c.nextCombination=function(Z){var c=Z|Z-1;return c+1|(~c&-~c)-1>>>L(Z)+1}},12284:Z=>{"use strict";Z.exports=function(Z,c,L,k){var N=self||window;try{try{var R;try{R=new N.Blob([Z])}catch(J){(R=new(N.BlobBuilder||N.WebKitBlobBuilder||N.MozBlobBuilder||N.MSBlobBuilder)).append(Z),R=R.getBlob()}var G=N.URL||N.webkitURL,V=G.createObjectURL(R),p=new N[c](V,L);return G.revokeObjectURL(V),p}catch(J){return new N[c]("data:application/javascript,".concat(encodeURIComponent(Z)),L)}}catch(J){if(!k)throw Error("Inline worker is not supported");return new N[c](k,L)}}},11958:(Z,c,L)=>{"use strict";function k(Z,c,L,k,N){var R={};return Object.keys(k).forEach((function(Z){R[Z]=k[Z]})),R.enumerable=!!R.enumerable,R.configurable=!!R.configurable,("value"in R||R.initializer)&&(R.writable=!0),R=L.slice().reverse().reduce((function(L,k){return k(Z,c,L)||L}),R),N&&void 0!==R.initializer&&(R.value=R.initializer?R.initializer.call(N):void 0,R.initializer=void 0),void 0===R.initializer&&(Object.defineProperty(Z,c,R),R=null),R}L.d(c,{b:()=>k})},11954:(Z,c,L)=>{"use strict";function k(Z,c,L,k){L&&Object.defineProperty(Z,c,{enumerable:L.enumerable,configurable:L.configurable,writable:L.writable,value:L.initializer?L.initializer.call(k):void 0})}L.d(c,{d:()=>k})},13296:(Z,c,L)=>{"use strict";L.d(c,{d:()=>G,f:()=>i,h:()=>V,l:()=>R,m:()=>p,n:()=>N,r:()=>J,s:()=>z});var k=L(11471);class N{constructor(){this._easingMode=N.EASINGMODE_EASEIN}setEasingMode(Z){const c=Math.min(Math.max(Z,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(Z){throw new Error("You must implement this method")}ease(Z){switch(this._easingMode){case N.EASINGMODE_EASEIN:return this.easeInCore(Z);case N.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Z)}return Z>=.5?.5*(1-this.easeInCore(2*(1-Z)))+.5:.5*this.easeInCore(2*Z)}}N.EASINGMODE_EASEIN=0,N.EASINGMODE_EASEOUT=1,N.EASINGMODE_EASEINOUT=2;class R extends N{easeInCore(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}class G extends N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Z}easeInCore(Z){const c=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*c*Math.sin(3.141592653589793*Z)}}class V extends N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Z,this.bounciness=c}easeInCore(Z){const c=Math.max(0,this.bounces);let L=this.bounciness;L<=1&&(L=1.001);const k=Math.pow(L,c),N=1-L,R=(1-k)/N+.5*k,G=Z*R,V=Math.log(-G*(1-L)+1)/Math.log(L),p=Math.floor(V),J=p+1,z=(1-Math.pow(L,p))/(N*R),i=.5*(z+(1-Math.pow(L,J))/(N*R)),t=Z-i,E=i-z;return-Math.pow(1/L,c-p)/(E*E)*(t-E)*(t+E)}}class p extends N{easeInCore(Z){return Z*Z*Z}}class J extends N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Z,this.springiness=c}easeInCore(Z){let c;const L=Math.max(0,this.oscillations),k=Math.max(0,this.springiness);return c=0==k?Z:(Math.exp(k*Z)-1)/(Math.exp(k)-1),c*Math.sin((6.283185307179586*L+1.5707963267948966)*Z)}}class z extends N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Z}easeInCore(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)}}class i extends N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Z,this.y1=c,this.x2=L,this.y2=k}easeInCore(Z){return k.d.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}},12745:(Z,c,L)=>{"use strict";L.d(c,{e:()=>G});var k=L(10993),N=L(11008),R=L(11277);class G extends R.b{get _matrix(){return this._compose(),this.it}set _matrix(Z){(Z.updateFlag!==this.it.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.it.R(Z),this._markAsDirtyAndDecompose())}constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Z,c.XZ(),!1),this.name=Z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.it=(null===N||void 0===N?void 0:N.clone())??k.b.Identity(),this._restMatrix=R??this.it.clone(),this._bindMatrix=G??this.it.clone(),this._index=V,this._absoluteMatrix=new k.b,this._absoluteBindMatrix=new k.b,this._absoluteInverseBindMatrix=new k.b,this._finalMatrix=new k.b,c.bones.push(this),this.setParent(L,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Z){this.setParent(Z)}setParent(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Z){if(this.parent){const Z=this.parent.children.indexOf(this);-1!==Z&&this.parent.children.splice(Z,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.DJ()}}getLocalMatrix(){return this._compose(),this.it}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Z){this._restMatrix.R(Z)}setRestPose(Z){this.setRestMatrix(Z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Z){this.hc(Z)}setBindPose(Z){this.setBindMatrix(Z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Z=k.d.Mc[0],c=k.d.Quaternion[0],L=k.d.Mc[1];this.getRestMatrix().decompose(Z,c,L),this._linkedTransformNode.position.R(L),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??k.c.Identity(),this._linkedTransformNode.rotationQuaternion.R(c),this._linkedTransformNode.Pc.R(Z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.bV}set position(Z){this._decompose(),this.bV.R(Z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Z){this.setRotation(Z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Z){this.setRotationQuaternion(Z)}get Pc(){return this.getScale()}set Pc(Z){this.setScale(Z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=k.h.Zero(),this._localRotation=k.c.Zero(),this.bV=k.h.Zero()),this.it.decompose(this._localScaling,this._localRotation,this.bV))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,k.b.ComposeToRef(this._localScaling,this._localRotation,this.bV,this.it)):this._needToCompose=!1)}hc(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.R(Z),c&&this._updateAbsoluteBindMatrices(),L?this._matrix=Z:this.DJ()}_updateAbsoluteBindMatrices(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z||(Z=this._bindMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.R(Z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let L=0;L<this.children.length;L++)this.children[L]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}DJ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.DJ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.DJ(),this._needToDecompose=!0}_updatePosition(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const R=this.getLocalMatrix();if(0==c)N?(R.addAtIndex(12,Z.x),R.addAtIndex(13,Z.y),R.addAtIndex(14,Z.z)):R.setTranslationFromFloats(Z.x,Z.y,Z.z);else{let c=null;L&&(c=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const V=G._TmpMats[0],p=G._TmpVecs[0];this.parent?L&&c?(V.R(this.parent.getAbsoluteMatrix()),V.multiplyToRef(c,V)):V.R(this.parent.getAbsoluteMatrix()):k.b.IdentityToRef(V),N&&V.setTranslationFromFloats(0,0,0),V.invert(),k.h.TransformCoordinatesToRef(Z,V,p),N?(R.addAtIndex(12,p.x),R.addAtIndex(13,p.y),R.addAtIndex(14,p.z)):R.setTranslationFromFloats(p.x,p.y,p.z)}this._markAsDirtyAndDecompose()}translate(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,c,L,!0)}setPosition(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,c,L,!1)}setAbsolutePosition(Z,c){this.setPosition(Z,1,c)}scale(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=this.getLocalMatrix(),V=G._TmpMats[0];k.b.ScalingToRef(Z,c,L,V),V.multiplyToRef(R,R),V.invert();for(const k of this.children){const N=k.getLocalMatrix();N.multiplyToRef(V,N),N.multiplyAtIndex(12,Z),N.multiplyAtIndex(13,c),N.multiplyAtIndex(14,L),k._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),N)for(const k of this.children)k.scale(Z,c,L,N)}setScale(Z){this._decompose(),this._localScaling.R(Z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Z){this._decompose(),Z.R(this._localScaling)}setYawPitchRoll(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4?arguments[4]:void 0;if(0===N){const V=G._TmpQuat;return k.c.RotationYawPitchRollToRef(Z,c,L,V),void this.setRotationQuaternion(V,N,R)}const V=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,R))return;const p=G._TmpMats[1];k.b.RotationYawPitchRollToRef(Z,c,L,p),V.multiplyToRef(p,p),this._rotateWithMatrix(p,N,R)}rotate(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;const R=G._TmpMats[0];R.setTranslationFromFloats(0,0,0),k.b.RotationAxisToRef(Z,c,R),this._rotateWithMatrix(R,L,N)}setAxisAngle(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;if(0===L){const R=G._TmpQuat;return k.c.RotationAxisToRef(Z,c,R),void this.setRotationQuaternion(R,L,N)}const R=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,N))return;const V=G._TmpMats[1];k.b.RotationAxisToRef(Z,c,V),R.multiplyToRef(V,V),this._rotateWithMatrix(V,L,N)}setRotation(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Z.y,Z.x,Z.z,c,L)}setRotationQuaternion(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.R(Z),void this._markAsDirtyAndCompose();const N=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,L))return;const R=G._TmpMats[1];k.b.FromQuaternionToRef(Z,R),N.multiplyToRef(R,R),this._rotateWithMatrix(R,c,L)}setRotationMatrix(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;if(0===c){const N=G._TmpQuat;return k.c.FromRotationMatrixToRef(Z,N),void this.setRotationQuaternion(N,c,L)}const N=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,L))return;const R=G._TmpMats[1];R.R(Z),N.multiplyToRef(Z,R),this._rotateWithMatrix(R,c,L)}_rotateWithMatrix(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const k=this.getLocalMatrix(),N=k.m[12],R=k.m[13],V=k.m[14],p=this.getParent(),J=G._TmpMats[3],z=G._TmpMats[4];p&&1==c?(L?(J.R(L.getWorldMatrix()),p.getAbsoluteMatrix().multiplyToRef(J,J)):J.R(p.getAbsoluteMatrix()),z.R(J),z.invert(),k.multiplyToRef(J,k),k.multiplyToRef(Z,k),k.multiplyToRef(z,k)):1==c&&L?(J.R(L.getWorldMatrix()),z.R(J),z.invert(),k.multiplyToRef(J,k),k.multiplyToRef(Z,k),k.multiplyToRef(z,k)):k.multiplyToRef(Z,k),k.setTranslationFromFloats(N,R,V),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Z,c){const L=G._TmpMats[2];return Z.R(this.getAbsoluteMatrix()),c?(Z.multiplyToRef(c.getWorldMatrix(),Z),k.b.ScalingToRef(c.Pc.x,c.Pc.y,c.Pc.z,L)):k.b.IdentityToRef(L),Z.invert(),!isNaN(Z.m[0])&&(L.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(L,Z),!0)}Gc(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.h.Zero();return this.getPositionToRef(Z,c,L),L}getPositionToRef(){let Z=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Z=this.getLocalMatrix();c.x=Z.m[12],c.y=Z.m[13],c.z=Z.m[14]}else{let L=null;Z&&(L=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let k=G._TmpMats[0];Z&&L?(k.R(this.getAbsoluteMatrix()),k.multiplyToRef(L,k)):k=this.getAbsoluteMatrix(),c.x=k.m[12],c.y=k.m[13],c.z=k.m[14]}}getAbsolutePosition(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=k.h.Zero();return this.getPositionToRef(1,Z,c),c}getAbsolutePositionToRef(Z,c){this.getPositionToRef(1,Z,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.it.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.R(this.it);const Z=this._skeleton.getPoseMatrix();Z&&this._absoluteMatrix.multiplyToRef(Z,this._absoluteMatrix)}const Z=this.children,c=Z.length;for(let L=0;L<c;L++)Z[L].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}wp(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.h.Zero();return this.getDirectionToRef(Z,c,L),L}getDirectionToRef(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;c&&(N=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=G._TmpMats[0];R.R(this.getAbsoluteMatrix()),c&&N&&R.multiplyToRef(N,R),k.h.TransformNormalToRef(Z,R,L),L.normalize()}getRotation(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.h.Zero();return this.getRotationToRef(Z,c,L),L}getRotationToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;const k=G._TmpQuat;this.getRotationQuaternionToRef(Z,c,k),k.toEulerAnglesToRef(L)}getRotationQuaternion(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.c.Identity();return this.getRotationQuaternionToRef(Z,c,L),L}getRotationQuaternionToRef(){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.R(this._localRotation);else{const L=G._TmpMats[0],k=this.getAbsoluteMatrix();Z?k.multiplyToRef(Z.getWorldMatrix(),L):L.R(k),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.decompose(void 0,c,void 0)}}getRotationMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const L=k.b.Identity();return this.getRotationMatrixToRef(Z,c,L),L}getRotationMatrixToRef(){let Z=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const L=G._TmpMats[0],k=this.getAbsoluteMatrix();Z?k.multiplyToRef(Z.getWorldMatrix(),L):L.R(k),L.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyAtIndex(1,this._scalingDeterminant),L.multiplyAtIndex(2,this._scalingDeterminant),L.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.h.Zero();return this.getAbsolutePositionFromLocalToRef(Z,c,L),L}getAbsolutePositionFromLocalToRef(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;c&&(N=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=G._TmpMats[0];R.R(this.getAbsoluteMatrix()),c&&N&&R.multiplyToRef(N,R),k.h.TransformCoordinatesToRef(Z,R,L)}getLocalPositionFromAbsolute(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=k.h.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,c,L),L}getLocalPositionFromAbsoluteToRef(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,N=null;c&&(N=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=G._TmpMats[0];R.R(this.getAbsoluteMatrix()),c&&N&&R.multiplyToRef(N,R),R.invert(),k.h.TransformCoordinatesToRef(Z,R,L)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Z=this._skeleton.bones.indexOf(this);if(-1!==Z&&this._skeleton.bones.splice(Z,1),this._parentNode&&this._parentNode.children){const Z=this._parentNode.children,c=Z.indexOf(this);-1!==c&&Z.splice(c,1)}super.dispose()}}G._TmpVecs=(0,N.b)(2,k.h.Zero),G._TmpQuat=k.c.Identity(),G._TmpMats=(0,N.b)(5,k.b.Identity)},13293:(Z,c,L)=>{"use strict";L.d(c,{c:()=>I});var k=L(11170),N=L(11173),R=L(11027),G=L(10993),V=L(11032),p=L(11277),J=L(11325),z=L(11614),i=L(11065),t=L(10999);class E{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Z){this._idleRotationSpeed=Z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Z){this._idleRotationWaitTime=Z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Z){this._idleRotationSpinupTime=Z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Z){this._attachedCamera=Z;const c=this._attachedCamera.XZ();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((Z=>{Z.type!==z.e.POINTERDOWN?Z.type===z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Z=i.c.Now;let c=0;null!=this._lastFrameTime&&(c=Z-this._lastFrameTime),this._lastFrameTime=Z,this._applyUserInteraction();const L=Z-this._lastInteractionTime-this._idleRotationWaitTime,k=Math.max(Math.min(L/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*k,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.XZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Z){this._lastInteractionTime=Z??i.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<t.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=i.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var x=L(13296),q=L(11716);class O{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Z){if(this._autoTransitionRange===Z)return;this._autoTransitionRange=Z;const c=this._attachedCamera;c&&(Z?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((Z=>{if(Z&&(Z.Jc(!0),Z.getBoundingInfo)){const c=Z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Z){this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Z){if(!this._attachedCamera)return;this._radiusBounceTransition||(O.EasingFunction.setEasingMode(O.EasingMode),this._radiusBounceTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=q.c.TransitionTo("radius",this._attachedCamera.radius+Z,this._attachedCamera,this._attachedCamera.XZ(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}O.EasingFunction=new x.d(.3),O.EasingMode=x.n.EASINGMODE_EASEOUT;class w{constructor(){this.onTargetFramingAnimationEndObservable=new R.b,this._mode=w.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Z){this._mode=Z}get mode(){return this._mode}set radiusScale(Z){this._radiusScale=Z}get radiusScale(){return this._radiusScale}set positionScale(Z){this._positionScale=Z}get positionScale(){return this._positionScale}set defaultElevation(Z){this._defaultElevation=Z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Z){this._elevationReturnTime=Z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Z){this._elevationReturnWaitTime=Z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Z){this._framingTime=Z}get framingTime(){return this._framingTime}init(){}attach(Z){this._attachedCamera=Z;const c=this._attachedCamera.XZ();w.EasingFunction.setEasingMode(w.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((Z=>{Z.type!==z.e.POINTERDOWN?Z.type===z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((Z=>{Z&&Z.getBoundingInfo&&this.zoomOnMesh(Z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.XZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Jc(!0);const k=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(k.minimumWorld,k.maximumWorld,c,L)}zoomOnMeshHierarchy(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Jc(!0);const k=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(k.min,k.max,c,L)}zoomOnMeshesHierarchy(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new G.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new G.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let R=0;R<Z.length;R++){const c=Z[R].getHierarchyBoundingVectors(!0);G.h.CheckExtends(c.min,k,N),G.h.CheckExtends(c.max,k,N)}this.zoomOnBoundingInfo(k,N,c,L)}zoomOnBoundingInfo(Z,c){let L,k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const R=Z.y,V=R+(c.y-R)*this._positionScale,p=c.yL(Z).scale(.5);if(!isFinite(V))return!1;if(k)L=new G.h(0,V,0);else{const c=Z.add(p);L=new G.h(c.x,V,c.z)}this._vectorTransition||(this._vectorTransition=q.c.CreateAnimation("target",q.c.ANIMATIONTYPE_VECTOR3,60,w.EasingFunction)),this._betaIsAnimating=!0;let J=q.c.TransitionTo("target",L,this._attachedCamera,this._attachedCamera.XZ(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let z=0;if(this._mode===w.FitFrustumSidesMode){const L=this._calculateLowerRadiusFromModelBoundingSphere(Z,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=p.length()+this._attachedCamera.Dc),z=L}else this._mode===w.IgnoreBoundsSizeMode&&(z=this._calculateLowerRadiusFromModelBoundingSphere(Z,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Dc));if(this.autoCorrectCameraLimitsAndSensibility){const L=c.yL(Z).length();this._attachedCamera.panningSensibility=5e3/L,this._attachedCamera.wheelPrecision=100/z}return this._radiusTransition||(this._radiusTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),J=q.c.TransitionTo("radius",z,this._attachedCamera,this._attachedCamera.XZ(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),N&&N(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(Z,c){const L=this._attachedCamera;if(!L)return 0;let k=L._calculateLowerRadiusFromModelBoundingSphere(Z,c,this._radiusScale);return L.lowerRadiusLimit&&this._mode===w.IgnoreBoundsSizeMode&&(k=k<L.lowerRadiusLimit?L.lowerRadiusLimit:k),L.upperRadiusLimit&&(k=k>L.upperRadiusLimit?L.upperRadiusLimit:k),k}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Z=i.c.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,L=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>L&&Z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=q.c.CreateAnimation("beta",q.c.ANIMATIONTYPE_FLOAT,60,w.EasingFunction));const Z=q.c.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.XZ(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Z&&this._animatables.push(Z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=i.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}w.EasingFunction=new x.s,w.EasingMode=x.n.EASINGMODE_EASEINOUT,w.IgnoreBoundsSizeMode=0,w.FitFrustumSidesMode=1;var M=L(11329),P=L(11558),j=L(12737),o=L(11038);class u{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Z){Z=o.c.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),L=c.getInputElement();let k=0,N=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=R=>{var G,V;const p=R.event,J="touch"===p.pointerType;if(R.type!==z.e.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const i=p.target;if(this._altKey=p.altKey,this._ctrlKey=p.ctrlKey,this._metaKey=p.metaKey,this._shiftKey=p.shiftKey,this._buttonsPressed=p.buttons,c.isPointerLock){const Z=p.movementX,c=p.movementY;this.onTouch(null,Z,c),this._pointA=null,this._pointB=null}else{if(R.type!==z.e.POINTERDOWN&&R.type!==z.e.POINTERDOUBLETAP&&J&&(null===(G=this._pointA)||void 0===G?void 0:G.pointerId)!==p.pointerId&&(null===(V=this._pointB)||void 0===V?void 0:V.pointerId)!==p.pointerId)return;if(R.type!==z.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!J)if(R.type===z.e.POINTERDOUBLETAP)this.onDoubleTap(p.pointerType);else if(R.type!==z.e.POINTERUP||this._currentMousePointerIdDown!==p.pointerId&&!J){if(R.type===z.e.POINTERMOVE)if(Z||p.preventDefault(),this._pointA&&null===this._pointB){const Z=p.clientX-this._pointA.x,c=p.clientY-this._pointA.y;this._pointA.x=p.clientX,this._pointA.y=p.clientY,this.onTouch(this._pointA,Z,c)}else if(this._pointA&&this._pointB){const Z=this._pointA.pointerId===p.pointerId?this._pointA:this._pointB;Z.x=p.clientX,Z.y=p.clientY;const c=this._pointA.x-this._pointB.x,L=this._pointA.y-this._pointB.y,G=c*c+L*L,V={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:p.pointerId,type:R.type};this.onMultiTouch(this._pointA,this._pointB,k,G,N,V),N=V,k=G}}else{try{null===i||void 0===i||i.releasePointerCapture(p.pointerId)}catch(t){}J||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==p.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==p.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==k||N)&&(this.onMultiTouch(this._pointA,this._pointB,k,0,N,null),k=0,N=null),this._currentMousePointerIdDown=-1,this.onButtonUp(p),Z||p.preventDefault()}else{try{null===i||void 0===i||i.setPointerCapture(p.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType};else{if(null!==this._pointB)return;this._pointB={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType}}-1!==this._currentMousePointerIdDown||J||(this._currentMousePointerIdDown=p.pointerId),this.onButtonDown(p),Z||(p.preventDefault(),L&&L.focus())}}},this._observer=this.camera.XZ()._inputManager._addCameraPointerObserver(this._pointerInput,z.e.POINTERDOWN|z.e.POINTERUP|z.e.POINTERMOVE|z.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,k=0,N=null,this.onLostFocus()},this._contextMenuBind=Z=>this.onContextMenu(Z),L&&L.addEventListener("contextmenu",this._contextMenuBind,!1);const R=this.camera.XZ().getEngine().getHostWindow();R&&o.c.RegisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}Oi(){if(this._onLostFocus){const Z=this.camera.XZ().getEngine().getHostWindow();Z&&o.c.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.XZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Z=this.camera.XZ().getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Z){}onTouch(Z,c,L){}onMultiTouch(Z,c,L,k,N,R){}onContextMenu(Z){Z.preventDefault()}onButtonDown(Z){}onButtonUp(Z){}onLostFocus(){}}(0,k.d)([(0,N.H)()],u.prototype,"buttons",void 0);class X extends u{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Z,c){if(0!==this.panningSensibility&&Z&&c){const L=c.x-Z.x,k=c.y-Z.y;this.camera.inertialPanningX+=-L/this.panningSensibility,this.camera.inertialPanningY+=k/this.panningSensibility}}_computePinchZoom(Z,c){const L=this.camera.radius||X.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=L*Math.sqrt(Z)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-Z)*L*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Z,c,L){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=L/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=L/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Z,c,L,k,N,R){0===L&&null===N||0===k&&null===R||(this.multiTouchPanAndZoom?(this._computePinchZoom(L,k),this._computeMultiTouchPanning(N,R)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(k)-Math.sqrt(L))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(L,k),this._isPinching=!0):this._computeMultiTouchPanning(N,R)):this.multiTouchPanning?this._computeMultiTouchPanning(N,R):this.pinchZoom&&this._computePinchZoom(L,k))}onButtonDown(Z){this._isPanClick=Z.button===this.camera._panningMouseButton}onButtonUp(Z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}X.MinimumRadiusForPinch=.001,(0,k.d)([(0,N.H)()],X.prototype,"buttons",void 0),(0,k.d)([(0,N.H)()],X.prototype,"angularSensibilityX",void 0),(0,k.d)([(0,N.H)()],X.prototype,"angularSensibilityY",void 0),(0,k.d)([(0,N.H)()],X.prototype,"pinchPrecision",void 0),(0,k.d)([(0,N.H)()],X.prototype,"pinchDeltaPercentage",void 0),(0,k.d)([(0,N.H)()],X.prototype,"useNaturalPinchZoom",void 0),(0,k.d)([(0,N.H)()],X.prototype,"pinchZoom",void 0),(0,k.d)([(0,N.H)()],X.prototype,"panningSensibility",void 0),(0,k.d)([(0,N.H)()],X.prototype,"multiTouchPanning",void 0),(0,k.d)([(0,N.H)()],X.prototype,"multiTouchPanAndZoom",void 0),j.d.ArcRotateCameraPointersInput=X;var h=L(11621);class B{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Z){Z=o.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.XZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const L=c.event;if(!L.metaKey)if(c.type===h.d.KEYDOWN){if(this._ctrlPressed=L.ctrlKey,this._altPressed=L.altKey,-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),L.preventDefault&&(Z||L.preventDefault())}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysReset.indexOf(L.keyCode)){const c=this._keys.indexOf(L.keyCode);c>=0&&this._keys.splice(c,1),L.preventDefault&&(Z||L.preventDefault())}})))}Oi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let c=0;c<this._keys.length;c++){const L=this._keys[c];-1!==this.keysLeft.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(L)&&Z.useInputToRestoreState&&Z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,k.d)([(0,N.H)()],B.prototype,"keysUp",void 0),(0,k.d)([(0,N.H)()],B.prototype,"keysDown",void 0),(0,k.d)([(0,N.H)()],B.prototype,"keysLeft",void 0),(0,k.d)([(0,N.H)()],B.prototype,"keysRight",void 0),(0,k.d)([(0,N.H)()],B.prototype,"keysReset",void 0),(0,k.d)([(0,N.H)()],B.prototype,"panningSensibility",void 0),(0,k.d)([(0,N.H)()],B.prototype,"zoomingSensibility",void 0),(0,k.d)([(0,N.H)()],B.prototype,"useAltToZoom",void 0),(0,k.d)([(0,N.H)()],B.prototype,"angularSpeed",void 0),j.d.ArcRotateCameraKeyboardMoveInput=B;var D=L(11239),e=L(11630);class H{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new G.h(0,0,0),this._globalOffset=new G.h(0,0,0),this._inertialPanning=G.h.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Z,c){let L=0;const k=.01*Z*this.wheelDeltaPercentage*c;return L=Z>0?k/(1+this.wheelDeltaPercentage):k*(1+this.wheelDeltaPercentage),L}attachControl(Z){Z=o.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==z.e.POINTERWHEEL)return;const L=c.event;let k=0;const N=L.deltaMode===e.d.DOM_DELTA_LINE?40:1,R=-L.deltaY*N;if(this.customComputeDeltaFromMouseWheel)k=this.customComputeDeltaFromMouseWheel(R,this,L);else if(this.wheelDeltaPercentage){if(k=this._computeDeltaFromMouseWheelLegacyEvent(R,this.camera.radius),k>0){let Z=this.camera.radius,c=this.camera.inertialRadiusOffset+k;for(let L=0;L<20&&!(Z<=c)&&!(Math.abs(c*this.camera.inertia)<.001);L++)Z-=c,c*=this.camera.inertia;Z=(0,V.Clamp)(Z,0,Number.MAX_VALUE),k=this._computeDeltaFromMouseWheelLegacyEvent(R,Z)}}else k=R/(40*this.wheelPrecision);k&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(k)):this.camera.inertialRadiusOffset+=k),L.preventDefault&&(Z||L.preventDefault())},this._observer=this.camera.XZ()._inputManager._addCameraPointerObserver(this._wheel,z.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.uc(0)}Oi(){this._observer&&(this.camera.XZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Z=this.camera,c=Z.target.yL(Z.position);this._hitPlane=D.b.FromPositionAndNormal(Z.target,c)}_getPosition(){const Z=this.camera,c=Z.XZ(),L=c.createPickingRay(c.pointerX,c.pointerY,G.b.Identity(),Z,!1);0===Z.targetScreenOffset.x&&0===Z.targetScreenOffset.y||(this._viewOffset.set(Z.targetScreenOffset.x,Z.targetScreenOffset.y,0),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),this._globalOffset=G.h.TransformNormal(this._viewOffset,Z._cameraTransformMatrix),L.origin.addInPlace(this._globalOffset));let k=0;return this._hitPlane&&(k=L.intersectsPlane(this._hitPlane)??0),L.origin.addInPlace(L.direction.scaleInPlace(k))}_zoomToMouse(Z){const c=this.camera,L=1-c.inertia;if(c.lowerRadiusLimit){const k=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+Z)/L<k&&(Z=(c.radius-k)*L-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const k=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+Z)/L>k&&(Z=(c.radius-k)*L-c.inertialRadiusOffset)}const k=Z/L/c.radius,N=this._getPosition(),R=G.d.Mc[6];N.subtractToRef(c.target,R),R.scaleInPlace(k),R.scaleInPlace(L),this._inertialPanning.addInPlace(R),c.inertialRadiusOffset+=Z}_zeroIfClose(Z){Math.abs(Z.x)<t.e&&(Z.x=0),Math.abs(Z.y)<t.e&&(Z.y=0),Math.abs(Z.z)<t.e&&(Z.z=0)}}(0,k.d)([(0,N.H)()],H.prototype,"wheelPrecision",void 0),(0,k.d)([(0,N.H)()],H.prototype,"zoomToMouseLocation",void 0),(0,k.d)([(0,N.H)()],H.prototype,"wheelDeltaPercentage",void 0),j.d.ArcRotateCameraMouseWheelInput=H;class l extends j.h{constructor(Z){super(Z)}addMouseWheel(){return this.add(new H),this}addPointers(){return this.add(new X),this}addKeyboard(){return this.add(new B),this}}var W=L(11012);function T(Z,c){return isNaN(Z)?c:Z}p.b.AddNodeConstructor("ArcRotateCamera",((Z,c)=>()=>new I(Z,0,0,1,G.h.Zero(),c)));class I extends P.e{get target(){return this._target}set target(Z){this.setTarget(Z)}get targetHost(){return this._targetHost}set targetHost(Z){Z&&this.setTarget(Z)}getTarget(){return this.target}get position(){return this._position}set position(Z){this.setPosition(Z)}set upVector(Z){this._upToYMatrix||(this._yToUpMatrix=new G.b,this._upToYMatrix=new G.b,this._upVector=G.h.Zero()),Z.normalize(),this._upVector.R(Z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){G.b.RotationAlignToRef(G.h.UpReadOnly,this._upVector,this._yToUpMatrix),G.b.RotationAlignToRef(this._upVector,G.h.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0}set angularSensibilityX(Z){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=Z)}get angularSensibilityY(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0}set angularSensibilityY(Z){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=Z)}get pinchPrecision(){const Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0}set pinchPrecision(Z){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=Z)}get pinchDeltaPercentage(){const Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0}set pinchDeltaPercentage(Z){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=Z)}get useNaturalPinchZoom(){const Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom}set useNaturalPinchZoom(Z){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=Z)}get panningSensibility(){const Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0}set panningSensibility(Z){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const c=this.inputs.attached.keyboard;c&&(c.keysUp=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const c=this.inputs.attached.keyboard;c&&(c.keysDown=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRight=Z)}get wheelPrecision(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0}set wheelPrecision(Z){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=Z)}get zoomToMouseLocation(){const Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation}set zoomToMouseLocation(Z){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=Z)}get wheelDeltaPercentage(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0}set wheelDeltaPercentage(Z){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=Z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new O,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new w,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new E,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Z,c,L,k,N,V){var p;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Z,G.h.Zero(),V,J),p=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=G.h.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=G.f.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new G.b,this.panningAxis=new G.h(1,1,0),this._transformedDirection=new G.h,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new R.b,this.checkCollisions=!1,this.collisionRadius=new G.h(.5,.5,.5),this._previousPosition=G.h.Zero(),this._collisionVelocity=G.h.Zero(),this._newPosition=G.h.Zero(),this._computationVector=G.h.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new G.h(NaN,NaN,NaN),this._goalTargetScreenOffset=new G.f(NaN,NaN),this._onCollisionPositionChange=function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L?(p.setPosition(c),p.VE&&p.VE(L)):p._previousPosition.R(p._position);const k=Math.cos(p.alpha),N=Math.sin(p.alpha),R=Math.cos(p.beta);let G=Math.sin(p.beta);0===G&&(G=1e-4);const V=p._getTargetPosition();p._computationVector.wc(p.radius*k*G,p.radius*R,p.radius*N*G),V.addToRef(p._computationVector,p._newPosition),p._position.R(p._newPosition);let J=p.upVector;p.allowUpsideDown&&p.beta<0&&(J=J.clone(),J=J.negate()),p._computeViewMatrix(p._position,V,J),p._viewMatrix.addAtIndex(12,p.targetScreenOffset.x),p._viewMatrix.addAtIndex(13,p.targetScreenOffset.y),p._collisionTriggered=!1},this._target=G.h.Zero(),N&&this.setTarget(N),this.alpha=c,this.beta=L,this.radius=k,this.getViewMatrix(),this.inputs=new l(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new G.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=G.f.Zero()}_updateCache(Z){Z||super._updateCache(),this._cache._target.R(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.R(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.R(Z)}const Z=this._getLockedTargetPosition();return Z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>t.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,R=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=R?this._currentInterpolationFactor=R:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=T(Z,this._goalAlpha),this._goalBeta=T(c,this._goalBeta),this._goalRadius=T(L,this._goalRadius),this._goalTarget.set(T(k.x,this._goalTarget.x),T(k.y,this._goalTarget.y),T(k.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(T(N.x,this._goalTargetScreenOffset.x),T(N.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,V.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,V.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,V.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,V.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const N=arguments;c=o.c.BackCompatCameraNoPreventDefault(N),this._useCtrlForPanning=L,this._panningMouseButton=k,"boolean"===typeof N[0]&&(N.length>1&&(this._useCtrlForPanning=N[1]),N.length>2&&(this._panningMouseButton=N[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Oi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Z=!0;const c=this.invertRotation?-1:1,L=this._calculateHandednessMultiplier();let k=this.inertialAlphaOffset*L;this.beta<0&&(k*=-1),this.alpha+=k*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<t.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<t.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*t.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Z=!0;const c=new G.h(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),G.h.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Z=this.upVector,c=G.h.CrossToRef(this._transformedDirection,Z,this._transformedDirection);G.h.CrossToRef(Z,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);G.h.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.R(this._transformedDirection)}else{if(this.parent){const Z=G.d.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.transposeToRef(Z),G.h.TransformCoordinatesToRef(this._transformedDirection,Z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*t.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*t.e&&(this.inertialPanningY=0)}if(Z)this.stopInterpolation();else if(this._isInterpolating){let Z=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,L=1-Math.pow(2,-c/this._currentInterpolationFactor),k=T(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=G.d.Mc[0].set(T(this._goalTarget.x,this._target.x),T(this._goalTarget.y,this._target.y),T(this._goalTarget.z,this._target.z));G.h.LerpToRef(this.target,c,L,this._target),10*G.h.Distance(this.target,c)/k<t.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.R(c),this.setTarget(this.target,!1,!0,!0)):Z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=G.c.RotationAlphaBetaGammaToRef(T(this._goalAlpha,this.alpha),T(this._goalBeta,this.beta),0,G.d.Quaternion[0]),k=G.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,G.d.Quaternion[1]),N=G.c.SlerpToRef(k,c,L,G.d.Quaternion[2]);N.normalize();const R=N.toAlphaBetaGammaToRef(G.d.Mc[0]);if(this.alpha=R.x,this.beta=R.y,N.isApprox(c,t.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Z=c.toAlphaBetaGammaToRef(G.d.Mc[0]);this.alpha=Z.x,this.beta=Z.y}else Z=!0}if(isNaN(this._goalRadius)||(this.radius+=(k-this.radius)*L,Math.abs(k/this.radius-1)<t.e?(this._goalRadius=NaN,this.radius=k):Z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=G.d.Vector2[0].set(T(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),T(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));G.f.LerpToRef(this.targetScreenOffset,c,L,this.targetScreenOffset),G.f.Distance(this.targetScreenOffset,c)<t.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.R(c)):Z=!0}this._isInterpolating=Z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.h.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Z=this.alpha;var c,L;this.alpha=function(Z){let c=Math.PI/2;return 0===Z.x&&0===Z.z||(c=Math.acos(Z.x/Math.sqrt(Math.pow(Z.x,2)+Math.pow(Z.z,2)))),Z.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,L=this.radius,Math.acos(c/L));const k=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*k*Math.PI,this._checkLimits()}setPosition(Z){this._position.equals(Z)||(this._position.R(Z),this.rebuildAnglesAndRadius())}setTarget(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(k=this.overrideCloneAlphaBetaRadius??k,Z.Jc)c&&Z.getBoundingInfo?this._targetBoundingCenter=Z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Z.Jc(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=Z,k=this._getTargetPosition();if(k&&!L&&k.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}k||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Z=Math.cos(this.alpha),c=Math.sin(this.alpha),L=Math.cos(this.beta);let k=Math.sin(this.beta);0===k&&(k=1e-4),0===this.radius&&(this.radius=1e-4);const N=this._getTargetPosition();if(this._computationVector.wc(this.radius*Z*k,this.radius*L,this.radius*c*k),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.h.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),N.addToRef(this._computationVector,this._newPosition),this.XZ().collisionsEnabled&&this.checkCollisions){const Z=this.XZ().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.R(this._newPosition);let Z=this.upVector;this.allowUpsideDown&&k<0&&(Z=Z.negate()),this._computeViewMatrix(this._position,N,Z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.R(N),this._viewMatrix}zoomOn(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z||this.XZ().meshes;const L=J.c.MinMax(Z);let k=this._calculateLowerRadiusFromModelBoundingSphere(L.min,L.max);if(k=Math.max(Math.min(k,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=k*this.zoomOnFactor,this.mode===M.d.ORTHOGRAPHIC_CAMERA){const Z=this.XZ().getEngine().getAspectRatio(this),c=k*this.zoomOnFactor/2;this.orthoLeft=-c*Z,this.orthoRight=c*Z,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:L.min,max:L.max,distance:k},c)}focusOn(Z){let c,L,k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Z.min){const k=Z||this.XZ().meshes;c=J.c.MinMax(k),L=G.h.Distance(c.min,c.max)}else{c=Z,L=Z.distance}this._target=J.c.Center(c),k||(this.maxZ=2*L)}createRigCamera(Z,c){let L=0;switch(this.cameraRigMode){case M.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.d.RIG_MODE_VR:L=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const k=new I(Z,this.alpha+L,this.beta,this.radius,this._target,this.XZ());return k._cameraRigParams={},k.isRigCamera=!0,k.rigParent=this,k.upVector=this.upVector,k.mode=this.mode,k.orthoLeft=this.orthoLeft,k.orthoRight=this.orthoRight,k.orthoBottom=this.orthoBottom,k.orthoTop=this.orthoTop,k}_updateRigCameras(){const Z=this._rigCameras[0],c=this._rigCameras[1];switch(Z.beta=c.beta=this.beta,this.cameraRigMode){case M.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.d.RIG_MODE_VR:Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const k=G.h.Distance(Z,c),N=this.XZ().getEngine().getAspectRatio(this),R=Math.tan(this.fov/2),V=R*N,p=.5*k*L,J=p*Math.sqrt(1+1/(V*V)),z=p*Math.sqrt(1+1/(R*R));return Math.max(J,z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,k.d)([(0,N.H)()],I.prototype,"alpha",void 0),(0,k.d)([(0,N.H)()],I.prototype,"beta",void 0),(0,k.d)([(0,N.H)()],I.prototype,"radius",void 0),(0,k.d)([(0,N.H)()],I.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,k.d)([(0,N.F)("target")],I.prototype,"_target",void 0),(0,k.d)([(0,N.x)("targetHost")],I.prototype,"_targetHost",void 0),(0,k.d)([(0,N.H)()],I.prototype,"inertialAlphaOffset",void 0),(0,k.d)([(0,N.H)()],I.prototype,"inertialBetaOffset",void 0),(0,k.d)([(0,N.H)()],I.prototype,"inertialRadiusOffset",void 0),(0,k.d)([(0,N.H)()],I.prototype,"lowerAlphaLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"upperAlphaLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"lowerBetaLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"upperBetaLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"lowerRadiusLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"upperRadiusLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"lowerTargetYLimit",void 0),(0,k.d)([(0,N.H)()],I.prototype,"inertialPanningX",void 0),(0,k.d)([(0,N.H)()],I.prototype,"inertialPanningY",void 0),(0,k.d)([(0,N.H)()],I.prototype,"pinchToPanMaxDistance",void 0),(0,k.d)([(0,N.H)()],I.prototype,"panningDistanceLimit",void 0),(0,k.d)([(0,N.F)()],I.prototype,"panningOriginTarget",void 0),(0,k.d)([(0,N.H)()],I.prototype,"panningInertia",void 0),(0,k.d)([(0,N.H)()],I.prototype,"zoomToMouseLocation",null),(0,k.d)([(0,N.H)()],I.prototype,"zoomOnFactor",void 0),(0,k.d)([(0,N.B)()],I.prototype,"targetScreenOffset",void 0),(0,k.d)([(0,N.H)()],I.prototype,"allowUpsideDown",void 0),(0,k.d)([(0,N.H)()],I.prototype,"useInputToRestoreState",void 0),(0,k.d)([(0,N.H)()],I.prototype,"restoreStateInterpolationFactor",void 0),(0,W.g)("BABYLON.ArcRotateCamera",I)},12737:(Z,c,L)=>{"use strict";L.d(c,{d:()=>G,h:()=>V});var k=L(11052),N=L(11242),R=L(11329),G={};class V{constructor(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=()=>{}}add(Z){const c=Z.getSimpleName();this.attached[c]?k.e.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl(this.noPreventDefault))}remove(Z){for(const c in this.attached){const L=this.attached[c];if(L===Z)return L.Oi(),L.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(Z){for(const c in this.attached){const L=this.attached[c];L.getClassName()===Z&&(L.Oi(),L.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(Z){const c=this.checkInputs;return()=>{c(),Z()}}attachInput(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)}attachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Z=!R.d.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z;for(const c in this.attached)this.attached[c].attachControl(Z)}}detachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].Oi(),Z&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Z in this.attached){const c=this.attached[Z];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Z){const c={};for(const L in this.attached){const Z=this.attached[L],k=N.e.Serialize(Z);c[Z.getClassName()]=k}Z.inputsmgr=c}parse(Z){const c=Z.inputsmgr;if(c){this.clear();for(const Z in c){const L=G[Z];if(L){const k=c[Z],R=N.e.Parse((()=>new L),k,null);this.add(R)}}}else for(const L in this.attached){const c=G[this.attached[L].getClassName()];if(c){const k=N.e.Parse((()=>new c),Z,null);this.remove(this.attached[L]),this.add(k)}}}}},12732:(Z,c,L)=>{"use strict";L.d(c,{c:()=>u});var k=L(11170),N=L(11173),R=L(10993),G=L(11558),V=L(12737),p=L(11621),J=L(11038);class z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Z){Z=J.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.XZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const L=c.event;if(!L.metaKey)if(c.type===p.d.KEYDOWN){if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){-1===this._keys.indexOf(L.keyCode)&&this._keys.push(L.keyCode),Z||L.preventDefault()}}else if(-1!==this.keysUp.indexOf(L.keyCode)||-1!==this.keysDown.indexOf(L.keyCode)||-1!==this.keysLeft.indexOf(L.keyCode)||-1!==this.keysRight.indexOf(L.keyCode)||-1!==this.keysUpward.indexOf(L.keyCode)||-1!==this.keysDownward.indexOf(L.keyCode)||-1!==this.keysRotateLeft.indexOf(L.keyCode)||-1!==this.keysRotateRight.indexOf(L.keyCode)||-1!==this.keysRotateUp.indexOf(L.keyCode)||-1!==this.keysRotateDown.indexOf(L.keyCode)){const c=this._keys.indexOf(L.keyCode);c>=0&&this._keys.splice(c,1),Z||L.preventDefault()}})))}Oi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let c=0;c<this._keys.length;c++){const L=this._keys[c],k=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(L)?Z._localDirection.wc(-k,0,0):-1!==this.keysUp.indexOf(L)?Z._localDirection.wc(0,0,k):-1!==this.keysRight.indexOf(L)?Z._localDirection.wc(k,0,0):-1!==this.keysDown.indexOf(L)?Z._localDirection.wc(0,0,-k):-1!==this.keysUpward.indexOf(L)?Z._localDirection.wc(0,k,0):-1!==this.keysDownward.indexOf(L)?Z._localDirection.wc(0,-k,0):-1!==this.keysRotateLeft.indexOf(L)?(Z._localDirection.wc(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(L)?(Z._localDirection.wc(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(L)?(Z._localDirection.wc(0,0,0),Z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(L)&&(Z._localDirection.wc(0,0,0),Z.cameraRotation.x+=this._getLocalRotation()),Z.XZ().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),R.h.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Z}}(0,k.d)([(0,N.H)()],z.prototype,"keysUp",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysUpward",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysDown",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysDownward",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysLeft",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysRight",void 0),(0,k.d)([(0,N.H)()],z.prototype,"rotationSpeed",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysRotateLeft",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysRotateRight",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysRotateUp",void 0),(0,k.d)([(0,N.H)()],z.prototype,"keysRotateDown",void 0),V.d.FreeCameraKeyboardMoveInput=z;var i=L(11027),t=L(11614);class E{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new i.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Z){Z=J.c.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),L=c.getInputElement();this._pointerInput||(this._pointerInput=k=>{const N=k.event,R="touch"===N.pointerType;if(!this.touchEnabled&&R)return;if(k.type!==t.e.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const G=N.target;if(k.type===t.e.POINTERDOWN){if(R&&-1!==this._activePointerId||!R&&-1!==this._currentActiveButton)return;this._activePointerId=N.pointerId;try{null===G||void 0===G||G.setPointerCapture(N.pointerId)}catch(V){}-1===this._currentActiveButton&&(this._currentActiveButton=N.button),this._previousPosition={x:N.clientX,y:N.clientY},Z||(N.preventDefault(),L&&L.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(k.event)}else if(k.type===t.e.POINTERUP){if(R&&this._activePointerId!==N.pointerId||!R&&this._currentActiveButton!==N.button)return;try{null===G||void 0===G||G.releasePointerCapture(N.pointerId)}catch(V){}this._currentActiveButton=-1,this._previousPosition=null,Z||N.preventDefault(),this._activePointerId=-1}else if(k.type===t.e.POINTERMOVE&&(this._activePointerId===N.pointerId||!R))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(k.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),L=(N.clientX-this._previousPosition.x)*c,k=N.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=L/this.angularSensibility,this.camera.cameraRotation.x+=k/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:L,offsetY:k}),this._previousPosition={x:N.clientX,y:N.clientY},Z||N.preventDefault()}}),this._onMouseMove=L=>{if(!c.isPointerLock)return;const k=this.camera._calculateHandednessMultiplier(),N=L.movementX*k;this.camera.cameraRotation.y+=N/this.angularSensibility;const R=L.movementY;this.camera.cameraRotation.x+=R/this.angularSensibility,this._previousPosition=null,Z||L.preventDefault()},this._observer=this.camera.XZ()._inputManager._addCameraPointerObserver(this._pointerInput,t.e.POINTERDOWN|t.e.POINTERUP|t.e.POINTERMOVE),L&&(this._contextMenuBind=Z=>this.onContextMenu(Z),L.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Z){Z.preventDefault()}Oi(){if(this._observer){if(this.camera.XZ()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,k.d)([(0,N.H)()],E.prototype,"buttons",void 0),(0,k.d)([(0,N.H)()],E.prototype,"angularSensibility",void 0),V.d.FreeCameraMouseInput=E;var x,q=L(11630);class O{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new i.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Z){Z=J.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==t.e.POINTERWHEEL)return;const L=c.event,k=L.deltaMode===q.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*k*L.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*k*L.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*k*L.deltaZ/this._normalize,L.preventDefault&&(Z||L.preventDefault())},this._observer=this.camera.XZ()._inputManager._addCameraPointerObserver(this._wheel,t.e.POINTERWHEEL)}Oi(){this._observer&&(this.camera.XZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,k.d)([(0,N.H)()],O.prototype,"wheelPrecisionX",void 0),(0,k.d)([(0,N.H)()],O.prototype,"wheelPrecisionY",void 0),(0,k.d)([(0,N.H)()],O.prototype,"wheelPrecisionZ",void 0),function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(x||(x={}));class w extends O{constructor(){super(...arguments),this._moveRelative=R.h.Zero(),this._rotateRelative=R.h.Zero(),this._moveScene=R.h.Zero(),this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Z){null===Z&&this._wheelXAction!==x.MoveRelative||(this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=Z)}get wheelXMoveRelative(){return this._wheelXAction!==x.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Z){null===Z&&this._wheelYAction!==x.MoveRelative||(this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=Z)}get wheelYMoveRelative(){return this._wheelYAction!==x.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Z){null===Z&&this._wheelZAction!==x.MoveRelative||(this._wheelZAction=x.MoveRelative,this._wheelZActionCoordinate=Z)}get wheelZMoveRelative(){return this._wheelZAction!==x.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Z){null===Z&&this._wheelXAction!==x.RotateRelative||(this._wheelXAction=x.RotateRelative,this._wheelXActionCoordinate=Z)}get wheelXRotateRelative(){return this._wheelXAction!==x.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Z){null===Z&&this._wheelYAction!==x.RotateRelative||(this._wheelYAction=x.RotateRelative,this._wheelYActionCoordinate=Z)}get wheelYRotateRelative(){return this._wheelYAction!==x.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Z){null===Z&&this._wheelZAction!==x.RotateRelative||(this._wheelZAction=x.RotateRelative,this._wheelZActionCoordinate=Z)}get wheelZRotateRelative(){return this._wheelZAction!==x.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Z){null===Z&&this._wheelXAction!==x.MoveScene||(this._wheelXAction=x.MoveScene,this._wheelXActionCoordinate=Z)}get wheelXMoveScene(){return this._wheelXAction!==x.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Z){null===Z&&this._wheelYAction!==x.MoveScene||(this._wheelYAction=x.MoveScene,this._wheelYActionCoordinate=Z)}get wheelYMoveScene(){return this._wheelYAction!==x.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Z){null===Z&&this._wheelZAction!==x.MoveScene||(this._wheelZAction=x.MoveScene,this._wheelZActionCoordinate=Z)}get wheelZMoveScene(){return this._wheelZAction!==x.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.uc(0),this._rotateRelative.uc(0),this._moveScene.uc(0),this._updateCamera(),this.camera.XZ().useRightHandedSystem&&(this._moveRelative.z*=-1);const Z=R.b.Zero();this.camera.getViewMatrix().invertToRef(Z);const c=R.h.Zero();R.h.TransformNormalToRef(this._moveRelative,Z,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Z,c,L){if(0===Z)return;if(null===c||null===L)return;let k=null;switch(c){case x.MoveRelative:k=this._moveRelative;break;case x.RotateRelative:k=this._rotateRelative;break;case x.MoveScene:k=this._moveScene}switch(L){case 0:k.set(Z,0,0);break;case 1:k.set(0,Z,0);break;case 2:k.set(0,0,Z)}}}(0,k.d)([(0,N.H)()],w.prototype,"wheelXMoveRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelYMoveRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelZMoveRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelXRotateRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelYRotateRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelZRotateRelative",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelXMoveScene",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelYMoveScene",null),(0,k.d)([(0,N.H)()],w.prototype,"wheelZMoveScene",null),V.d.FreeCameraMouseWheelInput=w;class M{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.c.IsSafari()}attachControl(Z){Z=J.c.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=L=>{const k=L.event,N="mouse"===k.pointerType||this._isSafari&&"undefined"===typeof k.pointerType;if(this.allowMouse||!N)if(L.type===t.e.POINTERDOWN){if(Z||k.preventDefault(),this._pointerPressed.push(k.pointerId),1!==this._pointerPressed.length)return;c={x:k.clientX,y:k.clientY}}else if(L.type===t.e.POINTERUP){Z||k.preventDefault();const L=this._pointerPressed.indexOf(k.pointerId);if(-1===L)return;if(this._pointerPressed.splice(L,1),0!=L)return;c=null,this._offsetX=null,this._offsetY=null}else if(L.type===t.e.POINTERMOVE){if(Z||k.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(k.pointerId))return;this._offsetX=k.clientX-c.x,this._offsetY=-(k.clientY-c.y)}}),this._observer=this.camera.XZ()._inputManager._addCameraPointerObserver(this._pointerInput,t.e.POINTERDOWN|t.e.POINTERUP|t.e.POINTERMOVE),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.addEventListener("blur",this._onLostFocus)}}Oi(){if(this._pointerInput){if(this._observer&&(this.camera.XZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Z=this.camera,c=Z._calculateHandednessMultiplier();Z.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=Z._computeLocalCameraSpeed(),L=new R.h(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);R.b.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(R.h.TransformCoordinates(L,Z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,k.d)([(0,N.H)()],M.prototype,"touchAngularSensibility",void 0),(0,k.d)([(0,N.H)()],M.prototype,"touchMoveSensibility",void 0),V.d.FreeCameraTouchInput=M;class P extends V.h{constructor(Z){super(Z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new z),this}addMouse(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new E(Z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new w,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new M),this}clear(){super.clear(),this._mouseInput=null}}var j=L(11012),o=L(11110);class u extends G.e{get angularSensibility(){const Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0}set angularSensibility(Z){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const c=this.inputs.attached.keyboard;c&&(c.keysUp=Z)}get keysUpward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]}set keysUpward(Z){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const c=this.inputs.attached.keyboard;c&&(c.keysDown=Z)}get keysDownward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]}set keysDownward(Z){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRight=Z)}get keysRotateLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]}set keysRotateLeft(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=Z)}get keysRotateRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]}set keysRotateRight(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=Z)}get keysRotateUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateUp:[]}set keysRotateUp(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=Z)}get keysRotateDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateDown:[]}set keysRotateDown(Z){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=Z)}constructor(Z,c,L){var k;super(Z,c,L,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),k=this,this.ellipsoid=new R.h(.5,1,.5),this.ellipsoidOffset=new R.h(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=R.h.Zero(),this._diffPosition=R.h.Zero(),this._newPosition=R.h.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k._newPosition.R(c),k._newPosition.subtractToRef(k._oldPosition,k._diffPosition),k._diffPosition.length()>o.c.CollisionsEpsilon&&(k.position.addToRef(k._diffPosition,k._deferredPositionUpdate),k._deferOnly?k._deferredUpdated=!0:k.position.R(k._deferredPositionUpdate),k.VE&&L&&k.VE(L))},this.inputs=new P(this),this.inputs.addKeyboard().addMouse()}attachControl(Z,c){c=J.c.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}Oi(){this.inputs.detachElement(),this.cameraDirection=new R.h(0,0,0),this.cameraRotation=new R.f(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Z){this._collisionMask=isNaN(Z)?-1:Z}_collideWithWorld(Z){let c;c=this.parent?R.h.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const L=this.XZ().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let k=Z;this.applyGravity&&(k=Z.add(this.XZ().gravity)),L.getNewPosition(this._oldPosition,k,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=R.h.Zero(),this._transformedDirection=R.h.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Z){this._needMoveForGravity=Z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.XZ().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Uc"}}(0,k.d)([(0,N.F)()],u.prototype,"ellipsoid",void 0),(0,k.d)([(0,N.F)()],u.prototype,"ellipsoidOffset",void 0),(0,k.d)([(0,N.H)()],u.prototype,"checkCollisions",void 0),(0,k.d)([(0,N.H)()],u.prototype,"applyGravity",void 0),(0,j.g)("BABYLON.FreeCamera",u)},13355:(Z,c,L)=>{"use strict";L.d(c,{e:()=>R});var k=L(11336),N=L(13363);class R{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=L,this.rz=[],this._maxBlockCapacity=c||64,this._selectionContent=new k.c(1024),this._creationFunc=Z}update(Z,c,L){N.e._CreateBlocks(Z,c,L,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}mJ(Z){for(let c=0;c<this.Zz.length;c++){this.Zz[c].addEntry(Z)}}sJ(Z){for(let c=0;c<this.Zz.length;c++){this.Zz[c].removeEntry(Z)}}select(Z,c){this._selectionContent.reset();for(let L=0;L<this.Zz.length;L++){this.Zz[L].select(Z,this._selectionContent,c)}return c?this._selectionContent.concat(this.rz):this._selectionContent.concatWithNoDuplicate(this.rz),this._selectionContent}intersects(Z,c,L){this._selectionContent.reset();for(let k=0;k<this.Zz.length;k++){this.Zz[k].intersects(Z,c,this._selectionContent,L)}return L?this._selectionContent.concat(this.rz):this._selectionContent.concatWithNoDuplicate(this.rz),this._selectionContent}intersectsRay(Z){this._selectionContent.reset();for(let c=0;c<this.Zz.length;c++){this.Zz[c].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.rz),this._selectionContent}}R.CreationFuncForMeshes=(Z,c)=>{const L=Z.getBoundingInfo();!Z.isBlocked&&L.boundingBox.intersectsMinMax(c.mz,c.Az)&&c.entries.push(Z)},R.CreationFuncForSubMeshes=(Z,c)=>{Z.getBoundingInfo().boundingBox.intersectsMinMax(c.mz,c.Az)&&c.entries.push(Z)}},13363:(Z,c,L)=>{"use strict";L.d(c,{e:()=>R});var k=L(10993),N=L(11210);class R{constructor(Z,c,L,k,N,R){this.entries=[],this.bz=new Array,this._capacity=L,this._depth=k,this._maxDepth=N,this._creationFunc=R,this._minPoint=Z,this._maxPoint=c,this.bz.push(Z.clone()),this.bz.push(c.clone()),this.bz.push(Z.clone()),this.bz[2].x=c.x,this.bz.push(Z.clone()),this.bz[3].y=c.y,this.bz.push(Z.clone()),this.bz[4].z=c.z,this.bz.push(c.clone()),this.bz[5].z=Z.z,this.bz.push(c.clone()),this.bz[6].x=Z.x,this.bz.push(c.clone()),this.bz[7].y=Z.y}get kL(){return this._capacity}get mz(){return this._minPoint}get Az(){return this._maxPoint}addEntry(Z){if(this.Zz)for(let c=0;c<this.Zz.length;c++){this.Zz[c].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.kL&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Z){if(this.Zz){for(let c=0;c<this.Zz.length;c++){this.Zz[c].removeEntry(Z)}return}const c=this.entries.indexOf(Z);c>-1&&this.entries.splice(c,1)}addEntries(Z){for(let c=0;c<Z.length;c++){const L=Z[c];this.addEntry(L)}}select(Z,c,L){if(N.e.IsInFrustum(this.bz,Z)){if(this.Zz){for(let k=0;k<this.Zz.length;k++){this.Zz[k].select(Z,c,L)}return}L?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(Z,c,L,k){if(N.e.IntersectsSphere(this._minPoint,this._maxPoint,Z,c)){if(this.Zz){for(let N=0;N<this.Zz.length;N++){this.Zz[N].intersects(Z,c,L,k)}return}k?L.concat(this.entries):L.concatWithNoDuplicate(this.entries)}}intersectsRay(Z,c){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Zz){for(let L=0;L<this.Zz.length;L++){this.Zz[L].intersectsRay(Z,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){R._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Z,c,L,N,G,V,p,J){p.Zz=new Array;const z=new k.h((c.x-Z.x)/2,(c.y-Z.y)/2,(c.z-Z.z)/2);for(let k=0;k<2;k++)for(let c=0;c<2;c++)for(let i=0;i<2;i++){const t=Z.add(z.multiplyByFloats(k,c,i)),E=Z.add(z.multiplyByFloats(k+1,c+1,i+1)),x=new R(t,E,N,G+1,V,J);x.addEntries(L),p.Zz.push(x)}}}},13371:(Z,c,L)=>{"use strict";L.d(c,{d:()=>z});var k=L(11588),N=L(10993),R=L(11282),G=L(12522),V=L(11386),p=L(13355),J=L(11023);k.d.prototype.createOrUpdateSelectionOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,L=this._getComponent(V.c.NAME_OCTREE);L||(L=new z(this),this.o(L)),this.dz||(this.dz=new p.e(p.e.CreationFuncForMeshes,Z,c));const k=this.getWorldExtends();return this.dz.update(k.min,k.max,this.meshes),this.dz},Object.defineProperty(k.d.prototype,"selectionOctree",{get:function(){return this.dz},enumerable:!0,configurable:!0}),R.d.prototype.createOrUpdateSubmeshesOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const L=this.XZ();let k=L._getComponent(V.c.NAME_OCTREE);k||(k=new z(L),L.o(k)),this._submeshesOctree||(this._submeshesOctree=new p.e(p.e.CreationFuncForSubMeshes,Z,c)),this.Jc(!0);const N=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(N.minimumWorld,N.maximumWorld,this.ec),this._submeshesOctree};class z{constructor(Z){this.name=V.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new G.c(N.h.Zero(),new N.h(1,1,1)),(Z=Z||J.d.LastCreatedScene)&&(this.LL=Z,this.LL.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.LL.getActiveSubMeshCandidates=Z=>this.getActiveSubMeshCandidates(Z),this.LL.getCollidingSubMeshCandidates=(Z,c)=>this.getCollidingSubMeshCandidates(Z,c),this.LL.getIntersectingSubMeshCandidates=(Z,c)=>this.getIntersectingSubMeshCandidates(Z,c))}register(){this.LL.onMeshRemovedObservable.add((Z=>{const c=this.LL.selectionOctree;if(void 0!==c&&null!==c){const L=c.rz.indexOf(Z);-1!==L&&c.rz.splice(L,1)}})),this.LL.onMeshImportedObservable.add((Z=>{const c=this.LL.selectionOctree;void 0!==c&&null!==c&&c.mJ(Z)}))}getActiveMeshCandidates(){var Z;return(null===(Z=this.LL.dz)||void 0===Z?void 0:Z.select(this.LL.frustumPlanes))||this.LL._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Z){if(Z._submeshesOctree&&Z.useOctreeForRenderingSelection){return Z._submeshesOctree.select(this.LL.frustumPlanes)}return this.LL._getDefaultSubMeshCandidates(Z)}getIntersectingSubMeshCandidates(Z,c){if(Z._submeshesOctree&&Z.useOctreeForPicking){G.c.TransformToRef(c,Z.getWorldMatrix(),this._tempRay);return Z._submeshesOctree.intersectsRay(this._tempRay)}return this.LL._getDefaultSubMeshCandidates(Z)}getCollidingSubMeshCandidates(Z,c){if(Z._submeshesOctree&&Z.useOctreeForCollisions){const L=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return Z._submeshesOctree.intersects(c._basePointWorld,L)}return this.LL._getDefaultSubMeshCandidates(Z)}rebuild(){}dispose(){}}},12522:(Z,c,L)=>{"use strict";L.d(c,{c:()=>E});var k=L(11588),N=L(11329),R=L(10999),G=L(10993),V=L(11008),p=L(11199),J=L(11304),z=L(11023),i=L(11637);const t={internalPickerForMesh:void 0};class E{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.e;this.origin=Z,this.direction=c,this.length=L,this.epsilon=k}clone(){return new E(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const k=E._TmpVector3[0].wc(Z.x-L,Z.y-L,Z.z-L),N=E._TmpVector3[1].wc(c.x+L,c.y+L,c.z+L);let R,G,V,p,J=0,z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<k.x||this.origin.x>N.x)return!1}else if(R=1/this.direction.x,G=(k.x-this.origin.x)*R,V=(N.x-this.origin.x)*R,V===-1/0&&(V=1/0),G>V&&(p=G,G=V,V=p),J=Math.max(G,J),z=Math.min(V,z),J>z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<k.y||this.origin.y>N.y)return!1}else if(R=1/this.direction.y,G=(k.y-this.origin.y)*R,V=(N.y-this.origin.y)*R,V===-1/0&&(V=1/0),G>V&&(p=G,G=V,V=p),J=Math.max(G,J),z=Math.min(V,z),J>z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<k.z||this.origin.z>N.z)return!1}else if(R=1/this.direction.z,G=(k.z-this.origin.z)*R,V=(N.z-this.origin.z)*R,V===-1/0&&(V=1/0),G>V&&(p=G,G=V,V=p),J=Math.max(G,J),z=Math.min(V,z),J>z)return!1;return!0}intersectsBox(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Z.minimum,Z.maximum,c)}intersectsSphere(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=Z.center.x-this.origin.x,k=Z.center.y-this.origin.y,N=Z.center.z-this.origin.z,R=L*L+k*k+N*N,G=Z.radius+c,V=G*G;if(R<=V)return!0;const p=L*this.direction.x+k*this.direction.y+N*this.direction.z;if(p<0)return!1;return R-p*p<=V}intersectsTriangle(Z,c,L){const k=E._TmpVector3[0],N=E._TmpVector3[1],R=E._TmpVector3[2],V=E._TmpVector3[3],J=E._TmpVector3[4];c.subtractToRef(Z,k),L.subtractToRef(Z,N),G.h.CrossToRef(this.direction,N,R);const z=G.h.Dot(k,R);if(0===z)return null;const i=1/z;this.origin.subtractToRef(Z,V);const t=G.h.Dot(V,R)*i;if(t<-this.epsilon||t>1+this.epsilon)return null;G.h.CrossToRef(V,k,J);const x=G.h.Dot(this.direction,J)*i;if(x<-this.epsilon||t+x>1+this.epsilon)return null;const q=G.h.Dot(N,J)*i;return q>this.length?null:new p.d(1-t-x,t,q)}intersectsPlane(Z){let c;const L=G.h.Dot(Z.kc,this.direction);if(Math.abs(L)<9.99999997475243e-7)return null;{const k=G.h.Dot(Z.kc,this.origin);return c=(-Z.d-k)/L,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Z){case"y":{const Z=(this.origin.y-c)/this.direction.y;return Z>0?null:new G.h(this.origin.x+this.direction.x*-Z,c,this.origin.z+this.direction.z*-Z)}case"x":{const Z=(this.origin.x-c)/this.direction.x;return Z>0?null:new G.h(c,this.origin.y+this.direction.y*-Z,this.origin.z+this.direction.z*-Z)}case"z":{const Z=(this.origin.z-c)/this.direction.z;return Z>0?null:new G.h(this.origin.x+this.direction.x*-Z,this.origin.y+this.direction.y*-Z,c)}default:return null}}intersectsMesh(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=G.d.Matrix[0];return Z.getWorldMatrix().invertToRef(V),this._tmpRay?E.TransformToRef(this,V,this._tmpRay):this._tmpRay=E.Transform(this,V),Z.intersects(this._tmpRay,c,L,k,N,R)}intersectsMeshes(Z,c,L){L?L.length=0:L=[];for(let k=0;k<Z.length;k++){const N=this.intersectsMesh(Z[k],c);N.hit&&L.push(N)}return L.sort(this._comparePickingInfo),L}_comparePickingInfo(Z,c){return Z.distance<c.distance?-1:Z.distance>c.distance?1:0}intersectionSegment(Z,c,L){const k=this.origin,N=G.d.Mc[0],R=G.d.Mc[1],V=G.d.Mc[2],p=G.d.Mc[3];c.subtractToRef(Z,N),this.direction.scaleToRef(E._Rayl,V),k.addToRef(V,R),Z.subtractToRef(k,p);const J=G.h.Dot(N,N),z=G.h.Dot(N,V),i=G.h.Dot(V,V),t=G.h.Dot(N,p),x=G.h.Dot(V,p),q=J*i-z*z;let O,w,M=q,P=q;q<E._Smallnum?(O=0,M=1,w=x,P=i):(O=z*x-i*t,w=J*x-z*t,O<0?(O=0,w=x,P=i):O>M&&(O=M,w=x+z,P=i)),w<0?(w=0,-t<0?O=0:-t>J?O=M:(O=-t,M=J)):w>P&&(w=P,-t+z<0?O=0:-t+z>J?O=M:(O=-t+z,M=J));const j=Math.abs(O)<E._Smallnum?0:O/M,o=Math.abs(w)<E._Smallnum?0:w/P,u=G.d.Mc[4];V.scaleToRef(o,u);const X=G.d.Mc[5];N.scaleToRef(j,X),X.addInPlace(p);const h=G.d.Mc[6];X.subtractToRef(u,h);return o>0&&o<=this.length&&h.lengthSquared()<L*L?X.length():-1}update(Z,c,L,k,N,R,V){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){E._RayDistant||(E._RayDistant=E.Zero()),E._RayDistant.unprojectRayToRef(Z,c,L,k,G.b.IdentityReadOnly,R,V);const p=G.d.Matrix[0];N.invertToRef(p),E.TransformToRef(E._RayDistant,p,this)}else this.unprojectRayToRef(Z,c,L,k,N,R,V);return this}static Zero(){return new E(G.h.Zero(),G.h.Zero())}static CreateNew(Z,c,L,k,N,R,G){return E.Zero().update(Z,c,L,k,N,R,G)}static CreateNewFromTo(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.b.IdentityReadOnly;const k=new E(new G.h(0,0,0),new G.h(0,0,0));return E.CreateFromToToRef(Z,c,k,L)}static CreateFromToToRef(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.b.IdentityReadOnly;L.origin.R(Z);const N=c.subtractToRef(Z,L.direction),R=Math.sqrt(N.x*N.x+N.y*N.y+N.z*N.z);return L.length=R,L.direction.normalize(),E.TransformToRef(L,k,L)}static Transform(Z,c){const L=new E(new G.h(0,0,0),new G.h(0,0,0));return E.TransformToRef(Z,c,L),L}static TransformToRef(Z,c,L){G.h.TransformCoordinatesToRef(Z.origin,c,L.origin),G.h.TransformNormalToRef(Z.direction,c,L.direction),L.length=Z.length,L.epsilon=Z.epsilon;const k=L.direction,N=k.length();if(0!==N&&1!==N){const Z=1/N;k.x*=Z,k.y*=Z,k.z*=Z,L.length*=N}return L}unprojectRayToRef(Z,c,L,k,N,R,V){const p=G.d.Matrix[0];N.multiplyToRef(R,p),p.multiplyToRef(V,p),p.invert();const J=z.d.LastCreatedEngine,i=G.d.Mc[0];i.x=Z/L*2-1,i.y=-(c/k*2-1),i.z=null!==J&&void 0!==J&&J.useReverseDepthBuffer?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const t=G.d.Mc[1].wc(i.x,i.y,1-1e-8),E=G.d.Mc[2],x=G.d.Mc[3];G.h._UnprojectFromInvertedMatrixToRef(i,p,E),G.h._UnprojectFromInvertedMatrixToRef(t,p,x),this.origin.R(E),x.subtractToRef(E,this.direction),this.direction.normalize()}}function x(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=E.Zero();return q(Z,c,L,k,G,N,R),G}function q(Z,c,L,k,N,R){let V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=Z.getEngine();if(!R&&!(R=Z.activeCamera))return Z;const z=R.viewport,i=J.getRenderHeight(),{x:t,y:E,width:x,height:q}=z.toGlobal(J.getRenderWidth(),i),O=1/J.getHardwareScalingLevel();return c=c*O-t,L=L*O-(i-E-q),N.update(c,L,x,q,k||G.b.IdentityReadOnly,V?G.b.IdentityReadOnly:R.getViewMatrix(),R.getProjectionMatrix(),p),Z}function O(Z,c,L,k,N){if(!J.e)return Z;const R=Z.getEngine();if(!N&&!(N=Z.activeCamera))throw new Error("Active camera not set");const V=N.viewport,p=R.getRenderHeight(),{x:z,y:i,width:t,height:E}=V.toGlobal(R.getRenderWidth(),p),x=G.b.Identity(),q=1/R.getHardwareScalingLevel();return c=c*q-z,L=L*q-(p-i-E),k.update(c,L,t,E,x,x,N.getProjectionMatrix()),Z}function w(Z,c,L,k,N,R,G,V){const p=c(k,L.enableDistantPicking),J=L.intersects(p,N,G,R,k,V);return J&&J.hit?!N&&null!=Z&&J.distance>=Z.distance?null:J:null}function M(Z,c,L,k,N,R){let V=null;const p=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),z=Z.cameraToUseForPointers||Z.activeCamera,i=t.internalPickerForMesh||w;for(let J=0;J<Z.meshes.length;J++){const t=Z.meshes[J];if(L){if(!L(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.ep)continue;const E=p&&t.isWorldMatrixCameraDependent(),x=t.Jc(E,z);if(t.hasThinInstances&&t.thinInstanceEnablePicking){const Z=i(V,c,t,x,!0,!0,R);if(Z){if(N)return Z;const p=G.d.Matrix[1],J=t.thinInstanceGetWorldMatrices();for(let Z=0;Z<J.length;Z++){if(L&&!L(t,Z))continue;J[Z].multiplyToRef(x,p);const G=i(V,c,t,p,k,N,R,!0);if(G&&(V=G,V.thinInstanceIndex=Z,k))return V}}}else{const Z=i(V,c,t,x,k,N,R);if(Z&&(V=Z,k))return V}}return V||new J.e}function P(Z,c,L,k){if(!J.e)return null;const N=[],R=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),V=Z.cameraToUseForPointers||Z.activeCamera,p=t.internalPickerForMesh||w;for(let J=0;J<Z.meshes.length;J++){const z=Z.meshes[J];if(L){if(!L(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.ep)continue;const i=R&&z.isWorldMatrixCameraDependent(),t=z.Jc(i,V);if(z.hasThinInstances&&z.thinInstanceEnablePicking){if(p(null,c,z,t,!0,!0,k)){const Z=G.d.Matrix[1],R=z.thinInstanceGetWorldMatrices();for(let G=0;G<R.length;G++){if(L&&!L(z,G))continue;R[G].multiplyToRef(t,Z);const V=p(null,c,z,Z,!1,!1,k,!0);V&&(V.thinInstanceIndex=G,N.push(V))}}}else{const Z=p(null,c,z,t,!1,!1,k);Z&&N.push(Z)}}return N}function j(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;k||(k=Z.getWorldMatrix()),c.length=L,N?c.origin.R(N):c.origin.R(Z.position);const R=G.d.Mc[2];R.set(0,0,Z._scene.useRightHandedSystem?-1:1);const V=G.d.Mc[3];return G.h.TransformNormalToRef(R,k,V),G.h.NormalizeToRef(V,c.direction),c}var o,u;E._TmpVector3=(0,V.b)(6,G.h.Zero),E._RayDistant=E.Zero(),E._Smallnum=1e-8,E._Rayl=1e9,o=k.d,(u=N.d)&&(u.prototype.getForwardRay=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;return j(this,new E(G.h.Zero(),G.h.Zero(),Z),Z,c,L)},u.prototype.getForwardRayToRef=function(Z){return j(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),o&&(i.d._IsPickingAvailable=!0,o.prototype.createPickingRay=function(Z,c,L,k){return x(this,Z,c,L,k,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),k.d.prototype.createPickingRayToRef=function(Z,c,L,k,N){return q(this,Z,c,L,k,N,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},k.d.prototype.createPickingRayInCameraSpace=function(Z,c,L){return function(Z,c,L,k){const N=E.Zero();return O(Z,c,L,N,k),N}(this,Z,c,L)},k.d.prototype.createPickingRayInCameraSpaceToRef=function(Z,c,L,k){return O(this,Z,c,L,k)},k.d.prototype.pickWithBoundingInfo=function(Z,c,L,k,N){return function(Z,c,L,k,N,R){if(!J.e)return null;const V=M(Z,(k=>(Z._tempPickingRay||(Z._tempPickingRay=E.Zero()),q(Z,c,L,k,Z._tempPickingRay,R||null),Z._tempPickingRay)),k,N,!0);return V&&(V.ray=x(Z,c,L,G.b.Identity(),R||null)),V}(this,Z,c,L,k,N)},k.d.prototype.gL=function(Z,c,L,k,N,R){return function(Z,c,L,k,N,R,V){const p=M(Z,((k,N)=>(Z._tempPickingRay||(Z._tempPickingRay=E.Zero()),q(Z,c,L,k,Z._tempPickingRay,R||null,!1,N),Z._tempPickingRay)),k,N,!1,V);return p&&(p.ray=x(Z,c,L,G.b.Identity(),R||null)),p}(this,Z,c,L,k,N,R)},k.d.prototype.pickWithRay=function(Z,c,L,k){return function(Z,c,L,k,N){const R=M(Z,(L=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=G.b.Identity()),L.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=E.Zero()),E.TransformToRef(c,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),L,k,!1,N);return R&&(R.ray=c),R}(this,Z,c,L,k)},k.d.prototype.multiPick=function(Z,c,L,k,N){return function(Z,c,L,k,N,R){return P(Z,(k=>x(Z,c,L,k,N||null)),k,R)}(this,Z,c,L,k,N)},k.d.prototype.multiPickWithRay=function(Z,c,L){return function(Z,c,L,k){return P(Z,(L=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=G.b.Identity()),L.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=E.Zero()),E.TransformToRef(c,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),L,k)}(this,Z,c,L)}},12792:(Z,c,L)=>{"use strict";var k=L(11139),N=L(11052),R=L(11081),G=L(11155),V=L(11110),p=L(11144);V.c.prototype._partialLoadFile=function(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Z,(Z=>{L[c]=Z,L._internalCount++,6===L._internalCount&&k(L)}),void 0,void 0,!0,((Z,c)=>{N&&Z&&N(Z.status+" "+Z.statusText,c)}))},V.c.prototype._cascadeLoadFiles=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=[];N._internalCount=0;for(let R=0;R<6;R++)this._partialLoadFile(L[R],R,N,c,k)},V.c.prototype._cascadeLoadImgs=function(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5?arguments[5]:void 0;const G=[];G._internalCount=0;for(let V=0;V<6;V++)this._partialLoadImg(k[V],V,G,Z,c,L,N,R)},V.c.prototype._partialLoadImg=function(Z,c,L,k,N,V){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const z=(0,G.d)();(0,R.s)(Z,(Z=>{L[c]=Z,L._internalCount++,k&&k.removePendingData(z),6===L._internalCount&&V&&V(N,L)}),((Z,c)=>{k&&k.removePendingData(z),p&&p(Z,c)}),k?k.offlineProvider:null,J),k&&k.addPendingData(z)},V.c.prototype.createCubeTextureBase=function(Z,c,L,R){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,O=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,w=arguments.length>14&&void 0!==arguments[14]&&arguments[14],M=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const P=x||new k.e(this,7);P.isCube=!0,P.url=Z,P.generateMipMaps=!R,P._lodGenerationScale=t,P._lodGenerationOffset=E,P._useSRGBBuffer=!!w&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!R),P!==x&&(P.label=Z.substring(0,60)),this._doNotHandleContextLost||(P._extension=z,P._files=L,P._buffer=M);const j=Z;this._transformTextureUrl&&!x&&(Z=this._transformTextureUrl(Z));const o=z??function(Z){const c=Z.split("?")[0],L=c.lastIndexOf(".");return L>-1?c.substring(L).toLowerCase():""}(Z),u=(0,p.e)(o),X=(Z,c)=>{P.dispose(),V?V(Z,c):Z&&N.e.Warn(Z)},h=(k,V)=>{Z===j?k&&X(k.status+" "+k.statusText,V):(N.e.Warn(`Failed to load ${Z}, falling back to the ${j}`),this.createCubeTextureBase(j,c,L,!!R,G,X,J,z,i,t,E,P,q,O,w,M))};if(u)u.then((k=>{const N=Z=>{q&&q(P,Z),k.loadCubeData(Z,P,i,G,((Z,c)=>{X(Z,c)}))};M?N(M):L&&6===L.length?k.supportCascades?this._cascadeLoadFiles(c,(Z=>N(Z.map((Z=>new Uint8Array(Z))))),L,X):X("Textures type does not support cascades."):this._loadFile(Z,(Z=>N(new Uint8Array(Z))),void 0,void 0,!0,h)}));else{if(!L||0===L.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,P,((Z,c)=>{O&&O(Z,c)}),L,X)}return this._internalTexturesCache.push(P),P}},13380:(Z,c,L)=>{"use strict";L(11052);var k=L(11395);L(11139),L(11194),L(11019),L(11444),L(11401);k.c},12817:(Z,c,L)=>{"use strict";L.d(c,{b:()=>N});var k=L(11012);class N{constructor(Z){this.value=this._toInt(Z)}_toInt(Z){return 0|Z}add(Z){return new N(this.value+Z.value)}yL(Z){return new N(this.value-Z.value)}multiply(Z){return new N(Math.imul(this.value,Z.value))}divide(Z){return new N(this.value/Z.value)}getClassName(){return N.ClassName}equals(Z){return this.value===Z.value}static FromValue(Z){return new N(Z)}toString(){return this.value.toString()}}N.ClassName="FlowGraphInteger",(0,k.g)("FlowGraphInteger",N)},12834:(Z,c,L)=>{"use strict";L.d(c,{e:()=>N,g:()=>R});var k=L(10993);class N{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.zt=Z}get m(){return this.zt}transformVector(Z){return this.transformVectorToRef(Z,new k.f)}transformVectorToRef(Z,c){return c.x=Z.x*this.zt[0]+Z.y*this.zt[1],c.y=Z.x*this.zt[2]+Z.y*this.zt[3],c}xc(){return this.toArray()}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)Z[c]=this.zt[c];return Z}vL(Z){for(let c=0;c<4;c++)this.zt[c]=Z[c];return this}multiplyToRef(Z,c){const L=Z.zt,k=this.zt,N=c.zt;return N[0]=L[0]*k[0]+L[1]*k[2],N[1]=L[0]*k[1]+L[1]*k[3],N[2]=L[2]*k[0]+L[3]*k[2],N[3]=L[2]*k[1]+L[3]*k[3],c}multiply(Z){return this.multiplyToRef(Z,new N)}divideToRef(Z,c){const L=this.zt,k=Z.zt,N=c.zt;return N[0]=L[0]/k[0],N[1]=L[1]/k[1],N[2]=L[2]/k[2],N[3]=L[3]/k[3],c}divide(Z){return this.divideToRef(Z,new N)}addToRef(Z,c){const L=this.zt,k=Z.m,N=c.m;return N[0]=L[0]+k[0],N[1]=L[1]+k[1],N[2]=L[2]+k[2],N[3]=L[3]+k[3],c}add(Z){return this.addToRef(Z,new N)}subtractToRef(Z,c){const L=this.zt,k=Z.m,N=c.m;return N[0]=L[0]-k[0],N[1]=L[1]-k[1],N[2]=L[2]-k[2],N[3]=L[3]-k[3],c}yL(Z){return this.subtractToRef(Z,new N)}transpose(){const Z=this.zt;return new N([Z[0],Z[2],Z[1],Z[3]])}determinant(){const Z=this.zt;return Z[0]*Z[3]-Z[1]*Z[2]}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const c=this.zt,L=1/Z;return new N([c[3]*L,-c[1]*L,-c[2]*L,c[0]*L])}equals(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.zt,k=Z.m;return 0===c?L[0]===k[0]&&L[1]===k[1]&&L[2]===k[2]&&L[3]===k[3]:Math.abs(L[0]-k[0])<c&&Math.abs(L[1]-k[1])<c&&Math.abs(L[2]-k[2])<c&&Math.abs(L[3]-k[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.zt.join(", ")})`}}class R{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.zt=Z}get m(){return this.zt}transformVector(Z){return this.transformVectorToRef(Z,new k.h)}transformVectorToRef(Z,c){const L=this.zt;return c.x=Z.x*L[0]+Z.y*L[1]+Z.z*L[2],c.y=Z.x*L[3]+Z.y*L[4]+Z.z*L[5],c.z=Z.x*L[6]+Z.y*L[7]+Z.z*L[8],c}multiplyToRef(Z,c){const L=Z.zt,k=this.zt,N=c.m;return N[0]=L[0]*k[0]+L[1]*k[3]+L[2]*k[6],N[1]=L[0]*k[1]+L[1]*k[4]+L[2]*k[7],N[2]=L[0]*k[2]+L[1]*k[5]+L[2]*k[8],N[3]=L[3]*k[0]+L[4]*k[3]+L[5]*k[6],N[4]=L[3]*k[1]+L[4]*k[4]+L[5]*k[7],N[5]=L[3]*k[2]+L[4]*k[5]+L[5]*k[8],N[6]=L[6]*k[0]+L[7]*k[3]+L[8]*k[6],N[7]=L[6]*k[1]+L[7]*k[4]+L[8]*k[7],N[8]=L[6]*k[2]+L[7]*k[5]+L[8]*k[8],c}multiply(Z){return this.multiplyToRef(Z,new R)}divideToRef(Z,c){const L=this.zt,k=Z.m,N=c.m;return N[0]=L[0]/k[0],N[1]=L[1]/k[1],N[2]=L[2]/k[2],N[3]=L[3]/k[3],N[4]=L[4]/k[4],N[5]=L[5]/k[5],N[6]=L[6]/k[6],N[7]=L[7]/k[7],N[8]=L[8]/k[8],c}divide(Z){return this.divideToRef(Z,new R)}addToRef(Z,c){const L=this.zt,k=Z.m,N=c.m;return N[0]=L[0]+k[0],N[1]=L[1]+k[1],N[2]=L[2]+k[2],N[3]=L[3]+k[3],N[4]=L[4]+k[4],N[5]=L[5]+k[5],N[6]=L[6]+k[6],N[7]=L[7]+k[7],N[8]=L[8]+k[8],c}add(Z){return this.addToRef(Z,new R)}subtractToRef(Z,c){const L=this.zt,k=Z.m,N=c.m;return N[0]=L[0]-k[0],N[1]=L[1]-k[1],N[2]=L[2]-k[2],N[3]=L[3]-k[3],N[4]=L[4]-k[4],N[5]=L[5]-k[5],N[6]=L[6]-k[6],N[7]=L[7]-k[7],N[8]=L[8]-k[8],c}yL(Z){return this.subtractToRef(Z,new R)}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)Z[c]=this.zt[c];return Z}xc(){return this.toArray()}vL(Z){for(let c=0;c<9;c++)this.zt[c]=Z[c];return this}transpose(){const Z=this.zt;return new R([Z[0],Z[3],Z[6],Z[1],Z[4],Z[7],Z[2],Z[5],Z[8]])}determinant(){const Z=this.zt;return Z[0]*(Z[4]*Z[8]-Z[5]*Z[7])-Z[1]*(Z[3]*Z[8]-Z[5]*Z[6])+Z[2]*(Z[3]*Z[7]-Z[4]*Z[6])}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const c=this.zt,L=1/Z;return new R([(c[4]*c[8]-c[5]*c[7])*L,(c[2]*c[7]-c[1]*c[8])*L,(c[1]*c[5]-c[2]*c[4])*L,(c[5]*c[6]-c[3]*c[8])*L,(c[0]*c[8]-c[2]*c[6])*L,(c[2]*c[3]-c[0]*c[5])*L,(c[3]*c[7]-c[4]*c[6])*L,(c[1]*c[6]-c[0]*c[7])*L,(c[0]*c[4]-c[1]*c[3])*L])}equals(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.zt,k=Z.m;return 0===c?L[0]===k[0]&&L[1]===k[1]&&L[2]===k[2]&&L[3]===k[3]&&L[4]===k[4]&&L[5]===k[5]&&L[6]===k[6]&&L[7]===k[7]&&L[8]===k[8]:Math.abs(L[0]-k[0])<c&&Math.abs(L[1]-k[1])<c&&Math.abs(L[2]-k[2])<c&&Math.abs(L[3]-k[3])<c&&Math.abs(L[4]-k[4])<c&&Math.abs(L[5]-k[5])<c&&Math.abs(L[6]-k[6])<c&&Math.abs(L[7]-k[7])<c&&Math.abs(L[8]-k[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.zt.join(", ")})`}}},12836:(Z,c,L)=>{"use strict";var k;function N(Z,c,L,k){switch(c){case"Animation":return k?Z.animations.find((Z=>Z.uniqueId===L))??null:Z.animations[L]??null;case"AnimationGroup":return k?Z.animationGroups.find((Z=>Z.uniqueId===L))??null:Z.animationGroups[L]??null;case"Mesh":return k?Z.meshes.find((Z=>Z.uniqueId===L))??null:Z.meshes[L]??null;case"Material":return k?Z.materials.find((Z=>Z.uniqueId===L))??null:Z.materials[L]??null;case"vJ":return k?Z.cameras.find((Z=>Z.uniqueId===L))??null:Z.cameras[L]??null;case"Light":return k?Z.lights.find((Z=>Z.uniqueId===L))??null:Z.lights[L]??null;default:return null}}L.d(c,{b:()=>N}),function(Z){Z.Animation="Animation",Z.AnimationGroup="AnimationGroup",Z.Mesh="Mesh",Z.Material="Material",Z.vJ="vJ",Z.Light="Light"}(k||(k={}))},12870:(Z,c,L)=>{"use strict";L.d(c,{d:()=>N});var k=L(12875);class N extends k.e{constructor(Z,c){if(super(Z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const L of c)this._eventsSignalOutputs[L]=this._registerSignalOutput(L+"Event")}_executeOnTick(Z){}_startPendingTasks(Z){Z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Z),this._resetAfterCanceled(Z)),this._preparePendingTasks(Z),Z._addPendingBlock(this),this.out._activateSignal(Z),Z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Z){Z._deleteExecutionVariable(this,"_initialized"),Z._removePendingBlock(this)}}},12846:(Z,c,L)=>{"use strict";L.d(c,{c:()=>J});var k=L(11155),N=L(11012),R=L(12849),G=L(11027),V=L(12811);class p extends R.c{constructor(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:k.defaultValue,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Z,c,L),this.richType=k,this._defaultValue=N,this._optional=R,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new G.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Z){this._isDisabled!==Z&&(this._isDisabled=Z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Z,c){c._getConnectionValue(this)!==Z&&(c._setConnectionValue(this,Z),this.onValueChangedObservable.notifyObservers(Z))}resetToDefaultValue(Z){Z._setConnectionValue(this,this._defaultValue)}connectTo(Z){this._isDisabled||super.connectTo(Z)}_getValueOrDefault(Z){const c=Z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(Z){if(1===this.connectionType){Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Z);const c=this._getValueOrDefault(Z);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(Z):this._getValueOrDefault(Z);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.richType={},this.richType.serialize(Z.richType),Z.optional=this._optional,(0,V.e)("defaultValue",this._defaultValue,Z)}}(0,N.g)("FlowGraphDataConnection",p);class J{constructor(Z){var c;this.config=Z,this.uniqueId=(0,k.d)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Z){}registerDataInput(Z,c,L){const k=new p(Z,0,this,c,L);return this.dataInputs.push(k),k}registerDataOutput(Z,c,L){const k=new p(Z,1,this,c,L);return this.dataOutputs.push(k),k}getDataInput(Z){return this.dataInputs.find((c=>c.name===Z))}getDataOutput(Z){return this.dataOutputs.find((c=>c.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.e;if(Z.uniqueId=this.uniqueId,Z.config={},this.config){const L=this.config,k=Object.keys(L);for(const N of k)c(N,L[N],Z.config)}Z.dataInputs=[],Z.dataOutputs=[],Z.className=this.getClassName();for(const L of this.dataInputs){const c={};L.serialize(c),Z.dataInputs.push(c)}for(const L of this.dataOutputs){const c={};L.serialize(c),Z.dataOutputs.push(c)}}deserialize(Z){}_log(Z,c,L){var k;null===(k=Z.logger)||void 0===k||k.addLogItem({action:c,payload:L,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12849:(Z,c,L)=>{"use strict";L.d(c,{c:()=>R});var k,N=L(11155);!function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(k||(k={}));class R{constructor(Z,c,L){this._ownerBlock=L,this._connectedPoint=[],this.uniqueId=(0,N.d)(),this.connectedPointIds=[],this.name=Z,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Z){if(this._connectionType===Z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Z._isSingularConnection()&&Z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Z),Z._connectedPoint.push(this)}disconnectFrom(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this._connectedPoint.indexOf(Z),k=Z._connectedPoint.indexOf(this);-1!==L&&-1!==k&&(c&&this._connectedPoint.splice(L,1),Z._connectedPoint.splice(k,1))}disconnectFromAll(){for(const Z of this._connectedPoint)this.disconnectFrom(Z,!1);this._connectedPoint.length=0}dispose(){for(const Z of this._connectedPoint)this.disconnectFrom(Z)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.uniqueId=this.uniqueId,Z.name=this.name,Z._connectionType=this._connectionType,Z.connectedPointIds=[],Z.className=this.getClassName();for(const c of this._connectedPoint)Z.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(Z){this.uniqueId=Z.uniqueId,this.name=Z.name,this._connectionType=Z._connectionType,this.connectedPointIds=Z.connectedPointIds}}},12807:(Z,c,L)=>{"use strict";L.d(c,{d:()=>P});var k,N=L(11027),R=L(11170),G=L(11173),V=L(11155),p=L(12811),J=L(12836),z=L(11052);!function(Z){Z.ExecuteBlock="ExecuteBlock",Z.ExecuteEvent="ExecuteEvent",Z.TriggerConnection="TriggerConnection",Z.ContextVariableSet="ContextVariableSet",Z.GlobalVariableSet="GlobalVariableSet",Z.GlobalVariableDelete="GlobalVariableDelete",Z.GlobalVariableGet="GlobalVariableGet",Z.AddConnection="AddConnection",Z.GetConnectionValue="GetConnectionValue",Z.SetConnectionValue="SetConnectionValue",Z.ActivateSignal="ActivateSignal",Z.ContextVariableGet="ContextVariableGet"}(k||(k={}));class i{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Z){if(Z.time||(Z.time=Date.now()),this.log.push(Z),this.logToConsole){var c;const L=null===(c=Z.payload)||void 0===c?void 0:c.value;"object"===typeof L&&L.getClassName?z.e.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(L.getClassName())}: ${L.toString()}`):z.e.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(Z.payload)}`)}}getItemsOfType(Z){return this.log.filter((c=>c.action===Z))}}class t{get enableLogging(){return this._enableLogging}set enableLogging(Z){this._enableLogging!==Z&&(this._enableLogging=Z,this._enableLogging?(this.logger=new i,this.logger.logToConsole=!0):this.logger=null)}constructor(Z){this.uniqueId=(0,V.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new N.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Z,this.assetsContext=Z.assetsContext??Z.LL}hasVariable(Z){return Z in this._userVariables}setVariable(Z,c){var L;this._userVariables[Z]=c,null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:Z,value:c}})}getAsset(Z,c){return(0,J.b)(this.assetsContext,Z,c)}getVariable(Z){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:Z,value:this._userVariables[Z]}}),this._userVariables[Z]}get userVariables(){return this._userVariables}XZ(){return this._configuration.LL}_getUniqueIdPrefixedName(Z,c){return`${Z.uniqueId}_${c}`}_getGlobalContextVariable(Z,c){var L;return null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:Z,defaultValue:c,possibleValue:this._globalContextVariables[Z]}}),this._hasGlobalContextVariable(Z)?this._globalContextVariables[Z]:c}_setGlobalContextVariable(Z,c){var L;null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:Z,value:c}}),this._globalContextVariables[Z]=c}_deleteGlobalContextVariable(Z){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:Z}}),delete this._globalContextVariables[Z]}_hasGlobalContextVariable(Z){return Z in this._globalContextVariables}_setExecutionVariable(Z,c,L){this._executionVariables[this._getUniqueIdPrefixedName(Z,c)]=L}_getExecutionVariable(Z,c,L){return this._hasExecutionVariable(Z,c)?this._executionVariables[this._getUniqueIdPrefixedName(Z,c)]:L}_deleteExecutionVariable(Z,c){delete this._executionVariables[this._getUniqueIdPrefixedName(Z,c)]}_hasExecutionVariable(Z,c){return this._getUniqueIdPrefixedName(Z,c)in this._executionVariables}_hasConnectionValue(Z){return Z.uniqueId in this._connectionValues}_setConnectionValue(Z,c){var L;this._connectionValues[Z.uniqueId]=c,null===(L=this.logger)||void 0===L||L.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:c}})}_setConnectionValueByKey(Z,c){this._connectionValues[Z]=c}_getConnectionValue(Z){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:this._connectionValues[Z.uniqueId]}}),this._connectionValues[Z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Z){this._pendingBlocks.includes(Z)||(this._pendingBlocks.push(Z),this._pendingBlocks.sort(((Z,c)=>Z.priority-c.priority)))}_removePendingBlock(Z){const c=this._pendingBlocks.indexOf(Z);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const Z of this._pendingBlocks)Z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Z){var c;this.onNodeExecutedObservable.notifyObservers(Z),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:Z.getClassName(),uniqueId:Z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Z){this._setGlobalContextVariable("timeSinceStart",Z.timeSinceStart),this._setGlobalContextVariable("deltaTime",Z.deltaTime);for(const L of this._pendingBlocks){var c;null===(c=L._executeOnTick)||void 0===c||c.call(L,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.e;Z.uniqueId=this.uniqueId,Z._userVariables={};for(const k in this._userVariables)c(k,this._userVariables[k],Z._userVariables);Z._connectionValues={};for(const k in this._connectionValues)c(k,this._connectionValues[k],Z._connectionValues);var L;this.assetsContext!==this.XZ()&&(Z._assetsContext={meshes:this.assetsContext.meshes.map((Z=>Z.id)),materials:this.assetsContext.materials.map((Z=>Z.id)),textures:this.assetsContext.textures.map((Z=>Z.name)),animations:this.assetsContext.animations.map((Z=>Z.name)),lights:this.assetsContext.lights.map((Z=>Z.id)),cameras:this.assetsContext.cameras.map((Z=>Z.id)),Xt:null===(L=this.assetsContext.Xt)||void 0===L?void 0:L.map((Z=>Z.name)),skeletons:this.assetsContext.skeletons.map((Z=>Z.id)),si:this.assetsContext.si.map((Z=>Z.name)),geometries:this.assetsContext.geometries.map((Z=>Z.id)),multiMaterials:this.assetsContext.multiMaterials.map((Z=>Z.id)),transformNodes:this.assetsContext.transformNodes.map((Z=>Z.id))})}getClassName(){return"FlowGraphContext"}}(0,R.d)([(0,G.H)()],t.prototype,"uniqueId",void 0);var E=L(12839),x=L(11614);class q{constructor(Z){this.onEventTriggeredObservable=new N.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Xc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:Z}}),this._startingTime+=Z})),this._meshPickedObserver=this._scene.onPointerObservable.add((Z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:Z})}),x.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Z=>{const c=Z.pointerId,L=Z.mesh,k=this._pointerUnderMeshState[c];!k&&L?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:c,mesh:L}}):k&&!L?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:c,mesh:k}}):k&&L&&k!==L&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:c,mesh:k,over:L}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:c,mesh:L,out:k}})),this._pointerUnderMeshState[c]=L}),x.e.POINTERMOVE)}dispose(){var Z,c,L,k,N;null===(Z=this._sceneDisposeObserver)||void 0===Z||Z.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(L=this._sceneOnBeforeRenderObserver)||void 0===L||L.remove(),null===(k=this._meshPickedObserver)||void 0===k||k.remove(),null===(N=this._meshUnderPointerObserver)||void 0===N||N.remove(),this.onEventTriggeredObservable.clear()}}var O,w=L(12858);!function(Z){Z[Z.Stopped=0]="Stopped",Z[Z.Started=1]="Started"}(O||(O={}));class M{get state(){return this._state}set state(Z){this._state=Z,this.onStateChangedObservable.notifyObservers(Z)}constructor(Z){this.onStateChangedObservable=new N.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Z.LL,this._sceneEventCoordinator=new q(this._scene),this._coordinator=Z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Z=>{for(const c of this._executionContexts){const L=this._getContextualOrder(Z.type,c);for(const k of L)if(!k._executeEvent(c,Z.payload))break}switch(Z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(Z.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const Z=new t({LL:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Z),Z}getContext(Z){return this._executionContexts[Z]}addEventBlock(Z){if("PointerOver"!==Z.type&&"PointerOut"!==Z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Z.type&&this._eventBlocks[Z.type].push(Z),1===this.state)for(const c of this._executionContexts)Z._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const L of this._executionContexts)Z._startPendingTasks(L)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Z=>{1===Z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Z of this._executionContexts)for(const c in this._eventBlocks){const L=this._getContextualOrder(c,Z);for(const c of L)c._startPendingTasks(Z)}}_getContextualOrder(Z,c){const L=this._eventBlocks[Z].sort(((Z,c)=>c.initPriority-Z.initPriority));if("MeshPick"===Z){const Z=[];for(const k of L){const N=k.asset.getValue(c);let R=0;for(;R<L.length;R++){const Z=L[R].asset.getValue(c);if(N&&Z&&(0,w.m)(N,Z))break}Z.splice(R,0,k)}return Z}return L}dispose(){var Z;if(0!==this.state){this.state=0;for(const Z of this._executionContexts)Z._clearPendingBlocks();this._executionContexts.length=0;for(const Z in this._eventBlocks)this._eventBlocks[Z].length=0;null===(Z=this._eventObserver)||void 0===Z||Z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Z){const c=[],L=new Set;for(const k in this._eventBlocks)for(const Z of this._eventBlocks[k])c.push(Z),L.add(Z.uniqueId);for(;c.length>0;){const k=c.pop();Z(k);for(const Z of k.dataInputs)for(const k of Z._connectedPoint)L.has(k._ownerBlock.uniqueId)||(c.push(k._ownerBlock),L.add(k._ownerBlock.uniqueId));if(k instanceof E.b)for(const Z of k.signalOutputs)for(const k of Z._connectedPoint)L.has(k._ownerBlock.uniqueId)||(c.push(k._ownerBlock),L.add(k._ownerBlock.uniqueId))}}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;Z.allBlocks=[],this.visitAllBlocks((c=>{const L={};c.serialize(L),Z.allBlocks.push(L)})),Z.executionContexts=[];for(const L of this._executionContexts){const k={};L.serialize(k,c),Z.executionContexts.push(k)}}}class P{constructor(Z){this.config=Z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.LL.Xc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.LL.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Z=this._executeOnNextFrame.slice(0);if(Z.length)for(const c of Z){this.notifyCustomEvent(c.id,c.data,!1);const Z=this._executeOnNextFrame.findIndex((Z=>Z.uniqueId===c.uniqueId));-1!==Z&&this._executeOnNextFrame.splice(Z,1)}}));(P.SceneCoordinators.get(this.config.LL)??[]).push(this)}createGraph(){const Z=new M({LL:this.config.LL,coordinator:this});return this._flowGraphs.push(Z),Z}removeGraph(Z){const c=this._flowGraphs.indexOf(Z);-1!==c&&(Z.dispose(),this._flowGraphs.splice(c,1))}start(){for(const Z of this._flowGraphs)Z.start()}dispose(){var Z,c;for(const N of this._flowGraphs)N.dispose();this._flowGraphs.length=0,null===(Z=this._disposeObserver)||void 0===Z||Z.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const L=P.SceneCoordinators.get(this.config.LL)??[],k=L.indexOf(this);-1!==k&&L.splice(k,1)}serialize(Z,c){Z._flowGraphs=[];for(const L of this._flowGraphs){const k={};L.serialize(k,c),Z._flowGraphs.push(k)}Z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Z){let c=this._customEventsMap.get(Z);return c||(c=new N.b,this._customEventsMap.set(Z,c)),c}notifyCustomEvent(Z,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Z,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Z)){const c=this._eventExecutionCounter.get(Z);if(this._eventExecutionCounter.set(Z,c+1),c>=P.MaxEventTypeExecutionPerFrame)return void(c===P.MaxEventTypeExecutionPerFrame&&z.e.Warn(`FlowGraphCoordinator: Too many executions of event "${Z}".`))}else this._eventExecutionCounter.set(Z,1);const L=this._customEventsMap.get(Z);L&&L.notifyObservers(c)}}P.MaxEventsPerType=30,P.MaxEventTypeExecutionPerFrame=30,P.SceneCoordinators=new Map},12866:(Z,c,L)=>{"use strict";L.d(c,{e:()=>N});var k=L(12870);class N extends k.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Z){Z._notifyExecuteNode(this),this.done._activateSignal(Z)}}},12839:(Z,c,L)=>{"use strict";L.d(c,{b:()=>V});var k=L(12846),N=L(12849),R=L(11012);class G extends N.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Z){super.connectTo(Z),this._connectedPoint.sort(((Z,c)=>c.priority-Z.priority))}_activateSignal(Z){var c;if(null===(c=Z.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Z,this),Z._increaseExecutionId();else for(const L of this._connectedPoint)L._activateSignal(Z)}}(0,R.g)("FlowGraphSignalConnection",G);class V extends k.c{constructor(Z){super(Z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Z){const c=new G(Z,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(Z){const c=new G(Z,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(Z){const c=this.signalInputs.findIndex((c=>c.name===Z));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(Z){const c=this.signalOutputs.findIndex((c=>c.name===Z));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(Z,c){this.error.payload="string"===typeof c?new Error(c):c,this.error._activateSignal(Z)}getSignalInput(Z){return this.signalInputs.find((c=>c.name===Z))}getSignalOutput(Z){return this.signalOutputs.find((c=>c.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.signalInputs=[],Z.signalOutputs=[];for(const c of this.signalInputs){const L={};c.serialize(L),Z.signalInputs.push(L)}for(const c of this.signalOutputs){const L={};c.serialize(L),Z.signalOutputs.push(L)}}deserialize(Z){for(let c=0;c<Z.signalInputs.length;c++){const L=this.getSignalInput(Z.signalInputs[c].name);if(!L)throw new Error("Could not find signal input with name "+Z.signalInputs[c].name+" in block "+Z.className);L.deserialize(Z.signalInputs[c])}for(let c=0;c<Z.signalOutputs.length;c++){const L=this.getSignalOutput(Z.signalOutputs[c].name);if(!L)throw new Error("Could not find signal output with name "+Z.signalOutputs[c].name+" in block "+Z.className);L.deserialize(Z.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},12875:(Z,c,L)=>{"use strict";L.d(c,{e:()=>N});var k=L(12839);class N extends k.b{constructor(Z){super(Z),this.out=this._registerSignalOutput("out")}}},12825:(Z,c,L)=>{"use strict";L.d(c,{A:()=>x,B:()=>q,F:()=>B,G:()=>D,H:()=>h,I:()=>X,e:()=>J,g:()=>t,i:()=>u,m:()=>O,n:()=>w,r:()=>M,t:()=>i,u:()=>o,x:()=>z,z:()=>E});var k,N=L(10993),R=L(11255),G=L(12817),V=L(12834);!function(Z){Z.Any="any",Z.String="string",Z.Number="number",Z.Boolean="boolean",Z.Object="object",Z.Integer="FlowGraphInteger",Z.Vector2="Vector2",Z.Mc="Mc",Z.Vector4="Vector4",Z.Quaternion="Quaternion",Z.Matrix="Matrix",Z.Matrix2D="Matrix2D",Z.Matrix3D="Matrix3D",Z.sc="sc",Z.mc="mc"}(k||(k={}));class p{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Z,this.defaultValue=c,this.animationType=L}serialize(Z){Z.typeName=this.typeName,Z.defaultValue=this.defaultValue}}const J=new p("any",void 0),z=new p("string",""),i=new p("number",0,0),t=new p("boolean",!1),E=new p("Vector2",N.f.Zero(),5),x=new p("Mc",N.h.Zero(),1),q=new p("Vector4",N.j.Zero()),O=new p("Matrix",N.b.Identity(),3),w=new p("Matrix2D",new V.e),M=new p("Matrix3D",new V.g),P=new p("sc",R.d.Black(),4),j=new p("mc",new R.h(0,0,0,0),7),o=new p("Quaternion",N.c.Identity(),2);o.typeTransformer=Z=>{if(Z.getClassName){if("Vector4"===Z.getClassName())return N.c.oc(Z.xc());if("Mc"===Z.getClassName())return N.c.FromEulerVector(Z);if("Matrix"===Z.getClassName())return N.c.FromRotationMatrix(Z)}return Z};const u=new p("FlowGraphInteger",new G.b(0),0);function X(Z){const c=Z;switch(typeof Z){case"string":return z;case"number":return i;case"boolean":return t;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return E;case"Mc":return x;case"Vector4":return q;case"Matrix":return O;case"sc":return P;case"mc":return j;case"Quaternion":return o;case"FlowGraphInteger":return u;case"Matrix2D":return w;case"Matrix3D":return M}return J;default:return J}}function h(Z){switch(Z){case"string":return z;case"number":return i;case"boolean":return t;case"Vector2":return E;case"Mc":return x;case"Vector4":return q;case"Matrix":return O;case"sc":return P;case"mc":return j;case"Quaternion":return o;case"FlowGraphInteger":return u;case"Matrix2D":return w;case"Matrix3D":return M;default:return J}}function B(Z){switch(Z){case"number":default:return 0;case"Vector2":return 5;case"Mc":return 1;case"Matrix":return 3;case"sc":return 4;case"mc":return 7;case"Quaternion":return 2}}function D(Z){switch(Z){case 0:return i;case 5:return E;case 1:return x;case 3:return O;case 4:return P;case 7:return j;case 2:return o;default:return J}}},12811:(Z,c,L)=>{"use strict";L.d(c,{d:()=>z,e:()=>J,h:()=>i});var k=L(11255),N=L(10993),R=L(12817),G=L(12825),V=L(12834);function p(Z){return"Vector2"===Z||"Mc"===Z||"Vector4"===Z||"Quaternion"===Z||"sc"===Z||"mc"===Z}function J(Z,c,L){var k;const N=(null===c||void 0===c||null===(k=c.getClassName)||void 0===k?void 0:k.call(c))??"";if(p(N)||function(Z){return"Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z}(N))L[Z]={value:c.xc(),className:N};else if("FlowGraphInteger"===N)L[Z]={value:c.value,className:N};else if(N&&(c.id||c.name))L[Z]={id:c.id,name:c.name,className:N};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);L[Z]=c}}function z(Z,c,L,J){const i=c[Z];let t;const E=(null===i||void 0===i?void 0:i.type)??(null===i||void 0===i?void 0:i.className);if(function(Z){return"Mesh"===Z||"AbstractMesh"===Z||"GroundMesh"===Z||"InstanceMesh"===Z||"LinesMesh"===Z||"GoldbergMesh"===Z||"GreasedLineMesh"===Z||"TrailMesh"===Z}(E)){let Z=J.meshes.filter((Z=>i.id?Z.id===i.id:Z.name===i.name));0===Z.length&&(Z=J.transformNodes.filter((Z=>i.id?Z.id===i.id:Z.name===i.name))),t=i.uniqueId?Z.find((Z=>Z.uniqueId===i.uniqueId)):Z[0]}else if(p(E))t=function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Z)return N.f.oc(c);if("Mc"===Z)return L&&(c[2]*=-1),N.h.oc(c);if("Vector4"===Z)return N.j.oc(c);if("Quaternion"===Z)return L&&(c[2]*=-1,c[3]*=-1),N.c.oc(c);if("sc"===Z)return new k.d(c[0],c[1],c[2]);if("mc"===Z)return new k.h(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${Z}`)}(E,i.value);else if(function(Z){return"AnimationGroup"===Z}(E)){const Z=J.animationGroups.filter((Z=>Z.name===i.name));t=1===Z.length?Z[0]:Z.find((Z=>Z.uniqueId===i.uniqueId))}else t="Matrix"===E?N.b.oc(i.value):"Matrix2D"===E?new V.e(i.value):"Matrix3D"===E?new V.g(i.value):"FlowGraphInteger"===E?R.b.FromValue(i.value):"number"===E||"string"===E||"boolean"===E?i.value[0]:i&&void 0!==i.value?i.value:Array.isArray(i)?i.reduce(((Z,c)=>c.eventData?(Z[c.id]={type:(0,G.H)(c.type)},"undefined"!==typeof c.value&&(Z[c.id].value=z("value",c,L,J)),Z):Z),{}):i;return t}function i(Z){return"FlowGraphJsonPointerParserBlock"===Z}},12858:(Z,c,L)=>{"use strict";function k(Z,c){return!(!Z.parent||Z.parent!==c&&!k(Z.parent,c))}function N(Z){if(Z.getClassName)return Z.getClassName()}function R(Z,c){return Z===c&&("Vector2"===Z||"Mc"===Z||"Vector4"===Z||"Quaternion"===Z)}function G(Z,c){return Z===c&&("Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z)}function V(Z,c){return"FlowGraphInteger"===Z&&"FlowGraphInteger"===c}function p(Z,c){const L="number"===typeof Z||"number"===typeof(null===Z||void 0===Z?void 0:Z.value);return L&&!c?!isNaN(J(Z)):L}function J(Z){return"number"===typeof Z?Z:Z.value}L.d(c,{b:()=>V,f:()=>G,i:()=>R,l:()=>N,m:()=>k,q:()=>J,u:()=>p})},12279:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{SceneInstrumentation:()=>R});var k=L(11038),N=L(11496);class R{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Z){Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.LL.onBeforeActiveMeshesEvaluationObservable.add((()=>{k.c.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.LL.onAfterActiveMeshesEvaluationObservable.add((()=>{k.c.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.LL.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LL.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Z){Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.LL.onBeforeRenderTargetsRenderObservable.add((()=>{k.c.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.LL.onAfterRenderTargetsRenderObservable.add((()=>{k.c.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.LL.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LL.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Z){Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.LL.onBeforeParticlesRenderingObservable.add((()=>{k.c.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.LL.onAfterParticlesRenderingObservable.add((()=>{k.c.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.LL.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LL.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Z){Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.LL.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.LL.onBeforeSpritesRenderingObservable.add((()=>{k.c.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.LL.onAfterSpritesRenderingObservable.add((()=>{k.c.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.LL.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.LL.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Z){Z!==this._capturePhysicsTime&&this.LL.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.LL.onBeforePhysicsObservable.add((()=>{k.c.StartPerformanceCounter("Kc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.LL.onAfterPhysicsObservable.add((()=>{k.c.EndPerformanceCounter("Kc"),this._physicsTime.endMonitoring()}))):(this.LL.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.LL.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Z){Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.LL.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.LL.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Z){this._captureFrameTime=Z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Z){this._captureInterFrameTime=Z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Z){Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.LL.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),k.c.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.LL.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),k.c.EndPerformanceCounter("Main render")}))):(this.LL.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LL.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Z){Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.LL.onBeforeCameraRenderObservable.add((Z=>{this._cameraRenderTime.beginMonitoring(),k.c.StartPerformanceCounter(`Rendering camera ${Z.name}`)})),this._onAfterCameraRenderObserver=this.LL.onAfterCameraRenderObservable.add((Z=>{this._cameraRenderTime.endMonitoring(!1),k.c.EndPerformanceCounter(`Rendering camera ${Z.name}`)}))):(this.LL.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LL.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.LL.getEngine()._drawCalls}constructor(Z){this.LL=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new N.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new N.d,this._captureFrameTime=!1,this._frameTime=new N.d,this._captureRenderTime=!1,this._renderTime=new N.d,this._captureInterFrameTime=!1,this._interFrameTime=new N.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new N.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new N.d,this._capturePhysicsTime=!1,this._physicsTime=new N.d,this._captureAnimationsTime=!1,this._animationsTime=new N.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new N.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(k.c.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.LL.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(k.c.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.li(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.li(),this._captureParticlesRenderTime&&this._particlesRenderTime.li(),this._captureSpritesRenderTime&&this._spritesRenderTime.li(),this._captureRenderTime&&this._renderTime.li(),this._captureCameraRenderTime&&this._cameraRenderTime.li()}))}dispose(){this._disposed||(this.LL.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.LL.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LL.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.LL.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LL.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.LL.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.LL.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LL.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.LL.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.LL.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.LL.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LL.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.LL.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.LL.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.LL.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.LL.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LL.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.LL=null,this._disposed=!0)}}},12802:(Z,c,L)=>{"use strict";L.d(c,{c:()=>z});var k=L(11170),N=L(11173),R=L(10993),G=L(11277),V=L(11732),p=L(11792),J=L(11012);G.b.AddNodeConstructor("Light_Type_1",((Z,c)=>()=>new z(Z,R.h.Zero(),c)));class z extends p.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Z){this._orthoLeft=Z}get orthoRight(){return this._orthoRight}set orthoRight(Z){this._orthoRight=Z}get orthoTop(){return this._orthoTop}set orthoTop(Z){this._orthoTop=Z}get orthoBottom(){return this._orthoBottom}set orthoBottom(Z){this._orthoBottom=Z}constructor(Z,c,L){super(Z,L),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"vc"}getTypeID(){return V.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Z,c,L){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,c,L)}_setDefaultFixedFrustumShadowProjectionMatrix(Z){const c=this.XZ().activeCamera;c&&R.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.Dc,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,Z,this.XZ().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Z,c,L){const k=this.XZ().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Z=R.h.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let k=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let G=0;G<L.length;G++){const V=L[G];if(!V)continue;const p=V.getBoundingInfo().boundingBox;for(let L=0;L<p.vectorsWorld.length;L++)R.h.TransformCoordinatesToRef(p.vectorsWorld[L],c,Z),Z.x<this._orthoLeft&&(this._orthoLeft=Z.x),Z.y<this._orthoBottom&&(this._orthoBottom=Z.y),Z.x>this._orthoRight&&(this._orthoRight=Z.x),Z.y>this._orthoTop&&(this._orthoTop=Z.y),this.autoCalcShadowZBounds&&(Z.z<k&&(k=Z.z),Z.z>N&&(N=Z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=k,this._shadowMaxZ=N)}const N=this._orthoRight-this._orthoLeft,G=this._orthoTop-this._orthoBottom,V=void 0!==this.shadowMinZ?this.shadowMinZ:(null===k||void 0===k?void 0:k.Dc)||0,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===k||void 0===k?void 0:k.maxZ)||1e4,J=this.XZ().getEngine().useReverseDepthBuffer;R.b.OrthoOffCenterLHToRef(this._orthoLeft-N*this.shadowOrthoScale,this._orthoRight+N*this.shadowOrthoScale,this._orthoBottom-G*this.shadowOrthoScale,this._orthoTop+G*this.shadowOrthoScale,J?p:V,J?V:p,Z,this.XZ().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(Z,c){return this.computeTransformedInformation()?(Z.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Z){const c=this._scene.getEngine();return!c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}getDepthMaxZ(Z){const c=this._scene.getEngine();return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Z,c){Z["DIRLIGHT"+c]=!0}}(0,k.d)([(0,N.H)()],z.prototype,"shadowFrustumSize",null),(0,k.d)([(0,N.H)()],z.prototype,"shadowOrthoScale",null),(0,k.d)([(0,N.H)()],z.prototype,"autoUpdateExtends",void 0),(0,k.d)([(0,N.H)()],z.prototype,"autoCalcShadowZBounds",void 0),(0,k.d)([(0,N.H)("orthoLeft")],z.prototype,"_orthoLeft",void 0),(0,k.d)([(0,N.H)("orthoRight")],z.prototype,"_orthoRight",void 0),(0,k.d)([(0,N.H)("orthoTop")],z.prototype,"_orthoTop",void 0),(0,k.d)([(0,N.H)("orthoBottom")],z.prototype,"_orthoBottom",void 0),(0,J.g)("BABYLON.DirectionalLight",z)},13303:(Z,c,L)=>{"use strict";L.d(c,{d:()=>z});var k=L(11170),N=L(11173),R=L(10993),G=L(11255),V=L(11277),p=L(11732),J=L(11012);V.b.AddNodeConstructor("Light_Type_3",((Z,c)=>()=>new z(Z,R.h.Zero(),c)));class z extends p.e{constructor(Z,c,L){super(Z,L),this.groundColor=new G.d(0,0,0),this.direction=c||R.h.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Yc"}setDirectionToTarget(Z){return this.direction=R.h.Normalize(Z.yL(R.h.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Z,c){const L=R.h.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",L.x,L.y,L.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Qc),c),this}transferToNodeMaterialEffect(Z,c){const L=R.h.Normalize(this.direction);return Z.setFloat3(c,L.x,L.y,L.z),this}Jc(){return this._worldMatrix||(this._worldMatrix=R.b.Identity()),this._worldMatrix}getTypeID(){return p.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Z,c){Z["HEMILIGHT"+c]=!0}}(0,k.d)([(0,N.m)()],z.prototype,"groundColor",void 0),(0,k.d)([(0,N.F)()],z.prototype,"direction",void 0),(0,J.g)("BABYLON.HemisphericLight",z)},12766:(Z,c,L)=>{"use strict";L.d(c,{e:()=>i});var k=L(11170),N=L(11173),R=L(10993),G=L(11277),V=L(11732),p=L(11792),J=L(11508),z=L(11012);G.b.AddNodeConstructor("Light_Type_2",((Z,c)=>()=>new i(Z,R.h.Zero(),R.h.Zero(),0,0,c)));class i extends p.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Z){this._iesProfileTexture!==Z&&(this._iesProfileTexture=Z,this._iesProfileTexture&&i._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Z){this._innerAngle=Z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Z){this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(i._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):i._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Z){return void 0!==Z.onGeneratedObservable}static _IsTexture(Z){return void 0!==Z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Z,c,L,k,N,G){super(Z,G),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=R.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=R.h.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=R.h.Zero(),this._projectionTextureViewLightMatrix=R.b.Zero(),this._projectionTextureProjectionLightMatrix=R.b.Zero(),this._projectionTextureScalingMatrix=R.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=L,this.angle=k,this.exponent=N}getClassName(){return"SpotLight"}getTypeID(){return V.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(Z){super._setDirection(Z),this._projectionTextureViewLightDirty=!0}_setPosition(Z){super._setPosition(Z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Z,c,L){const k=this.XZ().activeCamera;if(!k)return;this._shadowAngleScale=this._shadowAngleScale||1;const N=this._shadowAngleScale*this._angle,G=void 0!==this.shadowMinZ?this.shadowMinZ:k.Dc,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,p=this.XZ().getEngine().useReverseDepthBuffer;R.b.PerspectiveFovLHToRef(N,1,p?V:G,p?G:V,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),R.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Z=this.projectionTextureLightFar,c=this.projectionTextureLightNear,L=Z/(Z-c),k=-L*c,N=1/Math.tan(this._angle/2);R.b.FromValuesToRef(N/1,0,0,0,0,N,0,0,0,0,L,1,0,0,k,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.c){const Z=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;R.b.FromValuesToRef(Z,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Z,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),Z.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Z.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(Z,c){let L;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),L=R.h.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),L=R.h.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",L.x,L.y,L.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(Z,c){let L;return L=this.computeTransformedInformation()?R.h.Normalize(this.transformedDirection):R.h.Normalize(this.direction),this.XZ().useRightHandedSystem?Z.setFloat3(c,-L.x,-L.y,-L.z):Z.setFloat3(c,L.x,L.y,L.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Z){const c=this._scene.getEngine(),L=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.Dc)??0;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?L:this._scene.getEngine().isNDCHalfZRange?0:L}getDepthMaxZ(Z){const c=this._scene.getEngine(),L=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)??1e4;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:L}prepareLightSpecificDefines(Z,c){Z["SPOTLIGHT"+c]=!0,Z["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Z["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,k.d)([(0,N.H)()],i.prototype,"angle",null),(0,k.d)([(0,N.H)()],i.prototype,"innerAngle",null),(0,k.d)([(0,N.H)()],i.prototype,"shadowAngleScale",null),(0,k.d)([(0,N.H)()],i.prototype,"exponent",void 0),(0,k.d)([(0,N.H)()],i.prototype,"projectionTextureLightNear",null),(0,k.d)([(0,N.H)()],i.prototype,"projectionTextureLightFar",null),(0,k.d)([(0,N.H)()],i.prototype,"projectionTextureUpDirection",null),(0,k.d)([(0,N.A)("projectedLightTexture")],i.prototype,"_projectionTexture",void 0),(0,z.g)("BABYLON.SpotLight",i)},12514:(Z,c,L)=>{"use strict";L.d(c,{b:()=>G,f:()=>R,g:()=>V});const k={},N={};function R(Z,c){k[Z]=c}function G(Z,c){N[Z]=c}function V(Z){return N[Z]?N[Z]:null}},12430:(Z,c,L)=>{"use strict";L.d(c,{c:()=>X,g:()=>Q});var k,N=L(11038),R=L(11027),G=L(11588),V=L(11023),p=L(11052),J=L(11362),z=L(11081),i=L(11085),t=L(11155),E=L(11110),x=L(11079);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(k||(k={}));const q=new R.b,O={};let w=!1;function M(){return O[".babylon"]}function P(Z,c){const L=O[Z];return L||(p.e.Warn("Unable to find a plugin to load "+Z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?M():void 0)}function j(Z,c,L){let k="Unable to load from "+(Z.rawData?"binary data":Z.url);return c?k+=`: ${c}`:L&&(k+=`: ${L}`),k}async function o(Z,c,L,k,N,R,G,V,p){var J;const i="data:"===(t=Z.url).substring(0,5)?t.substring(5):null;var t;if(Z.rawData&&!G)throw"When using ArrayBufferView to load data the file extension must be provided.";const w=i||G?"":function(Z){const c=Z.indexOf("?");-1!==c&&(Z=Z.substring(0,c));const L=Z.lastIndexOf(".");return Z.substring(L,Z.length).toLowerCase()}(Z.url);let j=G?P(G,!0):i?function(Z){for(const c in O){const L=O[c].plugin;if(L.canDirectLoad&&L.canDirectLoad(Z))return O[c]}return M()}(Z.url):P(w,!1);if(!j&&w){if(Z.url&&!Z.url.startsWith("blob:")){const c=await async function(Z,c){const L=c.method||"GET";return await new Promise(((k,N)=>{const R=new x.b;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const Z={};if(c.responseHeaders)for(const L of c.responseHeaders)Z[L]=R.getResponseHeader(L)||"";k({response:R.response,headerValues:Z})}else N(`Unable to fetch data from ${Z}. Error code: ${R.status}`)})),R.open(L,Z),R.send()}))}(Z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),L=c.headerValues?c.headerValues["Content-Type"]:"";L&&(j=function(Z){for(const c in O){const L=O[c];if(L.mimeType===Z)return L}}(L))}j||(j=M())}if(!j)throw new Error(`No plugin or fallback for ${G??Z.url}`);if(!1===(null===p||void 0===p||null===(J=p[j.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${j.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Z.rawData&&!j.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Z=>{if(j.plugin.createPlugin){const c=j.plugin.createPlugin(p??{});return c instanceof Promise?(c.then(Z).catch((Z=>{N("Error instantiating plugin.",Z)})),null):(Z(c),c)}return Z(j.plugin),j.plugin})((p=>{var J;if(!p)throw`The loader plugin corresponding to the '${G}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(q.notifyObservers(p),i&&(p.canDirectLoad&&p.canDirectLoad(Z.url)||!(0,z.h)(Z.url))){if(p.directLoad){const Z=p.directLoad(c,i);Z instanceof Promise?Z.then((Z=>{L(p,Z)})).catch((Z=>{N("Error in directLoad of _loadData: "+Z,Z)})):L(p,Z)}else L(p,i);return}const t=j.isBinary,x=(Z,k)=>{c.p?N("Scene has been disposed"):L(p,Z,k)};let O=null,w=!1;null===(J=p.Xc)||void 0===J||J.add((()=>{w=!0,O&&(O.abort(),O=null),R()}));const M=()=>{if(w)return;const L=(Z,c)=>{N(null===Z||void 0===Z?void 0:Z.statusText,c)};if(!p.loadFile&&Z.rawData)throw"Plugin does not support loading ArrayBufferView.";O=p.loadFile?p.loadFile(c,Z.rawData||Z.file||Z.url,Z.rootUrl,x,k,t,L,V):c._loadFile(Z.file||Z.url,x,k,!0,t,L)},P=c.getEngine();let o=P.enableOfflineSupport;if(o){let L=!1;for(const k of c.disableOfflineSupportExceptionRules)if(k.test(Z.url)){L=!0;break}o=!L}o&&E.c.OfflineProviderFactory?c.offlineProvider=E.c.OfflineProviderFactory(Z.url,M,P.disableManifestCheck):M()}))}function u(Z,c){let L,k,R=null,G=null;if(c)if(c.name)L=`file:${c.name}`,k=c.name,R=c;else if(ArrayBuffer.isView(c))L="",k=(0,t.d)(),G=c;else if(c.startsWith("data:"))L=c,k="";else if(Z){const R=c;if("/"===R.substring(0,1))return N.c.Error("Wrong sceneFilename parameter"),null;L=Z+R,k=R}else L=c,k=N.c.GetFilename(c),Z=N.c.GetFolderPath(c);else L=Z,k=N.c.GetFilename(Z),Z=N.c.GetFolderPath(Z);return{url:L,rootUrl:Z,name:k,file:R,rawData:G}}function X(Z){if("string"===typeof Z.extensions){const c=Z.extensions;O[c.toLowerCase()]={plugin:Z,isBinary:!1}}else{const c=Z.extensions,L=Object.keys(c);for(const k of L)O[k.toLowerCase()]={plugin:Z,isBinary:c[k].isBinary,mimeType:c[k].mimeType}}}async function h(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.d.LastCreatedScene,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!k)return p.e.Error("No scene available to import mesh to"),null;const E=u(c,L);if(!E)return null;const x={};k.addPendingData(x);const q=()=>{k.removePendingData(x)},O=(Z,c)=>{const L=j(E,Z,c);G?G(k,L,new i.h(L,i.e.SceneLoaderError,c)):p.e.Error(L),q()},w=R?Z=>{try{R(Z)}catch(c){O("Error in onProgress callback: "+c,c)}}:void 0,M=(Z,c,L,R,G,V,p,J)=>{if(k.importedMeshesFiles.push(E.url),N)try{N(Z,c,L,R,G,V,p,J)}catch(z){O("Error in onSuccess callback: "+z,z)}k.removePendingData(x)};return await o(E,k,((c,L,N)=>{if(c.rewriteRootURL&&(E.rootUrl=c.rewriteRootURL(E.rootUrl,N)),c.importMesh){const N=[],R=[],G=[];if(!c.importMesh(Z,k,L,E.rootUrl,N,R,G,O))return;k.loadingPluginName=c.name,M(N,R,G,[],[],[],[],[])}else{c.importMeshAsync(Z,k,L,E.rootUrl,w,E.name).then((Z=>{k.loadingPluginName=c.name,M(Z.meshes,Z.si,Z.skeletons,Z.animationGroups,Z.transformNodes,Z.geometries,Z.lights,Z.spriteManagers)})).catch((Z=>{O(Z.message,Z)}))}}),w,O,q,J,z,t)}async function B(Z,c,L,k,N,R,G,V){return await new Promise(((p,J)=>{try{h(Z,c,L,k,((Z,c,L,k,N,R,G,V)=>{p({meshes:Z,si:c,skeletons:L,animationGroups:k,transformNodes:N,geometries:R,lights:G,spriteManagers:V})}),N,((Z,c,L)=>{J(L||new Error(c))}),R,G,V).catch(J)}catch(i){J(i)}}))}async function D(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.d.LastCreatedEngine,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};L?await H(Z,c,new G.d(L),k,R,p,J,z,i):N.c.Error("No engine available")}async function e(Z,c,L,k,N,R,G){return await new Promise(((V,p)=>{D(Z,c,L,(Z=>{V(Z)}),k,((Z,c,L)=>{p(L||new Error(c))}),N,R,G)}))}async function H(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.d.LastCreatedScene,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return p.e.Error("No scene available to append to"),null;const E=u(Z,c);if(!E)return null;const x={};L.addPendingData(x);const q=()=>{L.removePendingData(x)};J.e.ShowLoadingScreen&&!w&&(w=!0,L.getEngine().displayLoadingUI(),L.executeWhenReady((()=>{L.getEngine().hideLoadingUI(),w=!1})));const O=(Z,c)=>{const k=j(E,Z,c);R?R(L,k,new i.h(k,i.e.SceneLoaderError,c)):p.e.Error(k),q()},M=N?Z=>{try{N(Z)}catch(c){O("Error in onProgress callback",c)}}:void 0,P=()=>{if(k)try{k(L)}catch(Z){O("Error in onSuccess callback",Z)}L.removePendingData(x)};return await o(E,L,((Z,c)=>{if(Z.load){if(!Z.load(L,c,E.rootUrl,O))return;L.loadingPluginName=Z.name,P()}else{Z.loadAsync(L,c,E.rootUrl,M,E.name).then((()=>{L.loadingPluginName=Z.name,P()})).catch((Z=>{O(Z.message,Z)}))}}),M,O,q,G,z,t)}async function l(Z,c,L,k,N,R,G){return await new Promise(((V,p)=>{try{H(Z,c,L,(Z=>{V(Z)}),k,((Z,c,L)=>{p(L||new Error(c))}),N,R,G).catch(p)}catch(i){p(i)}}))}async function W(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.d.LastCreatedScene,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!L)return p.e.Error("No scene available to load asset container to"),null;const t=u(Z,c);if(!t)return null;const E={};L.addPendingData(E);const x=()=>{L.removePendingData(E)},q=(Z,c)=>{const k=j(t,Z,c);R?R(L,k,new i.h(k,i.e.SceneLoaderError,c)):p.e.Error(k),x()},O=N?Z=>{try{N(Z)}catch(c){q("Error in onProgress callback",c)}}:void 0,w=Z=>{if(k)try{k(Z)}catch(c){q("Error in onSuccess callback",c)}L.removePendingData(E)};return await o(t,L,((Z,c)=>{if(Z.loadAssetContainer){const k=Z.loadAssetContainer(L,c,t.rootUrl,q);if(!k)return;k.populateRootNodes(),L.loadingPluginName=Z.name,w(k)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(L,c,t.rootUrl,O,t.name).then((c=>{c.populateRootNodes(),L.loadingPluginName=Z.name,w(c)})).catch((Z=>{q(Z.message,Z)}))}else q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),O,q,x,G,J,z)}async function T(Z,c,L,k,N,R,G){return await new Promise(((V,p)=>{try{W(Z,c,L,(Z=>{V(Z)}),k,((Z,c,L)=>{p(L||new Error(c))}),N,R,G).catch(p)}catch(i){p(i)}}))}async function I(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.d.LastCreatedScene,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!L)return void p.e.Error("No scene available to load animations to");if(k){for(const k of L.animatables)k.reset();L.stopAllAnimations();const Z=L.animationGroups.slice();for(const L of Z)L.dispose();const c=L.getNodes();for(const L of c)L.animations&&(L.animations=[])}else switch(N){case 0:const Z=L.animationGroups.slice();for(const c of Z)c.dispose();break;case 1:for(const c of L.animationGroups)c.stop();break;case 2:for(const c of L.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void p.e.Error("Unknown animation group loading mode value '"+N+"'")}const x=L.animatables.length;await W(Z,c,L,(Z=>{Z.mergeAnimationsTo(L,L.animatables.slice(x),R),Z.dispose(),L.onAnimationFileImportedObservable.notifyObservers(L),G&&G(L)}),J,z,i,t,E)}async function d(Z,c,L,k,N,R,G,V,p,J){return await new Promise(((z,t)=>{try{I(Z,c,L,k,N,R,(Z=>{z(Z)}),G,((Z,c,L)=>{t(L||new Error(c))}),V,p,J).catch(t)}catch(i){t(i)}}))}class Q{static get ForceFullSceneLoadingForIncremental(){return J.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){J.e.ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return J.e.ShowLoadingScreen}static set ShowLoadingScreen(Z){J.e.ShowLoadingScreen=Z}static get loggingLevel(){return J.e.loggingLevel}static set loggingLevel(Z){J.e.loggingLevel=Z}static get CleanBoneMatrixWeights(){return J.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){J.e.CleanBoneMatrixWeights=Z}static GetDefaultPlugin(){return M()}static GetPluginForExtension(Z){var c;return null===(c=P(Z,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(Z){return function(Z){return!!O[Z]}(Z)}static RegisterPlugin(Z){X(Z)}static ImportMesh(Z,c,L,k,N,R,G,p,J){h(Z,c,L,k,N,R,G,p,J).catch((Z=>null===G||void 0===G?void 0:G(V.d.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportMeshAsync(Z,c,L,k,N,R,G){return await B(Z,c,L,k,N,R,G)}static Load(Z,c,L,k,N,R,G,p){D(Z,c,L,k,N,R,G,p).catch((Z=>null===R||void 0===R?void 0:R(V.d.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAsync(Z,c,L,k,N,R){return await e(Z,c,L,k,N,R)}static Append(Z,c,L,k,N,R,G,p){H(Z,c,L,k,N,R,G,p).catch((Z=>null===R||void 0===R?void 0:R(L??V.d.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async AppendAsync(Z,c,L,k,N,R){return await l(Z,c,L,k,N,R)}static LoadAssetContainer(Z,c,L,k,N,R,G,p){W(Z,c,L,k,N,R,G,p).catch((Z=>null===R||void 0===R?void 0:R(L??V.d.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAssetContainerAsync(Z,c,L,k,N,R){return await T(Z,c,L,k,N,R)}static ImportAnimations(Z,c,L,k,N,R,G,p,J,z,i){I(Z,c,L,k,N,R,G,p,J,z,i).catch((Z=>null===J||void 0===J?void 0:J(L??V.d.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportAnimationsAsync(Z,c,L,k,N,R,G,V,p,J,z){return await d(Z,c,L,k,N,R,V,J,z)}}Q.NO_LOGGING=0,Q.MINIMAL_LOGGING=1,Q.SUMMARY_LOGGING=2,Q.DETAILED_LOGGING=3,Q.OnPluginActivatedObservable=q},12789:(Z,c,L)=>{"use strict";L.d(c,{c:()=>t});var k=L(11170),N=L(11173),R=L(11038),G=L(10993),V=L(11487),p=L(11508),J=L(11012),z=L(11027),i=L(11242);L(12792);class t extends V.d{set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const c=this.XZ();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Z){this._rotationY=Z,this.setReflectionTextureMatrix(G.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Z,c,L){let k="";for(const N of Z)k+=N;return new t(k,c,null,L,Z)}static CreateFromPrefilteredData(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const R=new t(Z,c,null,!1,null,null,null,void 0,!0,L,k);return c.useDelayedTextureLoading=N,R}constructor(Z,c){var L;let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new z.b,this.boundingBoxPosition=G.h.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new G.b,this._buffer=null,this.name=Z,this.url=Z,this._noMipmap=N,this.Oc=!1,this.isCube=!0,this._textureMatrix=G.b.Identity(),this.coordinatesMode=p.c.CUBIC_MODE;let P=null,j=null;null===k||Array.isArray(k)?(this._noMipmap=N,this._format=i,this._createPolynomials=x,P=k,this._loaderOptions=w,this._useSRGBBuffer=M,this._lodScale=q,this._lodOffset=O):(P=k.extensions??null,this._noMipmap=k.noMipmap??!1,R=k.files??null,j=k.buffer??null,this._format=k.format??5,t=k.prefiltered??!1,E=k.forcedExtension??null,this._createPolynomials=k.createPolynomials??!1,this._lodScale=k.lodScale??.8,this._lodOffset=k.lodOffset??0,this._loaderOptions=k.loaderOptions,this._useSRGBBuffer=k.useSRGBBuffer,V=k.v??null,J=k.onError??null),(Z||R)&&this.updateURL(Z,E,V,t,J,P,null===(L=this.XZ())||void 0===L?void 0:L.useDelayedTextureLoading,R,j)}getClassName(){return"CubeTexture"}updateURL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,c&&(this._forcedExtension=c);const J=Z.lastIndexOf("."),z=c||(J>-1?Z.substring(J).toLowerCase():""),i=0===z.indexOf(".dds"),t=0===z.indexOf(".env"),E=0===z.indexOf(".basis");if(t?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=k,k&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),V)this._files=V;else if(E||t||i||R||(R=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,R){for(let c=0;c<R.length;c++)this._files.push(Z+R[c]);this._extensions=R}this._buffer=p,G?(this.delayLoadState=4,this._delayedOnLoad=L,this._delayedOnError=N):this._loadTexture(L,N)}delayLoad(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Z){var c,L;if(Z.updateFlag===this._textureMatrix.updateFlag)return;Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(L=this.XZ())||void 0===L||L.markAllMaterialsAsDirty(1,(Z=>-1!==Z.getActiveTextures().indexOf(this))));if(this._textureMatrix=Z,null===(c=this.XZ())||void 0===c||!c.useRightHandedSystem)return;const k=G.d.Mc[0],N=G.d.Quaternion[0],R=G.d.Mc[1];this._textureMatrix.decompose(k,N,R),N.z*=-1,N.w*=-1,G.b.ComposeToRef(k,N,R,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Z;return null!==(Z=this.XZ())&&void 0!==Z&&Z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this.XZ(),k=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const N=()=>{var c;(this.onLoadObservable.notifyObservers(this),k)&&(k.dispose(),null===(c=this.XZ())||void 0===c||c.markAllMaterialsAsDirty(1));Z&&Z()},G=(Z,L)=>{this._loadingError=!0,this._errorObject={message:Z,exception:L},c&&c(Z,L),p.c.OnTextureLoadErrorObservable.notifyObservers(this)};var V;this._texture?this._texture.isReady?R.c.SetImmediate((()=>N())):this._texture.onLoadedObservable.add((()=>N())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,L,this._lodScale,this._lodOffset,Z,G,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,L,this._files,this._noMipmap,Z,G,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(V=this._texture)||void 0===V||V.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Z,c,L){const k=i.e.Parse((()=>{let k=!1;return Z.prefiltered&&(k=Z.prefiltered),new t(L+(Z.url??Z.name),c,Z.extensions,!1,Z.files||null,null,null,void 0,k,Z.forcedExtension)}),Z,c);if(Z.boundingBoxPosition&&(k.boundingBoxPosition=G.h.oc(Z.boundingBoxPosition)),Z.boundingBoxSize&&(k.boundingBoxSize=G.h.oc(Z.boundingBoxSize)),Z.animations)for(let N=0;N<Z.animations.length;N++){const c=Z.animations[N],L=(0,J.d)("BABYLON.Animation");L&&k.animations.push(L.Parse(c))}return k}clone(){let Z=0;const c=i.e.Clone((()=>{const c=new t(this.url,this.XZ()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Z=c.uniqueId,c}),this);return c.uniqueId=Z,c}}(0,k.d)([(0,N.H)()],t.prototype,"url",void 0),(0,k.d)([(0,N.F)()],t.prototype,"boundingBoxPosition",void 0),(0,k.d)([(0,N.F)()],t.prototype,"boundingBoxSize",null),(0,k.d)([(0,N.H)("rotationY")],t.prototype,"rotationY",null),(0,k.d)([(0,N.H)("files")],t.prototype,"_files",void 0),(0,k.d)([(0,N.H)("forcedExtension")],t.prototype,"_forcedExtension",void 0),(0,k.d)([(0,N.H)("extensions")],t.prototype,"_extensions",void 0),(0,k.d)([(0,N.v)("textureMatrix")],t.prototype,"_textureMatrix",void 0),(0,k.d)([(0,N.v)("textureMatrixRefraction")],t.prototype,"_textureMatrixRefraction",void 0),p.c._CubeTextureParser=t.Parse,(0,J.g)("BABYLON.CubeTexture",t)},13319:(Z,c,L)=>{"use strict";L.d(c,{d:()=>p});var k=L(11052),N=L(11508),R=L(11159),G=L(11397),V=L(11139);G.ThinEngine.prototype.createDynamicTexture=function(Z,c,L,k){const N=new V.e(this,4);return N.baseWidth=Z,N.baseHeight=c,L&&(Z=this.needPOTTextures?(0,R.h)(Z,this._caps.maxTextureSize):Z,c=this.needPOTTextures?(0,R.h)(c,this._caps.maxTextureSize):c),N.width=Z,N.height=c,N.isReady=!1,N.generateMipMaps=L,N.samplingMode=k,this.updateTextureSamplingMode(k,N),this._internalTexturesCache.push(N),N},G.ThinEngine.prototype.updateDynamicTexture=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z)return;const G=this._gl,V=G.TEXTURE_2D,p=this._bindTextureDirectly(V,Z,!0,R);this._unpackFlipY(void 0===L?Z.invertY:L),k&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(Z.type),z=this._getInternalFormat(N||Z.format),i=this._getRGBABufferInternalSizedFormat(Z.type,z);G.texImage2D(V,0,i,z,J,c),Z.generateMipMaps&&G.generateMipmap(V),p||this._bindTextureDirectly(V,null),k&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),N&&(Z.format=N),Z._dynamicTextureSource=c,Z._premulAlpha=k,Z.invertY=L||!1,Z.isReady=!0};class p extends N.c{constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,V=arguments.length>6?arguments[6]:void 0;const p=!L||L._isScene;super(null,p?L:null===L||void 0===L?void 0:L.LL,p?!k:L,V,R,void 0,void 0,void 0,void 0,G),this.name=Z,this.wrapU=N.c.CLAMP_ADDRESSMODE,this.wrapV=N.c.CLAMP_ADDRESSMODE,this._generateMipMaps=k;const J=this._getEngine();if(!J)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,k,R);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const Z=c;Z.width||0===Z.width?this._texture=J.createDynamicTexture(Z.width,Z.height,k,R):this._texture=J.createDynamicTexture(c,c,k,R)}const z=this.getSize();this._canvas.width!==z.width&&(this._canvas.width=z.width),this._canvas.height!==z.height&&(this._canvas.height=z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)}scale(Z){const c=this.getSize();c.width*=Z,c.height*=Z,this._recreate(c)}scaleTo(Z,c){const L=this.getSize();L.width=Z,L.height=c,this._recreate(L)}getContext(){return this._context}clear(Z){const c=this.getSize();Z&&(this._context.fillStyle=Z),this._context.clearRect(0,0,c.width,c.height)}update(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,c,this._format||void 0,void 0,L)}drawText(Z,c,L,k,N,R,G){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const p=this.getSize();if(R&&(this._context.fillStyle=R,this._context.fillRect(0,0,p.width,p.height)),this._context.font=k,null===c||void 0===c){const L=this._context.measureText(Z);c=(p.width-L.width)/2}if(null===L||void 0===L){const Z=parseInt(k.replace(/\D/g,""));L=p.height/2+Z/3.65}this._context.fillStyle=N||"",this._context.fillText(Z,c,L),V&&this.update(G)}dispose(){var Z,c;(super.dispose(),this._ownCanvas)&&(null===(Z=this._canvas)||void 0===Z||null===(c=Z.remove)||void 0===c||c.call(Z));this._canvas=null,this._context=null}clone(){const Z=this.XZ();if(!Z)return this;const c=this.getSize(),L=new p(this.name,c,Z,this._generateMipMaps);return L.Oc=this.Oc,L.level=this.level,L.wrapU=this.wrapU,L.wrapV=this.wrapV,L}serialize(){const Z=this.XZ();Z&&!Z.isReady()&&k.e.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return p._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(Z){return void 0!==Z.toDataURL}_rebuild(){this.update()}}},12704:(Z,c,L)=>{"use strict";L.d(c,{c:()=>N});var k=L(11508);class N extends k.c{get depth(){return this._depth}constructor(Z,c,L,N,R,G){let V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:k.c.TRILINEAR_SAMPLINGMODE,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10?arguments[10]:void 0;super(null,G,!V,p),this.format=R,this._texture=G.getEngine().createRawTexture2DArray(Z,c,L,N,R,V,p,J,null,z,i),this._depth=N,this.is2DArray=!0}update(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Z,c,L,k,R){return new N(Z,c,L,k,5,R,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12529:(Z,c,L)=>{"use strict";L.d(c,{c:()=>V,g:()=>p,i:()=>R,l:()=>G});var k=L(11032),N=L(10993);function R(Z,c){return`{X: ${Z.x.toFixed(c)} Y: ${Z.y.toFixed(c)}}`}function G(Z,c){return`{X: ${Z._x.toFixed(c)} Y: ${Z._y.toFixed(c)} Z: ${Z._z.toFixed(c)}}`}function V(Z,c){return 2*Math.acos((0,k.Clamp)(N.c.Dot(Z,c)))}function p(Z,c){const L=new N.c;return function(Z,c,L){const R=N.h.Cross(Z,c),G=Math.acos((0,k.Clamp)(N.h.Dot(Z,c),-1,1));N.c.RotationAxisToRef(R,G,L)}(Z,c,L),L}},12384:(Z,c,L)=>{"use strict";L.d(c,{d:()=>J});var k=L(10993),N=L(11255),R=L(11325),G=L(11289),V=L(11371);L(12387);function p(Z){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const L=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],R=[];let p=[];const J=Z.width||Z.size||1,z=Z.height||Z.size||1,i=Z.depth||Z.size||1,t=Z.wrap||!1;let E=void 0===Z.topBaseAt?1:Z.topBaseAt,x=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt;E=(E+4)%4,x=(x+4)%4;let q=[2,0,3,1][E],O=[2,0,1,3][x],w=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(t){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],w=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const k=[17,18,19,16],N=[22,23,20,21];for(;q>0;)Z.unshift(Z.pop()),k.unshift(k.pop()),q--;for(;O>0;)L.unshift(L.pop()),N.unshift(N.pop()),O--;Z=Z.flat(),L=L.flat(),w=w.concat(Z).concat(L),c.push(k[0],k[2],k[3],k[0],k[1],k[2]),c.push(N[0],N[2],N[3],N[0],N[1],N[2])}const M=[J/2,z/2,i/2];p=w.reduce(((Z,c,L)=>Z.concat(c*M[L%3])),[]);const P=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,j=Z.faceUV||new Array(6),o=Z.faceColors,u=[];for(let G=0;G<6;G++)void 0===j[G]&&(j[G]=new k.j(0,0,1,1)),o&&void 0===o[G]&&(o[G]=new N.h(1,1,1,1));for(let k=0;k<6;k++)if(R.push(j[k].z,V.b?1-j[k].w:j[k].w),R.push(j[k].x,V.b?1-j[k].w:j[k].w),R.push(j[k].x,V.b?1-j[k].y:j[k].y),R.push(j[k].z,V.b?1-j[k].y:j[k].y),o)for(let Z=0;Z<4;Z++)u.push(o[k].r,o[k].g,o[k].b,o[k].a);G.e._ComputeSides(P,p,c,L,R,Z.frontUVs,Z.backUVs);const X=new G.e;if(X.indices=c,X.BZ=p,X.DZ=L,X.HZ=R,o){const Z=P===G.e.DOUBLESIDE?u.concat(u):u;X.eZ=Z}return X}function J(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new R.c(Z,L);c.sideOrientation=R.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return p(c).WZ(k,c.updatable),k}G.e.CreateBox=p,R.c.CreateBox=function(Z,c){return J(Z,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12517:(Z,c,L)=>{"use strict";L.d(c,{d:()=>V});var k=L(11325),N=L(11289),R=L(11371);function G(Z){const c=[],L=[],k=[],G=[],V=Z.radius||.5,p=Z.tessellation||64,J=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,z=0===Z.sideOrientation?0:Z.sideOrientation||N.e.DEFAULTSIDE;c.push(0,0,0),G.push(.5,.5);const i=2*Math.PI*J,t=1===J?i/p:i/(p-1);let E=0;for(let N=0;N<p;N++){const Z=Math.cos(E),L=Math.sin(E),k=(Z+1)/2,N=(1-L)/2;c.push(V*Z,V*L,0),G.push(k,R.b?1-N:N),E+=t}1===J&&(c.push(c[3],c[4],c[5]),G.push(G[2],R.b?1-G[3]:G[3]));const x=c.length/3;for(let N=1;N<x-1;N++)L.push(N+1,0,N);N.e.ComputeNormals(c,L,k),N.e._ComputeSides(z,c,L,k,G,Z.frontUVs,Z.backUVs);const q=new N.e;return q.indices=L,q.BZ=c,q.DZ=k,q.HZ=G,q}function V(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new k.c(Z,L);c.sideOrientation=k.c._GetDefaultSideOrientation(c.sideOrientation),N._originalBuilderSideOrientation=c.sideOrientation;return G(c).WZ(N,c.updatable),N}N.e.CreateDisc=G,k.c.CreateDisc=function(Z,c,L){return V(Z,{radius:c,tessellation:L,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12387:(Z,c,L)=>{"use strict";L.d(c,{h:()=>O,d:()=>M,i:()=>w});var k=L(10993),N=L(11255),R=L(11325),G=L(11289),V=L(11190);R.c._GroundMeshParser=(Z,c)=>p.Parse(Z,c);class p extends R.c{constructor(Z,c){super(Z,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);const L=this;L.createOrUpdateSubmeshesOctree&&L.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(Z,c){const L=this.getWorldMatrix(),N=k.d.Matrix[5];L.invertToRef(N);const R=k.d.Mc[8];if(k.h.TransformCoordinatesFromFloatsToRef(Z,0,c,N,R),Z=R.x,c=R.z,Z<this._minX||Z>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(Z,c),V=-(G.x*Z+G.z*c+G.w)/G.y;return k.h.TransformCoordinatesFromFloatsToRef(0,V,0,L,R),R.y}getNormalAtCoordinates(Z,c){const L=new k.h(0,1,0);return this.getNormalAtCoordinatesToRef(Z,c,L),L}getNormalAtCoordinatesToRef(Z,c,L){const N=this.getWorldMatrix(),R=k.d.Matrix[5];N.invertToRef(R);const G=k.d.Mc[8];if(k.h.TransformCoordinatesFromFloatsToRef(Z,0,c,R,G),Z=G.x,c=G.z,Z<this._minX||Z>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(Z,c);return k.h.TransformNormalFromFloatsToRef(V.x,V.y,V.z,N,L),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Z,c){const L=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),k=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),N=this._heightQuads[k*this._subdivisionsX+L];let R;return R=c<N.slope.x*Z+N.slope.y?N.facet1:N.facet2,R}_initHeightQuads(){const Z=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let L=0;L<c;L++)for(let c=0;c<Z;c++){const N={slope:k.f.Zero(),facet1:new k.j(0,0,0,0),facet2:new k.j(0,0,0,0)};this._heightQuads[L*Z+c]=N}return this}_computeHeightQuads(){const Z=this.getVerticesData(V.g.PositionKind);if(!Z)return this;const c=k.d.Mc[3],L=k.d.Mc[2],N=k.d.Mc[1],R=k.d.Mc[0],G=k.d.Mc[4],p=k.d.Mc[5],J=k.d.Mc[6],z=k.d.Mc[7],i=k.d.Mc[8];let t=0,E=0,x=0,q=0,O=0,w=0,M=0;const P=this._subdivisionsX,j=this._subdivisionsY;for(let V=0;V<j;V++)for(let j=0;j<P;j++){t=3*j,E=V*(P+1)*3,x=(V+1)*(P+1)*3,c.x=Z[E+t],c.y=Z[E+t+1],c.z=Z[E+t+2],L.x=Z[E+t+3],L.y=Z[E+t+4],L.z=Z[E+t+5],N.x=Z[x+t],N.y=Z[x+t+1],N.z=Z[x+t+2],R.x=Z[x+t+3],R.y=Z[x+t+4],R.z=Z[x+t+5],q=(R.z-c.z)/(R.x-c.x),O=c.z-q*c.x,L.subtractToRef(c,G),N.subtractToRef(c,p),R.subtractToRef(c,J),k.h.CrossToRef(J,p,z),k.h.CrossToRef(G,J,i),z.normalize(),i.normalize(),w=-(z.x*c.x+z.y*c.y+z.z*c.z),M=-(i.x*L.x+i.y*L.y+i.z*L.z);const o=this._heightQuads[V*P+j];o.slope.wc(q,O),o.facet1.wc(z.x,z.y,z.z,w),o.facet2.wc(i.x,i.y,i.z,M)}return this}serialize(Z){super.serialize(Z),Z.subdivisionsX=this._subdivisionsX,Z.subdivisionsY=this._subdivisionsY,Z.minX=this._minX,Z.maxX=this._maxX,Z.Dc=this._minZ,Z.maxZ=this._maxZ,Z.width=this._width,Z.height=this._height}static Parse(Z,c){const L=new p(Z.name,c);return L._subdivisionsX=Z.subdivisionsX||1,L._subdivisionsY=Z.subdivisionsY||1,L._minX=Z.minX,L._maxX=Z.maxX,L._minZ=Z.Dc,L._maxZ=Z.maxZ,L._width=Z.width,L._height=Z.height,L}}var J=L(11038),z=L(11023),i=L(10999),t=L(11371);function E(Z){const c=[],L=[],N=[],R=[];let V,p;const J=Z.width||Z.size||1,z=Z.height||Z.size||1,i=0|(Z.subdivisionsX||Z.subdivisions||1),E=0|(Z.subdivisionsY||Z.subdivisions||1);for(V=0;V<=E;V++)for(p=0;p<=i;p++){const Z=new k.h(p*J/i-J/2,0,(E-V)*z/E-z/2),c=new k.h(0,1,0);L.push(Z.x,Z.y,Z.z),N.push(c.x,c.y,c.z),R.push(p/i,t.b?V/E:1-V/E)}for(V=0;V<E;V++)for(p=0;p<i;p++)c.push(p+1+(V+1)*(i+1)),c.push(p+1+V*(i+1)),c.push(p+V*(i+1)),c.push(p+(V+1)*(i+1)),c.push(p+1+(V+1)*(i+1)),c.push(p+V*(i+1));const x=new G.e;return x.indices=c,x.BZ=L,x.DZ=N,x.HZ=R,x}function x(Z){const c=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,L=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,N=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,R=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,V=Z.subdivisions||{w:1,h:1},p=Z.precision||{w:1,h:1},J=[],z=[],i=[],t=[];let E,x,q,O;V.h=V.h<1?1:V.h,V.w=V.w<1?1:V.w,p.w=p.w<1?1:p.w,p.h=p.h<1?1:p.h;const w=(N-c)/V.w,M=(R-L)/V.h;function P(Z,c,L,N){const R=z.length/3,G=p.w+1;for(E=0;E<p.h;E++)for(x=0;x<p.w;x++){const Z=[R+x+E*G,R+(x+1)+E*G,R+(x+1)+(E+1)*G,R+x+(E+1)*G];J.push(Z[1]),J.push(Z[2]),J.push(Z[3]),J.push(Z[0]),J.push(Z[1]),J.push(Z[3])}const V=k.h.Zero(),q=new k.h(0,1,0);for(E=0;E<=p.h;E++)for(V.z=E*(N-c)/p.h+c,x=0;x<=p.w;x++)V.x=x*(L-Z)/p.w+Z,V.y=0,z.push(V.x,V.y,V.z),i.push(q.x,q.y,q.z),t.push(x/p.w,E/p.h)}for(q=0;q<V.h;q++)for(O=0;O<V.w;O++)P(c+O*w,L+q*M,c+(O+1)*w,L+(q+1)*M);const j=new G.e;return j.indices=J,j.BZ=z,j.DZ=i,j.HZ=t,j}function q(Z){const c=[],L=[],R=[],V=[];let p,J;const z=Z.colorFilter||new N.d(.3,.59,.11),t=Z.alphaFilter||0;let E=!1;if(Z.minHeight>Z.maxHeight){E=!0;const c=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=c}for(p=0;p<=Z.subdivisions;p++)for(J=0;J<=Z.subdivisions;J++){const c=new k.h(J*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-p)*Z.height/Z.subdivisions-Z.height/2),N=4*(((c.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(c.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth);let G=Z.buffer[N]/255,x=Z.buffer[N+1]/255,q=Z.buffer[N+2]/255;const O=Z.buffer[N+3]/255;E&&(G=1-G,x=1-x,q=1-q);const w=G*z.r+x*z.g+q*z.b;c.y=O>=t?Z.minHeight+(Z.maxHeight-Z.minHeight)*w:Z.minHeight-i.e,Z.heightBuffer&&(Z.heightBuffer[p*(Z.subdivisions+1)+J]=c.y),L.push(c.x,c.y,c.z),R.push(0,0,0),V.push(J/Z.subdivisions,1-p/Z.subdivisions)}for(p=0;p<Z.subdivisions;p++)for(J=0;J<Z.subdivisions;J++){const k=J+1+(p+1)*(Z.subdivisions+1),N=J+1+p*(Z.subdivisions+1),R=J+p*(Z.subdivisions+1),G=J+(p+1)*(Z.subdivisions+1),V=L[3*k+1]>=Z.minHeight,z=L[3*N+1]>=Z.minHeight,i=L[3*R+1]>=Z.minHeight;V&&z&&i&&(c.push(k),c.push(N),c.push(R));L[3*G+1]>=Z.minHeight&&V&&i&&(c.push(G),c.push(k),c.push(R))}G.e.ComputeNormals(L,c,R);const x=new G.e;return x.indices=c,x.BZ=L,x.DZ=R,x.HZ=V,x}function O(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const L=new p(Z,arguments.length>2?arguments[2]:void 0);L._setReady(!1),L._subdivisionsX=c.subdivisionsX||c.subdivisions||1,L._subdivisionsY=c.subdivisionsY||c.subdivisions||1,L._width=c.width||1,L._height=c.height||1,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ;return E(c).WZ(L,c.updatable),L._setReady(!0),L}function w(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new R.c(Z,L);return x(c).WZ(k,c.updatable),k}function M(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=L.width||10,G=L.height||10,V=L.subdivisions||1,i=L.minHeight||0,t=L.maxHeight||1,E=L.colorFilter||new N.d(.3,.59,.11),x=L.alphaFilter||0,O=L.updatable,w=L.onReady;k=k||z.d.LastCreatedScene;const M=new p(Z,k);let P;M._subdivisionsX=V,M._subdivisionsY=V,M._width=R,M._height=G,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ,M._setReady(!1),L.passHeightBufferInCallback&&(P=new Float32Array((V+1)*(V+1)));const j=(Z,c,L)=>{q({width:R,height:G,subdivisions:V,minHeight:i,maxHeight:t,colorFilter:E,buffer:Z,bufferWidth:c,bufferHeight:L,alphaFilter:x,heightBuffer:P}).WZ(M,O),w&&w(M,P),M._setReady(!0)};if("string"===typeof c){const Z=Z=>{var c;const L=Z.width,N=Z.height;if(k.p)return;const R=null===(c=k)||void 0===c?void 0:c.getEngine().resizeImageBitmap(Z,L,N);j(R,L,N)};J.c.LoadImage(c,Z,L.onError?L.onError:()=>{},k.offlineProvider)}else j(c.data,c.width,c.height);return M}G.e.CreateGround=E,G.e.CreateTiledGround=x,G.e.CreateGroundFromHeightMap=q,R.c.CreateGround=(Z,c,L,k,N,R)=>O(Z,{width:c,height:L,subdivisions:k,updatable:R},N),R.c.CreateTiledGround=(Z,c,L,k,N,R,G,V,p)=>w(Z,{xmin:c,zmin:L,xmax:k,zmax:N,subdivisions:R,precision:G,updatable:p},V),R.c.CreateGroundFromHeightMap=(Z,c,L,k,N,R,G,V,p,J,z)=>M(Z,c,{width:L,height:k,subdivisions:N,minHeight:R,maxHeight:G,updatable:p,onReady:J,alphaFilter:z},V)},13017:(Z,c,L)=>{"use strict";L.d(c,{d:()=>E,e:()=>i,f:()=>t});var k=L(10993),N=L(11325),R=L(11289),G=L(11736),V=L(11190),p=L(11052);function J(Z){const c=[],L=[],k=Z.lines,N=Z.eZ,G=[];let V=0;for(let R=0;R<k.length;R++){const Z=k[R];for(let k=0;k<Z.length;k++){const{x:p,y:J,z:z}=Z[k];if(L.push(p,J,z),N){const Z=N[R],{r:c,g:L,b:V,a:p}=Z[k];G.push(c,L,V,p)}k>0&&(c.push(V-1),c.push(V)),V++}}const p=new R.e;return p.indices=c,p.BZ=L,N&&(p.eZ=G),p}function z(Z){const c=Z.dashSize||3,L=Z.gapSize||1,N=Z.dashNb||200,G=Z.points,V=[],p=[],J=k.h.Zero();let z=0,i=0,t=0,E=0,x=0,q=0,O=0;for(O=0;O<G.length-1;O++)G[O+1].subtractToRef(G[O],J),z+=J.length();for(t=z/N,E=c*t/(c+L),O=0;O<G.length-1;O++){G[O+1].subtractToRef(G[O],J),i=Math.floor(J.length()/t),J.normalize();for(let Z=0;Z<i;Z++)x=t*Z,V.push(G[O].x+x*J.x,G[O].y+x*J.y,G[O].z+x*J.z),V.push(G[O].x+(x+E)*J.x,G[O].y+(x+E)*J.y,G[O].z+(x+E)*J.z),p.push(q,q+1),q+=2}const w=new R.e;return w.BZ=V,w.indices=p,w}function i(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=c.instance,N=c.lines,R=c.eZ;if(k){const Z=k.getVerticesData(V.g.PositionKind);let c,L;R&&(c=k.getVerticesData(V.g.ColorKind));let G=0,p=0;for(let k=0;k<N.length;k++){const V=N[k];for(let N=0;N<V.length;N++)Z[G]=V[N].x,Z[G+1]=V[N].y,Z[G+2]=V[N].z,R&&c&&(L=R[k],c[p]=L[N].r,c[p+1]=L[N].g,c[p+2]=L[N].b,c[p+3]=L[N].a,p+=4),G+=3}return k.updateVerticesData(V.g.PositionKind,Z,!1,!1),R&&c&&k.updateVerticesData(V.g.ColorKind,c,!1,!1),k.refreshBoundingInfo(),k}const p=!!R,z=new G.b(Z,L,null,void 0,void 0,p,c.useVertexAlpha,c.material);return J(c).WZ(z,c.updatable),z}function t(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=c.eZ?[c.eZ]:null;return i(Z,{lines:[c.points],updatable:c.updatable,instance:c.instance,eZ:k,useVertexAlpha:c.useVertexAlpha,material:c.material},L)}function E(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=c.points,V=c.instance,J=c.gapSize||1,i=c.dashSize||3;if(V){const Z=Z=>{const c=k.h.Zero(),L=Z.length/6;let N=0,G=0,p=0,J=0,z=0,i=0,t=0,E=0;for(t=0;t<R.length-1;t++)R[t+1].subtractToRef(R[t],c),N+=c.length();p=N/L;const x=V._creationDataStorage.dashSize;for(J=x*p/(x+V._creationDataStorage.gapSize),t=0;t<R.length-1;t++)for(R[t+1].subtractToRef(R[t],c),G=Math.floor(c.length()/p),c.normalize(),E=0;E<G&&i<Z.length;)z=p*E,Z[i]=R[t].x+z*c.x,Z[i+1]=R[t].y+z*c.y,Z[i+2]=R[t].z+z*c.z,Z[i+3]=R[t].x+(z+J)*c.x,Z[i+4]=R[t].y+(z+J)*c.y,Z[i+5]=R[t].z+(z+J)*c.z,i+=6,E++;for(;i<Z.length;)Z[i]=R[t].x,Z[i+1]=R[t].y,Z[i+2]=R[t].z,i+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&p.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),V.updateMeshPositions(Z,!1),V}const t=new G.b(Z,L,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return z(c).WZ(t,c.updatable),t._creationDataStorage=new N.d,t._creationDataStorage.dashSize=i,t._creationDataStorage.gapSize=J,t}R.e.CreateLineSystem=J,R.e.CreateDashedLines=z,N.c.RJ=function(Z,c){return t(Z,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},N.c.CreateDashedLines=function(Z,c,L,k,N){return E(Z,{points:c,dashSize:L,gapSize:k,dashNb:N,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12438:(Z,c,L)=>{"use strict";L.d(c,{b:()=>V,d:()=>p});var k=L(11325),N=L(11289),R=L(11371);function G(Z){const c=[],L=[],k=[],G=[],V=void 0!==Z.width?Z.width:void 0!==Z.size?Z.size:1,p=void 0!==Z.height?Z.height:void 0!==Z.size?Z.size:1,J=0===Z.sideOrientation?0:Z.sideOrientation||N.e.DEFAULTSIDE,z=V/2,i=p/2;L.push(-z,-i,0),k.push(0,0,-1),G.push(0,R.b?1:0),L.push(z,-i,0),k.push(0,0,-1),G.push(1,R.b?1:0),L.push(z,i,0),k.push(0,0,-1),G.push(1,R.b?0:1),L.push(-z,i,0),k.push(0,0,-1),G.push(0,R.b?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),N.e._ComputeSides(J,L,c,k,G,Z.frontUVs,Z.backUVs);const t=new N.e;return t.indices=c,t.BZ=L,t.DZ=k,t.HZ=G,t}function V(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new k.c(Z,L);c.sideOrientation=k.c._GetDefaultSideOrientation(c.sideOrientation),N._originalBuilderSideOrientation=c.sideOrientation;return G(c).WZ(N,c.updatable),c.sourcePlane&&(N.translate(c.sourcePlane.kc,-c.sourcePlane.d),N.setDirection(c.sourcePlane.kc.scale(-1))),N}const p={VJ:V};N.e.VJ=G,k.c.VJ=(Z,c,L,k,N)=>V(Z,{size:c,width:c,height:c,sideOrientation:N,updatable:k},L)},12508:(Z,c,L)=>{"use strict";L.d(c,{b:()=>p});var k=L(10993),N=L(11325),R=L(11289),G=L(11371);function V(Z){const c=0|(Z.segments||32),L=Z.diameterX||Z.diameter||1,N=Z.diameterY||Z.diameter||1,V=Z.diameterZ||Z.diameter||1,p=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,J=Z.slice&&Z.slice<=0?1:Z.slice||1,z=0===Z.sideOrientation?0:Z.sideOrientation||R.e.DEFAULTSIDE,i=!!Z.dedupTopBottomIndices,t=new k.h(L/2,N/2,V/2),E=2+c,x=2*E,q=[],O=[],w=[],M=[];for(let R=0;R<=E;R++){const Z=R/E,c=Z*Math.PI*J;for(let L=0;L<=x;L++){const N=L/x,R=N*Math.PI*2*p,V=k.b.RotationZ(-c),J=k.b.RotationY(R),z=k.h.TransformCoordinates(k.h.Up(),V),i=k.h.TransformCoordinates(z,J),E=i.multiply(t),q=i.divide(t).normalize();O.push(E.x,E.y,E.z),w.push(q.x,q.y,q.z),M.push(N,G.b?1-Z:Z)}if(R>0){const Z=O.length/3;for(let c=Z-2*(x+1);c+x+2<Z;c++)i?(R>1&&(q.push(c),q.push(c+1),q.push(c+x+1)),(R<E||J<1)&&(q.push(c+x+1),q.push(c+1),q.push(c+x+2))):(q.push(c),q.push(c+1),q.push(c+x+1),q.push(c+x+1),q.push(c+1),q.push(c+x+2))}}R.e._ComputeSides(z,O,q,w,M,Z.frontUVs,Z.backUVs);const P=new R.e;return P.indices=q,P.BZ=O,P.DZ=w,P.HZ=M,P}function p(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return V(c).WZ(k,c.updatable),k}R.e.CreateSphere=V,N.c.CreateSphere=(Z,c,L,k,N,R)=>p(Z,{segments:c,diameterX:L,diameterY:L,diameterZ:L,sideOrientation:R,updatable:N},k)},13327:(Z,c,L)=>{"use strict";L.d(c,{e:()=>V});var k=L(11765),N=L(12795),R=L(11781),G=L(11289);class V{static get Configuration(){return{get decoder(){return N.c.DefaultConfiguration},set decoder(Z){N.c.DefaultConfiguration=Z}}}static set Configuration(Z){N.c.DefaultConfiguration=Z.decoder}static get DecoderAvailable(){return(0,k.h)(N.c.DefaultConfiguration)}static get Default(){return V._Default??(V._Default=new V),V._Default}static ResetDefault(Z){V._Default&&(Z||V._Default.dispose(),V._Default=null)}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.DefaultNumWorkers;const c="number"===typeof Z?{...N.c.DefaultConfiguration,numWorkers:Z}:{...N.c.DefaultConfiguration,...Z};this._decoder=new N.c(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Z,c,L){return this._decoder.decodeMeshToMeshDataAsync(Z,c,L)}async decodeMeshToGeometryAsync(Z,c,L,k){return await this._decoder.decodeMeshToGeometryAsync(Z,c,L,k)}async _decodeMeshToGeometryForGltfAsync(Z,c,L,k,N,R){return await this._decoder._decodeMeshToGeometryForGltfAsync(Z,c,L,k,N,R)}async decodeMeshAsync(Z,c){const L=await this._decoder.decodeMeshToMeshDataAsync(Z,c),k=new G.e;L.indices&&(k.indices=L.indices);for(const N of L.attributes){const Z=R.c.GetFloatData(N.data,N.size,R.c.GetDataType(N.data),N.byteOffset,N.byteStride,N.normalized,L.totalVertices);k.set(Z,N.kind)}return k}}V.DefaultNumWorkers=(0,k.e)(),V._Default=null},12795:(Z,c,L)=>{"use strict";L.d(c,{c:()=>J});var k=L(11765),N=L(11038),R=L(11358),G=L(11781),V=L(11052),p=L(11777);class J extends k.c{static get DefaultAvailable(){return(0,k.h)(J.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(Z){J._Default&&(Z||J._Default.dispose(),J._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Z,c){return{module:await(c||DracoDecoderModule)({wasmBinary:Z})}}_getWorkerContent(){return`${p.c}(${p.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultConfiguration)}decodeMeshToMeshDataAsync(Z,c,L){const k=Z instanceof ArrayBuffer?new Int8Array(Z):new Int8Array(Z.buffer,Z.byteOffset,Z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Z=>await new Promise(((N,R)=>{Z.push(((Z,G)=>{let p=null;const J=[],z=c=>{Z.removeEventListener("error",z),Z.removeEventListener("message",i),R(c),G()},i=c=>{const k=c.data;switch(k.id){case"indices":p=k.data;break;case"attribute":J.push({kind:k.kind,data:k.data,size:k.size,byteOffset:k.byteOffset,byteStride:k.byteStride,normalized:(R=k.kind,t=k.normalized,L&&void 0!==L[R]?(t!==L[R]&&V.e.Warn(`Normalized flag from Draco data (${t}) does not match normalized flag from glTF accessor (${L[R]}). Using flag from glTF accessor.`),L[R]):t)});break;case"decodeMeshDone":Z.removeEventListener("error",z),Z.removeEventListener("message",i),N({indices:p,attributes:J,totalVertices:k.totalVertices}),G()}var R,t};Z.addEventListener("error",z),Z.addEventListener("message",i);const t=k.slice();Z.postMessage({id:"decodeMesh",dataView:t,attributes:c},[t.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Z=>{let L=null;const N=[],R=(0,p.c)(Z.module,k,c,(Z=>{L=Z}),((Z,c,L,k,R,G)=>{N.push({kind:Z,data:c,size:L,byteOffset:k,byteStride:R,normalized:G})}));return{indices:L,attributes:N,totalVertices:R}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Z,c,L,k){const N=await this.decodeMeshToMeshDataAsync(L,k),V=new R.e(Z,c);N.indices&&V.setIndices(N.indices);for(const R of N.attributes)V.setVerticesBuffer(new G.c(c.getEngine(),R.data,R.kind,!1,void 0,R.byteStride,void 0,R.byteOffset,R.size,void 0,R.normalized,!0),N.totalVertices);return V}async _decodeMeshToGeometryForGltfAsync(Z,c,L,k,N,V){const p=await this.decodeMeshToMeshDataAsync(L,k,N),J=new R.e(Z,c);V&&(J._boundingInfo=V,J.useBoundingInfoFromGeometry=!0),p.indices&&J.setIndices(p.indices);for(const R of p.attributes)J.setVerticesBuffer(new G.c(c.getEngine(),R.data,R.kind,!1,void 0,R.byteStride,void 0,R.byteOffset,R.size,void 0,R.normalized,!0),p.totalVertices);return J}}J.DefaultConfiguration={wasmUrl:`${N.c._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${N.c._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${N.c._DefaultCdnUrl}/draco_decoder_gltf.js`},J._Default=null},13010:(Z,c,L)=>{"use strict";L.d(c,{c:()=>VZ});var k=L(10993),N=L(11325),R=L(11190),G=L(11289),V=L(11371);function p(Z){let c=Z.pathArray;const L=Z.closeArray||!1,k=Z.closePath||!1,N=Z.invertUV||!1,p=Math.floor(c[0].length/2);let J=Z.offset||p;J=J>p?p:Math.floor(J);const z=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,i=Z.HZ,t=Z.eZ,E=[],x=[],q=[],O=[],w=[],M=[],P=[],j=[];let o;const u=[],X=[];let h,B,D;if(c.length<2){const Z=[],L=[];for(B=0;B<c[0].length-J;B++)Z.push(c[0][B]),L.push(c[0][B+J]);c=[Z,L]}let e=0;const H=k?1:0,l=L?1:0;let W,T,I,d,Q,r;for(o=c[0].length,h=0;h<c.length+l;h++){for(P[h]=0,w[h]=[0],W=h===c.length?c[0]:c[h],T=W.length,o=o<T?o:T,D=0;D<T;)E.push(W[D].x,W[D].y,W[D].z),D>0&&(I=W[D].yL(W[D-1]).length(),d=I+P[h],w[h].push(d),P[h]=d),D++;k&&(D--,E.push(W[0].x,W[0].y,W[0].z),I=W[D].yL(W[0]).length(),d=I+P[h],w[h].push(d),P[h]=d),u[h]=T+H,X[h]=e,e+=T+H}let f,S,s=null,m=null;for(B=0;B<o+H;B++)for(j[B]=0,M[B]=[0],h=0;h<c.length-1+l;h++)Q=c[h],r=h===c.length-1?c[0]:c[h+1],B===o?(s=Q[0],m=r[0]):(s=Q[B],m=r[B]),I=m.yL(s).length(),d=I+j[B],M[B].push(d),j[B]=d;if(i)for(h=0;h<i.length;h++)O.push(i[h].x,V.b?1-i[h].y:i[h].y);else for(h=0;h<c.length+l;h++)for(B=0;B<o+H;B++)f=0!=P[h]?w[h][B]/P[h]:0,S=0!=j[B]?M[B][h]/j[B]:0,N?O.push(S,f):O.push(f,V.b?1-S:S);h=0;let A=0,b=u[h]-1,F=u[h+1]-1,U=b<F?b:F,K=X[1]-X[0];const n=u.length-1;for(;A<=U&&h<n;)x.push(A,A+K,A+1),x.push(A+K+1,A+1,A+K),A+=1,A===U&&(h++,K=X[h+1]-X[h],b=u[h]-1,F=u[h+1]-1,A=X[h],U=b<F?b+A:F+A);if(G.e.ComputeNormals(E,x,q),k){let Z=0,L=0;for(h=0;h<c.length;h++){Z=3*X[h],L=h+1<c.length?3*(X[h+1]-1):q.length-3,q[Z]=.5*(q[Z]+q[L]),q[Z+1]=.5*(q[Z+1]+q[L+1]),q[Z+2]=.5*(q[Z+2]+q[L+2]);const k=Math.sqrt(q[Z]*q[Z]+q[Z+1]*q[Z+1]+q[Z+2]*q[Z+2]);q[Z]/=k,q[Z+1]/=k,q[Z+2]/=k,q[L]=q[Z],q[L+1]=q[Z+1],q[L+2]=q[Z+2]}}if(L){let Z=3*X[0],L=3*X[c.length];for(B=0;B<o+H;B++){q[Z]=.5*(q[Z]+q[L]),q[Z+1]=.5*(q[Z+1]+q[L+1]),q[Z+2]=.5*(q[Z+2]+q[L+2]);const c=Math.sqrt(q[Z]*q[Z]+q[Z+1]*q[Z+1]+q[Z+2]*q[Z+2]);q[Z]/=c,q[Z+1]/=c,q[Z+2]/=c,q[L]=q[Z],q[L+1]=q[Z+1],q[L+2]=q[Z+2],Z+=3,L+=3}}G.e._ComputeSides(z,E,x,q,O,Z.frontUVs,Z.backUVs);let g=null;if(t){g=new Float32Array(4*t.length);for(let Z=0;Z<t.length;Z++)g[4*Z]=t[Z].r,g[4*Z+1]=t[Z].g,g[4*Z+2]=t[Z].b,g[4*Z+3]=t[Z].a}const y=new G.e,v=new Float32Array(E),Y=new Float32Array(q),a=new Float32Array(O);return y.indices=x,y.BZ=v,y.DZ=Y,y.HZ=a,g&&y.set(g,R.g.ColorKind),k&&(y._idx=X),y}function J(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=c.pathArray,z=c.closeArray,i=c.closePath,t=N.c._GetDefaultSideOrientation(c.sideOrientation),E=c.instance,x=c.updatable;if(E){const Z=k.d.Mc[0].uc(Number.MAX_VALUE),L=k.d.Mc[1].uc(-Number.MAX_VALUE),p=c=>{let k=J[0].length;const R=E;let G=0;const V=R._originalBuilderSideOrientation===N.c.DOUBLESIDE?2:1;for(let N=1;N<=V;++N)for(let V=0;V<J.length;++V){const N=J[V],p=N.length;k=k<p?k:p;for(let R=0;R<k;++R){const k=N[R];c[G]=k.x,c[G+1]=k.y,c[G+2]=k.z,Z.minimizeInPlaceFromFloats(k.x,k.y,k.z),L.maximizeInPlaceFromFloats(k.x,k.y,k.z),G+=3}if(R._creationDataStorage&&R._creationDataStorage.closePath){const Z=N[0];c[G]=Z.x,c[G+1]=Z.y,c[G+2]=Z.z,G+=3}}},z=E.getVerticesData(R.g.PositionKind);if(p(z),E.hasBoundingInfo?E.getBoundingInfo().reConstruct(Z,L,E._worldMatrix):E.buildBoundingInfo(Z,L,E._worldMatrix),E.updateVerticesData(R.g.PositionKind,z,!1,!1),c.eZ){const Z=E.getVerticesData(R.g.ColorKind);for(let L=0,k=0;L<c.eZ.length;L++,k+=4){const N=c.eZ[L];Z[k]=N.r,Z[k+1]=N.g,Z[k+2]=N.b,Z[k+3]=N.a}E.updateVerticesData(R.g.ColorKind,Z,!1,!1)}if(c.HZ){const Z=E.getVerticesData(R.g.UVKind);for(let L=0;L<c.HZ.length;L++)Z[2*L]=c.HZ[L].x,Z[2*L+1]=V.b?1-c.HZ[L].y:c.HZ[L].y;E.updateVerticesData(R.g.UVKind,Z,!1,!1)}if(!E.areNormalsFrozen||E.isFacetDataEnabled){const Z=E.tc(),c=E.getVerticesData(R.g.NormalKind),L=E.isFacetDataEnabled?E.getFacetDataParameters():null;if(G.e.ComputeNormals(z,Z,c,L),E._creationDataStorage&&E._creationDataStorage.closePath){let Z=0,L=0;for(let k=0;k<J.length;k++)Z=3*E._creationDataStorage.idx[k],L=k+1<J.length?3*(E._creationDataStorage.idx[k+1]-1):c.length-3,c[Z]=.5*(c[Z]+c[L]),c[Z+1]=.5*(c[Z+1]+c[L+1]),c[Z+2]=.5*(c[Z+2]+c[L+2]),c[L]=c[Z],c[L+1]=c[Z+1],c[L+2]=c[Z+2]}E.areNormalsFrozen||E.updateVerticesData(R.g.NormalKind,c,!1,!1)}return E}{const k=new N.c(Z,L);k._originalBuilderSideOrientation=t,k._creationDataStorage=new N.d;const R=p(c);return i&&(k._creationDataStorage.idx=R._idx),k._creationDataStorage.closePath=i,k._creationDataStorage.closeArray=z,R.WZ(k,x),k}}G.e.CreateRibbon=p,N.c.CreateRibbon=function(Z,c){return J(Z,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var z=L(12517),i=L(12384),t=L(11255);function E(Z){const c=Z.pattern||N.c.NO_FLIP,L=Z.tileWidth||Z.tileSize||1,k=Z.tileHeight||Z.tileSize||1,R=Z.alignHorizontal||0,V=Z.alignVertical||0,p=Z.width||Z.size||1,J=Math.floor(p/L);let z=p-J*L;const i=Z.height||Z.size||1,t=Math.floor(i/k);let E=i-t*k;const x=L*J/2,q=k*t/2;let O=0,w=0,M=0,P=0,j=0,o=0;if(z>0||E>0){switch(M=-x,P=-q,j=x,o=q,R){case N.c.CENTER:z/=2,M-=z,j+=z;break;case N.c.LEFT:j+=z,O=-z/2;break;case N.c.RIGHT:M-=z,O=z/2}switch(V){case N.c.CENTER:E/=2,P-=E,o+=E;break;case N.c.BOTTOM:o+=E,w=-E/2;break;case N.c.TOP:P-=E,w=E/2}}const u=[],X=[],h=[];h[0]=[0,0,1,0,1,1,0,1],h[1]=[0,0,1,0,1,1,0,1],c!==N.c.ROTATE_TILE&&c!==N.c.ROTATE_ROW||(h[1]=[1,1,0,1,0,0,1,0]),c!==N.c.FLIP_TILE&&c!==N.c.FLIP_ROW||(h[1]=[1,0,0,0,0,1,1,1]),c!==N.c.FLIP_N_ROTATE_TILE&&c!==N.c.FLIP_N_ROTATE_ROW||(h[1]=[0,1,1,1,1,0,0,0]);let B=[];const D=[],e=[];let H=0;for(let G=0;G<t;G++)for(let Z=0;Z<J;Z++)u.push(Z*L-x+O,G*k-q+w,0),u.push((Z+1)*L-x+O,G*k-q+w,0),u.push((Z+1)*L-x+O,(G+1)*k-q+w,0),u.push(Z*L-x+O,(G+1)*k-q+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),B=c===N.c.FLIP_TILE||c===N.c.ROTATE_TILE||c===N.c.FLIP_N_ROTATE_TILE?B.concat(h[(Z%2+G%2)%2]):c===N.c.FLIP_ROW||c===N.c.ROTATE_ROW||c===N.c.FLIP_N_ROTATE_ROW?B.concat(h[G%2]):B.concat(h[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),H+=4;if(z>0||E>0){const Z=E>0&&(V===N.c.CENTER||V===N.c.TOP),G=E>0&&(V===N.c.CENTER||V===N.c.BOTTOM),p=z>0&&(R===N.c.CENTER||R===N.c.RIGHT),i=z>0&&(R===N.c.CENTER||R===N.c.LEFT);let h,l,W,T,I=[];if(Z&&p&&(u.push(M+O,P+w,0),u.push(-x+O,P+w,0),u.push(-x+O,P+E+w,0),u.push(M+O,P+E+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,h=1-z/L,l=1-E/k,W=1,T=1,I=[h,l,W,l,W,T,h,T],c===N.c.ROTATE_ROW&&(I=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),c===N.c.FLIP_ROW&&(I=[1-h,l,1-W,l,1-W,T,1-h,T]),c===N.c.FLIP_N_ROTATE_ROW&&(I=[h,1-l,W,1-l,W,1-T,h,1-T]),B=B.concat(I),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&i&&(u.push(x+O,P+w,0),u.push(j+O,P+w,0),u.push(j+O,P+E+w,0),u.push(x+O,P+E+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,h=0,l=1-E/k,W=z/L,T=1,I=[h,l,W,l,W,T,h,T],(c===N.c.ROTATE_ROW||c===N.c.ROTATE_TILE&&J%2===0)&&(I=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),(c===N.c.FLIP_ROW||c===N.c.FLIP_TILE&&J%2===0)&&(I=[1-h,l,1-W,l,1-W,T,1-h,T]),(c===N.c.FLIP_N_ROTATE_ROW||c===N.c.FLIP_N_ROTATE_TILE&&J%2===0)&&(I=[h,1-l,W,1-l,W,1-T,h,1-T]),B=B.concat(I),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&p&&(u.push(M+O,q+w,0),u.push(-x+O,q+w,0),u.push(-x+O,o+w,0),u.push(M+O,o+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,h=1-z/L,l=0,W=1,T=E/k,I=[h,l,W,l,W,T,h,T],(c===N.c.ROTATE_ROW&&t%2===1||c===N.c.ROTATE_TILE&&t%1===0)&&(I=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),(c===N.c.FLIP_ROW&&t%2===1||c===N.c.FLIP_TILE&&t%2===0)&&(I=[1-h,l,1-W,l,1-W,T,1-h,T]),(c===N.c.FLIP_N_ROTATE_ROW&&t%2===1||c===N.c.FLIP_N_ROTATE_TILE&&t%2===0)&&(I=[h,1-l,W,1-l,W,1-T,h,1-T]),B=B.concat(I),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&i&&(u.push(x+O,q+w,0),u.push(j+O,q+w,0),u.push(j+O,o+w,0),u.push(x+O,o+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,h=0,l=0,W=z/L,T=E/k,I=[h,l,W,l,W,T,h,T],(c===N.c.ROTATE_ROW&&t%2===1||c===N.c.ROTATE_TILE&&(t+J)%2===1)&&(I=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),(c===N.c.FLIP_ROW&&t%2===1||c===N.c.FLIP_TILE&&(t+J)%2===1)&&(I=[1-h,l,1-W,l,1-W,T,1-h,T]),(c===N.c.FLIP_N_ROTATE_ROW&&t%2===1||c===N.c.FLIP_N_ROTATE_TILE&&(t+J)%2===1)&&(I=[h,1-l,W,1-l,W,1-T,h,1-T]),B=B.concat(I),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z){const Z=[];h=0,l=1-E/k,W=1,T=1,Z[0]=[h,l,W,l,W,T,h,T],Z[1]=[h,l,W,l,W,T,h,T],c!==N.c.ROTATE_TILE&&c!==N.c.ROTATE_ROW||(Z[1]=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),c!==N.c.FLIP_TILE&&c!==N.c.FLIP_ROW||(Z[1]=[1-h,l,1-W,l,1-W,T,1-h,T]),c!==N.c.FLIP_N_ROTATE_TILE&&c!==N.c.FLIP_N_ROTATE_ROW||(Z[1]=[h,1-l,W,1-l,W,1-T,h,1-T]);for(let k=0;k<J;k++)u.push(k*L-x+O,P+w,0),u.push((k+1)*L-x+O,P+w,0),u.push((k+1)*L-x+O,P+E+w,0),u.push(k*L-x+O,P+E+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,B=c===N.c.FLIP_TILE||c===N.c.ROTATE_TILE||c===N.c.FLIP_N_ROTATE_TILE?B.concat(Z[(k+1)%2]):c===N.c.FLIP_ROW||c===N.c.ROTATE_ROW||c===N.c.FLIP_N_ROTATE_ROW?B.concat(Z[1]):B.concat(Z[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const Z=[];h=0,l=0,W=1,T=E/k,Z[0]=[h,l,W,l,W,T,h,T],Z[1]=[h,l,W,l,W,T,h,T],c!==N.c.ROTATE_TILE&&c!==N.c.ROTATE_ROW||(Z[1]=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),c!==N.c.FLIP_TILE&&c!==N.c.FLIP_ROW||(Z[1]=[1-h,l,1-W,l,1-W,T,1-h,T]),c!==N.c.FLIP_N_ROTATE_TILE&&c!==N.c.FLIP_N_ROTATE_ROW||(Z[1]=[h,1-l,W,1-l,W,1-T,h,1-T]);for(let k=0;k<J;k++)u.push(k*L-x+O,o-E+w,0),u.push((k+1)*L-x+O,o-E+w,0),u.push((k+1)*L-x+O,o+w,0),u.push(k*L-x+O,o+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,B=c===N.c.FLIP_TILE||c===N.c.ROTATE_TILE||c===N.c.FLIP_N_ROTATE_TILE?B.concat(Z[(k+t)%2]):c===N.c.FLIP_ROW||c===N.c.ROTATE_ROW||c===N.c.FLIP_N_ROTATE_ROW?B.concat(Z[t%2]):B.concat(Z[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const Z=[];h=1-z/L,l=0,W=1,T=1,Z[0]=[h,l,W,l,W,T,h,T],Z[1]=[h,l,W,l,W,T,h,T],c!==N.c.ROTATE_TILE&&c!==N.c.ROTATE_ROW||(Z[1]=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),c!==N.c.FLIP_TILE&&c!==N.c.FLIP_ROW||(Z[1]=[1-h,l,1-W,l,1-W,T,1-h,T]),c!==N.c.FLIP_N_ROTATE_TILE&&c!==N.c.FLIP_N_ROTATE_ROW||(Z[1]=[h,1-l,W,1-l,W,1-T,h,1-T]);for(let L=0;L<t;L++)u.push(M+O,L*k-q+w,0),u.push(M+z+O,L*k-q+w,0),u.push(M+z+O,(L+1)*k-q+w,0),u.push(M+O,(L+1)*k-q+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,B=c===N.c.FLIP_TILE||c===N.c.ROTATE_TILE||c===N.c.FLIP_N_ROTATE_TILE?B.concat(Z[(L+1)%2]):c===N.c.FLIP_ROW||c===N.c.ROTATE_ROW||c===N.c.FLIP_N_ROTATE_ROW?B.concat(Z[L%2]):B.concat(Z[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const Z=[];h=0,l=0,W=z/k,T=1,Z[0]=[h,l,W,l,W,T,h,T],Z[1]=[h,l,W,l,W,T,h,T],c!==N.c.ROTATE_TILE&&c!==N.c.ROTATE_ROW||(Z[1]=[1-h,1-l,1-W,1-l,1-W,1-T,1-h,1-T]),c!==N.c.FLIP_TILE&&c!==N.c.FLIP_ROW||(Z[1]=[1-h,l,1-W,l,1-W,T,1-h,T]),c!==N.c.FLIP_N_ROTATE_TILE&&c!==N.c.FLIP_N_ROTATE_ROW||(Z[1]=[h,1-l,W,1-l,W,1-T,h,1-T]);for(let L=0;L<t;L++)u.push(j-z+O,L*k-q+w,0),u.push(j+O,L*k-q+w,0),u.push(j+O,(L+1)*k-q+w,0),u.push(j-z+O,(L+1)*k-q+w,0),e.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,B=c===N.c.FLIP_TILE||c===N.c.ROTATE_TILE||c===N.c.FLIP_N_ROTATE_TILE?B.concat(Z[(L+J)%2]):c===N.c.FLIP_ROW||c===N.c.ROTATE_ROW||c===N.c.FLIP_N_ROTATE_ROW?B.concat(Z[L%2]):B.concat(Z[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const l=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE;G.e._ComputeSides(l,u,e,X,B,Z.frontUVs,Z.backUVs);const W=new G.e;W.indices=e,W.BZ=u,W.DZ=X,W.HZ=B;const T=l===G.e.DOUBLESIDE?D.concat(D):D;return W.eZ=T,W}function x(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return E(c).WZ(k,c.updatable),k}function q(Z){const c=Z.faceUV||new Array(6),L=Z.faceColors,R=Z.pattern||N.c.NO_FLIP,p=Z.width||Z.size||1,J=Z.height||Z.size||1,z=Z.depth||Z.size||1,i=Z.tileWidth||Z.tileSize||1,x=Z.tileHeight||Z.tileSize||1,q=Z.alignHorizontal||0,O=Z.alignVertical||0,w=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE;for(let N=0;N<6;N++)void 0===c[N]&&(c[N]=new k.j(0,0,1,1)),L&&void 0===L[N]&&(L[N]=new t.h(1,1,1,1));const M=p/2,P=J/2,j=z/2,o=[];for(let k=0;k<2;k++)o[k]=E({pattern:R,tileWidth:i,tileHeight:x,width:p,height:J,alignVertical:O,alignHorizontal:q,sideOrientation:w});for(let k=2;k<4;k++)o[k]=E({pattern:R,tileWidth:i,tileHeight:x,width:z,height:J,alignVertical:O,alignHorizontal:q,sideOrientation:w});let u=O;O===N.c.BOTTOM?u=N.c.TOP:O===N.c.TOP&&(u=N.c.BOTTOM);for(let k=4;k<6;k++)o[k]=E({pattern:R,tileWidth:i,tileHeight:x,width:p,height:z,alignVertical:u,alignHorizontal:q,sideOrientation:w});let X=[],h=[],B=[],D=[];const e=[],H=[],l=[],W=[];let T=0,I=0;for(let N=0;N<6;N++){const Z=o[N].BZ.length;H[N]=[],l[N]=[];for(let c=0;c<Z/3;c++)H[N].push(new k.h(o[N].BZ[3*c],o[N].BZ[3*c+1],o[N].BZ[3*c+2])),l[N].push(new k.h(o[N].DZ[3*c],o[N].DZ[3*c+1],o[N].DZ[3*c+2]));T=o[N].HZ.length,W[N]=[];for(let L=0;L<T;L+=2)W[N][L]=c[N].x+(c[N].z-c[N].x)*o[N].HZ[L],W[N][L+1]=c[N].y+(c[N].w-c[N].y)*o[N].HZ[L+1],V.b&&(W[N][L+1]=1-W[N][L+1]);if(B=B.concat(W[N]),D=D.concat(o[N].indices.map((Z=>Z+I))),I+=H[N].length,L)for(let c=0;c<4;c++)e.push(L[N].r,L[N].g,L[N].b,L[N].a)}const d=new k.h(0,0,j),Q=k.b.RotationY(Math.PI);X=H[0].map((Z=>k.h.TransformNormal(Z,Q).add(d))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]),h=l[0].map((Z=>k.h.TransformNormal(Z,Q))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]),X=X.concat(H[1].map((Z=>Z.yL(d))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),h=h.concat(l[1].map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]));const r=new k.h(M,0,0),f=k.b.RotationY(-Math.PI/2);X=X.concat(H[2].map((Z=>k.h.TransformNormal(Z,f).add(r))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),h=h.concat(l[2].map((Z=>k.h.TransformNormal(Z,f))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]));const S=k.b.RotationY(Math.PI/2);X=X.concat(H[3].map((Z=>k.h.TransformNormal(Z,S).yL(r))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),h=h.concat(l[3].map((Z=>k.h.TransformNormal(Z,S))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]));const s=new k.h(0,P,0),m=k.b.RotationX(Math.PI/2);X=X.concat(H[4].map((Z=>k.h.TransformNormal(Z,m).add(s))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),h=h.concat(l[4].map((Z=>k.h.TransformNormal(Z,m))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[]));const A=k.b.RotationX(-Math.PI/2);X=X.concat(H[5].map((Z=>k.h.TransformNormal(Z,A).yL(s))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),h=h.concat(l[5].map((Z=>k.h.TransformNormal(Z,A))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,c)=>Z.concat(c)),[])),G.e._ComputeSides(w,X,D,h,B);const b=new G.e;if(b.indices=D,b.BZ=X,b.DZ=h,b.HZ=B,L){const Z=w===G.e.DOUBLESIDE?e.concat(e):e;b.eZ=Z}return b}function O(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return q(c).WZ(k,c.updatable),k}G.e.CreateTiledPlane=E;G.e.CreateTiledBox=q;var w=L(12508),M=L(11588),P=L(11312);function j(Z){const c=Z.height||2;let L=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,R=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;L=L||1e-5,R=R||1e-5;const p=0|(Z.tessellation||24),J=0|(Z.subdivisions||1),z=!!Z.hasRings,i=!!Z.enclose,E=0===Z.cap?0:Z.cap||N.c.CAP_ALL,x=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,q=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,O=Z.faceUV||new Array(3),w=Z.faceColors,M=2+(1+(1!==x&&i?2:0))*(z?J:1);let j;for(j=0;j<M;j++)w&&void 0===w[j]&&(w[j]=new t.h(1,1,1,1));for(j=0;j<M;j++)O&&void 0===O[j]&&(O[j]=new k.j(0,0,1,1));const o=[],u=[],X=[],h=[],B=[],D=2*Math.PI*x/p;let e,H,l;const W=(R-L)/2/c,T=k.h.Zero(),I=k.h.Zero(),d=k.h.Zero(),Q=k.h.Zero(),r=k.h.Zero(),f=P.b.Y;let S,s,m,A=1,b=1,F=0,U=0;for(S=0;S<=J;S++)for(H=S/J,l=(H*(L-R)+R)/2,A=z&&0!==S&&S!==J?2:1,m=0;m<A;m++){for(z&&(b+=m),i&&(b+=2*m),s=0;s<=p;s++)e=s*D,T.x=Math.cos(-e)*l,T.y=-c/2+H*c,T.z=Math.sin(-e)*l,0===L&&S===J?(I.x=X[X.length-3*(p+1)],I.y=X[X.length-3*(p+1)+1],I.z=X[X.length-3*(p+1)+2]):(I.x=T.x,I.z=T.z,I.y=Math.sqrt(I.x*I.x+I.z*I.z)*W,I.normalize()),0===s&&(d.R(T),Q.R(I)),u.push(T.x,T.y,T.z),X.push(I.x,I.y,I.z),U=z?F!==b?O[b].y:O[b].w:O[b].y+(O[b].w-O[b].y)*H,h.push(O[b].x+(O[b].z-O[b].x)*s/p,V.b?1-U:U),w&&B.push(w[b].r,w[b].g,w[b].b,w[b].a);1!==x&&i&&(u.push(T.x,T.y,T.z),u.push(0,T.y,0),u.push(0,T.y,0),u.push(d.x,d.y,d.z),k.h.CrossToRef(f,I,r),r.normalize(),X.push(r.x,r.y,r.z,r.x,r.y,r.z),k.h.CrossToRef(Q,f,r),r.normalize(),X.push(r.x,r.y,r.z,r.x,r.y,r.z),U=z?F!==b?O[b+1].y:O[b+1].w:O[b+1].y+(O[b+1].w-O[b+1].y)*H,h.push(O[b+1].x,V.b?1-U:U),h.push(O[b+1].z,V.b?1-U:U),U=z?F!==b?O[b+2].y:O[b+2].w:O[b+2].y+(O[b+2].w-O[b+2].y)*H,h.push(O[b+2].x,V.b?1-U:U),h.push(O[b+2].z,V.b?1-U:U),w&&(B.push(w[b+1].r,w[b+1].g,w[b+1].b,w[b+1].a),B.push(w[b+1].r,w[b+1].g,w[b+1].b,w[b+1].a),B.push(w[b+2].r,w[b+2].g,w[b+2].b,w[b+2].a),B.push(w[b+2].r,w[b+2].g,w[b+2].b,w[b+2].a))),F!==b&&(F=b)}const K=1!==x&&i?p+4:p;for(S=0,b=0;b<J;b++){let Z=0,c=0,L=0,k=0;for(s=0;s<p;s++)Z=S*(K+1)+s,c=(S+1)*(K+1)+s,L=S*(K+1)+(s+1),k=(S+1)*(K+1)+(s+1),o.push(Z,c,L),o.push(k,L,c);1!==x&&i&&(o.push(Z+2,c+2,L+2),o.push(k+2,L+2,c+2),o.push(Z+4,c+4,L+4),o.push(k+4,L+4,c+4)),S=z?S+2:S+1}const n=Z=>{const N=Z?L/2:R/2;if(0===N)return;let G,J,z;const i=Z?O[M-1]:O[0];let t=null;w&&(t=Z?w[M-1]:w[0]);const E=u.length/3,q=Z?c/2:-c/2,P=new k.h(0,q,0);u.push(P.x,P.y,P.z),X.push(0,Z?1:-1,0);const j=i.y+.5*(i.w-i.y);h.push(i.x+.5*(i.z-i.x),V.b?1-j:j),t&&B.push(t.r,t.g,t.b,t.a);const D=new k.f(.5,.5);for(z=0;z<=p;z++){G=2*Math.PI*z*x/p;const c=Math.cos(-G),L=Math.sin(-G);J=new k.h(c*N,q,L*N);const R=new k.f(c*D.x+.5,L*D.y+.5);u.push(J.x,J.y,J.z),X.push(0,Z?1:-1,0);const E=i.y+(i.w-i.y)*R.y;h.push(i.x+(i.z-i.x)*R.x,V.b?1-E:E),t&&B.push(t.r,t.g,t.b,t.a)}for(z=0;z<p;z++)Z?(o.push(E),o.push(E+(z+2)),o.push(E+(z+1))):(o.push(E),o.push(E+(z+1)),o.push(E+(z+2)))};E!==N.c.CAP_START&&E!==N.c.CAP_ALL||n(!1),E!==N.c.CAP_END&&E!==N.c.CAP_ALL||n(!0),G.e._ComputeSides(q,u,o,X,h,Z.frontUVs,Z.backUVs);const g=new G.e;return g.indices=o,g.BZ=u,g.DZ=X,g.HZ=h,w&&(g.eZ=B),g}function o(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return j(c).WZ(k,c.updatable),k}function u(Z){const c=[],L=[],N=[],R=[],p=Z.diameter||1,J=Z.thickness||.5,z=0|(Z.tessellation||16),i=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,t=z+1;for(let G=0;G<=z;G++){const Z=G/z,i=G*Math.PI*2/z-Math.PI/2,E=k.b.Translation(p/2,0,0).multiply(k.b.RotationY(i));for(let p=0;p<=z;p++){const i=1-p/z,x=p*Math.PI*2/z+Math.PI,q=Math.cos(x),O=Math.sin(x);let w=new k.h(q,O,0),M=w.scale(J/2);const P=new k.f(Z,i);M=k.h.TransformCoordinates(M,E),w=k.h.TransformNormal(w,E),L.push(M.x,M.y,M.z),N.push(w.x,w.y,w.z),R.push(P.x,V.b?1-P.y:P.y);const j=(G+1)%t,o=(p+1)%t;c.push(G*t+p),c.push(G*t+o),c.push(j*t+p),c.push(G*t+o),c.push(j*t+o),c.push(j*t+p)}}G.e._ComputeSides(i,L,c,N,R,Z.frontUVs,Z.backUVs);const E=new G.e;return E.indices=c,E.BZ=L,E.DZ=N,E.HZ=R,E}function X(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return u(c).WZ(k,c.updatable),k}G.e.CreateCylinder=j,N.c.CreateCylinder=(Z,c,L,k,R,G,V,p,J)=>{void 0!==V&&V instanceof M.d||(void 0!==V&&(J=p||N.c.DEFAULTSIDE,p=V),V=G,G=1);return o(Z,{height:c,diameterTop:L,diameterBottom:k,tessellation:R,subdivisions:G,sideOrientation:J,updatable:p},V)};function h(Z){const c=[],L=[],N=[],R=[],p=Z.radius||2,J=Z.tube||.5,z=Z.radialSegments||32,i=Z.tubularSegments||32,t=Z.p||2,E=Z.q||3,x=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,q=Z=>{const c=Math.cos(Z),L=Math.sin(Z),N=E/t*Z,R=Math.cos(N),G=p*(2+R)*.5*c,V=p*(2+R)*L*.5,J=p*Math.sin(N)*.5;return new k.h(G,V,J)};let O,w;for(O=0;O<=z;O++){const Z=O%z/z*2*t*Math.PI,c=q(Z),N=q(Z+.01),G=N.yL(c);let p=N.add(c);const E=k.h.Cross(G,p);for(p=k.h.Cross(E,G),E.normalize(),p.normalize(),w=0;w<i;w++){const Z=w%i/i*2*Math.PI,k=-J*Math.cos(Z),N=J*Math.sin(Z);L.push(c.x+k*p.x+N*E.x),L.push(c.y+k*p.y+N*E.y),L.push(c.z+k*p.z+N*E.z),R.push(O/z),R.push(V.b?1-w/i:w/i)}}for(O=0;O<z;O++)for(w=0;w<i;w++){const Z=(w+1)%i,L=O*i+w,k=(O+1)*i+w,N=(O+1)*i+Z,R=O*i+Z;c.push(R),c.push(k),c.push(L),c.push(R),c.push(N),c.push(k)}G.e.ComputeNormals(L,c,N),G.e._ComputeSides(x,L,c,N,R,Z.frontUVs,Z.backUVs);const M=new G.e;return M.indices=c,M.BZ=L,M.DZ=N,M.HZ=R,M}function B(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return h(c).WZ(k,c.updatable),k}G.e.CreateTorus=u,N.c.CreateTorus=(Z,c,L,k,N,R,G)=>X(Z,{diameter:c,thickness:L,tessellation:k,sideOrientation:G,updatable:R},N);G.e.CreateTorusKnot=h,N.c.CreateTorusKnot=(Z,c,L,k,N,R,G,V,p,J)=>B(Z,{radius:c,tube:L,radialSegments:k,tubularSegments:N,p:R,q:G,sideOrientation:J,updatable:p},V);var D=L(13017),e=L(11754),H=L(11471);function l(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=c.path,R=c.shape,G=c.scale||1,V=c.rotation||0,p=0===c.cap?0:c.cap||N.c.NO_CAP,J=c.updatable,z=N.c._GetDefaultSideOrientation(c.sideOrientation),i=c.instance||null,t=c.invertUV||!1,E=c.closeShape||!1,x=c.closePath||!1,q=c.capFunction||null;return T(Z,R,k,G,V,null,null,x,E,p,!1,L,!!J,z,i,t,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,q)}function W(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=c.path,R=c.shape,G=c.scaleFunction||(()=>1),V=c.rotationFunction||(()=>0),p=c.closePath||c.ribbonCloseArray||!1,J=c.closeShape||c.ribbonClosePath||!1,z=0===c.cap?0:c.cap||N.c.NO_CAP,i=c.updatable,t=c.firstNormal||null,E=c.adjustFrame||!1,x=N.c._GetDefaultSideOrientation(c.sideOrientation),q=c.instance,O=c.invertUV||!1,w=c.capFunction||null;return T(Z,R,k,null,null,G,V,p,J,z,!0,L,!!i,x,q||null,O,c.frontUVs||null,c.backUVs||null,t,E,w||null)}function T(Z,c,L,R,G,V,p,z,i,t,E,x,q,O,w,M,P,j,o,u,X){const h=(Z,c,L,R,G,V,p,J,z,i,t)=>{const E=L.getTangents(),x=L.getNormals(),q=L.getBinormals(),O=L.getDistances();if(t)for(let N=0;N<E.length;N++)if(0==E[N].x&&0==E[N].y&&0==E[N].z&&E[N].R(E[N-1]),0==x[N].x&&0==x[N].y&&0==x[N].z&&x[N].R(x[N-1]),0==q[N].x&&0==q[N].y&&0==q[N].z&&q[N].R(q[N-1]),N>0){let Z=E[N-1];k.h.Dot(Z,E[N])<0&&E[N].scaleInPlace(-1),Z=x[N-1],k.h.Dot(Z,x[N])<0&&x[N].scaleInPlace(-1),Z=q[N-1],k.h.Dot(Z,q[N])<0&&q[N].scaleInPlace(-1)}let w=0;const M=i&&J?J:()=>null!==V?V:0,P=i&&p?p:()=>null!==G?G:1;let j=z===N.c.NO_CAP||z===N.c.CAP_END?0:2;const o=k.d.Matrix[0];for(let N=0;N<c.length;N++){const L=[],G=M(N,O[N]),V=P(N,O[N]);k.b.RotationAxisToRef(E[N],w,o);for(let R=0;R<Z.length;R++){const G=E[N].scale(Z[R].z).add(x[N].scale(Z[R].x)).add(q[N].scale(Z[R].y)),p=k.h.Zero();k.h.TransformCoordinatesToRef(G,o,p),p.scaleInPlace(V).addInPlace(c[N]),L[R]=p}R[j]=L,w+=G,j++}const u=X||(Z=>{const c=Array(),L=k.h.Zero();let N;for(N=0;N<Z.length;N++)L.addInPlace(Z[N]);for(L.scaleInPlace(1/Z.length),N=0;N<Z.length;N++)c.push(L);return c});switch(z){case N.c.NO_CAP:break;case N.c.CAP_START:R[0]=u(R[2]),R[1]=R[2];break;case N.c.CAP_END:R[j]=R[j-1],R[j+1]=u(R[j-1]);break;case N.c.CAP_ALL:R[0]=u(R[2]),R[1]=R[2],R[j]=R[j-1],R[j+1]=u(R[j-1])}return R};let B,D;if(w){const Z=w._creationDataStorage;return B=o?Z.path3D.update(L,o):Z.path3D.update(L),D=h(c,L,Z.path3D,Z.pathArray,R,G,V,p,Z.cap,E,u),w=J("",{pathArray:D,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:w},x||void 0)}B=o?new H.l(L,o):new H.l(L);D=h(c,L,B,new Array,R,G,V,p,t=t<0||t>3?0:t,E,u);const e=J(Z,{pathArray:D,closeArray:z,closePath:i,updatable:q,sideOrientation:O,invertUV:M,frontUVs:P||void 0,backUVs:j||void 0},x);return e._creationDataStorage.pathArray=D,e._creationDataStorage.path3D=B,e._creationDataStorage.cap=t,e}function I(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,G=void 0===c.closed||c.closed,V=c.shape,p=c.radius||1,z=c.tessellation||64,i=c.clip||0,t=c.updatable,E=N.c._GetDefaultSideOrientation(c.sideOrientation),x=c.cap||N.c.NO_CAP,q=2*Math.PI,O=[],w=c.invertUV||!1;let M=0,P=0;const j=q/z*R;let o,u;for(M=0;M<=z-i;M++){for(u=[],x!=N.c.CAP_START&&x!=N.c.CAP_ALL||(u.push(new k.h(0,V[0].y,0)),u.push(new k.h(Math.cos(M*j)*V[0].x*p,V[0].y,Math.sin(M*j)*V[0].x*p))),P=0;P<V.length;P++)o=new k.h(Math.cos(M*j)*V[P].x*p,V[P].y,Math.sin(M*j)*V[P].x*p),u.push(o);x!=N.c.CAP_END&&x!=N.c.CAP_ALL||(u.push(new k.h(Math.cos(M*j)*V[V.length-1].x*p,V[V.length-1].y,Math.sin(M*j)*V[V.length-1].x*p)),u.push(new k.h(0,V[V.length-1].y,0))),O.push(u)}return J(Z,{pathArray:O,closeArray:G,sideOrientation:E,updatable:t,invertUV:w,frontUVs:c.frontUVs,backUVs:c.backUVs},L)}N.c.ExtrudeShape=function(Z,c,L,k,R,G){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,z=arguments.length>9?arguments[9]:void 0;return l(Z,{shape:c,path:L,scale:k,rotation:R,cap:0===G?0:G||N.c.NO_CAP,sideOrientation:J,instance:z,updatable:p},V)},N.c.ExtrudeShapeCustom=(Z,c,L,k,R,G,V,p,J,z,i,t)=>W(Z,{shape:c,path:L,scaleFunction:k,rotationFunction:R,ribbonCloseArray:G,ribbonClosePath:V,cap:0===p?0:p||N.c.NO_CAP,sideOrientation:i,instance:t,updatable:z},J);N.c.CreateLathe=(Z,c,L,k,N,R,G)=>I(Z,{shape:c,radius:L,tessellation:k,sideOrientation:G,updatable:R},N);var d=L(12438),Q=L(12387);function r(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=c.path;let G=c.instance,V=1;void 0!==c.radius?V=c.radius:G&&(V=G._creationDataStorage.radius);const p=c.tessellation||64,z=c.radiusFunction||null;let i=c.cap||N.c.NO_CAP;const t=c.invertUV||!1,E=c.updatable,x=N.c._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const q=(Z,c,L,R,G,V,p,J)=>{const z=c.getTangents(),i=c.getNormals(),t=c.getDistances(),E=2*Math.PI/G*J,x=V||(()=>R);let q,O,w,M;const P=k.d.Matrix[0];let j=p===N.c.NO_CAP||p===N.c.CAP_END?0:2;for(let N=0;N<Z.length;N++){O=x(N,t[N]),q=Array(),w=i[N];for(let c=0;c<G;c++)k.b.RotationAxisToRef(z[N],E*c,P),M=q[c]?q[c]:k.h.Zero(),k.h.TransformCoordinatesToRef(w,P,M),M.scaleInPlace(O).addInPlace(Z[N]),q[c]=M;L[j]=q,j++}const o=(c,L)=>{const k=Array();for(let N=0;N<c;N++)k.push(Z[L]);return k};switch(p){case N.c.NO_CAP:break;case N.c.CAP_START:L[0]=o(G,0),L[1]=L[2].slice(0);break;case N.c.CAP_END:L[j]=L[j-1].slice(0),L[j+1]=o(G,Z.length-1);break;case N.c.CAP_ALL:L[0]=o(G,0),L[1]=L[2].slice(0),L[j]=L[j-1].slice(0),L[j+1]=o(G,Z.length-1)}return L};let O,w;if(G){const Z=G._creationDataStorage,L=c.arc||Z.arc;return O=Z.path3D.update(R),w=q(R,O,Z.pathArray,V,Z.tessellation,z,Z.cap,L),G=J("",{pathArray:w,instance:G}),Z.path3D=O,Z.pathArray=w,Z.arc=L,Z.radius=V,G}O=new H.l(R);i=i<0||i>3?0:i,w=q(R,O,new Array,V,p,z,i,c.arc);const M=J(Z,{pathArray:w,closePath:!0,closeArray:!1,updatable:E,sideOrientation:x,invertUV:t,frontUVs:c.frontUVs,backUVs:c.backUVs},L);return M._creationDataStorage.pathArray=w,M._creationDataStorage.path3D=O,M._creationDataStorage.tessellation=p,M._creationDataStorage.cap=i,M._creationDataStorage.arc=c.arc,M._creationDataStorage.radius=V,M}function f(Z){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const L=Z.type&&(Z.type<0||Z.type>=c.length)?0:Z.type||0,N=Z.size,R=Z.sizeX||N||1,p=Z.sizeY||N||1,J=Z.sizeZ||N||1,z=Z.custom||c[L],i=z.face.length,E=Z.faceUV||new Array(i),x=Z.faceColors,q=void 0===Z.flat||Z.flat,O=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,w=[],M=[],P=[],j=[],o=[];let u=0,X=0;const h=[];let B,D,e,H,l,W,T=0,I=0;if(q)for(I=0;I<i;I++)x&&void 0===x[I]&&(x[I]=new t.h(1,1,1,1)),E&&void 0===E[I]&&(E[I]=new k.j(0,0,1,1));if(q)for(I=0;I<i;I++){const Z=z.face[I].length;for(e=2*Math.PI/Z,H=.5*Math.tan(e/2),l=.5,T=0;T<Z;T++)w.push(z.vertex[z.face[I][T]][0]*R,z.vertex[z.face[I][T]][1]*p,z.vertex[z.face[I][T]][2]*J),h.push(u),u++,B=E[I].x+(E[I].z-E[I].x)*(.5+H),D=E[I].y+(E[I].w-E[I].y)*(l-.5),j.push(B,V.b?1-D:D),W=H*Math.cos(e)-l*Math.sin(e),l=H*Math.sin(e)+l*Math.cos(e),H=W,x&&o.push(x[I].r,x[I].g,x[I].b,x[I].a);for(T=0;T<Z-2;T++)M.push(h[0+X],h[T+2+X],h[T+1+X]);X+=Z}else{for(T=0;T<z.vertex.length;T++)w.push(z.vertex[T][0]*R,z.vertex[T][1]*p,z.vertex[T][2]*J),j.push(0,V.b?1:0);for(I=0;I<i;I++)for(T=0;T<z.face[I].length-2;T++)M.push(z.face[I][0],z.face[I][T+2],z.face[I][T+1])}G.e.ComputeNormals(w,M,P),G.e._ComputeSides(O,w,M,P,j,Z.frontUVs,Z.backUVs);const d=new G.e;return d.BZ=w,d.indices=M,d.DZ=P,d.HZ=j,x&&q&&(d.eZ=o),d}function S(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return f(c).WZ(k,c.updatable),k}N.c.CreateTube=(Z,c,L,k,N,R,G,V,p,J)=>r(Z,{path:c,radius:L,tessellation:k,radiusFunction:N,arc:1,cap:R,updatable:V,sideOrientation:p,instance:J},G);function s(Z){const c=Z.sideOrientation||G.e.DEFAULTSIDE,L=Z.radius||1,N=void 0===Z.flat||Z.flat,R=0|(Z.subdivisions||4),p=Z.radiusX||L,J=Z.radiusY||L,z=Z.radiusZ||L,i=(1+Math.sqrt(5))/2,t=[-1,i,-0,1,i,0,-1,-i,0,1,-i,0,0,-1,-i,0,1,-i,0,-1,i,0,1,i,i,0,1,i,0,-1,-i,0,1,-i,0,-1],E=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],x=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],O=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],w=[],M=[],P=[],j=[];let o=0;const u=new Array(3),X=new Array(3);let h;for(h=0;h<3;h++)u[h]=k.h.Zero(),X[h]=k.f.Zero();for(let G=0;G<20;G++){for(h=0;h<3;h++){const Z=E[3*G+h];u[h].wc(t[3*x[Z]],t[3*x[Z]+1],t[3*x[Z]+2]),u[h].normalize(),X[h].wc(.134765625*q[2*Z]+.05859375+-.0390625*O[G],.2333984375*q[2*Z+1]+.025390625+.01953125*O[G])}const Z=(Z,c,L,G)=>{const i=k.h.Lerp(u[0],u[2],c/R),t=k.h.Lerp(u[1],u[2],c/R),E=R===c?u[2]:k.h.Lerp(i,t,Z/(R-c));let x;if(E.normalize(),N){const Z=k.h.Lerp(u[0],u[2],G/R),c=k.h.Lerp(u[1],u[2],G/R);x=k.h.Lerp(Z,c,L/(R-G))}else x=new k.h(E.x,E.y,E.z);x.x/=p,x.y/=J,x.z/=z,x.normalize();const q=k.f.Lerp(X[0],X[2],c/R),O=k.f.Lerp(X[1],X[2],c/R),h=R===c?X[2]:k.f.Lerp(q,O,Z/(R-c));M.push(E.x*p,E.y*J,E.z*z),P.push(x.x,x.y,x.z),j.push(h.x,V.b?1-h.y:h.y),w.push(o),o++};for(let c=0;c<R;c++)for(let L=0;L+c<R;L++)Z(L,c,L+1/3,c+1/3),Z(L+1,c,L+1/3,c+1/3),Z(L,c+1,L+1/3,c+1/3),L+c+1<R&&(Z(L+1,c,L+2/3,c+2/3),Z(L+1,c+1,L+2/3,c+2/3),Z(L,c+1,L+2/3,c+2/3))}G.e._ComputeSides(c,M,w,P,j,Z.frontUVs,Z.backUVs);const B=new G.e;return B.indices=w,B.BZ=M,B.DZ=P,B.HZ=j,B}function m(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new N.c(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),k._originalBuilderSideOrientation=c.sideOrientation;return s(c).WZ(k,c.updatable),k}G.e.CreatePolyhedron=f,N.c.CreatePolyhedron=(Z,c,L)=>S(Z,c,L);G.e.CreateIcoSphere=s,N.c.CreateIcoSphere=(Z,c,L)=>m(Z,c,L);var A=L(11032);const b=new k.h(1,0,0),F=new k.h(-1,0,0),U=new k.h(0,1,0),K=new k.h(0,-1,0),n=new k.h(0,0,1),g=new k.h(0,0,-1);class y{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.h.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.h.Up(),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.f.Zero(),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Z,this.kc=c,this.uv=L,this.vertexIdx=N,this.vertexIdxForBones=R,this.localPositionOverride=G,this.localNormalOverride=V,this.matrixIndicesOverride=p,this.matrixWeightsOverride=J}clone(){var Z,c,L,k;return new y(this.position.clone(),this.kc.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Z=this.localPositionOverride)||void 0===Z?void 0:Z.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(L=this.matrixIndicesOverride)||void 0===L?void 0:L.slice(),null===(k=this.matrixWeightsOverride)||void 0===k?void 0:k.slice())}}function v(Z,c,L){var p,J,z,i,t;const E=!!c.skeleton,x=!(null===(p=c.morphTargetManager)||void 0===p||!p.numTargets),q=L.localMode||E,O=c.tc(),w=E||x?c.TV(!0,!0):c.getVerticesData(R.g.PositionKind),M=E||x?c.getNormalsData(!0,!0):c.getVerticesData(R.g.NormalKind),P=q?E?c.getVerticesData(R.g.PositionKind):w:null,j=q?E?c.getVerticesData(R.g.NormalKind):M:null,o=c.getVerticesData(R.g.UVKind),u=E?c.getVerticesData(R.g.MatricesIndicesKind):null,X=E?c.getVerticesData(R.g.MatricesWeightsKind):null,h=E?c.getVerticesData(R.g.MatricesIndicesExtraKind):null,B=E?c.getVerticesData(R.g.MatricesWeightsExtraKind):null,D=L.position||k.h.Zero();let e=L.kc||k.h.Up();const H=L.size||k.h.One(),l=L.angle||0;if(!e){const Z=new k.h(0,0,1),L=c.XZ().activeCamera,N=k.h.TransformCoordinates(Z,L.getWorldMatrix());e=L.globalPosition.yL(N)}const W=-Math.atan2(e.z,e.x)-Math.PI/2,T=Math.sqrt(e.x*e.x+e.z*e.z),I=Math.atan2(e.y,T),d=new G.e;d.indices=[],d.BZ=[],d.DZ=[],d.HZ=[],d.matricesIndices=E?[]:null,d.matricesWeights=E?[]:null,d.matricesIndicesExtra=h?[]:null,d.matricesWeightsExtra=B?[]:null;let Q=0;const r=(Z,c)=>{const N=new y;if(!O||!w||!M)return N;const R=O[Z];if(N.vertexIdx=3*R,N.vertexIdxForBones=4*R,N.position=new k.h(w[3*R],w[3*R+1],w[3*R+2]),k.h.TransformCoordinatesToRef(N.position,c,N.position),N.kc=new k.h(M[3*R],M[3*R+1],M[3*R+2]),k.h.TransformNormalToRef(N.kc,c,N.kc),L.captureUVS&&o){const Z=o[2*R+1];N.uv=new k.f(o[2*R],V.b?1-Z:Z)}return N},f=[0,0,0,0],S=(Z,c)=>{if(0===Z.length)return Z;const L=.5*Math.abs(k.h.Dot(H,c)),N=(Z,c,L,k)=>{for(let N=0;N<k;++N)if(Z[L+N]===c)return L+N;return-1},R=(Z,R)=>{const G=k.h.GetClipFactor(Z.position,R.position,c,L);let V=f,p=f;if(u&&X){const c=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,L=Z.matrixIndicesOverride??u,k=Z.matrixWeightsOverride??X,J=R.matrixIndicesOverride?0:R.vertexIdxForBones,z=R.matrixIndicesOverride??u,i=R.matrixWeightsOverride??X;V=[0,0,0,0],p=[0,0,0,0];let t=0;for(let Z=0;Z<4;++Z)if(k[c+Z]>0){const R=N(z,L[c+Z],J,4);V[t]=L[c+Z],p[t]=(0,A.Lerp)(k[c+Z],R>=0?i[R]:0,G),t++}for(let Z=0;Z<4&&t<4;++Z){const k=z[J+Z];-1===N(L,k,c,4)&&(V[t]=k,p[t]=(0,A.Lerp)(0,i[J+Z],G),t++)}const E=p[0]+p[1]+p[2]+p[3];p[0]/=E,p[1]/=E,p[2]/=E,p[3]/=E}const J=Z.localPositionOverride?Z.localPositionOverride[0]:(null===P||void 0===P?void 0:P[Z.vertexIdx])??0,z=Z.localPositionOverride?Z.localPositionOverride[1]:(null===P||void 0===P?void 0:P[Z.vertexIdx+1])??0,i=Z.localPositionOverride?Z.localPositionOverride[2]:(null===P||void 0===P?void 0:P[Z.vertexIdx+2])??0,t=R.localPositionOverride?R.localPositionOverride[0]:(null===P||void 0===P?void 0:P[R.vertexIdx])??0,E=R.localPositionOverride?R.localPositionOverride[1]:(null===P||void 0===P?void 0:P[R.vertexIdx+1])??0,x=R.localPositionOverride?R.localPositionOverride[2]:(null===P||void 0===P?void 0:P[R.vertexIdx+2])??0,q=Z.localNormalOverride?Z.localNormalOverride[0]:(null===j||void 0===j?void 0:j[Z.vertexIdx])??0,O=Z.localNormalOverride?Z.localNormalOverride[1]:(null===j||void 0===j?void 0:j[Z.vertexIdx+1])??0,w=Z.localNormalOverride?Z.localNormalOverride[2]:(null===j||void 0===j?void 0:j[Z.vertexIdx+2])??0,M=q+((R.localNormalOverride?R.localNormalOverride[0]:(null===j||void 0===j?void 0:j[R.vertexIdx])??0)-q)*G,o=O+((R.localNormalOverride?R.localNormalOverride[1]:(null===j||void 0===j?void 0:j[R.vertexIdx+1])??0)-O)*G,h=w+((R.localNormalOverride?R.localNormalOverride[2]:(null===j||void 0===j?void 0:j[R.vertexIdx+2])??0)-w)*G,B=Math.sqrt(M*M+o*o+h*h);return new y(k.h.Lerp(Z.position,R.position,G),k.h.Lerp(Z.kc,R.kc,G).normalize(),k.f.Lerp(Z.uv,R.uv,G),-1,-1,P?[J+(t-J)*G,z+(E-z)*G,i+(x-i)*G]:null,j?[M/B,o/B,h/B]:null,V,p)};let G=null;Z.length>3&&(G=[]);for(let V=0;V<Z.length;V+=3){let N=0,p=null,J=null,z=null,i=null;const t=k.h.Dot(Z[V].position,c)-L>0,E=k.h.Dot(Z[V+1].position,c)-L>0,x=k.h.Dot(Z[V+2].position,c)-L>0;switch(N=(t?1:0)+(E?1:0)+(x?1:0),N){case 0:Z.length>3?(G.push(Z[V]),G.push(Z[V+1]),G.push(Z[V+2])):G=Z;break;case 1:if(G=G??new Array,t&&(p=Z[V+1],J=Z[V+2],z=R(Z[V],p),i=R(Z[V],J)),E){p=Z[V],J=Z[V+2],z=R(Z[V+1],p),i=R(Z[V+1],J),G.push(z),G.push(J.clone()),G.push(p.clone()),G.push(J.clone()),G.push(z.clone()),G.push(i);break}x&&(p=Z[V],J=Z[V+1],z=R(Z[V+2],p),i=R(Z[V+2],J)),p&&J&&z&&i&&(G.push(p.clone()),G.push(J.clone()),G.push(z),G.push(i),G.push(z.clone()),G.push(J.clone()));break;case 2:G=G??new Array,t||(p=Z[V].clone(),J=R(p,Z[V+1]),z=R(p,Z[V+2]),G.push(p),G.push(J),G.push(z)),E||(p=Z[V+1].clone(),J=R(p,Z[V+2]),z=R(p,Z[V]),G.push(p),G.push(J),G.push(z)),x||(p=Z[V+2].clone(),J=R(p,Z[V]),z=R(p,Z[V+1]),G.push(p),G.push(J),G.push(z))}}return G},s=c instanceof N.c?c:null,m=null===s||void 0===s?void 0:s._thinInstanceDataStorage.matrixData,v=(null===s||void 0===s?void 0:s.dc)||1,Y=k.d.Matrix[0];Y.R(k.b.IdentityReadOnly);for(let N=0;N<v;++N){if(null!==s&&void 0!==s&&s.hasThinInstances&&m){const Z=16*N;Y.setRowFromFloats(0,m[Z+0],m[Z+1],m[Z+2],m[Z+3]),Y.setRowFromFloats(1,m[Z+4],m[Z+5],m[Z+6],m[Z+7]),Y.setRowFromFloats(2,m[Z+8],m[Z+9],m[Z+10],m[Z+11]),Y.setRowFromFloats(3,m[Z+12],m[Z+13],m[Z+14],m[Z+15])}const Z=k.b.RotationYawPitchRoll(W,I,l).multiply(k.b.Translation(D.x,D.y,D.z)),R=k.b.Invert(Z),G=c.getWorldMatrix(),p=Y.multiply(G).multiply(R),J=new Array(3);for(let c=0;c<O.length;c+=3){let Z=J;if(Z[0]=r(c,p),Z[1]=r(c+1,p),Z[2]=r(c+2,p),!(L.cullBackFaces&&-Z[0].kc.z<=0&&-Z[1].kc.z<=0&&-Z[2].kc.z<=0)&&(Z=S(Z,b),Z&&(Z=S(Z,F),Z&&(Z=S(Z,U),Z&&(Z=S(Z,K),Z&&(Z=S(Z,n),Z&&(Z=S(Z,g),Z)))))))for(let c=0;c<Z.length;c++){const k=Z[c];if(d.indices.push(Q),q?(k.localPositionOverride?(d.BZ[3*Q]=k.localPositionOverride[0],d.BZ[3*Q+1]=k.localPositionOverride[1],d.BZ[3*Q+2]=k.localPositionOverride[2]):P&&(d.BZ[3*Q]=P[k.vertexIdx],d.BZ[3*Q+1]=P[k.vertexIdx+1],d.BZ[3*Q+2]=P[k.vertexIdx+2]),k.localNormalOverride?(d.DZ[3*Q]=k.localNormalOverride[0],d.DZ[3*Q+1]=k.localNormalOverride[1],d.DZ[3*Q+2]=k.localNormalOverride[2]):j&&(d.DZ[3*Q]=j[k.vertexIdx],d.DZ[3*Q+1]=j[k.vertexIdx+1],d.DZ[3*Q+2]=j[k.vertexIdx+2])):(k.position.toArray(d.BZ,3*Q),k.kc.toArray(d.DZ,3*Q)),d.matricesIndices&&d.matricesWeights&&(k.matrixIndicesOverride?(d.matricesIndices[4*Q]=k.matrixIndicesOverride[0],d.matricesIndices[4*Q+1]=k.matrixIndicesOverride[1],d.matricesIndices[4*Q+2]=k.matrixIndicesOverride[2],d.matricesIndices[4*Q+3]=k.matrixIndicesOverride[3]):(u&&(d.matricesIndices[4*Q]=u[k.vertexIdxForBones],d.matricesIndices[4*Q+1]=u[k.vertexIdxForBones+1],d.matricesIndices[4*Q+2]=u[k.vertexIdxForBones+2],d.matricesIndices[4*Q+3]=u[k.vertexIdxForBones+3]),h&&d.matricesIndicesExtra&&(d.matricesIndicesExtra[4*Q]=h[k.vertexIdxForBones],d.matricesIndicesExtra[4*Q+1]=h[k.vertexIdxForBones+1],d.matricesIndicesExtra[4*Q+2]=h[k.vertexIdxForBones+2],d.matricesIndicesExtra[4*Q+3]=h[k.vertexIdxForBones+3])),k.matrixWeightsOverride?(d.matricesWeights[4*Q]=k.matrixWeightsOverride[0],d.matricesWeights[4*Q+1]=k.matrixWeightsOverride[1],d.matricesWeights[4*Q+2]=k.matrixWeightsOverride[2],d.matricesWeights[4*Q+3]=k.matrixWeightsOverride[3]):(X&&(d.matricesWeights[4*Q]=X[k.vertexIdxForBones],d.matricesWeights[4*Q+1]=X[k.vertexIdxForBones+1],d.matricesWeights[4*Q+2]=X[k.vertexIdxForBones+2],d.matricesWeights[4*Q+3]=X[k.vertexIdxForBones+3]),B&&d.matricesWeightsExtra&&(d.matricesWeightsExtra[4*Q]=B[k.vertexIdxForBones],d.matricesWeightsExtra[4*Q+1]=B[k.vertexIdxForBones+1],d.matricesWeightsExtra[4*Q+2]=B[k.vertexIdxForBones+2],d.matricesWeightsExtra[4*Q+3]=B[k.vertexIdxForBones+3]))),L.captureUVS)k.uv.toArray(d.HZ,2*Q);else{d.HZ.push(.5+k.position.x/H.x);const Z=.5+k.position.y/H.y;d.HZ.push(V.b?1-Z:Z)}Q++}}}0===d.indices.length&&(d.indices=null),0===d.BZ.length&&(d.BZ=null),0===d.DZ.length&&(d.DZ=null),0===d.HZ.length&&(d.HZ=null),0===(null===(J=d.matricesIndices)||void 0===J?void 0:J.length)&&(d.matricesIndices=null),0===(null===(z=d.matricesWeights)||void 0===z?void 0:z.length)&&(d.matricesWeights=null),0===(null===(i=d.matricesIndicesExtra)||void 0===i?void 0:i.length)&&(d.matricesIndicesExtra=null),0===(null===(t=d.matricesWeightsExtra)||void 0===t?void 0:t.length)&&(d.matricesWeightsExtra=null);const a=new N.c(Z,c.XZ());return d.WZ(a),q?(a.skeleton=c.skeleton,a.parent=c):(a.position=D.clone(),a.rotation=new k.h(I,W,l)),a.Jc(!0),a.refreshBoundingInfo(!0,!0),a}function Y(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(Z.subdivisions?Z.subdivisions:2,1),L=0|Math.max(Z.tessellation?Z.tessellation:16,3),N=Math.max(Z.height?Z.height:1,0),R=Math.max(Z.radius?Z.radius:.25,0),p=0|Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),J=L,z=c,i=Math.max(Z.radiusTop?Z.radiusTop:R,0),t=Math.max(Z.radiusBottom?Z.radiusBottom:R,0),E=N-(i+t),x=2*Math.PI,q=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:p,1),O=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:p,1),w=Math.acos((t-i)/N);let M=[];const P=[],j=[],o=[];let u=0;const X=[],h=.5*E,B=.5*Math.PI;let D,e;const H=k.h.Zero(),l=k.h.Zero(),W=Math.cos(w),T=Math.sin(w),I=new k.f(i*T,h+i*W).yL(new k.f(t*T,t*W-h)).length(),d=i*w+I+t*(B-w);let Q=0;for(e=0;e<=q;e++){const Z=[],c=B-w*(e/q);Q+=i*w/q;const L=Math.cos(c),k=Math.sin(c),N=L*i;for(D=0;D<=J;D++){const c=D/J,R=c*x+0,G=Math.sin(R),p=Math.cos(R);l.x=N*G,l.y=h+k*i,l.z=N*p,P.push(l.x,l.y,l.z),H.set(L*G,k,L*p),j.push(H.x,H.y,H.z),o.push(c,V.b?Q/d:1-Q/d),Z.push(u),u++}X.push(Z)}const r=N-i-t+W*i-W*t,f=T*(t-i)/r;for(e=1;e<=z;e++){const Z=[];Q+=I/z;const c=T*(e*(t-i)/z+i);for(D=0;D<=J;D++){const L=D/J,k=L*x+0,N=Math.sin(k),R=Math.cos(k);l.x=c*N,l.y=h+W*i-e*r/z,l.z=c*R,P.push(l.x,l.y,l.z),H.set(N,f,R).normalize(),j.push(H.x,H.y,H.z),o.push(L,V.b?Q/d:1-Q/d),Z.push(u),u++}X.push(Z)}for(e=1;e<=O;e++){const Z=[],c=B-w-(Math.PI-w)*(e/O);Q+=t*w/O;const L=Math.cos(c),k=Math.sin(c),N=L*t;for(D=0;D<=J;D++){const c=D/J,R=c*x+0,G=Math.sin(R),p=Math.cos(R);l.x=N*G,l.y=k*t-h,l.z=N*p,P.push(l.x,l.y,l.z),H.set(L*G,k,L*p),j.push(H.x,H.y,H.z),o.push(c,V.b?Q/d:1-Q/d),Z.push(u),u++}X.push(Z)}for(D=0;D<J;D++)for(e=0;e<q+z+O;e++){const Z=X[e][D],c=X[e+1][D],L=X[e+1][D+1],k=X[e][D+1];M.push(Z),M.push(c),M.push(k),M.push(c),M.push(L),M.push(k)}if(M=M.reverse(),Z.orientation&&!Z.orientation.equals(k.h.Up())){const c=new k.b;Z.orientation.clone().scale(.5*Math.PI).cross(k.h.Up()).toQuaternion().toRotationMatrix(c);const L=k.h.Zero();for(let Z=0;Z<P.length;Z+=3)L.set(P[Z],P[Z+1],P[Z+2]),k.h.TransformCoordinatesToRef(L.clone(),c,L),P[Z]=L.x,P[Z+1]=L.y,P[Z+2]=L.z}const S=new G.e;return S.BZ=P,S.DZ=j,S.HZ=o,S.indices=M,S}function a(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:k.h.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new N.c(Z,L);return Y(c).WZ(R,c.updatable),R}N.c.CreateDecal=(Z,c,L,k,N,R)=>v(Z,c,{position:L,kc:k,size:N,angle:R});N.c.CreateCapsule=(Z,c,L)=>a(Z,c,L),G.e.CreateCapsule=Y;var C=L(11052),ZZ=L(10999);class cZ{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=c,Z!==Math.floor(Z)&&(Z=Math.floor(Z),C.e.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),C.e.Warn("y is not an integer, floor(y) used"))}clone(){return new cZ(this.x,this.y)}rotate60About(Z){const c=this.x;return this.x=Z.x+Z.y-this.y,this.y=c+this.y-Z.x,this}rotateNeg60About(Z){const c=this.x;return this.x=c+this.y-Z.y,this.y=Z.x+Z.y-c,this}rotate120(Z,c){Z!==Math.floor(Z)&&(Z=Math.floor(Z),C.e.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),C.e.Warn("n not an integer only floor(n) used"));const L=this.x;return this.x=Z-L-this.y,this.y=c+L,this}rotateNeg120(Z,c){Z!==Math.floor(Z)&&(Z=Math.floor(Z),C.e.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),C.e.Warn("n is not an integer,   floor(n) used"));const L=this.x;return this.x=this.y-c,this.y=Z+c-L-this.y,this}toCartesianOrigin(Z,c){const L=k.h.Zero();return L.x=Z.x+2*this.x*c+this.y*c,L.y=Z.y+Math.sqrt(3)*this.y*c,L}static Zero(){return new cZ(0,0)}}class LZ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new kZ("icosahedron","Regular",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Z=12;const c={},L=this.m,k=this.n;let N,R,G,V,p,J=L,z=1,i=0;0!==k&&(J=(0,A.HighestCommonFactor)(L,k)),z=L/J,i=k/J;const t=cZ.Zero(),E=new cZ(L,k),x=new cZ(-k,L+k),q=cZ.Zero(),O=cZ.Zero(),w=cZ.Zero();let M,P,j,o,u=[];const X=[],h=this.vertByDist,B=(L,k,N,R)=>{M=L+"|"+N,P=k+"|"+R,M in c||P in c?M in c&&!(P in c)?c[P]=c[M]:P in c&&!(M in c)&&(c[M]=c[P]):(c[M]=Z,c[P]=Z,Z++),h[N][0]>2?X[c[M]]=[-h[N][0],h[N][1],c[M]]:X[c[M]]=[u[h[N][0]],h[N][1],c[M]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(u=this.IDATA.face[D],G=u[2],V=u[1],p=u[0],j=t.x+"|"+t.y,M=D+"|"+j,M in c||(c[M]=G,X[G]=[u[h[j][0]],h[j][1]]),j=E.x+"|"+E.y,M=D+"|"+j,M in c||(c[M]=V,X[V]=[u[h[j][0]],h[j][1]]),j=x.x+"|"+x.y,M=D+"|"+j,M in c||(c[M]=p,X[p]=[u[h[j][0]],h[j][1]]),N=this.IDATA.edgematch[D][0],R=this.IDATA.edgematch[D][1],"B"===R)for(let Z=1;Z<J;Z++)O.x=L-Z*(z+i),O.y=k+Z*z,w.x=-Z*i,w.y=Z*(z+i),j=O.x+"|"+O.y,o=w.x+"|"+w.y,B(D,N,j,o);if("O"===R)for(let Z=1;Z<J;Z++)w.x=-Z*i,w.y=Z*(z+i),q.x=Z*z,q.y=Z*i,j=w.x+"|"+w.y,o=q.x+"|"+q.y,B(D,N,j,o);if(N=this.IDATA.edgematch[D][2],R=this.IDATA.edgematch[D][3],R&&"A"===R)for(let Z=1;Z<J;Z++)q.x=Z*z,q.y=Z*i,O.x=L-(J-Z)*(z+i),O.y=k+(J-Z)*z,j=q.x+"|"+q.y,o=O.x+"|"+O.y,B(D,N,j,o);for(let L=0;L<this.vertices.length;L++)j=this.vertices[L].x+"|"+this.vertices[L].y,M=D+"|"+j,M in c||(c[M]=Z++,h[j][0]>2?X[c[M]]=[-h[j][0],h[j][1],c[M]]:X[c[M]]=[u[h[j][0]],h[j][1],c[M]])}this.closestTo=X,this.vecToidx=c}calcCoeffs(){const Z=this.m,c=this.n,L=Math.sqrt(3)/3,k=Z*Z+c*c+Z*c;this.coau=(Z+c)/k,this.cobu=-c/k,this.coav=-L*(Z-c)/k,this.cobv=L*(2*Z+c)/k}createInnerFacets(){const Z=this.m,c=this.n;for(let L=0;L<c+Z+1;L++)for(let Z=this.min[L];Z<this.max[L]+1;Z++)Z<this.max[L]&&Z<this.max[L+1]+1&&this.innerFacets.push(["|"+Z+"|"+L,"|"+Z+"|"+(L+1),"|"+(Z+1)+"|"+L]),L>0&&Z<this.max[L-1]&&Z+1<this.max[L]+1&&this.innerFacets.push(["|"+Z+"|"+L,"|"+(Z+1)+"|"+L,"|"+(Z+1)+"|"+(L-1)])}edgeVecsABOB(){const Z=this.m,c=this.n,L=new cZ(-c,Z+c);for(let k=1;k<Z+c;k++){const Z=new cZ(this.min[k],k),c=new cZ(this.min[k-1],k-1),N=new cZ(this.min[k+1],k+1),R=Z.clone(),G=c.clone(),V=N.clone();R.rotate60About(L),G.rotate60About(L),V.rotate60About(L);const p=new cZ(this.max[R.y],R.y),J=new cZ(this.max[R.y-1],R.y-1),z=new cZ(this.max[R.y-1]-1,R.y-1);R.x===p.x&&R.y===p.y||(R.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,J,z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,z,p])):R.y===V.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,c,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Z,J,N])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,c,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,J,p])))}}mapABOBtoOBOA(){const Z=new cZ(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const L=[];for(let k=0;k<3;k++)Z.x=this.isoVecsABOB[c][k].x,Z.y=this.isoVecsABOB[c][k].y,0===this.vertexTypes[c][k]&&Z.rotateNeg120(this.m,this.n),L.push(Z.clone());this.isoVecsOBOA.push(L)}}mapABOBtoBAOA(){const Z=new cZ(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const L=[];for(let k=0;k<3;k++)Z.x=this.isoVecsABOB[c][k].x,Z.y=this.isoVecsABOB[c][k].y,1===this.vertexTypes[c][k]&&Z.rotate120(this.m,this.n),L.push(Z.clone());this.isoVecsBAOA.push(L)}}MapToFace(Z,c){const L=this.IDATA.face[Z],N=L[2],R=L[1],G=L[0],V=k.h.oc(this.IDATA.vertex[N]),p=k.h.oc(this.IDATA.vertex[R]),J=k.h.oc(this.IDATA.vertex[G]),z=p.yL(V),i=J.yL(V),t=z.scale(this.coau).add(i.scale(this.cobu)),E=z.scale(this.coav).add(i.scale(this.cobv)),x=[];let q,O=k.d.Mc[0];for(let k=0;k<this.cartesian.length;k++)O=t.scale(this.cartesian[k].x).add(E.scale(this.cartesian[k].y)).add(V),x[k]=[O.x,O.y,O.z],q=Z+"|"+this.vertices[k].x+"|"+this.vertices[k].y,c.vertex[this.vecToidx[q]]=[O.x,O.y,O.z]}build(Z,c){const L=[],k=cZ.Zero(),N=new cZ(Z,c),R=new cZ(-c,Z+c);L.push(k,N,R);for(let j=c;j<Z+1;j++)for(let c=0;c<Z+1-j;c++)L.push(new cZ(c,j));if(c>0){const k=(0,A.HighestCommonFactor)(Z,c),N=Z/k,R=c/k;for(let V=1;V<k;V++)L.push(new cZ(V*N,V*R)),L.push(new cZ(-V*R,V*(N+R))),L.push(new cZ(Z-V*(N+R),c+V*N));const G=Z/c;for(let V=1;V<c;V++)for(let k=0;k<V*G;k++)L.push(new cZ(k,V)),L.push(new cZ(k,V).rotate120(Z,c)),L.push(new cZ(k,V).rotateNeg120(Z,c))}L.sort(((Z,c)=>Z.x-c.x)),L.sort(((Z,c)=>Z.y-c.y));const G=new Array(Z+c+1),V=new Array(Z+c+1);for(let j=0;j<G.length;j++)G[j]=1/0,V[j]=-1/0;let p=0,J=0;const z=L.length;for(let j=0;j<z;j++)J=L[j].x,p=L[j].y,G[p]=Math.min(J,G[p]),V[p]=Math.max(J,V[p]);const i=(L,k)=>{const N=L.clone();return"A"===k&&N.rotateNeg120(Z,c),"B"===k&&N.rotate120(Z,c),N.x<0?N.y:N.x+N.y},t=[],E=[],x=[],q=[],O={},w=[];let M=-1,P=-1;for(let j=0;j<z;j++)t[j]=L[j].toCartesianOrigin(new cZ(0,0),.5),E[j]=i(L[j],"O"),x[j]=i(L[j],"A"),q[j]=i(L[j],"B"),E[j]===x[j]&&x[j]===q[j]?(M=3,P=E[j]):E[j]===x[j]?(M=4,P=E[j]):x[j]===q[j]?(M=5,P=x[j]):q[j]===E[j]&&(M=6,P=E[j]),E[j]<x[j]&&E[j]<q[j]&&(M=2,P=E[j]),x[j]<E[j]&&x[j]<q[j]&&(M=1,P=x[j]),q[j]<x[j]&&q[j]<E[j]&&(M=0,P=q[j]),w.push([M,P,L[j].x,L[j].y]);w.sort(((Z,c)=>Z[2]-c[2])),w.sort(((Z,c)=>Z[3]-c[3])),w.sort(((Z,c)=>Z[1]-c[1])),w.sort(((Z,c)=>Z[0]-c[0]));for(let j=0;j<w.length;j++)O[w[j][2]+"|"+w[j][3]]=[w[j][0],w[j][1],j];return this.m=Z,this.n=c,this.vertices=L,this.vertByDist=O,this.cartesian=t,this.min=G,this.max=V,this}}class kZ{constructor(Z,c,L,k){this.name=Z,this.category=c,this.vertex=L,this.face=k}}class NZ extends kZ{innerToData(Z,c){for(let L=0;L<c.innerFacets.length;L++)this.face.push(c.innerFacets[L].map((L=>c.vecToidx[Z+L])))}mapABOBtoDATA(Z,c){const L=c.IDATA.edgematch[Z][0];for(let k=0;k<c.isoVecsABOB.length;k++){const N=[];for(let R=0;R<3;R++)0===c.vertexTypes[k][R]?N.push(Z+"|"+c.isoVecsABOB[k][R].x+"|"+c.isoVecsABOB[k][R].y):N.push(L+"|"+c.isoVecsABOB[k][R].x+"|"+c.isoVecsABOB[k][R].y);this.face.push([c.vecToidx[N[0]],c.vecToidx[N[1]],c.vecToidx[N[2]]])}}mapOBOAtoDATA(Z,c){const L=c.IDATA.edgematch[Z][0];for(let k=0;k<c.isoVecsOBOA.length;k++){const N=[];for(let R=0;R<3;R++)1===c.vertexTypes[k][R]?N.push(Z+"|"+c.isoVecsOBOA[k][R].x+"|"+c.isoVecsOBOA[k][R].y):N.push(L+"|"+c.isoVecsOBOA[k][R].x+"|"+c.isoVecsOBOA[k][R].y);this.face.push([c.vecToidx[N[0]],c.vecToidx[N[1]],c.vecToidx[N[2]]])}}mapBAOAtoDATA(Z,c){const L=c.IDATA.edgematch[Z][2];for(let k=0;k<c.isoVecsBAOA.length;k++){const N=[];for(let R=0;R<3;R++)1===c.vertexTypes[k][R]?N.push(Z+"|"+c.isoVecsBAOA[k][R].x+"|"+c.isoVecsBAOA[k][R].y):N.push(L+"|"+c.isoVecsBAOA[k][R].x+"|"+c.isoVecsBAOA[k][R].y);this.face.push([c.vecToidx[N[0]],c.vecToidx[N[1]],c.vecToidx[N[2]]])}}orderData(Z){const c=[];for(let R=0;R<13;R++)c[R]=[];const L=Z.closestTo;for(let R=0;R<L.length;R++)L[R][0]>-1?L[R][1]>0&&c[L[R][0]].push([R,L[R][1]]):c[12].push([R,L[R][0]]);const k=[];for(let R=0;R<12;R++)k[R]=R;let N=12;for(let R=0;R<12;R++){c[R].sort(((Z,c)=>Z[1]-c[1]));for(let Z=0;Z<c[R].length;Z++)k[c[R][Z][0]]=N++}for(let R=0;R<c[12].length;R++)k[c[12][R][0]]=N++;for(let R=0;R<this.vertex.length;R++)this.vertex[R].push(k[R]);this.vertex.sort(((Z,c)=>Z[3]-c[3]));for(let R=0;R<this.vertex.length;R++)this.vertex[R].pop();for(let R=0;R<this.face.length;R++)for(let Z=0;Z<this.face[R].length;Z++)this.face[R][Z]=k[this.face[R][Z]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Z,c){const L=[],k=[];let N=c.pop();k.push(N);let R=this.face[N].indexOf(Z);R=(R+2)%3;let G=this.face[N][R];L.push(G);let V=0;for(;c.length>0;)N=c[V],this.face[N].indexOf(G)>-1?(R=(this.face[N].indexOf(G)+1)%3,G=this.face[N][R],L.push(G),k.push(N),c.splice(V,1),V=0):V++;return this.adjacentFaces.push(L),k}toGoldbergPolyhedronData(){const Z=new kZ("GeoDual","Goldberg",[],[]);Z.name="GD dual";const c=this.vertex.length,L=new Array(c);for(let p=0;p<c;p++)L[p]=[];for(let p=0;p<this.face.length;p++)for(let Z=0;Z<3;Z++)L[this.face[p][Z]].push(p);let k=0,N=0,R=0,G=[],V=[];this.adjacentFaces=[];for(let p=0;p<L.length;p++){Z.face[p]=this.setOrder(p,L[p].concat([]));for(const c of L[p]){k=0,N=0,R=0,G=this.face[c];for(let Z=0;Z<3;Z++)V=this.vertex[G[Z]],k+=V[0],N+=V[1],R+=V[2];Z.vertex[c]=[k/3,N/3,R/3]}}return Z}static BuildGeodesicData(Z){const c=new NZ("Geodesic-m-n","Geodesic",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(let L=0;L<Z.IDATA.face.length;L++)Z.MapToFace(L,c),c.innerToData(L,Z),"B"===Z.IDATA.edgematch[L][1]&&c.mapABOBtoDATA(L,Z),"O"===Z.IDATA.edgematch[L][1]&&c.mapOBOAtoDATA(L,Z),"A"===Z.IDATA.edgematch[L][3]&&c.mapBAOAtoDATA(L,Z);c.orderData(Z);return c.vertex=c.vertex.map((function(Z){const c=Z[0],L=Z[1],k=Z[2],N=Math.sqrt(c*c+L*L+k*k);return Z[0]*=1/N,Z[1]*=1/N,Z[2]*=1/N,Z})),c}}N.c._GoldbergMeshParser=(Z,c)=>RZ.Parse(Z,c);class RZ extends N.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Z,c){return void 0===c?(Z>this.goldbergData.nbUnsharedFaces-1&&(C.e.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(C.e.Warn("Last pole used"),Z=11),c>this.goldbergData.nbFacesAtPole-1&&(C.e.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(Z){for(let L=0;L<Z.length;L++){const c=Z[L][0],k=Z[L][1],N=Z[L][2];for(let Z=c;Z<k+1;Z++)this.goldbergData.faceColors[Z]=N}const c=[];for(let L=0;L<12;L++)for(let Z=0;Z<5;Z++)c.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);for(let L=12;L<this.goldbergData.faceColors.length;L++)for(let Z=0;Z<6;Z++)c.push(this.goldbergData.faceColors[L].r,this.goldbergData.faceColors[L].g,this.goldbergData.faceColors[L].b,this.goldbergData.faceColors[L].a);return c}setGoldbergFaceColors(Z){const c=this._changeGoldbergFaceColors(Z);this.QZ(R.g.ColorKind,c)}updateGoldbergFaceColors(Z){const c=this._changeGoldbergFaceColors(Z);this.updateVerticesData(R.g.ColorKind,c)}_changeGoldbergFaceUVs(Z){const c=this.getVerticesData(R.g.UVKind);for(let L=0;L<Z.length;L++){const k=Z[L][0],N=Z[L][1],R=Z[L][2],G=Z[L][3],V=Z[L][4],p=[],J=[];let z,i;for(let Z=0;Z<5;Z++)z=R.x+G*Math.cos(V+Z*Math.PI/2.5),i=R.y+G*Math.sin(V+Z*Math.PI/2.5),z<0&&(z=0),z>1&&(z=1),p.push(z,i);for(let Z=0;Z<6;Z++)z=R.x+G*Math.cos(V+Z*Math.PI/3),i=R.y+G*Math.sin(V+Z*Math.PI/3),z<0&&(z=0),z>1&&(z=1),J.push(z,i);for(let Z=k;Z<Math.min(12,N+1);Z++)for(let L=0;L<5;L++)c[10*Z+2*L]=p[2*L],c[10*Z+2*L+1]=p[2*L+1];for(let Z=Math.max(12,k);Z<N+1;Z++)for(let L=0;L<6;L++)c[12*Z-24+2*L]=J[2*L],c[12*Z-23+2*L]=J[2*L+1]}return c}setGoldbergFaceUVs(Z){const c=this._changeGoldbergFaceUVs(Z);this.QZ(R.g.UVKind,c)}updateGoldbergFaceUVs(Z){const c=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(R.g.UVKind,c)}placeOnGoldbergFaceAt(Z,c,L){const N=k.h.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);Z.rotation=N,Z.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(L.x)).add(this.goldbergData.faceYaxis[c].scale(L.y)).add(this.goldbergData.faceZaxis[c].scale(L.z))}serialize(Z){super.serialize(Z),Z.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const Z of this.goldbergData.faceColors)c.faceColors.push(Z.xc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const Z of this.goldbergData.faceCenters)c.faceCenters.push(Z.xc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const Z of this.goldbergData.faceZaxis)c.faceZaxis.push(Z.xc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const Z of this.goldbergData.faceYaxis)c.faceYaxis.push(Z.xc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const Z of this.goldbergData.faceXaxis)c.faceXaxis.push(Z.xc())}Z.goldbergData=c}static Parse(Z,c){const L=Z.goldbergData;L.faceColors=L.faceColors.map((Z=>t.h.oc(Z))),L.faceCenters=L.faceCenters.map((Z=>k.h.oc(Z))),L.faceZaxis=L.faceZaxis.map((Z=>k.h.oc(Z))),L.faceXaxis=L.faceXaxis.map((Z=>k.h.oc(Z))),L.faceYaxis=L.faceYaxis.map((Z=>k.h.oc(Z)));const N=new RZ(Z.name,c);return N.goldbergData=L,N}}var GZ=L(11748);const VZ={CreateBox:i.d,CreateTiledBox:O,CreateSphere:w.b,CreateDisc:z.d,CreateIcoSphere:m,CreateRibbon:J,CreateCylinder:o,CreateTorus:X,CreateTorusKnot:B,CreateLineSystem:D.e,RJ:D.f,CreateDashedLines:D.d,ExtrudeShape:l,ExtrudeShapeCustom:W,CreateLathe:I,CreateTiledPlane:x,VJ:d.b,CreateGround:Q.h,CreateTiledGround:Q.i,CreateGroundFromHeightMap:Q.d,CreatePolygon:e.c,ExtrudePolygon:e.g,CreateTube:r,CreatePolyhedron:S,CreateGeodesic:function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=c.m||1;k!==Math.floor(k)&&(k=Math.floor(k),C.e.Warn("m not an integer only floor(m) used"));let N=c.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),C.e.Warn("n not an integer only floor(n) used")),N>k){const Z=N;N=k,k=Z,C.e.Warn("n > m therefore m and n swapped")}const R=new LZ;return R.build(k,N),S(Z,{custom:NZ.BuildGeodesicData(R),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},L)},CreateGoldberg:function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=c.size,p=c.sizeX||R||1,J=c.sizeY||R||1,z=c.sizeZ||R||1;let i=c.m||1;i!==Math.floor(i)&&(i=Math.floor(i),C.e.Warn("m not an integer only floor(m) used"));let E=c.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),C.e.Warn("n not an integer only floor(n) used")),E>i){const Z=E;E=i,i=Z,C.e.Warn("n > m therefore m and n swapped")}const x=new LZ;x.build(i,E);const q=NZ.BuildGeodesicData(x),O=q.toGoldbergPolyhedronData(),w=new RZ(Z,L);c.sideOrientation=N.c._GetDefaultSideOrientation(c.sideOrientation),w._originalBuilderSideOrientation=c.sideOrientation;(function(Z,c){const L=Z.size,N=Z.sizeX||L||1,R=Z.sizeY||L||1,p=Z.sizeZ||L||1,J=0===Z.sideOrientation?0:Z.sideOrientation||G.e.DEFAULTSIDE,z=[],i=[],t=[],E=[];let x=1/0,q=-1/0,O=1/0,w=-1/0;for(let k=0;k<c.vertex.length;k++)x=Math.min(x,c.vertex[k][0]*N),q=Math.max(q,c.vertex[k][0]*N),O=Math.min(O,c.vertex[k][1]*R),w=Math.max(w,c.vertex[k][1]*R);let M=0;for(let G=0;G<c.face.length;G++){const Z=c.face[G],L=k.h.oc(c.vertex[Z[0]]),J=k.h.oc(c.vertex[Z[2]]),P=k.h.oc(c.vertex[Z[1]]),j=J.yL(L),o=P.yL(L),u=k.h.Cross(o,j).normalize();for(let k=0;k<Z.length;k++){t.push(u.x,u.y,u.z);const L=c.vertex[Z[k]];z.push(L[0]*N,L[1]*R,L[2]*p);const G=(L[1]*R-O)/(w-O);E.push((L[0]*N-x)/(q-x),V.b?1-G:G)}for(let c=0;c<Z.length-2;c++)i.push(M,M+c+2,M+c+1);M+=Z.length}G.e._ComputeSides(J,z,i,t,E);const P=new G.e;return P.BZ=z,P.indices=i,P.DZ=t,P.HZ=E,P})(c,O).WZ(w,c.updatable),w.goldbergData.nbSharedFaces=q.sharedNodes,w.goldbergData.nbUnsharedFaces=q.poleNodes,w.goldbergData.adjacentFaces=q.adjacentFaces,w.goldbergData.nbFaces=w.goldbergData.nbSharedFaces+w.goldbergData.nbUnsharedFaces,w.goldbergData.nbFacesAtPole=(w.goldbergData.nbUnsharedFaces-12)/12;for(let N=0;N<q.vertex.length;N++)w.goldbergData.faceCenters.push(k.h.oc(q.vertex[N])),w.goldbergData.faceCenters[N].x*=p,w.goldbergData.faceCenters[N].y*=J,w.goldbergData.faceCenters[N].z*=z,w.goldbergData.faceColors.push(new t.h(1,1,1,1));for(let N=0;N<O.face.length;N++){const Z=O.face[N],c=k.h.oc(O.vertex[Z[0]]),L=k.h.oc(O.vertex[Z[2]]),R=k.h.oc(O.vertex[Z[1]]),G=L.yL(c),V=R.yL(c),p=k.h.Cross(V,G).normalize(),J=k.h.Cross(V,p).normalize();w.goldbergData.faceXaxis.push(V.normalize()),w.goldbergData.faceYaxis.push(p),w.goldbergData.faceZaxis.push(J)}return w},CreateDecal:v,CreateCapsule:a,CreateText:GZ.f}},12453:(Z,c,L)=>{"use strict";L.d(c,{e:()=>Vc});var k=L(10993),N=L(11650);class R extends N.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var G=L(11255),V=(L(11431),L(11012));class p{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this._targetStopDuration!==Z&&(this._targetStopDuration=Z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){this._useLogarithmicDepth=Z&&this.XZ().getEngine().getCaps().fragmentDepthSupported}XZ(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Z){switch(Z){case p.BLENDMODE_MULTIPLYADD:return;case p.BLENDMODE_ADD:Z=1;break;case p.BLENDMODE_ONEONE:Z=6;break;case p.BLENDMODE_STANDARD:Z=2;break;case p.BLENDMODE_MULTIPLY:Z=4;break;case p.BLENDMODE_SUBTRACT:Z=3}this._engine.setAlphaMode(Z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:k.h.Zero()}set direction1(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:k.h.Zero()}set direction2(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:k.h.Zero()}set minEmitBox(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:k.h.Zero()}set maxEmitBox(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)}get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z)}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)}_reset(){}_removeGradientAndTexture(Z,c,L){if(!c)return this;let k=0;for(const N of c){if(N.gradient===Z){c.splice(k,1);break}k++}return L&&L.dispose(),this}constructor(Z){this.animations=[],this.renderingGroupId=0,this.j=k.h.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new k.h(10,10,10),this.onAnimationEnd=null,this.blendMode=p.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new k.f(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.LJ=new k.h(0,0,0),this._useLogarithmicDepth=!1,this.gravity=k.h.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.h(1,1,1,1),this.color2=new G.h(1,1,1,1),this.colorDead=new G.h(0,0,0,1),this.textureMask=new G.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new R,this.id=Z,this.name=Z}createPointEmitter(Z,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new k.h(0,1,0),arguments.length>2&&void 0!==arguments[2]||new k.h(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new k.h(0,1,0),arguments.length>4&&void 0!==arguments[4]||new k.h(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new k.h(0,1,0),arguments.length>3&&void 0!==arguments[3]||new k.h(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Z,c,L,k){throw new Error("Method not implemented.")}}p.BLENDMODE_ONEONE=0,p.BLENDMODE_STANDARD=1,p.BLENDMODE_ADD=2,p.BLENDMODE_MULTIPLY=3,p.BLENDMODE_MULTIPLYADD=4,p.BLENDMODE_SUBTRACT=-1,(0,V.g)("BABYLON.BaseParticleSystem",p);var J=L(11032),z=L(11058);class i{constructor(){this.direction1=new k.h(0,1,0),this.direction2=new k.h(0,1,0),this.minEmitBox=new k.h(-.5,-.5,-.5),this.maxEmitBox=new k.h(.5,.5,.5)}startDirectionFunction(Z,c,L,N){const R=(0,J.RandomRange)(this.direction1.x,this.direction2.x),G=(0,J.RandomRange)(this.direction1.y,this.direction2.y),V=(0,J.RandomRange)(this.direction1.z,this.direction2.z);if(N)return c.x=R,c.y=G,void(c.z=V);k.h.TransformNormalFromFloatsToRef(R,G,V,Z,c)}startPositionFunction(Z,c,L,N){const R=(0,J.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),G=(0,J.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),V=(0,J.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(N)return c.x=R,c.y=G,void(c.z=V);k.h.TransformCoordinatesFromFloatsToRef(R,G,V,Z,c)}clone(){const Z=new i;return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.xc(),Z.direction2=this.direction2.xc(),Z.minEmitBox=this.minEmitBox.xc(),Z.maxEmitBox=this.maxEmitBox.xc(),Z}parse(Z){k.h.FromArrayToRef(Z.direction1,0,this.direction1),k.h.FromArrayToRef(Z.direction2,0,this.direction2),k.h.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),k.h.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)}}class t{get radius(){return this._radius}set radius(Z){this._radius=Z,this._buildHeight()}get angle(){return this._angle}set angle(Z){this._angle=Z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=L,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=Z}startDirectionFunction(Z,c,L,N){N?k.d.Mc[0].R(L.bV).normalize():L.position.subtractToRef(Z.getTranslation(),k.d.Mc[0]).normalize();const R=(0,J.RandomRange)(0,this.directionRandomizer),G=(0,J.RandomRange)(0,this.directionRandomizer),V=(0,J.RandomRange)(0,this.directionRandomizer);c.x=k.d.Mc[0].x+R,c.y=k.d.Mc[0].y+G,c.z=k.d.Mc[0].z+V,c.normalize()}startPositionFunction(Z,c,L,N){const R=(0,J.RandomRange)(0,2*Math.PI);let G;this.emitFromSpawnPointOnly?G=1e-4:(G=(0,J.RandomRange)(0,this.heightRange),G=1-G*G);let V=this._radius-(0,J.RandomRange)(0,this._radius*this.radiusRange);V*=G;const p=V*Math.sin(R),z=V*Math.cos(R),i=G*this._height;if(N)return c.x=p,c.y=i,void(c.z=z);k.h.TransformCoordinatesFromFloatsToRef(p,i,z,Z,c)}clone(){const Z=new t(this._radius,this._angle,this.directionRandomizer);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)}getEffectDefines(){let Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z}getClassName(){return"ConeParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z}parse(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly}}class E extends t{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0);super(Z,c),this.direction1=L,this.direction2=N}startDirectionFunction(Z,c){const L=(0,J.RandomRange)(this.direction1.x,this.direction2.x),N=(0,J.RandomRange)(this.direction1.y,this.direction2.y),R=(0,J.RandomRange)(this.direction1.z,this.direction2.z);k.h.TransformNormalFromFloatsToRef(L,N,R,Z,c)}clone(){const Z=new E(this.radius,this.angle,this.direction1,this.direction2);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.xc(),Z.direction2=this.direction2.xc(),Z}parse(Z){super.parse(Z),this.direction1.R(Z.direction1),this.direction2.R(Z.direction2)}}class x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Z,this.height=c,this.radiusRange=L,this.directionRandomizer=N,this._tempVector=k.h.Zero()}startDirectionFunction(Z,c,L,N,R){L.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),k.h.TransformNormalToRef(this._tempVector,R,this._tempVector);const G=(0,J.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let V=Math.atan2(this._tempVector.x,this._tempVector.z);V+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=G,this._tempVector.x=Math.sin(V),this._tempVector.z=Math.cos(V),this._tempVector.normalize(),N?c.R(this._tempVector):k.h.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,c)}startPositionFunction(Z,c,L,N){const R=(0,J.RandomRange)(-this.height/2,this.height/2),G=(0,J.RandomRange)(0,2*Math.PI),V=(0,J.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),p=Math.sqrt(V)*this.radius,z=p*Math.cos(G),i=p*Math.sin(G);N?c.wc(z,R,i):k.h.TransformCoordinatesFromFloatsToRef(z,R,i,Z,c)}clone(){const Z=new x(this.radius,this.directionRandomizer);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class q extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0),R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.h(0,1,0);super(Z,c,L),this.direction1=N,this.direction2=R}startDirectionFunction(Z,c,L,N){const R=(0,J.RandomRange)(this.direction1.x,this.direction2.x),G=(0,J.RandomRange)(this.direction1.y,this.direction2.y),V=(0,J.RandomRange)(this.direction1.z,this.direction2.z);N?c.wc(R,G,V):k.h.TransformNormalFromFloatsToRef(R,G,V,Z,c)}clone(){const Z=new q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.xc(),Z.direction2=this.direction2.xc(),Z}parse(Z){super.parse(Z),k.h.FromArrayToRef(Z.direction1,0,this.direction1),k.h.FromArrayToRef(Z.direction2,0,this.direction2)}}class O{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=c,this.directionRandomizer=L}startDirectionFunction(Z,c,L,N){const R=L.position.yL(Z.getTranslation()).normalize(),G=(0,J.RandomRange)(0,this.directionRandomizer),V=(0,J.RandomRange)(0,this.directionRandomizer),p=(0,J.RandomRange)(0,this.directionRandomizer);R.x+=G,R.y+=V,R.z+=p,R.normalize(),N?c.R(R):k.h.TransformNormalFromFloatsToRef(R.x,R.y,R.z,Z,c)}startPositionFunction(Z,c,L,N){const R=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),G=(0,J.RandomRange)(0,1),V=(0,J.RandomRange)(0,2*Math.PI),p=Math.acos(2*G-1),z=R*Math.cos(V)*Math.sin(p),i=R*Math.cos(p),t=R*Math.sin(V)*Math.sin(p);N?c.wc(z,Math.abs(i),t):k.h.TransformCoordinatesFromFloatsToRef(z,Math.abs(i),t,Z,c)}clone(){const Z=new O(this.radius,this.directionRandomizer);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class w{constructor(){this.direction1=new k.h(0,1,0),this.direction2=new k.h(0,1,0)}startDirectionFunction(Z,c,L,N){const R=(0,J.RandomRange)(this.direction1.x,this.direction2.x),G=(0,J.RandomRange)(this.direction1.y,this.direction2.y),V=(0,J.RandomRange)(this.direction1.z,this.direction2.z);N?c.wc(R,G,V):k.h.TransformNormalFromFloatsToRef(R,G,V,Z,c)}startPositionFunction(Z,c,L,N){N?c.wc(0,0,0):k.h.TransformCoordinatesFromFloatsToRef(0,0,0,Z,c)}clone(){const Z=new w;return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.xc(),Z.direction2=this.direction2.xc(),Z}parse(Z){k.h.FromArrayToRef(Z.direction1,0,this.direction1),k.h.FromArrayToRef(Z.direction2,0,this.direction2)}}class M{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=c,this.directionRandomizer=L}startDirectionFunction(Z,c,L,N){const R=L.position.yL(Z.getTranslation()).normalize(),G=(0,J.RandomRange)(0,this.directionRandomizer),V=(0,J.RandomRange)(0,this.directionRandomizer),p=(0,J.RandomRange)(0,this.directionRandomizer);R.x+=G,R.y+=V,R.z+=p,R.normalize(),N?c.R(R):k.h.TransformNormalFromFloatsToRef(R.x,R.y,R.z,Z,c)}startPositionFunction(Z,c,L,N){const R=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),G=(0,J.RandomRange)(0,1),V=(0,J.RandomRange)(0,2*Math.PI),p=Math.acos(2*G-1),z=R*Math.cos(V)*Math.sin(p),i=R*Math.cos(p),t=R*Math.sin(V)*Math.sin(p);N?c.wc(z,i,t):k.h.TransformCoordinatesFromFloatsToRef(z,i,t,Z,c)}clone(){const Z=new M(this.radius,this.directionRandomizer);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class P extends M{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.h(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0);super(Z),this.direction1=c,this.direction2=L}startDirectionFunction(Z,c){const L=(0,J.RandomRange)(this.direction1.x,this.direction2.x),N=(0,J.RandomRange)(this.direction1.y,this.direction2.y),R=(0,J.RandomRange)(this.direction1.z,this.direction2.z);k.h.TransformNormalFromFloatsToRef(L,N,R,Z,c)}clone(){const Z=new P(this.radius,this.direction1,this.direction2);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.xc(),Z.direction2=this.direction2.xc(),Z}parse(Z){super.parse(Z),this.direction1.R(Z.direction1),this.direction2.R(Z.direction2)}}class j{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Z,c,L,N){const R=k.d.Mc[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,L,R);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,L,R);const Z=k.d.Mc[1];R.subtractToRef(L.position,Z),Z.scaleToRef(1/L.lifeTime,R)}else R.set(0,0,0);N?c.R(R):k.h.TransformNormalToRef(R,Z,c)}startPositionFunction(Z,c,L,N){const R=k.d.Mc[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,L,R):R.set(0,0,0),N?c.R(R):k.h.TransformCoordinatesToRef(R,Z,c)}clone(){const Z=new j;return z.d.DeepCopy(this,Z),Z}applyToShader(Z){}buildUniformLayout(Z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.particlePositionGenerator=this.particlePositionGenerator,Z.particleDestinationGenerator=this.particleDestinationGenerator,Z}parse(Z){Z.particlePositionGenerator&&(this.particlePositionGenerator=Z.particlePositionGenerator),Z.particleDestinationGenerator&&(this.particleDestinationGenerator=Z.particleDestinationGenerator)}}var o=L(11190);class u{get mesh(){return this._mesh}set mesh(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.tc(),this._positions=Z.getVerticesData(o.g.PositionKind),this._normals=Z.getVerticesData(o.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=k.h.Zero(),this._mesh=null,this.direction1=new k.h(0,1,0),this.direction2=new k.h(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}startDirectionFunction(Z,c,L,N){if(this.useMeshNormalsForDirection&&this._normals)return void k.h.TransformNormalToRef(this._storedNormal,Z,c);const R=(0,J.RandomRange)(this.direction1.x,this.direction2.x),G=(0,J.RandomRange)(this.direction1.y,this.direction2.y),V=(0,J.RandomRange)(this.direction1.z,this.direction2.z);N?c.wc(R,G,V):k.h.TransformNormalFromFloatsToRef(R,G,V,Z,c)}startPositionFunction(Z,c,L,N){if(!this._indices||!this._positions)return;const R=3*(Math.random()*(this._indices.length/3)|0),G=Math.random(),V=Math.random()*(1-G),p=1-G-V,J=this._indices[R],z=this._indices[R+1],i=this._indices[R+2],t=k.d.Mc[0],E=k.d.Mc[1],x=k.d.Mc[2],q=k.d.Mc[3];k.h.FromArrayToRef(this._positions,3*J,t),k.h.FromArrayToRef(this._positions,3*z,E),k.h.FromArrayToRef(this._positions,3*i,x),q.x=G*t.x+V*E.x+p*x.x,q.y=G*t.y+V*E.y+p*x.y,q.z=G*t.z+V*E.z+p*x.z,N?c.wc(q.x,q.y,q.z):k.h.TransformCoordinatesFromFloatsToRef(q.x,q.y,q.z,Z,c),this.useMeshNormalsForDirection&&this._normals&&(k.h.FromArrayToRef(this._normals,3*J,t),k.h.FromArrayToRef(this._normals,3*z,E),k.h.FromArrayToRef(this._normals,3*i,x),this._storedNormal.x=G*t.x+V*E.x+p*x.x,this._storedNormal.y=G*t.y+V*E.y+p*x.y,this._storedNormal.z=G*t.z+V*E.z+p*x.z)}clone(){const Z=new u(this.mesh);return z.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Z;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.xc(),c.direction2=this.direction2.xc(),c.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(Z,c){k.h.FromArrayToRef(Z.direction1,0,this.direction1),k.h.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&c&&(this.mesh=c.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection}}class X{_isUbo(Z){return void 0!==Z.addUniform}constructor(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.hc.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}}var h=L(11124);const B="gpuUpdateParticlesPixelShader",D="#version 300 es\nvoid main() {discard;}\n";h.e.ShadersStore[B]||(h.e.ShadersStore[B]=D);const e="gpuUpdateParticlesVertexShader",H="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";h.e.ShadersStore[e]||(h.e.ShadersStore[e]=H);(0,V.g)("BABYLON.WebGL2ParticleSystem",class{constructor(Z,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Z;return(null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof j&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new X(this._updateEffect)}createVertexBuffers(Z,c){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(Z){return Z}bindDrawBuffers(Z,c,L){L?this._engine.bindBuffers(this._renderVertexBuffers,L,c):this._engine.bindVertexArrayObject(this._renderVAO[Z],null)}preUpdateParticleBuffer(){const Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Z,c,L){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);const k=this._engine;k.bindTransformFeedbackBuffer(c.getBuffer()),k.setRasterizerState(!1),k.beginTransformFeedback(!0),k.drawArraysType(3,0,L),k.endTransformFeedback(),k.setRasterizerState(!0),k.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO.length=0;for(let Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO.length=0}_createUpdateVAO(Z){const c={};c.position=Z.createVertexBuffer("position",0,3);let L=3;c.age=Z.createVertexBuffer("age",L,1),L+=1,c.size=Z.createVertexBuffer("size",L,3),L+=3,c.life=Z.createVertexBuffer("life",L,1),L+=1,c.seed=Z.createVertexBuffer("seed",L,4),L+=4,c.direction=Z.createVertexBuffer("direction",L,3),L+=3,this._parent.particleEmitterType instanceof j&&(c.initialPosition=Z.createVertexBuffer("initialPosition",L,3),L+=3),this._parent._colorGradientsTexture||(c.color=Z.createVertexBuffer("color",L,4),L+=4),this._parent._isBillboardBased||(c.initialDirection=Z.createVertexBuffer("initialDirection",L,3),L+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",L,3),L+=3,c.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",L,3),L+=3),this._parent._angularSpeedGradientsTexture?(c.angle=Z.createVertexBuffer("angle",L,1),L+=1):(c.angle=Z.createVertexBuffer("angle",L,2),L+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=Z.createVertexBuffer("cellIndex",L,1),L+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=Z.createVertexBuffer("cellStartOffset",L,1),L+=1));const k=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),k}});class l{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,k=arguments.length>3?arguments[3]:void 0;this._engine=Z,this._label=k,this._engine._storageBuffers.push(this),this._create(c,L)}_create(Z,c){this._bufferSize=Z,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(Z,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Z,c,L){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,c,L)}async read(Z,c,L,k){return await this._engine.readFromStorageBuffer(this._buffer,Z,c,L,k)}dispose(){const Z=this._engine._storageBuffers,c=Z.indexOf(this);-1!==c&&(Z[c]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var W=L(11170),T=L(11173),I=L(11242),d=L(11508),Q=L(11645),r=L(11052),f=L(11142),S=L(11496);class s{constructor(){this._gpuTimeInFrameId=-1,this.counter=new S.d}_addDuration(Z,c){Z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=Z):this.counter.addCount(c,!1))}}var m=L(11108);class A{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=c,this.uniqueId=Q.b.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new s),this._engine.getCaps().supportComputeShaders?k.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=L,this._options={bindingsMapping:{},defines:[],...k}):r.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):r.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=this._bindings[Z];this._bindings[Z]={type:L?0:4,object:c,indexInGroupEntries:null===k||void 0===k?void 0:k.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!k||k.object!==c||k.type!==this._bindings[Z].type)}setStorageTexture(Z,c){const L=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==c),this._bindings[Z]={type:1,object:c,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setExternalTexture(Z,c){const L=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==c),this._bindings[Z]={type:6,object:c,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setVideoTexture(Z,c){return!!c.externalTexture&&(this.setExternalTexture(Z,c.externalTexture),!0)}setUniformBuffer(Z,c){const L=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==c),this._bindings[Z]={type:A._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setStorageBuffer(Z,c){const L=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==c),this._bindings[Z]={type:A._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}setTextureSampler(Z,c){const L=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!L||!c.compareSampler(L.object)),this._bindings[Z]={type:5,object:c,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}}isReady(){let Z=this._effect;for(const N in this._bindings){const Z=this._bindings[N],c=Z.type,L=Z.object;switch(c){case 0:case 4:case 1:if(!L.isReady())return!1;break;case 6:if(!L.isReady())return!1;break}}const c=[],L=this._shaderPath;if(this._options.defines)for(let N=0;N<this._options.defines.length;N++)c.push(this._options.defines[N]);const k=c.join("\n");return this._cachedDefines!==k&&(this._cachedDefines=k,Z=this._engine.createComputeEffect(L,{defines:k,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()}dispatch(Z,c,L){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,c,L,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const L=A._BufferIsDataBuffer(Z)?Z:Z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,L,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const L=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(L.type){case 0:{const k=this._samplers[c],N=L.object;var Z;if(!k||!N._texture||!k.compareSampler(N._texture))this._samplers[c]=(new f.d).setParameters(N.wrapU,N.wrapV,N.wrapR,N.anisotropicFilteringLevel,N._texture.samplingMode,null===(Z=N._texture)||void 0===Z?void 0:Z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Z=L.object;Z.getBuffer()!==L.buffer&&(L.buffer=Z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((N=>{(0,m.d)((()=>this.dispatch(Z,c,L)),N,void 0,k)}))}serialize(){const Z=I.e.Serialize(this);Z.options=this._options,Z.shaderPath=this._shaderPath,Z.ni={},Z.textures={};for(const c in this._bindings){const L=this._bindings[c],k=L.object;switch(L.type){case 0:case 4:case 1:{const N=k.serialize();N&&(Z.textures[c]=N,Z.ni[c]={type:L.type});break}}}return Z}static Parse(Z,c,L){const k=I.e.Parse((()=>new A(Z.name,c.getEngine(),Z.shaderPath,Z.options)),Z,c,L);for(const N in Z.textures){const R=Z.ni[N],G=d.c.Parse(Z.textures[N],c,L);0===R.type?k.setTexture(N,G):4===R.type?k.setTexture(N,G,!1):k.setStorageTexture(N,G)}return k}static _BufferIsDataBuffer(Z){return void 0!==Z.underlyingResource}}(0,W.d)([(0,T.H)()],A.prototype,"name",void 0),(0,W.d)([(0,T.H)()],A.prototype,"fastMode",void 0),(0,V.g)("BABYLON.ComputeShader",A);var b=L(11236);const F="gpuUpdateParticlesComputeShader",U="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";h.e.ShadersStoreWGSL[F]||(h.e.ShadersStoreWGSL[F]=U);(0,V.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(Z,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Z;return(null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){var c;const L={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(L.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(L.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(L.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(L.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(L.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(L.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(L.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new A("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:L,defines:Z.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new b.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new X(this._simParamsComputeShader)}createVertexBuffers(Z,c){this._renderVertexBuffers.push(c)}createParticleBuffer(Z){const c=new l(this._engine,4*Z.length,11,"ComputeShaderParticleSystemBuffer");return c.update(Z),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(Z,c,L){this._engine.bindBuffers(this._renderVertexBuffers[Z],L,c)}preUpdateParticleBuffer(){}updateParticleBuffer(Z,c,L){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(L/64))}releaseBuffers(){var Z;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class K{constructor(Z,c,L){this.gradient=Z,this.color1=c,this.color2=L}getColorToRef(Z){this.color2?G.h.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.R(this.color1)}}class n{constructor(Z,c){this.gradient=Z,this.color=c}}class g{constructor(Z,c,L){this.gradient=Z,this.factor1=c,this.factor2=L}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class y{static GetCurrentGradient(Z,c,L){if(c[0].gradient>Z)return void L(c[0],c[0],1);for(let N=0;N<c.length-1;N++){const k=c[N],R=c[N+1];if(Z>=k.gradient&&Z<=R.gradient){return void L(k,R,(Z-k.gradient)/(R.gradient-k.gradient))}}const k=c.length-1;L(c[k],c[k],1)}}var v=L(11027),Y=L(11544),a=L(11023);class C{constructor(Z){this.particleSystem=Z,this.position=k.h.Zero(),this.direction=k.h.Zero(),this.color=new G.h(0,0,0,0),this.colorStep=new G.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new k.f(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.h(0,0,0,0),this._currentColor2=new G.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=C._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Z=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);const L=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let k;k=this._initialSpriteCellLoop?(0,J.Clamp)(Z*c%this.lifeTime/this.lifeTime):(0,J.Clamp)(Z*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+k*L|0}_inheritParticleInfoToSubEmitter(Z){if(Z.particleSystem.j.position){const c=Z.particleSystem.j;if(c.position.R(this.position),Z.inheritDirection){const Z=k.d.Mc[0];this.direction.normalizeToRef(Z),c.setDirection(Z,0,Math.PI/2)}}else{Z.particleSystem.j.R(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,k.d.Mc[0]),Z.particleSystem._inheritedVelocityOffset.R(k.d.Mc[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Z)}_reset(){this.age=0,this.id=C._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Z){Z.position.R(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.R(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.R(this.direction),this.bV&&(Z.bV?Z.bV.R(this.bV):Z.bV=this.bV.clone()),Z.color.R(this.color),Z.colorStep.R(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.R(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.R(this._currentColor1),Z._currentColor2.R(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellId=this._initialStartSpriteCellId,Z._initialEndSpriteCellId=this._initialEndSpriteCellId,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.R(this.remapData):Z.remapData=new k.j(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.R(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.R(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}C._Count=0;var ZZ=L(11230),cZ=(L(11429),L(11268)),LZ=L(11258),kZ=L(11607);function NZ(Z,c){const L=(0,J.RandomRange)(0,1);G.h.LerpToRef(c.color1,c.color2,L,Z.color),c.colorDead.subtractToRef(Z.color,c._colorDiff),c._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}function RZ(Z,c){Z._currentColorGradient=c._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.R(Z.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.R(Z.color)}function GZ(Z,c){const L=c._colorGradients;y.GetCurrentGradient(c._ratio,L,((c,L,k)=>{c!==Z._currentColorGradient&&(Z._currentColor1.R(Z._currentColor2),L.getColorToRef(Z._currentColor2),Z._currentColorGradient=c),G.h.LerpToRef(Z._currentColor1,Z._currentColor2,k,Z.color)}))}function VZ(Z,c){Z.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),Z.color.addInPlace(c._scaledColorStep),Z.color.a<0&&(Z.color.a=0)}function pZ(Z,c){y.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,L,k)=>{c!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=L.getFactor(),Z._currentAngularSpeedGradient=c),Z.angularSpeed=(0,J.Lerp)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,k)}))}function JZ(Z,c){Z.angle+=Z.angularSpeed*c._scaledUpdateSpeed}function zZ(Z,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,Z.direction,Z,c.isLocal,c._emitterInverseWorldMatrix)}function iZ(Z,c){c.startDirectionFunction(c._emitterWorldMatrix,Z.direction,Z,c.isLocal)}function tZ(Z,c){Z._currentVelocityGradient=c._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?Z._currentVelocity2=c._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1}function EZ(Z,c){Z._currentLimitVelocityGradient=c._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?Z._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1}function xZ(Z,c){y.GetCurrentGradient(c._ratio,c._velocityGradients,((L,k,N)=>{L!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=k.getFactor(),Z._currentVelocityGradient=L),c._directionScale*=(0,J.Lerp)(Z._currentVelocity1,Z._currentVelocity2,N)}))}function qZ(Z,c){y.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((L,k,N)=>{L!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=k.getFactor(),Z._currentLimitVelocityGradient=L);const R=(0,J.Lerp)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,N);Z.direction.length()>R&&Z.direction.scaleInPlace(c.limitVelocityDamping)}))}function OZ(Z,c){Z.direction.scaleToRef(c._directionScale,c._scaledDirection)}function wZ(Z,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,Z.position,Z,c.isLocal)}function MZ(Z,c){c.startPositionFunction(c._emitterWorldMatrix,Z.position,Z,c.isLocal)}function PZ(Z,c){Z.bV?Z.bV.R(Z.position):Z.bV=Z.position.clone(),k.h.TransformCoordinatesToRef(Z.bV,c._emitterWorldMatrix,Z.position)}function jZ(Z,c){c.isLocal&&Z.bV?(Z.bV.addInPlace(c._scaledDirection),k.h.TransformCoordinatesToRef(Z.bV,c._emitterWorldMatrix,Z.position)):Z.position.addInPlace(c._scaledDirection)}function oZ(Z,c){Z._currentDragGradient=c._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),c._dragGradients.length>1?Z._currentDrag2=c._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1}function uZ(Z,c){y.GetCurrentGradient(c._ratio,c._dragGradients,((L,k,N)=>{L!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=k.getFactor(),Z._currentDragGradient=L);const R=(0,J.Lerp)(Z._currentDrag1,Z._currentDrag2,N);c._scaledDirection.scaleInPlace(1-R)}))}function XZ(Z,c){Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.wc(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.wc(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new k.h(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new k.h(Math.random(),Math.random(),Math.random()))}function hZ(Z,c){const L=c._noiseTextureData,N=c._noiseTextureSize;if(L&&N&&Z._randomNoiseCoordinates1){const R=c._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,N.width,N.height,L),G=c._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,N.width,N.height,L),V=c._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,N.width,N.height,L),p=k.d.Mc[0],J=k.d.Mc[1];p.wc((2*R-1)*c.noiseStrength.x,(2*G-1)*c.noiseStrength.y,(2*V-1)*c.noiseStrength.z),p.scaleToRef(c._tempScaledUpdateSpeed,J),Z.direction.addInPlace(J)}}function BZ(Z,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),Z.direction.addInPlace(c._scaledGravity)}function DZ(Z,c){Z.size=(0,J.RandomRange)(c.minSize,c.maxSize),Z.scale.wc((0,J.RandomRange)(c.minScaleX,c.maxScaleX),(0,J.RandomRange)(c.minScaleY,c.maxScaleY))}function eZ(Z,c){Z._currentSizeGradient=c._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,c._sizeGradients.length>1?Z._currentSize2=c._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1,Z.scale.wc((0,J.RandomRange)(c.minScaleX,c.maxScaleX),(0,J.RandomRange)(c.minScaleY,c.maxScaleY))}function HZ(Z,c){const L=c._actualFrame/c.targetStopDuration;y.GetCurrentGradient(L,c._startSizeGradients,((L,k,N)=>{L!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=k.getFactor(),c._currentStartSizeGradient=L);const R=(0,J.Lerp)(c._currentStartSize1,c._currentStartSize2,N);Z.scale.scaleInPlace(R)}))}function lZ(Z,c){y.GetCurrentGradient(c._ratio,c._sizeGradients,((c,L,k)=>{c!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=L.getFactor(),Z._currentSizeGradient=c),Z.size=(0,J.Lerp)(Z._currentSize1,Z._currentSize2,k)}))}function WZ(Z,c){Z.remapData=new k.j(0,1,0,1)}function TZ(Z,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&y.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,L,k)=>{const N=(0,J.Lerp)(c.factor1,L.factor1,k),R=(0,J.Lerp)(c.factor2,L.factor2,k);Z.remapData.x=N,Z.remapData.y=R-N})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&y.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,L,k)=>{const N=(0,J.Lerp)(c.factor1,L.factor1,k),R=(0,J.Lerp)(c.factor2,L.factor2,k);Z.remapData.z=N,Z.remapData.w=R-N}))}function IZ(Z,c){const L=(0,J.Clamp)(c._actualFrame/c.targetStopDuration);y.GetCurrentGradient(L,c._lifeTimeGradients,((c,k)=>{const N=c,R=k,G=N.getFactor(),V=R.getFactor(),p=(L-N.gradient)/(R.gradient-N.gradient);Z.lifeTime=(0,J.Lerp)(G,V,p)})),c._emitPower=(0,J.RandomRange)(c.minEmitPower,c.maxEmitPower)}function dZ(Z,c){Z.lifeTime=(0,J.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,J.RandomRange)(c.minEmitPower,c.maxEmitPower)}function QZ(Z,c){0===c._emitPower?(Z._initialDirection?Z._initialDirection.R(Z.direction):Z._initialDirection=Z.direction.clone(),Z.direction.set(0,0,0)):(Z._initialDirection=null,Z.direction.scaleInPlace(c._emitPower)),Z.direction.addInPlace(c._inheritedVelocityOffset)}function rZ(Z,c){Z.angularSpeed=(0,J.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),Z.angle=(0,J.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function fZ(Z,c){Z._currentAngularSpeedGradient=c._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,c._angularSpeedGradients.length>1?Z._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1,Z.angle=(0,J.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function SZ(Z,c){Z._initialStartSpriteCellId=c.startSpriteCellID,Z._initialEndSpriteCellId=c.endSpriteCellID,Z._initialSpriteCellLoop=c.spriteCellLoop}function sZ(Z,c){Z.previousItem=c.previousItem,Z.nextItem=c,c.previousItem&&(c.previousItem.nextItem=Z),c.previousItem=Z}function mZ(Z,c){Z.previousItem=c,Z.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=Z),c.nextItem=Z}function AZ(Z,c){let L=c;for(;L.nextItem;)L=L.nextItem;Z.previousItem=L,Z.nextItem=L.nextItem,L.nextItem=Z}function bZ(Z){Z.previousItem&&(Z.previousItem.nextItem=Z.nextItem),Z.nextItem&&(Z.nextItem.previousItem=Z.previousItem)}class FZ extends p{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Z){this._startDirectionFunction!==Z&&(this._startDirectionFunction=Z,this._directionProcessing.process=Z?iZ:zZ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Z){this._startPositionFunction!==Z&&(this._startPositionFunction=Z,this._positionCreation.process=Z?MZ:wZ)}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}get p(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect(),Z?(this._rampCreation={process:WZ,previousItem:null,nextItem:null},mZ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:TZ,previousItem:null,nextItem:null},mZ(this._remapGradientProcessing,this._gravityProcessing)):(bZ(this._rampCreation),bZ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Z){this._isLocal!==Z&&(this._isLocal=Z,Z?(this._isLocalCreation={process:PZ,previousItem:null,nextItem:null},mZ(this._isLocalCreation,this._positionCreation)):bZ(this._isLocalCreation))}get particles(){return this.Ai}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z,Z?(this._sheetCreation={process:SZ,previousItem:null,nextItem:null},mZ(this._sheetCreation,this._colorCreation)):bZ(this._sheetCreation),this._reset())}getActiveCount(){return this.Ai.length}getClassName(){return"bc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[c])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new ZZ.d(this._engine),this._customWrappers[c].effect=Z,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){if(this.noiseTexture!==Z){if(this._noiseTexture=Z,!Z)return bZ(this._noiseCreation),void bZ(this._noiseProcessing);this._noiseCreation={process:XZ,previousItem:null,nextItem:null},mZ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:hZ,previousItem:null,nextItem:null},mZ(this._noiseProcessing,this._positionProcessing)}}constructor(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Z),this._emitterInverseWorldMatrix=k.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new k.h,this.Xc=new v.b,this.onStoppedObservable=new v.b,this.onStartedObservable=new v.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ai=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new G.h(0,0,0,0),this._colorDiff=new G.h(0,0,0,0),this._scaledDirection=k.h.Zero(),this._scaledGravity=k.h.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Z=>{},this.recycleParticle=Z=>{const c=this.Ai.pop();c!==Z&&c.copyTo(Z),this._stockParticles.push(c)},this._createParticle=()=>{let Z;return 0!==this._stockParticles.length?(Z=this._stockParticles.pop(),Z._reset()):Z=new C(this),this._prepareParticle(Z),Z},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=V,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=k.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.si.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:dZ,previousItem:null,nextItem:null},this._positionCreation={process:wZ,previousItem:null,nextItem:null},mZ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:zZ,previousItem:null,nextItem:null},mZ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:QZ,previousItem:null,nextItem:null},mZ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:DZ,previousItem:null,nextItem:null},mZ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:rZ,previousItem:null,nextItem:null},mZ(this._angleCreation,this._sizeCreation),this._colorCreation={process:NZ,previousItem:null,nextItem:null},mZ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,p||(this._colorProcessing={process:VZ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:JZ,previousItem:null,nextItem:null},mZ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:OZ,previousItem:null,nextItem:null},mZ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:jZ,previousItem:null,nextItem:null},mZ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:BZ,previousItem:null,nextItem:null},mZ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=R,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ZZ.d(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new i,this.updateFunction=Z=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((Z=>{this._noiseTextureData=Z})));const L=Z===this.Ai;for(let k=0;k<Z.length;k++){const c=Z[k];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const N=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const Z=c.age-N,L=c.lifeTime-N;this._tempScaledUpdateSpeed=L*this._tempScaledUpdateSpeed/Z,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let R=this._updateQueueStart;for(;R;)R.process(c,this),R=R.nextItem;if(this._isAnimationSheetEnabled&&!p&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const Z of c._attachedSubEmitters)Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),L&&k--}else;}}}serialize(Z){throw new Error("Method not implemented.")}clone(Z,c){throw new Error("Method not implemented.")}_addFactorGradient(Z,c,L,k){const N=new g(c,L,k);Z.push(N),Z.sort(((Z,c)=>Z.gradient<c.gradient?-1:Z.gradient>c.gradient?1:0))}_removeFactorGradient(Z,c){if(!Z)return;let L=0;for(const k of Z){if(k.gradient===c){Z.splice(L,1);break}L++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=IZ:this._lifeTimeCreation.process=dZ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:HZ,previousItem:null,nextItem:null},mZ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(bZ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this.targetStopDuration!==Z&&(this._targetStopDuration=Z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Z,c,L){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,c,L),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this._syncLifeTimeCreation(),this}addSizeGradient(Z,c,L){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=eZ,this._sizeGradientProcessing={process:lZ,previousItem:null,nextItem:null},sZ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Z,c,L),this}removeSizeGradient(Z){var c;return this._removeFactorGradient(this._sizeGradients,Z),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(bZ(this._sizeGradientProcessing),this._sizeCreation.process=DZ),this}addColorRemapGradient(Z,c,L){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,c,L),this}removeColorRemapGradient(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this}addAlphaRemapGradient(Z,c,L){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,c,L),this}removeAlphaRemapGradient(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this}addAngularSpeedGradient(Z,c,L){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=fZ,this._angularSpeedGradientProcessing={process:pZ,previousItem:null,nextItem:null},sZ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Z,c,L),this}removeAngularSpeedGradient(Z){var c;return this._removeFactorGradient(this._angularSpeedGradients,Z),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=rZ,bZ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Z,c,L){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:tZ,previousItem:null,nextItem:null},mZ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:xZ,previousItem:null,nextItem:null},sZ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Z,c,L),this}removeVelocityGradient(Z){var c;return this._removeFactorGradient(this._velocityGradients,Z),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(bZ(this._velocityCreation),bZ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Z,c,L){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:EZ,previousItem:null,nextItem:null},mZ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:qZ,previousItem:null,nextItem:null},mZ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Z,c,L),this}removeLimitVelocityGradient(Z){var c;return this._removeFactorGradient(this._limitVelocityGradients,Z),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(bZ(this._limitVelocityCreation),bZ(this._limitVelocityGradientProcessing)),this}addDragGradient(Z,c,L){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:oZ,previousItem:null,nextItem:null},sZ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:uZ,previousItem:null,nextItem:null},sZ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Z,c,L),this}removeDragGradient(Z){var c;return this._removeFactorGradient(this._dragGradients,Z),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(bZ(this._dragCreation),bZ(this._dragGradientProcessing)),this}addEmitRateGradient(Z,c,L){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,c,L),this}removeEmitRateGradient(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this}addStartSizeGradient(Z,c,L){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,c,L),this._syncStartSizeCreation(),this}removeStartSizeGradient(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Z=new Uint8Array(4*this._rawTextureWidth),c=G.i.sc[0];for(let L=0;L<this._rawTextureWidth;L++){const k=L/this._rawTextureWidth;y.GetCurrentGradient(k,this._rampGradients,((k,N,R)=>{G.d.LerpToRef(k.color,N.color,R,c),Z[4*L]=255*c.r,Z[4*L+1]=255*c.g,Z[4*L+2]=255*c.b,Z[4*L+3]=255}))}this._rampGradientsTexture=Y.e.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Z,c)=>Z.gradient<c.gradient?-1:Z.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Z,c){this._rampGradients||(this._rampGradients=[]);const L=new n(Z,c);return this._rampGradients.push(L),this._syncRampGradientTexture(),this}removeRampGradient(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Z,c,L){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=RZ,this._colorProcessing.process=GZ);const k=new K(Z,c,L);return this._colorGradients.push(k),this._colorGradients.sort(((Z,c)=>Z.gradient<c.gradient?-1:Z.gradient>c.gradient?1:0)),this}removeColorGradient(Z){if(!this._colorGradients)return this;let c=0;for(const L of this._colorGradients){if(L.gradient===Z){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=NZ,this._colorProcessing.process=VZ),this}resetDrawCache(){if(this._drawWrappers){for(const Z of this._drawWrappers)if(Z)for(const c of Z)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(Z,c,L,k,N){return N[4*(((Z=.5*Math.abs(Z)+.5)*L%L|0)+((c=.5*Math.abs(c)+.5)*k%k|0)*L)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Z=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new o.e(Z,this._vertexData,!0,c);let L=0;const k=this._vertexBuffer.createVertexBuffer(o.g.PositionKind,L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.g.PositionKind]=k,L+=3;const N=this._vertexBuffer.createVertexBuffer(o.g.ColorKind,L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.g.ColorKind]=N,L+=4;const R=this._vertexBuffer.createVertexBuffer("angle",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=R,L+=1;const G=this._vertexBuffer.createVertexBuffer("size",L,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=G,L+=2,this._isAnimationSheetEnabled){const Z=this._vertexBuffer.createVertexBuffer("cellIndex",L,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Z,L+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Z=this._vertexBuffer.createVertexBuffer("direction",L,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Z,L+=3}if(this._useRampGradients){const Z=this._vertexBuffer.createVertexBuffer("remapData",L,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Z,L+=4}let V;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new o.e(Z,c,!1,2),V=this._spriteBuffer.createVertexBuffer("offset",0,2)}else V=this._vertexBuffer.createVertexBuffer("offset",L,2,this._vertexBufferSize,this._useInstancing),L+=2;this._vertexBuffers.offset=V,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Z=[],c=[];let L=0;for(let k=0;k<this._capacity;k++)Z.push(L),Z.push(L+1),Z.push(L+2),Z.push(L),Z.push(L+2),Z.push(L+3),c.push(L,L+1,L+1,L+2,L+2,L+3,L+3,L,L,L+3),L+=4;this._indexBuffer=this._engine.createIndexBuffer(Z),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((()=>{this.start(0)}),Z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.j)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.j.Jc(!0);const Z=this.noiseTexture;if(Z&&Z.onGeneratedObservable)Z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),Z.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Z))}_postStop(Z){}reset(){this._stockParticles.length=0,this.Ai.length=0}_appendParticleVertex(Z,c,L,N){let R=Z*this._vertexBufferSize;if(this._vertexData[R++]=c.position.x+this.LJ.x,this._vertexData[R++]=c.position.y+this.LJ.y,this._vertexData[R++]=c.position.z+this.LJ.z,this._vertexData[R++]=c.color.r,this._vertexData[R++]=c.color.g,this._vertexData[R++]=c.color.b,this._vertexData[R++]=c.color.a,this._vertexData[R++]=c.angle,this._vertexData[R++]=c.scale.x*c.size,this._vertexData[R++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[R++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[R++]=c.direction.x,this._vertexData[R++]=c.direction.y,this._vertexData[R++]=c.direction.z);else if(c._initialDirection){let Z=c._initialDirection;this.isLocal&&(k.h.TransformNormalToRef(Z,this._emitterWorldMatrix,k.d.Mc[0]),Z=k.d.Mc[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[R++]=Z.x,this._vertexData[R++]=Z.y,this._vertexData[R++]=Z.z}else{let Z=c.direction;this.isLocal&&(k.h.TransformNormalToRef(Z,this._emitterWorldMatrix,k.d.Mc[0]),Z=k.d.Mc[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[R++]=Z.x,this._vertexData[R++]=Z.y,this._vertexData[R++]=Z.z}this._useRampGradients&&c.remapData&&(this._vertexData[R++]=c.remapData.x,this._vertexData[R++]=c.remapData.y,this._vertexData[R++]=c.remapData.z,this._vertexData[R++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===L?L=this._epsilon:1===L&&(L=1-this._epsilon),0===N?N=this._epsilon:1===N&&(N=1-this._epsilon)),this._vertexData[R++]=L,this._vertexData[R++]=N)}_prepareParticle(Z){}_createNewOnes(Z){let c;for(let L=0;L<Z&&this.Ai.length!==this._capacity;L++){c=this._createParticle(),this.Ai.push(c);let Z=this._createQueueStart;for(;Z;)Z.process(c,this),Z=Z.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(Z){if(this._alive=this.Ai.length>0,this.j.position){const Z=this.j;this._emitterWorldMatrix=Z.getWorldMatrix()}else{const Z=this.j;this._emitterWorldMatrix=k.b.Translation(Z.x,Z.y,Z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ai),this._createNewOnes(Z)}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=[o.g.PositionKind,o.g.ColorKind,"angle","offset","size"];return Z&&k.push("cellIndex"),c||k.push("direction"),L&&k.push("remapData"),k}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cZ.b)(k),Z&&k.push("particlesInfos"),c&&k.push("logarithmicDepthConstant"),L&&(k.push("vFogInfos"),k.push("vFogColor")),k}fillDefines(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cZ.h)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Z.push("#define FOG")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),c===p.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case 2:Z.push("#define BILLBOARDY");break;case 8:case 9:Z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Z.push("#define BILLBOARDMODE_ALL")}L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,c,L){c.push(...FZ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Z.push(...FZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,kZ.e)(Z,this._imageProcessingConfigurationDefines),(0,kZ.d)(L,this._imageProcessingConfigurationDefines))}_getWrapper(Z){const c=this._getCustomDrawWrapper(Z);if(null!==c&&void 0!==c&&c.effect)return c;const L=[];this.fillDefines(L,Z);const k=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let N=this._drawWrappers[k];N||(N=this._drawWrappers[k]=[]);let R=N[Z];R||(R=new ZZ.d(this._engine),R.drawContext&&(R.drawContext.useInstancing=this._useInstancing),N[Z]=R);const G=L.join("\n");if(R.defines!==G){const Z=[],c=[],L=[];this.fillUniformsAttributesAndSamplerNames(c,Z,L),R.setEffect(this._engine.createEffect("particles",Z,c,L,G,void 0,void 0,void 0,void 0,this._shaderLanguage),G)}return R}animate(){var Z;let c,L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!L&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(L?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;y.GetCurrentGradient(c,this._emitRateGradients,((c,L,k)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=L.getFactor(),this._currentEmitRateGradient=c),Z=(0,J.Lerp)(this._currentEmitRate1,this._currentEmitRate2,k)}))}c=Z*this._scaledUpdateSpeed|0,this._newPartsExcess+=Z*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!L){let Z=0;for(let c=0;c<this.Ai.length;c++){const L=this.Ai[c];this._appendParticleVertices(Z,L),Z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ai.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Z,c){this._appendParticleVertex(Z++,c,0,0),this._useInstancing||(this._appendParticleVertex(Z++,c,1,0),this._appendParticleVertex(Z++,c,1,1),this._appendParticleVertex(Z++,c,0,1))}rebuild(){var Z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!FZ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(L.bind(L,12602)),Promise.resolve().then(L.bind(L,12556))])):await Promise.all([Promise.resolve().then(L.bind(L,12544)),Promise.resolve().then(L.bind(L,12532))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==p.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(p.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(p.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Z){const c=this._getWrapper(Z),L=c.effect,N=this._engine;N.enableEffect(c);const R=this.defaultViewMatrix??this._scene.getViewMatrix();if(L.setTexture("diffuseSampler",this.particleTexture),L.setMatrix("view",R),L.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();L.setFloat3("particlesInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,this.spriteCellWidth/Z.width)}if(L.setVector2("translationPivot",this.translationPivot),L.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;L.setVector3("eyePosition",Z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),L.setTexture("rampSampler",this._rampGradientsTexture));const G=L.defines;var V,p,J,z,i,t;(this._scene&&((0,cZ.e)(L,this,this._scene),this.applyFog&&(0,LZ.d)(this._scene,void 0,L)),G.indexOf("#define BILLBOARDMODE_ALL")>=0&&(R.invertToRef(k.d.Matrix[0]),L.setMatrix("invView",k.d.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?N.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,L):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,L)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?N.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBuffer:this._indexBuffer,L):N.bindBuffers(this._vertexBuffers,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:null,L);(this.useLogarithmicDepth&&this._scene&&(0,LZ.k)(G,L,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(L),this._setEngineBasedOnBlendMode(Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(L),this._useInstancing)?null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?N.drawElementsType(6,0,10,this.Ai.length):N.drawArraysType(7,0,4,this.Ai.length):null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?N.drawElementsType(1,0,10*this.Ai.length):N.drawElementsType(0,0,6*this.Ai.length);return this.Ai.length}render(){if(!this.isReady()||!this.Ai.length)return 0;const Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));let c=0;return c=this.blendMode===p.BLENDMODE_MULTIPLYADD?this._render(p.BLENDMODE_MULTIPLY)+this._render(p.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Z=this._scene.si.indexOf(this);Z>-1&&this._scene.si.splice(Z,1),this._scene._activeParticleSystems.dispose()}this.Xc.notifyObservers(this),this.Xc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}FZ.ForceGLSL=!1;var UZ,KZ=L(11070);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(UZ||(UZ={}));class nZ{constructor(Z){if(this.particleSystem=Z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.j||!Z.j.dispose){const c=(0,V.d)("BABYLON.AbstractMesh");Z.j=new c("SubemitterSystemEmitter",Z.XZ()),Z._disposeEmitterOnDispose=!0}}clone(){let Z=this.particleSystem.j;if(Z){if(Z instanceof k.h)Z=Z.clone();else if(-1!==Z.getClassName().indexOf("Mesh")){Z=new((0,V.d)("BABYLON.Mesh"))("",Z.XZ()),Z.isVisible=!1}}else Z=new k.h;const c=new nZ(this.particleSystem.clone(this.particleSystem.name,Z));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(Z),c}static _ParseParticleSystem(Z,c,L){throw(0,KZ.e)("ParseParticle")}static Parse(Z,c,L){const k=Z.particleSystem,N=new nZ(nZ._ParseParticleSystem(k,c,L,!0));return N.type=Z.type,N.inheritDirection=Z.inheritDirection,N.inheritedVelocityAmount=Z.inheritedVelocityAmount,N.particleSystem._isSubEmitter=!0,N}dispose(){this.particleSystem.dispose()}}var gZ=L(11110);function yZ(Z,c){const L=new w;return L.direction1=Z,L.direction2=c,L}function vZ(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function YZ(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aZ(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.h(0,1,0),L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0);return new P(Z,c,L)}function CZ(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Zc(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0),R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.h(0,1,0);return new q(Z,c,L,N,R)}function cc(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new t(Z,c)}function Lc(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0);return new E(Z,c,L,N)}const kc=k.h.Zero(),Nc=k.h.Zero(),Rc=k.h.Zero();class Gc{constructor(){this.strength=0,this.position=k.h.Zero()}_processParticle(Z,c){this.position.subtractToRef(Z.position,kc);const L=kc.lengthSquared()+1;kc.normalize().scaleToRef(this.strength/L,Nc),Nc.scaleToRef(c._tempScaledUpdateSpeed,Rc),Z.direction.addInPlace(Rc)}serialize(){return{position:this.position.xc(),strength:this.strength}}}class Vc extends FZ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const L of this._subEmitters[c])if(1===L.type){const c=L.clone();Z._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Z,c){const L=yZ(Z,c);return this.particleEmitterType=L,L}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z,this._flowMapUpdate&&(bZ(this._flowMapUpdate),this._flowMapUpdate=null),Z&&(this._flowMapUpdate={process:Z=>{var c;const L=null===(c=this.XZ())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(Z,this.flowMapStrength*this._tempScaledUpdateSpeed,L)},previousItem:null,nextItem:null},mZ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Z){this._attractors.push(Z),1===this._attractors.length&&(this._attractorUpdate={process:Z=>{for(const c of this._attractors)c._processParticle(Z,this)},previousItem:null,nextItem:null},mZ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Z){const c=this._attractors.indexOf(Z);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&bZ(this._attractorUpdate)}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Z)}createHemisphericEmitter(){const Z=vZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=YZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=aZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.h(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=CZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Lc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,c,L,k){const N=new i;return this.particleEmitterType=N,this.direction1=Z,this.direction2=c,this.minEmitBox=L,this.maxEmitBox=k,N}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Z of this.subEmitters)Z instanceof Vc?this._subEmitters.push([new nZ(Z)]):Z instanceof nZ?this._subEmitters.push([Z]):Z instanceof Array&&this._subEmitters.push(Z)}_stopSubEmitters(){if(this.activeSubSystems){for(const Z of this.activeSubSystems)Z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Z){Z&&this._stopSubEmitters()}_prepareParticle(Z){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Z._attachedSubEmitters=[];for(const L of c)if(0===L.type){const c=L.clone();Z._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Z&&this.particles)for(const L of this.particles)if(L._attachedSubEmitters)for(let Z=L._attachedSubEmitters.length-1;Z>=0;Z-=1)L._attachedSubEmitters[Z].dispose();if(c&&this.activeSubSystems)for(let L=this.activeSubSystems.length-1;L>=0;L-=1)this.activeSubSystems[L].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Z=0;Z<this._subEmitters.length;Z++)for(const c of this._subEmitters[Z])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(Z,c,L,N){let R;R=L instanceof gZ.c?null:L;const p=(0,V.d)("BABYLON.Texture");if(p&&R&&(Z.texture?c.particleTexture=p.Parse(Z.texture,R,N):Z.textureName&&(c.particleTexture=new p(N+Z.textureName,R,!1,void 0===Z.invertY||Z.invertY),c.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.j?Z.emitterId&&R?c.j=R.getLastMeshById(Z.emitterId):c.j=k.h.oc(Z.j):c.j=k.h.Zero(),c.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(c.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(c.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(c.billboardMode=Z.billboardMode),void 0!==Z.useLogarithmicDepth&&(c.useLogarithmicDepth=Z.useLogarithmicDepth),Z.animations){for(let L=0;L<Z.animations.length;L++){const k=Z.animations[L],N=(0,V.d)("BABYLON.Animation");N&&c.animations.push(N.Parse(k))}c.beginAnimationOnStart=Z.beginAnimationOnStart,c.beginAnimationFrom=Z.beginAnimationFrom,c.beginAnimationTo=Z.beginAnimationTo,c.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&R&&R.beginAnimation(c,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),c.startDelay=0|Z.startDelay,c.minAngularSpeed=Z.minAngularSpeed,c.maxAngularSpeed=Z.maxAngularSpeed,c.minSize=Z.minSize,c.maxSize=Z.maxSize,Z.minScaleX&&(c.minScaleX=Z.minScaleX,c.maxScaleX=Z.maxScaleX,c.minScaleY=Z.minScaleY,c.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(c.preWarmCycles=Z.preWarmCycles,c.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(c.minInitialRotation=Z.minInitialRotation,c.maxInitialRotation=Z.maxInitialRotation),c.minLifeTime=Z.minLifeTime,c.maxLifeTime=Z.maxLifeTime,c.minEmitPower=Z.minEmitPower,c.maxEmitPower=Z.maxEmitPower,c.emitRate=Z.emitRate,c.gravity=k.h.oc(Z.gravity),Z.noiseStrength&&(c.noiseStrength=k.h.oc(Z.noiseStrength)),c.color1=G.h.oc(Z.color1),c.color2=G.h.oc(Z.color2),c.colorDead=G.h.oc(Z.colorDead),c.updateSpeed=Z.updateSpeed,c.targetStopDuration=Z.targetStopDuration,c.blendMode=Z.blendMode,Z.colorGradients)for(const k of Z.colorGradients)c.addColorGradient(k.gradient,G.h.oc(k.color1),k.color2?G.h.oc(k.color2):void 0);if(Z.rampGradients){for(const L of Z.rampGradients)c.addRampGradient(L.gradient,G.d.oc(L.color));c.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(const k of Z.colorRemapGradients)c.addColorRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.alphaRemapGradients)for(const k of Z.alphaRemapGradients)c.addAlphaRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.sizeGradients)for(const k of Z.sizeGradients)c.addSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.angularSpeedGradients)for(const k of Z.angularSpeedGradients)c.addAngularSpeedGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.velocityGradients)for(const k of Z.velocityGradients)c.addVelocityGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.dragGradients)for(const k of Z.dragGradients)c.addDragGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.emitRateGradients)for(const k of Z.emitRateGradients)c.addEmitRateGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.startSizeGradients)for(const k of Z.startSizeGradients)c.addStartSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.lifeTimeGradients)for(const k of Z.lifeTimeGradients)c.addLifeTimeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(Z.limitVelocityGradients){for(const L of Z.limitVelocityGradients)c.addLimitVelocityGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2);c.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&R){const L=(0,V.d)("BABYLON.ProceduralTexture");c.noiseTexture=L.Parse(Z.noiseTexture,R,N)}let J;if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":J=new M;break;case"SphereDirectedParticleEmitter":J=new P;break;case"ConeEmitter":case"ConeParticleEmitter":J=new t;break;case"ConeDirectedParticleEmitter":J=new E;break;case"CylinderParticleEmitter":J=new x;break;case"CylinderDirectedParticleEmitter":J=new q;break;case"HemisphericParticleEmitter":J=new O;break;case"PointParticleEmitter":J=new w;break;case"MeshParticleEmitter":J=new u;break;case"CustomParticleEmitter":J=new j;break;default:J=new i}J.parse(Z.particleEmitterType,R)}else J=new i,J.parse(Z,R);c.particleEmitterType=J,c.startSpriteCellID=Z.startSpriteCellID,c.endSpriteCellID=Z.endSpriteCellID,c.spriteCellLoop=Z.spriteCellLoop??!0,c.spriteCellWidth=Z.spriteCellWidth,c.spriteCellHeight=Z.spriteCellHeight,c.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,c.spriteRandomStartCell=Z.spriteRandomStartCell,c.disposeOnStop=Z.disposeOnStop??!1,c.manualEmitCount=Z.manualEmitCount??-1}static Parse(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0;const V=Z.name;let p,J,z=null,i=null;if(c instanceof gZ.c?p=c:(J=c,p=J.getEngine()),Z.customShader&&p.createEffectForParticles){i=Z.customShader;const c=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";z=p.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,c)}const t=new Vc(V,R||Z.kL,c,z,Z.isAnimationSheetEnabled);if(t.customShader=i,t._rootUrl=L,Z.id&&(t.id=Z.id),Z.subEmitters){t.subEmitters=[];for(const k of Z.subEmitters){const Z=[];for(const N of k)Z.push(nZ.Parse(N,c,L));t.subEmitters.push(Z)}}if(Z.attractors)for(const G of Z.attractors){const Z=new Gc;Z.position=k.h.oc(G.position),Z.strength=G.strength,t.addAttractor(Z)}return Vc._Parse(Z,t,c,L),Z.textureMask&&(t.textureMask=G.h.oc(Z.textureMask)),Z.LJ&&(t.LJ=k.h.oc(Z.LJ)),Z.preventAutoStart&&(t.preventAutoStart=Z.preventAutoStart),N||t.preventAutoStart||t.start(),t}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(Vc._Serialize(c,this,Z),c.textureMask=this.textureMask.xc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.LJ=this.LJ.xc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const L of this._subEmitters){const k=[];for(const c of L)k.push(c.serialize(Z));c.subEmitters.push(k)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const Z of this._attractors)c.attractors.push(Z.serialize())}return c}static _Serialize(Z,c,L){if(Z.name=c.name,Z.id=c.id,Z.kL=c.getCapacity(),Z.disposeOnStop=c.disposeOnStop,Z.manualEmitCount=c.manualEmitCount,c.j.position){const L=c.j;Z.emitterId=L.id}else{const L=c.j;Z.j=L.xc()}c.particleEmitterType&&(Z.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(L?Z.texture=c.particleTexture.serialize():(Z.textureName=c.particleTexture.name,Z.invertY=!!c.particleTexture._invertY)),Z.isLocal=c.isLocal,I.e.AppendSerializedAnimations(c,Z),Z.beginAnimationOnStart=c.beginAnimationOnStart,Z.beginAnimationFrom=c.beginAnimationFrom,Z.beginAnimationTo=c.beginAnimationTo,Z.beginAnimationLoop=c.beginAnimationLoop,Z.startDelay=c.startDelay,Z.renderingGroupId=c.renderingGroupId,Z.isBillboardBased=c.isBillboardBased,Z.billboardMode=c.billboardMode,Z.minAngularSpeed=c.minAngularSpeed,Z.maxAngularSpeed=c.maxAngularSpeed,Z.minSize=c.minSize,Z.maxSize=c.maxSize,Z.minScaleX=c.minScaleX,Z.maxScaleX=c.maxScaleX,Z.minScaleY=c.minScaleY,Z.maxScaleY=c.maxScaleY,Z.minEmitPower=c.minEmitPower,Z.maxEmitPower=c.maxEmitPower,Z.minLifeTime=c.minLifeTime,Z.maxLifeTime=c.maxLifeTime,Z.emitRate=c.emitRate,Z.gravity=c.gravity.xc(),Z.noiseStrength=c.noiseStrength.xc(),Z.color1=c.color1.xc(),Z.color2=c.color2.xc(),Z.colorDead=c.colorDead.xc(),Z.updateSpeed=c.updateSpeed,Z.targetStopDuration=c.targetStopDuration,Z.blendMode=c.blendMode,Z.preWarmCycles=c.preWarmCycles,Z.preWarmStepOffset=c.preWarmStepOffset,Z.minInitialRotation=c.minInitialRotation,Z.maxInitialRotation=c.maxInitialRotation,Z.startSpriteCellID=c.startSpriteCellID,Z.spriteCellLoop=c.spriteCellLoop,Z.endSpriteCellID=c.endSpriteCellID,Z.spriteCellChangeSpeed=c.spriteCellChangeSpeed,Z.spriteCellWidth=c.spriteCellWidth,Z.spriteCellHeight=c.spriteCellHeight,Z.spriteRandomStartCell=c.spriteRandomStartCell,Z.isAnimationSheetEnabled=c.isAnimationSheetEnabled,Z.useLogarithmicDepth=c.useLogarithmicDepth;const k=c.getColorGradients();if(k){Z.colorGradients=[];for(const c of k){const L={gradient:c.gradient,color1:c.color1.xc()};c.color2?L.color2=c.color2.xc():L.color2=c.color1.xc(),Z.colorGradients.push(L)}}const N=c.getRampGradients();if(N){Z.rampGradients=[];for(const c of N){const L={gradient:c.gradient,color:c.color.xc()};Z.rampGradients.push(L)}Z.useRampGradients=c.useRampGradients}const R=c.getColorRemapGradients();if(R){Z.colorRemapGradients=[];for(const c of R){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.colorRemapGradients.push(L)}}const G=c.getAlphaRemapGradients();if(G){Z.alphaRemapGradients=[];for(const c of G){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.alphaRemapGradients.push(L)}}const V=c.getSizeGradients();if(V){Z.sizeGradients=[];for(const c of V){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.sizeGradients.push(L)}}const p=c.getAngularSpeedGradients();if(p){Z.angularSpeedGradients=[];for(const c of p){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.angularSpeedGradients.push(L)}}const J=c.getVelocityGradients();if(J){Z.velocityGradients=[];for(const c of J){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.velocityGradients.push(L)}}const z=c.getDragGradients();if(z){Z.dragGradients=[];for(const c of z){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.dragGradients.push(L)}}const i=c.getEmitRateGradients();if(i){Z.emitRateGradients=[];for(const c of i){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.emitRateGradients.push(L)}}const t=c.getStartSizeGradients();if(t){Z.startSizeGradients=[];for(const c of t){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.startSizeGradients.push(L)}}const E=c.getLifeTimeGradients();if(E){Z.lifeTimeGradients=[];for(const c of E){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.lifeTimeGradients.push(L)}}const x=c.getLimitVelocityGradients();if(x){Z.limitVelocityGradients=[];for(const c of x){const L={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?L.factor2=c.factor2:L.factor2=c.factor1,Z.limitVelocityGradients.push(L)}Z.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(Z.noiseTexture=c.noiseTexture.serialize())}clone(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k={...this._customWrappers};let N=null;const R=this._engine;if(R.createEffectForParticles&&null!=this.customShader){N=this.customShader;const Z=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",c=R.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,Z);k[0]?k[0].effect=c:this.setCustomEffect(c,0)}const G=this.serialize(L),V=Vc.Parse(G,this._scene||this._engine,this._rootUrl);return V.name=Z,V.customShader=N,V._customWrappers=k,void 0===c&&(c=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=c,this.preventAutoStart||V.start(),V}}Vc.BILLBOARDMODE_Y=2,Vc.BILLBOARDMODE_ALL=7,Vc.BILLBOARDMODE_STRETCHED=8,Vc.BILLBOARDMODE_STRETCHED_LOCAL=9,nZ._ParseParticleSystem=Vc.Parse;var pc=L(11592),Jc=L(11588),zc=L(11395);zc.c.prototype.createTransformFeedback=function(){const Z=this._gl.createTransformFeedback();if(!Z)throw new Error("Unable to create Transform Feedback");return Z},zc.c.prototype.deleteTransformFeedback=function(Z){this._gl.deleteTransformFeedback(Z)},zc.c.prototype.bindTransformFeedback=function(Z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Z)},zc.c.prototype.beginTransformFeedback=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Z?this._gl.POINTS:this._gl.TRIANGLES)},zc.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},zc.c.prototype.setTranformFeedbackVaryings=function(Z,c){this._gl.transformFeedbackVaryings(Z,c,this._gl.INTERLEAVED_ATTRIBS)},zc.c.prototype.bindTransformFeedbackBuffer=function(Z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z?Z.underlyingResource:null)},zc.c.prototype.readTransformFeedbackBuffer=function(Z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z)};const ic="clipPlaneFragmentDeclaration2",tc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";h.e.IncludesShadersStore[ic]||(h.e.IncludesShadersStore[ic]=tc);L(12455),L(12459),L(12464),L(12466),L(12469),L(12476),L(12480),L(12482);const Ec="gpuRenderParticlesPixelShader",xc="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";h.e.ShadersStore[Ec]||(h.e.ShadersStore[Ec]=xc);const qc="clipPlaneVertexDeclaration2",Oc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";h.e.IncludesShadersStore[qc]||(h.e.IncludesShadersStore[qc]=Oc);L(12490),L(12493),L(12495),L(12499);const wc="gpuRenderParticlesVertexShader",Mc="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";h.e.ShadersStore[wc]||(h.e.ShadersStore[wc]=Mc);class Pc extends p{static get IsSupported(){if(!a.d.LastCreatedEngine)return!1;const Z=a.d.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Z){this._maxActiveParticleCount=Math.min(Z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Z){this.maxActiveParticleCount=Z}createPointEmitter(Z,c){const L=yZ(Z,c);return this.particleEmitterType=L,L}createHemisphericEmitter(){const Z=vZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=YZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=aZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.h(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=CZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Lc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.h(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.h(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,c,L,k){const N=new i;return this.particleEmitterType=N,this.direction1=Z,this.direction2=c,this.minEmitBox=L,this.maxEmitBox=k,N}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Vc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Vc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Vc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((()=>{this.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[c])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new ZZ.d(this._engine),this._customWrappers[c].effect=Z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Z,c,L){return super._removeGradientAndTexture(Z,c,L),this._releaseBuffers(),this}addColorGradient(Z,c){this._colorGradients||(this._colorGradients=[]);const L=new K(Z,c);return this._colorGradients.push(L),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Z&&this._colorGradients.sort(((Z,c)=>Z.gradient<c.gradient?-1:Z.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var Z;null===(Z=this._drawWrappers[c].drawContext)||void 0===Z||Z.reset()}}_addFactorGradient(Z,c,L){const k=new g(c,L);Z.push(k),this._releaseBuffers()}addSizeGradient(Z,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Z,c){if(!Z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Z.sort(((Z,c)=>Z.gradient<c.gradient?-1:Z.gradient>c.gradient?1:0));const L=this;L[c]&&(L[c].dispose(),L[c]=null)}addAngularSpeedGradient(Z,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Z,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Z,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Z,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Xc=new v.b,this.onStoppedObservable=new v.b,this.onStartedObservable=new v.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,L&&"Scene"!==L.getClassName()?(this._engine=L,this.defaultProjectionMatrix=k.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=L||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.si.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,V.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,V.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ZZ.d(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers={0:new ZZ.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const G={kL:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},p=c;isFinite(p)&&(G.kL=p),this._capacity=G.kL,this._maxActiveParticleCount=G.kL,this._currentActiveCount=0,this._isAnimationSheetEnabled=R,this.particleEmitterType=new i;const J=Math.min(this._engine.getCaps().maxTextureSize,G.randomTextureSize);let z=[];for(let k=0;k<J;++k)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture=new Y.e(new Float32Array(z),J,1,5,L,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,z=[];for(let k=0;k<J;++k)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture2=new Y.e(new Float32Array(z),J,1,5,L,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(Z,c,L){const k={};k.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let N=3;k.age=c.createVertexBuffer("age",N,1,this._attributesStrideSize,!0),N+=1,k.size=c.createVertexBuffer("size",N,3,this._attributesStrideSize,!0),N+=3,k.life=c.createVertexBuffer("life",N,1,this._attributesStrideSize,!0),N+=1,N+=4,this.billboardMode===Vc.BILLBOARDMODE_STRETCHED&&(k.direction=c.createVertexBuffer("direction",N,3,this._attributesStrideSize,!0)),N+=3,this._platform.alignDataInBuffer&&(N+=1),this.particleEmitterType instanceof j&&(N+=3,this._platform.alignDataInBuffer&&(N+=1)),this._colorGradientsTexture||(k.color=c.createVertexBuffer("color",N,4,this._attributesStrideSize,!0),N+=4),this._isBillboardBased||(k.initialDirection=c.createVertexBuffer("initialDirection",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),this.noiseTexture&&(k.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1),k.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),k.angle=c.createVertexBuffer("angle",N,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?N++:N+=2,this._isAnimationSheetEnabled&&(k.cellIndex=c.createVertexBuffer("cellIndex",N,1,this._attributesStrideSize,!0),N+=1,this.spriteRandomStartCell&&(k.cellStartOffset=c.createVertexBuffer("cellStartOffset",N,1,this._attributesStrideSize,!0),N+=1)),k.offset=L.createVertexBuffer("offset",0,2),k.uv=L.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(k),this._platform.createVertexBuffers(Z,k),this.resetDrawCache()}_initialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Z)return;const c=this._engine,L=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof j&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const N=this.particleEmitterType instanceof j,R=k.d.Mc[0];let G=0;for(let k=0;k<this._capacity;k++)if(L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),N?(this.particleEmitterType.particleDestinationGenerator(k,null,R),L.push(R.x),L.push(R.y),L.push(R.z)):(L.push(0),L.push(0),L.push(0)),this._platform.alignDataInBuffer&&L.push(0),G+=16,N&&(this.particleEmitterType.particlePositionGenerator(k,null,R),L.push(R.x),L.push(R.y),L.push(R.z),this._platform.alignDataInBuffer&&L.push(0),G+=4),this._colorGradientsTexture||(L.push(0),L.push(0),L.push(0),L.push(0),G+=4),this.isBillboardBased||(L.push(0),L.push(0),L.push(0),this._platform.alignDataInBuffer&&L.push(0),G+=4),this.noiseTexture&&(L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),G+=8),L.push(0),G+=1,this._angularSpeedGradientsTexture||(L.push(0),G+=1),this._isAnimationSheetEnabled&&(L.push(0),G+=1,this.spriteRandomStartCell&&(L.push(0),G+=1)),this._platform.alignDataInBuffer){let Z=3-(G+3&3);for(G+=Z;Z-- >0;)L.push(0)}const V=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),p=this._platform.createParticleBuffer(L),J=this._platform.createParticleBuffer(L);this._buffer0=new o.e(c,p,!1,this._attributesStrideSize),this._buffer1=new o.e(c,J,!1,this._attributesStrideSize),this._spriteBuffer=new o.e(c,V,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this._flowMap&&(Z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z)),this._platform.isUpdateBufferReady()}_getWrapper(Z){const c=this._getCustomDrawWrapper(Z);if(null!==c&&void 0!==c&&c.effect)return c;const L=[];this.fillDefines(L,Z);let k=this._drawWrappers[Z];k||(k=new ZZ.d(this._engine),k.drawContext&&(k.drawContext.useInstancing=!0),this._drawWrappers[Z]=k);const N=L.join("\n");if(k.defines!==N){const Z=[],c=[],L=[];this.fillUniformsAttributesAndSamplerNames(c,Z,L),k.setEffect(this._engine.createEffect("gpuRenderParticles",Z,c,L,N),N)}return k}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=[o.g.PositionKind,"age","life","size","angle"];return Z||N.push(o.g.ColorKind),c&&N.push("cellIndex"),L||N.push("initialDirection"),k&&N.push("direction"),N.push("offset",o.g.UVKind),N}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=["emitterWM","LJ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cZ.b)(k),Z&&k.push("sheetInfos"),c&&k.push("logarithmicDepthConstant"),L&&(k.push("vFogInfos"),k.push("vFogColor")),k}fillDefines(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cZ.h)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Jc.d.FOGMODE_NONE&&Z.push("#define FOG")),c===Vc.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case Vc.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case Vc.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case Vc.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),L&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,c,L){c.push(...Pc._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Vc.BILLBOARDMODE_STRETCHED)),Z.push(...Pc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),L.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(pc.b.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),pc.b.PrepareSamplers(L,this._imageProcessingConfigurationDefines))}animate(){var Z;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Z,c){const L=this[c];if(!Z||!Z.length||L)return;const k=new Float32Array(this._rawTextureWidth);for(let N=0;N<this._rawTextureWidth;N++){const c=N/this._rawTextureWidth;y.GetCurrentGradient(c,Z,((Z,c,L)=>{k[N]=(0,J.Lerp)(Z.factor1,c.factor1,L)}))}this[c]=Y.e.CreateRTexture(k,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Z=new Uint8Array(4*this._rawTextureWidth),c=G.i.mc[0];for(let L=0;L<this._rawTextureWidth;L++){const k=L/this._rawTextureWidth;y.GetCurrentGradient(k,this._colorGradients,((k,N,R)=>{G.h.LerpToRef(k.color1,N.color1,R,c),Z[4*L]=255*c.r,Z[4*L+1]=255*c.g,Z[4*L+2]=255*c.b,Z[4*L+3]=255*c.a}))}this._colorGradientsTexture=Y.e.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Z,c){var L,N,R,G;const V=this._getWrapper(Z),p=V.effect;this._engine.enableEffect(V);const J=(null===(L=this._scene)||void 0===L?void 0:L.getViewMatrix())||k.b.IdentityReadOnly;if(p.setMatrix("view",J),p.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),p.setTexture("diffuseSampler",this.particleTexture),p.setVector2("translationPivot",this.translationPivot),p.setVector3("LJ",this.LJ),this.isLocal&&p.setMatrix("emitterWM",c),this._colorGradientsTexture?p.setTexture("colorGradientSampler",this._colorGradientsTexture):p.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();p.setFloat3("sheetInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,Z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;p.setVector3("eyePosition",Z.globalPosition)}const z=p.defines;if(this._scene&&((0,cZ.e)(p,this,this._scene),this.applyFog&&(0,LZ.d)(this._scene,void 0,p)),z.indexOf("#define BILLBOARDMODE_ALL")>=0){const Z=J.clone();Z.invert(),p.setMatrix("invView",Z)}return this.useLogarithmicDepth&&this._scene&&(0,LZ.k)(z,p,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),this._setEngineBasedOnBlendMode(Z),this._platform.bindDrawBuffers(this._targetIndex,p,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Z){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Z)if(this.j.position){Z=this.j.getWorldMatrix()}else{const c=this.j;Z=k.d.Matrix[0],k.b.TranslationToRef(c.x,c.y,c.z,Z)}const c=this._engine,L=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Z=this.XZ();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const N=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=N,c.setDepthWrite(L)}render(){let Z,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Z=0|this._accumulatedCount;this._accumulatedCount-=Z,this._currentActiveCount+=Z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){Z=this.j.getWorldMatrix()}else{const c=this.j;Z=k.d.Matrix[0],k.b.TranslationToRef(c.x,c.y,c.z,Z)}const N=this._engine;this.updateInAnimate||this._update(Z);let R=0;return c||L||(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0),R=this.blendMode===Vc.BLENDMODE_MULTIPLYADD?this._render(Vc.BLENDMODE_MULTIPLY,Z)+this._render(Vc.BLENDMODE_ADD,Z):this._render(this.blendMode,Z),this._engine.setAlphaMode(0)),R}rebuild(){const Z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const Z=this._scene.si.indexOf(this);Z>-1&&this._scene.si.splice(Z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const Z=this._renderVertexBuffers[c];for(const c in Z)Z[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Xc.notifyObservers(this),this.Xc.clear()}clone(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k={...this._customWrappers};let N=null;const R=this._engine;if(R.createEffectForParticles&&null!=this.customShader){N=this.customShader;const Z=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";k[0]=R.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,Z,void 0,void 0,void 0,this)}const G=this.serialize(L),V=Pc.Parse(G,this._scene||this._engine,this._rootUrl);return V.name=Z,V.customShader=N,V._customWrappers=k,void 0===c&&(c=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=c,V}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return Vc._Serialize(c,this,Z),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const R=Z.name;let G,V;c instanceof gZ.c?G=c:(V=c,G=V.getEngine());const p=new Pc(R,{kL:N||Z.kL,randomTextureSize:Z.randomTextureSize},c,null,Z.isAnimationSheetEnabled);if(p._rootUrl=L,Z.customShader&&G.createEffectForParticles){const c=Z.customShader,L=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",k=G.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,L,void 0,void 0,void 0,p);p.setCustomEffect(k,0),p.customShader=c}return Z.id&&(p.id=Z.id),Z.activeParticleCount&&(p.activeParticleCount=Z.activeParticleCount),Vc._Parse(Z,p,c,L),Z.preventAutoStart&&(p.preventAutoStart=Z.preventAutoStart),k||p.preventAutoStart||p.start(),p}}var jc=L(11038),oc=L(12508),uc=L(11708);class Xc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.j=Z;this._emitterNode=Z}setEmitterAsSphere(Z,c,L){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:c};const k=(0,oc.b)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},L);k.renderingGroupId=c;const N=new uc.c("emitterSphereMaterial",L);N.emissiveColor=Z.color,k.material=N;for(const R of this.systems)R.j=k;this._emitterNode=k}start(Z){for(const c of this.systems)Z&&(c.j=Z),c.start()}dispose(){for(const Z of this.systems)Z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const L of this.systems)c.systems.push(L.serialize(Z));return this._emitterNode&&(c.j=this._emitterCreationOptions),c}static Parse(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;const N=new Xc,R=this.BaseAssetsUrl+"/textures/";c=c||a.d.LastCreatedScene;for(const G of Z.systems)N.systems.push(L?Pc.Parse(G,c,R,!0,k):Vc.Parse(G,c,R,!0,k));if(Z.j){const L=Z.j.options;if("Sphere"===Z.j.kind)N.setEmitterAsSphere({diameter:L.diameter,segments:L.segments,color:G.d.oc(L.color)},Z.j.renderingGroupId,c)}return N}}Xc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var hc=L(11079);class Bc{static CreateDefault(Z){let c,L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,k=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Pc("default system",{kL:L},k):new Vc("default system",L,k),c.j=Z;const N=jc.c.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new d.c(N,c.XZ()),c.createConeEmitter(.1,Math.PI/4),c.color1=new G.h(1,1,1,1),c.color2=new G.h(1,1,1,1),c.colorDead=new G.h(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;c||(c=a.d.LastCreatedScene);const N={};return c.addPendingData(N),new Promise(((R,G)=>{if(L&&!Pc.IsSupported)return c.removePendingData(N),G("Particle system with GPU is not supported.");jc.c.LoadFile(`${Bc.BaseAssetsUrl}/systems/${Z}.json`,(Z=>{c.removePendingData(N);const G=JSON.parse(Z.toString());return R(Xc.Parse(G,c,L,k))}),void 0,void 0,void 0,(()=>(c.removePendingData(N),G(`An error occurred with the creation of your particle system. Check if your type '${Z}' exists.`))))}))}static ExportSet(Z){const c=new Xc;for(const L of Z)c.systems.push(L);return c}static ParseFromFileAsync(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",R=arguments.length>5?arguments[5]:void 0;return new Promise(((G,V)=>{const p=new hc.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const c=JSON.parse(p.responseText);let V;V=k?Pc.Parse(c,L,N,!1,R):Vc.Parse(c,L,N,!1,R),Z&&(V.name=Z),G(V)}else V("Unable to load the particle system")})),p.open("GET",c),p.send()}))}static ParseFromSnippetAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Z){const Z=this.CreateDefault(null);return Z.start(),Promise.resolve(Z)}return new Promise(((R,G)=>{const V=new hc.b;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const G=JSON.parse(JSON.parse(V.responseText).jsonPayload),p=JSON.parse(G.particleSystem);let J;J=L?Pc.Parse(p,c,k,!1,N):Vc.Parse(p,c,k,!1,N),J.snippetId=Z,R(J)}else G("Unable to load the snippet "+Z)})),V.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),V.send()}))}}Bc.BaseAssetsUrl=Xc.BaseAssetsUrl,Bc.SnippetUrl="https://snippet.babylonjs.com",Bc.CreateFromSnippetAsync=Bc.ParseFromSnippetAsync;var Dc=L(11325),ec=L(11386),Hc=L(12514);(0,Hc.f)(ec.c.NAME_PARTICLESYSTEM,((Z,c,L,k)=>{const N=(0,Hc.g)(ec.c.NAME_PARTICLESYSTEM);if(N&&void 0!==Z.si&&null!==Z.si)for(let R=0,G=Z.si.length;R<G;R++){const G=Z.si[R];L.si.push(N(G,c,k))}})),(0,Hc.b)(ec.c.NAME_PARTICLESYSTEM,((Z,c,L)=>{if(Z.activeParticleCount){return Pc.Parse(Z,c,L)}return Vc.Parse(Z,c,L)})),gZ.c.prototype.createEffectForParticles=function(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",R=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,z=arguments.length>9?arguments[9]:void 0,i=[],t=[];const E=[];return p?p.fillUniformsAttributesAndSamplerNames(t,i,E):(i=Vc._GetAttributeNamesOrOptions(),t=Vc._GetEffectCreationOptions()),-1===N.indexOf(" BILLBOARD")&&(N+="\n#define BILLBOARD\n"),null!==p&&void 0!==p&&p.isAnimationSheetEnabled&&-1===N.indexOf(" ANIMATESHEET")&&(N+="\n#define ANIMATESHEET\n"),-1===k.indexOf("diffuseSampler")&&k.push("diffuseSampler"),this.createEffect({vertex:z??(null===p||void 0===p?void 0:p.vertexShaderName)??"particles",fragmentElement:Z},i,t.concat(c),E.concat(k),N,R,G,V,void 0,J,(async()=>{0===J?await Promise.resolve().then(L.bind(L,12544)):await Promise.resolve().then(L.bind(L,12602))}))},Dc.c.prototype.getEmittedParticleSystems=function(){const Z=[];for(let c=0;c<this.XZ().si.length;c++){const L=this.XZ().si[c];L.j===this&&Z.push(L)}return Z},Dc.c.prototype.getHierarchyEmittedParticleSystems=function(){const Z=[],c=this.getDescendants();c.push(this);for(let L=0;L<this.XZ().si.length;L++){const k=this.XZ().si[L],N=k.j;N.position&&-1!==c.indexOf(N)&&Z.push(k)}return Z};L(11205),L(11219),L(11282);L(11289),L(12517),L(11312),L(11185),L(11380);L(11464);var lc;L(12522),L(11487);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(lc||(lc={}));var Wc=L(11503);const Tc=new k.h(0,0,0),Ic=new k.h(0,0,0),dc=new k.h(0,0,0);class Qc{constructor(Z,c,L){this.width=Z,this.height=c,this.data=L}processFlowable(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;if(!L)return;L instanceof k.b?k.h.TransformCoordinatesToRef(Z.position,L,dc):(dc.x=L.x,dc.y=L.y,dc.z=L.z);const N=.5*dc.x+.5,R=1-(.5*dc.y+.5),G=Math.floor(N*this.width),V=Math.floor(R*this.height);if(G<0||G>=this.width||V<0||V>=this.height)return;const p=4*(V*this.width+G),J=this.data[p]/255*2-1,z=this.data[p+1]/255*2-1,i=this.data[p+2]/255*2-1,t=this.data[p+3]/255;Tc.set(J,z,i),Tc.scaleToRef(c*t,Ic),Z.direction.addInPlace(Ic)}_processParticle(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;this.processFlowable(Z,c,L)}static async FromUrlAsync(Z){return await new Promise(((c,L)=>{const k=document.createElement("canvas"),N=k.getContext("2d");let R=null;const G=new Image;G.crossOrigin="anonymous",G.src=Z,G.onerror=c=>{L(new Error(`Failed to load image: ${Z} : ${c}`))},G.onload=()=>{k.width=G.width,k.height=G.height,N.drawImage(G,0,0),R=N.getImageData(0,0,k.width,k.height),c(new Qc(k.width,k.height,R.data))}}))}static async ExtractFromTextureAsync(Z){return await new Promise(((c,L)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{const L=await this.ExtractFromTextureAsync(Z);c(L)}catch(k){L(k)}}));const k=Z.getSize();Wc.n.GetTextureDataAsync(Z,k.width,k.height).then((Z=>{c(new Qc(k.width,k.height,new Uint8ClampedArray(Z)))})).catch(L)}))}}var rc,fc,Sc,sc,mc,Ac,bc,Fc,Uc;!function(Z){Z[Z.Int=1]="Int",Z[Z.Float=2]="Float",Z[Z.Vector2=4]="Vector2",Z[Z.Mc=8]="Mc",Z[Z.Matrix=16]="Matrix",Z[Z.Particle=32]="Particle",Z[Z.Texture=64]="Texture",Z[Z.mc=128]="mc",Z[Z.FloatGradient=256]="FloatGradient",Z[Z.Vector2Gradient=512]="Vector2Gradient",Z[Z.Vector3Gradient=1024]="Vector3Gradient",Z[Z.Color4Gradient=2048]="Color4Gradient",Z[Z.System=4096]="System",Z[Z.AutoDetect=8192]="AutoDetect",Z[Z.BasedOnInput=16384]="BasedOnInput",Z[Z.Undefined=32768]="Undefined",Z[Z.All=65535]="All"}(rc||(rc={})),function(Z){Z[Z.Compatible=0]="Compatible",Z[Z.TypeIncompatible=1]="TypeIncompatible",Z[Z.HierarchyIssue=2]="HierarchyIssue"}(fc||(fc={})),function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(Sc||(Sc={}));class Kc{get direction(){return this._direction}get type(){if(this._type===rc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===rc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Z){this._type=Z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Z=>Z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Z,c,L){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=rc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new v.b,this.onDisconnectionObservable=new v.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=Z,this._direction=L}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Z){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(Z):this._connectedPoint._storedValue:this.value}canConnectTo(Z){return 0===this.checkCompatibilityState(Z)}checkCompatibilityState(Z){const c=this._ownerBlock,L=Z.ownerBlock;if(this.type!==Z.type&&Z.innerType!==rc.AutoDetect)return Z.acceptedConnectionPointTypes&&-1!==Z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Z.excludedConnectionPointTypes&&-1!==Z.excludedConnectionPointTypes.indexOf(this.type))return 1;let k=L,N=c;return 0===this.direction&&(k=c,N=L),k.isAnAncestorOf(N)?2:0}connectTo(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Z.ownerBlock.name}".${Z.name}`;return this._endpoints.push(Z),Z._connectedPoint=this,this.onConnectionObservable.notifyObservers(Z),Z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Z){const c=this._endpoints.indexOf(Z);return-1===c||(this._endpoints.splice(c,1),Z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Z),Z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Z){let c=1;for(;c<rc.All;)Z&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.xc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.xc()):(c.valueType="number",c.value=this.value)),Z&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class nc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Z){this._name=Z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new v.b,this.Xc=new v.b,this.onInputChangedObservable=new v.b,this.visibleOnFrame=!1,this._name=Z,this.uniqueId=Q.b.UniqueId}_inputRename(Z){return Z}_outputRename(Z){return Z}isAnAncestorOf(Z){for(const c of this._outputs)if(c.hasEndpoints)for(const L of c.endpoints){if(L.ownerBlock===Z)return!0;if(L.ownerBlock.isAnAncestorOf(Z))return!0}return!1}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const L of c.endpoints)if(L.ownerBlock.isAnAncestorOfType(Z))return!0;return!1}getInputByName(Z){const c=this._inputs.filter((c=>c.name===Z));return c.length?c[0]:null}_linkConnectionTypes(Z,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[Z]:(this._inputs[Z]._linkedConnectionSource=this._inputs[c],this._inputs[Z]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[Z]}registerInput(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0;const G=new Kc(Z,this,0);return G.type=c,G.isOptional=L,G.defaultValue=k,G.value=k,G.valueMin=N,G.valueMax=R,this._inputs.push(G),this.onInputChangedObservable.notifyObservers(G),this}registerOutput(Z,c,L){return(L=L??new Kc(Z,this,1)).type=c,this._outputs.push(L),this}_build(Z){}_customBuildStep(Z){}build(Z){if(this._buildId===Z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Z=>Z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Z.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||Z.notConnectedNonOptionalInputs.push(c);continue}const L=c.connectedPoint.ownerBlock;L&&L!==this&&!L.isSystem&&L.build(Z)}return this._customBuildStep(Z),Z.verbose&&r.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Z={};Z.customType="BABYLON."+this.getClassName(),Z.id=this.uniqueId,Z.name=this.name,Z.visibleOnFrame=this.visibleOnFrame,Z.inputs=[],Z.outputs=[];for(const c of this.inputs)Z.inputs.push(c.serialize());for(const c of this.outputs)Z.outputs.push(c.serialize(!1));return Z}_deserialize(Z){this._name=Z.name,this.comments=Z.comments,this.visibleOnFrame=!!Z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Z)}_deserializePortDisplayNamesAndExposedOnFrame(Z){const c=Z.inputs,L=Z.outputs;if(c)for(const k of c){const Z=this.inputs.find((Z=>Z.name===k.name));if(!Z)return;if(k.displayName&&(Z.displayName=k.displayName),k.isExposedOnFrame&&(Z.isExposedOnFrame=k.isExposedOnFrame,Z.exposedPortPosition=k.exposedPortPosition),void 0!==k.value&&null!==k.value)if("number"===k.valueType)Z.value=k.value;else{const c=(0,V.d)(k.valueType);c&&(Z.value=c.oc(k.value))}}if(L)for(let k=0;k<L.length;k++){const Z=L[k];Z.displayName&&(this.outputs[k].displayName=Z.displayName),Z.isExposedOnFrame&&(this.outputs[k].isExposedOnFrame=Z.isExposedOnFrame,this.outputs[k].exposedPortPosition=Z.exposedPortPosition)}}clone(){const Z=this.serialize(),c=(0,V.d)(Z.customType);if(c){const L=new c;return L._deserialize(Z),L}return null}dispose(){this.Xc.notifyObservers(this),this.Xc.clear();for(const Z of this.inputs)Z.dispose();for(const Z of this.outputs)Z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function gc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",k=arguments.length>3?arguments[3]:void 0;return(N,R)=>{let G=N._propStore;G||(G=[],N._propStore=G),G.push({propertyName:R,displayName:Z,type:c,groupName:L,options:k??{},className:N.getClassName()})}}(0,W.d)([(0,T.H)("comment")],nc.prototype,"comments",void 0),function(Z){Z[Z.Boolean=0]="Boolean",Z[Z.Float=1]="Float",Z[Z.Int=2]="Int",Z[Z.Vector2=3]="Vector2",Z[Z.List=4]="List",Z[Z.mc=5]="mc",Z[Z.SamplingMode=6]="SamplingMode",Z[Z.TextureFormat=7]="TextureFormat",Z[Z.TextureType=8]="TextureType"}(sc||(sc={})),function(Z){Z[Z.None=0]="None",Z[Z.Position=1]="Position",Z[Z.Direction=2]="Direction",Z[Z.Age=3]="Age",Z[Z.Lifetime=4]="Lifetime",Z[Z.Color=5]="Color",Z[Z.ScaledDirection=6]="ScaledDirection",Z[Z.Scale=7]="Scale",Z[Z.AgeGradient=8]="AgeGradient",Z[Z.Angle=9]="Angle",Z[Z.SpriteCellIndex=16]="SpriteCellIndex",Z[Z.SpriteCellStart=17]="SpriteCellStart",Z[Z.SpriteCellEnd=18]="SpriteCellEnd"}(mc||(mc={})),function(Z){Z[Z.None=0]="None",Z[Z.Time=1]="Time",Z[Z.Delta=2]="Delta",Z[Z.Emitter=3]="Emitter"}(Ac||(Ac={}));class yc{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Z="";for(const c of this.notConnectedNonOptionalInputs)Z+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Z)throw"Build of Node Particle System Set failed:\n"+Z}adapt(Z,c){const L=Z.getConnectedValue(this)||0;if(Z.type===c)return L;switch(c){case rc.Vector2:return new k.f(L,L);case rc.Mc:return new k.h(L,L,L);case rc.mc:return new G.h(L,L,L,L)}return null}getContextualValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case mc.Position:return this.particleContext.position;case mc.Direction:return this.particleContext.direction;case mc.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case mc.Color:return this.particleContext.color;case mc.Age:return this.particleContext.age;case mc.Lifetime:return this.particleContext.lifeTime;case mc.Angle:return this.particleContext.angle;case mc.Scale:return this.particleContext.scale;case mc.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case mc.SpriteCellEnd:return this.systemContext.endSpriteCellID;case mc.SpriteCellIndex:return this.particleContext.cellIndex;case mc.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case Ac.Time:return this.systemContext._actualFrame;case Ac.Delta:return this.systemContext._scaledUpdateSpeed;case Ac.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function vc(Z,c,L){const k=new yc;k.LL=c;const N=Z.createSystem(k);return N.canStart=()=>!0,N.j=L.clone(),N.disposeOnStop=!0,N.start(),N}class Yc extends nc{constructor(Z){super(Z),this.blendMode=p.BLENDMODE_ONEONE,this.kL=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",rc.Particle),this.registerInput("texture",rc.Texture),this.registerInput("onStart",rc.System,!0),this.registerInput("onEnd",rc.System,!0),this.registerOutput("system",rc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Z){Z.kL=this.kL,Z.buildId=this._buildId++,this.build(Z);const c=this.particle.getConnectedValue(Z);return c.particleTexture=this.texture.getConnectedValue(Z),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((L=>{const k=this.onStart.getConnectedValue(Z);k&&L.onStartedObservable.addOnce((()=>{Z.systemContext=c;const L=vc(k,Z.LL,Z.emitterPosition);this.Xc.addOnce((()=>{L.dispose()}))}));const N=this.onEnd.getConnectedValue(Z);N&&L.onStoppedObservable.addOnce((()=>{Z.systemContext=c;const L=vc(N,Z.LL,Z.emitterPosition);this.Xc.addOnce((()=>{L.dispose()}))}))})),this.Xc.addOnce((()=>{c.dispose()})),c}serialize(){const Z=super.serialize();return Z.kL=this.kL,Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.doNoStart=this.doNoStart,Z.targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,Z}_deserialize(Z){super._deserialize(Z),this.kL=Z.kL,this.emitRate=Z.emitRate,this.doNoStart=!!Z.doNoStart,void 0!==Z.blendMode&&(this.blendMode=Z.blendMode),void 0!==Z.targetStopDuration&&(this.targetStopDuration=Z.targetStopDuration),void 0!==Z.startDelay&&(this.startDelay=Z.startDelay)}}(0,W.d)([gc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:p.BLENDMODE_ONEONE},{label:"Standard",value:p.BLENDMODE_STANDARD},{label:"Add",value:p.BLENDMODE_ADD},{label:"Multiply",value:p.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:p.BLENDMODE_MULTIPLYADD}]})],Yc.prototype,"blendMode",void 0),(0,W.d)([gc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Yc.prototype,"kL",void 0),(0,W.d)([gc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yc.prototype,"emitRate",void 0),(0,W.d)([gc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yc.prototype,"targetStopDuration",void 0),(0,W.d)([gc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yc.prototype,"startDelay",void 0),(0,W.d)([gc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Yc.prototype,"doNoStart",void 0),(0,V.g)("BABYLON.SystemBlock",Yc);class ac extends nc{get type(){if(this._type===rc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=rc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=rc.Vector2,this._type;case"Mc":return this._type=rc.Mc,this._type;case"mc":return this._type=rc.mc,this._type;case"Matrix":return this._type=rc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===mc.None&&this._systemSource!==Ac.None}get systemSource(){return this._systemSource}set systemSource(Z){if(this._systemSource=Z,Z!==Ac.None){switch(this._contextualSource=mc.None,this._type=rc.Float,Z){case Ac.Time:case Ac.Delta:this._type=rc.Float;break;case Ac.Emitter:this._type=rc.Mc}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==mc.None}get contextualValue(){return this._contextualSource}set contextualValue(Z){if(this._contextualSource=Z,Z!==mc.None){switch(this._systemSource=Ac.None,Z){case mc.Scale:this._type=rc.Vector2;break;case mc.Position:case mc.Direction:case mc.ScaledDirection:this._type=rc.Mc;break;case mc.Color:this._type=rc.mc;break;case mc.Age:case mc.Lifetime:case mc.Angle:case mc.AgeGradient:this._type=rc.Float;break;case mc.SpriteCellEnd:case mc.SpriteCellStart:case mc.SpriteCellIndex:this._type=rc.Int}this.output&&(this.output.type=this._type)}}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rc.AutoDetect;super(Z),this._type=rc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new v.b,this._systemSource=Ac.None,this._contextualSource=mc.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(Z){this.type===rc.Float&&this.min!==this.max&&(Z=Math.max(this.min,Z),Z=Math.min(this.max,Z)),this._storedValue=Z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Z){this._valueCallback=Z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case rc.Int:case rc.Float:this.value=0;break;case rc.Vector2:this.value=k.f.Zero();break;case rc.Mc:this.value=k.h.Zero();break;case rc.mc:this.value=new G.h(1,1,1,1);break;case rc.Matrix:this.value=k.b.Identity()}}_build(Z){super._build(Z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Z=super.serialize();return Z.type=this.type,Z.contextualValue=this.contextualValue,Z.systemSource=this.systemSource,Z.min=this.min,Z.max=this.max,Z.groupInInspector=this.groupInInspector,Z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.xc?(Z.valueType="BABYLON."+this._storedValue.getClassName(),Z.value=this._storedValue.xc()):(Z.valueType="number",Z.value=this._storedValue)),Z}_deserialize(Z){if(super._deserialize(Z),this._type=Z.type,this.contextualValue=Z.contextualValue,this.systemSource=Z.systemSource||Ac.None,this.min=Z.min||0,this.max=Z.max||0,this.groupInInspector=Z.groupInInspector||"",void 0!==Z.displayInInspector&&(this.displayInInspector=Z.displayInInspector),Z.valueType)if("number"===Z.valueType)this._storedValue=Z.value;else{const c=(0,V.d)(Z.valueType);c&&(this._storedValue=c.oc(Z.value))}}}(0,V.g)("BABYLON.ParticleInputBlock",ac);class Cc extends nc{get url(){return this._url}set url(Z){this._url!==Z&&(this._cachedData=null,this._url=Z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Z){this._textureDataUrl!==Z&&(this._cachedData=null,this._textureDataUrl=Z,this._url="",this._sourceTexture=null)}set sourceTexture(Z){this._sourceTexture!==Z&&(this._cachedData=null,this._sourceTexture=Z,this._url="",this._textureDataUrl="")}constructor(Z){super(Z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",rc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Z=this.texture._storedValue;return await new Promise(((c,L)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(Z){L(Z)}}));const k=Z.getSize();Wc.n.GetTextureDataAsync(Z,k.width,k.height).then((L=>{this._cachedData={width:k.width,height:k.height,data:new Uint8ClampedArray(L)},Z.dispose(),c(this._cachedData)})).catch(L)}))}_build(Z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new d.c(this._textureDataUrl,Z.LL):this.texture._storedValue=new d.c(this._url,Z.LL):this.texture._storedValue=null}serialize(){const Z=super.serialize();return Z.url=this.url,Z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Z.textureDataUrl=this.textureDataUrl),Z}_deserialize(Z){super._deserialize(Z),this.url=Z.url,this.serializedCachedData=!!Z.serializedCachedData,Z.textureDataUrl&&(this.textureDataUrl=Z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,V.g)("BABYLON.ParticleTextureSourceBlock",Cc);class ZL extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("position",rc.Mc),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.position.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.position.R(this.position.getConnectedValue(Z))},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}}(0,V.g)("BABYLON.UpdatePositionBlock",ZL),function(Z){Z[Z.Add=0]="Add",Z[Z.Subtract=1]="Subtract",Z[Z.Multiply=2]="Multiply",Z[Z.Divide=3]="Divide",Z[Z.Max=4]="Max",Z[Z.Min=5]="Min"}(bc||(bc={}));class cL extends nc{constructor(Z){super(Z),this.operation=bc.Add,this.registerInput("left",rc.AutoDetect),this.registerInput("right",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[rc.Matrix,rc.Particle,rc.Texture,rc.System,rc.FloatGradient,rc.Color4Gradient,rc.Vector2Gradient,rc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Z){let c;const L=this.left,N=this.right;if(!L.isConnected||!N.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const R=L.type===rc.Float||L.type===rc.Int,V=N.type===rc.Float||N.type===rc.Int,p=R&&V;switch(this.operation){case bc.Add:c=p?Z=>L.getConnectedValue(Z)+N.getConnectedValue(Z):R?Z=>Z.adapt(L,N.type).add(N.getConnectedValue(Z)):Z=>L.getConnectedValue(Z).add(Z.adapt(N,L.type));break;case bc.Subtract:c=p?Z=>L.getConnectedValue(Z)-N.getConnectedValue(Z):R?Z=>Z.adapt(L,N.type).yL(N.getConnectedValue(Z)):Z=>L.getConnectedValue(Z).yL(Z.adapt(N,L.type));break;case bc.Multiply:c=p?Z=>L.getConnectedValue(Z)*N.getConnectedValue(Z):R?Z=>Z.adapt(L,N.type).multiply(N.getConnectedValue(Z)):Z=>L.getConnectedValue(Z).multiply(Z.adapt(N,L.type));break;case bc.Divide:c=p?Z=>L.getConnectedValue(Z)/N.getConnectedValue(Z):R?Z=>Z.adapt(L,N.type).divide(N.getConnectedValue(Z)):Z=>L.getConnectedValue(Z).divide(Z.adapt(N,L.type));break;case bc.Min:if(p)c=Z=>Math.min(L.getConnectedValue(Z),N.getConnectedValue(Z));else{const[Z,V]=R?[N,L]:[L,N];switch(Z.type){case rc.Vector2:c=c=>k.f.Minimize(Z.getConnectedValue(c),c.adapt(V,Z.type));break;case rc.Mc:c=c=>k.h.Minimize(Z.getConnectedValue(c),c.adapt(V,Z.type));break;case rc.mc:c=c=>{const L=Z.getConnectedValue(c),{r:k,g:N,b:R,a:p}=c.adapt(V,Z.type);return new G.h(Math.min(L.r,k),Math.min(L.g,N),Math.min(L.b,R),Math.min(L.a,p))}}}break;case bc.Max:if(!p){const[Z,V]=R?[N,L]:[L,N];switch(Z.type){case rc.Vector2:c=c=>k.f.Maximize(Z.getConnectedValue(c),c.adapt(V,Z.type));break;case rc.Mc:c=c=>k.h.Maximize(Z.getConnectedValue(c),c.adapt(V,Z.type));break;case rc.mc:c=c=>{const L=Z.getConnectedValue(c),{r:k,g:N,b:R,a:p}=c.adapt(V,Z.type);return new G.h(Math.max(L.r,k),Math.min(L.g,N),Math.min(L.b,R),Math.min(L.a,p))}}break}c=Z=>Math.max(L.getConnectedValue(Z),N.getConnectedValue(Z))}this.output._storedFunction=Z=>L.type===rc.Int?0|c(Z):c(Z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===rc.Int||this.left.type===rc.Float&&this.right.type!==rc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Z,c]of[[this.left,this.right],[this.right,this.left]])Z.acceptedConnectionPointTypes=[rc.Int,rc.Float],c.isConnected&&(Z.acceptedConnectionPointTypes.push(c.type),c.type!==rc.Int&&c.type!==rc.Float||Z.acceptedConnectionPointTypes.push(rc.Vector2,rc.Mc,rc.mc))}dispose(){super.dispose();for(const Z of this._connectionObservers)Z.remove();this._connectionObservers.length=0}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,W.d)([gc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:bc.Add},{label:"Subtract",value:bc.Subtract},{label:"Multiply",value:bc.Multiply},{label:"Divide",value:bc.Divide},{label:"Max",value:bc.Max},{label:"Min",value:bc.Min}]})],cL.prototype,"operation",void 0),(0,V.g)("BABYLON.ParticleMathBlock",cL);class LL extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("direction1",rc.Mc,!0,new k.h(0,1,0)),this.registerInput("direction2",rc.Mc,!0,new k.h(0,1,0)),this.registerInput("minEmitBox",rc.Mc,!0,new k.h(-.5,-.5,-.5)),this.registerInput("maxEmitBox",rc.Mc,!0,new k.h(.5,.5,.5)),this.registerOutput("output",rc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const c=this.particle.getConnectedValue(Z);c._directionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.direction1.getConnectedValue(Z),R=this.direction2.getConnectedValue(Z),G=(0,J.RandomRange)(N.x,R.x),V=(0,J.RandomRange)(N.y,R.y),p=(0,J.RandomRange)(N.z,R.z);Z.isEmitterTransformNode?k.h.TransformNormalFromFloatsToRef(G,V,p,Z.emitterWorldMatrix,L.direction):L.direction.wc(G,V,p)},c._positionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.minEmitBox.getConnectedValue(Z),R=this.maxEmitBox.getConnectedValue(Z),G=(0,J.RandomRange)(N.x,R.x),V=(0,J.RandomRange)(N.y,R.y),p=(0,J.RandomRange)(N.z,R.z);Z.isEmitterTransformNode?k.h.TransformCoordinatesFromFloatsToRef(G,V,p,Z.emitterWorldMatrix,L.position):(L.position.wc(G,V,p),L.position.addInPlace(Z.emitterPosition))},this.output._storedValue=c}}(0,V.g)("BABYLON.BoxShapeBlock",LL);class kL extends nc{constructor(Z){super(Z),this.registerInput("emitPower",rc.Float,!0,1),this.registerInput("lifeTime",rc.Float,!0,1),this.registerInput("color",rc.mc,!0,new G.h(1,1,1,1)),this.registerInput("scale",rc.Vector2,!0,new k.f(1,1)),this.registerInput("angle",rc.Float,!0,0),this.registerOutput("particle",rc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Z){const c=new Vc(this.name,Z.kL,Z.LL,null,!1,void 0,!0);c.particleEmitterType=new w,c._lifeTimeCreation.process=(c,L)=>{Z.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(Z),L._emitPower=this.emitPower.getConnectedValue(Z)},c._colorCreation.process=c=>{Z.particleContext=c,c.color.R(this.color.getConnectedValue(Z))},c._sizeCreation.process=c=>{Z.particleContext=c,c.size=1,c.scale.R(this.scale.getConnectedValue(Z))},c._angleCreation.process=c=>{Z.particleContext=c,c.angle=this.angle.getConnectedValue(Z)},this.particle._storedValue=c}}(0,V.g)("BABYLON.CreateParticleBlock",kL);class NL{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Z=[];for(const c of this.attachedBlocks)c.isInput&&Z.push(c);return Z}constructor(Z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new v.b,this.name=Z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Z)&&this.attachedBlocks.push(Z);for(const L of Z.inputs){const k=L.connectedPoint;if(k){const L=k.ownerBlock;L!==Z&&this._initializeBlock(L,c)}}}async buildAsync(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((L=>{const k=new Xc;for(const Z of this._systemBlocks)this._initializeBlock(Z);for(const N of this.systemBlocks){const L=new yc;L.buildId=this._buildId++,L.LL=Z,L.verbose=c;const R=N.createSystem(L);L.emitErrors(),k.systems.push(R)}this.onBuildObservable.notifyObservers(this),L(k)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Z=new Yc("Particle system"),c=new ZL("Update position");c.output.connectTo(Z.particle);const L=new ac("Position");L.contextualValue=mc.Position;const k=new ac("Scaled direction");k.contextualValue=mc.ScaledDirection;const N=new cL("Add");N.operation=bc.Add,L.output.connectTo(N.left),k.output.connectTo(N.right),N.output.connectTo(c.position);const R=new kL("Create particle"),G=new LL("Box shape");R.particle.connectTo(G.particle),G.output.connectTo(c.particle);const V=new Cc("Texture");V.texture.connectTo(Z.texture),V.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Z)}removeBlock(Z){const c=this.attachedBlocks.indexOf(Z);if(c>-1&&this.attachedBlocks.splice(c,1),Z.isSystem){const c=this._systemBlocks.indexOf(Z);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const L={};for(const k of Z.Zz){const Z=(0,V.d)(k.customType);if(Z){const c=new Z;c._deserialize(k),L[k.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const k of this.attachedBlocks)if(k.isTeleportOut){const Z=k,c=Z._tempEntryPointUniqueId;if(c){const k=L[c];k&&k.attachToEndpoint(Z)}}for(let k=0;k<Z.Zz.length;k++){const N=Z.Zz[k],R=L[N.id];R&&(R.inputs.length&&N.inputs.some((Z=>Z.targetConnectionName))&&!c||this._restoreConnections(R,Z,L))}if(Z.locations||Z.editorData&&Z.editorData.locations){const k=Z.locations||Z.editorData.locations;for(const Z of k)L[Z.CN]&&(Z.CN=L[Z.CN].uniqueId);c&&this.editorData&&this.editorData.locations&&k.concat(this.editorData.locations),Z.locations?this.editorData={locations:k}:(this.editorData=Z.editorData,this.editorData.locations=k);const N=[];for(const Z in L)N[Z]=L[Z].uniqueId;this.editorData.map=N}this.comment=Z.comment}_restoreConnections(Z,c,L){for(const k of Z.outputs)for(const N of c.Zz){const R=L[N.id];if(R)for(const G of N.inputs)if(L[G.targetBlockId]!==Z||G.targetConnectionName!==k.name);else{const Z=R.getInputByName(G.inputName);if(!Z||Z.isConnected)continue;k.connectTo(Z,!0),this._restoreConnections(R,c,L)}}}serialize(Z){const c=Z?{}:I.e.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let L=[];Z?L=Z:c.customType="BABYLON.NodeParticleSystemSet",c.Zz=[];for(const k of L)c.Zz.push(k.serialize());if(!Z)for(const k of this.attachedBlocks)-1===L.indexOf(k)&&c.Zz.push(k.serialize());return c}dispose(){for(const Z of this.attachedBlocks)Z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Z){const c=new NL(Z);return c.setToDefault(),c}static Parse(Z){const c=I.e.Parse((()=>new NL(Z.name)),Z,null);return c.parseSerializedObject(Z),c}static ParseFromSnippetAsync(Z,c){return"_BLANK"===Z?Promise.resolve(NL.CreateDefault("blank")):new Promise(((L,k)=>{const N=new hc.b;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const G=JSON.parse(JSON.parse(N.responseText).jsonPayload),V=JSON.parse(G.nodeParticle);c||(c=I.e.Parse((()=>new NL(Z)),V,null)),c.parseSerializedObject(V),c.snippetId=Z;try{L(c)}catch(R){k(R)}}else k("Unable to load the snippet "+Z)})),N.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),N.send()}))}}NL.EditorURL=`${jc.c._DefaultCdnUrl}/v${gZ.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,NL.SnippetUrl="https://snippet.babylonjs.com",(0,W.d)([(0,T.H)()],NL.prototype,"name",void 0),(0,W.d)([(0,T.H)("comment")],NL.prototype,"comment",void 0),function(Z){Z[Z.None=0]="None",Z[Z.PerParticle=1]="PerParticle",Z[Z.PerSystem=2]="PerSystem"}(Fc||(Fc={}));class RL extends nc{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Fc.PerParticle,this.registerInput("min",rc.AutoDetect,!0,0),this.registerInput("max",rc.AutoDetect,!0,1),this.registerOutput("output",rc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rc.Float|rc.Int|rc.Vector2|rc.Mc|rc.mc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rc.Float|rc.Int|rc.Vector2|rc.Mc|rc.mc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=rc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case rc.AutoDetect:case rc.Int:case rc.Float:Z=Z=>{const c=this.min.getConnectedValue(Z)||0,L=this.max.getConnectedValue(Z)||1;return c+Math.random()*(L-c)};break;case rc.Vector2:Z=Z=>{const c=this.min.getConnectedValue(Z)||k.f.Zero(),L=this.max.getConnectedValue(Z)||k.f.One();return new k.f(c.x+Math.random()*(L.x-c.x),c.y+Math.random()*(L.y-c.y))};break;case rc.Mc:Z=Z=>{const c=this.min.getConnectedValue(Z)||k.h.Zero(),L=this.max.getConnectedValue(Z)||k.h.One();return new k.h(c.x+Math.random()*(L.x-c.x),c.y+Math.random()*(L.y-c.y),c.z+Math.random()*(L.z-c.z))};break;case rc.mc:Z=Z=>{const c=this.min.getConnectedValue(Z)||new G.h(0,0,0,0),L=this.max.getConnectedValue(Z)||new G.h(1,1,1,1);return new G.h(c.x+Math.random()*(L.x-c.x),c.y+Math.random()*(L.y-c.y),c.z+Math.random()*(L.z-c.z),c.w+Math.random()*(L.w-c.w))}}this.output._storedFunction=c=>{var L;let k=0;switch(this.lockMode){case Fc.PerParticle:k=(null===(L=c.particleContext)||void 0===L?void 0:L.id)||-1;break;case Fc.PerSystem:k=c.buildId||0}return this._currentLockId!==k&&(this.lockMode!==Fc.None&&(this._currentLockId=k),this.output._storedValue=Z(c)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),this.lockMode=Z.lockMode}}(0,W.d)([gc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Fc.None},{label:"Per particle",value:Fc.PerParticle},{label:"Per system",value:Fc.PerSystem}]})],RL.prototype,"lockMode",void 0),(0,V.g)("BABYLON.ParticleRandomBlock",RL);class GL extends nc{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Fc.PerParticle,this.registerInput("min",rc.AutoDetect),this.registerInput("max",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[rc.Matrix,rc.Particle,rc.Texture,rc.System,rc.FloatGradient,rc.Color4Gradient,rc.Vector2Gradient,rc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case rc.Float:case rc.Int:Z=Z=>{const c=this.min.getConnectedValue(Z),L=this.max.getConnectedValue(Z);return Math.random()*(L-c)+c};break;case rc.Vector2:Z=Z=>{const c=this.min.getConnectedValue(Z),L=this.max.getConnectedValue(Z);return new k.f(Math.random()*(L.x-c.x)+c.x,Math.random()*(L.y-c.y)+c.y)};break;case rc.Mc:Z=Z=>{const c=this.min.getConnectedValue(Z),L=this.max.getConnectedValue(Z);return new k.h(Math.random()*(L.x-c.x)+c.x,Math.random()*(L.y-c.y)+c.y,Math.random()*(L.z-c.z)+c.z)};break;case rc.mc:Z=Z=>{const c=this.min.getConnectedValue(Z),L=this.max.getConnectedValue(Z);return new G.h(Math.random()*(L.r-c.r)+c.r,Math.random()*(L.g-c.g)+c.g,Math.random()*(L.b-c.b)+c.b,Math.random()*(L.a-c.a)+c.a)}}this.output._storedFunction=c=>{var L;let k=0;switch(this.lockMode){case Fc.PerParticle:k=(null===(L=c.particleContext)||void 0===L?void 0:L.id)||-1;break;case Fc.PerSystem:k=c.buildId||0}return this._currentLockId!==k&&(this.lockMode!==Fc.None&&(this._currentLockId=k),this.output._storedValue=Z(c)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.lockMode&&(this.lockMode=Z.lockMode)}}(0,W.d)([gc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Fc.None},{label:"Per particle",value:Fc.PerParticle},{label:"Per system",value:Fc.PerSystem}]})],GL.prototype,"lockMode",void 0),(0,V.g)("BABYLON.RandomRangeBlock",GL);(0,V.g)("BABYLON.ParticleLerpBlock",class extends nc{constructor(Z){super(Z),this.registerInput("left",rc.AutoDetect),this.registerInput("right",rc.AutoDetect),this.registerInput("gradient",rc.Float,!0,0,0,1),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rc.Float|rc.Int|rc.Vector2|rc.Mc|rc.mc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=(Z,c,L)=>(1-Z)*c+Z*L;this.output._storedFunction=c=>{const L=this.left.getConnectedValue(c),N=this.right.getConnectedValue(c),R=this.gradient.getConnectedValue(c);switch(this.left.type){case rc.Int:case rc.Float:return Z(R,L,N);case rc.Vector2:return new k.f(Z(R,L.x,N.x),Z(R,L.y,N.y));case rc.Mc:return new k.h(Z(R,L.x,N.x),Z(R,L.y,N.y),Z(R,L.z,N.z));case rc.mc:return new G.h(Z(R,L.r,N.r),Z(R,L.g,N.g),Z(R,L.b,N.b),Z(R,L.a,N.a))}return 0}}});(0,V.g)("BABYLON.UpdateDirectionBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("direction",rc.Mc),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.direction.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.direction.R(this.direction.getConnectedValue(Z))},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}});(0,V.g)("BABYLON.UpdateColorBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("color",rc.mc),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.color.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.color.R(this.color.getConnectedValue(Z))},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}});(0,V.g)("BABYLON.UpdateScaleBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("scale",rc.Vector2),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.scale.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.scale.R(this.scale.getConnectedValue(Z))},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}});(0,V.g)("BABYLON.UpdateAngleBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("angle",rc.Float),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.angle.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.angle=this.angle.getConnectedValue(Z)},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}});(0,V.g)("BABYLON.BasicPositionUpdateBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Z){const c=this.particle.getConnectedValue(Z),L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.direction.scaleToRef(c._directionScale,c._scaledDirection),L.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L,this.output._storedValue=c}});(0,V.g)("BABYLON.BasicSpriteUpdateBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Z){const c=this.particle.getConnectedValue(Z),L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L,this.output._storedValue=c}});(0,V.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("cellIndex",rc.Int),this.registerOutput("output",rc.Particle),this.cellIndex.acceptedConnectionPointTypes=[rc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Z){const c=this.particle.getConnectedValue(Z);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const L={process:L=>{Z.particleContext=L,Z.systemContext=c,L.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Z))},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L}});class VL extends nc{constructor(Z){super(Z),this.strength=1,this.registerInput("particle",rc.Particle),this.registerInput("flowMap",rc.Texture),this.registerOutput("output",rc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Z){var c;const L=this.particle.getConnectedValue(Z),k=Z.LL;let N;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((Z=>{Z&&(N=new Qc(Z.width,Z.height,Z.data))}));const R={process:Z=>{const c=k.getTransformMatrix();N&&N._processParticle(Z,this.strength*L._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};L._updateQueueStart?AZ(R,L._updateQueueStart):L._updateQueueStart=R,this.output._storedValue=L}serialize(){const Z=super.serialize();return Z.strength=this.strength,Z}_deserialize(Z){super._deserialize(Z),this.strength=Z.strength}}(0,W.d)([gc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VL.prototype,"strength",void 0),(0,V.g)("BABYLON.UpdateFlowMapBlock",VL);(0,V.g)("BABYLON.SphereShapeBlock",class extends nc{constructor(Z){super(Z),this.registerInput("input",rc.Particle),this.registerInput("radius",rc.Float,!0,1),this.registerInput("radiusRange",rc.Float,!0,1,0,1),this.registerInput("directionRandomizer",rc.Float,!0,0,0,1),this.registerOutput("output",rc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Z){const c=this.input.getConnectedValue(Z);c._directionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.directionRandomizer.getConnectedValue(Z),R=L.position.yL(Z.emitterPosition).normalize(),G=(0,J.RandomRange)(0,N),V=(0,J.RandomRange)(0,N),p=(0,J.RandomRange)(0,N);R.x+=G,R.y+=V,R.z+=p,R.normalize(),Z.isEmitterTransformNode?k.h.TransformNormalFromFloatsToRef(G,V,p,Z.emitterWorldMatrix,L.direction):L.direction.wc(G,V,p)},c._positionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.radius.getConnectedValue(Z),R=this.radiusRange.getConnectedValue(Z),G=N-(0,J.RandomRange)(0,N*R),V=(0,J.RandomRange)(0,1),p=(0,J.RandomRange)(0,2*Math.PI),z=Math.acos(2*V-1),i=G*Math.cos(p)*Math.sin(z),t=G*Math.cos(z),E=G*Math.sin(p)*Math.sin(z);Z.isEmitterTransformNode?k.h.TransformCoordinatesFromFloatsToRef(i,t,E,Z.emitterWorldMatrix,L.position):(L.position.wc(i,t,E),L.position.addInPlace(Z.emitterPosition))},this.output._storedValue=c}});(0,V.g)("BABYLON.PointShapeBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("direction1",rc.Mc,!0,new k.h(0,1,0)),this.registerInput("direction2",rc.Mc,!0,new k.h(0,1,0)),this.registerOutput("output",rc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const c=this.particle.getConnectedValue(Z);c._directionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.direction1.getConnectedValue(Z),R=this.direction2.getConnectedValue(Z),G=(0,J.RandomRange)(N.x,R.x),V=(0,J.RandomRange)(N.y,R.y),p=(0,J.RandomRange)(N.z,R.z);Z.isEmitterTransformNode?k.h.TransformNormalFromFloatsToRef(G,V,p,Z.emitterWorldMatrix,L.direction):L.direction.wc(G,V,p)},c._positionCreation.process=L=>{Z.systemContext=c,Z.isEmitterTransformNode?k.h.TransformCoordinatesFromFloatsToRef(0,0,0,Z.emitterWorldMatrix,L.position):L.position.R(Z.emitterPosition)},this.output._storedValue=c}});(0,V.g)("BABYLON.CustomShapeBlock",class extends nc{constructor(Z){super(Z),this.registerInput("particle",rc.Particle),this.registerInput("position",rc.Mc,!0,new k.h(0,0,0)),this.registerInput("direction",rc.Mc,!0,new k.h(0,1,0)),this.registerOutput("output",rc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const c=this.particle.getConnectedValue(Z);c._directionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.direction.getConnectedValue(Z);Z.isEmitterTransformNode?k.h.TransformNormalToRef(N,Z.emitterWorldMatrix,L.direction):L.direction.R(N)},c._positionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.position.getConnectedValue(Z);Z.isEmitterTransformNode?k.h.TransformCoordinatesToRef(N,Z.emitterWorldMatrix,L.position):(L.position.R(N),L.position.addInPlace(Z.emitterPosition))},this.output._storedValue=c}});(0,V.g)("BABYLON.CylinderShapeBlock",class extends nc{constructor(Z){super(Z),this._tempVector=k.h.Zero(),this.registerInput("particle",rc.Particle),this.registerInput("radius",rc.Float,!0,1),this.registerInput("height",rc.Float,!0,1,0),this.registerInput("radiusRange",rc.Float,!0,1,0,1),this.registerInput("directionRandomizer",rc.Float,!0,0,0,1),this.registerOutput("output",rc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const c=this.particle.getConnectedValue(Z);c._directionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.directionRandomizer.getConnectedValue(Z);L.position.subtractToRef(Z.emitterPosition,this._tempVector),this._tempVector.normalize(),Z.isEmitterTransformNode&&k.h.TransformNormalToRef(this._tempVector,Z.emitterInverseWorldMatrix,this._tempVector);const R=(0,J.RandomRange)(-N/2,N/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*N,this._tempVector.y=R,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),Z.isEmitterTransformNode?k.h.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z.emitterWorldMatrix,L.direction):L.direction.R(this._tempVector)},c._positionCreation.process=L=>{Z.particleContext=L,Z.systemContext=c;const N=this.height.getConnectedValue(Z),R=this.radiusRange.getConnectedValue(Z),G=this.radius.getConnectedValue(Z),V=(0,J.RandomRange)(-N/2,N/2),p=(0,J.RandomRange)(0,2*Math.PI),z=(0,J.RandomRange)((1-R)*(1-R),1),i=Math.sqrt(z)*G,t=i*Math.cos(p),E=i*Math.sin(p);Z.isEmitterTransformNode?k.h.TransformCoordinatesFromFloatsToRef(t,V,E,Z.emitterWorldMatrix,L.position):(L.position.wc(t,V,E),L.position.addInPlace(Z.emitterPosition))},this.output._storedValue=c}});class pL extends nc{constructor(Z){super(Z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",rc.Particle),this.registerOutput("output",rc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const c=this.particle.getConnectedValue(Z);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const Z=super.serialize();return Z.width=this.width,Z.height=this.height,Z.start=this.start,Z.end=this.end,Z.randomStartCell=this.randomStartCell,Z}_deserialize(Z){super._deserialize(Z),this.width=Z.width,this.height=Z.height,this.start=Z.start,this.end=Z.end,this.randomStartCell=Z.randomStartCell}}(0,W.d)([gc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pL.prototype,"start",void 0),(0,W.d)([gc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pL.prototype,"end",void 0),(0,W.d)([gc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pL.prototype,"width",void 0),(0,W.d)([gc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pL.prototype,"height",void 0),(0,W.d)([gc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pL.prototype,"loop",void 0),(0,W.d)([gc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pL.prototype,"randomStartCell",void 0),(0,V.g)("BABYLON.SetupSpriteSheetBlock",pL);class JL extends nc{constructor(Z){super(Z),this.reference=0,this.registerInput("value",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case rc.Float:return rc.FloatGradient;case rc.Vector2:return rc.Vector2Gradient;case rc.Mc:return rc.Vector3Gradient;case rc.mc:return rc.Color4Gradient}return Z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rc.Float|rc.Vector2|rc.Mc|rc.mc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Z=>null}serialize(){const Z=super.serialize();return Z.reference=this.reference,Z}_deserialize(Z){super._deserialize(Z),this.reference=Z.reference}}(0,W.d)([gc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],JL.prototype,"reference",void 0),(0,V.g)("BABYLON.ParticleGradientValueBlock",JL);(0,V.g)("BABYLON.ParticleGradientBlock",class extends nc{constructor(Z){super(Z),this._entryCount=1,this.registerInput("gradient",rc.Float,!0,1,0,1),this.registerInput("value0",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case rc.FloatGradient:return rc.Float;case rc.Vector2Gradient:return rc.Vector2;case rc.Vector3Gradient:return rc.Mc;case rc.Color4Gradient:return rc.mc}return Z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(rc.FloatGradient|rc.Vector2Gradient|rc.Vector3Gradient|rc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Z){this._inputs[Z].onConnectionObservable.add((()=>{this._entryCount>Z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),rc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Z=[];for(let L=1;L<this._inputs.length;L++){var c;if(this._inputs[L].isConnected)Z.push(null===(c=this._inputs[L].connectedPoint)||void 0===c?void 0:c.ownerBlock)}Z.sort(((Z,c)=>Z.reference-c.reference)),this.output._storedFunction=c=>{const L=this.gradient.getConnectedValue(c);if(1===Z.length)return Z[0].value.getConnectedValue(c);let N=null;for(let R=Z.length-1;R>=0;R--){const V=Z[R];if(V.reference<=L){const Z=V.value.getConnectedValue(c);if(N){const R=N.value.getConnectedValue(c),p=N.reference,z=V.reference,i=Math.max(0,Math.min(1,(L-z)/(p-z)));switch(this.output.type){case rc.Float:return(0,J.Lerp)(Z,R,i);case rc.Vector2:return k.f.Lerp(Z,R,i);case rc.Mc:return k.h.Lerp(Z,R,i);case rc.mc:return G.h.Lerp(Z,R,i)}}return Z}N=V}return 0}}});(0,V.g)("BABYLON.ParticleConverterBlock",class extends nc{constructor(Z){super(Z),this.registerInput("color ",rc.mc,!0),this.registerInput("xyz ",rc.Mc,!0),this.registerInput("xy ",rc.Vector2,!0),this.registerInput("zw ",rc.Vector2,!0),this.registerInput("x ",rc.Float,!0),this.registerInput("y ",rc.Float,!0),this.registerInput("z ",rc.Float,!0),this.registerInput("w ",rc.Float,!0),this.registerOutput("color",rc.mc),this.registerOutput("xyz",rc.Mc),this.registerOutput("xy",rc.Vector2),this.registerOutput("zw",rc.Vector2),this.registerOutput("x",rc.Float),this.registerOutput("y",rc.Float),this.registerOutput("z",rc.Float),this.registerOutput("w",rc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Z){return"color "===Z?"colorIn":"xyz "===Z?"xyzIn":"xy "===Z?"xyIn":"zw "===Z?"zwIn":"x "===Z?"xIn":"y "===Z?"yIn":"z "===Z?"zIn":"w "===Z?"wIn":Z}_outputRename(Z){switch(Z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Z}}_build(Z){super._build(Z);const c=this.xIn,L=this.yIn,N=this.zIn,R=this.wIn,V=this.xyIn,p=this.zwIn,J=this.xyzIn,z=this.colorIn,i=this.colorOut,t=this.xyzOut,E=this.xyOut,x=this.zwOut,q=this.xOut,O=this.yOut,w=this.zOut,M=this.wOut,P=Z=>{if(z.isConnected)return z.getConnectedValue(Z);let k=0,i=0,t=0,E=0;if(c.isConnected&&(k=c.getConnectedValue(Z)),L.isConnected&&(i=L.getConnectedValue(Z)),N.isConnected&&(t=N.getConnectedValue(Z)),R.isConnected&&(E=R.getConnectedValue(Z)),V.isConnected){const c=V.getConnectedValue(Z);c&&(k=c.x,i=c.y)}if(p.isConnected){const c=p.getConnectedValue(Z);c&&(t=c.x,E=c.y)}if(J.isConnected){const c=J.getConnectedValue(Z);c&&(k=c.x,i=c.y,t=c.z)}return new G.h(k,i,t,E)};i._storedFunction=Z=>P(Z),t._storedFunction=Z=>{const c=P(Z);return new k.h(c.r,c.g,c.b)},E._storedFunction=Z=>{const c=P(Z);return new k.f(c.r,c.g)},x._storedFunction=Z=>{const c=P(Z);return new k.f(c.b,c.a)},q._storedFunction=Z=>P(Z).r,O._storedFunction=Z=>P(Z).g,w._storedFunction=Z=>P(Z).b,M._storedFunction=Z=>P(Z).a}}),function(Z){Z[Z.Cos=0]="Cos",Z[Z.Sin=1]="Sin",Z[Z.Abs=2]="Abs",Z[Z.Exp=3]="Exp",Z[Z.Exp2=4]="Exp2",Z[Z.Round=5]="Round",Z[Z.Floor=6]="Floor",Z[Z.Ceiling=7]="Ceiling",Z[Z.Sqrt=8]="Sqrt",Z[Z.Log=9]="Log",Z[Z.Tan=10]="Tan",Z[Z.ArcTan=11]="ArcTan",Z[Z.ArcCos=12]="ArcCos",Z[Z.ArcSin=13]="ArcSin",Z[Z.Sign=14]="Sign",Z[Z.Negate=15]="Negate",Z[Z.OneMinus=16]="OneMinus",Z[Z.Reciprocal=17]="Reciprocal",Z[Z.ToDegrees=18]="ToDegrees",Z[Z.ToRadians=19]="ToRadians",Z[Z.Fract=20]="Fract"}(Uc||(Uc={}));class zL extends nc{constructor(Z){super(Z),this.operation=Uc.Cos,this.registerInput("input",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(rc.Float|rc.Int|rc.Vector2|rc.Mc|rc.mc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);let c=null;switch(this.operation){case Uc.Cos:c=Z=>Math.cos(Z);break;case Uc.Sin:c=Z=>Math.sin(Z);break;case Uc.Abs:c=Z=>Math.abs(Z);break;case Uc.Exp:c=Z=>Math.exp(Z);break;case Uc.Exp2:c=Z=>Math.pow(2,Z);break;case Uc.Round:c=Z=>Math.round(Z);break;case Uc.Floor:c=Z=>Math.floor(Z);break;case Uc.Ceiling:c=Z=>Math.ceil(Z);break;case Uc.Sqrt:c=Z=>Math.sqrt(Z);break;case Uc.Log:c=Z=>Math.log(Z);break;case Uc.Tan:c=Z=>Math.tan(Z);break;case Uc.ArcTan:c=Z=>Math.atan(Z);break;case Uc.ArcCos:c=Z=>Math.acos(Z);break;case Uc.ArcSin:c=Z=>Math.asin(Z);break;case Uc.Sign:c=Z=>Math.sign(Z);break;case Uc.Negate:c=Z=>-Z;break;case Uc.OneMinus:c=Z=>1-Z;break;case Uc.Reciprocal:c=Z=>1/Z;break;case Uc.ToRadians:c=Z=>Z*Math.PI/180;break;case Uc.ToDegrees:c=Z=>180*Z/Math.PI;break;case Uc.Fract:c=Z=>Z>=0?Z-Math.floor(Z):Z-Math.ceil(Z)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case rc.Int:case rc.Float:this.output._storedFunction=Z=>{const L=this.input.getConnectedValue(Z);return c(L)};break;case rc.Vector2:this.output._storedFunction=Z=>{const L=this.input.getConnectedValue(Z);return new k.f(c(L.x),c(L.y))};break;case rc.Mc:this.output._storedFunction=Z=>{const L=this.input.getConnectedValue(Z);return new k.h(c(L.x),c(L.y),c(L.z))};break;case rc.mc:this.output._storedFunction=Z=>{const L=this.input.getConnectedValue(Z);return new G.h(c(L.r),c(L.g),c(L.b),c(L.a))}}return this}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,W.d)([gc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Uc.Cos},{label:"Sin",value:Uc.Sin},{label:"Abs",value:Uc.Abs},{label:"Exp",value:Uc.Exp},{label:"Exp2",value:Uc.Exp2},{label:"Round",value:Uc.Round},{label:"Floor",value:Uc.Floor},{label:"Ceiling",value:Uc.Ceiling},{label:"Sqrt",value:Uc.Sqrt},{label:"Log",value:Uc.Log},{label:"Tan",value:Uc.Tan},{label:"ArcTan",value:Uc.ArcTan},{label:"ArcCos",value:Uc.ArcCos},{label:"ArcSin",value:Uc.ArcSin},{label:"Sign",value:Uc.Sign},{label:"Negate",value:Uc.Negate},{label:"OneMinus",value:Uc.OneMinus},{label:"Reciprocal",value:Uc.Reciprocal},{label:"ToDegrees",value:Uc.ToDegrees},{label:"ToRadians",value:Uc.ToRadians},{label:"Fract",value:Uc.Fract}]})],zL.prototype,"operation",void 0),(0,V.g)("BABYLON.ParticleTrigonometryBlock",zL);var iL,tL=L(12529);class EL extends nc{constructor(Z){super(Z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(rc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(rc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(rc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(rc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(rc.System),this._inputs[0].excludedConnectionPointTypes.push(rc.Particle),this._inputs[0].excludedConnectionPointTypes.push(rc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=Z=>{const c=this.input.getConnectedValue(Z);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case rc.Vector2:this.log.push([(0,tL.i)(c,4),c.toString()]);break;case rc.Mc:this.log.push([(0,tL.l)(c,4),c.toString()]);break;case rc.mc:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(Z)}serialize(){const Z=super.serialize();return Z.stackSize=this.stackSize,Z}_deserialize(Z){super._deserialize(Z),this.stackSize=Z.stackSize}}(0,W.d)([gc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],EL.prototype,"stackSize",void 0),(0,V.g)("BABYLON.ParticleDebugBlock",EL);(0,V.g)("BABYLON.ParticleElbowBlock",class extends nc{constructor(Z){super(Z),this.registerInput("input",rc.AutoDetect),this.registerOutput("output",rc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const c=this._outputs[0],L=this._inputs[0];c._storedFunction=Z=>L.getConnectedValue(Z)}});(0,V.g)("BABYLON.ParticleTeleportInBlock",class extends nc{get endpoints(){return this._endpoints}constructor(Z){super(Z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",rc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(Z))return!0;return!1}isAnAncestorOf(Z){for(const c of this.endpoints){if(c===Z)return!0;if(c.isAnAncestorOf(Z))return!0}return!1}attachToEndpoint(Z){Z.detach(),this._endpoints.push(Z),Z._entryPoint=this,Z._outputs[0]._typeConnectionSource=this._inputs[0],Z._tempEntryPointUniqueId=null,Z.name="> "+this.name}detachFromEndpoint(Z){const c=this._endpoints.indexOf(Z);-1!==c&&(this._endpoints.splice(c,1),Z._outputs[0]._typeConnectionSource=null,Z._entryPoint=null)}_build(){for(const Z of this._endpoints)Z.output._storedFunction=Z=>this.input.getConnectedValue(Z)}});(0,V.g)("BABYLON.ParticleTeleportOutBlock",class extends nc{constructor(Z){super(Z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",rc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Z){this.entryPoint&&this.entryPoint.build(Z)}clone(){const Z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Z),Z}serialize(){var Z;const c=super.serialize();return c.entryPoint=(null===(Z=this.entryPoint)||void 0===Z?void 0:Z.uniqueId)??"",c}_deserialize(Z){super._deserialize(Z),this._tempEntryPointUniqueId=Z.entryPoint}}),function(Z){Z[Z.Equal=0]="Equal",Z[Z.NotEqual=1]="NotEqual",Z[Z.LessThan=2]="LessThan",Z[Z.GreaterThan=3]="GreaterThan",Z[Z.LessOrEqual=4]="LessOrEqual",Z[Z.GreaterOrEqual=5]="GreaterOrEqual",Z[Z.Xor=6]="Xor",Z[Z.Or=7]="Or",Z[Z.And=8]="And"}(iL||(iL={}));class xL extends nc{constructor(Z){super(Z),this.test=iL.Equal,this.epsilon=0,this.registerInput("left",rc.Float),this.registerInput("right",rc.Float,!0,0),this.registerInput("ifTrue",rc.AutoDetect,!0,1),this.registerInput("ifFalse",rc.AutoDetect,!0,0),this.registerOutput("output",rc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=rc.Float,this._inputs[0].acceptedConnectionPointTypes.push(rc.Int),this._inputs[1].acceptedConnectionPointTypes.push(rc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Z=Z=>{const c=this.left.getConnectedValue(Z),L=this.right.getConnectedValue(Z);let k=!1;switch(this.test){case iL.Equal:k=(0,J.WithinEpsilon)(c,L,this.epsilon);break;case iL.NotEqual:k=!(0,J.WithinEpsilon)(c,L,this.epsilon);break;case iL.LessThan:k=c<L+this.epsilon;break;case iL.GreaterThan:k=c>L-this.epsilon;break;case iL.LessOrEqual:k=c<=L+this.epsilon;break;case iL.GreaterOrEqual:k=c>=L-this.epsilon;break;case iL.Xor:k=!!c&&!L||!c&&!!L;break;case iL.Or:k=!!c||!!L;break;case iL.And:k=!!c&&!!L}return k};this.output._storedFunction=c=>Z(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const Z=super.serialize();return Z.test=this.test,Z.epsilon=this.epsilon,Z}_deserialize(Z){super._deserialize(Z),this.test=Z.test,void 0!==Z.epsilon&&(this.epsilon=Z.epsilon)}}(0,W.d)([gc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:iL.Equal},{label:"NotEqual",value:iL.NotEqual},{label:"LessThan",value:iL.LessThan},{label:"GreaterThan",value:iL.GreaterThan},{label:"LessOrEqual",value:iL.LessOrEqual},{label:"GreaterOrEqual",value:iL.GreaterOrEqual},{label:"Xor",value:iL.Xor},{label:"Or",value:iL.Or},{label:"And",value:iL.And}]})],xL.prototype,"test",void 0),(0,W.d)([gc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],xL.prototype,"epsilon",void 0),(0,V.g)("BABYLON.ParticleConditionBlock",xL);class qL extends nc{constructor(Z){super(Z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",rc.Particle),this.registerInput("condition",rc.Float,!0,0),this.registerInput("system",rc.System),this.registerOutput("output",rc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){this._triggerCount=0;const c=this.input.getConnectedValue(Z),L={process:L=>{if(Z.particleContext=L,Z.systemContext=c,0!==this.condition.getConnectedValue(Z)&&(0===this.limit||this._triggerCount<this.limit)){const k=(new Date).getTime();if(this._previousOne&&k-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=k;const N=this.system.getConnectedValue(Z);if(N){const k=vc(N,Z.LL,L.position);k.Xc.addOnce((()=>{this._triggerCount--})),c.Xc.addOnce((()=>{k.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?AZ(L,c._updateQueueStart):c._updateQueueStart=L,this.output._storedValue=c}serialize(){const Z=super.serialize();return Z.limit=this.limit,Z.delay=this.delay,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.limit&&(this.limit=Z.limit),void 0!==Z.delay&&(this.delay=Z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,W.d)([gc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qL.prototype,"limit",void 0),(0,W.d)([gc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qL.prototype,"delay",void 0),(0,V.g)("BABYLON.ParticleTriggerBlock",qL);L(12532),L(12544),L(12556),L(12602)},12586:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneFragment",R="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12562:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneFragmentDeclaration",R="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12618:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneVertex",R="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12610:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneVertexDeclaration",R="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12596:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogFragment",R="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12578:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogFragmentDeclaration",R="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12622:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogVertex",R="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12616:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogVertexDeclaration",R="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12573:(Z,c,L)=>{"use strict";var k=L(11124);const N="helperFunctions",R="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12565:(Z,c,L)=>{"use strict";var k=L(11124);const N="imageProcessingDeclaration",R="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12576:(Z,c,L)=>{"use strict";var k=L(11124);const N="imageProcessingFunctions",R="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12568:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthDeclaration",R="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12588:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthFragment",R="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12631:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthVertex",R="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";k.e.IncludesShadersStoreWGSL[N]||(k.e.IncludesShadersStoreWGSL[N]=R)},12556:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{particlesPixelShaderWGSL:()=>G});var k=L(11124);L(12562),L(12565),L(12568),L(12573),L(12576),L(12578),L(12586),L(12588),L(12596);const N="particlesPixelShader",R="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";k.e.ShadersStoreWGSL[N]||(k.e.ShadersStoreWGSL[N]=R);const G={name:N,shader:R}},12602:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{particlesVertexShaderWGSL:()=>G});var k=L(11124);L(12610),L(12616),L(12568),L(12618),L(12622),L(12631);const N="particlesVertexShader",R="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";k.e.ShadersStoreWGSL[N]||(k.e.ShadersStoreWGSL[N]=R);const G={name:N,shader:R}},12476:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneFragment",R="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12539:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneFragmentDeclaration",R="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12493:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneVertex",R="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12548:(Z,c,L)=>{"use strict";var k=L(11124);const N="clipPlaneVertexDeclaration",R="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12482:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogFragment",R="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12469:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogFragmentDeclaration",R="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12495:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogVertex",R="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12490:(Z,c,L)=>{"use strict";var k=L(11124);const N="fogVertexDeclaration",R="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12464:(Z,c,L)=>{"use strict";var k=L(11124);const N="helperFunctions",R="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12455:(Z,c,L)=>{"use strict";var k=L(11124);const N="imageProcessingDeclaration",R="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12466:(Z,c,L)=>{"use strict";var k=L(11124);const N="imageProcessingFunctions",R="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12459:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthDeclaration",R="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12480:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthFragment",R="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12499:(Z,c,L)=>{"use strict";var k=L(11124);const N="logDepthVertex",R="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";k.e.IncludesShadersStore[N]||(k.e.IncludesShadersStore[N]=R)},12532:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{particlesPixelShader:()=>G});var k=L(11124);L(12539),L(12455),L(12459),L(12464),L(12466),L(12469),L(12476),L(12480),L(12482);const N="particlesPixelShader",R="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";k.e.ShadersStore[N]||(k.e.ShadersStore[N]=R);const G={name:N,shader:R}},12544:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{particlesVertexShader:()=>G});var k=L(11124);L(12548),L(12490),L(12459),L(12493),L(12495),L(12499);const N="particlesVertexShader",R="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";k.e.ShadersStore[N]||(k.e.ShadersStore[N]=R);const G={name:N,shader:R}},12878:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{FlowGraphGLTFDataProvider:()=>R});var k=L(12846),N=L(12825);class R extends k.c{constructor(Z){var c,L;super();const k=Z.glTF,R=(null===(c=k.animations)||void 0===c?void 0:c.map((Z=>Z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",N.e,R);const G=(null===(L=k.nodes)||void 0===L?void 0:L.map((Z=>Z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",N.e,G)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12760:(Z,c,L)=>{"use strict";L.d(c,{c:()=>O,f:()=>x,i:()=>E,l:()=>q});var k=L(10993),N=L(11549),R=L(11255),G=L(12766);const V=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class p{constructor(Z,c){this._gltf=Z,this._infoTree=c}convert(Z){let c,L=this._gltf,k=this._infoTree;if(!Z.startsWith("/"))throw new Error("Path must start with a /");const N=Z.split("/");if(N.shift(),N[N.length-1].includes(".length")){const Z=N[N.length-1].split(".");N.pop(),N.push(...Z)}let R=!1;for(const p of N){const N="length"===p;if(N&&!k.__array__)throw new Error(`Path ${Z} is invalid`);if(k.__ignoreObjectTree__&&(R=!0),k.__array__&&!N)k=k.__array__;else if(k=k[p],!k)throw new Error(`Path ${Z} is invalid`);if(!R)if(void 0===L){if(!V.find((c=>c.regex.test(Z))))throw new Error(`Path ${Z} is invalid`)}else if(!N){var G;L=null===(G=L)||void 0===G?void 0:G[p]}(k.__target__||N)&&(c=L)}return{object:c,info:k}}}function J(Z,c,L,k){const N=z(Z,c);return k?N[L][k]:N[L]}function z(Z,c,L){var k,R;return null===(k=Z._data)||void 0===k||null===(R=k[(null===L||void 0===L?void 0:L.fillMode)??N.b.MATERIAL_TriangleFillMode])||void 0===R?void 0:R.babylonMaterial}function i(Z,c){return{offset:{componentsCount:2,type:"Vector2",get:(L,N,R)=>{const G=J(L,R,Z,c);return new k.f(null===G||void 0===G?void 0:G.uOffset,null===G||void 0===G?void 0:G.vOffset)},getTarget:z,set:(L,k,N,R)=>{const G=J(k,R,Z,c);G.uOffset=L.x,G.vOffset=L.y},getPropertyName:[()=>`${Z}${c?"."+c:""}.uOffset`,()=>`${Z}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(L,k,N)=>{var R;return null===(R=J(L,N,Z,c))||void 0===R?void 0:R.wAng},getTarget:z,set:(L,k,N,R)=>J(k,R,Z,c).wAng=L,getPropertyName:[()=>`${Z}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(L,N,R)=>{const G=J(L,R,Z,c);return new k.f(null===G||void 0===G?void 0:G.uScale,null===G||void 0===G?void 0:G.vScale)},getTarget:z,set:(L,k,N,R)=>{const G=J(k,R,Z,c);G.uScale=L.x,G.vScale=L.y},getPropertyName:[()=>`${Z}${c?"."+c:""}.uScale`,()=>`${Z}${c?"."+c:""}.vScale`]}}}const t={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Z=>{var c,L;return new k.f((null===(c=Z._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(L=Z._babylonCamera)||void 0===L?void 0:L.orthoRight)??0)},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=Z.x,c._babylonCamera.orthoRight=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Z=>{var c,L;return new k.f((null===(c=Z._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(L=Z._babylonCamera)||void 0===L?void 0:L.orthoTop)??0)},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=Z.x,c._babylonCamera.orthoTop=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.maxZ},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.Dc},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.Dc=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Dc"]}},perspective:{aspectRatio:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(Z._babylonCamera)},getTarget:Z=>Z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.fov},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.fov=Z)},getTarget:Z=>Z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.maxZ},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var c;return null===(c=Z._babylonCamera)||void 0===c?void 0:c.Dc},set:(Z,c)=>{c._babylonCamera&&(c._babylonCamera.Dc=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Dc"]}}}},nodes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Mc",get:Z=>{var c;return null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.position},set:(Z,c)=>{var L;return null===(L=c._babylonTransformNode)||void 0===L?void 0:L.position.R(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Z=>{var c;return null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(Z,c)=>{var L,k;return null===(L=c._babylonTransformNode)||void 0===L||null===(k=L.rotationQuaternion)||void 0===k?void 0:k.R(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Mc",get:Z=>{var c;return null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.Pc},set:(Z,c)=>{var L;return null===(L=c._babylonTransformNode)||void 0===L?void 0:L.Pc.R(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"Pc"]},weights:{length:{type:"number",get:Z=>Z._numMorphTargets,getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Z,c)=>{var L,k;return void 0!==c?null===(L=Z._primitiveBabylonMeshes)||void 0===L||null===(k=L[0].morphTargetManager)||void 0===k?void 0:k.getTarget(c).influence:void 0},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Z,c)=>[0],getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Z=>{var c,L,N;return k.b.Compose(null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.Pc,null===(L=Z._babylonTransformNode)||void 0===L?void 0:L.rotationQuaternion,null===(N=Z._babylonTransformNode)||void 0===N?void 0:N.position)},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Z=>{var c,L,N,R;const G=k.b.Identity();let V=Z.parent;for(;V&&V.parent;)V=V.parent;const p=(null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(L=Z._babylonTransformNode)||void 0===L||null===(N=L.rotationQuaternion)||void 0===N?void 0:N._isDirty)||(null===(R=Z._babylonTransformNode)||void 0===R?void 0:R.Pc._isDirty);if(V){var J;const c=null===(J=V._babylonTransformNode)||void 0===J?void 0:J.Jc(!0).invert();var z,i;if(c)null===(z=Z._babylonTransformNode)||void 0===z||null===(i=z.Jc(p))||void 0===i||i.multiplyToRef(c,G)}else Z._babylonTransformNode&&G.R(Z._babylonTransformNode.Jc(p));return G},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Z=>{var c,L;return null===(c=Z._babylonTransformNode)||void 0===c||null===(L=c.getChildren((Z=>Z instanceof G.e),!0)[0])||void 0===L?void 0:L.Qc},getTarget:Z=>{var c;return null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.getChildren((Z=>Z instanceof G.e),!0)[0]},set:(Z,c)=>{if(c._babylonTransformNode){const L=c._babylonTransformNode.getChildren((Z=>Z instanceof G.e),!0)[0];L&&(L.Qc=Z)}}},color:{type:"sc",get:Z=>{var c,L;return null===(c=Z._babylonTransformNode)||void 0===c||null===(L=c.getChildren((Z=>Z instanceof G.e),!0)[0])||void 0===L?void 0:L.rc},getTarget:Z=>{var c;return null===(c=Z._babylonTransformNode)||void 0===c?void 0:c.getChildren((Z=>Z instanceof G.e),!0)[0]},set:(Z,c)=>{if(c._babylonTransformNode){const L=c._babylonTransformNode.getChildren((Z=>Z instanceof G.e),!0)[0];L&&(L.rc=Z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"sc",get:(Z,c,L)=>z(Z,c,L).emissiveColor,set:(Z,c,L,k)=>z(c,L,k).emissiveColor.R(Z),getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:i("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Z,c,L)=>{var k;return null===(k=J(Z,L,"bumpTexture"))||void 0===k?void 0:k.level},set:(Z,c,L,k)=>{const N=J(c,k,"bumpTexture");N&&(N.level=Z)},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:i("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Z,c,L)=>z(Z,c,L).ambientTextureStrength,set:(Z,c,L,k)=>{const N=z(c,L,k);N&&(N.ambientTextureStrength=Z)},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:i("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"mc",get:(Z,c,L)=>{const k=z(Z,c,L);return R.h.FromColor3(k.albedoColor,k.alpha)},set:(Z,c,L,k)=>{const N=z(c,L,k);N.albedoColor.set(Z.r,Z.g,Z.b),N.alpha=Z.a},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:i("albedoTexture")}},metallicFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).metallic,set:(Z,c,L,k)=>{const N=z(c,L,k);N&&(N.metallic=Z)},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).roughness,set:(Z,c,L,k)=>{const N=z(c,L,k);N&&(N.roughness=Z)},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:i("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Z,c,L)=>z(Z,c,L).anisotropy.Qc,set:(Z,c,L,k)=>{z(c,L,k).anisotropy.Qc=Z},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Z,c,L)=>z(Z,c,L).anisotropy.angle,set:(Z,c,L,k)=>{z(c,L,k).anisotropy.angle=Z},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:i("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).clearCoat.Qc,set:(Z,c,L,k)=>{z(c,L,k).clearCoat.Qc=Z},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).clearCoat.roughness,set:(Z,c,L,k)=>{z(c,L,k).clearCoat.roughness=Z},getTarget:(Z,c,L)=>z(Z,c,L),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:i("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Z,c,L)=>{var k;return null===(k=z(Z,c,L).clearCoat.bumpTexture)||void 0===k?void 0:k.level},getTarget:z,set:(Z,c,L,k)=>z(c,L,k).clearCoat.bumpTexture.level=Z},extensions:{KHR_texture_transform:i("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:i("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Z,c,L)=>z(Z,c,L).subSurface.dispersion,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.dispersion=Z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Z,c,L)=>z(Z,c,L).emissiveIntensity,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).emissiveIntensity=Z}},KHR_materials_ior:{ior:{type:"number",get:(Z,c,L)=>z(Z,c,L).indexOfRefraction,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).indexOfRefraction=Z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).iridescence.Qc,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).iridescence.Qc=Z},iridescenceIor:{type:"number",get:(Z,c,L)=>z(Z,c,L).iridescence.indexOfRefraction,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).iridescence.indexOfRefraction=Z},iridescenceTexture:{extensions:{KHR_texture_transform:i("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Z,c,L)=>z(Z,c,L).iridescence.maximumThickness,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).iridescence.maximumThickness=Z},iridescenceThicknessMinimum:{type:"number",get:(Z,c,L)=>z(Z,c,L).iridescence.minimumThickness,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).iridescence.minimumThickness=Z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:i("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"sc",get:(Z,c,L)=>z(Z,c,L).sheen.color,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).sheen.color.R(Z)},sheenColorTexture:{extensions:{KHR_texture_transform:i("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).sheen.Qc,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).sheen.Qc=Z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:i("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).metallicF0Factor,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).metallicF0Factor=Z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"sc",get:(Z,c,L)=>z(Z,c,L).metallicReflectanceColor,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).metallicReflectanceColor.R(Z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:i("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:i("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).subSurface.refractionIntensity,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.refractionIntensity=Z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:i("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).subSurface.translucencyIntensity,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.translucencyIntensity=Z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:i("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"sc",get:(Z,c,L)=>z(Z,c,L).subSurface.translucencyColor,getTarget:z,set:(Z,c,L,k)=>{var N;return Z&&(null===(N=z(c,L,k).subSurface.translucencyColor)||void 0===N?void 0:N.R(Z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:i("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"sc",get:(Z,c,L)=>z(Z,c,L).subSurface.tintColor,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.tintColor.R(Z)},attenuationDistance:{type:"number",get:(Z,c,L)=>z(Z,c,L).subSurface.tintColorAtDistance,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.tintColorAtDistance=Z},thicknessFactor:{type:"number",get:(Z,c,L)=>z(Z,c,L).subSurface.maximumThickness,getTarget:z,set:(Z,c,L,k)=>z(c,L,k).subSurface.maximumThickness=Z},thicknessTexture:{extensions:{KHR_texture_transform:i("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,color:{type:"sc",get:Z=>{var c;return null===(c=Z._babylonLight)||void 0===c?void 0:c.rc},set:(Z,c)=>{var L;return null===(L=c._babylonLight)||void 0===L?void 0:L.rc.R(Z)},getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"diffuse"]},Qc:{type:"number",get:Z=>{var c;return null===(c=Z._babylonLight)||void 0===c?void 0:c.Qc},set:(Z,c)=>c._babylonLight?c._babylonLight.Qc=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"intensity"]},range:{type:"number",get:Z=>{var c;return null===(c=Z._babylonLight)||void 0===c?void 0:c.range},set:(Z,c)=>c._babylonLight?c._babylonLight.range=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"range"]},spot:{innerConeAngle:{type:"number",get:Z=>{var c;return null===(c=Z._babylonLight)||void 0===c?void 0:c.innerAngle},set:(Z,c)=>c._babylonLight?c._babylonLight.innerAngle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Z=>{var c;return null===(c=Z._babylonLight)||void 0===c?void 0:c.angle},set:(Z,c)=>c._babylonLight?c._babylonLight.angle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTexture)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,Qc:{type:"number",get:Z=>{var c;return null===(c=Z._babylonTexture)||void 0===c?void 0:c.level},set:(Z,c)=>{c._babylonTexture&&(c._babylonTexture.level=Z)},getTarget:Z=>Z._babylonTexture},rotation:{type:"Quaternion",get:Z=>{var c;return Z._babylonTexture&&k.c.FromRotationMatrix(null===(c=Z._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(Z,c)=>{var L;c._babylonTexture&&(null!==(L=c._babylonTexture.XZ())&&void 0!==L&&L.useRightHandedSystem||(Z=k.c.Inverse(Z)),k.b.FromQuaternionToRef(Z,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:Z=>Z._babylonTexture}}}}},animations:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>{var c;return null===(c=Z.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function E(Z){return new p(Z,t)}function x(Z){const c=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let L=t;for(const k of c)k&&(L=L[k]);if(L&&L.type&&L.get)return L}function q(Z,c){const L=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let k=t;for(const N of L)N&&(k=k[N]);k&&k.type&&k.get&&(k.interpolation=c)}function O(Z,c){const L=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let k=t;for(const N of L)if(N){if(!k[N]){if("?"===N){k.__ignoreObjectTree__=!0;continue}k[N]={},"__array__"===N&&(k[N].__target__=!0)}k=k[N]}Object.assign(k,c)}},12775:(Z,c,L)=>{"use strict";L.r(c),L.d(c,{AnimationPropertyInfo:()=>J,TransformNodeAnimationPropertyInfo:()=>z,WeightAnimationPropertyInfo:()=>i,getQuaternion:()=>V,getVector3:()=>G,getWeights:()=>p});var k=L(11716),N=L(10993),R=L(12760);function G(Z,c,L,k){return N.h.oc(c,L).scaleInPlace(k)}function V(Z,c,L,k){return N.c.oc(c,L).scaleInPlace(k)}function p(Z,c,L,k){const N=new Array(Z._numMorphTargets);for(let R=0;R<N.length;R++)N[R]=c[L++]*k;return N}class J{constructor(Z,c,L,k){this.type=Z,this.name=c,this.getValue=L,this.getStride=k}_buildAnimation(Z,c,L){const N=new k.c(Z,this.name,c,this.type);return N.setKeys(L),N}}class z extends J{buildAnimations(Z,c,L,k){const N=[];return N.push({babylonAnimatable:Z._babylonTransformNode,babylonAnimation:this._buildAnimation(c,L,k)}),N}}class i extends J{buildAnimations(Z,c,L,N){const R=[];if(Z._numMorphTargets)for(let G=0;G<Z._numMorphTargets;G++){const V=new k.c(`${c}_${G}`,this.name,L,this.type);if(V.setKeys(N.map((Z=>({frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[G]:void 0,value:Z.value[G],outTangent:Z.outTangent?Z.outTangent[G]:void 0,interpolation:Z.interpolation})))),Z._primitiveBabylonMeshes)for(const c of Z._primitiveBabylonMeshes)if(c.morphTargetManager){const Z=c.morphTargetManager.getTarget(G),L=V.clone();Z.animations.push(L),R.push({babylonAnimatable:Z,babylonAnimation:L})}}return R}}(0,R.l)("/nodes/{}/translation",[new z(k.c.ANIMATIONTYPE_VECTOR3,"position",G,(()=>3))]),(0,R.l)("/nodes/{}/rotation",[new z(k.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",V,(()=>4))]),(0,R.l)("/nodes/{}/scale",[new z(k.c.ANIMATIONTYPE_VECTOR3,"Pc",G,(()=>3))]),(0,R.l)("/nodes/{}/weights",[new i(k.c.ANIMATIONTYPE_FLOAT,"influence",p,(Z=>Z._numMorphTargets))])},12727:(Z,c,L)=>{"use strict";class k{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Z,c)=>{this._resolve=Z,this._reject=c}))}}var N=L(10993),R=L(11255),G=L(11038),V=L(11329),p=L(12732),J=L(12745),z=L(11027),i=L(11544),t=L(11716),E=L(11718),x=L(11023),q=L(11052),O=L(11058);class w{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Z,c,L){this.name=Z,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=N.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new z.b,this.bones=[],this._scene=L||x.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const k=this._scene.getEngine().getCaps();this._canUseTextureForBones=k.textureFloat&&k.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Z=>!Z.getParent()))}getTransformMatrices(Z){if(this.needInitialSkinMatrix){if(!Z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Z._bonesTransformMatrices||this.prepare(!0),Z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture}XZ(){return this._scene}toString(Z){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Z){c+=", Ranges: {";let Z=!0;for(const L in this._ranges)Z&&(c+=", ",Z=!1),c+=L;c+="}"}return c}getBoneIndexByName(Z){for(let c=0,L=this.bones.length;c<L;c++)if(this.bones[c].name===Z)return c;return-1}createAnimationRange(Z,c,L){if(!this._ranges[Z]){this._ranges[Z]=new E.d(Z,c,L);for(let k=0,N=this.bones.length;k<N;k++)this.bones[k].animations[0]&&this.bones[k].animations[0].createRange(Z,c,L)}}deleteAnimationRange(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let L=0,k=this.bones.length;L<k;L++)this.bones[L].animations[0]&&this.bones[L].animations[0].deleteRange(Z,c);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}getAnimationRanges(){const Z=[];let c;for(c in this._ranges)Z.push(this._ranges[c]);return Z}copyAnimationRange(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!Z.getAnimationRange(c))return!1;let k=!0;const N=this._getHighestAnimationFrame()+1,R={},G=Z.bones;let V,p;for(p=0,V=G.length;p<V;p++)R[G[p].name]=G[p];this.bones.length!==G.length&&(q.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${G.length}`),k=!1);const J=L&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(p=0,V=this.bones.length;p<V;p++){const Z=this.bones[p].name,G=R[Z];G?k=k&&this.bones[p].copyAnimationRange(G,c,N,L,J):(q.e.Warn("copyAnimationRange: not same rig, missing source bone "+Z),k=!1)}const z=Z.getAnimationRange(c);return z&&(this._ranges[c]=new E.d(c,z.from+N,z.to+N)),k}returnToRest(){for(const Z of this.bones)-1!==Z._index&&Z.returnToRest()}_getHighestAnimationFrame(){let Z=0;for(let c=0,L=this.bones.length;c<L;c++)if(this.bones[c].animations[0]){const L=this.bones[c].animations[0].getHighestFrame();Z<L&&(Z=L)}return Z}beginAnimation(Z,c,L,k){const N=this.getAnimationRange(Z);return N?this._scene.beginAnimation(this,N.from,N.to,c,L,k):null}static MakeAnimationAdditive(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;const k=Z.getAnimationRange(L);if(!k)return null;const N=Z._scene.getAllAnimatablesByTarget(Z);let R=null;for(let V=0;V<N.length;V++){const Z=N[V];if(Z.fromFrame===(null===k||void 0===k?void 0:k.from)&&Z.toFrame===(null===k||void 0===k?void 0:k.to)){R=Z;break}}const G=Z.getAnimatables();for(let V=0;V<G.length;V++){const Z=G[V].animations;if(Z)for(let k=0;k<Z.length;k++)t.c.MakeAnimationAdditive(Z[k],c,L)}return R&&(R.isAdditive=!0),Z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Z){this._meshesWithPoseMatrix.push(Z)}_unregisterMeshWithPoseMatrix(Z){const c=this._meshesWithPoseMatrix.indexOf(Z);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(Z,c){this.onBeforeComputeObservable.notifyObservers(this);for(let L=0;L<this.bones.length;L++){const k=this.bones[L];k._childUpdateId++;const N=k.getParent();if(N?k.getLocalMatrix().multiplyToRef(N.getFinalMatrix(),k.getFinalMatrix()):c?k.getLocalMatrix().multiplyToRef(c,k.getFinalMatrix()):k.getFinalMatrix().R(k.getLocalMatrix()),-1!==k._index){const c=null===k._index?L:k._index;k.getAbsoluteInverseBindMatrix().multiplyToArray(k.getFinalMatrix(),Z,16*c)}}this._identity.copyToArray(Z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Z=this.XZ().getRenderId();if(this._currentRenderId===Z)return;this._currentRenderId=Z}if(this._numBonesWithLinkedTransformNode>0)for(const Z of this.bones)if(Z._linkedTransformNode){const c=Z._linkedTransformNode;Z.position=c.position,c.rotationQuaternion?Z.rotationQuaternion=c.rotationQuaternion:Z.rotation=c.rotation,Z.Pc=c.Pc}if(this.needInitialSkinMatrix)for(const Z of this._meshesWithPoseMatrix){const c=Z.getPoseMatrix();let L=this._isDirty;if(Z._bonesTransformMatrices&&Z._bonesTransformMatrices.length===16*(this.bones.length+1)||(Z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),L=!0),L){if(this._synchronizedWithMesh!==Z){this._synchronizedWithMesh=Z;for(const Z of this.bones)if(!Z.getParent()){Z.getBindMatrix().multiplyToRef(c,N.d.Matrix[1]),Z._updateAbsoluteBindMatrices(N.d.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);Z._transformMatrixTexture&&Z._transformMatrixTexture.getSize().width===c||(Z._transformMatrixTexture&&Z._transformMatrixTexture.dispose(),Z._transformMatrixTexture=i.e.CreateRGBATexture(Z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Z._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&Z._transformMatrixTexture&&Z._transformMatrixTexture.update(Z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=i.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables}clone(Z,c){const L=new w(Z,c||Z,this._scene);L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let k=0;k<this.bones.length;k++){const Z=this.bones[k];let c=null;const N=Z.getParent();if(N){const Z=this.bones.indexOf(N);c=L.bones[Z]}const R=new J.e(Z.name,L,c,Z.getBindMatrix().clone(),Z.getRestMatrix().clone());R._index=Z._index,Z._linkedTransformNode&&R.linkTransformNode(Z._linkedTransformNode),O.d.DeepCopy(Z.animations,R.animations)}if(this._ranges){L._ranges={};for(const Z in this._ranges){const c=this._ranges[Z];c&&(L._ranges[Z]=c.clone())}}return this._isDirty=!0,L.prepare(!0),L}enableBlending(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const L of c.animations)L.enableBlending=!0,L.blendingSpeed=Z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.XZ().stopAnimation(this),this.XZ().removeSkeleton(this),this._parentContainer){const Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Z={};Z.name=this.name,Z.id=this.id,this.dimensionsAtRest&&(Z.dimensionsAtRest=this.dimensionsAtRest.xc()),Z.bones=[],Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let L=0;L<this.bones.length;L++){var c;const k=this.bones[L],N=k.getParent(),R={parentBoneIndex:N?this.bones.indexOf(N):-1,index:k.getIndex(),name:k.name,id:k.id,matrix:k.getBindMatrix().xc(),rest:k.getRestMatrix().xc(),linkedTransformNodeId:null===(c=k.getTransformNode())||void 0===c?void 0:c.id};Z.bones.push(R),k.length&&(R.length=k.length),k.metadata&&(R.metadata=k.metadata),k.animations&&k.animations.length>0&&(R.animation=k.animations[0].serialize()),Z.ranges=[];for(const c in this._ranges){const L=this._ranges[c];if(!L)continue;const k={};k.name=c,k.from=L.from,k.to=L.to,Z.ranges.push(k)}}return Z}static Parse(Z,c){const L=new w(Z.name,Z.id,c);let k;for(Z.dimensionsAtRest&&(L.dimensionsAtRest=N.h.oc(Z.dimensionsAtRest)),L.needInitialSkinMatrix=Z.needInitialSkinMatrix,k=0;k<Z.bones.length;k++){const c=Z.bones[k],R=Z.bones[k].index;let G=null;c.parentBoneIndex>-1&&(G=L.bones[c.parentBoneIndex]);const V=c.rest?N.b.oc(c.rest):null,p=new J.e(c.name,L,G,N.b.oc(c.matrix),V,null,R);void 0!==c.id&&null!==c.id&&(p.id=c.id),c.length&&(p.length=c.length),c.metadata&&(p.metadata=c.metadata),c.animation&&p.animations.push(t.c.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(L._hasWaitingData=!0,p._waitingTransformNodeId=c.linkedTransformNodeId)}if(Z.ranges)for(k=0;k<Z.ranges.length;k++){const c=Z.ranges[k];L.createAnimationRange(c.name,c.from,c.to)}return L}computeAbsoluteMatrices(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Z)}getPoseMatrix(){let Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z}sortBones(){const Z=[],c=new Array(this.bones.length);for(let L=0;L<this.bones.length;L++)this._sortBones(L,Z,c);this.bones=Z}_sortBones(Z,c,L){if(L[Z])return;L[Z]=!0;const k=this.bones[Z];if(!k)return;void 0===k._index&&(k._index=Z);const N=k.getParent();N&&this._sortBones(this.bones.indexOf(N),c,L),c.push(k)}setCurrentPoseAsRest(){for(const Z of this.bones)Z.setCurrentPoseAsRest()}}var M=L(11163),P=L(11563),j=L(11508),o=L(11274),u=L(11190),X=L(11358),h=L(11282),B=L(11325),D=L(11725),e=L(11336),H=L(12704);class l{set areUpdatesFrozen(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Z||(Z=x.d.LastCreatedScene),this._scene=Z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Z.canUseGLVertexID&&Z.textureFloat&&Z.maxVertexTextureImageUnits>0&&Z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return l.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?l.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Z){this._numMaxInfluencers!==Z&&(this._numMaxInfluencers=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Z){this._useTextureToStoreTargets!==Z&&(this._useTextureToStoreTargets=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Z;return l.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Z=this._scene)&&void 0!==Z&&Z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Z){return this._activeTargets.data[Z]}getTarget(Z){return this._targets[Z]}getTargetByName(Z){for(const c of this._targets)if(c.name===Z)return c;return null}addTarget(Z){this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((Z=>{this.areUpdatesFrozen&&Z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Z){const c=this._targets.indexOf(Z);c>=0&&(this._targets.splice(c,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Z)}_bind(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture),Z.setInt("morphTargetCount",this.numInfluencers)}clone(){const Z=new l(this._scene);for(const c of this._targets)Z.addTarget(c.clone());return Z.enablePositionMorphing=this.enablePositionMorphing,Z.enableNormalMorphing=this.enableNormalMorphing,Z.enableTangentMorphing=this.enableTangentMorphing,Z.enableUVMorphing=this.enableUVMorphing,Z.enableUV2Morphing=this.enableUV2Morphing,Z.enableColorMorphing=this.enableColorMorphing,Z}serialize(){const Z={};Z.id=this.uniqueId,Z.targets=[];for(const c of this._targets)Z.targets.push(c.serialize());return Z}_syncActiveTargets(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,L=this.isUsingTextureForTargets;(this._mustSynchronize||c!==L)&&(this._mustSynchronize=!1,this.synchronize());let k=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let N=-1;for(const R of this._targets)if(N++,0!==R.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=l.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(R),this._morphTargetTextureIndices[k]=N,this._tempInfluences[k++]=R.influence}this._morphTargetTextureIndices.length!==k&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,k)),this._influences&&this._influences.length===k||(this._influences=new Float32Array(k));for(let R=0;R<k;R++)this._influences[R]=this._tempInfluences[R];if(Z&&this._scene)for(const R of this._scene.meshes)R.morphTargetManager===this&&(L?R._markSubMeshesAsAttributesDirty():R._syncGeometryWithMorphTargetManager())}synchronize(){var Z;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Z=this._targetStoreTexture)||void 0===Z||Z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const L of this._targets){this._supportsPositions=this._supportsPositions&&L.hasPositions,this._supportsNormals=this._supportsNormals&&L.hasNormals,this._supportsTangents=this._supportsTangents&&L.hasTangents,this._supportsUVs=this._supportsUVs&&L.hasUVs,this._supportsUV2s=this._supportsUV2s&&L.hasUV2s,this._supportsColors=this._supportsColors&&L.hasColors;const Z=L.vertexCount;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void q.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${L.name}": ${Z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Z=c.getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);const L=this._targets.length,k=new Float32Array(L*this._textureWidth*this._textureHeight*4);let N=0;for(let c=0;c<L;c++){const Z=this._targets[c],L=Z.getPositions(),R=Z.getNormals(),G=Z.getUVs(),V=Z.getTangents(),p=Z.getUV2s(),J=Z.getColors();N=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&L&&(k[N]=L[3*c],k[N+1]=L[3*c+1],k[N+2]=L[3*c+2],N+=4),this._supportsNormals&&R&&(k[N]=R[3*c],k[N+1]=R[3*c+1],k[N+2]=R[3*c+2],N+=4),this._supportsUVs&&G&&(k[N]=G[2*c],k[N+1]=G[2*c+1],N+=4),this._supportsTangents&&V&&(k[N]=V[3*c],k[N+1]=V[3*c+1],k[N+2]=V[3*c+2],N+=4),this._supportsUV2s&&p&&(k[N]=p[2*c],k[N+1]=p[2*c+1],N+=4),this._supportsColors&&J&&(k[N]=J[4*c],k[N+1]=J[4*c+1],k[N+2]=J[4*c+2],k[N+3]=J[4*c+3],N+=4)}this._targetStoreTexture=H.c.CreateRGBATexture(k,this._textureWidth,this._textureHeight,L,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const L of this._scene.meshes)L.morphTargetManager===this&&L._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}for(const Z of this._targets)this._scene.stopAnimation(Z)}}static Parse(Z,c){const L=new l(c);for(const k of Z.targets)L.addTarget(D.e.Parse(k,c));return L}}l.EnableTextureStorage=!0,l.MaxActiveMorphTargetsInVertexAttributeMode=8,l.ConstantTargetCountForTextureMode=0;var W=L(12754),T=L(11081),I=L(11205);const d=new Map,Q=d;function r(Z,c,L){f(Z)&&q.e.Warn(`Extension with the name '${Z}' already exists`),d.set(Z,{isGLTFExtension:c,factory:L})}function f(Z){return d.delete(Z)}var S=L(12760),s=L(11787),m=L(11197);class A{static Get(Z,c,L){if(!c||void 0==L||!c[L])throw new Error(`${Z}: Failed to find index (${L})`);return c[L]}static TryGet(Z,c){return Z&&void 0!=c&&Z[c]?Z[c]:null}static Assign(Z){if(Z)for(let c=0;c<Z.length;c++)Z[c].index=c}}function b(Z){if(Z.min&&Z.max){const c=Z.min,L=Z.max,k=N.d.Mc[0].wc(c[0],c[1],c[2]),R=N.d.Mc[1].wc(L[0],L[1],L[2]);if(Z.normalized&&5126!==Z.componentType){let c=1;switch(Z.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const L=1/c;k.scaleInPlace(L),R.scaleInPlace(L)}return new I.e(k,R)}return null}class F{static RegisterExtension(Z,c){r(Z,!1,c)}static UnregisterExtension(Z){return f(Z)}get Bc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Z=>Z.dispose&&Z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Z,c,L,k,N,R){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=L,this._loadData(k);let R=null;if(Z){const c={};if(this._gltf.nodes)for(const Z of this._gltf.nodes)Z.name&&(c[Z.name]=Z.index);R=(Z instanceof Array?Z:[Z]).map((Z=>{const L=c[Z];if(void 0===L)throw new Error(`Failed to find node '${Z}'`);return L}))}return await this._loadAsync(N,G,R,(()=>({meshes:this._getMeshes(),si:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Z,this._loadData(c),await this._loadAsync(L,N,null,(()=>{}))}async _loadAsync(Z,c,L,k){return await Promise.resolve().then((async()=>{this._rootUrl=Z,this._uniqueRootUrl=!Z.startsWith("file:")&&c?Z:`${Z}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const N=`${W.j[W.j.LOADING]} => ${W.j[W.j.READY]}`,R=`${W.j[W.j.LOADING]} => ${W.j[W.j.COMPLETE]}`;this._parent._startPerformanceCounter(N),this._parent._startPerformanceCounter(R),this._parent._setState(W.j.LOADING),this._extensionsOnLoading();const V=new Array;if(!this.parent.loadOnlyMaterials)if(L)V.push(this.loadSceneAsync("/nodes",{nodes:L,index:-1}));else if(void 0!=this._gltf.LL||this._gltf.scenes&&this._gltf.scenes[0]){const Z=A.Get("/scene",this._gltf.scenes,this._gltf.LL||0);V.push(this.loadSceneAsync(`/scenes/${Z.index}`,Z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Z=0;Z<this._gltf.materials.length;++Z){const c=this._gltf.materials[Z],L="/materials/"+Z,k=M.e.TriangleFillMode;V.push(this._loadMaterialAsync(L,c,null,k,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&V.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&V.push(this._compileShadowGeneratorsAsync());const p=Promise.all(V).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.lV(!0);for(const Z of this._babylonScene.materials){const c=Z;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(W.j.READY),this._skipStartAnimationStep||this._startAnimations(),k()}));return await p.then((Z=>(this._parent._endPerformanceCounter(N),G.c.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(R),this._parent._setState(W.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Z=>{this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()}))})),Z)))})).catch((Z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()),Z}))}_loadData(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const L=c[0];(L.byteLength<Z.bin.byteLength-3||L.byteLength>Z.bin.byteLength)&&q.e.Warn(`Binary buffer length (${L.byteLength}) from JSON does not match chunk length (${Z.bin.byteLength})`),this._bin=Z.bin}else q.e.Warn("Unexpected BIN chunk")}}_setupData(){if(A.Assign(this._gltf.accessors),A.Assign(this._gltf.animations),A.Assign(this._gltf.buffers),A.Assign(this._gltf.bufferViews),A.Assign(this._gltf.cameras),A.Assign(this._gltf.images),A.Assign(this._gltf.materials),A.Assign(this._gltf.meshes),A.Assign(this._gltf.nodes),A.Assign(this._gltf.samplers),A.Assign(this._gltf.scenes),A.Assign(this._gltf.skins),A.Assign(this._gltf.textures),this._gltf.nodes){const Z={};for(const L of this._gltf.nodes)if(L.children)for(const c of L.children)Z[c]=L.index;const c=this._createRootNode();for(const L of this._gltf.nodes){const k=Z[L.index];L.parent=void 0===k?c:this._gltf.nodes[k]}}}async _loadExtensionsAsync(){const Z=[];if(Q.forEach(((c,L)=>{var k;!1===(null===(k=this.parent.extensionOptions[L])||void 0===k?void 0:k.enabled)?c.isGLTFExtension&&this.isExtensionUsed(L)&&q.e.Warn(`Extension ${L} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(L)||Z.push((async()=>{const Z=await c.factory(this);return Z.name!==L&&q.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Z.name} !== ${L}`),this._parent.onExtensionLoadedObservable.notifyObservers(Z),Z})())})),this._extensions.push(...await Promise.all(Z)),this._extensions.sort(((Z,c)=>(Z.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const L of this._gltf.extensionsRequired){if(!this._extensions.some((Z=>Z.name===L&&Z.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[L])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${L} is disabled`);throw new Error(`Required extension ${L} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new B.c("__root__",this._babylonScene);this._rootBabylonMesh=Z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.lV(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case W.h.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],F._LoadTransform(c,this._rootBabylonMesh));break;case W.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Z),c}loadSceneAsync(Z,c){const L=this._extensionsLoadSceneAsync(Z,c);if(L)return L;const k=new Array;if(this.logOpen(`${Z} ${c.name||""}`),c.nodes)for(const N of c.nodes){const c=A.Get(`${Z}/nodes/${N}`,this._gltf.nodes,N);k.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(Z=>{Z.parent=this._rootBabylonMesh})))}for(const N of this._postSceneLoadActions)N();return k.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(k).then((()=>{}))}_forEachPrimitive(Z,c){if(Z._primitiveBabylonMeshes)for(const L of Z._primitiveBabylonMeshes)c(L)}_getGeometries(){const Z=[],c=this._gltf.nodes;if(c)for(const L of c)this._forEachPrimitive(L,(c=>{const L=c.zc;L&&-1===Z.indexOf(L)&&Z.push(L)}));return Z}_getMeshes(){const Z=[];this._rootBabylonMesh instanceof h.d&&Z.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const L of c)this._forEachPrimitive(L,(c=>{Z.push(c)}));return Z}_getTransformNodes(){const Z=[],c=this._gltf.nodes;if(c)for(const L of c)L._babylonTransformNode&&"Ac"===L._babylonTransformNode.getClassName()&&Z.push(L._babylonTransformNode),L._babylonTransformNodeForSkin&&Z.push(L._babylonTransformNodeForSkin);return Z}_getSkeletons(){const Z=[],c=this._gltf.skins;if(c)for(const L of c)L._data&&Z.push(L._data.babylonSkeleton);return Z}_getAnimationGroups(){const Z=[],c=this._gltf.animations;if(c)for(const L of c)L._babylonAnimationGroup&&Z.push(L._babylonAnimationGroup);return Z}_startAnimations(){switch(this._parent.animationStartMode){case W.g.NONE:break;case W.g.FIRST:{const Z=this._getAnimationGroups();0!==Z.length&&Z[0].start(!0);break}case W.g.ALL:{const Z=this._getAnimationGroups();for(const c of Z)c.start(!0);break}default:return void q.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadNodeAsync(Z,c,L);if(k)return k;if(c._babylonTransformNode)throw new Error(`${Z}: Invalid recursive node hierarchy`);const N=new Array;this.logOpen(`${Z} ${c.name||""}`);const R=k=>{if(F.AddPointerMetadata(k,Z),F._LoadTransform(c,k),void 0!=c.camera){const L=A.Get(`${Z}/camera`,this._gltf.cameras,c.camera);N.push(this.loadCameraAsync(`/cameras/${L.index}`,L,(Z=>{Z.parent=k,this._babylonScene.useRightHandedSystem||(k.Pc.x=-1)})))}if(c.children)for(const L of c.children){const c=A.Get(`${Z}/children/${L}`,this._gltf.nodes,L);N.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(Z=>{Z.parent=k})))}L(k)},G=void 0!=c.mesh,V=this._parent.loadSkins&&void 0!=c.skin;if(!G||V){const Z=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new o.e(Z,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=L:c._babylonTransformNodeForSkin=L,R(L)}if(G)if(V){const L=A.Get(`${Z}/mesh`,this._gltf.meshes,c.mesh);N.push(this._loadMeshAsync(`/meshes/${L.index}`,c,L,(L=>{const k=c._babylonTransformNodeForSkin;L.metadata=(0,s.e)(k.metadata,L.metadata||{});const R=A.Get(`${Z}/skin`,this._gltf.skins,c.skin);N.push(this._loadSkinAsync(`/skins/${R.index}`,c,R,(Z=>{this._forEachPrimitive(c,(c=>{c.skeleton=Z})),this._postSceneLoadActions.push((()=>{if(void 0!=R.skeleton){const Z=A.Get(`/skins/${R.index}/skeleton`,this._gltf.nodes,R.skeleton).parent;c.index===Z.index?L.parent=k.parent:L.parent=Z._babylonTransformNode}else L.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:k,skinnedNode:L})}))})))})))}else{const L=A.Get(`${Z}/mesh`,this._gltf.meshes,c.mesh);N.push(this._loadMeshAsync(`/meshes/${L.index}`,c,L,R))}return this.logClose(),Promise.all(N).then((()=>(this._forEachPrimitive(c,(Z=>{const c=Z;!c.isAnInstance&&c.zc&&c.zc.useBoundingInfoFromGeometry?Z.IZ():Z.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(Z,c,L,k){const N=L.primitives;if(!N||!N.length)throw new Error(`${Z}: Primitives are missing`);void 0==N[0].index&&A.Assign(N);const R=new Array;this.logOpen(`${Z} ${L.name||""}`);const G=c.name||`node${c.index}`;if(1===N.length){const k=L.primitives[0];R.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${k.index}`,G,c,L,k,(Z=>{c._babylonTransformNode=Z,c._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new o.e(G,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const k of N)R.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${k.index}`,`${G}_primitive${k.index}`,c,L,k,(Z=>{Z.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(Z)})))}return k(c._babylonTransformNode),this.logClose(),Promise.all(R).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(Z,c,L,k,N,R){const G=this._extensionsLoadMeshPrimitiveAsync(Z,c,L,k,N,R);if(G)return G;this.logOpen(`${Z}`);const V=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==L.skin&&!k.primitives[0].targets;let p,J;if(V&&N._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,p=N._instanceData.babylonSourceMesh.createInstance(c),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=N._instanceData.promise;else{const R=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new B.c(c,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.sideOrientation=this._babylonScene.useRightHandedSystem?M.e.CounterClockWiseSideOrientation:M.e.ClockWiseSideOrientation,this._createMorphTargets(Z,L,k,N,G),R.push(this._loadVertexDataAsync(Z,N,G).then((async c=>await this._loadMorphTargetsAsync(Z,N,G,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.WZ(G),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const z=F._GetDrawMode(Z,N.mode);if(void 0==N.material){let Z=this._defaultBabylonMaterialData[z];Z||(Z=this._createDefaultMaterial("__GLTFLoader._default",z),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this._defaultBabylonMaterialData[z]=Z),G.material=Z}else if(!this.parent.skipMaterials){const c=A.Get(`${Z}/material`,this._gltf.materials,N.material);R.push(this._loadMaterialAsync(`/materials/${c.index}`,c,G,z,(Z=>{G.material=Z})))}J=Promise.all(R),V&&(N._instanceData={babylonSourceMesh:G,promise:J}),p=G}return F.AddPointerMetadata(p,Z),this._parent.onMeshLoadedObservable.notifyObservers(p),R(p),this.logClose(),J.then((()=>p))}_loadVertexDataAsync(Z,c,L){const k=this._extensionsLoadVertexDataAsync(Z,c,L);if(k)return k;const N=c.attributes;if(!N)throw new Error(`${Z}: Attributes are missing`);const R=new Array,G=new X.e(L.name,this._babylonScene);if(void 0==c.indices)L.isUnIndexed=!0;else{const L=A.Get(`${Z}/indices`,this._gltf.accessors,c.indices);R.push(this._loadIndicesAccessorAsync(`/accessors/${L.index}`,L).then((Z=>{G.setIndices(Z)})))}const V=(c,k,V)=>{if(void 0==N[c])return;L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(k)&&L._delayInfo.push(k);const p=A.Get(`${Z}/attributes/${c}`,this._gltf.accessors,N[c]);R.push(this._loadVertexAccessorAsync(`/accessors/${p.index}`,p,k).then((Z=>{if(Z.getKind()===u.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!L.skeleton){const Z=b(p);Z&&(G._boundingInfo=Z,G.useBoundingInfoFromGeometry=!0)}G.setVerticesBuffer(Z,p.count)}))),k==u.g.MatricesIndicesExtraKind&&(L.numBoneInfluencers=8),V&&V(p)};return V("POSITION",u.g.PositionKind),V("NORMAL",u.g.NormalKind),V("TANGENT",u.g.TangentKind),V("TEXCOORD_0",u.g.UVKind),V("TEXCOORD_1",u.g.UV2Kind),V("TEXCOORD_2",u.g.UV3Kind),V("TEXCOORD_3",u.g.UV4Kind),V("TEXCOORD_4",u.g.UV5Kind),V("TEXCOORD_5",u.g.UV6Kind),V("JOINTS_0",u.g.MatricesIndicesKind),V("WEIGHTS_0",u.g.MatricesWeightsKind),V("JOINTS_1",u.g.MatricesIndicesExtraKind),V("WEIGHTS_1",u.g.MatricesWeightsExtraKind),V("COLOR_0",u.g.ColorKind,(Z=>{"VEC4"===Z.type&&(L.hasVertexAlpha=!0)})),Promise.all(R).then((()=>G))}_createMorphTargets(Z,c,L,k,N){if(!k.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=k.targets.length;else if(k.targets.length!==c._numMorphTargets)throw new Error(`${Z}: Primitives do not have the same number of targets`);const R=L.extras?L.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,N.morphTargetManager=new l(this._babylonScene),N.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.morphTargetManager.areUpdatesFrozen=!0;for(let G=0;G<k.targets.length;G++){const Z=c.weights?c.weights[G]:L.weights?L.weights[G]:0,k=R?R[G]:`morphTarget${G}`;N.morphTargetManager.addTarget(new D.e(k,Z,N.XZ()))}}_loadMorphTargetsAsync(Z,c,L,k){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const N=new Array,R=L.morphTargetManager;for(let G=0;G<R.numTargets;G++){const L=R.getTarget(G);N.push(this._loadMorphTargetVertexDataAsync(`${Z}/targets/${G}`,k,c.targets[G],L))}return Promise.all(N).then((()=>{R.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Z,c,L,k){const N=new Array,R=(k,R,G)=>{if(void 0==L[k])return;const V=c.getVertexBuffer(R);if(!V)return;const p=A.Get(`${Z}/${k}`,this._gltf.accessors,L[k]);N.push(this._loadFloatAccessorAsync(`/accessors/${p.index}`,p).then((Z=>{G(V,Z)})))};return R("POSITION",u.g.PositionKind,((Z,c)=>{const L=new Float32Array(c.length);Z.forEach(c.length,((Z,k)=>{L[k]=c[k]+Z})),k.setPositions(L)})),R("NORMAL",u.g.NormalKind,((Z,c)=>{const L=new Float32Array(c.length);Z.forEach(L.length,((Z,k)=>{L[k]=c[k]+Z})),k.setNormals(L)})),R("TANGENT",u.g.TangentKind,((Z,c)=>{const L=new Float32Array(c.length/3*4);let N=0;Z.forEach(c.length/3*4,((Z,k)=>{(k+1)%4!==0&&(L[N]=c[N]+Z,N++)})),k.setTangents(L)})),R("TEXCOORD_0",u.g.UVKind,((Z,c)=>{const L=new Float32Array(c.length);Z.forEach(c.length,((Z,k)=>{L[k]=c[k]+Z})),k.setUVs(L)})),R("TEXCOORD_1",u.g.UV2Kind,((Z,c)=>{const L=new Float32Array(c.length);Z.forEach(c.length,((Z,k)=>{L[k]=c[k]+Z})),k.setUV2s(L)})),R("COLOR_0",u.g.ColorKind,((c,L)=>{let N=null;const R=c.getSize();if(3===R){N=new Float32Array(L.length/3*4),c.forEach(L.length,((Z,c)=>{const k=Math.floor(c/3),R=c%3;N[4*k+R]=L[3*k+R]+Z}));for(let Z=0;Z<L.length/3;++Z)N[4*Z+3]=1}else{if(4!==R)throw new Error(`${Z}: Invalid number of components (${R}) for COLOR_0 attribute`);N=new Float32Array(L.length),c.forEach(L.length,((Z,c)=>{N[c]=L[c]+Z}))}k.setColors(N)})),await Promise.all(N).then((()=>{}))}static _LoadTransform(Z,c){if(void 0!=Z.skin)return;let L=N.h.Zero(),k=N.c.Identity(),R=N.h.One();if(Z.matrix){N.b.oc(Z.matrix).decompose(R,k,L)}else Z.translation&&(L=N.h.oc(Z.translation)),Z.rotation&&(k=N.c.oc(Z.rotation)),Z.scale&&(R=N.h.oc(Z.scale));c.position=L,c.rotationQuaternion=k,c.Pc=R}_loadSkinAsync(Z,c,L,k){if(!this._parent.loadSkins)return Promise.resolve();const N=this._extensionsLoadSkinAsync(Z,c,L);if(N)return N;if(L._data)return k(L._data.babylonSkeleton),L._data.promise;const R=`skeleton${L.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new w(L.name||R,R,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,L,G);const V=this._loadSkinInverseBindMatricesDataAsync(Z,L).then((Z=>{this._updateBoneMatrices(G,Z)}));return L._data={babylonSkeleton:G,promise:V},k(G),V}_loadBones(Z,c,L){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const L=this._findSkeletonRootNode(`${Z}/joints`,c.joints);if(L)if(void 0===c.skeleton)c.skeleton=L.index;else{const k=(Z,c)=>{for(;c.parent;c=c.parent)if(c.parent===Z)return!0;return!1},N=A.Get(`${Z}/skeleton`,this._gltf.nodes,c.skeleton);N===L||k(N,L)||(q.e.Warn(`${Z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=L.index)}else q.e.Warn(`${Z}: Failed to find common root`)}const k={};for(const N of c.joints){const R=A.Get(`${Z}/joints/${N}`,this._gltf.nodes,N);this._loadBone(R,c,L,k)}}_findSkeletonRootNode(Z,c){if(0===c.length)return null;const L={};for(const N of c){const c=[];let k=A.Get(`${Z}/${N}`,this._gltf.nodes,N);for(;-1!==k.index;)c.unshift(k),k=k.parent;L[N]=c}let k=null;for(let N=0;;++N){let Z=L[c[0]];if(N>=Z.length)return k;const R=Z[N];for(let G=1;G<c.length;++G)if(Z=L[c[G]],N>=Z.length||R!==Z[N])return k;k=R}}_loadBone(Z,c,L,k){Z._isJoint=!0;let N=k[Z.index];if(N)return N;let R=null;Z.index!==c.skeleton&&(Z.parent&&-1!==Z.parent.index?R=this._loadBone(Z.parent,c,L,k):void 0!==c.skeleton&&q.e.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const G=c.joints.indexOf(Z.index);return N=new J.e(Z.name||`joint${Z.index}`,L,R,this._getNodeMatrix(Z),null,null,G),k[Z.index]=N,this._postSceneLoadActions.push((()=>{N.linkTransformNode(Z._babylonTransformNode)})),N}_loadSkinInverseBindMatricesDataAsync(Z,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const L=A.Get(`${Z}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)}_updateBoneMatrices(Z,c){for(const L of Z.bones){const Z=N.b.Identity(),k=L._index;c&&-1!==k&&(N.b.FromArrayToRef(c,16*k,Z),Z.invertToRef(Z));const R=L.getParent();R&&Z.multiplyToRef(R.getAbsoluteInverseBindMatrix(),Z),L.hc(Z,!1,!1),L._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Z){return Z.matrix?N.b.oc(Z.matrix):N.b.Compose(Z.scale?N.h.oc(Z.scale):N.h.One(),Z.rotation?N.c.oc(Z.rotation):N.c.Identity(),Z.translation?N.h.oc(Z.translation):N.h.Zero())}loadCameraAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadCameraAsync(Z,c,L);if(k)return k;const R=new Array;this.logOpen(`${Z} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new p.c(c.name||`camera${c.index}`,N.h.Zero(),this._babylonScene,!1);switch(G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=G,G.setTarget(new N.h(0,0,-1)),c.type){case"perspective":{const L=c.perspective;if(!L)throw new Error(`${Z}: Camera perspective properties are missing`);G.fov=L.yfov,G.Dc=L.znear,G.maxZ=L.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${Z}: Camera orthographic properties are missing`);G.mode=V.d.ORTHOGRAPHIC_CAMERA,G.orthoLeft=-c.orthographic.xmag,G.orthoRight=c.orthographic.xmag,G.orthoBottom=-c.orthographic.ymag,G.orthoTop=c.orthographic.ymag,G.Dc=c.orthographic.znear,G.maxZ=c.orthographic.zfar;break;default:throw new Error(`${Z}: Invalid camera type (${c.type})`)}return F.AddPointerMetadata(G,Z),this._parent.onCameraLoadedObservable.notifyObservers(G),L(G),this.logClose(),Promise.all(R).then((()=>G))}_loadAnimationsAsync(){const Z=this._gltf.animations;if(!Z)return Promise.resolve();const c=new Array;for(let L=0;L<Z.length;L++){const k=Z[L];c.push(this.loadAnimationAsync(`/animations/${k.index}`,k).then((Z=>{0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(Z,c){const k=this._extensionsLoadAnimationAsync(Z,c);return k||L.e(58).then(L.bind(L,14296)).then((L=>{let{AnimationGroup:k}=L;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new k(c.name||`animation${c.index}`,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=N;const R=new Array;A.Assign(c.channels),A.Assign(c.samplers);for(const G of c.channels)R.push(this._loadAnimationChannelAsync(`${Z}/channels/${G.index}`,Z,c,G,((Z,c)=>{Z.animations=Z.animations||[],Z.animations.push(c),N.addTargetedAnimation(c,Z)})));return Promise.all(R).then((()=>(N.normalize(0),N)))}))}async _loadAnimationChannelAsync(Z,c,k,N,R){const G=this._extensionsLoadAnimationChannelAsync(Z,c,k,N,R);if(G)return await G;if(void 0==N.target.node)return await Promise.resolve();const V=A.Get(`${Z}/target/node`,this._gltf.nodes,N.target.node),p=N.target.path,J="weights"===p;if(J&&!V._numMorphTargets||!J&&!V._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!V._isJoint)return await Promise.resolve();let z;switch(await Promise.resolve().then(L.bind(L,12775)),p){case"translation":var i;z=null===(i=(0,S.f)("/nodes/{}/translation"))||void 0===i?void 0:i.interpolation;break;case"rotation":var t;z=null===(t=(0,S.f)("/nodes/{}/rotation"))||void 0===t?void 0:t.interpolation;break;case"scale":var E;z=null===(E=(0,S.f)("/nodes/{}/scale"))||void 0===E?void 0:E.interpolation;break;case"weights":var x;z=null===(x=(0,S.f)("/nodes/{}/weights"))||void 0===x?void 0:x.interpolation;break;default:throw new Error(`${Z}/target/path: Invalid value (${N.target.path})`)}if(!z)throw new Error(`${Z}/target/path: Could not find interpolation properties for target path (${N.target.path})`);const q={object:V,info:z};return await this._loadAnimationChannelFromTargetInfoAsync(Z,c,k,N,q,R)}_loadAnimationChannelFromTargetInfoAsync(Z,c,L,k,N,R){const G=this.parent.targetFps,V=1/G,p=A.Get(`${Z}/sampler`,L.samplers,k.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${k.sampler}`,p).then((Z=>{let c=0;const p=N.object,J=N.info;for(const N of J){const J=N.getStride(p),z=Z.input,i=Z.output,t=new Array(z.length);let E=0;switch(Z.interpolation){case"STEP":for(let Z=0;Z<z.length;Z++){const c=N.getValue(p,i,E,1);E+=J,t[Z]={frame:z[Z]*G,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let Z=0;Z<z.length;Z++){const c=N.getValue(p,i,E,V);E+=J;const L=N.getValue(p,i,E,1);E+=J;const k=N.getValue(p,i,E,V);E+=J,t[Z]={frame:z[Z]*G,inTangent:c,value:L,outTangent:k}}break;case"LINEAR":for(let Z=0;Z<z.length;Z++){const c=N.getValue(p,i,E,1);E+=J,t[Z]={frame:z[Z]*G,value:c}}}if(E>0){const Z=`${L.name||`animation${L.index}`}_channel${k.index}_${c}`,V=N.buildAnimations(p,Z,G,t);for(const L of V)c++,R(L.babylonAnimatable,L.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Z,c){if(c._data)return c._data;const L=c.interpolation||"LINEAR";switch(L){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Z}/interpolation: Invalid value (${c.interpolation})`)}const k=A.Get(`${Z}/input`,this._gltf.accessors,c.input),N=A.Get(`${Z}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${k.index}`,k),this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)]).then((Z=>{let[c,k]=Z;return{input:c,interpolation:L,output:k}})),c._data}loadBufferAsync(Z,c,L,k){const N=this._extensionsLoadBufferAsync(Z,c,L,k);if(N)return N;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${Z}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+L,k)}catch(N){throw new Error(`${Z}: ${N.message}`)}}))}loadBufferViewAsync(Z,c){const L=this._extensionsLoadBufferViewAsync(Z,c);if(L)return L;if(c._data)return c._data;const k=A.Get(`${Z}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${k.index}`,k,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(Z,c,L){if(c._data)return c._data;const k=F._GetNumComponents(Z,c.type),N=k*u.g.GetTypeByteLength(c.componentType),R=k*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new L(R));else{const G=A.Get(`${Z}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((V=>{if(5126!==c.componentType||c.normalized||G.byteStride&&G.byteStride!==N){const Z=new L(R);return u.g.ForEach(V,c.byteOffset||0,G.byteStride||N,k,c.componentType,Z.length,c.normalized||!1,((c,L)=>{Z[L]=c})),Z}return F._GetTypedArray(Z,c.componentType,V,c.byteOffset,R)}))}if(c.sparse){const R=c.sparse;c._data=c._data.then((G=>{const V=G,p=A.Get(`${Z}/sparse/indices/bufferView`,this._gltf.bufferViews,R.indices.bufferView),J=A.Get(`${Z}/sparse/values/bufferView`,this._gltf.bufferViews,R.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${p.index}`,p),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((G=>{let[p,J]=G;const z=F._GetTypedArray(`${Z}/sparse/indices`,R.indices.componentType,p,R.indices.byteOffset,R.count),i=k*R.count;let t;if(5126!==c.componentType||c.normalized){const G=F._GetTypedArray(`${Z}/sparse/values`,c.componentType,J,R.values.byteOffset,i);t=new L(i),u.g.ForEach(G,0,N,k,c.componentType,t.length,c.normalized||!1,((Z,c)=>{t[c]=Z}))}else t=F._GetTypedArray(`${Z}/sparse/values`,c.componentType,J,R.values.byteOffset,i);let E=0;for(let Z=0;Z<z.length;Z++){let c=z[Z]*k;for(let Z=0;Z<k;Z++)V[c++]=t[E++]}return V}))}))}return c._data}_loadFloatAccessorAsync(Z,c){return this._loadAccessorAsync(Z,c,Float32Array)}_loadIndicesAccessorAsync(Z,c){if("SCALAR"!==c.type)throw new Error(`${Z}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${Z}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const L=F._GetTypedArrayConstructor(`${Z}/componentType`,c.componentType);c._data=this._loadAccessorAsync(Z,c,L)}else{const L=A.Get(`${Z}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>F._GetTypedArray(Z,c.componentType,L,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(Z){if(Z._babylonBuffer)return Z._babylonBuffer;const c=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>new u.e(c,Z,!1))),Z._babylonBuffer}_loadVertexAccessorAsync(Z,c,L){var k;if(null!==(k=c._babylonVertexBuffer)&&void 0!==k&&k[L])return c._babylonVertexBuffer[L];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const N=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[L]=this._loadFloatAccessorAsync(Z,c).then((Z=>new u.g(N,Z,L,!1)));else{const k=A.Get(`${Z}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[L]=this._loadVertexBufferViewAsync(k).then((R=>{const G=F._GetNumComponents(Z,c.type);return new u.g(N,R,L,!1,void 0,k.byteStride,void 0,c.byteOffset,G,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[L]}_loadMaterialMetallicRoughnessPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return c&&(c.baseColorFactor?(L.albedoColor=R.d.oc(c.baseColorFactor),L.alpha=c.baseColorFactor[3]):L.albedoColor=R.d.White(),L.metallic=void 0==c.metallicFactor?1:c.metallicFactor,L.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&k.push(this.loadTextureInfoAsync(`${Z}/baseColorTexture`,c.baseColorTexture,(Z=>{Z.name=`${L.name} (Base Color)`,L.albedoTexture=Z}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${Z}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(Z=>{Z.name=`${L.name} (Metallic Roughness)`,L.metallicTexture=Z}))),L.useMetallnessFromMetallicTextureBlue=!0,L.useRoughnessFromMetallicTextureGreen=!0,L.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(k).then((()=>{}))}_loadMaterialAsync(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const R=this._extensionsLoadMaterialAsync(Z,c,L,k,N);if(R)return R;c._data=c._data||{};let G=c._data[k];if(!G){this.logOpen(`${Z} ${c.name||""}`);const L=this.createMaterial(Z,c,k);G={babylonMaterial:L,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Z,c,L)},c._data[k]=G,F.AddPointerMetadata(L,Z),this._parent.onMaterialLoadedObservable.notifyObservers(L),this.logClose()}return L&&(G.babylonMeshes.push(L),L.Xc.addOnce((()=>{const Z=G.babylonMeshes.indexOf(L);-1!==Z&&G.babylonMeshes.splice(Z,1)}))),N(G.babylonMaterial),G.promise.then((()=>G.babylonMaterial))}_createDefaultMaterial(Z,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new P.e(Z,this._babylonScene);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.fillMode=c,L.enableSpecularAntiAliasing=!0,L.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,L.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,L.transparencyMode=P.e.PBRMATERIAL_OPAQUE,L.metallic=1,L.roughness=1,L}createMaterial(Z,c,L){const k=this._extensionsCreateMaterial(Z,c,L);if(k)return k;const N=c.name||`material${c.index}`;return this._createDefaultMaterial(N,L)}loadMaterialPropertiesAsync(Z,c,L){const k=this._extensionsLoadMaterialPropertiesAsync(Z,c,L);if(k)return k;const N=new Array;return N.push(this.loadMaterialBasePropertiesAsync(Z,c,L)),c.pbrMetallicRoughness&&N.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Z}/pbrMetallicRoughness`,c.pbrMetallicRoughness,L)),this.loadMaterialAlphaProperties(Z,c,L),Promise.all(N).then((()=>{}))}loadMaterialBasePropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.emissiveColor=c.emissiveFactor?R.d.oc(c.emissiveFactor):new R.d(0,0,0),c.doubleSided&&(L.Ec=!1,L.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${Z}/normalTexture`,c.normalTexture,(Z=>{Z.name=`${L.name} (Normal)`,L.bumpTexture=Z}))),L.invertNormalMapX=!this._babylonScene.useRightHandedSystem,L.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&L.bumpTexture&&(L.bumpTexture.level=c.normalTexture.scale),L.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${Z}/occlusionTexture`,c.occlusionTexture,(Z=>{Z.name=`${L.name} (Occlusion)`,L.ambientTexture=Z}))),L.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(L.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&k.push(this.loadTextureInfoAsync(`${Z}/emissiveTexture`,c.emissiveTexture,(Z=>{Z.name=`${L.name} (Emissive)`,L.emissiveTexture=Z}))),Promise.all(k).then((()=>{}))}loadMaterialAlphaProperties(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":L.transparencyMode=P.e.PBRMATERIAL_OPAQUE,L.alpha=1;break;case"MASK":L.transparencyMode=P.e.PBRMATERIAL_ALPHATEST,L.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,L.albedoTexture&&(L.albedoTexture.Oc=!0);break;case"BLEND":L.transparencyMode=P.e.PBRMATERIAL_ALPHABLEND,L.albedoTexture&&(L.albedoTexture.Oc=!0,L.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Z}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadTextureInfoAsync(Z,c,L);if(k)return k;if(this.logOpen(`${Z}`),c.texCoord>=6)throw new Error(`${Z}/texCoord: Invalid value (${c.texCoord})`);const N=A.Get(`${Z}/index`,this._gltf.textures,c.index);N._textureInfo=c;const R=this._loadTextureAsync(`/textures/${c.index}`,N,(k=>{k.coordinatesIndex=c.texCoord||0,F.AddPointerMetadata(k,Z),this._parent.onTextureLoadedObservable.notifyObservers(k),L(k)}));return this.logClose(),R}_loadTextureAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadTextureAsync(Z,c,L);if(k)return k;this.logOpen(`${Z} ${c.name||""}`);const N=void 0==c.sampler?F.DefaultSampler:A.Get(`${Z}/sampler`,this._gltf.samplers,c.sampler),R=A.Get(`${Z}/source`,this._gltf.images,c.source),G=this._createTextureAsync(Z,N,R,L,void 0,!c._textureInfo.nonColorData);return this.logClose(),G}_createTextureAsync(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},R=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const V=this._loadSampler(`/samplers/${c.index}`,c),p=new Array,J=new k;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z={noMipmap:V.noMipMaps,invertY:!1,samplingMode:V.samplingMode,v:()=>{this._disposed||J.resolve()},onError:(c,L)=>{this._disposed||J.reject(new Error(`${Z}: ${L&&L.message?L.message:c||"Failed to load texture"}`))},mimeType:L.mimeType??(0,T.g)(L.uri??""),loaderOptions:R,useSRGBBuffer:!!G&&this._parent.useSRGBBuffers},i=new j.c(null,this._babylonScene,z);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.push(J.promise),p.push(this.loadImageAsync(`/images/${L.index}`,L).then((Z=>{const c=L.uri||`${this._fileName}#image${L.index}`,k=`data:${this._uniqueRootUrl}${c}`;i.updateURL(k,Z);const N=i.getInternalTexture();N&&(N.label=L.name)}))),i.wrapU=V.wrapU,i.wrapV=V.wrapV,N(i),this._parent.useGltfTextureNames&&(i.name=L.name||L.uri||`image${L.index}`),Promise.all(p).then((()=>i))}_loadSampler(Z,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:F._GetTextureSamplingMode(Z,c),wrapU:F._GetTextureWrapMode(`${Z}/wrapS`,c.wrapS),wrapV:F._GetTextureWrapMode(`${Z}/wrapT`,c.wrapT)}),c._data}loadImageAsync(Z,c){if(!c._data){if(this.logOpen(`${Z} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${Z}/uri`,c,c.uri);else{const L=A.Get(`${Z}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)}this.logClose()}return c._data}loadUriAsync(Z,c,L){const k=this._extensionsLoadUriAsync(Z,c,L);if(k)return k;if(!F._ValidateUri(L))throw new Error(`${Z}: '${L}' is invalid`);if((0,T.h)(L)){const c=new Uint8Array((0,T.c)(L));return this.log(`${Z}: Decoded ${L.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${Z}: Loading ${L}`),this._parent.preprocessUrlAsync(this._rootUrl+L).then((c=>new Promise(((k,N)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${Z}: Loaded ${L} (${c.byteLength} bytes)`),k(new Uint8Array(c)))}),!0,(c=>{N(new T.l(`${Z}: Failed to load '${L}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(Z,c){Z.metadata=Z.metadata||{};const L=Z._internalMetadata=Z._internalMetadata||{},k=L.Bc=L.Bc||{};(k.pointers=k.pointers||[]).push(c)}static _GetTextureWrapMode(Z,c){switch(c=void 0==c?10497:c){case 33071:return j.c.CLAMP_ADDRESSMODE;case 33648:return j.c.MIRROR_ADDRESSMODE;case 10497:return j.c.WRAP_ADDRESSMODE;default:return q.e.Warn(`${Z}: Invalid value (${c})`),j.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Z,c){const L=void 0==c.magFilter?9729:c.magFilter,k=void 0==c.minFilter?9987:c.minFilter;if(9729===L)switch(k){case 9728:return j.c.LINEAR_NEAREST;case 9729:return j.c.LINEAR_LINEAR;case 9984:return j.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return j.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return j.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return j.c.LINEAR_LINEAR_MIPLINEAR;default:return q.e.Warn(`${Z}/minFilter: Invalid value (${k})`),j.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==L&&q.e.Warn(`${Z}/magFilter: Invalid value (${L})`),k){case 9728:return j.c.NEAREST_NEAREST;case 9729:return j.c.NEAREST_LINEAR;case 9984:return j.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return j.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return j.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return j.c.NEAREST_LINEAR_MIPLINEAR;default:return q.e.Warn(`${Z}/minFilter: Invalid value (${k})`),j.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Z,c){try{return(0,m.r)(c)}catch(L){throw new Error(`${Z}: ${L.message}`)}}static _GetTypedArray(Z,c,L,k,N){const R=L.buffer;k=L.byteOffset+(k||0);const G=F._GetTypedArrayConstructor(`${Z}/componentType`,c),V=u.g.GetTypeByteLength(c);return k%V!==0?(q.e.Warn(`${Z}: Copying buffer as byte offset (${k}) is not a multiple of component type byte length (${V})`),new G(R.slice(k,k+N*V),0)):new G(R,k,N)}static _GetNumComponents(Z,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Z}: Invalid type (${c})`)}static _ValidateUri(Z){return G.c.IsBase64(Z)||-1===Z.indexOf("..")}static _GetDrawMode(Z,c){switch(void 0==c&&(c=4),c){case 0:return M.e.PointListDrawMode;case 1:return M.e.LineListDrawMode;case 2:return M.e.LineLoopDrawMode;case 3:return M.e.LineStripDrawMode;case 4:return M.e.TriangleFillMode;case 5:return M.e.TriangleStripDrawMode;case 6:return M.e.TriangleFanDrawMode}throw new Error(`${Z}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Z=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const L in c._data){const k=c._data[L];for(const c of k.babylonMeshes){c.Jc(!0);const L=k.babylonMaterial;Z.push(L.forceCompilationAsync(c)),Z.push(L.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(Z.push(L.forceCompilationAsync(c,{clipPlane:!0})),Z.push(L.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Z=new Array,c=this._babylonScene.lights;for(const L of c){const c=L.getShadowGenerator();c&&Z.push(c.forceCompilationAsync())}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Z){for(const c of this._extensions)c.enabled&&Z(c)}_applyExtensions(Z,c,L){for(const k of this._extensions)if(k.enabled){const N=`${k.name}.${c}`,R=Z;R._activeLoaderExtensionFunctions=R._activeLoaderExtensionFunctions||{};const G=R._activeLoaderExtensionFunctions;if(!G[N]){G[N]=!0;try{const Z=L(k);if(Z)return Z}finally{delete G[N]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Z=>Z.onLoading&&Z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Z=>Z.onReady&&Z.onReady()))}_extensionsLoadSceneAsync(Z,c){return this._applyExtensions(c,"loadScene",(L=>L.loadSceneAsync&&L.loadSceneAsync(Z,c)))}_extensionsLoadNodeAsync(Z,c,L){return this._applyExtensions(c,"loadNode",(k=>k.loadNodeAsync&&k.loadNodeAsync(Z,c,L)))}_extensionsLoadCameraAsync(Z,c,L){return this._applyExtensions(c,"loadCamera",(k=>k.loadCameraAsync&&k.loadCameraAsync(Z,c,L)))}_extensionsLoadVertexDataAsync(Z,c,L){return this._applyExtensions(c,"loadVertexData",(k=>k._loadVertexDataAsync&&k._loadVertexDataAsync(Z,c,L)))}_extensionsLoadMeshPrimitiveAsync(Z,c,L,k,N,R){return this._applyExtensions(N,"loadMeshPrimitive",(G=>G._loadMeshPrimitiveAsync&&G._loadMeshPrimitiveAsync(Z,c,L,k,N,R)))}_extensionsLoadMaterialAsync(Z,c,L,k,N){return this._applyExtensions(c,"loadMaterial",(R=>R._loadMaterialAsync&&R._loadMaterialAsync(Z,c,L,k,N)))}_extensionsCreateMaterial(Z,c,L){return this._applyExtensions(c,"createMaterial",(k=>k.createMaterial&&k.createMaterial(Z,c,L)))}_extensionsLoadMaterialPropertiesAsync(Z,c,L){return this._applyExtensions(c,"loadMaterialProperties",(k=>k.loadMaterialPropertiesAsync&&k.loadMaterialPropertiesAsync(Z,c,L)))}_extensionsLoadTextureInfoAsync(Z,c,L){return this._applyExtensions(c,"loadTextureInfo",(k=>k.loadTextureInfoAsync&&k.loadTextureInfoAsync(Z,c,L)))}_extensionsLoadTextureAsync(Z,c,L){return this._applyExtensions(c,"loadTexture",(k=>k._loadTextureAsync&&k._loadTextureAsync(Z,c,L)))}_extensionsLoadAnimationAsync(Z,c){return this._applyExtensions(c,"loadAnimation",(L=>L.loadAnimationAsync&&L.loadAnimationAsync(Z,c)))}_extensionsLoadAnimationChannelAsync(Z,c,L,k,N){return this._applyExtensions(L,"loadAnimationChannel",(R=>R._loadAnimationChannelAsync&&R._loadAnimationChannelAsync(Z,c,L,k,N)))}_extensionsLoadSkinAsync(Z,c,L){return this._applyExtensions(L,"loadSkin",(k=>k._loadSkinAsync&&k._loadSkinAsync(Z,c,L)))}_extensionsLoadUriAsync(Z,c,L){return this._applyExtensions(c,"loadUri",(k=>k._loadUriAsync&&k._loadUriAsync(Z,c,L)))}_extensionsLoadBufferViewAsync(Z,c){return this._applyExtensions(c,"loadBufferView",(L=>L.loadBufferViewAsync&&L.loadBufferViewAsync(Z,c)))}_extensionsLoadBufferAsync(Z,c,L,k){return this._applyExtensions(c,"loadBuffer",(N=>N.loadBufferAsync&&N.loadBufferAsync(Z,c,L,k)))}static LoadExtensionAsync(Z,c,L,k){if(!c.extensions)return null;const N=c.extensions[L];return N?k(`${Z}/extensions/${L}`,N):null}static LoadExtraAsync(Z,c,L,k){if(!c.extras)return null;const N=c.extras[L];return N?k(`${Z}/extras/${L}`,N):null}isExtensionUsed(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)}logOpen(Z){this._parent._logOpen(Z)}logClose(){this._parent._logClose()}log(Z){this._parent._log(Z)}startPerformanceCounter(Z){this._parent._startPerformanceCounter(Z)}endPerformanceCounter(Z){this._parent._endPerformanceCounter(Z)}}F.DefaultSampler={index:-1},W.c._CreateGLTF2Loader=Z=>new F(Z);var U=L(12775),K=L(11461),n=L(11242),g=L(12781),y=L(12789);class v extends y.c{constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Z),this._texture=Z.getEngine().createRawCubeTexture(c,L,k,N,R,G,V,p)}update(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Z,c,L,k,N)}updateRGBDAsync(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,g.f)(this._texture,Z,c,L,k).then((()=>{}))}clone(){return n.e.Clone((()=>{const Z=this.XZ(),c=this._texture,L=new v(Z,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&L.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),L}),this)}}const Y="EXT_lights_image_based";class a{constructor(Z){this.name=Y,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Y)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Bc.extensions;if(Z&&Z[this.name]){const c=Z[this.name];this._lights=c.lights}}loadSceneAsync(Z,c){return F.LoadExtensionAsync(Z,c,this.name,(async(L,k)=>{this._loader._allMaterialsDirtyRequired=!0;const N=new Array;N.push(this._loader.loadSceneAsync(Z,c)),this._loader.logOpen(`${L}`);const R=A.Get(`${L}/light`,this._lights,k.Vc);return N.push(this._loadLightAsync(`/extensions/${this.name}/lights/${k.Vc}`,R).then((Z=>{this._loader.babylonScene.environmentTexture=Z}))),this._loader.logClose(),await Promise.all(N).then((()=>{}))}))}_loadLightAsync(Z,c){if(!c._loaded){const L=new Array;this._loader.logOpen(`${Z}`);const k=new Array(c.specularImages.length);for(let N=0;N<c.specularImages.length;N++){const R=c.specularImages[N];k[N]=new Array(R.length);for(let c=0;c<R.length;c++){const G=`${Z}/specularImages/${N}/${c}`;this._loader.logOpen(`${G}`);const V=R[c],p=A.Get(G,this._loader.Bc.images,V);L.push(this._loader.loadImageAsync(`/images/${V}`,p).then((Z=>{k[N][c]=Z}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(L).then((async()=>{const L=new v(this._loader.babylonScene,null,c.specularImageSize);if(L.name=c.name||"environment",c._babylonTexture=L,void 0!=c.Qc&&(L.level=c.Qc),c.rotation){let Z=N.c.oc(c.rotation);this._loader.babylonScene.useRightHandedSystem||(Z=N.c.Inverse(Z)),N.b.FromQuaternionToRef(Z,L.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${Z}: Irradiance coefficients are missing`);const R=K.c.oc(c.irradianceCoefficients);R.scaleInPlace(c.Qc),R.convertIrradianceToLambertianRadiance();const G=K.d.FromHarmonics(R),V=(k.length-1)/Math.log2(c.specularImageSize);return await L.updateRGBDAsync(k,G,V)}))}return c._loaded.then((()=>c._babylonTexture))}}f(Y),r(Y,!0,(Z=>new a(Z)));L(11760);const C="EXT_mesh_gpu_instancing";class ZZ{constructor(Z){this.name=C,this._loader=Z,this.enabled=this._loader.isExtensionUsed(C)}dispose(){this._loader=null}loadNodeAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(Z,k)=>{this._loader._disableInstancedMesh++;const R=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,L);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await R;const G=new Array;let V=0;const p=c=>{if(void 0==k.attributes[c])return void G.push(Promise.resolve(null));const L=A.Get(`${Z}/attributes/${c}`,this._loader.Bc.accessors,k.attributes[c]);if(G.push(this._loader._loadFloatAccessorAsync(`/accessors/${L.bufferView}`,L)),0===V)V=L.count;else if(V!==L.count)throw new Error(`${Z}/attributes: Instance buffer accessors do not have the same count.`)};return p("TRANSLATION"),p("ROTATION"),p("SCALE"),await R.then((async Z=>{const[L,k,R]=await Promise.all(G),p=new Float32Array(16*V);N.d.Mc[0].wc(0,0,0),N.d.Quaternion[0].wc(0,0,0,1),N.d.Mc[1].wc(1,1,1);for(let c=0;c<V;++c)L&&N.h.FromArrayToRef(L,3*c,N.d.Mc[0]),k&&N.c.FromArrayToRef(k,4*c,N.d.Quaternion[0]),R&&N.h.FromArrayToRef(R,3*c,N.d.Mc[1]),N.b.ComposeToRef(N.d.Mc[1],N.d.Quaternion[0],N.d.Mc[0],N.d.Matrix[0]),N.d.Matrix[0].copyToArray(p,16*c);for(const N of c._primitiveBabylonMeshes)N.ki("matrix",p,16,!0);return Z}))}))}}f(C),r(C,!0,(Z=>new ZZ(Z)));let cZ=0,LZ=null;class kZ{static get Default(){return kZ._Default||(kZ._Default=new kZ),kZ._Default}constructor(){const Z=kZ.Configuration.decoder;this._decoderModulePromise=G.c.LoadBabylonScriptAsync(Z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Z,c,L,k,N){await this._decoderModulePromise,0===cZ&&(MeshoptDecoder.useWorkers(1),cZ=1);const R=await MeshoptDecoder.decodeGltfBufferAsync(c,L,Z,k,N);return null!==LZ&&clearTimeout(LZ),LZ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),cZ=0,LZ=null}),1e3),R}}kZ.Configuration={decoder:{url:`${G.c._DefaultCdnUrl}/meshopt_decoder.js`}},kZ._Default=null;const NZ="EXT_meshopt_compression";class RZ{constructor(Z){this.name=NZ,this.enabled=Z.isExtensionUsed(NZ),this._loader=Z}dispose(){this._loader=null}loadBufferViewAsync(Z,c){return F.LoadExtensionAsync(Z,c,this.name,(async(L,k)=>{const N=c;if(N._meshOptData)return await N._meshOptData;const R=A.Get(`${Z}/buffer`,this._loader.Bc.buffers,k.buffer);return N._meshOptData=this._loader.loadBufferAsync(`/buffers/${R.index}`,R,k.byteOffset||0,k.byteLength).then((async Z=>await kZ.Default.decodeGltfBufferAsync(Z,k.count,k.byteStride,k.mode,k.filter))),await N._meshOptData}))}}f(NZ),r(NZ,!0,(Z=>new RZ(Z)));const GZ="EXT_texture_webp";class VZ{constructor(Z){this.name=GZ,this._loader=Z,this.enabled=Z.isExtensionUsed(GZ)}dispose(){this._loader=null}_loadTextureAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=void 0==c.sampler?F.DefaultSampler:A.Get(`${Z}/sampler`,this._loader.Bc.samplers,c.sampler),G=A.Get(`${k}/source`,this._loader.Bc.images,N.source);return await this._loader._createTextureAsync(Z,R,G,(Z=>{L(Z)}),void 0,!c._textureInfo.nonColorData)}))}}f(GZ),r(GZ,!0,(Z=>new VZ(Z)));const pZ="EXT_texture_avif";class JZ{constructor(Z){this.name=pZ,this._loader=Z,this.enabled=Z.isExtensionUsed(pZ)}dispose(){this._loader=null}_loadTextureAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=void 0==c.sampler?F.DefaultSampler:A.Get(`${Z}/sampler`,this._loader.Bc.samplers,c.sampler),G=A.Get(`${k}/source`,this._loader.Bc.images,N.source);return await this._loader._createTextureAsync(Z,R,G,(Z=>{L(Z)}),void 0,!c._textureInfo.nonColorData)}))}}f(pZ),r(pZ,!0,(Z=>new JZ(Z)));var zZ=L(12766),iZ=L(11732);const tZ="EXT_lights_ies";class EZ{constructor(Z){this.name=tZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(tZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Bc.extensions;if(Z&&Z[this.name]){const c=Z[this.name];this._lights=c.lights,A.Assign(this._lights)}}loadNodeAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,G)=>{let V,p;this._loader._allMaterialsDirtyRequired=!0;const J=await this._loader.loadNodeAsync(Z,c,(Z=>{p=A.Get(k,this._lights,G.Vc);const c=p.name||Z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,V=new zZ.e(c,N.h.Zero(),N.h.Backward(),0,1,this._loader.babylonScene),V.angle=Math.PI/2,V.innerAngle=0,V._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=V,V.falloffType=iZ.e.FALLOFF_GLTF,V.rc=G.color?R.d.oc(G.color):R.d.White(),V.Qc=G.multiplier||1,V.range=Number.MAX_VALUE,V.parent=Z,this._loader._babylonLights.push(V),F.AddPointerMetadata(V,k),L(Z)}));let z;if(p.uri)z=await this._loader.loadUriAsync(Z,p,p.uri);else{const c=A.Get(`${Z}/bufferView`,this._loader.Bc.bufferViews,p.bufferView);z=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return V.iesProfileTexture=new j.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,z,!0,void 0,void 0,void 0,void 0,".ies"),J}))}}f(tZ),r(tZ,!0,(Z=>new EZ(Z)));var xZ=L(12795);const qZ="KHR_draco_mesh_compression";class OZ{constructor(Z){this.name=qZ,this.useNormalizedFlagFromAccessor=!0,this._loader=Z,this.enabled=xZ.c.DefaultAvailable&&this._loader.isExtensionUsed(qZ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${Z}: Unsupported mode ${c.mode}`);const R={},G={},V=(Z,k)=>{const V=N.attributes[Z];if(void 0!=V&&(L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(k)&&L._delayInfo.push(k),R[k]=V,this.useNormalizedFlagFromAccessor)){const L=A.TryGet(this._loader.Bc.accessors,c.attributes[Z]);L&&(G[k]=L.normalized||!1)}};V("POSITION",u.g.PositionKind),V("NORMAL",u.g.NormalKind),V("TANGENT",u.g.TangentKind),V("TEXCOORD_0",u.g.UVKind),V("TEXCOORD_1",u.g.UV2Kind),V("TEXCOORD_2",u.g.UV3Kind),V("TEXCOORD_3",u.g.UV4Kind),V("TEXCOORD_4",u.g.UV5Kind),V("TEXCOORD_5",u.g.UV6Kind),V("JOINTS_0",u.g.MatricesIndicesKind),V("WEIGHTS_0",u.g.MatricesWeightsKind),V("COLOR_0",u.g.ColorKind);const p=A.Get(k,this._loader.Bc.bufferViews,N.bufferView);return p._dracoBabylonGeometry||(p._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((async k=>{const N=this.dracoDecoder||xZ.c.Default,V=A.TryGet(this._loader.Bc.accessors,c.attributes.POSITION),p=this._loader.parent.alwaysComputeBoundingBox||L.skeleton||!V?null:b(V);return await N._decodeMeshToGeometryForGltfAsync(L.name,this._loader.babylonScene,k,R,G,p).catch((c=>{throw new Error(`${Z}: ${c.message}`)}))}))),await p._dracoBabylonGeometry}))}}f(qZ),r(qZ,!0,(Z=>new OZ(Z)));var wZ=L(12802),MZ=L(11170),PZ=L(11173),jZ=L(11277),oZ=L(11792),uZ=L(11012);jZ.b.AddNodeConstructor("Light_Type_0",((Z,c)=>()=>new XZ(Z,N.h.Zero(),c)));class XZ extends oZ.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Z){const c=this.needCube();if(this._direction=Z,this.needCube()!==c&&this._shadowGenerators){const Z=this._shadowGenerators.values();for(let c=Z.next();!0!==c.done;c=Z.next()){c.value.recreateShadowMap()}}}constructor(Z,c,L){super(Z,L),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return iZ.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Z){if(this.direction)return super.getShadowDirection(Z);switch(Z){case 0:return new N.h(1,0,0);case 1:return new N.h(-1,0,0);case 2:return new N.h(0,-1,0);case 3:return new N.h(0,1,0);case 4:return new N.h(0,0,1);case 5:return new N.h(0,0,-1)}return N.h.Zero()}_setDefaultShadowProjectionMatrix(Z,c,L){const k=this.XZ().activeCamera;if(!k)return;const R=void 0!==this.shadowMinZ?this.shadowMinZ:k.Dc,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,V=this.XZ().getEngine().useReverseDepthBuffer;N.b.PerspectiveFovLHToRef(this.shadowAngle,1,V?G:R,V?R:G,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,V)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(Z,c){return this.computeTransformedInformation()?Z.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Z,c){Z["POINTLIGHT"+c]=!0}}(0,MZ.d)([(0,PZ.H)()],XZ.prototype,"shadowAngle",null),(0,uZ.g)("BABYLON.PointLight",XZ);const hZ="KHR_lights_punctual";class BZ{constructor(Z){this.name=hZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(hZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Bc.extensions;if(Z&&Z[this.name]){const c=Z[this.name];this._lights=c.lights,A.Assign(this._lights)}}loadNodeAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,G)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Z,c,(Z=>{let c;const V=A.Get(k,this._lights,G.Vc),p=V.name||Z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,V.type){case"directional":{const Z=new wZ.c(p,N.h.Backward(),this._loader.babylonScene);Z.position.uc(0),c=Z;break}case"point":c=new XZ(p,N.h.Zero(),this._loader.babylonScene);break;case"spot":{const Z=new zZ.e(p,N.h.Zero(),N.h.Backward(),0,1,this._loader.babylonScene);Z.angle=2*(V.spot&&V.spot.outerConeAngle||Math.PI/4),Z.innerAngle=2*(V.spot&&V.spot.innerConeAngle||0),c=Z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${k}: Invalid light type (${V.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,V._babylonLight=c,c.falloffType=iZ.e.FALLOFF_GLTF,c.rc=V.color?R.d.oc(V.color):R.d.White(),c.Qc=void 0==V.Qc?1:V.Qc,c.range=void 0==V.range?Number.MAX_VALUE:V.range,c.parent=Z,this._loader._babylonLights.push(c),F.AddPointerMetadata(c,k),L(Z)})))))}}f(hZ),r(hZ,!0,(Z=>new BZ(Z)));const DZ="KHR_materials_pbrSpecularGlossiness";class eZ{constructor(Z){this.name=DZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(DZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialBasePropertiesAsync(Z,c,L)),R.push(this._loadSpecularGlossinessPropertiesAsync(k,N,L)),this._loader.loadMaterialAlphaProperties(Z,c,L),await Promise.all(R).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.metallic=null,L.roughness=null,c.diffuseFactor?(L.albedoColor=R.d.oc(c.diffuseFactor),L.alpha=c.diffuseFactor[3]):L.albedoColor=R.d.White(),L.reflectivityColor=c.specularFactor?R.d.oc(c.specularFactor):R.d.White(),L.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTexture`,c.diffuseTexture,(Z=>{Z.name=`${L.name} (Diffuse)`,L.albedoTexture=Z}))),c.specularGlossinessTexture&&(k.push(this._loader.loadTextureInfoAsync(`${Z}/specularGlossinessTexture`,c.specularGlossinessTexture,(Z=>{Z.name=`${L.name} (Specular Glossiness)`,L.reflectivityTexture=Z,L.reflectivityTexture.Oc=!0}))),L.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(k).then((()=>{}))}}f(DZ),r(DZ,!0,(Z=>new eZ(Z)));const HZ="KHR_materials_unlit";class lZ{constructor(Z){this.name=HZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(HZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(Z,c,L)))}_loadUnlitPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;L.unlit=!0;const N=c.pbrMetallicRoughness;return N&&(N.baseColorFactor?(L.albedoColor=R.d.oc(N.baseColorFactor),L.alpha=N.baseColorFactor[3]):L.albedoColor=R.d.White(),N.baseColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/baseColorTexture`,N.baseColorTexture,(Z=>{Z.name=`${L.name} (Base Color)`,L.albedoTexture=Z})))),c.doubleSided&&(L.Ec=!1,L.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,c,L),Promise.all(k).then((()=>{}))}}f(HZ),r(HZ,!0,(Z=>new lZ(Z)));const WZ="KHR_materials_clearcoat";class TZ{constructor(Z){this.name=WZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(WZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadClearCoatPropertiesAsync(k,N,L)),await Promise.all(R)}))}_loadClearCoatPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.clearCoat.isEnabled=!0,L.clearCoat.useRoughnessFromMainTexture=!1,L.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?L.clearCoat.Qc=c.clearcoatFactor:L.clearCoat.Qc=0,c.clearcoatTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatTexture`,c.clearcoatTexture,(Z=>{Z.name=`${L.name} (ClearCoat)`,L.clearCoat.texture=Z}))),void 0!=c.clearcoatRoughnessFactor?L.clearCoat.roughness=c.clearcoatRoughnessFactor:L.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(Z=>{Z.name=`${L.name} (ClearCoat Roughness)`,L.clearCoat.textureRoughness=Z})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(Z=>{Z.name=`${L.name} (ClearCoat Normal)`,L.clearCoat.bumpTexture=Z}))),L.invertNormalMapX=!L.XZ().useRightHandedSystem,L.invertNormalMapY=L.XZ().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(L.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(k).then((()=>{}))}}f(WZ),r(WZ,!0,(Z=>new TZ(Z)));const IZ="KHR_materials_iridescence";class dZ{constructor(Z){this.name=IZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(IZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadIridescencePropertiesAsync(k,N,L)),await Promise.all(R).then((()=>{}))}))}_loadIridescencePropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.iridescence.isEnabled=!0,L.iridescence.Qc=c.iridescenceFactor??0,L.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,L.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,L.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceTexture`,c.iridescenceTexture,(Z=>{Z.name=`${L.name} (Iridescence)`,L.iridescence.texture=Z}))),c.iridescenceThicknessTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(Z=>{Z.name=`${L.name} (Iridescence Thickness)`,L.iridescence.thicknessTexture=Z}))),Promise.all(k).then((()=>{}))}}f(IZ),r(IZ,!0,(Z=>new dZ(Z)));const QZ="KHR_materials_anisotropy";class rZ{constructor(Z){this.name=QZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(QZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadIridescencePropertiesAsync(k,N,L)),await Promise.all(R)}))}async _loadIridescencePropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;L.anisotropy.isEnabled=!0,L.anisotropy.Qc=c.anisotropyStrength??0,L.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${Z}/anisotropyTexture`,c.anisotropyTexture,(Z=>{Z.name=`${L.name} (Anisotropy Intensity)`,L.anisotropy.texture=Z})))),await Promise.all(k)}}f(QZ),r(QZ,!0,(Z=>new rZ(Z)));const fZ="KHR_materials_emissive_strength";class SZ{constructor(Z){this.name=fZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(fZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>await this._loader.loadMaterialPropertiesAsync(Z,c,L).then((()=>{this._loadEmissiveProperties(k,N,L)}))))}_loadEmissiveProperties(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);void 0!==c.emissiveStrength&&(L.emissiveIntensity=c.emissiveStrength)}}f(fZ),r(fZ,!0,(Z=>new SZ(Z)));const sZ="KHR_materials_sheen";class mZ{constructor(Z){this.name=sZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(sZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadSheenPropertiesAsync(k,N,L)),await Promise.all(R).then((()=>{}))}))}_loadSheenPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.sheen.isEnabled=!0,L.sheen.Qc=1,void 0!=c.sheenColorFactor?L.sheen.color=R.d.oc(c.sheenColorFactor):L.sheen.color=R.d.Black(),c.sheenColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/sheenColorTexture`,c.sheenColorTexture,(Z=>{Z.name=`${L.name} (Sheen Color)`,L.sheen.texture=Z}))),void 0!==c.sheenRoughnessFactor?L.sheen.roughness=c.sheenRoughnessFactor:L.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${Z}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(Z=>{Z.name=`${L.name} (Sheen Roughness)`,L.sheen.textureRoughness=Z})))),L.sheen.albedoScaling=!0,L.sheen.useRoughnessFromMainTexture=!1,Promise.all(k).then((()=>{}))}}f(sZ),r(sZ,!0,(Z=>new mZ(Z)));var AZ=L(11549);const bZ="KHR_materials_specular";class FZ{constructor(Z){this.name=bZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(bZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;if(R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadSpecularPropertiesAsync(k,N,L)),N.extensions&&N.extensions.EXT_materials_specular_edge_color&&L instanceof P.e){N.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(L.brdf.dielectricSpecularModel=AZ.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,L.brdf.conductorSpecularModel=AZ.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(R).then((()=>{}))}))}_loadSpecularPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return void 0!==c.specularFactor&&(L.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(L.metallicReflectanceColor=R.d.oc(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${Z}/specularTexture`,c.specularTexture,(Z=>{Z.name=`${L.name} (Specular)`,L.metallicReflectanceTexture=Z,L.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/specularColorTexture`,c.specularColorTexture,(Z=>{Z.name=`${L.name} (Specular Color)`,L.reflectanceTexture=Z}))),Promise.all(k).then((()=>{}))}}f(bZ),r(bZ,!0,(Z=>new FZ(Z)));const UZ="KHR_materials_ior";class KZ{constructor(Z){this.name=UZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(UZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadIorPropertiesAsync(k,N,L)),await Promise.all(R).then((()=>{}))}))}_loadIorPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);return void 0!==c.ior?L.indexOfRefraction=c.ior:L.indexOfRefraction=KZ._DEFAULT_IOR,Promise.resolve()}}KZ._DEFAULT_IOR=1.5,f(UZ),r(UZ,!0,(Z=>new KZ(Z)));const nZ="KHR_materials_variants";class gZ{constructor(Z){this.name=nZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(nZ)}dispose(){this._loader=null}static GetAvailableVariants(Z){const c=this._GetExtensionMetadata(Z);return c?Object.keys(c.variants):[]}getAvailableVariants(Z){return gZ.GetAvailableVariants(Z)}static SelectVariant(Z,c){const L=this._GetExtensionMetadata(Z);if(!L)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${nZ} extension`);const k=Z=>{const c=L.variants[Z];if(c)for(const L of c)L.mesh.material=L.material};if(c instanceof Array)for(const N of c)k(N);else k(c);L.lastSelected=c}selectVariant(Z,c){gZ.SelectVariant(Z,c)}static Reset(Z){const c=this._GetExtensionMetadata(Z);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${nZ} extension`);for(const L of c.original)L.mesh.material=L.material;c.lastSelected=null}reset(Z){gZ.Reset(Z)}static GetLastSelectedVariant(Z){const c=this._GetExtensionMetadata(Z);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${nZ} extension`);return c.lastSelected}getLastSelectedVariant(Z){return gZ.GetLastSelectedVariant(Z)}static _GetExtensionMetadata(Z){var c,L;return(null===Z||void 0===Z||null===(c=Z._internalMetadata)||void 0===c||null===(L=c.Bc)||void 0===L?void 0:L[nZ])||null}onLoading(){const Z=this._loader.Bc.extensions;if(Z&&Z[this.name]){const c=Z[this.name];this._variants=c.variants}}onReady(){const Z=this._loader.rootBabylonMesh;if(Z){var c;const L=this._loader.parent.extensionOptions[nZ];null!==L&&void 0!==L&&L.defaultVariant&&gZ.SelectVariant(Z,L.defaultVariant),null===L||void 0===L||null===(c=L.onLoaded)||void 0===c||c.call(L,{get variants(){return gZ.GetAvailableVariants(Z)},get selectedVariant(){const c=gZ.GetLastSelectedVariant(Z);return c?Array.isArray(c)?c[0]:c:gZ.GetAvailableVariants(Z)[0]},set selectedVariant(c){gZ.SelectVariant(Z,c)}})}}_loadMeshPrimitiveAsync(Z,c,L,k,N,R){return F.LoadExtensionAsync(Z,N,this.name,(async(G,V)=>{const p=new Array;return p.push(this._loader._loadMeshPrimitiveAsync(Z,c,L,k,N,(c=>{if(R(c),c instanceof B.c){const L=F._GetDrawMode(Z,N.mode),k=this._loader.rootBabylonMesh,R=k?k._internalMetadata=k._internalMetadata||{}:{},J=R.Bc=R.Bc||{},z=J[nZ]=J[nZ]||{lastSelected:null,original:[],variants:{}};z.original.push({mesh:c,material:c.material});for(let Z=0;Z<V.mappings.length;++Z){const N=V.mappings[Z],R=A.Get(`${G}/mappings/${Z}/material`,this._loader.Bc.materials,N.material);p.push(this._loader._loadMaterialAsync(`#/materials/${N.material}`,R,c,L,(Z=>{for(let L=0;L<N.variants.length;++L){const R=N.variants[L],G=A.Get(`/extensions/${nZ}/variants/${R}`,this._variants,R);z.variants[G.name]=z.variants[G.name]||[],z.variants[G.name].push({mesh:c,material:Z}),c.onClonedObservable.add((Z=>{const L=Z;let N=null,R=L;do{if(R=R.parent,!R)return;N=gZ._GetExtensionMetadata(R)}while(null===N);if(k&&N===gZ._GetExtensionMetadata(k)){R._internalMetadata={};for(const Z in k._internalMetadata)R._internalMetadata[Z]=k._internalMetadata[Z];R._internalMetadata.Bc=[];for(const Z in k._internalMetadata.Bc)R._internalMetadata.Bc[Z]=k._internalMetadata.Bc[Z];R._internalMetadata.Bc[nZ]={lastSelected:null,original:[],variants:{}};for(const Z of N.original)R._internalMetadata.Bc[nZ].original.push({mesh:Z.mesh,material:Z.material});for(const Z in N.variants)if(Object.prototype.hasOwnProperty.call(N.variants,Z)){R._internalMetadata.Bc[nZ].variants[Z]=[];for(const c of N.variants[Z])R._internalMetadata.Bc[nZ].variants[Z].push({mesh:c.mesh,material:c.material})}N=R._internalMetadata.Bc[nZ]}for(const k of N.original)k.mesh===c&&(k.mesh=L);for(const k of N.variants[G.name])k.mesh===c&&(k.mesh=L)}))}})))}}}))),await Promise.all(p).then((Z=>{let[c]=Z;return c}))}))}}f(nZ),r(nZ,!0,(Z=>new gZ(Z)));var yZ=L(11517);class vZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:AZ.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Z,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...vZ._GetDefaultOptions(),...Z},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new z.b,this._scene.Xc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Z){if(!Object.keys(Z).filter((c=>this._options[c]!==Z[c])).length)return;const c={...this._options,...Z},L=this._options;this._options=c,c.renderSize===L.renderSize&&c.renderTargetTextureType===L.renderTargetTextureType&&c.generateMipmaps===L.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Z){return!!Z&&!!(Z instanceof P.e&&Z.subSurface.isRefractionEnabled)}_addMesh(Z){this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),G.c.SetImmediate((()=>{this._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Z)&&this._transparentMeshesCache.push(Z)):-1===this._opaqueMeshesCache.indexOf(Z)&&this._opaqueMeshesCache.push(Z)}))}_removeMesh(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];let c=this._transparentMeshesCache.indexOf(Z);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(Z),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Z){const c=this._transparentMeshesCache.indexOf(Z),L=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof P.e&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==L?(this._opaqueMeshesCache.splice(L,1),this._transparentMeshesCache.push(Z)):-1===c&&this._transparentMeshesCache.push(Z)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(Z)):-1===L&&this._opaqueMeshesCache.push(Z)}_isRenderTargetValid(){var Z;return null!==(null===(Z=this._opaqueRenderTarget)||void 0===Z?void 0:Z.getInternalTexture())}_setupRenderTargets(){var Z;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new yZ.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Z=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Z.clearColor.R(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const L of this._transparentMeshesCache)this._shouldRenderAsTransmission(L.material)&&(L.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const YZ="KHR_materials_transmission";class aZ{constructor(Z){this.name=YZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(YZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadTransparentPropertiesAsync(k,c,L,N)),await Promise.all(R).then((()=>{}))}))}_loadTransparentPropertiesAsync(Z,c,L,k){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const N=L;if(N.subSurface.isRefractionEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.useAlbedoToTintRefraction=!0,void 0===k.transmissionFactor)return N.subSurface.refractionIntensity=0,N.subSurface.isRefractionEnabled=!1,Promise.resolve();{var R;N.subSurface.refractionIntensity=k.transmissionFactor;const Z=N.XZ();if(N.subSurface.refractionIntensity&&!Z._transmissionHelper)new vZ({},N.XZ());else if(N.subSurface.refractionIntensity&&(null===(R=Z._transmissionHelper)||void 0===R||!R._isRenderTargetValid())){var G;null===(G=Z._transmissionHelper)||void 0===G||G._setupRenderTargets()}}return N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,k.transmissionTexture?(k.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/transmissionTexture`,k.transmissionTexture,void 0).then((Z=>{Z.name=`${L.name} (Transmission)`,N.subSurface.refractionIntensityTexture=Z,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(YZ),r(YZ,!0,(Z=>new aZ(Z)));const CZ="KHR_materials_diffuse_transmission";class Zc{constructor(Z){this.name=CZ,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(CZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadTranslucentPropertiesAsync(k,c,L,N)),await Promise.all(R).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Z,c,L,k){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const N=L;if(N.subSurface.isTranslucencyEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,N.subSurface.useAlbedoToTintTranslucency=!1,void 0===k.diffuseTransmissionFactor)return N.subSurface.translucencyIntensity=0,N.subSurface.isTranslucencyEnabled=!1,Promise.resolve();N.subSurface.translucencyIntensity=k.diffuseTransmissionFactor;const G=new Array;return N.subSurface.useGltfStyleTextures=!0,k.diffuseTransmissionTexture&&(k.diffuseTransmissionTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionTexture`,k.diffuseTransmissionTexture).then((Z=>{Z.name=`${L.name} (Diffuse Transmission)`,N.subSurface.translucencyIntensityTexture=Z})))),void 0!==k.diffuseTransmissionColorFactor?N.subSurface.translucencyColor=R.d.oc(k.diffuseTransmissionColorFactor):N.subSurface.translucencyColor=R.d.White(),k.diffuseTransmissionColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionColorTexture`,k.diffuseTransmissionColorTexture).then((Z=>{Z.name=`${L.name} (Diffuse Transmission Color)`,N.subSurface.translucencyColorTexture=Z}))),Promise.all(G).then((()=>{}))}}f(CZ),r(CZ,!0,(Z=>new Zc(Z)));const cc="KHR_materials_volume";class Lc{constructor(Z){this.name=cc,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadVolumePropertiesAsync(k,c,L,N)),await Promise.all(R).then((()=>{}))}))}_loadVolumePropertiesAsync(Z,c,L,k){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);if(!L.subSurface.isRefractionEnabled&&!L.subSurface.isTranslucencyEnabled||!k.thicknessFactor)return Promise.resolve();L.subSurface.volumeIndexOfRefraction=L.indexOfRefraction;const N=void 0!==k.attenuationDistance?k.attenuationDistance:Number.MAX_VALUE;return L.subSurface.tintColorAtDistance=N,void 0!==k.attenuationColor&&3==k.attenuationColor.length&&L.subSurface.tintColor.wc(k.attenuationColor[0],k.attenuationColor[1],k.attenuationColor[2]),L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=k.thicknessFactor,L.subSurface.useThicknessAsDepth=!0,k.thicknessTexture?(k.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/thicknessTexture`,k.thicknessTexture).then((Z=>{Z.name=`${L.name} (Thickness)`,L.subSurface.thicknessTexture=Z,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(cc),r(cc,!0,(Z=>new Lc(Z)));const kc="KHR_materials_dispersion";class Nc{constructor(Z){this.name=kc,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(kc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadDispersionPropertiesAsync(k,c,L,N)),await Promise.all(R).then((()=>{}))}))}_loadDispersionPropertiesAsync(Z,c,L,k){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);return L.subSurface.isRefractionEnabled&&k.dispersion?(L.subSurface.isDispersionEnabled=!0,L.subSurface.dispersion=k.dispersion,Promise.resolve()):Promise.resolve()}}f(kc),r(kc,!0,(Z=>new Nc(Z)));const Rc="EXT_materials_diffuse_roughness";class Gc{constructor(Z){this.name=Rc,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Rc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=new Array;return R.push(this._loader.loadMaterialPropertiesAsync(Z,c,L)),R.push(this._loadDiffuseRoughnessPropertiesAsync(k,N,L)),await Promise.all(R).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Z,c,L){if(!(L instanceof P.e))throw new Error(`${Z}: Material type not supported`);const k=new Array;return L.brdf.baseDiffuseModel=AZ.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?L.baseDiffuseRoughness=c.diffuseRoughnessFactor:L.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&k.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(Z=>{Z.name=`${L.name} (Diffuse Roughness)`,L.baseDiffuseRoughnessTexture=Z}))),Promise.all(k).then((()=>{}))}}f(Rc),r(Rc,!0,(Z=>new Gc(Z)));const Vc="KHR_mesh_quantization";class pc{constructor(Z){this.name=Vc,this.enabled=Z.isExtensionUsed(Vc)}dispose(){}}f(Vc),r(Vc,!0,(Z=>new pc(Z)));const Jc="KHR_texture_basisu";class zc{constructor(Z){this.name=Jc,this._loader=Z,this.enabled=Z.isExtensionUsed(Jc)}dispose(){this._loader=null}_loadTextureAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>{const R=void 0==c.sampler?F.DefaultSampler:A.Get(`${Z}/sampler`,this._loader.Bc.samplers,c.sampler),G=A.Get(`${k}/source`,this._loader.Bc.images,N.source);return await this._loader._createTextureAsync(Z,R,G,(Z=>{L(Z)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}f(Jc),r(Jc,!0,(Z=>new zc(Z)));const ic="KHR_texture_transform";class tc{constructor(Z){this.name=ic,this._loader=Z,this.enabled=this._loader.isExtensionUsed(ic)}dispose(){this._loader=null}loadTextureInfoAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(k,N)=>await this._loader.loadTextureInfoAsync(Z,c,(Z=>{if(!(Z instanceof j.c))throw new Error(`${k}: Texture type not supported`);N.offset&&(Z.uOffset=N.offset[0],Z.vOffset=N.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,N.rotation&&(Z.wAng=-N.rotation),N.scale&&(Z.uScale=N.scale[0],Z.vScale=N.scale[1]),void 0!=N.texCoord&&(Z.coordinatesIndex=N.texCoord),L(Z)}))))}}f(ic),r(ic,!0,(Z=>new tc(Z)));const Ec="KHR_xmp_json_ld";class xc{constructor(Z){this.name=Ec,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Ec)}dispose(){this._loader=null}onLoading(){var Z,c,L;if(null===this._loader.rootBabylonMesh)return;const k=null===(Z=this._loader.Bc.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,N=null===(c=this._loader.Bc.asset)||void 0===c||null===(L=c.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld;if(k&&N){const Z=+N.packet;k.packets&&Z<k.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=k.packets[Z])}}}function qc(Z,c,L,k){return R.d.oc(c,L).scale(k)}function Oc(Z,c,L,k){return c[L]*k}function wc(Z,c,L,k){return-c[L]*k}function Mc(Z,c,L,k){return c[L+1]*k}function Pc(Z,c,L,k){return c[L]*k*2}function jc(Z){return{scale:[new uc(t.c.ANIMATIONTYPE_FLOAT,`${Z}.uScale`,Oc,(()=>2)),new uc(t.c.ANIMATIONTYPE_FLOAT,`${Z}.vScale`,Mc,(()=>2))],offset:[new uc(t.c.ANIMATIONTYPE_FLOAT,`${Z}.uOffset`,Oc,(()=>2)),new uc(t.c.ANIMATIONTYPE_FLOAT,`${Z}.vOffset`,Mc,(()=>2))],rotation:[new uc(t.c.ANIMATIONTYPE_FLOAT,`${Z}.wAng`,wc,(()=>1))]}}f(Ec),r(Ec,!0,(Z=>new xc(Z)));class oc extends U.AnimationPropertyInfo{buildAnimations(Z,c,L,k){return[{babylonAnimatable:Z._babylonCamera,babylonAnimation:this._buildAnimation(c,L,k)}]}}class uc extends U.AnimationPropertyInfo{buildAnimations(Z,c,L,k){const N=[];for(const R in Z._data)N.push({babylonAnimatable:Z._data[R].babylonMaterial,babylonAnimation:this._buildAnimation(c,L,k)});return N}}class Xc extends U.AnimationPropertyInfo{buildAnimations(Z,c,L,k){return[{babylonAnimatable:Z._babylonLight,babylonAnimation:this._buildAnimation(c,L,k)}]}}(0,S.l)("/cameras/{}/orthographic/xmag",[new oc(t.c.ANIMATIONTYPE_FLOAT,"orthoLeft",wc,(()=>1)),new oc(t.c.ANIMATIONTYPE_FLOAT,"orthoRight",Mc,(()=>1))]),(0,S.l)("/cameras/{}/orthographic/ymag",[new oc(t.c.ANIMATIONTYPE_FLOAT,"orthoBottom",wc,(()=>1)),new oc(t.c.ANIMATIONTYPE_FLOAT,"orthoTop",Mc,(()=>1))]),(0,S.l)("/cameras/{}/orthographic/zfar",[new oc(t.c.ANIMATIONTYPE_FLOAT,"maxZ",Oc,(()=>1))]),(0,S.l)("/cameras/{}/orthographic/znear",[new oc(t.c.ANIMATIONTYPE_FLOAT,"Dc",Oc,(()=>1))]),(0,S.l)("/cameras/{}/perspective/yfov",[new oc(t.c.ANIMATIONTYPE_FLOAT,"fov",Oc,(()=>1))]),(0,S.l)("/cameras/{}/perspective/zfar",[new oc(t.c.ANIMATIONTYPE_FLOAT,"maxZ",Oc,(()=>1))]),(0,S.l)("/cameras/{}/perspective/znear",[new oc(t.c.ANIMATIONTYPE_FLOAT,"Dc",Oc,(()=>1))]),(0,S.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"albedoColor",qc,(()=>4)),new uc(t.c.ANIMATIONTYPE_FLOAT,"alpha",(function(Z,c,L,k){return c[L+3]*k}),(()=>4))]),(0,S.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"metallic",Oc,(()=>1))]),(0,S.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"roughness",Oc,(()=>1))]);const hc=jc("albedoTexture");(0,S.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",hc.scale),(0,S.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",hc.offset),(0,S.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",hc.rotation);const Bc=jc("metallicTexture");(0,S.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Bc.scale),(0,S.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Bc.offset),(0,S.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Bc.rotation),(0,S.l)("/materials/{}/emissiveFactor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"emissiveColor",qc,(()=>3))]);const Dc=jc("bumpTexture");(0,S.l)("/materials/{}/normalTexture/scale",[new uc(t.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Oc,(()=>1))]),(0,S.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Dc.scale),(0,S.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Dc.offset),(0,S.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Dc.rotation),(0,S.l)("/materials/{}/occlusionTexture/strength",[new uc(t.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Oc,(()=>1))]);const ec=jc("ambientTexture");(0,S.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ec.scale),(0,S.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ec.offset),(0,S.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ec.rotation);const Hc=jc("emissiveTexture");(0,S.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Hc.scale),(0,S.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Hc.offset),(0,S.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Hc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new uc(t.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new uc(t.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Oc,(()=>1))]);const lc=jc("anisotropy.texture");(0,S.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",lc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",lc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",lc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Oc,(()=>1))]);const Wc=jc("clearCoat.texture");(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Wc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Wc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Wc.rotation);const Tc=jc("clearCoat.bumpTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new uc(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Tc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Tc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Tc.rotation);const Ic=jc("clearCoat.textureRoughness");(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Ic.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Ic.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Ic.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new uc(t.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new uc(t.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new uc(t.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new uc(t.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Oc,(()=>1))]);const dc=jc("iridescence.texture");(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",dc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",dc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",dc.rotation);const Qc=jc("iridescence.thicknessTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Qc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Qc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Qc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"sheen.color",qc,(()=>3))]),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Oc,(()=>1))]);const rc=jc("sheen.texture");(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",rc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",rc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",rc.rotation);const fc=jc("sheen.textureRoughness");(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",fc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",fc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",fc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",qc,(()=>3))]);const Sc=jc("metallicReflectanceTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Sc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Sc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Sc.rotation);const sc=jc("reflectanceTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",sc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",sc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",sc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Oc,(()=>1))]);const mc=jc("subSurface.refractionIntensityTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",mc.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",mc.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",mc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",qc,(()=>3))]),(0,S.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new uc(t.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Oc,(()=>1))]),(0,S.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Oc,(()=>1))]);const Ac=jc("subSurface.thicknessTexture");(0,S.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ac.scale),(0,S.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ac.offset),(0,S.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ac.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new uc(t.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Oc,(()=>1))]);const bc=jc("subSurface.translucencyIntensityTexture");(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",bc.scale),(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",bc.offset),(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",bc.rotation),(0,S.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new uc(t.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",qc,(()=>3))]);const Fc=jc("subSurface.translucencyColorTexture");(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Fc.scale),(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Fc.offset),(0,S.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Fc.rotation),(0,S.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Xc(t.c.ANIMATIONTYPE_COLOR3,"diffuse",qc,(()=>3))]),(0,S.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Xc(t.c.ANIMATIONTYPE_FLOAT,"intensity",Oc,(()=>1))]),(0,S.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Xc(t.c.ANIMATIONTYPE_FLOAT,"range",Oc,(()=>1))]),(0,S.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Xc(t.c.ANIMATIONTYPE_FLOAT,"innerAngle",Pc,(()=>1))]),(0,S.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Xc(t.c.ANIMATIONTYPE_FLOAT,"angle",Pc,(()=>1))]),(0,S.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Xc(t.c.ANIMATIONTYPE_COLOR3,"diffuse",qc,(()=>3))]),(0,S.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Xc(t.c.ANIMATIONTYPE_FLOAT,"intensity",Oc,(()=>1))]);const Uc="KHR_animation_pointer";class Kc{constructor(Z){this.name=Uc,this._loader=Z,this._pathToObjectConverter=(0,S.i)(this._loader.Bc)}get enabled(){return this._loader.isExtensionUsed(Uc)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Z,c,L,k,N){var R;const G=null===(R=k.target.extensions)||void 0===R?void 0:R.KHR_animation_pointer;if(!G||!this._pathToObjectConverter)return null;"pointer"!==k.target.path&&q.e.Warn(`${Z}/target/path: Value (${k.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=k.target.node&&q.e.Warn(`${Z}/target/node: Value (${k.target.node}) must not be present when using the ${this.name} extension`);const V=`${Z}/extensions/${this.name}`,p=G.pointer;if(!p)throw new Error(`${V}: Pointer is missing`);try{const R=this._pathToObjectConverter.convert(p);if(!R.info.interpolation)throw new Error(`${V}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Z,c,L,k,{object:R.object,info:R.info.interpolation},N)}catch(J){return q.e.Warn(`${V}/pointer: Invalid pointer (${p}) skipped`),null}}}f(Uc),r(Uc,!0,(Z=>new Kc(Z)));class nc{constructor(Z,c,L){this.frame=Z,this.action=c,this.onlyOnce=L,this.isDone=!1}_clone(){return new nc(this.frame,this.action,this.onlyOnce)}}var gc=L(11070),yc=L(11110),vc=L(11108);class Yc{get loop(){return this._loop}set loop(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))}get currentTime(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.audioContext&&(this.isPlaying||this.isPaused)){const Z=this.isPaused?0:yc.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Z){if(Z==this._spatialSound)return;const c=this.isPlaying;this.pause(),Z?(this._spatialSound=Z,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(Z,c,L){var k;let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new z.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=N.h.Zero(),this._localDirection=new N.h(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Z,L=L||x.d.LastCreatedScene)if(this._scene=L,Yc._SceneComponentInitialization(L),this._readyToPlayCallback=R,this._customAttenuationFunction=(Z,c,L,k,N)=>c<L?Z*(1-c/L):0,V&&(this.autoplay=V.autoplay||!1,this._loop=V.loop||!1,void 0!==V.volume&&(this._volume=V.volume),this._spatialSound=V.spatialSound??!1,this.maxDistance=V.maxDistance??100,this.useCustomAttenuation=V.useCustomAttenuation??!1,this.rolloffFactor=V.rolloffFactor||1,this.refDistance=V.refDistance||1,this.distanceModel=V.distanceModel||"linear",this._playbackRate=V.playbackRate||1,this._streaming=V.streaming??!1,this._length=V.length,this._offset=V.offset),null!==(k=yc.c.audioEngine)&&void 0!==k&&k.canUseWebAudio&&yc.c.audioEngine.audioContext){this._soundGain=yc.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Z=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let L=[],k=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=yc.c.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=yc.c.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(k=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":L.push(c);case"Array":0===L.length&&(L=c);for(let Z=0;Z<L.length;Z++){const c=L[Z];if(k=V&&V.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&yc.c.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&yc.c.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),k){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,G.c.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(Z=>{this._soundLoaded(Z)}),void 0,!0,!0,(Z=>{Z&&q.e.Error("XHR "+Z.status+" error on: "+c+"."),q.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Z=!1}Z?k||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):q.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(p){q.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),yc.c.audioEngine&&!yc.c.audioEngine.WarnedWebAudioUnsupported&&(q.e.Error("Web Audio is not supported by your browser."),yc.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Z;null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Z){var c;null!==(c=yc.c.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=Z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Z){var c;null!==(c=yc.c.audioEngine)&&void 0!==c&&c.audioContext&&yc.c.audioEngine.audioContext.decodeAudioData(Z,(Z=>{this._audioBufferLoaded(Z)}),(Z=>{q.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+Z)}))}setAudioBuffer(Z){var c;null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=Z,this._isReadyToPlay=!0)}updateOptions(Z){Z&&(this.loop=Z.loop??this.loop,this.maxDistance=Z.maxDistance??this.maxDistance,this.useCustomAttenuation=Z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Z.rolloffFactor??this.rolloffFactor,this.refDistance=Z.refDistance??this.refDistance,this.distanceModel=Z.distanceModel??this.distanceModel,this._playbackRate=Z.playbackRate??this._playbackRate,this._length=Z.length??void 0,this.spatialSound=Z.spatialSound??this._spatialSound,this._setOffset(Z.offset??void 0),this.setVolume(Z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Z;null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&yc.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??yc.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Z=this._soundPanner)||void 0===Z||Z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Z;null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Z){var c;null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)}setDirectionalCone(Z,c,L){c<Z?q.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=c,this._coneOuterGain=L,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!=this._coneInnerAngle){var c;if(this._coneOuterAngle<Z)return void q.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!=this._coneOuterAngle){var c;if(Z<this._coneInnerAngle)return void q.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Z){var c;Z.equals(this._position)||(this._position.R(Z),null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Z){var c;this._localDirection=Z,null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Z=this._connectedTransformNode.getWorldMatrix(),c=N.h.TransformNormal(this._localDirection,Z);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var Z;if(null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.yL(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Z){this._customAttenuationFunction=Z}play(Z,c,L){var k;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(k=yc.c.audioEngine)&&void 0!==k&&k.audioContext)try{var N,R;this._clearTimeoutsAndObservers();let k=Z?(null===(N=yc.c.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+Z:null===(R=yc.c.audioEngine)||void 0===R?void 0:R.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=yc.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Z=()=>{var L;if(null!==(L=yc.c.audioEngine)&&void 0!==L&&L.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const L=this._htmlAudioElement.play();void 0!==L&&L.catch((()=>{var c,L;(null===(c=yc.c.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(L=yc.c.audioEngine)||void 0===L?void 0:L.onAudioUnlockedObservable.addOnce((()=>{Z()})))}))}else{var k;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(k=yc.c.audioEngine)||void 0===k?void 0:k.onAudioUnlockedObservable.addOnce((()=>{Z()}))}};Z()}}else{var G;const N=()=>{var N;if(null!==(N=yc.c.audioEngine)&&void 0!==N&&N.audioContext){var R;if(L=L||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const Z=this._soundSource;Z.onended=()=>{Z.disconnect()}}if(this._soundSource=null===(R=yc.c.audioEngine)||void 0===R?void 0:R.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var G;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==L&&(this._soundSource.loopEnd=(0|c)+L),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},k=Z?(null===(G=yc.c.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+Z:yc.c.audioEngine.audioContext.currentTime;const N=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(k,N,this.loop?void 0:L)}}};"suspended"===(null===(G=yc.c.audioEngine)||void 0===G?void 0:G.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Z;"suspended"===(null===(Z=yc.c.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(yc.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=yc.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{N()})))):N()}),500):N()}this._startTime=k,this.isPlaying=!0,this.isPaused=!1}catch(V){q.e.Error("Error while trying to play audio: "+this.name+", "+V.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Z){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var L;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(L=this._streamingSource)||void 0===L||L.disconnect();this.isPlaying=!1}else if(null!==(c=yc.c.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=Z?yc.c.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=yc.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Z,c){var L;null!==(L=yc.c.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._soundGain&&(c&&yc.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(yc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,yc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,yc.c.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=Z),this._volume=Z}setPlaybackRate(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Z=>this._onRegisterAfterWorldMatrixUpdate(Z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Z){var c;if(Z.getBoundingInfo){const c=Z.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Z=()=>{(0,vc.d)((()=>this._isReadyToPlay),(()=>{L._audioBuffer=this.getAudioBuffer(),L._isReadyToPlay=!0,L.autoplay&&L.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},L=new Yc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&L.setAttenuationFunction(this._customAttenuationFunction),L.setPosition(this._position),L.setPlaybackRate(this._playbackRate),Z(),L}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.xc(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.xc(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z}static Parse(Z,c,L,k){const R=Z.name;let G;G=Z.url?L+Z.url:L+R;const V={autoplay:Z.autoplay,loop:Z.loop,volume:Z.volume,spatialSound:Z.spatialSound,maxDistance:Z.maxDistance,rolloffFactor:Z.rolloffFactor,refDistance:Z.refDistance,distanceModel:Z.distanceModel,playbackRate:Z.playbackRate};let p;if(k){const Z=()=>{(0,vc.d)((()=>k._isReadyToPlay),(()=>{p._audioBuffer=k.getAudioBuffer(),p._isReadyToPlay=!0,p.autoplay&&p.play(0,p._offset,p._length)}),void 0,300)};p=new Yc(R,new ArrayBuffer(0),c,null,V),Z()}else p=new Yc(R,G,c,(()=>{c.removePendingData(p)}),V),c.addPendingData(p);if(Z.position){const c=N.h.oc(Z.position);p.setPosition(c)}if(Z.isDirectional&&(p.setDirectionalCone(Z.coneInnerAngle||360,Z.coneOuterAngle||360,Z.coneOuterGain||0),Z.localDirectionToMesh)){const c=N.h.oc(Z.localDirectionToMesh);p.setLocalDirectionToMesh(c)}if(Z.connectedMeshId){const L=c.getMeshById(Z.connectedMeshId);L&&p.attachToMesh(L)}return Z.metadata&&(p.metadata=Z.metadata),p}_setOffset(Z){this._offset!==Z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Z)}_clearTimeoutsAndObservers(){var Z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Z=yc.c.audioEngine)||void 0===Z||Z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Yc._SceneComponentInitialization=Z=>{throw(0,gc.e)("AudioSceneComponent")},(0,uZ.g)("BABYLON.Sound",Yc);class ac{constructor(Z,c,L){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==L.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=L;let k=0;for(const R of L)k+=R;const N=k>0?1/k:0;for(let R=0;R<this._weights.length;R++)this._weights[R]*=N;this._sounds=c;for(const R of this._sounds)R.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void q.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(const c of this._sounds)c.directionalConeInnerAngle=Z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void q.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(const c of this._sounds)c.directionalConeOuterAngle=Z}}get volume(){return this._volume}set volume(Z){if(Z!==this._volume)for(const c of this._sounds)c.setVolume(Z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Z){if(!this.isPaused){this.stop();const Z=Math.random();let c=0;for(let L=0;L<this._weights.length;L++)if(c+=this._weights[L],Z<=c){this._currentIndex=L;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:Z):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Cc{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Z=Z||x.d.LastCreatedScene)&&(this._scene=Z,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Z;null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&yc.c.audioEngine.audioContext&&(this._outputAudioNode=yc.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(yc.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(yc.c.audioEngine&&yc.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Z){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&Z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Z.soundTrackId&&(-1===Z.soundTrackId?this._scene.mainSoundTrack.removeSound(Z):this._scene.soundTracks&&this._scene.soundTracks[Z.soundTrackId].removeSound(Z)),this.soundCollection.push(Z),Z.soundTrackId=this.id}removeSound(Z){const c=this.soundCollection.indexOf(Z);-1!==c&&this.soundCollection.splice(c,1)}setVolume(Z){var c;null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Z)}switchPanningModelToHRTF(){var Z;if(null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Z;if(null!==(Z=yc.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(Z){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Z,null!==(c=yc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,yc.c.audioEngine.masterGain))}}var ZL=L(11386),cL=L(11588),LL=L(11047);yc.c.AudioEngineFactory=(Z,c,L)=>new kL(Z,c,L);class kL{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new z.b,this.onAudioLockedObservable=new z.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,LL.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const k=document.createElement("audio");this._hostElement=Z,this._audioContext=c,this._audioDestination=L;try{k&&k.canPlayType&&(k.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||k.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(N){}try{k&&k.canPlayType&&k.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(N){}}lock(){this._triggerSuspendedState()}unlock(){var Z,c;if("running"===(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{q.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Z;null===(Z=this._audioContext)||void 0===Z||Z.addEventListener("statechange",(()=>{var Z;this.unlocked&&"running"!==(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Z;return null!==(Z=this._audioContext)&&void 0!==Z&&Z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Z){this.canUseWebAudio=!1,q.e.Error("Web Audio: "+Z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(Z)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Z=this._audioContext)||void 0===Z||Z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Z)}connectToAnalyser(Z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var NL=L(11065);(0,L(12514).f)(ZL.c.NAME_AUDIO,((Z,c,L,k)=>{let N,R=[];if(L.Xt=L.Xt||[],void 0!==Z.Xt&&null!==Z.Xt)for(let V=0,p=Z.Xt.length;V<p;V++){var G;const p=Z.Xt[V];null!==(G=yc.c.audioEngine)&&void 0!==G&&G.canUseWebAudio?(p.url||(p.url=p.name),R[p.url]?L.Xt.push(Yc.Parse(p,c,k,R[p.url])):(N=Yc.Parse(p,c,k),R[p.url]=N,L.Xt.push(N))):L.Xt.push(new Yc(p.name,null,c))}R=[]})),Object.defineProperty(cL.d.prototype,"mainSoundTrack",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),this._mainSoundTrack||(this._mainSoundTrack=new Cc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),cL.d.prototype.getSoundByName=function(Z){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===Z)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let L=0;L<this.soundTracks.length;L++)for(c=0;c<this.soundTracks[L].soundCollection.length;c++)if(this.soundTracks[L].soundCollection[c].name===Z)return this.soundTracks[L].soundCollection[c];return null},Object.defineProperty(cL.d.prototype,"audioEnabled",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),Z.audioEnabled},set:function(Z){let c=this._getComponent(ZL.c.NAME_AUDIO);c||(c=new RL(this),this.o(c)),Z?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(cL.d.prototype,"headphone",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),Z.headphone},set:function(Z){let c=this._getComponent(ZL.c.NAME_AUDIO);c||(c=new RL(this),this.o(c)),Z?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(cL.d.prototype,"audioListenerPositionProvider",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),Z.audioListenerPositionProvider},set:function(Z){let c=this._getComponent(ZL.c.NAME_AUDIO);if(c||(c=new RL(this),this.o(c)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(cL.d.prototype,"audioListenerRotationProvider",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),Z.audioListenerRotationProvider},set:function(Z){let c=this._getComponent(ZL.c.NAME_AUDIO);if(c||(c=new RL(this),this.o(c)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(cL.d.prototype,"audioPositioningRefreshRate",{get:function(){let Z=this._getComponent(ZL.c.NAME_AUDIO);return Z||(Z=new RL(this),this.o(Z)),Z.audioPositioningRefreshRate},set:function(Z){let c=this._getComponent(ZL.c.NAME_AUDIO);c||(c=new RL(this),this.o(c)),c.audioPositioningRefreshRate=Z},enumerable:!0,configurable:!0});class RL{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Z){this.name=ZL.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new N.h,this._cachedCameraPosition=new N.h,this._lastCheck=0,this._invertMatrixTemp=new N.b,this._cameraDirectionTemp=new N.h,(Z=Z||x.d.LastCreatedScene)&&(this.LL=Z,Z.soundTracks=[],Z.Xt=[])}register(){this.LL._afterRenderStage.registerStep(ZL.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Z){if(Z.Xt=[],this.LL.soundTracks)for(let c=0;c<this.LL.soundTracks.length;c++){const L=this.LL.soundTracks[c];for(let c=0;c<L.soundCollection.length;c++)Z.Xt.push(L.soundCollection[c].serialize())}}addFromContainer(Z){if(Z.Xt)for(const c of Z.Xt)c.play(),c.autoplay=!0,this.LL.mainSoundTrack.addSound(c)}removeFromContainer(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.Xt)for(const L of Z.Xt)L.stop(),L.autoplay=!1,this.LL.mainSoundTrack.removeSound(L),c&&L.dispose()}dispose(){const Z=this.LL;if(Z._mainSoundTrack&&Z.mainSoundTrack.dispose(),Z.soundTracks)for(let c=0;c<Z.soundTracks.length;c++)Z.soundTracks[c].dispose()}disableAudio(){const Z=this.LL;let c;for(this._audioEnabled=!1,yc.c.audioEngine&&yc.c.audioEngine.audioContext&&yc.c.audioEngine.audioContext.suspend(),c=0;c<Z.mainSoundTrack.soundCollection.length;c++)Z.mainSoundTrack.soundCollection[c].pause();if(Z.soundTracks)for(c=0;c<Z.soundTracks.length;c++)for(let L=0;L<Z.soundTracks[c].soundCollection.length;L++)Z.soundTracks[c].soundCollection[L].pause()}enableAudio(){const Z=this.LL;let c;for(this._audioEnabled=!0,yc.c.audioEngine&&yc.c.audioEngine.audioContext&&yc.c.audioEngine.audioContext.resume(),c=0;c<Z.mainSoundTrack.soundCollection.length;c++)Z.mainSoundTrack.soundCollection[c].isPaused&&Z.mainSoundTrack.soundCollection[c].play();if(Z.soundTracks)for(c=0;c<Z.soundTracks.length;c++)for(let L=0;L<Z.soundTracks[c].soundCollection.length;L++)Z.soundTracks[c].soundCollection[L].isPaused&&Z.soundTracks[c].soundCollection[L].play()}switchAudioModeForHeadphones(){const Z=this.LL;if(this._headphone=!0,Z.mainSoundTrack.switchPanningModelToHRTF(),Z.soundTracks)for(let c=0;c<Z.soundTracks.length;c++)Z.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Z=this.LL;if(this._headphone=!1,Z.mainSoundTrack.switchPanningModelToEqualPower(),Z.soundTracks)for(let c=0;c<Z.soundTracks.length;c++)Z.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const Z=NL.c.Now;if(this._lastCheck&&Z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Z;const c=this.LL;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const L=yc.c.audioEngine;if(L&&L.audioContext){let Z,k=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(k=c.activeCameras[0]),this.audioListenerPositionProvider){const Z=this.audioListenerPositionProvider();L.audioContext.listener.setPosition(Z.x||0,Z.y||0,Z.z||0)}else k?this._cachedCameraPosition.equals(k.globalPosition)||(this._cachedCameraPosition.R(k.globalPosition),L.audioContext.listener.setPosition(k.globalPosition.x,k.globalPosition.y,k.globalPosition.z)):L.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Z=this.audioListenerRotationProvider();L.audioContext.listener.setOrientation(Z.x||0,Z.y||0,Z.z||0,0,1,0)}else k?(k.rigCameras&&k.rigCameras.length>0&&(k=k.rigCameras[0]),k.getViewMatrix().invertToRef(this._invertMatrixTemp),N.h.TransformNormalToRef(RL._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.R(this._cameraDirectionTemp),L.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):L.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Z=0;Z<c.mainSoundTrack.soundCollection.length;Z++){const L=c.mainSoundTrack.soundCollection[Z];L.useCustomAttenuation&&L.updateDistanceFromListener()}if(c.soundTracks)for(Z=0;Z<c.soundTracks.length;Z++)for(let L=0;L<c.soundTracks[Z].soundCollection.length;L++){const k=c.soundTracks[Z].soundCollection[L];k.useCustomAttenuation&&k.updateDistanceFromListener()}}}}RL._CameraDirection=new N.h(0,0,-1),Yc._SceneComponentInitialization=Z=>{let c=Z._getComponent(ZL.c.NAME_AUDIO);c||(c=new RL(Z),Z.o(c))};const GL="MSFT_audio_emitter";class VL{constructor(Z){this.name=GL,this._loader=Z,this.enabled=this._loader.isExtensionUsed(GL)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Z=this._loader.Bc.extensions;if(Z&&Z[this.name]){const c=Z[this.name];this._clips=c.clips,this._emitters=c.emitters,A.Assign(this._clips),A.Assign(this._emitters)}}loadSceneAsync(Z,c){return F.LoadExtensionAsync(Z,c,this.name,(async(L,k)=>{const N=new Array;N.push(this._loader.loadSceneAsync(Z,c));for(const Z of k.emitters){const c=A.Get(`${L}/emitters`,this._emitters,Z);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${L}: Direction or Distance properties are not allowed on emitters attached to a scene`);N.push(this._loadEmitterAsync(`${L}/emitters/${c.index}`,c))}await Promise.all(N)}))}loadNodeAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(Z,k)=>{const R=new Array,V=await this._loader.loadNodeAsync(Z,c,(c=>{for(const L of k.emitters){const k=A.Get(`${Z}/emitters`,this._emitters,L);R.push(this._loadEmitterAsync(`${Z}/emitters/${k.index}`,k).then((()=>{for(const Z of k._babylonSounds)Z.attachToMesh(c),void 0==k.innerAngle&&void 0==k.outerAngle||(Z.setLocalDirectionToMesh(N.h.Forward()),Z.setDirectionalCone(2*G.c.ToDegrees(void 0==k.innerAngle?Math.PI:k.innerAngle),2*G.c.ToDegrees(void 0==k.outerAngle?Math.PI:k.outerAngle),0))})))}L(c)}));return await Promise.all(R),V}))}loadAnimationAsync(Z,c){return F.LoadExtensionAsync(Z,c,this.name,(async(L,k)=>{const N=await this._loader.loadAnimationAsync(Z,c),R=new Array;A.Assign(k.events);for(const G of k.events)R.push(this._loadAnimationEventAsync(`${L}/events/${G.index}`,Z,c,G,N));return await Promise.all(R),N}))}_loadClipAsync(Z,c){if(c._objectURL)return c._objectURL;let L;if(c.uri)L=this._loader.loadUriAsync(Z,c,c.uri);else{const k=A.Get(`${Z}/bufferView`,this._loader.Bc.bufferViews,c.bufferView);L=this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k)}return c._objectURL=L.then((Z=>URL.createObjectURL(new Blob([Z],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(Z,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const Z=new Array,L=c.name||`emitter${c.index}`,k={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let R=0;R<c.clips.length;R++){const N=`/extensions/${this.name}/clips`,G=A.Get(N,this._clips,c.clips[R].clip);Z.push(this._loadClipAsync(`${N}/${c.clips[R].clip}`,G).then((Z=>{const N=c._babylonSounds[R]=new Yc(L,Z,this._loader.babylonScene,null,k);N.refDistance=c.refDistance||1,N.maxDistance=c.maxDistance||256,N.rolloffFactor=c.rolloffFactor||1,N.distanceModel=c.distanceModel||"exponential"})))}const N=Promise.all(Z).then((()=>{const Z=c.clips.map((Z=>Z.weight||1)),L=new ac(c.loop||!1,c._babylonSounds,Z);c.innerAngle&&(L.directionalConeInnerAngle=2*G.c.ToDegrees(c.innerAngle)),c.outerAngle&&(L.directionalConeOuterAngle=2*G.c.ToDegrees(c.outerAngle)),c.volume&&(L.volume=c.volume),c._babylonData.sound=L}));c._babylonData={loaded:N}}return c._babylonData.loaded}_getEventAction(Z,c,L,k,N){switch(L){case"play":return Z=>{const L=(N||0)+(Z-k);c.play(L)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${Z}: Unsupported action ${L}`)}}_loadAnimationEventAsync(Z,c,L,k,N){if(0==N.targetedAnimations.length)return Promise.resolve();const R=N.targetedAnimations[0],G=k.j,V=A.Get(`/extensions/${this.name}/emitters`,this._emitters,G);return this._loadEmitterAsync(Z,V).then((()=>{const c=V._babylonData.sound;if(c){const L=new nc(k.time,this._getEventAction(Z,c,k.action,k.time,k.startOffset));R.animation.addEvent(L),N.onAnimationGroupEndObservable.add((()=>{c.stop()})),N.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}f(GL),r(GL,!0,(Z=>new VL(Z)));const pL="MSFT_lod";class JL{constructor(Z){var c;this.name=pL,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new z.b,this.onMaterialLODsLoadedObservable=new z.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[pL])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(pL)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Z=0;Z<this._nodePromiseLODs.length;Z++){const c=Promise.all(this._nodePromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Node LOD ${Z}`),this._loader.log(`Loaded node LOD ${Z}`)),this.onNodeLODsLoadedObservable.notifyObservers(Z),Z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Z+1}`),this._loadBufferLOD(this._nodeBufferLODs,Z+1),this._nodeSignalLODs[Z]&&this._nodeSignalLODs[Z].resolve())}));this._loader._completePromises.push(c)}for(let Z=0;Z<this._materialPromiseLODs.length;Z++){const c=Promise.all(this._materialPromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Material LOD ${Z}`),this._loader.log(`Loaded material LOD ${Z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Z),Z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Z+1}`),this._loadBufferLOD(this._materialBufferLODs,Z+1),this._materialSignalLODs[Z]&&this._materialSignalLODs[Z].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(Z,c){const L=this._loader.loadSceneAsync(Z,c);return this._loadBufferLOD(this._bufferLODs,0),L}loadNodeAsync(Z,c,L){return F.LoadExtensionAsync(Z,c,this.name,(async(Z,N)=>{let R;const G=this._getLODs(Z,c,this._loader.Bc.nodes,N.ids);this._loader.logOpen(`${Z}`);for(let c=0;c<G.length;c++){const Z=G[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new k);const N=Z=>{L(Z),Z.lV(!1)},V=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,N).then((Z=>{if(0!==c){const Z=G[c-1];Z._babylonTransformNode&&(this._disposeTransformNode(Z._babylonTransformNode),delete Z._babylonTransformNode)}return Z.lV(!0),Z}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?R=V:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(V))}return this._loader.logClose(),await R}))}_loadMaterialAsync(Z,c,L,k,N){return this._nodeIndexLOD?null:F.LoadExtensionAsync(Z,c,this.name,(async(Z,R)=>{let G;const V=this._getLODs(Z,c,this._loader.Bc.materials,R.ids);this._loader.logOpen(`${Z}`);for(let c=0;c<V.length;c++){const Z=V[c];0!==c&&(this._materialIndexLOD=c);const R=this._loader._loadMaterialAsync(`/materials/${Z.index}`,Z,L,k,(Z=>{0===c&&N(Z)})).then((Z=>{if(0!==c){N(Z);const L=V[c-1]._data;L[k]&&(this._disposeMaterials([L[k].babylonMaterial]),delete L[k])}return Z}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?G=R:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(R))}return this._loader.logClose(),await G}))}_loadUriAsync(Z,c,L){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const N=this._nodeIndexLOD-1;return this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new k,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Z,c,L)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const N=this._materialIndexLOD-1;return this._materialSignalLODs[N]=this._materialSignalLODs[N]||new k,this._materialSignalLODs[N].promise.then((async()=>await this._loader.loadUriAsync(Z,c,L)))}return null}loadBufferAsync(Z,c,L,N){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(Z,c)=>{const R=L,G=R+N-1;let V=Z[c];return V?(V.start=Math.min(V.start,R),V.end=Math.max(V.end,G)):(V={start:R,end:G,loaded:new k},Z[c]=V),await V.loaded.promise.then((Z=>new Uint8Array(Z.buffer,Z.byteOffset+L-V.start,N)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(Z,c){const L=Z[c];L&&(this._loader.log(`Loading buffer range [${L.start}-${L.end}]`),this._loader.bin.readAsync(L.start,L.end-L.start+1).then((Z=>{L.loaded.resolve(Z)}),(Z=>{L.loaded.reject(Z)})))}_getLODs(Z,c,L,k){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const N=[];for(let R=k.length-1;R>=0;R--)if(N.push(A.Get(`${Z}/ids/${k[R]}`,L,k[R])),N.length===this.maxLODsToLoad)return N;return N.push(c),N}_disposeTransformNode(Z){const c=[],L=Z.material;L&&c.push(L);for(const N of Z.getChildMeshes())N.material&&c.push(N.material);Z.dispose();const k=c.filter((Z=>this._loader.babylonScene.meshes.every((c=>c.material!=Z))));this._disposeMaterials(k)}_disposeMaterials(Z){const c={};for(const L of Z){for(const Z of L.getActiveTextures())c[Z.uniqueId]=Z;L.dispose()}for(const L in c)for(const Z of this._loader.babylonScene.materials)Z.hasTexture(c[L])&&delete c[L];for(const L in c)c[L].dispose()}}f(pL),r(pL,!0,(Z=>new JL(Z)));const zL="MSFT_minecraftMesh";class iL{constructor(Z){this.name=zL,this._loader=Z,this.enabled=this._loader.isExtensionUsed(zL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtraAsync(Z,c,this.name,(async(k,N)=>{if(N){if(!(L instanceof P.e))throw new Error(`${k}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(Z,c,L);return L.needAlphaBlending()&&(L.forceDepthWrite=!0,L.separateCullingPass=!0),L.Ec=L.forceDepthWrite,L.twoSidedLighting=!0,await N}}))}}f(zL),r(zL,!0,(Z=>new iL(Z)));const tL="MSFT_sRGBFactors";class EL{constructor(Z){this.name=tL,this._loader=Z,this.enabled=this._loader.isExtensionUsed(tL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,c,L){return F.LoadExtraAsync(Z,c,this.name,(async(k,N)=>{if(N){if(!(L instanceof P.e))throw new Error(`${k}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(Z,c,L),R=L.XZ().getEngine().useExactSrgbConversions;return L.albedoTexture||L.albedoColor.toLinearSpaceToRef(L.albedoColor,R),L.reflectivityTexture||L.reflectivityColor.toLinearSpaceToRef(L.reflectivityColor,R),await N}}))}}f(tL),r(tL,!0,(Z=>new EL(Z)));var xL=L(12807);const qL={};var OL=L(12866),wL=L(12839),ML=L(12811),PL=L(12825);function jL(Z,c){for(const L of Z)for(const Z of L.dataOutputs)if(Z.uniqueId===c)return Z;throw new Error("Could not find data out connection with unique id "+c)}function oL(Z,c){for(const L of Z)if(L instanceof wL.b)for(const Z of L.signalInputs)if(Z.uniqueId===c)return Z;throw new Error("Could not find signal in connection with unique id "+c)}async function uL(Z,c){const k=await Promise.all(Z.allBlocks.map((async Z=>{const c=function(Z){switch(Z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([L.e(58),L.e(59)]).then(L.bind(L,14303))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await L.e(60).then(L.bind(L,14311))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await L.e(61).then(L.bind(L,14314))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await L.e(62).then(L.bind(L,14321))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await L.e(63).then(L.bind(L,14329))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await L.e(64).then(L.bind(L,14333))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await L.e(65).then(L.bind(L,14335))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await L.e(66).then(L.bind(L,14342))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await L.e(67).then(L.bind(L,14345))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await L.e(75).then(L.bind(L,14391))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await L.e(76).then(L.bind(L,14397))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await L.e(77).then(L.bind(L,14399))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await L.e(78).then(L.bind(L,14406))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await L.e(79).then(L.bind(L,14408))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await L.e(80).then(L.bind(L,14415))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await L.e(81).then(L.bind(L,14418))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await L.e(82).then(L.bind(L,14420))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await L.e(83).then(L.bind(L,14428))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await L.e(84).then(L.bind(L,14433))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await L.e(85).then(L.bind(L,14442))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await L.e(86).then(L.bind(L,14450))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await L.e(87).then(L.bind(L,14455))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await L.e(88).then(L.bind(L,14461))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await L.e(89).then(L.bind(L,14464))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await L.e(90).then(L.bind(L,14471))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await L.e(91).then(L.bind(L,14475))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await L.e(92).then(L.bind(L,14479))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await L.e(93).then(L.bind(L,14483))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await L.e(72).then(L.bind(L,14492))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await L.e(94).then(L.bind(L,14498))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await L.e(95).then(L.bind(L,14500))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await L.e(96).then(L.bind(L,14509))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await L.e(73).then(L.bind(L,14517))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await L.e(68).then(L.bind(L,14349))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await L.e(74).then(L.bind(L,14525))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await L.e(69).then(L.bind(L,14378))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await L.e(70).then(L.bind(L,14385))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await L.e(71).then(L.bind(L,14531))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await L.e(97).then(L.bind(L,14539))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await L.e(98).then(L.bind(L,14542))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await L.e(99).then(L.bind(L,14550))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await L.e(100).then(L.bind(L,14557))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await L.e(101).then(L.bind(L,14559))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await L.e(102).then(L.bind(L,14568))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await L.e(103).then(L.bind(L,14575))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await L.e(104).then(L.bind(L,14580))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await L.e(105).then(L.bind(L,14583))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await L.e(106).then(L.bind(L,14585))).FlowGraphDataSwitchBlock;default:if(qL[Z])return qL[Z];throw new Error(`Unknown block name ${Z}`)}}(Z.className);return await c()})));return function(Z,c,L){const k=c.coordinator.createGraph(),N=[],R=c.valueParseFunction??ML.d;for(let G=0;G<Z.allBlocks.length;G++){const V=hL(Z.allBlocks[G],{LL:c.coordinator.config.LL,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.LL,valueParseFunction:R},L[G]);N.push(V),V instanceof OL.e&&k.addEventBlock(V)}for(const G of N){for(const Z of G.dataInputs)for(const c of Z.connectedPointIds){const L=jL(N,c);Z.connectTo(L)}if(G instanceof wL.b)for(const Z of G.signalOutputs)for(const c of Z.connectedPointIds){const L=oL(N,c);Z.connectTo(L)}}for(const G of Z.executionContexts)XL(G,{graph:k,valueParseFunction:R},Z.rightHanded);return k}(Z,c,k)}function XL(Z,c,L){const k=c.graph.createContext();Z.enableLogging&&(k.enableLogging=!0),k.treatDataAsRightHanded=L||!1;const N=c.valueParseFunction??ML.d;k.uniqueId=Z.uniqueId;const R=k.XZ();if(Z._assetsContext){var G,V,p,J,z,i,t,E,x,q;const c=Z._assetsContext,L={meshes:null===(G=c.meshes)||void 0===G?void 0:G.map((Z=>R.getMeshById(Z))),lights:null===(V=c.lights)||void 0===V?void 0:V.map((Z=>R.getLightByName(Z))),cameras:null===(p=c.cameras)||void 0===p?void 0:p.map((Z=>R.getCameraByName(Z))),materials:null===(J=c.materials)||void 0===J?void 0:J.map((Z=>R.getMaterialById(Z))),textures:null===(z=c.textures)||void 0===z?void 0:z.map((Z=>R.getTextureByName(Z))),animations:null===(i=c.animations)||void 0===i?void 0:i.map((Z=>R.animations.find((c=>c.name===Z)))),skeletons:null===(t=c.skeletons)||void 0===t?void 0:t.map((Z=>R.getSkeletonByName(Z))),si:null===(E=c.si)||void 0===E?void 0:E.map((Z=>R.getParticleSystemById(Z))),animationGroups:null===(x=c.animationGroups)||void 0===x?void 0:x.map((Z=>R.getAnimationGroupByName(Z))),transformNodes:null===(q=c.transformNodes)||void 0===q?void 0:q.map((Z=>R.getTransformNodeById(Z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Xt:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};k.assetsContext=L}for(const O in Z._userVariables){const c=N(O,Z._userVariables,k.assetsContext,R);k.userVariables[O]=c}for(const O in Z._connectionValues){const c=N(O,Z._connectionValues,k.assetsContext,R);k._setConnectionValueByKey(O,c)}return k}function hL(Z,c,L){const k={},N=c.valueParseFunction??ML.d;if(Z.config)for(const G in Z.config)k[G]=N(G,Z.config,c.assetsContainer||c.LL,c.LL);if((0,ML.h)(Z.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");k.pathConverter=c.pathConverter}const R=new L(k);R.uniqueId=Z.uniqueId;for(let G=0;G<Z.dataInputs.length;G++){const c=R.getDataInput(Z.dataInputs[G].name);if(!c)throw new Error("Could not find data input with name "+Z.dataInputs[G].name+" in block "+Z.className);c.deserialize(Z.dataInputs[G])}for(let G=0;G<Z.dataOutputs.length;G++){const c=R.getDataOutput(Z.dataOutputs[G].name);if(!c)throw new Error("Could not find data output with name "+Z.dataOutputs[G].name+" in block "+Z.className);c.deserialize(Z.dataOutputs[G])}return R.metadata=Z.metadata,R.deserialize&&R.deserialize(Z),R}function BL(Z){const[c,L]=Z.split(":");return DL({op:c,extension:L})}function DL(Z){var c;let L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const k=Z.extension?null===(c=HL[Z.extension])||void 0===c?void 0:c[Z.op]:lL[Z.op];if(!k&&(q.e.Warn(`No mapping found for operation ${Z.op} and extension ${Z.extension||"KHR_interactivity"}`),L)){const c={},L={flows:{}};if(Z.inputValueSockets){c.values={};for(const L in Z.inputValueSockets)c.values[L]={name:L}}return Z.outputValueSockets&&(L.values={},Object.keys(Z.outputValueSockets).forEach((Z=>{L.values[Z]={name:Z}}))),{Zz:[],inputs:c,outputs:L}}return k}function eL(Z,c,L){HL[c]||(HL[c]={}),HL[c][Z]=L}const HL={BABYLON:{"flow/log":{Zz:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},lL={"event/onStart":{Zz:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Zz:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Zz:["FlowGraphSendCustomEventBlock"],extraProcessor(Z,c,L,k,N){if("event/send"!==c.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const R=Z.configuration.event.value[0];if("number"!==typeof R)throw new Error("Event id should be a number");const G=k.arrays.events[R],V=N[0];return V.config||(V.config={}),V.config.eventId=G.eventId,V.config.eventData=G.eventData,N}},"event/receive":{Zz:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Z,c){var L;if(!Z.configuration)return q.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const k=Z.configuration.event;if(!k)return q.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const N=k.value[0];if("number"!==typeof N)return q.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(L=c.events)||void 0===L?void 0:L[N])?{valid:!0}:(q.e.Error(`Event with id ${N} not found`),{valid:!1,error:`Event with id ${N} not found`})},extraProcessor(Z,c,L,k,N){if("event/receive"!==c.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const R=Z.configuration.event.value[0];if("number"!==typeof R)throw new Error("Event id should be a number");const G=k.arrays.events[R],V=N[0];return V.config||(V.config={}),V.config.eventId=G.eventId,V.config.eventData=G.eventData,N}},"math/e":WL("FlowGraphEBlock"),"math/pi":WL("FlowGraphPIBlock"),"math/inf":WL("FlowGraphInfBlock"),"math/nan":WL("FlowGraphNaNBlock"),"math/abs":WL("FlowGraphAbsBlock"),"math/sign":WL("FlowGraphSignBlock"),"math/trunc":WL("FlowGraphTruncBlock"),"math/floor":WL("FlowGraphFloorBlock"),"math/ceil":WL("FlowGraphCeilBlock"),"math/round":{Zz:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N){var R;return(R=N[0]).config||(R.config={}),N[0].config.roundHalfAwayFromZero=!0,N}},"math/fract":WL("FlowGraphFractBlock"),"math/neg":WL("FlowGraphNegationBlock"),"math/add":WL("FlowGraphAddBlock",["a","b"],!0),"math/sub":WL("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Zz:["FlowGraphMultiplyBlock"],extraProcessor(Z,c,L,k,N){var R;(R=N[0]).config||(R.config={}),N[0].config.useMatrixPerComponent=!0,N[0].config.preventIntegerFloatArithmetic=!0;let G=-1;return Object.keys(Z.values||{}).find((c=>{var L;return void 0!==(null===(L=Z.values)||void 0===L?void 0:L[c].type)&&(G=Z.values[c].type,!0)})),-1!==G&&(N[0].config.type=k.arrays.types[G].flowGraphType),N},validation:Z=>Z.values?TL(Z):{valid:!0}},"math/div":WL("FlowGraphDivideBlock",["a","b"],!0),"math/rem":WL("FlowGraphModuloBlock",["a","b"]),"math/min":WL("FlowGraphMinBlock",["a","b"]),"math/max":WL("FlowGraphMaxBlock",["a","b"]),"math/clamp":WL("FlowGraphClampBlock",["a","b","c"]),"math/saturate":WL("FlowGraphSaturateBlock"),"math/mix":WL("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":WL("FlowGraphEqualityBlock",["a","b"]),"math/lt":WL("FlowGraphLessThanBlock",["a","b"]),"math/le":WL("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":WL("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":WL("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":WL("FlowGraphIsNaNBlock"),"math/isinf":WL("FlowGraphIsInfBlock"),"math/select":{Zz:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Zz:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":WL("FlowGraphSinBlock"),"math/cos":WL("FlowGraphCosBlock"),"math/tan":WL("FlowGraphTanBlock"),"math/asin":WL("FlowGraphASinBlock"),"math/acos":WL("FlowGraphACosBlock"),"math/atan":WL("FlowGraphATanBlock"),"math/atan2":WL("FlowGraphATan2Block",["a","b"]),"math/sinh":WL("FlowGraphSinhBlock"),"math/cosh":WL("FlowGraphCoshBlock"),"math/tanh":WL("FlowGraphTanhBlock"),"math/asinh":WL("FlowGraphASinhBlock"),"math/acosh":WL("FlowGraphACoshBlock"),"math/atanh":WL("FlowGraphATanhBlock"),"math/exp":WL("FlowGraphExponentialBlock"),"math/log":WL("FlowGraphLogBlock"),"math/log2":WL("FlowGraphLog2Block"),"math/log10":WL("FlowGraphLog10Block"),"math/sqrt":WL("FlowGraphSquareRootBlock"),"math/cbrt":WL("FlowGraphCubeRootBlock"),"math/pow":WL("FlowGraphPowerBlock",["a","b"]),"math/length":WL("FlowGraphLengthBlock"),"math/normalize":WL("FlowGraphNormalizeBlock"),"math/dot":WL("FlowGraphDotBlock",["a","b"]),"math/cross":WL("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":WL("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":WL("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Zz:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Zz:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Zz:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Zz:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Zz:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Zz:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Zz:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":WL("FlowGraphTransposeBlock"),"math/determinant":WL("FlowGraphDeterminantBlock"),"math/inverse":WL("FlowGraphInvertMatrixBlock"),"math/matmul":WL("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Zz:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Pc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N,R){const G=N[0].dataInputs.find((Z=>"rotationQuaternion"===Z.name));if(!G)throw new Error("Rotation quaternion input not found");return R._connectionValues[G.uniqueId]&&(R._connectionValues[G.uniqueId].type="Quaternion"),N}},"math/matDecompose":{Zz:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Pc"}}}},"math/quatConjugate":WL("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Zz:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N){var R;return(R=N[0]).config||(R.config={}),N[0].config.type="Quaternion",N}},"math/quatAngleBetween":WL("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Zz:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":WL("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":WL("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Zz:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N){var R;return(R=N[0]).config||(R.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract2x2":{Zz:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Zz:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N){var R;return(R=N[0]).config||(R.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract3x3":{Zz:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Zz:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N){var R;return(R=N[0]).config||(R.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract4x4":{Zz:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Zz:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N,R){var G,V;(V=N[0]).config||(V.config={});const p=N[0].dataInputs[0];return N[0].config.valueType=(null===(G=R._connectionValues[p.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",N}},"math/and":{Zz:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N,R){var G,V,p;(p=N[0]).config||(p.config={});const J=N[0].dataInputs[0],z=N[0].dataInputs[1];return N[0].config.valueType=(null===(G=R._connectionValues[J.uniqueId])||void 0===G?void 0:G.type)??(null===(V=R._connectionValues[z.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",N}},"math/or":{Zz:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N,R){var G,V,p;(p=N[0]).config||(p.config={});const J=N[0].dataInputs[0],z=N[0].dataInputs[1];return N[0].config.valueType=(null===(G=R._connectionValues[J.uniqueId])||void 0===G?void 0:G.type)??(null===(V=R._connectionValues[z.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",N}},"math/xor":{Zz:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,c,L,k,N,R){var G,V,p;(p=N[0]).config||(p.config={});const J=N[0].dataInputs[0],z=N[0].dataInputs[1];return N[0].config.valueType=(null===(G=R._connectionValues[J.uniqueId])||void 0===G?void 0:G.type)??(null===(V=R._connectionValues[z.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",N}},"math/asr":WL("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":WL("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":WL("FlowGraphLeadingZerosBlock"),"math/ctz":WL("FlowGraphTrailingZerosBlock"),"math/popcnt":WL("FlowGraphOneBitsCounterBlock"),"math/rad":WL("FlowGraphDegToRadBlock"),"math/deg":WL("FlowGraphRadToDegBlock"),"type/boolToInt":WL("FlowGraphBooleanToInt"),"type/boolToFloat":WL("FlowGraphBooleanToFloat"),"type/intToBool":WL("FlowGraphIntToBoolean"),"type/intToFloat":WL("FlowGraphIntToFloat"),"type/floatToInt":WL("FlowGraphFloatToInt"),"type/floatToBool":WL("FlowGraphFloatToBoolean"),"flow/sequence":{Zz:["FlowGraphSequenceBlock"],extraProcessor(Z,c,L,k,N){const R=N[0];return R.config||(R.config={}),R.config.outputSignalCount=Object.keys(Z.flows||[]).length,R.signalOutputs.forEach(((Z,c)=>{Z.name="out_"+c})),N}},"flow/branch":{Zz:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Zz:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const c=Z.configuration.cases.value;if(!c.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return q.e.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const L=new Set(c);Z.configuration.cases.value=Array.from(L)}return{valid:!0}},extraProcessor(Z,c,L,k,N){if("flow/switch"!==c.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return N[0].signalOutputs.forEach((Z=>{"default"!==Z.name&&(Z.name="out_"+Z.name)})),N}},"flow/while":{Zz:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Zz:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Z,c,L,k,N){const R=N[0];return R.config||(R.config={}),R.config.incrementIndexWhenLoopDone=!0,N}},"flow/doN":{Zz:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Zz:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Z,c,L,k,N){if("flow/multiGate"!==c.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const R=N[0];return R.config||(R.config={}),R.config.outputSignalCount=Object.keys(Z.flows).length,R.signalOutputs.forEach(((Z,c)=>{Z.name="out_"+c})),N}},"flow/waitAll":{Zz:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Z){var c,L;return"number"!==typeof(null===(c=Z.configuration)||void 0===c||null===(L=c.inputFlows)||void 0===L?void 0:L.value[0])&&(Z.configuration=Z.configuration||{inputFlows:{value:[0]}},Z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Zz:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Zz:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Zz:["FlowGraphCancelDelayBlock"]},"variable/get":{Zz:["FlowGraphGetVariableBlock"],validation(Z){var c,L;return null!==(c=Z.configuration)&&void 0!==c&&null!==(L=c.variable)&&void 0!==L&&L.value?{valid:!0}:(q.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,c)=>[c.getVariableName(Z[0])]}}},"variable/set":{Zz:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,c)=>[c.getVariableName(Z[0])]}}},"variable/setMultiple":{Zz:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Z,c)=>[Z[0].map((Z=>c.getVariableName(Z)))]}},extraProcessor:(Z,c,L,k,N)=>(N[0].dataInputs.forEach((Z=>{Z.name=k.getVariableName(+Z.name)})),N)},"variable/interpolate":{Zz:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Z,c)=>[c.getVariableName(Z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Z=>!0===Z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",ck:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",ck:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",ck:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",ck:"FlowGraphPlayAnimationBlock"},out:{name:"out",ck:"FlowGraphPlayAnimationBlock"},done:{name:"done",ck:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Z,c,L,k,N){var R,G,V;const p=N[0],J=null===(R=Z.configuration)||void 0===R?void 0:R.variable.value[0];if("number"!==typeof J)throw q.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const z=k.arrays.staticVariables[J];"undefined"===typeof p.config.animationType.value&&(k.arrays.staticVariables,p.config.animationType.value=(0,PL.F)(z.type));const i=N[4];return i.config||(i.config={}),(G=i.config).variable||(G.variable={}),i.config.variable.value=k.getVariableName(J),(V=N[3]).config||(V.config={}),N}},"pointer/get":{Zz:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",ck:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",ck:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,c,L,k,N)=>(N.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),N)},"pointer/set":{Zz:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",ck:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",ck:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,c,L,k,N)=>(N.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),N)},"pointer/interpolate":{Zz:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",ck:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",ck:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",ck:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",ck:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",ck:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",ck:"FlowGraphPlayAnimationBlock"},out:{name:"out",ck:"FlowGraphPlayAnimationBlock"},done:{name:"done",ck:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,c,L,k,N)=>(N.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(Z.values||[]).forEach((L=>{var N;const R=null===(N=Z.values)||void 0===N?void 0:N[L];if("value"===L&&R){const Z=R.type;void 0!==Z&&(c.config.animationType=k.arrays.types[Z].flowGraphType)}})))})),N)},"animation/start":{Zz:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",ck:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Z,c)=>[Z[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Z,c)=>[Z[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){const V=N[N.length-1];return V.config||(V.config={}),V.config.glTF=G,N}},"animation/stop":{Zz:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",ck:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){const V=N[N.length-1];return V.config||(V.config={}),V.config.glTF=G,N}},"animation/stopAt":{Zz:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",ck:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Z,c)=>[Z[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){const V=N[N.length-1];return V.config||(V.config={}),V.config.glTF=G,N}},"math/switch":{Zz:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const c=Z.configuration.cases.value;if(!c.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return q.e.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const L=new Set(c);Z.configuration.cases.value=Array.from(L)}return{valid:!0}},extraProcessor(Z,c,L,k,N){const R=N[0];return R.dataInputs.forEach((Z=>{"default"!==Z.name&&"case"!==Z.name&&(Z.name="in_"+Z.name)})),R.config||(R.config={}),R.config.treatCasesAsIntegers=!0,N}},"debug/log":{Zz:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function WL(Z){let c=arguments.length>2?arguments[2]:void 0;return{Zz:[Z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Z,c)=>(Z[c]={name:c},Z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,L,k,N,R){var G;if(c){(G=R[0]).config||(G.config={}),R[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(Z.values||{}).find((L=>{var k;return void 0!==(null===(k=Z.values)||void 0===k?void 0:k[L].type)&&(c=Z.values[L].type,!0)})),-1!==c&&(R[0].config.type=N.arrays.types[c].flowGraphType)}return R},validation:Z=>c?TL(Z):{valid:!0}}}function TL(Z){if(Z.values){const c=Object.keys(Z.values).map((c=>Z.values[c].type)).filter((Z=>void 0!==Z));if(!c.every((Z=>Z===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}lL["math/compose"]=lL["math/matCompose"],lL["math/decompose"]=lL["math/matDecompose"];var IL=L(11155);const dL={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Mc",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class QL{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Z,this._gltf=c,this._animationTargetFps=L,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Z of this._interactivityGraph.types)this._types.push(dL[Z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Z of this._interactivityGraph.declarations){const c=DL(Z);if(!c)throw q.e.Error(["No mapping found for declaration",Z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:Z.extension?Z.op+":"+Z.extension:Z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Z of this._interactivityGraph.variables){const c=this._parseVariable(Z);this._staticVariables.push(c)}}_parseVariable(Z,c){const L=this._types[Z.type];if(!L)throw q.e.Error(["No type found for variable",Z]),new Error("Error parsing variables");if(Z.value&&Z.value.length!==L.length)throw q.e.Error(["Invalid value length for variable",Z,L]),new Error("Error parsing variables");const k=Z.value||[];if(!k.length)switch(L.flowGraphType){case"boolean":k.push(!1);break;case"FlowGraphInteger":k.push(0);break;case"number":k.push(NaN);break;case"Vector2":k.push(NaN,NaN);break;case"Mc":k.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":k.fill(NaN,0,4);break;case"Matrix":k.fill(NaN,0,16);break;case"Matrix3D":k.fill(NaN,0,9)}return"number"===L.elementType&&"string"===typeof k[0]&&(k[0]=parseFloat(k[0])),{type:L.flowGraphType,value:c?c(k,this):k}}_parseEvents(){if(this._interactivityGraph.events)for(const Z of this._interactivityGraph.events){const c={eventId:Z.id||"internalEvent_"+this._internalEventsCounter++};Z.values&&(c.eventData=Object.keys(Z.values).map((c=>{var L;const k=null===(L=Z.values)||void 0===L?void 0:L[c];if(!k)throw q.e.Error(["No value found for event key",c]),new Error("Error parsing events");const N=this._types[k.type];if(!N)throw q.e.Error(["No type found for event value",k]),new Error("Error parsing events");const R="undefined"!==typeof k.value?this._parseVariable(k):void 0;return{id:c,type:N.flowGraphType,eventData:!0,value:R}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw q.e.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const L=this._mappings[c.declaration];if(!L)throw q.e.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(L.flowGraphMapping.validation){const k=L.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var Z;if(!k.valid)throw new Error(`Error validating interactivity node ${null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[c.declaration].op} - ${k.error}`)}const k=[];for(const Z of L.flowGraphMapping.Zz){const N=this._getEmptyBlock(Z,L.fullOperationName);this._parseNodeConfiguration(c,N,L.flowGraphMapping,Z),k.push(N)}this._nodes.push({Zz:k,fullOperationName:L.fullOperationName})}}_getEmptyBlock(Z,c){return{uniqueId:(0,IL.d)(),className:Z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(Z,c,L,k){const N=c.config;if(Z.configuration){const c=Object.keys(Z.configuration);for(const V of c){var R,G;const c=null===(R=Z.configuration)||void 0===R?void 0:R[V];if(!c)throw q.e.Error(["No value found for node configuration",V]),new Error("Error parsing node configuration");const p=null===(G=L.configuration)||void 0===G?void 0:G[V];if(p&&p.ck?p.ck===k:0===L.Zz.indexOf(k)){const Z=(null===p||void 0===p?void 0:p.name)||V;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===p||void 0===p?void 0:p.defaultValue)?c.value.length>=0?N[Z]={value:1===c.value.length?c.value[0]:c.value}:q.e.Warn(["Invalid value for node configuration",c]):N[Z]={value:p.defaultValue},p&&p.dataTransformer&&(N[Z].value=p.dataTransformer([N[Z].value],this)[0])}}}}_parseNodeConnections(Z){for(let u=0;u<this._nodes.length;u++){var c;const X=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[u];if(!X)throw q.e.Error(["No node found for interactivity node",this._nodes[u]]),new Error("Error parsing node connections");const h=this._nodes[u],B=this._mappings[X.declaration];if(!B)throw q.e.Error(["No mapping found for node",X]),new Error("Error parsing node connections");const D=X.flows||{},e=Object.keys(D).sort();for(const Z of e){var L,k,N,R;const c=D[Z],J=null===(L=B.flowGraphMapping.outputs)||void 0===L||null===(k=L.flows)||void 0===k?void 0:k[Z],z=(null===J||void 0===J?void 0:J.name)||Z,i=this._createNewSocketConnection(z,!0);(J&&J.ck&&h.Zz.find((Z=>Z.className===J.ck))||h.Zz[0]).signalOutputs.push(i);const t=c.node,E=this._nodes[t];if(!E)throw q.e.Error(["No node found for input node id",t]),new Error("Error parsing node connections");const x=BL(E.fullOperationName);if(!x)throw q.e.Error(["No mapping found for input node",E]),new Error("Error parsing node connections");let O=null===(N=x.inputs)||void 0===N||null===(R=N.flows)||void 0===R?void 0:R[c.socket||"in"],w=!1;if(!O)for(const Z in null===(G=x.inputs)||void 0===G?void 0:G.flows){var G,V,p;if(Z.startsWith("[")&&Z.endsWith("]"))w=!0,O=null===(V=x.inputs)||void 0===V||null===(p=V.flows)||void 0===p?void 0:p[Z]}const M=O?w?O.name.replace("$1",c.socket||""):O.name:c.socket||"in",P=O&&O.ck&&E.Zz.find((Z=>Z.className===O.ck))||E.Zz[0];let j=P.signalInputs.find((Z=>Z.name===M));j||(j=this._createNewSocketConnection(M),P.signalInputs.push(j)),j.connectedPointIds.push(i.uniqueId),i.connectedPointIds.push(j.uniqueId)}const H=X.values||{},l=Object.keys(H);for(const c of l){var J,z;const L=H[c];let k=null===(J=B.flowGraphMapping.inputs)||void 0===J||null===(z=J.values)||void 0===z?void 0:z[c],N=!1;if(!k)for(const Z in null===(i=B.flowGraphMapping.inputs)||void 0===i?void 0:i.values){var i,t,E;if(Z.startsWith("[")&&Z.endsWith("]"))N=!0,k=null===(t=B.flowGraphMapping.inputs)||void 0===t||null===(E=t.values)||void 0===E?void 0:E[Z]}const R=k?N?k.name.replace("$1",c):k.name:c,G=this._createNewSocketConnection(R);if((k&&k.ck&&h.Zz.find((Z=>Z.className===k.ck))||h.Zz[0]).dataInputs.push(G),void 0!==L.value){const c=this._parseVariable(L,k&&k.dataTransformer);Z._connectionValues[G.uniqueId]=c}else{if("undefined"===typeof L.node)throw q.e.Error(["Invalid value for value connection",L]),new Error("Error parsing node connections");{var x,O,w;const Z=L.node,c=L.socket||"value",k=this._nodes[Z];if(!k)throw q.e.Error(["No node found for output socket reference",L]),new Error("Error parsing node connections");const N=BL(k.fullOperationName);if(!N)throw q.e.Error(["No mapping found for output socket reference",L]),new Error("Error parsing node connections");let R=null===(x=N.outputs)||void 0===x||null===(O=x.values)||void 0===O?void 0:O[c],V=!1;if(!R)for(const L in null===(M=N.outputs)||void 0===M?void 0:M.values){var M,P,j;if(L.startsWith("[")&&L.endsWith("]"))V=!0,R=null===(P=N.outputs)||void 0===P||null===(j=P.values)||void 0===j?void 0:j[L]}const p=R?V?R.name.replace("$1",c):null===(w=R)||void 0===w?void 0:w.name:c,J=R&&R.ck&&k.Zz.find((Z=>Z.className===R.ck))||k.Zz[0];let z=J.dataOutputs.find((Z=>Z.name===p));z||(z=this._createNewSocketConnection(p,!0),J.dataOutputs.push(z)),G.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(G.uniqueId)}}}if(B.flowGraphMapping.interBlockConnectors)for(const Z of B.flowGraphMapping.interBlockConnectors){const c=Z.input,L=Z.output,k=Z.isVariable;this._connectFlowGraphNodes(c,L,h.Zz[Z.inputBlockIndex],h.Zz[Z.outputBlockIndex],k)}if(B.flowGraphMapping.extraProcessor){var o;const c=null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[X.declaration];if(!c)throw q.e.Error(["No declaration found for extra processor",X]),new Error("Error parsing node connections");h.Zz=B.flowGraphMapping.extraProcessor(X,c,B.flowGraphMapping,this,h.Zz,Z,this._gltf)}}}_createNewSocketConnection(Z,c){return{uniqueId:(0,IL.d)(),name:Z,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Z,c,L,k,N){const R=N?L.dataInputs:L.signalInputs,G=N?k.dataOutputs:k.signalOutputs,V=R.find((c=>c.name===Z))||this._createNewSocketConnection(Z),p=G.find((Z=>Z.name===c))||this._createNewSocketConnection(c,!0);R.find((c=>c.name===Z))||R.push(V),G.find((Z=>Z.name===c))||G.push(p),V.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(V.uniqueId)}getVariableName(Z){return"staticVariable_"+Z}serializeToFlowGraph(){const Z={uniqueId:(0,IL.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Z);for(let c=0;c<this._staticVariables.length;c++){const L=this._staticVariables[c];Z._userVariables[this.getVariableName(c)]=L}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Z,c)=>Z.concat(c.Zz)),[]),executionContexts:[Z]}}}const rL="KHR_interactivity";class fL{constructor(Z){this._loader=Z,this.name=rL,this.enabled=this._loader.isExtensionUsed(rL),this._pathConverter=(0,S.i)(this._loader.Bc),Z._skipStartAnimationStep=!0;const c=Z.babylonScene;c&&function(Z){(0,S.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Z.activeCamera)return new N.c(NaN,NaN,NaN,NaN);const c=N.c.FromRotationMatrix(Z.activeCamera.getWorldMatrix()).normalize();return Z.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>Z.activeCamera}),(0,S.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Z.activeCamera)return new N.h(NaN,NaN,NaN);const c=Z.activeCamera.getWorldMatrix().getTranslation();return Z.useRightHandedSystem||(c.x*=-1),c},type:"Mc",getTarget:()=>Z.activeCamera}),(0,S.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Z=>{var c;return(null===(c=Z._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:Z=>Z._babylonAnimationGroup}),(0,S.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Z=>{var c;return((null===(c=Z._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,S.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Z=>{var c;return((null===(c=Z._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,S.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Z=>{var c;return((null===(c=Z._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,S.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Z=>{var c;return((null===(c=Z._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Z;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,L=null===(Z=this._loader.Bc.extensions)||void 0===Z?void 0:Z.KHR_interactivity;if(!L)return;const k=new xL.d({LL:c});k.dispatchEventsSynchronously=!1;const N=L.graphs.map((Z=>new QL(Z,this._loader.Bc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(N.map((async Z=>await uL(Z,{coordinator:k,pathConverter:this._pathConverter})))),k.start()}}var SL;SL=async()=>(await Promise.resolve().then(L.bind(L,12878))).FlowGraphGLTFDataProvider,qL[`${rL}/${"FlowGraphGLTFDataProvider"}`]=SL,f(rL),r(rL,!0,(Z=>new fL(Z)));const sL="KHR_node_visibility";(0,S.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Z=>{const c=Z._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(Z,c)=>{var L,k;null===(L=c._primitiveBabylonMeshes)||void 0===L||L.forEach((Z=>{Z.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=Z),null===(k=c._primitiveBabylonMeshes)||void 0===k||k.forEach((c=>{c.isVisible=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class mL{constructor(Z){this.name=sL,this._loader=Z,this.enabled=Z.isExtensionUsed(sL)}async onReady(){var Z;null===(Z=this._loader.Bc.nodes)||void 0===Z||Z.forEach((Z=>{var c,L,k,N;(null===(c=Z._primitiveBabylonMeshes)||void 0===c||c.forEach((Z=>{Z.inheritVisibility=!0})),null!==(L=Z.extensions)&&void 0!==L&&L.KHR_node_visibility)&&(!1===(null===(k=Z.extensions)||void 0===k?void 0:k.KHR_node_visibility.visible)&&(Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=!1),null===(N=Z._primitiveBabylonMeshes)||void 0===N||N.forEach((Z=>{Z.isVisible=!1}))))}))}dispose(){this._loader=null}}f(sL),r(sL,!0,(Z=>new mL(Z)));const AL="KHR_node_selectability";eL("event/onSelect",AL,{Zz:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ck:"FlowGraphGetVariableBlock",dataTransformer:Z=>["pickedMesh_"+Z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",ck:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){var V,p,J,z,i,t;const E=N[N.length-1];E.config=E.config||{},E.config.glTF=G;const x=null===(V=Z.configuration)||void 0===V||null===(p=V.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const q="pickedMesh_"+x;return N[1].config.variable=q,R._userVariables[q]={className:"Mesh",id:null===G||void 0===G||null===(J=G.nodes)||void 0===J||null===(z=J[x]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===G||void 0===G||null===(i=G.nodes)||void 0===i||null===(t=i[x]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},N}}),(0,S.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Z=>{const c=Z._babylonTransformNode;return!c||void 0===c.ep||c.ep},set:(Z,c)=>{var L;null===(L=c._primitiveBabylonMeshes)||void 0===L||L.forEach((c=>{c.ep=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"ep"],type:"boolean"});class bL{constructor(Z){this.name=AL,this._loader=Z,this.enabled=Z.isExtensionUsed(AL)}async onReady(){var Z;null===(Z=this._loader.Bc.nodes)||void 0===Z||Z.forEach((Z=>{var c,L,k;null!==(c=Z.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(L=Z.extensions)||void 0===L?void 0:L.KHR_node_selectability.selectable)&&(null===(k=Z._babylonTransformNode)||void 0===k||k.getChildMeshes().forEach((Z=>{Z.ep=!1})))}))}dispose(){this._loader=null}}f(AL),r(AL,!0,(Z=>new bL(Z)));const FL="KHR_node_hoverability",UL="targetMeshPointerOver_";eL("event/onHoverIn",FL,{Zz:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ck:"FlowGraphGetVariableBlock",dataTransformer:Z=>[UL+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",ck:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){var V,p,J,z,i,t;const E=N[N.length-1];E.config=E.config||{},E.config.glTF=G;const x=null===(V=Z.configuration)||void 0===V||null===(p=V.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const q=UL+x;return N[1].config.variable=q,R._userVariables[q]={className:"Mesh",id:null===G||void 0===G||null===(J=G.nodes)||void 0===J||null===(z=J[x]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===G||void 0===G||null===(i=G.nodes)||void 0===i||null===(t=i[x]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},N}});const KL="targetMeshPointerOut_";eL("event/onHoverOut",FL,{Zz:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",ck:"FlowGraphGetVariableBlock",dataTransformer:Z=>[KL+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",ck:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,c,L,k,N,R,G){var V,p,J,z,i,t;const E=N[N.length-1];E.config=E.config||{},E.config.glTF=G;const x=null===(V=Z.configuration)||void 0===V||null===(p=V.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const q=KL+x;return N[1].config.variable=q,R._userVariables[q]={className:"Mesh",id:null===G||void 0===G||null===(J=G.nodes)||void 0===J||null===(z=J[x]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===G||void 0===G||null===(i=G.nodes)||void 0===i||null===(t=i[x]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},N}}),(0,S.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Z=>{const c=Z._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(Z,c)=>{var L;null===(L=c._primitiveBabylonMeshes)||void 0===L||L.forEach((c=>{c.pointerOverDisableMeshTesting=!Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class nL{constructor(Z){this.name=FL,this._loader=Z,this.enabled=Z.isExtensionUsed(FL)}async onReady(){var Z;null===(Z=this._loader.Bc.nodes)||void 0===Z||Z.forEach((Z=>{var c,L,k;null!==(c=Z.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(L=Z.extensions)||void 0===L?void 0:L.KHR_node_hoverability.hoverable)&&(null===(k=Z._babylonTransformNode)||void 0===k||k.getChildMeshes().forEach((Z=>{Z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}f(FL),r(FL,!0,(Z=>new nL(Z)));const gL="ExtrasAsMetadata";class yL{_assignExtras(Z,c){if(c.extras&&Object.keys(c.extras).length>0){const L=Z.metadata=Z.metadata||{};(L.Bc=L.Bc||{}).extras=c.extras}}constructor(Z){this.name=gL,this.enabled=!0,this._loader=Z}dispose(){this._loader=null}loadNodeAsync(Z,c,L){return this._loader.loadNodeAsync(Z,c,(Z=>{this._assignExtras(Z,c),L(Z)}))}loadCameraAsync(Z,c,L){return this._loader.loadCameraAsync(Z,c,(Z=>{this._assignExtras(Z,c),L(Z)}))}createMaterial(Z,c,L){const k=this._loader.createMaterial(Z,c,L);return this._assignExtras(k,c),k}}f(gL),r(gL,!1,(Z=>new yL(Z)));L(12878)},12754:(Z,c,L)=>{"use strict";L.d(c,{c:()=>T,g:()=>B,h:()=>h,j:()=>D});var k=L(11027),N=L(11038),R=L(12430),G=L(11325),V=L(11274),p=L(11282),J=L(11052),z=L(11023),i=L(11321),t=L(11732),E=L(11329),x=L(11251);class q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.si=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Xt=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture=Z}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const c of this.skeletons)Z=Z.concat(c.bones);return Z}}class O extends q{}class w{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Z=this.rootNodes;for(const k of Z)k.dispose();Z.length=0;const c=this.skeletons;for(const k of c)k.dispose();c.length=0;const L=this.animationGroups;for(const k of L)k.dispose();L.length=0}}class M extends q{constructor(Z){super(),this._wasAddedToScene=!1,(Z=Z||z.d.LastCreatedScene)&&(this.LL=Z,this.proceduralTextures=[],Z.Xc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Z.getEngine().onContextRestoredObservable.add((()=>{for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();for(const Z of this.si)Z.rebuild();for(const Z of this.textures)Z._rebuild()})))}_topologicalSort(Z){const c=new Map;for(const G of Z)c.set(G.uniqueId,G);const L={dependsOn:new Map,dependedBy:new Map};for(const G of Z){const Z=G.uniqueId;L.dependsOn.set(Z,new Set),L.dependedBy.set(Z,new Set)}for(const G of Z){const Z=G.uniqueId,k=L.dependsOn.get(Z);if(G instanceof i.e){const N=G.sourceMesh;c.has(N.uniqueId)&&(k.add(N.uniqueId),L.dependedBy.get(N.uniqueId).add(Z))}const N=L.dependedBy.get(Z);for(const R of G.getDescendants()){const k=R.uniqueId;if(c.has(k)){N.add(k);L.dependsOn.get(k).add(Z)}}}const k=[],N=[];for(const G of Z){const Z=G.uniqueId;0===L.dependsOn.get(Z).size&&(N.push(G),c.delete(Z))}const R=N;for(;R.length>0;){const Z=R.shift();k.push(Z);const N=L.dependedBy.get(Z.uniqueId);for(const k of Array.from(N.values())){const N=L.dependsOn.get(k);N.delete(Z.uniqueId),0===N.size&&c.get(k)&&(R.push(c.get(k)),c.delete(k))}}return c.size>0&&(J.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((Z=>{J.e.Error(Z.name)}))),k}_addNodeAndDescendantsToList(Z,c,L,k){if(L&&(!k||k(L))&&!c.has(L.uniqueId)){Z.push(L),c.add(L.uniqueId);for(const N of L.getDescendants(!0))this._addNodeAndDescendantsToList(Z,c,N,k)}}_isNodeInContainer(Z){return Z instanceof p.d&&-1!==this.meshes.indexOf(Z)||(Z instanceof V.e&&-1!==this.transformNodes.indexOf(Z)||(Z instanceof t.e&&-1!==this.lights.indexOf(Z)||Z instanceof E.d&&-1!==this.cameras.indexOf(Z)))}_isValidHierarchy(){for(const Z of this.meshes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.transformNodes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.lights)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.cameras)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||N.c.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const k={},R={},V=new w,p=[],J=[],z={doNotInstantiate:!0,...L},i=[],t=new Set;for(const N of this.transformNodes)null===N.parent&&this._addNodeAndDescendantsToList(i,t,N,z.predicate);for(const N of this.meshes)null===N.parent&&this._addNodeAndDescendantsToList(i,t,N,z.predicate);const E=this._topologicalSort(i),x=(L,N)=>{if(((c,L)=>{if(k[c.uniqueId]=L.uniqueId,R[L.uniqueId]=L,Z&&(L.name=Z(c.name)),L instanceof G.c){const Z=L;if(Z.morphTargetManager){const L=c.morphTargetManager;Z.morphTargetManager=L.clone();for(let c=0;c<L.numTargets;c++){const N=L.getTarget(c),G=Z.morphTargetManager.getTarget(c);k[N.uniqueId]=G.uniqueId,R[G.uniqueId]=G}}}})(L,N),L.parent){const Z=k[L.parent.uniqueId],c=R[Z];N.parent=c||L.parent}if(N.position&&L.position&&N.position.R(L.position),N.rotationQuaternion&&L.rotationQuaternion&&N.rotationQuaternion.R(L.rotationQuaternion),N.rotation&&L.rotation&&N.rotation.R(L.rotation),N.Pc&&L.Pc&&N.Pc.R(L.Pc),N.material){const G=N;if(G.material)if(c){const c=L.material;if(-1===J.indexOf(c)){let L=c.clone(Z?Z(c.name):"Clone of "+c.name);if(J.push(c),k[c.uniqueId]=L.uniqueId,R[L.uniqueId]=L,"MultiMaterial"===c.getClassName()){const N=c;for(const c of N.Ic)c&&(L=c.clone(Z?Z(c.name):"Clone of "+c.name),J.push(c),k[c.uniqueId]=L.uniqueId,R[L.uniqueId]=L);N.Ic=N.Ic.map((Z=>Z&&R[k[Z.uniqueId]]))}}"InstancedMesh"!==G.getClassName()&&(G.material=R[k[c.uniqueId]])}else"MultiMaterial"===G.material.getClassName()?-1===this.LL.multiMaterials.indexOf(G.material)&&this.LL.addMultiMaterial(G.material):-1===this.LL.materials.indexOf(G.material)&&this.LL.addMaterial(G.material)}null===N.parent&&V.rootNodes.push(N)};for(const N of E)if("InstancedMesh"===N.getClassName()){const Z=N,c=Z.sourceMesh,L=k[c.uniqueId];x(Z,("number"===typeof L?R[L]:c).createInstance(Z.name))}else{let Z=!0;"Ac"===N.getClassName()||"Node"===N.getClassName()||N.skeleton||!N.getTotalVertices||0===N.getTotalVertices()?Z=!1:z.doNotInstantiate&&(Z="function"===typeof z.doNotInstantiate?!z.doNotInstantiate(N):!z.doNotInstantiate);const c=Z?N.createInstance(`instance of ${N.name}`):N.clone(`Clone of ${N.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${N.name}`);x(N,c)}for(const N of this.skeletons){if(z.predicate&&!z.predicate(N))continue;const c=N.clone(Z?Z(N.name):"Clone of "+N.name);for(const Z of this.meshes)if(Z.skeleton===N&&!Z.isAnInstance){const L=R[k[Z.uniqueId]];if(!L||L.isAnInstance)continue;if(L.skeleton=c,-1!==p.indexOf(c))continue;p.push(c);for(const Z of c.bones)Z._linkedTransformNode&&(Z._linkedTransformNode=R[k[Z._linkedTransformNode.uniqueId]])}V.skeletons.push(c)}for(const N of this.animationGroups){if(z.predicate&&!z.predicate(N))continue;const c=N.clone(Z?Z(N.name):"Clone of "+N.name,(Z=>R[k[Z.uniqueId]]||Z));V.animationGroups.push(c)}return V}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||N.c.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.LL.environmentTexture=this.environmentTexture);for(const Z of this.LL._serializableComponents)Z.addFromContainer(this);this.LL.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const L of this.cameras)Z&&!Z(L)||(this.LL.addCamera(L),c.push(L));for(const L of this.lights)Z&&!Z(L)||(this.LL.addLight(L),c.push(L));for(const L of this.meshes)Z&&!Z(L)||(this.LL.mJ(L),c.push(L));for(const L of this.skeletons)Z&&!Z(L)||this.LL.addSkeleton(L);for(const L of this.animations)Z&&!Z(L)||this.LL.addAnimation(L);for(const L of this.animationGroups)Z&&!Z(L)||this.LL.addAnimationGroup(L);for(const L of this.multiMaterials)Z&&!Z(L)||this.LL.addMultiMaterial(L);for(const L of this.materials)Z&&!Z(L)||this.LL.addMaterial(L);for(const L of this.morphTargetManagers)Z&&!Z(L)||this.LL.addMorphTargetManager(L);for(const L of this.geometries)Z&&!Z(L)||this.LL.addGeometry(L);for(const L of this.transformNodes)Z&&!Z(L)||(this.LL.addTransformNode(L),c.push(L));for(const L of this.actionManagers)Z&&!Z(L)||this.LL.addActionManager(L);for(const L of this.textures)Z&&!Z(L)||this.LL.addTexture(L);for(const L of this.reflectionProbes)Z&&!Z(L)||this.LL.addReflectionProbe(L);for(const L of c)L.parent&&-1===this.LL.getNodes().indexOf(L.parent)&&(L.setParent?L.setParent(null):L.parent=null)}removeAllFromScene(){this._isValidHierarchy()||N.c.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.LL.environmentTexture&&(this.LL.environmentTexture=null);for(const Z of this.LL._serializableComponents)Z.removeFromContainer(this)}removeFromScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)Z&&!Z(c)||this.LL.removeCamera(c);for(const c of this.lights)Z&&!Z(c)||this.LL.removeLight(c);for(const c of this.meshes)Z&&!Z(c)||this.LL.sJ(c,!0);for(const c of this.skeletons)Z&&!Z(c)||this.LL.removeSkeleton(c);for(const c of this.animations)Z&&!Z(c)||this.LL.removeAnimation(c);for(const c of this.animationGroups)Z&&!Z(c)||this.LL.removeAnimationGroup(c);for(const c of this.multiMaterials)Z&&!Z(c)||this.LL.removeMultiMaterial(c);for(const c of this.materials)Z&&!Z(c)||this.LL.removeMaterial(c);for(const c of this.morphTargetManagers)Z&&!Z(c)||this.LL.removeMorphTargetManager(c);for(const c of this.geometries)Z&&!Z(c)||this.LL.removeGeometry(c);for(const c of this.transformNodes)Z&&!Z(c)||this.LL.removeTransformNode(c);for(const c of this.actionManagers)Z&&!Z(c)||this.LL.removeActionManager(c);for(const c of this.textures)Z&&!Z(c)||this.LL.removeTexture(c);for(const c of this.reflectionProbes)Z&&!Z(c)||this.LL.removeReflectionProbe(c)}dispose(){const Z=this.cameras.slice(0);for(const E of Z)E.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const E of c)E.dispose();this.lights.length=0;const L=this.meshes.slice(0);for(const E of L)E.dispose();this.meshes.length=0;const k=this.skeletons.slice(0);for(const E of k)E.dispose();this.skeletons.length=0;const N=this.animationGroups.slice(0);for(const E of N)E.dispose();this.animationGroups.length=0;const R=this.multiMaterials.slice(0);for(const E of R)E.dispose();this.multiMaterials.length=0;const G=this.materials.slice(0);for(const E of G)E.dispose();this.materials.length=0;const V=this.geometries.slice(0);for(const E of V)E.dispose();this.geometries.length=0;const p=this.transformNodes.slice(0);for(const E of p)E.dispose();this.transformNodes.length=0;const J=this.actionManagers.slice(0);for(const E of J)E.dispose();this.actionManagers.length=0;const z=this.textures.slice(0);for(const E of z)E.dispose();this.textures.length=0;const i=this.reflectionProbes.slice(0);for(const E of i)E.dispose();this.reflectionProbes.length=0;const t=this.morphTargetManagers.slice(0);for(const E of t)E.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const E of this.LL._serializableComponents)E.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.LL.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Z,c,L){if(Z&&c)for(const k of Z){let Z=!0;if(L)for(const c of L)if(k===c){Z=!1;break}Z&&(c.push(k),k._parentContainer=this)}}moveAllFromScene(Z){this._wasAddedToScene=!1,void 0===Z&&(Z=new O);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.LL[c],this[c],Z[c]));this.environmentTexture=this.LL.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Z=new G.c("assetContainerRootMesh",this.LL);for(const c of this.meshes)c.parent||Z.addChild(c);return this.meshes.unshift(Z),Z}mergeAnimationsTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.d.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Z)return J.e.Error("No scene available to merge animations to"),[];const k=L||(c=>{let L=null;const k=c.animations.length?c.animations[0].targetProperty:"",N=c.name.split(".").join("").split("_primitive")[0];switch(k){case"position":case"rotationQuaternion":L=Z.getTransformNodeByName(c.name)||Z.getTransformNodeByName(N);break;case"influence":L=Z.getMorphTargetByName(c.name)||Z.getMorphTargetByName(N);break;default:L=Z.getNodeByName(c.name)||Z.getNodeByName(N)}return L}),N=this.getNodes();for(const V of N){const Z=k(V);if(null!==Z){for(const c of V.animations){const L=Z.animations.filter((Z=>Z.targetProperty===c.targetProperty));for(const c of L){const L=Z.animations.indexOf(c,0);L>-1&&Z.animations.splice(L,1)}}Z.animations=Z.animations.concat(V.animations)}}const R=[],G=this.animationGroups.slice();for(const V of G){R.push(V.clone(V.name,k));for(const Z of V.animatables)Z.stop()}for(const V of c){const c=k(V.target);c&&(Z.beginAnimation(c,V.fromFrame,V.toFrame,V.loopAnimation,V.speedRatio,V.onAnimationEnd?V.onAnimationEnd:void 0,void 0,!0,void 0,V.onAnimationLoop?V.onAnimationLoop:void 0),Z.stopAnimation(V.target))}return R}populateRootNodes(){this.rootNodes.length=0;for(const Z of this.meshes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.transformNodes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.lights)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.cameras)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z)}addAllAssetsToContainer(Z){if(!Z)return;const c=[],L=new Set;for(c.push(Z);c.length>0;){const Z=c.pop();if(Z instanceof G.c?(Z.zc&&-1===this.geometries.indexOf(Z.zc)&&this.geometries.push(Z.zc),this.meshes.push(Z)):Z instanceof i.e?this.meshes.push(Z):Z instanceof V.e?this.transformNodes.push(Z):Z instanceof t.e?this.lights.push(Z):Z instanceof E.d&&this.cameras.push(Z),Z instanceof p.d){if(Z.material&&-1===this.materials.indexOf(Z.material)){this.materials.push(Z.material);for(const c of Z.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}Z.skeleton&&-1===this.skeletons.indexOf(Z.skeleton)&&this.skeletons.push(Z.skeleton),Z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Z.morphTargetManager)&&this.morphTargetManagers.push(Z.morphTargetManager)}for(const k of Z.getChildren())L.has(k)||c.push(k);L.add(Z)}this.populateRootNodes()}_getByTags(Z,c,L){if(void 0===c)return Z;const k=[];for(const N in Z){const R=Z[N];x.b&&x.b.MatchesQuery(R,c)&&(!L||L(R))&&k.push(R)}return k}getMeshesByTags(Z,c){return this._getByTags(this.meshes,Z,c)}getCamerasByTags(Z,c){return this._getByTags(this.cameras,Z,c)}getLightsByTags(Z,c){return this._getByTags(this.lights,Z,c)}getMaterialsByTags(Z,c){return this._getByTags(this.materials,Z,c).concat(this._getByTags(this.multiMaterials,Z,c))}getTransformNodesByTags(Z,c){return this._getByTags(this.transformNodes,Z,c)}}var P=L(11090);class j{constructor(Z){this.byteOffset=0,this.buffer=Z}async loadAsync(Z){const c=await this.buffer.readAsync(this.byteOffset,Z);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z}readUint8Array(Z){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,c}readString(Z){return(0,P.g)(this.readUint8Array(Z))}skipBytes(Z){this._dataByteOffset+=Z,this.byteOffset+=Z}}var o=L(12756);const u="Z2xURg",X={name:"Bc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Z=>-1!==Z.indexOf("asset")&&-1!==Z.indexOf("version")||Z.startsWith("data:base64,"+u)||Z.startsWith("data:;base64,"+u)||Z.startsWith("data:application/octet-stream;base64,"+u)||Z.startsWith("data:model/gltf-binary;base64,"+u)};var h,B,D,e=L(11081),H=L(11085);function l(Z,c,L){try{return Promise.resolve(new Uint8Array(Z,c,L))}catch(k){return Promise.reject(k)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(B||(B={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(D||(D={}));class W{constructor(){this.coordinateSystemMode=h.AUTO,this.animationStartMode=B.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.extensionOptions={}}R(Z){Z&&(this.onParsed=Z.onParsed,this.coordinateSystemMode=Z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Z.loadSkins??this.loadSkins,this.loadMorphTargets=Z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Z.compileMaterials??this.compileMaterials,this.useClipPlane=Z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Z.useRangeRequests??this.useRangeRequests,this.createInstances=Z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Z.customRootNode,this.onMeshLoaded=Z.onMeshLoaded,this.onSkinLoaded=Z.onSkinLoaded,this.onTextureLoaded=Z.onTextureLoaded,this.onMaterialLoaded=Z.onMaterialLoaded,this.onCameraLoaded=Z.onCameraLoaded,this.extensionOptions=Z.extensionOptions??this.extensionOptions)}}class T extends W{constructor(Z){super(),this.onParsedObservable=new k.b,this.onMeshLoadedObservable=new k.b,this.onSkinLoadedObservable=new k.b,this.onTextureLoadedObservable=new k.b,this.onMaterialLoadedObservable=new k.b,this.onCameraLoadedObservable=new k.b,this.onCompleteObservable=new k.b,this.onErrorObservable=new k.b,this.Xc=new k.b,this.onExtensionLoadedObservable=new k.b,this.validate=!1,this.onValidatedObservable=new k.b,this._loader=null,this._state=null,this._requests=new Array,this.name=X.name,this.extensions=X.extensions,this.onLoaderStateChangedObservable=new k.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.R(Z)}set onParsed(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Z&&(this._onParsedObserver=this.onParsedObservable.add(Z))}set onMeshLoaded(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z))}set onSkinLoaded(Z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>Z(c.node,c.skinnedNode))))}set onTextureLoaded(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z))}set onMaterialLoaded(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z))}set onCameraLoaded(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z))}set onComplete(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)}set onError(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}set onExtensionLoaded(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Z of this._requests)Z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Xc.notifyObservers(void 0),this.Xc.clear()}loadFile(Z,c,L,R,G,V,p,z){if(ArrayBuffer.isView(c))return this._loadBinary(Z,c,L,R,p,z),null;this._progressCallback=G;const i=c.name||N.c.GetFilename(c);if(V){if(this.useRangeRequests){this.validate&&J.e.Warn("glTF validation is not supported when range requests are enabled");const L={abort:()=>{},onCompleteObservable:new k.b},N={readAsync:(L,k)=>new Promise(((N,R)=>{this._loadFile(Z,c,(Z=>{N(new Uint8Array(Z))}),!0,(Z=>{R(Z)}),(Z=>{Z.setRequestHeader("Range",`bytes=${L}-${L+k-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(N)).then((Z=>{L.onCompleteObservable.notifyObservers(L),R(Z)}),p?Z=>p(void 0,Z):void 0),L}return this._loadFile(Z,c,(c=>{this._validate(Z,new Uint8Array(c,0,c.byteLength),L,i),this._unpackBinaryAsync(new j({readAsync:(Z,L)=>l(c,Z,L),byteLength:c.byteLength})).then((Z=>{R(Z)}),p?Z=>p(void 0,Z):void 0)}),!0,p)}return this._loadFile(Z,c,(c=>{try{this._validate(Z,c,L,i),R({json:this._parseJson(c)})}catch{p&&p()}}),!1,p)}_loadBinary(Z,c,L,k,N,R){this._validate(Z,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),L,R),this._unpackBinaryAsync(new j({readAsync:(Z,L)=>function(Z,c,L){try{if(c<0||c>=Z.byteLength)throw new RangeError("Offset is out of range.");if(c+L>Z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Z.buffer,Z.byteOffset+c,L))}catch(k){return Promise.reject(k)}}(c,Z,L),byteLength:c.byteLength})).then((Z=>{k(Z)}),N?Z=>N(void 0,Z):void 0)}importMeshAsync(Z,c,L,k,N,R){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(L),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(L),this._loader.importMeshAsync(Z,c,null,L,k,N,R))))}loadAsync(Z,c,L,k,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(Z,c,L,k,N))))}loadAssetContainerAsync(Z,c,L,k,N){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(c);const R=new M(Z),G=[];this.onMaterialLoadedObservable.add((Z=>{G.push(Z)}));const V=[];this.onTextureLoadedObservable.add((Z=>{V.push(Z)}));const p=[];this.onCameraLoadedObservable.add((Z=>{p.push(Z)}));const J=[];return this.onMeshLoadedObservable.add((Z=>{Z.morphTargetManager&&J.push(Z.morphTargetManager)})),this._loader.importMeshAsync(null,Z,R,c,L,k,N).then((Z=>(Array.prototype.push.apply(R.geometries,Z.geometries),Array.prototype.push.apply(R.meshes,Z.meshes),Array.prototype.push.apply(R.si,Z.si),Array.prototype.push.apply(R.skeletons,Z.skeletons),Array.prototype.push.apply(R.animationGroups,Z.animationGroups),Array.prototype.push.apply(R.materials,G),Array.prototype.push.apply(R.textures,V),Array.prototype.push.apply(R.lights,Z.lights),Array.prototype.push.apply(R.transformNodes,Z.transformNodes),Array.prototype.push.apply(R.cameras,p),Array.prototype.push.apply(R.morphTargetManagers,J),R)))}))}canDirectLoad(Z){return X.canDirectLoad(Z)}directLoad(Z,c){if(c.startsWith("base64,"+u)||c.startsWith(";base64,"+u)||c.startsWith("application/octet-stream;base64,"+u)||c.startsWith("model/gltf-binary;base64,"+u)){const L=(0,e.c)(c);return this._validate(Z,new Uint8Array(L,0,L.byteLength)),this._unpackBinaryAsync(new j({readAsync:(Z,c)=>l(L,Z,c),byteLength:L.byteLength}))}return this._validate(Z,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(Z){return new T(Z[X.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Z,c)=>{this.onCompleteObservable.addOnce((()=>{Z()})),this.onErrorObservable.addOnce((Z=>{c(Z)}))}))}_setState(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(D[this._state]))}_loadFile(Z,c,L,k,N,R){const G=Z._loadFile(c,L,(Z=>{this._onProgress(Z,G)}),!0,k,N,R);return G.onCompleteObservable.add((()=>{G._lengthComputable=!0,G._total=G._loaded})),this._requests.push(G),G}_onProgress(Z,c){if(!this._progressCallback)return;c._lengthComputable=Z.lengthComputable,c._loaded=Z.loaded,c._total=Z.total;let L=!0,k=0,N=0;for(const R of this._requests){if(void 0===R._lengthComputable||void 0===R._loaded||void 0===R._total)return;L=L&&R._lengthComputable,k+=R._loaded,N+=R._total}this._progressCallback({lengthComputable:L,loaded:k,total:L?N:0})}_validate(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.d.ValidateAsync(c,L,k,(c=>this.preprocessUrlAsync(L+c).then((c=>Z._loadFileAsync(c,void 0,!0,!0).then((Z=>new Uint8Array(Z,0,Z.byteLength))))))).then((Z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Z),this.onValidatedObservable.clear()}),(Z=>{this._endPerformanceCounter("Validate JSON"),N.c.Warn(`Failed to validate: ${Z.message}`),this.onValidatedObservable.clear()})))}_getLoader(Z){const c=Z.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const L=T._parseVersion(c.version);if(!L)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const Z=T._parseVersion(c.minVersion);if(!Z)throw new Error("Invalid minimum version: "+c.minVersion);if(T._compareVersion(Z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const k={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[L.major];if(!k)throw new Error("Unsupported version: "+c.version);return k(this)}_parseJson(Z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Z.length}`);const c=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(Z){return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((()=>{const c=Z.readUint32();if(1179937895!==c)throw new H.h("Unexpected magic: "+c,H.e.GLTFLoaderUnexpectedMagicError);const L=Z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${L}`);const k=Z.readUint32();let N;switch(this.useRangeRequests||k===Z.buffer.byteLength||J.e.Warn(`Length in header does not match actual data length: ${k} != ${Z.buffer.byteLength}`),L){case 1:N=this._unpackBinaryV1Async(Z,k);break;case 2:N=this._unpackBinaryV2Async(Z,k);break;default:throw new Error("Unsupported version: "+L)}return this._endPerformanceCounter("Unpack Binary"),N}))}_unpackBinaryV1Async(Z,c){const L=Z.readUint32(),k=Z.readUint32();if(0!==k)throw new Error(`Unexpected content format: ${k}`);const N=c-Z.byteOffset,R={json:this._parseJson(Z.readString(L)),bin:null};if(0!==N){const c=Z.byteOffset;R.bin={readAsync:(L,k)=>Z.buffer.readAsync(c+L,k),byteLength:N}}return Promise.resolve(R)}_unpackBinaryV2Async(Z,c){const L=1313821514,k=5130562,N=Z.readUint32();if(Z.readUint32()!==L)throw new Error("First chunk format is not JSON");return Z.byteOffset+N===c?Z.loadAsync(N).then((()=>({json:this._parseJson(Z.readString(N)),bin:null}))):Z.loadAsync(N+8).then((()=>{const R={json:this._parseJson(Z.readString(N)),bin:null},G=()=>{const N=Z.readUint32();switch(Z.readUint32()){case L:throw new Error("Unexpected JSON chunk");case k:{const c=Z.byteOffset;R.bin={readAsync:(L,k)=>Z.buffer.readAsync(c+L,k),byteLength:N},Z.skipBytes(N);break}default:Z.skipBytes(N)}return Z.byteOffset!==c?Z.loadAsync(8).then(G):Promise.resolve(R)};return G()}))}static _parseVersion(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};const c=(Z+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(Z,c){return Z.major>c.major?1:Z.major<c.major?-1:Z.minor>c.minor?1:Z.minor<c.minor?-1:0}_logOpen(Z){this._log(Z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Z){const c=T._logSpaces.substring(0,2*this._logIndentLevel);J.e.Log(`${c}${Z}`)}_logDisabled(Z){}_startPerformanceCounterEnabled(Z){N.c.StartPerformanceCounter(Z)}_startPerformanceCounterDisabled(Z){}_endPerformanceCounterEnabled(Z){N.c.EndPerformanceCounter(Z)}_endPerformanceCounterDisabled(Z){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,R.c)(new T)},12756:(Z,c,L)=>{"use strict";L.d(c,{d:()=>G});var k=L(11038);function N(Z,c,L,k){const N={externalResourceFunction:k};return L&&(N.uri="file:"===c?L:c+L),ArrayBuffer.isView(Z)?GLTFValidator.validateBytes(Z,N):GLTFValidator.validateString(Z,N)}function R(){const Z=[];onmessage=c=>{const L=c.data;switch(L.id){case"init":importScripts(L.url);break;case"validate":N(L.data,L.rootUrl,L.fileName,(c=>new Promise(((L,k)=>{const N=Z.length;Z.push({resolve:L,reject:k}),postMessage({id:"getExternalResource",index:N,uri:c})})))).then((Z=>{postMessage({id:"validate.resolve",value:Z})}),(Z=>{postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[L.index].resolve(L.value);break;case"getExternalResource.reject":Z[L.index].reject(L.reason)}}}class G{static ValidateAsync(Z,c,L,G){return"function"===typeof Worker?new Promise(((V,p)=>{const J=`${N}(${R})()`,z=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),i=new Worker(z),t=Z=>{i.removeEventListener("error",t),i.removeEventListener("message",E),p(Z)},E=Z=>{const c=Z.data;switch(c.id){case"getExternalResource":G(c.uri).then((Z=>{i.postMessage({id:"getExternalResource.resolve",index:c.index,value:Z},[Z.buffer])}),(Z=>{i.postMessage({id:"getExternalResource.reject",index:c.index,reason:Z})}));break;case"validate.resolve":i.removeEventListener("error",t),i.removeEventListener("message",E),V(c.value),i.terminate();break;case"validate.reject":i.removeEventListener("error",t),i.removeEventListener("message",E),p(c.reason),i.terminate()}};if(i.addEventListener("error",t),i.addEventListener("message",E),i.postMessage({id:"init",url:k.c.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Z)){const k=Z.slice();i.postMessage({id:"validate",data:k,rootUrl:c,fileName:L},[k.buffer])}else i.postMessage({id:"validate",data:Z,rootUrl:c,fileName:L})})):(this._LoadScriptPromise||(this._LoadScriptPromise=k.c.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>N(Z,c,L,G))))}}G.Configuration={url:`${k.c._DefaultCdnUrl}/gltf_validator.js`}},13325:(Z,c,L)=>{"use strict";L.d(c,{d:()=>X});var k=L(11170),N=L(11173),R=L(11242),G=L(10993),V=L(11650),p=L(11663),J=L(11190),z=L(11588),i=L(11012),t=L(11124);L(12539),L(12459),L(12469),L(12464),L(12476),L(12480),L(12482);const E="imageProcessingCompatibility",x="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";t.e.IncludesShadersStore[E]||(t.e.IncludesShadersStore[E]=x);const q="skyPixelShader",O="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";t.e.ShadersStore[q]||(t.e.ShadersStore[q]=O);L(12548),L(12490),L(12493),L(12499),L(12495);const w="skyVertexShader",M="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";t.e.ShadersStore[w]||(t.e.ShadersStore[w]=M);var P=L(11688),j=L(11268),o=L(11258);class u extends V.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class X extends p.b{constructor(Z,c){super(Z,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new G.h(0,100,0),this.useSunPosition=!1,this.cameraOffset=G.h.Zero(),this.up=G.h.Up(),this.dithering=!1,this._cameraPosition=G.h.Zero(),this._skyOrientation=new G.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Z,c){const L=c._drawWrapper;if(this.isFrozen&&L.effect&&L._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new u);const k=c.materialDefines,N=this.XZ();if(this._isReadyForSubMesh(c))return!0;if((0,o.T)(Z,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,k),(0,o.K)(Z,k,!0,!1),k.IMAGEPROCESSINGPOSTPROCESS!==N.imageProcessingConfiguration.applyByPostProcess&&k.markAsMiscDirty(),k.DITHER!==this.dithering&&k.markAsMiscDirty(),k.isDirty){k.markAsProcessed(),N.resetCachedMaterial();const Z=new P.c;k.FOG&&Z.addFallback(1,"FOG"),k.IMAGEPROCESSINGPOSTPROCESS=N.imageProcessingConfiguration.applyByPostProcess,k.DITHER=this.dithering;const L=[J.g.PositionKind];k.VERTEXCOLOR&&L.push(J.g.ColorKind);const R="sky",G=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,j.b)(G);const V=k.toString();c.setEffect(N.getEngine().createEffect(R,L,G,[],V,Z,this.onCompiled,this.onError),k,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(k._renderId=N.getRenderId(),L._wasPreviouslyReady=!0,!0)}bindForSubMesh(Z,c,L){const k=this.XZ(),N=L.materialDefines;if(!N)return;const R=L.effect;if(!R)return;this._activeEffect=R,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",k.getTransformMatrix()),this._mustRebind(k,R,L)&&((0,j.e)(R,this,k),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,o.k)(N,R,k)),k.fogEnabled&&c.applyFog&&k.fogMode!==z.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",k.getViewMatrix()),(0,o.d)(k,c,this._activeEffect);const V=k.activeCamera;if(V){const Z=V.getWorldMatrix();this._cameraPosition.x=Z.m[12],this._cameraPosition.y=Z.m[13],this._cameraPosition.z=Z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Z=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(Z),this.sunPosition.y=this.distance*Math.sin(-Z),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(Z),G.c.FromUnitVectorsToRef(G.h.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,L)}getAnimatables(){return[]}dispose(Z){super.dispose(Z)}clone(Z){return R.e.Clone((()=>new X(Z,this.XZ())),this)}serialize(){const Z=super.serialize();return Z.customType="BABYLON.SkyMaterial",Z}getClassName(){return"SkyMaterial"}static Parse(Z,c,L){return R.e.Parse((()=>new X(Z.name,c)),Z,c,L)}}(0,k.d)([(0,N.H)()],X.prototype,"luminance",void 0),(0,k.d)([(0,N.H)()],X.prototype,"turbidity",void 0),(0,k.d)([(0,N.H)()],X.prototype,"rayleigh",void 0),(0,k.d)([(0,N.H)()],X.prototype,"mieCoefficient",void 0),(0,k.d)([(0,N.H)()],X.prototype,"mieDirectionalG",void 0),(0,k.d)([(0,N.H)()],X.prototype,"distance",void 0),(0,k.d)([(0,N.H)()],X.prototype,"inclination",void 0),(0,k.d)([(0,N.H)()],X.prototype,"azimuth",void 0),(0,k.d)([(0,N.F)()],X.prototype,"sunPosition",void 0),(0,k.d)([(0,N.H)()],X.prototype,"useSunPosition",void 0),(0,k.d)([(0,N.F)()],X.prototype,"cameraOffset",void 0),(0,k.d)([(0,N.F)()],X.prototype,"up",void 0),(0,k.d)([(0,N.H)()],X.prototype,"dithering",void 0),(0,i.g)("BABYLON.SkyMaterial",X)},11812:(Z,c,L)=>{"use strict";function k(Z,c){c.headers=Z.headers||{},c.statusMessage=Z.statusText,c.statusCode=Z.status,c.data=Z.response}function N(Z,c,L){return new Promise((function(N,R){L=L||{};var G,V,p,J=new XMLHttpRequest,z=L.body,i=L.headers||{};for(G in L.timeout&&(J.timeout=L.timeout),J.ontimeout=J.onerror=function(Z){Z.timeout="timeout"==Z.type,R(Z)},J.open(Z,c.href||c),J.onload=function(){for(p=J.getAllResponseHeaders().trim().split(/[\r\n]+/),k(J,J);V=p.shift();)V=V.split(": "),J.headers[V.shift().toLowerCase()]=V.join(": ");if((V=J.headers["content-type"])&&~V.indexOf("application/json"))try{J.data=JSON.parse(J.data,L.reviver)}catch(Z){return k(J,Z),R(Z)}(J.status>=400?R:N)(J)},typeof FormData<"u"&&z instanceof FormData||z&&"object"==typeof z&&(i["content-type"]="application/json",z=JSON.stringify(z)),J.withCredentials=!!L.withCredentials,i)J.setRequestHeader(G,i[G]);J.send(z)}))}L.r(c),L.d(c,{del:()=>p,get:()=>R,patch:()=>V,post:()=>G,put:()=>J,send:()=>N});var R=N.bind(N,"GET"),G=N.bind(N,"POST"),V=N.bind(N,"PATCH"),p=N.bind(N,"DELETE"),J=N.bind(N,"PUT")},13440:(Z,c,L)=>{"use strict";L.d(c,{e:()=>i});const k=.5*(Math.sqrt(3)-1),N=(3-Math.sqrt(3))/6,R=1/3,G=1/6,V=(Math.sqrt(5)-1)/4,p=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const i=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof Z?Z:function(Z){let c=0,L=0,k=0,N=1;const R=function(){let Z=4022871197;return function(c){c=c.toString();for(let L=0;L<c.length;L++){Z+=c.charCodeAt(L);let k=.02519603282416938*Z;Z=k>>>0,k-=Z,k*=Z,Z=k>>>0,k-=Z,Z+=4294967296*k}return 2.3283064365386963e-10*(Z>>>0)}}();c=R(" "),L=R(" "),k=R(" "),c-=R(Z),c<0&&(c+=1);L-=R(Z),L<0&&(L+=1);k-=R(Z),k<0&&(k+=1);return function(){const Z=2091639*c+2.3283064365386963e-10*N;return c=L,L=k,k=Z-(N=0|Z)}}(Z);this.p=function(Z){const c=new Uint8Array(256);for(let L=0;L<256;L++)c[L]=L;for(let L=0;L<255;L++){const k=L+~~(Z()*(256-L)),N=c[L];c[L]=c[k],c[k]=N}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let L=0;L<512;L++)this.perm[L]=this.p[255&L],this.permMod12[L]=this.perm[L]%12}noise2D(Z,c){const L=this.permMod12,R=this.perm;let G=0,V=0,p=0;const z=(Z+c)*k,i=Math.floor(Z+z),t=Math.floor(c+z),E=(i+t)*N,x=Z-(i-E),q=c-(t-E);let O,w;x>q?(O=1,w=0):(O=0,w=1);const M=x-O+N,P=q-w+N,j=x-1+2*N,o=q-1+2*N,u=255&i,X=255&t;let h=.5-x*x-q*q;if(h>=0){const Z=3*L[u+R[X]];h*=h,G=h*h*(J[Z]*x+J[Z+1]*q)}let B=.5-M*M-P*P;if(B>=0){const Z=3*L[u+O+R[X+w]];B*=B,V=B*B*(J[Z]*M+J[Z+1]*P)}let D=.5-j*j-o*o;if(D>=0){const Z=3*L[u+1+R[X+1]];D*=D,p=D*D*(J[Z]*j+J[Z+1]*o)}return 70*(G+V+p)}noise3D(Z,c,L){const k=this.permMod12,N=this.perm;let V,p,z,i;const t=(Z+c+L)*R,E=Math.floor(Z+t),x=Math.floor(c+t),q=Math.floor(L+t),O=(E+x+q)*G,w=Z-(E-O),M=c-(x-O),P=L-(q-O);let j,o,u,X,h,B;w>=M?M>=P?(j=1,o=0,u=0,X=1,h=1,B=0):w>=P?(j=1,o=0,u=0,X=1,h=0,B=1):(j=0,o=0,u=1,X=1,h=0,B=1):M<P?(j=0,o=0,u=1,X=0,h=1,B=1):w<P?(j=0,o=1,u=0,X=0,h=1,B=1):(j=0,o=1,u=0,X=1,h=1,B=0);const D=w-j+G,e=M-o+G,H=P-u+G,l=w-X+2*G,W=M-h+2*G,T=P-B+2*G,I=w-1+.5,d=M-1+.5,Q=P-1+.5,r=255&E,f=255&x,S=255&q;let s=.6-w*w-M*M-P*P;if(s<0)V=0;else{const Z=3*k[r+N[f+N[S]]];s*=s,V=s*s*(J[Z]*w+J[Z+1]*M+J[Z+2]*P)}let m=.6-D*D-e*e-H*H;if(m<0)p=0;else{const Z=3*k[r+j+N[f+o+N[S+u]]];m*=m,p=m*m*(J[Z]*D+J[Z+1]*e+J[Z+2]*H)}let A=.6-l*l-W*W-T*T;if(A<0)z=0;else{const Z=3*k[r+X+N[f+h+N[S+B]]];A*=A,z=A*A*(J[Z]*l+J[Z+1]*W+J[Z+2]*T)}let b=.6-I*I-d*d-Q*Q;if(b<0)i=0;else{const Z=3*k[r+1+N[f+1+N[S+1]]];b*=b,i=b*b*(J[Z]*I+J[Z+1]*d+J[Z+2]*Q)}return 32*(V+p+z+i)}noise4D(Z,c,L,k){const N=this.perm;let R,G,J,i,t;const E=(Z+c+L+k)*V,x=Math.floor(Z+E),q=Math.floor(c+E),O=Math.floor(L+E),w=Math.floor(k+E),M=(x+q+O+w)*p,P=Z-(x-M),j=c-(q-M),o=L-(O-M),u=k-(w-M);let X=0,h=0,B=0,D=0;P>j?X++:h++,P>o?X++:B++,P>u?X++:D++,j>o?h++:B++,j>u?h++:D++,o>u?B++:D++;const e=X>=3?1:0,H=h>=3?1:0,l=B>=3?1:0,W=D>=3?1:0,T=X>=2?1:0,I=h>=2?1:0,d=B>=2?1:0,Q=D>=2?1:0,r=X>=1?1:0,f=h>=1?1:0,S=B>=1?1:0,s=D>=1?1:0,m=P-e+p,A=j-H+p,b=o-l+p,F=u-W+p,U=P-T+2*p,K=j-I+2*p,n=o-d+2*p,g=u-Q+2*p,y=P-r+3*p,v=j-f+3*p,Y=o-S+3*p,a=u-s+3*p,C=P-1+4*p,ZZ=j-1+4*p,cZ=o-1+4*p,LZ=u-1+4*p,kZ=255&x,NZ=255&q,RZ=255&O,GZ=255&w;let VZ=.6-P*P-j*j-o*o-u*u;if(VZ<0)R=0;else{const Z=N[kZ+N[NZ+N[RZ+N[GZ]]]]%32*4;VZ*=VZ,R=VZ*VZ*(z[Z]*P+z[Z+1]*j+z[Z+2]*o+z[Z+3]*u)}let pZ=.6-m*m-A*A-b*b-F*F;if(pZ<0)G=0;else{const Z=N[kZ+e+N[NZ+H+N[RZ+l+N[GZ+W]]]]%32*4;pZ*=pZ,G=pZ*pZ*(z[Z]*m+z[Z+1]*A+z[Z+2]*b+z[Z+3]*F)}let JZ=.6-U*U-K*K-n*n-g*g;if(JZ<0)J=0;else{const Z=N[kZ+T+N[NZ+I+N[RZ+d+N[GZ+Q]]]]%32*4;JZ*=JZ,J=JZ*JZ*(z[Z]*U+z[Z+1]*K+z[Z+2]*n+z[Z+3]*g)}let zZ=.6-y*y-v*v-Y*Y-a*a;if(zZ<0)i=0;else{const Z=N[kZ+r+N[NZ+f+N[RZ+S+N[GZ+s]]]]%32*4;zZ*=zZ,i=zZ*zZ*(z[Z]*y+z[Z+1]*v+z[Z+2]*Y+z[Z+3]*a)}let iZ=.6-C*C-ZZ*ZZ-cZ*cZ-LZ*LZ;if(iZ<0)t=0;else{const Z=N[kZ+1+N[NZ+1+N[RZ+1+N[GZ+1]]]]%32*4;iZ*=iZ,t=iZ*iZ*(z[Z]*C+z[Z+1]*ZZ+z[Z+2]*cZ+z[Z+3]*LZ)}return 27*(R+G+J+i+t)}}}}]);