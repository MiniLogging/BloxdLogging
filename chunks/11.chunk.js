/*! For license information please see ywlsh.11.0fd82ce5.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{12930:(q,c,U)=>{"use strict";var J=U(12934),Q=U(12940),s=U(12942);U.g.__TYPEDARRAY_POOL||(U.g.__TYPEDARRAY_POOL={UINT8:Q([32,0]),UINT16:Q([32,0]),UINT32:Q([32,0]),INT8:Q([32,0]),INT16:Q([32,0]),INT32:Q([32,0]),FLOAT:Q([32,0]),DOUBLE:Q([32,0]),DATA:Q([32,0]),UINT8C:Q([32,0]),BUFFER:Q([32,0])});var g="undefined"!==typeof Uint8ClampedArray,X=U.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=Q([32,0])),X.BUFFER||(X.BUFFER=Q([32,0]));var n=X.DATA,W=X.BUFFER;function D(q){if(q){var c=q.length||q.byteLength,U=J.log2(c);n[U].push(q)}}function u(q){q=J.nextPow2(q);var c=J.log2(q),U=n[c];return U.length>0?U.pop():new ArrayBuffer(q)}function K(q){return new Uint8Array(u(q),0,q)}function r(q){return new Uint16Array(u(2*q),0,q)}function H(q){return new Uint32Array(u(4*q),0,q)}function b(q){return new Int8Array(u(q),0,q)}function h(q){return new Int16Array(u(2*q),0,q)}function o(q){return new Int32Array(u(4*q),0,q)}function a(q){return new Float32Array(u(4*q),0,q)}function p(q){return new Float64Array(u(8*q),0,q)}function R(q){return g?new Uint8ClampedArray(u(q),0,q):K(q)}function I(q){return new DataView(u(q),0,q)}c.free=function(q){if(s(q))W[J.log2(q.length)].push(q);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(q)&&(q=q.buffer),!q)return;var c=q.length||q.byteLength,U=0|J.log2(c);n[U].push(q)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(q){D(q.buffer)},c.freeArrayBuffer=D,c.freeBuffer=function(q){W[J.log2(q.length)].push(q)},c.malloc=function(q,c){if(void 0===c||"arraybuffer"===c)return u(q);switch(c){case"uint8":return K(q);case"uint16":return r(q);case"uint32":return H(q);case"int8":return b(q);case"int16":return h(q);case"int32":return o(q);case"float":case"float32":return a(q);case"double":case"float64":return p(q);case"uint8_clamped":return R(q);case"buffer":throw"Buffer not supported";case"data":case"dataview":return I(q);default:return null}return null},c.mallocArrayBuffer=u,c.mallocUint8=K,c.mallocUint16=r,c.mallocUint32=H,c.mallocInt8=b,c.mallocInt16=h,c.mallocInt32=o,c.mallocFloat32=c.mallocFloat=a,c.mallocFloat64=c.mallocDouble=p,c.mallocUint8Clamped=R,c.mallocDataView=I,c.clearCache=function(){for(var q=0;q<32;++q)X.UINT8[q].length=0,X.UINT16[q].length=0,X.UINT32[q].length=0,X.INT8[q].length=0,X.INT16[q].length=0,X.INT32[q].length=0,X.FLOAT[q].length=0,X.DOUBLE[q].length=0,X.UINT8C[q].length=0,n[q].length=0,W[q].length=0}},13015:(q,c,U)=>{q.exports=Q;var J=U(11745);function Q(q,c){if(!(this instanceof Q))return new Q(q,c);var U=J.create();J.add(U,q,c),this.base=J.min(J.create(),q,U),this.qD=J.clone(c),this.max=J.max(J.create(),q,U),this.mag=J.length(this.qD)}var s=Q.prototype;s.width=function(){return this.qD[0]},s.height=function(){return this.qD[1]},s.depth=function(){return this.qD[2]},s.x0=function(){return this.base[0]},s.y0=function(){return this.base[1]},s.z0=function(){return this.base[2]},s.x1=function(){return this.max[0]},s.y1=function(){return this.max[1]},s.z1=function(){return this.max[2]},s.translate=function(q){return J.add(this.max,this.max,q),J.add(this.base,this.base,q),this},s.setPosition=function(q){return J.add(this.max,q,this.qD),J.k(this.base,q),this},s.expand=function(q){var c=J.create(),U=J.create();return J.max(c,q.max,this.max),J.min(U,q.base,this.base),J.eU(c,c,U),new Q(U,c)},s.intersects=function(q){return!(q.base[0]>this.max[0])&&(!(q.base[1]>this.max[1])&&(!(q.base[2]>this.max[2])&&(!(q.max[0]<this.base[0])&&(!(q.max[1]<this.base[1])&&!(q.max[2]<this.base[2])))))},s.touches=function(q){var c=this.union(q);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},s.union=function(q){if(!this.intersects(q))return null;var c=Math.max(q.base[0],this.base[0]),U=Math.max(q.base[1],this.base[1]),J=Math.max(q.base[2],this.base[2]);return new Q([c,U,J],[Math.min(q.max[0],this.max[0])-c,Math.min(q.max[1],this.max[1])-U,Math.min(q.max[2],this.max[2])-J])}},12934:(q,c)=>{"use strict";function U(q){var c=32;return(q&=-q)&&c--,65535&q&&(c-=16),16711935&q&&(c-=8),252645135&q&&(c-=4),858993459&q&&(c-=2),1431655765&q&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(q){return(q>0)-(q<0)},c.abs=function(q){var c=q>>31;return(q^c)-c},c.min=function(q,c){return c^(q^c)&-(q<c)},c.max=function(q,c){return q^(q^c)&-(q<c)},c.isPow2=function(q){return!(q&q-1)&&!!q},c.log2=function(q){var c,U;return c=(q>65535)<<4,c|=U=((q>>>=c)>255)<<3,c|=U=((q>>>=U)>15)<<2,(c|=U=((q>>>=U)>3)<<1)|(q>>>=U)>>1},c.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},c.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},c.countTrailingZeros=U,c.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},c.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},c.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var J=new Array(256);!function(q){for(var c=0;c<256;++c){var U=c,J=c,Q=7;for(U>>>=1;U;U>>>=1)J<<=1,J|=1&U,--Q;q[c]=J<<Q&255}}(J),c.reverse=function(q){return J[255&q]<<24|J[q>>>8&255]<<16|J[q>>>16&255]<<8|J[q>>>24&255]},c.interleave2=function(q,c){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(q,c){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>c&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},c.interleave3=function(q,c,U){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<2},c.deinterleave3=function(q,c){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>c&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},c.nextCombination=function(q){var c=q|q-1;return c+1|(~c&-~c)-1>>>U(q)+1}},12928:(q,c,U)=>{"use strict";q.exports=function(q,c,U){switch(arguments.length){case 1:return J=[],W(Q=q,Q,D,!0),J;case 2:return"function"===typeof c?W(q,q,c,!0):function(q,c){return J=[],W(q,c,D,!1),J}(q,c);case 3:return W(q,c,U,!1);default:throw new Error("box-intersect: Invalid arguments")}var Q};var J,Q=U(12930),s=U(12951),g=U(12962);function X(q,c){for(var U=0;U<q;++U)if(!(c[U]<=c[U+q]))return!0;return!1}function n(q,c,U,J){for(var Q=0,s=0,g=0,n=q.length;g<n;++g){var W=q[g];if(!X(c,W)){for(var D=0;D<2*c;++D)U[Q++]=W[D];J[s++]=g}}return s}function W(q,c,U,J){var X=q.length,W=c.length;if(!(X<=0||W<=0)){var D=q[0].length>>>1;if(!(D<=0)){var u,K=Q.mallocDouble(2*D*X),r=Q.mallocInt32(X);if((X=n(q,D,K,r))>0){if(1===D&&J)s.init(X),u=s.sweepComplete(D,U,0,X,K,r,0,X,K,r);else{var H=Q.mallocDouble(2*D*W),b=Q.mallocInt32(W);(W=n(c,D,H,b))>0&&(s.init(X+W),u=1===D?s.sweepBipartite(D,U,0,X,K,r,0,W,H,b):g(D,U,J,X,K,r,W,H,b),Q.free(H),Q.free(b))}Q.free(K),Q.free(r)}return u}}}function D(q,c){J.push([q,c])}},12966:(q,c)=>{"use strict";var U="d",J="ax",Q="fp",s="es",g="rs",X="re",n="rb",W="bs",D="be",u="bb",K=[U,J,"vv",g,X,n,"ri",W,D,u,"bi"];function r(q){var c="bruteForce"+(q?"Full":"Partial"),J=[],g=K.slice();q||g.splice(3,0,Q);var X=["function "+c+"("+g.join()+"){"];function n(c,Q){var g=function(q,c,J){var Q="bruteForce"+(q?"Red":"Blue")+(c?"Flip":"")+(J?"Full":""),g=["function ",Q,"(",K.join(),"){","var ",s,"=2*",U,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",n="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(J?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return q?g.push(X,"Q",":",n):g.push(n,"Q",":",X),J?g.push("if(y1<x0||x1<y0)continue;"):c?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:Q,code:g.join("")}}(c,Q,q);J.push(g.code),X.push("return "+g.name+"("+K.join()+");")}X.push("if(re-rs>be-bs){"),q?(n(!0,!1),X.push("}else{"),n(!1,!1)):(X.push("if(fp){"),n(!0,!0),X.push("}else{"),n(!0,!1),X.push("}}else{if(fp){"),n(!1,!0),X.push("}else{"),n(!1,!1),X.push("}")),X.push("}}return "+c);var W=J.join("")+X.join("");return new Function(W)()}c.partial=r(!1),c.full=r(!0)},12962:(q,c,U)=>{"use strict";q.exports=function(q,c,U,s,D,Y,k,V,O){!function(q,c){var U=8*Q.log2(c+1)*(q+1)|0,s=Q.nextPow2(R*U);t.length<s&&(J.free(t),t=J.mallocInt32(s));var g=Q.nextPow2(I*U);C.length<g&&(J.free(C),C=J.mallocDouble(g))}(q,s+k);var G,S=0,Z=2*q;i(S++,0,0,s,0,k,U?16:0,-1/0,1/0),U||i(S++,0,0,k,0,s,1,-1/0,1/0);for(;S>0;){var x=(S-=1)*R,z=t[x],y=t[x+1],M=t[x+2],T=t[x+3],m=t[x+4],d=t[x+5],e=S*I,B=C[e],N=C[e+1],P=1&d,w=!!(16&d),L=D,l=Y,j=V,f=O;if(P&&(L=V,l=O,j=D,f=Y),!(2&d&&y>=(M=h(q,z,y,M,L,l,N)))&&!(4&d&&(y=o(q,z,y,M,L,l,B))>=M)){var A=M-y,E=m-T;if(w){if(q*A*(A+E)<r){if(void 0!==(G=n.scanComplete(q,z,c,y,M,L,l,T,m,j,f)))return G;continue}}else{if(q*Math.min(A,E)<u){if(void 0!==(G=g(q,z,c,P,y,M,L,l,T,m,j,f)))return G;continue}if(q*A*E<K){if(void 0!==(G=n.scanBipartite(q,z,c,P,y,M,L,l,T,m,j,f)))return G;continue}}var qq=H(q,z,y,M,L,l,B,N);if(y<qq)if(q*(qq-y)<u){if(void 0!==(G=X(q,z+1,c,y,qq,L,l,T,m,j,f)))return G}else if(z===q-2){if(void 0!==(G=P?n.sweepBipartite(q,c,T,m,j,f,y,qq,L,l):n.sweepBipartite(q,c,y,qq,L,l,T,m,j,f)))return G}else i(S++,z+1,y,qq,T,m,P,-1/0,1/0),i(S++,z+1,T,m,y,qq,1^P,-1/0,1/0);if(qq<M){var cq=W(q,z,T,m,j,f),Uq=j[Z*cq+z],Jq=b(q,z,cq,m,j,f,Uq);if(Jq<m&&i(S++,z,qq,M,Jq,m,(4|P)+(w?16:0),Uq,N),T<cq&&i(S++,z,qq,M,T,cq,(2|P)+(w?16:0),B,Uq),cq+1===Jq){if(void 0!==(G=w?v(q,z,c,qq,M,L,l,cq,j,f[cq]):F(q,z,c,P,qq,M,L,l,cq,j,f[cq])))return G}else if(cq<Jq){var Qq;if(w){if(qq<(Qq=a(q,z,qq,M,L,l,Uq))){var sq=b(q,z,qq,Qq,L,l,Uq);if(z===q-2){if(qq<sq&&void 0!==(G=n.sweepComplete(q,c,qq,sq,L,l,cq,Jq,j,f)))return G;if(sq<Qq&&void 0!==(G=n.sweepBipartite(q,c,sq,Qq,L,l,cq,Jq,j,f)))return G}else qq<sq&&i(S++,z+1,qq,sq,cq,Jq,16,-1/0,1/0),sq<Qq&&(i(S++,z+1,sq,Qq,cq,Jq,0,-1/0,1/0),i(S++,z+1,cq,Jq,sq,Qq,1,-1/0,1/0))}}else qq<(Qq=P?p(q,z,qq,M,L,l,Uq):a(q,z,qq,M,L,l,Uq))&&(z===q-2?G=P?n.sweepBipartite(q,c,cq,Jq,j,f,qq,Qq,L,l):n.sweepBipartite(q,c,qq,Qq,L,l,cq,Jq,j,f):(i(S++,z+1,qq,Qq,cq,Jq,P,-1/0,1/0),i(S++,z+1,cq,Jq,qq,Qq,1^P,-1/0,1/0)))}}}}};var J=U(12930),Q=U(12934),s=U(12966),g=s.partial,X=s.full,n=U(12951),W=U(12973),D=U(12981),u=128,K=1<<22,r=1<<22,H=D("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),b=D("lo===p0",["p0"]),h=D("lo<p0",["p0"]),o=D("hi<=p0",["p0"]),a=D("lo<=p0&&p0<=hi",["p0"]),p=D("lo<p0&&p0<=hi",["p0"]),R=6,I=2,t=J.mallocInt32(1024),C=J.mallocDouble(1024);function i(q,c,U,J,Q,s,g,X,n){var W=R*q;t[W]=c,t[W+1]=U,t[W+2]=J,t[W+3]=Q,t[W+4]=s,t[W+5]=g;var D=I*q;C[D]=X,C[D+1]=n}function F(q,c,U,J,Q,s,g,X,n,W,D){var u=2*q,K=n*u,r=W[K+c];q:for(var H=Q,b=Q*u;H<s;++H,b+=u){var h=g[b+c],o=g[b+c+q];if(!(r<h||o<r)&&(!J||r!==h)){for(var a,p=X[H],R=c+1;R<q;++R){h=g[b+R],o=g[b+R+q];var I=W[K+R],t=W[K+R+q];if(o<I||t<h)continue q}if(void 0!==(a=J?U(D,p):U(p,D)))return a}}}function v(q,c,U,J,Q,s,g,X,n,W){var D=2*q,u=X*D,K=n[u+c];q:for(var r=J,H=J*D;r<Q;++r,H+=D){var b=g[r];if(b!==W){var h=s[H+c],o=s[H+c+q];if(!(K<h||o<K)){for(var a=c+1;a<q;++a){h=s[H+a],o=s[H+a+q];var p=n[u+a],R=n[u+a+q];if(o<p||R<h)continue q}var I=U(b,W);if(void 0!==I)return I}}}}},12973:(q,c,U)=>{"use strict";q.exports=function(q,c,U,g,X,n){if(g<=U+1)return U;var W=U,D=g,u=g+U>>>1,K=2*q,r=u,H=X[K*u+c];for(;W<D;){if(D-W<Q){s(q,c,W,D,X,n),H=X[K*u+c];break}var b=D-W,h=Math.random()*b+W|0,o=X[K*h+c],a=Math.random()*b+W|0,p=X[K*a+c],R=Math.random()*b+W|0,I=X[K*R+c];o<=p?I>=p?(r=a,H=p):o>=I?(r=h,H=o):(r=R,H=I):p>=I?(r=a,H=p):I>=o?(r=h,H=o):(r=R,H=I);for(var t=K*(D-1),C=K*r,i=0;i<K;++i,++t,++C){var F=X[t];X[t]=X[C],X[C]=F}var v=n[D-1];n[D-1]=n[r],n[r]=v;for(t=K*(D-1),C=K*(r=J(q,c,W,D-1,X,n,H)),i=0;i<K;++i,++t,++C){F=X[t];X[t]=X[C],X[C]=F}v=n[D-1];if(n[D-1]=n[r],n[r]=v,u<r){for(D=r-1;W<D&&X[K*(D-1)+c]===H;)D-=1;D+=1}else{if(!(r<u))break;for(W=r+1;W<D&&X[K*W+c]===H;)W+=1}}return J(q,c,U,u,X,n,X[K*u+c])};var J=U(12981)("lo<p0",["p0"]),Q=8;function s(q,c,U,J,Q,s){for(var g=2*q,X=g*(U+1)+c,n=U+1;n<J;++n,X+=g)for(var W=Q[X],D=n,u=g*(n-1);D>U&&Q[u+c]>W;--D,u-=g){for(var K=u,r=u+g,H=0;H<g;++H,++K,++r){var b=Q[K];Q[K]=Q[r],Q[r]=b}var h=s[D];s[D]=s[D-1],s[D-1]=h}}},12981:q=>{"use strict";q.exports=function(q,U){var J="abcdef".split("").concat(U),Q=[];q.indexOf("lo")>=0&&Q.push("lo=e[k+n]");q.indexOf("hi")>=0&&Q.push("hi=e[k+o]");return J.push(c.replace("_",Q.join()).replace("$",q)),Function.apply(void 0,J)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12957:q=>{"use strict";q.exports=function(q,J){J<=4*c?U(0,J-1,q):W(0,J-1,q)};var c=32;function U(q,c,U){for(var J=2*(q+1),Q=q+1;Q<=c;++Q){for(var s=U[J++],g=U[J++],X=Q,n=J-2;X-- >q;){var W=U[n-2],D=U[n-1];if(W<s)break;if(W===s&&D<g)break;U[n]=W,U[n+1]=D,n-=2}U[n]=s,U[n+1]=g}}function J(q,c,U){c*=2;var J=U[q*=2],Q=U[q+1];U[q]=U[c],U[q+1]=U[c+1],U[c]=J,U[c+1]=Q}function Q(q,c,U){c*=2,U[q*=2]=U[c],U[q+1]=U[c+1]}function s(q,c,U,J){c*=2,U*=2;var Q=J[q*=2],s=J[q+1];J[q]=J[c],J[q+1]=J[c+1],J[c]=J[U],J[c+1]=J[U+1],J[U]=Q,J[U+1]=s}function g(q,c,U,J,Q){c*=2,Q[q*=2]=Q[c],Q[c]=U,Q[q+1]=Q[c+1],Q[c+1]=J}function X(q,c,U){c*=2;var J=U[q*=2],Q=U[c];return!(J<Q)&&(J!==Q||U[q+1]>U[c+1])}function n(q,c,U,J){var Q=J[q*=2];return Q<c||Q===c&&J[q+1]<U}function W(q,D,u){var K=(D-q+1)/6|0,r=q+K,H=D-K,b=q+D>>1,h=b-K,o=b+K,a=r,p=h,R=b,I=o,t=H,C=q+1,i=D-1,F=0;X(a,p,u)&&(F=a,a=p,p=F),X(I,t,u)&&(F=I,I=t,t=F),X(a,R,u)&&(F=a,a=R,R=F),X(p,R,u)&&(F=p,p=R,R=F),X(a,I,u)&&(F=a,a=I,I=F),X(R,I,u)&&(F=R,R=I,I=F),X(p,t,u)&&(F=p,p=t,t=F),X(p,R,u)&&(F=p,p=R,R=F),X(I,t,u)&&(F=I,I=t,t=F);for(var v=u[2*p],Y=u[2*p+1],k=u[2*I],V=u[2*I+1],O=2*a,G=2*R,S=2*t,Z=2*r,x=2*b,z=2*H,y=0;y<2;++y){var M=u[O+y],T=u[G+y],m=u[S+y];u[Z+y]=M,u[x+y]=T,u[z+y]=m}Q(h,q,u),Q(o,D,u);for(var d=C;d<=i;++d)if(n(d,v,Y,u))d!==C&&J(d,C,u),++C;else if(!n(d,k,V,u))for(;;){if(n(i,k,V,u)){n(i,v,Y,u)?(s(d,C,i,u),++C,--i):(J(d,i,u),--i);break}if(--i<d)break}g(q,C-1,v,Y,u),g(D,i+1,k,V,u),C-2-q<=c?U(q,C-2,u):W(q,C-2,u),D-(i+2)<=c?U(i+2,D,u):W(i+2,D,u),i-C<=c?U(C,i,u):W(C,i,u)}},12951:(q,c,U)=>{"use strict";q.exports={init:function(q){var c=Q.nextPow2(q);n.length<c&&(J.free(n),n=J.mallocInt32(c));W.length<c&&(J.free(W),W=J.mallocInt32(c));D.length<c&&(J.free(D),D=J.mallocInt32(c));u.length<c&&(J.free(u),u=J.mallocInt32(c));K.length<c&&(J.free(K),K=J.mallocInt32(c));r.length<c&&(J.free(r),r=J.mallocInt32(c));var U=8*c;H.length<U&&(J.free(H),H=J.mallocDouble(U))},sweepBipartite:function(q,c,U,J,Q,X,K,r,o,a){for(var p=0,R=2*q,I=q-1,t=R-1,C=U;C<J;++C){var i=X[C],F=R*C;H[p++]=Q[F+I],H[p++]=-(i+1),H[p++]=Q[F+t],H[p++]=i}for(C=K;C<r;++C){i=a[C]+g;var v=R*C;H[p++]=o[v+I],H[p++]=-i,H[p++]=o[v+t],H[p++]=i}var Y=p>>>1;s(H,Y);var k=0,V=0;for(C=0;C<Y;++C){var O=0|H[2*C+1];if(O>=g)b(D,u,V--,O=O-g|0);else if(O>=0)b(n,W,k--,O);else if(O<=-g){O=-O-g|0;for(var G=0;G<k;++G){if(void 0!==(S=c(n[G],O)))return S}h(D,u,V++,O)}else{O=-O-1|0;for(G=0;G<V;++G){var S;if(void 0!==(S=c(O,D[G])))return S}h(n,W,k++,O)}}},sweepComplete:function(q,c,U,J,Q,g,X,o,a,p){for(var R=0,I=2*q,t=q-1,C=I-1,i=U;i<J;++i){var F=g[i]+1<<1,v=I*i;H[R++]=Q[v+t],H[R++]=-F,H[R++]=Q[v+C],H[R++]=F}for(i=X;i<o;++i){F=p[i]+1<<1;var Y=I*i;H[R++]=a[Y+t],H[R++]=1|-F,H[R++]=a[Y+C],H[R++]=1|F}var k=R>>>1;s(H,k);var V=0,O=0,G=0;for(i=0;i<k;++i){var S=0|H[2*i+1],Z=1&S;if(i<k-1&&S>>1===H[2*i+3]>>1&&(Z=2,i+=1),S<0){for(var x=-(S>>1)-1,z=0;z<G;++z){if(void 0!==(y=c(K[z],x)))return y}if(0!==Z)for(z=0;z<V;++z){if(void 0!==(y=c(n[z],x)))return y}if(1!==Z)for(z=0;z<O;++z){var y;if(void 0!==(y=c(D[z],x)))return y}0===Z?h(n,W,V++,x):1===Z?h(D,u,O++,x):2===Z&&h(K,r,G++,x)}else{x=(S>>1)-1;0===Z?b(n,W,V--,x):1===Z?b(D,u,O--,x):2===Z&&b(K,r,G--,x)}}},scanBipartite:function(q,c,U,J,Q,X,D,u,K,r,o,a){var p=0,R=2*q,I=c,t=c+q,C=1,i=1;J?i=g:C=g;for(var F=Q;F<X;++F){var v=F+C,Y=R*F;H[p++]=D[Y+I],H[p++]=-v,H[p++]=D[Y+t],H[p++]=v}for(F=K;F<r;++F){v=F+i;var k=R*F;H[p++]=o[k+I],H[p++]=-v}var V=p>>>1;s(H,V);var O=0;for(F=0;F<V;++F){var G=0|H[2*F+1];if(G<0){var S=!1;if((v=-G)>=g?(S=!J,v-=g):(S=!!J,v-=1),S)h(n,W,O++,v);else{var Z=a[v],x=R*v,z=o[x+c+1],y=o[x+c+1+q];q:for(var M=0;M<O;++M){var T=n[M],m=R*T;if(!(y<D[m+c+1]||D[m+c+1+q]<z)){for(var d=c+2;d<q;++d)if(o[x+d+q]<D[m+d]||D[m+d+q]<o[x+d])continue q;var e,B=u[T];if(void 0!==(e=J?U(Z,B):U(B,Z)))return e}}}}else b(n,W,O--,G-C)}},scanComplete:function(q,c,U,J,Q,X,W,D,u,K,r){for(var b=0,h=2*q,o=c,a=c+q,p=J;p<Q;++p){var R=p+g,I=h*p;H[b++]=X[I+o],H[b++]=-R,H[b++]=X[I+a],H[b++]=R}for(p=D;p<u;++p){R=p+1;var t=h*p;H[b++]=K[t+o],H[b++]=-R}var C=b>>>1;s(H,C);var i=0;for(p=0;p<C;++p){var F=0|H[2*p+1];if(F<0){if((R=-F)>=g)n[i++]=R-g;else{var v=r[R-=1],Y=h*R,k=K[Y+c+1],V=K[Y+c+1+q];q:for(var O=0;O<i;++O){var G=n[O],S=W[G];if(S===v)break;var Z=h*G;if(!(V<X[Z+c+1]||X[Z+c+1+q]<k)){for(var x=c+2;x<q;++x)if(K[Y+x+q]<X[Z+x]||X[Z+x+q]<K[Y+x])continue q;var z=U(S,v);if(void 0!==z)return z}}}}else{for(R=F-g,O=i-1;O>=0;--O)if(n[O]===R){for(x=O+1;x<i;++x)n[x-1]=n[x];break}--i}}}};var J=U(12930),Q=U(12934),s=U(12957),g=1<<28,X=1024,n=J.mallocInt32(X),W=J.mallocInt32(X),D=J.mallocInt32(X),u=J.mallocInt32(X),K=J.mallocInt32(X),r=J.mallocInt32(X),H=J.mallocDouble(8192);function b(q,c,U,J){var Q=c[J],s=q[U-1];q[Q]=s,c[s]=Q}function h(q,c,U,J){q[U]=J,c[J]=U}},12940:q=>{"use strict";function c(q,U,J){var Q=0|q[J];if(Q<=0)return[];var s,g=new Array(Q);if(J===q.length-1)for(s=0;s<Q;++s)g[s]=U;else for(s=0;s<Q;++s)g[s]=c(q,U,J+1);return g}q.exports=function(q,U){switch("undefined"===typeof U&&(U=0),typeof q){case"number":if(q>0)return function(q,c){var U,J;for(U=new Array(q),J=0;J<q;++J)U[J]=c;return U}(0|q,U);break;case"object":if("number"===typeof q.length)return c(q,U,0)}return[]}},12904:(q,c,U)=>{q.exports=function(){var q=this;this.components={},this.comps=this.components;var c=this.components,U=1,Q={},s=[],g=[],X={timeout:!1,removals:[],multiComps:[]};function n(q,U){var J=c[U],s=Q[U],g=s.hash[q];g&&(s.remove(q),J.sc&&(J.multi?(g.forEach((c=>{c&&J.sc(q,c)})),g.length=0):J.sc(q,g)),X.removals.push(s),W())}function W(){X.timeout||(X.timeout=!0,setTimeout(D,1))}function D(){X.timeout=!1,u()}function u(){X.multiComps.length&&function(q){for(var c=0;c<q.length;c++){var{entID:U,data:J}=q[c],Q=J.hash[U];if(Q){for(var s=0;s<Q.length;s++)Q[s]||(Q.splice(s,1),s--);0===Q.length&&(J.remove(U),X.removals.push(J))}}q.length=0}(X.multiComps),X.removals.length&&function(q){for(var c=0;c<q.length;c++){q[c].flush()}q.length=0}(X.removals)}this.Hu=Q,this._systems=s,this._renderSystems=g,this.JD=function(c){var J=U++;return Array.isArray(c)&&c.forEach((c=>q.Bn(J,c))),J},this.deleteEntity=function(c){return Object.keys(Q).forEach((q=>{Q[q].hash[c]&&n(c,q)})),q},this.pD=function(q){if(!q)throw new Error("Missing component definition");var U=q.name;if(!U)throw new Error("Component definition must have a name property.");if("string"!==typeof U)throw new Error("Component name must be a string.");if(""===U)throw new Error("Component name must be a non-empty string.");if(Q[U])throw new Error(`Component ${U} already exists.`);var X={};return X.name=U,X.multi=!!q.multi,X.order=isNaN(q.order)?99:q.order,X.stateConstructor=q.stateConstructor||null,X.state=q.state||{},X.Eg=q.Eg||null,X.sc=q.sc||null,X.system=q.system||null,X.qn=q.qn||null,c[U]=X,Q[U]=new J,Q[U]._pendingMultiCleanup=!1,Q[U]._multiCleanupIDs=X.multi?[]:null,X.system&&(s.push(U),s.sort(((q,U)=>c[q].order-c[U].order))),X.qn&&(g.push(U),g.sort(((q,U)=>c[q].order-c[U].order))),U},this.overwriteComponent=function(q,U){var J=c[q];if(!J)throw new Error(`Unknown component: ${q}`);if(!U)throw new Error("Missing component definition");if(J.name!==U.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=q,X.multi=!!U.multi,X.order=isNaN(U.order)?99:U.order,X.state=U.state||{},X.Eg=U.Eg||null,X.sc=U.sc||null,X.system=U.system||null,X.qn=U.qn||null,c[q]=X,Q[q]._pendingMultiCleanup=!1,Q[q]._multiCleanupIDs=X.multi?[]:null;var n=s.indexOf(q);X.system&&n<0&&s.push(q),!X.system&&n>=0&&s.splice(n,1),s.sort(((q,U)=>c[q].order-c[U].order));var W=g.indexOf(q);X.qn&&W<0&&g.push(q),!X.qn&&W>=0&&g.splice(W,1),g.sort(((q,U)=>c[q].order-c[U].order));var D=X.state;return this.mW(q).forEach((q=>{for(var c in D)c in q||(q[c]=D[c]);X.Eg&&X.Eg(q.AX,q)})),q},this.deleteComponent=function(U){var J=Q[U];if(!J)throw new Error(`Unknown component: ${U}`);J.flush(),J.list.forEach((q=>{q&&n(q.AX||q[0].AX,U)}));var X=s.indexOf(U),W=g.indexOf(U);return X>-1&&s.splice(X,1),W>-1&&g.splice(W,1),Q[U].dispose(),delete Q[U],delete c[U],q},this.Bn=function(q,U,J){var s,g=c[U],X=Q[U];if(!X)throw new Error(`Unknown component: ${U}.`);if(X.hash[q]&&!g.multi)throw new Error(`Entity ${q} already has component: ${U}.`);if(g.stateConstructor){if(!(s=new g.stateConstructor).hasOwnProperty("AX"))throw new Error(`Component ${g.name} stateConstructor type does not have property __id`)}else s=Object.assign({},{AX:q},g.state,J);if(s.AX=q,g.multi){var n=X.hash[q];n||(n=[],X.add(q,n)),n.push(s)}else X.add(q,s);return g.Eg&&g.Eg(q,s),this},this.qW=function(q,c){var U=Q[c];if(!U)throw new Error(`Unknown component: ${c}.`);return!!U.hash[q]},this.Ln=function(c,U){if(!Q[U])throw new Error(`Unknown component: ${U}.`);return n(c,U),q},this.getState=function(q,c){var U=Q[c];if(!U)throw new Error(`Unknown component: ${c}.`);return U.hash[q]},this.mW=function(q){var c=Q[q];if(!c)throw new Error(`Unknown component: ${q}.`);return u(),c.list},this.gr=function(q){if(!Q[q])throw new Error(`Unknown component: ${q}.`);var c=Q[q].hash;return q=>c[q]},this.Wr=function(q){if(!Q[q])throw new Error(`Unknown component: ${q}.`);var c=Q[q].hash;return q=>!!c[q]},this.wX=function(U){u();for(var J=0;J<s.length;J++){var g=s[J],X=c[g],n=Q[g];X.system(U,n.list),u()}return q},this.render=function(U){u();for(var J=0;J<g.length;J++){var s=g[J],X=c[s],n=Q[s];X.qn(U,n.list),u()}return q},this.removeMultiComponent=function(U,J,s){var g=c[J],n=Q[J];if(!n)throw new Error(`Unknown component: ${J}.`);if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(q,c,U,J){var Q=U.hash[q];if(Q){var s=Q[J];s&&(Q[J]=null,c.sc&&c.sc(q,s),X.multiComps.push({entID:q,data:U}),W())}}(U,g,n,s),q}};var J=U(12909)},12909:q=>{function c(q,c){var U=q._map[c];if(delete q.hash[c],delete q._map[c],U===q.list.length-1)q.list.pop();else{var J=q.list.pop();if(q.list[U]=J,null===J||null===J[0]){var Q=q.list.length;for(var s in q._map)if(q._map[s]===Q)return void(q._map[s]=U)}else{var g=J.AX||J[0].AX;q._map[g]=U}}}q.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(q,c){if("number"===typeof this._map[q]){var U=this._map[q];this.hash[q]=c,this.list[U]=c}else this._map[q]=this.list.length,this.hash[q]=c,this.list.push(c)}remove(q){var c=this._map[q];this.hash[q]=null,this.list[c]=null,this._pendingRemovals.push(q)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var q=0;q<this._pendingRemovals.length;q++){var U=this._pendingRemovals[q];null===this.hash[U]&&c(this,U)}this._pendingRemovals.length=0}}},12868:q=>{"use strict";var c,U="object"===typeof Reflect?Reflect:null,J=function(q,c,U){return Function.prototype.apply.call(q,c,U)};c=U&&"function"===typeof U.ownKeys?U.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var Q=Number.isNaN||function(q){return q!==q};function s(){s.init.call(this)}q.exports=s,q.exports.once=function(q,c){return new Promise((function(U,J){function Q(U){q.removeListener(c,s),J(U)}function s(){"function"===typeof q.removeListener&&q.removeListener("error",Q),U([].slice.call(arguments))}b(q,c,s,{once:!0}),"error"!==c&&function(q,c,U){"function"===typeof q.on&&b(q,"error",c,U)}(q,Q,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var g=10;function X(q){if("function"!==typeof q)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function n(q){return void 0===q._maxListeners?s.defaultMaxListeners:q._maxListeners}function W(q,c,U,J){var Q,s,g,W;if(X(U),void 0===(s=q._events)?(s=q._events=Object.create(null),q._eventsCount=0):(void 0!==s.newListener&&(q.emit("newListener",c,U.listener?U.listener:U),s=q._events),g=s[c]),void 0===g)g=s[c]=U,++q._eventsCount;else if("function"===typeof g?g=s[c]=J?[U,g]:[g,U]:J?g.unshift(U):g.push(U),(Q=n(q))>0&&g.length>Q&&!g.warned){g.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");D.name="MaxListenersExceededWarning",D.j=q,D.type=c,D.count=g.length,W=D,console&&console.warn&&console.warn(W)}return q}function D(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(q,c,U){var J={fired:!1,wrapFn:void 0,target:q,type:c,listener:U},Q=D.bind(J);return Q.listener=U,J.wrapFn=Q,Q}function K(q,c,U){var J=q._events;if(void 0===J)return[];var Q=J[c];return void 0===Q?[]:"function"===typeof Q?U?[Q.listener||Q]:[Q]:U?function(q){for(var c=new Array(q.length),U=0;U<c.length;++U)c[U]=q[U].listener||q[U];return c}(Q):H(Q,Q.length)}function r(q){var c=this._events;if(void 0!==c){var U=c[q];if("function"===typeof U)return 1;if(void 0!==U)return U.length}return 0}function H(q,c){for(var U=new Array(c),J=0;J<c;++J)U[J]=q[J];return U}function b(q,c,U,J){if("function"===typeof q.on)J.once?q.once(c,U):q.on(c,U);else{if("function"!==typeof q.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(c,(function Q(s){J.once&&q.removeEventListener(c,Q),U(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(q){if("number"!==typeof q||q<0||Q(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");g=q}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(q){if("number"!==typeof q||q<0||Q(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},s.prototype.getMaxListeners=function(){return n(this)},s.prototype.emit=function(q){for(var c=[],U=1;U<arguments.length;U++)c.push(arguments[U]);var Q="error"===q,s=this._events;if(void 0!==s)Q=Q&&void 0===s.error;else if(!Q)return!1;if(Q){var g;if(c.length>0&&(g=c[0]),g instanceof Error)throw g;var X=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw X.context=g,X}var n=s[q];if(void 0===n)return!1;if("function"===typeof n)J(n,this,c);else{var W=n.length,D=H(n,W);for(U=0;U<W;++U)J(D[U],this,c)}return!0},s.prototype.addListener=function(q,c){return W(this,q,c,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(q,c){return W(this,q,c,!0)},s.prototype.once=function(q,c){return X(c),this.on(q,u(this,q,c)),this},s.prototype.prependOnceListener=function(q,c){return X(c),this.prependListener(q,u(this,q,c)),this},s.prototype.removeListener=function(q,c){var U,J,Q,s,g;if(X(c),void 0===(J=this._events))return this;if(void 0===(U=J[q]))return this;if(U===c||U.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete J[q],J.removeListener&&this.emit("removeListener",q,U.listener||c));else if("function"!==typeof U){for(Q=-1,s=U.length-1;s>=0;s--)if(U[s]===c||U[s].listener===c){g=U[s].listener,Q=s;break}if(Q<0)return this;0===Q?U.shift():function(q,c){for(;c+1<q.length;c++)q[c]=q[c+1];q.pop()}(U,Q),1===U.length&&(J[q]=U[0]),void 0!==J.removeListener&&this.emit("removeListener",q,g||c)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(q){var c,U,J;if(void 0===(U=this._events))return this;if(void 0===U.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==U[q]&&(0===--this._eventsCount?this._events=Object.create(null):delete U[q]),this;if(0===arguments.length){var Q,s=Object.keys(U);for(J=0;J<s.length;++J)"removeListener"!==(Q=s[J])&&this.removeAllListeners(Q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=U[q]))this.removeListener(q,c);else if(void 0!==c)for(J=c.length-1;J>=0;J--)this.removeListener(q,c[J]);return this},s.prototype.listeners=function(q){return K(this,q,!0)},s.prototype.rawListeners=function(q){return K(this,q,!1)},s.listenerCount=function(q,c){return"function"===typeof q.listenerCount?q.listenerCount(c):r.call(q,c)},s.prototype.listenerCount=r,s.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},13143:q=>{"use strict";q.exports=function(q,c,U,J,Q,s){var g=+c[0],X=+c[1],n=+c[2],W=+U[0],D=+U[1],u=+U[2],K=Math.sqrt(W*W+D*D+u*u);if(0===K)throw new Error("Can't raycast along a zero vector");return function(q,c,U,J,Q,s,g,X,n,W){for(var D=0,u=Math.floor,K=0|u(c),r=0|u(U),H=0|u(J),b=Q>0?1:-1,h=s>0?1:-1,o=g>0?1:-1,a=Math.abs(1/Q),p=Math.abs(1/s),R=Math.abs(1/g),I=a<1/0?a*(b>0?K+1-c:c-K):1/0,t=p<1/0?p*(h>0?r+1-U:U-r):1/0,C=R<1/0?R*(o>0?H+1-J:J-H):1/0,i=-1;D<=X;){var F=q(K,r,H);if(F)return n&&(n[0]=c+D*Q,n[1]=U+D*s,n[2]=J+D*g),W&&(W[0]=W[1]=W[2]=0,0===i&&(W[0]=-b),1===i&&(W[1]=-h),2===i&&(W[2]=-o)),F;I<t?I<C?(K+=b,D=I,I+=a,i=0):(H+=o,D=C,C+=R,i=2):t<C?(r+=h,D=t,t+=p,i=1):(H+=o,D=C,C+=R,i=2)}return n&&(n[0]=c+D*Q,n[1]=U+D*s,n[2]=J+D*g),W&&(W[0]=W[1]=W[2]=0),0}(q,g,X,n,W/=K,D/=K,u/=K,J="undefined"===typeof J?64:+J,Q,s)}},13186:(q,c,U)=>{"use strict";U.d(c,{c:()=>s});var J=U(12868);function Q(){this.sK=!1,this.stopPropagation=!1,this.gK=!1,this.disabled=!1}class s{constructor(q,c){this.version="0.7.0";var U=Object.assign({},new Q,c||{});this.element=q||document,this.sK=!!U.sK,this.stopPropagation=!!U.stopPropagation,this.gK=!!U.gK,this.disabled=!!U.disabled,this.filterEvents=(q,c)=>!0,this.down=new J.EventEmitter,this.up=new J.EventEmitter,this.state={},this.ZW={dx:0,dy:0,fK:0,SW:0,AK:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(q=>{X(this)}),{once:!0})}bind(q){for(var c=arguments.length,U=new Array(c>1?c-1:0),J=1;J<c;J++)U[J-1]=arguments[J];U.forEach((c=>{var U=this._keyBindmap[c]||[];U.includes(q)||(U.push(q),this._keyBindmap[c]=U)})),this.state[q]=!!this.state[q],this.pressCount[q]=this.pressCount[q]||0,this.releaseCount[q]=this.releaseCount[q]||0}unbind(q){for(var c in this._keyBindmap){var U=this._keyBindmap[c],J=U.indexOf(q);J>-1&&U.splice(J,1)}}getBindings(){var q={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((U=>{q[U]=q[U]||[],q[U].push(c)}))}return q}wX(){g(this.ZW),g(this.pressCount),g(this.releaseCount)}}function g(q){for(var c in q)q[c]=0}function X(q){window.addEventListener("keydown",H.bind(null,q,!0),!1),window.addEventListener("keyup",H.bind(null,q,!1),!1);var c={passive:!0};q.element.addEventListener("touchstart",u.bind(void 0,q),{passive:!1}),q.element.addEventListener("touchend",r.bind(void 0,q),c),q.element.addEventListener("mousedown",b.bind(null,q,!0),c),window.document.addEventListener("mouseup",b.bind(null,q,!1),c),q.element.addEventListener("touchmove",h.bind(null,q),c),q.element.addEventListener("mousemove",h.bind(null,q),c),window.PointerEvent,q.element.addEventListener("wheel",o.bind(null,q),c),q.element.addEventListener("contextmenu",a.bind(null,q),!1),window.addEventListener("blur",p.bind(null,q),!1)}var n=0,W=0,D=null;function u(q,c){c.preventDefault(),K(c)}function K(q){let c=!1;for(let U=0;U<q.touches.length;++U)if(q.touches[U].identifier===D){c=!0;break}if(!c){const c=q.changedTouches[0];n=c.clientX,W=c.clientY,D=c.identifier}}function r(q,c){for(var U=c.changedTouches,J=0;J<U.length;++J)U[J].identifier===D&&(D=null)}function H(q,c,U){R(U.code,c,q,U)}function b(q,c,U){if("pointerId"in U)if(c){if(null!==q._touches.currID)return;q._touches.currID=U.pointerId}else{if(q._touches.currID!==U.pointerId)return;q._touches.currID=null}return R("Mouse"+("button"in U?U.button+1:1),c,q,U),!1}function h(q,c){var U=c.movementX||c.mozMovementX||0,J=c.movementY||c.mozMovementY||0;if(c.touches&&0===(U|J)){var Q=function(q){K(q);for(let c=0;c<q.changedTouches.length;++c)if(q.changedTouches[c].identifier==D){const U=q.changedTouches[c],J=[U.clientX-n,U.clientY-W];return n=U.clientX,W=U.clientY,J}return console.error(`Did not find touch id ${D}`),[0,0]}(c);U=Q[0],J=Q[1]}q.ZW.dx+=U,q.ZW.dy+=J}function o(q,c){var U=1;switch(c.deltaMode){case 0:U=1;break;case 1:U=12;break;case 2:U=q.element.clientHeight||window.innerHeight}q.ZW.fK+=(c.deltaX||0)*U,q.ZW.SW+=(c.deltaY||0)*U,q.ZW.AK+=(c.deltaZ||0)*U}function a(q,c){if(!q.gK)return c.preventDefault(),!1}function p(q){for(var c in q._keyStates)q._keyStates[c]&&(/^Mouse\d/.test(c)||R(c,!1,q,{code:c,note:"nul5b4ubrzr",preventDefault:()=>{},stopPropagation:()=>{}}))}function R(q,c,U,J){var Q=U._keyBindmap[q];Q&&(I(U._keyStates[q],c)&&(U._keyStates[q]=c,Q.forEach((q=>{(!U.filterEvents||U.filterEvents(J,q))&&function(q,c,U,J){var Q=c?U.pressCount:U.releaseCount;Q[q]=(Q[q]||0)+1;var s=U._bindPressCount[q]||0;(s+=c?1:-1)<0&&(s=0);U._bindPressCount[q]=s;var g=U.state[q];if(I(g,s)){U.state[q]=s>0;var X=c?U.down:U.up;U.disabled||X.emit(q,J)}}(q,c,U,J)}))),"button"in J||(U.sK&&!J.defaultPrevented&&J.preventDefault(),U.stopPropagation&&J.stopPropagation()))}function I(q,c){return q?!c:c}},11815:q=>{q.exports=function(q,c,U){return q[0]=c[0]+U[0],q[1]=c[1]+U[1],q[2]=c[2]+U[2],q}},11775:(q,c,U)=>{q.exports=function(q,c){var U=J(q[0],q[1],q[2]),g=J(c[0],c[1],c[2]);Q(U,U),Q(g,g);var X=s(U,g);return X>1?0:Math.acos(X)};var J=U(11783),Q=U(11786),s=U(11794)},11868:q=>{q.exports=function(q,c){return q[0]=Math.ceil(c[0]),q[1]=Math.ceil(c[1]),q[2]=Math.ceil(c[2]),q}},11771:q=>{q.exports=function(q){var c=new Float32Array(3);return c[0]=q[0],c[1]=q[1],c[2]=q[2],c}},11798:q=>{q.exports=function(q,c){return q[0]=c[0],q[1]=c[1],q[2]=c[2],q}},11762:q=>{q.exports=function(){var q=new Float32Array(3);return q[0]=0,q[1]=0,q[2]=0,q}},11958:q=>{q.exports=function(q,c,U){var J=c[0],Q=c[1],s=c[2],g=U[0],X=U[1],n=U[2];return q[0]=Q*n-s*X,q[1]=s*g-J*n,q[2]=J*X-Q*g,q}},11898:(q,c,U)=>{q.exports=U(11894)},11894:q=>{q.exports=function(q,c){var U=c[0]-q[0],J=c[1]-q[1],Q=c[2]-q[2];return Math.sqrt(U*U+J*J+Q*Q)}},11848:(q,c,U)=>{q.exports=U(11841)},11841:q=>{q.exports=function(q,c,U){return q[0]=c[0]/U[0],q[1]=c[1]/U[1],q[2]=c[2]/U[2],q}},11794:q=>{q.exports=function(q,c){return q[0]*c[0]+q[1]*c[1]+q[2]*c[2]}},11754:q=>{q.exports=1e-6},11803:(q,c,U)=>{q.exports=function(q,c){var U=q[0],Q=q[1],s=q[2],g=c[0],X=c[1],n=c[2];return Math.abs(U-g)<=J*Math.max(1,Math.abs(U),Math.abs(g))&&Math.abs(Q-X)<=J*Math.max(1,Math.abs(Q),Math.abs(X))&&Math.abs(s-n)<=J*Math.max(1,Math.abs(s),Math.abs(n))};var J=U(11754)},11810:q=>{q.exports=function(q,c){return q[0]===c[0]&&q[1]===c[1]&&q[2]===c[2]}},11863:q=>{q.exports=function(q,c){return q[0]=Math.floor(c[0]),q[1]=Math.floor(c[1]),q[2]=Math.floor(c[2]),q}},12014:(q,c,U)=>{q.exports=function(q,c,U,Q,s,g){var X,n;c||(c=3);U||(U=0);n=Q?Math.min(Q*c+U,q.length):q.length;for(X=U;X<n;X+=c)J[0]=q[X],J[1]=q[X+1],J[2]=q[X+2],s(J,J,g),q[X]=J[0],q[X+1]=J[1],q[X+2]=J[2];return q};var J=U(11762)()},11783:q=>{q.exports=function(q,c,U){var J=new Float32Array(3);return J[0]=q,J[1]=c,J[2]=U,J}},11745:(q,c,U)=>{q.exports={EPSILON:U(11754),create:U(11762),clone:U(11771),angle:U(11775),MX:U(11783),k:U(11798),set:U(11801),equals:U(11803),exactEquals:U(11810),add:U(11815),eU:U(11820),sub:U(11823),multiply:U(11825),mul:U(11834),divide:U(11841),div:U(11848),min:U(11851),max:U(11856),floor:U(11863),ceil:U(11868),round:U(11875),scale:U(11882),TX:U(11885),distance:U(11894),i:U(11898),squaredDistance:U(11906),sqrDist:U(11909),length:U(11917),len:U(11923),squaredLength:U(11932),mX:U(11939),negate:U(11946),inverse:U(11950),normalize:U(11786),dot:U(11794),cross:U(11958),ZX:U(11964),random:U(11971),transformMat4:U(11974),transformMat3:U(11980),transformQuat:U(11988),dX:U(11995),eX:U(11999),BX:U(12005),forEach:U(12014)}},11950:q=>{q.exports=function(q,c){return q[0]=1/c[0],q[1]=1/c[1],q[2]=1/c[2],q}},11923:(q,c,U)=>{q.exports=U(11917)},11917:q=>{q.exports=function(q){var c=q[0],U=q[1],J=q[2];return Math.sqrt(c*c+U*U+J*J)}},11964:q=>{q.exports=function(q,c,U,J){var Q=c[0],s=c[1],g=c[2];return q[0]=Q+J*(U[0]-Q),q[1]=s+J*(U[1]-s),q[2]=g+J*(U[2]-g),q}},11856:q=>{q.exports=function(q,c,U){return q[0]=Math.max(c[0],U[0]),q[1]=Math.max(c[1],U[1]),q[2]=Math.max(c[2],U[2]),q}},11851:q=>{q.exports=function(q,c,U){return q[0]=Math.min(c[0],U[0]),q[1]=Math.min(c[1],U[1]),q[2]=Math.min(c[2],U[2]),q}},11834:(q,c,U)=>{q.exports=U(11825)},11825:q=>{q.exports=function(q,c,U){return q[0]=c[0]*U[0],q[1]=c[1]*U[1],q[2]=c[2]*U[2],q}},11946:q=>{q.exports=function(q,c){return q[0]=-c[0],q[1]=-c[1],q[2]=-c[2],q}},11786:q=>{q.exports=function(q,c){var U=c[0],J=c[1],Q=c[2],s=U*U+J*J+Q*Q;s>0&&(s=1/Math.sqrt(s),q[0]=c[0]*s,q[1]=c[1]*s,q[2]=c[2]*s);return q}},11971:q=>{q.exports=function(q,c){c=c||1;var U=2*Math.random()*Math.PI,J=2*Math.random()-1,Q=Math.sqrt(1-J*J)*c;return q[0]=Math.cos(U)*Q,q[1]=Math.sin(U)*Q,q[2]=J*c,q}},11995:q=>{q.exports=function(q,c,U,J){var Q=U[1],s=U[2],g=c[1]-Q,X=c[2]-s,n=Math.sin(J),W=Math.cos(J);return q[0]=c[0],q[1]=Q+g*W-X*n,q[2]=s+g*n+X*W,q}},11999:q=>{q.exports=function(q,c,U,J){var Q=U[0],s=U[2],g=c[0]-Q,X=c[2]-s,n=Math.sin(J),W=Math.cos(J);return q[0]=Q+X*n+g*W,q[1]=c[1],q[2]=s+X*W-g*n,q}},12005:q=>{q.exports=function(q,c,U,J){var Q=U[0],s=U[1],g=c[0]-Q,X=c[1]-s,n=Math.sin(J),W=Math.cos(J);return q[0]=Q+g*W-X*n,q[1]=s+g*n+X*W,q[2]=c[2],q}},11875:q=>{q.exports=function(q,c){return q[0]=Math.round(c[0]),q[1]=Math.round(c[1]),q[2]=Math.round(c[2]),q}},11882:q=>{q.exports=function(q,c,U){return q[0]=c[0]*U,q[1]=c[1]*U,q[2]=c[2]*U,q}},11885:q=>{q.exports=function(q,c,U,J){return q[0]=c[0]+U[0]*J,q[1]=c[1]+U[1]*J,q[2]=c[2]+U[2]*J,q}},11801:q=>{q.exports=function(q,c,U,J){return q[0]=c,q[1]=U,q[2]=J,q}},11909:(q,c,U)=>{q.exports=U(11906)},11939:(q,c,U)=>{q.exports=U(11932)},11906:q=>{q.exports=function(q,c){var U=c[0]-q[0],J=c[1]-q[1],Q=c[2]-q[2];return U*U+J*J+Q*Q}},11932:q=>{q.exports=function(q){var c=q[0],U=q[1],J=q[2];return c*c+U*U+J*J}},11823:(q,c,U)=>{q.exports=U(11820)},11820:q=>{q.exports=function(q,c,U){return q[0]=c[0]-U[0],q[1]=c[1]-U[1],q[2]=c[2]-U[2],q}},11980:q=>{q.exports=function(q,c,U){var J=c[0],Q=c[1],s=c[2];return q[0]=J*U[0]+Q*U[3]+s*U[6],q[1]=J*U[1]+Q*U[4]+s*U[7],q[2]=J*U[2]+Q*U[5]+s*U[8],q}},11974:q=>{q.exports=function(q,c,U){var J=c[0],Q=c[1],s=c[2],g=U[3]*J+U[7]*Q+U[11]*s+U[15];return g=g||1,q[0]=(U[0]*J+U[4]*Q+U[8]*s+U[12])/g,q[1]=(U[1]*J+U[5]*Q+U[9]*s+U[13])/g,q[2]=(U[2]*J+U[6]*Q+U[10]*s+U[14])/g,q}},11988:q=>{q.exports=function(q,c,U){var J=c[0],Q=c[1],s=c[2],g=U[0],X=U[1],n=U[2],W=U[3],D=W*J+X*s-n*Q,u=W*Q+n*J-g*s,K=W*s+g*Q-X*J,r=-g*J-X*Q-n*s;return q[0]=D*W+r*-g+u*-n-K*-X,q[1]=u*W+r*-X+K*-g-D*-n,q[2]=K*W+r*-n+D*-X-u*-g,q}},12893:q=>{"use strict";q.exports=function(q){for(var c=new Array(q),U=0;U<q;++U)c[U]=U;return c}},12942:q=>{q.exports=function(q){return null!=q&&null!=q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}},13152:(q,c,U)=>{"use strict";U.d(c,{b:()=>J});class J{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.mD=!1,this.dD=!1,this.MD=30,this.TD=0,this.jD=!1,this.fullscreen=!1,this.BD=function(q){},this.ND=function(){},this.LD=function(){},this.gc=function(){},this.PD=function(q){},this.onFullscreenChanged=function(q){},W((()=>{!function(q,c){q._nowObject=performance||Date,q._lastTick=0,q._renderAccum=0,q._rt=0,q._frameCB=X.bind(null,q),requestAnimationFrame(q._frameCB),c>0&&(q._intervalCB=g.bind(null,q),q._interval=setInterval(q._intervalCB,Math.max(c,1e3/q.MD/2)))}(this,c),function(q,c){if(!c)return;var U=!1,J=!1;document.addEventListener("pointerlockchange",(J=>{U=document.pointerLockElement===c,q.PD(U)})),document.addEventListener("fullscreenchange",(U=>{J=document.fullscreenElement===c,q.onFullscreenChanged(J)})),Object.defineProperty(q,"jD",{get:()=>U,set:q=>{q&&!U?n(c):U&&!q&&function(q){q.exitPointerLock&&q.exitPointerLock()}(document)}}),Object.defineProperty(q,"fullscreen",{get:()=>J,set:q=>{q&&!J?c.requestFullscreen():J&&!q&&document.exitFullscreen()}}),c.addEventListener("click",(Q=>{q.mD&&!U&&n(c),q.dD&&!J&&c.requestFullscreen()}));var Q=()=>q.gc();if(window.ResizeObserver){new ResizeObserver(Q).observe(c)}else window.addEventListener("resize",Q)}(this,q),this.LD()}))}}var Q=3,s=20;function g(q){for(var c=1e3/q.MD,U=q._nowObject.now()+s,J=0;q._nowObject.now()>=q._lastTick+c&&q._nowObject.now()<U&&++J<=Q;)q.BD(c),q._lastTick+=c;var g=5*(c+5),X=q._nowObject.now();if(X-q._lastTick>g)for(;X>=q._lastTick+c;)q._lastTick+=c}function X(q){requestAnimationFrame(q._frameCB),g(q);var c=q._nowObject.now(),U=c-q._rt;if(q._rt=c,q.TD>0){q._renderAccum+=U;var J=1e3/q.TD;if(q._renderAccum<J)return;q._renderAccum=Math.min(q._renderAccum-J,J)}var Q=1e3/q.MD,s=(c-q._lastTick)/Q;q.ND(U,s,Q)}function n(q){q.requestPointerLock&&q.requestPointerLock()}var W=q=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),q()};document.addEventListener("readystatechange",c)}else setTimeout(q,1)}},12887:(q,c,U)=>{var J=U(12893),Q=U(12897),s="undefined"!==typeof Float64Array;function g(q,c){return q[0]-c[0]}function X(){var q,c=this.stride,U=new Array(c.length);for(q=0;q<U.length;++q)U[q]=[Math.abs(c[q]),q];U.sort(g);var J=new Array(U.length);for(q=0;q<J.length;++q)J[q]=U[q][1];return J}function n(q,c){var U=["View",c,"d",q].join("");c<0&&(U="View_Nil"+q);var Q="generic"===q;if(-1===c){var s="function "+U+"(a){this.data=a;};var proto="+U+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+U+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+U+"(a){return new "+U+"(a);}";return new Function(s)()}if(0===c){s="function "+U+"(a,d) {this.data = a;this.offset = d};var proto="+U+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+U+"_copy() {return new "+U+"(this.data,this.offset)};proto.pick=function "+U+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+U+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+U+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+U+"(a,b,c,d){return new "+U+"(a,d)}";return new Function("TrivialArray",s)(W[q][0])}s=["'use strict'"];var g=J(c),n=g.map((function(q){return"i"+q})),D="this.offset+"+g.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),u=g.map((function(q){return"b"+q})).join(","),K=g.map((function(q){return"c"+q})).join(",");s.push("function "+U+"(a,"+u+","+K+",d){this.data=a","this.shape=["+u+"]","this.stride=["+K+"]","this.offset=d|0}","var proto="+U+".prototype","proto.dtype='"+q+"'","proto.dimension="+c),s.push("Object.defineProperty(proto,'size',{get:function "+U+"_size(){return "+g.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===c?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),c<4?(s.push("function "+U+"_order(){"),2===c?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+U+"_set("+n.join(",")+",v){"),Q?s.push("return this.data.set("+D+",v)}"):s.push("return this.data["+D+"]=v}"),s.push("proto.get=function "+U+"_get("+n.join(",")+"){"),Q?s.push("return this.data.get("+D+")}"):s.push("return this.data["+D+"]}"),s.push("proto.index=function "+U+"_index(",n.join(),"){return "+D+"}"),s.push("proto.hi=function "+U+"_hi("+n.join(",")+"){return new "+U+"(this.data,"+g.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+g.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var r=g.map((function(q){return"a"+q+"=this.shape["+q+"]"})),H=g.map((function(q){return"c"+q+"=this.stride["+q+"]"}));s.push("proto.lo=function "+U+"_lo("+n.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+H.join(","));for(var b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");s.push("return new "+U+"(this.data,"+g.map((function(q){return"a"+q})).join(",")+","+g.map((function(q){return"c"+q})).join(",")+",b)}"),s.push("proto.step=function "+U+"_step("+n.join(",")+"){var "+g.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+g.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");s.push("return new "+U+"(this.data,"+g.map((function(q){return"a"+q})).join(",")+","+g.map((function(q){return"b"+q})).join(",")+",c)}");var h=new Array(c),o=new Array(c);for(b=0;b<c;++b)h[b]="a[i"+b+"]",o[b]="b[i"+b+"]";s.push("proto.transpose=function "+U+"_transpose("+n+"){"+n.map((function(q,c){return q+"=("+q+"===undefined?"+c+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+U+"(this.data,"+h.join(",")+","+o.join(",")+",this.offset)}"),s.push("proto.pick=function "+U+"_pick("+n+"){var a=[],b=[],c=this.offset");for(b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+U+"(data,shape,stride,offset){return new "+U+"(data,"+g.map((function(q){return"shape["+q+"]"})).join(",")+","+g.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(W[q],X)}var W={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,c,U,J){if(void 0===q)return(0,W.array[0])([]);"number"===typeof q&&(q=[q]),void 0===c&&(c=[q.length]);var g=c.length;if(void 0===U){U=new Array(g);for(var X=g-1,D=1;X>=0;--X)U[X]=D,D*=c[X]}if(void 0===J){J=0;for(X=0;X<g;++X)U[X]<0&&(J-=(c[X]-1)*U[X])}for(var u=function(q){if(Q(q))return"buffer";if(s)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),K=W[u];K.length<=g+1;)K.push(n(u,K.length-1));return(0,K[g+1])(q,c,U,J)}},12897:q=>{function c(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(c(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&c(q.slice(0,0))}(q)||!!q._isBuffer)}},13017:q=>{"use strict";var c=[],U=[],J=[],Q=[],s=[],g=[],X=[],n=[],W=[],D=[],u=[],K=[];q.exports=function(q,r,H,b,h,o){for(var a=X,p=W,R=D,I=K,t=0;t<3;t++)a[t]=+H[t],R[t]=+r.max[t],p[t]=+r.base[t];o||(o=1e-10);var C=function(q,X,W,D,K,r){var H=c,b=U,h=J,o=Q,a=s,p=g,R=n,I=Math.floor,t=0,C=0,i=0,F=0,v=0;if(Y(),0===i)return 0;for(F=O();C<=i;){if(k(F)&&V())return t;F=O()}for(t+=i,v=0;v<3;v++)D[v]+=W[v],K[v]+=W[v];return t;function Y(){if(C=0,0!==(i=Math.sqrt(W[0]*W[0]+W[1]*W[1]+W[2]*W[2])))for(var q=0;q<3;q++){var c=W[q]>=0;o[q]=c?1:-1;var U=c?K[q]:D[q];H[q]=c?D[q]:K[q],b[q]=G(U,o[q]),h[q]=S(H[q],o[q]),R[q]=W[q]/i,a[q]=Math.abs(1/R[q]);var J=c?b[q]+1-U:U-b[q];p[q]=a[q]<1/0?a[q]*J:1/0}}function k(c){for(var U=o[0],J=0===c?b[0]:h[0],Q=b[0]+U,s=o[1],g=1===c?b[1]:h[1],X=b[1]+s,n=o[2],W=2===c?b[2]:h[2],D=b[2]+n,u=J;u!=Q;u+=U)for(var K=g;K!=X;K+=s)for(var r=W;r!=D;r+=n)if(q(u,K,r))return!0;return!1}function V(){t+=C;var q=o[F],c=C/i,U=u;for(v=0;v<3;v++){var J=W[v]*c;D[v]+=J,K[v]+=J,U[v]=W[v]-J}if(q>0?K[F]=Math.round(K[F]):D[F]=Math.round(D[F]),X(t,F,q,U))return!0;for(v=0;v<3;v++)W[v]=U[v];return Y(),0===i}function O(){var q=p[0]<p[1]?p[0]<p[2]?0:2:p[1]<p[2]?1:2,c=p[q]-C;for(C=p[q],b[q]+=o[q],p[q]+=a[q],v=0;v<3;v++)H[v]+=c*R[v],h[v]=S(H[v],o[v]);return q}function G(q,c){return I(q-c*r)}function S(q,c){return I(q+c*r)}}(q,b,a,p,R,o);if(!h){for(t=0;t<3;t++)I[t]=H[t]>0?R[t]-r.max[t]:p[t]-r.base[t];r.translate(I)}return C}},13190:(q,c,U)=>{"use strict";U.d(c,{b:()=>u});var J=U(13015),Q=U(11745);class s{constructor(q,c,U,s,g,X,n){this.TW=new J(q.base,q.qD),this.aQ=c,this.friction=U,this.restitution=s,this.vX=g,this.ar=X,this.YX=!!n,this.EW=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.XH=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.bW=Q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Q.create(),this._impulses=Q.create(),this._sleepFrameCount=10}loadFromCopy(q){Q.k(this.TW.base,q.TW.base),Q.k(this.TW.qD,q.TW.qD),Q.k(this.TW.max,q.TW.max),this.TW.mag=q.TW.mag,this.aQ=q.aQ,this.friction=q.friction,this.restitution=q.restitution,this.vX=q.vX,this.ar=q.ar,this.YX=q.YX,this.EW=q.EW,this.fluidDrag=q.fluidDrag,this.XH=q.XH,this.preventFallOffEdge=q.preventFallOffEdge,this.rolledBackLastTick=q.rolledBackLastTick,Q.k(this.bW,q.bW),Q.k(this.resting,q.resting),this.inFluid=q.inFluid,this._ratioInFluid=q._ratioInFluid,Q.k(this._forces,q._forces),Q.k(this._impulses,q._impulses),this._sleepFrameCount=q._sleepFrameCount}setPosition(q){g(q),Q.eU(q,q,this.TW.base),this.TW.translate(q),this.aW()}Xc(){return Q.clone(this.TW.base)}applyForce(q){g(q),Q.add(this._forces,this._forces,q),this.aW()}applyImpulse(q){g(q),Q.add(this._impulses,this._impulses,q),this.aW()}aW(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=q=>{};var X=U(13015),n=U(11745),W=U(13017);function D(){this.EW=.1,this.fluidDrag=.4,this.SX=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function u(q,c,U){q=Object.assign(new D,q),this.gravity=q.gravity||[0,-10,0],this.EW=q.EW||.1,this.SX=q.SX||2,this.fluidDrag=q.fluidDrag||.4,this.minBounceImpulse=q.minBounceImpulse,this.bodies=[],this.mK=q.mK,this.testSolid=c,this.testFluid=U}u.prototype.Fr=function(q,c,U,J,Q,g){q=q||new X([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof U&&(U=1),"undefined"==typeof J&&(J=0),"undefined"==typeof Q&&(Q=1);var n=new s(q,c,U,J,Q,g);return this.bodies.push(n),n},u.prototype.vr=function(q){var c=this.bodies.indexOf(q);c<0||(this.bodies.splice(c,1),q.TW=q.ar=null)};var K=n.create(),r=n.create(),H=n.create(),b=n.create(),h=n.create(),o=n.create(),a=n.create(),p=new X([0,0,0],[1,1,1]),R=new s(p,1,1,0,1,(()=>{}),!1);function I(q,c,U){return c=U,c*=1-(1-q.ratioInFluid)**2}u.prototype.wX=function(q){q/=1e3;var c=M(0,n.squaredLength(this.gravity));this.bodies.forEach((U=>function(q,c,U,J){n.k(h,c.resting),q.mK&&R.loadFromCopy(c);if(c.aQ<=0)return n.set(c.bW,0,0,0),n.set(c._forces,0,0,0),void n.set(c._impulses,0,0,0);var Q=J||0===c.vX;if(function(q,c,U,J){if(c._sleepFrameCount>0)return!1;if(J)return!0;var Q=!1,s=.5*U*U*c.vX;return n.scale(y,q.gravity,s),W(q.testSolid,c.TW,y,(function(){return Q=!0,!0}),!0),Q}(q,c,U,Q))return;c._sleepFrameCount--,function(q,c){var U=c.TW,J=Math.floor(U.base[0]),Q=Math.floor(U.base[2]),s=Math.floor(U.base[1]),g=Math.floor(U.max[1]);if(!q.testFluid(J,s,Q))return c.inFluid=!1,void(c.ratioInFluid=0);var X=1,W=s+1;for(;W<=g&&q.testFluid(J,W,Q);)X++,W++;var D=(s+X-U.base[1])/U.qD[1];D>1&&(D=1);var u=U.qD[0]*U.qD[1]*U.qD[2]*D,K=C;n.scale(K,q.gravity,-q.SX*u*c.vX),c.applyForce(K),c.inFluid=!0,c.ratioInFluid=D}(q,c),m(c._forces),m(c._impulses),m(c.bW),m(c.resting),n.scale(K,c._forces,1/c.aQ),n.TX(K,K,q.gravity,c.vX),n.scale(r,c._impulses,1/c.aQ),n.TX(r,r,K,U),n.add(c.bW,c.bW,r),c.friction&&(i(q,0,c,r,U),i(q,1,c,r,U),i(q,2,c,r,U));var s=c.fluidDrag>=0?c.fluidDrag:q.fluidDrag,g=c.EW>=0?c.EW:q.EW,X=g,D=g;c.inFluid&&(X=I(c,X,c.fluidDragHoriz>=0?c.fluidDragHoriz:s),D=I(c,D,c.fluidDragVert>=0?c.fluidDragVert:s));X=Math.max(1-X*U/c.aQ,0),D=Math.max(1-D*U/c.aQ,0),n.set(t,X,D,X),n.multiply(c.bW,c.bW,t),n.scale(H,c.bW,U),n.set(c._forces,0,0,0),n.set(c._impulses,0,0,0),c.YX&&T(Y,c.TW);n.k(o,H),n.set(a,0,0,0),c.preventFallOffEdge&&function(q,c,U,J){if(!c.resting[1]||U[1]>0)return;var Q=Z;T(Q,c.TW);for(var s=0;s<3;s+=2){n.set(S,0,0,0),S[s]=U[s];var g=!0;(g=(g=(g=(g=g&&!z(q,Q.base[0]+S[0]+1e-5,Q.base[1],Q.base[2]+S[2]+1e-5))&&!z(q,Q.max[0]+S[0]-1e-5,Q.base[1],Q.base[2]+S[2]+1e-5))&&!z(q,Q.base[0]+S[0]+1e-5,Q.base[1],Q.max[2]+S[2]-1e-5))&&!z(q,Q.max[0]+S[0]-1e-5,Q.base[1],Q.max[2]+S[2]-1e-5))?(J[s]=U[s]>0?1:-1,U[s]=0):0===s&&(n.set(x,U[0],0,0),v(q,Q,x,J,c.slideOnCollision))}}(q,c,H,a);v(q,c.TW,H,c.resting,c.slideOnCollision),c.YX&&function(q,c,U,J){if(c.resting[1]>=0&&!c.inFluid)return;var Q=0!==c.resting[0],s=0!==c.resting[2];if(!Q&&!s)return;var g=Math.abs(J[0]/J[2]),X=4;if(!Q&&g>X)return;if(!s&&g<1/X)return;n.add(V,U.base,J);var D=q.testSolid;W(D,U,J,(function(q,c,U,J){if(1!==c)return!0;J[c]=0}));var u=U.base[1],K=c.inFluid?1.951:1.001,r=Math.floor(u+K)-u;n.set(O,0,r,0);var H=!1;if(W(D,U,O,(function(q,c,U,J){return H=!0,!0})),H)return;n.eU(G,V,U.base),G[1]=0,v(q,U,G,k,!0);var b=M(U.base[0],V[0]),h=M(U.base[2],V[2]);if(Q&&!b&&(!h||!s))return;if(s&&(!b||!Q)&&!h)return;var o=!0;if(o=o&&!z(q,U.base[0]+1e-5,U.base[1],U.base[2]+1e-5),o=o&&!z(q,U.max[0]-1e-5,U.base[1],U.base[2]+1e-5),o=o&&!z(q,U.base[0]+1e-5,U.base[1],U.max[2]-1e-5),o=o&&!z(q,U.max[0]-1e-5,U.base[1],U.max[2]-1e-5),o)return;T(c.TW,U),c.resting[0]=k[0],c.resting[2]=k[2],c.XH&&c.XH()}(q,c,Y,o);for(var u=0;u<3;++u)c.resting[u]=c.resting[u]||a[u],b[u]=0,c.resting[u]&&(h[u]||(b[u]=-c.bW[u]),c.bW[u]=0);var p=n.length(b);p>.001&&(n.scale(b,b,c.aQ),c.ar&&c.ar(b),c.restitution>0&&p>q.minBounceImpulse&&(n.scale(b,b,c.restitution),c.applyImpulse(b)));var F=n.squaredLength(c.bW);F>1e-5&&c.aW();q.mK&&q.mK(c)?(c.loadFromCopy(R),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,U,q,c)))};var t=n.create([0,0,0]);var C=n.create();function i(q,c,U,J,Q){var s=U.resting[c],g=J[c];if(!U.alwaysApplyHorizFriction||1!==c){if(0===s)return;if(s*g<=0)return}n.k(F,U.bW),F[c]=0;var X=n.length(F);if(!M(X,0)){var W=Math.abs(U.friction*q.gravity[c]*Q),D=X>W?(X-W)/X:0;U.bW[(c+1)%3]*=D,U.bW[(c+2)%3]*=D}}var F=n.create();function v(q,c,U,J,Q){return n.set(J,0,0,0),W(q.testSolid,c,U,(function(q,c,U,s){J[c]=U,s[c]=0,Q||(s[0]=0,s[1]=0,s[2]=0)}))}var Y=new X([],[]),k=n.create(),V=n.create(),O=n.create(),G=n.create();var S=n.create(),Z=new X([],[]),x=n.create();function z(q,c,U,J){return q.testSolid(Math.floor(c),Math.floor(U-1),Math.floor(J))}var y=n.create();function M(q,c){return Math.abs(q-c)<1e-5}function T(q,c){for(var U=0;U<3;U++)q.base[U]=c.base[U],q.max[U]=c.max[U],q.qD[U]=c.qD[U]}var m=function(q){}},11634:function(q,c){!function(q){"use strict";var c=function(q,U){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,c){q.__proto__=c}||function(q,c){for(var U in c)Object.prototype.hasOwnProperty.call(c,U)&&(q[U]=c[U])},c(q,U)};function U(q,U){if("function"!==typeof U&&null!==U)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function J(){this.constructor=q}c(q,U),q.prototype=null===U?Object.create(U):(J.prototype=U.prototype,new J)}function J(q,c,U,J){var Q,s=arguments.length,g=s<3?c:null===J?J=Object.getOwnPropertyDescriptor(c,U):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(q,c,U,J);else for(var X=q.length-1;X>=0;X--)(Q=q[X])&&(g=(s<3?Q(g):s>3?Q(c,U,g):Q(c,U))||g);return s>3&&g&&Object.defineProperty(c,U,g),g}function Q(q,c,U){if(U||2===arguments.length)for(var J,Q=0,s=c.length;Q<s;Q++)!J&&Q in c||(J||(J=Array.prototype.slice.call(c,0,Q)),J[Q]=c[Q]);return q.concat(J||Array.prototype.slice.call(c))}var s,g=255,X=213;q.OPERATION=void 0,(s=q.OPERATION||(q.OPERATION={}))[s.ADD=128]="ADD",s[s.REPLACE=0]="REPLACE",s[s.DELETE=64]="DELETE",s[s.DELETE_AND_ADD=192]="DELETE_AND_ADD",s[s.TOUCH=1]="TOUCH",s[s.CLEAR=10]="CLEAR";var n=function(){function c(q,c,U){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=q,this.setParent(c,U)}return c.prototype.setParent=function(q,c,U){var J=this;if(this.indexes||(this.indexes=this.ref instanceof Gq?this.ref._definition.indexes:{}),this.parent=q,this.parentIndex=U,c)if(this.root=c,this.ref instanceof Gq){var Q=this.ref._definition;for(var s in Q.schema){var g=this.ref[s];if(g&&g.$changes){var X=Q.indexes[s];g.$changes.setParent(this.ref,c,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(q,c){if(q instanceof Gq){var U=q.$changes,Q=J.ref.$changes.indexes[c];U.setParent(J.ref,J.root,Q)}}))},c.prototype.operation=function(q){this.changes.set(--this.currentCustomOperation,q)},c.prototype.change=function(c,U){void 0===U&&(U=q.OPERATION.ADD);var J="number"===typeof c?c:this.indexes[c];this.assertValidIndex(J,c);var Q=this.changes.get(J);Q&&Q.op!==q.OPERATION.DELETE&&Q.op!==q.OPERATION.TOUCH||this.changes.set(J,{op:Q&&Q.op===q.OPERATION.DELETE?q.OPERATION.DELETE_AND_ADD:U,index:J}),this.allChanges.add(J),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var U="number"===typeof c?c:this.indexes[c];this.assertValidIndex(U,c),this.changes.has(U)||this.changes.set(U,{op:q.OPERATION.TOUCH,index:U}),this.allChanges.add(U),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(q){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[q]];var c,U=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(U)[0]},c.prototype.getChildrenFilter=function(){var q=this.parent._definition.childFilters;return q&&q[this.parentIndex]},c.prototype.getValue=function(q){return this.ref.getByIndex(q)},c.prototype.delete=function(c){var U="number"===typeof c?c:this.indexes[c];if(void 0!==U){var J=this.getValue(U);this.changes.set(U,{op:q.OPERATION.DELETE,index:U}),this.allChanges.delete(U),delete this.caches[U],J&&J.$changes&&(J.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(U,")"))},c.prototype.discard=function(c,U){var J=this;void 0===c&&(c=!1),void 0===U&&(U=!1),this.ref instanceof Gq||this.changes.forEach((function(c){if(c.op===q.OPERATION.DELETE){var U=J.ref.getIndex(c.index);delete J.indexes[U]}})),this.changes.clear(),this.changed=c,U&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var q=this;this.changes.forEach((function(c){var U=q.getValue(c.index);U&&U.$changes&&U.$changes.discardAll()})),this.discard()},c.prototype.cache=function(q,c){this.caches[q]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(q,c){if(void 0===q)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function W(q,c,U,J){return q[c]||(q[c]=[]),q[c].push(U),null===J||void 0===J||J.forEach((function(q,c){return U(q,c)})),function(){return u(q[c],q[c].indexOf(U))}}function D(c){var U=this,J="string"!==typeof this.$changes.getType();this.$items.forEach((function(Q,s){c.push({refId:U.$changes.refId,op:q.OPERATION.DELETE,field:s,value:void 0,previousValue:Q}),J&&U.$changes.root.removeRef(Q.$changes.refId)}))}function u(q,c){if(-1===c||c>=q.length)return!1;for(var U=q.length-1,J=c;J<U;J++)q[J]=q[J+1];return q.length=U,!0}var K=function(q,c){var U=q.toString(),J=c.toString();return U<J?-1:U>J?1:0};function r(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,c){return"symbol"===typeof c||isNaN(c)?q[c]:q.at(c)},set:function(q,c,U){if("symbol"===typeof c||isNaN(c))q[c]=U;else{var J=Array.from(q.$items.keys()),Q=parseInt(J[c]||c);void 0===U||null===U?q.deleteAt(Q):q.setAt(Q,U)}return!0},deleteProperty:function(q,c){return"number"===typeof c?q.deleteAt(c):delete q[c],!0}})}var H=function(){function c(){for(var q=[],c=0;c<arguments.length;c++)q[c]=arguments[c];this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,q)}return c.prototype.Eg=function(c,U){return void 0===U&&(U=!0),W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,c,U?this.$items:void 0)},c.prototype.sc=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,c)},c.is=function(q){return Array.isArray(q)||void 0!==q.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(q){0===q?this.clear():this.splice(q,this.length-q)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var q,c=this,U=[],J=0;J<arguments.length;J++)U[J]=arguments[J];return U.forEach((function(U){q=c.$refId++,c.setAt(q,U)})),q},c.prototype.pop=function(){var q=Array.from(this.$indexes.values()).pop();if(void 0!==q){this.$changes.delete(q),this.$indexes.delete(q);var c=this.$items.get(q);return this.$items.delete(q),c}},c.prototype.at=function(q){var c=Array.from(this.$items.keys())[q];return this.$items.get(c)},c.prototype.setAt=function(c,U){var J,Q;if(void 0!==U&&null!==U){if(this.$items.get(c)!==U){void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,c);var s=null!==(Q=null===(J=this.$changes.indexes[c])||void 0===J?void 0:J.op)&&void 0!==Q?Q:q.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,U),this.$changes.change(c,s)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(q){var c=Array.from(this.$items.keys())[q];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(q){return this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&D.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var q,U=[],J=0;J<arguments.length;J++)U[J]=arguments[J];return new(c.bind.apply(c,Q([void 0],(q=Array.from(this.$items.values())).concat.apply(q,U),!1)))},c.prototype.join=function(q){return Array.from(this.$items.values()).join(q)},c.prototype.reverse=function(){var q=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(U,J){q.setAt(c[J],U)})),this},c.prototype.shift=function(){var q=Array.from(this.$items.keys()).shift();if(void 0!==q){var c=this.$items.get(q);return this.$deleteAt(q),c}},c.prototype.slice=function(q,U){var J=new c;return J.push.apply(J,Array.from(this.$items.values()).slice(q,U)),J},c.prototype.sort=function(q){var c=this;void 0===q&&(q=K);var U=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(q).forEach((function(q,J){c.setAt(U[J],q)})),this},c.prototype.splice=function(q,c){void 0===c&&(c=this.length-q);for(var U=Array.from(this.$items.keys()),J=[],Q=q;Q<q+c;Q++)J.push(this.$items.get(U[Q])),this.$deleteAt(U[Q]);return J},c.prototype.unshift=function(){for(var q=this,c=[],U=0;U<arguments.length;U++)c[U]=arguments[U];var J=this.length,Q=c.length,s=Array.from(this.$items.values());return c.forEach((function(c,U){q.setAt(U,c)})),s.forEach((function(c,U){q.setAt(Q+U,c)})),J+Q},c.prototype.indexOf=function(q,c){return Array.from(this.$items.values()).indexOf(q,c)},c.prototype.lastIndexOf=function(q,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(q,c)},c.prototype.every=function(q,c){return Array.from(this.$items.values()).every(q,c)},c.prototype.some=function(q,c){return Array.from(this.$items.values()).some(q,c)},c.prototype.forEach=function(q,c){Array.from(this.$items.values()).forEach(q,c)},c.prototype.map=function(q,c){return Array.from(this.$items.values()).map(q,c)},c.prototype.filter=function(q,c){return Array.from(this.$items.values()).filter(q,c)},c.prototype.reduce=function(q,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(q,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(q,c){return Array.from(this.$items.values()).find(q,c)},c.prototype.findIndex=function(q,c){return Array.from(this.$items.values()).findIndex(q,c)},c.prototype.fill=function(q,c,U){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(q,c,U){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(q,c){return Array.from(this.$items.values()).includes(q,c)},c.prototype.flatMap=function(q,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(q){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var q=Array.from(this.$items.values());return q.findLast.apply(q,arguments)},c.prototype.findLastIndex=function(){var q=Array.from(this.$items.values());return q.findLastIndex.apply(q,arguments)},c.prototype.setIndex=function(q,c){this.$indexes.set(q,c)},c.prototype.getIndex=function(q){return this.$indexes.get(q)},c.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},c.prototype.deleteByIndex=function(q){var c=this.$indexes.get(q);this.$items.delete(c),this.$indexes.delete(q)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(q){return"function"===typeof q.toJSON?q.toJSON():q}))},c.prototype.clone=function(q){return q?new(c.bind.apply(c,Q([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,Q([void 0],this.map((function(q){return q.$changes?q.clone():q})),!1)))},c}();function b(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,c){return"symbol"!==typeof c&&"undefined"===typeof q[c]?q.get(c):q[c]},set:function(q,c,U){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"Eg"!==c&&"sc"!==c&&"onChange"!==c?q.set(c,U):q[c]=U,!0},deleteProperty:function(q,c){return q.delete(c),!0}})}var h=function(){function c(q){var U=this;if(this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q)if(q instanceof Map||q instanceof c)q.forEach((function(q,c){return U.set(c,q)}));else for(var J in q)this.set(J,q[J])}return c.prototype.Eg=function(c,U){return void 0===U&&(U=!0),W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,c,U?this.$items:void 0)},c.prototype.sc=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,c)},c.is=function(q){return void 0!==q.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,U){if(void 0===U||null===U)throw new Error("MapSchema#set('".concat(c,"', ").concat(U,"): trying to set ").concat(U," value on '").concat(c,"'."));c=c.toString();var J="undefined"!==typeof this.$changes.indexes[c],Q=J?this.$changes.indexes[c]:this.$refId++,s=J?q.OPERATION.REPLACE:q.OPERATION.ADD,g=void 0!==U.$changes;if(g&&U.$changes.setParent(this,this.$changes.root,Q),J){if(!g&&this.$items.get(c)===U)return;g&&this.$items.get(c)!==U&&(s=q.OPERATION.ADD)}else this.$changes.indexes[c]=Q,this.$indexes.set(Q,c);return this.$items.set(c,U),this.$changes.change(c,s),this},c.prototype.get=function(q){return this.$items.get(q)},c.prototype.delete=function(q){return this.$changes.delete(q),this.$items.delete(q)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&D.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(q){return this.$items.has(q)},c.prototype.forEach=function(q){this.$items.forEach(q)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(q,c){this.$indexes.set(q,c)},c.prototype.getIndex=function(q){return this.$indexes.get(q)},c.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},c.prototype.deleteByIndex=function(q){var c=this.$indexes.get(q);this.$items.delete(c),this.$indexes.delete(q)},c.prototype.toJSON=function(){var q={};return this.forEach((function(c,U){q[U]="function"===typeof c.toJSON?c.toJSON():c})),q},c.prototype.clone=function(q){var U;return q?U=Object.assign(new c,this):(U=new c,this.forEach((function(q,c){q.$changes?U.set(c,q.clone()):U.set(c,q)}))),U},c}(),o={};function a(q,c){o[q]=c}function p(q){return o[q]}var R=function(){function q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return q.create=function(c){var U=new q;return U.schema=Object.assign({},c&&c.schema||{}),U.indexes=Object.assign({},c&&c.indexes||{}),U.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),U.descriptors=Object.assign({},c&&c.descriptors||{}),U.deprecated=Object.assign({},c&&c.deprecated||{}),U},q.prototype.addField=function(q,c){var U=this.getNextFieldIndex();this.fieldsByIndex[U]=q,this.indexes[q]=U,this.schema[q]=Array.isArray(c)?{array:c[0]}:c},q.prototype.hasField=function(q){return void 0!==this.indexes[q]},q.prototype.addFilter=function(q,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[q]]=c,this.indexesWithFilters.push(this.indexes[q]),!0},q.prototype.addChildrenFilter=function(q,c){var U=this.indexes[q],J=this.schema[q];if(p(Object.keys(J)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[U]=c,!0;console.warn("@filterChildren: field '".concat(q,"' can't have children. Ignoring filter."))},q.prototype.getChildrenFilter=function(q){return this.childFilters&&this.childFilters[this.indexes[q]]},q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},q}();function I(q){return q._context&&q._context.useFilters}var t=function(){function q(){this.types={},this.schemas=new Map,this.useFilters=!1}return q.prototype.has=function(q){return this.schemas.has(q)},q.prototype.get=function(q){return this.types[q]},q.prototype.add=function(q,c){void 0===c&&(c=this.schemas.size),q._definition=R.create(q._definition),q._typeid=c,this.types[c]=q,this.schemas.set(q,c)},q.create=function(c){return void 0===c&&(c={}),function(U){return c.context||(c.context=new q),i(U,c)}},q}(),C=new t;function i(q,c){return void 0===c&&(c={}),function(U,J){var s=c.context||C,g=U.constructor;if(g._context=s,!q)throw new Error("".concat(g.name,': @type() reference provided for "').concat(J,"\" is undefined. Make sure you don't have any circular dependencies."));s.has(g)||s.add(g);var X=g._definition;if(X.addField(J,q),X.descriptors[J]){if(X.deprecated[J])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(J,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(o){var n=o.stack.split("\n")[4].trim();throw new Error("".concat(o.message," ").concat(n))}}var W=H.is(q),D=!W&&h.is(q);if("string"!==typeof q&&!Gq.is(q)){var u=Object.values(q)[0];"string"===typeof u||s.has(u)||s.add(u)}if(c.manual)X.descriptors[J]={enumerable:!0,configurable:!0,writable:!0};else{var K="_".concat(J);X.descriptors[K]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[J]={get:function(){return this[K]},set:function(q){q!==this[K]&&(void 0!==q&&null!==q?(!W||q instanceof H||(q=new(H.bind.apply(H,Q([void 0],q,!1)))),!D||q instanceof h||(q=new h(q)),void 0===q.$proxy&&(D?q=b(q):W&&(q=r(q))),this.$changes.change(J),q.$changes&&q.$changes.setParent(this,this.$changes.root,this._definition.indexes[J])):this[K]&&this.$changes.delete(J),this[K]=q)},enumerable:!0,configurable:!0}}}}function F(q){return function(c,U){var J=c.constructor;J._definition.addFilter(U,q)&&(J._context.useFilters=!0)}}function v(q){return function(c,U){var J=c.constructor;J._definition.addChildrenFilter(U,q)&&(J._context.useFilters=!0)}}function Y(q){return void 0===q&&(q=!0),function(c,U){var J=c.constructor._definition;J.deprecated[U]=!0,q&&(J.descriptors[U]={get:function(){throw new Error("".concat(U," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function k(q,c,U){for(var J in void 0===U&&(U={}),U.context||(U.context=q._context||U.context||C),c)i(c[J],U)(q.prototype,J);return q}function V(q){for(var c=0,U=0,J=0,Q=q.length;J<Q;J++)(c=q.charCodeAt(J))<128?U+=1:c<2048?U+=2:c<55296||c>=57344?U+=3:(J++,U+=4);return U}function O(q,c,U){for(var J=0,Q=0,s=U.length;Q<s;Q++)(J=U.charCodeAt(Q))<128?q[c++]=J:J<2048?(q[c++]=192|J>>6,q[c++]=128|63&J):J<55296||J>=57344?(q[c++]=224|J>>12,q[c++]=128|J>>6&63,q[c++]=128|63&J):(Q++,J=65536+((1023&J)<<10|1023&U.charCodeAt(Q)),q[c++]=240|J>>18,q[c++]=128|J>>12&63,q[c++]=128|J>>6&63,q[c++]=128|63&J)}function G(q,c){q.push(255&c)}function S(q,c){q.push(255&c)}function Z(q,c){q.push(255&c),q.push(c>>8&255)}function x(q,c){q.push(255&c),q.push(c>>8&255)}function z(q,c){q.push(255&c),q.push(c>>8&255),q.push(c>>16&255),q.push(c>>24&255)}function y(q,c){var U=c>>24,J=c>>16,Q=c>>8,s=c;q.push(255&s),q.push(255&Q),q.push(255&J),q.push(255&U)}function M(q,c){var U=Math.floor(c/Math.pow(2,32));y(q,c>>>0),y(q,U)}function T(q,c){var U=c/Math.pow(2,32)|0;y(q,c>>>0),y(q,U)}function m(q,c){P(q,c)}function d(q,c){w(q,c)}var e=new Int32Array(2),B=new Float32Array(e.buffer),N=new Float64Array(e.buffer);function P(q,c){B[0]=c,z(q,e[0])}function w(q,c){N[0]=c,z(q,e[0]),z(q,e[1])}function L(q,c){return S(q,c?1:0)}function l(q,c){c||(c="");var U=V(c),J=0;if(U<32)q.push(160|U),J=1;else if(U<256)q.push(217),S(q,U),J=2;else if(U<65536)q.push(218),x(q,U),J=3;else{if(!(U<4294967296))throw new Error("String too long");q.push(219),y(q,U),J=5}return O(q,q.length,c),J+U}function j(q,c){return isNaN(c)?j(q,0):isFinite(c)?c!==(0|c)?(q.push(203),w(q,c),9):c>=0?c<128?(S(q,c),1):c<256?(q.push(204),S(q,c),2):c<65536?(q.push(205),x(q,c),3):c<4294967296?(q.push(206),y(q,c),5):(q.push(207),T(q,c),9):c>=-32?(q.push(224|c+32),1):c>=-128?(q.push(208),G(q,c),2):c>=-32768?(q.push(209),Z(q,c),3):c>=-2147483648?(q.push(210),z(q,c),5):(q.push(211),M(q,c),9):j(q,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var f=Object.freeze({__proto__:null,utf8Write:O,int8:G,uint8:S,int16:Z,uint16:x,int32:z,uint32:y,int64:M,uint64:T,float32:m,float64:d,writeFloat32:P,writeFloat64:w,boolean:L,string:l,number:j});function A(q,c,U){for(var J="",Q=0,s=c,g=c+U;s<g;s++){var X=q[s];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(Q=(7&X)<<18|(63&q[++s])<<12|(63&q[++s])<<6|63&q[++s])>=65536?(Q-=65536,J+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):J+=String.fromCharCode(Q):J+=String.fromCharCode((15&X)<<12|(63&q[++s])<<6|63&q[++s]):J+=String.fromCharCode((31&X)<<6|63&q[++s]):J+=String.fromCharCode(X)}return J}function E(q,c){return qq(q,c)<<24>>24}function qq(q,c){return q[c.offset++]}function cq(q,c){return Uq(q,c)<<16>>16}function Uq(q,c){return q[c.offset++]|q[c.offset++]<<8}function Jq(q,c){return q[c.offset++]|q[c.offset++]<<8|q[c.offset++]<<16|q[c.offset++]<<24}function Qq(q,c){return Jq(q,c)>>>0}function sq(q,c){return Kq(q,c)}function gq(q,c){return rq(q,c)}function Xq(q,c){var U=Qq(q,c);return Jq(q,c)*Math.pow(2,32)+U}function nq(q,c){var U=Qq(q,c);return Qq(q,c)*Math.pow(2,32)+U}var Wq=new Int32Array(2),Dq=new Float32Array(Wq.buffer),uq=new Float64Array(Wq.buffer);function Kq(q,c){return Wq[0]=Jq(q,c),Dq[0]}function rq(q,c){return Wq[0]=Jq(q,c),Wq[1]=Jq(q,c),uq[0]}function Hq(q,c){return qq(q,c)>0}function bq(q,c){var U,J=q[c.offset++];J<192?U=31&J:217===J?U=qq(q,c):218===J?U=Uq(q,c):219===J&&(U=Qq(q,c));var Q=A(q,c.offset,U);return c.offset+=U,Q}function hq(q,c){var U=q[c.offset];return U<192&&U>160||217===U||218===U||219===U}function oq(q,c){var U=q[c.offset++];return U<128?U:202===U?Kq(q,c):203===U?rq(q,c):204===U?qq(q,c):205===U?Uq(q,c):206===U?Qq(q,c):207===U?nq(q,c):208===U?E(q,c):209===U?cq(q,c):210===U?Jq(q,c):211===U?Xq(q,c):U>223?-1*(255-U+1):void 0}function aq(q,c){var U=q[c.offset];return U<128||U>=202&&U<=211}function pq(q,c){return q[c.offset]<160}function Rq(q,c){return q[c.offset-1]===g&&(q[c.offset]<128||q[c.offset]>=202&&q[c.offset]<=211)}var Iq=Object.freeze({__proto__:null,int8:E,uint8:qq,int16:cq,uint16:Uq,int32:Jq,uint32:Qq,float32:sq,float64:gq,int64:Xq,uint64:nq,readFloat32:Kq,readFloat64:rq,boolean:Hq,string:bq,stringCheck:hq,number:oq,numberCheck:aq,arrayCheck:pq,switchStructureCheck:Rq}),tq=function(){function c(q){var c=this;this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return c.add(q)}))}return c.prototype.Eg=function(c,U){return void 0===U&&(U=!0),W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,c,U?this.$items:void 0)},c.prototype.sc=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,c)},c.is=function(q){return void 0!==q.collection},c.prototype.add=function(q){var c=this.$refId++;return void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,q),this.$changes.change(c),c},c.prototype.at=function(q){var c=Array.from(this.$items.keys())[q];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(q){for(var c,U,J=this.$items.entries();(U=J.next())&&!U.done;)if(q===U.value[1]){c=U.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&D.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(q){return Array.from(this.$items.values()).some((function(c){return c===q}))},c.prototype.forEach=function(q){var c=this;this.$items.forEach((function(U,J,Q){return q(U,J,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(q,c){this.$indexes.set(q,c)},c.prototype.getIndex=function(q){return this.$indexes.get(q)},c.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},c.prototype.deleteByIndex=function(q){var c=this.$indexes.get(q);this.$items.delete(c),this.$indexes.delete(q)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var q=[];return this.forEach((function(c,U){q.push("function"===typeof c.toJSON?c.toJSON():c)})),q},c.prototype.clone=function(q){var U;return q?U=Object.assign(new c,this):(U=new c,this.forEach((function(q){q.$changes?U.add(q.clone()):U.add(q)}))),U},c}(),Cq=function(){function c(q){var c=this;this.$changes=new n(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return c.add(q)}))}return c.prototype.Eg=function(c,U){return void 0===U&&(U=!0),W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,c,U?this.$items:void 0)},c.prototype.sc=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,c)},c.is=function(q){return void 0!==q.set},c.prototype.add=function(c){var U,J;if(this.has(c))return!1;var Q=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,Q);var s=null!==(J=null===(U=this.$changes.indexes[Q])||void 0===U?void 0:U.op)&&void 0!==J?J:q.OPERATION.ADD;return this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,c),this.$changes.change(Q,s),Q},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(q){for(var c,U,J=this.$items.entries();(U=J.next())&&!U.done;)if(q===U.value[1]){c=U.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&D.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(q){for(var c,U=this.$items.values(),J=!1;(c=U.next())&&!c.done;)if(q===c.value){J=!0;break}return J},c.prototype.forEach=function(q){var c=this;this.$items.forEach((function(U,J,Q){return q(U,J,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(q,c){this.$indexes.set(q,c)},c.prototype.getIndex=function(q){return this.$indexes.get(q)},c.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},c.prototype.deleteByIndex=function(q){var c=this.$indexes.get(q);this.$items.delete(c),this.$indexes.delete(q)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var q=[];return this.forEach((function(c,U){q.push("function"===typeof c.toJSON?c.toJSON():c)})),q},c.prototype.clone=function(q){var U;return q?U=Object.assign(new c,this):(U=new c,this.forEach((function(q){q.$changes?U.add(q.clone()):U.add(q)}))),U},c}(),iq=function(){function q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return q.prototype.addRefId=function(q){this.refIds.has(q)||(this.refIds.add(q),this.containerIndexes.set(q,new Set))},q.get=function(c){return void 0===c.$filterState&&(c.$filterState=new q),c.$filterState},q}(),Fq=function(){function q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},q.prototype.addRef=function(q,c,U){void 0===U&&(U=!0),this.refs.set(q,c),U&&(this.refCounts[q]=(this.refCounts[q]||0)+1)},q.prototype.removeRef=function(q){this.refCounts[q]=this.refCounts[q]-1,this.deletedRefs.add(q)},q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},q.prototype.garbageCollectDeletedRefs=function(){var q=this;this.deletedRefs.forEach((function(c){if(!(q.refCounts[c]>0)){var U=q.refs.get(c);if(U instanceof Gq)for(var J in U._definition.schema)"string"!==typeof U._definition.schema[J]&&U[J]&&U[J].$changes&&q.removeRef(U[J].$changes.refId);else{var Q=U.$changes.parent._definition,s=Q.schema[Q.fieldsByIndex[U.$changes.parentIndex]];"function"===typeof Object.values(s)[0]&&Array.from(U.values()).forEach((function(c){return q.removeRef(c.$changes.refId)}))}q.refs.delete(c),delete q.refCounts[c]}})),this.deletedRefs.clear()},q}(),vq=function(q){function c(){return null!==q&&q.apply(this,arguments)||this}return U(c,q),c}(Error);function Yq(q,c,U,J){var Q,s=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Q="number",isNaN(q)&&console.log('trying to encode "NaN" in '.concat(U.constructor.name,"#").concat(J));break;case"string":Q="string",s=!0;break;case"boolean":return}if(typeof q!==Q&&(!s||s&&null!==q)){var g="'".concat(JSON.stringify(q),"'").concat(q&&q.constructor&&" (".concat(q.constructor.name,")")||"");throw new vq("a '".concat(Q,"' was expected, but ").concat(g," was provided in ").concat(U.constructor.name,"#").concat(J))}}function kq(q,c,U,J){if(!(q instanceof c))throw new vq("a '".concat(c.name,"' was expected, but '").concat(q.constructor.name,"' was provided in ").concat(U.constructor.name,"#").concat(J))}function Vq(q,c,U,J,Q){Yq(U,q,J,Q);var s=f[q];if(!s)throw new vq("a '".concat(q,"' was expected, but ").concat(U," was provided in ").concat(J.constructor.name,"#").concat(Q));s(c,U)}function Oq(q,c,U){return Iq[q](c,U)}var Gq=function(){function c(){for(var q=[],c=0;c<arguments.length;c++)q[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new n(this,void 0,new Fq),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var U=this._definition.descriptors;U&&Object.defineProperties(this,U),q[0]&&this.assign(q[0])}return c.onError=function(q){console.error(q)},c.is=function(q){return q._definition&&void 0!==q._definition.schema},c.prototype.onChange=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,c)},c.prototype.sc=function(c){return W(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,c)},c.prototype.assign=function(q){return Object.assign(this,q),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(q,c){this.$changes.change(q,c)},c.prototype.listen=function(q,c,U){var J=this;return void 0===U&&(U=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[q]||(this.$callbacks[q]=[]),this.$callbacks[q].push(c),U&&void 0!==this[q]&&c(this[q],void 0),function(){return u(J.$callbacks[q],J.$callbacks[q].indexOf(c))}},c.prototype.decode=function(U,J,Q){var s;void 0===J&&(J={offset:0}),void 0===Q&&(Q=this);var X=[],n=this.$changes.root,W=U.length,D=0;for(n.refs.set(D,this);J.offset<W;){var u=U[J.offset++];if(u!=g){var K=Q.$changes,r=void 0!==Q._definition,b=r?u>>6<<6:u;if(b!==q.OPERATION.CLEAR){var o=r?u%(b||255):oq(U,J),a=r?Q._definition.fieldsByIndex[o]:"",R=K.getType(o),I=void 0,t=void 0,C=void 0;if(r?t=Q["_".concat(a)]:(t=Q.getByIndex(o),(b&q.OPERATION.ADD)===q.OPERATION.ADD?(C=Q instanceof h?bq(U,J):o,Q.setIndex(o,C)):C=Q.getIndex(o)),(b&q.OPERATION.DELETE)===q.OPERATION.DELETE&&(b!==q.OPERATION.DELETE_AND_ADD&&Q.deleteByIndex(o),t&&t.$changes&&n.removeRef(t.$changes.refId),I=null),void 0!==a){if(b===q.OPERATION.DELETE);else if(c.is(R)){var i=oq(U,J);if(I=n.refs.get(i),b!==q.OPERATION.REPLACE){var F=this.getSchemaType(U,J,R);I||((I=this.createTypeInstance(F)).$changes.refId=i,t&&(I.$callbacks=t.$callbacks,t.$changes.refId&&i!==t.$changes.refId&&n.removeRef(t.$changes.refId))),n.addRef(i,I,I!==t)}}else if("string"===typeof R)I=Oq(R,U,J);else{var v=p(Object.keys(R)[0]),Y=oq(U,J),k=n.refs.has(Y)?t||n.refs.get(Y):new v.constructor;if((I=k.clone(!0)).$changes.refId=Y,t&&(I.$callbacks=t.$callbacks,t.$changes.refId&&Y!==t.$changes.refId)){n.removeRef(t.$changes.refId);for(var V=t.entries(),O=void 0;(O=V.next())&&!O.done;){var G=(s=O.value)[0],S=s[1];X.push({refId:Y,op:q.OPERATION.DELETE,field:G,value:void 0,previousValue:S})}}n.addRef(Y,I,k!==t)}if(null!==I&&void 0!==I)if(I.$changes&&I.$changes.setParent(K.ref,K.root,o),Q instanceof c)Q[a]=I;else if(Q instanceof h)G=C,Q.$items.set(G,I),Q.$changes.allChanges.add(o);else if(Q instanceof H)Q.setAt(o,I);else if(Q instanceof tq){var Z=Q.add(I);Q.setIndex(o,Z)}else Q instanceof Cq&&!1!==(Z=Q.add(I))&&Q.setIndex(o,Z);t!==I&&X.push({refId:D,op:b,field:a,dynamicIndex:C,value:I,previousValue:t})}else{console.warn("@colyseus/schema: definition mismatch");for(var x={offset:J.offset};J.offset<W&&(!Rq(U,J)||(x.offset=J.offset+1,!n.refs.has(oq(U,x))));)J.offset++}}else Q.clear(X)}else{D=oq(U,J);var z=n.refs.get(D);if(!z)throw new Error('"refId" not found: '.concat(D));Q=z}}return this._triggerChanges(X),n.garbageCollectDeletedRefs(),X},c.prototype.encode=function(U,J,Q){void 0===U&&(U=!1),void 0===J&&(J=[]),void 0===Q&&(Q=!1);for(var s=this.$changes,X=new WeakSet,n=[s],W=1,D=0;D<W;D++){var u=n[D],K=u.ref,r=K instanceof c;u.ensureRefId(),X.add(u),u!==s&&(u.changed||U)&&(S(J,g),j(J,u.refId));for(var H=U?Array.from(u.allChanges):Array.from(u.changes.values()),b=0,o=H.length;b<o;b++){var a=U?{op:q.OPERATION.ADD,index:H[b]}:H[b],R=a.index,I=r?K._definition.fieldsByIndex&&K._definition.fieldsByIndex[R]:R,t=J.length;if(a.op!==q.OPERATION.TOUCH)if(r)S(J,R|a.op);else{if(S(J,a.op),a.op===q.OPERATION.CLEAR)continue;j(J,R)}if(r||(a.op&q.OPERATION.ADD)!=q.OPERATION.ADD||K instanceof h&&l(J,u.ref.$indexes.get(R)),a.op!==q.OPERATION.DELETE){var C=u.getType(R),i=u.getValue(R);if(i&&i.$changes&&!X.has(i.$changes)&&(n.push(i.$changes),i.$changes.ensureRefId(),W++),a.op!==q.OPERATION.TOUCH){if(c.is(C))kq(i,C,K,I),j(J,i.$changes.refId),(a.op&q.OPERATION.ADD)===q.OPERATION.ADD&&this.tryEncodeTypeId(J,C,i.constructor);else if("string"===typeof C)Vq(C,J,i,K,I);else{var F=p(Object.keys(C)[0]);kq(K["_".concat(I)],F.constructor,K,I),j(J,i.$changes.refId)}Q&&u.cache(R,J.slice(t))}}}U||Q||u.discard()}return J},c.prototype.encodeAll=function(q){return this.encode(!0,[],q)},c.prototype.applyFilters=function(U,J){var Q,s;void 0===J&&(J=!1);for(var X=this,n=new Set,W=iq.get(U),D=[this.$changes],u=1,K=[],r=function(r){var H=D[r];if(n.has(H.refId))return"continue";var b=H.ref,o=b instanceof c;S(K,g),j(K,H.refId);var a=W.refIds.has(H),p=J||!a;W.addRefId(H);var R=W.containerIndexes.get(H),I=p?Array.from(H.allChanges):Array.from(H.changes.values());!J&&o&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach((function(c){!R.has(c)&&H.allChanges.has(c)&&(p?I.push(c):I.push({op:q.OPERATION.ADD,index:c}))}));for(var t=0,C=I.length;t<C;t++){var i=p?{op:q.OPERATION.ADD,index:I[t]}:I[t];if(i.op!==q.OPERATION.CLEAR){var F=i.index;if(i.op!==q.OPERATION.DELETE){var v=H.getValue(F),Y=H.getType(F);if(o){if((k=b._definition.filters&&b._definition.filters[F])&&!k.call(b,U,v,X)){v&&v.$changes&&n.add(v.$changes.refId);continue}}else{var k,V=H.parent;if((k=H.getChildrenFilter())&&!k.call(V,U,b.$indexes.get(F),v,X)){v&&v.$changes&&n.add(v.$changes.refId);continue}}if(v.$changes&&(D.push(v.$changes),u++),i.op!==q.OPERATION.TOUCH)if(i.op===q.OPERATION.ADD||o)K.push.apply(K,null!==(Q=H.caches[F])&&void 0!==Q?Q:[]),R.add(F);else if(R.has(F))K.push.apply(K,null!==(s=H.caches[F])&&void 0!==s?s:[]);else{if(R.add(F),S(K,q.OPERATION.ADD),j(K,F),b instanceof h){var O=H.ref.$indexes.get(F);l(K,O)}v.$changes?j(K,v.$changes.refId):f[Y](K,v)}else v.$changes&&!o&&(S(K,q.OPERATION.ADD),j(K,F),b instanceof h&&(O=H.ref.$indexes.get(F),l(K,O)),j(K,v.$changes.refId))}else o?S(K,i.op|F):(S(K,i.op),j(K,F))}else S(K,i.op)}},H=0;H<u;H++)r(H);return K},c.prototype.clone=function(){var q,c=new this.constructor,U=this._definition.schema;for(var J in U)"object"===typeof this[J]&&"function"===typeof(null===(q=this[J])||void 0===q?void 0:q.clone)?c[J]=this[J].clone():c[J]=this[J];return c},c.prototype.toJSON=function(){var q=this._definition.schema,c=this._definition.deprecated,U={};for(var J in q)c[J]||null===this[J]||"undefined"===typeof this[J]||(U[J]="function"===typeof this[J].toJSON?this[J].toJSON():this["_".concat(J)]);return U},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(q){return this[this._definition.fieldsByIndex[q]]},c.prototype.deleteByIndex=function(q){this[this._definition.fieldsByIndex[q]]=void 0},c.prototype.tryEncodeTypeId=function(q,c,U){c._typeid!==U._typeid&&(S(q,X),j(q,U._typeid))},c.prototype.getSchemaType=function(q,c,U){var J;return q[c.offset]===X&&(c.offset++,J=this.constructor._context.get(oq(q,c))),J||U},c.prototype.createTypeInstance=function(q){var c=new q;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(U){for(var J,Q,s,g,X,n,W,D,u,K=new Set,r=this.$changes.root.refs,H=function(H){var b=U[H],h=b.refId,o=r.get(h),a=o.$callbacks;if((b.op&q.OPERATION.DELETE)===q.OPERATION.DELETE&&b.previousValue instanceof c&&(null===(Q=null===(J=b.previousValue.$callbacks)||void 0===J?void 0:J[q.OPERATION.DELETE])||void 0===Q||Q.forEach((function(q){return q()}))),!a)return"continue";if(o instanceof c){if(!K.has(h))try{null===(s=null===a||void 0===a?void 0:a[q.OPERATION.REPLACE])||void 0===s||s.forEach((function(q){return q()}))}catch(p){c.onError(p)}try{a.hasOwnProperty(b.field)&&(null===(g=a[b.field])||void 0===g||g.forEach((function(q){return q(b.value,b.previousValue)})))}catch(p){c.onError(p)}}else b.op===q.OPERATION.ADD&&void 0===b.previousValue?null===(X=a[q.OPERATION.ADD])||void 0===X||X.forEach((function(q){var c;return q(b.value,null!==(c=b.dynamicIndex)&&void 0!==c?c:b.field)})):b.op===q.OPERATION.DELETE?void 0!==b.previousValue&&(null===(n=a[q.OPERATION.DELETE])||void 0===n||n.forEach((function(q){var c;return q(b.previousValue,null!==(c=b.dynamicIndex)&&void 0!==c?c:b.field)}))):b.op===q.OPERATION.DELETE_AND_ADD&&(void 0!==b.previousValue&&(null===(W=a[q.OPERATION.DELETE])||void 0===W||W.forEach((function(q){var c;return q(b.previousValue,null!==(c=b.dynamicIndex)&&void 0!==c?c:b.field)}))),null===(D=a[q.OPERATION.ADD])||void 0===D||D.forEach((function(q){var c;return q(b.value,null!==(c=b.dynamicIndex)&&void 0!==c?c:b.field)}))),b.value!==b.previousValue&&(null===(u=a[q.OPERATION.REPLACE])||void 0===u||u.forEach((function(q){var c;return q(b.value,null!==(c=b.dynamicIndex)&&void 0!==c?c:b.field)})));K.add(h)},b=0;b<U.length;b++)H(b)},c._definition=R.create(),c}();function Sq(q){for(var c=[q.$changes],U=1,J={},Q=J,s=function(q){var U=c[q];U.changes.forEach((function(q){var c=U.ref,J=q.index,s=c._definition?c._definition.fieldsByIndex[J]:c.$indexes.get(J);Q[s]=U.getValue(J)}))},g=0;g<U;g++)s(g);return J}var Zq={context:new t},xq=function(q){function c(){return null!==q&&q.apply(this,arguments)||this}return U(c,q),J([i("string",Zq)],c.prototype,"name",void 0),J([i("string",Zq)],c.prototype,"type",void 0),J([i("number",Zq)],c.prototype,"referencedType",void 0),c}(Gq),zq=function(q){function c(){var c=null!==q&&q.apply(this,arguments)||this;return c.fields=new H,c}return U(c,q),J([i("number",Zq)],c.prototype,"id",void 0),J([i([xq],Zq)],c.prototype,"fields",void 0),c}(Gq),yq=function(q){function c(){var c=null!==q&&q.apply(this,arguments)||this;return c.types=new H,c}return U(c,q),c.encode=function(q){var U=q.constructor,J=new c;J.rootType=U._typeid;var Q=function(q,c){for(var U in c){var Q=new xq;Q.name=U;var s=void 0;if("string"===typeof c[U])s=c[U];else{var g=c[U],X=void 0;Gq.is(g)?(s="ref",X=c[U]):"string"===typeof g[s=Object.keys(g)[0]]?s+=":"+g[s]:X=g[s],Q.referencedType=X?X._typeid:-1}Q.type=s,q.fields.push(Q)}J.types.push(q)},s=U._context.types;for(var g in s){var X=new zq;X.id=Number(g),Q(X,s[g]._definition.schema)}return J.encodeAll()},c.decode=function(q,J){var Q=new t,s=new c;s.decode(q,J);var g=s.types.reduce((function(q,c){var J=function(q){function c(){return null!==q&&q.apply(this,arguments)||this}return U(c,q),c}(Gq),s=c.id;return q[s]=J,Q.add(J,s),q}),{});s.types.forEach((function(q){var c=g[q.id];q.fields.forEach((function(q){var U;if(void 0!==q.referencedType){var J=q.type,s=g[q.referencedType];if(!s){var X=q.type.split(":");J=X[0],s=X[1]}"ref"===J?i(s,{context:Q})(c.prototype,q.name):i(((U={})[J]=s,U),{context:Q})(c.prototype,q.name)}else i(q.type,{context:Q})(c.prototype,q.name)}))}));var X=g[s.rootType],n=new X;for(var W in X._definition.schema){var D=X._definition.schema[W];"string"!==typeof D&&(n[W]="function"===typeof D?new D:new(p(Object.keys(D)[0]).constructor))}return n},J([i([zq],Zq)],c.prototype,"types",void 0),J([i("number",Zq)],c.prototype,"rootType",void 0),c}(Gq);a("map",{constructor:h}),a("array",{constructor:H}),a("set",{constructor:Cq}),a("collection",{constructor:tq}),q.ArraySchema=H,q.CollectionSchema=tq,q.Context=t,q.MapSchema=h,q.Reflection=yq,q.ReflectionField=xq,q.ReflectionType=zq,q.Schema=Gq,q.SchemaDefinition=R,q.SetSchema=Cq,q.decode=Iq,q.defineTypes=k,q.deprecated=Y,q.dumpChanges=Sq,q.encode=f,q.filter=F,q.filterChildren=v,q.hasFilter=I,q.registerType=a,q.type=i,Object.defineProperty(q,"__esModule",{value:!0})}(c)},13058:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13053:(q,c,U)=>{var J=U(13058),Q=U(13067),s=Object.hasOwnProperty,g=Object.create(null);for(var X in J)s.call(J,X)&&(g[J[X]]=X);var n=q.exports={to:{},get:{}};function W(q,c,U){return Math.min(Math.max(c,q),U)}function D(q){var c=Math.round(q).toString(16).toUpperCase();return c.length<2?"0"+c:c}n.get=function(q){var c,U;switch(q.substring(0,3).toLowerCase()){case"hsl":c=n.get.hsl(q),U="hsl";break;case"hwb":c=n.get.hwb(q),U="hwb";break;default:c=n.get.rgb(q),U="rgb"}return c?{model:U,value:c}:null},n.get.rgb=function(q){if(!q)return null;var c,U,Q,g=[0,0,0,1];if(c=q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Q=c[2],c=c[1],U=0;U<3;U++){var X=2*U;g[U]=parseInt(c.slice(X,X+2),16)}Q&&(g[3]=parseInt(Q,16)/255)}else if(c=q.match(/^#([a-f0-9]{3,4})$/i)){for(Q=(c=c[1])[3],U=0;U<3;U++)g[U]=parseInt(c[U]+c[U],16);Q&&(g[3]=parseInt(Q+Q,16)/255)}else if(c=q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(U=0;U<3;U++)g[U]=parseInt(c[U+1],0);c[4]&&(c[5]?g[3]=.01*parseFloat(c[4]):g[3]=parseFloat(c[4]))}else{if(!(c=q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=q.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:s.call(J,c[1])?((g=J[c[1]])[3]=1,g):null:null;for(U=0;U<3;U++)g[U]=Math.round(2.55*parseFloat(c[U+1]));c[4]&&(c[5]?g[3]=.01*parseFloat(c[4]):g[3]=parseFloat(c[4]))}for(U=0;U<3;U++)g[U]=W(g[U],0,255);return g[3]=W(g[3],0,1),g},n.get.hsl=function(q){if(!q)return null;var c=q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var U=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,W(parseFloat(c[2]),0,100),W(parseFloat(c[3]),0,100),W(isNaN(U)?1:U,0,1)]}return null},n.get.hwb=function(q){if(!q)return null;var c=q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var U=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,W(parseFloat(c[2]),0,100),W(parseFloat(c[3]),0,100),W(isNaN(U)?1:U,0,1)]}return null},n.to.hex=function(){var q=Q(arguments);return"#"+D(q[0])+D(q[1])+D(q[2])+(q[3]<1?D(Math.round(255*q[3])):"")},n.to.rgb=function(){var q=Q(arguments);return q.length<4||1===q[3]?"rgb("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+")":"rgba("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+", "+q[3]+")"},n.to.rgb.percent=function(){var q=Q(arguments),c=Math.round(q[0]/255*100),U=Math.round(q[1]/255*100),J=Math.round(q[2]/255*100);return q.length<4||1===q[3]?"rgb("+c+"%, "+U+"%, "+J+"%)":"rgba("+c+"%, "+U+"%, "+J+"%, "+q[3]+")"},n.to.hsl=function(){var q=Q(arguments);return q.length<4||1===q[3]?"hsl("+q[0]+", "+q[1]+"%, "+q[2]+"%)":"hsla("+q[0]+", "+q[1]+"%, "+q[2]+"%, "+q[3]+")"},n.to.hwb=function(){var q=Q(arguments),c="";return q.length>=4&&1!==q[3]&&(c=", "+q[3]),"hwb("+q[0]+", "+q[1]+"%, "+q[2]+"%"+c+")"},n.to.keyword=function(q){return g[q.slice(0,3)]}},13050:(q,c,U)=>{const J=U(13053),Q=U(13072),s=["keyword","gray","hex"],g={};for(const r of Object.keys(Q))g[[...Q[r].labels].sort().join("")]=r;const X={};function n(q,c){if(!(this instanceof n))return new n(q,c);if(c&&c in s&&(c=null),c&&!(c in Q))throw new Error("Unknown model: "+c);let U,W;if(null==q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof n)this.model=q.model,this.color=[...q.color],this.valpha=q.valpha;else if("string"===typeof q){const c=J.get(q);if(null===c)throw new Error("Unable to parse color from string: "+q);this.model=c.model,W=Q[this.model].channels,this.color=c.value.slice(0,W),this.valpha="number"===typeof c.value[W]?c.value[W]:1}else if(q.length>0){this.model=c||"rgb",W=Q[this.model].channels;const U=Array.prototype.slice.call(q,0,W);this.color=K(U,W),this.valpha="number"===typeof q[W]?q[W]:1}else if("number"===typeof q)this.model="rgb",this.color=[q>>16&255,q>>8&255,255&q],this.valpha=1;else{this.valpha=1;const c=Object.keys(q);"alpha"in q&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);const J=c.sort().join("");if(!(J in g))throw new Error("Unable to parse color from object: "+JSON.stringify(q));this.model=g[J];const{labels:s}=Q[this.model],X=[];for(U=0;U<s.length;U++)X.push(q[s[U]]);this.color=K(X)}if(X[this.model])for(W=Q[this.model].channels,U=0;U<W;U++){const q=X[this.model][U];q&&(this.color[U]=q(this.color[U]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}n.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(q){let c=this.model in J.to?this:this.rgb();c=c.round("number"===typeof q?q:1);const U=1===c.valpha?c.color:[...c.color,this.valpha];return J.to[c.model](U)},percentString(q){const c=this.rgb().round("number"===typeof q?q:1),U=1===c.valpha?c.color:[...c.color,this.valpha];return J.to.rgb.percent(U)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const q={},{channels:c}=Q[this.model],{labels:U}=Q[this.model];for(let J=0;J<c;J++)q[U[J]]=this.color[J];return 1!==this.valpha&&(q.alpha=this.valpha),q},unitArray(){const q=this.rgb().color;return q[0]/=255,q[1]/=255,q[2]/=255,1!==this.valpha&&q.push(this.valpha),q},unitObject(){const q=this.rgb().object();return q.r/=255,q.g/=255,q.b/=255,1!==this.valpha&&(q.alpha=this.valpha),q},round(q){return q=Math.max(q||0,0),new n([...this.color.map(W(q)),this.valpha],this.model)},alpha(q){return void 0!==q?new n([...this.color,Math.max(0,Math.min(1,q))],this.model):this.valpha},red:D("rgb",0,u(255)),green:D("rgb",1,u(255)),blue:D("rgb",2,u(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,(q=>(q%360+360)%360)),saturationl:D("hsl",1,u(100)),lightness:D("hsl",2,u(100)),saturationv:D("hsv",1,u(100)),value:D("hsv",2,u(100)),chroma:D("hcg",1,u(100)),gray:D("hcg",2,u(100)),white:D("hwb",1,u(100)),wblack:D("hwb",2,u(100)),cyan:D("cmyk",0,u(100)),magenta:D("cmyk",1,u(100)),yellow:D("cmyk",2,u(100)),black:D("cmyk",3,u(100)),x:D("xyz",0,u(95.047)),y:D("xyz",1,u(100)),z:D("xyz",2,u(108.833)),l:D("lab",0,u(100)),a:D("lab",1),b:D("lab",2),keyword(q){return void 0!==q?new n(q):Q[this.model].keyword(this.color)},hex(q){return void 0!==q?new n(q):J.to.hex(this.rgb().round().color)},hexa(q){if(void 0!==q)return new n(q);const c=this.rgb().round().color;let U=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===U.length&&(U="0"+U),J.to.hex(c)+U},rgbNumber(){const q=this.rgb().color;return(255&q[0])<<16|(255&q[1])<<8|255&q[2]},luminosity(){const q=this.rgb().color,c=[];for(const[U,J]of q.entries()){const q=J/255;c[U]=q<=.04045?q/12.92:((q+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(q){const c=this.luminosity(),U=q.luminosity();return c>U?(c+.05)/(U+.05):(U+.05)/(c+.05)},level(q){const c=this.contrast(q);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const q=this.rgb().color;return(2126*q[0]+7152*q[1]+722*q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const q=this.rgb();for(let c=0;c<3;c++)q.color[c]=255-q.color[c];return q},lighten(q){const c=this.hsl();return c.color[2]+=c.color[2]*q,c},darken(q){const c=this.hsl();return c.color[2]-=c.color[2]*q,c},saturate(q){const c=this.hsl();return c.color[1]+=c.color[1]*q,c},desaturate(q){const c=this.hsl();return c.color[1]-=c.color[1]*q,c},whiten(q){const c=this.hwb();return c.color[1]+=c.color[1]*q,c},blacken(q){const c=this.hwb();return c.color[2]+=c.color[2]*q,c},grayscale(){const q=this.rgb().color,c=.3*q[0]+.59*q[1]+.11*q[2];return n.rgb(c,c,c)},fade(q){return this.alpha(this.valpha-this.valpha*q)},opaquer(q){return this.alpha(this.valpha+this.valpha*q)},rotate(q){const c=this.hsl();let U=c.color[0];return U=(U+q)%360,U=U<0?360+U:U,c.color[0]=U,c},mix(q,c){if(!q||!q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof q);const U=q.rgb(),J=this.rgb(),Q=void 0===c?.5:c,s=2*Q-1,g=U.alpha()-J.alpha(),X=((s*g===-1?s:(s+g)/(1+s*g))+1)/2,W=1-X;return n.rgb(X*U.red()+W*J.red(),X*U.green()+W*J.green(),X*U.blue()+W*J.blue(),U.alpha()*Q+J.alpha()*(1-Q))}};for(const r of Object.keys(Q)){if(s.includes(r))continue;const{channels:q}=Q[r];n.prototype[r]=function(){if(this.model===r)return new n(this);for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];return c.length>0?new n(c,r):new n([...(J=Q[this.model][r].raw(this.color),Array.isArray(J)?J:[J]),this.valpha],r);var J},n[r]=function(){for(var c=arguments.length,U=new Array(c),J=0;J<c;J++)U[J]=arguments[J];let Q=U[0];return"number"===typeof Q&&(Q=K(U,q)),new n(Q,r)}}function W(q){return function(c){return function(q,c){return Number(q.toFixed(c))}(c,q)}}function D(q,c,U){q=Array.isArray(q)?q:[q];for(const J of q)(X[J]||(X[J]=[]))[c]=U;return q=q[0],function(J){let Q;return void 0!==J?(U&&(J=U(J)),Q=this[q](),Q.color[c]=J,Q):(Q=this[q]().color[c],U&&(Q=U(Q)),Q)}}function u(q){return function(c){return Math.max(0,Math.min(q,c))}}function K(q,c){for(let U=0;U<c;U++)"number"!==typeof q[U]&&(q[U]=0);return q}q.exports=n},13078:(q,c,U)=>{const J=U(13083),Q={};for(const g of Object.keys(J))Q[J[g]]=g;const s={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};q.exports=s;for(const g of Object.keys(s)){if(!("channels"in s[g]))throw new Error("missing channels property: "+g);if(!("labels"in s[g]))throw new Error("missing channel labels property: "+g);if(s[g].labels.length!==s[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:q,labels:c}=s[g];delete s[g].channels,delete s[g].labels,Object.defineProperty(s[g],"channels",{value:q}),Object.defineProperty(s[g],"labels",{value:c})}s.rgb.hsl=function(q){const c=q[0]/255,U=q[1]/255,J=q[2]/255,Q=Math.min(c,U,J),s=Math.max(c,U,J),g=s-Q;let X,n;s===Q?X=0:c===s?X=(U-J)/g:U===s?X=2+(J-c)/g:J===s&&(X=4+(c-U)/g),X=Math.min(60*X,360),X<0&&(X+=360);const W=(Q+s)/2;return n=s===Q?0:W<=.5?g/(s+Q):g/(2-s-Q),[X,100*n,100*W]},s.rgb.hsv=function(q){let c,U,J,Q,s;const g=q[0]/255,X=q[1]/255,n=q[2]/255,W=Math.max(g,X,n),D=W-Math.min(g,X,n),u=function(q){return(W-q)/6/D+.5};return 0===D?(Q=0,s=0):(s=D/W,c=u(g),U=u(X),J=u(n),g===W?Q=J-U:X===W?Q=1/3+c-J:n===W&&(Q=2/3+U-c),Q<0?Q+=1:Q>1&&(Q-=1)),[360*Q,100*s,100*W]},s.rgb.hwb=function(q){const c=q[0],U=q[1];let J=q[2];const Q=s.rgb.hsl(q)[0],g=1/255*Math.min(c,Math.min(U,J));return J=1-1/255*Math.max(c,Math.max(U,J)),[Q,100*g,100*J]},s.rgb.cmyk=function(q){const c=q[0]/255,U=q[1]/255,J=q[2]/255,Q=Math.min(1-c,1-U,1-J);return[100*((1-c-Q)/(1-Q)||0),100*((1-U-Q)/(1-Q)||0),100*((1-J-Q)/(1-Q)||0),100*Q]},s.rgb.keyword=function(q){const c=Q[q];if(c)return c;let U,s=1/0;for(const Q of Object.keys(J)){const c=J[Q],n=(X=c,((g=q)[0]-X[0])**2+(g[1]-X[1])**2+(g[2]-X[2])**2);n<s&&(s=n,U=Q)}var g,X;return U},s.keyword.rgb=function(q){return J[q]},s.rgb.xyz=function(q){let c=q[0]/255,U=q[1]/255,J=q[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92;return[100*(.4124*c+.3576*U+.1805*J),100*(.2126*c+.7152*U+.0722*J),100*(.0193*c+.1192*U+.9505*J)]},s.rgb.lab=function(q){const c=s.rgb.xyz(q);let U=c[0],J=c[1],Q=c[2];U/=95.047,J/=100,Q/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*J-16,500*(U-J),200*(J-Q)]},s.hsl.rgb=function(q){const c=q[0]/360,U=q[1]/100,J=q[2]/100;let Q,s,g;if(0===U)return g=255*J,[g,g,g];Q=J<.5?J*(1+U):J+U-J*U;const X=2*J-Q,n=[0,0,0];for(let W=0;W<3;W++)s=c+1/3*-(W-1),s<0&&s++,s>1&&s--,g=6*s<1?X+6*(Q-X)*s:2*s<1?Q:3*s<2?X+(Q-X)*(2/3-s)*6:X,n[W]=255*g;return n},s.hsl.hsv=function(q){const c=q[0];let U=q[1]/100,J=q[2]/100,Q=U;const s=Math.max(J,.01);J*=2,U*=J<=1?J:2-J,Q*=s<=1?s:2-s;return[c,100*(0===J?2*Q/(s+Q):2*U/(J+U)),100*((J+U)/2)]},s.hsv.rgb=function(q){const c=q[0]/60,U=q[1]/100;let J=q[2]/100;const Q=Math.floor(c)%6,s=c-Math.floor(c),g=255*J*(1-U),X=255*J*(1-U*s),n=255*J*(1-U*(1-s));switch(J*=255,Q){case 0:return[J,n,g];case 1:return[X,J,g];case 2:return[g,J,n];case 3:return[g,X,J];case 4:return[n,g,J];case 5:return[J,g,X]}},s.hsv.hsl=function(q){const c=q[0],U=q[1]/100,J=q[2]/100,Q=Math.max(J,.01);let s,g;g=(2-U)*J;const X=(2-U)*Q;return s=U*Q,s/=X<=1?X:2-X,s=s||0,g/=2,[c,100*s,100*g]},s.hwb.rgb=function(q){const c=q[0]/360;let U=q[1]/100,J=q[2]/100;const Q=U+J;let s;Q>1&&(U/=Q,J/=Q);const g=Math.floor(6*c),X=1-J;s=6*c-g,0!==(1&g)&&(s=1-s);const n=U+s*(X-U);let W,D,u;switch(g){default:case 6:case 0:W=X,D=n,u=U;break;case 1:W=n,D=X,u=U;break;case 2:W=U,D=X,u=n;break;case 3:W=U,D=n,u=X;break;case 4:W=n,D=U,u=X;break;case 5:W=X,D=U,u=n}return[255*W,255*D,255*u]},s.cmyk.rgb=function(q){const c=q[0]/100,U=q[1]/100,J=q[2]/100,Q=q[3]/100;return[255*(1-Math.min(1,c*(1-Q)+Q)),255*(1-Math.min(1,U*(1-Q)+Q)),255*(1-Math.min(1,J*(1-Q)+Q))]},s.xyz.rgb=function(q){const c=q[0]/100,U=q[1]/100,J=q[2]/100;let Q,s,g;return Q=3.2406*c+-1.5372*U+-.4986*J,s=-.9689*c+1.8758*U+.0415*J,g=.0557*c+-.204*U+1.057*J,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,Q=Math.min(Math.max(0,Q),1),s=Math.min(Math.max(0,s),1),g=Math.min(Math.max(0,g),1),[255*Q,255*s,255*g]},s.xyz.lab=function(q){let c=q[0],U=q[1],J=q[2];c/=95.047,U/=100,J/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,U=U>.008856?U**(1/3):7.787*U+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*U-16,500*(c-U),200*(U-J)]},s.lab.xyz=function(q){let c,U,J;U=(q[0]+16)/116,c=q[1]/500+U,J=U-q[2]/200;const Q=U**3,s=c**3,g=J**3;return U=Q>.008856?Q:(U-16/116)/7.787,c=s>.008856?s:(c-16/116)/7.787,J=g>.008856?g:(J-16/116)/7.787,c*=95.047,U*=100,J*=108.883,[c,U,J]},s.lab.lch=function(q){const c=q[0],U=q[1],J=q[2];let Q;Q=360*Math.atan2(J,U)/2/Math.PI,Q<0&&(Q+=360);return[c,Math.sqrt(U*U+J*J),Q]},s.lch.lab=function(q){const c=q[0],U=q[1],J=q[2]/360*2*Math.PI;return[c,U*Math.cos(J),U*Math.sin(J)]},s.rgb.ansi16=function(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[U,J,Q]=q;let g=null===c?s.rgb.hsv(q)[2]:c;if(g=Math.round(g/50),0===g)return 30;let X=30+(Math.round(Q/255)<<2|Math.round(J/255)<<1|Math.round(U/255));return 2===g&&(X+=60),X},s.hsv.ansi16=function(q){return s.rgb.ansi16(s.hsv.rgb(q),q[2])},s.rgb.ansi256=function(q){const c=q[0],U=q[1],J=q[2];if(c===U&&U===J)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(U/255*5)+Math.round(J/255*5)},s.ansi16.rgb=function(q){let c=q%10;if(0===c||7===c)return q>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const U=.5*(1+~~(q>50));return[(1&c)*U*255,(c>>1&1)*U*255,(c>>2&1)*U*255]},s.ansi256.rgb=function(q){if(q>=232){const c=10*(q-232)+8;return[c,c,c]}let c;q-=16;return[Math.floor(q/36)/5*255,Math.floor((c=q%36)/6)/5*255,c%6/5*255]},s.rgb.hex=function(q){const c=(((255&Math.round(q[0]))<<16)+((255&Math.round(q[1]))<<8)+(255&Math.round(q[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},s.hex.rgb=function(q){const c=q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let U=c[0];3===c[0].length&&(U=U.split("").map((q=>q+q)).join(""));const J=parseInt(U,16);return[J>>16&255,J>>8&255,255&J]},s.rgb.hcg=function(q){const c=q[0]/255,U=q[1]/255,J=q[2]/255,Q=Math.max(Math.max(c,U),J),s=Math.min(Math.min(c,U),J),g=Q-s;let X,n;return X=g<1?s/(1-g):0,n=g<=0?0:Q===c?(U-J)/g%6:Q===U?2+(J-c)/g:4+(c-U)/g,n/=6,n%=1,[360*n,100*g,100*X]},s.hsl.hcg=function(q){const c=q[1]/100,U=q[2]/100,J=U<.5?2*c*U:2*c*(1-U);let Q=0;return J<1&&(Q=(U-.5*J)/(1-J)),[q[0],100*J,100*Q]},s.hsv.hcg=function(q){const c=q[1]/100,U=q[2]/100,J=c*U;let Q=0;return J<1&&(Q=(U-J)/(1-J)),[q[0],100*J,100*Q]},s.hcg.rgb=function(q){const c=q[0]/360,U=q[1]/100,J=q[2]/100;if(0===U)return[255*J,255*J,255*J];const Q=[0,0,0],s=c%1*6,g=s%1,X=1-g;let n=0;switch(Math.floor(s)){case 0:Q[0]=1,Q[1]=g,Q[2]=0;break;case 1:Q[0]=X,Q[1]=1,Q[2]=0;break;case 2:Q[0]=0,Q[1]=1,Q[2]=g;break;case 3:Q[0]=0,Q[1]=X,Q[2]=1;break;case 4:Q[0]=g,Q[1]=0,Q[2]=1;break;default:Q[0]=1,Q[1]=0,Q[2]=X}return n=(1-U)*J,[255*(U*Q[0]+n),255*(U*Q[1]+n),255*(U*Q[2]+n)]},s.hcg.hsv=function(q){const c=q[1]/100,U=c+q[2]/100*(1-c);let J=0;return U>0&&(J=c/U),[q[0],100*J,100*U]},s.hcg.hsl=function(q){const c=q[1]/100,U=q[2]/100*(1-c)+.5*c;let J=0;return U>0&&U<.5?J=c/(2*U):U>=.5&&U<1&&(J=c/(2*(1-U))),[q[0],100*J,100*U]},s.hcg.hwb=function(q){const c=q[1]/100,U=c+q[2]/100*(1-c);return[q[0],100*(U-c),100*(1-U)]},s.hwb.hcg=function(q){const c=q[1]/100,U=1-q[2]/100,J=U-c;let Q=0;return J<1&&(Q=(U-J)/(1-J)),[q[0],100*J,100*Q]},s.apple.rgb=function(q){return[q[0]/65535*255,q[1]/65535*255,q[2]/65535*255]},s.rgb.apple=function(q){return[q[0]/255*65535,q[1]/255*65535,q[2]/255*65535]},s.gray.rgb=function(q){return[q[0]/100*255,q[0]/100*255,q[0]/100*255]},s.gray.hsl=function(q){return[0,0,q[0]]},s.gray.hsv=s.gray.hsl,s.gray.hwb=function(q){return[0,100,q[0]]},s.gray.cmyk=function(q){return[0,0,0,q[0]]},s.gray.lab=function(q){return[q[0],0,0]},s.gray.hex=function(q){const c=255&Math.round(q[0]/100*255),U=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(U.length)+U},s.rgb.gray=function(q){return[(q[0]+q[1]+q[2])/3/255*100]}},13072:(q,c,U)=>{const J=U(13078),Q=U(13087),s={};Object.keys(J).forEach((q=>{s[q]={},Object.defineProperty(s[q],"channels",{value:J[q].channels}),Object.defineProperty(s[q],"labels",{value:J[q].labels});const c=Q(q);Object.keys(c).forEach((U=>{const J=c[U];s[q][U]=function(q){const c=function(){for(var c=arguments.length,U=new Array(c),J=0;J<c;J++)U[J]=arguments[J];const Q=U[0];if(void 0===Q||null===Q)return Q;Q.length>1&&(U=Q);const s=q(U);if("object"===typeof s)for(let q=s.length,g=0;g<q;g++)s[g]=Math.round(s[g]);return s};return"conversion"in q&&(c.conversion=q.conversion),c}(J),s[q][U].raw=function(q){const c=function(){for(var c=arguments.length,U=new Array(c),J=0;J<c;J++)U[J]=arguments[J];const Q=U[0];return void 0===Q||null===Q?Q:(Q.length>1&&(U=Q),q(U))};return"conversion"in q&&(c.conversion=q.conversion),c}(J)}))})),q.exports=s},13087:(q,c,U)=>{const J=U(13078);function Q(q){const c=function(){const q={},c=Object.keys(J);for(let U=c.length,J=0;J<U;J++)q[c[J]]={distance:-1,parent:null};return q}(),U=[q];for(c[q].distance=0;U.length;){const q=U.pop(),Q=Object.keys(J[q]);for(let J=Q.length,s=0;s<J;s++){const J=Q[s],g=c[J];-1===g.distance&&(g.distance=c[q].distance+1,g.parent=q,U.unshift(J))}}return c}function s(q,c){return function(U){return c(q(U))}}function g(q,c){const U=[c[q].parent,q];let Q=J[c[q].parent][q],g=c[q].parent;for(;c[g].parent;)U.unshift(c[g].parent),Q=s(J[c[g].parent][g],Q),g=c[g].parent;return Q.conversion=U,Q}q.exports=function(q){const c=Q(q),U={},J=Object.keys(c);for(let Q=J.length,s=0;s<Q;s++){const q=J[s];null!==c[q].parent&&(U[q]=g(q,c))}return U}},13083:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11637:function(q,c,U){"use strict";var J=this&&this.__createBinding||(Object.create?function(q,c,U,J){void 0===J&&(J=U);var Q=Object.getOwnPropertyDescriptor(c,U);Q&&!("get"in Q?!c.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return c[U]}}),Object.defineProperty(q,J,Q)}:function(q,c,U,J){void 0===J&&(J=U),q[J]=c[U]}),Q=this&&this.__setModuleDefault||(Object.create?function(q,c){Object.defineProperty(q,"default",{enumerable:!0,value:c})}:function(q,c){q.default=c}),s=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var c={};if(null!=q)for(var U in q)"default"!==U&&Object.prototype.hasOwnProperty.call(q,U)&&J(c,q,U);return Q(c,q),c},g=this&&this.__awaiter||function(q,c,U,J){return new(U||(U=Promise))((function(Q,s){function g(q){try{n(J.next(q))}catch(c){s(c)}}function X(q){try{n(J.throw(q))}catch(c){s(c)}}function n(q){var c;q.done?Q(q.value):(c=q.value,c instanceof U?c:new U((function(q){q(c)}))).then(g,X)}n((J=J.apply(q,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=c.Platform=void 0;const X=s(U(11571)),n=U(11645),W="colyseus-auth-token";!function(q){q.ios="ios",q.android="android"}(c.Platform||(c.Platform={}));c.Auth=class{constructor(q){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=q.replace("ws","http"),(0,n.getItem)(W,(q=>this.token=q))}get hasToken(){return!!this.token}login(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g(this,void 0,void 0,(function*(){const c=Object.assign({},q);this.hasToken&&(c.token=this.token);const U=yield this.request("post","/auth",c);this.token=U.token,(0,n.setItem)(W,this.token);for(let q in U)this.hasOwnProperty(q)&&(this[q]=U[q]);return this.registerPingService(),this}))}save(){return g(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(q){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:q})}))}acceptFriendRequest(q){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:q})}))}declineFriendRequest(q){return g(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:q})}))}blockUser(q){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:q})}))}unblockUser(q){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:q})}))}request(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return g(this,void 0,void 0,(function*(){Q.Accept="application/json",this.hasToken&&(Q.Authorization="Bearer "+this.token);const s=[];for(const q in U)s.push(`${q}=${U[q]}`);const g=s.length>0?`?${s.join("&")}`:"",n={headers:Q};return J&&(n.body=J),(yield X[q](`${this.endpoint}${c}${g}`,n)).data}))}logout(){this.token=void 0,(0,n.removeItem)(W),this.unregisterPingService()}registerPingService(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),q)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11562:function(q,c,U){"use strict";var J,Q=this&&this.__awaiter||function(q,c,U,J){return new(U||(U=Promise))((function(Q,s){function g(q){try{n(J.next(q))}catch(c){s(c)}}function X(q){try{n(J.throw(q))}catch(c){s(c)}}function n(q){var c;q.done?Q(q.value):(c=q.value,c instanceof U?c:new U((function(q){q(c)}))).then(g,X)}n((J=J.apply(q,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const s=U(11571),g=U(11576),X=U(11581);class n extends Error{constructor(q,c){super(q),this.code=c,Object.setPrototypeOf(this,n.prototype)}}c.MatchMakeError=n;const W="undefined"!==typeof window&&"undefined"!==typeof(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;if("string"===typeof q){const c=new URL(q),U="https:"===c.protocol||"wss:"===c.protocol,J=Number(c.port||(U?443:80));this.settings={hostname:c.hostname,pathname:"/"!==c.pathname?c.pathname:"",port:J,secure:U}}else void 0===q.port&&(q.port=q.secure?443:80),void 0===q.pathname&&(q.pathname=""),this.settings=q}joinOrCreate(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",q,c,U)}))}create(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",q,c,U)}))}join(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",q,c,U)}))}joinById(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",q,c,U)}))}reconnect(q,c){return Q(this,void 0,void 0,(function*(){if("string"===typeof q&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[U,J]=q.split(":");return yield this.createMatchMakeRequest("reconnect",U,{reconnectionToken:J},c)}))}getAvailableRooms(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Q(this,void 0,void 0,(function*(){return(yield(0,s.get)(this.getHttpEndpoint(`${q}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(q,c,U){return Q(this,void 0,void 0,(function*(){const J=this.createRoom(q.room.name,c);J.roomId=q.room.roomId,J.sessionId=q.sessionId;const s={sessionId:J.sessionId};q.reconnectionToken&&(s.reconnectionToken=q.reconnectionToken);const X=U||J;return J.connect(this.buildEndpoint(q.room,s),q.devMode&&(()=>Q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${J.roomId}'...`);let U=0;const s=()=>Q(this,void 0,void 0,(function*(){U++;try{yield this.consumeSeatReservation(q,c,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${J.roomId}'`)}catch(Q){U<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${U} out of 8)`),setTimeout(s,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(s,2e3)}))),X),new Promise(((q,c)=>{const U=(q,U)=>c(new g.ServerError(q,U));X.onError.once(U),X.onJoin.once((()=>{X.onError.remove(U),q(X)}))}))}))}createMatchMakeRequest(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;return Q(this,void 0,void 0,(function*(){const Q=(yield(0,s.post)(this.getHttpEndpoint(`${q}/${c}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(U)})).data;if(Q.error)throw new n(Q.error,Q.code);return"reconnect"===q&&(Q.reconnectionToken=U.reconnectionToken),yield this.consumeSeatReservation(Q,J,g)}))}createRoom(q,c){return new X.Room(q,c)}buildEndpoint(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const U=[];for(const Q in c)c.hasOwnProperty(Q)&&U.push(`${Q}=${c[Q]}`);let J=this.settings.secure?"wss://":"ws://";return q.publicAddress?J+=`${q.publicAddress}`:J+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${J}/${q.processId}/${q.roomId}?${U.join("&")}`}getHttpEndpoint(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${q}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11587:(q,c,U)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const J=U(11594);c.Connection=class{constructor(){this.events={},this.transport=new J.WebSocketTransport(this.events)}send(q){this.transport.send(q)}connect(q){this.transport.connect(q)}close(q,c){this.transport.close(q,c)}get isOpen(){return this.transport.isOpen}}},11608:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(q){q[q.HANDSHAKE=9]="HANDSHAKE",q[q.JOIN_ROOM=10]="JOIN_ROOM",q[q.ERROR=11]="ERROR",q[q.LEAVE_ROOM=12]="LEAVE_ROOM",q[q.ROOM_DATA=13]="ROOM_DATA",q[q.ROOM_STATE=14]="ROOM_STATE",q[q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",q[q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",q[q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(q){q[q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",q[q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",q[q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",q[q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",q[q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",q[q.AUTH_FAILED=4215]="AUTH_FAILED",q[q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(q,c){const U=q[c++];for(var J="",Q=0,s=c,g=c+U;s<g;s++){var X=q[s];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(Q=(7&X)<<18|(63&q[++s])<<12|(63&q[++s])<<6|63&q[++s])>=65536?(Q-=65536,J+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):J+=String.fromCharCode(Q)}else J+=String.fromCharCode((15&X)<<12|(63&q[++s])<<6|63&q[++s]);else J+=String.fromCharCode((31&X)<<6|63&q[++s]);else J+=String.fromCharCode(X)}return J},c.utf8Length=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,U=0;for(let J=0,Q=q.length;J<Q;J++)c=q.charCodeAt(J),c<128?U+=1:c<2048?U+=2:c<55296||c>=57344?U+=3:(J++,U+=4);return U+1}},11581:function(q,c,U){"use strict";var J=this&&this.__createBinding||(Object.create?function(q,c,U,J){void 0===J&&(J=U);var Q=Object.getOwnPropertyDescriptor(c,U);Q&&!("get"in Q?!c.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return c[U]}}),Object.defineProperty(q,J,Q)}:function(q,c,U,J){void 0===J&&(J=U),q[J]=c[U]}),Q=this&&this.__setModuleDefault||(Object.create?function(q,c){Object.defineProperty(q,"default",{enumerable:!0,value:c})}:function(q,c){q.default=c}),s=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var c={};if(null!=q)for(var U in q)"default"!==U&&Object.prototype.hasOwnProperty.call(q,U)&&J(c,q,U);return Q(c,q),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const g=s(U(11585)),X=U(11587),n=U(11608),W=U(11613),D=U(11622),u=U(11627),K=U(11634),r=U(11576);class H{constructor(q,c){this.onStateChange=(0,u.createSignal)(),this.onError=(0,u.createSignal)(),this.onLeave=(0,u.createSignal)(),this.onJoin=(0,u.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,D.createNanoEvents)(),this.roomId=null,this.name=q,c&&(this.serializer=new((0,W.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((q,c)=>{var U;return null===(U=console.warn)||void 0===U?void 0:U.call(console,`colyseus.js - onError => (${q}) ${c}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const J=new X.Connection;U.connection=J,J.events.onmessage=H.prototype.onMessageCallback.bind(U),J.events.onclose=function(q){var J;if(!U.hasJoined)return null===(J=console.warn)||void 0===J||J.call(console,`Room connection was closed unexpectedly (${q.code}): ${q.reason}`),void U.onError.invoke(q.code,q.reason);q.code===r.CloseCode.DEVMODE_RESTART&&c?c():(U.onLeave.invoke(q.code),U.destroy())},J.events.onerror=function(q){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${q.code}): ${q.reason}`),U.onError.invoke(q.code,q.reason)},J.connect(q)}leave(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((q=>c(q))),this.connection?q?this.connection.send([n.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(r.CloseCode.CONSENTED)}))}onMessage(q,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(q),c)}send(q,c){const U=[n.Protocol.ROOM_DATA];let J;if("string"===typeof q?K.encode.string(U,q):K.encode.number(U,q),void 0!==c){const q=g.encode(c);J=new Uint8Array(U.length+q.byteLength),J.set(new Uint8Array(U),0),J.set(new Uint8Array(q),U.length)}else J=new Uint8Array(U);this.connection.send(J.buffer)}sendBytes(q,c){const U=[n.Protocol.ROOM_DATA_BYTES];let J;"string"===typeof q?K.encode.string(U,q):K.encode.number(U,q),J=new Uint8Array(U.length+(c.byteLength||c.length)),J.set(new Uint8Array(U),0),J.set(new Uint8Array(c),U.length),this.connection.send(J.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(q){const c=Array.from(new Uint8Array(q.data)),U=c[0];if(U===n.Protocol.JOIN_ROOM){let q=1;const U=(0,n.utf8Read)(c,q);if(q+=(0,n.utf8Length)(U),this.serializerId=(0,n.utf8Read)(c,q),q+=(0,n.utf8Length)(this.serializerId),!this.serializer){const q=(0,W.getSerializer)(this.serializerId);this.serializer=new q}c.length>q&&this.serializer.handshake&&this.serializer.handshake(c,{offset:q}),this.reconnectionToken=`${this.roomId}:${U}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([n.Protocol.JOIN_ROOM])}else if(U===n.Protocol.ERROR){const q={offset:1},U=K.decode.number(c,q),J=K.decode.string(c,q);this.onError.invoke(U,J)}else if(U===n.Protocol.LEAVE_ROOM)this.leave();else if(U===n.Protocol.ROOM_DATA_SCHEMA){const q={offset:1},U=this.serializer.getState().constructor._context.get(K.decode.number(c,q)),J=new U;J.decode(c,q),this.dispatchMessage(U,J)}else if(U===n.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(U===n.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(U===n.Protocol.ROOM_DATA){const U={offset:1},J=K.decode.stringCheck(c,U)?K.decode.string(c,U):K.decode.number(c,U),Q=c.length>U.offset?g.decode(q.data,U.offset):void 0;this.dispatchMessage(J,Q)}else if(U===n.Protocol.ROOM_DATA_BYTES){const q={offset:1},U=K.decode.stringCheck(c,q)?K.decode.string(c,q):K.decode.number(c,q);this.dispatchMessage(U,new Uint8Array(c.slice(q.offset)))}}setState(q){this.serializer.setState(q),this.onStateChange.invoke(this.serializer.getState())}patch(q){this.serializer.patch(q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(q,c){var U;const J=this.getMessageHandlerKey(q);this.onMessageHandlers.events[J]?this.onMessageHandlers.emit(J,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",q,c):null===(U=console.warn)||void 0===U||U.call(console,`colyseus.js: onMessage() not registered for type '${q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(q){switch(typeof q){case"function":return`$${q._typeid}`;case"string":return q;case"number":return`i${q}`;default:throw new Error("invalid message type.")}}}c.Room=H},11645:(q,c)=>{"use strict";let U;function J(){return U||(U="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(q,c){this.cache[q]=c},getItem:function(q){this.cache[q]},removeItem:function(q){delete this.cache[q]}}),U}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(q,c){J().setItem(q,c)},c.removeItem=function(q){J().removeItem(q)},c.getItem=function(q,c){const U=J().getItem(q);"undefined"!==typeof Promise&&U instanceof Promise?U.then((q=>c(q))):c(U)}},11622:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(q){let c=this.events[q]||[];for(var U=arguments.length,J=new Array(U>1?U-1:0),Q=1;Q<U;Q++)J[Q-1]=arguments[Q];for(let s=0,g=c.length;s<g;s++)c[s](...J)},events:{},on(q,c){var U;return(null===(U=this.events[q])||void 0===U?void 0:U.push(c))||(this.events[q]=[c]),()=>{var U;this.events[q]=null===(U=this.events[q])||void 0===U?void 0:U.filter((q=>c!==q))}}})},11627:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class U{constructor(){this.handlers=[]}register(q){return this.handlers.push(q),this}invoke(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];this.handlers.forEach((q=>q.apply(this,c)))}invokeAsync(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];return Promise.all(this.handlers.map((q=>q.apply(this,c))))}remove(q){const c=this.handlers.indexOf(q);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=U,c.createSignal=function(){const q=new U;function c(c){return q.register(c,null===this)}return c.once=c=>{const U=function(){for(var J=arguments.length,Q=new Array(J),s=0;s<J;s++)Q[s]=arguments[s];c.apply(this,Q),q.remove(U)};q.register(U)},c.remove=c=>q.remove(c),c.invoke=function(){return q.invoke(...arguments)},c.invokeAsync=function(){return q.invokeAsync(...arguments)},c.clear=()=>q.clear(),c}},11576:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(q){q[q.CONSENTED=4e3]="CONSENTED",q[q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class U extends Error{constructor(q,c){super(c),this.name="ServerError",this.code=q}}c.ServerError=U},11556:(q,c,U)=>{"use strict";c.c=void 0,U(11560);var J=U(11562);Object.defineProperty(c,"c",{enumerable:!0,get:function(){return J.Client}});var Q=U(11608);var s=U(11581);var g=U(11637);const X=U(11648);const n=U(11655),W=U(11613);(0,W.registerSerializer)("schema",X.SchemaSerializer),(0,W.registerSerializer)("none",n.NoneSerializer)},11560:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=q=>null!==q&&"object"===typeof q&&q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11585:(q,c)=>{"use strict";function U(q,c){if(this._offset=c,q instanceof ArrayBuffer)this._buffer=q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(q))throw new Error("Invalid argument");this._buffer=q.buffer,this._view=new DataView(this._buffer,q.byteOffset,q.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,U.prototype._array=function(q){for(var c=new Array(q),U=0;U<q;U++)c[U]=this._parse();return c},U.prototype._map=function(q){for(var c={},U=0;U<q;U++)c[this._parse()]=this._parse();return c},U.prototype._str=function(q){var c=function(q,c,U){for(var J="",Q=0,s=c,g=c+U;s<g;s++){var X=q.getUint8(s);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(Q=(7&X)<<18|(63&q.getUint8(++s))<<12|(63&q.getUint8(++s))<<6|63&q.getUint8(++s))>=65536?(Q-=65536,J+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):J+=String.fromCharCode(Q)}else J+=String.fromCharCode((15&X)<<12|(63&q.getUint8(++s))<<6|63&q.getUint8(++s));else J+=String.fromCharCode((31&X)<<6|63&q.getUint8(++s));else J+=String.fromCharCode(X)}return J}(this._view,this._offset,q);return this._offset+=q,c},U.prototype._bin=function(q){var c=this._buffer.slice(this._offset,this._offset+q);return this._offset+=q,c},U.prototype._parse=function(){var q,c=this._view.getUint8(this._offset++),U=0,J=0,Q=0,s=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return U=this._view.getUint8(this._offset),this._offset+=1,this._bin(U);case 197:return U=this._view.getUint16(this._offset),this._offset+=2,this._bin(U);case 198:return U=this._view.getUint32(this._offset),this._offset+=4,this._bin(U);case 199:if(U=this._view.getUint8(this._offset),J=this._view.getInt8(this._offset+1),this._offset+=2,-1===J){var g=this._view.getUint32(this._offset);return Q=this._view.getInt32(this._offset+4),s=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Q+s)+g/1e6)}return[J,this._bin(U)];case 200:return U=this._view.getUint16(this._offset),J=this._view.getInt8(this._offset+2),this._offset+=3,[J,this._bin(U)];case 201:return U=this._view.getUint32(this._offset),J=this._view.getInt8(this._offset+4),this._offset+=5,[J,this._bin(U)];case 202:return q=this._view.getFloat32(this._offset),this._offset+=4,q;case 203:return q=this._view.getFloat64(this._offset),this._offset+=8,q;case 204:return q=this._view.getUint8(this._offset),this._offset+=1,q;case 205:return q=this._view.getUint16(this._offset),this._offset+=2,q;case 206:return q=this._view.getUint32(this._offset),this._offset+=4,q;case 207:return Q=this._view.getUint32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,Q+s;case 208:return q=this._view.getInt8(this._offset),this._offset+=1,q;case 209:return q=this._view.getInt16(this._offset),this._offset+=2,q;case 210:return q=this._view.getInt32(this._offset),this._offset+=4,q;case 211:return Q=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,Q+s;case 212:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?void(this._offset+=1):[J,this._bin(1)];case 213:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(2)];case 214:return J=this._view.getInt8(this._offset),this._offset+=1,-1===J?(q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*q)):[J,this._bin(4)];case 215:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?(Q=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Q+s)):-1===J?(Q=this._view.getUint32(this._offset),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Q)+s)+(Q>>>2)/1e6)):[J,this._bin(8)];case 216:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(16)];case 217:return U=this._view.getUint8(this._offset),this._offset+=1,this._str(U);case 218:return U=this._view.getUint16(this._offset),this._offset+=2,this._str(U);case 219:return U=this._view.getUint32(this._offset),this._offset+=4,this._str(U);case 220:return U=this._view.getUint16(this._offset),this._offset+=2,this._array(U);case 221:return U=this._view.getUint32(this._offset),this._offset+=4,this._array(U);case 222:return U=this._view.getUint16(this._offset),this._offset+=2,this._map(U);case 223:return U=this._view.getUint32(this._offset),this._offset+=4,this._map(U)}throw new Error("Could not parse")},c.decode=function(q){var c=new U(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),J=c._parse();if(c._offset!==q.byteLength)throw new Error(q.byteLength-c._offset+" trailing bytes");return J};function J(q,c,U){for(var J=0,Q=0,s=U.length;Q<s;Q++)(J=U.charCodeAt(Q))<128?q.setUint8(c++,J):J<2048?(q.setUint8(c++,192|J>>6),q.setUint8(c++,128|63&J)):J<55296||J>=57344?(q.setUint8(c++,224|J>>12),q.setUint8(c++,128|J>>6&63),q.setUint8(c++,128|63&J)):(Q++,J=65536+((1023&J)<<10|1023&U.charCodeAt(Q)),q.setUint8(c++,240|J>>18),q.setUint8(c++,128|J>>12&63),q.setUint8(c++,128|J>>6&63),q.setUint8(c++,128|63&J))}function Q(q,c,U){var J=typeof U,s=0,g=0,X=0,n=0,W=0,D=0;if("string"===J){if(W=function(q){for(var c=0,U=0,J=0,Q=q.length;J<Q;J++)(c=q.charCodeAt(J))<128?U+=1:c<2048?U+=2:c<55296||c>=57344?U+=3:(J++,U+=4);return U}(U),W<32)q.push(160|W),D=1;else if(W<256)q.push(217,W),D=2;else if(W<65536)q.push(218,W>>8,W),D=3;else{if(!(W<4294967296))throw new Error("String too long");q.push(219,W>>24,W>>16,W>>8,W),D=5}return c.push({_str:U,_length:W,_offset:q.length}),D+W}if("number"===J)return Math.floor(U)===U&&isFinite(U)?U>=0?U<128?(q.push(U),1):U<256?(q.push(204,U),2):U<65536?(q.push(205,U>>8,U),3):U<4294967296?(q.push(206,U>>24,U>>16,U>>8,U),5):(X=U/Math.pow(2,32)|0,n=U>>>0,q.push(207,X>>24,X>>16,X>>8,X,n>>24,n>>16,n>>8,n),9):U>=-32?(q.push(U),1):U>=-128?(q.push(208,U),2):U>=-32768?(q.push(209,U>>8,U),3):U>=-2147483648?(q.push(210,U>>24,U>>16,U>>8,U),5):(X=Math.floor(U/Math.pow(2,32)),n=U>>>0,q.push(211,X>>24,X>>16,X>>8,X,n>>24,n>>16,n>>8,n),9):(q.push(203),c.push({_float:U,_length:8,_offset:q.length}),9);if("object"===J){if(null===U)return q.push(192),1;if(Array.isArray(U)){if((W=U.length)<16)q.push(144|W),D=1;else if(W<65536)q.push(220,W>>8,W),D=3;else{if(!(W<4294967296))throw new Error("Array too large");q.push(221,W>>24,W>>16,W>>8,W),D=5}for(s=0;s<W;s++)D+=Q(q,c,U[s]);return D}if(U instanceof Date){var u=U.getTime(),K=Math.floor(u/1e3),r=1e6*(u-1e3*K);return K>=0&&r>=0&&K<=17179869183?0===r&&K<=4294967295?(q.push(214,255,K>>24,K>>16,K>>8,K),6):(X=K/4294967296,n=4294967295&K,q.push(215,255,r>>22,r>>14,r>>6,X,n>>24,n>>16,n>>8,n),10):(X=Math.floor(K/4294967296),n=K>>>0,q.push(199,12,255,r>>24,r>>16,r>>8,r,X>>24,X>>16,X>>8,X,n>>24,n>>16,n>>8,n),15)}if(U instanceof ArrayBuffer){if((W=U.byteLength)<256)q.push(196,W),D=2;else if(W<65536)q.push(197,W>>8,W),D=3;else{if(!(W<4294967296))throw new Error("Buffer too large");q.push(198,W>>24,W>>16,W>>8,W),D=5}return c.push({_bin:U,_length:W,_offset:q.length}),D+W}if("function"===typeof U.toJSON)return Q(q,c,U.toJSON());var H=[],b="",h=Object.keys(U);for(s=0,g=h.length;s<g;s++)void 0!==U[b=h[s]]&&"function"!==typeof U[b]&&H.push(b);if((W=H.length)<16)q.push(128|W),D=1;else if(W<65536)q.push(222,W>>8,W),D=3;else{if(!(W<4294967296))throw new Error("Object too large");q.push(223,W>>24,W>>16,W>>8,W),D=5}for(s=0;s<W;s++)D+=Q(q,c,b=H[s]),D+=Q(q,c,U[b]);return D}if("boolean"===J)return q.push(U?195:194),1;if("undefined"===J)return q.push(192),1;if("function"===typeof U.toJSON)return Q(q,c,U.toJSON());throw new Error("Could not encode")}c.encode=function(q){var c=[],U=[],s=Q(c,U,q),g=new ArrayBuffer(s),X=new DataView(g),n=0,W=0,D=-1;U.length>0&&(D=U[0]._offset);for(var u,K=0,r=0,H=0,b=c.length;H<b;H++)if(X.setUint8(W+H,c[H]),H+1===D){if(K=(u=U[n])._length,r=W+D,u._bin)for(var h=new Uint8Array(u._bin),o=0;o<K;o++)X.setUint8(r+o,h[o]);else u._str?J(X,r,u._str):void 0!==u._float&&X.setFloat64(r,u._float);W+=K,U[++n]&&(D=U[n]._offset)}return g}},11655:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(q){}getState(){return null}patch(q){}teardown(){}handshake(q){}}},11648:(q,c,U)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const J=U(11634);c.SchemaSerializer=class{setState(q){return this.state.decode(q)}getState(){return this.state}patch(q){return this.state.decode(q)}teardown(){var q,c;null===(c=null===(q=this.state)||void 0===q?void 0:q.$changes)||void 0===c||c.root.clearRefs()}handshake(q,c){if(this.state){(new J.Reflection).decode(q,c)}else this.state=J.Reflection.decode(q,c)}}},11613:(q,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const U={};c.registerSerializer=function(q,c){U[q]=c},c.getSerializer=function(q){const c=U[q];if(!c)throw new Error("missing serializer: "+q);return c}},11594:function(q,c,U){"use strict";var J=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const Q=J(U(11602)),s=globalThis.WebSocket||Q.default;c.WebSocketTransport=class{constructor(q){this.events=q}send(q){q instanceof ArrayBuffer?this.ws.send(q):Array.isArray(q)&&this.ws.send(new Uint8Array(q).buffer)}connect(q){this.ws=new s(q,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(q,c){this.ws.close(q,c)}get isOpen(){return this.ws.readyState===s.OPEN}}},11602:q=>{"use strict";q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12041:q=>{"use strict";q.exports=function(q){for(var c=new Array(q),U=0;U<q;++U)c[U]=U;return c}},12048:q=>{function c(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(c(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&c(q.slice(0,0))}(q)||!!q._isBuffer)}},12034:(q,c,U)=>{var J=U(12041),Q=U(12048),s="undefined"!==typeof Float64Array;function g(q,c){return q[0]-c[0]}function X(){var q,c=this.stride,U=new Array(c.length);for(q=0;q<U.length;++q)U[q]=[Math.abs(c[q]),q];U.sort(g);var J=new Array(U.length);for(q=0;q<J.length;++q)J[q]=U[q][1];return J}function n(q,c){var U=["View",c,"d",q].join("");c<0&&(U="View_Nil"+q);var Q="generic"===q;if(-1===c){var s="function "+U+"(a){this.data=a;};var proto="+U+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+U+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+U+"(a){return new "+U+"(a);}";return new Function(s)()}if(0===c){s="function "+U+"(a,d) {this.data = a;this.offset = d};var proto="+U+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+U+"_copy() {return new "+U+"(this.data,this.offset)};proto.pick=function "+U+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+U+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+U+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+U+"(a,b,c,d){return new "+U+"(a,d)}";return new Function("TrivialArray",s)(W[q][0])}s=["'use strict'"];var g=J(c),n=g.map((function(q){return"i"+q})),D="this.offset+"+g.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),u=g.map((function(q){return"b"+q})).join(","),K=g.map((function(q){return"c"+q})).join(",");s.push("function "+U+"(a,"+u+","+K+",d){this.data=a","this.shape=["+u+"]","this.stride=["+K+"]","this.offset=d|0}","var proto="+U+".prototype","proto.dtype='"+q+"'","proto.dimension="+c),s.push("Object.defineProperty(proto,'size',{get:function "+U+"_size(){return "+g.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===c?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),c<4?(s.push("function "+U+"_order(){"),2===c?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+U+"_set("+n.join(",")+",v){"),Q?s.push("return this.data.set("+D+",v)}"):s.push("return this.data["+D+"]=v}"),s.push("proto.get=function "+U+"_get("+n.join(",")+"){"),Q?s.push("return this.data.get("+D+")}"):s.push("return this.data["+D+"]}"),s.push("proto.index=function "+U+"_index(",n.join(),"){return "+D+"}"),s.push("proto.hi=function "+U+"_hi("+n.join(",")+"){return new "+U+"(this.data,"+g.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+g.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var r=g.map((function(q){return"a"+q+"=this.shape["+q+"]"})),H=g.map((function(q){return"c"+q+"=this.stride["+q+"]"}));s.push("proto.lo=function "+U+"_lo("+n.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+H.join(","));for(var b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");s.push("return new "+U+"(this.data,"+g.map((function(q){return"a"+q})).join(",")+","+g.map((function(q){return"c"+q})).join(",")+",b)}"),s.push("proto.step=function "+U+"_step("+n.join(",")+"){var "+g.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+g.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");s.push("return new "+U+"(this.data,"+g.map((function(q){return"a"+q})).join(",")+","+g.map((function(q){return"b"+q})).join(",")+",c)}");var h=new Array(c),o=new Array(c);for(b=0;b<c;++b)h[b]="a[i"+b+"]",o[b]="b[i"+b+"]";s.push("proto.transpose=function "+U+"_transpose("+n+"){"+n.map((function(q,c){return q+"=("+q+"===undefined?"+c+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+U+"(this.data,"+h.join(",")+","+o.join(",")+",this.offset)}"),s.push("proto.pick=function "+U+"_pick("+n+"){var a=[],b=[],c=this.offset");for(b=0;b<c;++b)s.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+U+"(data,shape,stride,offset){return new "+U+"(data,"+g.map((function(q){return"shape["+q+"]"})).join(",")+","+g.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(W[q],X)}var W={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,c,U,J){if(void 0===q)return(0,W.array[0])([]);"number"===typeof q&&(q=[q]),void 0===c&&(c=[q.length]);var g=c.length;if(void 0===U){U=new Array(g);for(var X=g-1,D=1;X>=0;--X)U[X]=D,D*=c[X]}if(void 0===J){J=0;for(X=0;X<g;++X)U[X]<0&&(J-=(c[X]-1)*U[X])}for(var u=function(q){if(Q(q))return"buffer";if(s)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),K=W[u];K.length<=g+1;)K.push(n(u,K.length-1));return(0,K[g+1])(q,c,U,J)}},13030:q=>{var c;self,c=()=>(()=>{"use strict";var q={d:(c,U)=>{for(var J in U)q.o(U,J)&&!q.o(c,J)&&Object.defineProperty(c,J,{enumerable:!0,get:U[J]})},o:(q,c)=>Object.prototype.hasOwnProperty.call(q,c)},c={};q.d(c,{default:()=>S});var U,J=function(q,c){var U=c.x-q.x,J=c.y-q.y;return Math.sqrt(U*U+J*J)},Q=function(q){return q*(Math.PI/180)},s=new Map,g=function(q){s.has(q)&&clearTimeout(s.get(q)),s.set(q,setTimeout(q,100))},X=function(q,c,U){for(var J,Q=c.split(/[ ,]+/g),s=0;s<Q.length;s+=1)J=Q[s],q.addEventListener?q.addEventListener(J,U,!1):q.attachEvent&&q.attachEvent(J,U)},n=function(q,c,U){for(var J,Q=c.split(/[ ,]+/g),s=0;s<Q.length;s+=1)J=Q[s],q.removeEventListener?q.removeEventListener(J,U):q.detachEvent&&q.detachEvent(J,U)},W=function(q){return q.preventDefault(),q.type.match(/^touch/)?q.changedTouches:q},D=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(q,c){c.top||c.right||c.bottom||c.left?(q.style.top=c.top,q.style.right=c.right,q.style.bottom=c.bottom,q.style.left=c.left):(q.style.left=c.x+"px",q.style.top=c.y+"px")},K=function(q,c,U){var J=r(q);for(var Q in J)if(J.hasOwnProperty(Q))if("string"==typeof c)J[Q]=c+" "+U;else{for(var s="",g=0,X=c.length;g<X;g+=1)s+=c[g]+" "+U+", ";J[Q]=s.slice(0,-2)}return J},r=function(q){var c={};return c[q]="",["webkit","Moz","o"].forEach((function(U){c[U+q.charAt(0).toUpperCase()+q.slice(1)]=""})),c},H=function(q,c){for(var U in c)c.hasOwnProperty(U)&&(q[U]=c[U]);return q},b=function(q,c){if(q.length)for(var U=0,J=q.length;U<J;U+=1)c(q[U]);else c(q)},h="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,o=window.matchMedia("(any-hover: none)").matches,a=!!("ontouchstart"in window),p=!!window.PointerEvent,R=!!window.MSPointerEvent,I={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},t={start:"mousedown",move:"mousemove",end:"mouseup"},C={};function i(){}h&&!o?U=I:p?U={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:R?U={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:a?(U=I,C=t):U=t,i.prototype.on=function(q,c){var U,J=this,Q=q.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var s=0;s<Q.length;s+=1)U=Q[s],J._handlers_[U]=J._handlers_[U]||[],J._handlers_[U].push(c);return J},i.prototype.off=function(q,c){var U=this;return U._handlers_=U._handlers_||{},void 0===q?U._handlers_={}:void 0===c?U._handlers_[q]=null:U._handlers_[q]&&U._handlers_[q].indexOf(c)>=0&&U._handlers_[q].splice(U._handlers_[q].indexOf(c),1),U},i.prototype.trigger=function(q,c){var U,J=this,Q=q.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var s=0;s<Q.length;s+=1)U=Q[s],J._handlers_[U]&&J._handlers_[U].length&&J._handlers_[U].forEach((function(q){q.call(J,{type:U,target:J},c)}))},i.prototype.config=function(q){var c=this;c.options=c.defaults||{},q&&(c.options=function(q,c){var U={};for(var J in q)q.hasOwnProperty(J)&&c.hasOwnProperty(J)?U[J]=c[J]:q.hasOwnProperty(J)&&(U[J]=q[J]);return U}(c.options,q))},i.prototype.bindEvt=function(q,c){var J=this;return J._domHandlers_=J._domHandlers_||{},J._domHandlers_[c]=function(){"function"==typeof J["on"+c]?J["on"+c].apply(J,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},X(q,U[c],J._domHandlers_[c]),C[c]&&X(q,C[c],J._domHandlers_[c]),J},i.prototype.unbindEvt=function(q,c){var J=this;return J._domHandlers_=J._domHandlers_||{},n(q,U[c],J._domHandlers_[c]),C[c]&&n(q,C[c],J._domHandlers_[c]),delete J._domHandlers_[c],this};const F=i;function v(q,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=v.id,v.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}v.prototype=new F,v.constructor=v,v.id=0,v.prototype.buildEl=function(q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},v.prototype.stylize=function(){if(this.options.dataOnly)return this;var q=this.options.fadeTime+"ms",c=function(){var q=r("borderRadius");for(var c in q)q.hasOwnProperty(c)&&(q[c]="50%");return q}(),U=K("transition","opacity",q),J={};return J.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},J.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},J.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},H(J.el,U),"circle"===this.options.shape&&H(J.back,c),H(J.front,c),this.applyStyles(J),this},v.prototype.applyStyles=function(q){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var U in q[c])this.ui[c].style[U]=q[c][U];return this},v.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},v.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},v.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},v.prototype.show=function(q){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof q&&q.call(this)}),c.options.fadeTime)),c},v.prototype.hide=function(q){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var U="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=U,"function"==typeof q&&q.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var U=c.options.restJoystick,J={};J.x=!0===U||!1!==U.x?0:c.instance.frontPosition.x,J.y=!0===U||!1!==U.y?0:c.instance.frontPosition.y,c.setPosition(q,J)}return c},v.prototype.setPosition=function(q,c){var U=this;U.frontPosition={x:c.x,y:c.y};var J=U.options.fadeTime+"ms",Q={};Q.front=K("transition",["transform"],J);var s={front:{}};s.front={transform:"translate("+U.frontPosition.x+"px,"+U.frontPosition.y+"px)"},U.applyStyles(Q),U.applyStyles(s),U.restTimeout=setTimeout((function(){"function"==typeof q&&q.call(U),U.restCallback()}),U.options.fadeTime)},v.prototype.restCallback=function(){var q=this,c={};c.front=K("transition","none",""),q.applyStyles(c),q.trigger("rested",q.instance)},v.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},v.prototype.computeDirection=function(q){var c,U,J,Q=q.angle.radian,s=Math.PI/4,g=Math.PI/2;if(Q>s&&Q<3*s&&!q.lockX?c="up":Q>-s&&Q<=s&&!q.lockY?c="left":Q>3*-s&&Q<=-s&&!q.lockX?c="down":q.lockY||(c="right"),q.lockY||(U=Q>-g&&Q<g?"left":"right"),q.lockX||(J=Q>0?"up":"down"),q.force>this.options.threshold){var X,n={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(n[X]=this.direction[X]);var W={};for(X in this.direction={x:U,y:J,angle:c},q.direction=this.direction,n)n[X]===this.direction[X]&&(W[X]=!0);if(W.x&&W.y&&W.angle)return q;W.x&&W.y||this.trigger("plain",q),W.x||this.trigger("plain:"+U,q),W.y||this.trigger("plain:"+J,q),W.angle||this.trigger("dir dir:"+c,q)}else this.resetDirection();return q};const Y=v;function k(q,c){var U=this;U.nipples=[],U.idles=[],U.actives=[],U.ids=[],U.pressureIntervals={},U.manager=q,U.id=k.id,k.id+=1,U.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},U.config(c),"static"!==U.options.mode&&"semi"!==U.options.mode||(U.options.multitouch=!1),U.options.multitouch||(U.options.maxNumberOfNipples=1);var J=getComputedStyle(U.options.zone.parentElement);return J&&"flex"===J.display&&(U.parentIsFlex=!0),U.updateBox(),U.prepareNipples(),U.XK(),U.begin(),U.nipples}k.prototype=new F,k.constructor=k,k.id=0,k.prototype.prepareNipples=function(){var q=this,c=q.nipples;c.on=q.on.bind(q),c.off=q.off.bind(q),c.options=q.options,c.destroy=q.destroy.bind(q),c.ids=q.ids,c.id=q.id,c.processOnMove=q.processOnMove.bind(q),c.processOnEnd=q.processOnEnd.bind(q),c.get=function(q){if(void 0===q)return c[0];for(var U=0,J=c.length;U<J;U+=1)if(c[U].identifier===q)return c[U];return!1}},k.prototype.XK=function(){var q=this;q.bindEvt(q.options.zone,"start"),q.options.zone.style.touchAction="none",q.options.zone.style.msTouchAction="none"},k.prototype.begin=function(){var q=this,c=q.options;if("static"===c.mode){var U=q.createNipple(c.position,q.manager.getIdentifier());U.add(),q.idles.push(U)}},k.prototype.createNipple=function(q,c){var U=this,J=U.manager.scroll,Q={},s=U.options,g=U.parentIsFlex?J.x:J.x+U.box.left,X=U.parentIsFlex?J.y:J.y+U.box.top;if(q.x&&q.y)Q={x:q.x-g,y:q.y-X};else if(q.top||q.right||q.bottom||q.left){var n=document.createElement("DIV");n.style.display="hidden",n.style.top=q.top,n.style.right=q.right,n.style.bottom=q.bottom,n.style.left=q.left,n.style.position="absolute",s.zone.appendChild(n);var W=n.getBoundingClientRect();s.zone.removeChild(n),Q=q,q={x:W.left+J.x,y:W.top+J.y}}var D=new Y(U,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:c,position:q,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(u(D.ui.el,Q),u(D.ui.front,D.frontPosition)),U.nipples.push(D),U.trigger("added "+D.identifier+":added",D),U.manager.trigger("added "+D.identifier+":added",D),U.bindNipple(D),D},k.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},k.prototype.bindNipple=function(q){var c,U=this,J=function(q,J){c=q.type+" "+J.id+":"+q.type,U.trigger(c,J)};q.on("destroyed",U.onDestroyed.bind(U)),q.on("shown hidden rested dir plain",J),q.on("dir:up dir:right dir:down dir:left",J),q.on("plain:up plain:right plain:down plain:left",J)},k.prototype.pressureFn=function(q,c,U){var J=this,Q=0;clearInterval(J.pressureIntervals[U]),J.pressureIntervals[U]=setInterval(function(){var U=q.force||q.pressure||q.webkitForce||0;U!==Q&&(c.trigger("pressure",U),J.trigger("pressure "+c.identifier+":pressure",U),Q=U)}.bind(J),100)},k.prototype.onstart=function(q){var c=this,U=c.options,J=q;return q=W(q),c.updateBox(),b(q,(function(Q){c.actives.length<U.maxNumberOfNipples?c.processOnStart(Q):J.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(U){if(Object.values(J.touches).findIndex((function(q){return q.identifier===U}))<0){var Q=[q[0]];Q.identifier=U,c.processOnEnd(Q)}})),c.actives.length<U.maxNumberOfNipples&&c.processOnStart(Q))})),c.manager.bindDocument(),!1},k.prototype.processOnStart=function(q){var c,U=this,Q=U.options,s=U.manager.getIdentifier(q),g=q.force||q.pressure||q.webkitForce||0,X={x:q.pageX,y:q.pageY},n=U.getOrCreate(s,X);n.identifier!==s&&U.manager.removeIdentifier(n.identifier),n.identifier=s;var W=function(c){c.trigger("start",c),U.trigger("start "+c.id+":start",c),c.show(),g>0&&U.pressureFn(q,c,c.identifier),U.processOnMove(q)};if((c=U.idles.indexOf(n))>=0&&U.idles.splice(c,1),U.actives.push(n),U.ids.push(n.identifier),"semi"!==Q.mode)W(n);else{if(!(J(X,n.position)<=Q.catchDistance))return n.destroy(),void U.processOnStart(q);W(n)}return n},k.prototype.getOrCreate=function(q,c){var U,J=this,Q=J.options;return/(semi|static)/.test(Q.mode)?(U=J.idles[0])?(J.idles.splice(0,1),U):"semi"===Q.mode?J.createNipple(c,q):(console.warn("Coudln't find the needed nipple."),!1):U=J.createNipple(c,q)},k.prototype.processOnMove=function(q){var c=this,U=c.options,s=c.manager.getIdentifier(q),g=c.nipples.get(s),X=c.manager.scroll;if(function(q){return isNaN(q.buttons)?0!==q.pressure:0!==q.buttons}(q)){if(!g)return console.error("Found zombie joystick with ID "+s),void c.manager.removeIdentifier(s);if(U.dynamicPage){var n=g.el.getBoundingClientRect();g.position={x:X.x+n.left,y:X.y+n.top}}g.identifier=s;var W=g.options.size/2,D={x:q.pageX,y:q.pageY};U.lockX&&(D.y=g.position.y),U.lockY&&(D.x=g.position.x);var u,K,r,H,b,h,o,a,p,R,I=J(D,g.position),t=(u=D,r=(K=g.position).x-u.x,H=K.y-u.y,function(q){return q*(180/Math.PI)}(Math.atan2(H,r))),C=Q(t),i=I/W,F={distance:I,position:D};if("circle"===g.options.shape?(b=Math.min(I,W),o=g.position,a=b,R={x:0,y:0},p=Q(p=t),R.x=o.x-a*Math.cos(p),R.y=o.y-a*Math.sin(p),h=R):(h=function(q,c,U){return{x:Math.min(Math.max(q.x,c.x-U),c.x+U),y:Math.min(Math.max(q.y,c.y-U),c.y+U)}}(D,g.position,W),b=J(h,g.position)),U.follow){if(I>W){var v=D.x-h.x,Y=D.y-h.y;g.position.x+=v,g.position.y+=Y,g.el.style.top=g.position.y-(c.box.top+X.y)+"px",g.el.style.left=g.position.x-(c.box.left+X.x)+"px",I=J(D,g.position)}}else D=h,I=b;var k=D.x-g.position.x,V=D.y-g.position.y;g.frontPosition={x:k,y:V},U.dataOnly||(g.ui.front.style.transform="translate("+k+"px,"+V+"px)");var O={identifier:g.identifier,position:D,force:i,pressure:q.force||q.pressure||q.webkitForce||0,distance:I,angle:{radian:C,degree:t},vector:{x:k/W,y:-V/W},raw:F,instance:g,lockX:U.lockX,lockY:U.lockY};(O=g.computeDirection(O)).angle={radian:Q(180-t),degree:180-t},g.trigger("move",O),c.trigger("move "+g.id+":move",O)}else this.processOnEnd(q)},k.prototype.processOnEnd=function(q){var c=this,U=c.options,J=c.manager.getIdentifier(q),Q=c.nipples.get(J),s=c.manager.removeIdentifier(Q.identifier);Q&&(U.dataOnly||Q.hide((function(){"dynamic"===U.mode&&(Q.trigger("removed",Q),c.trigger("removed "+Q.id+":removed",Q),c.manager.trigger("removed "+Q.id+":removed",Q),Q.destroy())})),clearInterval(c.pressureIntervals[Q.identifier]),Q.resetDirection(),Q.trigger("end",Q),c.trigger("end "+Q.id+":end",Q),c.ids.indexOf(Q.identifier)>=0&&c.ids.splice(c.ids.indexOf(Q.identifier),1),c.actives.indexOf(Q)>=0&&c.actives.splice(c.actives.indexOf(Q),1),/(semi|static)/.test(U.mode)?c.idles.push(Q):c.nipples.indexOf(Q)>=0&&c.nipples.splice(c.nipples.indexOf(Q),1),c.manager.unbindDocument(),/(semi|static)/.test(U.mode)&&(c.manager.ids[s.id]=s.identifier))},k.prototype.onDestroyed=function(q,c){var U=this;U.nipples.indexOf(c)>=0&&U.nipples.splice(U.nipples.indexOf(c),1),U.actives.indexOf(c)>=0&&U.actives.splice(U.actives.indexOf(c),1),U.idles.indexOf(c)>=0&&U.idles.splice(U.idles.indexOf(c),1),U.ids.indexOf(c.identifier)>=0&&U.ids.splice(U.ids.indexOf(c.identifier),1),U.manager.removeIdentifier(c.identifier),U.manager.unbindDocument()},k.prototype.destroy=function(){var q=this;for(var c in q.unbindEvt(q.options.zone,"start"),q.nipples.forEach((function(q){q.destroy()})),q.pressureIntervals)q.pressureIntervals.hasOwnProperty(c)&&clearInterval(q.pressureIntervals[c]);q.trigger("destroyed",q.nipples),q.manager.unbindDocument(),q.off()};const V=k;function O(q){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=D(),c.config(q),c.prepareCollections();var U=function(){var q;c.collections.forEach((function(U){U.forEach((function(U){q=U.el.getBoundingClientRect(),U.position={x:c.scroll.x+q.left,y:c.scroll.y+q.top}}))}))};X(window,"resize",(function(){g(U)}));var J=function(){c.scroll=D()};return X(window,"scroll",(function(){g(J)})),c.collections}O.prototype=new F,O.constructor=O,O.prototype.prepareCollections=function(){var q=this;q.collections.create=q.create.bind(q),q.collections.on=q.on.bind(q),q.collections.off=q.off.bind(q),q.collections.destroy=q.destroy.bind(q),q.collections.get=function(c){var U;return q.collections.every((function(q){return!(U=q.get(c))})),U}},O.prototype.create=function(q){return this.createCollection(q)},O.prototype.createCollection=function(q){var c=this,U=new V(c,q);return c.bindCollection(U),c.collections.push(U),U},O.prototype.bindCollection=function(q){var c,U=this,J=function(q,J){c=q.type+" "+J.id+":"+q.type,U.trigger(c,J)};q.on("destroyed",U.onDestroyed.bind(U)),q.on("shown hidden rested dir plain",J),q.on("dir:up dir:right dir:down dir:left",J),q.on("plain:up plain:right plain:down plain:left",J)},O.prototype.bindDocument=function(){var q=this;q.binded||(q.bindEvt(document,"move").bindEvt(document,"end"),q.binded=!0)},O.prototype.unbindDocument=function(q){var c=this;Object.keys(c.ids).length&&!0!==q||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},O.prototype.getIdentifier=function(q){var c;return q?void 0===(c=void 0===q.identifier?q.pointerId:q.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},O.prototype.removeIdentifier=function(q){var c={};for(var U in this.ids)if(this.ids[U]===q){c.id=U,c.identifier=this.ids[U],delete this.ids[U];break}return c},O.prototype.onmove=function(q){return this.onAny("move",q),!1},O.prototype.onend=function(q){return this.onAny("end",q),!1},O.prototype.oncancel=function(q){return this.onAny("end",q),!1},O.prototype.onAny=function(q,c){var U,J=this,Q="processOn"+q.charAt(0).toUpperCase()+q.slice(1);c=W(c);var s=function(q,c,U){U.ids.indexOf(c)>=0&&(U[Q](q),q._found_=!0)};return b(c,(function(q){U=J.getIdentifier(q),b(J.collections,s.bind(null,q,U)),q._found_||J.removeIdentifier(U)})),!1},O.prototype.destroy=function(){var q=this;q.unbindDocument(!0),q.ids={},q.index=0,q.collections.forEach((function(q){q.destroy()})),q.off()},O.prototype.onDestroyed=function(q,c){var U=this;if(U.collections.indexOf(c)<0)return!1;U.collections.splice(U.collections.indexOf(c),1)};var G=new O;const S={create:function(q){return G.create(q)},factory:G};return c.default})(),q.exports=c()},12067:(q,c,U)=>{"use strict";const{Deflate:J,deflate:Q,deflateRaw:s,gzip:g}=U(12071),{Inflate:X,inflate:n,inflateRaw:W,ungzip:D}=U(12129),u=U(12111);q.exports.Deflate=J,q.exports.deflate=Q,q.exports.deflateRaw=s,q.exports.gzip=g,q.exports.Inflate=X,q.exports.inflate=n,q.exports.inflateRaw=W,q.exports.ungzip=D,q.exports.constants=u},12071:(q,c,U)=>{"use strict";const J=U(12080),Q=U(12117),s=U(12123),g=U(12105),X=U(12126),n=Object.prototype.toString,{Z_NO_FLUSH:W,Z_SYNC_FLUSH:D,Z_FULL_FLUSH:u,Z_FINISH:K,Z_OK:r,Z_STREAM_END:H,Z_DEFAULT_COMPRESSION:b,Z_DEFAULT_STRATEGY:h,Z_DEFLATED:o}=U(12111);function a(q){this.options=Q.assign({level:b,method:o,Mq:16384,windowBits:15,memLevel:8,strategy:h},q||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.Yc="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let U=J.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(U!==r)throw new Error(g[U]);if(c.header&&J.deflateSetHeader(this.strm,c.header),c.dictionary){let q;if(q="string"===typeof c.dictionary?s.string2buf(c.dictionary):"[object ArrayBuffer]"===n.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,U=J.deflateSetDictionary(this.strm,q),U!==r)throw new Error(g[U]);this._dict_set=!0}}function p(q,c){const U=new a(c);if(U.push(q,!0),U.err)throw U.Yc||g[U.err];return U.result}a.prototype.push=function(q,c){const U=this.strm,Q=this.options.Mq;let g,X;if(this.ended)return!1;for(X=c===~~c?c:!0===c?K:W,"string"===typeof q?U.input=s.string2buf(q):"[object ArrayBuffer]"===n.call(q)?U.input=new Uint8Array(q):U.input=q,U.next_in=0,U.avail_in=U.input.length;;)if(0===U.avail_out&&(U.output=new Uint8Array(Q),U.next_out=0,U.avail_out=Q),(X===D||X===u)&&U.avail_out<=6)this.onData(U.output.subarray(0,U.next_out)),U.avail_out=0;else{if(g=J.deflate(U,X),g===H)return U.next_out>0&&this.onData(U.output.subarray(0,U.next_out)),g=J.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===r;if(0!==U.avail_out){if(X>0&&U.next_out>0)this.onData(U.output.subarray(0,U.next_out)),U.avail_out=0;else if(0===U.avail_in)break}else this.onData(U.output)}return!0},a.prototype.onData=function(q){this.chunks.push(q)},a.prototype.onEnd=function(q){q===r&&(this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.Yc=this.strm.Yc},q.exports.Deflate=a,q.exports.deflate=p,q.exports.deflateRaw=function(q,c){return(c=c||{}).raw=!0,p(q,c)},q.exports.gzip=function(q,c){return(c=c||{}).gzip=!0,p(q,c)},q.exports.constants=U(12111)},12129:(q,c,U)=>{"use strict";const J=U(12133),Q=U(12117),s=U(12123),g=U(12105),X=U(12126),n=U(12146),W=Object.prototype.toString,{Z_NO_FLUSH:D,Z_FINISH:u,Z_OK:K,Z_STREAM_END:r,Z_NEED_DICT:H,Z_STREAM_ERROR:b,Z_DATA_ERROR:h,Z_MEM_ERROR:o}=U(12111);function a(q){this.options=Q.assign({Mq:65536,windowBits:15,to:""},q||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||q&&q.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.Yc="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let U=J.inflateInit2(this.strm,c.windowBits);if(U!==K)throw new Error(g[U]);if(this.header=new n,J.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=s.string2buf(c.dictionary):"[object ArrayBuffer]"===W.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(U=J.inflateSetDictionary(this.strm,c.dictionary),U!==K)))throw new Error(g[U])}function p(q,c){const U=new a(c);if(U.push(q),U.err)throw U.Yc||g[U.err];return U.result}a.prototype.push=function(q,c){const U=this.strm,Q=this.options.Mq,g=this.options.dictionary;let X,n,a;if(this.ended)return!1;for(n=c===~~c?c:!0===c?u:D,"[object ArrayBuffer]"===W.call(q)?U.input=new Uint8Array(q):U.input=q,U.next_in=0,U.avail_in=U.input.length;;){for(0===U.avail_out&&(U.output=new Uint8Array(Q),U.next_out=0,U.avail_out=Q),X=J.inflate(U,n),X===H&&g&&(X=J.inflateSetDictionary(U,g),X===K?X=J.inflate(U,n):X===h&&(X=H));U.avail_in>0&&X===r&&U.state.wrap>0&&0!==q[U.next_in];)J.inflateReset(U),X=J.inflate(U,n);switch(X){case b:case h:case H:case o:return this.onEnd(X),this.ended=!0,!1}if(a=U.avail_out,U.next_out&&(0===U.avail_out||X===r))if("string"===this.options.to){let q=s.utf8border(U.output,U.next_out),c=U.next_out-q,J=s.buf2string(U.output,q);U.next_out=c,U.avail_out=Q-c,c&&U.output.set(U.output.subarray(q,q+c),0),this.onData(J)}else this.onData(U.output.length===U.next_out?U.output:U.output.subarray(0,U.next_out));if(X!==K||0!==a){if(X===r)return X=J.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===U.avail_in)break}}return!0},a.prototype.onData=function(q){this.chunks.push(q)},a.prototype.onEnd=function(q){q===K&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.Yc=this.strm.Yc},q.exports.Inflate=a,q.exports.inflate=p,q.exports.inflateRaw=function(q,c){return(c=c||{}).raw=!0,p(q,c)},q.exports.ungzip=p,q.exports.constants=U(12111)},12117:q=>{"use strict";const c=(q,c)=>Object.prototype.hasOwnProperty.call(q,c);q.exports.assign=function(q){const U=Array.prototype.slice.call(arguments,1);for(;U.length;){const J=U.shift();if(J){if("object"!==typeof J)throw new TypeError(J+"must be non-object");for(const U in J)c(J,U)&&(q[U]=J[U])}}return q},q.exports.flattenChunks=q=>{let c=0;for(let J=0,Q=q.length;J<Q;J++)c+=q[J].length;const U=new Uint8Array(c);for(let J=0,Q=0,s=q.length;J<s;J++){let c=q[J];U.set(c,Q),Q+=c.length}return U}},12123:q=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(J){c=!1}const U=new Uint8Array(256);for(let Q=0;Q<256;Q++)U[Q]=Q>=252?6:Q>=248?5:Q>=240?4:Q>=224?3:Q>=192?2:1;U[254]=U[254]=1,q.exports.string2buf=q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(q);let c,U,J,Q,s,g=q.length,X=0;for(Q=0;Q<g;Q++)U=q.charCodeAt(Q),55296===(64512&U)&&Q+1<g&&(J=q.charCodeAt(Q+1),56320===(64512&J)&&(U=65536+(U-55296<<10)+(J-56320),Q++)),X+=U<128?1:U<2048?2:U<65536?3:4;for(c=new Uint8Array(X),s=0,Q=0;s<X;Q++)U=q.charCodeAt(Q),55296===(64512&U)&&Q+1<g&&(J=q.charCodeAt(Q+1),56320===(64512&J)&&(U=65536+(U-55296<<10)+(J-56320),Q++)),U<128?c[s++]=U:U<2048?(c[s++]=192|U>>>6,c[s++]=128|63&U):U<65536?(c[s++]=224|U>>>12,c[s++]=128|U>>>6&63,c[s++]=128|63&U):(c[s++]=240|U>>>18,c[s++]=128|U>>>12&63,c[s++]=128|U>>>6&63,c[s++]=128|63&U);return c};q.exports.buf2string=(q,J)=>{const Q=J||q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(q.subarray(0,J));let s,g;const X=new Array(2*Q);for(g=0,s=0;s<Q;){let c=q[s++];if(c<128){X[g++]=c;continue}let J=U[c];if(J>4)X[g++]=65533,s+=J-1;else{for(c&=2===J?31:3===J?15:7;J>1&&s<Q;)c=c<<6|63&q[s++],J--;J>1?X[g++]=65533:c<65536?X[g++]=c:(c-=65536,X[g++]=55296|c>>10&1023,X[g++]=56320|1023&c)}}return((q,U)=>{if(U<65534&&q.subarray&&c)return String.fromCharCode.apply(null,q.length===U?q:q.subarray(0,U));let J="";for(let c=0;c<U;c++)J+=String.fromCharCode(q[c]);return J})(X,g)},q.exports.utf8border=(q,c)=>{(c=c||q.length)>q.length&&(c=q.length);let J=c-1;for(;J>=0&&128===(192&q[J]);)J--;return J<0||0===J?c:J+U[q[J]]>c?J:c}},12097:q=>{"use strict";q.exports=(q,c,U,J)=>{let Q=65535&q,s=q>>>16&65535,g=0;for(;0!==U;){g=U>2e3?2e3:U,U-=g;do{Q=Q+c[J++]|0,s=s+Q|0}while(--g);Q%=65521,s%=65521}return Q|s<<16}},12111:q=>{"use strict";q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12103:q=>{"use strict";const c=new Uint32Array((()=>{let q,c=[];for(var U=0;U<256;U++){q=U;for(var J=0;J<8;J++)q=1&q?3988292384^q>>>1:q>>>1;c[U]=q}return c})());q.exports=(q,U,J,Q)=>{const s=c,g=Q+J;q^=-1;for(let c=Q;c<g;c++)q=q>>>8^s[255&(q^U[c])];return~q}},12080:(q,c,U)=>{"use strict";const{_tr_init:J,_tr_stored_block:Q,_tr_flush_block:s,_tr_tally:g,_tr_align:X}=U(12088),n=U(12097),W=U(12103),D=U(12105),{Z_NO_FLUSH:u,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:r,Z_FINISH:H,Z_BLOCK:b,Z_OK:h,Z_STREAM_END:o,Z_STREAM_ERROR:a,Z_DATA_ERROR:p,Z_BUF_ERROR:R,Z_DEFAULT_COMPRESSION:I,Z_FILTERED:t,Z_HUFFMAN_ONLY:C,Z_RLE:i,Z_FIXED:F,Z_DEFAULT_STRATEGY:v,Z_UNKNOWN:Y,Z_DEFLATED:k}=U(12111),V=258,O=262,G=103,S=113,Z=666,x=(q,c)=>(q.Yc=D[c],c),z=q=>(q<<1)-(q>4?9:0),y=q=>{let c=q.length;for(;--c>=0;)q[c]=0};let M=(q,c,U)=>(c<<q.hash_shift^U)&q.hash_mask;const T=q=>{const c=q.state;let U=c.pending;U>q.avail_out&&(U=q.avail_out),0!==U&&(q.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+U),q.next_out),q.next_out+=U,c.pending_out+=U,q.total_out+=U,q.avail_out-=U,c.pending-=U,0===c.pending&&(c.pending_out=0))},m=(q,c)=>{s(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,c),q.block_start=q.strstart,T(q.strm)},d=(q,c)=>{q.pending_buf[q.pending++]=c},e=(q,c)=>{q.pending_buf[q.pending++]=c>>>8&255,q.pending_buf[q.pending++]=255&c},B=(q,c,U,J)=>{let Q=q.avail_in;return Q>J&&(Q=J),0===Q?0:(q.avail_in-=Q,c.set(q.input.subarray(q.next_in,q.next_in+Q),U),1===q.state.wrap?q.adler=n(q.adler,c,Q,U):2===q.state.wrap&&(q.adler=W(q.adler,c,Q,U)),q.next_in+=Q,q.total_in+=Q,Q)},N=(q,c)=>{let U,J,Q=q.max_chain_length,s=q.strstart,g=q.prev_length,X=q.nice_match;const n=q.strstart>q.w_size-O?q.strstart-(q.w_size-O):0,W=q.window,D=q.w_mask,u=q.prev,K=q.strstart+V;let r=W[s+g-1],H=W[s+g];q.prev_length>=q.good_match&&(Q>>=2),X>q.lookahead&&(X=q.lookahead);do{if(U=c,W[U+g]===H&&W[U+g-1]===r&&W[U]===W[s]&&W[++U]===W[s+1]){s+=2,U++;do{}while(W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&W[++s]===W[++U]&&s<K);if(J=V-(K-s),s=K-V,J>g){if(q.match_start=c,g=J,J>=X)break;r=W[s+g-1],H=W[s+g]}}}while((c=u[c&D])>n&&0!==--Q);return g<=q.lookahead?g:q.lookahead},P=q=>{const c=q.w_size;let U,J,Q,s,g;do{if(s=q.window_size-q.lookahead-q.strstart,q.strstart>=c+(c-O)){q.window.set(q.window.subarray(c,c+c),0),q.match_start-=c,q.strstart-=c,q.block_start-=c,J=q.hash_size,U=J;do{Q=q.head[--U],q.head[U]=Q>=c?Q-c:0}while(--J);J=c,U=J;do{Q=q.prev[--U],q.prev[U]=Q>=c?Q-c:0}while(--J);s+=c}if(0===q.strm.avail_in)break;if(J=B(q.strm,q.window,q.strstart+q.lookahead,s),q.lookahead+=J,q.lookahead+q.insert>=3)for(g=q.strstart-q.insert,q.ins_h=q.window[g],q.ins_h=M(q,q.ins_h,q.window[g+1]);q.insert&&(q.ins_h=M(q,q.ins_h,q.window[g+3-1]),q.prev[g&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=g,g++,q.insert--,!(q.lookahead+q.insert<3)););}while(q.lookahead<O&&0!==q.strm.avail_in)},w=(q,c)=>{let U,J;for(;;){if(q.lookahead<O){if(P(q),q.lookahead<O&&c===u)return 1;if(0===q.lookahead)break}if(U=0,q.lookahead>=3&&(q.ins_h=M(q,q.ins_h,q.window[q.strstart+3-1]),U=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),0!==U&&q.strstart-U<=q.w_size-O&&(q.match_length=N(q,U)),q.match_length>=3)if(J=g(q,q.strstart-q.match_start,q.match_length-3),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=3){q.match_length--;do{q.strstart++,q.ins_h=M(q,q.ins_h,q.window[q.strstart+3-1]),U=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart}while(0!==--q.match_length);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=M(q,q.ins_h,q.window[q.strstart+1]);else J=g(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(J&&(m(q,!1),0===q.strm.avail_out))return 1}return q.insert=q.strstart<2?q.strstart:2,c===H?(m(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(m(q,!1),0===q.strm.avail_out)?1:2},L=(q,c)=>{let U,J,Q;for(;;){if(q.lookahead<O){if(P(q),q.lookahead<O&&c===u)return 1;if(0===q.lookahead)break}if(U=0,q.lookahead>=3&&(q.ins_h=M(q,q.ins_h,q.window[q.strstart+3-1]),U=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=2,0!==U&&q.prev_length<q.max_lazy_match&&q.strstart-U<=q.w_size-O&&(q.match_length=N(q,U),q.match_length<=5&&(q.strategy===t||3===q.match_length&&q.strstart-q.match_start>4096)&&(q.match_length=2)),q.prev_length>=3&&q.match_length<=q.prev_length){Q=q.strstart+q.lookahead-3,J=g(q,q.strstart-1-q.prev_match,q.prev_length-3),q.lookahead-=q.prev_length-1,q.prev_length-=2;do{++q.strstart<=Q&&(q.ins_h=M(q,q.ins_h,q.window[q.strstart+3-1]),U=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart)}while(0!==--q.prev_length);if(q.match_available=0,q.match_length=2,q.strstart++,J&&(m(q,!1),0===q.strm.avail_out))return 1}else if(q.match_available){if(J=g(q,0,q.window[q.strstart-1]),J&&m(q,!1),q.strstart++,q.lookahead--,0===q.strm.avail_out)return 1}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(J=g(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<2?q.strstart:2,c===H?(m(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(m(q,!1),0===q.strm.avail_out)?1:2};function l(q,c,U,J,Q){this.good_length=q,this.max_lazy=c,this.nice_length=U,this.max_chain=J,this.func=Q}const j=[new l(0,0,0,0,((q,c)=>{let U=65535;for(U>q.pending_buf_size-5&&(U=q.pending_buf_size-5);;){if(q.lookahead<=1){if(P(q),0===q.lookahead&&c===u)return 1;if(0===q.lookahead)break}q.strstart+=q.lookahead,q.lookahead=0;const J=q.block_start+U;if((0===q.strstart||q.strstart>=J)&&(q.lookahead=q.strstart-J,q.strstart=J,m(q,!1),0===q.strm.avail_out))return 1;if(q.strstart-q.block_start>=q.w_size-O&&(m(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,c===H?(m(q,!0),0===q.strm.avail_out?3:4):(q.strstart>q.block_start&&(m(q,!1),q.strm.avail_out),1)})),new l(4,4,8,4,w),new l(4,5,16,8,w),new l(4,6,32,32,w),new l(4,4,16,16,L),new l(8,16,32,32,L),new l(8,16,128,128,L),new l(8,32,128,256,L),new l(32,128,258,1024,L),new l(32,258,258,4096,L)];function f(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),y(this.dyn_ltree),y(this.dyn_dtree),y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const A=q=>{if(!q||!q.state)return x(q,a);q.total_in=q.total_out=0,q.data_type=Y;const c=q.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:S,q.adler=2===c.wrap?0:1,c.last_flush=u,J(c),h},E=q=>{const c=A(q);var U;return c===h&&((U=q.state).window_size=2*U.w_size,y(U.head),U.max_lazy_match=j[U.level].max_lazy,U.good_match=j[U.level].good_length,U.nice_match=j[U.level].nice_length,U.max_chain_length=j[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=2,U.match_available=0,U.ins_h=0),c},qq=(q,c,U,J,Q,s)=>{if(!q)return a;let g=1;if(c===I&&(c=6),J<0?(g=0,J=-J):J>15&&(g=2,J-=16),Q<1||Q>9||U!==k||J<8||J>15||c<0||c>9||s<0||s>F)return x(q,a);8===J&&(J=9);const X=new f;return q.state=X,X.strm=q,X.wrap=g,X.gzhead=null,X.w_bits=J,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=Q+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<Q+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=c,X.strategy=s,X.method=U,E(q)};q.exports.deflateInit=(q,c)=>qq(q,c,k,15,8,v),q.exports.deflateInit2=qq,q.exports.deflateReset=E,q.exports.deflateResetKeep=A,q.exports.deflateSetHeader=(q,c)=>q&&q.state?2!==q.state.wrap?a:(q.state.gzhead=c,h):a,q.exports.deflate=(q,c)=>{let U,J;if(!q||!q.state||c>b||c<0)return q?x(q,a):a;const s=q.state;if(!q.output||!q.input&&0!==q.avail_in||s.status===Z&&c!==H)return x(q,0===q.avail_out?R:a);s.strm=q;const n=s.last_flush;if(s.last_flush=c,42===s.status)if(2===s.wrap)q.adler=0,d(s,31),d(s,139),d(s,8),s.gzhead?(d(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),d(s,255&s.gzhead.time),d(s,s.gzhead.time>>8&255),d(s,s.gzhead.time>>16&255),d(s,s.gzhead.time>>24&255),d(s,9===s.level?2:s.strategy>=C||s.level<2?4:0),d(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(d(s,255&s.gzhead.extra.length),d(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(q.adler=W(q.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(d(s,0),d(s,0),d(s,0),d(s,0),d(s,0),d(s,9===s.level?2:s.strategy>=C||s.level<2?4:0),d(s,3),s.status=S);else{let c=k+(s.w_bits-8<<4)<<8,U=-1;U=s.strategy>=C||s.level<2?0:s.level<6?1:6===s.level?2:3,c|=U<<6,0!==s.strstart&&(c|=32),c+=31-c%31,s.status=S,e(s,c),0!==s.strstart&&(e(s,q.adler>>>16),e(s,65535&q.adler)),q.adler=1}if(69===s.status)if(s.gzhead.extra){for(U=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),T(q),U=s.pending,s.pending!==s.pending_buf_size));)d(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){U=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),T(q),U=s.pending,s.pending===s.pending_buf_size)){J=1;break}J=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,d(s,J)}while(0!==J);s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),0===J&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){U=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),T(q),U=s.pending,s.pending===s.pending_buf_size)){J=1;break}J=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,d(s,J)}while(0!==J);s.gzhead.hcrc&&s.pending>U&&(q.adler=W(q.adler,s.pending_buf,s.pending-U,U)),0===J&&(s.status=G)}else s.status=G;if(s.status===G&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&T(q),s.pending+2<=s.pending_buf_size&&(d(s,255&q.adler),d(s,q.adler>>8&255),q.adler=0,s.status=S)):s.status=S),0!==s.pending){if(T(q),0===q.avail_out)return s.last_flush=-1,h}else if(0===q.avail_in&&z(c)<=z(n)&&c!==H)return x(q,R);if(s.status===Z&&0!==q.avail_in)return x(q,R);if(0!==q.avail_in||0!==s.lookahead||c!==u&&s.status!==Z){let U=s.strategy===C?((q,c)=>{let U;for(;;){if(0===q.lookahead&&(P(q),0===q.lookahead)){if(c===u)return 1;break}if(q.match_length=0,U=g(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,U&&(m(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,c===H?(m(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(m(q,!1),0===q.strm.avail_out)?1:2})(s,c):s.strategy===i?((q,c)=>{let U,J,Q,s;const X=q.window;for(;;){if(q.lookahead<=V){if(P(q),q.lookahead<=V&&c===u)return 1;if(0===q.lookahead)break}if(q.match_length=0,q.lookahead>=3&&q.strstart>0&&(Q=q.strstart-1,J=X[Q],J===X[++Q]&&J===X[++Q]&&J===X[++Q])){s=q.strstart+V;do{}while(J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&J===X[++Q]&&Q<s);q.match_length=V-(s-Q),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=3?(U=g(q,1,q.match_length-3),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(U=g(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),U&&(m(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,c===H?(m(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(m(q,!1),0===q.strm.avail_out)?1:2})(s,c):j[s.level].func(s,c);if(3!==U&&4!==U||(s.status=Z),1===U||3===U)return 0===q.avail_out&&(s.last_flush=-1),h;if(2===U&&(c===K?X(s):c!==b&&(Q(s,0,0,!1),c===r&&(y(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),T(q),0===q.avail_out))return s.last_flush=-1,h}return c!==H?h:s.wrap<=0?o:(2===s.wrap?(d(s,255&q.adler),d(s,q.adler>>8&255),d(s,q.adler>>16&255),d(s,q.adler>>24&255),d(s,255&q.total_in),d(s,q.total_in>>8&255),d(s,q.total_in>>16&255),d(s,q.total_in>>24&255)):(e(s,q.adler>>>16),e(s,65535&q.adler)),T(q),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?h:o)},q.exports.deflateEnd=q=>{if(!q||!q.state)return a;const c=q.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==G&&c!==S&&c!==Z?x(q,a):(q.state=null,c===S?x(q,p):h)},q.exports.deflateSetDictionary=(q,c)=>{let U=c.length;if(!q||!q.state)return a;const J=q.state,Q=J.wrap;if(2===Q||1===Q&&42!==J.status||J.lookahead)return a;if(1===Q&&(q.adler=n(q.adler,c,U,0)),J.wrap=0,U>=J.w_size){0===Q&&(y(J.head),J.strstart=0,J.block_start=0,J.insert=0);let q=new Uint8Array(J.w_size);q.set(c.subarray(U-J.w_size,U),0),c=q,U=J.w_size}const s=q.avail_in,g=q.next_in,X=q.input;for(q.avail_in=U,q.next_in=0,q.input=c,P(J);J.lookahead>=3;){let q=J.strstart,c=J.lookahead-2;do{J.ins_h=M(J,J.ins_h,J.window[q+3-1]),J.prev[q&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=q,q++}while(--c);J.strstart=q,J.lookahead=2,P(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=2,J.match_available=0,q.next_in=g,q.input=X,q.avail_in=s,J.wrap=Q,h},q.exports.deflateInfo="pako deflate (from Nodeca project)"},12146:q=>{"use strict";q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12137:q=>{"use strict";q.exports=function(q,c){let U,J,Q,s,g,X,n,W,D,u,K,r,H,b,h,o,a,p,R,I,t,C,i,F;const v=q.state;U=q.next_in,i=q.input,J=U+(q.avail_in-5),Q=q.next_out,F=q.output,s=Q-(c-q.avail_out),g=Q+(q.avail_out-257),X=v.dmax,n=v.wsize,W=v.whave,D=v.wnext,u=v.window,K=v.hold,r=v.bits,H=v.lencode,b=v.distcode,h=(1<<v.lenbits)-1,o=(1<<v.distbits)-1;q:do{r<15&&(K+=i[U++]<<r,r+=8,K+=i[U++]<<r,r+=8),a=H[K&h];c:for(;;){if(p=a>>>24,K>>>=p,r-=p,p=a>>>16&255,0===p)F[Q++]=65535&a;else{if(!(16&p)){if(0===(64&p)){a=H[(65535&a)+(K&(1<<p)-1)];continue c}if(32&p){v.mode=12;break q}q.Yc="invalid literal/length code",v.mode=30;break q}R=65535&a,p&=15,p&&(r<p&&(K+=i[U++]<<r,r+=8),R+=K&(1<<p)-1,K>>>=p,r-=p),r<15&&(K+=i[U++]<<r,r+=8,K+=i[U++]<<r,r+=8),a=b[K&o];U:for(;;){if(p=a>>>24,K>>>=p,r-=p,p=a>>>16&255,!(16&p)){if(0===(64&p)){a=b[(65535&a)+(K&(1<<p)-1)];continue U}q.Yc="invalid distance code",v.mode=30;break q}if(I=65535&a,p&=15,r<p&&(K+=i[U++]<<r,r+=8,r<p&&(K+=i[U++]<<r,r+=8)),I+=K&(1<<p)-1,I>X){q.Yc="invalid distance too far back",v.mode=30;break q}if(K>>>=p,r-=p,p=Q-s,I>p){if(p=I-p,p>W&&v.sane){q.Yc="invalid distance too far back",v.mode=30;break q}if(t=0,C=u,0===D){if(t+=n-p,p<R){R-=p;do{F[Q++]=u[t++]}while(--p);t=Q-I,C=F}}else if(D<p){if(t+=n+D-p,p-=D,p<R){R-=p;do{F[Q++]=u[t++]}while(--p);if(t=0,D<R){p=D,R-=p;do{F[Q++]=u[t++]}while(--p);t=Q-I,C=F}}}else if(t+=D-p,p<R){R-=p;do{F[Q++]=u[t++]}while(--p);t=Q-I,C=F}for(;R>2;)F[Q++]=C[t++],F[Q++]=C[t++],F[Q++]=C[t++],R-=3;R&&(F[Q++]=C[t++],R>1&&(F[Q++]=C[t++]))}else{t=Q-I;do{F[Q++]=F[t++],F[Q++]=F[t++],F[Q++]=F[t++],R-=3}while(R>2);R&&(F[Q++]=F[t++],R>1&&(F[Q++]=F[t++]))}break}}break}}while(U<J&&Q<g);R=r>>3,U-=R,r-=R<<3,K&=(1<<r)-1,q.next_in=U,q.next_out=Q,q.avail_in=U<J?J-U+5:5-(U-J),q.avail_out=Q<g?g-Q+257:257-(Q-g),v.hold=K,v.bits=r}},12133:(q,c,U)=>{"use strict";const J=U(12097),Q=U(12103),s=U(12137),g=U(12139),{Z_FINISH:X,Z_BLOCK:n,Z_TREES:W,Z_OK:D,Z_STREAM_END:u,Z_NEED_DICT:K,Z_STREAM_ERROR:r,Z_DATA_ERROR:H,Z_MEM_ERROR:b,Z_BUF_ERROR:h,Z_DEFLATED:o}=U(12111),a=12,p=30,R=q=>(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24);function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t=q=>{if(!q||!q.state)return r;const c=q.state;return q.total_in=q.total_out=c.total=0,q.Yc="",c.wrap&&(q.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,D},C=q=>{if(!q||!q.state)return r;const c=q.state;return c.wsize=0,c.whave=0,c.wnext=0,t(q)},i=(q,c)=>{let U;if(!q||!q.state)return r;const J=q.state;return c<0?(U=0,c=-c):(U=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?r:(null!==J.window&&J.wbits!==c&&(J.window=null),J.wrap=U,J.wbits=c,C(q))},F=(q,c)=>{if(!q)return r;const U=new I;q.state=U,U.window=null;const J=i(q,c);return J!==D&&(q.state=null),J};let v,Y,k=!0;const V=q=>{if(k){v=new Int32Array(512),Y=new Int32Array(32);let c=0;for(;c<144;)q.lens[c++]=8;for(;c<256;)q.lens[c++]=9;for(;c<280;)q.lens[c++]=7;for(;c<288;)q.lens[c++]=8;for(g(1,q.lens,0,288,v,0,q.work,{bits:9}),c=0;c<32;)q.lens[c++]=5;g(2,q.lens,0,32,Y,0,q.work,{bits:5}),k=!1}q.lencode=v,q.lenbits=9,q.distcode=Y,q.distbits=5},O=(q,c,U,J)=>{let Q;const s=q.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),J>=s.wsize?(s.window.set(c.subarray(U-s.wsize,U),0),s.wnext=0,s.whave=s.wsize):(Q=s.wsize-s.wnext,Q>J&&(Q=J),s.window.set(c.subarray(U-J,U-J+Q),s.wnext),(J-=Q)?(s.window.set(c.subarray(U-J,U),0),s.wnext=J,s.whave=s.wsize):(s.wnext+=Q,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=Q))),0};q.exports.inflateReset=C,q.exports.inflateReset2=i,q.exports.inflateResetKeep=t,q.exports.inflateInit=q=>F(q,15),q.exports.inflateInit2=F,q.exports.inflate=(q,c)=>{let U,I,t,C,i,F,v,Y,k,G,S,Z,x,z,y,M,T,m,d,e,B,N,P=0;const w=new Uint8Array(4);let L,l;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return r;U=q.state,U.mode===a&&(U.mode=13),i=q.next_out,t=q.output,v=q.avail_out,C=q.next_in,I=q.input,F=q.avail_in,Y=U.hold,k=U.bits,G=F,S=v,N=D;q:for(;;)switch(U.mode){case 1:if(0===U.wrap){U.mode=13;break}for(;k<16;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(2&U.wrap&&35615===Y){U.check=0,w[0]=255&Y,w[1]=Y>>>8&255,U.check=Q(U.check,w,2,0),Y=0,k=0,U.mode=2;break}if(U.flags=0,U.head&&(U.head.done=!1),!(1&U.wrap)||(((255&Y)<<8)+(Y>>8))%31){q.Yc="incorrect header check",U.mode=p;break}if((15&Y)!==o){q.Yc="unknown compression method",U.mode=p;break}if(Y>>>=4,k-=4,B=8+(15&Y),0===U.wbits)U.wbits=B;else if(B>U.wbits){q.Yc="invalid window size",U.mode=p;break}U.dmax=1<<U.wbits,q.adler=U.check=1,U.mode=512&Y?10:a,Y=0,k=0;break;case 2:for(;k<16;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(U.flags=Y,(255&U.flags)!==o){q.Yc="unknown compression method",U.mode=p;break}if(57344&U.flags){q.Yc="unknown header flags set",U.mode=p;break}U.head&&(U.head.text=Y>>8&1),512&U.flags&&(w[0]=255&Y,w[1]=Y>>>8&255,U.check=Q(U.check,w,2,0)),Y=0,k=0,U.mode=3;case 3:for(;k<32;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.head&&(U.head.time=Y),512&U.flags&&(w[0]=255&Y,w[1]=Y>>>8&255,w[2]=Y>>>16&255,w[3]=Y>>>24&255,U.check=Q(U.check,w,4,0)),Y=0,k=0,U.mode=4;case 4:for(;k<16;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.head&&(U.head.xflags=255&Y,U.head.os=Y>>8),512&U.flags&&(w[0]=255&Y,w[1]=Y>>>8&255,U.check=Q(U.check,w,2,0)),Y=0,k=0,U.mode=5;case 5:if(1024&U.flags){for(;k<16;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.length=Y,U.head&&(U.head.extra_len=Y),512&U.flags&&(w[0]=255&Y,w[1]=Y>>>8&255,U.check=Q(U.check,w,2,0)),Y=0,k=0}else U.head&&(U.head.extra=null);U.mode=6;case 6:if(1024&U.flags&&(Z=U.length,Z>F&&(Z=F),Z&&(U.head&&(B=U.head.extra_len-U.length,U.head.extra||(U.head.extra=new Uint8Array(U.head.extra_len)),U.head.extra.set(I.subarray(C,C+Z),B)),512&U.flags&&(U.check=Q(U.check,I,Z,C)),F-=Z,C+=Z,U.length-=Z),U.length))break q;U.length=0,U.mode=7;case 7:if(2048&U.flags){if(0===F)break q;Z=0;do{B=I[C+Z++],U.head&&B&&U.length<65536&&(U.head.name+=String.fromCharCode(B))}while(B&&Z<F);if(512&U.flags&&(U.check=Q(U.check,I,Z,C)),F-=Z,C+=Z,B)break q}else U.head&&(U.head.name=null);U.length=0,U.mode=8;case 8:if(4096&U.flags){if(0===F)break q;Z=0;do{B=I[C+Z++],U.head&&B&&U.length<65536&&(U.head.comment+=String.fromCharCode(B))}while(B&&Z<F);if(512&U.flags&&(U.check=Q(U.check,I,Z,C)),F-=Z,C+=Z,B)break q}else U.head&&(U.head.comment=null);U.mode=9;case 9:if(512&U.flags){for(;k<16;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(Y!==(65535&U.check)){q.Yc="header crc mismatch",U.mode=p;break}Y=0,k=0}U.head&&(U.head.hcrc=U.flags>>9&1,U.head.done=!0),q.adler=U.check=0,U.mode=a;break;case 10:for(;k<32;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}q.adler=U.check=R(Y),Y=0,k=0,U.mode=11;case 11:if(0===U.havedict)return q.next_out=i,q.avail_out=v,q.next_in=C,q.avail_in=F,U.hold=Y,U.bits=k,K;q.adler=U.check=1,U.mode=a;case a:if(c===n||c===W)break q;case 13:if(U.last){Y>>>=7&k,k-=7&k,U.mode=27;break}for(;k<3;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}switch(U.last=1&Y,Y>>>=1,k-=1,3&Y){case 0:U.mode=14;break;case 1:if(V(U),U.mode=20,c===W){Y>>>=2,k-=2;break q}break;case 2:U.mode=17;break;case 3:q.Yc="invalid block type",U.mode=p}Y>>>=2,k-=2;break;case 14:for(Y>>>=7&k,k-=7&k;k<32;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if((65535&Y)!==(Y>>>16^65535)){q.Yc="invalid stored block lengths",U.mode=p;break}if(U.length=65535&Y,Y=0,k=0,U.mode=15,c===W)break q;case 15:U.mode=16;case 16:if(Z=U.length,Z){if(Z>F&&(Z=F),Z>v&&(Z=v),0===Z)break q;t.set(I.subarray(C,C+Z),i),F-=Z,C+=Z,v-=Z,i+=Z,U.length-=Z;break}U.mode=a;break;case 17:for(;k<14;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(U.nlen=257+(31&Y),Y>>>=5,k-=5,U.ndist=1+(31&Y),Y>>>=5,k-=5,U.ncode=4+(15&Y),Y>>>=4,k-=4,U.nlen>286||U.ndist>30){q.Yc="too many length or distance symbols",U.mode=p;break}U.have=0,U.mode=18;case 18:for(;U.have<U.ncode;){for(;k<3;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.lens[j[U.have++]]=7&Y,Y>>>=3,k-=3}for(;U.have<19;)U.lens[j[U.have++]]=0;if(U.lencode=U.lendyn,U.lenbits=7,L={bits:U.lenbits},N=g(0,U.lens,0,19,U.lencode,0,U.work,L),U.lenbits=L.bits,N){q.Yc="invalid code lengths set",U.mode=p;break}U.have=0,U.mode=19;case 19:for(;U.have<U.nlen+U.ndist;){for(;P=U.lencode[Y&(1<<U.lenbits)-1],y=P>>>24,M=P>>>16&255,T=65535&P,!(y<=k);){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(T<16)Y>>>=y,k-=y,U.lens[U.have++]=T;else{if(16===T){for(l=y+2;k<l;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(Y>>>=y,k-=y,0===U.have){q.Yc="invalid bit length repeat",U.mode=p;break}B=U.lens[U.have-1],Z=3+(3&Y),Y>>>=2,k-=2}else if(17===T){for(l=y+3;k<l;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}Y>>>=y,k-=y,B=0,Z=3+(7&Y),Y>>>=3,k-=3}else{for(l=y+7;k<l;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}Y>>>=y,k-=y,B=0,Z=11+(127&Y),Y>>>=7,k-=7}if(U.have+Z>U.nlen+U.ndist){q.Yc="invalid bit length repeat",U.mode=p;break}for(;Z--;)U.lens[U.have++]=B}}if(U.mode===p)break;if(0===U.lens[256]){q.Yc="invalid code -- missing end-of-block",U.mode=p;break}if(U.lenbits=9,L={bits:U.lenbits},N=g(1,U.lens,0,U.nlen,U.lencode,0,U.work,L),U.lenbits=L.bits,N){q.Yc="invalid literal/lengths set",U.mode=p;break}if(U.distbits=6,U.distcode=U.distdyn,L={bits:U.distbits},N=g(2,U.lens,U.nlen,U.ndist,U.distcode,0,U.work,L),U.distbits=L.bits,N){q.Yc="invalid distances set",U.mode=p;break}if(U.mode=20,c===W)break q;case 20:U.mode=21;case 21:if(F>=6&&v>=258){q.next_out=i,q.avail_out=v,q.next_in=C,q.avail_in=F,U.hold=Y,U.bits=k,s(q,S),i=q.next_out,t=q.output,v=q.avail_out,C=q.next_in,I=q.input,F=q.avail_in,Y=U.hold,k=U.bits,U.mode===a&&(U.back=-1);break}for(U.back=0;P=U.lencode[Y&(1<<U.lenbits)-1],y=P>>>24,M=P>>>16&255,T=65535&P,!(y<=k);){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(M&&0===(240&M)){for(m=y,d=M,e=T;P=U.lencode[e+((Y&(1<<m+d)-1)>>m)],y=P>>>24,M=P>>>16&255,T=65535&P,!(m+y<=k);){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}Y>>>=m,k-=m,U.back+=m}if(Y>>>=y,k-=y,U.back+=y,U.length=T,0===M){U.mode=26;break}if(32&M){U.back=-1,U.mode=a;break}if(64&M){q.Yc="invalid literal/length code",U.mode=p;break}U.extra=15&M,U.mode=22;case 22:if(U.extra){for(l=U.extra;k<l;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.length+=Y&(1<<U.extra)-1,Y>>>=U.extra,k-=U.extra,U.back+=U.extra}U.was=U.length,U.mode=23;case 23:for(;P=U.distcode[Y&(1<<U.distbits)-1],y=P>>>24,M=P>>>16&255,T=65535&P,!(y<=k);){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(0===(240&M)){for(m=y,d=M,e=T;P=U.distcode[e+((Y&(1<<m+d)-1)>>m)],y=P>>>24,M=P>>>16&255,T=65535&P,!(m+y<=k);){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}Y>>>=m,k-=m,U.back+=m}if(Y>>>=y,k-=y,U.back+=y,64&M){q.Yc="invalid distance code",U.mode=p;break}U.offset=T,U.extra=15&M,U.mode=24;case 24:if(U.extra){for(l=U.extra;k<l;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}U.offset+=Y&(1<<U.extra)-1,Y>>>=U.extra,k-=U.extra,U.back+=U.extra}if(U.offset>U.dmax){q.Yc="invalid distance too far back",U.mode=p;break}U.mode=25;case 25:if(0===v)break q;if(Z=S-v,U.offset>Z){if(Z=U.offset-Z,Z>U.whave&&U.sane){q.Yc="invalid distance too far back",U.mode=p;break}Z>U.wnext?(Z-=U.wnext,x=U.wsize-Z):x=U.wnext-Z,Z>U.length&&(Z=U.length),z=U.window}else z=t,x=i-U.offset,Z=U.length;Z>v&&(Z=v),v-=Z,U.length-=Z;do{t[i++]=z[x++]}while(--Z);0===U.length&&(U.mode=21);break;case 26:if(0===v)break q;t[i++]=U.length,v--,U.mode=21;break;case 27:if(U.wrap){for(;k<32;){if(0===F)break q;F--,Y|=I[C++]<<k,k+=8}if(S-=v,q.total_out+=S,U.total+=S,S&&(q.adler=U.check=U.flags?Q(U.check,t,S,i-S):J(U.check,t,S,i-S)),S=v,(U.flags?Y:R(Y))!==U.check){q.Yc="incorrect data check",U.mode=p;break}Y=0,k=0}U.mode=28;case 28:if(U.wrap&&U.flags){for(;k<32;){if(0===F)break q;F--,Y+=I[C++]<<k,k+=8}if(Y!==(4294967295&U.total)){q.Yc="incorrect length check",U.mode=p;break}Y=0,k=0}U.mode=29;case 29:N=u;break q;case p:N=H;break q;case 31:return b;default:return r}return q.next_out=i,q.avail_out=v,q.next_in=C,q.avail_in=F,U.hold=Y,U.bits=k,(U.wsize||S!==q.avail_out&&U.mode<p&&(U.mode<27||c!==X))&&O(q,q.output,q.next_out,S-q.avail_out)?(U.mode=31,b):(G-=q.avail_in,S-=q.avail_out,q.total_in+=G,q.total_out+=S,U.total+=S,U.wrap&&S&&(q.adler=U.check=U.flags?Q(U.check,t,S,q.next_out-S):J(U.check,t,S,q.next_out-S)),q.data_type=U.bits+(U.last?64:0)+(U.mode===a?128:0)+(20===U.mode||15===U.mode?256:0),(0===G&&0===S||c===X)&&N===D&&(N=h),N)},q.exports.inflateEnd=q=>{if(!q||!q.state)return r;let c=q.state;return c.window&&(c.window=null),q.state=null,D},q.exports.inflateGetHeader=(q,c)=>{if(!q||!q.state)return r;const U=q.state;return 0===(2&U.wrap)?r:(U.head=c,c.done=!1,D)},q.exports.inflateSetDictionary=(q,c)=>{const U=c.length;let Q,s,g;return q&&q.state?(Q=q.state,0!==Q.wrap&&11!==Q.mode?r:11===Q.mode&&(s=1,s=J(s,c,U,0),s!==Q.check)?H:(g=O(q,c,U,U),g?(Q.mode=31,b):(Q.havedict=1,D))):r},q.exports.inflateInfo="pako inflate (from Nodeca project)"},12139:q=>{"use strict";const c=15,U=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),J=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),s=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);q.exports=(q,g,X,n,W,D,u,K)=>{const r=K.bits;let H,b,h,o,a,p,R=0,I=0,t=0,C=0,i=0,F=0,v=0,Y=0,k=0,V=0,O=null,G=0;const S=new Uint16Array(16),Z=new Uint16Array(16);let x,z,y,M=null,T=0;for(R=0;R<=c;R++)S[R]=0;for(I=0;I<n;I++)S[g[X+I]]++;for(i=r,C=c;C>=1&&0===S[C];C--);if(i>C&&(i=C),0===C)return W[D++]=20971520,W[D++]=20971520,K.bits=1,0;for(t=1;t<C&&0===S[t];t++);for(i<t&&(i=t),Y=1,R=1;R<=c;R++)if(Y<<=1,Y-=S[R],Y<0)return-1;if(Y>0&&(0===q||1!==C))return-1;for(Z[1]=0,R=1;R<c;R++)Z[R+1]=Z[R]+S[R];for(I=0;I<n;I++)0!==g[X+I]&&(u[Z[g[X+I]]++]=I);if(0===q?(O=M=u,p=19):1===q?(O=U,G-=257,M=J,T-=257,p=256):(O=Q,M=s,p=-1),V=0,I=0,R=t,a=D,F=i,v=0,h=-1,k=1<<i,o=k-1,1===q&&k>852||2===q&&k>592)return 1;for(;;){x=R-v,u[I]<p?(z=0,y=u[I]):u[I]>p?(z=M[T+u[I]],y=O[G+u[I]]):(z=96,y=0),H=1<<R-v,b=1<<F,t=b;do{b-=H,W[a+(V>>v)+b]=x<<24|z<<16|y}while(0!==b);for(H=1<<R-1;V&H;)H>>=1;if(0!==H?(V&=H-1,V+=H):V=0,I++,0===--S[R]){if(R===C)break;R=g[X+u[I]]}if(R>i&&(V&o)!==h){for(0===v&&(v=i),a+=t,F=R-v,Y=1<<F;F+v<C&&(Y-=S[F+v],!(Y<=0));)F++,Y<<=1;if(k+=1<<F,1===q&&k>852||2===q&&k>592)return 1;h=V&o,W[h]=i<<24|F<<16|a-D}}return 0!==V&&(W[a+V]=R-v<<24|64<<16),K.bits=i,0}},12105:q=>{"use strict";q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12088:q=>{"use strict";function c(q){let c=q.length;for(;--c>=0;)q[c]=0}const U=256,J=286,Q=30,s=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=new Array(576);c(D);const u=new Array(60);c(u);const K=new Array(512);c(K);const r=new Array(256);c(r);const H=new Array(29);c(H);const b=new Array(Q);function h(q,c,U,J,Q){this.static_tree=q,this.extra_bits=c,this.extra_base=U,this.elems=J,this.max_length=Q,this.has_stree=q&&q.length}let o,a,p;function R(q,c){this.dyn_tree=q,this.max_code=0,this.stat_desc=c}c(b);const I=q=>q<256?K[q]:K[256+(q>>>7)],t=(q,c)=>{q.pending_buf[q.pending++]=255&c,q.pending_buf[q.pending++]=c>>>8&255},C=(q,c,U)=>{q.bi_valid>16-U?(q.bi_buf|=c<<q.bi_valid&65535,t(q,q.bi_buf),q.bi_buf=c>>16-q.bi_valid,q.bi_valid+=U-16):(q.bi_buf|=c<<q.bi_valid&65535,q.bi_valid+=U)},i=(q,c,U)=>{C(q,U[2*c],U[2*c+1])},F=(q,c)=>{let U=0;do{U|=1&q,q>>>=1,U<<=1}while(--c>0);return U>>>1},v=(q,c,U)=>{const J=new Array(16);let Q,g,X=0;for(Q=1;Q<=s;Q++)J[Q]=X=X+U[Q-1]<<1;for(g=0;g<=c;g++){let c=q[2*g+1];0!==c&&(q[2*g]=F(J[c]++,c))}},Y=q=>{let c;for(c=0;c<J;c++)q.dyn_ltree[2*c]=0;for(c=0;c<Q;c++)q.dyn_dtree[2*c]=0;for(c=0;c<19;c++)q.bl_tree[2*c]=0;q.dyn_ltree[512]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0},k=q=>{q.bi_valid>8?t(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0},V=(q,c,U,J)=>{const Q=2*c,s=2*U;return q[Q]<q[s]||q[Q]===q[s]&&J[c]<=J[U]},O=(q,c,U)=>{const J=q.heap[U];let Q=U<<1;for(;Q<=q.heap_len&&(Q<q.heap_len&&V(c,q.heap[Q+1],q.heap[Q],q.depth)&&Q++,!V(c,J,q.heap[Q],q.depth));)q.heap[U]=q.heap[Q],U=Q,Q<<=1;q.heap[U]=J},G=(q,c,J)=>{let Q,s,n,W,D=0;if(0!==q.last_lit)do{Q=q.pending_buf[q.d_buf+2*D]<<8|q.pending_buf[q.d_buf+2*D+1],s=q.pending_buf[q.l_buf+D],D++,0===Q?i(q,s,c):(n=r[s],i(q,n+U+1,c),W=g[n],0!==W&&(s-=H[n],C(q,s,W)),Q--,n=I(Q),i(q,n,J),W=X[n],0!==W&&(Q-=b[n],C(q,Q,W)))}while(D<q.last_lit);i(q,256,c)},S=(q,c)=>{const U=c.dyn_tree,J=c.stat_desc.static_tree,Q=c.stat_desc.has_stree,g=c.stat_desc.elems;let X,n,W,D=-1;for(q.heap_len=0,q.heap_max=573,X=0;X<g;X++)0!==U[2*X]?(q.heap[++q.heap_len]=D=X,q.depth[X]=0):U[2*X+1]=0;for(;q.heap_len<2;)W=q.heap[++q.heap_len]=D<2?++D:0,U[2*W]=1,q.depth[W]=0,q.opt_len--,Q&&(q.static_len-=J[2*W+1]);for(c.max_code=D,X=q.heap_len>>1;X>=1;X--)O(q,U,X);W=g;do{X=q.heap[1],q.heap[1]=q.heap[q.heap_len--],O(q,U,1),n=q.heap[1],q.heap[--q.heap_max]=X,q.heap[--q.heap_max]=n,U[2*W]=U[2*X]+U[2*n],q.depth[W]=(q.depth[X]>=q.depth[n]?q.depth[X]:q.depth[n])+1,U[2*X+1]=U[2*n+1]=W,q.heap[1]=W++,O(q,U,1)}while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],((q,c)=>{const U=c.dyn_tree,J=c.max_code,Q=c.stat_desc.static_tree,g=c.stat_desc.has_stree,X=c.stat_desc.extra_bits,n=c.stat_desc.extra_base,W=c.stat_desc.max_length;let D,u,K,r,H,b,h=0;for(r=0;r<=s;r++)q.bl_count[r]=0;for(U[2*q.heap[q.heap_max]+1]=0,D=q.heap_max+1;D<573;D++)u=q.heap[D],r=U[2*U[2*u+1]+1]+1,r>W&&(r=W,h++),U[2*u+1]=r,u>J||(q.bl_count[r]++,H=0,u>=n&&(H=X[u-n]),b=U[2*u],q.opt_len+=b*(r+H),g&&(q.static_len+=b*(Q[2*u+1]+H)));if(0!==h){do{for(r=W-1;0===q.bl_count[r];)r--;q.bl_count[r]--,q.bl_count[r+1]+=2,q.bl_count[W]--,h-=2}while(h>0);for(r=W;0!==r;r--)for(u=q.bl_count[r];0!==u;)K=q.heap[--D],K>J||(U[2*K+1]!==r&&(q.opt_len+=(r-U[2*K+1])*U[2*K],U[2*K+1]=r),u--)}})(q,c),v(U,D,q.bl_count)},Z=(q,c,U)=>{let J,Q,s=-1,g=c[1],X=0,n=7,W=4;for(0===g&&(n=138,W=3),c[2*(U+1)+1]=65535,J=0;J<=U;J++)Q=g,g=c[2*(J+1)+1],++X<n&&Q===g||(X<W?q.bl_tree[2*Q]+=X:0!==Q?(Q!==s&&q.bl_tree[2*Q]++,q.bl_tree[32]++):X<=10?q.bl_tree[34]++:q.bl_tree[36]++,X=0,s=Q,0===g?(n=138,W=3):Q===g?(n=6,W=3):(n=7,W=4))},x=(q,c,U)=>{let J,Q,s=-1,g=c[1],X=0,n=7,W=4;for(0===g&&(n=138,W=3),J=0;J<=U;J++)if(Q=g,g=c[2*(J+1)+1],!(++X<n&&Q===g)){if(X<W)do{i(q,Q,q.bl_tree)}while(0!==--X);else 0!==Q?(Q!==s&&(i(q,Q,q.bl_tree),X--),i(q,16,q.bl_tree),C(q,X-3,2)):X<=10?(i(q,17,q.bl_tree),C(q,X-3,3)):(i(q,18,q.bl_tree),C(q,X-11,7));X=0,s=Q,0===g?(n=138,W=3):Q===g?(n=6,W=3):(n=7,W=4)}};let z=!1;const y=(q,c,U,J)=>{C(q,0+(J?1:0),3),((q,c,U,J)=>{k(q),J&&(t(q,U),t(q,~U)),q.pending_buf.set(q.window.subarray(c,c+U),q.pending),q.pending+=U})(q,c,U,!0)};q.exports._tr_init=q=>{z||((()=>{let q,c,U,W,R;const I=new Array(16);for(U=0,W=0;W<28;W++)for(H[W]=U,q=0;q<1<<g[W];q++)r[U++]=W;for(r[U-1]=W,R=0,W=0;W<16;W++)for(b[W]=R,q=0;q<1<<X[W];q++)K[R++]=W;for(R>>=7;W<Q;W++)for(b[W]=R<<7,q=0;q<1<<X[W]-7;q++)K[256+R++]=W;for(c=0;c<=s;c++)I[c]=0;for(q=0;q<=143;)D[2*q+1]=8,q++,I[8]++;for(;q<=255;)D[2*q+1]=9,q++,I[9]++;for(;q<=279;)D[2*q+1]=7,q++,I[7]++;for(;q<=287;)D[2*q+1]=8,q++,I[8]++;for(v(D,287,I),q=0;q<Q;q++)u[2*q+1]=5,u[2*q]=F(q,5);o=new h(D,g,257,J,s),a=new h(u,X,0,Q,s),p=new h(new Array(0),n,0,19,7)})(),z=!0),q.l_desc=new R(q.dyn_ltree,o),q.d_desc=new R(q.dyn_dtree,a),q.bl_desc=new R(q.bl_tree,p),q.bi_buf=0,q.bi_valid=0,Y(q)},q.exports._tr_stored_block=y,q.exports._tr_flush_block=(q,c,J,Q)=>{let s,g,X=0;q.level>0?(2===q.strm.data_type&&(q.strm.data_type=(q=>{let c,J=4093624447;for(c=0;c<=31;c++,J>>>=1)if(1&J&&0!==q.dyn_ltree[2*c])return 0;if(0!==q.dyn_ltree[18]||0!==q.dyn_ltree[20]||0!==q.dyn_ltree[26])return 1;for(c=32;c<U;c++)if(0!==q.dyn_ltree[2*c])return 1;return 0})(q)),S(q,q.l_desc),S(q,q.d_desc),X=(q=>{let c;for(Z(q,q.dyn_ltree,q.l_desc.max_code),Z(q,q.dyn_dtree,q.d_desc.max_code),S(q,q.bl_desc),c=18;c>=3&&0===q.bl_tree[2*W[c]+1];c--);return q.opt_len+=3*(c+1)+5+5+4,c})(q),s=q.opt_len+3+7>>>3,g=q.static_len+3+7>>>3,g<=s&&(s=g)):s=g=J+5,J+4<=s&&-1!==c?y(q,c,J,Q):4===q.strategy||g===s?(C(q,2+(Q?1:0),3),G(q,D,u)):(C(q,4+(Q?1:0),3),((q,c,U,J)=>{let Q;for(C(q,c-257,5),C(q,U-1,5),C(q,J-4,4),Q=0;Q<J;Q++)C(q,q.bl_tree[2*W[Q]+1],3);x(q,q.dyn_ltree,c-1),x(q,q.dyn_dtree,U-1)})(q,q.l_desc.max_code+1,q.d_desc.max_code+1,X+1),G(q,q.dyn_ltree,q.dyn_dtree)),Y(q),Q&&k(q)},q.exports._tr_tally=(q,c,J)=>(q.pending_buf[q.d_buf+2*q.last_lit]=c>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&c,q.pending_buf[q.l_buf+q.last_lit]=255&J,q.last_lit++,0===c?q.dyn_ltree[2*J]++:(q.matches++,c--,q.dyn_ltree[2*(r[J]+U+1)]++,q.dyn_dtree[2*I(c)]++),q.last_lit===q.lit_bufsize-1),q.exports._tr_align=q=>{C(q,2,3),i(q,256,D),(q=>{16===q.bi_valid?(t(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(q)}},12126:q=>{"use strict";q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Yc="",this.state=null,this.data_type=2,this.adler=0}},11738:q=>{function c(q,c,U){for(var J=q.length,Q=-1/0,s=1/0,g=0;g<J;g++){var X=(U[0][g]-q[g])/c[g],n=(U[1][g]-q[g])/c[g];if(X>n){var W=X;X=n,n=W}if(n<Q||X>s)return 1/0;X>Q&&(Q=X),n<s&&(s=n)}return Q>s?1/0:Q}q.exports=function(q,U,J,Q){var s=c(U,J,Q);if(s===1/0)q=null;else{q=q||[];for(var g=0;g<U.length;g++)q[g]=U[g]+J[g]*s}return q},q.exports.distance=c},13104:(q,c,U)=>{"use strict";U.d(c,{b:()=>g});var J=U(38);const Q=J.useLayoutEffect;const s=function(q){var c=(0,J.useRef)(q);return Q((function(){c.current=q})),c};var g=function(q){var c=s(q);(0,J.oc)((function(){var q=function(q){var U;if(null!=c.current&&(U=c.current(q)),q.defaultPrevented&&(q.returnValue=""),"string"===typeof U)return q.returnValue=U,U};return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[])}},13067:(q,c,U)=>{"use strict";var J=U(13070),Q=Array.prototype.concat,s=Array.prototype.slice,g=q.exports=function(q){for(var c=[],U=0,g=q.length;U<g;U++){var X=q[U];J(X)?c=Q.call(c,s.call(X)):c.push(X)}return c};g.wrap=function(q){return function(){return q(g(arguments))}}},13070:q=>{q.exports=function(q){return!(!q||"string"===typeof q)&&(q instanceof Array||Array.isArray(q)||q.length>=0&&(q.splice instanceof Function||Object.getOwnPropertyDescriptor(q,q.length-1)&&"String"!==q.constructor.name))}},12026:(q,c,U)=>{var J=U(12032);function Q(q){for(var c,U,Q=0,s=q.length,g=0;g<q.length;){for(c=q[g],U=0;g<s&&q[g]===c;)++g,++U;Q+=J.log2(U)/7|0,Q+=J.log2(c>>>0)/7|0,Q+=2}return Q}c.size=Q,c.encode=function(q,c){c||(c=new Uint8Array(Q(q)));for(var U,J,s=0,g=c.length,X=0;X<q.length;){for(U=q[X],J=0;X<q.length&&q[X]===U;)++X,++J;for(;s<g&&J>=128;)c[s++]=128+(127&J),J>>>=7;if(s>=g)throw new Error("RLE buffer overflow");for(c[s++]=J,U>>>=0;s<g&&U>=128;)c[s++]=128+(127&U),U>>>=7;if(s>=g)throw new Error("RLE buffer overflow");c[s++]=U}return c},c.decode=function(q,c){for(var U,J,Q,s,g=c.length,X=q.length,n=0,W=0;W<X;){for(U=0,J=0;W<X&&q[W]>=128;)U+=(127&q[W++])<<J,J+=7;if(U+=q[W++]<<J,W>=X)throw new Error("RLE buffer underrun");if(n+U>g)throw new Error("Chunk buffer overflow");for(Q=0,J=0;W<X&&q[W]>=128;)Q+=(127&q[W++])<<J,J+=7;if(W>=X)throw new Error("RLE buffer underrun");for(Q+=q[W++]<<J,s=0;s<U;++s)c[n++]=Q}return c}},12032:(q,c)=>{"use strict";function U(q){var c=32;return(q&=-q)&&c--,65535&q&&(c-=16),16711935&q&&(c-=8),252645135&q&&(c-=4),858993459&q&&(c-=2),1431655765&q&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(q){return(q>0)-(q<0)},c.abs=function(q){var c=q>>31;return(q^c)-c},c.min=function(q,c){return c^(q^c)&-(q<c)},c.max=function(q,c){return q^(q^c)&-(q<c)},c.isPow2=function(q){return!(q&q-1)&&!!q},c.log2=function(q){var c,U;return c=(q>65535)<<4,c|=U=((q>>>=c)>255)<<3,c|=U=((q>>>=U)>15)<<2,(c|=U=((q>>>=U)>3)<<1)|(q>>>=U)>>1},c.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},c.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},c.countTrailingZeros=U,c.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},c.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},c.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var J=new Array(256);!function(q){for(var c=0;c<256;++c){var U=c,J=c,Q=7;for(U>>>=1;U;U>>>=1)J<<=1,J|=1&U,--Q;q[c]=J<<Q&255}}(J),c.reverse=function(q){return J[255&q]<<24|J[q>>>8&255]<<16|J[q>>>16&255]<<8|J[q>>>24&255]},c.interleave2=function(q,c){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(q,c){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>c&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},c.interleave3=function(q,c,U){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<2},c.deinterleave3=function(q,c){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>c&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},c.nextCombination=function(q){var c=q|q-1;return c+1|(~c&-~c)-1>>>U(q)+1}},12060:q=>{"use strict";q.exports=function(q,c,U,J){var Q=self||window;try{try{var s;try{s=new Q.Blob([q])}catch(W){(s=new(Q.BlobBuilder||Q.WebKitBlobBuilder||Q.MozBlobBuilder||Q.MSBlobBuilder)).append(q),s=s.getBlob()}var g=Q.URL||Q.webkitURL,X=g.createObjectURL(s),n=new Q[c](X,U);return g.revokeObjectURL(X),n}catch(W){return new Q[c]("data:application/javascript,".concat(encodeURIComponent(q)),U)}}catch(W){if(!J)throw Error("Inline worker is not supported");return new Q[c](J,U)}}},11721:(q,c,U)=>{"use strict";function J(q,c,U,J,Q){var s={};return Object.keys(J).forEach((function(q){s[q]=J[q]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=U.slice().reverse().reduce((function(U,J){return J(q,c,U)||U}),s),Q&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(Q):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(q,c,s),s=null),s}U.d(c,{e:()=>J})},11717:(q,c,U)=>{"use strict";function J(q,c,U,J){U&&Object.defineProperty(q,c,{enumerable:U.enumerable,configurable:U.configurable,writable:U.writable,value:U.initializer?U.initializer.call(J):void 0})}U.d(c,{e:()=>J})},13096:(q,c,U)=>{"use strict";U.d(c,{d:()=>g,f:()=>u,i:()=>X,k:()=>s,o:()=>n,s:()=>Q,u:()=>W,v:()=>D});var J=U(11266);class Q{constructor(){this._easingMode=Q.EASINGMODE_EASEIN}setEasingMode(q){const c=Math.min(Math.max(q,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(q){throw new Error("You must implement this method")}ease(q){switch(this._easingMode){case Q.EASINGMODE_EASEIN:return this.easeInCore(q);case Q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-q)}return q>=.5?.5*(1-this.easeInCore(2*(1-q)))+.5:.5*this.easeInCore(2*q)}}Q.EASINGMODE_EASEIN=0,Q.EASINGMODE_EASEOUT=1,Q.EASINGMODE_EASEINOUT=2;class s extends Q{easeInCore(q){return q=Math.max(0,Math.min(1,q)),1-Math.sqrt(1-q*q)}}class g extends Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=q}easeInCore(q){const c=Math.max(0,this.amplitude);return Math.pow(q,3)-q*c*Math.sin(3.141592653589793*q)}}class X extends Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=q,this.bounciness=c}easeInCore(q){const c=Math.max(0,this.bounces);let U=this.bounciness;U<=1&&(U=1.001);const J=Math.pow(U,c),Q=1-U,s=(1-J)/Q+.5*J,g=q*s,X=Math.log(-g*(1-U)+1)/Math.log(U),n=Math.floor(X),W=n+1,D=(1-Math.pow(U,n))/(Q*s),u=.5*(D+(1-Math.pow(U,W))/(Q*s)),K=q-u,r=u-D;return-Math.pow(1/U,c-n)/(r*r)*(K-r)*(K+r)}}class n extends Q{easeInCore(q){return q*q*q}}class W extends Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=q,this.springiness=c}easeInCore(q){let c;const U=Math.max(0,this.oscillations),J=Math.max(0,this.springiness);return c=0==J?q:(Math.exp(J*q)-1)/(Math.exp(J)-1),c*Math.sin((6.283185307179586*U+1.5707963267948966)*q)}}class D extends Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=q}easeInCore(q){return this.exponent<=0?q:(Math.exp(this.exponent*q)-1)/(Math.exp(this.exponent)-1)}}class u extends Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=q,this.y1=c,this.x2=U,this.y2=J}easeInCore(q){return J.e.Interpolate(q,this.x1,this.y1,this.x2,this.y2)}}},12580:(q,c,U)=>{"use strict";U.d(c,{b:()=>g});var J=U(10833),Q=U(10845),s=U(11113);class g extends s.b{get _matrix(){return this._compose(),this.CK}set _matrix(q){(q.updateFlag!==this.CK.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.CK.X(q),this._markAsDirtyAndDecompose())}constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(q,c.Cq(),!1),this.name=q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.CK=(null===Q||void 0===Q?void 0:Q.clone())??J.d.Identity(),this._restMatrix=s??this.CK.clone(),this._bindMatrix=g??this.CK.clone(),this._index=X,this._absoluteMatrix=new J.d,this._absoluteBindMatrix=new J.d,this._absoluteInverseBindMatrix=new J.d,this._finalMatrix=new J.d,c.bones.push(this),this.setParent(U,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(q){this.setParent(q)}setParent(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==q){if(this.parent){const q=this.parent.children.indexOf(this);-1!==q&&this.parent.children.splice(q,1)}this._parentNode=q,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.PW()}}getLocalMatrix(){return this._compose(),this.CK}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(q){this._restMatrix.X(q)}setRestPose(q){this.setRestMatrix(q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(q){this.vc(q)}setBindPose(q){this.setBindMatrix(q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const q=J.j.hc[0],c=J.j.Quaternion[0],U=J.j.hc[1];this.getRestMatrix().decompose(q,c,U),this._linkedTransformNode.position.X(U),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??J.g.Identity(),this._linkedTransformNode.rotationQuaternion.X(c),this._linkedTransformNode.ac.X(q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.gn}set position(q){this._decompose(),this.gn.X(q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(q){this.setRotation(q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(q){this.setRotationQuaternion(q)}get ac(){return this.getScale()}set ac(q){this.setScale(q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=J.p.Zero(),this._localRotation=J.g.Zero(),this.gn=J.p.Zero()),this.CK.decompose(this._localScaling,this._localRotation,this.gn))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,J.d.ComposeToRef(this._localScaling,this._localRotation,this.gn,this.CK)):this._needToCompose=!1)}vc(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.X(q),c&&this._updateAbsoluteBindMatrices(),U?this._matrix=q:this.PW()}_updateAbsoluteBindMatrices(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q||(q=this._bindMatrix),this.parent?q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.X(q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let U=0;U<this.children.length;U++)this.children[U]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}PW(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.PW(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.PW(),this._needToDecompose=!0}_updatePosition(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=this.getLocalMatrix();if(0==c)Q?(s.addAtIndex(12,q.x),s.addAtIndex(13,q.y),s.addAtIndex(14,q.z)):s.setTranslationFromFloats(q.x,q.y,q.z);else{let c=null;U&&(c=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=g._TmpMats[0],n=g._TmpVecs[0];this.parent?U&&c?(X.X(this.parent.getAbsoluteMatrix()),X.multiplyToRef(c,X)):X.X(this.parent.getAbsoluteMatrix()):J.d.IdentityToRef(X),Q&&X.setTranslationFromFloats(0,0,0),X.invert(),J.p.TransformCoordinatesToRef(q,X,n),Q?(s.addAtIndex(12,n.x),s.addAtIndex(13,n.y),s.addAtIndex(14,n.z)):s.setTranslationFromFloats(n.x,n.y,n.z)}this._markAsDirtyAndDecompose()}translate(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,c,U,!0)}setPosition(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,c,U,!1)}setAbsolutePosition(q,c){this.setPosition(q,1,c)}scale(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=this.getLocalMatrix(),X=g._TmpMats[0];J.d.ScalingToRef(q,c,U,X),X.multiplyToRef(s,s),X.invert();for(const J of this.children){const Q=J.getLocalMatrix();Q.multiplyToRef(X,Q),Q.multiplyAtIndex(12,q),Q.multiplyAtIndex(13,c),Q.multiplyAtIndex(14,U),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Q)for(const J of this.children)J.scale(q,c,U,Q)}setScale(q){this._decompose(),this._localScaling.X(q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(q){this._decompose(),q.X(this._localScaling)}setYawPitchRoll(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;if(0===Q){const X=g._TmpQuat;return J.g.RotationYawPitchRollToRef(q,c,U,X),void this.setRotationQuaternion(X,Q,s)}const X=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,s))return;const n=g._TmpMats[1];J.d.RotationYawPitchRollToRef(q,c,U,n),X.multiplyToRef(n,n),this._rotateWithMatrix(n,Q,s)}rotate(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;const s=g._TmpMats[0];s.setTranslationFromFloats(0,0,0),J.d.RotationAxisToRef(q,c,s),this._rotateWithMatrix(s,U,Q)}setAxisAngle(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;if(0===U){const s=g._TmpQuat;return J.g.RotationAxisToRef(q,c,s),void this.setRotationQuaternion(s,U,Q)}const s=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,Q))return;const X=g._TmpMats[1];J.d.RotationAxisToRef(q,c,X),s.multiplyToRef(X,X),this._rotateWithMatrix(X,U,Q)}setRotation(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(q.y,q.x,q.z,c,U)}setRotationQuaternion(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.X(q),void this._markAsDirtyAndCompose();const Q=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,U))return;const s=g._TmpMats[1];J.d.FromQuaternionToRef(q,s),Q.multiplyToRef(s,s),this._rotateWithMatrix(s,c,U)}setRotationMatrix(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;if(0===c){const Q=g._TmpQuat;return J.g.FromRotationMatrixToRef(q,Q),void this.setRotationQuaternion(Q,c,U)}const Q=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,U))return;const s=g._TmpMats[1];s.X(q),Q.multiplyToRef(q,s),this._rotateWithMatrix(s,c,U)}_rotateWithMatrix(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;const J=this.getLocalMatrix(),Q=J.m[12],s=J.m[13],X=J.m[14],n=this.getParent(),W=g._TmpMats[3],D=g._TmpMats[4];n&&1==c?(U?(W.X(U.getWorldMatrix()),n.getAbsoluteMatrix().multiplyToRef(W,W)):W.X(n.getAbsoluteMatrix()),D.X(W),D.invert(),J.multiplyToRef(W,J),J.multiplyToRef(q,J),J.multiplyToRef(D,J)):1==c&&U?(W.X(U.getWorldMatrix()),D.X(W),D.invert(),J.multiplyToRef(W,J),J.multiplyToRef(q,J),J.multiplyToRef(D,J)):J.multiplyToRef(q,J),J.setTranslationFromFloats(Q,s,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(q,c){const U=g._TmpMats[2];return q.X(this.getAbsoluteMatrix()),c?(q.multiplyToRef(c.getWorldMatrix(),q),J.d.ScalingToRef(c.ac.x,c.ac.y,c.ac.z,U)):J.d.IdentityToRef(U),q.invert(),!isNaN(q.m[0])&&(U.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyToRef(U,q),!0)}Xc(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.p.Zero();return this.getPositionToRef(q,c,U),U}getPositionToRef(){let q=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const q=this.getLocalMatrix();c.x=q.m[12],c.y=q.m[13],c.z=q.m[14]}else{let U=null;q&&(U=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let J=g._TmpMats[0];q&&U?(J.X(this.getAbsoluteMatrix()),J.multiplyToRef(U,J)):J=this.getAbsoluteMatrix(),c.x=J.m[12],c.y=J.m[13],c.z=J.m[14]}}getAbsolutePosition(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=J.p.Zero();return this.getPositionToRef(1,q,c),c}getAbsolutePositionToRef(q,c){this.getPositionToRef(1,q,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.CK.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.X(this.CK);const q=this._skeleton.getPoseMatrix();q&&this._absoluteMatrix.multiplyToRef(q,this._absoluteMatrix)}const q=this.children,c=q.length;for(let U=0;U<c;U++)q[U].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}zn(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.p.Zero();return this.getDirectionToRef(q,c,U),U}getDirectionToRef(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,Q=null;c&&(Q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=g._TmpMats[0];s.X(this.getAbsoluteMatrix()),c&&Q&&s.multiplyToRef(Q,s),J.p.TransformNormalToRef(q,s,U),U.normalize()}getRotation(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.p.Zero();return this.getRotationToRef(q,c,U),U}getRotationToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;const J=g._TmpQuat;this.getRotationQuaternionToRef(q,c,J),J.toEulerAnglesToRef(U)}getRotationQuaternion(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.g.Identity();return this.getRotationQuaternionToRef(q,c,U),U}getRotationQuaternionToRef(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.X(this._localRotation);else{const U=g._TmpMats[0],J=this.getAbsoluteMatrix();q?J.multiplyToRef(q.getWorldMatrix(),U):U.X(J),U.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyAtIndex(1,this._scalingDeterminant),U.multiplyAtIndex(2,this._scalingDeterminant),U.decompose(void 0,c,void 0)}}getRotationMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const U=J.d.Identity();return this.getRotationMatrixToRef(q,c,U),U}getRotationMatrixToRef(){let q=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const U=g._TmpMats[0],J=this.getAbsoluteMatrix();q?J.multiplyToRef(q.getWorldMatrix(),U):U.X(J),U.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyAtIndex(1,this._scalingDeterminant),U.multiplyAtIndex(2,this._scalingDeterminant),U.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.p.Zero();return this.getAbsolutePositionFromLocalToRef(q,c,U),U}getAbsolutePositionFromLocalToRef(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,Q=null;c&&(Q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=g._TmpMats[0];s.X(this.getAbsoluteMatrix()),c&&Q&&s.multiplyToRef(Q,s),J.p.TransformCoordinatesToRef(q,s,U)}getLocalPositionFromAbsolute(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=J.p.Zero();return this.getLocalPositionFromAbsoluteToRef(q,c,U),U}getLocalPositionFromAbsoluteToRef(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,Q=null;c&&(Q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=g._TmpMats[0];s.X(this.getAbsoluteMatrix()),c&&Q&&s.multiplyToRef(Q,s),s.invert(),J.p.TransformCoordinatesToRef(q,s,U)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const q=this._skeleton.bones.indexOf(this);if(-1!==q&&this._skeleton.bones.splice(q,1),this._parentNode&&this._parentNode.children){const q=this._parentNode.children,c=q.indexOf(this);-1!==c&&q.splice(c,1)}super.dispose()}}g._TmpVecs=(0,Q.d)(2,J.p.Zero),g._TmpQuat=J.g.Identity(),g._TmpMats=(0,Q.d)(5,J.d.Identity)},13094:(q,c,U)=>{"use strict";U.d(c,{c:()=>S});var J=U(11010),Q=U(11019),s=U(10866),g=U(10833),X=U(10870),n=U(11113),W=U(11149),D=U(11391),u=U(10902),K=U(10836);class r{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(q){this._idleRotationSpeed=q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(q){this._idleRotationWaitTime=q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(q){this._idleRotationSpinupTime=q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(q){this._attachedCamera=q;const c=this._attachedCamera.Cq();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((q=>{q.type!==D.d.POINTERDOWN?q.type===D.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const q=u.d.Now;let c=0;null!=this._lastFrameTime&&(c=q-this._lastFrameTime),this._lastFrameTime=q,this._applyUserInteraction();const U=q-this._lastInteractionTime-this._idleRotationWaitTime,J=Math.max(Math.min(U/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*J,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Cq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(q){this._lastInteractionTime=q??u.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<K.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let q=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(q=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=u.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var H=U(13096),b=U(11468);class h{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(q){if(this._autoTransitionRange===q)return;this._autoTransitionRange=q;const c=this._attachedCamera;c&&(q?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((q=>{if(q&&(q.o(!0),q.getBoundingInfo)){const c=q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(q){this._attachedCamera=q,this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(q){return!!this._attachedCamera&&(this._attachedCamera.radius===q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(q){if(!this._attachedCamera)return;this._radiusBounceTransition||(h.EasingFunction.setEasingMode(h.EasingMode),this._radiusBounceTransition=b.b.CreateAnimation("radius",b.b.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=b.b.TransitionTo("radius",this._attachedCamera.radius+q,this._attachedCamera,this._attachedCamera.Cq(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}h.EasingFunction=new H.d(.3),h.EasingMode=H.s.EASINGMODE_EASEOUT;class o{constructor(){this.onTargetFramingAnimationEndObservable=new s.e,this._mode=o.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(q){this._mode=q}get mode(){return this._mode}set radiusScale(q){this._radiusScale=q}get radiusScale(){return this._radiusScale}set positionScale(q){this._positionScale=q}get positionScale(){return this._positionScale}set defaultElevation(q){this._defaultElevation=q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(q){this._elevationReturnTime=q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(q){this._elevationReturnWaitTime=q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(q){this._framingTime=q}get framingTime(){return this._framingTime}init(){}attach(q){this._attachedCamera=q;const c=this._attachedCamera.Cq();o.EasingFunction.setEasingMode(o.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((q=>{q.type!==D.d.POINTERDOWN?q.type===D.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((q=>{q&&q.getBoundingInfo&&this.zoomOnMesh(q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Cq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.o(!0);const J=q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(J.minimumWorld,J.maximumWorld,c,U)}zoomOnMeshHierarchy(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.o(!0);const J=q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(J.min,J.max,c,U)}zoomOnMeshesHierarchy(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new g.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new g.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let s=0;s<q.length;s++){const c=q[s].getHierarchyBoundingVectors(!0);g.p.CheckExtends(c.min,J,Q),g.p.CheckExtends(c.max,J,Q)}this.zoomOnBoundingInfo(J,Q,c,U)}zoomOnBoundingInfo(q,c){let U,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const s=q.y,X=s+(c.y-s)*this._positionScale,n=c.eU(q).scale(.5);if(!isFinite(X))return!1;if(J)U=new g.p(0,X,0);else{const c=q.add(n);U=new g.p(c.x,X,c.z)}this._vectorTransition||(this._vectorTransition=b.b.CreateAnimation("target",b.b.ANIMATIONTYPE_VECTOR3,60,o.EasingFunction)),this._betaIsAnimating=!0;let W=b.b.TransitionTo("target",U,this._attachedCamera,this._attachedCamera.Cq(),60,this._vectorTransition,this._framingTime);W&&this._animatables.push(W);let D=0;if(this._mode===o.FitFrustumSidesMode){const U=this._calculateLowerRadiusFromModelBoundingSphere(q,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=n.length()+this._attachedCamera.Oc),D=U}else this._mode===o.IgnoreBoundsSizeMode&&(D=this._calculateLowerRadiusFromModelBoundingSphere(q,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Oc));if(this.autoCorrectCameraLimitsAndSensibility){const U=c.eU(q).length();this._attachedCamera.panningSensibility=5e3/U,this._attachedCamera.wheelPrecision=100/D}return this._radiusTransition||(this._radiusTransition=b.b.CreateAnimation("radius",b.b.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),W=b.b.TransitionTo("radius",D,this._attachedCamera,this._attachedCamera.Cq(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Q&&Q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),W&&this._animatables.push(W),!0}_calculateLowerRadiusFromModelBoundingSphere(q,c){const U=this._attachedCamera;if(!U)return 0;let J=U._calculateLowerRadiusFromModelBoundingSphere(q,c,this._radiusScale);return U.lowerRadiusLimit&&this._mode===o.IgnoreBoundsSizeMode&&(J=J<U.lowerRadiusLimit?U.lowerRadiusLimit:J),U.upperRadiusLimit&&(J=J>U.upperRadiusLimit?U.upperRadiusLimit:J),J}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const q=u.d.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,U=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>U&&q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=b.b.CreateAnimation("beta",b.b.ANIMATIONTYPE_FLOAT,60,o.EasingFunction));const q=b.b.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.Cq(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));q&&this._animatables.push(q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=u.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}o.EasingFunction=new H.v,o.EasingMode=H.s.EASINGMODE_EASEINOUT,o.IgnoreBoundsSizeMode=0,o.FitFrustumSidesMode=1;var a=U(11151),p=U(11339),R=U(12577),I=U(10879);class t{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(q){q=I.e.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),U=c.getInputElement();let J=0,Q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=s=>{var g,X;const n=s.event,W="touch"===n.pointerType;if(s.type!==D.d.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const u=n.target;if(this._altKey=n.altKey,this._ctrlKey=n.ctrlKey,this._metaKey=n.metaKey,this._shiftKey=n.shiftKey,this._buttonsPressed=n.buttons,c.isPointerLock){const q=n.movementX,c=n.movementY;this.onTouch(null,q,c),this._pointA=null,this._pointB=null}else{if(s.type!==D.d.POINTERDOWN&&s.type!==D.d.POINTERDOUBLETAP&&W&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==n.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==n.pointerId)return;if(s.type!==D.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!W)if(s.type===D.d.POINTERDOUBLETAP)this.onDoubleTap(n.pointerType);else if(s.type!==D.d.POINTERUP||this._currentMousePointerIdDown!==n.pointerId&&!W){if(s.type===D.d.POINTERMOVE)if(q||n.preventDefault(),this._pointA&&null===this._pointB){const q=n.clientX-this._pointA.x,c=n.clientY-this._pointA.y;this._pointA.x=n.clientX,this._pointA.y=n.clientY,this.onTouch(this._pointA,q,c)}else if(this._pointA&&this._pointB){const q=this._pointA.pointerId===n.pointerId?this._pointA:this._pointB;q.x=n.clientX,q.y=n.clientY;const c=this._pointA.x-this._pointB.x,U=this._pointA.y-this._pointB.y,g=c*c+U*U,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:n.pointerId,type:s.type};this.onMultiTouch(this._pointA,this._pointB,J,g,Q,X),Q=X,J=g}}else{try{null===u||void 0===u||u.releasePointerCapture(n.pointerId)}catch(K){}W||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==n.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==n.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==J||Q)&&(this.onMultiTouch(this._pointA,this._pointB,J,0,Q,null),J=0,Q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(n),q||n.preventDefault()}else{try{null===u||void 0===u||u.setPointerCapture(n.pointerId)}catch(K){}if(null===this._pointA)this._pointA={x:n.clientX,y:n.clientY,pointerId:n.pointerId,type:n.pointerType};else{if(null!==this._pointB)return;this._pointB={x:n.clientX,y:n.clientY,pointerId:n.pointerId,type:n.pointerType}}-1!==this._currentMousePointerIdDown||W||(this._currentMousePointerIdDown=n.pointerId),this.onButtonDown(n),q||(n.preventDefault(),U&&U.focus())}}},this._observer=this.camera.Cq()._inputManager._addCameraPointerObserver(this._pointerInput,D.d.POINTERDOWN|D.d.POINTERUP|D.d.POINTERMOVE|D.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,J=0,Q=null,this.onLostFocus()},this._contextMenuBind=q=>this.onContextMenu(q),U&&U.addEventListener("contextmenu",this._contextMenuBind,!1);const s=this.camera.Cq().getEngine().getHostWindow();s&&I.e.RegisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}Ou(){if(this._onLostFocus){const q=this.camera.Cq().getEngine().getHostWindow();q&&I.e.UnregisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Cq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const q=this.camera.Cq().getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(q){}onTouch(q,c,U){}onMultiTouch(q,c,U,J,Q,s){}onContextMenu(q){q.preventDefault()}onButtonDown(q){}onButtonUp(q){}onLostFocus(){}}(0,J.d)([(0,Q.N)()],t.prototype,"buttons",void 0);class C extends t{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(q,c){if(0!==this.panningSensibility&&q&&c){const U=c.x-q.x,J=c.y-q.y;this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility}}_computePinchZoom(q,c){const U=this.camera.radius||C.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=U*Math.sqrt(q)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-q)*U*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(q,c,U){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=U/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=U/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(q,c,U,J,Q,s){0===U&&null===Q||0===J&&null===s||(this.multiTouchPanAndZoom?(this._computePinchZoom(U,J),this._computeMultiTouchPanning(Q,s)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(J)-Math.sqrt(U))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(U,J),this._isPinching=!0):this._computeMultiTouchPanning(Q,s)):this.multiTouchPanning?this._computeMultiTouchPanning(Q,s):this.pinchZoom&&this._computePinchZoom(U,J))}onButtonDown(q){this._isPanClick=q.button===this.camera._panningMouseButton}onButtonUp(q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}C.MinimumRadiusForPinch=.001,(0,J.d)([(0,Q.N)()],C.prototype,"buttons",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"angularSensibilityX",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"angularSensibilityY",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"pinchPrecision",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"pinchDeltaPercentage",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"useNaturalPinchZoom",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"pinchZoom",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"panningSensibility",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"multiTouchPanning",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"multiTouchPanAndZoom",void 0),R.d.ArcRotateCameraPointersInput=C;var i=U(11396);class F{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(q){q=I.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Cq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const U=c.event;if(!U.metaKey)if(c.type===i.e.KEYDOWN){if(this._ctrlPressed=U.ctrlKey,this._altPressed=U.altKey,-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysReset.indexOf(U.keyCode)){-1===this._keys.indexOf(U.keyCode)&&this._keys.push(U.keyCode),U.preventDefault&&(q||U.preventDefault())}}else if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysReset.indexOf(U.keyCode)){const c=this._keys.indexOf(U.keyCode);c>=0&&this._keys.splice(c,1),U.preventDefault&&(q||U.preventDefault())}})))}Ou(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let c=0;c<this._keys.length;c++){const U=this._keys[c];-1!==this.keysLeft.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX-=1/this.panningSensibility:q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset+=1/this.zoomingSensibility:q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX+=1/this.panningSensibility:q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(U)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset-=1/this.zoomingSensibility:q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(U)&&q.useInputToRestoreState&&q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,J.d)([(0,Q.N)()],F.prototype,"keysUp",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"keysDown",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"keysLeft",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"keysRight",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"keysReset",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"panningSensibility",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"zoomingSensibility",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"useAltToZoom",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"angularSpeed",void 0),R.d.ArcRotateCameraKeyboardMoveInput=F;var v=U(11077),Y=U(11404);class k{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.p(0,0,0),this._globalOffset=new g.p(0,0,0),this._inertialPanning=g.p.Zero()}_computeDeltaFromMouseWheelLegacyEvent(q,c){let U=0;const J=.01*q*this.wheelDeltaPercentage*c;return U=q>0?J/(1+this.wheelDeltaPercentage):J*(1+this.wheelDeltaPercentage),U}attachControl(q){q=I.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==D.d.POINTERWHEEL)return;const U=c.event;let J=0;const Q=U.deltaMode===Y.c.DOM_DELTA_LINE?40:1,s=-U.deltaY*Q;if(this.customComputeDeltaFromMouseWheel)J=this.customComputeDeltaFromMouseWheel(s,this,U);else if(this.wheelDeltaPercentage){if(J=this._computeDeltaFromMouseWheelLegacyEvent(s,this.camera.radius),J>0){let q=this.camera.radius,c=this.camera.inertialRadiusOffset+J;for(let U=0;U<20&&!(q<=c)&&!(Math.abs(c*this.camera.inertia)<.001);U++)q-=c,c*=this.camera.inertia;q=(0,X.Clamp)(q,0,Number.MAX_VALUE),J=this._computeDeltaFromMouseWheelLegacyEvent(s,q)}}else J=s/(40*this.wheelPrecision);J&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(J)):this.camera.inertialRadiusOffset+=J),U.preventDefault&&(q||U.preventDefault())},this._observer=this.camera.Cq()._inputManager._addCameraPointerObserver(this._wheel,D.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.tc(0)}Ou(){this._observer&&(this.camera.Cq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const q=this.camera;0+q.inertialAlphaOffset+q.inertialBetaOffset+q.inertialRadiusOffset&&(this._updateHitPlane(),q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const q=this.camera,c=q.target.eU(q.position);this._hitPlane=v.d.FromPositionAndNormal(q.target,c)}_getPosition(){const q=this.camera,c=q.Cq(),U=c.createPickingRay(c.pointerX,c.pointerY,g.d.Identity(),q,!1);0===q.targetScreenOffset.x&&0===q.targetScreenOffset.y||(this._viewOffset.set(q.targetScreenOffset.x,q.targetScreenOffset.y,0),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),this._globalOffset=g.p.TransformNormal(this._viewOffset,q._cameraTransformMatrix),U.origin.addInPlace(this._globalOffset));let J=0;return this._hitPlane&&(J=U.intersectsPlane(this._hitPlane)??0),U.origin.addInPlace(U.direction.scaleInPlace(J))}_zoomToMouse(q){const c=this.camera,U=1-c.inertia;if(c.lowerRadiusLimit){const J=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+q)/U<J&&(q=(c.radius-J)*U-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const J=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+q)/U>J&&(q=(c.radius-J)*U-c.inertialRadiusOffset)}const J=q/U/c.radius,Q=this._getPosition(),s=g.j.hc[6];Q.subtractToRef(c.target,s),s.scaleInPlace(J),s.scaleInPlace(U),this._inertialPanning.addInPlace(s),c.inertialRadiusOffset+=q}_zeroIfClose(q){Math.abs(q.x)<K.d&&(q.x=0),Math.abs(q.y)<K.d&&(q.y=0),Math.abs(q.z)<K.d&&(q.z=0)}}(0,J.d)([(0,Q.N)()],k.prototype,"wheelPrecision",void 0),(0,J.d)([(0,Q.N)()],k.prototype,"zoomToMouseLocation",void 0),(0,J.d)([(0,Q.N)()],k.prototype,"wheelDeltaPercentage",void 0),R.d.ArcRotateCameraMouseWheelInput=k;class V extends R.h{constructor(q){super(q)}addMouseWheel(){return this.add(new k),this}addPointers(){return this.add(new C),this}addKeyboard(){return this.add(new F),this}}var O=U(10850);function G(q,c){return isNaN(q)?c:q}n.b.AddNodeConstructor("ArcRotateCamera",((q,c)=>()=>new S(q,0,0,1,g.p.Zero(),c)));class S extends p.c{get target(){return this._target}set target(q){this.setTarget(q)}get targetHost(){return this._targetHost}set targetHost(q){q&&this.setTarget(q)}getTarget(){return this.target}get position(){return this._position}set position(q){this.setPosition(q)}set upVector(q){this._upToYMatrix||(this._yToUpMatrix=new g.d,this._upToYMatrix=new g.d,this._upVector=g.p.Zero()),q.normalize(),this._upVector.X(q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.d.RotationAlignToRef(g.p.UpReadOnly,this._upVector,this._yToUpMatrix),g.d.RotationAlignToRef(this._upVector,g.p.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityX:0}set angularSensibilityX(q){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=q)}get angularSensibilityY(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityY:0}set angularSensibilityY(q){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=q)}get pinchPrecision(){const q=this.inputs.attached.pointers;return q?q.pinchPrecision:0}set pinchPrecision(q){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=q)}get pinchDeltaPercentage(){const q=this.inputs.attached.pointers;return q?q.pinchDeltaPercentage:0}set pinchDeltaPercentage(q){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=q)}get useNaturalPinchZoom(){const q=this.inputs.attached.pointers;return!!q&&q.useNaturalPinchZoom}set useNaturalPinchZoom(q){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=q)}get panningSensibility(){const q=this.inputs.attached.pointers;return q?q.panningSensibility:0}set panningSensibility(q){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const c=this.inputs.attached.keyboard;c&&(c.keysUp=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const c=this.inputs.attached.keyboard;c&&(c.keysDown=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const c=this.inputs.attached.keyboard;c&&(c.keysRight=q)}get wheelPrecision(){const q=this.inputs.attached.mousewheel;return q?q.wheelPrecision:0}set wheelPrecision(q){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=q)}get zoomToMouseLocation(){const q=this.inputs.attached.mousewheel;return!!q&&q.zoomToMouseLocation}set zoomToMouseLocation(q){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=q)}get wheelDeltaPercentage(){const q=this.inputs.attached.mousewheel;return q?q.wheelDeltaPercentage:0}set wheelDeltaPercentage(q){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=q)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(q){q!==this.useBouncingBehavior&&(q?(this._bouncingBehavior=new h,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(q){q!==this.useFramingBehavior&&(q?(this._framingBehavior=new o,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(q){q!==this.useAutoRotationBehavior&&(q?(this._autoRotationBehavior=new r,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(q,c,U,J,Q,X){var n;let W=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(q,g.p.Zero(),X,W),n=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.p.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.d,this.panningAxis=new g.p(1,1,0),this._transformedDirection=new g.p,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new s.e,this.checkCollisions=!1,this.collisionRadius=new g.p(.5,.5,.5),this._previousPosition=g.p.Zero(),this._collisionVelocity=g.p.Zero(),this._newPosition=g.p.Zero(),this._computationVector=g.p.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.p(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.l(NaN,NaN),this._onCollisionPositionChange=function(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U?(n.setPosition(c),n.ar&&n.ar(U)):n._previousPosition.X(n._position);const J=Math.cos(n.alpha),Q=Math.sin(n.alpha),s=Math.cos(n.beta);let g=Math.sin(n.beta);0===g&&(g=1e-4);const X=n._getTargetPosition();n._computationVector.bc(n.radius*J*g,n.radius*s,n.radius*Q*g),X.addToRef(n._computationVector,n._newPosition),n._position.X(n._newPosition);let W=n.upVector;n.allowUpsideDown&&n.beta<0&&(W=W.clone(),W=W.negate()),n._computeViewMatrix(n._position,X,W),n._viewMatrix.addAtIndex(12,n.targetScreenOffset.x),n._viewMatrix.addAtIndex(13,n.targetScreenOffset.y),n._collisionTriggered=!1},this._target=g.p.Zero(),Q&&this.setTarget(Q),this.alpha=c,this.beta=U,this.radius=J,this.getViewMatrix(),this.inputs=new V(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.l.Zero()}_updateCache(q){q||super._updateCache(),this._cache._target.X(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.X(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?q.addToRef(this._targetBoundingCenter,this._target):this._target.X(q)}const q=this._getLockedTargetPosition();return q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>K.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,s=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=s?this._currentInterpolationFactor=s:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=G(q,this._goalAlpha),this._goalBeta=G(c,this._goalBeta),this._goalRadius=G(U,this._goalRadius),this._goalTarget.set(G(J.x,this._goalTarget.x),G(J.y,this._goalTarget.y),G(J.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(G(Q.x,this._goalTargetScreenOffset.x),G(Q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Q=arguments;c=I.e.BackCompatCameraNoPreventDefault(Q),this._useCtrlForPanning=U,this._panningMouseButton=J,"boolean"===typeof Q[0]&&(Q.length>1&&(this._useCtrlForPanning=Q[1]),Q.length>2&&(this._panningMouseButton=Q[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ou(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let q=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){q=!0;const c=this.invertRotation?-1:1,U=this._calculateHandednessMultiplier();let J=this.inertialAlphaOffset*U;this.beta<0&&(J*=-1),this.alpha+=J*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<K.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<K.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*K.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){q=!0;const c=new g.p(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),g.p.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const q=this.upVector,c=g.p.CrossToRef(this._transformedDirection,q,this._transformedDirection);g.p.CrossToRef(q,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.p.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.X(this._transformedDirection)}else{if(this.parent){const q=g.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.transposeToRef(q),g.p.TransformCoordinatesToRef(this._transformedDirection,q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*K.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*K.d&&(this.inertialPanningY=0)}if(q)this.stopInterpolation();else if(this._isInterpolating){let q=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,U=1-Math.pow(2,-c/this._currentInterpolationFactor),J=G(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=g.j.hc[0].set(G(this._goalTarget.x,this._target.x),G(this._goalTarget.y,this._target.y),G(this._goalTarget.z,this._target.z));g.p.LerpToRef(this.target,c,U,this._target),10*g.p.Distance(this.target,c)/J<K.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.X(c),this.setTarget(this.target,!1,!0,!0)):q=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=g.g.RotationAlphaBetaGammaToRef(G(this._goalAlpha,this.alpha),G(this._goalBeta,this.beta),0,g.j.Quaternion[0]),J=g.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.j.Quaternion[1]),Q=g.g.SlerpToRef(J,c,U,g.j.Quaternion[2]);Q.normalize();const s=Q.toAlphaBetaGammaToRef(g.j.hc[0]);if(this.alpha=s.x,this.beta=s.y,Q.isApprox(c,K.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const q=c.toAlphaBetaGammaToRef(g.j.hc[0]);this.alpha=q.x,this.beta=q.y}else q=!0}if(isNaN(this._goalRadius)||(this.radius+=(J-this.radius)*U,Math.abs(J/this.radius-1)<K.d?(this._goalRadius=NaN,this.radius=J):q=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=g.j.Vector2[0].set(G(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),G(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.l.LerpToRef(this.targetScreenOffset,c,U,this.targetScreenOffset),g.l.Distance(this.targetScreenOffset,c)<K.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.X(c)):q=!0}this._isInterpolating=q}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.p.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const q=this.alpha;var c,U;this.alpha=function(q){let c=Math.PI/2;return 0===q.x&&0===q.z||(c=Math.acos(q.x/Math.sqrt(Math.pow(q.x,2)+Math.pow(q.z,2)))),q.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,U=this.radius,Math.acos(c/U));const J=Math.round((q-this.alpha)/(2*Math.PI));this.alpha+=2*J*Math.PI,this._checkLimits()}setPosition(q){this._position.equals(q)||(this._position.X(q),this.rebuildAnglesAndRadius())}setTarget(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(J=this.overrideCloneAlphaBetaRadius??J,q.o)c&&q.getBoundingInfo?this._targetBoundingCenter=q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,q.o(),this._targetHost=q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=q,J=this._getTargetPosition();if(J&&!U&&J.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}J||this.rebuildAnglesAndRadius()}_getViewMatrix(){const q=Math.cos(this.alpha),c=Math.sin(this.alpha),U=Math.cos(this.beta);let J=Math.sin(this.beta);0===J&&(J=1e-4),0===this.radius&&(this.radius=1e-4);const Q=this._getTargetPosition();if(this._computationVector.bc(this.radius*q*J,this.radius*U,this.radius*c*J),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.p.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Q.addToRef(this._computationVector,this._newPosition),this.Cq().collisionsEnabled&&this.checkCollisions){const q=this.Cq().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.X(this._newPosition);let q=this.upVector;this.allowUpsideDown&&J<0&&(q=q.negate()),this._computeViewMatrix(this._position,Q,q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.X(Q),this._viewMatrix}zoomOn(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q||this.Cq().meshes;const U=W.b.MinMax(q);let J=this._calculateLowerRadiusFromModelBoundingSphere(U.min,U.max);if(J=Math.max(Math.min(J,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=J*this.zoomOnFactor,this.mode===a.d.ORTHOGRAPHIC_CAMERA){const q=this.Cq().getEngine().getAspectRatio(this),c=J*this.zoomOnFactor/2;this.orthoLeft=-c*q,this.orthoRight=c*q,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:U.min,max:U.max,distance:J},c)}focusOn(q){let c,U,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===q.min){const J=q||this.Cq().meshes;c=W.b.MinMax(J),U=g.p.Distance(c.min,c.max)}else{c=q,U=q.distance}this._target=W.b.Center(c),J||(this.maxZ=2*U)}createRigCamera(q,c){let U=0;switch(this.cameraRigMode){case a.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case a.d.RIG_MODE_VR:U=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case a.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const J=new S(q,this.alpha+U,this.beta,this.radius,this._target,this.Cq());return J._cameraRigParams={},J.isRigCamera=!0,J.rigParent=this,J.upVector=this.upVector,J.mode=this.mode,J.orthoLeft=this.orthoLeft,J.orthoRight=this.orthoRight,J.orthoBottom=this.orthoBottom,J.orthoTop=this.orthoTop,J}_updateRigCameras(){const q=this._rigCameras[0],c=this._rigCameras[1];switch(q.beta=c.beta=this.beta,this.cameraRigMode){case a.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case a.d.RIG_MODE_VR:q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case a.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const J=g.p.Distance(q,c),Q=this.Cq().getEngine().getAspectRatio(this),s=Math.tan(this.fov/2),X=s*Q,n=.5*J*U,W=n*Math.sqrt(1+1/(X*X)),D=n*Math.sqrt(1+1/(s*s));return Math.max(W,D)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,J.d)([(0,Q.N)()],S.prototype,"alpha",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"beta",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"radius",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,J.d)([(0,Q.K)("target")],S.prototype,"_target",void 0),(0,J.d)([(0,Q.y)("targetHost")],S.prototype,"_targetHost",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"inertialAlphaOffset",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"inertialBetaOffset",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"inertialRadiusOffset",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"lowerAlphaLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"upperAlphaLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"lowerBetaLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"upperBetaLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"lowerRadiusLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"upperRadiusLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"lowerTargetYLimit",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"inertialPanningX",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"inertialPanningY",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"pinchToPanMaxDistance",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"panningDistanceLimit",void 0),(0,J.d)([(0,Q.K)()],S.prototype,"panningOriginTarget",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"panningInertia",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"zoomToMouseLocation",null),(0,J.d)([(0,Q.N)()],S.prototype,"zoomOnFactor",void 0),(0,J.d)([(0,Q.H)()],S.prototype,"targetScreenOffset",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"allowUpsideDown",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"useInputToRestoreState",void 0),(0,J.d)([(0,Q.N)()],S.prototype,"restoreStateInterpolationFactor",void 0),(0,O.f)("BABYLON.ArcRotateCamera",S)},12577:(q,c,U)=>{"use strict";U.d(c,{d:()=>g,h:()=>X});var J=U(10886),Q=U(11082),s=U(11151),g={};class X{constructor(q){this.attachedToElement=!1,this.attached={},this.camera=q,this.checkInputs=()=>{}}add(q){const c=q.getSimpleName();this.attached[c]?J.c.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=q,q.camera=this.camera,q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q))),this.attachedToElement&&q.attachControl(this.noPreventDefault))}remove(q){for(const c in this.attached){const U=this.attached[c];if(U===q)return U.Ou(),U.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(q){for(const c in this.attached){const U=this.attached[c];U.getClassName()===q&&(U.Ou(),U.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(q){const c=this.checkInputs;return()=>{c(),q()}}attachInput(q){this.attachedToElement&&q.attachControl(this.noPreventDefault)}attachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){q=!s.d.ForceAttachControlToAlwaysPreventDefault&&q,this.attachedToElement=!0,this.noPreventDefault=q;for(const c in this.attached)this.attached[c].attachControl(q)}}detachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].Ou(),q&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const q in this.attached){const c=this.attached[q];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(q){const c={};for(const U in this.attached){const q=this.attached[U],J=Q.e.Serialize(q);c[q.getClassName()]=J}q.inputsmgr=c}parse(q){const c=q.inputsmgr;if(c){this.clear();for(const q in c){const U=g[q];if(U){const J=c[q],s=Q.e.Parse((()=>new U),J,null);this.add(s)}}}else for(const U in this.attached){const c=g[this.attached[U].getClassName()];if(c){const J=Q.e.Parse((()=>new c),q,null);this.remove(this.attached[U]),this.add(J)}}}}},12569:(q,c,U)=>{"use strict";U.d(c,{b:()=>t});var J=U(11010),Q=U(11019),s=U(10833),g=U(11339),X=U(12577),n=U(11396),W=U(10879);class D{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(q){q=W.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Cq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const U=c.event;if(!U.metaKey)if(c.type===n.e.KEYDOWN){if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysUpward.indexOf(U.keyCode)||-1!==this.keysDownward.indexOf(U.keyCode)||-1!==this.keysRotateLeft.indexOf(U.keyCode)||-1!==this.keysRotateRight.indexOf(U.keyCode)||-1!==this.keysRotateUp.indexOf(U.keyCode)||-1!==this.keysRotateDown.indexOf(U.keyCode)){-1===this._keys.indexOf(U.keyCode)&&this._keys.push(U.keyCode),q||U.preventDefault()}}else if(-1!==this.keysUp.indexOf(U.keyCode)||-1!==this.keysDown.indexOf(U.keyCode)||-1!==this.keysLeft.indexOf(U.keyCode)||-1!==this.keysRight.indexOf(U.keyCode)||-1!==this.keysUpward.indexOf(U.keyCode)||-1!==this.keysDownward.indexOf(U.keyCode)||-1!==this.keysRotateLeft.indexOf(U.keyCode)||-1!==this.keysRotateRight.indexOf(U.keyCode)||-1!==this.keysRotateUp.indexOf(U.keyCode)||-1!==this.keysRotateDown.indexOf(U.keyCode)){const c=this._keys.indexOf(U.keyCode);c>=0&&this._keys.splice(c,1),q||U.preventDefault()}})))}Ou(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let c=0;c<this._keys.length;c++){const U=this._keys[c],J=q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(U)?q._localDirection.bc(-J,0,0):-1!==this.keysUp.indexOf(U)?q._localDirection.bc(0,0,J):-1!==this.keysRight.indexOf(U)?q._localDirection.bc(J,0,0):-1!==this.keysDown.indexOf(U)?q._localDirection.bc(0,0,-J):-1!==this.keysUpward.indexOf(U)?q._localDirection.bc(0,J,0):-1!==this.keysDownward.indexOf(U)?q._localDirection.bc(0,-J,0):-1!==this.keysRotateLeft.indexOf(U)?(q._localDirection.bc(0,0,0),q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(U)?(q._localDirection.bc(0,0,0),q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(U)?(q._localDirection.bc(0,0,0),q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(U)&&(q._localDirection.bc(0,0,0),q.cameraRotation.x+=this._getLocalRotation()),q.Cq().useRightHandedSystem&&(q._localDirection.z*=-1),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),s.p.TransformNormalToRef(q._localDirection,q._cameraTransformMatrix,q._transformedDirection),q.cameraDirection.addInPlace(q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*q}}(0,J.d)([(0,Q.N)()],D.prototype,"keysUp",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysUpward",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysDown",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysDownward",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysLeft",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysRight",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"rotationSpeed",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysRotateLeft",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysRotateRight",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysRotateUp",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"keysRotateDown",void 0),X.d.FreeCameraKeyboardMoveInput=D;var u=U(10866),K=U(11391);class r{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new u.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(q){q=W.e.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),U=c.getInputElement();this._pointerInput||(this._pointerInput=J=>{const Q=J.event,s="touch"===Q.pointerType;if(!this.touchEnabled&&s)return;if(J.type!==K.d.POINTERMOVE&&-1===this.buttons.indexOf(Q.button))return;const g=Q.target;if(J.type===K.d.POINTERDOWN){if(s&&-1!==this._activePointerId||!s&&-1!==this._currentActiveButton)return;this._activePointerId=Q.pointerId;try{null===g||void 0===g||g.setPointerCapture(Q.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=Q.button),this._previousPosition={x:Q.clientX,y:Q.clientY},q||(Q.preventDefault(),U&&U.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(J.event)}else if(J.type===K.d.POINTERUP){if(s&&this._activePointerId!==Q.pointerId||!s&&this._currentActiveButton!==Q.button)return;try{null===g||void 0===g||g.releasePointerCapture(Q.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,q||Q.preventDefault(),this._activePointerId=-1}else if(J.type===K.d.POINTERMOVE&&(this._activePointerId===Q.pointerId||!s))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(J.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),U=(Q.clientX-this._previousPosition.x)*c,J=Q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=U/this.angularSensibility,this.camera.cameraRotation.x+=J/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:U,offsetY:J}),this._previousPosition={x:Q.clientX,y:Q.clientY},q||Q.preventDefault()}}),this._onMouseMove=U=>{if(!c.isPointerLock)return;const J=this.camera._calculateHandednessMultiplier(),Q=U.movementX*J;this.camera.cameraRotation.y+=Q/this.angularSensibility;const s=U.movementY;this.camera.cameraRotation.x+=s/this.angularSensibility,this._previousPosition=null,q||U.preventDefault()},this._observer=this.camera.Cq()._inputManager._addCameraPointerObserver(this._pointerInput,K.d.POINTERDOWN|K.d.POINTERUP|K.d.POINTERMOVE),U&&(this._contextMenuBind=q=>this.onContextMenu(q),U.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(q){q.preventDefault()}Ou(){if(this._observer){if(this.camera.Cq()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,J.d)([(0,Q.N)()],r.prototype,"buttons",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"angularSensibility",void 0),X.d.FreeCameraMouseInput=r;var H,b=U(11404);class h{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new u.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(q){q=W.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==K.d.POINTERWHEEL)return;const U=c.event,J=U.deltaMode===b.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*J*U.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*J*U.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*J*U.deltaZ/this._normalize,U.preventDefault&&(q||U.preventDefault())},this._observer=this.camera.Cq()._inputManager._addCameraPointerObserver(this._wheel,K.d.POINTERWHEEL)}Ou(){this._observer&&(this.camera.Cq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,J.d)([(0,Q.N)()],h.prototype,"wheelPrecisionX",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"wheelPrecisionY",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"wheelPrecisionZ",void 0),function(q){q[q.MoveRelative=0]="MoveRelative",q[q.RotateRelative=1]="RotateRelative",q[q.MoveScene=2]="MoveScene"}(H||(H={}));class o extends h{constructor(){super(...arguments),this._moveRelative=s.p.Zero(),this._rotateRelative=s.p.Zero(),this._moveScene=s.p.Zero(),this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(q){null===q&&this._wheelXAction!==H.MoveRelative||(this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=q)}get wheelXMoveRelative(){return this._wheelXAction!==H.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(q){null===q&&this._wheelYAction!==H.MoveRelative||(this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=q)}get wheelYMoveRelative(){return this._wheelYAction!==H.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(q){null===q&&this._wheelZAction!==H.MoveRelative||(this._wheelZAction=H.MoveRelative,this._wheelZActionCoordinate=q)}get wheelZMoveRelative(){return this._wheelZAction!==H.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(q){null===q&&this._wheelXAction!==H.RotateRelative||(this._wheelXAction=H.RotateRelative,this._wheelXActionCoordinate=q)}get wheelXRotateRelative(){return this._wheelXAction!==H.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(q){null===q&&this._wheelYAction!==H.RotateRelative||(this._wheelYAction=H.RotateRelative,this._wheelYActionCoordinate=q)}get wheelYRotateRelative(){return this._wheelYAction!==H.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(q){null===q&&this._wheelZAction!==H.RotateRelative||(this._wheelZAction=H.RotateRelative,this._wheelZActionCoordinate=q)}get wheelZRotateRelative(){return this._wheelZAction!==H.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(q){null===q&&this._wheelXAction!==H.MoveScene||(this._wheelXAction=H.MoveScene,this._wheelXActionCoordinate=q)}get wheelXMoveScene(){return this._wheelXAction!==H.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(q){null===q&&this._wheelYAction!==H.MoveScene||(this._wheelYAction=H.MoveScene,this._wheelYActionCoordinate=q)}get wheelYMoveScene(){return this._wheelYAction!==H.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(q){null===q&&this._wheelZAction!==H.MoveScene||(this._wheelZAction=H.MoveScene,this._wheelZActionCoordinate=q)}get wheelZMoveScene(){return this._wheelZAction!==H.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.tc(0),this._rotateRelative.tc(0),this._moveScene.tc(0),this._updateCamera(),this.camera.Cq().useRightHandedSystem&&(this._moveRelative.z*=-1);const q=s.d.Zero();this.camera.getViewMatrix().invertToRef(q);const c=s.p.Zero();s.p.TransformNormalToRef(this._moveRelative,q,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(q,c,U){if(0===q)return;if(null===c||null===U)return;let J=null;switch(c){case H.MoveRelative:J=this._moveRelative;break;case H.RotateRelative:J=this._rotateRelative;break;case H.MoveScene:J=this._moveScene}switch(U){case 0:J.set(q,0,0);break;case 1:J.set(0,q,0);break;case 2:J.set(0,0,q)}}}(0,J.d)([(0,Q.N)()],o.prototype,"wheelXMoveRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelYMoveRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelZMoveRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelXRotateRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelYRotateRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelZRotateRelative",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelXMoveScene",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelYMoveScene",null),(0,J.d)([(0,Q.N)()],o.prototype,"wheelZMoveScene",null),X.d.FreeCameraMouseWheelInput=o;class a{constructor(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=W.e.IsSafari()}attachControl(q){q=W.e.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=U=>{const J=U.event,Q="mouse"===J.pointerType||this._isSafari&&"undefined"===typeof J.pointerType;if(this.allowMouse||!Q)if(U.type===K.d.POINTERDOWN){if(q||J.preventDefault(),this._pointerPressed.push(J.pointerId),1!==this._pointerPressed.length)return;c={x:J.clientX,y:J.clientY}}else if(U.type===K.d.POINTERUP){q||J.preventDefault();const U=this._pointerPressed.indexOf(J.pointerId);if(-1===U)return;if(this._pointerPressed.splice(U,1),0!=U)return;c=null,this._offsetX=null,this._offsetY=null}else if(U.type===K.d.POINTERMOVE){if(q||J.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(J.pointerId))return;this._offsetX=J.clientX-c.x,this._offsetY=-(J.clientY-c.y)}}),this._observer=this.camera.Cq()._inputManager._addCameraPointerObserver(this._pointerInput,K.d.POINTERDOWN|K.d.POINTERUP|K.d.POINTERMOVE),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.addEventListener("blur",this._onLostFocus)}}Ou(){if(this._pointerInput){if(this._observer&&(this.camera.Cq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const q=this.camera,c=q._calculateHandednessMultiplier();q.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=q._computeLocalCameraSpeed(),U=new s.p(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);s.d.RotationYawPitchRollToRef(q.rotation.y,q.rotation.x,0,q._cameraRotationMatrix),q.cameraDirection.addInPlace(s.p.TransformCoordinates(U,q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,J.d)([(0,Q.N)()],a.prototype,"touchAngularSensibility",void 0),(0,J.d)([(0,Q.N)()],a.prototype,"touchMoveSensibility",void 0),X.d.FreeCameraTouchInput=a;class p extends X.h{constructor(q){super(q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new D),this}addMouse(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new r(q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new o,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new a),this}clear(){super.clear(),this._mouseInput=null}}var R=U(10850),I=U(10954);class t extends g.c{get angularSensibility(){const q=this.inputs.attached.mouse;return q?q.angularSensibility:0}set angularSensibility(q){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const c=this.inputs.attached.keyboard;c&&(c.keysUp=q)}get keysUpward(){const q=this.inputs.attached.keyboard;return q?q.keysUpward:[]}set keysUpward(q){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const c=this.inputs.attached.keyboard;c&&(c.keysDown=q)}get keysDownward(){const q=this.inputs.attached.keyboard;return q?q.keysDownward:[]}set keysDownward(q){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const c=this.inputs.attached.keyboard;c&&(c.keysRight=q)}get keysRotateLeft(){const q=this.inputs.attached.keyboard;return q?q.keysRotateLeft:[]}set keysRotateLeft(q){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=q)}get keysRotateRight(){const q=this.inputs.attached.keyboard;return q?q.keysRotateRight:[]}set keysRotateRight(q){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=q)}get keysRotateUp(){const q=this.inputs.attached.keyboard;return q?q.keysRotateUp:[]}set keysRotateUp(q){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=q)}get keysRotateDown(){const q=this.inputs.attached.keyboard;return q?q.keysRotateDown:[]}set keysRotateDown(q){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=q)}constructor(q,c,U){var J;super(q,c,U,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),J=this,this.ellipsoid=new s.p(.5,1,.5),this.ellipsoidOffset=new s.p(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=s.p.Zero(),this._diffPosition=s.p.Zero(),this._newPosition=s.p.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J._newPosition.X(c),J._newPosition.subtractToRef(J._oldPosition,J._diffPosition),J._diffPosition.length()>I.d.CollisionsEpsilon&&(J.position.addToRef(J._diffPosition,J._deferredPositionUpdate),J._deferOnly?J._deferredUpdated=!0:J.position.X(J._deferredPositionUpdate),J.ar&&U&&J.ar(U))},this.inputs=new p(this),this.inputs.addKeyboard().addMouse()}attachControl(q,c){c=W.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}Ou(){this.inputs.detachElement(),this.cameraDirection=new s.p(0,0,0),this.cameraRotation=new s.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(q){this._collisionMask=isNaN(q)?-1:q}_collideWithWorld(q){let c;c=this.parent?s.p.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const U=this.Cq().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let J=q;this.applyGravity&&(J=q.add(this.Cq().gravity)),U.getNewPosition(this._oldPosition,J,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=s.p.Zero(),this._transformedDirection=s.p.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(q){this._needMoveForGravity=q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Cq().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ac"}}(0,J.d)([(0,Q.K)()],t.prototype,"ellipsoid",void 0),(0,J.d)([(0,Q.K)()],t.prototype,"ellipsoidOffset",void 0),(0,J.d)([(0,Q.N)()],t.prototype,"checkCollisions",void 0),(0,J.d)([(0,Q.N)()],t.prototype,"applyGravity",void 0),(0,R.f)("BABYLON.FreeCamera",t)},13158:(q,c,U)=>{"use strict";U.d(c,{c:()=>s});var J=U(11156),Q=U(13166);class s{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=U,this.ED=[],this._maxBlockCapacity=c||64,this._selectionContent=new J.e(1024),this._creationFunc=q}update(q,c,U){Q.b._CreateBlocks(q,c,U,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}sD(q){for(let c=0;c<this.aD.length;c++){this.aD[c].addEntry(q)}}QD(q){for(let c=0;c<this.aD.length;c++){this.aD[c].removeEntry(q)}}select(q,c){this._selectionContent.reset();for(let U=0;U<this.aD.length;U++){this.aD[U].select(q,this._selectionContent,c)}return c?this._selectionContent.concat(this.ED):this._selectionContent.concatWithNoDuplicate(this.ED),this._selectionContent}intersects(q,c,U){this._selectionContent.reset();for(let J=0;J<this.aD.length;J++){this.aD[J].intersects(q,c,this._selectionContent,U)}return U?this._selectionContent.concat(this.ED):this._selectionContent.concatWithNoDuplicate(this.ED),this._selectionContent}intersectsRay(q){this._selectionContent.reset();for(let c=0;c<this.aD.length;c++){this.aD[c].intersectsRay(q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ED),this._selectionContent}}s.CreationFuncForMeshes=(q,c)=>{const U=q.getBoundingInfo();!q.isBlocked&&U.boundingBox.intersectsMinMax(c.Ju,c.Qu)&&c.entries.push(q)},s.CreationFuncForSubMeshes=(q,c)=>{q.getBoundingInfo().boundingBox.intersectsMinMax(c.Ju,c.Qu)&&c.entries.push(q)}},13166:(q,c,U)=>{"use strict";U.d(c,{b:()=>s});var J=U(10833),Q=U(11054);class s{constructor(q,c,U,J,Q,s){this.entries=[],this.su=new Array,this._capacity=U,this._depth=J,this._maxDepth=Q,this._creationFunc=s,this._minPoint=q,this._maxPoint=c,this.su.push(q.clone()),this.su.push(c.clone()),this.su.push(q.clone()),this.su[2].x=c.x,this.su.push(q.clone()),this.su[3].y=c.y,this.su.push(q.clone()),this.su[4].z=c.z,this.su.push(c.clone()),this.su[5].z=q.z,this.su.push(c.clone()),this.su[6].x=q.x,this.su.push(c.clone()),this.su[7].y=q.y}get WU(){return this._capacity}get Ju(){return this._minPoint}get Qu(){return this._maxPoint}addEntry(q){if(this.aD)for(let c=0;c<this.aD.length;c++){this.aD[c].addEntry(q)}else this._creationFunc(q,this),this.entries.length>this.WU&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(q){if(this.aD){for(let c=0;c<this.aD.length;c++){this.aD[c].removeEntry(q)}return}const c=this.entries.indexOf(q);c>-1&&this.entries.splice(c,1)}addEntries(q){for(let c=0;c<q.length;c++){const U=q[c];this.addEntry(U)}}select(q,c,U){if(Q.c.IsInFrustum(this.su,q)){if(this.aD){for(let J=0;J<this.aD.length;J++){this.aD[J].select(q,c,U)}return}U?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(q,c,U,J){if(Q.c.IntersectsSphere(this._minPoint,this._maxPoint,q,c)){if(this.aD){for(let Q=0;Q<this.aD.length;Q++){this.aD[Q].intersects(q,c,U,J)}return}J?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersectsRay(q,c){if(q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.aD){for(let U=0;U<this.aD.length;U++){this.aD[U].intersectsRay(q,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){s._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(q,c,U,Q,g,X,n,W){n.aD=new Array;const D=new J.p((c.x-q.x)/2,(c.y-q.y)/2,(c.z-q.z)/2);for(let J=0;J<2;J++)for(let c=0;c<2;c++)for(let u=0;u<2;u++){const K=q.add(D.multiplyByFloats(J,c,u)),r=q.add(D.multiplyByFloats(J+1,c+1,u+1)),H=new s(K,r,Q,g+1,X,W);H.addEntries(U),n.aD.push(H)}}}},13175:(q,c,U)=>{"use strict";U.d(c,{d:()=>D});var J=U(11364),Q=U(10833),s=U(11119),g=U(12349),X=U(11192),n=U(13158),W=U(10864);J.b.prototype.createOrUpdateSelectionOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,U=this._getComponent(X.d.NAME_OCTREE);U||(U=new D(this),this.nc(U)),this.fD||(this.fD=new n.c(n.c.CreationFuncForMeshes,q,c));const J=this.getWorldExtends();return this.fD.update(J.min,J.max,this.meshes),this.fD},Object.defineProperty(J.b.prototype,"selectionOctree",{get:function(){return this.fD},enumerable:!0,configurable:!0}),s.c.prototype.createOrUpdateSubmeshesOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const U=this.Cq();let J=U._getComponent(X.d.NAME_OCTREE);J||(J=new D(U),U.nc(J)),this._submeshesOctree||(this._submeshesOctree=new n.c(n.c.CreationFuncForSubMeshes,q,c)),this.o(!0);const Q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Q.minimumWorld,Q.maximumWorld,this.Gc),this._submeshesOctree};class D{constructor(q){this.name=X.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.e(Q.p.Zero(),new Q.p(1,1,1)),(q=q||W.c.LastCreatedScene)&&(this.mc=q,this.mc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.mc.getActiveSubMeshCandidates=q=>this.getActiveSubMeshCandidates(q),this.mc.getCollidingSubMeshCandidates=(q,c)=>this.getCollidingSubMeshCandidates(q,c),this.mc.getIntersectingSubMeshCandidates=(q,c)=>this.getIntersectingSubMeshCandidates(q,c))}register(){this.mc.onMeshRemovedObservable.add((q=>{const c=this.mc.selectionOctree;if(void 0!==c&&null!==c){const U=c.ED.indexOf(q);-1!==U&&c.ED.splice(U,1)}})),this.mc.onMeshImportedObservable.add((q=>{const c=this.mc.selectionOctree;void 0!==c&&null!==c&&c.sD(q)}))}getActiveMeshCandidates(){var q;return(null===(q=this.mc.fD)||void 0===q?void 0:q.select(this.mc.frustumPlanes))||this.mc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(q){if(q._submeshesOctree&&q.useOctreeForRenderingSelection){return q._submeshesOctree.select(this.mc.frustumPlanes)}return this.mc._getDefaultSubMeshCandidates(q)}getIntersectingSubMeshCandidates(q,c){if(q._submeshesOctree&&q.useOctreeForPicking){g.e.TransformToRef(c,q.getWorldMatrix(),this._tempRay);return q._submeshesOctree.intersectsRay(this._tempRay)}return this.mc._getDefaultSubMeshCandidates(q)}getCollidingSubMeshCandidates(q,c){if(q._submeshesOctree&&q.useOctreeForCollisions){const U=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return q._submeshesOctree.intersects(c._basePointWorld,U)}return this.mc._getDefaultSubMeshCandidates(q)}rebuild(){}dispose(){}}},12349:(q,c,U)=>{"use strict";U.d(c,{e:()=>r});var J=U(11364),Q=U(11151),s=U(10836),g=U(10833),X=U(10845),n=U(11043),W=U(11132),D=U(10864),u=U(11407);const K={internalPickerForMesh:void 0};class r{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.d;this.origin=q,this.direction=c,this.length=U,this.epsilon=J}clone(){return new r(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=r._TmpVector3[0].bc(q.x-U,q.y-U,q.z-U),Q=r._TmpVector3[1].bc(c.x+U,c.y+U,c.z+U);let s,g,X,n,W=0,D=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<J.x||this.origin.x>Q.x)return!1}else if(s=1/this.direction.x,g=(J.x-this.origin.x)*s,X=(Q.x-this.origin.x)*s,X===-1/0&&(X=1/0),g>X&&(n=g,g=X,X=n),W=Math.max(g,W),D=Math.min(X,D),W>D)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<J.y||this.origin.y>Q.y)return!1}else if(s=1/this.direction.y,g=(J.y-this.origin.y)*s,X=(Q.y-this.origin.y)*s,X===-1/0&&(X=1/0),g>X&&(n=g,g=X,X=n),W=Math.max(g,W),D=Math.min(X,D),W>D)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<J.z||this.origin.z>Q.z)return!1}else if(s=1/this.direction.z,g=(J.z-this.origin.z)*s,X=(Q.z-this.origin.z)*s,X===-1/0&&(X=1/0),g>X&&(n=g,g=X,X=n),W=Math.max(g,W),D=Math.min(X,D),W>D)return!1;return!0}intersectsBox(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(q.minimum,q.maximum,c)}intersectsSphere(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=q.center.x-this.origin.x,J=q.center.y-this.origin.y,Q=q.center.z-this.origin.z,s=U*U+J*J+Q*Q,g=q.radius+c,X=g*g;if(s<=X)return!0;const n=U*this.direction.x+J*this.direction.y+Q*this.direction.z;if(n<0)return!1;return s-n*n<=X}intersectsTriangle(q,c,U){const J=r._TmpVector3[0],Q=r._TmpVector3[1],s=r._TmpVector3[2],X=r._TmpVector3[3],W=r._TmpVector3[4];c.subtractToRef(q,J),U.subtractToRef(q,Q),g.p.CrossToRef(this.direction,Q,s);const D=g.p.Dot(J,s);if(0===D)return null;const u=1/D;this.origin.subtractToRef(q,X);const K=g.p.Dot(X,s)*u;if(K<-this.epsilon||K>1+this.epsilon)return null;g.p.CrossToRef(X,J,W);const H=g.p.Dot(this.direction,W)*u;if(H<-this.epsilon||K+H>1+this.epsilon)return null;const b=g.p.Dot(Q,W)*u;return b>this.length?null:new n.e(1-K-H,K,b)}intersectsPlane(q){let c;const U=g.p.Dot(q.Jc,this.direction);if(Math.abs(U)<9.99999997475243e-7)return null;{const J=g.p.Dot(q.Jc,this.origin);return c=(-q.d-J)/U,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(q){case"y":{const q=(this.origin.y-c)/this.direction.y;return q>0?null:new g.p(this.origin.x+this.direction.x*-q,c,this.origin.z+this.direction.z*-q)}case"x":{const q=(this.origin.x-c)/this.direction.x;return q>0?null:new g.p(c,this.origin.y+this.direction.y*-q,this.origin.z+this.direction.z*-q)}case"z":{const q=(this.origin.z-c)/this.direction.z;return q>0?null:new g.p(this.origin.x+this.direction.x*-q,this.origin.y+this.direction.y*-q,c)}default:return null}}intersectsMesh(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=g.j.Matrix[0];return q.getWorldMatrix().invertToRef(X),this._tmpRay?r.TransformToRef(this,X,this._tmpRay):this._tmpRay=r.Transform(this,X),q.intersects(this._tmpRay,c,U,J,Q,s)}intersectsMeshes(q,c,U){U?U.length=0:U=[];for(let J=0;J<q.length;J++){const Q=this.intersectsMesh(q[J],c);Q.hit&&U.push(Q)}return U.sort(this._comparePickingInfo),U}_comparePickingInfo(q,c){return q.distance<c.distance?-1:q.distance>c.distance?1:0}intersectionSegment(q,c,U){const J=this.origin,Q=g.j.hc[0],s=g.j.hc[1],X=g.j.hc[2],n=g.j.hc[3];c.subtractToRef(q,Q),this.direction.scaleToRef(r._Rayl,X),J.addToRef(X,s),q.subtractToRef(J,n);const W=g.p.Dot(Q,Q),D=g.p.Dot(Q,X),u=g.p.Dot(X,X),K=g.p.Dot(Q,n),H=g.p.Dot(X,n),b=W*u-D*D;let h,o,a=b,p=b;b<r._Smallnum?(h=0,a=1,o=H,p=u):(h=D*H-u*K,o=W*H-D*K,h<0?(h=0,o=H,p=u):h>a&&(h=a,o=H+D,p=u)),o<0?(o=0,-K<0?h=0:-K>W?h=a:(h=-K,a=W)):o>p&&(o=p,-K+D<0?h=0:-K+D>W?h=a:(h=-K+D,a=W));const R=Math.abs(h)<r._Smallnum?0:h/a,I=Math.abs(o)<r._Smallnum?0:o/p,t=g.j.hc[4];X.scaleToRef(I,t);const C=g.j.hc[5];Q.scaleToRef(R,C),C.addInPlace(n);const i=g.j.hc[6];C.subtractToRef(t,i);return I>0&&I<=this.length&&i.lengthSquared()<U*U?C.length():-1}update(q,c,U,J,Q,s,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){r._RayDistant||(r._RayDistant=r.Zero()),r._RayDistant.unprojectRayToRef(q,c,U,J,g.d.IdentityReadOnly,s,X);const n=g.j.Matrix[0];Q.invertToRef(n),r.TransformToRef(r._RayDistant,n,this)}else this.unprojectRayToRef(q,c,U,J,Q,s,X);return this}static Zero(){return new r(g.p.Zero(),g.p.Zero())}static CreateNew(q,c,U,J,Q,s,g){return r.Zero().update(q,c,U,J,Q,s,g)}static CreateNewFromTo(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.d.IdentityReadOnly;const J=new r(new g.p(0,0,0),new g.p(0,0,0));return r.CreateFromToToRef(q,c,J,U)}static CreateFromToToRef(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.d.IdentityReadOnly;U.origin.X(q);const Q=c.subtractToRef(q,U.direction),s=Math.sqrt(Q.x*Q.x+Q.y*Q.y+Q.z*Q.z);return U.length=s,U.direction.normalize(),r.TransformToRef(U,J,U)}static Transform(q,c){const U=new r(new g.p(0,0,0),new g.p(0,0,0));return r.TransformToRef(q,c,U),U}static TransformToRef(q,c,U){g.p.TransformCoordinatesToRef(q.origin,c,U.origin),g.p.TransformNormalToRef(q.direction,c,U.direction),U.length=q.length,U.epsilon=q.epsilon;const J=U.direction,Q=J.length();if(0!==Q&&1!==Q){const q=1/Q;J.x*=q,J.y*=q,J.z*=q,U.length*=Q}return U}unprojectRayToRef(q,c,U,J,Q,s,X){const n=g.j.Matrix[0];Q.multiplyToRef(s,n),n.multiplyToRef(X,n),n.invert();const W=D.c.LastCreatedEngine,u=g.j.hc[0];u.x=q/U*2-1,u.y=-(c/J*2-1),u.z=null!==W&&void 0!==W&&W.useReverseDepthBuffer?1:null!==W&&void 0!==W&&W.isNDCHalfZRange?0:-1;const K=g.j.hc[1].bc(u.x,u.y,1-1e-8),r=g.j.hc[2],H=g.j.hc[3];g.p._UnprojectFromInvertedMatrixToRef(u,n,r),g.p._UnprojectFromInvertedMatrixToRef(K,n,H),this.origin.X(r),H.subtractToRef(r,this.direction),this.direction.normalize()}}function H(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=r.Zero();return b(q,c,U,J,g,Q,s),g}function b(q,c,U,J,Q,s){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const W=q.getEngine();if(!s&&!(s=q.activeCamera))return q;const D=s.viewport,u=W.getRenderHeight(),{x:K,y:r,width:H,height:b}=D.toGlobal(W.getRenderWidth(),u),h=1/W.getHardwareScalingLevel();return c=c*h-K,U=U*h-(u-r-b),Q.update(c,U,H,b,J||g.d.IdentityReadOnly,X?g.d.IdentityReadOnly:s.getViewMatrix(),s.getProjectionMatrix(),n),q}function h(q,c,U,J,Q){if(!W.c)return q;const s=q.getEngine();if(!Q&&!(Q=q.activeCamera))throw new Error("Active camera not set");const X=Q.viewport,n=s.getRenderHeight(),{x:D,y:u,width:K,height:r}=X.toGlobal(s.getRenderWidth(),n),H=g.d.Identity(),b=1/s.getHardwareScalingLevel();return c=c*b-D,U=U*b-(n-u-r),J.update(c,U,K,r,H,H,Q.getProjectionMatrix()),q}function o(q,c,U,J,Q,s,g,X){const n=c(J,U.enableDistantPicking),W=U.intersects(n,Q,g,s,J,X);return W&&W.hit?!Q&&null!=q&&W.distance>=q.distance?null:W:null}function a(q,c,U,J,Q,s){let X=null;const n=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),D=q.cameraToUseForPointers||q.activeCamera,u=K.internalPickerForMesh||o;for(let W=0;W<q.meshes.length;W++){const K=q.meshes[W];if(U){if(!U(K,-1))continue}else if(!K.isEnabled()||!K.isVisible||!K.Pn)continue;const r=n&&K.isWorldMatrixCameraDependent(),H=K.o(r,D);if(K.hasThinInstances&&K.thinInstanceEnablePicking){const q=u(X,c,K,H,!0,!0,s);if(q){if(Q)return q;const n=g.j.Matrix[1],W=K.thinInstanceGetWorldMatrices();for(let q=0;q<W.length;q++){if(U&&!U(K,q))continue;W[q].multiplyToRef(H,n);const g=u(X,c,K,n,J,Q,s,!0);if(g&&(X=g,X.thinInstanceIndex=q,J))return X}}}else{const q=u(X,c,K,H,J,Q,s);if(q&&(X=q,J))return X}}return X||new W.c}function p(q,c,U,J){if(!W.c)return null;const Q=[],s=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),X=q.cameraToUseForPointers||q.activeCamera,n=K.internalPickerForMesh||o;for(let W=0;W<q.meshes.length;W++){const D=q.meshes[W];if(U){if(!U(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.Pn)continue;const u=s&&D.isWorldMatrixCameraDependent(),K=D.o(u,X);if(D.hasThinInstances&&D.thinInstanceEnablePicking){if(n(null,c,D,K,!0,!0,J)){const q=g.j.Matrix[1],s=D.thinInstanceGetWorldMatrices();for(let g=0;g<s.length;g++){if(U&&!U(D,g))continue;s[g].multiplyToRef(K,q);const X=n(null,c,D,q,!1,!1,J,!0);X&&(X.thinInstanceIndex=g,Q.push(X))}}}else{const q=n(null,c,D,K,!1,!1,J);q&&Q.push(q)}}return Q}function R(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;J||(J=q.getWorldMatrix()),c.length=U,Q?c.origin.X(Q):c.origin.X(q.position);const s=g.j.hc[2];s.set(0,0,q._scene.useRightHandedSystem?-1:1);const X=g.j.hc[3];return g.p.TransformNormalToRef(s,J,X),g.p.NormalizeToRef(X,c.direction),c}var I,t;r._TmpVector3=(0,X.d)(6,g.p.Zero),r._RayDistant=r.Zero(),r._Smallnum=1e-8,r._Rayl=1e9,I=J.b,(t=Q.d)&&(t.prototype.getForwardRay=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;return R(this,new r(g.p.Zero(),g.p.Zero(),q),q,c,U)},t.prototype.getForwardRayToRef=function(q){return R(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),I&&(u.b._IsPickingAvailable=!0,I.prototype.createPickingRay=function(q,c,U,J){return H(this,q,c,U,J,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),J.b.prototype.createPickingRayToRef=function(q,c,U,J,Q){return b(this,q,c,U,J,Q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},J.b.prototype.createPickingRayInCameraSpace=function(q,c,U){return function(q,c,U,J){const Q=r.Zero();return h(q,c,U,Q,J),Q}(this,q,c,U)},J.b.prototype.createPickingRayInCameraSpaceToRef=function(q,c,U,J){return h(this,q,c,U,J)},J.b.prototype.pickWithBoundingInfo=function(q,c,U,J,Q){return function(q,c,U,J,Q,s){if(!W.c)return null;const X=a(q,(J=>(q._tempPickingRay||(q._tempPickingRay=r.Zero()),b(q,c,U,J,q._tempPickingRay,s||null),q._tempPickingRay)),J,Q,!0);return X&&(X.ray=H(q,c,U,g.d.Identity(),s||null)),X}(this,q,c,U,J,Q)},J.b.prototype.dU=function(q,c,U,J,Q,s){return function(q,c,U,J,Q,s,X){const n=a(q,((J,Q)=>(q._tempPickingRay||(q._tempPickingRay=r.Zero()),b(q,c,U,J,q._tempPickingRay,s||null,!1,Q),q._tempPickingRay)),J,Q,!1,X);return n&&(n.ray=H(q,c,U,g.d.Identity(),s||null)),n}(this,q,c,U,J,Q,s)},J.b.prototype.pickWithRay=function(q,c,U,J){return function(q,c,U,J,Q){const s=a(q,(U=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=g.d.Identity()),U.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=r.Zero()),r.TransformToRef(c,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),U,J,!1,Q);return s&&(s.ray=c),s}(this,q,c,U,J)},J.b.prototype.multiPick=function(q,c,U,J,Q){return function(q,c,U,J,Q,s){return p(q,(J=>H(q,c,U,J,Q||null)),J,s)}(this,q,c,U,J,Q)},J.b.prototype.multiPickWithRay=function(q,c,U){return function(q,c,U,J){return p(q,(U=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=g.d.Identity()),U.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=r.Zero()),r.TransformToRef(c,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),U,J)}(this,q,c,U)}},12617:(q,c,U)=>{"use strict";var J=U(10976),Q=U(10886),s=U(10922),g=U(10995),X=U(10954),n=U(10988);X.d.prototype._partialLoadFile=function(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(q,(q=>{U[c]=q,U._internalCount++,6===U._internalCount&&J(U)}),void 0,void 0,!0,((q,c)=>{Q&&q&&Q(q.status+" "+q.statusText,c)}))},X.d.prototype._cascadeLoadFiles=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=[];Q._internalCount=0;for(let s=0;s<6;s++)this._partialLoadFile(U[s],s,Q,c,J)},X.d.prototype._cascadeLoadImgs=function(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(J[X],X,g,q,c,U,Q,s)},X.d.prototype._partialLoadImg=function(q,c,U,J,Q,X){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0;const D=(0,g.b)();(0,s.s)(q,(q=>{U[c]=q,U._internalCount++,J&&J.removePendingData(D),6===U._internalCount&&X&&X(Q,U)}),((q,c)=>{J&&J.removePendingData(D),n&&n(q,c)}),J?J.offlineProvider:null,W),J&&J.addPendingData(D)},X.d.prototype.createCubeTextureBase=function(q,c,U,s){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6?arguments[6]:void 0,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,o=arguments.length>14&&void 0!==arguments[14]&&arguments[14],a=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const p=H||new J.e(this,7);p.isCube=!0,p.url=q,p.generateMipMaps=!s,p._lodGenerationScale=K,p._lodGenerationOffset=r,p._useSRGBBuffer=!!o&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!s),p!==H&&(p.label=q.substring(0,60)),this._doNotHandleContextLost||(p._extension=D,p._files=U,p._buffer=a);const R=q;this._transformTextureUrl&&!H&&(q=this._transformTextureUrl(q));const I=D??function(q){const c=q.split("?")[0],U=c.lastIndexOf(".");return U>-1?c.substring(U).toLowerCase():""}(q),t=(0,n.c)(I),C=(q,c)=>{p.dispose(),X?X(q,c):q&&Q.c.Warn(q)},i=(J,X)=>{q===R?J&&C(J.status+" "+J.statusText,X):(Q.c.Warn(`Failed to load ${q}, falling back to the ${R}`),this.createCubeTextureBase(R,c,U,!!s,g,C,W,D,u,K,r,p,b,h,o,a))};if(t)t.then((J=>{const Q=q=>{b&&b(p,q),J.loadCubeData(q,p,u,g,((q,c)=>{C(q,c)}))};a?Q(a):U&&6===U.length?J.supportCascades?this._cascadeLoadFiles(c,(q=>Q(q.map((q=>new Uint8Array(q))))),U,C):C("Textures type does not support cascades."):this._loadFile(q,(q=>Q(new Uint8Array(q))),void 0,void 0,!0,i)}));else{if(!U||0===U.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,p,((q,c)=>{h&&h(q,c)}),U,C)}return this._internalTexturesCache.push(p),p}},13177:(q,c,U)=>{"use strict";U(10886);var J=U(11196);U(10976),U(11033),U(10857),U(11247),U(11201);J.e},12642:(q,c,U)=>{"use strict";U.d(c,{b:()=>Q});var J=U(10850);class Q{constructor(q){this.value=this._toInt(q)}_toInt(q){return 0|q}add(q){return new Q(this.value+q.value)}eU(q){return new Q(this.value-q.value)}multiply(q){return new Q(Math.imul(this.value,q.value))}divide(q){return new Q(this.value/q.value)}getClassName(){return Q.ClassName}equals(q){return this.value===q.value}static FromValue(q){return new Q(q)}toString(){return this.value.toString()}}Q.ClassName="FlowGraphInteger",(0,J.f)("FlowGraphInteger",Q)},12653:(q,c,U)=>{"use strict";U.d(c,{d:()=>Q,f:()=>s});var J=U(10833);class Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.tK=q}get m(){return this.tK}transformVector(q){return this.transformVectorToRef(q,new J.l)}transformVectorToRef(q,c){return c.x=q.x*this.tK[0]+q.y*this.tK[1],c.y=q.x*this.tK[2]+q.y*this.tK[3],c}rc(){return this.toArray()}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)q[c]=this.tK[c];return q}BU(q){for(let c=0;c<4;c++)this.tK[c]=q[c];return this}multiplyToRef(q,c){const U=q.tK,J=this.tK,Q=c.tK;return Q[0]=U[0]*J[0]+U[1]*J[2],Q[1]=U[0]*J[1]+U[1]*J[3],Q[2]=U[2]*J[0]+U[3]*J[2],Q[3]=U[2]*J[1]+U[3]*J[3],c}multiply(q){return this.multiplyToRef(q,new Q)}divideToRef(q,c){const U=this.tK,J=q.tK,Q=c.tK;return Q[0]=U[0]/J[0],Q[1]=U[1]/J[1],Q[2]=U[2]/J[2],Q[3]=U[3]/J[3],c}divide(q){return this.divideToRef(q,new Q)}addToRef(q,c){const U=this.tK,J=q.m,Q=c.m;return Q[0]=U[0]+J[0],Q[1]=U[1]+J[1],Q[2]=U[2]+J[2],Q[3]=U[3]+J[3],c}add(q){return this.addToRef(q,new Q)}subtractToRef(q,c){const U=this.tK,J=q.m,Q=c.m;return Q[0]=U[0]-J[0],Q[1]=U[1]-J[1],Q[2]=U[2]-J[2],Q[3]=U[3]-J[3],c}eU(q){return this.subtractToRef(q,new Q)}transpose(){const q=this.tK;return new Q([q[0],q[2],q[1],q[3]])}determinant(){const q=this.tK;return q[0]*q[3]-q[1]*q[2]}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const c=this.tK,U=1/q;return new Q([c[3]*U,-c[1]*U,-c[2]*U,c[0]*U])}equals(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.tK,J=q.m;return 0===c?U[0]===J[0]&&U[1]===J[1]&&U[2]===J[2]&&U[3]===J[3]:Math.abs(U[0]-J[0])<c&&Math.abs(U[1]-J[1])<c&&Math.abs(U[2]-J[2])<c&&Math.abs(U[3]-J[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.tK.join(", ")})`}}class s{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.tK=q}get m(){return this.tK}transformVector(q){return this.transformVectorToRef(q,new J.p)}transformVectorToRef(q,c){const U=this.tK;return c.x=q.x*U[0]+q.y*U[1]+q.z*U[2],c.y=q.x*U[3]+q.y*U[4]+q.z*U[5],c.z=q.x*U[6]+q.y*U[7]+q.z*U[8],c}multiplyToRef(q,c){const U=q.tK,J=this.tK,Q=c.m;return Q[0]=U[0]*J[0]+U[1]*J[3]+U[2]*J[6],Q[1]=U[0]*J[1]+U[1]*J[4]+U[2]*J[7],Q[2]=U[0]*J[2]+U[1]*J[5]+U[2]*J[8],Q[3]=U[3]*J[0]+U[4]*J[3]+U[5]*J[6],Q[4]=U[3]*J[1]+U[4]*J[4]+U[5]*J[7],Q[5]=U[3]*J[2]+U[4]*J[5]+U[5]*J[8],Q[6]=U[6]*J[0]+U[7]*J[3]+U[8]*J[6],Q[7]=U[6]*J[1]+U[7]*J[4]+U[8]*J[7],Q[8]=U[6]*J[2]+U[7]*J[5]+U[8]*J[8],c}multiply(q){return this.multiplyToRef(q,new s)}divideToRef(q,c){const U=this.tK,J=q.m,Q=c.m;return Q[0]=U[0]/J[0],Q[1]=U[1]/J[1],Q[2]=U[2]/J[2],Q[3]=U[3]/J[3],Q[4]=U[4]/J[4],Q[5]=U[5]/J[5],Q[6]=U[6]/J[6],Q[7]=U[7]/J[7],Q[8]=U[8]/J[8],c}divide(q){return this.divideToRef(q,new s)}addToRef(q,c){const U=this.tK,J=q.m,Q=c.m;return Q[0]=U[0]+J[0],Q[1]=U[1]+J[1],Q[2]=U[2]+J[2],Q[3]=U[3]+J[3],Q[4]=U[4]+J[4],Q[5]=U[5]+J[5],Q[6]=U[6]+J[6],Q[7]=U[7]+J[7],Q[8]=U[8]+J[8],c}add(q){return this.addToRef(q,new s)}subtractToRef(q,c){const U=this.tK,J=q.m,Q=c.m;return Q[0]=U[0]-J[0],Q[1]=U[1]-J[1],Q[2]=U[2]-J[2],Q[3]=U[3]-J[3],Q[4]=U[4]-J[4],Q[5]=U[5]-J[5],Q[6]=U[6]-J[6],Q[7]=U[7]-J[7],Q[8]=U[8]-J[8],c}eU(q){return this.subtractToRef(q,new s)}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)q[c]=this.tK[c];return q}rc(){return this.toArray()}BU(q){for(let c=0;c<9;c++)this.tK[c]=q[c];return this}transpose(){const q=this.tK;return new s([q[0],q[3],q[6],q[1],q[4],q[7],q[2],q[5],q[8]])}determinant(){const q=this.tK;return q[0]*(q[4]*q[8]-q[5]*q[7])-q[1]*(q[3]*q[8]-q[5]*q[6])+q[2]*(q[3]*q[7]-q[4]*q[6])}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const c=this.tK,U=1/q;return new s([(c[4]*c[8]-c[5]*c[7])*U,(c[2]*c[7]-c[1]*c[8])*U,(c[1]*c[5]-c[2]*c[4])*U,(c[5]*c[6]-c[3]*c[8])*U,(c[0]*c[8]-c[2]*c[6])*U,(c[2]*c[3]-c[0]*c[5])*U,(c[3]*c[7]-c[4]*c[6])*U,(c[1]*c[6]-c[0]*c[7])*U,(c[0]*c[4]-c[1]*c[3])*U])}equals(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.tK,J=q.m;return 0===c?U[0]===J[0]&&U[1]===J[1]&&U[2]===J[2]&&U[3]===J[3]&&U[4]===J[4]&&U[5]===J[5]&&U[6]===J[6]&&U[7]===J[7]&&U[8]===J[8]:Math.abs(U[0]-J[0])<c&&Math.abs(U[1]-J[1])<c&&Math.abs(U[2]-J[2])<c&&Math.abs(U[3]-J[3])<c&&Math.abs(U[4]-J[4])<c&&Math.abs(U[5]-J[5])<c&&Math.abs(U[6]-J[6])<c&&Math.abs(U[7]-J[7])<c&&Math.abs(U[8]-J[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.tK.join(", ")})`}}},12658:(q,c,U)=>{"use strict";var J;function Q(q,c,U,J){switch(c){case"Animation":return J?q.animations.find((q=>q.uniqueId===U))??null:q.animations[U]??null;case"AnimationGroup":return J?q.animationGroups.find((q=>q.uniqueId===U))??null:q.animationGroups[U]??null;case"Mesh":return J?q.meshes.find((q=>q.uniqueId===U))??null:q.meshes[U]??null;case"Material":return J?q.materials.find((q=>q.uniqueId===U))??null:q.materials[U]??null;case"HD":return J?q.cameras.find((q=>q.uniqueId===U))??null:q.cameras[U]??null;case"Light":return J?q.lights.find((q=>q.uniqueId===U))??null:q.lights[U]??null;default:return null}}U.d(c,{d:()=>Q}),function(q){q.Animation="Animation",q.AnimationGroup="AnimationGroup",q.Mesh="Mesh",q.Material="Material",q.HD="HD",q.Light="Light"}(J||(J={}))},12693:(q,c,U)=>{"use strict";U.d(c,{d:()=>Q});var J=U(12699);class Q extends J.e{constructor(q,c){if(super(q),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const U of c)this._eventsSignalOutputs[U]=this._registerSignalOutput(U+"Event")}_executeOnTick(q){}_startPendingTasks(q){q._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(q),this._resetAfterCanceled(q)),this._preparePendingTasks(q),q._addPendingBlock(this),this.out._activateSignal(q),q._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(q){q._deleteExecutionVariable(this,"_initialized"),q._removePendingBlock(this)}}},12667:(q,c,U)=>{"use strict";U.d(c,{c:()=>W});var J=U(10995),Q=U(10850),s=U(12671),g=U(10866),X=U(12633);class n extends s.e{constructor(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:J.defaultValue,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(q,c,U),this.richType=J,this._defaultValue=Q,this._optional=s,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(q){this._isDisabled!==q&&(this._isDisabled=q,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(q,c){c._getConnectionValue(this)!==q&&(c._setConnectionValue(this,q),this.onValueChangedObservable.notifyObservers(q))}resetToDefaultValue(q){q._setConnectionValue(this,this._defaultValue)}connectTo(q){this._isDisabled||super.connectTo(q)}_getValueOrDefault(q){const c=q._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(q){if(1===this.connectionType){q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(q);const c=this._getValueOrDefault(q);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(q):this._getValueOrDefault(q);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.richType={},this.richType.serialize(q.richType),q.optional=this._optional,(0,X.h)("defaultValue",this._defaultValue,q)}}(0,Q.f)("FlowGraphDataConnection",n);class W{constructor(q){var c;this.config=q,this.uniqueId=(0,J.b)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(q){}registerDataInput(q,c,U){const J=new n(q,0,this,c,U);return this.dataInputs.push(J),J}registerDataOutput(q,c,U){const J=new n(q,1,this,c,U);return this.dataOutputs.push(J),J}getDataInput(q){return this.dataInputs.find((c=>c.name===q))}getDataOutput(q){return this.dataOutputs.find((c=>c.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.h;if(q.uniqueId=this.uniqueId,q.config={},this.config){const U=this.config,J=Object.keys(U);for(const Q of J)c(Q,U[Q],q.config)}q.dataInputs=[],q.dataOutputs=[],q.className=this.getClassName();for(const U of this.dataInputs){const c={};U.serialize(c),q.dataInputs.push(c)}for(const U of this.dataOutputs){const c={};U.serialize(c),q.dataOutputs.push(c)}}deserialize(q){}_log(q,c,U){var J;null===(J=q.logger)||void 0===J||J.addLogItem({action:c,payload:U,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12671:(q,c,U)=>{"use strict";U.d(c,{e:()=>s});var J,Q=U(10995);!function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(J||(J={}));class s{constructor(q,c,U){this._ownerBlock=U,this._connectedPoint=[],this.uniqueId=(0,Q.b)(),this.connectedPointIds=[],this.name=q,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(q){if(this._connectionType===q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||q._isSingularConnection()&&q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(q),q._connectedPoint.push(this)}disconnectFrom(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=this._connectedPoint.indexOf(q),J=q._connectedPoint.indexOf(this);-1!==U&&-1!==J&&(c&&this._connectedPoint.splice(U,1),q._connectedPoint.splice(J,1))}disconnectFromAll(){for(const q of this._connectedPoint)this.disconnectFrom(q,!1);this._connectedPoint.length=0}dispose(){for(const q of this._connectedPoint)this.disconnectFrom(q)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.name=this.name,q._connectionType=this._connectionType,q.connectedPointIds=[],q.className=this.getClassName();for(const c of this._connectedPoint)q.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(q){this.uniqueId=q.uniqueId,this.name=q.name,this._connectionType=q._connectionType,this.connectedPointIds=q.connectedPointIds}}},12630:(q,c,U)=>{"use strict";U.d(c,{b:()=>p});var J,Q=U(10866),s=U(11010),g=U(11019),X=U(10995),n=U(12633),W=U(12658),D=U(10886);!function(q){q.ExecuteBlock="ExecuteBlock",q.ExecuteEvent="ExecuteEvent",q.TriggerConnection="TriggerConnection",q.ContextVariableSet="ContextVariableSet",q.GlobalVariableSet="GlobalVariableSet",q.GlobalVariableDelete="GlobalVariableDelete",q.GlobalVariableGet="GlobalVariableGet",q.AddConnection="AddConnection",q.GetConnectionValue="GetConnectionValue",q.SetConnectionValue="SetConnectionValue",q.ActivateSignal="ActivateSignal",q.ContextVariableGet="ContextVariableGet"}(J||(J={}));class u{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(q){if(q.time||(q.time=Date.now()),this.log.push(q),this.logToConsole){var c;const U=null===(c=q.payload)||void 0===c?void 0:c.value;"object"===typeof U&&U.getClassName?D.c.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(U.getClassName())}: ${U.toString()}`):D.c.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(q.payload)}`)}}getItemsOfType(q){return this.log.filter((c=>c.action===q))}}class K{get enableLogging(){return this._enableLogging}set enableLogging(q){this._enableLogging!==q&&(this._enableLogging=q,this._enableLogging?(this.logger=new u,this.logger.logToConsole=!0):this.logger=null)}constructor(q){this.uniqueId=(0,X.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Q.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=q,this.assetsContext=q.assetsContext??q.mc}hasVariable(q){return q in this._userVariables}setVariable(q,c){var U;this._userVariables[q]=c,null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:q,value:c}})}getAsset(q,c){return(0,W.d)(this.assetsContext,q,c)}getVariable(q){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:q,value:this._userVariables[q]}}),this._userVariables[q]}get userVariables(){return this._userVariables}Cq(){return this._configuration.mc}_getUniqueIdPrefixedName(q,c){return`${q.uniqueId}_${c}`}_getGlobalContextVariable(q,c){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:q,defaultValue:c,possibleValue:this._globalContextVariables[q]}}),this._hasGlobalContextVariable(q)?this._globalContextVariables[q]:c}_setGlobalContextVariable(q,c){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:q,value:c}}),this._globalContextVariables[q]=c}_deleteGlobalContextVariable(q){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:q}}),delete this._globalContextVariables[q]}_hasGlobalContextVariable(q){return q in this._globalContextVariables}_setExecutionVariable(q,c,U){this._executionVariables[this._getUniqueIdPrefixedName(q,c)]=U}_getExecutionVariable(q,c,U){return this._hasExecutionVariable(q,c)?this._executionVariables[this._getUniqueIdPrefixedName(q,c)]:U}_deleteExecutionVariable(q,c){delete this._executionVariables[this._getUniqueIdPrefixedName(q,c)]}_hasExecutionVariable(q,c){return this._getUniqueIdPrefixedName(q,c)in this._executionVariables}_hasConnectionValue(q){return q.uniqueId in this._connectionValues}_setConnectionValue(q,c){var U;this._connectionValues[q.uniqueId]=c,null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:q.uniqueId,value:c}})}_setConnectionValueByKey(q,c){this._connectionValues[q]=c}_getConnectionValue(q){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:q.uniqueId,value:this._connectionValues[q.uniqueId]}}),this._connectionValues[q.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(q){this._pendingBlocks.includes(q)||(this._pendingBlocks.push(q),this._pendingBlocks.sort(((q,c)=>q.priority-c.priority)))}_removePendingBlock(q){const c=this._pendingBlocks.indexOf(q);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const q of this._pendingBlocks)q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(q){var c;this.onNodeExecutedObservable.notifyObservers(q),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:q.getClassName(),uniqueId:q.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(q){this._setGlobalContextVariable("timeSinceStart",q.timeSinceStart),this._setGlobalContextVariable("deltaTime",q.deltaTime);for(const U of this._pendingBlocks){var c;null===(c=U._executeOnTick)||void 0===c||c.call(U,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.h;q.uniqueId=this.uniqueId,q._userVariables={};for(const J in this._userVariables)c(J,this._userVariables[J],q._userVariables);q._connectionValues={};for(const J in this._connectionValues)c(J,this._connectionValues[J],q._connectionValues);var U;this.assetsContext!==this.Cq()&&(q._assetsContext={meshes:this.assetsContext.meshes.map((q=>q.id)),materials:this.assetsContext.materials.map((q=>q.id)),textures:this.assetsContext.textures.map((q=>q.name)),animations:this.assetsContext.animations.map((q=>q.name)),lights:this.assetsContext.lights.map((q=>q.id)),cameras:this.assetsContext.cameras.map((q=>q.id)),zK:null===(U=this.assetsContext.zK)||void 0===U?void 0:U.map((q=>q.name)),skeletons:this.assetsContext.skeletons.map((q=>q.id)),qK:this.assetsContext.qK.map((q=>q.name)),geometries:this.assetsContext.geometries.map((q=>q.id)),multiMaterials:this.assetsContext.multiMaterials.map((q=>q.id)),transformNodes:this.assetsContext.transformNodes.map((q=>q.id))})}getClassName(){return"FlowGraphContext"}}(0,s.d)([(0,g.N)()],K.prototype,"uniqueId",void 0);var r=U(12664),H=U(11391);class b{constructor(q){this.onEventTriggeredObservable=new Q.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=q,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Cc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const q=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:q}}),this._startingTime+=q})),this._meshPickedObserver=this._scene.onPointerObservable.add((q=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:q})}),H.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((q=>{const c=q.pointerId,U=q.mesh,J=this._pointerUnderMeshState[c];!J&&U?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:c,mesh:U}}):J&&!U?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:c,mesh:J}}):J&&U&&J!==U&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:c,mesh:J,over:U}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:c,mesh:U,out:J}})),this._pointerUnderMeshState[c]=U}),H.d.POINTERMOVE)}dispose(){var q,c,U,J,Q;null===(q=this._sceneDisposeObserver)||void 0===q||q.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(U=this._sceneOnBeforeRenderObserver)||void 0===U||U.remove(),null===(J=this._meshPickedObserver)||void 0===J||J.remove(),null===(Q=this._meshUnderPointerObserver)||void 0===Q||Q.remove(),this.onEventTriggeredObservable.clear()}}var h,o=U(12677);!function(q){q[q.Stopped=0]="Stopped",q[q.Started=1]="Started"}(h||(h={}));class a{get state(){return this._state}set state(q){this._state=q,this.onStateChangedObservable.notifyObservers(q)}constructor(q){this.onStateChangedObservable=new Q.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=q.mc,this._sceneEventCoordinator=new b(this._scene),this._coordinator=q.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((q=>{for(const c of this._executionContexts){const U=this._getContextualOrder(q.type,c);for(const J of U)if(!J._executeEvent(c,q.payload))break}switch(q.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(q.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const q=new K({mc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(q),q}getContext(q){return this._executionContexts[q]}addEventBlock(q){if("PointerOver"!==q.type&&"PointerOut"!==q.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==q.type&&this._eventBlocks[q.type].push(q),1===this.state)for(const c of this._executionContexts)q._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const U of this._executionContexts)q._startPendingTasks(U)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((q=>{1===q&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const q of this._executionContexts)for(const c in this._eventBlocks){const U=this._getContextualOrder(c,q);for(const c of U)c._startPendingTasks(q)}}_getContextualOrder(q,c){const U=this._eventBlocks[q].sort(((q,c)=>c.initPriority-q.initPriority));if("MeshPick"===q){const q=[];for(const J of U){const Q=J.asset.getValue(c);let s=0;for(;s<U.length;s++){const q=U[s].asset.getValue(c);if(Q&&q&&(0,o.m)(Q,q))break}q.splice(s,0,J)}return q}return U}dispose(){var q;if(0!==this.state){this.state=0;for(const q of this._executionContexts)q._clearPendingBlocks();this._executionContexts.length=0;for(const q in this._eventBlocks)this._eventBlocks[q].length=0;null===(q=this._eventObserver)||void 0===q||q.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(q){const c=[],U=new Set;for(const J in this._eventBlocks)for(const q of this._eventBlocks[J])c.push(q),U.add(q.uniqueId);for(;c.length>0;){const J=c.pop();q(J);for(const q of J.dataInputs)for(const J of q._connectedPoint)U.has(J._ownerBlock.uniqueId)||(c.push(J._ownerBlock),U.add(J._ownerBlock.uniqueId));if(J instanceof r.e)for(const q of J.signalOutputs)for(const J of q._connectedPoint)U.has(J._ownerBlock.uniqueId)||(c.push(J._ownerBlock),U.add(J._ownerBlock.uniqueId))}}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;q.allBlocks=[],this.visitAllBlocks((c=>{const U={};c.serialize(U),q.allBlocks.push(U)})),q.executionContexts=[];for(const U of this._executionContexts){const J={};U.serialize(J,c),q.executionContexts.push(J)}}}class p{constructor(q){this.config=q,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.mc.Cc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.mc.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const q=this._executeOnNextFrame.slice(0);if(q.length)for(const c of q){this.notifyCustomEvent(c.id,c.data,!1);const q=this._executeOnNextFrame.findIndex((q=>q.uniqueId===c.uniqueId));-1!==q&&this._executeOnNextFrame.splice(q,1)}}));(p.SceneCoordinators.get(this.config.mc)??[]).push(this)}createGraph(){const q=new a({mc:this.config.mc,coordinator:this});return this._flowGraphs.push(q),q}removeGraph(q){const c=this._flowGraphs.indexOf(q);-1!==c&&(q.dispose(),this._flowGraphs.splice(c,1))}start(){for(const q of this._flowGraphs)q.start()}dispose(){var q,c;for(const Q of this._flowGraphs)Q.dispose();this._flowGraphs.length=0,null===(q=this._disposeObserver)||void 0===q||q.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const U=p.SceneCoordinators.get(this.config.mc)??[],J=U.indexOf(this);-1!==J&&U.splice(J,1)}serialize(q,c){q._flowGraphs=[];for(const U of this._flowGraphs){const J={};U.serialize(J,c),q._flowGraphs.push(J)}q.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(q){let c=this._customEventsMap.get(q);return c||(c=new Q.e,this._customEventsMap.set(q,c)),c}notifyCustomEvent(q,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:q,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(q)){const c=this._eventExecutionCounter.get(q);if(this._eventExecutionCounter.set(q,c+1),c>=p.MaxEventTypeExecutionPerFrame)return void(c===p.MaxEventTypeExecutionPerFrame&&D.c.Warn(`FlowGraphCoordinator: Too many executions of event "${q}".`))}else this._eventExecutionCounter.set(q,1);const U=this._customEventsMap.get(q);U&&U.notifyObservers(c)}}p.MaxEventsPerType=30,p.MaxEventTypeExecutionPerFrame=30,p.SceneCoordinators=new Map},12686:(q,c,U)=>{"use strict";U.d(c,{e:()=>Q});var J=U(12693);class Q extends J.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(q){q._notifyExecuteNode(this),this.done._activateSignal(q)}}},12664:(q,c,U)=>{"use strict";U.d(c,{e:()=>X});var J=U(12667),Q=U(12671),s=U(10850);class g extends Q.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(q){super.connectTo(q),this._connectedPoint.sort(((q,c)=>c.priority-q.priority))}_activateSignal(q){var c;if(null===(c=q.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(q,this),q._increaseExecutionId();else for(const U of this._connectedPoint)U._activateSignal(q)}}(0,s.f)("FlowGraphSignalConnection",g);class X extends J.c{constructor(q){super(q),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(q){const c=new g(q,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(q){const c=new g(q,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(q){const c=this.signalInputs.findIndex((c=>c.name===q));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(q){const c=this.signalOutputs.findIndex((c=>c.name===q));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(q,c){this.error.payload="string"===typeof c?new Error(c):c,this.error._activateSignal(q)}getSignalInput(q){return this.signalInputs.find((c=>c.name===q))}getSignalOutput(q){return this.signalOutputs.find((c=>c.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.signalInputs=[],q.signalOutputs=[];for(const c of this.signalInputs){const U={};c.serialize(U),q.signalInputs.push(U)}for(const c of this.signalOutputs){const U={};c.serialize(U),q.signalOutputs.push(U)}}deserialize(q){for(let c=0;c<q.signalInputs.length;c++){const U=this.getSignalInput(q.signalInputs[c].name);if(!U)throw new Error("Could not find signal input with name "+q.signalInputs[c].name+" in block "+q.className);U.deserialize(q.signalInputs[c])}for(let c=0;c<q.signalOutputs.length;c++){const U=this.getSignalOutput(q.signalOutputs[c].name);if(!U)throw new Error("Could not find signal output with name "+q.signalOutputs[c].name+" in block "+q.className);U.deserialize(q.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},12699:(q,c,U)=>{"use strict";U.d(c,{e:()=>Q});var J=U(12664);class Q extends J.e{constructor(q){super(q),this.out=this._registerSignalOutput("out")}}},12648:(q,c,U)=>{"use strict";U.d(c,{C:()=>r,G:()=>H,J:()=>b,N:()=>F,P:()=>v,S:()=>i,T:()=>C,c:()=>W,e:()=>K,i:()=>t,j:()=>h,n:()=>o,p:()=>a,t:()=>u,v:()=>I,y:()=>D});var J,Q=U(10833),s=U(11093),g=U(12642),X=U(12653);!function(q){q.Any="any",q.String="string",q.Number="number",q.Boolean="boolean",q.Object="object",q.Integer="FlowGraphInteger",q.Vector2="Vector2",q.hc="hc",q.Vector4="Vector4",q.Quaternion="Quaternion",q.Matrix="Matrix",q.Matrix2D="Matrix2D",q.Matrix3D="Matrix3D",q.Nc="Nc",q.Pc="Pc"}(J||(J={}));class n{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=q,this.defaultValue=c,this.animationType=U}serialize(q){q.typeName=this.typeName,q.defaultValue=this.defaultValue}}const W=new n("any",void 0),D=new n("string",""),u=new n("number",0,0),K=new n("boolean",!1),r=new n("Vector2",Q.l.Zero(),5),H=new n("hc",Q.p.Zero(),1),b=new n("Vector4",Q.q.Zero()),h=new n("Matrix",Q.d.Identity(),3),o=new n("Matrix2D",new X.d),a=new n("Matrix3D",new X.f),p=new n("Nc",s.c.Black(),4),R=new n("Pc",new s.e(0,0,0,0),7),I=new n("Quaternion",Q.g.Identity(),2);I.typeTransformer=q=>{if(q.getClassName){if("Vector4"===q.getClassName())return Q.g.Ic(q.rc());if("hc"===q.getClassName())return Q.g.FromEulerVector(q);if("Matrix"===q.getClassName())return Q.g.FromRotationMatrix(q)}return q};const t=new n("FlowGraphInteger",new g.b(0),0);function C(q){const c=q;switch(typeof q){case"string":return D;case"number":return u;case"boolean":return K;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return r;case"hc":return H;case"Vector4":return b;case"Matrix":return h;case"Nc":return p;case"Pc":return R;case"Quaternion":return I;case"FlowGraphInteger":return t;case"Matrix2D":return o;case"Matrix3D":return a}return W;default:return W}}function i(q){switch(q){case"string":return D;case"number":return u;case"boolean":return K;case"Vector2":return r;case"hc":return H;case"Vector4":return b;case"Matrix":return h;case"Nc":return p;case"Pc":return R;case"Quaternion":return I;case"FlowGraphInteger":return t;case"Matrix2D":return o;case"Matrix3D":return a;default:return W}}function F(q){switch(q){case"number":default:return 0;case"Vector2":return 5;case"hc":return 1;case"Matrix":return 3;case"Nc":return 4;case"Pc":return 7;case"Quaternion":return 2}}function v(q){switch(q){case 0:return u;case 5:return r;case 1:return H;case 3:return h;case 4:return p;case 7:return R;case 2:return I;default:return W}}},12633:(q,c,U)=>{"use strict";U.d(c,{d:()=>D,h:()=>W,l:()=>u});var J=U(11093),Q=U(10833),s=U(12642),g=U(12648),X=U(12653);function n(q){return"Vector2"===q||"hc"===q||"Vector4"===q||"Quaternion"===q||"Nc"===q||"Pc"===q}function W(q,c,U){var J;const Q=(null===c||void 0===c||null===(J=c.getClassName)||void 0===J?void 0:J.call(c))??"";if(n(Q)||function(q){return"Matrix"===q||"Matrix2D"===q||"Matrix3D"===q}(Q))U[q]={value:c.rc(),className:Q};else if("FlowGraphInteger"===Q)U[q]={value:c.value,className:Q};else if(Q&&(c.id||c.name))U[q]={id:c.id,name:c.name,className:Q};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);U[q]=c}}function D(q,c,U,W){const u=c[q];let K;const r=(null===u||void 0===u?void 0:u.type)??(null===u||void 0===u?void 0:u.className);if(function(q){return"Mesh"===q||"AbstractMesh"===q||"GroundMesh"===q||"InstanceMesh"===q||"LinesMesh"===q||"GoldbergMesh"===q||"GreasedLineMesh"===q||"TrailMesh"===q}(r)){let q=W.meshes.filter((q=>u.id?q.id===u.id:q.name===u.name));0===q.length&&(q=W.transformNodes.filter((q=>u.id?q.id===u.id:q.name===u.name))),K=u.uniqueId?q.find((q=>q.uniqueId===u.uniqueId)):q[0]}else if(n(r))K=function(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===q)return Q.l.Ic(c);if("hc"===q)return U&&(c[2]*=-1),Q.p.Ic(c);if("Vector4"===q)return Q.q.Ic(c);if("Quaternion"===q)return U&&(c[2]*=-1,c[3]*=-1),Q.g.Ic(c);if("Nc"===q)return new J.c(c[0],c[1],c[2]);if("Pc"===q)return new J.e(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${q}`)}(r,u.value);else if(function(q){return"AnimationGroup"===q}(r)){const q=W.animationGroups.filter((q=>q.name===u.name));K=1===q.length?q[0]:q.find((q=>q.uniqueId===u.uniqueId))}else K="Matrix"===r?Q.d.Ic(u.value):"Matrix2D"===r?new X.d(u.value):"Matrix3D"===r?new X.f(u.value):"FlowGraphInteger"===r?s.b.FromValue(u.value):"number"===r||"string"===r||"boolean"===r?u.value[0]:u&&void 0!==u.value?u.value:Array.isArray(u)?u.reduce(((q,c)=>c.eventData?(q[c.id]={type:(0,g.S)(c.type)},"undefined"!==typeof c.value&&(q[c.id].value=D("value",c,U,W)),q):q),{}):u;return K}function u(q){return"FlowGraphJsonPointerParserBlock"===q}},12677:(q,c,U)=>{"use strict";function J(q,c){return!(!q.parent||q.parent!==c&&!J(q.parent,c))}function Q(q){if(q.getClassName)return q.getClassName()}function s(q,c){return q===c&&("Vector2"===q||"hc"===q||"Vector4"===q||"Quaternion"===q)}function g(q,c){return q===c&&("Matrix"===q||"Matrix2D"===q||"Matrix3D"===q)}function X(q,c){return"FlowGraphInteger"===q&&"FlowGraphInteger"===c}function n(q,c){const U="number"===typeof q||"number"===typeof(null===q||void 0===q?void 0:q.value);return U&&!c?!isNaN(W(q)):U}function W(q){return"number"===typeof q?q:q.value}U.d(c,{e:()=>X,g:()=>g,h:()=>s,l:()=>Q,m:()=>J,n:()=>W,q:()=>n})},12053:(q,c,U)=>{"use strict";U.r(c),U.d(c,{SceneInstrumentation:()=>s});var J=U(10879),Q=U(11282);class s{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(q){q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=q,q?(this._onBeforeActiveMeshesEvaluationObserver=this.mc.onBeforeActiveMeshesEvaluationObservable.add((()=>{J.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.mc.onAfterActiveMeshesEvaluationObservable.add((()=>{J.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.mc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(q){q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=q,q?(this._onBeforeRenderTargetsRenderObserver=this.mc.onBeforeRenderTargetsRenderObservable.add((()=>{J.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.mc.onAfterRenderTargetsRenderObservable.add((()=>{J.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.mc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(q){q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=q,q?(this._onBeforeParticlesRenderingObserver=this.mc.onBeforeParticlesRenderingObservable.add((()=>{J.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.mc.onAfterParticlesRenderingObservable.add((()=>{J.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.mc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(q){q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=q,this.mc.spriteManagers&&(q?(this._onBeforeSpritesRenderingObserver=this.mc.onBeforeSpritesRenderingObservable.add((()=>{J.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.mc.onAfterSpritesRenderingObservable.add((()=>{J.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.mc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.mc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(q){q!==this._capturePhysicsTime&&this.mc.onBeforePhysicsObservable&&(this._capturePhysicsTime=q,q?(this._onBeforePhysicsObserver=this.mc.onBeforePhysicsObservable.add((()=>{J.e.StartPerformanceCounter("Ec"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.mc.onAfterPhysicsObservable.add((()=>{J.e.EndPerformanceCounter("Ec"),this._physicsTime.endMonitoring()}))):(this.mc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.mc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(q){q!==this._captureAnimationsTime&&(this._captureAnimationsTime=q,q?this._onAfterAnimationsObserver=this.mc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.mc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(q){this._captureFrameTime=q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(q){this._captureInterFrameTime=q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(q){q!==this._captureRenderTime&&(this._captureRenderTime=q,q?(this._onBeforeDrawPhaseObserver=this.mc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),J.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.mc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),J.e.EndPerformanceCounter("Main render")}))):(this.mc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(q){q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=q,q?(this._onBeforeCameraRenderObserver=this.mc.onBeforeCameraRenderObservable.add((q=>{this._cameraRenderTime.beginMonitoring(),J.e.StartPerformanceCounter(`Rendering camera ${q.name}`)})),this._onAfterCameraRenderObserver=this.mc.onAfterCameraRenderObservable.add((q=>{this._cameraRenderTime.endMonitoring(!1),J.e.EndPerformanceCounter(`Rendering camera ${q.name}`)}))):(this.mc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.mc.getEngine()._drawCalls}constructor(q){this.mc=q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Q.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Q.e,this._captureFrameTime=!1,this._frameTime=new Q.e,this._captureRenderTime=!1,this._renderTime=new Q.e,this._captureInterFrameTime=!1,this._interFrameTime=new Q.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Q.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Q.e,this._capturePhysicsTime=!1,this._physicsTime=new Q.e,this._captureAnimationsTime=!1,this._animationsTime=new Q.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Q.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(J.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.mc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(J.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Nu(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Nu(),this._captureParticlesRenderTime&&this._particlesRenderTime.Nu(),this._captureSpritesRenderTime&&this._spritesRenderTime.Nu(),this._captureRenderTime&&this._renderTime.Nu(),this._captureCameraRenderTime&&this._cameraRenderTime.Nu()}))}dispose(){this._disposed||(this.mc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.mc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.mc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.mc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.mc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.mc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.mc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.mc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.mc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.mc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.mc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.mc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.mc=null,this._disposed=!0)}}},12626:(q,c,U)=>{"use strict";U.d(c,{d:()=>D});var J=U(11010),Q=U(11019),s=U(10833),g=U(11113),X=U(11483),n=U(11545),W=U(10850);g.b.AddNodeConstructor("Light_Type_1",((q,c)=>()=>new D(q,s.p.Zero(),c)));class D extends n.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(q){this._shadowFrustumSize=q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(q){this._shadowOrthoScale=q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(q){this._orthoLeft=q}get orthoRight(){return this._orthoRight}set orthoRight(q){this._orthoRight=q}get orthoTop(){return this._orthoTop}set orthoTop(q){this._orthoTop=q}get orthoBottom(){return this._orthoBottom}set orthoBottom(q){this._orthoBottom=q}constructor(q,c,U){super(q,U),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"qg"}getTypeID(){return X.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(q,c,U){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(q):this._setDefaultAutoExtendShadowProjectionMatrix(q,c,U)}_setDefaultFixedFrustumShadowProjectionMatrix(q){const c=this.Cq().activeCamera;c&&s.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.Oc,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,q,this.Cq().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(q,c,U){const J=this.Cq().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const q=s.p.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let J=Number.MAX_VALUE,Q=-Number.MAX_VALUE;for(let g=0;g<U.length;g++){const X=U[g];if(!X)continue;const n=X.getBoundingInfo().boundingBox;for(let U=0;U<n.vectorsWorld.length;U++)s.p.TransformCoordinatesToRef(n.vectorsWorld[U],c,q),q.x<this._orthoLeft&&(this._orthoLeft=q.x),q.y<this._orthoBottom&&(this._orthoBottom=q.y),q.x>this._orthoRight&&(this._orthoRight=q.x),q.y>this._orthoTop&&(this._orthoTop=q.y),this.autoCalcShadowZBounds&&(q.z<J&&(J=q.z),q.z>Q&&(Q=q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=J,this._shadowMaxZ=Q)}const Q=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.Oc)||0,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4,W=this.Cq().getEngine().useReverseDepthBuffer;s.d.OrthoOffCenterLHToRef(this._orthoLeft-Q*this.shadowOrthoScale,this._orthoRight+Q*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,W?n:X,W?X:n,q,this.Cq().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(q,c){return this.computeTransformedInformation()?(q.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(q.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(q){const c=this._scene.getEngine();return!c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}getDepthMaxZ(q){const c=this._scene.getEngine();return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(q,c){q["DIRLIGHT"+c]=!0}}(0,J.d)([(0,Q.N)()],D.prototype,"shadowFrustumSize",null),(0,J.d)([(0,Q.N)()],D.prototype,"shadowOrthoScale",null),(0,J.d)([(0,Q.N)()],D.prototype,"autoUpdateExtends",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"autoCalcShadowZBounds",void 0),(0,J.d)([(0,Q.N)("orthoLeft")],D.prototype,"_orthoLeft",void 0),(0,J.d)([(0,Q.N)("orthoRight")],D.prototype,"_orthoRight",void 0),(0,J.d)([(0,Q.N)("orthoTop")],D.prototype,"_orthoTop",void 0),(0,J.d)([(0,Q.N)("orthoBottom")],D.prototype,"_orthoBottom",void 0),(0,W.f)("BABYLON.DirectionalLight",D)},13101:(q,c,U)=>{"use strict";U.d(c,{b:()=>D});var J=U(11010),Q=U(11019),s=U(10833),g=U(11093),X=U(11113),n=U(11483),W=U(10850);X.b.AddNodeConstructor("Light_Type_3",((q,c)=>()=>new D(q,s.p.Zero(),c)));class D extends n.c{constructor(q,c,U){super(q,U),this.groundColor=new g.c(0,0,0),this.direction=c||s.p.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"cg"}setDirectionToTarget(q){return this.direction=s.p.Normalize(q.eU(s.p.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(q,c){const U=s.p.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",U.x,U.y,U.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.zc),c),this}transferToNodeMaterialEffect(q,c){const U=s.p.Normalize(this.direction);return q.setFloat3(c,U.x,U.y,U.z),this}o(){return this._worldMatrix||(this._worldMatrix=s.d.Identity()),this._worldMatrix}getTypeID(){return n.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(q,c){q["HEMILIGHT"+c]=!0}}(0,J.d)([(0,Q.j)()],D.prototype,"groundColor",void 0),(0,J.d)([(0,Q.K)()],D.prototype,"direction",void 0),(0,W.f)("BABYLON.HemisphericLight",D)},12598:(q,c,U)=>{"use strict";U.d(c,{c:()=>u});var J=U(11010),Q=U(11019),s=U(10833),g=U(11113),X=U(11483),n=U(11545),W=U(11288),D=U(10850);g.b.AddNodeConstructor("Light_Type_2",((q,c)=>()=>new u(q,s.p.Zero(),s.p.Zero(),0,0,c)));class u extends n.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(q){this._iesProfileTexture!==q&&(this._iesProfileTexture=q,this._iesProfileTexture&&u._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(q){this._angle=q,this._cosHalfAngle=Math.cos(.5*q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(q){this._innerAngle=q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(q){this._shadowAngleScale=q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(q){this._projectionTextureLightNear=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(q){this._projectionTextureLightFar=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(q){this._projectionTextureUpDirection=q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(q){this._projectionTexture!==q&&(this._projectionTexture=q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(u._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):u._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(q){return void 0!==q.onGeneratedObservable}static _IsTexture(q){return void 0!==q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(q){this._projectionTextureProjectionLightMatrix=q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(q,c,U,J,Q,g){super(q,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=s.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=s.p.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=s.p.Zero(),this._projectionTextureViewLightMatrix=s.d.Zero(),this._projectionTextureProjectionLightMatrix=s.d.Zero(),this._projectionTextureScalingMatrix=s.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=U,this.angle=J,this.exponent=Q}getClassName(){return"SpotLight"}getTypeID(){return X.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(q){super._setDirection(q),this._projectionTextureViewLightDirty=!0}_setPosition(q){super._setPosition(q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(q,c,U){const J=this.Cq().activeCamera;if(!J)return;this._shadowAngleScale=this._shadowAngleScale||1;const Q=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:J.Oc,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,n=this.Cq().getEngine().useReverseDepthBuffer;s.d.PerspectiveFovLHToRef(Q,1,n?X:g,n?g:X,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,n)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),s.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const q=this.projectionTextureLightFar,c=this.projectionTextureLightNear,U=q/(q-c),J=-U*c,Q=1/Math.tan(this._angle/2);s.d.FromValuesToRef(Q/1,0,0,0,0,Q,0,0,0,0,U,1,0,0,J,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof W.c){const q=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;s.d.FromValuesToRef(q,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(q,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),q.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),q.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&q.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(q,c){let U;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),U=s.p.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),U=s.p.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",U.x,U.y,U.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(q,c){let U;return U=this.computeTransformedInformation()?s.p.Normalize(this.transformedDirection):s.p.Normalize(this.direction),this.Cq().useRightHandedSystem?q.setFloat3(c,-U.x,-U.y,-U.z):q.setFloat3(c,U.x,U.y,U.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(q){const c=this._scene.getEngine(),U=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.Oc)??0;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?U:this._scene.getEngine().isNDCHalfZRange?0:U}getDepthMaxZ(q){const c=this._scene.getEngine(),U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)??1e4;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:U}prepareLightSpecificDefines(q,c){q["SPOTLIGHT"+c]=!0,q["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),q["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,J.d)([(0,Q.N)()],u.prototype,"angle",null),(0,J.d)([(0,Q.N)()],u.prototype,"innerAngle",null),(0,J.d)([(0,Q.N)()],u.prototype,"shadowAngleScale",null),(0,J.d)([(0,Q.N)()],u.prototype,"exponent",void 0),(0,J.d)([(0,Q.N)()],u.prototype,"projectionTextureLightNear",null),(0,J.d)([(0,Q.N)()],u.prototype,"projectionTextureLightFar",null),(0,J.d)([(0,Q.N)()],u.prototype,"projectionTextureUpDirection",null),(0,J.d)([(0,Q.D)("projectedLightTexture")],u.prototype,"_projectionTexture",void 0),(0,D.f)("BABYLON.SpotLight",u)},12331:(q,c,U)=>{"use strict";U.d(c,{e:()=>g,i:()=>s,k:()=>X});const J={},Q={};function s(q,c){J[q]=c}function g(q,c){Q[q]=c}function X(q){return Q[q]?Q[q]:null}},12228:(q,c,U)=>{"use strict";U.d(c,{e:()=>C,f:()=>x});var J,Q=U(10879),s=U(10866),g=U(11364),X=U(10864),n=U(10886),W=U(11175),D=U(10922),u=U(10928),K=U(10995),r=U(10954),H=U(10913);!function(q){q[q.Clean=0]="Clean",q[q.Stop=1]="Stop",q[q.Sync=2]="Sync",q[q.NoSync=3]="NoSync"}(J||(J={}));const b=new s.e,h={};let o=!1;function a(){return h[".babylon"]}function p(q,c){const U=h[q];return U||(n.c.Warn("Unable to find a plugin to load "+q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?a():void 0)}function R(q,c,U){let J="Unable to load from "+(q.rawData?"binary data":q.url);return c?J+=`: ${c}`:U&&(J+=`: ${U}`),J}async function I(q,c,U,J,Q,s,g,X,n){var W;const u="data:"===(K=q.url).substring(0,5)?K.substring(5):null;var K;if(q.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const o=u||g?"":function(q){const c=q.indexOf("?");-1!==c&&(q=q.substring(0,c));const U=q.lastIndexOf(".");return q.substring(U,q.length).toLowerCase()}(q.url);let R=g?p(g,!0):u?function(q){for(const c in h){const U=h[c].plugin;if(U.canDirectLoad&&U.canDirectLoad(q))return h[c]}return a()}(q.url):p(o,!1);if(!R&&o){if(q.url&&!q.url.startsWith("blob:")){const c=await async function(q,c){const U=c.method||"GET";return await new Promise(((J,Q)=>{const s=new H.d;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const q={};if(c.responseHeaders)for(const U of c.responseHeaders)q[U]=s.getResponseHeader(U)||"";J({response:s.response,headerValues:q})}else Q(`Unable to fetch data from ${q}. Error code: ${s.status}`)})),s.open(U,q),s.send()}))}(q.url,{method:"HEAD",responseHeaders:["Content-Type"]}),U=c.headerValues?c.headerValues["Content-Type"]:"";U&&(R=function(q){for(const c in h){const U=h[c];if(U.mimeType===q)return U}}(U))}R||(R=a())}if(!R)throw new Error(`No plugin or fallback for ${g??q.url}`);if(!1===(null===n||void 0===n||null===(W=n[R.plugin.name])||void 0===W?void 0:W.enabled))throw new Error(`The '${R.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(q.rawData&&!R.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(q=>{if(R.plugin.createPlugin){const c=R.plugin.createPlugin(n??{});return c instanceof Promise?(c.then(q).catch((q=>{Q("Error instantiating plugin.",q)})),null):(q(c),c)}return q(R.plugin),R.plugin})((n=>{var W;if(!n)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(b.notifyObservers(n),u&&(n.canDirectLoad&&n.canDirectLoad(q.url)||!(0,D.i)(q.url))){if(n.directLoad){const q=n.directLoad(c,u);q instanceof Promise?q.then((q=>{U(n,q)})).catch((q=>{Q("Error in directLoad of _loadData: "+q,q)})):U(n,q)}else U(n,u);return}const K=R.isBinary,H=(q,J)=>{c.u?Q("Scene has been disposed"):U(n,q,J)};let h=null,o=!1;null===(W=n.Cc)||void 0===W||W.add((()=>{o=!0,h&&(h.abort(),h=null),s()}));const a=()=>{if(o)return;const U=(q,c)=>{Q(null===q||void 0===q?void 0:q.statusText,c)};if(!n.loadFile&&q.rawData)throw"Plugin does not support loading ArrayBufferView.";h=n.loadFile?n.loadFile(c,q.rawData||q.file||q.url,q.rootUrl,H,J,K,U,X):c._loadFile(q.file||q.url,H,J,!0,K,U)},p=c.getEngine();let I=p.enableOfflineSupport;if(I){let U=!1;for(const J of c.disableOfflineSupportExceptionRules)if(J.test(q.url)){U=!0;break}I=!U}I&&r.d.OfflineProviderFactory?c.offlineProvider=r.d.OfflineProviderFactory(q.url,a,p.disableManifestCheck):a()}))}function t(q,c){let U,J,s=null,g=null;if(c)if(c.name)U=`file:${c.name}`,J=c.name,s=c;else if(ArrayBuffer.isView(c))U="",J=(0,K.b)(),g=c;else if(c.startsWith("data:"))U=c,J="";else if(q){const s=c;if("/"===s.substring(0,1))return Q.e.Error("Wrong sceneFilename parameter"),null;U=q+s,J=s}else U=c,J=Q.e.GetFilename(c),q=Q.e.GetFolderPath(c);else U=q,J=Q.e.GetFilename(q),q=Q.e.GetFolderPath(q);return{url:U,rootUrl:q,name:J,file:s,rawData:g}}function C(q){if("string"===typeof q.extensions){const c=q.extensions;h[c.toLowerCase()]={plugin:q,isBinary:!1}}else{const c=q.extensions,U=Object.keys(c);for(const J of U)h[J.toLowerCase()]={plugin:q,isBinary:c[J].isBinary,mimeType:c[J].mimeType}}}async function i(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.c.LastCreatedScene,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!J)return n.c.Error("No scene available to import mesh to"),null;const r=t(c,U);if(!r)return null;const H={};J.addPendingData(H);const b=()=>{J.removePendingData(H)},h=(q,c)=>{const U=R(r,q,c);g?g(J,U,new u.i(U,u.e.SceneLoaderError,c)):n.c.Error(U),b()},o=s?q=>{try{s(q)}catch(c){h("Error in onProgress callback: "+c,c)}}:void 0,a=(q,c,U,s,g,X,n,W)=>{if(J.importedMeshesFiles.push(r.url),Q)try{Q(q,c,U,s,g,X,n,W)}catch(D){h("Error in onSuccess callback: "+D,D)}J.removePendingData(H)};return await I(r,J,((c,U,Q)=>{if(c.rewriteRootURL&&(r.rootUrl=c.rewriteRootURL(r.rootUrl,Q)),c.importMesh){const Q=[],s=[],g=[];if(!c.importMesh(q,J,U,r.rootUrl,Q,s,g,h))return;J.loadingPluginName=c.name,a(Q,s,g,[],[],[],[],[])}else{c.importMeshAsync(q,J,U,r.rootUrl,o,r.name).then((q=>{J.loadingPluginName=c.name,a(q.meshes,q.qK,q.skeletons,q.animationGroups,q.transformNodes,q.geometries,q.lights,q.spriteManagers)})).catch((q=>{h(q.message,q)}))}}),o,h,b,W,D,K)}async function F(q,c,U,J,Q,s,g,X){return await new Promise(((n,W)=>{try{i(q,c,U,J,((q,c,U,J,Q,s,g,X)=>{n({meshes:q,qK:c,skeletons:U,animationGroups:J,transformNodes:Q,geometries:s,lights:g,spriteManagers:X})}),Q,((q,c,U)=>{W(U||new Error(c))}),s,g,X).catch(W)}catch(u){W(u)}}))}async function v(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedEngine,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};U?await k(q,c,new g.b(U),J,s,n,W,D,u):Q.e.Error("No engine available")}async function Y(q,c,U,J,Q,s,g){return await new Promise(((X,n)=>{v(q,c,U,(q=>{X(q)}),J,((q,c,U)=>{n(U||new Error(c))}),Q,s,g)}))}async function k(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!U)return n.c.Error("No scene available to append to"),null;const r=t(q,c);if(!r)return null;const H={};U.addPendingData(H);const b=()=>{U.removePendingData(H)};W.c.ShowLoadingScreen&&!o&&(o=!0,U.getEngine().displayLoadingUI(),U.executeWhenReady((()=>{U.getEngine().hideLoadingUI(),o=!1})));const h=(q,c)=>{const J=R(r,q,c);s?s(U,J,new u.i(J,u.e.SceneLoaderError,c)):n.c.Error(J),b()},a=Q?q=>{try{Q(q)}catch(c){h("Error in onProgress callback",c)}}:void 0,p=()=>{if(J)try{J(U)}catch(q){h("Error in onSuccess callback",q)}U.removePendingData(H)};return await I(r,U,((q,c)=>{if(q.load){if(!q.load(U,c,r.rootUrl,h))return;U.loadingPluginName=q.name,p()}else{q.loadAsync(U,c,r.rootUrl,a,r.name).then((()=>{U.loadingPluginName=q.name,p()})).catch((q=>{h(q.message,q)}))}}),a,h,b,g,D,K)}async function V(q,c,U,J,Q,s,g){return await new Promise(((X,n)=>{try{k(q,c,U,(q=>{X(q)}),J,((q,c,U)=>{n(U||new Error(c))}),Q,s,g).catch(n)}catch(u){n(u)}}))}async function O(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!U)return n.c.Error("No scene available to load asset container to"),null;const K=t(q,c);if(!K)return null;const r={};U.addPendingData(r);const H=()=>{U.removePendingData(r)},b=(q,c)=>{const J=R(K,q,c);s?s(U,J,new u.i(J,u.e.SceneLoaderError,c)):n.c.Error(J),H()},h=Q?q=>{try{Q(q)}catch(c){b("Error in onProgress callback",c)}}:void 0,o=q=>{if(J)try{J(q)}catch(c){b("Error in onSuccess callback",c)}U.removePendingData(r)};return await I(K,U,((q,c)=>{if(q.loadAssetContainer){const J=q.loadAssetContainer(U,c,K.rootUrl,b);if(!J)return;J.populateRootNodes(),U.loadingPluginName=q.name,o(J)}else if(q.loadAssetContainerAsync){q.loadAssetContainerAsync(U,c,K.rootUrl,h,K.name).then((c=>{c.populateRootNodes(),U.loadingPluginName=q.name,o(c)})).catch((q=>{b(q.message,q)}))}else b("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),h,b,H,g,W,D)}async function G(q,c,U,J,Q,s,g){return await new Promise(((X,n)=>{try{O(q,c,U,(q=>{X(q)}),J,((q,c,U)=>{n(U||new Error(c))}),Q,s,g).catch(n)}catch(u){n(u)}}))}async function S(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!U)return void n.c.Error("No scene available to load animations to");if(J){for(const J of U.animatables)J.reset();U.stopAllAnimations();const q=U.animationGroups.slice();for(const U of q)U.dispose();const c=U.getNodes();for(const U of c)U.animations&&(U.animations=[])}else switch(Q){case 0:const q=U.animationGroups.slice();for(const c of q)c.dispose();break;case 1:for(const c of U.animationGroups)c.stop();break;case 2:for(const c of U.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void n.c.Error("Unknown animation group loading mode value '"+Q+"'")}const H=U.animatables.length;await O(q,c,U,(q=>{q.mergeAnimationsTo(U,U.animatables.slice(H),s),q.dispose(),U.onAnimationFileImportedObservable.notifyObservers(U),g&&g(U)}),W,D,u,K,r)}async function Z(q,c,U,J,Q,s,g,X,n,W){return await new Promise(((D,K)=>{try{S(q,c,U,J,Q,s,(q=>{D(q)}),g,((q,c,U)=>{K(U||new Error(c))}),X,n,W).catch(K)}catch(u){K(u)}}))}class x{static get ForceFullSceneLoadingForIncremental(){return W.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){W.c.ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return W.c.ShowLoadingScreen}static set ShowLoadingScreen(q){W.c.ShowLoadingScreen=q}static get loggingLevel(){return W.c.loggingLevel}static set loggingLevel(q){W.c.loggingLevel=q}static get CleanBoneMatrixWeights(){return W.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){W.c.CleanBoneMatrixWeights=q}static GetDefaultPlugin(){return a()}static GetPluginForExtension(q){var c;return null===(c=p(q,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(q){return function(q){return!!h[q]}(q)}static RegisterPlugin(q){C(q)}static ImportMesh(q,c,U,J,Q,s,g,n,W){i(q,c,U,J,Q,s,g,n,W).catch((q=>null===g||void 0===g?void 0:g(X.c.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportMeshAsync(q,c,U,J,Q,s,g){return await F(q,c,U,J,Q,s,g)}static Load(q,c,U,J,Q,s,g,n){v(q,c,U,J,Q,s,g,n).catch((q=>null===s||void 0===s?void 0:s(X.c.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAsync(q,c,U,J,Q,s){return await Y(q,c,U,J,Q,s)}static Append(q,c,U,J,Q,s,g,n){k(q,c,U,J,Q,s,g,n).catch((q=>null===s||void 0===s?void 0:s(U??X.c.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async AppendAsync(q,c,U,J,Q,s){return await V(q,c,U,J,Q,s)}static LoadAssetContainer(q,c,U,J,Q,s,g,n){O(q,c,U,J,Q,s,g,n).catch((q=>null===s||void 0===s?void 0:s(U??X.c.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAssetContainerAsync(q,c,U,J,Q,s){return await G(q,c,U,J,Q,s)}static ImportAnimations(q,c,U,J,Q,s,g,n,W,D,u){S(q,c,U,J,Q,s,g,n,W,D,u).catch((q=>null===W||void 0===W?void 0:W(U??X.c.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportAnimationsAsync(q,c,U,J,Q,s,g,X,n,W,D){return await Z(q,c,U,J,Q,s,X,W,D)}}x.NO_LOGGING=0,x.MINIMAL_LOGGING=1,x.SUMMARY_LOGGING=2,x.DETAILED_LOGGING=3,x.OnPluginActivatedObservable=b},12610:(q,c,U)=>{"use strict";U.d(c,{c:()=>K});var J=U(11010),Q=U(11019),s=U(10879),g=U(10833),X=U(11280),n=U(11288),W=U(10850),D=U(10866),u=U(11082);U(12617);class K extends X.b{set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const c=this.Cq();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(q){this._rotationY=q,this.setReflectionTextureMatrix(g.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(q,c,U){let J="";for(const Q of q)J+=Q;return new K(J,c,null,U,q)}static CreateFromPrefilteredData(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const s=new K(q,c,null,!1,null,null,null,void 0,!0,U,J);return c.useDelayedTextureLoading=Q,s}constructor(q,c){var U;let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,o=arguments.length>13?arguments[13]:void 0,a=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new D.e,this.boundingBoxPosition=g.p.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.d,this._buffer=null,this.name=q,this.url=q,this._noMipmap=Q,this.Hc=!1,this.isCube=!0,this._textureMatrix=g.d.Identity(),this.coordinatesMode=n.c.CUBIC_MODE;let p=null,R=null;null===J||Array.isArray(J)?(this._noMipmap=Q,this._format=u,this._createPolynomials=H,p=J,this._loaderOptions=o,this._useSRGBBuffer=a,this._lodScale=b,this._lodOffset=h):(p=J.extensions??null,this._noMipmap=J.noMipmap??!1,s=J.files??null,R=J.buffer??null,this._format=J.format??5,K=J.prefiltered??!1,r=J.forcedExtension??null,this._createPolynomials=J.createPolynomials??!1,this._lodScale=J.lodScale??.8,this._lodOffset=J.lodOffset??0,this._loaderOptions=J.loaderOptions,this._useSRGBBuffer=J.useSRGBBuffer,X=J.L??null,W=J.onError??null),(q||s)&&this.updateURL(q,r,X,K,W,p,null===(U=this.Cq())||void 0===U?void 0:U.useDelayedTextureLoading,s,R)}getClassName(){return"CubeTexture"}updateURL(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,c&&(this._forcedExtension=c);const W=q.lastIndexOf("."),D=c||(W>-1?q.substring(W).toLowerCase():""),u=0===D.indexOf(".dds"),K=0===D.indexOf(".env"),r=0===D.indexOf(".basis");if(K?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=J,J&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(r||K||u||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(let c=0;c<s.length;c++)this._files.push(q+s[c]);this._extensions=s}this._buffer=n,g?(this.delayLoadState=4,this._delayedOnLoad=U,this._delayedOnError=Q):this._loadTexture(U,Q)}delayLoad(q){4===this.delayLoadState&&(q&&(this._forcedExtension=q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(q){var c,U;if(q.updateFlag===this._textureMatrix.updateFlag)return;q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(U=this.Cq())||void 0===U||U.markAllMaterialsAsDirty(1,(q=>-1!==q.getActiveTextures().indexOf(this))));if(this._textureMatrix=q,null===(c=this.Cq())||void 0===c||!c.useRightHandedSystem)return;const J=g.j.hc[0],Q=g.j.Quaternion[0],s=g.j.hc[1];this._textureMatrix.decompose(J,Q,s),Q.z*=-1,Q.w*=-1,g.d.ComposeToRef(J,Q,s,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var q;return null!==(q=this.Cq())&&void 0!==q&&q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this.Cq(),J=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Q=()=>{var c;(this.onLoadObservable.notifyObservers(this),J)&&(J.dispose(),null===(c=this.Cq())||void 0===c||c.markAllMaterialsAsDirty(1));q&&q()},g=(q,U)=>{this._loadingError=!0,this._errorObject={message:q,exception:U},c&&c(q,U),n.c.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?s.e.SetImmediate((()=>Q())):this._texture.onLoadedObservable.add((()=>Q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,U,this._lodScale,this._lodOffset,q,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,U,this._files,this._noMipmap,q,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(q,c,U){const J=u.e.Parse((()=>{let J=!1;return q.prefiltered&&(J=q.prefiltered),new K(U+(q.url??q.name),c,q.extensions,!1,q.files||null,null,null,void 0,J,q.forcedExtension)}),q,c);if(q.boundingBoxPosition&&(J.boundingBoxPosition=g.p.Ic(q.boundingBoxPosition)),q.boundingBoxSize&&(J.boundingBoxSize=g.p.Ic(q.boundingBoxSize)),q.animations)for(let Q=0;Q<q.animations.length;Q++){const c=q.animations[Q],U=(0,W.d)("BABYLON.Animation");U&&J.animations.push(U.Parse(c))}return J}clone(){let q=0;const c=u.e.Clone((()=>{const c=new K(this.url,this.Cq()||this._getEngine(),this._extensions,this._noMipmap,this._files);return q=c.uniqueId,c}),this);return c.uniqueId=q,c}}(0,J.d)([(0,Q.N)()],K.prototype,"url",void 0),(0,J.d)([(0,Q.K)()],K.prototype,"boundingBoxPosition",void 0),(0,J.d)([(0,Q.K)()],K.prototype,"boundingBoxSize",null),(0,J.d)([(0,Q.N)("rotationY")],K.prototype,"rotationY",null),(0,J.d)([(0,Q.N)("files")],K.prototype,"_files",void 0),(0,J.d)([(0,Q.N)("forcedExtension")],K.prototype,"_forcedExtension",void 0),(0,J.d)([(0,Q.N)("extensions")],K.prototype,"_extensions",void 0),(0,J.d)([(0,Q.w)("textureMatrix")],K.prototype,"_textureMatrix",void 0),(0,J.d)([(0,Q.w)("textureMatrixRefraction")],K.prototype,"_textureMatrixRefraction",void 0),n.c._CubeTextureParser=K.Parse,(0,W.f)("BABYLON.CubeTexture",K)},13110:(q,c,U)=>{"use strict";U.d(c,{c:()=>n});var J=U(10886),Q=U(11288),s=U(11002),g=U(11199),X=U(10976);g.ThinEngine.prototype.createDynamicTexture=function(q,c,U,J){const Q=new X.e(this,4);return Q.baseWidth=q,Q.baseHeight=c,U&&(q=this.needPOTTextures?(0,s.h)(q,this._caps.maxTextureSize):q,c=this.needPOTTextures?(0,s.h)(c,this._caps.maxTextureSize):c),Q.width=q,Q.height=c,Q.isReady=!1,Q.generateMipMaps=U,Q.samplingMode=J,this.updateTextureSamplingMode(J,Q),this._internalTexturesCache.push(Q),Q},g.ThinEngine.prototype.updateDynamicTexture=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!q)return;const g=this._gl,X=g.TEXTURE_2D,n=this._bindTextureDirectly(X,q,!0,s);this._unpackFlipY(void 0===U?q.invertY:U),J&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const W=this._getWebGLTextureType(q.type),D=this._getInternalFormat(Q||q.format),u=this._getRGBABufferInternalSizedFormat(q.type,D);g.texImage2D(X,0,u,D,W,c),q.generateMipMaps&&g.generateMipmap(X),n||this._bindTextureDirectly(X,null),J&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Q&&(q.format=Q),q._dynamicTextureSource=c,q._premulAlpha=J,q.invertY=U||!1,q.isReady=!0};class n extends Q.c{constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const n=!U||U._isScene;super(null,n?U:null===U||void 0===U?void 0:U.mc,n?!J:U,X,s,void 0,void 0,void 0,void 0,g),this.name=q,this.wrapU=Q.c.CLAMP_ADDRESSMODE,this.wrapV=Q.c.CLAMP_ADDRESSMODE,this._generateMipMaps=J;const W=this._getEngine();if(!W)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=W.createDynamicTexture(this._canvas.width,this._canvas.height,J,s);else{this._canvas=W.createCanvas(1,1),this._ownCanvas=!0;const q=c;q.width||0===q.width?this._texture=W.createDynamicTexture(q.width,q.height,J,s):this._texture=W.createDynamicTexture(c,c,J,s)}const D=this.getSize();this._canvas.width!==D.width&&(this._canvas.width=D.width),this._canvas.height!==D.height&&(this._canvas.height=D.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(q){this._canvas.width=q.width,this._canvas.height=q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(q.width,q.height,this._generateMipMaps,this.samplingMode)}scale(q){const c=this.getSize();c.width*=q,c.height*=q,this._recreate(c)}scaleTo(q,c){const U=this.getSize();U.width=q,U.height=c,this._recreate(U)}getContext(){return this._context}clear(q){const c=this.getSize();q&&(this._context.fillStyle=q),this._context.clearRect(0,0,c.width,c.height)}update(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===q||q,c,this._format||void 0,void 0,U)}drawText(q,c,U,J,Q,s,g){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const n=this.getSize();if(s&&(this._context.fillStyle=s,this._context.fillRect(0,0,n.width,n.height)),this._context.font=J,null===c||void 0===c){const U=this._context.measureText(q);c=(n.width-U.width)/2}if(null===U||void 0===U){const q=parseInt(J.replace(/\D/g,""));U=n.height/2+q/3.65}this._context.fillStyle=Q||"",this._context.fillText(q,c,U),X&&this.update(g)}dispose(){var q,c;(super.dispose(),this._ownCanvas)&&(null===(q=this._canvas)||void 0===q||null===(c=q.remove)||void 0===c||c.call(q));this._canvas=null,this._context=null}clone(){const q=this.Cq();if(!q)return this;const c=this.getSize(),U=new n(this.name,c,q,this._generateMipMaps);return U.Hc=this.Hc,U.level=this.level,U.wrapU=this.wrapU,U.wrapV=this.wrapV,U}serialize(){const q=this.Cq();q&&!q.isReady()&&J.c.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return n._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(q){return void 0!==q.toDataURL}_rebuild(){this.update()}}},12539:(q,c,U)=>{"use strict";U.d(c,{e:()=>Q});var J=U(11288);class Q extends J.c{get depth(){return this._depth}constructor(q,c,U,Q,s,g){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:J.c.TRILINEAR_SAMPLINGMODE,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;super(null,g,!X,n),this.format=s,this._texture=g.getEngine().createRawTexture2DArray(q,c,U,Q,s,X,n,W,null,D,u),this._depth=Q,this.is2DArray=!0}update(q){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(q,c,U,J,s){return new Q(q,c,U,J,5,s,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12354:(q,c,U)=>{"use strict";U.d(c,{e:()=>X,f:()=>n,h:()=>s,j:()=>g});var J=U(10870),Q=U(10833);function s(q,c){return`{X: ${q.x.toFixed(c)} Y: ${q.y.toFixed(c)}}`}function g(q,c){return`{X: ${q._x.toFixed(c)} Y: ${q._y.toFixed(c)} Z: ${q._z.toFixed(c)}}`}function X(q,c){return 2*Math.acos((0,J.Clamp)(Q.g.Dot(q,c)))}function n(q,c){const U=new Q.g;return function(q,c,U){const s=Q.p.Cross(q,c),g=Math.acos((0,J.Clamp)(Q.p.Dot(q,c),-1,1));Q.g.RotationAxisToRef(s,g,U)}(q,c,U),U}},12174:(q,c,U)=>{"use strict";U.d(c,{b:()=>W});var J=U(10833),Q=U(11093),s=U(11149),g=U(11125),X=U(11178);U(12183);function n(q){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const U=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[];let n=[];const W=q.width||q.size||1,D=q.height||q.size||1,u=q.depth||q.size||1,K=q.wrap||!1;let r=void 0===q.topBaseAt?1:q.topBaseAt,H=void 0===q.bottomBaseAt?0:q.bottomBaseAt;r=(r+4)%4,H=(H+4)%4;let b=[2,0,3,1][r],h=[2,0,1,3][H],o=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(K){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],o=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],U=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const J=[17,18,19,16],Q=[22,23,20,21];for(;b>0;)q.unshift(q.pop()),J.unshift(J.pop()),b--;for(;h>0;)U.unshift(U.pop()),Q.unshift(Q.pop()),h--;q=q.flat(),U=U.flat(),o=o.concat(q).concat(U),c.push(J[0],J[2],J[3],J[0],J[1],J[2]),c.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2])}const a=[W/2,D/2,u/2];n=o.reduce(((q,c,U)=>q.concat(c*a[U%3])),[]);const p=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,R=q.faceUV||new Array(6),I=q.faceColors,t=[];for(let g=0;g<6;g++)void 0===R[g]&&(R[g]=new J.q(0,0,1,1)),I&&void 0===I[g]&&(I[g]=new Q.e(1,1,1,1));for(let J=0;J<6;J++)if(s.push(R[J].z,X.b?1-R[J].w:R[J].w),s.push(R[J].x,X.b?1-R[J].w:R[J].w),s.push(R[J].x,X.b?1-R[J].y:R[J].y),s.push(R[J].z,X.b?1-R[J].y:R[J].y),I)for(let q=0;q<4;q++)t.push(I[J].r,I[J].g,I[J].b,I[J].a);g.c._ComputeSides(p,n,c,U,s,q.frontUVs,q.backUVs);const C=new g.c;if(C.indices=c,C.Fq=n,C.vq=U,C.kq=s,I){const q=p===g.c.DOUBLESIDE?t.concat(t):t;C.Yq=q}return C}function W(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new s.b(q,U);c.sideOrientation=s.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return n(c).Oq(J,c.updatable),J}g.c.CreateBox=n,s.b.CreateBox=function(q,c){return W(q,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12340:(q,c,U)=>{"use strict";U.d(c,{b:()=>X});var J=U(11149),Q=U(11125),s=U(11178);function g(q){const c=[],U=[],J=[],g=[],X=q.radius||.5,n=q.tessellation||64,W=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,D=0===q.sideOrientation?0:q.sideOrientation||Q.c.DEFAULTSIDE;c.push(0,0,0),g.push(.5,.5);const u=2*Math.PI*W,K=1===W?u/n:u/(n-1);let r=0;for(let Q=0;Q<n;Q++){const q=Math.cos(r),U=Math.sin(r),J=(q+1)/2,Q=(1-U)/2;c.push(X*q,X*U,0),g.push(J,s.b?1-Q:Q),r+=K}1===W&&(c.push(c[3],c[4],c[5]),g.push(g[2],s.b?1-g[3]:g[3]));const H=c.length/3;for(let Q=1;Q<H-1;Q++)U.push(Q+1,0,Q);Q.c.ComputeNormals(c,U,J),Q.c._ComputeSides(D,c,U,J,g,q.frontUVs,q.backUVs);const b=new Q.c;return b.indices=U,b.Fq=c,b.vq=J,b.kq=g,b}function X(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new J.b(q,U);c.sideOrientation=J.b._GetDefaultSideOrientation(c.sideOrientation),Q._originalBuilderSideOrientation=c.sideOrientation;return g(c).Oq(Q,c.updatable),Q}Q.c.CreateDisc=g,J.b.CreateDisc=function(q,c,U){return X(q,{radius:c,tessellation:U,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12183:(q,c,U)=>{"use strict";U.d(c,{d:()=>h,b:()=>a,h:()=>o});var J=U(10833),Q=U(11093),s=U(11149),g=U(11125),X=U(11031);s.b._GroundMeshParser=(q,c)=>n.Parse(q,c);class n extends s.b{constructor(q,c){super(q,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=q,this._subdivisionsY=q,this.subdivide(q);const U=this;U.createOrUpdateSubmeshesOctree&&U.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(q,c){const U=this.getWorldMatrix(),Q=J.j.Matrix[5];U.invertToRef(Q);const s=J.j.hc[8];if(J.p.TransformCoordinatesFromFloatsToRef(q,0,c,Q,s),q=s.x,c=s.z,q<this._minX||q>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(q,c),X=-(g.x*q+g.z*c+g.w)/g.y;return J.p.TransformCoordinatesFromFloatsToRef(0,X,0,U,s),s.y}getNormalAtCoordinates(q,c){const U=new J.p(0,1,0);return this.getNormalAtCoordinatesToRef(q,c,U),U}getNormalAtCoordinatesToRef(q,c,U){const Q=this.getWorldMatrix(),s=J.j.Matrix[5];Q.invertToRef(s);const g=J.j.hc[8];if(J.p.TransformCoordinatesFromFloatsToRef(q,0,c,s,g),q=g.x,c=g.z,q<this._minX||q>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(q,c);return J.p.TransformNormalFromFloatsToRef(X.x,X.y,X.z,Q,U),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(q,c){const U=Math.floor((q+this._maxX)*this._subdivisionsX/this._width),J=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Q=this._heightQuads[J*this._subdivisionsX+U];let s;return s=c<Q.slope.x*q+Q.slope.y?Q.facet1:Q.facet2,s}_initHeightQuads(){const q=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let U=0;U<c;U++)for(let c=0;c<q;c++){const Q={slope:J.l.Zero(),facet1:new J.q(0,0,0,0),facet2:new J.q(0,0,0,0)};this._heightQuads[U*q+c]=Q}return this}_computeHeightQuads(){const q=this.getVerticesData(X.h.PositionKind);if(!q)return this;const c=J.j.hc[3],U=J.j.hc[2],Q=J.j.hc[1],s=J.j.hc[0],g=J.j.hc[4],n=J.j.hc[5],W=J.j.hc[6],D=J.j.hc[7],u=J.j.hc[8];let K=0,r=0,H=0,b=0,h=0,o=0,a=0;const p=this._subdivisionsX,R=this._subdivisionsY;for(let X=0;X<R;X++)for(let R=0;R<p;R++){K=3*R,r=X*(p+1)*3,H=(X+1)*(p+1)*3,c.x=q[r+K],c.y=q[r+K+1],c.z=q[r+K+2],U.x=q[r+K+3],U.y=q[r+K+4],U.z=q[r+K+5],Q.x=q[H+K],Q.y=q[H+K+1],Q.z=q[H+K+2],s.x=q[H+K+3],s.y=q[H+K+4],s.z=q[H+K+5],b=(s.z-c.z)/(s.x-c.x),h=c.z-b*c.x,U.subtractToRef(c,g),Q.subtractToRef(c,n),s.subtractToRef(c,W),J.p.CrossToRef(W,n,D),J.p.CrossToRef(g,W,u),D.normalize(),u.normalize(),o=-(D.x*c.x+D.y*c.y+D.z*c.z),a=-(u.x*U.x+u.y*U.y+u.z*U.z);const I=this._heightQuads[X*p+R];I.slope.bc(b,h),I.facet1.bc(D.x,D.y,D.z,o),I.facet2.bc(u.x,u.y,u.z,a)}return this}serialize(q){super.serialize(q),q.subdivisionsX=this._subdivisionsX,q.subdivisionsY=this._subdivisionsY,q.minX=this._minX,q.maxX=this._maxX,q.Oc=this._minZ,q.maxZ=this._maxZ,q.width=this._width,q.height=this._height}static Parse(q,c){const U=new n(q.name,c);return U._subdivisionsX=q.subdivisionsX||1,U._subdivisionsY=q.subdivisionsY||1,U._minX=q.minX,U._maxX=q.maxX,U._minZ=q.Oc,U._maxZ=q.maxZ,U._width=q.width,U._height=q.height,U}}var W=U(10879),D=U(10864),u=U(10836),K=U(11178);function r(q){const c=[],U=[],Q=[],s=[];let X,n;const W=q.width||q.size||1,D=q.height||q.size||1,u=0|(q.subdivisionsX||q.subdivisions||1),r=0|(q.subdivisionsY||q.subdivisions||1);for(X=0;X<=r;X++)for(n=0;n<=u;n++){const q=new J.p(n*W/u-W/2,0,(r-X)*D/r-D/2),c=new J.p(0,1,0);U.push(q.x,q.y,q.z),Q.push(c.x,c.y,c.z),s.push(n/u,K.b?X/r:1-X/r)}for(X=0;X<r;X++)for(n=0;n<u;n++)c.push(n+1+(X+1)*(u+1)),c.push(n+1+X*(u+1)),c.push(n+X*(u+1)),c.push(n+(X+1)*(u+1)),c.push(n+1+(X+1)*(u+1)),c.push(n+X*(u+1));const H=new g.c;return H.indices=c,H.Fq=U,H.vq=Q,H.kq=s,H}function H(q){const c=void 0!==q.xmin&&null!==q.xmin?q.xmin:-1,U=void 0!==q.zmin&&null!==q.zmin?q.zmin:-1,Q=void 0!==q.xmax&&null!==q.xmax?q.xmax:1,s=void 0!==q.zmax&&null!==q.zmax?q.zmax:1,X=q.subdivisions||{w:1,h:1},n=q.precision||{w:1,h:1},W=[],D=[],u=[],K=[];let r,H,b,h;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,n.w=n.w<1?1:n.w,n.h=n.h<1?1:n.h;const o=(Q-c)/X.w,a=(s-U)/X.h;function p(q,c,U,Q){const s=D.length/3,g=n.w+1;for(r=0;r<n.h;r++)for(H=0;H<n.w;H++){const q=[s+H+r*g,s+(H+1)+r*g,s+(H+1)+(r+1)*g,s+H+(r+1)*g];W.push(q[1]),W.push(q[2]),W.push(q[3]),W.push(q[0]),W.push(q[1]),W.push(q[3])}const X=J.p.Zero(),b=new J.p(0,1,0);for(r=0;r<=n.h;r++)for(X.z=r*(Q-c)/n.h+c,H=0;H<=n.w;H++)X.x=H*(U-q)/n.w+q,X.y=0,D.push(X.x,X.y,X.z),u.push(b.x,b.y,b.z),K.push(H/n.w,r/n.h)}for(b=0;b<X.h;b++)for(h=0;h<X.w;h++)p(c+h*o,U+b*a,c+(h+1)*o,U+(b+1)*a);const R=new g.c;return R.indices=W,R.Fq=D,R.vq=u,R.kq=K,R}function b(q){const c=[],U=[],s=[],X=[];let n,W;const D=q.colorFilter||new Q.c(.3,.59,.11),K=q.alphaFilter||0;let r=!1;if(q.minHeight>q.maxHeight){r=!0;const c=q.maxHeight;q.maxHeight=q.minHeight,q.minHeight=c}for(n=0;n<=q.subdivisions;n++)for(W=0;W<=q.subdivisions;W++){const c=new J.p(W*q.width/q.subdivisions-q.width/2,0,(q.subdivisions-n)*q.height/q.subdivisions-q.height/2),Q=4*(((c.x+q.width/2)/q.width*(q.bufferWidth-1)|0)+((1-(c.z+q.height/2)/q.height)*(q.bufferHeight-1)|0)*q.bufferWidth);let g=q.buffer[Q]/255,H=q.buffer[Q+1]/255,b=q.buffer[Q+2]/255;const h=q.buffer[Q+3]/255;r&&(g=1-g,H=1-H,b=1-b);const o=g*D.r+H*D.g+b*D.b;c.y=h>=K?q.minHeight+(q.maxHeight-q.minHeight)*o:q.minHeight-u.d,q.heightBuffer&&(q.heightBuffer[n*(q.subdivisions+1)+W]=c.y),U.push(c.x,c.y,c.z),s.push(0,0,0),X.push(W/q.subdivisions,1-n/q.subdivisions)}for(n=0;n<q.subdivisions;n++)for(W=0;W<q.subdivisions;W++){const J=W+1+(n+1)*(q.subdivisions+1),Q=W+1+n*(q.subdivisions+1),s=W+n*(q.subdivisions+1),g=W+(n+1)*(q.subdivisions+1),X=U[3*J+1]>=q.minHeight,D=U[3*Q+1]>=q.minHeight,u=U[3*s+1]>=q.minHeight;X&&D&&u&&(c.push(J),c.push(Q),c.push(s));U[3*g+1]>=q.minHeight&&X&&u&&(c.push(g),c.push(J),c.push(s))}g.c.ComputeNormals(U,c,s);const H=new g.c;return H.indices=c,H.Fq=U,H.vq=s,H.kq=X,H}function h(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const U=new n(q,arguments.length>2?arguments[2]:void 0);U._setReady(!1),U._subdivisionsX=c.subdivisionsX||c.subdivisions||1,U._subdivisionsY=c.subdivisionsY||c.subdivisions||1,U._width=c.width||1,U._height=c.height||1,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ;return r(c).Oq(U,c.updatable),U._setReady(!0),U}function o(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new s.b(q,U);return H(c).Oq(J,c.updatable),J}function a(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=U.width||10,g=U.height||10,X=U.subdivisions||1,u=U.minHeight||0,K=U.maxHeight||1,r=U.colorFilter||new Q.c(.3,.59,.11),H=U.alphaFilter||0,h=U.updatable,o=U.onReady;J=J||D.c.LastCreatedScene;const a=new n(q,J);let p;a._subdivisionsX=X,a._subdivisionsY=X,a._width=s,a._height=g,a._maxX=a._width/2,a._maxZ=a._height/2,a._minX=-a._maxX,a._minZ=-a._maxZ,a._setReady(!1),U.passHeightBufferInCallback&&(p=new Float32Array((X+1)*(X+1)));const R=(q,c,U)=>{b({width:s,height:g,subdivisions:X,minHeight:u,maxHeight:K,colorFilter:r,buffer:q,bufferWidth:c,bufferHeight:U,alphaFilter:H,heightBuffer:p}).Oq(a,h),o&&o(a,p),a._setReady(!0)};if("string"===typeof c){const q=q=>{var c;const U=q.width,Q=q.height;if(J.u)return;const s=null===(c=J)||void 0===c?void 0:c.getEngine().resizeImageBitmap(q,U,Q);R(s,U,Q)};W.e.LoadImage(c,q,U.onError?U.onError:()=>{},J.offlineProvider)}else R(c.data,c.width,c.height);return a}g.c.CreateGround=r,g.c.CreateTiledGround=H,g.c.CreateGroundFromHeightMap=b,s.b.CreateGround=(q,c,U,J,Q,s)=>h(q,{width:c,height:U,subdivisions:J,updatable:s},Q),s.b.CreateTiledGround=(q,c,U,J,Q,s,g,X,n)=>o(q,{xmin:c,zmin:U,xmax:J,zmax:Q,subdivisions:s,precision:g,updatable:n},X),s.b.CreateGroundFromHeightMap=(q,c,U,J,Q,s,g,X,n,W,D)=>a(q,c,{width:U,height:J,subdivisions:Q,minHeight:s,maxHeight:g,updatable:n,onReady:W,alphaFilter:D},X)},12830:(q,c,U)=>{"use strict";U.d(c,{c:()=>r,e:()=>u,i:()=>K});var J=U(10833),Q=U(11149),s=U(11125),g=U(11486),X=U(11031),n=U(10886);function W(q){const c=[],U=[],J=q.lines,Q=q.Yq,g=[];let X=0;for(let s=0;s<J.length;s++){const q=J[s];for(let J=0;J<q.length;J++){const{x:n,y:W,z:D}=q[J];if(U.push(n,W,D),Q){const q=Q[s],{r:c,g:U,b:X,a:n}=q[J];g.push(c,U,X,n)}J>0&&(c.push(X-1),c.push(X)),X++}}const n=new s.c;return n.indices=c,n.Fq=U,Q&&(n.Yq=g),n}function D(q){const c=q.dashSize||3,U=q.gapSize||1,Q=q.dashNb||200,g=q.points,X=[],n=[],W=J.p.Zero();let D=0,u=0,K=0,r=0,H=0,b=0,h=0;for(h=0;h<g.length-1;h++)g[h+1].subtractToRef(g[h],W),D+=W.length();for(K=D/Q,r=c*K/(c+U),h=0;h<g.length-1;h++){g[h+1].subtractToRef(g[h],W),u=Math.floor(W.length()/K),W.normalize();for(let q=0;q<u;q++)H=K*q,X.push(g[h].x+H*W.x,g[h].y+H*W.y,g[h].z+H*W.z),X.push(g[h].x+(H+r)*W.x,g[h].y+(H+r)*W.y,g[h].z+(H+r)*W.z),n.push(b,b+1),b+=2}const o=new s.c;return o.Fq=X,o.indices=n,o}function u(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=c.instance,Q=c.lines,s=c.Yq;if(J){const q=J.getVerticesData(X.h.PositionKind);let c,U;s&&(c=J.getVerticesData(X.h.ColorKind));let g=0,n=0;for(let J=0;J<Q.length;J++){const X=Q[J];for(let Q=0;Q<X.length;Q++)q[g]=X[Q].x,q[g+1]=X[Q].y,q[g+2]=X[Q].z,s&&c&&(U=s[J],c[n]=U[Q].r,c[n+1]=U[Q].g,c[n+2]=U[Q].b,c[n+3]=U[Q].a,n+=4),g+=3}return J.updateVerticesData(X.h.PositionKind,q,!1,!1),s&&c&&J.updateVerticesData(X.h.ColorKind,c,!1,!1),J.refreshBoundingInfo(),J}const n=!!s,D=new g.d(q,U,null,void 0,void 0,n,c.useVertexAlpha,c.material);return W(c).Oq(D,c.updatable),D}function K(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=c.Yq?[c.Yq]:null;return u(q,{lines:[c.points],updatable:c.updatable,instance:c.instance,Yq:J,useVertexAlpha:c.useVertexAlpha,material:c.material},U)}function r(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.points,X=c.instance,W=c.gapSize||1,u=c.dashSize||3;if(X){const q=q=>{const c=J.p.Zero(),U=q.length/6;let Q=0,g=0,n=0,W=0,D=0,u=0,K=0,r=0;for(K=0;K<s.length-1;K++)s[K+1].subtractToRef(s[K],c),Q+=c.length();n=Q/U;const H=X._creationDataStorage.dashSize;for(W=H*n/(H+X._creationDataStorage.gapSize),K=0;K<s.length-1;K++)for(s[K+1].subtractToRef(s[K],c),g=Math.floor(c.length()/n),c.normalize(),r=0;r<g&&u<q.length;)D=n*r,q[u]=s[K].x+D*c.x,q[u+1]=s[K].y+D*c.y,q[u+2]=s[K].z+D*c.z,q[u+3]=s[K].x+(D+W)*c.x,q[u+4]=s[K].y+(D+W)*c.y,q[u+5]=s[K].z+(D+W)*c.z,u+=6,r++;for(;u<q.length;)q[u]=s[K].x,q[u+1]=s[K].y,q[u+2]=s[K].z,u+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&n.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(q,!1),X}const K=new g.d(q,U,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return D(c).Oq(K,c.updatable),K._creationDataStorage=new Q.e,K._creationDataStorage.dashSize=u,K._creationDataStorage.gapSize=W,K}s.c.CreateLineSystem=W,s.c.CreateDashedLines=D,Q.b.tW=function(q,c){return K(q,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Q.b.CreateDashedLines=function(q,c,U,J,Q){return r(q,{points:c,dashSize:U,gapSize:J,dashNb:Q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12237:(q,c,U)=>{"use strict";U.d(c,{c:()=>X,f:()=>n});var J=U(11149),Q=U(11125),s=U(11178);function g(q){const c=[],U=[],J=[],g=[],X=void 0!==q.width?q.width:void 0!==q.size?q.size:1,n=void 0!==q.height?q.height:void 0!==q.size?q.size:1,W=0===q.sideOrientation?0:q.sideOrientation||Q.c.DEFAULTSIDE,D=X/2,u=n/2;U.push(-D,-u,0),J.push(0,0,-1),g.push(0,s.b?1:0),U.push(D,-u,0),J.push(0,0,-1),g.push(1,s.b?1:0),U.push(D,u,0),J.push(0,0,-1),g.push(1,s.b?0:1),U.push(-D,u,0),J.push(0,0,-1),g.push(0,s.b?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),Q.c._ComputeSides(W,U,c,J,g,q.frontUVs,q.backUVs);const K=new Q.c;return K.indices=c,K.Fq=U,K.vq=J,K.kq=g,K}function X(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new J.b(q,U);c.sideOrientation=J.b._GetDefaultSideOrientation(c.sideOrientation),Q._originalBuilderSideOrientation=c.sideOrientation;return g(c).Oq(Q,c.updatable),c.sourcePlane&&(Q.translate(c.sourcePlane.Jc,-c.sourcePlane.d),Q.setDirection(c.sourcePlane.Jc.scale(-1))),Q}const n={FW:X};Q.c.FW=g,J.b.FW=(q,c,U,J,Q)=>X(q,{size:c,width:c,height:c,sideOrientation:Q,updatable:J},U)},12326:(q,c,U)=>{"use strict";U.d(c,{d:()=>n});var J=U(10833),Q=U(11149),s=U(11125),g=U(11178);function X(q){const c=0|(q.segments||32),U=q.diameterX||q.diameter||1,Q=q.diameterY||q.diameter||1,X=q.diameterZ||q.diameter||1,n=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,W=q.slice&&q.slice<=0?1:q.slice||1,D=0===q.sideOrientation?0:q.sideOrientation||s.c.DEFAULTSIDE,u=!!q.dedupTopBottomIndices,K=new J.p(U/2,Q/2,X/2),r=2+c,H=2*r,b=[],h=[],o=[],a=[];for(let s=0;s<=r;s++){const q=s/r,c=q*Math.PI*W;for(let U=0;U<=H;U++){const Q=U/H,s=Q*Math.PI*2*n,X=J.d.RotationZ(-c),W=J.d.RotationY(s),D=J.p.TransformCoordinates(J.p.Up(),X),u=J.p.TransformCoordinates(D,W),r=u.multiply(K),b=u.divide(K).normalize();h.push(r.x,r.y,r.z),o.push(b.x,b.y,b.z),a.push(Q,g.b?1-q:q)}if(s>0){const q=h.length/3;for(let c=q-2*(H+1);c+H+2<q;c++)u?(s>1&&(b.push(c),b.push(c+1),b.push(c+H+1)),(s<r||W<1)&&(b.push(c+H+1),b.push(c+1),b.push(c+H+2))):(b.push(c),b.push(c+1),b.push(c+H+1),b.push(c+H+1),b.push(c+1),b.push(c+H+2))}}s.c._ComputeSides(D,h,b,o,a,q.frontUVs,q.backUVs);const p=new s.c;return p.indices=b,p.Fq=h,p.vq=o,p.kq=a,p}function n(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return X(c).Oq(J,c.updatable),J}s.c.CreateSphere=X,Q.b.CreateSphere=(q,c,U,J,Q,s)=>n(q,{segments:c,diameterX:U,diameterY:U,diameterZ:U,sideOrientation:s,updatable:Q},J)},13120:(q,c,U)=>{"use strict";U.d(c,{c:()=>X});var J=U(11517),Q=U(12623),s=U(11539),g=U(11125);class X{static get Configuration(){return{get decoder(){return Q.b.DefaultConfiguration},set decoder(q){Q.b.DefaultConfiguration=q}}}static set Configuration(q){Q.b.DefaultConfiguration=q.decoder}static get DecoderAvailable(){return(0,J.k)(Q.b.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(q){X._Default&&(q||X._Default.dispose(),X._Default=null)}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const c="number"===typeof q?{...Q.b.DefaultConfiguration,numWorkers:q}:{...Q.b.DefaultConfiguration,...q};this._decoder=new Q.b(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(q,c,U){return this._decoder.decodeMeshToMeshDataAsync(q,c,U)}async decodeMeshToGeometryAsync(q,c,U,J){return await this._decoder.decodeMeshToGeometryAsync(q,c,U,J)}async _decodeMeshToGeometryForGltfAsync(q,c,U,J,Q,s){return await this._decoder._decodeMeshToGeometryForGltfAsync(q,c,U,J,Q,s)}async decodeMeshAsync(q,c){const U=await this._decoder.decodeMeshToMeshDataAsync(q,c),J=new g.c;U.indices&&(J.indices=U.indices);for(const Q of U.attributes){const q=s.c.GetFloatData(Q.data,Q.size,s.c.GetDataType(Q.data),Q.byteOffset,Q.byteStride,Q.normalized,U.totalVertices);J.set(q,Q.kind)}return J}}X.DefaultNumWorkers=(0,J.g)(),X._Default=null},12623:(q,c,U)=>{"use strict";U.d(c,{b:()=>W});var J=U(11517),Q=U(10879),s=U(11170),g=U(11539),X=U(10886),n=U(11532);class W extends J.c{static get DefaultAvailable(){return(0,J.k)(W.DefaultConfiguration)}static get Default(){return W._Default??(W._Default=new W),W._Default}static ResetDefault(q){W._Default&&(q||W._Default.dispose(),W._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(q,c){return{module:await(c||DracoDecoderModule)({wasmBinary:q})}}_getWorkerContent(){return`${n.e}(${n.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultConfiguration)}decodeMeshToMeshDataAsync(q,c,U){const J=q instanceof ArrayBuffer?new Int8Array(q):new Int8Array(q.buffer,q.byteOffset,q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async q=>await new Promise(((Q,s)=>{q.push(((q,g)=>{let n=null;const W=[],D=c=>{q.removeEventListener("error",D),q.removeEventListener("message",u),s(c),g()},u=c=>{const J=c.data;switch(J.id){case"indices":n=J.data;break;case"attribute":W.push({kind:J.kind,data:J.data,size:J.size,byteOffset:J.byteOffset,byteStride:J.byteStride,normalized:(s=J.kind,K=J.normalized,U&&void 0!==U[s]?(K!==U[s]&&X.c.Warn(`Normalized flag from Draco data (${K}) does not match normalized flag from glTF accessor (${U[s]}). Using flag from glTF accessor.`),U[s]):K)});break;case"decodeMeshDone":q.removeEventListener("error",D),q.removeEventListener("message",u),Q({indices:n,attributes:W,totalVertices:J.totalVertices}),g()}var s,K};q.addEventListener("error",D),q.addEventListener("message",u);const K=J.slice();q.postMessage({id:"decodeMesh",dataView:K,attributes:c},[K.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((q=>{let U=null;const Q=[],s=(0,n.e)(q.module,J,c,(q=>{U=q}),((q,c,U,J,s,g)=>{Q.push({kind:q,data:c,size:U,byteOffset:J,byteStride:s,normalized:g})}));return{indices:U,attributes:Q,totalVertices:s}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(q,c,U,J){const Q=await this.decodeMeshToMeshDataAsync(U,J),X=new s.d(q,c);Q.indices&&X.setIndices(Q.indices);for(const s of Q.attributes)X.setVerticesBuffer(new g.c(c.getEngine(),s.data,s.kind,!1,void 0,s.byteStride,void 0,s.byteOffset,s.size,void 0,s.normalized,!0),Q.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(q,c,U,J,Q,X){const n=await this.decodeMeshToMeshDataAsync(U,J,Q),W=new s.d(q,c);X&&(W._boundingInfo=X,W.useBoundingInfoFromGeometry=!0),n.indices&&W.setIndices(n.indices);for(const s of n.attributes)W.setVerticesBuffer(new g.c(c.getEngine(),s.data,s.kind,!1,void 0,s.byteStride,void 0,s.byteOffset,s.size,void 0,s.normalized,!0),n.totalVertices);return W}}W.DefaultConfiguration={wasmUrl:`${Q.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Q.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Q.e._DefaultCdnUrl}/draco_decoder_gltf.js`},W._Default=null},12825:(q,c,U)=>{"use strict";U.d(c,{c:()=>Xq});var J=U(10833),Q=U(11149),s=U(11031),g=U(11125),X=U(11178);function n(q){let c=q.pathArray;const U=q.closeArray||!1,J=q.closePath||!1,Q=q.invertUV||!1,n=Math.floor(c[0].length/2);let W=q.offset||n;W=W>n?n:Math.floor(W);const D=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,u=q.kq,K=q.Yq,r=[],H=[],b=[],h=[],o=[],a=[],p=[],R=[];let I;const t=[],C=[];let i,F,v;if(c.length<2){const q=[],U=[];for(F=0;F<c[0].length-W;F++)q.push(c[0][F]),U.push(c[0][F+W]);c=[q,U]}let Y=0;const k=J?1:0,V=U?1:0;let O,G,S,Z,x,z;for(I=c[0].length,i=0;i<c.length+V;i++){for(p[i]=0,o[i]=[0],O=i===c.length?c[0]:c[i],G=O.length,I=I<G?I:G,v=0;v<G;)r.push(O[v].x,O[v].y,O[v].z),v>0&&(S=O[v].eU(O[v-1]).length(),Z=S+p[i],o[i].push(Z),p[i]=Z),v++;J&&(v--,r.push(O[0].x,O[0].y,O[0].z),S=O[v].eU(O[0]).length(),Z=S+p[i],o[i].push(Z),p[i]=Z),t[i]=G+k,C[i]=Y,Y+=G+k}let y,M,T=null,m=null;for(F=0;F<I+k;F++)for(R[F]=0,a[F]=[0],i=0;i<c.length-1+V;i++)x=c[i],z=i===c.length-1?c[0]:c[i+1],F===I?(T=x[0],m=z[0]):(T=x[F],m=z[F]),S=m.eU(T).length(),Z=S+R[F],a[F].push(Z),R[F]=Z;if(u)for(i=0;i<u.length;i++)h.push(u[i].x,X.b?1-u[i].y:u[i].y);else for(i=0;i<c.length+V;i++)for(F=0;F<I+k;F++)y=0!=p[i]?o[i][F]/p[i]:0,M=0!=R[F]?a[F][i]/R[F]:0,Q?h.push(M,y):h.push(y,X.b?1-M:M);i=0;let d=0,e=t[i]-1,B=t[i+1]-1,N=e<B?e:B,P=C[1]-C[0];const w=t.length-1;for(;d<=N&&i<w;)H.push(d,d+P,d+1),H.push(d+P+1,d+1,d+P),d+=1,d===N&&(i++,P=C[i+1]-C[i],e=t[i]-1,B=t[i+1]-1,d=C[i],N=e<B?e+d:B+d);if(g.c.ComputeNormals(r,H,b),J){let q=0,U=0;for(i=0;i<c.length;i++){q=3*C[i],U=i+1<c.length?3*(C[i+1]-1):b.length-3,b[q]=.5*(b[q]+b[U]),b[q+1]=.5*(b[q+1]+b[U+1]),b[q+2]=.5*(b[q+2]+b[U+2]);const J=Math.sqrt(b[q]*b[q]+b[q+1]*b[q+1]+b[q+2]*b[q+2]);b[q]/=J,b[q+1]/=J,b[q+2]/=J,b[U]=b[q],b[U+1]=b[q+1],b[U+2]=b[q+2]}}if(U){let q=3*C[0],U=3*C[c.length];for(F=0;F<I+k;F++){b[q]=.5*(b[q]+b[U]),b[q+1]=.5*(b[q+1]+b[U+1]),b[q+2]=.5*(b[q+2]+b[U+2]);const c=Math.sqrt(b[q]*b[q]+b[q+1]*b[q+1]+b[q+2]*b[q+2]);b[q]/=c,b[q+1]/=c,b[q+2]/=c,b[U]=b[q],b[U+1]=b[q+1],b[U+2]=b[q+2],q+=3,U+=3}}g.c._ComputeSides(D,r,H,b,h,q.frontUVs,q.backUVs);let L=null;if(K){L=new Float32Array(4*K.length);for(let q=0;q<K.length;q++)L[4*q]=K[q].r,L[4*q+1]=K[q].g,L[4*q+2]=K[q].b,L[4*q+3]=K[q].a}const l=new g.c,j=new Float32Array(r),f=new Float32Array(b),A=new Float32Array(h);return l.indices=H,l.Fq=j,l.vq=f,l.kq=A,L&&l.set(L,s.h.ColorKind),J&&(l._idx=C),l}function W(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=c.pathArray,D=c.closeArray,u=c.closePath,K=Q.b._GetDefaultSideOrientation(c.sideOrientation),r=c.instance,H=c.updatable;if(r){const q=J.j.hc[0].tc(Number.MAX_VALUE),U=J.j.hc[1].tc(-Number.MAX_VALUE),n=c=>{let J=W[0].length;const s=r;let g=0;const X=s._originalBuilderSideOrientation===Q.b.DOUBLESIDE?2:1;for(let Q=1;Q<=X;++Q)for(let X=0;X<W.length;++X){const Q=W[X],n=Q.length;J=J<n?J:n;for(let s=0;s<J;++s){const J=Q[s];c[g]=J.x,c[g+1]=J.y,c[g+2]=J.z,q.minimizeInPlaceFromFloats(J.x,J.y,J.z),U.maximizeInPlaceFromFloats(J.x,J.y,J.z),g+=3}if(s._creationDataStorage&&s._creationDataStorage.closePath){const q=Q[0];c[g]=q.x,c[g+1]=q.y,c[g+2]=q.z,g+=3}}},D=r.getVerticesData(s.h.PositionKind);if(n(D),r.hasBoundingInfo?r.getBoundingInfo().reConstruct(q,U,r._worldMatrix):r.buildBoundingInfo(q,U,r._worldMatrix),r.updateVerticesData(s.h.PositionKind,D,!1,!1),c.Yq){const q=r.getVerticesData(s.h.ColorKind);for(let U=0,J=0;U<c.Yq.length;U++,J+=4){const Q=c.Yq[U];q[J]=Q.r,q[J+1]=Q.g,q[J+2]=Q.b,q[J+3]=Q.a}r.updateVerticesData(s.h.ColorKind,q,!1,!1)}if(c.kq){const q=r.getVerticesData(s.h.UVKind);for(let U=0;U<c.kq.length;U++)q[2*U]=c.kq[U].x,q[2*U+1]=X.b?1-c.kq[U].y:c.kq[U].y;r.updateVerticesData(s.h.UVKind,q,!1,!1)}if(!r.areNormalsFrozen||r.isFacetDataEnabled){const q=r.uc(),c=r.getVerticesData(s.h.NormalKind),U=r.isFacetDataEnabled?r.getFacetDataParameters():null;if(g.c.ComputeNormals(D,q,c,U),r._creationDataStorage&&r._creationDataStorage.closePath){let q=0,U=0;for(let J=0;J<W.length;J++)q=3*r._creationDataStorage.idx[J],U=J+1<W.length?3*(r._creationDataStorage.idx[J+1]-1):c.length-3,c[q]=.5*(c[q]+c[U]),c[q+1]=.5*(c[q+1]+c[U+1]),c[q+2]=.5*(c[q+2]+c[U+2]),c[U]=c[q],c[U+1]=c[q+1],c[U+2]=c[q+2]}r.areNormalsFrozen||r.updateVerticesData(s.h.NormalKind,c,!1,!1)}return r}{const J=new Q.b(q,U);J._originalBuilderSideOrientation=K,J._creationDataStorage=new Q.e;const s=n(c);return u&&(J._creationDataStorage.idx=s._idx),J._creationDataStorage.closePath=u,J._creationDataStorage.closeArray=D,s.Oq(J,H),J}}g.c.CreateRibbon=n,Q.b.CreateRibbon=function(q,c){return W(q,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var D=U(12340),u=U(12174),K=U(11093);function r(q){const c=q.pattern||Q.b.NO_FLIP,U=q.tileWidth||q.tileSize||1,J=q.tileHeight||q.tileSize||1,s=q.alignHorizontal||0,X=q.alignVertical||0,n=q.width||q.size||1,W=Math.floor(n/U);let D=n-W*U;const u=q.height||q.size||1,K=Math.floor(u/J);let r=u-K*J;const H=U*W/2,b=J*K/2;let h=0,o=0,a=0,p=0,R=0,I=0;if(D>0||r>0){switch(a=-H,p=-b,R=H,I=b,s){case Q.b.CENTER:D/=2,a-=D,R+=D;break;case Q.b.LEFT:R+=D,h=-D/2;break;case Q.b.RIGHT:a-=D,h=D/2}switch(X){case Q.b.CENTER:r/=2,p-=r,I+=r;break;case Q.b.BOTTOM:I+=r,o=-r/2;break;case Q.b.TOP:p-=r,o=r/2}}const t=[],C=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],c!==Q.b.ROTATE_TILE&&c!==Q.b.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),c!==Q.b.FLIP_TILE&&c!==Q.b.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),c!==Q.b.FLIP_N_ROTATE_TILE&&c!==Q.b.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let F=[];const v=[],Y=[];let k=0;for(let g=0;g<K;g++)for(let q=0;q<W;q++)t.push(q*U-H+h,g*J-b+o,0),t.push((q+1)*U-H+h,g*J-b+o,0),t.push((q+1)*U-H+h,(g+1)*J-b+o,0),t.push(q*U-H+h,(g+1)*J-b+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),F=c===Q.b.FLIP_TILE||c===Q.b.ROTATE_TILE||c===Q.b.FLIP_N_ROTATE_TILE?F.concat(i[(q%2+g%2)%2]):c===Q.b.FLIP_ROW||c===Q.b.ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_ROW?F.concat(i[g%2]):F.concat(i[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),k+=4;if(D>0||r>0){const q=r>0&&(X===Q.b.CENTER||X===Q.b.TOP),g=r>0&&(X===Q.b.CENTER||X===Q.b.BOTTOM),n=D>0&&(s===Q.b.CENTER||s===Q.b.RIGHT),u=D>0&&(s===Q.b.CENTER||s===Q.b.LEFT);let i,V,O,G,S=[];if(q&&n&&(t.push(a+h,p+o,0),t.push(-H+h,p+o,0),t.push(-H+h,p+r+o,0),t.push(a+h,p+r+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,i=1-D/U,V=1-r/J,O=1,G=1,S=[i,V,O,V,O,G,i,G],c===Q.b.ROTATE_ROW&&(S=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),c===Q.b.FLIP_ROW&&(S=[1-i,V,1-O,V,1-O,G,1-i,G]),c===Q.b.FLIP_N_ROTATE_ROW&&(S=[i,1-V,O,1-V,O,1-G,i,1-G]),F=F.concat(S),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&u&&(t.push(H+h,p+o,0),t.push(R+h,p+o,0),t.push(R+h,p+r+o,0),t.push(H+h,p+r+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,i=0,V=1-r/J,O=D/U,G=1,S=[i,V,O,V,O,G,i,G],(c===Q.b.ROTATE_ROW||c===Q.b.ROTATE_TILE&&W%2===0)&&(S=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),(c===Q.b.FLIP_ROW||c===Q.b.FLIP_TILE&&W%2===0)&&(S=[1-i,V,1-O,V,1-O,G,1-i,G]),(c===Q.b.FLIP_N_ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_TILE&&W%2===0)&&(S=[i,1-V,O,1-V,O,1-G,i,1-G]),F=F.concat(S),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&n&&(t.push(a+h,b+o,0),t.push(-H+h,b+o,0),t.push(-H+h,I+o,0),t.push(a+h,I+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,i=1-D/U,V=0,O=1,G=r/J,S=[i,V,O,V,O,G,i,G],(c===Q.b.ROTATE_ROW&&K%2===1||c===Q.b.ROTATE_TILE&&K%1===0)&&(S=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),(c===Q.b.FLIP_ROW&&K%2===1||c===Q.b.FLIP_TILE&&K%2===0)&&(S=[1-i,V,1-O,V,1-O,G,1-i,G]),(c===Q.b.FLIP_N_ROTATE_ROW&&K%2===1||c===Q.b.FLIP_N_ROTATE_TILE&&K%2===0)&&(S=[i,1-V,O,1-V,O,1-G,i,1-G]),F=F.concat(S),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&u&&(t.push(H+h,b+o,0),t.push(R+h,b+o,0),t.push(R+h,I+o,0),t.push(H+h,I+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,i=0,V=0,O=D/U,G=r/J,S=[i,V,O,V,O,G,i,G],(c===Q.b.ROTATE_ROW&&K%2===1||c===Q.b.ROTATE_TILE&&(K+W)%2===1)&&(S=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),(c===Q.b.FLIP_ROW&&K%2===1||c===Q.b.FLIP_TILE&&(K+W)%2===1)&&(S=[1-i,V,1-O,V,1-O,G,1-i,G]),(c===Q.b.FLIP_N_ROTATE_ROW&&K%2===1||c===Q.b.FLIP_N_ROTATE_TILE&&(K+W)%2===1)&&(S=[i,1-V,O,1-V,O,1-G,i,1-G]),F=F.concat(S),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q){const q=[];i=0,V=1-r/J,O=1,G=1,q[0]=[i,V,O,V,O,G,i,G],q[1]=[i,V,O,V,O,G,i,G],c!==Q.b.ROTATE_TILE&&c!==Q.b.ROTATE_ROW||(q[1]=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),c!==Q.b.FLIP_TILE&&c!==Q.b.FLIP_ROW||(q[1]=[1-i,V,1-O,V,1-O,G,1-i,G]),c!==Q.b.FLIP_N_ROTATE_TILE&&c!==Q.b.FLIP_N_ROTATE_ROW||(q[1]=[i,1-V,O,1-V,O,1-G,i,1-G]);for(let J=0;J<W;J++)t.push(J*U-H+h,p+o,0),t.push((J+1)*U-H+h,p+o,0),t.push((J+1)*U-H+h,p+r+o,0),t.push(J*U-H+h,p+r+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,F=c===Q.b.FLIP_TILE||c===Q.b.ROTATE_TILE||c===Q.b.FLIP_N_ROTATE_TILE?F.concat(q[(J+1)%2]):c===Q.b.FLIP_ROW||c===Q.b.ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_ROW?F.concat(q[1]):F.concat(q[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const q=[];i=0,V=0,O=1,G=r/J,q[0]=[i,V,O,V,O,G,i,G],q[1]=[i,V,O,V,O,G,i,G],c!==Q.b.ROTATE_TILE&&c!==Q.b.ROTATE_ROW||(q[1]=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),c!==Q.b.FLIP_TILE&&c!==Q.b.FLIP_ROW||(q[1]=[1-i,V,1-O,V,1-O,G,1-i,G]),c!==Q.b.FLIP_N_ROTATE_TILE&&c!==Q.b.FLIP_N_ROTATE_ROW||(q[1]=[i,1-V,O,1-V,O,1-G,i,1-G]);for(let J=0;J<W;J++)t.push(J*U-H+h,I-r+o,0),t.push((J+1)*U-H+h,I-r+o,0),t.push((J+1)*U-H+h,I+o,0),t.push(J*U-H+h,I+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,F=c===Q.b.FLIP_TILE||c===Q.b.ROTATE_TILE||c===Q.b.FLIP_N_ROTATE_TILE?F.concat(q[(J+K)%2]):c===Q.b.FLIP_ROW||c===Q.b.ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_ROW?F.concat(q[K%2]):F.concat(q[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const q=[];i=1-D/U,V=0,O=1,G=1,q[0]=[i,V,O,V,O,G,i,G],q[1]=[i,V,O,V,O,G,i,G],c!==Q.b.ROTATE_TILE&&c!==Q.b.ROTATE_ROW||(q[1]=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),c!==Q.b.FLIP_TILE&&c!==Q.b.FLIP_ROW||(q[1]=[1-i,V,1-O,V,1-O,G,1-i,G]),c!==Q.b.FLIP_N_ROTATE_TILE&&c!==Q.b.FLIP_N_ROTATE_ROW||(q[1]=[i,1-V,O,1-V,O,1-G,i,1-G]);for(let U=0;U<K;U++)t.push(a+h,U*J-b+o,0),t.push(a+D+h,U*J-b+o,0),t.push(a+D+h,(U+1)*J-b+o,0),t.push(a+h,(U+1)*J-b+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,F=c===Q.b.FLIP_TILE||c===Q.b.ROTATE_TILE||c===Q.b.FLIP_N_ROTATE_TILE?F.concat(q[(U+1)%2]):c===Q.b.FLIP_ROW||c===Q.b.ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_ROW?F.concat(q[U%2]):F.concat(q[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const q=[];i=0,V=0,O=D/J,G=1,q[0]=[i,V,O,V,O,G,i,G],q[1]=[i,V,O,V,O,G,i,G],c!==Q.b.ROTATE_TILE&&c!==Q.b.ROTATE_ROW||(q[1]=[1-i,1-V,1-O,1-V,1-O,1-G,1-i,1-G]),c!==Q.b.FLIP_TILE&&c!==Q.b.FLIP_ROW||(q[1]=[1-i,V,1-O,V,1-O,G,1-i,G]),c!==Q.b.FLIP_N_ROTATE_TILE&&c!==Q.b.FLIP_N_ROTATE_ROW||(q[1]=[i,1-V,O,1-V,O,1-G,i,1-G]);for(let U=0;U<K;U++)t.push(R-D+h,U*J-b+o,0),t.push(R+h,U*J-b+o,0),t.push(R+h,(U+1)*J-b+o,0),t.push(R-D+h,(U+1)*J-b+o,0),Y.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,F=c===Q.b.FLIP_TILE||c===Q.b.ROTATE_TILE||c===Q.b.FLIP_N_ROTATE_TILE?F.concat(q[(U+W)%2]):c===Q.b.FLIP_ROW||c===Q.b.ROTATE_ROW||c===Q.b.FLIP_N_ROTATE_ROW?F.concat(q[U%2]):F.concat(q[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const V=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE;g.c._ComputeSides(V,t,Y,C,F,q.frontUVs,q.backUVs);const O=new g.c;O.indices=Y,O.Fq=t,O.vq=C,O.kq=F;const G=V===g.c.DOUBLESIDE?v.concat(v):v;return O.Yq=G,O}function H(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return r(c).Oq(J,c.updatable),J}function b(q){const c=q.faceUV||new Array(6),U=q.faceColors,s=q.pattern||Q.b.NO_FLIP,n=q.width||q.size||1,W=q.height||q.size||1,D=q.depth||q.size||1,u=q.tileWidth||q.tileSize||1,H=q.tileHeight||q.tileSize||1,b=q.alignHorizontal||0,h=q.alignVertical||0,o=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE;for(let Q=0;Q<6;Q++)void 0===c[Q]&&(c[Q]=new J.q(0,0,1,1)),U&&void 0===U[Q]&&(U[Q]=new K.e(1,1,1,1));const a=n/2,p=W/2,R=D/2,I=[];for(let J=0;J<2;J++)I[J]=r({pattern:s,tileWidth:u,tileHeight:H,width:n,height:W,alignVertical:h,alignHorizontal:b,sideOrientation:o});for(let J=2;J<4;J++)I[J]=r({pattern:s,tileWidth:u,tileHeight:H,width:D,height:W,alignVertical:h,alignHorizontal:b,sideOrientation:o});let t=h;h===Q.b.BOTTOM?t=Q.b.TOP:h===Q.b.TOP&&(t=Q.b.BOTTOM);for(let J=4;J<6;J++)I[J]=r({pattern:s,tileWidth:u,tileHeight:H,width:n,height:D,alignVertical:t,alignHorizontal:b,sideOrientation:o});let C=[],i=[],F=[],v=[];const Y=[],k=[],V=[],O=[];let G=0,S=0;for(let Q=0;Q<6;Q++){const q=I[Q].Fq.length;k[Q]=[],V[Q]=[];for(let c=0;c<q/3;c++)k[Q].push(new J.p(I[Q].Fq[3*c],I[Q].Fq[3*c+1],I[Q].Fq[3*c+2])),V[Q].push(new J.p(I[Q].vq[3*c],I[Q].vq[3*c+1],I[Q].vq[3*c+2]));G=I[Q].kq.length,O[Q]=[];for(let U=0;U<G;U+=2)O[Q][U]=c[Q].x+(c[Q].z-c[Q].x)*I[Q].kq[U],O[Q][U+1]=c[Q].y+(c[Q].w-c[Q].y)*I[Q].kq[U+1],X.b&&(O[Q][U+1]=1-O[Q][U+1]);if(F=F.concat(O[Q]),v=v.concat(I[Q].indices.map((q=>q+S))),S+=k[Q].length,U)for(let c=0;c<4;c++)Y.push(U[Q].r,U[Q].g,U[Q].b,U[Q].a)}const Z=new J.p(0,0,R),x=J.d.RotationY(Math.PI);C=k[0].map((q=>J.p.TransformNormal(q,x).add(Z))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]),i=V[0].map((q=>J.p.TransformNormal(q,x))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]),C=C.concat(k[1].map((q=>q.eU(Z))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),i=i.concat(V[1].map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]));const z=new J.p(a,0,0),y=J.d.RotationY(-Math.PI/2);C=C.concat(k[2].map((q=>J.p.TransformNormal(q,y).add(z))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),i=i.concat(V[2].map((q=>J.p.TransformNormal(q,y))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]));const M=J.d.RotationY(Math.PI/2);C=C.concat(k[3].map((q=>J.p.TransformNormal(q,M).eU(z))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),i=i.concat(V[3].map((q=>J.p.TransformNormal(q,M))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]));const T=new J.p(0,p,0),m=J.d.RotationX(Math.PI/2);C=C.concat(k[4].map((q=>J.p.TransformNormal(q,m).add(T))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),i=i.concat(V[4].map((q=>J.p.TransformNormal(q,m))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[]));const d=J.d.RotationX(-Math.PI/2);C=C.concat(k[5].map((q=>J.p.TransformNormal(q,d).eU(T))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),i=i.concat(V[5].map((q=>J.p.TransformNormal(q,d))).map((q=>[q.x,q.y,q.z])).reduce(((q,c)=>q.concat(c)),[])),g.c._ComputeSides(o,C,v,i,F);const e=new g.c;if(e.indices=v,e.Fq=C,e.vq=i,e.kq=F,U){const q=o===g.c.DOUBLESIDE?Y.concat(Y):Y;e.Yq=q}return e}function h(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return b(c).Oq(J,c.updatable),J}g.c.CreateTiledPlane=r;g.c.CreateTiledBox=b;var o=U(12326),a=U(11364),p=U(11137);function R(q){const c=q.height||2;let U=0===q.diameterTop?0:q.diameterTop||q.diameter||1,s=0===q.diameterBottom?0:q.diameterBottom||q.diameter||1;U=U||1e-5,s=s||1e-5;const n=0|(q.tessellation||24),W=0|(q.subdivisions||1),D=!!q.hasRings,u=!!q.enclose,r=0===q.cap?0:q.cap||Q.b.CAP_ALL,H=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,b=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,h=q.faceUV||new Array(3),o=q.faceColors,a=2+(1+(1!==H&&u?2:0))*(D?W:1);let R;for(R=0;R<a;R++)o&&void 0===o[R]&&(o[R]=new K.e(1,1,1,1));for(R=0;R<a;R++)h&&void 0===h[R]&&(h[R]=new J.q(0,0,1,1));const I=[],t=[],C=[],i=[],F=[],v=2*Math.PI*H/n;let Y,k,V;const O=(s-U)/2/c,G=J.p.Zero(),S=J.p.Zero(),Z=J.p.Zero(),x=J.p.Zero(),z=J.p.Zero(),y=p.d.Y;let M,T,m,d=1,e=1,B=0,N=0;for(M=0;M<=W;M++)for(k=M/W,V=(k*(U-s)+s)/2,d=D&&0!==M&&M!==W?2:1,m=0;m<d;m++){for(D&&(e+=m),u&&(e+=2*m),T=0;T<=n;T++)Y=T*v,G.x=Math.cos(-Y)*V,G.y=-c/2+k*c,G.z=Math.sin(-Y)*V,0===U&&M===W?(S.x=C[C.length-3*(n+1)],S.y=C[C.length-3*(n+1)+1],S.z=C[C.length-3*(n+1)+2]):(S.x=G.x,S.z=G.z,S.y=Math.sqrt(S.x*S.x+S.z*S.z)*O,S.normalize()),0===T&&(Z.X(G),x.X(S)),t.push(G.x,G.y,G.z),C.push(S.x,S.y,S.z),N=D?B!==e?h[e].y:h[e].w:h[e].y+(h[e].w-h[e].y)*k,i.push(h[e].x+(h[e].z-h[e].x)*T/n,X.b?1-N:N),o&&F.push(o[e].r,o[e].g,o[e].b,o[e].a);1!==H&&u&&(t.push(G.x,G.y,G.z),t.push(0,G.y,0),t.push(0,G.y,0),t.push(Z.x,Z.y,Z.z),J.p.CrossToRef(y,S,z),z.normalize(),C.push(z.x,z.y,z.z,z.x,z.y,z.z),J.p.CrossToRef(x,y,z),z.normalize(),C.push(z.x,z.y,z.z,z.x,z.y,z.z),N=D?B!==e?h[e+1].y:h[e+1].w:h[e+1].y+(h[e+1].w-h[e+1].y)*k,i.push(h[e+1].x,X.b?1-N:N),i.push(h[e+1].z,X.b?1-N:N),N=D?B!==e?h[e+2].y:h[e+2].w:h[e+2].y+(h[e+2].w-h[e+2].y)*k,i.push(h[e+2].x,X.b?1-N:N),i.push(h[e+2].z,X.b?1-N:N),o&&(F.push(o[e+1].r,o[e+1].g,o[e+1].b,o[e+1].a),F.push(o[e+1].r,o[e+1].g,o[e+1].b,o[e+1].a),F.push(o[e+2].r,o[e+2].g,o[e+2].b,o[e+2].a),F.push(o[e+2].r,o[e+2].g,o[e+2].b,o[e+2].a))),B!==e&&(B=e)}const P=1!==H&&u?n+4:n;for(M=0,e=0;e<W;e++){let q=0,c=0,U=0,J=0;for(T=0;T<n;T++)q=M*(P+1)+T,c=(M+1)*(P+1)+T,U=M*(P+1)+(T+1),J=(M+1)*(P+1)+(T+1),I.push(q,c,U),I.push(J,U,c);1!==H&&u&&(I.push(q+2,c+2,U+2),I.push(J+2,U+2,c+2),I.push(q+4,c+4,U+4),I.push(J+4,U+4,c+4)),M=D?M+2:M+1}const w=q=>{const Q=q?U/2:s/2;if(0===Q)return;let g,W,D;const u=q?h[a-1]:h[0];let K=null;o&&(K=q?o[a-1]:o[0]);const r=t.length/3,b=q?c/2:-c/2,p=new J.p(0,b,0);t.push(p.x,p.y,p.z),C.push(0,q?1:-1,0);const R=u.y+.5*(u.w-u.y);i.push(u.x+.5*(u.z-u.x),X.b?1-R:R),K&&F.push(K.r,K.g,K.b,K.a);const v=new J.l(.5,.5);for(D=0;D<=n;D++){g=2*Math.PI*D*H/n;const c=Math.cos(-g),U=Math.sin(-g);W=new J.p(c*Q,b,U*Q);const s=new J.l(c*v.x+.5,U*v.y+.5);t.push(W.x,W.y,W.z),C.push(0,q?1:-1,0);const r=u.y+(u.w-u.y)*s.y;i.push(u.x+(u.z-u.x)*s.x,X.b?1-r:r),K&&F.push(K.r,K.g,K.b,K.a)}for(D=0;D<n;D++)q?(I.push(r),I.push(r+(D+2)),I.push(r+(D+1))):(I.push(r),I.push(r+(D+1)),I.push(r+(D+2)))};r!==Q.b.CAP_START&&r!==Q.b.CAP_ALL||w(!1),r!==Q.b.CAP_END&&r!==Q.b.CAP_ALL||w(!0),g.c._ComputeSides(b,t,I,C,i,q.frontUVs,q.backUVs);const L=new g.c;return L.indices=I,L.Fq=t,L.vq=C,L.kq=i,o&&(L.Yq=F),L}function I(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return R(c).Oq(J,c.updatable),J}function t(q){const c=[],U=[],Q=[],s=[],n=q.diameter||1,W=q.thickness||.5,D=0|(q.tessellation||16),u=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,K=D+1;for(let g=0;g<=D;g++){const q=g/D,u=g*Math.PI*2/D-Math.PI/2,r=J.d.Translation(n/2,0,0).multiply(J.d.RotationY(u));for(let n=0;n<=D;n++){const u=1-n/D,H=n*Math.PI*2/D+Math.PI,b=Math.cos(H),h=Math.sin(H);let o=new J.p(b,h,0),a=o.scale(W/2);const p=new J.l(q,u);a=J.p.TransformCoordinates(a,r),o=J.p.TransformNormal(o,r),U.push(a.x,a.y,a.z),Q.push(o.x,o.y,o.z),s.push(p.x,X.b?1-p.y:p.y);const R=(g+1)%K,I=(n+1)%K;c.push(g*K+n),c.push(g*K+I),c.push(R*K+n),c.push(g*K+I),c.push(R*K+I),c.push(R*K+n)}}g.c._ComputeSides(u,U,c,Q,s,q.frontUVs,q.backUVs);const r=new g.c;return r.indices=c,r.Fq=U,r.vq=Q,r.kq=s,r}function C(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return t(c).Oq(J,c.updatable),J}g.c.CreateCylinder=R,Q.b.CreateCylinder=(q,c,U,J,s,g,X,n,W)=>{void 0!==X&&X instanceof a.b||(void 0!==X&&(W=n||Q.b.DEFAULTSIDE,n=X),X=g,g=1);return I(q,{height:c,diameterTop:U,diameterBottom:J,tessellation:s,subdivisions:g,sideOrientation:W,updatable:n},X)};function i(q){const c=[],U=[],Q=[],s=[],n=q.radius||2,W=q.tube||.5,D=q.radialSegments||32,u=q.tubularSegments||32,K=q.p||2,r=q.q||3,H=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,b=q=>{const c=Math.cos(q),U=Math.sin(q),Q=r/K*q,s=Math.cos(Q),g=n*(2+s)*.5*c,X=n*(2+s)*U*.5,W=n*Math.sin(Q)*.5;return new J.p(g,X,W)};let h,o;for(h=0;h<=D;h++){const q=h%D/D*2*K*Math.PI,c=b(q),Q=b(q+.01),g=Q.eU(c);let n=Q.add(c);const r=J.p.Cross(g,n);for(n=J.p.Cross(r,g),r.normalize(),n.normalize(),o=0;o<u;o++){const q=o%u/u*2*Math.PI,J=-W*Math.cos(q),Q=W*Math.sin(q);U.push(c.x+J*n.x+Q*r.x),U.push(c.y+J*n.y+Q*r.y),U.push(c.z+J*n.z+Q*r.z),s.push(h/D),s.push(X.b?1-o/u:o/u)}}for(h=0;h<D;h++)for(o=0;o<u;o++){const q=(o+1)%u,U=h*u+o,J=(h+1)*u+o,Q=(h+1)*u+q,s=h*u+q;c.push(s),c.push(J),c.push(U),c.push(s),c.push(Q),c.push(J)}g.c.ComputeNormals(U,c,Q),g.c._ComputeSides(H,U,c,Q,s,q.frontUVs,q.backUVs);const a=new g.c;return a.indices=c,a.Fq=U,a.vq=Q,a.kq=s,a}function F(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2?arguments[2]:void 0;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return i(c).Oq(J,c.updatable),J}g.c.CreateTorus=t,Q.b.CreateTorus=(q,c,U,J,Q,s,g)=>C(q,{diameter:c,thickness:U,tessellation:J,sideOrientation:g,updatable:s},Q);g.c.CreateTorusKnot=i,Q.b.CreateTorusKnot=(q,c,U,J,Q,s,g,X,n,W)=>F(q,{radius:c,tube:U,radialSegments:J,tubularSegments:Q,p:s,q:g,sideOrientation:W,updatable:n},X);var v=U(12830),Y=U(11505),k=U(11266);function V(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=c.path,s=c.shape,g=c.scale||1,X=c.rotation||0,n=0===c.cap?0:c.cap||Q.b.NO_CAP,W=c.updatable,D=Q.b._GetDefaultSideOrientation(c.sideOrientation),u=c.instance||null,K=c.invertUV||!1,r=c.closeShape||!1,H=c.closePath||!1,b=c.capFunction||null;return G(q,s,J,g,X,null,null,H,r,n,!1,U,!!W,D,u,K,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,b)}function O(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=c.path,s=c.shape,g=c.scaleFunction||(()=>1),X=c.rotationFunction||(()=>0),n=c.closePath||c.ribbonCloseArray||!1,W=c.closeShape||c.ribbonClosePath||!1,D=0===c.cap?0:c.cap||Q.b.NO_CAP,u=c.updatable,K=c.firstNormal||null,r=c.adjustFrame||!1,H=Q.b._GetDefaultSideOrientation(c.sideOrientation),b=c.instance,h=c.invertUV||!1,o=c.capFunction||null;return G(q,s,J,null,null,g,X,n,W,D,!0,U,!!u,H,b||null,h,c.frontUVs||null,c.backUVs||null,K,r,o||null)}function G(q,c,U,s,g,X,n,D,u,K,r,H,b,h,o,a,p,R,I,t,C){const i=(q,c,U,s,g,X,n,W,D,u,K)=>{const r=U.getTangents(),H=U.getNormals(),b=U.getBinormals(),h=U.getDistances();if(K)for(let Q=0;Q<r.length;Q++)if(0==r[Q].x&&0==r[Q].y&&0==r[Q].z&&r[Q].X(r[Q-1]),0==H[Q].x&&0==H[Q].y&&0==H[Q].z&&H[Q].X(H[Q-1]),0==b[Q].x&&0==b[Q].y&&0==b[Q].z&&b[Q].X(b[Q-1]),Q>0){let q=r[Q-1];J.p.Dot(q,r[Q])<0&&r[Q].scaleInPlace(-1),q=H[Q-1],J.p.Dot(q,H[Q])<0&&H[Q].scaleInPlace(-1),q=b[Q-1],J.p.Dot(q,b[Q])<0&&b[Q].scaleInPlace(-1)}let o=0;const a=u&&W?W:()=>null!==X?X:0,p=u&&n?n:()=>null!==g?g:1;let R=D===Q.b.NO_CAP||D===Q.b.CAP_END?0:2;const I=J.j.Matrix[0];for(let Q=0;Q<c.length;Q++){const U=[],g=a(Q,h[Q]),X=p(Q,h[Q]);J.d.RotationAxisToRef(r[Q],o,I);for(let s=0;s<q.length;s++){const g=r[Q].scale(q[s].z).add(H[Q].scale(q[s].x)).add(b[Q].scale(q[s].y)),n=J.p.Zero();J.p.TransformCoordinatesToRef(g,I,n),n.scaleInPlace(X).addInPlace(c[Q]),U[s]=n}s[R]=U,o+=g,R++}const t=C||(q=>{const c=Array(),U=J.p.Zero();let Q;for(Q=0;Q<q.length;Q++)U.addInPlace(q[Q]);for(U.scaleInPlace(1/q.length),Q=0;Q<q.length;Q++)c.push(U);return c});switch(D){case Q.b.NO_CAP:break;case Q.b.CAP_START:s[0]=t(s[2]),s[1]=s[2];break;case Q.b.CAP_END:s[R]=s[R-1],s[R+1]=t(s[R-1]);break;case Q.b.CAP_ALL:s[0]=t(s[2]),s[1]=s[2],s[R]=s[R-1],s[R+1]=t(s[R-1])}return s};let F,v;if(o){const q=o._creationDataStorage;return F=I?q.path3D.update(U,I):q.path3D.update(U),v=i(c,U,q.path3D,q.pathArray,s,g,X,n,q.cap,r,t),o=W("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:o},H||void 0)}F=I?new k.k(U,I):new k.k(U);v=i(c,U,F,new Array,s,g,X,n,K=K<0||K>3?0:K,r,t);const Y=W(q,{pathArray:v,closeArray:D,closePath:u,updatable:b,sideOrientation:h,invertUV:a,frontUVs:p||void 0,backUVs:R||void 0},H);return Y._creationDataStorage.pathArray=v,Y._creationDataStorage.path3D=F,Y._creationDataStorage.cap=K,Y}function S(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,g=void 0===c.closed||c.closed,X=c.shape,n=c.radius||1,D=c.tessellation||64,u=c.clip||0,K=c.updatable,r=Q.b._GetDefaultSideOrientation(c.sideOrientation),H=c.cap||Q.b.NO_CAP,b=2*Math.PI,h=[],o=c.invertUV||!1;let a=0,p=0;const R=b/D*s;let I,t;for(a=0;a<=D-u;a++){for(t=[],H!=Q.b.CAP_START&&H!=Q.b.CAP_ALL||(t.push(new J.p(0,X[0].y,0)),t.push(new J.p(Math.cos(a*R)*X[0].x*n,X[0].y,Math.sin(a*R)*X[0].x*n))),p=0;p<X.length;p++)I=new J.p(Math.cos(a*R)*X[p].x*n,X[p].y,Math.sin(a*R)*X[p].x*n),t.push(I);H!=Q.b.CAP_END&&H!=Q.b.CAP_ALL||(t.push(new J.p(Math.cos(a*R)*X[X.length-1].x*n,X[X.length-1].y,Math.sin(a*R)*X[X.length-1].x*n)),t.push(new J.p(0,X[X.length-1].y,0))),h.push(t)}return W(q,{pathArray:h,closeArray:g,sideOrientation:r,updatable:K,invertUV:o,frontUVs:c.frontUVs,backUVs:c.backUVs},U)}Q.b.ExtrudeShape=function(q,c,U,J,s,g){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7?arguments[7]:void 0,W=arguments.length>8?arguments[8]:void 0,D=arguments.length>9?arguments[9]:void 0;return V(q,{shape:c,path:U,scale:J,rotation:s,cap:0===g?0:g||Q.b.NO_CAP,sideOrientation:W,instance:D,updatable:n},X)},Q.b.ExtrudeShapeCustom=(q,c,U,J,s,g,X,n,W,D,u,K)=>O(q,{shape:c,path:U,scaleFunction:J,rotationFunction:s,ribbonCloseArray:g,ribbonClosePath:X,cap:0===n?0:n||Q.b.NO_CAP,sideOrientation:u,instance:K,updatable:D},W);Q.b.CreateLathe=(q,c,U,J,Q,s,g)=>S(q,{shape:c,radius:U,tessellation:J,sideOrientation:g,updatable:s},Q);var Z=U(12237),x=U(12183);function z(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.path;let g=c.instance,X=1;void 0!==c.radius?X=c.radius:g&&(X=g._creationDataStorage.radius);const n=c.tessellation||64,D=c.radiusFunction||null;let u=c.cap||Q.b.NO_CAP;const K=c.invertUV||!1,r=c.updatable,H=Q.b._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const b=(q,c,U,s,g,X,n,W)=>{const D=c.getTangents(),u=c.getNormals(),K=c.getDistances(),r=2*Math.PI/g*W,H=X||(()=>s);let b,h,o,a;const p=J.j.Matrix[0];let R=n===Q.b.NO_CAP||n===Q.b.CAP_END?0:2;for(let Q=0;Q<q.length;Q++){h=H(Q,K[Q]),b=Array(),o=u[Q];for(let c=0;c<g;c++)J.d.RotationAxisToRef(D[Q],r*c,p),a=b[c]?b[c]:J.p.Zero(),J.p.TransformCoordinatesToRef(o,p,a),a.scaleInPlace(h).addInPlace(q[Q]),b[c]=a;U[R]=b,R++}const I=(c,U)=>{const J=Array();for(let Q=0;Q<c;Q++)J.push(q[U]);return J};switch(n){case Q.b.NO_CAP:break;case Q.b.CAP_START:U[0]=I(g,0),U[1]=U[2].slice(0);break;case Q.b.CAP_END:U[R]=U[R-1].slice(0),U[R+1]=I(g,q.length-1);break;case Q.b.CAP_ALL:U[0]=I(g,0),U[1]=U[2].slice(0),U[R]=U[R-1].slice(0),U[R+1]=I(g,q.length-1)}return U};let h,o;if(g){const q=g._creationDataStorage,U=c.arc||q.arc;return h=q.path3D.update(s),o=b(s,h,q.pathArray,X,q.tessellation,D,q.cap,U),g=W("",{pathArray:o,instance:g}),q.path3D=h,q.pathArray=o,q.arc=U,q.radius=X,g}h=new k.k(s);u=u<0||u>3?0:u,o=b(s,h,new Array,X,n,D,u,c.arc);const a=W(q,{pathArray:o,closePath:!0,closeArray:!1,updatable:r,sideOrientation:H,invertUV:K,frontUVs:c.frontUVs,backUVs:c.backUVs},U);return a._creationDataStorage.pathArray=o,a._creationDataStorage.path3D=h,a._creationDataStorage.tessellation=n,a._creationDataStorage.cap=u,a._creationDataStorage.arc=c.arc,a._creationDataStorage.radius=X,a}function y(q){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const U=q.type&&(q.type<0||q.type>=c.length)?0:q.type||0,Q=q.size,s=q.sizeX||Q||1,n=q.sizeY||Q||1,W=q.sizeZ||Q||1,D=q.custom||c[U],u=D.face.length,r=q.faceUV||new Array(u),H=q.faceColors,b=void 0===q.flat||q.flat,h=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,o=[],a=[],p=[],R=[],I=[];let t=0,C=0;const i=[];let F,v,Y,k,V,O,G=0,S=0;if(b)for(S=0;S<u;S++)H&&void 0===H[S]&&(H[S]=new K.e(1,1,1,1)),r&&void 0===r[S]&&(r[S]=new J.q(0,0,1,1));if(b)for(S=0;S<u;S++){const q=D.face[S].length;for(Y=2*Math.PI/q,k=.5*Math.tan(Y/2),V=.5,G=0;G<q;G++)o.push(D.vertex[D.face[S][G]][0]*s,D.vertex[D.face[S][G]][1]*n,D.vertex[D.face[S][G]][2]*W),i.push(t),t++,F=r[S].x+(r[S].z-r[S].x)*(.5+k),v=r[S].y+(r[S].w-r[S].y)*(V-.5),R.push(F,X.b?1-v:v),O=k*Math.cos(Y)-V*Math.sin(Y),V=k*Math.sin(Y)+V*Math.cos(Y),k=O,H&&I.push(H[S].r,H[S].g,H[S].b,H[S].a);for(G=0;G<q-2;G++)a.push(i[0+C],i[G+2+C],i[G+1+C]);C+=q}else{for(G=0;G<D.vertex.length;G++)o.push(D.vertex[G][0]*s,D.vertex[G][1]*n,D.vertex[G][2]*W),R.push(0,X.b?1:0);for(S=0;S<u;S++)for(G=0;G<D.face[S].length-2;G++)a.push(D.face[S][0],D.face[S][G+2],D.face[S][G+1])}g.c.ComputeNormals(o,a,p),g.c._ComputeSides(h,o,a,p,R,q.frontUVs,q.backUVs);const Z=new g.c;return Z.Fq=o,Z.indices=a,Z.vq=p,Z.kq=R,H&&b&&(Z.Yq=I),Z}function M(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return y(c).Oq(J,c.updatable),J}Q.b.CreateTube=(q,c,U,J,Q,s,g,X,n,W)=>z(q,{path:c,radius:U,tessellation:J,radiusFunction:Q,arc:1,cap:s,updatable:X,sideOrientation:n,instance:W},g);function T(q){const c=q.sideOrientation||g.c.DEFAULTSIDE,U=q.radius||1,Q=void 0===q.flat||q.flat,s=0|(q.subdivisions||4),n=q.radiusX||U,W=q.radiusY||U,D=q.radiusZ||U,u=(1+Math.sqrt(5))/2,K=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],r=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],H=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],b=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],o=[],a=[],p=[],R=[];let I=0;const t=new Array(3),C=new Array(3);let i;for(i=0;i<3;i++)t[i]=J.p.Zero(),C[i]=J.l.Zero();for(let g=0;g<20;g++){for(i=0;i<3;i++){const q=r[3*g+i];t[i].bc(K[3*H[q]],K[3*H[q]+1],K[3*H[q]+2]),t[i].normalize(),C[i].bc(.134765625*b[2*q]+.05859375+-.0390625*h[g],.2333984375*b[2*q+1]+.025390625+.01953125*h[g])}const q=(q,c,U,g)=>{const u=J.p.Lerp(t[0],t[2],c/s),K=J.p.Lerp(t[1],t[2],c/s),r=s===c?t[2]:J.p.Lerp(u,K,q/(s-c));let H;if(r.normalize(),Q){const q=J.p.Lerp(t[0],t[2],g/s),c=J.p.Lerp(t[1],t[2],g/s);H=J.p.Lerp(q,c,U/(s-g))}else H=new J.p(r.x,r.y,r.z);H.x/=n,H.y/=W,H.z/=D,H.normalize();const b=J.l.Lerp(C[0],C[2],c/s),h=J.l.Lerp(C[1],C[2],c/s),i=s===c?C[2]:J.l.Lerp(b,h,q/(s-c));a.push(r.x*n,r.y*W,r.z*D),p.push(H.x,H.y,H.z),R.push(i.x,X.b?1-i.y:i.y),o.push(I),I++};for(let c=0;c<s;c++)for(let U=0;U+c<s;U++)q(U,c,U+1/3,c+1/3),q(U+1,c,U+1/3,c+1/3),q(U,c+1,U+1/3,c+1/3),U+c+1<s&&(q(U+1,c,U+2/3,c+2/3),q(U+1,c+1,U+2/3,c+2/3),q(U,c+1,U+2/3,c+2/3))}g.c._ComputeSides(c,a,o,p,R,q.frontUVs,q.backUVs);const F=new g.c;return F.indices=o,F.Fq=a,F.vq=p,F.kq=R,F}function m(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new Q.b(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),J._originalBuilderSideOrientation=c.sideOrientation;return T(c).Oq(J,c.updatable),J}g.c.CreatePolyhedron=y,Q.b.CreatePolyhedron=(q,c,U)=>M(q,c,U);g.c.CreateIcoSphere=T,Q.b.CreateIcoSphere=(q,c,U)=>m(q,c,U);var d=U(10870);const e=new J.p(1,0,0),B=new J.p(-1,0,0),N=new J.p(0,1,0),P=new J.p(0,-1,0),w=new J.p(0,0,1),L=new J.p(0,0,-1);class l{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.p.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.p.Up(),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.l.Zero(),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=q,this.Jc=c,this.uv=U,this.vertexIdx=Q,this.vertexIdxForBones=s,this.localPositionOverride=g,this.localNormalOverride=X,this.matrixIndicesOverride=n,this.matrixWeightsOverride=W}clone(){var q,c,U,J;return new l(this.position.clone(),this.Jc.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(q=this.localPositionOverride)||void 0===q?void 0:q.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(U=this.matrixIndicesOverride)||void 0===U?void 0:U.slice(),null===(J=this.matrixWeightsOverride)||void 0===J?void 0:J.slice())}}function j(q,c,U){var n,W,D,u,K;const r=!!c.skeleton,H=!(null===(n=c.morphTargetManager)||void 0===n||!n.numTargets),b=U.localMode||r,h=c.uc(),o=r||H?c.jX(!0,!0):c.getVerticesData(s.h.PositionKind),a=r||H?c.getNormalsData(!0,!0):c.getVerticesData(s.h.NormalKind),p=b?r?c.getVerticesData(s.h.PositionKind):o:null,R=b?r?c.getVerticesData(s.h.NormalKind):a:null,I=c.getVerticesData(s.h.UVKind),t=r?c.getVerticesData(s.h.MatricesIndicesKind):null,C=r?c.getVerticesData(s.h.MatricesWeightsKind):null,i=r?c.getVerticesData(s.h.MatricesIndicesExtraKind):null,F=r?c.getVerticesData(s.h.MatricesWeightsExtraKind):null,v=U.position||J.p.Zero();let Y=U.Jc||J.p.Up();const k=U.size||J.p.One(),V=U.angle||0;if(!Y){const q=new J.p(0,0,1),U=c.Cq().activeCamera,Q=J.p.TransformCoordinates(q,U.getWorldMatrix());Y=U.globalPosition.eU(Q)}const O=-Math.atan2(Y.z,Y.x)-Math.PI/2,G=Math.sqrt(Y.x*Y.x+Y.z*Y.z),S=Math.atan2(Y.y,G),Z=new g.c;Z.indices=[],Z.Fq=[],Z.vq=[],Z.kq=[],Z.matricesIndices=r?[]:null,Z.matricesWeights=r?[]:null,Z.matricesIndicesExtra=i?[]:null,Z.matricesWeightsExtra=F?[]:null;let x=0;const z=(q,c)=>{const Q=new l;if(!h||!o||!a)return Q;const s=h[q];if(Q.vertexIdx=3*s,Q.vertexIdxForBones=4*s,Q.position=new J.p(o[3*s],o[3*s+1],o[3*s+2]),J.p.TransformCoordinatesToRef(Q.position,c,Q.position),Q.Jc=new J.p(a[3*s],a[3*s+1],a[3*s+2]),J.p.TransformNormalToRef(Q.Jc,c,Q.Jc),U.captureUVS&&I){const q=I[2*s+1];Q.uv=new J.l(I[2*s],X.b?1-q:q)}return Q},y=[0,0,0,0],M=(q,c)=>{if(0===q.length)return q;const U=.5*Math.abs(J.p.Dot(k,c)),Q=(q,c,U,J)=>{for(let Q=0;Q<J;++Q)if(q[U+Q]===c)return U+Q;return-1},s=(q,s)=>{const g=J.p.GetClipFactor(q.position,s.position,c,U);let X=y,n=y;if(t&&C){const c=q.matrixIndicesOverride?0:q.vertexIdxForBones,U=q.matrixIndicesOverride??t,J=q.matrixWeightsOverride??C,W=s.matrixIndicesOverride?0:s.vertexIdxForBones,D=s.matrixIndicesOverride??t,u=s.matrixWeightsOverride??C;X=[0,0,0,0],n=[0,0,0,0];let K=0;for(let q=0;q<4;++q)if(J[c+q]>0){const s=Q(D,U[c+q],W,4);X[K]=U[c+q],n[K]=(0,d.Lerp)(J[c+q],s>=0?u[s]:0,g),K++}for(let q=0;q<4&&K<4;++q){const J=D[W+q];-1===Q(U,J,c,4)&&(X[K]=J,n[K]=(0,d.Lerp)(0,u[W+q],g),K++)}const r=n[0]+n[1]+n[2]+n[3];n[0]/=r,n[1]/=r,n[2]/=r,n[3]/=r}const W=q.localPositionOverride?q.localPositionOverride[0]:(null===p||void 0===p?void 0:p[q.vertexIdx])??0,D=q.localPositionOverride?q.localPositionOverride[1]:(null===p||void 0===p?void 0:p[q.vertexIdx+1])??0,u=q.localPositionOverride?q.localPositionOverride[2]:(null===p||void 0===p?void 0:p[q.vertexIdx+2])??0,K=s.localPositionOverride?s.localPositionOverride[0]:(null===p||void 0===p?void 0:p[s.vertexIdx])??0,r=s.localPositionOverride?s.localPositionOverride[1]:(null===p||void 0===p?void 0:p[s.vertexIdx+1])??0,H=s.localPositionOverride?s.localPositionOverride[2]:(null===p||void 0===p?void 0:p[s.vertexIdx+2])??0,b=q.localNormalOverride?q.localNormalOverride[0]:(null===R||void 0===R?void 0:R[q.vertexIdx])??0,h=q.localNormalOverride?q.localNormalOverride[1]:(null===R||void 0===R?void 0:R[q.vertexIdx+1])??0,o=q.localNormalOverride?q.localNormalOverride[2]:(null===R||void 0===R?void 0:R[q.vertexIdx+2])??0,a=b+((s.localNormalOverride?s.localNormalOverride[0]:(null===R||void 0===R?void 0:R[s.vertexIdx])??0)-b)*g,I=h+((s.localNormalOverride?s.localNormalOverride[1]:(null===R||void 0===R?void 0:R[s.vertexIdx+1])??0)-h)*g,i=o+((s.localNormalOverride?s.localNormalOverride[2]:(null===R||void 0===R?void 0:R[s.vertexIdx+2])??0)-o)*g,F=Math.sqrt(a*a+I*I+i*i);return new l(J.p.Lerp(q.position,s.position,g),J.p.Lerp(q.Jc,s.Jc,g).normalize(),J.l.Lerp(q.uv,s.uv,g),-1,-1,p?[W+(K-W)*g,D+(r-D)*g,u+(H-u)*g]:null,R?[a/F,I/F,i/F]:null,X,n)};let g=null;q.length>3&&(g=[]);for(let X=0;X<q.length;X+=3){let Q=0,n=null,W=null,D=null,u=null;const K=J.p.Dot(q[X].position,c)-U>0,r=J.p.Dot(q[X+1].position,c)-U>0,H=J.p.Dot(q[X+2].position,c)-U>0;switch(Q=(K?1:0)+(r?1:0)+(H?1:0),Q){case 0:q.length>3?(g.push(q[X]),g.push(q[X+1]),g.push(q[X+2])):g=q;break;case 1:if(g=g??new Array,K&&(n=q[X+1],W=q[X+2],D=s(q[X],n),u=s(q[X],W)),r){n=q[X],W=q[X+2],D=s(q[X+1],n),u=s(q[X+1],W),g.push(D),g.push(W.clone()),g.push(n.clone()),g.push(W.clone()),g.push(D.clone()),g.push(u);break}H&&(n=q[X],W=q[X+1],D=s(q[X+2],n),u=s(q[X+2],W)),n&&W&&D&&u&&(g.push(n.clone()),g.push(W.clone()),g.push(D),g.push(u),g.push(D.clone()),g.push(W.clone()));break;case 2:g=g??new Array,K||(n=q[X].clone(),W=s(n,q[X+1]),D=s(n,q[X+2]),g.push(n),g.push(W),g.push(D)),r||(n=q[X+1].clone(),W=s(n,q[X+2]),D=s(n,q[X]),g.push(n),g.push(W),g.push(D)),H||(n=q[X+2].clone(),W=s(n,q[X]),D=s(n,q[X+1]),g.push(n),g.push(W),g.push(D))}}return g},T=c instanceof Q.b?c:null,m=null===T||void 0===T?void 0:T._thinInstanceDataStorage.matrixData,j=(null===T||void 0===T?void 0:T.xc)||1,f=J.j.Matrix[0];f.X(J.d.IdentityReadOnly);for(let Q=0;Q<j;++Q){if(null!==T&&void 0!==T&&T.hasThinInstances&&m){const q=16*Q;f.setRowFromFloats(0,m[q+0],m[q+1],m[q+2],m[q+3]),f.setRowFromFloats(1,m[q+4],m[q+5],m[q+6],m[q+7]),f.setRowFromFloats(2,m[q+8],m[q+9],m[q+10],m[q+11]),f.setRowFromFloats(3,m[q+12],m[q+13],m[q+14],m[q+15])}const q=J.d.RotationYawPitchRoll(O,S,V).multiply(J.d.Translation(v.x,v.y,v.z)),s=J.d.Invert(q),g=c.getWorldMatrix(),n=f.multiply(g).multiply(s),W=new Array(3);for(let c=0;c<h.length;c+=3){let q=W;if(q[0]=z(c,n),q[1]=z(c+1,n),q[2]=z(c+2,n),!(U.cullBackFaces&&-q[0].Jc.z<=0&&-q[1].Jc.z<=0&&-q[2].Jc.z<=0)&&(q=M(q,e),q&&(q=M(q,B),q&&(q=M(q,N),q&&(q=M(q,P),q&&(q=M(q,w),q&&(q=M(q,L),q)))))))for(let c=0;c<q.length;c++){const J=q[c];if(Z.indices.push(x),b?(J.localPositionOverride?(Z.Fq[3*x]=J.localPositionOverride[0],Z.Fq[3*x+1]=J.localPositionOverride[1],Z.Fq[3*x+2]=J.localPositionOverride[2]):p&&(Z.Fq[3*x]=p[J.vertexIdx],Z.Fq[3*x+1]=p[J.vertexIdx+1],Z.Fq[3*x+2]=p[J.vertexIdx+2]),J.localNormalOverride?(Z.vq[3*x]=J.localNormalOverride[0],Z.vq[3*x+1]=J.localNormalOverride[1],Z.vq[3*x+2]=J.localNormalOverride[2]):R&&(Z.vq[3*x]=R[J.vertexIdx],Z.vq[3*x+1]=R[J.vertexIdx+1],Z.vq[3*x+2]=R[J.vertexIdx+2])):(J.position.toArray(Z.Fq,3*x),J.Jc.toArray(Z.vq,3*x)),Z.matricesIndices&&Z.matricesWeights&&(J.matrixIndicesOverride?(Z.matricesIndices[4*x]=J.matrixIndicesOverride[0],Z.matricesIndices[4*x+1]=J.matrixIndicesOverride[1],Z.matricesIndices[4*x+2]=J.matrixIndicesOverride[2],Z.matricesIndices[4*x+3]=J.matrixIndicesOverride[3]):(t&&(Z.matricesIndices[4*x]=t[J.vertexIdxForBones],Z.matricesIndices[4*x+1]=t[J.vertexIdxForBones+1],Z.matricesIndices[4*x+2]=t[J.vertexIdxForBones+2],Z.matricesIndices[4*x+3]=t[J.vertexIdxForBones+3]),i&&Z.matricesIndicesExtra&&(Z.matricesIndicesExtra[4*x]=i[J.vertexIdxForBones],Z.matricesIndicesExtra[4*x+1]=i[J.vertexIdxForBones+1],Z.matricesIndicesExtra[4*x+2]=i[J.vertexIdxForBones+2],Z.matricesIndicesExtra[4*x+3]=i[J.vertexIdxForBones+3])),J.matrixWeightsOverride?(Z.matricesWeights[4*x]=J.matrixWeightsOverride[0],Z.matricesWeights[4*x+1]=J.matrixWeightsOverride[1],Z.matricesWeights[4*x+2]=J.matrixWeightsOverride[2],Z.matricesWeights[4*x+3]=J.matrixWeightsOverride[3]):(C&&(Z.matricesWeights[4*x]=C[J.vertexIdxForBones],Z.matricesWeights[4*x+1]=C[J.vertexIdxForBones+1],Z.matricesWeights[4*x+2]=C[J.vertexIdxForBones+2],Z.matricesWeights[4*x+3]=C[J.vertexIdxForBones+3]),F&&Z.matricesWeightsExtra&&(Z.matricesWeightsExtra[4*x]=F[J.vertexIdxForBones],Z.matricesWeightsExtra[4*x+1]=F[J.vertexIdxForBones+1],Z.matricesWeightsExtra[4*x+2]=F[J.vertexIdxForBones+2],Z.matricesWeightsExtra[4*x+3]=F[J.vertexIdxForBones+3]))),U.captureUVS)J.uv.toArray(Z.kq,2*x);else{Z.kq.push(.5+J.position.x/k.x);const q=.5+J.position.y/k.y;Z.kq.push(X.b?1-q:q)}x++}}}0===Z.indices.length&&(Z.indices=null),0===Z.Fq.length&&(Z.Fq=null),0===Z.vq.length&&(Z.vq=null),0===Z.kq.length&&(Z.kq=null),0===(null===(W=Z.matricesIndices)||void 0===W?void 0:W.length)&&(Z.matricesIndices=null),0===(null===(D=Z.matricesWeights)||void 0===D?void 0:D.length)&&(Z.matricesWeights=null),0===(null===(u=Z.matricesIndicesExtra)||void 0===u?void 0:u.length)&&(Z.matricesIndicesExtra=null),0===(null===(K=Z.matricesWeightsExtra)||void 0===K?void 0:K.length)&&(Z.matricesWeightsExtra=null);const A=new Q.b(q,c.Cq());return Z.Oq(A),b?(A.skeleton=c.skeleton,A.parent=c):(A.position=v.clone(),A.rotation=new J.p(S,O,V)),A.o(!0),A.refreshBoundingInfo(!0,!0),A}function f(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(q.subdivisions?q.subdivisions:2,1),U=0|Math.max(q.tessellation?q.tessellation:16,3),Q=Math.max(q.height?q.height:1,0),s=Math.max(q.radius?q.radius:.25,0),n=0|Math.max(q.capSubdivisions?q.capSubdivisions:6,1),W=U,D=c,u=Math.max(q.radiusTop?q.radiusTop:s,0),K=Math.max(q.radiusBottom?q.radiusBottom:s,0),r=Q-(u+K),H=2*Math.PI,b=Math.max(q.topCapSubdivisions?q.topCapSubdivisions:n,1),h=Math.max(q.bottomCapSubdivisions?q.bottomCapSubdivisions:n,1),o=Math.acos((K-u)/Q);let a=[];const p=[],R=[],I=[];let t=0;const C=[],i=.5*r,F=.5*Math.PI;let v,Y;const k=J.p.Zero(),V=J.p.Zero(),O=Math.cos(o),G=Math.sin(o),S=new J.l(u*G,i+u*O).eU(new J.l(K*G,K*O-i)).length(),Z=u*o+S+K*(F-o);let x=0;for(Y=0;Y<=b;Y++){const q=[],c=F-o*(Y/b);x+=u*o/b;const U=Math.cos(c),J=Math.sin(c),Q=U*u;for(v=0;v<=W;v++){const c=v/W,s=c*H+0,g=Math.sin(s),n=Math.cos(s);V.x=Q*g,V.y=i+J*u,V.z=Q*n,p.push(V.x,V.y,V.z),k.set(U*g,J,U*n),R.push(k.x,k.y,k.z),I.push(c,X.b?x/Z:1-x/Z),q.push(t),t++}C.push(q)}const z=Q-u-K+O*u-O*K,y=G*(K-u)/z;for(Y=1;Y<=D;Y++){const q=[];x+=S/D;const c=G*(Y*(K-u)/D+u);for(v=0;v<=W;v++){const U=v/W,J=U*H+0,Q=Math.sin(J),s=Math.cos(J);V.x=c*Q,V.y=i+O*u-Y*z/D,V.z=c*s,p.push(V.x,V.y,V.z),k.set(Q,y,s).normalize(),R.push(k.x,k.y,k.z),I.push(U,X.b?x/Z:1-x/Z),q.push(t),t++}C.push(q)}for(Y=1;Y<=h;Y++){const q=[],c=F-o-(Math.PI-o)*(Y/h);x+=K*o/h;const U=Math.cos(c),J=Math.sin(c),Q=U*K;for(v=0;v<=W;v++){const c=v/W,s=c*H+0,g=Math.sin(s),n=Math.cos(s);V.x=Q*g,V.y=J*K-i,V.z=Q*n,p.push(V.x,V.y,V.z),k.set(U*g,J,U*n),R.push(k.x,k.y,k.z),I.push(c,X.b?x/Z:1-x/Z),q.push(t),t++}C.push(q)}for(v=0;v<W;v++)for(Y=0;Y<b+D+h;Y++){const q=C[Y][v],c=C[Y+1][v],U=C[Y+1][v+1],J=C[Y][v+1];a.push(q),a.push(c),a.push(J),a.push(c),a.push(U),a.push(J)}if(a=a.reverse(),q.orientation&&!q.orientation.equals(J.p.Up())){const c=new J.d;q.orientation.clone().scale(.5*Math.PI).cross(J.p.Up()).toQuaternion().toRotationMatrix(c);const U=J.p.Zero();for(let q=0;q<p.length;q+=3)U.set(p[q],p[q+1],p[q+2]),J.p.TransformCoordinatesToRef(U.clone(),c,U),p[q]=U.x,p[q+1]=U.y,p[q+2]=U.z}const M=new g.c;return M.Fq=p,M.vq=R,M.kq=I,M.indices=a,M}function A(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:J.p.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new Q.b(q,U);return f(c).Oq(s,c.updatable),s}Q.b.CreateDecal=(q,c,U,J,Q,s)=>j(q,c,{position:U,Jc:J,size:Q,angle:s});Q.b.CreateCapsule=(q,c,U)=>A(q,c,U),g.c.CreateCapsule=f;var E=U(10886),qq=U(10836);class cq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=c,q!==Math.floor(q)&&(q=Math.floor(q),E.c.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.c.Warn("y is not an integer, floor(y) used"))}clone(){return new cq(this.x,this.y)}rotate60About(q){const c=this.x;return this.x=q.x+q.y-this.y,this.y=c+this.y-q.x,this}rotateNeg60About(q){const c=this.x;return this.x=c+this.y-q.y,this.y=q.x+q.y-c,this}rotate120(q,c){q!==Math.floor(q)&&(q=Math.floor(q),E.c.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.c.Warn("n not an integer only floor(n) used"));const U=this.x;return this.x=q-U-this.y,this.y=c+U,this}rotateNeg120(q,c){q!==Math.floor(q)&&(q=Math.floor(q),E.c.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.c.Warn("n is not an integer,   floor(n) used"));const U=this.x;return this.x=this.y-c,this.y=q+c-U-this.y,this}toCartesianOrigin(q,c){const U=J.p.Zero();return U.x=q.x+2*this.x*c+this.y*c,U.y=q.y+Math.sqrt(3)*this.y*c,U}static Zero(){return new cq(0,0)}}class Uq{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Jq("icosahedron","Regular",[[0,qq.g,-1],[-qq.g,1,0],[-1,0,-qq.g],[1,0,-qq.g],[qq.g,1,0],[0,qq.g,1],[-1,0,qq.g],[-qq.g,-1,0],[0,-qq.g,-1],[qq.g,-1,0],[1,0,qq.g],[0,-qq.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let q=12;const c={},U=this.m,J=this.n;let Q,s,g,X,n,W=U,D=1,u=0;0!==J&&(W=(0,d.HighestCommonFactor)(U,J)),D=U/W,u=J/W;const K=cq.Zero(),r=new cq(U,J),H=new cq(-J,U+J),b=cq.Zero(),h=cq.Zero(),o=cq.Zero();let a,p,R,I,t=[];const C=[],i=this.vertByDist,F=(U,J,Q,s)=>{a=U+"|"+Q,p=J+"|"+s,a in c||p in c?a in c&&!(p in c)?c[p]=c[a]:p in c&&!(a in c)&&(c[a]=c[p]):(c[a]=q,c[p]=q,q++),i[Q][0]>2?C[c[a]]=[-i[Q][0],i[Q][1],c[a]]:C[c[a]]=[t[i[Q][0]],i[Q][1],c[a]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let v=0;v<20;v++){if(t=this.IDATA.face[v],g=t[2],X=t[1],n=t[0],R=K.x+"|"+K.y,a=v+"|"+R,a in c||(c[a]=g,C[g]=[t[i[R][0]],i[R][1]]),R=r.x+"|"+r.y,a=v+"|"+R,a in c||(c[a]=X,C[X]=[t[i[R][0]],i[R][1]]),R=H.x+"|"+H.y,a=v+"|"+R,a in c||(c[a]=n,C[n]=[t[i[R][0]],i[R][1]]),Q=this.IDATA.edgematch[v][0],s=this.IDATA.edgematch[v][1],"B"===s)for(let q=1;q<W;q++)h.x=U-q*(D+u),h.y=J+q*D,o.x=-q*u,o.y=q*(D+u),R=h.x+"|"+h.y,I=o.x+"|"+o.y,F(v,Q,R,I);if("O"===s)for(let q=1;q<W;q++)o.x=-q*u,o.y=q*(D+u),b.x=q*D,b.y=q*u,R=o.x+"|"+o.y,I=b.x+"|"+b.y,F(v,Q,R,I);if(Q=this.IDATA.edgematch[v][2],s=this.IDATA.edgematch[v][3],s&&"A"===s)for(let q=1;q<W;q++)b.x=q*D,b.y=q*u,h.x=U-(W-q)*(D+u),h.y=J+(W-q)*D,R=b.x+"|"+b.y,I=h.x+"|"+h.y,F(v,Q,R,I);for(let U=0;U<this.vertices.length;U++)R=this.vertices[U].x+"|"+this.vertices[U].y,a=v+"|"+R,a in c||(c[a]=q++,i[R][0]>2?C[c[a]]=[-i[R][0],i[R][1],c[a]]:C[c[a]]=[t[i[R][0]],i[R][1],c[a]])}this.closestTo=C,this.vecToidx=c}calcCoeffs(){const q=this.m,c=this.n,U=Math.sqrt(3)/3,J=q*q+c*c+q*c;this.coau=(q+c)/J,this.cobu=-c/J,this.coav=-U*(q-c)/J,this.cobv=U*(2*q+c)/J}createInnerFacets(){const q=this.m,c=this.n;for(let U=0;U<c+q+1;U++)for(let q=this.min[U];q<this.max[U]+1;q++)q<this.max[U]&&q<this.max[U+1]+1&&this.innerFacets.push(["|"+q+"|"+U,"|"+q+"|"+(U+1),"|"+(q+1)+"|"+U]),U>0&&q<this.max[U-1]&&q+1<this.max[U]+1&&this.innerFacets.push(["|"+q+"|"+U,"|"+(q+1)+"|"+U,"|"+(q+1)+"|"+(U-1)])}edgeVecsABOB(){const q=this.m,c=this.n,U=new cq(-c,q+c);for(let J=1;J<q+c;J++){const q=new cq(this.min[J],J),c=new cq(this.min[J-1],J-1),Q=new cq(this.min[J+1],J+1),s=q.clone(),g=c.clone(),X=Q.clone();s.rotate60About(U),g.rotate60About(U),X.rotate60About(U);const n=new cq(this.max[s.y],s.y),W=new cq(this.max[s.y-1],s.y-1),D=new cq(this.max[s.y-1]-1,s.y-1);s.x===n.x&&s.y===n.y||(s.x!==W.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,W,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,D,n])):s.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,c,W]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([q,W,Q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,c,W]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,W,n])))}}mapABOBtoOBOA(){const q=new cq(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const U=[];for(let J=0;J<3;J++)q.x=this.isoVecsABOB[c][J].x,q.y=this.isoVecsABOB[c][J].y,0===this.vertexTypes[c][J]&&q.rotateNeg120(this.m,this.n),U.push(q.clone());this.isoVecsOBOA.push(U)}}mapABOBtoBAOA(){const q=new cq(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const U=[];for(let J=0;J<3;J++)q.x=this.isoVecsABOB[c][J].x,q.y=this.isoVecsABOB[c][J].y,1===this.vertexTypes[c][J]&&q.rotate120(this.m,this.n),U.push(q.clone());this.isoVecsBAOA.push(U)}}MapToFace(q,c){const U=this.IDATA.face[q],Q=U[2],s=U[1],g=U[0],X=J.p.Ic(this.IDATA.vertex[Q]),n=J.p.Ic(this.IDATA.vertex[s]),W=J.p.Ic(this.IDATA.vertex[g]),D=n.eU(X),u=W.eU(X),K=D.scale(this.coau).add(u.scale(this.cobu)),r=D.scale(this.coav).add(u.scale(this.cobv)),H=[];let b,h=J.j.hc[0];for(let J=0;J<this.cartesian.length;J++)h=K.scale(this.cartesian[J].x).add(r.scale(this.cartesian[J].y)).add(X),H[J]=[h.x,h.y,h.z],b=q+"|"+this.vertices[J].x+"|"+this.vertices[J].y,c.vertex[this.vecToidx[b]]=[h.x,h.y,h.z]}build(q,c){const U=[],J=cq.Zero(),Q=new cq(q,c),s=new cq(-c,q+c);U.push(J,Q,s);for(let R=c;R<q+1;R++)for(let c=0;c<q+1-R;c++)U.push(new cq(c,R));if(c>0){const J=(0,d.HighestCommonFactor)(q,c),Q=q/J,s=c/J;for(let X=1;X<J;X++)U.push(new cq(X*Q,X*s)),U.push(new cq(-X*s,X*(Q+s))),U.push(new cq(q-X*(Q+s),c+X*Q));const g=q/c;for(let X=1;X<c;X++)for(let J=0;J<X*g;J++)U.push(new cq(J,X)),U.push(new cq(J,X).rotate120(q,c)),U.push(new cq(J,X).rotateNeg120(q,c))}U.sort(((q,c)=>q.x-c.x)),U.sort(((q,c)=>q.y-c.y));const g=new Array(q+c+1),X=new Array(q+c+1);for(let R=0;R<g.length;R++)g[R]=1/0,X[R]=-1/0;let n=0,W=0;const D=U.length;for(let R=0;R<D;R++)W=U[R].x,n=U[R].y,g[n]=Math.min(W,g[n]),X[n]=Math.max(W,X[n]);const u=(U,J)=>{const Q=U.clone();return"A"===J&&Q.rotateNeg120(q,c),"B"===J&&Q.rotate120(q,c),Q.x<0?Q.y:Q.x+Q.y},K=[],r=[],H=[],b=[],h={},o=[];let a=-1,p=-1;for(let R=0;R<D;R++)K[R]=U[R].toCartesianOrigin(new cq(0,0),.5),r[R]=u(U[R],"O"),H[R]=u(U[R],"A"),b[R]=u(U[R],"B"),r[R]===H[R]&&H[R]===b[R]?(a=3,p=r[R]):r[R]===H[R]?(a=4,p=r[R]):H[R]===b[R]?(a=5,p=H[R]):b[R]===r[R]&&(a=6,p=r[R]),r[R]<H[R]&&r[R]<b[R]&&(a=2,p=r[R]),H[R]<r[R]&&H[R]<b[R]&&(a=1,p=H[R]),b[R]<H[R]&&b[R]<r[R]&&(a=0,p=b[R]),o.push([a,p,U[R].x,U[R].y]);o.sort(((q,c)=>q[2]-c[2])),o.sort(((q,c)=>q[3]-c[3])),o.sort(((q,c)=>q[1]-c[1])),o.sort(((q,c)=>q[0]-c[0]));for(let R=0;R<o.length;R++)h[o[R][2]+"|"+o[R][3]]=[o[R][0],o[R][1],R];return this.m=q,this.n=c,this.vertices=U,this.vertByDist=h,this.cartesian=K,this.min=g,this.max=X,this}}class Jq{constructor(q,c,U,J){this.name=q,this.category=c,this.vertex=U,this.face=J}}class Qq extends Jq{innerToData(q,c){for(let U=0;U<c.innerFacets.length;U++)this.face.push(c.innerFacets[U].map((U=>c.vecToidx[q+U])))}mapABOBtoDATA(q,c){const U=c.IDATA.edgematch[q][0];for(let J=0;J<c.isoVecsABOB.length;J++){const Q=[];for(let s=0;s<3;s++)0===c.vertexTypes[J][s]?Q.push(q+"|"+c.isoVecsABOB[J][s].x+"|"+c.isoVecsABOB[J][s].y):Q.push(U+"|"+c.isoVecsABOB[J][s].x+"|"+c.isoVecsABOB[J][s].y);this.face.push([c.vecToidx[Q[0]],c.vecToidx[Q[1]],c.vecToidx[Q[2]]])}}mapOBOAtoDATA(q,c){const U=c.IDATA.edgematch[q][0];for(let J=0;J<c.isoVecsOBOA.length;J++){const Q=[];for(let s=0;s<3;s++)1===c.vertexTypes[J][s]?Q.push(q+"|"+c.isoVecsOBOA[J][s].x+"|"+c.isoVecsOBOA[J][s].y):Q.push(U+"|"+c.isoVecsOBOA[J][s].x+"|"+c.isoVecsOBOA[J][s].y);this.face.push([c.vecToidx[Q[0]],c.vecToidx[Q[1]],c.vecToidx[Q[2]]])}}mapBAOAtoDATA(q,c){const U=c.IDATA.edgematch[q][2];for(let J=0;J<c.isoVecsBAOA.length;J++){const Q=[];for(let s=0;s<3;s++)1===c.vertexTypes[J][s]?Q.push(q+"|"+c.isoVecsBAOA[J][s].x+"|"+c.isoVecsBAOA[J][s].y):Q.push(U+"|"+c.isoVecsBAOA[J][s].x+"|"+c.isoVecsBAOA[J][s].y);this.face.push([c.vecToidx[Q[0]],c.vecToidx[Q[1]],c.vecToidx[Q[2]]])}}orderData(q){const c=[];for(let s=0;s<13;s++)c[s]=[];const U=q.closestTo;for(let s=0;s<U.length;s++)U[s][0]>-1?U[s][1]>0&&c[U[s][0]].push([s,U[s][1]]):c[12].push([s,U[s][0]]);const J=[];for(let s=0;s<12;s++)J[s]=s;let Q=12;for(let s=0;s<12;s++){c[s].sort(((q,c)=>q[1]-c[1]));for(let q=0;q<c[s].length;q++)J[c[s][q][0]]=Q++}for(let s=0;s<c[12].length;s++)J[c[12][s][0]]=Q++;for(let s=0;s<this.vertex.length;s++)this.vertex[s].push(J[s]);this.vertex.sort(((q,c)=>q[3]-c[3]));for(let s=0;s<this.vertex.length;s++)this.vertex[s].pop();for(let s=0;s<this.face.length;s++)for(let q=0;q<this.face[s].length;q++)this.face[s][q]=J[this.face[s][q]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(q,c){const U=[],J=[];let Q=c.pop();J.push(Q);let s=this.face[Q].indexOf(q);s=(s+2)%3;let g=this.face[Q][s];U.push(g);let X=0;for(;c.length>0;)Q=c[X],this.face[Q].indexOf(g)>-1?(s=(this.face[Q].indexOf(g)+1)%3,g=this.face[Q][s],U.push(g),J.push(Q),c.splice(X,1),X=0):X++;return this.adjacentFaces.push(U),J}toGoldbergPolyhedronData(){const q=new Jq("GeoDual","Goldberg",[],[]);q.name="GD dual";const c=this.vertex.length,U=new Array(c);for(let n=0;n<c;n++)U[n]=[];for(let n=0;n<this.face.length;n++)for(let q=0;q<3;q++)U[this.face[n][q]].push(n);let J=0,Q=0,s=0,g=[],X=[];this.adjacentFaces=[];for(let n=0;n<U.length;n++){q.face[n]=this.setOrder(n,U[n].concat([]));for(const c of U[n]){J=0,Q=0,s=0,g=this.face[c];for(let q=0;q<3;q++)X=this.vertex[g[q]],J+=X[0],Q+=X[1],s+=X[2];q.vertex[c]=[J/3,Q/3,s/3]}}return q}static BuildGeodesicData(q){const c=new Qq("Geodesic-m-n","Geodesic",[[0,qq.g,-1],[-qq.g,1,0],[-1,0,-qq.g],[1,0,-qq.g],[qq.g,1,0],[0,qq.g,1],[-1,0,qq.g],[-qq.g,-1,0],[0,-qq.g,-1],[qq.g,-1,0],[1,0,qq.g],[0,-qq.g,1]],[]);q.setIndices(),q.calcCoeffs(),q.createInnerFacets(),q.edgeVecsABOB(),q.mapABOBtoOBOA(),q.mapABOBtoBAOA();for(let U=0;U<q.IDATA.face.length;U++)q.MapToFace(U,c),c.innerToData(U,q),"B"===q.IDATA.edgematch[U][1]&&c.mapABOBtoDATA(U,q),"O"===q.IDATA.edgematch[U][1]&&c.mapOBOAtoDATA(U,q),"A"===q.IDATA.edgematch[U][3]&&c.mapBAOAtoDATA(U,q);c.orderData(q);return c.vertex=c.vertex.map((function(q){const c=q[0],U=q[1],J=q[2],Q=Math.sqrt(c*c+U*U+J*J);return q[0]*=1/Q,q[1]*=1/Q,q[2]*=1/Q,q})),c}}Q.b._GoldbergMeshParser=(q,c)=>sq.Parse(q,c);class sq extends Q.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(q,c){return void 0===c?(q>this.goldbergData.nbUnsharedFaces-1&&(E.c.Warn("Maximum number of unshared faces used"),q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+q):(q>11&&(E.c.Warn("Last pole used"),q=11),c>this.goldbergData.nbFacesAtPole-1&&(E.c.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+q*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(q){for(let U=0;U<q.length;U++){const c=q[U][0],J=q[U][1],Q=q[U][2];for(let q=c;q<J+1;q++)this.goldbergData.faceColors[q]=Q}const c=[];for(let U=0;U<12;U++)for(let q=0;q<5;q++)c.push(this.goldbergData.faceColors[U].r,this.goldbergData.faceColors[U].g,this.goldbergData.faceColors[U].b,this.goldbergData.faceColors[U].a);for(let U=12;U<this.goldbergData.faceColors.length;U++)for(let q=0;q<6;q++)c.push(this.goldbergData.faceColors[U].r,this.goldbergData.faceColors[U].g,this.goldbergData.faceColors[U].b,this.goldbergData.faceColors[U].a);return c}setGoldbergFaceColors(q){const c=this._changeGoldbergFaceColors(q);this.xq(s.h.ColorKind,c)}updateGoldbergFaceColors(q){const c=this._changeGoldbergFaceColors(q);this.updateVerticesData(s.h.ColorKind,c)}_changeGoldbergFaceUVs(q){const c=this.getVerticesData(s.h.UVKind);for(let U=0;U<q.length;U++){const J=q[U][0],Q=q[U][1],s=q[U][2],g=q[U][3],X=q[U][4],n=[],W=[];let D,u;for(let q=0;q<5;q++)D=s.x+g*Math.cos(X+q*Math.PI/2.5),u=s.y+g*Math.sin(X+q*Math.PI/2.5),D<0&&(D=0),D>1&&(D=1),n.push(D,u);for(let q=0;q<6;q++)D=s.x+g*Math.cos(X+q*Math.PI/3),u=s.y+g*Math.sin(X+q*Math.PI/3),D<0&&(D=0),D>1&&(D=1),W.push(D,u);for(let q=J;q<Math.min(12,Q+1);q++)for(let U=0;U<5;U++)c[10*q+2*U]=n[2*U],c[10*q+2*U+1]=n[2*U+1];for(let q=Math.max(12,J);q<Q+1;q++)for(let U=0;U<6;U++)c[12*q-24+2*U]=W[2*U],c[12*q-23+2*U]=W[2*U+1]}return c}setGoldbergFaceUVs(q){const c=this._changeGoldbergFaceUVs(q);this.xq(s.h.UVKind,c)}updateGoldbergFaceUVs(q){const c=this._changeGoldbergFaceUVs(q);this.updateVerticesData(s.h.UVKind,c)}placeOnGoldbergFaceAt(q,c,U){const Q=J.p.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);q.rotation=Q,q.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(U.x)).add(this.goldbergData.faceYaxis[c].scale(U.y)).add(this.goldbergData.faceZaxis[c].scale(U.z))}serialize(q){super.serialize(q),q.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const q of this.goldbergData.faceColors)c.faceColors.push(q.rc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const q of this.goldbergData.faceCenters)c.faceCenters.push(q.rc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const q of this.goldbergData.faceZaxis)c.faceZaxis.push(q.rc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const q of this.goldbergData.faceYaxis)c.faceYaxis.push(q.rc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const q of this.goldbergData.faceXaxis)c.faceXaxis.push(q.rc())}q.goldbergData=c}static Parse(q,c){const U=q.goldbergData;U.faceColors=U.faceColors.map((q=>K.e.Ic(q))),U.faceCenters=U.faceCenters.map((q=>J.p.Ic(q))),U.faceZaxis=U.faceZaxis.map((q=>J.p.Ic(q))),U.faceXaxis=U.faceXaxis.map((q=>J.p.Ic(q))),U.faceYaxis=U.faceYaxis.map((q=>J.p.Ic(q)));const Q=new sq(q.name,c);return Q.goldbergData=U,Q}}var gq=U(11502);const Xq={CreateBox:u.b,CreateTiledBox:h,CreateSphere:o.d,CreateDisc:D.b,CreateIcoSphere:m,CreateRibbon:W,CreateCylinder:I,CreateTorus:C,CreateTorusKnot:F,CreateLineSystem:v.e,tW:v.i,CreateDashedLines:v.c,ExtrudeShape:V,ExtrudeShapeCustom:O,CreateLathe:S,CreateTiledPlane:H,FW:Z.c,CreateGround:x.d,CreateTiledGround:x.h,CreateGroundFromHeightMap:x.b,CreatePolygon:Y.b,ExtrudePolygon:Y.e,CreateTube:z,CreatePolyhedron:M,CreateGeodesic:function(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=c.m||1;J!==Math.floor(J)&&(J=Math.floor(J),E.c.Warn("m not an integer only floor(m) used"));let Q=c.n||0;if(Q!==Math.floor(Q)&&(Q=Math.floor(Q),E.c.Warn("n not an integer only floor(n) used")),Q>J){const q=Q;Q=J,J=q,E.c.Warn("n > m therefore m and n swapped")}const s=new Uq;return s.build(J,Q),M(q,{custom:Qq.BuildGeodesicData(s),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},U)},CreateGoldberg:function(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.size,n=c.sizeX||s||1,W=c.sizeY||s||1,D=c.sizeZ||s||1;let u=c.m||1;u!==Math.floor(u)&&(u=Math.floor(u),E.c.Warn("m not an integer only floor(m) used"));let r=c.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),E.c.Warn("n not an integer only floor(n) used")),r>u){const q=r;r=u,u=q,E.c.Warn("n > m therefore m and n swapped")}const H=new Uq;H.build(u,r);const b=Qq.BuildGeodesicData(H),h=b.toGoldbergPolyhedronData(),o=new sq(q,U);c.sideOrientation=Q.b._GetDefaultSideOrientation(c.sideOrientation),o._originalBuilderSideOrientation=c.sideOrientation;(function(q,c){const U=q.size,Q=q.sizeX||U||1,s=q.sizeY||U||1,n=q.sizeZ||U||1,W=0===q.sideOrientation?0:q.sideOrientation||g.c.DEFAULTSIDE,D=[],u=[],K=[],r=[];let H=1/0,b=-1/0,h=1/0,o=-1/0;for(let J=0;J<c.vertex.length;J++)H=Math.min(H,c.vertex[J][0]*Q),b=Math.max(b,c.vertex[J][0]*Q),h=Math.min(h,c.vertex[J][1]*s),o=Math.max(o,c.vertex[J][1]*s);let a=0;for(let g=0;g<c.face.length;g++){const q=c.face[g],U=J.p.Ic(c.vertex[q[0]]),W=J.p.Ic(c.vertex[q[2]]),p=J.p.Ic(c.vertex[q[1]]),R=W.eU(U),I=p.eU(U),t=J.p.Cross(I,R).normalize();for(let J=0;J<q.length;J++){K.push(t.x,t.y,t.z);const U=c.vertex[q[J]];D.push(U[0]*Q,U[1]*s,U[2]*n);const g=(U[1]*s-h)/(o-h);r.push((U[0]*Q-H)/(b-H),X.b?1-g:g)}for(let c=0;c<q.length-2;c++)u.push(a,a+c+2,a+c+1);a+=q.length}g.c._ComputeSides(W,D,u,K,r);const p=new g.c;return p.Fq=D,p.indices=u,p.vq=K,p.kq=r,p})(c,h).Oq(o,c.updatable),o.goldbergData.nbSharedFaces=b.sharedNodes,o.goldbergData.nbUnsharedFaces=b.poleNodes,o.goldbergData.adjacentFaces=b.adjacentFaces,o.goldbergData.nbFaces=o.goldbergData.nbSharedFaces+o.goldbergData.nbUnsharedFaces,o.goldbergData.nbFacesAtPole=(o.goldbergData.nbUnsharedFaces-12)/12;for(let Q=0;Q<b.vertex.length;Q++)o.goldbergData.faceCenters.push(J.p.Ic(b.vertex[Q])),o.goldbergData.faceCenters[Q].x*=n,o.goldbergData.faceCenters[Q].y*=W,o.goldbergData.faceCenters[Q].z*=D,o.goldbergData.faceColors.push(new K.e(1,1,1,1));for(let Q=0;Q<h.face.length;Q++){const q=h.face[Q],c=J.p.Ic(h.vertex[q[0]]),U=J.p.Ic(h.vertex[q[2]]),s=J.p.Ic(h.vertex[q[1]]),g=U.eU(c),X=s.eU(c),n=J.p.Cross(X,g).normalize(),W=J.p.Cross(X,n).normalize();o.goldbergData.faceXaxis.push(X.normalize()),o.goldbergData.faceYaxis.push(n),o.goldbergData.faceZaxis.push(W)}return o},CreateDecal:j,CreateCapsule:A,CreateText:gq.f}},12256:(q,c,U)=>{"use strict";U.d(c,{d:()=>Xc});var J=U(10833),Q=U(11416);class s extends Q.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=U(11093),X=(U(11233),U(10850));class n{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this._targetStopDuration!==q&&(this._targetStopDuration=q)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){this._noiseTexture!==q&&(this._noiseTexture=q,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(q){this._isAnimationSheetEnabled!=q&&(this._isAnimationSheetEnabled=q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){this._useLogarithmicDepth=q&&this.Cq().getEngine().getCaps().fragmentDepthSupported}Cq(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(q){switch(q){case n.BLENDMODE_MULTIPLYADD:return;case n.BLENDMODE_ADD:q=1;break;case n.BLENDMODE_ONEONE:q=6;break;case n.BLENDMODE_STANDARD:q=2;break;case n.BLENDMODE_MULTIPLY:q=4;break;case n.BLENDMODE_SUBTRACT:q=3}this._engine.setAlphaMode(q)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:J.p.Zero()}set direction1(q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:J.p.Zero()}set direction2(q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:J.p.Zero()}set minEmitBox(q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:J.p.Zero()}set maxEmitBox(q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=q)}get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(q){this._isBillboardBased!==q&&(this._isBillboardBased=q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q)}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(!q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=q)}_reset(){}_removeGradientAndTexture(q,c,U){if(!c)return this;let J=0;for(const Q of c){if(Q.gradient===q){c.splice(J,1);break}J++}return U&&U.dispose(),this}constructor(q){this.animations=[],this.renderingGroupId=0,this.j=J.p.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new J.p(10,10,10),this.onAnimationEnd=null,this.blendMode=n.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new J.l(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.pW=new J.p(0,0,0),this._useLogarithmicDepth=!1,this.gravity=J.p.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.e(1,1,1,1),this.color2=new g.e(1,1,1,1),this.colorDead=new g.e(0,0,0,1),this.textureMask=new g.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new s,this.id=q,this.name=q}createPointEmitter(q,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new J.p(0,1,0),arguments.length>2&&void 0!==arguments[2]||new J.p(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new J.p(0,1,0),arguments.length>4&&void 0!==arguments[4]||new J.p(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new J.p(0,1,0),arguments.length>3&&void 0!==arguments[3]||new J.p(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(q,c,U,J){throw new Error("Method not implemented.")}}n.BLENDMODE_ONEONE=0,n.BLENDMODE_STANDARD=1,n.BLENDMODE_ADD=2,n.BLENDMODE_MULTIPLY=3,n.BLENDMODE_MULTIPLYADD=4,n.BLENDMODE_SUBTRACT=-1,(0,X.f)("BABYLON.BaseParticleSystem",n);var W=U(10870),D=U(10895);class u{constructor(){this.direction1=new J.p(0,1,0),this.direction2=new J.p(0,1,0),this.minEmitBox=new J.p(-.5,-.5,-.5),this.maxEmitBox=new J.p(.5,.5,.5)}startDirectionFunction(q,c,U,Q){const s=(0,W.RandomRange)(this.direction1.x,this.direction2.x),g=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);if(Q)return c.x=s,c.y=g,void(c.z=X);J.p.TransformNormalFromFloatsToRef(s,g,X,q,c)}startPositionFunction(q,c,U,Q){const s=(0,W.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,W.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,W.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(Q)return c.x=s,c.y=g,void(c.z=X);J.p.TransformCoordinatesFromFloatsToRef(s,g,X,q,c)}clone(){const q=new u;return D.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2),q.setVector3("minEmitBox",this.minEmitBox),q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3),q.addUniform("minEmitBox",3),q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.rc(),q.direction2=this.direction2.rc(),q.minEmitBox=this.minEmitBox.rc(),q.maxEmitBox=this.maxEmitBox.rc(),q}parse(q){J.p.FromArrayToRef(q.direction1,0,this.direction1),J.p.FromArrayToRef(q.direction2,0,this.direction2),J.p.FromArrayToRef(q.minEmitBox,0,this.minEmitBox),J.p.FromArrayToRef(q.maxEmitBox,0,this.maxEmitBox)}}class K{get radius(){return this._radius}set radius(q){this._radius=q,this._buildHeight()}get angle(){return this._angle}set angle(q){this._angle=q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=U,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=q}startDirectionFunction(q,c,U,Q){Q?J.j.hc[0].X(U.gn).normalize():U.position.subtractToRef(q.getTranslation(),J.j.hc[0]).normalize();const s=(0,W.RandomRange)(0,this.directionRandomizer),g=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer);c.x=J.j.hc[0].x+s,c.y=J.j.hc[0].y+g,c.z=J.j.hc[0].z+X,c.normalize()}startPositionFunction(q,c,U,Q){const s=(0,W.RandomRange)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,W.RandomRange)(0,this.heightRange),g=1-g*g);let X=this._radius-(0,W.RandomRange)(0,this._radius*this.radiusRange);X*=g;const n=X*Math.sin(s),D=X*Math.cos(s),u=g*this._height;if(Q)return c.x=n,c.y=u,void(c.z=D);J.p.TransformCoordinatesFromFloatsToRef(n,u,D,q,c)}clone(){const q=new K(this._radius,this._angle,this.directionRandomizer);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat2("radius",this._radius,this.radiusRange),q.setFloat("coneAngle",this._angle),q.setFloat2("height",this._height,this.heightRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",2),q.addUniform("coneAngle",1),q.addUniform("height",2),q.addUniform("directionRandomizer",1)}getEffectDefines(){let q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(q+="\n#define CONEEMITTERSPAWNPOINT"),q}getClassName(){return"ConeParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this._radius,q.angle=this._angle,q.directionRandomizer=this.directionRandomizer,q.radiusRange=this.radiusRange,q.heightRange=this.heightRange,q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,q}parse(q){this.radius=q.radius,this.angle=q.angle,this.directionRandomizer=q.directionRandomizer,this.radiusRange=void 0!==q.radiusRange?q.radiusRange:1,this.heightRange=void 0!==q.radiusRange?q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==q.emitFromSpawnPointOnly&&q.emitFromSpawnPointOnly}}class r extends K{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0);super(q,c),this.direction1=U,this.direction2=Q}startDirectionFunction(q,c){const U=(0,W.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,W.RandomRange)(this.direction1.y,this.direction2.y),s=(0,W.RandomRange)(this.direction1.z,this.direction2.z);J.p.TransformNormalFromFloatsToRef(U,Q,s,q,c)}clone(){const q=new r(this.radius,this.angle,this.direction1,this.direction2);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.rc(),q.direction2=this.direction2.rc(),q}parse(q){super.parse(q),this.direction1.X(q.direction1),this.direction2.X(q.direction2)}}class H{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=q,this.height=c,this.radiusRange=U,this.directionRandomizer=Q,this._tempVector=J.p.Zero()}startDirectionFunction(q,c,U,Q,s){U.position.subtractToRef(q.getTranslation(),this._tempVector),this._tempVector.normalize(),J.p.TransformNormalToRef(this._tempVector,s,this._tempVector);const g=(0,W.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),Q?c.X(this._tempVector):J.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q,c)}startPositionFunction(q,c,U,Q){const s=(0,W.RandomRange)(-this.height/2,this.height/2),g=(0,W.RandomRange)(0,2*Math.PI),X=(0,W.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),n=Math.sqrt(X)*this.radius,D=n*Math.cos(g),u=n*Math.sin(g);Q?c.bc(D,s,u):J.p.TransformCoordinatesFromFloatsToRef(D,s,u,q,c)}clone(){const q=new H(this.radius,this.directionRandomizer);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.height=this.height,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.height=q.height,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class b extends H{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.p(0,1,0);super(q,c,U),this.direction1=Q,this.direction2=s}startDirectionFunction(q,c,U,Q){const s=(0,W.RandomRange)(this.direction1.x,this.direction2.x),g=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);Q?c.bc(s,g,X):J.p.TransformNormalFromFloatsToRef(s,g,X,q,c)}clone(){const q=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.rc(),q.direction2=this.direction2.rc(),q}parse(q){super.parse(q),J.p.FromArrayToRef(q.direction1,0,this.direction1),J.p.FromArrayToRef(q.direction2,0,this.direction2)}}class h{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=c,this.directionRandomizer=U}startDirectionFunction(q,c,U,Q){const s=U.position.eU(q.getTranslation()).normalize(),g=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer),n=(0,W.RandomRange)(0,this.directionRandomizer);s.x+=g,s.y+=X,s.z+=n,s.normalize(),Q?c.X(s):J.p.TransformNormalFromFloatsToRef(s.x,s.y,s.z,q,c)}startPositionFunction(q,c,U,Q){const s=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),g=(0,W.RandomRange)(0,1),X=(0,W.RandomRange)(0,2*Math.PI),n=Math.acos(2*g-1),D=s*Math.cos(X)*Math.sin(n),u=s*Math.cos(n),K=s*Math.sin(X)*Math.sin(n);Q?c.bc(D,Math.abs(u),K):J.p.TransformCoordinatesFromFloatsToRef(D,Math.abs(u),K,q,c)}clone(){const q=new h(this.radius,this.directionRandomizer);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class o{constructor(){this.direction1=new J.p(0,1,0),this.direction2=new J.p(0,1,0)}startDirectionFunction(q,c,U,Q){const s=(0,W.RandomRange)(this.direction1.x,this.direction2.x),g=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);Q?c.bc(s,g,X):J.p.TransformNormalFromFloatsToRef(s,g,X,q,c)}startPositionFunction(q,c,U,Q){Q?c.bc(0,0,0):J.p.TransformCoordinatesFromFloatsToRef(0,0,0,q,c)}clone(){const q=new o;return D.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.rc(),q.direction2=this.direction2.rc(),q}parse(q){J.p.FromArrayToRef(q.direction1,0,this.direction1),J.p.FromArrayToRef(q.direction2,0,this.direction2)}}class a{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=c,this.directionRandomizer=U}startDirectionFunction(q,c,U,Q){const s=U.position.eU(q.getTranslation()).normalize(),g=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer),n=(0,W.RandomRange)(0,this.directionRandomizer);s.x+=g,s.y+=X,s.z+=n,s.normalize(),Q?c.X(s):J.p.TransformNormalFromFloatsToRef(s.x,s.y,s.z,q,c)}startPositionFunction(q,c,U,Q){const s=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),g=(0,W.RandomRange)(0,1),X=(0,W.RandomRange)(0,2*Math.PI),n=Math.acos(2*g-1),D=s*Math.cos(X)*Math.sin(n),u=s*Math.cos(n),K=s*Math.sin(X)*Math.sin(n);Q?c.bc(D,u,K):J.p.TransformCoordinatesFromFloatsToRef(D,u,K,q,c)}clone(){const q=new a(this.radius,this.directionRandomizer);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class p extends a{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.p(0,1,0),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0);super(q),this.direction1=c,this.direction2=U}startDirectionFunction(q,c){const U=(0,W.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,W.RandomRange)(this.direction1.y,this.direction2.y),s=(0,W.RandomRange)(this.direction1.z,this.direction2.z);J.p.TransformNormalFromFloatsToRef(U,Q,s,q,c)}clone(){const q=new p(this.radius,this.direction1,this.direction2);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.rc(),q.direction2=this.direction2.rc(),q}parse(q){super.parse(q),this.direction1.X(q.direction1),this.direction2.X(q.direction2)}}class R{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(q,c,U,Q){const s=J.j.hc[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,U,s);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,U,s);const q=J.j.hc[1];s.subtractToRef(U.position,q),q.scaleToRef(1/U.lifeTime,s)}else s.set(0,0,0);Q?c.X(s):J.p.TransformNormalToRef(s,q,c)}startPositionFunction(q,c,U,Q){const s=J.j.hc[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,U,s):s.set(0,0,0),Q?c.X(s):J.p.TransformCoordinatesToRef(s,q,c)}clone(){const q=new R;return D.e.DeepCopy(this,q),q}applyToShader(q){}buildUniformLayout(q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.particlePositionGenerator=this.particlePositionGenerator,q.particleDestinationGenerator=this.particleDestinationGenerator,q}parse(q){q.particlePositionGenerator&&(this.particlePositionGenerator=q.particlePositionGenerator),q.particleDestinationGenerator&&(this.particleDestinationGenerator=q.particleDestinationGenerator)}}var I=U(11031);class t{get mesh(){return this._mesh}set mesh(q){this._mesh!==q&&(this._mesh=q,q?(this._indices=q.uc(),this._positions=q.getVerticesData(I.h.PositionKind),this._normals=q.getVerticesData(I.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=J.p.Zero(),this._mesh=null,this.direction1=new J.p(0,1,0),this.direction2=new J.p(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=q}startDirectionFunction(q,c,U,Q){if(this.useMeshNormalsForDirection&&this._normals)return void J.p.TransformNormalToRef(this._storedNormal,q,c);const s=(0,W.RandomRange)(this.direction1.x,this.direction2.x),g=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);Q?c.bc(s,g,X):J.p.TransformNormalFromFloatsToRef(s,g,X,q,c)}startPositionFunction(q,c,U,Q){if(!this._indices||!this._positions)return;const s=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),X=Math.random()*(1-g),n=1-g-X,W=this._indices[s],D=this._indices[s+1],u=this._indices[s+2],K=J.j.hc[0],r=J.j.hc[1],H=J.j.hc[2],b=J.j.hc[3];J.p.FromArrayToRef(this._positions,3*W,K),J.p.FromArrayToRef(this._positions,3*D,r),J.p.FromArrayToRef(this._positions,3*u,H),b.x=g*K.x+X*r.x+n*H.x,b.y=g*K.y+X*r.y+n*H.y,b.z=g*K.z+X*r.z+n*H.z,Q?c.bc(b.x,b.y,b.z):J.p.TransformCoordinatesFromFloatsToRef(b.x,b.y,b.z,q,c),this.useMeshNormalsForDirection&&this._normals&&(J.p.FromArrayToRef(this._normals,3*W,K),J.p.FromArrayToRef(this._normals,3*D,r),J.p.FromArrayToRef(this._normals,3*u,H),this._storedNormal.x=g*K.x+X*r.x+n*H.x,this._storedNormal.y=g*K.y+X*r.y+n*H.y,this._storedNormal.z=g*K.z+X*r.z+n*H.z)}clone(){const q=new t(this.mesh);return D.e.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var q;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.rc(),c.direction2=this.direction2.rc(),c.meshId=null===(q=this.mesh)||void 0===q?void 0:q.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(q,c){J.p.FromArrayToRef(q.direction1,0,this.direction1),J.p.FromArrayToRef(q.direction2,0,this.direction2),q.meshId&&c&&(this.mesh=c.getLastMeshById(q.meshId)),this.useMeshNormalsForDirection=q.useMeshNormalsForDirection}}class C{_isUbo(q){return void 0!==q.addUniform}constructor(q){this._isUbo(q)?(this.setMatrix3x3=q.updateMatrix3x3.bind(q),this.setMatrix2x2=q.updateMatrix2x2.bind(q),this.setFloat=q.updateFloat.bind(q),this.setFloat2=q.updateFloat2.bind(q),this.setFloat3=q.updateFloat3.bind(q),this.setFloat4=q.updateFloat4.bind(q),this.setFloatArray=q.updateFloatArray.bind(q),this.setArray=q.updateArray.bind(q),this.setIntArray=q.updateIntArray.bind(q),this.setMatrix=q.vc.bind(q),this.setMatrices=q.updateMatrices.bind(q),this.setVector3=q.updateVector3.bind(q),this.setVector4=q.updateVector4.bind(q),this.setColor3=q.updateColor3.bind(q),this.setColor4=q.updateColor4.bind(q),this.setDirectColor4=q.updateDirectColor4.bind(q),this.setInt=q.updateInt.bind(q),this.setInt2=q.updateInt2.bind(q),this.setInt3=q.updateInt3.bind(q),this.setInt4=q.updateInt4.bind(q)):(this.setMatrix3x3=q.setMatrix3x3.bind(q),this.setMatrix2x2=q.setMatrix2x2.bind(q),this.setFloat=q.setFloat.bind(q),this.setFloat2=q.setFloat2.bind(q),this.setFloat3=q.setFloat3.bind(q),this.setFloat4=q.setFloat4.bind(q),this.setFloatArray=q.setFloatArray.bind(q),this.setArray=q.setArray.bind(q),this.setIntArray=q.setIntArray.bind(q),this.setMatrix=q.setMatrix.bind(q),this.setMatrices=q.setMatrices.bind(q),this.setVector3=q.setVector3.bind(q),this.setVector4=q.setVector4.bind(q),this.setColor3=q.setColor3.bind(q),this.setColor4=q.setColor4.bind(q),this.setDirectColor4=q.setDirectColor4.bind(q),this.setInt=q.setInt.bind(q),this.setInt2=q.setInt2.bind(q),this.setInt3=q.setInt3.bind(q),this.setInt4=q.setInt4.bind(q))}}var i=U(10961);const F="gpuUpdateParticlesPixelShader",v="#version 300 es\nvoid main() {discard;}\n";i.c.ShadersStore[F]||(i.c.ShadersStore[F]=v);const Y="gpuUpdateParticlesVertexShader",k="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.c.ShadersStore[Y]||(i.c.ShadersStore[Y]=k);(0,X.f)("BABYLON.WebGL2ParticleSystem",class{constructor(q,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=q,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var q;return(null===(q=this._updateEffect)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof R&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=q,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new C(this._updateEffect)}createVertexBuffers(q,c){this._updateVAO.push(this._createUpdateVAO(q)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(q){return q}bindDrawBuffers(q,c,U){U?this._engine.bindBuffers(this._renderVertexBuffers,U,c):this._engine.bindVertexArrayObject(this._renderVAO[q],null)}preUpdateParticleBuffer(){const q=this._engine;if(this._engine.enableEffect(this._updateEffect),!q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(q,c,U){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[q],null);const J=this._engine;J.bindTransformFeedbackBuffer(c.getBuffer()),J.setRasterizerState(!1),J.beginTransformFeedback(!0),J.drawArraysType(3,0,U),J.endTransformFeedback(),J.setRasterizerState(!0),J.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let q=0;q<this._updateVAO.length;q++)this._engine.releaseVertexArrayObject(this._updateVAO[q]);this._updateVAO.length=0;for(let q=0;q<this._renderVAO.length;q++)this._engine.releaseVertexArrayObject(this._renderVAO[q]);this._renderVAO.length=0}_createUpdateVAO(q){const c={};c.position=q.createVertexBuffer("position",0,3);let U=3;c.age=q.createVertexBuffer("age",U,1),U+=1,c.size=q.createVertexBuffer("size",U,3),U+=3,c.life=q.createVertexBuffer("life",U,1),U+=1,c.seed=q.createVertexBuffer("seed",U,4),U+=4,c.direction=q.createVertexBuffer("direction",U,3),U+=3,this._parent.particleEmitterType instanceof R&&(c.initialPosition=q.createVertexBuffer("initialPosition",U,3),U+=3),this._parent._colorGradientsTexture||(c.color=q.createVertexBuffer("color",U,4),U+=4),this._parent._isBillboardBased||(c.initialDirection=q.createVertexBuffer("initialDirection",U,3),U+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",U,3),U+=3,c.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",U,3),U+=3),this._parent._angularSpeedGradientsTexture?(c.angle=q.createVertexBuffer("angle",U,1),U+=1):(c.angle=q.createVertexBuffer("angle",U,2),U+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=q.createVertexBuffer("cellIndex",U,1),U+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=q.createVertexBuffer("cellStartOffset",U,1),U+=1));const J=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),J}});class V{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3?arguments[3]:void 0;this._engine=q,this._label=J,this._engine._storageBuffers.push(this),this._create(c,U)}_create(q,c){this._bufferSize=q,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(q,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(q,c,U){this._buffer&&this._engine.updateStorageBuffer(this._buffer,q,c,U)}async read(q,c,U,J){return await this._engine.readFromStorageBuffer(this._buffer,q,c,U,J)}dispose(){const q=this._engine._storageBuffers,c=q.indexOf(this);-1!==c&&(q[c]=q[q.length-1],q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var O=U(11010),G=U(11019),S=U(11082),Z=U(11288),x=U(11414),z=U(10886),y=U(10980),M=U(11282);class T{constructor(){this._gpuTimeInFrameId=-1,this.counter=new M.e}_addDuration(q,c){q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=q):this.counter.addCount(c,!1))}}var m=U(10945);class d{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=q,this._engine=c,this.uniqueId=x.d.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new T),this._engine.getCaps().supportComputeShaders?J.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=U,this._options={bindingsMapping:{},defines:[],...J}):z.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):z.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=this._bindings[q];this._bindings[q]={type:U?0:4,object:c,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!J||J.object!==c||J.type!==this._bindings[q].type)}setStorageTexture(q,c){const U=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==c),this._bindings[q]={type:1,object:c,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setExternalTexture(q,c){const U=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==c),this._bindings[q]={type:6,object:c,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setVideoTexture(q,c){return!!c.externalTexture&&(this.setExternalTexture(q,c.externalTexture),!0)}setUniformBuffer(q,c){const U=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==c),this._bindings[q]={type:d._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setStorageBuffer(q,c){const U=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!U||U.object!==c),this._bindings[q]={type:d._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}setTextureSampler(q,c){const U=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!U||!c.compareSampler(U.object)),this._bindings[q]={type:5,object:c,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries}}isReady(){let q=this._effect;for(const Q in this._bindings){const q=this._bindings[Q],c=q.type,U=q.object;switch(c){case 0:case 4:case 1:if(!U.isReady())return!1;break;case 6:if(!U.isReady())return!1;break}}const c=[],U=this._shaderPath;if(this._options.defines)for(let Q=0;Q<this._options.defines.length;Q++)c.push(this._options.defines[Q]);const J=c.join("\n");return this._cachedDefines!==J&&(this._cachedDefines=J,q=this._engine.createComputeEffect(U,{defines:J,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=q),!!q.isReady()}dispatch(q,c,U){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,q,c,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const U=d._BufferIsDataBuffer(q)?q:q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,U,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const U=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(U.type){case 0:{const J=this._samplers[c],Q=U.object;var q;if(!J||!Q._texture||!J.compareSampler(Q._texture))this._samplers[c]=(new y.d).setParameters(Q.wrapU,Q.wrapV,Q.wrapR,Q.anisotropicFilteringLevel,Q._texture.samplingMode,null===(q=Q._texture)||void 0===q?void 0:q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const q=U.object;q.getBuffer()!==U.buffer&&(U.buffer=q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Q=>{(0,m.f)((()=>this.dispatch(q,c,U)),Q,void 0,J)}))}serialize(){const q=S.e.Serialize(this);q.options=this._options,q.shaderPath=this._shaderPath,q.XK={},q.textures={};for(const c in this._bindings){const U=this._bindings[c],J=U.object;switch(U.type){case 0:case 4:case 1:{const Q=J.serialize();Q&&(q.textures[c]=Q,q.XK[c]={type:U.type});break}}}return q}static Parse(q,c,U){const J=S.e.Parse((()=>new d(q.name,c.getEngine(),q.shaderPath,q.options)),q,c,U);for(const Q in q.textures){const s=q.XK[Q],g=Z.c.Parse(q.textures[Q],c,U);0===s.type?J.setTexture(Q,g):4===s.type?J.setTexture(Q,g,!1):J.setStorageTexture(Q,g)}return J}static _BufferIsDataBuffer(q){return void 0!==q.underlyingResource}}(0,O.d)([(0,G.N)()],d.prototype,"name",void 0),(0,O.d)([(0,G.N)()],d.prototype,"fastMode",void 0),(0,X.f)("BABYLON.ComputeShader",d);var e=U(11075);const B="gpuUpdateParticlesComputeShader",N="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.c.ShadersStoreWGSL[B]||(i.c.ShadersStoreWGSL[B]=N);(0,X.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(q,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=q,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var q;return(null===(q=this._updateComputeShader)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){var c;const U={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(U.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(U.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(U.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(U.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(U.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(U.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(U.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new d("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:U,defines:q.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new e.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new C(this._simParamsComputeShader)}createVertexBuffers(q,c){this._renderVertexBuffers.push(c)}createParticleBuffer(q){const c=new V(this._engine,4*q.length,11,"ComputeShaderParticleSystemBuffer");return c.update(q),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(q,c,U){this._engine.bindBuffers(this._renderVertexBuffers[q],U,c)}preUpdateParticleBuffer(){}updateParticleBuffer(q,c,U){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^q]),this._updateComputeShader.dispatch(Math.ceil(U/64))}releaseBuffers(){var q;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class P{constructor(q,c,U){this.gradient=q,this.color1=c,this.color2=U}getColorToRef(q){this.color2?g.e.LerpToRef(this.color1,this.color2,Math.random(),q):q.X(this.color1)}}class w{constructor(q,c){this.gradient=q,this.color=c}}class L{constructor(q,c,U){this.gradient=q,this.factor1=c,this.factor2=U}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class l{static GetCurrentGradient(q,c,U){if(c[0].gradient>q)return void U(c[0],c[0],1);for(let Q=0;Q<c.length-1;Q++){const J=c[Q],s=c[Q+1];if(q>=J.gradient&&q<=s.gradient){return void U(J,s,(q-J.gradient)/(s.gradient-J.gradient))}}const J=c.length-1;U(c[J],c[J],1)}}var j=U(10866),f=U(11321),A=U(10864);class E{constructor(q){this.particleSystem=q,this.position=J.p.Zero(),this.direction=J.p.Zero(),this.color=new g.e(0,0,0,0),this.colorStep=new g.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new J.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.e(0,0,0,0),this._currentColor2=new g.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=E._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let q=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,q=this._randomCellOffset):q+=this._randomCellOffset);const U=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let J;J=this._initialSpriteCellLoop?(0,W.Clamp)(q*c%this.lifeTime/this.lifeTime):(0,W.Clamp)(q*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+J*U|0}_inheritParticleInfoToSubEmitter(q){if(q.particleSystem.j.position){const c=q.particleSystem.j;if(c.position.X(this.position),q.inheritDirection){const q=J.j.hc[0];this.direction.normalizeToRef(q),c.setDirection(q,0,Math.PI/2)}}else{q.particleSystem.j.X(this.position)}this.direction.scaleToRef(q.inheritedVelocityAmount/2,J.j.hc[0]),q.particleSystem._inheritedVelocityOffset.X(J.j.hc[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const q of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(q)}_reset(){this.age=0,this.id=E._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(q){q.position.X(this.position),this._initialDirection?q._initialDirection?q._initialDirection.X(this._initialDirection):q._initialDirection=this._initialDirection.clone():q._initialDirection=null,q.direction.X(this.direction),this.gn&&(q.gn?q.gn.X(this.gn):q.gn=this.gn.clone()),q.color.X(this.color),q.colorStep.X(this.colorStep),q.lifeTime=this.lifeTime,q.age=this.age,q._randomCellOffset=this._randomCellOffset,q.size=this.size,q.scale.X(this.scale),q.angle=this.angle,q.angularSpeed=this.angularSpeed,q.particleSystem=this.particleSystem,q.cellIndex=this.cellIndex,q.id=this.id,q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(q._currentColorGradient=this._currentColorGradient,q._currentColor1.X(this._currentColor1),q._currentColor2.X(this._currentColor2)),this._currentSizeGradient&&(q._currentSizeGradient=this._currentSizeGradient,q._currentSize1=this._currentSize1,q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,q._currentAngularSpeed1=this._currentAngularSpeed1,q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(q._currentVelocityGradient=this._currentVelocityGradient,q._currentVelocity1=this._currentVelocity1,q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,q._currentLimitVelocity1=this._currentLimitVelocity1,q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(q._currentDragGradient=this._currentDragGradient,q._currentDrag1=this._currentDrag1,q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(q._initialStartSpriteCellId=this._initialStartSpriteCellId,q._initialEndSpriteCellId=this._initialEndSpriteCellId,q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(q.remapData&&this.remapData?q.remapData.X(this.remapData):q.remapData=new J.q(0,0,0,0)),this._randomNoiseCoordinates1&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.X(this._randomNoiseCoordinates1),q._randomNoiseCoordinates2.X(this._randomNoiseCoordinates2)):(q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}E._Count=0;var qq=U(11071),cq=(U(11226),U(11104)),Uq=U(11095),Jq=U(11383);function Qq(q,c){const U=(0,W.RandomRange)(0,1);g.e.LerpToRef(c.color1,c.color2,U,q.color),c.colorDead.subtractToRef(q.color,c._colorDiff),c._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}function sq(q,c){q._currentColorGradient=c._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.X(q.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.X(q.color)}function gq(q,c){const U=c._colorGradients;l.GetCurrentGradient(c._ratio,U,((c,U,J)=>{c!==q._currentColorGradient&&(q._currentColor1.X(q._currentColor2),U.getColorToRef(q._currentColor2),q._currentColorGradient=c),g.e.LerpToRef(q._currentColor1,q._currentColor2,J,q.color)}))}function Xq(q,c){q.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),q.color.addInPlace(c._scaledColorStep),q.color.a<0&&(q.color.a=0)}function nq(q,c){l.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,U,J)=>{c!==q._currentAngularSpeedGradient&&(q._currentAngularSpeed1=q._currentAngularSpeed2,q._currentAngularSpeed2=U.getFactor(),q._currentAngularSpeedGradient=c),q.angularSpeed=(0,W.Lerp)(q._currentAngularSpeed1,q._currentAngularSpeed2,J)}))}function Wq(q,c){q.angle+=q.angularSpeed*c._scaledUpdateSpeed}function Dq(q,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,q.direction,q,c.isLocal,c._emitterInverseWorldMatrix)}function uq(q,c){c.startDirectionFunction(c._emitterWorldMatrix,q.direction,q,c.isLocal)}function Kq(q,c){q._currentVelocityGradient=c._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?q._currentVelocity2=c._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1}function rq(q,c){q._currentLimitVelocityGradient=c._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?q._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1}function Hq(q,c){l.GetCurrentGradient(c._ratio,c._velocityGradients,((U,J,Q)=>{U!==q._currentVelocityGradient&&(q._currentVelocity1=q._currentVelocity2,q._currentVelocity2=J.getFactor(),q._currentVelocityGradient=U),c._directionScale*=(0,W.Lerp)(q._currentVelocity1,q._currentVelocity2,Q)}))}function bq(q,c){l.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((U,J,Q)=>{U!==q._currentLimitVelocityGradient&&(q._currentLimitVelocity1=q._currentLimitVelocity2,q._currentLimitVelocity2=J.getFactor(),q._currentLimitVelocityGradient=U);const s=(0,W.Lerp)(q._currentLimitVelocity1,q._currentLimitVelocity2,Q);q.direction.length()>s&&q.direction.scaleInPlace(c.limitVelocityDamping)}))}function hq(q,c){q.direction.scaleToRef(c._directionScale,c._scaledDirection)}function oq(q,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,q.position,q,c.isLocal)}function aq(q,c){c.startPositionFunction(c._emitterWorldMatrix,q.position,q,c.isLocal)}function pq(q,c){q.gn?q.gn.X(q.position):q.gn=q.position.clone(),J.p.TransformCoordinatesToRef(q.gn,c._emitterWorldMatrix,q.position)}function Rq(q,c){c.isLocal&&q.gn?(q.gn.addInPlace(c._scaledDirection),J.p.TransformCoordinatesToRef(q.gn,c._emitterWorldMatrix,q.position)):q.position.addInPlace(c._scaledDirection)}function Iq(q,c){q._currentDragGradient=c._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),c._dragGradients.length>1?q._currentDrag2=c._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1}function tq(q,c){l.GetCurrentGradient(c._ratio,c._dragGradients,((U,J,Q)=>{U!==q._currentDragGradient&&(q._currentDrag1=q._currentDrag2,q._currentDrag2=J.getFactor(),q._currentDragGradient=U);const s=(0,W.Lerp)(q._currentDrag1,q._currentDrag2,Q);c._scaledDirection.scaleInPlace(1-s)}))}function Cq(q,c){q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.bc(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.bc(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new J.p(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new J.p(Math.random(),Math.random(),Math.random()))}function iq(q,c){const U=c._noiseTextureData,Q=c._noiseTextureSize;if(U&&Q&&q._randomNoiseCoordinates1){const s=c._fetchR(q._randomNoiseCoordinates1.x,q._randomNoiseCoordinates1.y,Q.width,Q.height,U),g=c._fetchR(q._randomNoiseCoordinates1.z,q._randomNoiseCoordinates2.x,Q.width,Q.height,U),X=c._fetchR(q._randomNoiseCoordinates2.y,q._randomNoiseCoordinates2.z,Q.width,Q.height,U),n=J.j.hc[0],W=J.j.hc[1];n.bc((2*s-1)*c.noiseStrength.x,(2*g-1)*c.noiseStrength.y,(2*X-1)*c.noiseStrength.z),n.scaleToRef(c._tempScaledUpdateSpeed,W),q.direction.addInPlace(W)}}function Fq(q,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),q.direction.addInPlace(c._scaledGravity)}function vq(q,c){q.size=(0,W.RandomRange)(c.minSize,c.maxSize),q.scale.bc((0,W.RandomRange)(c.minScaleX,c.maxScaleX),(0,W.RandomRange)(c.minScaleY,c.maxScaleY))}function Yq(q,c){q._currentSizeGradient=c._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,c._sizeGradients.length>1?q._currentSize2=c._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1,q.scale.bc((0,W.RandomRange)(c.minScaleX,c.maxScaleX),(0,W.RandomRange)(c.minScaleY,c.maxScaleY))}function kq(q,c){const U=c._actualFrame/c.targetStopDuration;l.GetCurrentGradient(U,c._startSizeGradients,((U,J,Q)=>{U!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=J.getFactor(),c._currentStartSizeGradient=U);const s=(0,W.Lerp)(c._currentStartSize1,c._currentStartSize2,Q);q.scale.scaleInPlace(s)}))}function Vq(q,c){l.GetCurrentGradient(c._ratio,c._sizeGradients,((c,U,J)=>{c!==q._currentSizeGradient&&(q._currentSize1=q._currentSize2,q._currentSize2=U.getFactor(),q._currentSizeGradient=c),q.size=(0,W.Lerp)(q._currentSize1,q._currentSize2,J)}))}function Oq(q,c){q.remapData=new J.q(0,1,0,1)}function Gq(q,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&l.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,U,J)=>{const Q=(0,W.Lerp)(c.factor1,U.factor1,J),s=(0,W.Lerp)(c.factor2,U.factor2,J);q.remapData.x=Q,q.remapData.y=s-Q})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&l.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,U,J)=>{const Q=(0,W.Lerp)(c.factor1,U.factor1,J),s=(0,W.Lerp)(c.factor2,U.factor2,J);q.remapData.z=Q,q.remapData.w=s-Q}))}function Sq(q,c){const U=(0,W.Clamp)(c._actualFrame/c.targetStopDuration);l.GetCurrentGradient(U,c._lifeTimeGradients,((c,J)=>{const Q=c,s=J,g=Q.getFactor(),X=s.getFactor(),n=(U-Q.gradient)/(s.gradient-Q.gradient);q.lifeTime=(0,W.Lerp)(g,X,n)})),c._emitPower=(0,W.RandomRange)(c.minEmitPower,c.maxEmitPower)}function Zq(q,c){q.lifeTime=(0,W.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,W.RandomRange)(c.minEmitPower,c.maxEmitPower)}function xq(q,c){0===c._emitPower?(q._initialDirection?q._initialDirection.X(q.direction):q._initialDirection=q.direction.clone(),q.direction.set(0,0,0)):(q._initialDirection=null,q.direction.scaleInPlace(c._emitPower)),q.direction.addInPlace(c._inheritedVelocityOffset)}function zq(q,c){q.angularSpeed=(0,W.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),q.angle=(0,W.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function yq(q,c){q._currentAngularSpeedGradient=c._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,c._angularSpeedGradients.length>1?q._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1,q.angle=(0,W.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function Mq(q,c){q._initialStartSpriteCellId=c.startSpriteCellID,q._initialEndSpriteCellId=c.endSpriteCellID,q._initialSpriteCellLoop=c.spriteCellLoop}function Tq(q,c){q.previousItem=c.previousItem,q.nextItem=c,c.previousItem&&(c.previousItem.nextItem=q),c.previousItem=q}function mq(q,c){q.previousItem=c,q.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=q),c.nextItem=q}function dq(q,c){let U=c;for(;U.nextItem;)U=U.nextItem;q.previousItem=U,q.nextItem=U.nextItem,U.nextItem=q}function eq(q){q.previousItem&&(q.previousItem.nextItem=q.nextItem),q.nextItem&&(q.nextItem.previousItem=q.previousItem)}class Bq extends n{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(q){this._startDirectionFunction!==q&&(this._startDirectionFunction=q,this._directionProcessing.process=q?uq:Dq)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(q){this._startPositionFunction!==q&&(this._startPositionFunction=q,this._positionCreation.process=q?aq:oq)}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(q){this._useRampGradients!==q&&(this._useRampGradients=q,this._resetEffect(),q?(this._rampCreation={process:Oq,previousItem:null,nextItem:null},mq(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Gq,previousItem:null,nextItem:null},mq(this._remapGradientProcessing,this._gravityProcessing)):(eq(this._rampCreation),eq(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(q){this._isLocal!==q&&(this._isLocal=q,q?(this._isLocalCreation={process:pq,previousItem:null,nextItem:null},mq(this._isLocalCreation,this._positionCreation)):eq(this._isLocalCreation))}get particles(){return this.UK}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q,q?(this._sheetCreation={process:Mq,previousItem:null,nextItem:null},mq(this._sheetCreation,this._colorCreation)):eq(this._sheetCreation),this._reset())}getActiveCount(){return this.UK.length}getClassName(){return"Lc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[c])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new qq.c(this._engine),this._customWrappers[c].effect=q,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new j.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){if(this.noiseTexture!==q){if(this._noiseTexture=q,!q)return eq(this._noiseCreation),void eq(this._noiseProcessing);this._noiseCreation={process:Cq,previousItem:null,nextItem:null},mq(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:iq,previousItem:null,nextItem:null},mq(this._noiseProcessing,this._positionProcessing)}}constructor(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(q),this._emitterInverseWorldMatrix=J.d.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new J.p,this.Cc=new j.e,this.onStoppedObservable=new j.e,this.onStartedObservable=new j.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.UK=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.e(0,0,0,0),this._colorDiff=new g.e(0,0,0,0),this._scaledDirection=J.p.Zero(),this._scaledGravity=J.p.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=q=>{},this.recycleParticle=q=>{const c=this.UK.pop();c!==q&&c.copyTo(q),this._stockParticles.push(c)},this._createParticle=()=>{let q;return 0!==this._stockParticles.length?(q=this._stockParticles.pop(),q._reset()):q=new E(this),this._prepareParticle(q),q},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=X,U&&"Scene"!==U.getClassName()?(this._engine=U,this.defaultProjectionMatrix=J.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=U||A.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qK.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Zq,previousItem:null,nextItem:null},this._positionCreation={process:oq,previousItem:null,nextItem:null},mq(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Dq,previousItem:null,nextItem:null},mq(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:xq,previousItem:null,nextItem:null},mq(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:vq,previousItem:null,nextItem:null},mq(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:zq,previousItem:null,nextItem:null},mq(this._angleCreation,this._sizeCreation),this._colorCreation={process:Qq,previousItem:null,nextItem:null},mq(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,n||(this._colorProcessing={process:Xq,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Wq,previousItem:null,nextItem:null},mq(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:hq,previousItem:null,nextItem:null},mq(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Rq,previousItem:null,nextItem:null},mq(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Fq,previousItem:null,nextItem:null},mq(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=s,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new qq.c(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new u,this.updateFunction=q=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((q=>{this._noiseTextureData=q})));const U=q===this.UK;for(let J=0;J<q.length;J++){const c=q[J];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Q=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const q=c.age-Q,U=c.lifeTime-Q;this._tempScaledUpdateSpeed=U*this._tempScaledUpdateSpeed/q,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let s=this._updateQueueStart;for(;s;)s.process(c,this),s=s.nextItem;if(this._isAnimationSheetEnabled&&!n&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const q of c._attachedSubEmitters)q.particleSystem.disposeOnStop=!0,q.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),U&&J--}else;}}}serialize(q){throw new Error("Method not implemented.")}clone(q,c){throw new Error("Method not implemented.")}_addFactorGradient(q,c,U,J){const Q=new L(c,U,J);q.push(Q),q.sort(((q,c)=>q.gradient<c.gradient?-1:q.gradient>c.gradient?1:0))}_removeFactorGradient(q,c){if(!q)return;let U=0;for(const J of q){if(J.gradient===c){q.splice(U,1);break}U++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Sq:this._lifeTimeCreation.process=Zq}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:kq,previousItem:null,nextItem:null},mq(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(eq(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this.targetStopDuration!==q&&(this._targetStopDuration=q,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(q,c,U){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,q,c,U),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(q){return this._removeFactorGradient(this._lifeTimeGradients,q),this._syncLifeTimeCreation(),this}addSizeGradient(q,c,U){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Yq,this._sizeGradientProcessing={process:Vq,previousItem:null,nextItem:null},Tq(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,q,c,U),this}removeSizeGradient(q){var c;return this._removeFactorGradient(this._sizeGradients,q),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(eq(this._sizeGradientProcessing),this._sizeCreation.process=vq),this}addColorRemapGradient(q,c,U){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,q,c,U),this}removeColorRemapGradient(q){return this._removeFactorGradient(this._colorRemapGradients,q),this}addAlphaRemapGradient(q,c,U){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,q,c,U),this}removeAlphaRemapGradient(q){return this._removeFactorGradient(this._alphaRemapGradients,q),this}addAngularSpeedGradient(q,c,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=yq,this._angularSpeedGradientProcessing={process:nq,previousItem:null,nextItem:null},Tq(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,q,c,U),this}removeAngularSpeedGradient(q){var c;return this._removeFactorGradient(this._angularSpeedGradients,q),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=zq,eq(this._angularSpeedGradientProcessing)),this}addVelocityGradient(q,c,U){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Kq,previousItem:null,nextItem:null},mq(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Hq,previousItem:null,nextItem:null},Tq(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,q,c,U),this}removeVelocityGradient(q){var c;return this._removeFactorGradient(this._velocityGradients,q),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(eq(this._velocityCreation),eq(this._velocityGradientProcessing)),this}addLimitVelocityGradient(q,c,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:rq,previousItem:null,nextItem:null},mq(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:bq,previousItem:null,nextItem:null},mq(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,q,c,U),this}removeLimitVelocityGradient(q){var c;return this._removeFactorGradient(this._limitVelocityGradients,q),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(eq(this._limitVelocityCreation),eq(this._limitVelocityGradientProcessing)),this}addDragGradient(q,c,U){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Iq,previousItem:null,nextItem:null},Tq(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:tq,previousItem:null,nextItem:null},Tq(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,q,c,U),this}removeDragGradient(q){var c;return this._removeFactorGradient(this._dragGradients,q),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(eq(this._dragCreation),eq(this._dragGradientProcessing)),this}addEmitRateGradient(q,c,U){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,q,c,U),this}removeEmitRateGradient(q){return this._removeFactorGradient(this._emitRateGradients,q),this}addStartSizeGradient(q,c,U){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,q,c,U),this._syncStartSizeCreation(),this}removeStartSizeGradient(q){return this._removeFactorGradient(this._startSizeGradients,q),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const q=new Uint8Array(4*this._rawTextureWidth),c=g.g.Nc[0];for(let U=0;U<this._rawTextureWidth;U++){const J=U/this._rawTextureWidth;l.GetCurrentGradient(J,this._rampGradients,((J,Q,s)=>{g.c.LerpToRef(J.color,Q.color,s,c),q[4*U]=255*c.r,q[4*U+1]=255*c.g,q[4*U+2]=255*c.b,q[4*U+3]=255}))}this._rampGradientsTexture=f.e.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((q,c)=>q.gradient<c.gradient?-1:q.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(q,c){this._rampGradients||(this._rampGradients=[]);const U=new w(q,c);return this._rampGradients.push(U),this._syncRampGradientTexture(),this}removeRampGradient(q){return this._removeGradientAndTexture(q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(q,c,U){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=sq,this._colorProcessing.process=gq);const J=new P(q,c,U);return this._colorGradients.push(J),this._colorGradients.sort(((q,c)=>q.gradient<c.gradient?-1:q.gradient>c.gradient?1:0)),this}removeColorGradient(q){if(!this._colorGradients)return this;let c=0;for(const U of this._colorGradients){if(U.gradient===q){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=Qq,this._colorProcessing.process=Xq),this}resetDrawCache(){if(this._drawWrappers){for(const q of this._drawWrappers)if(q)for(const c of q)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(q,c,U,J,Q){return Q[4*(((q=.5*Math.abs(q)+.5)*U%U|0)+((c=.5*Math.abs(c)+.5)*J%J|0)*U)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const q=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new I.e(q,this._vertexData,!0,c);let U=0;const J=this._vertexBuffer.createVertexBuffer(I.h.PositionKind,U,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[I.h.PositionKind]=J,U+=3;const Q=this._vertexBuffer.createVertexBuffer(I.h.ColorKind,U,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[I.h.ColorKind]=Q,U+=4;const s=this._vertexBuffer.createVertexBuffer("angle",U,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=s,U+=1;const g=this._vertexBuffer.createVertexBuffer("size",U,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,U+=2,this._isAnimationSheetEnabled){const q=this._vertexBuffer.createVertexBuffer("cellIndex",U,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=q,U+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const q=this._vertexBuffer.createVertexBuffer("direction",U,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=q,U+=3}if(this._useRampGradients){const q=this._vertexBuffer.createVertexBuffer("remapData",U,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=q,U+=4}let X;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new I.e(q,c,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",U,2,this._vertexBufferSize,this._useInstancing),U+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const q=[],c=[];let U=0;for(let J=0;J<this._capacity;J++)q.push(U),q.push(U+1),q.push(U+2),q.push(U),q.push(U+2),q.push(U+3),c.push(U,U+1,U+1,U+2,U+2,U+3,U+3,U,U,U+3),U+=4;this._indexBuffer=this._engine.createIndexBuffer(q),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(q)setTimeout((()=>{this.start(0)}),q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.j)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.j.o(!0);const q=this.noiseTexture;if(q&&q.onGeneratedObservable)q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),q.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(q))}_postStop(q){}reset(){this._stockParticles.length=0,this.UK.length=0}_appendParticleVertex(q,c,U,Q){let s=q*this._vertexBufferSize;if(this._vertexData[s++]=c.position.x+this.pW.x,this._vertexData[s++]=c.position.y+this.pW.y,this._vertexData[s++]=c.position.z+this.pW.z,this._vertexData[s++]=c.color.r,this._vertexData[s++]=c.color.g,this._vertexData[s++]=c.color.b,this._vertexData[s++]=c.color.a,this._vertexData[s++]=c.angle,this._vertexData[s++]=c.scale.x*c.size,this._vertexData[s++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[s++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[s++]=c.direction.x,this._vertexData[s++]=c.direction.y,this._vertexData[s++]=c.direction.z);else if(c._initialDirection){let q=c._initialDirection;this.isLocal&&(J.p.TransformNormalToRef(q,this._emitterWorldMatrix,J.j.hc[0]),q=J.j.hc[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[s++]=q.x,this._vertexData[s++]=q.y,this._vertexData[s++]=q.z}else{let q=c.direction;this.isLocal&&(J.p.TransformNormalToRef(q,this._emitterWorldMatrix,J.j.hc[0]),q=J.j.hc[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[s++]=q.x,this._vertexData[s++]=q.y,this._vertexData[s++]=q.z}this._useRampGradients&&c.remapData&&(this._vertexData[s++]=c.remapData.x,this._vertexData[s++]=c.remapData.y,this._vertexData[s++]=c.remapData.z,this._vertexData[s++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===U?U=this._epsilon:1===U&&(U=1-this._epsilon),0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon)),this._vertexData[s++]=U,this._vertexData[s++]=Q)}_prepareParticle(q){}_createNewOnes(q){let c;for(let U=0;U<q&&this.UK.length!==this._capacity;U++){c=this._createParticle(),this.UK.push(c);let q=this._createQueueStart;for(;q;)q.process(c,this),q=q.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(q){if(this._alive=this.UK.length>0,this.j.position){const q=this.j;this._emitterWorldMatrix=q.getWorldMatrix()}else{const q=this.j;this._emitterWorldMatrix=J.d.Translation(q.x,q.y,q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.UK),this._createNewOnes(q)}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=[I.h.PositionKind,I.h.ColorKind,"angle","offset","size"];return q&&J.push("cellIndex"),c||J.push("direction"),U&&J.push("remapData"),J}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cq.b)(J),q&&J.push("particlesInfos"),c&&J.push("logarithmicDepthConstant"),U&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cq.h)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&q.push("#define FOG")),this._isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),c===n.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case 2:q.push("#define BILLBOARDY");break;case 8:case 9:q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:q.push("#define BILLBOARDMODE_ALL")}U&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,c,U){c.push(...Bq._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),q.push(...Bq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),U.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Jq.c)(q,this._imageProcessingConfigurationDefines),(0,Jq.b)(U,this._imageProcessingConfigurationDefines))}_getWrapper(q){const c=this._getCustomDrawWrapper(q);if(null!==c&&void 0!==c&&c.effect)return c;const U=[];this.fillDefines(U,q);const J=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Q=this._drawWrappers[J];Q||(Q=this._drawWrappers[J]=[]);let s=Q[q];s||(s=new qq.c(this._engine),s.drawContext&&(s.drawContext.useInstancing=this._useInstancing),Q[q]=s);const g=U.join("\n");if(s.defines!==g){const q=[],c=[],U=[];this.fillUniformsAttributesAndSamplerNames(c,q,U),s.setEffect(this._engine.createEffect("particles",q,c,U,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return s}animate(){var q;let c,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!U&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(U?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;l.GetCurrentGradient(c,this._emitRateGradients,((c,U,J)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=U.getFactor(),this._currentEmitRateGradient=c),q=(0,W.Lerp)(this._currentEmitRate1,this._currentEmitRate2,J)}))}c=q*this._scaledUpdateSpeed|0,this._newPartsExcess+=q*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!U){let q=0;for(let c=0;c<this.UK.length;c++){const U=this.UK[c];this._appendParticleVertices(q,U),q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.UK.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(q,c){this._appendParticleVertex(q++,c,0,0),this._useInstancing||(this._appendParticleVertex(q++,c,1,0),this._appendParticleVertex(q++,c,1,1),this._appendParticleVertex(q++,c,0,1))}rebuild(){var q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(q=this._spriteBuffer)||void 0===q||q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Bq.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(U.bind(U,12435)),Promise.resolve().then(U.bind(U,12386))])):await Promise.all([Promise.resolve().then(U.bind(U,12375)),Promise.resolve().then(U.bind(U,12358))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==n.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(n.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(n.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(q){const c=this._getWrapper(q),U=c.effect,Q=this._engine;Q.enableEffect(c);const s=this.defaultViewMatrix??this._scene.getViewMatrix();if(U.setTexture("diffuseSampler",this.particleTexture),U.setMatrix("view",s),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();U.setFloat3("particlesInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,this.spriteCellWidth/q.width)}if(U.setVector2("translationPivot",this.translationPivot),U.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;U.setVector3("eyePosition",q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),U.setTexture("rampSampler",this._rampGradientsTexture));const g=U.defines;var X,n,W,D,u,K;(this._scene&&((0,cq.c)(U,this,this._scene),this.applyFog&&(0,Uq.f)(this._scene,void 0,U)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(s.invertToRef(J.j.Matrix[0]),U.setMatrix("invView",J.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?Q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,U):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,U)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Q.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBuffer:this._indexBuffer,U):Q.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:null,U);(this.useLogarithmicDepth&&this._scene&&(0,Uq.m)(g,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),this._useInstancing)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?Q.drawElementsType(6,0,10,this.UK.length):Q.drawArraysType(7,0,4,this.UK.length):null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?Q.drawElementsType(1,0,10*this.UK.length):Q.drawElementsType(0,0,6*this.UK.length);return this.UK.length}render(){if(!this.isReady()||!this.UK.length)return 0;const q=this._engine;q.setState&&(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0));let c=0;return c=this.blendMode===n.BLENDMODE_MULTIPLYADD?this._render(n.BLENDMODE_MULTIPLY)+this._render(n.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const q=this._scene.qK.indexOf(this);q>-1&&this._scene.qK.splice(q,1),this._scene._activeParticleSystems.dispose()}this.Cc.notifyObservers(this),this.Cc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Bq.ForceGLSL=!1;var Nq,Pq=U(10910);!function(q){q[q.ATTACHED=0]="ATTACHED",q[q.END=1]="END"}(Nq||(Nq={}));class wq{constructor(q){if(this.particleSystem=q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!q.j||!q.j.dispose){const c=(0,X.d)("BABYLON.AbstractMesh");q.j=new c("SubemitterSystemEmitter",q.Cq()),q._disposeEmitterOnDispose=!0}}clone(){let q=this.particleSystem.j;if(q){if(q instanceof J.p)q=q.clone();else if(-1!==q.getClassName().indexOf("Mesh")){q=new((0,X.d)("BABYLON.Mesh"))("",q.Cq()),q.isVisible=!1}}else q=new J.p;const c=new wq(this.particleSystem.clone(this.particleSystem.name,q));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(q),c}static _ParseParticleSystem(q,c,U){throw(0,Pq.d)("ParseParticle")}static Parse(q,c,U){const J=q.particleSystem,Q=new wq(wq._ParseParticleSystem(J,c,U,!0));return Q.type=q.type,Q.inheritDirection=q.inheritDirection,Q.inheritedVelocityAmount=q.inheritedVelocityAmount,Q.particleSystem._isSubEmitter=!0,Q}dispose(){this.particleSystem.dispose()}}var Lq=U(10954);function lq(q,c){const U=new o;return U.direction1=q,U.direction2=c,U}function jq(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fq(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Aq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.p(0,1,0),U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0);return new p(q,c,U)}function Eq(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function qc(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.p(0,1,0);return new b(q,c,U,Q,s)}function cc(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new K(q,c)}function Uc(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0);return new r(q,c,U,Q)}const Jc=J.p.Zero(),Qc=J.p.Zero(),sc=J.p.Zero();class gc{constructor(){this.strength=0,this.position=J.p.Zero()}_processParticle(q,c){this.position.subtractToRef(q.position,Jc);const U=Jc.lengthSquared()+1;Jc.normalize().scaleToRef(this.strength/U,Qc),Qc.scaleToRef(c._tempScaledUpdateSpeed,sc),q.direction.addInPlace(sc)}serialize(){return{position:this.position.rc(),strength:this.strength}}}class Xc extends Bq{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const U of this._subEmitters[c])if(1===U.type){const c=U.clone();q._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(q,c){const U=lq(q,c);return this.particleEmitterType=U,U}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q,this._flowMapUpdate&&(eq(this._flowMapUpdate),this._flowMapUpdate=null),q&&(this._flowMapUpdate={process:q=>{var c;const U=null===(c=this.Cq())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(q,this.flowMapStrength*this._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null},mq(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(q){this._attractors.push(q),1===this._attractors.length&&(this._attractorUpdate={process:q=>{for(const c of this._attractors)c._processParticle(q,this)},previousItem:null,nextItem:null},mq(this._attractorUpdate,this._directionProcessing))}removeAttractor(q){const c=this._attractors.indexOf(q);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&eq(this._attractorUpdate)}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(q)}createHemisphericEmitter(){const q=jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=fq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Aq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=Eq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.p(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=Uc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,c,U,J){const Q=new u;return this.particleEmitterType=Q,this.direction1=q,this.direction2=c,this.minEmitBox=U,this.maxEmitBox=J,Q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const q of this.subEmitters)q instanceof Xc?this._subEmitters.push([new wq(q)]):q instanceof wq?this._subEmitters.push([q]):q instanceof Array&&this._subEmitters.push(q)}_stopSubEmitters(){if(this.activeSubSystems){for(const q of this.activeSubSystems)q.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==q&&this._rootParticleSystem.activeSubSystems.splice(q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(q){q&&this._stopSubEmitters()}_prepareParticle(q){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];q._attachedSubEmitters=[];for(const U of c)if(0===U.type){const c=U.clone();q._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),q&&this.particles)for(const U of this.particles)if(U._attachedSubEmitters)for(let q=U._attachedSubEmitters.length-1;q>=0;q-=1)U._attachedSubEmitters[q].dispose();if(c&&this.activeSubSystems)for(let U=this.activeSubSystems.length-1;U>=0;U-=1)this.activeSubSystems[U].dispose();if(this._subEmitters&&this._subEmitters.length){for(let q=0;q<this._subEmitters.length;q++)for(const c of this._subEmitters[q])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(q,c,U,Q){let s;s=U instanceof Lq.d?null:U;const n=(0,X.d)("BABYLON.Texture");if(n&&s&&(q.texture?c.particleTexture=n.Parse(q.texture,s,Q):q.textureName&&(c.particleTexture=new n(Q+q.textureName,s,!1,void 0===q.invertY||q.invertY),c.particleTexture.name=q.textureName)),q.emitterId||0===q.emitterId||void 0!==q.j?q.emitterId&&s?c.j=s.getLastMeshById(q.emitterId):c.j=J.p.Ic(q.j):c.j=J.p.Zero(),c.isLocal=!!q.isLocal,void 0!==q.renderingGroupId&&(c.renderingGroupId=q.renderingGroupId),void 0!==q.isBillboardBased&&(c.isBillboardBased=q.isBillboardBased),void 0!==q.billboardMode&&(c.billboardMode=q.billboardMode),void 0!==q.useLogarithmicDepth&&(c.useLogarithmicDepth=q.useLogarithmicDepth),q.animations){for(let U=0;U<q.animations.length;U++){const J=q.animations[U],Q=(0,X.d)("BABYLON.Animation");Q&&c.animations.push(Q.Parse(J))}c.beginAnimationOnStart=q.beginAnimationOnStart,c.beginAnimationFrom=q.beginAnimationFrom,c.beginAnimationTo=q.beginAnimationTo,c.beginAnimationLoop=q.beginAnimationLoop}if(q.autoAnimate&&s&&s.beginAnimation(c,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),c.startDelay=0|q.startDelay,c.minAngularSpeed=q.minAngularSpeed,c.maxAngularSpeed=q.maxAngularSpeed,c.minSize=q.minSize,c.maxSize=q.maxSize,q.minScaleX&&(c.minScaleX=q.minScaleX,c.maxScaleX=q.maxScaleX,c.minScaleY=q.minScaleY,c.maxScaleY=q.maxScaleY),void 0!==q.preWarmCycles&&(c.preWarmCycles=q.preWarmCycles,c.preWarmStepOffset=q.preWarmStepOffset),void 0!==q.minInitialRotation&&(c.minInitialRotation=q.minInitialRotation,c.maxInitialRotation=q.maxInitialRotation),c.minLifeTime=q.minLifeTime,c.maxLifeTime=q.maxLifeTime,c.minEmitPower=q.minEmitPower,c.maxEmitPower=q.maxEmitPower,c.emitRate=q.emitRate,c.gravity=J.p.Ic(q.gravity),q.noiseStrength&&(c.noiseStrength=J.p.Ic(q.noiseStrength)),c.color1=g.e.Ic(q.color1),c.color2=g.e.Ic(q.color2),c.colorDead=g.e.Ic(q.colorDead),c.updateSpeed=q.updateSpeed,c.targetStopDuration=q.targetStopDuration,c.blendMode=q.blendMode,q.colorGradients)for(const J of q.colorGradients)c.addColorGradient(J.gradient,g.e.Ic(J.color1),J.color2?g.e.Ic(J.color2):void 0);if(q.rampGradients){for(const U of q.rampGradients)c.addRampGradient(U.gradient,g.c.Ic(U.color));c.useRampGradients=q.useRampGradients}if(q.colorRemapGradients)for(const J of q.colorRemapGradients)c.addColorRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.alphaRemapGradients)for(const J of q.alphaRemapGradients)c.addAlphaRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.sizeGradients)for(const J of q.sizeGradients)c.addSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.angularSpeedGradients)for(const J of q.angularSpeedGradients)c.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.velocityGradients)for(const J of q.velocityGradients)c.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.dragGradients)for(const J of q.dragGradients)c.addDragGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.emitRateGradients)for(const J of q.emitRateGradients)c.addEmitRateGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.startSizeGradients)for(const J of q.startSizeGradients)c.addStartSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.lifeTimeGradients)for(const J of q.lifeTimeGradients)c.addLifeTimeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(q.limitVelocityGradients){for(const U of q.limitVelocityGradients)c.addLimitVelocityGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);c.limitVelocityDamping=q.limitVelocityDamping}if(q.noiseTexture&&s){const U=(0,X.d)("BABYLON.ProceduralTexture");c.noiseTexture=U.Parse(q.noiseTexture,s,Q)}let W;if(q.particleEmitterType){switch(q.particleEmitterType.type){case"SphereParticleEmitter":W=new a;break;case"SphereDirectedParticleEmitter":W=new p;break;case"ConeEmitter":case"ConeParticleEmitter":W=new K;break;case"ConeDirectedParticleEmitter":W=new r;break;case"CylinderParticleEmitter":W=new H;break;case"CylinderDirectedParticleEmitter":W=new b;break;case"HemisphericParticleEmitter":W=new h;break;case"PointParticleEmitter":W=new o;break;case"MeshParticleEmitter":W=new t;break;case"CustomParticleEmitter":W=new R;break;default:W=new u}W.parse(q.particleEmitterType,s)}else W=new u,W.parse(q,s);c.particleEmitterType=W,c.startSpriteCellID=q.startSpriteCellID,c.endSpriteCellID=q.endSpriteCellID,c.spriteCellLoop=q.spriteCellLoop??!0,c.spriteCellWidth=q.spriteCellWidth,c.spriteCellHeight=q.spriteCellHeight,c.spriteCellChangeSpeed=q.spriteCellChangeSpeed,c.spriteRandomStartCell=q.spriteRandomStartCell,c.disposeOnStop=q.disposeOnStop??!1,c.manualEmitCount=q.manualEmitCount??-1}static Parse(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0;const X=q.name;let n,W,D=null,u=null;if(c instanceof Lq.d?n=c:(W=c,n=W.getEngine()),q.customShader&&n.createEffectForParticles){u=q.customShader;const c=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";D=n.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,c)}const K=new Xc(X,s||q.WU,c,D,q.isAnimationSheetEnabled);if(K.customShader=u,K._rootUrl=U,q.id&&(K.id=q.id),q.subEmitters){K.subEmitters=[];for(const J of q.subEmitters){const q=[];for(const Q of J)q.push(wq.Parse(Q,c,U));K.subEmitters.push(q)}}if(q.attractors)for(const g of q.attractors){const q=new gc;q.position=J.p.Ic(g.position),q.strength=g.strength,K.addAttractor(q)}return Xc._Parse(q,K,c,U),q.textureMask&&(K.textureMask=g.e.Ic(q.textureMask)),q.pW&&(K.pW=J.p.Ic(q.pW)),q.preventAutoStart&&(K.preventAutoStart=q.preventAutoStart),Q||K.preventAutoStart||K.start(),K}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(Xc._Serialize(c,this,q),c.textureMask=this.textureMask.rc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.pW=this.pW.rc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const U of this._subEmitters){const J=[];for(const c of U)J.push(c.serialize(q));c.subEmitters.push(J)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const q of this._attractors)c.attractors.push(q.serialize())}return c}static _Serialize(q,c,U){if(q.name=c.name,q.id=c.id,q.WU=c.getCapacity(),q.disposeOnStop=c.disposeOnStop,q.manualEmitCount=c.manualEmitCount,c.j.position){const U=c.j;q.emitterId=U.id}else{const U=c.j;q.j=U.rc()}c.particleEmitterType&&(q.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(U?q.texture=c.particleTexture.serialize():(q.textureName=c.particleTexture.name,q.invertY=!!c.particleTexture._invertY)),q.isLocal=c.isLocal,S.e.AppendSerializedAnimations(c,q),q.beginAnimationOnStart=c.beginAnimationOnStart,q.beginAnimationFrom=c.beginAnimationFrom,q.beginAnimationTo=c.beginAnimationTo,q.beginAnimationLoop=c.beginAnimationLoop,q.startDelay=c.startDelay,q.renderingGroupId=c.renderingGroupId,q.isBillboardBased=c.isBillboardBased,q.billboardMode=c.billboardMode,q.minAngularSpeed=c.minAngularSpeed,q.maxAngularSpeed=c.maxAngularSpeed,q.minSize=c.minSize,q.maxSize=c.maxSize,q.minScaleX=c.minScaleX,q.maxScaleX=c.maxScaleX,q.minScaleY=c.minScaleY,q.maxScaleY=c.maxScaleY,q.minEmitPower=c.minEmitPower,q.maxEmitPower=c.maxEmitPower,q.minLifeTime=c.minLifeTime,q.maxLifeTime=c.maxLifeTime,q.emitRate=c.emitRate,q.gravity=c.gravity.rc(),q.noiseStrength=c.noiseStrength.rc(),q.color1=c.color1.rc(),q.color2=c.color2.rc(),q.colorDead=c.colorDead.rc(),q.updateSpeed=c.updateSpeed,q.targetStopDuration=c.targetStopDuration,q.blendMode=c.blendMode,q.preWarmCycles=c.preWarmCycles,q.preWarmStepOffset=c.preWarmStepOffset,q.minInitialRotation=c.minInitialRotation,q.maxInitialRotation=c.maxInitialRotation,q.startSpriteCellID=c.startSpriteCellID,q.spriteCellLoop=c.spriteCellLoop,q.endSpriteCellID=c.endSpriteCellID,q.spriteCellChangeSpeed=c.spriteCellChangeSpeed,q.spriteCellWidth=c.spriteCellWidth,q.spriteCellHeight=c.spriteCellHeight,q.spriteRandomStartCell=c.spriteRandomStartCell,q.isAnimationSheetEnabled=c.isAnimationSheetEnabled,q.useLogarithmicDepth=c.useLogarithmicDepth;const J=c.getColorGradients();if(J){q.colorGradients=[];for(const c of J){const U={gradient:c.gradient,color1:c.color1.rc()};c.color2?U.color2=c.color2.rc():U.color2=c.color1.rc(),q.colorGradients.push(U)}}const Q=c.getRampGradients();if(Q){q.rampGradients=[];for(const c of Q){const U={gradient:c.gradient,color:c.color.rc()};q.rampGradients.push(U)}q.useRampGradients=c.useRampGradients}const s=c.getColorRemapGradients();if(s){q.colorRemapGradients=[];for(const c of s){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.colorRemapGradients.push(U)}}const g=c.getAlphaRemapGradients();if(g){q.alphaRemapGradients=[];for(const c of g){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.alphaRemapGradients.push(U)}}const X=c.getSizeGradients();if(X){q.sizeGradients=[];for(const c of X){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.sizeGradients.push(U)}}const n=c.getAngularSpeedGradients();if(n){q.angularSpeedGradients=[];for(const c of n){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.angularSpeedGradients.push(U)}}const W=c.getVelocityGradients();if(W){q.velocityGradients=[];for(const c of W){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.velocityGradients.push(U)}}const D=c.getDragGradients();if(D){q.dragGradients=[];for(const c of D){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.dragGradients.push(U)}}const u=c.getEmitRateGradients();if(u){q.emitRateGradients=[];for(const c of u){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.emitRateGradients.push(U)}}const K=c.getStartSizeGradients();if(K){q.startSizeGradients=[];for(const c of K){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.startSizeGradients.push(U)}}const r=c.getLifeTimeGradients();if(r){q.lifeTimeGradients=[];for(const c of r){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.lifeTimeGradients.push(U)}}const H=c.getLimitVelocityGradients();if(H){q.limitVelocityGradients=[];for(const c of H){const U={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?U.factor2=c.factor2:U.factor2=c.factor1,q.limitVelocityGradients.push(U)}q.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(q.noiseTexture=c.noiseTexture.serialize())}clone(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let Q=null;const s=this._engine;if(s.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const q=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"",c=s.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,q);J[0]?J[0].effect=c:this.setCustomEffect(c,0)}const g=this.serialize(U),X=Xc.Parse(g,this._scene||this._engine,this._rootUrl);return X.name=q,X.customShader=Q,X._customWrappers=J,void 0===c&&(c=this.j),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.j=c,this.preventAutoStart||X.start(),X}}Xc.BILLBOARDMODE_Y=2,Xc.BILLBOARDMODE_ALL=7,Xc.BILLBOARDMODE_STRETCHED=8,Xc.BILLBOARDMODE_STRETCHED_LOCAL=9,wq._ParseParticleSystem=Xc.Parse;var nc=U(11373),Wc=U(11364),Dc=U(11196);Dc.e.prototype.createTransformFeedback=function(){const q=this._gl.createTransformFeedback();if(!q)throw new Error("Unable to create Transform Feedback");return q},Dc.e.prototype.deleteTransformFeedback=function(q){this._gl.deleteTransformFeedback(q)},Dc.e.prototype.bindTransformFeedback=function(q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,q)},Dc.e.prototype.beginTransformFeedback=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(q?this._gl.POINTS:this._gl.TRIANGLES)},Dc.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Dc.e.prototype.setTranformFeedbackVaryings=function(q,c){this._gl.transformFeedbackVaryings(q,c,this._gl.INTERLEAVED_ATTRIBS)},Dc.e.prototype.bindTransformFeedbackBuffer=function(q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q?q.underlyingResource:null)},Dc.e.prototype.readTransformFeedbackBuffer=function(q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q)};const uc="clipPlaneFragmentDeclaration2",Kc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[uc]||(i.c.IncludesShadersStore[uc]=Kc);U(12264),U(12270),U(12277),U(12279),U(12282),U(12291),U(12299),U(12303);const rc="gpuRenderParticlesPixelShader",Hc="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.c.ShadersStore[rc]||(i.c.ShadersStore[rc]=Hc);const bc="clipPlaneVertexDeclaration2",hc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[bc]||(i.c.IncludesShadersStore[bc]=hc);U(12305),U(12309),U(12312),U(12319);const oc="gpuRenderParticlesVertexShader",ac="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.c.ShadersStore[oc]||(i.c.ShadersStore[oc]=ac);class pc extends n{static get IsSupported(){if(!A.c.LastCreatedEngine)return!1;const q=A.c.LastCreatedEngine.getCaps();return q.supportTransformFeedbacks||q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(q){this._maxActiveParticleCount=Math.min(q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(q){this.maxActiveParticleCount=q}createPointEmitter(q,c){const U=lq(q,c);return this.particleEmitterType=U,U}createHemisphericEmitter(){const q=jq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=fq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Aq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=Eq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.p(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=Uc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.p(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,c,U,J){const Q=new u;return this.particleEmitterType=Q,this.direction1=q,this.direction2=c,this.minEmitBox=U,this.maxEmitBox=J,Q}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Xc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Xc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Xc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";q?setTimeout((()=>{this.start(0)}),q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[c])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new qq.c(this._engine),this._customWrappers[c].effect=q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new j.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(q,c,U){return super._removeGradientAndTexture(q,c,U),this._releaseBuffers(),this}addColorGradient(q,c){this._colorGradients||(this._colorGradients=[]);const U=new P(q,c);return this._colorGradients.push(U),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(q&&this._colorGradients.sort(((q,c)=>q.gradient<c.gradient?-1:q.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(q){return this._removeGradientAndTexture(q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var q;null===(q=this._drawWrappers[c].drawContext)||void 0===q||q.reset()}}_addFactorGradient(q,c,U){const J=new L(c,U);q.push(J),this._releaseBuffers()}addSizeGradient(q,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(q){return this._removeGradientAndTexture(q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(q,c){if(!q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&q.sort(((q,c)=>q.gradient<c.gradient?-1:q.gradient>c.gradient?1:0));const U=this;U[c]&&(U[c].dispose(),U[c]=null)}addAngularSpeedGradient(q,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(q){return this._removeGradientAndTexture(q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(q,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(q){return this._removeGradientAndTexture(q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(q,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(q){return this._removeGradientAndTexture(q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(q,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(q){return this._removeGradientAndTexture(q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Cc=new j.e,this.onStoppedObservable=new j.e,this.onStartedObservable=new j.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,U&&"Scene"!==U.getClassName()?(this._engine=U,this.defaultProjectionMatrix=J.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=U||A.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qK.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new qq.c(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers={0:new qq.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const g={WU:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},n=c;isFinite(n)&&(g.WU=n),this._capacity=g.WU,this._maxActiveParticleCount=g.WU,this._currentActiveCount=0,this._isAnimationSheetEnabled=s,this.particleEmitterType=new u;const W=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let D=[];for(let J=0;J<W;++J)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture=new f.e(new Float32Array(D),W,1,5,U,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,D=[];for(let J=0;J<W;++J)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture2=new f.e(new Float32Array(D),W,1,5,U,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=W}_reset(){this._releaseBuffers()}_createVertexBuffers(q,c,U){const J={};J.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Q=3;J.age=c.createVertexBuffer("age",Q,1,this._attributesStrideSize,!0),Q+=1,J.size=c.createVertexBuffer("size",Q,3,this._attributesStrideSize,!0),Q+=3,J.life=c.createVertexBuffer("life",Q,1,this._attributesStrideSize,!0),Q+=1,Q+=4,this.billboardMode===Xc.BILLBOARDMODE_STRETCHED&&(J.direction=c.createVertexBuffer("direction",Q,3,this._attributesStrideSize,!0)),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),this.particleEmitterType instanceof R&&(Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this._colorGradientsTexture||(J.color=c.createVertexBuffer("color",Q,4,this._attributesStrideSize,!0),Q+=4),this._isBillboardBased||(J.initialDirection=c.createVertexBuffer("initialDirection",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this.noiseTexture&&(J.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),J.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),J.angle=c.createVertexBuffer("angle",Q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Q++:Q+=2,this._isAnimationSheetEnabled&&(J.cellIndex=c.createVertexBuffer("cellIndex",Q,1,this._attributesStrideSize,!0),Q+=1,this.spriteRandomStartCell&&(J.cellStartOffset=c.createVertexBuffer("cellStartOffset",Q,1,this._attributesStrideSize,!0),Q+=1)),J.offset=U.createVertexBuffer("offset",0,2),J.uv=U.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(J),this._platform.createVertexBuffers(q,J),this.resetDrawCache()}_initialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!q)return;const c=this._engine,U=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof R&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Q=this.particleEmitterType instanceof R,s=J.j.hc[0];let g=0;for(let J=0;J<this._capacity;J++)if(U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(0),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),Q?(this.particleEmitterType.particleDestinationGenerator(J,null,s),U.push(s.x),U.push(s.y),U.push(s.z)):(U.push(0),U.push(0),U.push(0)),this._platform.alignDataInBuffer&&U.push(0),g+=16,Q&&(this.particleEmitterType.particlePositionGenerator(J,null,s),U.push(s.x),U.push(s.y),U.push(s.z),this._platform.alignDataInBuffer&&U.push(0),g+=4),this._colorGradientsTexture||(U.push(0),U.push(0),U.push(0),U.push(0),g+=4),this.isBillboardBased||(U.push(0),U.push(0),U.push(0),this._platform.alignDataInBuffer&&U.push(0),g+=4),this.noiseTexture&&(U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),this._platform.alignDataInBuffer&&U.push(0),U.push(Math.random()),U.push(Math.random()),U.push(Math.random()),this._platform.alignDataInBuffer&&U.push(0),g+=8),U.push(0),g+=1,this._angularSpeedGradientsTexture||(U.push(0),g+=1),this._isAnimationSheetEnabled&&(U.push(0),g+=1,this.spriteRandomStartCell&&(U.push(0),g+=1)),this._platform.alignDataInBuffer){let q=3-(g+3&3);for(g+=q;q-- >0;)U.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),n=this._platform.createParticleBuffer(U),W=this._platform.createParticleBuffer(U);this._buffer0=new I.e(c,n,!1,this._attributesStrideSize),this._buffer1=new I.e(c,W,!1,this._attributesStrideSize),this._spriteBuffer=new I.e(c,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(q+="\n#define DRAGGRADIENTS"),this._flowMap&&(q+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(q+="\n#define NOISE"),this.isLocal&&(q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===q||(this._cachedUpdateDefines=q,this._updateBuffer=this._platform.createUpdateBuffer(q)),this._platform.isUpdateBufferReady()}_getWrapper(q){const c=this._getCustomDrawWrapper(q);if(null!==c&&void 0!==c&&c.effect)return c;const U=[];this.fillDefines(U,q);let J=this._drawWrappers[q];J||(J=new qq.c(this._engine),J.drawContext&&(J.drawContext.useInstancing=!0),this._drawWrappers[q]=J);const Q=U.join("\n");if(J.defines!==Q){const q=[],c=[],U=[];this.fillUniformsAttributesAndSamplerNames(c,q,U),J.setEffect(this._engine.createEffect("gpuRenderParticles",q,c,U,Q),Q)}return J}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=[I.h.PositionKind,"age","life","size","angle"];return q||Q.push(I.h.ColorKind),c&&Q.push("cellIndex"),U||Q.push("initialDirection"),J&&Q.push("direction"),Q.push("offset",I.h.UVKind),Q}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["emitterWM","pW","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cq.b)(J),q&&J.push("sheetInfos"),c&&J.push("logarithmicDepthConstant"),U&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cq.h)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Wc.b.FOGMODE_NONE&&q.push("#define FOG")),c===Xc.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&q.push("#define LOCAL"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case Xc.BILLBOARDMODE_Y:q.push("#define BILLBOARDY");break;case Xc.BILLBOARDMODE_STRETCHED:q.push("#define BILLBOARDSTRETCHED");break;case Xc.BILLBOARDMODE_ALL:q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),U&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,c,U){c.push(...pc._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Xc.BILLBOARDMODE_STRETCHED)),q.push(...pc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),U.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(nc.b.PrepareUniforms(q,this._imageProcessingConfigurationDefines),nc.b.PrepareSamplers(U,this._imageProcessingConfigurationDefines))}animate(){var q;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(q,c){const U=this[c];if(!q||!q.length||U)return;const J=new Float32Array(this._rawTextureWidth);for(let Q=0;Q<this._rawTextureWidth;Q++){const c=Q/this._rawTextureWidth;l.GetCurrentGradient(c,q,((q,c,U)=>{J[Q]=(0,W.Lerp)(q.factor1,c.factor1,U)}))}this[c]=f.e.CreateRTexture(J,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const q=new Uint8Array(4*this._rawTextureWidth),c=g.g.Pc[0];for(let U=0;U<this._rawTextureWidth;U++){const J=U/this._rawTextureWidth;l.GetCurrentGradient(J,this._colorGradients,((J,Q,s)=>{g.e.LerpToRef(J.color1,Q.color1,s,c),q[4*U]=255*c.r,q[4*U+1]=255*c.g,q[4*U+2]=255*c.b,q[4*U+3]=255*c.a}))}this._colorGradientsTexture=f.e.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(q,c){var U,Q,s,g;const X=this._getWrapper(q),n=X.effect;this._engine.enableEffect(X);const W=(null===(U=this._scene)||void 0===U?void 0:U.getViewMatrix())||J.d.IdentityReadOnly;if(n.setMatrix("view",W),n.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),n.setTexture("diffuseSampler",this.particleTexture),n.setVector2("translationPivot",this.translationPivot),n.setVector3("pW",this.pW),this.isLocal&&n.setMatrix("emitterWM",c),this._colorGradientsTexture?n.setTexture("colorGradientSampler",this._colorGradientsTexture):n.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();n.setFloat3("sheetInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;n.setVector3("eyePosition",q.globalPosition)}const D=n.defines;if(this._scene&&((0,cq.c)(n,this,this._scene),this.applyFog&&(0,Uq.f)(this._scene,void 0,n)),D.indexOf("#define BILLBOARDMODE_ALL")>=0){const q=W.clone();q.invert(),n.setMatrix("invView",q)}return this.useLogarithmicDepth&&this._scene&&(0,Uq.m)(D,n,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),this._setEngineBasedOnBlendMode(q),this._platform.bindDrawBuffers(this._targetIndex,n,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(n),null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(q){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!q)if(this.j.position){q=this.j.getWorldMatrix()}else{const c=this.j;q=J.j.Matrix[0],J.d.TranslationToRef(c.x,c.y,c.z,q)}const c=this._engine,U=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const q=this.Cq();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",q.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Q,c.setDepthWrite(U)}render(){let q,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const q=0|this._accumulatedCount;this._accumulatedCount-=q,this._currentActiveCount+=q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){q=this.j.getWorldMatrix()}else{const c=this.j;q=J.j.Matrix[0],J.d.TranslationToRef(c.x,c.y,c.z,q)}const Q=this._engine;this.updateInAnimate||this._update(q);let s=0;return c||U||(Q.setState(!1),this.forceDepthWrite&&Q.setDepthWrite(!0),s=this.blendMode===Xc.BLENDMODE_MULTIPLYADD?this._render(Xc.BLENDMODE_MULTIPLY,q)+this._render(Xc.BLENDMODE_ADD,q):this._render(this.blendMode,q),this._engine.setAlphaMode(0)),s}rebuild(){const q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const q=this._scene.qK.indexOf(this);q>-1&&this._scene.qK.splice(q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const q=this._renderVertexBuffers[c];for(const c in q)q[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Cc.notifyObservers(this),this.Cc.clear()}clone(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let Q=null;const s=this._engine;if(s.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const q=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";J[0]=s.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,q,void 0,void 0,void 0,this)}const g=this.serialize(U),X=pc.Parse(g,this._scene||this._engine,this._rootUrl);return X.name=q,X.customShader=Q,X._customWrappers=J,void 0===c&&(c=this.j),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.j=c,X}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return Xc._Serialize(c,this,q),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const s=q.name;let g,X;c instanceof Lq.d?g=c:(X=c,g=X.getEngine());const n=new pc(s,{WU:Q||q.WU,randomTextureSize:q.randomTextureSize},c,null,q.isAnimationSheetEnabled);if(n._rootUrl=U,q.customShader&&g.createEffectForParticles){const c=q.customShader,U=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",J=g.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,U,void 0,void 0,void 0,n);n.setCustomEffect(J,0),n.customShader=c}return q.id&&(n.id=q.id),q.activeParticleCount&&(n.activeParticleCount=q.activeParticleCount),Xc._Parse(q,n,c,U),q.preventAutoStart&&(n.preventAutoStart=q.preventAutoStart),J||n.preventAutoStart||n.start(),n}}var Rc=U(10879),Ic=U(12326),tc=U(11463);class Cc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.j=q;this._emitterNode=q}setEmitterAsSphere(q,c,U){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:q,renderingGroupId:c};const J=(0,Ic.d)("emitterSphere",{diameter:q.diameter,segments:q.segments},U);J.renderingGroupId=c;const Q=new tc.b("emitterSphereMaterial",U);Q.emissiveColor=q.color,J.material=Q;for(const s of this.systems)s.j=J;this._emitterNode=J}start(q){for(const c of this.systems)q&&(c.j=q),c.start()}dispose(){for(const q of this.systems)q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const U of this.systems)c.systems.push(U.serialize(q));return this._emitterNode&&(c.j=this._emitterCreationOptions),c}static Parse(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;const Q=new Cc,s=this.BaseAssetsUrl+"/textures/";c=c||A.c.LastCreatedScene;for(const g of q.systems)Q.systems.push(U?pc.Parse(g,c,s,!0,J):Xc.Parse(g,c,s,!0,J));if(q.j){const U=q.j.options;if("Sphere"===q.j.kind)Q.setEmitterAsSphere({diameter:U.diameter,segments:U.segments,color:g.c.Ic(U.color)},q.j.renderingGroupId,c)}return Q}}Cc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ic=U(10913);class Fc{static CreateDefault(q){let c,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,J=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new pc("default system",{WU:U},J):new Xc("default system",U,J),c.j=q;const Q=Rc.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new Z.c(Q,c.Cq()),c.createConeEmitter(.1,Math.PI/4),c.color1=new g.e(1,1,1,1),c.color2=new g.e(1,1,1,1),c.colorDead=new g.e(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;c||(c=A.c.LastCreatedScene);const Q={};return c.addPendingData(Q),new Promise(((s,g)=>{if(U&&!pc.IsSupported)return c.removePendingData(Q),g("Particle system with GPU is not supported.");Rc.e.LoadFile(`${Fc.BaseAssetsUrl}/systems/${q}.json`,(q=>{c.removePendingData(Q);const g=JSON.parse(q.toString());return s(Cc.Parse(g,c,U,J))}),void 0,void 0,void 0,(()=>(c.removePendingData(Q),g(`An error occurred with the creation of your particle system. Check if your type '${q}' exists.`))))}))}static ExportSet(q){const c=new Cc;for(const U of q)c.systems.push(U);return c}static ParseFromFileAsync(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5?arguments[5]:void 0;return new Promise(((g,X)=>{const n=new ic.d;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const c=JSON.parse(n.responseText);let X;X=J?pc.Parse(c,U,Q,!1,s):Xc.Parse(c,U,Q,!1,s),q&&(X.name=q),g(X)}else X("Unable to load the particle system")})),n.open("GET",c),n.send()}))}static ParseFromSnippetAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===q){const q=this.CreateDefault(null);return q.start(),Promise.resolve(q)}return new Promise(((s,g)=>{const X=new ic.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const g=JSON.parse(JSON.parse(X.responseText).jsonPayload),n=JSON.parse(g.particleSystem);let W;W=U?pc.Parse(n,c,J,!1,Q):Xc.Parse(n,c,J,!1,Q),W.snippetId=q,s(W)}else g("Unable to load the snippet "+q)})),X.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),X.send()}))}}Fc.BaseAssetsUrl=Cc.BaseAssetsUrl,Fc.SnippetUrl="https://snippet.babylonjs.com",Fc.CreateFromSnippetAsync=Fc.ParseFromSnippetAsync;var vc=U(11149),Yc=U(11192),kc=U(12331);(0,kc.i)(Yc.d.NAME_PARTICLESYSTEM,((q,c,U,J)=>{const Q=(0,kc.k)(Yc.d.NAME_PARTICLESYSTEM);if(Q&&void 0!==q.qK&&null!==q.qK)for(let s=0,g=q.qK.length;s<g;s++){const g=q.qK[s];U.qK.push(Q(g,c,J))}})),(0,kc.e)(Yc.d.NAME_PARTICLESYSTEM,((q,c,U)=>{if(q.activeParticleCount){return pc.Parse(q,c,U)}return Xc.Parse(q,c,U)})),Lq.d.prototype.createEffectForParticles=function(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,u=[],K=[];const r=[];return n?n.fillUniformsAttributesAndSamplerNames(K,u,r):(u=Xc._GetAttributeNamesOrOptions(),K=Xc._GetEffectCreationOptions()),-1===Q.indexOf(" BILLBOARD")&&(Q+="\n#define BILLBOARD\n"),null!==n&&void 0!==n&&n.isAnimationSheetEnabled&&-1===Q.indexOf(" ANIMATESHEET")&&(Q+="\n#define ANIMATESHEET\n"),-1===J.indexOf("diffuseSampler")&&J.push("diffuseSampler"),this.createEffect({vertex:D??(null===n||void 0===n?void 0:n.vertexShaderName)??"particles",fragmentElement:q},u,K.concat(c),r.concat(J),Q,s,g,X,void 0,W,(async()=>{0===W?await Promise.resolve().then(U.bind(U,12375)):await Promise.resolve().then(U.bind(U,12435))}))},vc.b.prototype.getEmittedParticleSystems=function(){const q=[];for(let c=0;c<this.Cq().qK.length;c++){const U=this.Cq().qK[c];U.j===this&&q.push(U)}return q},vc.b.prototype.getHierarchyEmittedParticleSystems=function(){const q=[],c=this.getDescendants();c.push(this);for(let U=0;U<this.Cq().qK.length;U++){const J=this.Cq().qK[U],Q=J.j;Q.position&&-1!==c.indexOf(Q)&&q.push(J)}return q};U(11050),U(11059),U(11119);U(11125),U(12340),U(11137),U(11025),U(11183);U(11263);var Vc;U(12349),U(11280);!function(q){q[q.Color=2]="Color",q[q.UV=1]="UV",q[q.Random=0]="Random",q[q.Stated=3]="Stated"}(Vc||(Vc={}));var Oc=U(11285);const Gc=new J.p(0,0,0),Sc=new J.p(0,0,0),Zc=new J.p(0,0,0);class xc{constructor(q,c,U){this.width=q,this.height=c,this.data=U}processFlowable(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;if(!U)return;U instanceof J.d?J.p.TransformCoordinatesToRef(q.position,U,Zc):(Zc.x=U.x,Zc.y=U.y,Zc.z=U.z);const Q=.5*Zc.x+.5,s=1-(.5*Zc.y+.5),g=Math.floor(Q*this.width),X=Math.floor(s*this.height);if(g<0||g>=this.width||X<0||X>=this.height)return;const n=4*(X*this.width+g),W=this.data[n]/255*2-1,D=this.data[n+1]/255*2-1,u=this.data[n+2]/255*2-1,K=this.data[n+3]/255;Gc.set(W,D,u),Gc.scaleToRef(c*K,Sc),q.direction.addInPlace(Sc)}_processParticle(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;this.processFlowable(q,c,U)}static async FromUrlAsync(q){return await new Promise(((c,U)=>{const J=document.createElement("canvas"),Q=J.getContext("2d");let s=null;const g=new Image;g.crossOrigin="anonymous",g.src=q,g.onerror=c=>{U(new Error(`Failed to load image: ${q} : ${c}`))},g.onload=()=>{J.width=g.width,J.height=g.height,Q.drawImage(g,0,0),s=Q.getImageData(0,0,J.width,J.height),c(new xc(J.width,J.height,s.data))}}))}static async ExtractFromTextureAsync(q){return await new Promise(((c,U)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{const U=await this.ExtractFromTextureAsync(q);c(U)}catch(J){U(J)}}));const J=q.getSize();Oc.l.GetTextureDataAsync(q,J.width,J.height).then((q=>{c(new xc(J.width,J.height,new Uint8ClampedArray(q)))})).catch(U)}))}}var zc,yc,Mc,Tc,mc,dc,ec,Bc,Nc;!function(q){q[q.Int=1]="Int",q[q.Float=2]="Float",q[q.Vector2=4]="Vector2",q[q.hc=8]="hc",q[q.Matrix=16]="Matrix",q[q.Particle=32]="Particle",q[q.Texture=64]="Texture",q[q.Pc=128]="Pc",q[q.FloatGradient=256]="FloatGradient",q[q.Vector2Gradient=512]="Vector2Gradient",q[q.Vector3Gradient=1024]="Vector3Gradient",q[q.Color4Gradient=2048]="Color4Gradient",q[q.System=4096]="System",q[q.AutoDetect=8192]="AutoDetect",q[q.BasedOnInput=16384]="BasedOnInput",q[q.Undefined=32768]="Undefined",q[q.All=65535]="All"}(zc||(zc={})),function(q){q[q.Compatible=0]="Compatible",q[q.TypeIncompatible=1]="TypeIncompatible",q[q.HierarchyIssue=2]="HierarchyIssue"}(yc||(yc={})),function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(Mc||(Mc={}));class Pc{get direction(){return this._direction}get type(){if(this._type===zc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===zc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(q){this._type=q}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((q=>q.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(q,c,U){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=zc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new j.e,this.onDisconnectionObservable=new j.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=q,this._direction=U}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(q){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(q):this._connectedPoint._storedValue:this.value}canConnectTo(q){return 0===this.checkCompatibilityState(q)}checkCompatibilityState(q){const c=this._ownerBlock,U=q.ownerBlock;if(this.type!==q.type&&q.innerType!==zc.AutoDetect)return q.acceptedConnectionPointTypes&&-1!==q.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(q.excludedConnectionPointTypes&&-1!==q.excludedConnectionPointTypes.indexOf(this.type))return 1;let J=U,Q=c;return 0===this.direction&&(J=c,Q=U),J.isAnAncestorOf(Q)?2:0}connectTo(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(q))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${q.ownerBlock.name}".${q.name}`;return this._endpoints.push(q),q._connectedPoint=this,this.onConnectionObservable.notifyObservers(q),q.onConnectionObservable.notifyObservers(this),this}disconnectFrom(q){const c=this._endpoints.indexOf(q);return-1===c||(this._endpoints.splice(c,1),q._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(q),q.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(q){let c=1;for(;c<zc.All;)q&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.rc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.rc()):(c.valueType="number",c.value=this.value)),q&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class wc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(q){this._name=q}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(q){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new j.e,this.Cc=new j.e,this.onInputChangedObservable=new j.e,this.visibleOnFrame=!1,this._name=q,this.uniqueId=x.d.UniqueId}_inputRename(q){return q}_outputRename(q){return q}isAnAncestorOf(q){for(const c of this._outputs)if(c.hasEndpoints)for(const U of c.endpoints){if(U.ownerBlock===q)return!0;if(U.ownerBlock.isAnAncestorOf(q))return!0}return!1}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const U of c.endpoints)if(U.ownerBlock.isAnAncestorOfType(q))return!0;return!1}getInputByName(q){const c=this._inputs.filter((c=>c.name===q));return c.length?c[0]:null}_linkConnectionTypes(q,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[q]:(this._inputs[q]._linkedConnectionSource=this._inputs[c],this._inputs[q]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[q]}registerInput(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;const g=new Pc(q,this,0);return g.type=c,g.isOptional=U,g.defaultValue=J,g.value=J,g.valueMin=Q,g.valueMax=s,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(q,c,U){return(U=U??new Pc(q,this,1)).type=c,this._outputs.push(U),this}_build(q){}_customBuildStep(q){}build(q){if(this._buildId===q.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((q=>q.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=q.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||q.notConnectedNonOptionalInputs.push(c);continue}const U=c.connectedPoint.ownerBlock;U&&U!==this&&!U.isSystem&&U.build(q)}return this._customBuildStep(q),q.verbose&&z.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(q),this.onBuildObservable.notifyObservers(this),!1}serialize(){const q={};q.customType="BABYLON."+this.getClassName(),q.id=this.uniqueId,q.name=this.name,q.visibleOnFrame=this.visibleOnFrame,q.inputs=[],q.outputs=[];for(const c of this.inputs)q.inputs.push(c.serialize());for(const c of this.outputs)q.outputs.push(c.serialize(!1));return q}_deserialize(q){this._name=q.name,this.comments=q.comments,this.visibleOnFrame=!!q.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(q)}_deserializePortDisplayNamesAndExposedOnFrame(q){const c=q.inputs,U=q.outputs;if(c)for(const J of c){const q=this.inputs.find((q=>q.name===J.name));if(!q)return;if(J.displayName&&(q.displayName=J.displayName),J.isExposedOnFrame&&(q.isExposedOnFrame=J.isExposedOnFrame,q.exposedPortPosition=J.exposedPortPosition),void 0!==J.value&&null!==J.value)if("number"===J.valueType)q.value=J.value;else{const c=(0,X.d)(J.valueType);c&&(q.value=c.Ic(J.value))}}if(U)for(let J=0;J<U.length;J++){const q=U[J];q.displayName&&(this.outputs[J].displayName=q.displayName),q.isExposedOnFrame&&(this.outputs[J].isExposedOnFrame=q.isExposedOnFrame,this.outputs[J].exposedPortPosition=q.exposedPortPosition)}}clone(){const q=this.serialize(),c=(0,X.d)(q.customType);if(c){const U=new c;return U._deserialize(q),U}return null}dispose(){this.Cc.notifyObservers(this),this.Cc.clear();for(const q of this.inputs)q.dispose();for(const q of this.outputs)q.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Lc(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",J=arguments.length>3?arguments[3]:void 0;return(Q,s)=>{let g=Q._propStore;g||(g=[],Q._propStore=g),g.push({propertyName:s,displayName:q,type:c,groupName:U,options:J??{},className:Q.getClassName()})}}(0,O.d)([(0,G.N)("comment")],wc.prototype,"comments",void 0),function(q){q[q.Boolean=0]="Boolean",q[q.Float=1]="Float",q[q.Int=2]="Int",q[q.Vector2=3]="Vector2",q[q.List=4]="List",q[q.Pc=5]="Pc",q[q.SamplingMode=6]="SamplingMode",q[q.TextureFormat=7]="TextureFormat",q[q.TextureType=8]="TextureType"}(Tc||(Tc={})),function(q){q[q.None=0]="None",q[q.Position=1]="Position",q[q.Direction=2]="Direction",q[q.Age=3]="Age",q[q.Lifetime=4]="Lifetime",q[q.Color=5]="Color",q[q.ScaledDirection=6]="ScaledDirection",q[q.Scale=7]="Scale",q[q.AgeGradient=8]="AgeGradient",q[q.Angle=9]="Angle",q[q.SpriteCellIndex=16]="SpriteCellIndex",q[q.SpriteCellStart=17]="SpriteCellStart",q[q.SpriteCellEnd=18]="SpriteCellEnd"}(mc||(mc={})),function(q){q[q.None=0]="None",q[q.Time=1]="Time",q[q.Delta=2]="Delta",q[q.Emitter=3]="Emitter"}(dc||(dc={}));class lc{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let q="";for(const c of this.notConnectedNonOptionalInputs)q+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(q)throw"Build of Node Particle System Set failed:\n"+q}adapt(q,c){const U=q.getConnectedValue(this)||0;if(q.type===c)return U;switch(c){case zc.Vector2:return new J.l(U,U);case zc.hc:return new J.p(U,U,U);case zc.Pc:return new g.e(U,U,U,U)}return null}getContextualValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case mc.Position:return this.particleContext.position;case mc.Direction:return this.particleContext.direction;case mc.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case mc.Color:return this.particleContext.color;case mc.Age:return this.particleContext.age;case mc.Lifetime:return this.particleContext.lifeTime;case mc.Angle:return this.particleContext.angle;case mc.Scale:return this.particleContext.scale;case mc.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case mc.SpriteCellEnd:return this.systemContext.endSpriteCellID;case mc.SpriteCellIndex:return this.particleContext.cellIndex;case mc.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case dc.Time:return this.systemContext._actualFrame;case dc.Delta:return this.systemContext._scaledUpdateSpeed;case dc.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function jc(q,c,U){const J=new lc;J.mc=c;const Q=q.createSystem(J);return Q.canStart=()=>!0,Q.j=U.clone(),Q.disposeOnStop=!0,Q.start(),Q}class fc extends wc{constructor(q){super(q),this.blendMode=n.BLENDMODE_ONEONE,this.WU=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",zc.Particle),this.registerInput("texture",zc.Texture),this.registerInput("onStart",zc.System,!0),this.registerInput("onEnd",zc.System,!0),this.registerOutput("system",zc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(q){q.WU=this.WU,q.buildId=this._buildId++,this.build(q);const c=this.particle.getConnectedValue(q);return c.particleTexture=this.texture.getConnectedValue(q),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((U=>{const J=this.onStart.getConnectedValue(q);J&&U.onStartedObservable.addOnce((()=>{q.systemContext=c;const U=jc(J,q.mc,q.emitterPosition);this.Cc.addOnce((()=>{U.dispose()}))}));const Q=this.onEnd.getConnectedValue(q);Q&&U.onStoppedObservable.addOnce((()=>{q.systemContext=c;const U=jc(Q,q.mc,q.emitterPosition);this.Cc.addOnce((()=>{U.dispose()}))}))})),this.Cc.addOnce((()=>{c.dispose()})),c}serialize(){const q=super.serialize();return q.WU=this.WU,q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.doNoStart=this.doNoStart,q.targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,q}_deserialize(q){super._deserialize(q),this.WU=q.WU,this.emitRate=q.emitRate,this.doNoStart=!!q.doNoStart,void 0!==q.blendMode&&(this.blendMode=q.blendMode),void 0!==q.targetStopDuration&&(this.targetStopDuration=q.targetStopDuration),void 0!==q.startDelay&&(this.startDelay=q.startDelay)}}(0,O.d)([Lc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:n.BLENDMODE_ONEONE},{label:"Standard",value:n.BLENDMODE_STANDARD},{label:"Add",value:n.BLENDMODE_ADD},{label:"Multiply",value:n.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:n.BLENDMODE_MULTIPLYADD}]})],fc.prototype,"blendMode",void 0),(0,O.d)([Lc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],fc.prototype,"WU",void 0),(0,O.d)([Lc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fc.prototype,"emitRate",void 0),(0,O.d)([Lc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fc.prototype,"targetStopDuration",void 0),(0,O.d)([Lc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fc.prototype,"startDelay",void 0),(0,O.d)([Lc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],fc.prototype,"doNoStart",void 0),(0,X.f)("BABYLON.SystemBlock",fc);class Ac extends wc{get type(){if(this._type===zc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=zc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=zc.Vector2,this._type;case"hc":return this._type=zc.hc,this._type;case"Pc":return this._type=zc.Pc,this._type;case"Matrix":return this._type=zc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===mc.None&&this._systemSource!==dc.None}get systemSource(){return this._systemSource}set systemSource(q){if(this._systemSource=q,q!==dc.None){switch(this._contextualSource=mc.None,this._type=zc.Float,q){case dc.Time:case dc.Delta:this._type=zc.Float;break;case dc.Emitter:this._type=zc.hc}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==mc.None}get contextualValue(){return this._contextualSource}set contextualValue(q){if(this._contextualSource=q,q!==mc.None){switch(this._systemSource=dc.None,q){case mc.Scale:this._type=zc.Vector2;break;case mc.Position:case mc.Direction:case mc.ScaledDirection:this._type=zc.hc;break;case mc.Color:this._type=zc.Pc;break;case mc.Age:case mc.Lifetime:case mc.Angle:case mc.AgeGradient:this._type=zc.Float;break;case mc.SpriteCellEnd:case mc.SpriteCellStart:case mc.SpriteCellIndex:this._type=zc.Int}this.output&&(this.output.type=this._type)}}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zc.AutoDetect;super(q),this._type=zc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new j.e,this._systemSource=dc.None,this._contextualSource=mc.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(q){this.type===zc.Float&&this.min!==this.max&&(q=Math.max(this.min,q),q=Math.min(this.max,q)),this._storedValue=q,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(q){this._valueCallback=q}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case zc.Int:case zc.Float:this.value=0;break;case zc.Vector2:this.value=J.l.Zero();break;case zc.hc:this.value=J.p.Zero();break;case zc.Pc:this.value=new g.e(1,1,1,1);break;case zc.Matrix:this.value=J.d.Identity()}}_build(q){super._build(q),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=q=>q.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=q=>q.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const q=super.serialize();return q.type=this.type,q.contextualValue=this.contextualValue,q.systemSource=this.systemSource,q.min=this.min,q.max=this.max,q.groupInInspector=this.groupInInspector,q.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.rc?(q.valueType="BABYLON."+this._storedValue.getClassName(),q.value=this._storedValue.rc()):(q.valueType="number",q.value=this._storedValue)),q}_deserialize(q){if(super._deserialize(q),this._type=q.type,this.contextualValue=q.contextualValue,this.systemSource=q.systemSource||dc.None,this.min=q.min||0,this.max=q.max||0,this.groupInInspector=q.groupInInspector||"",void 0!==q.displayInInspector&&(this.displayInInspector=q.displayInInspector),q.valueType)if("number"===q.valueType)this._storedValue=q.value;else{const c=(0,X.d)(q.valueType);c&&(this._storedValue=c.Ic(q.value))}}}(0,X.f)("BABYLON.ParticleInputBlock",Ac);class Ec extends wc{get url(){return this._url}set url(q){this._url!==q&&(this._cachedData=null,this._url=q,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(q){this._textureDataUrl!==q&&(this._cachedData=null,this._textureDataUrl=q,this._url="",this._sourceTexture=null)}set sourceTexture(q){this._sourceTexture!==q&&(this._cachedData=null,this._sourceTexture=q,this._url="",this._textureDataUrl="")}constructor(q){super(q),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",zc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const q=this.texture._storedValue;return await new Promise(((c,U)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(q){U(q)}}));const J=q.getSize();Oc.l.GetTextureDataAsync(q,J.width,J.height).then((U=>{this._cachedData={width:J.width,height:J.height,data:new Uint8ClampedArray(U)},q.dispose(),c(this._cachedData)})).catch(U)}))}_build(q){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Z.c(this._textureDataUrl,q.mc):this.texture._storedValue=new Z.c(this._url,q.mc):this.texture._storedValue=null}serialize(){const q=super.serialize();return q.url=this.url,q.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(q.textureDataUrl=this.textureDataUrl),q}_deserialize(q){super._deserialize(q),this.url=q.url,this.serializedCachedData=!!q.serializedCachedData,q.textureDataUrl&&(this.textureDataUrl=q.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.f)("BABYLON.ParticleTextureSourceBlock",Ec);class qU extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("position",zc.hc),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.position.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.position.X(this.position.getConnectedValue(q))},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}}(0,X.f)("BABYLON.UpdatePositionBlock",qU),function(q){q[q.Add=0]="Add",q[q.Subtract=1]="Subtract",q[q.Multiply=2]="Multiply",q[q.Divide=3]="Divide",q[q.Max=4]="Max",q[q.Min=5]="Min"}(ec||(ec={}));class cU extends wc{constructor(q){super(q),this.operation=ec.Add,this.registerInput("left",zc.AutoDetect),this.registerInput("right",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[zc.Matrix,zc.Particle,zc.Texture,zc.System,zc.FloatGradient,zc.Color4Gradient,zc.Vector2Gradient,zc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(q){let c;const U=this.left,Q=this.right;if(!U.isConnected||!Q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const s=U.type===zc.Float||U.type===zc.Int,X=Q.type===zc.Float||Q.type===zc.Int,n=s&&X;switch(this.operation){case ec.Add:c=n?q=>U.getConnectedValue(q)+Q.getConnectedValue(q):s?q=>q.adapt(U,Q.type).add(Q.getConnectedValue(q)):q=>U.getConnectedValue(q).add(q.adapt(Q,U.type));break;case ec.Subtract:c=n?q=>U.getConnectedValue(q)-Q.getConnectedValue(q):s?q=>q.adapt(U,Q.type).eU(Q.getConnectedValue(q)):q=>U.getConnectedValue(q).eU(q.adapt(Q,U.type));break;case ec.Multiply:c=n?q=>U.getConnectedValue(q)*Q.getConnectedValue(q):s?q=>q.adapt(U,Q.type).multiply(Q.getConnectedValue(q)):q=>U.getConnectedValue(q).multiply(q.adapt(Q,U.type));break;case ec.Divide:c=n?q=>U.getConnectedValue(q)/Q.getConnectedValue(q):s?q=>q.adapt(U,Q.type).divide(Q.getConnectedValue(q)):q=>U.getConnectedValue(q).divide(q.adapt(Q,U.type));break;case ec.Min:if(n)c=q=>Math.min(U.getConnectedValue(q),Q.getConnectedValue(q));else{const[q,X]=s?[Q,U]:[U,Q];switch(q.type){case zc.Vector2:c=c=>J.l.Minimize(q.getConnectedValue(c),c.adapt(X,q.type));break;case zc.hc:c=c=>J.p.Minimize(q.getConnectedValue(c),c.adapt(X,q.type));break;case zc.Pc:c=c=>{const U=q.getConnectedValue(c),{r:J,g:Q,b:s,a:n}=c.adapt(X,q.type);return new g.e(Math.min(U.r,J),Math.min(U.g,Q),Math.min(U.b,s),Math.min(U.a,n))}}}break;case ec.Max:if(!n){const[q,X]=s?[Q,U]:[U,Q];switch(q.type){case zc.Vector2:c=c=>J.l.Maximize(q.getConnectedValue(c),c.adapt(X,q.type));break;case zc.hc:c=c=>J.p.Maximize(q.getConnectedValue(c),c.adapt(X,q.type));break;case zc.Pc:c=c=>{const U=q.getConnectedValue(c),{r:J,g:Q,b:s,a:n}=c.adapt(X,q.type);return new g.e(Math.max(U.r,J),Math.min(U.g,Q),Math.min(U.b,s),Math.min(U.a,n))}}break}c=q=>Math.max(U.getConnectedValue(q),Q.getConnectedValue(q))}this.output._storedFunction=q=>U.type===zc.Int?0|c(q):c(q)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===zc.Int||this.left.type===zc.Float&&this.right.type!==zc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[q,c]of[[this.left,this.right],[this.right,this.left]])q.acceptedConnectionPointTypes=[zc.Int,zc.Float],c.isConnected&&(q.acceptedConnectionPointTypes.push(c.type),c.type!==zc.Int&&c.type!==zc.Float||q.acceptedConnectionPointTypes.push(zc.Vector2,zc.hc,zc.Pc))}dispose(){super.dispose();for(const q of this._connectionObservers)q.remove();this._connectionObservers.length=0}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,O.d)([Lc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ec.Add},{label:"Subtract",value:ec.Subtract},{label:"Multiply",value:ec.Multiply},{label:"Divide",value:ec.Divide},{label:"Max",value:ec.Max},{label:"Min",value:ec.Min}]})],cU.prototype,"operation",void 0),(0,X.f)("BABYLON.ParticleMathBlock",cU);class UU extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("direction1",zc.hc,!0,new J.p(0,1,0)),this.registerInput("direction2",zc.hc,!0,new J.p(0,1,0)),this.registerInput("minEmitBox",zc.hc,!0,new J.p(-.5,-.5,-.5)),this.registerInput("maxEmitBox",zc.hc,!0,new J.p(.5,.5,.5)),this.registerOutput("output",zc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const c=this.particle.getConnectedValue(q);c._directionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.direction1.getConnectedValue(q),s=this.direction2.getConnectedValue(q),g=(0,W.RandomRange)(Q.x,s.x),X=(0,W.RandomRange)(Q.y,s.y),n=(0,W.RandomRange)(Q.z,s.z);q.isEmitterTransformNode?J.p.TransformNormalFromFloatsToRef(g,X,n,q.emitterWorldMatrix,U.direction):U.direction.bc(g,X,n)},c._positionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.minEmitBox.getConnectedValue(q),s=this.maxEmitBox.getConnectedValue(q),g=(0,W.RandomRange)(Q.x,s.x),X=(0,W.RandomRange)(Q.y,s.y),n=(0,W.RandomRange)(Q.z,s.z);q.isEmitterTransformNode?J.p.TransformCoordinatesFromFloatsToRef(g,X,n,q.emitterWorldMatrix,U.position):(U.position.bc(g,X,n),U.position.addInPlace(q.emitterPosition))},this.output._storedValue=c}}(0,X.f)("BABYLON.BoxShapeBlock",UU);class JU extends wc{constructor(q){super(q),this.registerInput("emitPower",zc.Float,!0,1),this.registerInput("lifeTime",zc.Float,!0,1),this.registerInput("color",zc.Pc,!0,new g.e(1,1,1,1)),this.registerInput("scale",zc.Vector2,!0,new J.l(1,1)),this.registerInput("angle",zc.Float,!0,0),this.registerOutput("particle",zc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(q){const c=new Xc(this.name,q.WU,q.mc,null,!1,void 0,!0);c.particleEmitterType=new o,c._lifeTimeCreation.process=(c,U)=>{q.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(q),U._emitPower=this.emitPower.getConnectedValue(q)},c._colorCreation.process=c=>{q.particleContext=c,c.color.X(this.color.getConnectedValue(q))},c._sizeCreation.process=c=>{q.particleContext=c,c.size=1,c.scale.X(this.scale.getConnectedValue(q))},c._angleCreation.process=c=>{q.particleContext=c,c.angle=this.angle.getConnectedValue(q)},this.particle._storedValue=c}}(0,X.f)("BABYLON.CreateParticleBlock",JU);class QU{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const q=[];for(const c of this.attachedBlocks)c.isInput&&q.push(c);return q}constructor(q){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new j.e,this.name=q}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(q)&&this.attachedBlocks.push(q);for(const U of q.inputs){const J=U.connectedPoint;if(J){const U=J.ownerBlock;U!==q&&this._initializeBlock(U,c)}}}async buildAsync(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((U=>{const J=new Cc;for(const q of this._systemBlocks)this._initializeBlock(q);for(const Q of this.systemBlocks){const U=new lc;U.buildId=this._buildId++,U.mc=q,U.verbose=c;const s=Q.createSystem(U);U.emitErrors(),J.systems.push(s)}this.onBuildObservable.notifyObservers(this),U(J)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const q=new fc("Particle system"),c=new qU("Update position");c.output.connectTo(q.particle);const U=new Ac("Position");U.contextualValue=mc.Position;const J=new Ac("Scaled direction");J.contextualValue=mc.ScaledDirection;const Q=new cU("Add");Q.operation=ec.Add,U.output.connectTo(Q.left),J.output.connectTo(Q.right),Q.output.connectTo(c.position);const s=new JU("Create particle"),g=new UU("Box shape");s.particle.connectTo(g.particle),g.output.connectTo(c.particle);const X=new Ec("Texture");X.texture.connectTo(q.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(q)}removeBlock(q){const c=this.attachedBlocks.indexOf(q);if(c>-1&&this.attachedBlocks.splice(c,1),q.isSystem){const c=this._systemBlocks.indexOf(q);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const U={};for(const J of q.aD){const q=(0,X.d)(J.customType);if(q){const c=new q;c._deserialize(J),U[J.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const J of this.attachedBlocks)if(J.isTeleportOut){const q=J,c=q._tempEntryPointUniqueId;if(c){const J=U[c];J&&J.attachToEndpoint(q)}}for(let J=0;J<q.aD.length;J++){const Q=q.aD[J],s=U[Q.id];s&&(s.inputs.length&&Q.inputs.some((q=>q.targetConnectionName))&&!c||this._restoreConnections(s,q,U))}if(q.locations||q.editorData&&q.editorData.locations){const J=q.locations||q.editorData.locations;for(const q of J)U[q.GJ]&&(q.GJ=U[q.GJ].uniqueId);c&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),q.locations?this.editorData={locations:J}:(this.editorData=q.editorData,this.editorData.locations=J);const Q=[];for(const q in U)Q[q]=U[q].uniqueId;this.editorData.map=Q}this.comment=q.comment}_restoreConnections(q,c,U){for(const J of q.outputs)for(const Q of c.aD){const s=U[Q.id];if(s)for(const g of Q.inputs)if(U[g.targetBlockId]!==q||g.targetConnectionName!==J.name);else{const q=s.getInputByName(g.inputName);if(!q||q.isConnected)continue;J.connectTo(q,!0),this._restoreConnections(s,c,U)}}}serialize(q){const c=q?{}:S.e.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let U=[];q?U=q:c.customType="BABYLON.NodeParticleSystemSet",c.aD=[];for(const J of U)c.aD.push(J.serialize());if(!q)for(const J of this.attachedBlocks)-1===U.indexOf(J)&&c.aD.push(J.serialize());return c}dispose(){for(const q of this.attachedBlocks)q.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(q){const c=new QU(q);return c.setToDefault(),c}static Parse(q){const c=S.e.Parse((()=>new QU(q.name)),q,null);return c.parseSerializedObject(q),c}static ParseFromSnippetAsync(q,c){return"_BLANK"===q?Promise.resolve(QU.CreateDefault("blank")):new Promise(((U,J)=>{const Q=new ic.d;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const g=JSON.parse(JSON.parse(Q.responseText).jsonPayload),X=JSON.parse(g.nodeParticle);c||(c=S.e.Parse((()=>new QU(q)),X,null)),c.parseSerializedObject(X),c.snippetId=q;try{U(c)}catch(s){J(s)}}else J("Unable to load the snippet "+q)})),Q.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),Q.send()}))}}QU.EditorURL=`${Rc.e._DefaultCdnUrl}/v${Lq.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,QU.SnippetUrl="https://snippet.babylonjs.com",(0,O.d)([(0,G.N)()],QU.prototype,"name",void 0),(0,O.d)([(0,G.N)("comment")],QU.prototype,"comment",void 0),function(q){q[q.None=0]="None",q[q.PerParticle=1]="PerParticle",q[q.PerSystem=2]="PerSystem"}(Bc||(Bc={}));class sU extends wc{constructor(q){super(q),this._currentLockId=-2,this.lockMode=Bc.PerParticle,this.registerInput("min",zc.AutoDetect,!0,0),this.registerInput("max",zc.AutoDetect,!0,1),this.registerOutput("output",zc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(zc.Float|zc.Int|zc.Vector2|zc.hc|zc.Pc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(zc.Float|zc.Int|zc.Vector2|zc.hc|zc.Pc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=zc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case zc.AutoDetect:case zc.Int:case zc.Float:q=q=>{const c=this.min.getConnectedValue(q)||0,U=this.max.getConnectedValue(q)||1;return c+Math.random()*(U-c)};break;case zc.Vector2:q=q=>{const c=this.min.getConnectedValue(q)||J.l.Zero(),U=this.max.getConnectedValue(q)||J.l.One();return new J.l(c.x+Math.random()*(U.x-c.x),c.y+Math.random()*(U.y-c.y))};break;case zc.hc:q=q=>{const c=this.min.getConnectedValue(q)||J.p.Zero(),U=this.max.getConnectedValue(q)||J.p.One();return new J.p(c.x+Math.random()*(U.x-c.x),c.y+Math.random()*(U.y-c.y),c.z+Math.random()*(U.z-c.z))};break;case zc.Pc:q=q=>{const c=this.min.getConnectedValue(q)||new g.e(0,0,0,0),U=this.max.getConnectedValue(q)||new g.e(1,1,1,1);return new g.e(c.x+Math.random()*(U.x-c.x),c.y+Math.random()*(U.y-c.y),c.z+Math.random()*(U.z-c.z),c.w+Math.random()*(U.w-c.w))}}this.output._storedFunction=c=>{var U;let J=0;switch(this.lockMode){case Bc.PerParticle:J=(null===(U=c.particleContext)||void 0===U?void 0:U.id)||-1;break;case Bc.PerSystem:J=c.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Bc.None&&(this._currentLockId=J),this.output._storedValue=q(c)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),this.lockMode=q.lockMode}}(0,O.d)([Lc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Bc.None},{label:"Per particle",value:Bc.PerParticle},{label:"Per system",value:Bc.PerSystem}]})],sU.prototype,"lockMode",void 0),(0,X.f)("BABYLON.ParticleRandomBlock",sU);class gU extends wc{constructor(q){super(q),this._currentLockId=-2,this.lockMode=Bc.PerParticle,this.registerInput("min",zc.AutoDetect),this.registerInput("max",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[zc.Matrix,zc.Particle,zc.Texture,zc.System,zc.FloatGradient,zc.Color4Gradient,zc.Vector2Gradient,zc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case zc.Float:case zc.Int:q=q=>{const c=this.min.getConnectedValue(q),U=this.max.getConnectedValue(q);return Math.random()*(U-c)+c};break;case zc.Vector2:q=q=>{const c=this.min.getConnectedValue(q),U=this.max.getConnectedValue(q);return new J.l(Math.random()*(U.x-c.x)+c.x,Math.random()*(U.y-c.y)+c.y)};break;case zc.hc:q=q=>{const c=this.min.getConnectedValue(q),U=this.max.getConnectedValue(q);return new J.p(Math.random()*(U.x-c.x)+c.x,Math.random()*(U.y-c.y)+c.y,Math.random()*(U.z-c.z)+c.z)};break;case zc.Pc:q=q=>{const c=this.min.getConnectedValue(q),U=this.max.getConnectedValue(q);return new g.e(Math.random()*(U.r-c.r)+c.r,Math.random()*(U.g-c.g)+c.g,Math.random()*(U.b-c.b)+c.b,Math.random()*(U.a-c.a)+c.a)}}this.output._storedFunction=c=>{var U;let J=0;switch(this.lockMode){case Bc.PerParticle:J=(null===(U=c.particleContext)||void 0===U?void 0:U.id)||-1;break;case Bc.PerSystem:J=c.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Bc.None&&(this._currentLockId=J),this.output._storedValue=q(c)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),void 0!==q.lockMode&&(this.lockMode=q.lockMode)}}(0,O.d)([Lc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Bc.None},{label:"Per particle",value:Bc.PerParticle},{label:"Per system",value:Bc.PerSystem}]})],gU.prototype,"lockMode",void 0),(0,X.f)("BABYLON.RandomRangeBlock",gU);(0,X.f)("BABYLON.ParticleLerpBlock",class extends wc{constructor(q){super(q),this.registerInput("left",zc.AutoDetect),this.registerInput("right",zc.AutoDetect),this.registerInput("gradient",zc.Float,!0,0,0,1),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(zc.Float|zc.Int|zc.Vector2|zc.hc|zc.Pc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=(q,c,U)=>(1-q)*c+q*U;this.output._storedFunction=c=>{const U=this.left.getConnectedValue(c),Q=this.right.getConnectedValue(c),s=this.gradient.getConnectedValue(c);switch(this.left.type){case zc.Int:case zc.Float:return q(s,U,Q);case zc.Vector2:return new J.l(q(s,U.x,Q.x),q(s,U.y,Q.y));case zc.hc:return new J.p(q(s,U.x,Q.x),q(s,U.y,Q.y),q(s,U.z,Q.z));case zc.Pc:return new g.e(q(s,U.r,Q.r),q(s,U.g,Q.g),q(s,U.b,Q.b),q(s,U.a,Q.a))}return 0}}});(0,X.f)("BABYLON.UpdateDirectionBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("direction",zc.hc),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.direction.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.direction.X(this.direction.getConnectedValue(q))},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}});(0,X.f)("BABYLON.UpdateColorBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("color",zc.Pc),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.color.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.color.X(this.color.getConnectedValue(q))},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}});(0,X.f)("BABYLON.UpdateScaleBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("scale",zc.Vector2),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.scale.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.scale.X(this.scale.getConnectedValue(q))},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}});(0,X.f)("BABYLON.UpdateAngleBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("angle",zc.Float),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.angle.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.angle=this.angle.getConnectedValue(q)},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}});(0,X.f)("BABYLON.BasicPositionUpdateBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(q){const c=this.particle.getConnectedValue(q),U={process:U=>{q.particleContext=U,q.systemContext=c,U.direction.scaleToRef(c._directionScale,c._scaledDirection),U.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U,this.output._storedValue=c}});(0,X.f)("BABYLON.BasicSpriteUpdateBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(q){const c=this.particle.getConnectedValue(q),U={process:U=>{q.particleContext=U,q.systemContext=c,U.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U,this.output._storedValue=c}});(0,X.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("cellIndex",zc.Int),this.registerOutput("output",zc.Particle),this.cellIndex.acceptedConnectionPointTypes=[zc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(q){const c=this.particle.getConnectedValue(q);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const U={process:U=>{q.particleContext=U,q.systemContext=c,U.cellIndex=Math.floor(this.cellIndex.getConnectedValue(q))},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U}});class XU extends wc{constructor(q){super(q),this.strength=1,this.registerInput("particle",zc.Particle),this.registerInput("flowMap",zc.Texture),this.registerOutput("output",zc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(q){var c;const U=this.particle.getConnectedValue(q),J=q.mc;let Q;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((q=>{q&&(Q=new xc(q.width,q.height,q.data))}));const s={process:q=>{const c=J.getTransformMatrix();Q&&Q._processParticle(q,this.strength*U._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};U._updateQueueStart?dq(s,U._updateQueueStart):U._updateQueueStart=s,this.output._storedValue=U}serialize(){const q=super.serialize();return q.strength=this.strength,q}_deserialize(q){super._deserialize(q),this.strength=q.strength}}(0,O.d)([Lc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XU.prototype,"strength",void 0),(0,X.f)("BABYLON.UpdateFlowMapBlock",XU);(0,X.f)("BABYLON.SphereShapeBlock",class extends wc{constructor(q){super(q),this.registerInput("input",zc.Particle),this.registerInput("radius",zc.Float,!0,1),this.registerInput("radiusRange",zc.Float,!0,1,0,1),this.registerInput("directionRandomizer",zc.Float,!0,0,0,1),this.registerOutput("output",zc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(q){const c=this.input.getConnectedValue(q);c._directionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.directionRandomizer.getConnectedValue(q),s=U.position.eU(q.emitterPosition).normalize(),g=(0,W.RandomRange)(0,Q),X=(0,W.RandomRange)(0,Q),n=(0,W.RandomRange)(0,Q);s.x+=g,s.y+=X,s.z+=n,s.normalize(),q.isEmitterTransformNode?J.p.TransformNormalFromFloatsToRef(g,X,n,q.emitterWorldMatrix,U.direction):U.direction.bc(g,X,n)},c._positionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.radius.getConnectedValue(q),s=this.radiusRange.getConnectedValue(q),g=Q-(0,W.RandomRange)(0,Q*s),X=(0,W.RandomRange)(0,1),n=(0,W.RandomRange)(0,2*Math.PI),D=Math.acos(2*X-1),u=g*Math.cos(n)*Math.sin(D),K=g*Math.cos(D),r=g*Math.sin(n)*Math.sin(D);q.isEmitterTransformNode?J.p.TransformCoordinatesFromFloatsToRef(u,K,r,q.emitterWorldMatrix,U.position):(U.position.bc(u,K,r),U.position.addInPlace(q.emitterPosition))},this.output._storedValue=c}});(0,X.f)("BABYLON.PointShapeBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("direction1",zc.hc,!0,new J.p(0,1,0)),this.registerInput("direction2",zc.hc,!0,new J.p(0,1,0)),this.registerOutput("output",zc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const c=this.particle.getConnectedValue(q);c._directionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.direction1.getConnectedValue(q),s=this.direction2.getConnectedValue(q),g=(0,W.RandomRange)(Q.x,s.x),X=(0,W.RandomRange)(Q.y,s.y),n=(0,W.RandomRange)(Q.z,s.z);q.isEmitterTransformNode?J.p.TransformNormalFromFloatsToRef(g,X,n,q.emitterWorldMatrix,U.direction):U.direction.bc(g,X,n)},c._positionCreation.process=U=>{q.systemContext=c,q.isEmitterTransformNode?J.p.TransformCoordinatesFromFloatsToRef(0,0,0,q.emitterWorldMatrix,U.position):U.position.X(q.emitterPosition)},this.output._storedValue=c}});(0,X.f)("BABYLON.CustomShapeBlock",class extends wc{constructor(q){super(q),this.registerInput("particle",zc.Particle),this.registerInput("position",zc.hc,!0,new J.p(0,0,0)),this.registerInput("direction",zc.hc,!0,new J.p(0,1,0)),this.registerOutput("output",zc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const c=this.particle.getConnectedValue(q);c._directionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.direction.getConnectedValue(q);q.isEmitterTransformNode?J.p.TransformNormalToRef(Q,q.emitterWorldMatrix,U.direction):U.direction.X(Q)},c._positionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.position.getConnectedValue(q);q.isEmitterTransformNode?J.p.TransformCoordinatesToRef(Q,q.emitterWorldMatrix,U.position):(U.position.X(Q),U.position.addInPlace(q.emitterPosition))},this.output._storedValue=c}});(0,X.f)("BABYLON.CylinderShapeBlock",class extends wc{constructor(q){super(q),this._tempVector=J.p.Zero(),this.registerInput("particle",zc.Particle),this.registerInput("radius",zc.Float,!0,1),this.registerInput("height",zc.Float,!0,1,0),this.registerInput("radiusRange",zc.Float,!0,1,0,1),this.registerInput("directionRandomizer",zc.Float,!0,0,0,1),this.registerOutput("output",zc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const c=this.particle.getConnectedValue(q);c._directionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.directionRandomizer.getConnectedValue(q);U.position.subtractToRef(q.emitterPosition,this._tempVector),this._tempVector.normalize(),q.isEmitterTransformNode&&J.p.TransformNormalToRef(this._tempVector,q.emitterInverseWorldMatrix,this._tempVector);const s=(0,W.RandomRange)(-Q/2,Q/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*Q,this._tempVector.y=s,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),q.isEmitterTransformNode?J.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q.emitterWorldMatrix,U.direction):U.direction.X(this._tempVector)},c._positionCreation.process=U=>{q.particleContext=U,q.systemContext=c;const Q=this.height.getConnectedValue(q),s=this.radiusRange.getConnectedValue(q),g=this.radius.getConnectedValue(q),X=(0,W.RandomRange)(-Q/2,Q/2),n=(0,W.RandomRange)(0,2*Math.PI),D=(0,W.RandomRange)((1-s)*(1-s),1),u=Math.sqrt(D)*g,K=u*Math.cos(n),r=u*Math.sin(n);q.isEmitterTransformNode?J.p.TransformCoordinatesFromFloatsToRef(K,X,r,q.emitterWorldMatrix,U.position):(U.position.bc(K,X,r),U.position.addInPlace(q.emitterPosition))},this.output._storedValue=c}});class nU extends wc{constructor(q){super(q),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",zc.Particle),this.registerOutput("output",zc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const c=this.particle.getConnectedValue(q);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const q=super.serialize();return q.width=this.width,q.height=this.height,q.start=this.start,q.end=this.end,q.randomStartCell=this.randomStartCell,q}_deserialize(q){super._deserialize(q),this.width=q.width,this.height=q.height,this.start=q.start,this.end=q.end,this.randomStartCell=q.randomStartCell}}(0,O.d)([Lc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nU.prototype,"start",void 0),(0,O.d)([Lc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nU.prototype,"end",void 0),(0,O.d)([Lc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nU.prototype,"width",void 0),(0,O.d)([Lc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nU.prototype,"height",void 0),(0,O.d)([Lc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nU.prototype,"loop",void 0),(0,O.d)([Lc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nU.prototype,"randomStartCell",void 0),(0,X.f)("BABYLON.SetupSpriteSheetBlock",nU);class WU extends wc{constructor(q){super(q),this.reference=0,this.registerInput("value",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case zc.Float:return zc.FloatGradient;case zc.Vector2:return zc.Vector2Gradient;case zc.hc:return zc.Vector3Gradient;case zc.Pc:return zc.Color4Gradient}return q},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(zc.Float|zc.Vector2|zc.hc|zc.Pc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=q=>null}serialize(){const q=super.serialize();return q.reference=this.reference,q}_deserialize(q){super._deserialize(q),this.reference=q.reference}}(0,O.d)([Lc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],WU.prototype,"reference",void 0),(0,X.f)("BABYLON.ParticleGradientValueBlock",WU);(0,X.f)("BABYLON.ParticleGradientBlock",class extends wc{constructor(q){super(q),this._entryCount=1,this.registerInput("gradient",zc.Float,!0,1,0,1),this.registerInput("value0",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case zc.FloatGradient:return zc.Float;case zc.Vector2Gradient:return zc.Vector2;case zc.Vector3Gradient:return zc.hc;case zc.Color4Gradient:return zc.Pc}return q},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(zc.FloatGradient|zc.Vector2Gradient|zc.Vector3Gradient|zc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(q){this._inputs[q].onConnectionObservable.add((()=>{this._entryCount>q||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),zc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const q=[];for(let U=1;U<this._inputs.length;U++){var c;if(this._inputs[U].isConnected)q.push(null===(c=this._inputs[U].connectedPoint)||void 0===c?void 0:c.ownerBlock)}q.sort(((q,c)=>q.reference-c.reference)),this.output._storedFunction=c=>{const U=this.gradient.getConnectedValue(c);if(1===q.length)return q[0].value.getConnectedValue(c);let Q=null;for(let s=q.length-1;s>=0;s--){const X=q[s];if(X.reference<=U){const q=X.value.getConnectedValue(c);if(Q){const s=Q.value.getConnectedValue(c),n=Q.reference,D=X.reference,u=Math.max(0,Math.min(1,(U-D)/(n-D)));switch(this.output.type){case zc.Float:return(0,W.Lerp)(q,s,u);case zc.Vector2:return J.l.Lerp(q,s,u);case zc.hc:return J.p.Lerp(q,s,u);case zc.Pc:return g.e.Lerp(q,s,u)}}return q}Q=X}return 0}}});(0,X.f)("BABYLON.ParticleConverterBlock",class extends wc{constructor(q){super(q),this.registerInput("color ",zc.Pc,!0),this.registerInput("xyz ",zc.hc,!0),this.registerInput("xy ",zc.Vector2,!0),this.registerInput("zw ",zc.Vector2,!0),this.registerInput("x ",zc.Float,!0),this.registerInput("y ",zc.Float,!0),this.registerInput("z ",zc.Float,!0),this.registerInput("w ",zc.Float,!0),this.registerOutput("color",zc.Pc),this.registerOutput("xyz",zc.hc),this.registerOutput("xy",zc.Vector2),this.registerOutput("zw",zc.Vector2),this.registerOutput("x",zc.Float),this.registerOutput("y",zc.Float),this.registerOutput("z",zc.Float),this.registerOutput("w",zc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(q){return"color "===q?"colorIn":"xyz "===q?"xyzIn":"xy "===q?"xyIn":"zw "===q?"zwIn":"x "===q?"xIn":"y "===q?"yIn":"z "===q?"zIn":"w "===q?"wIn":q}_outputRename(q){switch(q){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return q}}_build(q){super._build(q);const c=this.xIn,U=this.yIn,Q=this.zIn,s=this.wIn,X=this.xyIn,n=this.zwIn,W=this.xyzIn,D=this.colorIn,u=this.colorOut,K=this.xyzOut,r=this.xyOut,H=this.zwOut,b=this.xOut,h=this.yOut,o=this.zOut,a=this.wOut,p=q=>{if(D.isConnected)return D.getConnectedValue(q);let J=0,u=0,K=0,r=0;if(c.isConnected&&(J=c.getConnectedValue(q)),U.isConnected&&(u=U.getConnectedValue(q)),Q.isConnected&&(K=Q.getConnectedValue(q)),s.isConnected&&(r=s.getConnectedValue(q)),X.isConnected){const c=X.getConnectedValue(q);c&&(J=c.x,u=c.y)}if(n.isConnected){const c=n.getConnectedValue(q);c&&(K=c.x,r=c.y)}if(W.isConnected){const c=W.getConnectedValue(q);c&&(J=c.x,u=c.y,K=c.z)}return new g.e(J,u,K,r)};u._storedFunction=q=>p(q),K._storedFunction=q=>{const c=p(q);return new J.p(c.r,c.g,c.b)},r._storedFunction=q=>{const c=p(q);return new J.l(c.r,c.g)},H._storedFunction=q=>{const c=p(q);return new J.l(c.b,c.a)},b._storedFunction=q=>p(q).r,h._storedFunction=q=>p(q).g,o._storedFunction=q=>p(q).b,a._storedFunction=q=>p(q).a}}),function(q){q[q.Cos=0]="Cos",q[q.Sin=1]="Sin",q[q.Abs=2]="Abs",q[q.Exp=3]="Exp",q[q.Exp2=4]="Exp2",q[q.Round=5]="Round",q[q.Floor=6]="Floor",q[q.Ceiling=7]="Ceiling",q[q.Sqrt=8]="Sqrt",q[q.Log=9]="Log",q[q.Tan=10]="Tan",q[q.ArcTan=11]="ArcTan",q[q.ArcCos=12]="ArcCos",q[q.ArcSin=13]="ArcSin",q[q.Sign=14]="Sign",q[q.Negate=15]="Negate",q[q.OneMinus=16]="OneMinus",q[q.Reciprocal=17]="Reciprocal",q[q.ToDegrees=18]="ToDegrees",q[q.ToRadians=19]="ToRadians",q[q.Fract=20]="Fract"}(Nc||(Nc={}));class DU extends wc{constructor(q){super(q),this.operation=Nc.Cos,this.registerInput("input",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(zc.Float|zc.Int|zc.Vector2|zc.hc|zc.Pc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);let c=null;switch(this.operation){case Nc.Cos:c=q=>Math.cos(q);break;case Nc.Sin:c=q=>Math.sin(q);break;case Nc.Abs:c=q=>Math.abs(q);break;case Nc.Exp:c=q=>Math.exp(q);break;case Nc.Exp2:c=q=>Math.pow(2,q);break;case Nc.Round:c=q=>Math.round(q);break;case Nc.Floor:c=q=>Math.floor(q);break;case Nc.Ceiling:c=q=>Math.ceil(q);break;case Nc.Sqrt:c=q=>Math.sqrt(q);break;case Nc.Log:c=q=>Math.log(q);break;case Nc.Tan:c=q=>Math.tan(q);break;case Nc.ArcTan:c=q=>Math.atan(q);break;case Nc.ArcCos:c=q=>Math.acos(q);break;case Nc.ArcSin:c=q=>Math.asin(q);break;case Nc.Sign:c=q=>Math.sign(q);break;case Nc.Negate:c=q=>-q;break;case Nc.OneMinus:c=q=>1-q;break;case Nc.Reciprocal:c=q=>1/q;break;case Nc.ToRadians:c=q=>q*Math.PI/180;break;case Nc.ToDegrees:c=q=>180*q/Math.PI;break;case Nc.Fract:c=q=>q>=0?q-Math.floor(q):q-Math.ceil(q)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case zc.Int:case zc.Float:this.output._storedFunction=q=>{const U=this.input.getConnectedValue(q);return c(U)};break;case zc.Vector2:this.output._storedFunction=q=>{const U=this.input.getConnectedValue(q);return new J.l(c(U.x),c(U.y))};break;case zc.hc:this.output._storedFunction=q=>{const U=this.input.getConnectedValue(q);return new J.p(c(U.x),c(U.y),c(U.z))};break;case zc.Pc:this.output._storedFunction=q=>{const U=this.input.getConnectedValue(q);return new g.e(c(U.r),c(U.g),c(U.b),c(U.a))}}return this}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,O.d)([Lc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Nc.Cos},{label:"Sin",value:Nc.Sin},{label:"Abs",value:Nc.Abs},{label:"Exp",value:Nc.Exp},{label:"Exp2",value:Nc.Exp2},{label:"Round",value:Nc.Round},{label:"Floor",value:Nc.Floor},{label:"Ceiling",value:Nc.Ceiling},{label:"Sqrt",value:Nc.Sqrt},{label:"Log",value:Nc.Log},{label:"Tan",value:Nc.Tan},{label:"ArcTan",value:Nc.ArcTan},{label:"ArcCos",value:Nc.ArcCos},{label:"ArcSin",value:Nc.ArcSin},{label:"Sign",value:Nc.Sign},{label:"Negate",value:Nc.Negate},{label:"OneMinus",value:Nc.OneMinus},{label:"Reciprocal",value:Nc.Reciprocal},{label:"ToDegrees",value:Nc.ToDegrees},{label:"ToRadians",value:Nc.ToRadians},{label:"Fract",value:Nc.Fract}]})],DU.prototype,"operation",void 0),(0,X.f)("BABYLON.ParticleTrigonometryBlock",DU);var uU,KU=U(12354);class rU extends wc{constructor(q){super(q),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(zc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(zc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(zc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(zc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(zc.System),this._inputs[0].excludedConnectionPointTypes.push(zc.Particle),this._inputs[0].excludedConnectionPointTypes.push(zc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=q=>{const c=this.input.getConnectedValue(q);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case zc.Vector2:this.log.push([(0,KU.h)(c,4),c.toString()]);break;case zc.hc:this.log.push([(0,KU.j)(c,4),c.toString()]);break;case zc.Pc:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(q)}serialize(){const q=super.serialize();return q.stackSize=this.stackSize,q}_deserialize(q){super._deserialize(q),this.stackSize=q.stackSize}}(0,O.d)([Lc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],rU.prototype,"stackSize",void 0),(0,X.f)("BABYLON.ParticleDebugBlock",rU);(0,X.f)("BABYLON.ParticleElbowBlock",class extends wc{constructor(q){super(q),this.registerInput("input",zc.AutoDetect),this.registerOutput("output",zc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const c=this._outputs[0],U=this._inputs[0];c._storedFunction=q=>U.getConnectedValue(q)}});(0,X.f)("BABYLON.ParticleTeleportInBlock",class extends wc{get endpoints(){return this._endpoints}constructor(q){super(q),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",zc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(q))return!0;return!1}isAnAncestorOf(q){for(const c of this.endpoints){if(c===q)return!0;if(c.isAnAncestorOf(q))return!0}return!1}attachToEndpoint(q){q.detach(),this._endpoints.push(q),q._entryPoint=this,q._outputs[0]._typeConnectionSource=this._inputs[0],q._tempEntryPointUniqueId=null,q.name="> "+this.name}detachFromEndpoint(q){const c=this._endpoints.indexOf(q);-1!==c&&(this._endpoints.splice(c,1),q._outputs[0]._typeConnectionSource=null,q._entryPoint=null)}_build(){for(const q of this._endpoints)q.output._storedFunction=q=>this.input.getConnectedValue(q)}});(0,X.f)("BABYLON.ParticleTeleportOutBlock",class extends wc{constructor(q){super(q),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",zc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(q){this.entryPoint&&this.entryPoint.build(q)}clone(){const q=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(q),q}serialize(){var q;const c=super.serialize();return c.entryPoint=(null===(q=this.entryPoint)||void 0===q?void 0:q.uniqueId)??"",c}_deserialize(q){super._deserialize(q),this._tempEntryPointUniqueId=q.entryPoint}}),function(q){q[q.Equal=0]="Equal",q[q.NotEqual=1]="NotEqual",q[q.LessThan=2]="LessThan",q[q.GreaterThan=3]="GreaterThan",q[q.LessOrEqual=4]="LessOrEqual",q[q.GreaterOrEqual=5]="GreaterOrEqual",q[q.Xor=6]="Xor",q[q.Or=7]="Or",q[q.And=8]="And"}(uU||(uU={}));class HU extends wc{constructor(q){super(q),this.test=uU.Equal,this.epsilon=0,this.registerInput("left",zc.Float),this.registerInput("right",zc.Float,!0,0),this.registerInput("ifTrue",zc.AutoDetect,!0,1),this.registerInput("ifFalse",zc.AutoDetect,!0,0),this.registerOutput("output",zc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=zc.Float,this._inputs[0].acceptedConnectionPointTypes.push(zc.Int),this._inputs[1].acceptedConnectionPointTypes.push(zc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const q=q=>{const c=this.left.getConnectedValue(q),U=this.right.getConnectedValue(q);let J=!1;switch(this.test){case uU.Equal:J=(0,W.WithinEpsilon)(c,U,this.epsilon);break;case uU.NotEqual:J=!(0,W.WithinEpsilon)(c,U,this.epsilon);break;case uU.LessThan:J=c<U+this.epsilon;break;case uU.GreaterThan:J=c>U-this.epsilon;break;case uU.LessOrEqual:J=c<=U+this.epsilon;break;case uU.GreaterOrEqual:J=c>=U-this.epsilon;break;case uU.Xor:J=!!c&&!U||!c&&!!U;break;case uU.Or:J=!!c||!!U;break;case uU.And:J=!!c&&!!U}return J};this.output._storedFunction=c=>q(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const q=super.serialize();return q.test=this.test,q.epsilon=this.epsilon,q}_deserialize(q){super._deserialize(q),this.test=q.test,void 0!==q.epsilon&&(this.epsilon=q.epsilon)}}(0,O.d)([Lc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:uU.Equal},{label:"NotEqual",value:uU.NotEqual},{label:"LessThan",value:uU.LessThan},{label:"GreaterThan",value:uU.GreaterThan},{label:"LessOrEqual",value:uU.LessOrEqual},{label:"GreaterOrEqual",value:uU.GreaterOrEqual},{label:"Xor",value:uU.Xor},{label:"Or",value:uU.Or},{label:"And",value:uU.And}]})],HU.prototype,"test",void 0),(0,O.d)([Lc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HU.prototype,"epsilon",void 0),(0,X.f)("BABYLON.ParticleConditionBlock",HU);class bU extends wc{constructor(q){super(q),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",zc.Particle),this.registerInput("condition",zc.Float,!0,0),this.registerInput("system",zc.System),this.registerOutput("output",zc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){this._triggerCount=0;const c=this.input.getConnectedValue(q),U={process:U=>{if(q.particleContext=U,q.systemContext=c,0!==this.condition.getConnectedValue(q)&&(0===this.limit||this._triggerCount<this.limit)){const J=(new Date).getTime();if(this._previousOne&&J-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=J;const Q=this.system.getConnectedValue(q);if(Q){const J=jc(Q,q.mc,U.position);J.Cc.addOnce((()=>{this._triggerCount--})),c.Cc.addOnce((()=>{J.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?dq(U,c._updateQueueStart):c._updateQueueStart=U,this.output._storedValue=c}serialize(){const q=super.serialize();return q.limit=this.limit,q.delay=this.delay,q}_deserialize(q){super._deserialize(q),void 0!==q.limit&&(this.limit=q.limit),void 0!==q.delay&&(this.delay=q.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,O.d)([Lc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bU.prototype,"limit",void 0),(0,O.d)([Lc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bU.prototype,"delay",void 0),(0,X.f)("BABYLON.ParticleTriggerBlock",bU);U(12358),U(12375),U(12386),U(12435)},12428:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneFragment",s="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12392:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneFragmentDeclaration",s="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12450:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneVertex",s="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12442:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneVertexDeclaration",s="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12433:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogFragment",s="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12425:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogFragmentDeclaration",s="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12455:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogVertex",s="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12446:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogVertexDeclaration",s="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12412:(q,c,U)=>{"use strict";var J=U(10961);const Q="helperFunctions",s="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12395:(q,c,U)=>{"use strict";var J=U(10961);const Q="imageProcessingDeclaration",s="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12421:(q,c,U)=>{"use strict";var J=U(10961);const Q="imageProcessingFunctions",s="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12403:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthDeclaration",s="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12431:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthFragment",s="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12460:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthVertex",s="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";J.c.IncludesShadersStoreWGSL[Q]||(J.c.IncludesShadersStoreWGSL[Q]=s)},12386:(q,c,U)=>{"use strict";U.r(c),U.d(c,{particlesPixelShaderWGSL:()=>g});var J=U(10961);U(12392),U(12395),U(12403),U(12412),U(12421),U(12425),U(12428),U(12431),U(12433);const Q="particlesPixelShader",s="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.c.ShadersStoreWGSL[Q]||(J.c.ShadersStoreWGSL[Q]=s);const g={name:Q,shader:s}},12435:(q,c,U)=>{"use strict";U.r(c),U.d(c,{particlesVertexShaderWGSL:()=>g});var J=U(10961);U(12442),U(12446),U(12403),U(12450),U(12455),U(12460);const Q="particlesVertexShader",s="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.c.ShadersStoreWGSL[Q]||(J.c.ShadersStoreWGSL[Q]=s);const g={name:Q,shader:s}},12291:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneFragment",s="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12366:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneFragmentDeclaration",s="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12309:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneVertex",s="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12384:(q,c,U)=>{"use strict";var J=U(10961);const Q="clipPlaneVertexDeclaration",s="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12303:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogFragment",s="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12282:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogFragmentDeclaration",s="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12312:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogVertex",s="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12305:(q,c,U)=>{"use strict";var J=U(10961);const Q="fogVertexDeclaration",s="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12277:(q,c,U)=>{"use strict";var J=U(10961);const Q="helperFunctions",s="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12264:(q,c,U)=>{"use strict";var J=U(10961);const Q="imageProcessingDeclaration",s="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12279:(q,c,U)=>{"use strict";var J=U(10961);const Q="imageProcessingFunctions",s="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12270:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthDeclaration",s="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12299:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthFragment",s="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12319:(q,c,U)=>{"use strict";var J=U(10961);const Q="logDepthVertex",s="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";J.c.IncludesShadersStore[Q]||(J.c.IncludesShadersStore[Q]=s)},12358:(q,c,U)=>{"use strict";U.r(c),U.d(c,{particlesPixelShader:()=>g});var J=U(10961);U(12366),U(12264),U(12270),U(12277),U(12279),U(12282),U(12291),U(12299),U(12303);const Q="particlesPixelShader",s="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.c.ShadersStore[Q]||(J.c.ShadersStore[Q]=s);const g={name:Q,shader:s}},12375:(q,c,U)=>{"use strict";U.r(c),U.d(c,{particlesVertexShader:()=>g});var J=U(10961);U(12384),U(12305),U(12270),U(12309),U(12312),U(12319);const Q="particlesVertexShader",s="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.c.ShadersStore[Q]||(J.c.ShadersStore[Q]=s);const g={name:Q,shader:s}},12706:(q,c,U)=>{"use strict";U.r(c),U.d(c,{FlowGraphGLTFDataProvider:()=>s});var J=U(12667),Q=U(12648);class s extends J.c{constructor(q){var c,U;super();const J=q.glTF,s=(null===(c=J.animations)||void 0===c?void 0:c.map((q=>q._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Q.c,s);const g=(null===(U=J.nodes)||void 0===U?void 0:U.map((q=>q._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Q.c,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12594:(q,c,U)=>{"use strict";U.d(c,{e:()=>h,h:()=>H,l:()=>r,o:()=>b});var J=U(10833),Q=U(11328),s=U(11093),g=U(12598);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class n{constructor(q,c){this._gltf=q,this._infoTree=c}convert(q){let c,U=this._gltf,J=this._infoTree;if(!q.startsWith("/"))throw new Error("Path must start with a /");const Q=q.split("/");if(Q.shift(),Q[Q.length-1].includes(".length")){const q=Q[Q.length-1].split(".");Q.pop(),Q.push(...q)}let s=!1;for(const n of Q){const Q="length"===n;if(Q&&!J.__array__)throw new Error(`Path ${q} is invalid`);if(J.__ignoreObjectTree__&&(s=!0),J.__array__&&!Q)J=J.__array__;else if(J=J[n],!J)throw new Error(`Path ${q} is invalid`);if(!s)if(void 0===U){if(!X.find((c=>c.regex.test(q))))throw new Error(`Path ${q} is invalid`)}else if(!Q){var g;U=null===(g=U)||void 0===g?void 0:g[n]}(J.__target__||Q)&&(c=U)}return{object:c,info:J}}}function W(q,c,U,J){const Q=D(q,c);return J?Q[U][J]:Q[U]}function D(q,c,U){var J,s;return null===(J=q._data)||void 0===J||null===(s=J[(null===U||void 0===U?void 0:U.fillMode)??Q.c.MATERIAL_TriangleFillMode])||void 0===s?void 0:s.babylonMaterial}function u(q,c){return{offset:{componentsCount:2,type:"Vector2",get:(U,Q,s)=>{const g=W(U,s,q,c);return new J.l(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:D,set:(U,J,Q,s)=>{const g=W(J,s,q,c);g.uOffset=U.x,g.vOffset=U.y},getPropertyName:[()=>`${q}${c?"."+c:""}.uOffset`,()=>`${q}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(U,J,Q)=>{var s;return null===(s=W(U,Q,q,c))||void 0===s?void 0:s.wAng},getTarget:D,set:(U,J,Q,s)=>W(J,s,q,c).wAng=U,getPropertyName:[()=>`${q}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(U,Q,s)=>{const g=W(U,s,q,c);return new J.l(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:D,set:(U,J,Q,s)=>{const g=W(J,s,q,c);g.uScale=U.x,g.vScale=U.y},getPropertyName:[()=>`${q}${c?"."+c:""}.uScale`,()=>`${q}${c?"."+c:""}.vScale`]}}}const K={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:q=>{var c,U;return new J.l((null===(c=q._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(U=q._babylonCamera)||void 0===U?void 0:U.orthoRight)??0)},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=q.x,c._babylonCamera.orthoRight=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:q=>{var c,U;return new J.l((null===(c=q._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(U=q._babylonCamera)||void 0===U?void 0:U.orthoTop)??0)},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=q.x,c._babylonCamera.orthoTop=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.maxZ},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.Oc},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.Oc=q)},getTarget:q=>q,getPropertyName:[()=>"Oc"]}},perspective:{aspectRatio:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(q._babylonCamera)},getTarget:q=>q,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.fov},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.fov=q)},getTarget:q=>q,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.maxZ},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var c;return null===(c=q._babylonCamera)||void 0===c?void 0:c.Oc},set:(q,c)=>{c._babylonCamera&&(c._babylonCamera.Oc=q)},getTarget:q=>q,getPropertyName:[()=>"Oc"]}}}},nodes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"hc",get:q=>{var c;return null===(c=q._babylonTransformNode)||void 0===c?void 0:c.position},set:(q,c)=>{var U;return null===(U=c._babylonTransformNode)||void 0===U?void 0:U.position.X(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:q=>{var c;return null===(c=q._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(q,c)=>{var U,J;return null===(U=c._babylonTransformNode)||void 0===U||null===(J=U.rotationQuaternion)||void 0===J?void 0:J.X(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"hc",get:q=>{var c;return null===(c=q._babylonTransformNode)||void 0===c?void 0:c.ac},set:(q,c)=>{var U;return null===(U=c._babylonTransformNode)||void 0===U?void 0:U.ac.X(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"ac"]},weights:{length:{type:"number",get:q=>q._numMorphTargets,getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(q,c)=>{var U,J;return void 0!==c?null===(U=q._primitiveBabylonMeshes)||void 0===U||null===(J=U[0].morphTargetManager)||void 0===J?void 0:J.getTarget(c).influence:void 0},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(q,c)=>[0],getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:q=>{var c,U,Q;return J.d.Compose(null===(c=q._babylonTransformNode)||void 0===c?void 0:c.ac,null===(U=q._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion,null===(Q=q._babylonTransformNode)||void 0===Q?void 0:Q.position)},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:q=>{var c,U,Q,s;const g=J.d.Identity();let X=q.parent;for(;X&&X.parent;)X=X.parent;const n=(null===(c=q._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(U=q._babylonTransformNode)||void 0===U||null===(Q=U.rotationQuaternion)||void 0===Q?void 0:Q._isDirty)||(null===(s=q._babylonTransformNode)||void 0===s?void 0:s.ac._isDirty);if(X){var W;const c=null===(W=X._babylonTransformNode)||void 0===W?void 0:W.o(!0).invert();var D,u;if(c)null===(D=q._babylonTransformNode)||void 0===D||null===(u=D.o(n))||void 0===u||u.multiplyToRef(c,g)}else q._babylonTransformNode&&g.X(q._babylonTransformNode.o(n));return g},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:q=>{var c,U;return null===(c=q._babylonTransformNode)||void 0===c||null===(U=c.getChildren((q=>q instanceof g.c),!0)[0])||void 0===U?void 0:U.zc},getTarget:q=>{var c;return null===(c=q._babylonTransformNode)||void 0===c?void 0:c.getChildren((q=>q instanceof g.c),!0)[0]},set:(q,c)=>{if(c._babylonTransformNode){const U=c._babylonTransformNode.getChildren((q=>q instanceof g.c),!0)[0];U&&(U.zc=q)}}},color:{type:"Nc",get:q=>{var c,U;return null===(c=q._babylonTransformNode)||void 0===c||null===(U=c.getChildren((q=>q instanceof g.c),!0)[0])||void 0===U?void 0:U.dc},getTarget:q=>{var c;return null===(c=q._babylonTransformNode)||void 0===c?void 0:c.getChildren((q=>q instanceof g.c),!0)[0]},set:(q,c)=>{if(c._babylonTransformNode){const U=c._babylonTransformNode.getChildren((q=>q instanceof g.c),!0)[0];U&&(U.dc=q)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Nc",get:(q,c,U)=>D(q,c,U).emissiveColor,set:(q,c,U,J)=>D(c,U,J).emissiveColor.X(q),getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:u("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(q,c,U)=>{var J;return null===(J=W(q,U,"bumpTexture"))||void 0===J?void 0:J.level},set:(q,c,U,J)=>{const Q=W(c,J,"bumpTexture");Q&&(Q.level=q)},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:u("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(q,c,U)=>D(q,c,U).ambientTextureStrength,set:(q,c,U,J)=>{const Q=D(c,U,J);Q&&(Q.ambientTextureStrength=q)},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:u("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Pc",get:(q,c,U)=>{const J=D(q,c,U);return s.e.FromColor3(J.albedoColor,J.alpha)},set:(q,c,U,J)=>{const Q=D(c,U,J);Q.albedoColor.set(q.r,q.g,q.b),Q.alpha=q.a},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:u("albedoTexture")}},metallicFactor:{type:"number",get:(q,c,U)=>D(q,c,U).metallic,set:(q,c,U,J)=>{const Q=D(c,U,J);Q&&(Q.metallic=q)},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(q,c,U)=>D(q,c,U).roughness,set:(q,c,U,J)=>{const Q=D(c,U,J);Q&&(Q.roughness=q)},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:u("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(q,c,U)=>D(q,c,U).anisotropy.zc,set:(q,c,U,J)=>{D(c,U,J).anisotropy.zc=q},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(q,c,U)=>D(q,c,U).anisotropy.angle,set:(q,c,U,J)=>{D(c,U,J).anisotropy.angle=q},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:u("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(q,c,U)=>D(q,c,U).clearCoat.zc,set:(q,c,U,J)=>{D(c,U,J).clearCoat.zc=q},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(q,c,U)=>D(q,c,U).clearCoat.roughness,set:(q,c,U,J)=>{D(c,U,J).clearCoat.roughness=q},getTarget:(q,c,U)=>D(q,c,U),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:u("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(q,c,U)=>{var J;return null===(J=D(q,c,U).clearCoat.bumpTexture)||void 0===J?void 0:J.level},getTarget:D,set:(q,c,U,J)=>D(c,U,J).clearCoat.bumpTexture.level=q},extensions:{KHR_texture_transform:u("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:u("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(q,c,U)=>D(q,c,U).subSurface.dispersion,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.dispersion=q}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(q,c,U)=>D(q,c,U).emissiveIntensity,getTarget:D,set:(q,c,U,J)=>D(c,U,J).emissiveIntensity=q}},KHR_materials_ior:{ior:{type:"number",get:(q,c,U)=>D(q,c,U).indexOfRefraction,getTarget:D,set:(q,c,U,J)=>D(c,U,J).indexOfRefraction=q}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(q,c,U)=>D(q,c,U).iridescence.zc,getTarget:D,set:(q,c,U,J)=>D(c,U,J).iridescence.zc=q},iridescenceIor:{type:"number",get:(q,c,U)=>D(q,c,U).iridescence.indexOfRefraction,getTarget:D,set:(q,c,U,J)=>D(c,U,J).iridescence.indexOfRefraction=q},iridescenceTexture:{extensions:{KHR_texture_transform:u("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(q,c,U)=>D(q,c,U).iridescence.maximumThickness,getTarget:D,set:(q,c,U,J)=>D(c,U,J).iridescence.maximumThickness=q},iridescenceThicknessMinimum:{type:"number",get:(q,c,U)=>D(q,c,U).iridescence.minimumThickness,getTarget:D,set:(q,c,U,J)=>D(c,U,J).iridescence.minimumThickness=q},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:u("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Nc",get:(q,c,U)=>D(q,c,U).sheen.color,getTarget:D,set:(q,c,U,J)=>D(c,U,J).sheen.color.X(q)},sheenColorTexture:{extensions:{KHR_texture_transform:u("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(q,c,U)=>D(q,c,U).sheen.zc,getTarget:D,set:(q,c,U,J)=>D(c,U,J).sheen.zc=q},sheenRoughnessTexture:{extensions:{KHR_texture_transform:u("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(q,c,U)=>D(q,c,U).metallicF0Factor,getTarget:D,set:(q,c,U,J)=>D(c,U,J).metallicF0Factor=q,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Nc",get:(q,c,U)=>D(q,c,U).metallicReflectanceColor,getTarget:D,set:(q,c,U,J)=>D(c,U,J).metallicReflectanceColor.X(q),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:u("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:u("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(q,c,U)=>D(q,c,U).subSurface.refractionIntensity,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.refractionIntensity=q,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(q,c,U)=>D(q,c,U).subSurface.translucencyIntensity,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.translucencyIntensity=q},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Nc",get:(q,c,U)=>D(q,c,U).subSurface.translucencyColor,getTarget:D,set:(q,c,U,J)=>{var Q;return q&&(null===(Q=D(c,U,J).subSurface.translucencyColor)||void 0===Q?void 0:Q.X(q))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Nc",get:(q,c,U)=>D(q,c,U).subSurface.tintColor,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.tintColor.X(q)},attenuationDistance:{type:"number",get:(q,c,U)=>D(q,c,U).subSurface.tintColorAtDistance,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.tintColorAtDistance=q},thicknessFactor:{type:"number",get:(q,c,U)=>D(q,c,U).subSurface.maximumThickness,getTarget:D,set:(q,c,U,J)=>D(c,U,J).subSurface.maximumThickness=q},thicknessTexture:{extensions:{KHR_texture_transform:u("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,color:{type:"Nc",get:q=>{var c;return null===(c=q._babylonLight)||void 0===c?void 0:c.dc},set:(q,c)=>{var U;return null===(U=c._babylonLight)||void 0===U?void 0:U.dc.X(q)},getTarget:q=>q._babylonLight,getPropertyName:[q=>"diffuse"]},zc:{type:"number",get:q=>{var c;return null===(c=q._babylonLight)||void 0===c?void 0:c.zc},set:(q,c)=>c._babylonLight?c._babylonLight.zc=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"intensity"]},range:{type:"number",get:q=>{var c;return null===(c=q._babylonLight)||void 0===c?void 0:c.range},set:(q,c)=>c._babylonLight?c._babylonLight.range=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"range"]},spot:{innerConeAngle:{type:"number",get:q=>{var c;return null===(c=q._babylonLight)||void 0===c?void 0:c.innerAngle},set:(q,c)=>c._babylonLight?c._babylonLight.innerAngle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"innerConeAngle"]},outerConeAngle:{type:"number",get:q=>{var c;return null===(c=q._babylonLight)||void 0===c?void 0:c.angle},set:(q,c)=>c._babylonLight?c._babylonLight.angle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTexture)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,zc:{type:"number",get:q=>{var c;return null===(c=q._babylonTexture)||void 0===c?void 0:c.level},set:(q,c)=>{c._babylonTexture&&(c._babylonTexture.level=q)},getTarget:q=>q._babylonTexture},rotation:{type:"Quaternion",get:q=>{var c;return q._babylonTexture&&J.g.FromRotationMatrix(null===(c=q._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(q,c)=>{var U;c._babylonTexture&&(null!==(U=c._babylonTexture.Cq())&&void 0!==U&&U.useRightHandedSystem||(q=J.g.Inverse(q)),J.d.FromQuaternionToRef(q,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:q=>q._babylonTexture}}}}},animations:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>{var c;return null===(c=q.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function r(q){return new n(q,K)}function H(q){const c=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let U=K;for(const J of c)J&&(U=U[J]);if(U&&U.type&&U.get)return U}function b(q,c){const U=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let J=K;for(const Q of U)Q&&(J=J[Q]);J&&J.type&&J.get&&(J.interpolation=c)}function h(q,c){const U=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let J=K;for(const Q of U)if(Q){if(!J[Q]){if("?"===Q){J.__ignoreObjectTree__=!0;continue}J[Q]={},"__array__"===Q&&(J[Q].__target__=!0)}J=J[Q]}Object.assign(J,c)}},12602:(q,c,U)=>{"use strict";U.r(c),U.d(c,{AnimationPropertyInfo:()=>W,TransformNodeAnimationPropertyInfo:()=>D,WeightAnimationPropertyInfo:()=>u,getQuaternion:()=>X,getVector3:()=>g,getWeights:()=>n});var J=U(11468),Q=U(10833),s=U(12594);function g(q,c,U,J){return Q.p.Ic(c,U).scaleInPlace(J)}function X(q,c,U,J){return Q.g.Ic(c,U).scaleInPlace(J)}function n(q,c,U,J){const Q=new Array(q._numMorphTargets);for(let s=0;s<Q.length;s++)Q[s]=c[U++]*J;return Q}class W{constructor(q,c,U,J){this.type=q,this.name=c,this.getValue=U,this.getStride=J}_buildAnimation(q,c,U){const Q=new J.b(q,this.name,c,this.type);return Q.setKeys(U),Q}}class D extends W{buildAnimations(q,c,U,J){const Q=[];return Q.push({babylonAnimatable:q._babylonTransformNode,babylonAnimation:this._buildAnimation(c,U,J)}),Q}}class u extends W{buildAnimations(q,c,U,Q){const s=[];if(q._numMorphTargets)for(let g=0;g<q._numMorphTargets;g++){const X=new J.b(`${c}_${g}`,this.name,U,this.type);if(X.setKeys(Q.map((q=>({frame:q.frame,inTangent:q.inTangent?q.inTangent[g]:void 0,value:q.value[g],outTangent:q.outTangent?q.outTangent[g]:void 0,interpolation:q.interpolation})))),q._primitiveBabylonMeshes)for(const c of q._primitiveBabylonMeshes)if(c.morphTargetManager){const q=c.morphTargetManager.getTarget(g),U=X.clone();q.animations.push(U),s.push({babylonAnimatable:q,babylonAnimation:U})}}return s}}(0,s.o)("/nodes/{}/translation",[new D(J.b.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,s.o)("/nodes/{}/rotation",[new D(J.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,s.o)("/nodes/{}/scale",[new D(J.b.ANIMATIONTYPE_VECTOR3,"ac",g,(()=>3))]),(0,s.o)("/nodes/{}/weights",[new u(J.b.ANIMATIONTYPE_FLOAT,"influence",n,(q=>q._numMorphTargets))])},12564:(q,c,U)=>{"use strict";class J{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((q,c)=>{this._resolve=q,this._reject=c}))}}var Q=U(10833),s=U(11093),g=U(10879),X=U(11151),n=U(12569),W=U(12580),D=U(10866),u=U(11321),K=U(11468),r=U(11476),H=U(10864),b=U(10886),h=U(10895);class o{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(q){this._useTextureToStoreBoneMatrices=q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(q,c,U){this.name=q,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Q.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new D.e,this.bones=[],this._scene=U||H.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const J=this._scene.getEngine().getCaps();this._canUseTextureForBones=J.textureFloat&&J.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((q=>!q.getParent()))}getTransformMatrices(q){if(this.needInitialSkinMatrix){if(!q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return q._bonesTransformMatrices||this.prepare(!0),q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(q){return this.needInitialSkinMatrix&&q._transformMatrixTexture?q._transformMatrixTexture:this._transformMatrixTexture}Cq(){return this._scene}toString(q){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,q){c+=", Ranges: {";let q=!0;for(const U in this._ranges)q&&(c+=", ",q=!1),c+=U;c+="}"}return c}getBoneIndexByName(q){for(let c=0,U=this.bones.length;c<U;c++)if(this.bones[c].name===q)return c;return-1}createAnimationRange(q,c,U){if(!this._ranges[q]){this._ranges[q]=new r.d(q,c,U);for(let J=0,Q=this.bones.length;J<Q;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].createRange(q,c,U)}}deleteAnimationRange(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let U=0,J=this.bones.length;U<J;U++)this.bones[U].animations[0]&&this.bones[U].animations[0].deleteRange(q,c);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}getAnimationRanges(){const q=[];let c;for(c in this._ranges)q.push(this._ranges[c]);return q}copyAnimationRange(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!q.getAnimationRange(c))return!1;let J=!0;const Q=this._getHighestAnimationFrame()+1,s={},g=q.bones;let X,n;for(n=0,X=g.length;n<X;n++)s[g[n].name]=g[n];this.bones.length!==g.length&&(b.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),J=!1);const W=U&&this.dimensionsAtRest&&q.dimensionsAtRest?this.dimensionsAtRest.divide(q.dimensionsAtRest):null;for(n=0,X=this.bones.length;n<X;n++){const q=this.bones[n].name,g=s[q];g?J=J&&this.bones[n].copyAnimationRange(g,c,Q,U,W):(b.c.Warn("copyAnimationRange: not same rig, missing source bone "+q),J=!1)}const D=q.getAnimationRange(c);return D&&(this._ranges[c]=new r.d(c,D.from+Q,D.to+Q)),J}returnToRest(){for(const q of this.bones)-1!==q._index&&q.returnToRest()}_getHighestAnimationFrame(){let q=0;for(let c=0,U=this.bones.length;c<U;c++)if(this.bones[c].animations[0]){const U=this.bones[c].animations[0].getHighestFrame();q<U&&(q=U)}return q}beginAnimation(q,c,U,J){const Q=this.getAnimationRange(q);return Q?this._scene.beginAnimation(this,Q.from,Q.to,c,U,J):null}static MakeAnimationAdditive(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;const J=q.getAnimationRange(U);if(!J)return null;const Q=q._scene.getAllAnimatablesByTarget(q);let s=null;for(let X=0;X<Q.length;X++){const q=Q[X];if(q.fromFrame===(null===J||void 0===J?void 0:J.from)&&q.toFrame===(null===J||void 0===J?void 0:J.to)){s=q;break}}const g=q.getAnimatables();for(let X=0;X<g.length;X++){const q=g[X].animations;if(q)for(let J=0;J<q.length;J++)K.b.MakeAnimationAdditive(q[J],c,U)}return s&&(s.isAdditive=!0),q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(q){this._meshesWithPoseMatrix.push(q)}_unregisterMeshWithPoseMatrix(q){const c=this._meshesWithPoseMatrix.indexOf(q);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(q,c){this.onBeforeComputeObservable.notifyObservers(this);for(let U=0;U<this.bones.length;U++){const J=this.bones[U];J._childUpdateId++;const Q=J.getParent();if(Q?J.getLocalMatrix().multiplyToRef(Q.getFinalMatrix(),J.getFinalMatrix()):c?J.getLocalMatrix().multiplyToRef(c,J.getFinalMatrix()):J.getFinalMatrix().X(J.getLocalMatrix()),-1!==J._index){const c=null===J._index?U:J._index;J.getAbsoluteInverseBindMatrix().multiplyToArray(J.getFinalMatrix(),q,16*c)}}this._identity.copyToArray(q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const q=this.Cq().getRenderId();if(this._currentRenderId===q)return;this._currentRenderId=q}if(this._numBonesWithLinkedTransformNode>0)for(const q of this.bones)if(q._linkedTransformNode){const c=q._linkedTransformNode;q.position=c.position,c.rotationQuaternion?q.rotationQuaternion=c.rotationQuaternion:q.rotation=c.rotation,q.ac=c.ac}if(this.needInitialSkinMatrix)for(const q of this._meshesWithPoseMatrix){const c=q.getPoseMatrix();let U=this._isDirty;if(q._bonesTransformMatrices&&q._bonesTransformMatrices.length===16*(this.bones.length+1)||(q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),U=!0),U){if(this._synchronizedWithMesh!==q){this._synchronizedWithMesh=q;for(const q of this.bones)if(!q.getParent()){q.getBindMatrix().multiplyToRef(c,Q.j.Matrix[1]),q._updateAbsoluteBindMatrices(Q.j.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);q._transformMatrixTexture&&q._transformMatrixTexture.getSize().width===c||(q._transformMatrixTexture&&q._transformMatrixTexture.dispose(),q._transformMatrixTexture=u.e.CreateRGBATexture(q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(q._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&q._transformMatrixTexture&&q._transformMatrixTexture.update(q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=u.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let q=0;q<this.bones.length;q++)this._animatables.push(this.bones[q])}return this._animatables}clone(q,c){const U=new o(q,c||q,this._scene);U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){const q=this.bones[J];let c=null;const Q=q.getParent();if(Q){const q=this.bones.indexOf(Q);c=U.bones[q]}const s=new W.b(q.name,U,c,q.getBindMatrix().clone(),q.getRestMatrix().clone());s._index=q._index,q._linkedTransformNode&&s.linkTransformNode(q._linkedTransformNode),h.e.DeepCopy(q.animations,s.animations)}if(this._ranges){U._ranges={};for(const q in this._ranges){const c=this._ranges[q];c&&(U._ranges[q]=c.clone())}}return this._isDirty=!0,U.prepare(!0),U}enableBlending(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const U of c.animations)U.enableBlending=!0,U.blendingSpeed=q}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Cq().stopAnimation(this),this.Cq().removeSkeleton(this),this._parentContainer){const q=this._parentContainer.skeletons.indexOf(this);q>-1&&this._parentContainer.skeletons.splice(q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const q={};q.name=this.name,q.id=this.id,this.dimensionsAtRest&&(q.dimensionsAtRest=this.dimensionsAtRest.rc()),q.bones=[],q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let U=0;U<this.bones.length;U++){var c;const J=this.bones[U],Q=J.getParent(),s={parentBoneIndex:Q?this.bones.indexOf(Q):-1,index:J.getIndex(),name:J.name,id:J.id,matrix:J.getBindMatrix().rc(),rest:J.getRestMatrix().rc(),linkedTransformNodeId:null===(c=J.getTransformNode())||void 0===c?void 0:c.id};q.bones.push(s),J.length&&(s.length=J.length),J.metadata&&(s.metadata=J.metadata),J.animations&&J.animations.length>0&&(s.animation=J.animations[0].serialize()),q.ranges=[];for(const c in this._ranges){const U=this._ranges[c];if(!U)continue;const J={};J.name=c,J.from=U.from,J.to=U.to,q.ranges.push(J)}}return q}static Parse(q,c){const U=new o(q.name,q.id,c);let J;for(q.dimensionsAtRest&&(U.dimensionsAtRest=Q.p.Ic(q.dimensionsAtRest)),U.needInitialSkinMatrix=q.needInitialSkinMatrix,J=0;J<q.bones.length;J++){const c=q.bones[J],s=q.bones[J].index;let g=null;c.parentBoneIndex>-1&&(g=U.bones[c.parentBoneIndex]);const X=c.rest?Q.d.Ic(c.rest):null,n=new W.b(c.name,U,g,Q.d.Ic(c.matrix),X,null,s);void 0!==c.id&&null!==c.id&&(n.id=c.id),c.length&&(n.length=c.length),c.metadata&&(n.metadata=c.metadata),c.animation&&n.animations.push(K.b.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(U._hasWaitingData=!0,n._waitingTransformNodeId=c.linkedTransformNodeId)}if(q.ranges)for(J=0;J<q.ranges.length;J++){const c=q.ranges[J];U.createAnimationRange(c.name,c.from,c.to)}return U}computeAbsoluteMatrices(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(q)}getPoseMatrix(){let q=null;return this._meshesWithPoseMatrix.length>0&&(q=this._meshesWithPoseMatrix[0].getPoseMatrix()),q}sortBones(){const q=[],c=new Array(this.bones.length);for(let U=0;U<this.bones.length;U++)this._sortBones(U,q,c);this.bones=q}_sortBones(q,c,U){if(U[q])return;U[q]=!0;const J=this.bones[q];if(!J)return;void 0===J._index&&(J._index=q);const Q=J.getParent();Q&&this._sortBones(this.bones.indexOf(Q),c,U),c.push(J)}setCurrentPoseAsRest(){for(const q of this.bones)q.setCurrentPoseAsRest()}}var a=U(11004),p=U(11341),R=U(11288),I=U(11107),t=U(11031),C=U(11170),i=U(11119),F=U(11149),v=U(11481),Y=U(11156),k=U(12539);class V{set areUpdatesFrozen(q){q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Y.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,q||(q=H.c.LastCreatedScene),this._scene=q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=q.canUseGLVertexID&&q.textureFloat&&q.maxVertexTextureImageUnits>0&&q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return V.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?V.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(q){this._numMaxInfluencers!==q&&(this._numMaxInfluencers=q,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(q){this._useTextureToStoreTargets!==q&&(this._useTextureToStoreTargets=q,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var q;return V.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(q=this._scene)&&void 0!==q&&q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(q){return this._activeTargets.data[q]}getTarget(q){return this._targets[q]}getTargetByName(q){for(const c of this._targets)if(c.name===q)return c;return null}addTarget(q){this._targets.push(q),this._targetInfluenceChangedObservers.push(q.onInfluenceChanged.add((q=>{this.areUpdatesFrozen&&q&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(q)}))),this._targetDataLayoutChangedObservers.push(q._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(q){const c=this._targets.indexOf(q);c>=0&&(this._targets.splice(c,1),q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(q)}_bind(q){q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),q.setTexture("morphTargets",this._targetStoreTexture),q.setInt("morphTargetCount",this.numInfluencers)}clone(){const q=new V(this._scene);for(const c of this._targets)q.addTarget(c.clone());return q.enablePositionMorphing=this.enablePositionMorphing,q.enableNormalMorphing=this.enableNormalMorphing,q.enableTangentMorphing=this.enableTangentMorphing,q.enableUVMorphing=this.enableUVMorphing,q.enableUV2Morphing=this.enableUV2Morphing,q.enableColorMorphing=this.enableColorMorphing,q}serialize(){const q={};q.id=this.uniqueId,q.targets=[];for(const c of this._targets)q.targets.push(c.serialize());return q}_syncActiveTargets(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,U=this.isUsingTextureForTargets;(this._mustSynchronize||c!==U)&&(this._mustSynchronize=!1,this.synchronize());let J=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Q=-1;for(const s of this._targets)if(Q++,0!==s.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=V.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(s),this._morphTargetTextureIndices[J]=Q,this._tempInfluences[J++]=s.influence}this._morphTargetTextureIndices.length!==J&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,J)),this._influences&&this._influences.length===J||(this._influences=new Float32Array(J));for(let s=0;s<J;s++)this._influences[s]=this._tempInfluences[s];if(q&&this._scene)for(const s of this._scene.meshes)s.morphTargetManager===this&&(U?s._markSubMeshesAsAttributesDirty():s._syncGeometryWithMorphTargetManager())}synchronize(){var q;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(q=this._targetStoreTexture)||void 0===q||q.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const U of this._targets){this._supportsPositions=this._supportsPositions&&U.hasPositions,this._supportsNormals=this._supportsNormals&&U.hasNormals,this._supportsTangents=this._supportsTangents&&U.hasTangents,this._supportsUVs=this._supportsUVs&&U.hasUVs,this._supportsUV2s=this._supportsUV2s&&U.hasUV2s,this._supportsColors=this._supportsColors&&U.hasColors;const q=U.vertexCount;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void b.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${U.name}": ${q}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const q=c.getCaps().maxTextureSize;this._textureWidth>q&&(this._textureHeight=Math.ceil(this._textureWidth/q),this._textureWidth=q);const U=this._targets.length,J=new Float32Array(U*this._textureWidth*this._textureHeight*4);let Q=0;for(let c=0;c<U;c++){const q=this._targets[c],U=q.getPositions(),s=q.getNormals(),g=q.getUVs(),X=q.getTangents(),n=q.getUV2s(),W=q.getColors();Q=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&U&&(J[Q]=U[3*c],J[Q+1]=U[3*c+1],J[Q+2]=U[3*c+2],Q+=4),this._supportsNormals&&s&&(J[Q]=s[3*c],J[Q+1]=s[3*c+1],J[Q+2]=s[3*c+2],Q+=4),this._supportsUVs&&g&&(J[Q]=g[2*c],J[Q+1]=g[2*c+1],Q+=4),this._supportsTangents&&X&&(J[Q]=X[3*c],J[Q+1]=X[3*c+1],J[Q+2]=X[3*c+2],Q+=4),this._supportsUV2s&&n&&(J[Q]=n[2*c],J[Q+1]=n[2*c+1],Q+=4),this._supportsColors&&W&&(J[Q]=W[4*c],J[Q+1]=W[4*c+1],J[Q+2]=W[4*c+2],J[Q+3]=W[4*c+3],Q+=4)}this._targetStoreTexture=k.e.CreateRGBATexture(J,this._textureWidth,this._textureHeight,U,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const U of this._scene.meshes)U.morphTargetManager===this&&U._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const q=this._parentContainer.morphTargetManagers.indexOf(this);q>-1&&this._parentContainer.morphTargetManagers.splice(q,1),this._parentContainer=null}for(const q of this._targets)this._scene.stopAnimation(q)}}static Parse(q,c){const U=new V(c);for(const J of q.targets)U.addTarget(v.c.Parse(J,c));return U}}V.EnableTextureStorage=!0,V.MaxActiveMorphTargetsInVertexAttributeMode=8,V.ConstantTargetCountForTextureMode=0;var O=U(12587),G=U(10922),S=U(11050);const Z=new Map,x=Z;function z(q,c,U){y(q)&&b.c.Warn(`Extension with the name '${q}' already exists`),Z.set(q,{isGLTFExtension:c,factory:U})}function y(q){return Z.delete(q)}var M=U(12594),T=U(11542),m=U(11035);class d{static Get(q,c,U){if(!c||void 0==U||!c[U])throw new Error(`${q}: Failed to find index (${U})`);return c[U]}static TryGet(q,c){return q&&void 0!=c&&q[c]?q[c]:null}static Assign(q){if(q)for(let c=0;c<q.length;c++)q[c].index=c}}function e(q){if(q.min&&q.max){const c=q.min,U=q.max,J=Q.j.hc[0].bc(c[0],c[1],c[2]),s=Q.j.hc[1].bc(U[0],U[1],U[2]);if(q.normalized&&5126!==q.componentType){let c=1;switch(q.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const U=1/c;J.scaleInPlace(U),s.scaleInPlace(U)}return new S.e(J,s)}return null}class B{static RegisterExtension(q,c){z(q,!1,c)}static UnregisterExtension(q){return y(q)}get Vc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((q=>q.dispose&&q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(q,c,U,J,Q,s){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=U,this._loadData(J);let s=null;if(q){const c={};if(this._gltf.nodes)for(const q of this._gltf.nodes)q.name&&(c[q.name]=q.index);s=(q instanceof Array?q:[q]).map((q=>{const U=c[q];if(void 0===U)throw new Error(`Failed to find node '${q}'`);return U}))}return await this._loadAsync(Q,g,s,(()=>({meshes:this._getMeshes(),qK:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=q,this._loadData(c),await this._loadAsync(U,Q,null,(()=>{}))}async _loadAsync(q,c,U,J){return await Promise.resolve().then((async()=>{this._rootUrl=q,this._uniqueRootUrl=!q.startsWith("file:")&&c?q:`${q}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Q=`${O.j[O.j.LOADING]} => ${O.j[O.j.READY]}`,s=`${O.j[O.j.LOADING]} => ${O.j[O.j.COMPLETE]}`;this._parent._startPerformanceCounter(Q),this._parent._startPerformanceCounter(s),this._parent._setState(O.j.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(U)X.push(this.loadSceneAsync("/nodes",{nodes:U,index:-1}));else if(void 0!=this._gltf.mc||this._gltf.scenes&&this._gltf.scenes[0]){const q=d.Get("/scene",this._gltf.scenes,this._gltf.mc||0);X.push(this.loadSceneAsync(`/scenes/${q.index}`,q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let q=0;q<this._gltf.materials.length;++q){const c=this._gltf.materials[q],U="/materials/"+q,J=a.b.TriangleFillMode;X.push(this._loadMaterialAsync(U,c,null,J,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const n=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.LX(!0);for(const q of this._babylonScene.materials){const c=q;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(O.j.READY),this._skipStartAnimationStep||this._startAnimations(),J()}));return await n.then((q=>(this._parent._endPerformanceCounter(Q),g.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(s),this._parent._setState(O.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(q=>{this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()}))})),q)))})).catch((q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()),q}))}_loadData(q){if(this._gltf=q.json,this._setupData(),q.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const U=c[0];(U.byteLength<q.bin.byteLength-3||U.byteLength>q.bin.byteLength)&&b.c.Warn(`Binary buffer length (${U.byteLength}) from JSON does not match chunk length (${q.bin.byteLength})`),this._bin=q.bin}else b.c.Warn("Unexpected BIN chunk")}}_setupData(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){const q={};for(const U of this._gltf.nodes)if(U.children)for(const c of U.children)q[c]=U.index;const c=this._createRootNode();for(const U of this._gltf.nodes){const J=q[U.index];U.parent=void 0===J?c:this._gltf.nodes[J]}}}async _loadExtensionsAsync(){const q=[];if(x.forEach(((c,U)=>{var J;!1===(null===(J=this.parent.extensionOptions[U])||void 0===J?void 0:J.enabled)?c.isGLTFExtension&&this.isExtensionUsed(U)&&b.c.Warn(`Extension ${U} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(U)||q.push((async()=>{const q=await c.factory(this);return q.name!==U&&b.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${q.name} !== ${U}`),this._parent.onExtensionLoadedObservable.notifyObservers(q),q})())})),this._extensions.push(...await Promise.all(q)),this._extensions.sort(((q,c)=>(q.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const U of this._gltf.extensionsRequired){if(!this._extensions.some((q=>q.name===U&&q.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[U])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${U} is disabled`);throw new Error(`Required extension ${U} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new F.b("__root__",this._babylonScene);this._rootBabylonMesh=q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.LX(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case O.i.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],B._LoadTransform(c,this._rootBabylonMesh));break;case O.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(q),c}loadSceneAsync(q,c){const U=this._extensionsLoadSceneAsync(q,c);if(U)return U;const J=new Array;if(this.logOpen(`${q} ${c.name||""}`),c.nodes)for(const Q of c.nodes){const c=d.Get(`${q}/nodes/${Q}`,this._gltf.nodes,Q);J.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(q=>{q.parent=this._rootBabylonMesh})))}for(const Q of this._postSceneLoadActions)Q();return J.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(J).then((()=>{}))}_forEachPrimitive(q,c){if(q._primitiveBabylonMeshes)for(const U of q._primitiveBabylonMeshes)c(U)}_getGeometries(){const q=[],c=this._gltf.nodes;if(c)for(const U of c)this._forEachPrimitive(U,(c=>{const U=c.Dc;U&&-1===q.indexOf(U)&&q.push(U)}));return q}_getMeshes(){const q=[];this._rootBabylonMesh instanceof i.c&&q.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const U of c)this._forEachPrimitive(U,(c=>{q.push(c)}));return q}_getTransformNodes(){const q=[],c=this._gltf.nodes;if(c)for(const U of c)U._babylonTransformNode&&"wc"===U._babylonTransformNode.getClassName()&&q.push(U._babylonTransformNode),U._babylonTransformNodeForSkin&&q.push(U._babylonTransformNodeForSkin);return q}_getSkeletons(){const q=[],c=this._gltf.skins;if(c)for(const U of c)U._data&&q.push(U._data.babylonSkeleton);return q}_getAnimationGroups(){const q=[],c=this._gltf.animations;if(c)for(const U of c)U._babylonAnimationGroup&&q.push(U._babylonAnimationGroup);return q}_startAnimations(){switch(this._parent.animationStartMode){case O.f.NONE:break;case O.f.FIRST:{const q=this._getAnimationGroups();0!==q.length&&q[0].start(!0);break}case O.f.ALL:{const q=this._getAnimationGroups();for(const c of q)c.start(!0);break}default:return void b.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadNodeAsync(q,c,U);if(J)return J;if(c._babylonTransformNode)throw new Error(`${q}: Invalid recursive node hierarchy`);const Q=new Array;this.logOpen(`${q} ${c.name||""}`);const s=J=>{if(B.AddPointerMetadata(J,q),B._LoadTransform(c,J),void 0!=c.camera){const U=d.Get(`${q}/camera`,this._gltf.cameras,c.camera);Q.push(this.loadCameraAsync(`/cameras/${U.index}`,U,(q=>{q.parent=J,this._babylonScene.useRightHandedSystem||(J.ac.x=-1)})))}if(c.children)for(const U of c.children){const c=d.Get(`${q}/children/${U}`,this._gltf.nodes,U);Q.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(q=>{q.parent=J})))}U(J)},g=void 0!=c.mesh,X=this._parent.loadSkins&&void 0!=c.skin;if(!g||X){const q=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new I.c(q,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=U:c._babylonTransformNodeForSkin=U,s(U)}if(g)if(X){const U=d.Get(`${q}/mesh`,this._gltf.meshes,c.mesh);Q.push(this._loadMeshAsync(`/meshes/${U.index}`,c,U,(U=>{const J=c._babylonTransformNodeForSkin;U.metadata=(0,T.e)(J.metadata,U.metadata||{});const s=d.Get(`${q}/skin`,this._gltf.skins,c.skin);Q.push(this._loadSkinAsync(`/skins/${s.index}`,c,s,(q=>{this._forEachPrimitive(c,(c=>{c.skeleton=q})),this._postSceneLoadActions.push((()=>{if(void 0!=s.skeleton){const q=d.Get(`/skins/${s.index}/skeleton`,this._gltf.nodes,s.skeleton).parent;c.index===q.index?U.parent=J.parent:U.parent=q._babylonTransformNode}else U.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:J,skinnedNode:U})}))})))})))}else{const U=d.Get(`${q}/mesh`,this._gltf.meshes,c.mesh);Q.push(this._loadMeshAsync(`/meshes/${U.index}`,c,U,s))}return this.logClose(),Promise.all(Q).then((()=>(this._forEachPrimitive(c,(q=>{const c=q;!c.isAnInstance&&c.Dc&&c.Dc.useBoundingInfoFromGeometry?q.Sq():q.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(q,c,U,J){const Q=U.primitives;if(!Q||!Q.length)throw new Error(`${q}: Primitives are missing`);void 0==Q[0].index&&d.Assign(Q);const s=new Array;this.logOpen(`${q} ${U.name||""}`);const g=c.name||`node${c.index}`;if(1===Q.length){const J=U.primitives[0];s.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${J.index}`,g,c,U,J,(q=>{c._babylonTransformNode=q,c._primitiveBabylonMeshes=[q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new I.c(g,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const J of Q)s.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${J.index}`,`${g}_primitive${J.index}`,c,U,J,(q=>{q.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(q)})))}return J(c._babylonTransformNode),this.logClose(),Promise.all(s).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(q,c,U,J,Q,s){const g=this._extensionsLoadMeshPrimitiveAsync(q,c,U,J,Q,s);if(g)return g;this.logOpen(`${q}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==U.skin&&!J.primitives[0].targets;let n,W;if(X&&Q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,n=Q._instanceData.babylonSourceMesh.createInstance(c),n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W=Q._instanceData.promise;else{const s=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new F.b(c,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?a.b.CounterClockWiseSideOrientation:a.b.ClockWiseSideOrientation,this._createMorphTargets(q,U,J,Q,g),s.push(this._loadVertexDataAsync(q,Q,g).then((async c=>await this._loadMorphTargetsAsync(q,Q,g,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.Oq(g),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const D=B._GetDrawMode(q,Q.mode);if(void 0==Q.material){let q=this._defaultBabylonMaterialData[D];q||(q=this._createDefaultMaterial("__GLTFLoader._default",D),this._parent.onMaterialLoadedObservable.notifyObservers(q),this._defaultBabylonMaterialData[D]=q),g.material=q}else if(!this.parent.skipMaterials){const c=d.Get(`${q}/material`,this._gltf.materials,Q.material);s.push(this._loadMaterialAsync(`/materials/${c.index}`,c,g,D,(q=>{g.material=q})))}W=Promise.all(s),X&&(Q._instanceData={babylonSourceMesh:g,promise:W}),n=g}return B.AddPointerMetadata(n,q),this._parent.onMeshLoadedObservable.notifyObservers(n),s(n),this.logClose(),W.then((()=>n))}_loadVertexDataAsync(q,c,U){const J=this._extensionsLoadVertexDataAsync(q,c,U);if(J)return J;const Q=c.attributes;if(!Q)throw new Error(`${q}: Attributes are missing`);const s=new Array,g=new C.d(U.name,this._babylonScene);if(void 0==c.indices)U.isUnIndexed=!0;else{const U=d.Get(`${q}/indices`,this._gltf.accessors,c.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${U.index}`,U).then((q=>{g.setIndices(q)})))}const X=(c,J,X)=>{if(void 0==Q[c])return;U._delayInfo=U._delayInfo||[],-1===U._delayInfo.indexOf(J)&&U._delayInfo.push(J);const n=d.Get(`${q}/attributes/${c}`,this._gltf.accessors,Q[c]);s.push(this._loadVertexAccessorAsync(`/accessors/${n.index}`,n,J).then((q=>{if(q.getKind()===t.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!U.skeleton){const q=e(n);q&&(g._boundingInfo=q,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(q,n.count)}))),J==t.h.MatricesIndicesExtraKind&&(U.numBoneInfluencers=8),X&&X(n)};return X("POSITION",t.h.PositionKind),X("NORMAL",t.h.NormalKind),X("TANGENT",t.h.TangentKind),X("TEXCOORD_0",t.h.UVKind),X("TEXCOORD_1",t.h.UV2Kind),X("TEXCOORD_2",t.h.UV3Kind),X("TEXCOORD_3",t.h.UV4Kind),X("TEXCOORD_4",t.h.UV5Kind),X("TEXCOORD_5",t.h.UV6Kind),X("JOINTS_0",t.h.MatricesIndicesKind),X("WEIGHTS_0",t.h.MatricesWeightsKind),X("JOINTS_1",t.h.MatricesIndicesExtraKind),X("WEIGHTS_1",t.h.MatricesWeightsExtraKind),X("COLOR_0",t.h.ColorKind,(q=>{"VEC4"===q.type&&(U.hasVertexAlpha=!0)})),Promise.all(s).then((()=>g))}_createMorphTargets(q,c,U,J,Q){if(!J.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=J.targets.length;else if(J.targets.length!==c._numMorphTargets)throw new Error(`${q}: Primitives do not have the same number of targets`);const s=U.extras?U.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Q.morphTargetManager=new V(this._babylonScene),Q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<J.targets.length;g++){const q=c.weights?c.weights[g]:U.weights?U.weights[g]:0,J=s?s[g]:`morphTarget${g}`;Q.morphTargetManager.addTarget(new v.c(J,q,Q.Cq()))}}_loadMorphTargetsAsync(q,c,U,J){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Q=new Array,s=U.morphTargetManager;for(let g=0;g<s.numTargets;g++){const U=s.getTarget(g);Q.push(this._loadMorphTargetVertexDataAsync(`${q}/targets/${g}`,J,c.targets[g],U))}return Promise.all(Q).then((()=>{s.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(q,c,U,J){const Q=new Array,s=(J,s,g)=>{if(void 0==U[J])return;const X=c.getVertexBuffer(s);if(!X)return;const n=d.Get(`${q}/${J}`,this._gltf.accessors,U[J]);Q.push(this._loadFloatAccessorAsync(`/accessors/${n.index}`,n).then((q=>{g(X,q)})))};return s("POSITION",t.h.PositionKind,((q,c)=>{const U=new Float32Array(c.length);q.forEach(c.length,((q,J)=>{U[J]=c[J]+q})),J.setPositions(U)})),s("NORMAL",t.h.NormalKind,((q,c)=>{const U=new Float32Array(c.length);q.forEach(U.length,((q,J)=>{U[J]=c[J]+q})),J.setNormals(U)})),s("TANGENT",t.h.TangentKind,((q,c)=>{const U=new Float32Array(c.length/3*4);let Q=0;q.forEach(c.length/3*4,((q,J)=>{(J+1)%4!==0&&(U[Q]=c[Q]+q,Q++)})),J.setTangents(U)})),s("TEXCOORD_0",t.h.UVKind,((q,c)=>{const U=new Float32Array(c.length);q.forEach(c.length,((q,J)=>{U[J]=c[J]+q})),J.setUVs(U)})),s("TEXCOORD_1",t.h.UV2Kind,((q,c)=>{const U=new Float32Array(c.length);q.forEach(c.length,((q,J)=>{U[J]=c[J]+q})),J.setUV2s(U)})),s("COLOR_0",t.h.ColorKind,((c,U)=>{let Q=null;const s=c.getSize();if(3===s){Q=new Float32Array(U.length/3*4),c.forEach(U.length,((q,c)=>{const J=Math.floor(c/3),s=c%3;Q[4*J+s]=U[3*J+s]+q}));for(let q=0;q<U.length/3;++q)Q[4*q+3]=1}else{if(4!==s)throw new Error(`${q}: Invalid number of components (${s}) for COLOR_0 attribute`);Q=new Float32Array(U.length),c.forEach(U.length,((q,c)=>{Q[c]=U[c]+q}))}J.setColors(Q)})),await Promise.all(Q).then((()=>{}))}static _LoadTransform(q,c){if(void 0!=q.skin)return;let U=Q.p.Zero(),J=Q.g.Identity(),s=Q.p.One();if(q.matrix){Q.d.Ic(q.matrix).decompose(s,J,U)}else q.translation&&(U=Q.p.Ic(q.translation)),q.rotation&&(J=Q.g.Ic(q.rotation)),q.scale&&(s=Q.p.Ic(q.scale));c.position=U,c.rotationQuaternion=J,c.ac=s}_loadSkinAsync(q,c,U,J){if(!this._parent.loadSkins)return Promise.resolve();const Q=this._extensionsLoadSkinAsync(q,c,U);if(Q)return Q;if(U._data)return J(U._data.babylonSkeleton),U._data.promise;const s=`skeleton${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new o(U.name||s,s,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(q,U,g);const X=this._loadSkinInverseBindMatricesDataAsync(q,U).then((q=>{this._updateBoneMatrices(g,q)}));return U._data={babylonSkeleton:g,promise:X},J(g),X}_loadBones(q,c,U){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const U=this._findSkeletonRootNode(`${q}/joints`,c.joints);if(U)if(void 0===c.skeleton)c.skeleton=U.index;else{const J=(q,c)=>{for(;c.parent;c=c.parent)if(c.parent===q)return!0;return!1},Q=d.Get(`${q}/skeleton`,this._gltf.nodes,c.skeleton);Q===U||J(Q,U)||(b.c.Warn(`${q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=U.index)}else b.c.Warn(`${q}: Failed to find common root`)}const J={};for(const Q of c.joints){const s=d.Get(`${q}/joints/${Q}`,this._gltf.nodes,Q);this._loadBone(s,c,U,J)}}_findSkeletonRootNode(q,c){if(0===c.length)return null;const U={};for(const Q of c){const c=[];let J=d.Get(`${q}/${Q}`,this._gltf.nodes,Q);for(;-1!==J.index;)c.unshift(J),J=J.parent;U[Q]=c}let J=null;for(let Q=0;;++Q){let q=U[c[0]];if(Q>=q.length)return J;const s=q[Q];for(let g=1;g<c.length;++g)if(q=U[c[g]],Q>=q.length||s!==q[Q])return J;J=s}}_loadBone(q,c,U,J){q._isJoint=!0;let Q=J[q.index];if(Q)return Q;let s=null;q.index!==c.skeleton&&(q.parent&&-1!==q.parent.index?s=this._loadBone(q.parent,c,U,J):void 0!==c.skeleton&&b.c.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const g=c.joints.indexOf(q.index);return Q=new W.b(q.name||`joint${q.index}`,U,s,this._getNodeMatrix(q),null,null,g),J[q.index]=Q,this._postSceneLoadActions.push((()=>{Q.linkTransformNode(q._babylonTransformNode)})),Q}_loadSkinInverseBindMatricesDataAsync(q,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const U=d.Get(`${q}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)}_updateBoneMatrices(q,c){for(const U of q.bones){const q=Q.d.Identity(),J=U._index;c&&-1!==J&&(Q.d.FromArrayToRef(c,16*J,q),q.invertToRef(q));const s=U.getParent();s&&q.multiplyToRef(s.getAbsoluteInverseBindMatrix(),q),U.vc(q,!1,!1),U._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(q){return q.matrix?Q.d.Ic(q.matrix):Q.d.Compose(q.scale?Q.p.Ic(q.scale):Q.p.One(),q.rotation?Q.g.Ic(q.rotation):Q.g.Identity(),q.translation?Q.p.Ic(q.translation):Q.p.Zero())}loadCameraAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadCameraAsync(q,c,U);if(J)return J;const s=new Array;this.logOpen(`${q} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new n.b(c.name||`camera${c.index}`,Q.p.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=g,g.setTarget(new Q.p(0,0,-1)),c.type){case"perspective":{const U=c.perspective;if(!U)throw new Error(`${q}: Camera perspective properties are missing`);g.fov=U.yfov,g.Oc=U.znear,g.maxZ=U.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${q}: Camera orthographic properties are missing`);g.mode=X.d.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-c.orthographic.xmag,g.orthoRight=c.orthographic.xmag,g.orthoBottom=-c.orthographic.ymag,g.orthoTop=c.orthographic.ymag,g.Oc=c.orthographic.znear,g.maxZ=c.orthographic.zfar;break;default:throw new Error(`${q}: Invalid camera type (${c.type})`)}return B.AddPointerMetadata(g,q),this._parent.onCameraLoadedObservable.notifyObservers(g),U(g),this.logClose(),Promise.all(s).then((()=>g))}_loadAnimationsAsync(){const q=this._gltf.animations;if(!q)return Promise.resolve();const c=new Array;for(let U=0;U<q.length;U++){const J=q[U];c.push(this.loadAnimationAsync(`/animations/${J.index}`,J).then((q=>{0===q.targetedAnimations.length&&q.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(q,c){const J=this._extensionsLoadAnimationAsync(q,c);return J||U.e(58).then(U.bind(U,14039)).then((U=>{let{AnimationGroup:J}=U;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new J(c.name||`animation${c.index}`,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=Q;const s=new Array;d.Assign(c.channels),d.Assign(c.samplers);for(const g of c.channels)s.push(this._loadAnimationChannelAsync(`${q}/channels/${g.index}`,q,c,g,((q,c)=>{q.animations=q.animations||[],q.animations.push(c),Q.addTargetedAnimation(c,q)})));return Promise.all(s).then((()=>(Q.normalize(0),Q)))}))}async _loadAnimationChannelAsync(q,c,J,Q,s){const g=this._extensionsLoadAnimationChannelAsync(q,c,J,Q,s);if(g)return await g;if(void 0==Q.target.node)return await Promise.resolve();const X=d.Get(`${q}/target/node`,this._gltf.nodes,Q.target.node),n=Q.target.path,W="weights"===n;if(W&&!X._numMorphTargets||!W&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!W&&!X._isJoint)return await Promise.resolve();let D;switch(await Promise.resolve().then(U.bind(U,12602)),n){case"translation":var u;D=null===(u=(0,M.h)("/nodes/{}/translation"))||void 0===u?void 0:u.interpolation;break;case"rotation":var K;D=null===(K=(0,M.h)("/nodes/{}/rotation"))||void 0===K?void 0:K.interpolation;break;case"scale":var r;D=null===(r=(0,M.h)("/nodes/{}/scale"))||void 0===r?void 0:r.interpolation;break;case"weights":var H;D=null===(H=(0,M.h)("/nodes/{}/weights"))||void 0===H?void 0:H.interpolation;break;default:throw new Error(`${q}/target/path: Invalid value (${Q.target.path})`)}if(!D)throw new Error(`${q}/target/path: Could not find interpolation properties for target path (${Q.target.path})`);const b={object:X,info:D};return await this._loadAnimationChannelFromTargetInfoAsync(q,c,J,Q,b,s)}_loadAnimationChannelFromTargetInfoAsync(q,c,U,J,Q,s){const g=this.parent.targetFps,X=1/g,n=d.Get(`${q}/sampler`,U.samplers,J.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${J.sampler}`,n).then((q=>{let c=0;const n=Q.object,W=Q.info;for(const Q of W){const W=Q.getStride(n),D=q.input,u=q.output,K=new Array(D.length);let r=0;switch(q.interpolation){case"STEP":for(let q=0;q<D.length;q++){const c=Q.getValue(n,u,r,1);r+=W,K[q]={frame:D[q]*g,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let q=0;q<D.length;q++){const c=Q.getValue(n,u,r,X);r+=W;const U=Q.getValue(n,u,r,1);r+=W;const J=Q.getValue(n,u,r,X);r+=W,K[q]={frame:D[q]*g,inTangent:c,value:U,outTangent:J}}break;case"LINEAR":for(let q=0;q<D.length;q++){const c=Q.getValue(n,u,r,1);r+=W,K[q]={frame:D[q]*g,value:c}}}if(r>0){const q=`${U.name||`animation${U.index}`}_channel${J.index}_${c}`,X=Q.buildAnimations(n,q,g,K);for(const U of X)c++,s(U.babylonAnimatable,U.babylonAnimation)}}}))}_loadAnimationSamplerAsync(q,c){if(c._data)return c._data;const U=c.interpolation||"LINEAR";switch(U){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${q}/interpolation: Invalid value (${c.interpolation})`)}const J=d.Get(`${q}/input`,this._gltf.accessors,c.input),Q=d.Get(`${q}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${J.index}`,J),this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)]).then((q=>{let[c,J]=q;return{input:c,interpolation:U,output:J}})),c._data}loadBufferAsync(q,c,U,J){const Q=this._extensionsLoadBufferAsync(q,c,U,J);if(Q)return Q;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${q}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+U,J)}catch(Q){throw new Error(`${q}: ${Q.message}`)}}))}loadBufferViewAsync(q,c){const U=this._extensionsLoadBufferViewAsync(q,c);if(U)return U;if(c._data)return c._data;const J=d.Get(`${q}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${J.index}`,J,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(q,c,U){if(c._data)return c._data;const J=B._GetNumComponents(q,c.type),Q=J*t.h.GetTypeByteLength(c.componentType),s=J*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new U(s));else{const g=d.Get(`${q}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((X=>{if(5126!==c.componentType||c.normalized||g.byteStride&&g.byteStride!==Q){const q=new U(s);return t.h.ForEach(X,c.byteOffset||0,g.byteStride||Q,J,c.componentType,q.length,c.normalized||!1,((c,U)=>{q[U]=c})),q}return B._GetTypedArray(q,c.componentType,X,c.byteOffset,s)}))}if(c.sparse){const s=c.sparse;c._data=c._data.then((g=>{const X=g,n=d.Get(`${q}/sparse/indices/bufferView`,this._gltf.bufferViews,s.indices.bufferView),W=d.Get(`${q}/sparse/values/bufferView`,this._gltf.bufferViews,s.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${n.index}`,n),this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)]).then((g=>{let[n,W]=g;const D=B._GetTypedArray(`${q}/sparse/indices`,s.indices.componentType,n,s.indices.byteOffset,s.count),u=J*s.count;let K;if(5126!==c.componentType||c.normalized){const g=B._GetTypedArray(`${q}/sparse/values`,c.componentType,W,s.values.byteOffset,u);K=new U(u),t.h.ForEach(g,0,Q,J,c.componentType,K.length,c.normalized||!1,((q,c)=>{K[c]=q}))}else K=B._GetTypedArray(`${q}/sparse/values`,c.componentType,W,s.values.byteOffset,u);let r=0;for(let q=0;q<D.length;q++){let c=D[q]*J;for(let q=0;q<J;q++)X[c++]=K[r++]}return X}))}))}return c._data}_loadFloatAccessorAsync(q,c){return this._loadAccessorAsync(q,c,Float32Array)}_loadIndicesAccessorAsync(q,c){if("SCALAR"!==c.type)throw new Error(`${q}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${q}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const U=B._GetTypedArrayConstructor(`${q}/componentType`,c.componentType);c._data=this._loadAccessorAsync(q,c,U)}else{const U=d.Get(`${q}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((U=>B._GetTypedArray(q,c.componentType,U,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(q){if(q._babylonBuffer)return q._babylonBuffer;const c=this._babylonScene.getEngine();return q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>new t.e(c,q,!1))),q._babylonBuffer}_loadVertexAccessorAsync(q,c,U){var J;if(null!==(J=c._babylonVertexBuffer)&&void 0!==J&&J[U])return c._babylonVertexBuffer[U];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const Q=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[U]=this._loadFloatAccessorAsync(q,c).then((q=>new t.h(Q,q,U,!1)));else{const J=d.Get(`${q}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[U]=this._loadVertexBufferViewAsync(J).then((s=>{const g=B._GetNumComponents(q,c.type);return new t.h(Q,s,U,!1,void 0,J.byteStride,void 0,c.byteOffset,g,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[U]}_loadMaterialMetallicRoughnessPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return c&&(c.baseColorFactor?(U.albedoColor=s.c.Ic(c.baseColorFactor),U.alpha=c.baseColorFactor[3]):U.albedoColor=s.c.White(),U.metallic=void 0==c.metallicFactor?1:c.metallicFactor,U.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&J.push(this.loadTextureInfoAsync(`${q}/baseColorTexture`,c.baseColorTexture,(q=>{q.name=`${U.name} (Base Color)`,U.albedoTexture=q}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${q}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(q=>{q.name=`${U.name} (Metallic Roughness)`,U.metallicTexture=q}))),U.useMetallnessFromMetallicTextureBlue=!0,U.useRoughnessFromMetallicTextureGreen=!0,U.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(J).then((()=>{}))}_loadMaterialAsync(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const s=this._extensionsLoadMaterialAsync(q,c,U,J,Q);if(s)return s;c._data=c._data||{};let g=c._data[J];if(!g){this.logOpen(`${q} ${c.name||""}`);const U=this.createMaterial(q,c,J);g={babylonMaterial:U,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(q,c,U)},c._data[J]=g,B.AddPointerMetadata(U,q),this._parent.onMaterialLoadedObservable.notifyObservers(U),this.logClose()}return U&&(g.babylonMeshes.push(U),U.Cc.addOnce((()=>{const q=g.babylonMeshes.indexOf(U);-1!==q&&g.babylonMeshes.splice(q,1)}))),Q(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(q,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new p.d(q,this._babylonScene);return U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.fillMode=c,U.enableSpecularAntiAliasing=!0,U.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,U.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,U.transparencyMode=p.d.PBRMATERIAL_OPAQUE,U.metallic=1,U.roughness=1,U}createMaterial(q,c,U){const J=this._extensionsCreateMaterial(q,c,U);if(J)return J;const Q=c.name||`material${c.index}`;return this._createDefaultMaterial(Q,U)}loadMaterialPropertiesAsync(q,c,U){const J=this._extensionsLoadMaterialPropertiesAsync(q,c,U);if(J)return J;const Q=new Array;return Q.push(this.loadMaterialBasePropertiesAsync(q,c,U)),c.pbrMetallicRoughness&&Q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${q}/pbrMetallicRoughness`,c.pbrMetallicRoughness,U)),this.loadMaterialAlphaProperties(q,c,U),Promise.all(Q).then((()=>{}))}loadMaterialBasePropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.emissiveColor=c.emissiveFactor?s.c.Ic(c.emissiveFactor):new s.c(0,0,0),c.doubleSided&&(U.Kc=!1,U.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${q}/normalTexture`,c.normalTexture,(q=>{q.name=`${U.name} (Normal)`,U.bumpTexture=q}))),U.invertNormalMapX=!this._babylonScene.useRightHandedSystem,U.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&U.bumpTexture&&(U.bumpTexture.level=c.normalTexture.scale),U.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${q}/occlusionTexture`,c.occlusionTexture,(q=>{q.name=`${U.name} (Occlusion)`,U.ambientTexture=q}))),U.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(U.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&J.push(this.loadTextureInfoAsync(`${q}/emissiveTexture`,c.emissiveTexture,(q=>{q.name=`${U.name} (Emissive)`,U.emissiveTexture=q}))),Promise.all(J).then((()=>{}))}loadMaterialAlphaProperties(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":U.transparencyMode=p.d.PBRMATERIAL_OPAQUE,U.alpha=1;break;case"MASK":U.transparencyMode=p.d.PBRMATERIAL_ALPHATEST,U.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,U.albedoTexture&&(U.albedoTexture.Hc=!0);break;case"BLEND":U.transparencyMode=p.d.PBRMATERIAL_ALPHABLEND,U.albedoTexture&&(U.albedoTexture.Hc=!0,U.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${q}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureInfoAsync(q,c,U);if(J)return J;if(this.logOpen(`${q}`),c.texCoord>=6)throw new Error(`${q}/texCoord: Invalid value (${c.texCoord})`);const Q=d.Get(`${q}/index`,this._gltf.textures,c.index);Q._textureInfo=c;const s=this._loadTextureAsync(`/textures/${c.index}`,Q,(J=>{J.coordinatesIndex=c.texCoord||0,B.AddPointerMetadata(J,q),this._parent.onTextureLoadedObservable.notifyObservers(J),U(J)}));return this.logClose(),s}_loadTextureAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureAsync(q,c,U);if(J)return J;this.logOpen(`${q} ${c.name||""}`);const Q=void 0==c.sampler?B.DefaultSampler:d.Get(`${q}/sampler`,this._gltf.samplers,c.sampler),s=d.Get(`${q}/source`,this._gltf.images,c.source),g=this._createTextureAsync(q,Q,s,U,void 0,!c._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},s=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${c.index}`,c),n=new Array,W=new J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,L:()=>{this._disposed||W.resolve()},onError:(c,U)=>{this._disposed||W.reject(new Error(`${q}: ${U&&U.message?U.message:c||"Failed to load texture"}`))},mimeType:U.mimeType??(0,G.f)(U.uri??""),loaderOptions:s,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},u=new R.c(null,this._babylonScene,D);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.push(W.promise),n.push(this.loadImageAsync(`/images/${U.index}`,U).then((q=>{const c=U.uri||`${this._fileName}#image${U.index}`,J=`data:${this._uniqueRootUrl}${c}`;u.updateURL(J,q);const Q=u.getInternalTexture();Q&&(Q.label=U.name)}))),u.wrapU=X.wrapU,u.wrapV=X.wrapV,Q(u),this._parent.useGltfTextureNames&&(u.name=U.name||U.uri||`image${U.index}`),Promise.all(n).then((()=>u))}_loadSampler(q,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:B._GetTextureSamplingMode(q,c),wrapU:B._GetTextureWrapMode(`${q}/wrapS`,c.wrapS),wrapV:B._GetTextureWrapMode(`${q}/wrapT`,c.wrapT)}),c._data}loadImageAsync(q,c){if(!c._data){if(this.logOpen(`${q} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${q}/uri`,c,c.uri);else{const U=d.Get(`${q}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}this.logClose()}return c._data}loadUriAsync(q,c,U){const J=this._extensionsLoadUriAsync(q,c,U);if(J)return J;if(!B._ValidateUri(U))throw new Error(`${q}: '${U}' is invalid`);if((0,G.i)(U)){const c=new Uint8Array((0,G.c)(U));return this.log(`${q}: Decoded ${U.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${q}: Loading ${U}`),this._parent.preprocessUrlAsync(this._rootUrl+U).then((c=>new Promise(((J,Q)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${q}: Loaded ${U} (${c.byteLength} bytes)`),J(new Uint8Array(c)))}),!0,(c=>{Q(new G.m(`${q}: Failed to load '${U}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(q,c){q.metadata=q.metadata||{};const U=q._internalMetadata=q._internalMetadata||{},J=U.Vc=U.Vc||{};(J.pointers=J.pointers||[]).push(c)}static _GetTextureWrapMode(q,c){switch(c=void 0==c?10497:c){case 33071:return R.c.CLAMP_ADDRESSMODE;case 33648:return R.c.MIRROR_ADDRESSMODE;case 10497:return R.c.WRAP_ADDRESSMODE;default:return b.c.Warn(`${q}: Invalid value (${c})`),R.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(q,c){const U=void 0==c.magFilter?9729:c.magFilter,J=void 0==c.minFilter?9987:c.minFilter;if(9729===U)switch(J){case 9728:return R.c.LINEAR_NEAREST;case 9729:return R.c.LINEAR_LINEAR;case 9984:return R.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return R.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return R.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return R.c.LINEAR_LINEAR_MIPLINEAR;default:return b.c.Warn(`${q}/minFilter: Invalid value (${J})`),R.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==U&&b.c.Warn(`${q}/magFilter: Invalid value (${U})`),J){case 9728:return R.c.NEAREST_NEAREST;case 9729:return R.c.NEAREST_LINEAR;case 9984:return R.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return R.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return R.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return R.c.NEAREST_LINEAR_MIPLINEAR;default:return b.c.Warn(`${q}/minFilter: Invalid value (${J})`),R.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(q,c){try{return(0,m.q)(c)}catch(U){throw new Error(`${q}: ${U.message}`)}}static _GetTypedArray(q,c,U,J,Q){const s=U.buffer;J=U.byteOffset+(J||0);const g=B._GetTypedArrayConstructor(`${q}/componentType`,c),X=t.h.GetTypeByteLength(c);return J%X!==0?(b.c.Warn(`${q}: Copying buffer as byte offset (${J}) is not a multiple of component type byte length (${X})`),new g(s.slice(J,J+Q*X),0)):new g(s,J,Q)}static _GetNumComponents(q,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${q}: Invalid type (${c})`)}static _ValidateUri(q){return g.e.IsBase64(q)||-1===q.indexOf("..")}static _GetDrawMode(q,c){switch(void 0==c&&(c=4),c){case 0:return a.b.PointListDrawMode;case 1:return a.b.LineListDrawMode;case 2:return a.b.LineLoopDrawMode;case 3:return a.b.LineStripDrawMode;case 4:return a.b.TriangleFillMode;case 5:return a.b.TriangleStripDrawMode;case 6:return a.b.TriangleFanDrawMode}throw new Error(`${q}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const q=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const U in c._data){const J=c._data[U];for(const c of J.babylonMeshes){c.o(!0);const U=J.babylonMaterial;q.push(U.forceCompilationAsync(c)),q.push(U.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(q.push(U.forceCompilationAsync(c,{clipPlane:!0})),q.push(U.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const q=new Array,c=this._babylonScene.lights;for(const U of c){const c=U.getShadowGenerator();c&&q.push(c.forceCompilationAsync())}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(q){for(const c of this._extensions)c.enabled&&q(c)}_applyExtensions(q,c,U){for(const J of this._extensions)if(J.enabled){const Q=`${J.name}.${c}`,s=q;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};const g=s._activeLoaderExtensionFunctions;if(!g[Q]){g[Q]=!0;try{const q=U(J);if(q)return q}finally{delete g[Q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((q=>q.onLoading&&q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((q=>q.onReady&&q.onReady()))}_extensionsLoadSceneAsync(q,c){return this._applyExtensions(c,"loadScene",(U=>U.loadSceneAsync&&U.loadSceneAsync(q,c)))}_extensionsLoadNodeAsync(q,c,U){return this._applyExtensions(c,"loadNode",(J=>J.loadNodeAsync&&J.loadNodeAsync(q,c,U)))}_extensionsLoadCameraAsync(q,c,U){return this._applyExtensions(c,"loadCamera",(J=>J.loadCameraAsync&&J.loadCameraAsync(q,c,U)))}_extensionsLoadVertexDataAsync(q,c,U){return this._applyExtensions(c,"loadVertexData",(J=>J._loadVertexDataAsync&&J._loadVertexDataAsync(q,c,U)))}_extensionsLoadMeshPrimitiveAsync(q,c,U,J,Q,s){return this._applyExtensions(Q,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(q,c,U,J,Q,s)))}_extensionsLoadMaterialAsync(q,c,U,J,Q){return this._applyExtensions(c,"loadMaterial",(s=>s._loadMaterialAsync&&s._loadMaterialAsync(q,c,U,J,Q)))}_extensionsCreateMaterial(q,c,U){return this._applyExtensions(c,"createMaterial",(J=>J.createMaterial&&J.createMaterial(q,c,U)))}_extensionsLoadMaterialPropertiesAsync(q,c,U){return this._applyExtensions(c,"loadMaterialProperties",(J=>J.loadMaterialPropertiesAsync&&J.loadMaterialPropertiesAsync(q,c,U)))}_extensionsLoadTextureInfoAsync(q,c,U){return this._applyExtensions(c,"loadTextureInfo",(J=>J.loadTextureInfoAsync&&J.loadTextureInfoAsync(q,c,U)))}_extensionsLoadTextureAsync(q,c,U){return this._applyExtensions(c,"loadTexture",(J=>J._loadTextureAsync&&J._loadTextureAsync(q,c,U)))}_extensionsLoadAnimationAsync(q,c){return this._applyExtensions(c,"loadAnimation",(U=>U.loadAnimationAsync&&U.loadAnimationAsync(q,c)))}_extensionsLoadAnimationChannelAsync(q,c,U,J,Q){return this._applyExtensions(U,"loadAnimationChannel",(s=>s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(q,c,U,J,Q)))}_extensionsLoadSkinAsync(q,c,U){return this._applyExtensions(U,"loadSkin",(J=>J._loadSkinAsync&&J._loadSkinAsync(q,c,U)))}_extensionsLoadUriAsync(q,c,U){return this._applyExtensions(c,"loadUri",(J=>J._loadUriAsync&&J._loadUriAsync(q,c,U)))}_extensionsLoadBufferViewAsync(q,c){return this._applyExtensions(c,"loadBufferView",(U=>U.loadBufferViewAsync&&U.loadBufferViewAsync(q,c)))}_extensionsLoadBufferAsync(q,c,U,J){return this._applyExtensions(c,"loadBuffer",(Q=>Q.loadBufferAsync&&Q.loadBufferAsync(q,c,U,J)))}static LoadExtensionAsync(q,c,U,J){if(!c.extensions)return null;const Q=c.extensions[U];return Q?J(`${q}/extensions/${U}`,Q):null}static LoadExtraAsync(q,c,U,J){if(!c.extras)return null;const Q=c.extras[U];return Q?J(`${q}/extras/${U}`,Q):null}isExtensionUsed(q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(q)}logOpen(q){this._parent._logOpen(q)}logClose(){this._parent._logClose()}log(q){this._parent._log(q)}startPerformanceCounter(q){this._parent._startPerformanceCounter(q)}endPerformanceCounter(q){this._parent._endPerformanceCounter(q)}}B.DefaultSampler={index:-1},O.d._CreateGLTF2Loader=q=>new B(q);var N=U(12602),P=U(11258),w=U(11082),L=U(12605),l=U(12610);class j extends l.c{constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",q),this._texture=q.getEngine().createRawCubeTexture(c,U,J,Q,s,g,X,n)}update(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,q,c,U,J,Q)}updateRGBDAsync(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,L.q)(this._texture,q,c,U,J).then((()=>{}))}clone(){return w.e.Clone((()=>{const q=this.Cq(),c=this._texture,U=new j(q,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&U.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),U}),this)}}const f="EXT_lights_image_based";class A{constructor(q){this.name=f,this._loader=q,this.enabled=this._loader.isExtensionUsed(f)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.Vc.extensions;if(q&&q[this.name]){const c=q[this.name];this._lights=c.lights}}loadSceneAsync(q,c){return B.LoadExtensionAsync(q,c,this.name,(async(U,J)=>{this._loader._allMaterialsDirtyRequired=!0;const Q=new Array;Q.push(this._loader.loadSceneAsync(q,c)),this._loader.logOpen(`${U}`);const s=d.Get(`${U}/light`,this._lights,J.Wc);return Q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${J.Wc}`,s).then((q=>{this._loader.babylonScene.environmentTexture=q}))),this._loader.logClose(),await Promise.all(Q).then((()=>{}))}))}_loadLightAsync(q,c){if(!c._loaded){const U=new Array;this._loader.logOpen(`${q}`);const J=new Array(c.specularImages.length);for(let Q=0;Q<c.specularImages.length;Q++){const s=c.specularImages[Q];J[Q]=new Array(s.length);for(let c=0;c<s.length;c++){const g=`${q}/specularImages/${Q}/${c}`;this._loader.logOpen(`${g}`);const X=s[c],n=d.Get(g,this._loader.Vc.images,X);U.push(this._loader.loadImageAsync(`/images/${X}`,n).then((q=>{J[Q][c]=q}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(U).then((async()=>{const U=new j(this._loader.babylonScene,null,c.specularImageSize);if(U.name=c.name||"environment",c._babylonTexture=U,void 0!=c.zc&&(U.level=c.zc),c.rotation){let q=Q.g.Ic(c.rotation);this._loader.babylonScene.useRightHandedSystem||(q=Q.g.Inverse(q)),Q.d.FromQuaternionToRef(q,U.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${q}: Irradiance coefficients are missing`);const s=P.d.Ic(c.irradianceCoefficients);s.scaleInPlace(c.zc),s.convertIrradianceToLambertianRadiance();const g=P.f.FromHarmonics(s),X=(J.length-1)/Math.log2(c.specularImageSize);return await U.updateRGBDAsync(J,g,X)}))}return c._loaded.then((()=>c._babylonTexture))}}y(f),z(f,!0,(q=>new A(q)));U(11510);const E="EXT_mesh_gpu_instancing";class qq{constructor(q){this.name=E,this._loader=q,this.enabled=this._loader.isExtensionUsed(E)}dispose(){this._loader=null}loadNodeAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(q,J)=>{this._loader._disableInstancedMesh++;const s=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,U);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await s;const g=new Array;let X=0;const n=c=>{if(void 0==J.attributes[c])return void g.push(Promise.resolve(null));const U=d.Get(`${q}/attributes/${c}`,this._loader.Vc.accessors,J.attributes[c]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${U.bufferView}`,U)),0===X)X=U.count;else if(X!==U.count)throw new Error(`${q}/attributes: Instance buffer accessors do not have the same count.`)};return n("TRANSLATION"),n("ROTATION"),n("SCALE"),await s.then((async q=>{const[U,J,s]=await Promise.all(g),n=new Float32Array(16*X);Q.j.hc[0].bc(0,0,0),Q.j.Quaternion[0].bc(0,0,0,1),Q.j.hc[1].bc(1,1,1);for(let c=0;c<X;++c)U&&Q.p.FromArrayToRef(U,3*c,Q.j.hc[0]),J&&Q.g.FromArrayToRef(J,4*c,Q.j.Quaternion[0]),s&&Q.p.FromArrayToRef(s,3*c,Q.j.hc[1]),Q.d.ComposeToRef(Q.j.hc[1],Q.j.Quaternion[0],Q.j.hc[0],Q.j.Matrix[0]),Q.j.Matrix[0].copyToArray(n,16*c);for(const Q of c._primitiveBabylonMeshes)Q.ou("matrix",n,16,!0);return q}))}))}}y(E),z(E,!0,(q=>new qq(q)));let cq=0,Uq=null;class Jq{static get Default(){return Jq._Default||(Jq._Default=new Jq),Jq._Default}constructor(){const q=Jq.Configuration.decoder;this._decoderModulePromise=g.e.LoadBabylonScriptAsync(q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(q,c,U,J,Q){await this._decoderModulePromise,0===cq&&(MeshoptDecoder.useWorkers(1),cq=1);const s=await MeshoptDecoder.decodeGltfBufferAsync(c,U,q,J,Q);return null!==Uq&&clearTimeout(Uq),Uq=setTimeout((()=>{MeshoptDecoder.useWorkers(0),cq=0,Uq=null}),1e3),s}}Jq.Configuration={decoder:{url:`${g.e._DefaultCdnUrl}/meshopt_decoder.js`}},Jq._Default=null;const Qq="EXT_meshopt_compression";class sq{constructor(q){this.name=Qq,this.enabled=q.isExtensionUsed(Qq),this._loader=q}dispose(){this._loader=null}loadBufferViewAsync(q,c){return B.LoadExtensionAsync(q,c,this.name,(async(U,J)=>{const Q=c;if(Q._meshOptData)return await Q._meshOptData;const s=d.Get(`${q}/buffer`,this._loader.Vc.buffers,J.buffer);return Q._meshOptData=this._loader.loadBufferAsync(`/buffers/${s.index}`,s,J.byteOffset||0,J.byteLength).then((async q=>await Jq.Default.decodeGltfBufferAsync(q,J.count,J.byteStride,J.mode,J.filter))),await Q._meshOptData}))}}y(Qq),z(Qq,!0,(q=>new sq(q)));const gq="EXT_texture_webp";class Xq{constructor(q){this.name=gq,this._loader=q,this.enabled=q.isExtensionUsed(gq)}dispose(){this._loader=null}_loadTextureAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=void 0==c.sampler?B.DefaultSampler:d.Get(`${q}/sampler`,this._loader.Vc.samplers,c.sampler),g=d.Get(`${J}/source`,this._loader.Vc.images,Q.source);return await this._loader._createTextureAsync(q,s,g,(q=>{U(q)}),void 0,!c._textureInfo.nonColorData)}))}}y(gq),z(gq,!0,(q=>new Xq(q)));const nq="EXT_texture_avif";class Wq{constructor(q){this.name=nq,this._loader=q,this.enabled=q.isExtensionUsed(nq)}dispose(){this._loader=null}_loadTextureAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=void 0==c.sampler?B.DefaultSampler:d.Get(`${q}/sampler`,this._loader.Vc.samplers,c.sampler),g=d.Get(`${J}/source`,this._loader.Vc.images,Q.source);return await this._loader._createTextureAsync(q,s,g,(q=>{U(q)}),void 0,!c._textureInfo.nonColorData)}))}}y(nq),z(nq,!0,(q=>new Wq(q)));var Dq=U(12598),uq=U(11483);const Kq="EXT_lights_ies";class rq{constructor(q){this.name=Kq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Kq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.Vc.extensions;if(q&&q[this.name]){const c=q[this.name];this._lights=c.lights,d.Assign(this._lights)}}loadNodeAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,g)=>{let X,n;this._loader._allMaterialsDirtyRequired=!0;const W=await this._loader.loadNodeAsync(q,c,(q=>{n=d.Get(J,this._lights,g.Wc);const c=n.name||q.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new Dq.c(c,Q.p.Zero(),Q.p.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,n._babylonLight=X,X.falloffType=uq.c.FALLOFF_GLTF,X.dc=g.color?s.c.Ic(g.color):s.c.White(),X.zc=g.multiplier||1,X.range=Number.MAX_VALUE,X.parent=q,this._loader._babylonLights.push(X),B.AddPointerMetadata(X,J),U(q)}));let D;if(n.uri)D=await this._loader.loadUriAsync(q,n,n.uri);else{const c=d.Get(`${q}/bufferView`,this._loader.Vc.bufferViews,n.bufferView);D=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return X.iesProfileTexture=new R.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,D,!0,void 0,void 0,void 0,void 0,".ies"),W}))}}y(Kq),z(Kq,!0,(q=>new rq(q)));var Hq=U(12623);const bq="KHR_draco_mesh_compression";class hq{constructor(q){this.name=bq,this.useNormalizedFlagFromAccessor=!0,this._loader=q,this.enabled=Hq.b.DefaultAvailable&&this._loader.isExtensionUsed(bq)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${q}: Unsupported mode ${c.mode}`);const s={},g={},X=(q,J)=>{const X=Q.attributes[q];if(void 0!=X&&(U._delayInfo=U._delayInfo||[],-1===U._delayInfo.indexOf(J)&&U._delayInfo.push(J),s[J]=X,this.useNormalizedFlagFromAccessor)){const U=d.TryGet(this._loader.Vc.accessors,c.attributes[q]);U&&(g[J]=U.normalized||!1)}};X("POSITION",t.h.PositionKind),X("NORMAL",t.h.NormalKind),X("TANGENT",t.h.TangentKind),X("TEXCOORD_0",t.h.UVKind),X("TEXCOORD_1",t.h.UV2Kind),X("TEXCOORD_2",t.h.UV3Kind),X("TEXCOORD_3",t.h.UV4Kind),X("TEXCOORD_4",t.h.UV5Kind),X("TEXCOORD_5",t.h.UV6Kind),X("JOINTS_0",t.h.MatricesIndicesKind),X("WEIGHTS_0",t.h.MatricesWeightsKind),X("COLOR_0",t.h.ColorKind);const n=d.Get(J,this._loader.Vc.bufferViews,Q.bufferView);return n._dracoBabylonGeometry||(n._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((async J=>{const Q=this.dracoDecoder||Hq.b.Default,X=d.TryGet(this._loader.Vc.accessors,c.attributes.POSITION),n=this._loader.parent.alwaysComputeBoundingBox||U.skeleton||!X?null:e(X);return await Q._decodeMeshToGeometryForGltfAsync(U.name,this._loader.babylonScene,J,s,g,n).catch((c=>{throw new Error(`${q}: ${c.message}`)}))}))),await n._dracoBabylonGeometry}))}}y(bq),z(bq,!0,(q=>new hq(q)));var oq=U(12626),aq=U(11010),pq=U(11019),Rq=U(11113),Iq=U(11545),tq=U(10850);Rq.b.AddNodeConstructor("Light_Type_0",((q,c)=>()=>new Cq(q,Q.p.Zero(),c)));class Cq extends Iq.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(q){this._shadowAngle=q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(q){const c=this.needCube();if(this._direction=q,this.needCube()!==c&&this._shadowGenerators){const q=this._shadowGenerators.values();for(let c=q.next();!0!==c.done;c=q.next()){c.value.recreateShadowMap()}}}constructor(q,c,U){super(q,U),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return uq.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(q){if(this.direction)return super.getShadowDirection(q);switch(q){case 0:return new Q.p(1,0,0);case 1:return new Q.p(-1,0,0);case 2:return new Q.p(0,-1,0);case 3:return new Q.p(0,1,0);case 4:return new Q.p(0,0,1);case 5:return new Q.p(0,0,-1)}return Q.p.Zero()}_setDefaultShadowProjectionMatrix(q,c,U){const J=this.Cq().activeCamera;if(!J)return;const s=void 0!==this.shadowMinZ?this.shadowMinZ:J.Oc,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,X=this.Cq().getEngine().useReverseDepthBuffer;Q.d.PerspectiveFovLHToRef(this.shadowAngle,1,X?g:s,X?s:g,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(q,c){return this.computeTransformedInformation()?q.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):q.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(q,c){q["POINTLIGHT"+c]=!0}}(0,aq.d)([(0,pq.N)()],Cq.prototype,"shadowAngle",null),(0,tq.f)("BABYLON.PointLight",Cq);const iq="KHR_lights_punctual";class Fq{constructor(q){this.name=iq,this._loader=q,this.enabled=this._loader.isExtensionUsed(iq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.Vc.extensions;if(q&&q[this.name]){const c=q[this.name];this._lights=c.lights,d.Assign(this._lights)}}loadNodeAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(q,c,(q=>{let c;const X=d.Get(J,this._lights,g.Wc),n=X.name||q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const q=new oq.d(n,Q.p.Backward(),this._loader.babylonScene);q.position.tc(0),c=q;break}case"point":c=new Cq(n,Q.p.Zero(),this._loader.babylonScene);break;case"spot":{const q=new Dq.c(n,Q.p.Zero(),Q.p.Backward(),0,1,this._loader.babylonScene);q.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),c=q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${J}: Invalid light type (${X.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=c,c.falloffType=uq.c.FALLOFF_GLTF,c.dc=X.color?s.c.Ic(X.color):s.c.White(),c.zc=void 0==X.zc?1:X.zc,c.range=void 0==X.range?Number.MAX_VALUE:X.range,c.parent=q,this._loader._babylonLights.push(c),B.AddPointerMetadata(c,J),U(q)})))))}}y(iq),z(iq,!0,(q=>new Fq(q)));const vq="KHR_materials_pbrSpecularGlossiness";class Yq{constructor(q){this.name=vq,this.order=200,this._loader=q,this.enabled=this._loader.isExtensionUsed(vq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(q,c,U)),s.push(this._loadSpecularGlossinessPropertiesAsync(J,Q,U)),this._loader.loadMaterialAlphaProperties(q,c,U),await Promise.all(s).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.metallic=null,U.roughness=null,c.diffuseFactor?(U.albedoColor=s.c.Ic(c.diffuseFactor),U.alpha=c.diffuseFactor[3]):U.albedoColor=s.c.White(),U.reflectivityColor=c.specularFactor?s.c.Ic(c.specularFactor):s.c.White(),U.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTexture`,c.diffuseTexture,(q=>{q.name=`${U.name} (Diffuse)`,U.albedoTexture=q}))),c.specularGlossinessTexture&&(J.push(this._loader.loadTextureInfoAsync(`${q}/specularGlossinessTexture`,c.specularGlossinessTexture,(q=>{q.name=`${U.name} (Specular Glossiness)`,U.reflectivityTexture=q,U.reflectivityTexture.Hc=!0}))),U.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(J).then((()=>{}))}}y(vq),z(vq,!0,(q=>new Yq(q)));const kq="KHR_materials_unlit";class Vq{constructor(q){this.name=kq,this.order=210,this._loader=q,this.enabled=this._loader.isExtensionUsed(kq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(q,c,U)))}_loadUnlitPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;U.unlit=!0;const Q=c.pbrMetallicRoughness;return Q&&(Q.baseColorFactor?(U.albedoColor=s.c.Ic(Q.baseColorFactor),U.alpha=Q.baseColorFactor[3]):U.albedoColor=s.c.White(),Q.baseColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/baseColorTexture`,Q.baseColorTexture,(q=>{q.name=`${U.name} (Base Color)`,U.albedoTexture=q})))),c.doubleSided&&(U.Kc=!1,U.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(q,c,U),Promise.all(J).then((()=>{}))}}y(kq),z(kq,!0,(q=>new Vq(q)));const Oq="KHR_materials_clearcoat";class Gq{constructor(q){this.name=Oq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Oq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadClearCoatPropertiesAsync(J,Q,U)),await Promise.all(s)}))}_loadClearCoatPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.clearCoat.isEnabled=!0,U.clearCoat.useRoughnessFromMainTexture=!1,U.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?U.clearCoat.zc=c.clearcoatFactor:U.clearCoat.zc=0,c.clearcoatTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatTexture`,c.clearcoatTexture,(q=>{q.name=`${U.name} (ClearCoat)`,U.clearCoat.texture=q}))),void 0!=c.clearcoatRoughnessFactor?U.clearCoat.roughness=c.clearcoatRoughnessFactor:U.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(q=>{q.name=`${U.name} (ClearCoat Roughness)`,U.clearCoat.textureRoughness=q})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(q=>{q.name=`${U.name} (ClearCoat Normal)`,U.clearCoat.bumpTexture=q}))),U.invertNormalMapX=!U.Cq().useRightHandedSystem,U.invertNormalMapY=U.Cq().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(U.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(J).then((()=>{}))}}y(Oq),z(Oq,!0,(q=>new Gq(q)));const Sq="KHR_materials_iridescence";class Zq{constructor(q){this.name=Sq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Sq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadIridescencePropertiesAsync(J,Q,U)),await Promise.all(s).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.iridescence.isEnabled=!0,U.iridescence.zc=c.iridescenceFactor??0,U.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,U.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,U.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceTexture`,c.iridescenceTexture,(q=>{q.name=`${U.name} (Iridescence)`,U.iridescence.texture=q}))),c.iridescenceThicknessTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(q=>{q.name=`${U.name} (Iridescence Thickness)`,U.iridescence.thicknessTexture=q}))),Promise.all(J).then((()=>{}))}}y(Sq),z(Sq,!0,(q=>new Zq(q)));const xq="KHR_materials_anisotropy";class zq{constructor(q){this.name=xq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(xq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadIridescencePropertiesAsync(J,Q,U)),await Promise.all(s)}))}async _loadIridescencePropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;U.anisotropy.isEnabled=!0,U.anisotropy.zc=c.anisotropyStrength??0,U.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${q}/anisotropyTexture`,c.anisotropyTexture,(q=>{q.name=`${U.name} (Anisotropy Intensity)`,U.anisotropy.texture=q})))),await Promise.all(J)}}y(xq),z(xq,!0,(q=>new zq(q)));const yq="KHR_materials_emissive_strength";class Mq{constructor(q){this.name=yq,this.order=170,this._loader=q,this.enabled=this._loader.isExtensionUsed(yq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>await this._loader.loadMaterialPropertiesAsync(q,c,U).then((()=>{this._loadEmissiveProperties(J,Q,U)}))))}_loadEmissiveProperties(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);void 0!==c.emissiveStrength&&(U.emissiveIntensity=c.emissiveStrength)}}y(yq),z(yq,!0,(q=>new Mq(q)));const Tq="KHR_materials_sheen";class mq{constructor(q){this.name=Tq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Tq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadSheenPropertiesAsync(J,Q,U)),await Promise.all(s).then((()=>{}))}))}_loadSheenPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.sheen.isEnabled=!0,U.sheen.zc=1,void 0!=c.sheenColorFactor?U.sheen.color=s.c.Ic(c.sheenColorFactor):U.sheen.color=s.c.Black(),c.sheenColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/sheenColorTexture`,c.sheenColorTexture,(q=>{q.name=`${U.name} (Sheen Color)`,U.sheen.texture=q}))),void 0!==c.sheenRoughnessFactor?U.sheen.roughness=c.sheenRoughnessFactor:U.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${q}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(q=>{q.name=`${U.name} (Sheen Roughness)`,U.sheen.textureRoughness=q})))),U.sheen.albedoScaling=!0,U.sheen.useRoughnessFromMainTexture=!1,Promise.all(J).then((()=>{}))}}y(Tq),z(Tq,!0,(q=>new mq(q)));var dq=U(11328);const eq="KHR_materials_specular";class Bq{constructor(q){this.name=eq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(eq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;if(s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadSpecularPropertiesAsync(J,Q,U)),Q.extensions&&Q.extensions.EXT_materials_specular_edge_color&&U instanceof p.d){Q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(U.brdf.dielectricSpecularModel=dq.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,U.brdf.conductorSpecularModel=dq.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(s).then((()=>{}))}))}_loadSpecularPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return void 0!==c.specularFactor&&(U.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(U.metallicReflectanceColor=s.c.Ic(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${q}/specularTexture`,c.specularTexture,(q=>{q.name=`${U.name} (Specular)`,U.metallicReflectanceTexture=q,U.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/specularColorTexture`,c.specularColorTexture,(q=>{q.name=`${U.name} (Specular Color)`,U.reflectanceTexture=q}))),Promise.all(J).then((()=>{}))}}y(eq),z(eq,!0,(q=>new Bq(q)));const Nq="KHR_materials_ior";class Pq{constructor(q){this.name=Nq,this.order=180,this._loader=q,this.enabled=this._loader.isExtensionUsed(Nq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadIorPropertiesAsync(J,Q,U)),await Promise.all(s).then((()=>{}))}))}_loadIorPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);return void 0!==c.ior?U.indexOfRefraction=c.ior:U.indexOfRefraction=Pq._DEFAULT_IOR,Promise.resolve()}}Pq._DEFAULT_IOR=1.5,y(Nq),z(Nq,!0,(q=>new Pq(q)));const wq="KHR_materials_variants";class Lq{constructor(q){this.name=wq,this._loader=q,this.enabled=this._loader.isExtensionUsed(wq)}dispose(){this._loader=null}static GetAvailableVariants(q){const c=this._GetExtensionMetadata(q);return c?Object.keys(c.variants):[]}getAvailableVariants(q){return Lq.GetAvailableVariants(q)}static SelectVariant(q,c){const U=this._GetExtensionMetadata(q);if(!U)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${wq} extension`);const J=q=>{const c=U.variants[q];if(c)for(const U of c)U.mesh.material=U.material};if(c instanceof Array)for(const Q of c)J(Q);else J(c);U.lastSelected=c}selectVariant(q,c){Lq.SelectVariant(q,c)}static Reset(q){const c=this._GetExtensionMetadata(q);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${wq} extension`);for(const U of c.original)U.mesh.material=U.material;c.lastSelected=null}reset(q){Lq.Reset(q)}static GetLastSelectedVariant(q){const c=this._GetExtensionMetadata(q);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${wq} extension`);return c.lastSelected}getLastSelectedVariant(q){return Lq.GetLastSelectedVariant(q)}static _GetExtensionMetadata(q){var c,U;return(null===q||void 0===q||null===(c=q._internalMetadata)||void 0===c||null===(U=c.Vc)||void 0===U?void 0:U[wq])||null}onLoading(){const q=this._loader.Vc.extensions;if(q&&q[this.name]){const c=q[this.name];this._variants=c.variants}}onReady(){const q=this._loader.rootBabylonMesh;if(q){var c;const U=this._loader.parent.extensionOptions[wq];null!==U&&void 0!==U&&U.defaultVariant&&Lq.SelectVariant(q,U.defaultVariant),null===U||void 0===U||null===(c=U.onLoaded)||void 0===c||c.call(U,{get variants(){return Lq.GetAvailableVariants(q)},get selectedVariant(){const c=Lq.GetLastSelectedVariant(q);return c?Array.isArray(c)?c[0]:c:Lq.GetAvailableVariants(q)[0]},set selectedVariant(c){Lq.SelectVariant(q,c)}})}}_loadMeshPrimitiveAsync(q,c,U,J,Q,s){return B.LoadExtensionAsync(q,Q,this.name,(async(g,X)=>{const n=new Array;return n.push(this._loader._loadMeshPrimitiveAsync(q,c,U,J,Q,(c=>{if(s(c),c instanceof F.b){const U=B._GetDrawMode(q,Q.mode),J=this._loader.rootBabylonMesh,s=J?J._internalMetadata=J._internalMetadata||{}:{},W=s.Vc=s.Vc||{},D=W[wq]=W[wq]||{lastSelected:null,original:[],variants:{}};D.original.push({mesh:c,material:c.material});for(let q=0;q<X.mappings.length;++q){const Q=X.mappings[q],s=d.Get(`${g}/mappings/${q}/material`,this._loader.Vc.materials,Q.material);n.push(this._loader._loadMaterialAsync(`#/materials/${Q.material}`,s,c,U,(q=>{for(let U=0;U<Q.variants.length;++U){const s=Q.variants[U],g=d.Get(`/extensions/${wq}/variants/${s}`,this._variants,s);D.variants[g.name]=D.variants[g.name]||[],D.variants[g.name].push({mesh:c,material:q}),c.onClonedObservable.add((q=>{const U=q;let Q=null,s=U;do{if(s=s.parent,!s)return;Q=Lq._GetExtensionMetadata(s)}while(null===Q);if(J&&Q===Lq._GetExtensionMetadata(J)){s._internalMetadata={};for(const q in J._internalMetadata)s._internalMetadata[q]=J._internalMetadata[q];s._internalMetadata.Vc=[];for(const q in J._internalMetadata.Vc)s._internalMetadata.Vc[q]=J._internalMetadata.Vc[q];s._internalMetadata.Vc[wq]={lastSelected:null,original:[],variants:{}};for(const q of Q.original)s._internalMetadata.Vc[wq].original.push({mesh:q.mesh,material:q.material});for(const q in Q.variants)if(Object.prototype.hasOwnProperty.call(Q.variants,q)){s._internalMetadata.Vc[wq].variants[q]=[];for(const c of Q.variants[q])s._internalMetadata.Vc[wq].variants[q].push({mesh:c.mesh,material:c.material})}Q=s._internalMetadata.Vc[wq]}for(const J of Q.original)J.mesh===c&&(J.mesh=U);for(const J of Q.variants[g.name])J.mesh===c&&(J.mesh=U)}))}})))}}}))),await Promise.all(n).then((q=>{let[c]=q;return c}))}))}}y(wq),z(wq,!0,(q=>new Lq(q)));var lq=U(11296);class jq{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:dq.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(q,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...jq._GetDefaultOptions(),...q},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new D.e,this._scene.Cc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(q){if(!Object.keys(q).filter((c=>this._options[c]!==q[c])).length)return;const c={...this._options,...q},U=this._options;this._options=c,c.renderSize===U.renderSize&&c.renderTargetTextureType===U.renderTargetTextureType&&c.generateMipmaps===U.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(q){return!!q&&!!(q instanceof p.d&&q.subSurface.isRefractionEnabled)}_addMesh(q){this._materialObservers[q.uniqueId]=q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.e.SetImmediate((()=>{this._shouldRenderAsTransmission(q.material)?(q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(q)&&this._transparentMeshesCache.push(q)):-1===this._opaqueMeshesCache.indexOf(q)&&this._opaqueMeshesCache.push(q)}))}_removeMesh(q){q.onMaterialChangedObservable.remove(this._materialObservers[q.uniqueId]),delete this._materialObservers[q.uniqueId];let c=this._transparentMeshesCache.indexOf(q);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(q),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(q){const c=this._transparentMeshesCache.indexOf(q),U=this._opaqueMeshesCache.indexOf(q);this._shouldRenderAsTransmission(q.material)?(q.material instanceof p.d&&(q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==U?(this._opaqueMeshesCache.splice(U,1),this._transparentMeshesCache.push(q)):-1===c&&this._transparentMeshesCache.push(q)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(q)):-1===U&&this._opaqueMeshesCache.push(q)}_isRenderTargetValid(){var q;return null!==(null===(q=this._opaqueRenderTarget)||void 0===q?void 0:q.getInternalTexture())}_setupRenderTargets(){var q;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new lq.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(q=this._options.clearColor)||void 0===q?void 0:q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((q=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?q.clearColor.X(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(q.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const U of this._transparentMeshesCache)this._shouldRenderAsTransmission(U.material)&&(U.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const fq="KHR_materials_transmission";class Aq{constructor(q){this.name=fq,this.order=175,this._loader=q,this.enabled=this._loader.isExtensionUsed(fq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadTransparentPropertiesAsync(J,c,U,Q)),await Promise.all(s).then((()=>{}))}))}_loadTransparentPropertiesAsync(q,c,U,J){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const Q=U;if(Q.subSurface.isRefractionEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.useAlbedoToTintRefraction=!0,void 0===J.transmissionFactor)return Q.subSurface.refractionIntensity=0,Q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var s;Q.subSurface.refractionIntensity=J.transmissionFactor;const q=Q.Cq();if(Q.subSurface.refractionIntensity&&!q._transmissionHelper)new jq({},Q.Cq());else if(Q.subSurface.refractionIntensity&&(null===(s=q._transmissionHelper)||void 0===s||!s._isRenderTargetValid())){var g;null===(g=q._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,J.transmissionTexture?(J.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/transmissionTexture`,J.transmissionTexture,void 0).then((q=>{q.name=`${U.name} (Transmission)`,Q.subSurface.refractionIntensityTexture=q,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}y(fq),z(fq,!0,(q=>new Aq(q)));const Eq="KHR_materials_diffuse_transmission";class qc{constructor(q){this.name=Eq,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(Eq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadTranslucentPropertiesAsync(J,c,U,Q)),await Promise.all(s).then((()=>{}))}))}_loadTranslucentPropertiesAsync(q,c,U,J){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const Q=U;if(Q.subSurface.isTranslucencyEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,Q.subSurface.useAlbedoToTintTranslucency=!1,void 0===J.diffuseTransmissionFactor)return Q.subSurface.translucencyIntensity=0,Q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Q.subSurface.translucencyIntensity=J.diffuseTransmissionFactor;const g=new Array;return Q.subSurface.useGltfStyleTextures=!0,J.diffuseTransmissionTexture&&(J.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionTexture`,J.diffuseTransmissionTexture).then((q=>{q.name=`${U.name} (Diffuse Transmission)`,Q.subSurface.translucencyIntensityTexture=q})))),void 0!==J.diffuseTransmissionColorFactor?Q.subSurface.translucencyColor=s.c.Ic(J.diffuseTransmissionColorFactor):Q.subSurface.translucencyColor=s.c.White(),J.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionColorTexture`,J.diffuseTransmissionColorTexture).then((q=>{q.name=`${U.name} (Diffuse Transmission Color)`,Q.subSurface.translucencyColorTexture=q}))),Promise.all(g).then((()=>{}))}}y(Eq),z(Eq,!0,(q=>new qc(q)));const cc="KHR_materials_volume";class Uc{constructor(q){this.name=cc,this.order=173,this._loader=q,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadVolumePropertiesAsync(J,c,U,Q)),await Promise.all(s).then((()=>{}))}))}_loadVolumePropertiesAsync(q,c,U,J){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);if(!U.subSurface.isRefractionEnabled&&!U.subSurface.isTranslucencyEnabled||!J.thicknessFactor)return Promise.resolve();U.subSurface.volumeIndexOfRefraction=U.indexOfRefraction;const Q=void 0!==J.attenuationDistance?J.attenuationDistance:Number.MAX_VALUE;return U.subSurface.tintColorAtDistance=Q,void 0!==J.attenuationColor&&3==J.attenuationColor.length&&U.subSurface.tintColor.bc(J.attenuationColor[0],J.attenuationColor[1],J.attenuationColor[2]),U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=J.thicknessFactor,U.subSurface.useThicknessAsDepth=!0,J.thicknessTexture?(J.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/thicknessTexture`,J.thicknessTexture).then((q=>{q.name=`${U.name} (Thickness)`,U.subSurface.thicknessTexture=q,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}y(cc),z(cc,!0,(q=>new Uc(q)));const Jc="KHR_materials_dispersion";class Qc{constructor(q){this.name=Jc,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(Jc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadDispersionPropertiesAsync(J,c,U,Q)),await Promise.all(s).then((()=>{}))}))}_loadDispersionPropertiesAsync(q,c,U,J){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);return U.subSurface.isRefractionEnabled&&J.dispersion?(U.subSurface.isDispersionEnabled=!0,U.subSurface.dispersion=J.dispersion,Promise.resolve()):Promise.resolve()}}y(Jc),z(Jc,!0,(q=>new Qc(q)));const sc="EXT_materials_diffuse_roughness";class gc{constructor(q){this.name=sc,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(sc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(q,c,U)),s.push(this._loadDiffuseRoughnessPropertiesAsync(J,Q,U)),await Promise.all(s).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(q,c,U){if(!(U instanceof p.d))throw new Error(`${q}: Material type not supported`);const J=new Array;return U.brdf.baseDiffuseModel=dq.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?U.baseDiffuseRoughness=c.diffuseRoughnessFactor:U.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&J.push(this._loader.loadTextureInfoAsync(`${q}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(q=>{q.name=`${U.name} (Diffuse Roughness)`,U.baseDiffuseRoughnessTexture=q}))),Promise.all(J).then((()=>{}))}}y(sc),z(sc,!0,(q=>new gc(q)));const Xc="KHR_mesh_quantization";class nc{constructor(q){this.name=Xc,this.enabled=q.isExtensionUsed(Xc)}dispose(){}}y(Xc),z(Xc,!0,(q=>new nc(q)));const Wc="KHR_texture_basisu";class Dc{constructor(q){this.name=Wc,this._loader=q,this.enabled=q.isExtensionUsed(Wc)}dispose(){this._loader=null}_loadTextureAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>{const s=void 0==c.sampler?B.DefaultSampler:d.Get(`${q}/sampler`,this._loader.Vc.samplers,c.sampler),g=d.Get(`${J}/source`,this._loader.Vc.images,Q.source);return await this._loader._createTextureAsync(q,s,g,(q=>{U(q)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}y(Wc),z(Wc,!0,(q=>new Dc(q)));const uc="KHR_texture_transform";class Kc{constructor(q){this.name=uc,this._loader=q,this.enabled=this._loader.isExtensionUsed(uc)}dispose(){this._loader=null}loadTextureInfoAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(J,Q)=>await this._loader.loadTextureInfoAsync(q,c,(q=>{if(!(q instanceof R.c))throw new Error(`${J}: Texture type not supported`);Q.offset&&(q.uOffset=Q.offset[0],q.vOffset=Q.offset[1]),q.uRotationCenter=0,q.vRotationCenter=0,Q.rotation&&(q.wAng=-Q.rotation),Q.scale&&(q.uScale=Q.scale[0],q.vScale=Q.scale[1]),void 0!=Q.texCoord&&(q.coordinatesIndex=Q.texCoord),U(q)}))))}}y(uc),z(uc,!0,(q=>new Kc(q)));const rc="KHR_xmp_json_ld";class Hc{constructor(q){this.name=rc,this.order=100,this._loader=q,this.enabled=this._loader.isExtensionUsed(rc)}dispose(){this._loader=null}onLoading(){var q,c,U;if(null===this._loader.rootBabylonMesh)return;const J=null===(q=this._loader.Vc.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld,Q=null===(c=this._loader.Vc.asset)||void 0===c||null===(U=c.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld;if(J&&Q){const q=+Q.packet;J.packets&&q<J.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=J.packets[q])}}}function bc(q,c,U,J){return s.c.Ic(c,U).scale(J)}function hc(q,c,U,J){return c[U]*J}function oc(q,c,U,J){return-c[U]*J}function ac(q,c,U,J){return c[U+1]*J}function pc(q,c,U,J){return c[U]*J*2}function Rc(q){return{scale:[new tc(K.b.ANIMATIONTYPE_FLOAT,`${q}.uScale`,hc,(()=>2)),new tc(K.b.ANIMATIONTYPE_FLOAT,`${q}.vScale`,ac,(()=>2))],offset:[new tc(K.b.ANIMATIONTYPE_FLOAT,`${q}.uOffset`,hc,(()=>2)),new tc(K.b.ANIMATIONTYPE_FLOAT,`${q}.vOffset`,ac,(()=>2))],rotation:[new tc(K.b.ANIMATIONTYPE_FLOAT,`${q}.wAng`,oc,(()=>1))]}}y(rc),z(rc,!0,(q=>new Hc(q)));class Ic extends N.AnimationPropertyInfo{buildAnimations(q,c,U,J){return[{babylonAnimatable:q._babylonCamera,babylonAnimation:this._buildAnimation(c,U,J)}]}}class tc extends N.AnimationPropertyInfo{buildAnimations(q,c,U,J){const Q=[];for(const s in q._data)Q.push({babylonAnimatable:q._data[s].babylonMaterial,babylonAnimation:this._buildAnimation(c,U,J)});return Q}}class Cc extends N.AnimationPropertyInfo{buildAnimations(q,c,U,J){return[{babylonAnimatable:q._babylonLight,babylonAnimation:this._buildAnimation(c,U,J)}]}}(0,M.o)("/cameras/{}/orthographic/xmag",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"orthoLeft",oc,(()=>1)),new Ic(K.b.ANIMATIONTYPE_FLOAT,"orthoRight",ac,(()=>1))]),(0,M.o)("/cameras/{}/orthographic/ymag",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"orthoBottom",oc,(()=>1)),new Ic(K.b.ANIMATIONTYPE_FLOAT,"orthoTop",ac,(()=>1))]),(0,M.o)("/cameras/{}/orthographic/zfar",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"maxZ",hc,(()=>1))]),(0,M.o)("/cameras/{}/orthographic/znear",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"Oc",hc,(()=>1))]),(0,M.o)("/cameras/{}/perspective/yfov",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"fov",hc,(()=>1))]),(0,M.o)("/cameras/{}/perspective/zfar",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"maxZ",hc,(()=>1))]),(0,M.o)("/cameras/{}/perspective/znear",[new Ic(K.b.ANIMATIONTYPE_FLOAT,"Oc",hc,(()=>1))]),(0,M.o)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"albedoColor",bc,(()=>4)),new tc(K.b.ANIMATIONTYPE_FLOAT,"alpha",(function(q,c,U,J){return c[U+3]*J}),(()=>4))]),(0,M.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"metallic",hc,(()=>1))]),(0,M.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"roughness",hc,(()=>1))]);const ic=Rc("albedoTexture");(0,M.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",ic.scale),(0,M.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",ic.offset),(0,M.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",ic.rotation);const Fc=Rc("metallicTexture");(0,M.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Fc.scale),(0,M.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Fc.offset),(0,M.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Fc.rotation),(0,M.o)("/materials/{}/emissiveFactor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"emissiveColor",bc,(()=>3))]);const vc=Rc("bumpTexture");(0,M.o)("/materials/{}/normalTexture/scale",[new tc(K.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",hc,(()=>1))]),(0,M.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",vc.scale),(0,M.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",vc.offset),(0,M.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",vc.rotation),(0,M.o)("/materials/{}/occlusionTexture/strength",[new tc(K.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",hc,(()=>1))]);const Yc=Rc("ambientTexture");(0,M.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Yc.scale),(0,M.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Yc.offset),(0,M.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Yc.rotation);const kc=Rc("emissiveTexture");(0,M.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",kc.scale),(0,M.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",kc.offset),(0,M.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",kc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new tc(K.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new tc(K.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",hc,(()=>1))]);const Vc=Rc("anisotropy.texture");(0,M.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Vc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Vc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Vc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",hc,(()=>1))]);const Oc=Rc("clearCoat.texture");(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Oc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Oc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Oc.rotation);const Gc=Rc("clearCoat.bumpTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new tc(K.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Gc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Gc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Gc.rotation);const Sc=Rc("clearCoat.textureRoughness");(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Sc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Sc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Sc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new tc(K.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_ior/ior",[new tc(K.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new tc(K.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new tc(K.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",hc,(()=>1))]);const Zc=Rc("iridescence.texture");(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Zc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Zc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Zc.rotation);const xc=Rc("iridescence.thicknessTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",xc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",xc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",xc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"sheen.color",bc,(()=>3))]),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",hc,(()=>1))]);const zc=Rc("sheen.texture");(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",zc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",zc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",zc.rotation);const yc=Rc("sheen.textureRoughness");(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",yc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",yc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",yc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",bc,(()=>3))]);const Mc=Rc("metallicReflectanceTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Mc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Mc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Mc.rotation);const Tc=Rc("reflectanceTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Tc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Tc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Tc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",hc,(()=>1))]);const mc=Rc("subSurface.refractionIntensityTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",mc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",mc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",mc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",bc,(()=>3))]),(0,M.o)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new tc(K.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",hc,(()=>1))]),(0,M.o)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",hc,(()=>1))]);const dc=Rc("subSurface.thicknessTexture");(0,M.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",dc.scale),(0,M.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",dc.offset),(0,M.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",dc.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new tc(K.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",hc,(()=>1))]);const ec=Rc("subSurface.translucencyIntensityTexture");(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ec.scale),(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ec.offset),(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ec.rotation),(0,M.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new tc(K.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",bc,(()=>3))]);const Bc=Rc("subSurface.translucencyColorTexture");(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Bc.scale),(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Bc.offset),(0,M.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Bc.rotation),(0,M.o)("/extensions/KHR_lights_punctual/lights/{}/color",[new Cc(K.b.ANIMATIONTYPE_COLOR3,"diffuse",bc,(()=>3))]),(0,M.o)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Cc(K.b.ANIMATIONTYPE_FLOAT,"intensity",hc,(()=>1))]),(0,M.o)("/extensions/KHR_lights_punctual/lights/{}/range",[new Cc(K.b.ANIMATIONTYPE_FLOAT,"range",hc,(()=>1))]),(0,M.o)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Cc(K.b.ANIMATIONTYPE_FLOAT,"innerAngle",pc,(()=>1))]),(0,M.o)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Cc(K.b.ANIMATIONTYPE_FLOAT,"angle",pc,(()=>1))]),(0,M.o)("/nodes/{}/extensions/EXT_lights_ies/color",[new Cc(K.b.ANIMATIONTYPE_COLOR3,"diffuse",bc,(()=>3))]),(0,M.o)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Cc(K.b.ANIMATIONTYPE_FLOAT,"intensity",hc,(()=>1))]);const Nc="KHR_animation_pointer";class Pc{constructor(q){this.name=Nc,this._loader=q,this._pathToObjectConverter=(0,M.l)(this._loader.Vc)}get enabled(){return this._loader.isExtensionUsed(Nc)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(q,c,U,J,Q){var s;const g=null===(s=J.target.extensions)||void 0===s?void 0:s.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==J.target.path&&b.c.Warn(`${q}/target/path: Value (${J.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=J.target.node&&b.c.Warn(`${q}/target/node: Value (${J.target.node}) must not be present when using the ${this.name} extension`);const X=`${q}/extensions/${this.name}`,n=g.pointer;if(!n)throw new Error(`${X}: Pointer is missing`);try{const s=this._pathToObjectConverter.convert(n);if(!s.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(q,c,U,J,{object:s.object,info:s.info.interpolation},Q)}catch(W){return b.c.Warn(`${X}/pointer: Invalid pointer (${n}) skipped`),null}}}y(Nc),z(Nc,!0,(q=>new Pc(q)));class wc{constructor(q,c,U){this.frame=q,this.action=c,this.onlyOnce=U,this.isDone=!1}_clone(){return new wc(this.frame,this.action,this.onlyOnce)}}var Lc=U(10910),lc=U(10954),jc=U(10945);class fc{get loop(){return this._loop}set loop(q){q!==this._loop&&(this._loop=q,this.updateOptions({loop:q}))}get currentTime(){var q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(q=lc.d.audioEngine)&&void 0!==q&&q.audioContext&&(this.isPlaying||this.isPaused)){const q=this.isPaused?0:lc.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(q){if(q==this._spatialSound)return;const c=this.isPlaying;this.pause(),q?(this._spatialSound=q,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(q,c,U){var J;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new D.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Q.p.Zero(),this._localDirection=new Q.p(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=q,U=U||H.c.LastCreatedScene)if(this._scene=U,fc._SceneComponentInitialization(U),this._readyToPlayCallback=s,this._customAttenuationFunction=(q,c,U,J,Q)=>c<U?q*(1-c/U):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(J=lc.d.audioEngine)&&void 0!==J&&J.canUseWebAudio&&lc.d.audioEngine.audioContext){this._soundGain=lc.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let q=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let U=[],J=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lc.d.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=lc.d.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(J=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":U.push(c);case"Array":0===U.length&&(U=c);for(let q=0;q<U.length;q++){const c=U[q];if(J=X&&X.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&lc.d.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&lc.d.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),J){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.e.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(q=>{this._soundLoaded(q)}),void 0,!0,!0,(q=>{q&&b.c.Error("XHR "+q.status+" error on: "+c+"."),b.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:q=!1}q?J||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):b.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(n){b.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),lc.d.audioEngine&&!lc.d.audioEngine.WarnedWebAudioUnsupported&&(b.c.Error("Web Audio is not supported by your browser."),lc.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var q;null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(q){var c;null!==(c=lc.d.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(q){var c;null!==(c=lc.d.audioEngine)&&void 0!==c&&c.audioContext&&lc.d.audioEngine.audioContext.decodeAudioData(q,(q=>{this._audioBufferLoaded(q)}),(q=>{b.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+q)}))}setAudioBuffer(q){var c;null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=q,this._isReadyToPlay=!0)}updateOptions(q){q&&(this.loop=q.loop??this.loop,this.maxDistance=q.maxDistance??this.maxDistance,this.useCustomAttenuation=q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=q.rolloffFactor??this.rolloffFactor,this.refDistance=q.refDistance??this.refDistance,this.distanceModel=q.distanceModel??this.distanceModel,this._playbackRate=q.playbackRate??this._playbackRate,this._length=q.length??void 0,this.spatialSound=q.spatialSound??this._spatialSound,this._setOffset(q.offset??void 0),this.setVolume(q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var q;null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&lc.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??lc.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(q=this._soundPanner)||void 0===q||q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var q;null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(q){var c;null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(q),this._isOutputConnected=!0)}setDirectionalCone(q,c,U){c<q?b.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=q,this._coneOuterAngle=c,this._coneOuterGain=U,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!=this._coneInnerAngle){var c;if(this._coneOuterAngle<q)return void b.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q,null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!=this._coneOuterAngle){var c;if(q<this._coneInnerAngle)return void b.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q,null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(q){var c;q.equals(this._position)||(this._position.X(q),null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(q){var c;this._localDirection=q,null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const q=this._connectedTransformNode.getWorldMatrix(),c=Q.p.TransformNormal(this._localDirection,q);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var q;if(null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.eU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(q){this._customAttenuationFunction=q}play(q,c,U){var J;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(J=lc.d.audioEngine)&&void 0!==J&&J.audioContext)try{var Q,s;this._clearTimeoutsAndObservers();let J=q?(null===(Q=lc.d.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+q:null===(s=lc.d.audioEngine)||void 0===s?void 0:s.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=lc.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const q=()=>{var U;if(null!==(U=lc.d.audioEngine)&&void 0!==U&&U.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const U=this._htmlAudioElement.play();void 0!==U&&U.catch((()=>{var c,U;(null===(c=lc.d.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(U=lc.d.audioEngine)||void 0===U?void 0:U.onAudioUnlockedObservable.addOnce((()=>{q()})))}))}else{var J;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(J=lc.d.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{q()}))}};q()}}else{var g;const Q=()=>{var Q;if(null!==(Q=lc.d.audioEngine)&&void 0!==Q&&Q.audioContext){var s;if(U=U||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const q=this._soundSource;q.onended=()=>{q.disconnect()}}if(this._soundSource=null===(s=lc.d.audioEngine)||void 0===s?void 0:s.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==U&&(this._soundSource.loopEnd=(0|c)+U),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},J=q?(null===(g=lc.d.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+q:lc.d.audioEngine.audioContext.currentTime;const Q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(J,Q,this.loop?void 0:U)}}};"suspended"===(null===(g=lc.d.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var q;"suspended"===(null===(q=lc.d.audioEngine)||void 0===q?void 0:q.audioContext.state)?(lc.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=lc.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Q()})))):Q()}),500):Q()}this._startTime=J,this.isPlaying=!0,this.isPaused=!1}catch(X){b.c.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(q){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1}else if(null!==(c=lc.d.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=q?lc.d.audioEngine.audioContext.currentTime+q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(q=lc.d.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=lc.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(q,c){var U;null!==(U=lc.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._soundGain&&(c&&lc.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(lc.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,lc.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(q,lc.d.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=q),this._volume=q}setPlaybackRate(q){this._playbackRate=q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=q=>this._onRegisterAfterWorldMatrixUpdate(q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(q){var c;if(q.getBoundingInfo){const c=q.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(q.absolutePosition);null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const q=()=>{(0,jc.f)((()=>this._isReadyToPlay),(()=>{U._audioBuffer=this.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},U=new fc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&U.setAttenuationFunction(this._customAttenuationFunction),U.setPosition(this._position),U.setPlaybackRate(this._playbackRate),q(),U}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(q.connectedMeshId=this._connectedTransformNode.id),q.position=this._position.rc(),q.refDistance=this.refDistance,q.distanceModel=this.distanceModel,q.isDirectional=this._isDirectional,q.localDirectionToMesh=this._localDirection.rc(),q.coneInnerAngle=this._coneInnerAngle,q.coneOuterAngle=this._coneOuterAngle,q.coneOuterGain=this._coneOuterGain),q}static Parse(q,c,U,J){const s=q.name;let g;g=q.url?U+q.url:U+s;const X={autoplay:q.autoplay,loop:q.loop,volume:q.volume,spatialSound:q.spatialSound,maxDistance:q.maxDistance,rolloffFactor:q.rolloffFactor,refDistance:q.refDistance,distanceModel:q.distanceModel,playbackRate:q.playbackRate};let n;if(J){const q=()=>{(0,jc.f)((()=>J._isReadyToPlay),(()=>{n._audioBuffer=J.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,n._offset,n._length)}),void 0,300)};n=new fc(s,new ArrayBuffer(0),c,null,X),q()}else n=new fc(s,g,c,(()=>{c.removePendingData(n)}),X),c.addPendingData(n);if(q.position){const c=Q.p.Ic(q.position);n.setPosition(c)}if(q.isDirectional&&(n.setDirectionalCone(q.coneInnerAngle||360,q.coneOuterAngle||360,q.coneOuterGain||0),q.localDirectionToMesh)){const c=Q.p.Ic(q.localDirectionToMesh);n.setLocalDirectionToMesh(c)}if(q.connectedMeshId){const U=c.getMeshById(q.connectedMeshId);U&&n.attachToMesh(U)}return q.metadata&&(n.metadata=q.metadata),n}_setOffset(q){this._offset!==q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=q)}_clearTimeoutsAndObservers(){var q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(q=lc.d.audioEngine)||void 0===q||q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}fc._SceneComponentInitialization=q=>{throw(0,Lc.d)("AudioSceneComponent")},(0,tq.f)("BABYLON.Sound",fc);class Ac{constructor(q,c,U){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==U.length)throw new Error("Sounds length does not equal weights length");this.loop=q,this._weights=U;let J=0;for(const s of U)J+=s;const Q=J>0?1/J:0;for(let s=0;s<this._weights.length;s++)this._weights[s]*=Q;this._sounds=c;for(const s of this._sounds)s.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!==this._coneInnerAngle){if(this._coneOuterAngle<q)return void b.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q;for(const c of this._sounds)c.directionalConeInnerAngle=q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!==this._coneOuterAngle){if(q<this._coneInnerAngle)return void b.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q;for(const c of this._sounds)c.directionalConeOuterAngle=q}}get volume(){return this._volume}set volume(q){if(q!==this._volume)for(const c of this._sounds)c.setVolume(q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(q){if(!this.isPaused){this.stop();const q=Math.random();let c=0;for(let U=0;U<this._weights.length;U++)if(c+=this._weights[U],q<=c){this._currentIndex=U;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:q):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ec{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(q=q||H.c.LastCreatedScene)&&(this._scene=q,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var q;null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&lc.d.audioEngine.audioContext&&(this._outputAudioNode=lc.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(lc.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(lc.d.audioEngine&&lc.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(q){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==q.soundTrackId&&(-1===q.soundTrackId?this._scene.mainSoundTrack.removeSound(q):this._scene.soundTracks&&this._scene.soundTracks[q.soundTrackId].removeSound(q)),this.soundCollection.push(q),q.soundTrackId=this.id}removeSound(q){const c=this.soundCollection.indexOf(q);-1!==c&&this.soundCollection.splice(c,1)}setVolume(q){var c;null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=q)}switchPanningModelToHRTF(){var q;if(null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var q;if(null!==(q=lc.d.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(q){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=q,null!==(c=lc.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,lc.d.audioEngine.masterGain))}}var qU=U(11192),cU=U(11364),UU=U(10881);lc.d.AudioEngineFactory=(q,c,U)=>new JU(q,c,U);class JU{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new D.e,this.onAudioLockedObservable=new D.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,UU.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=q,this._audioContext=c,this._audioDestination=U;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Q){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Q){}}lock(){this._triggerSuspendedState()}unlock(){var q,c;if("running"===(null===(q=this._audioContext)||void 0===q?void 0:q.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{b.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var q;null===(q=this._audioContext)||void 0===q||q.addEventListener("statechange",(()=>{var q;this.unlocked&&"running"!==(null===(q=this._audioContext)||void 0===q?void 0:q.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var q;return null!==(q=this._audioContext)&&void 0!==q&&q.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(q){this.canUseWebAudio=!1,b.c.Error("Web Audio: "+q.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(q){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const q=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(q)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var q;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(q=this._audioContext)||void 0===q||q.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(q){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=q)}connectToAnalyser(q){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=q,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var QU=U(10902);(0,U(12331).i)(qU.d.NAME_AUDIO,((q,c,U,J)=>{let Q,s=[];if(U.zK=U.zK||[],void 0!==q.zK&&null!==q.zK)for(let X=0,n=q.zK.length;X<n;X++){var g;const n=q.zK[X];null!==(g=lc.d.audioEngine)&&void 0!==g&&g.canUseWebAudio?(n.url||(n.url=n.name),s[n.url]?U.zK.push(fc.Parse(n,c,J,s[n.url])):(Q=fc.Parse(n,c,J),s[n.url]=Q,U.zK.push(Q))):U.zK.push(new fc(n.name,null,c))}s=[]})),Object.defineProperty(cU.b.prototype,"mainSoundTrack",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),this._mainSoundTrack||(this._mainSoundTrack=new Ec(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),cU.b.prototype.getSoundByName=function(q){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===q)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let U=0;U<this.soundTracks.length;U++)for(c=0;c<this.soundTracks[U].soundCollection.length;c++)if(this.soundTracks[U].soundCollection[c].name===q)return this.soundTracks[U].soundCollection[c];return null},Object.defineProperty(cU.b.prototype,"audioEnabled",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),q.audioEnabled},set:function(q){let c=this._getComponent(qU.d.NAME_AUDIO);c||(c=new sU(this),this.nc(c)),q?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(cU.b.prototype,"headphone",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),q.headphone},set:function(q){let c=this._getComponent(qU.d.NAME_AUDIO);c||(c=new sU(this),this.nc(c)),q?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(cU.b.prototype,"audioListenerPositionProvider",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),q.audioListenerPositionProvider},set:function(q){let c=this._getComponent(qU.d.NAME_AUDIO);if(c||(c=new sU(this),this.nc(c)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(cU.b.prototype,"audioListenerRotationProvider",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),q.audioListenerRotationProvider},set:function(q){let c=this._getComponent(qU.d.NAME_AUDIO);if(c||(c=new sU(this),this.nc(c)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(cU.b.prototype,"audioPositioningRefreshRate",{get:function(){let q=this._getComponent(qU.d.NAME_AUDIO);return q||(q=new sU(this),this.nc(q)),q.audioPositioningRefreshRate},set:function(q){let c=this._getComponent(qU.d.NAME_AUDIO);c||(c=new sU(this),this.nc(c)),c.audioPositioningRefreshRate=q},enumerable:!0,configurable:!0});class sU{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(q){this.name=qU.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Q.p,this._cachedCameraPosition=new Q.p,this._lastCheck=0,this._invertMatrixTemp=new Q.d,this._cameraDirectionTemp=new Q.p,(q=q||H.c.LastCreatedScene)&&(this.mc=q,q.soundTracks=[],q.zK=[])}register(){this.mc._afterRenderStage.registerStep(qU.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(q){if(q.zK=[],this.mc.soundTracks)for(let c=0;c<this.mc.soundTracks.length;c++){const U=this.mc.soundTracks[c];for(let c=0;c<U.soundCollection.length;c++)q.zK.push(U.soundCollection[c].serialize())}}addFromContainer(q){if(q.zK)for(const c of q.zK)c.play(),c.autoplay=!0,this.mc.mainSoundTrack.addSound(c)}removeFromContainer(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q.zK)for(const U of q.zK)U.stop(),U.autoplay=!1,this.mc.mainSoundTrack.removeSound(U),c&&U.dispose()}dispose(){const q=this.mc;if(q._mainSoundTrack&&q.mainSoundTrack.dispose(),q.soundTracks)for(let c=0;c<q.soundTracks.length;c++)q.soundTracks[c].dispose()}disableAudio(){const q=this.mc;let c;for(this._audioEnabled=!1,lc.d.audioEngine&&lc.d.audioEngine.audioContext&&lc.d.audioEngine.audioContext.suspend(),c=0;c<q.mainSoundTrack.soundCollection.length;c++)q.mainSoundTrack.soundCollection[c].pause();if(q.soundTracks)for(c=0;c<q.soundTracks.length;c++)for(let U=0;U<q.soundTracks[c].soundCollection.length;U++)q.soundTracks[c].soundCollection[U].pause()}enableAudio(){const q=this.mc;let c;for(this._audioEnabled=!0,lc.d.audioEngine&&lc.d.audioEngine.audioContext&&lc.d.audioEngine.audioContext.resume(),c=0;c<q.mainSoundTrack.soundCollection.length;c++)q.mainSoundTrack.soundCollection[c].isPaused&&q.mainSoundTrack.soundCollection[c].play();if(q.soundTracks)for(c=0;c<q.soundTracks.length;c++)for(let U=0;U<q.soundTracks[c].soundCollection.length;U++)q.soundTracks[c].soundCollection[U].isPaused&&q.soundTracks[c].soundCollection[U].play()}switchAudioModeForHeadphones(){const q=this.mc;if(this._headphone=!0,q.mainSoundTrack.switchPanningModelToHRTF(),q.soundTracks)for(let c=0;c<q.soundTracks.length;c++)q.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const q=this.mc;if(this._headphone=!1,q.mainSoundTrack.switchPanningModelToEqualPower(),q.soundTracks)for(let c=0;c<q.soundTracks.length;c++)q.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const q=QU.d.Now;if(this._lastCheck&&q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=q;const c=this.mc;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const U=lc.d.audioEngine;if(U&&U.audioContext){let q,J=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(J=c.activeCameras[0]),this.audioListenerPositionProvider){const q=this.audioListenerPositionProvider();U.audioContext.listener.setPosition(q.x||0,q.y||0,q.z||0)}else J?this._cachedCameraPosition.equals(J.globalPosition)||(this._cachedCameraPosition.X(J.globalPosition),U.audioContext.listener.setPosition(J.globalPosition.x,J.globalPosition.y,J.globalPosition.z)):U.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const q=this.audioListenerRotationProvider();U.audioContext.listener.setOrientation(q.x||0,q.y||0,q.z||0,0,1,0)}else J?(J.rigCameras&&J.rigCameras.length>0&&(J=J.rigCameras[0]),J.getViewMatrix().invertToRef(this._invertMatrixTemp),Q.p.TransformNormalToRef(sU._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.X(this._cameraDirectionTemp),U.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):U.audioContext.listener.setOrientation(0,0,0,0,1,0);for(q=0;q<c.mainSoundTrack.soundCollection.length;q++){const U=c.mainSoundTrack.soundCollection[q];U.useCustomAttenuation&&U.updateDistanceFromListener()}if(c.soundTracks)for(q=0;q<c.soundTracks.length;q++)for(let U=0;U<c.soundTracks[q].soundCollection.length;U++){const J=c.soundTracks[q].soundCollection[U];J.useCustomAttenuation&&J.updateDistanceFromListener()}}}}sU._CameraDirection=new Q.p(0,0,-1),fc._SceneComponentInitialization=q=>{let c=q._getComponent(qU.d.NAME_AUDIO);c||(c=new sU(q),q.nc(c))};const gU="MSFT_audio_emitter";class XU{constructor(q){this.name=gU,this._loader=q,this.enabled=this._loader.isExtensionUsed(gU)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const q=this._loader.Vc.extensions;if(q&&q[this.name]){const c=q[this.name];this._clips=c.clips,this._emitters=c.emitters,d.Assign(this._clips),d.Assign(this._emitters)}}loadSceneAsync(q,c){return B.LoadExtensionAsync(q,c,this.name,(async(U,J)=>{const Q=new Array;Q.push(this._loader.loadSceneAsync(q,c));for(const q of J.emitters){const c=d.Get(`${U}/emitters`,this._emitters,q);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${U}: Direction or Distance properties are not allowed on emitters attached to a scene`);Q.push(this._loadEmitterAsync(`${U}/emitters/${c.index}`,c))}await Promise.all(Q)}))}loadNodeAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(q,J)=>{const s=new Array,X=await this._loader.loadNodeAsync(q,c,(c=>{for(const U of J.emitters){const J=d.Get(`${q}/emitters`,this._emitters,U);s.push(this._loadEmitterAsync(`${q}/emitters/${J.index}`,J).then((()=>{for(const q of J._babylonSounds)q.attachToMesh(c),void 0==J.innerAngle&&void 0==J.outerAngle||(q.setLocalDirectionToMesh(Q.p.Forward()),q.setDirectionalCone(2*g.e.ToDegrees(void 0==J.innerAngle?Math.PI:J.innerAngle),2*g.e.ToDegrees(void 0==J.outerAngle?Math.PI:J.outerAngle),0))})))}U(c)}));return await Promise.all(s),X}))}loadAnimationAsync(q,c){return B.LoadExtensionAsync(q,c,this.name,(async(U,J)=>{const Q=await this._loader.loadAnimationAsync(q,c),s=new Array;d.Assign(J.events);for(const g of J.events)s.push(this._loadAnimationEventAsync(`${U}/events/${g.index}`,q,c,g,Q));return await Promise.all(s),Q}))}_loadClipAsync(q,c){if(c._objectURL)return c._objectURL;let U;if(c.uri)U=this._loader.loadUriAsync(q,c,c.uri);else{const J=d.Get(`${q}/bufferView`,this._loader.Vc.bufferViews,c.bufferView);U=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}return c._objectURL=U.then((q=>URL.createObjectURL(new Blob([q],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(q,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const q=new Array,U=c.name||`emitter${c.index}`,J={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let s=0;s<c.clips.length;s++){const Q=`/extensions/${this.name}/clips`,g=d.Get(Q,this._clips,c.clips[s].clip);q.push(this._loadClipAsync(`${Q}/${c.clips[s].clip}`,g).then((q=>{const Q=c._babylonSounds[s]=new fc(U,q,this._loader.babylonScene,null,J);Q.refDistance=c.refDistance||1,Q.maxDistance=c.maxDistance||256,Q.rolloffFactor=c.rolloffFactor||1,Q.distanceModel=c.distanceModel||"exponential"})))}const Q=Promise.all(q).then((()=>{const q=c.clips.map((q=>q.weight||1)),U=new Ac(c.loop||!1,c._babylonSounds,q);c.innerAngle&&(U.directionalConeInnerAngle=2*g.e.ToDegrees(c.innerAngle)),c.outerAngle&&(U.directionalConeOuterAngle=2*g.e.ToDegrees(c.outerAngle)),c.volume&&(U.volume=c.volume),c._babylonData.sound=U}));c._babylonData={loaded:Q}}return c._babylonData.loaded}_getEventAction(q,c,U,J,Q){switch(U){case"play":return q=>{const U=(Q||0)+(q-J);c.play(U)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${q}: Unsupported action ${U}`)}}_loadAnimationEventAsync(q,c,U,J,Q){if(0==Q.targetedAnimations.length)return Promise.resolve();const s=Q.targetedAnimations[0],g=J.j,X=d.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(q,X).then((()=>{const c=X._babylonData.sound;if(c){const U=new wc(J.time,this._getEventAction(q,c,J.action,J.time,J.startOffset));s.animation.addEvent(U),Q.onAnimationGroupEndObservable.add((()=>{c.stop()})),Q.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}y(gU),z(gU,!0,(q=>new XU(q)));const nU="MSFT_lod";class WU{constructor(q){var c;this.name=nU,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new D.e,this.onMaterialLODsLoadedObservable=new D.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=q,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[nU])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(nU)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let q=0;q<this._nodePromiseLODs.length;q++){const c=Promise.all(this._nodePromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Node LOD ${q}`),this._loader.log(`Loaded node LOD ${q}`)),this.onNodeLODsLoadedObservable.notifyObservers(q),q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${q+1}`),this._loadBufferLOD(this._nodeBufferLODs,q+1),this._nodeSignalLODs[q]&&this._nodeSignalLODs[q].resolve())}));this._loader._completePromises.push(c)}for(let q=0;q<this._materialPromiseLODs.length;q++){const c=Promise.all(this._materialPromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Material LOD ${q}`),this._loader.log(`Loaded material LOD ${q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(q),q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${q+1}`),this._loadBufferLOD(this._materialBufferLODs,q+1),this._materialSignalLODs[q]&&this._materialSignalLODs[q].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(q,c){const U=this._loader.loadSceneAsync(q,c);return this._loadBufferLOD(this._bufferLODs,0),U}loadNodeAsync(q,c,U){return B.LoadExtensionAsync(q,c,this.name,(async(q,Q)=>{let s;const g=this._getLODs(q,c,this._loader.Vc.nodes,Q.ids);this._loader.logOpen(`${q}`);for(let c=0;c<g.length;c++){const q=g[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new J);const Q=q=>{U(q),q.LX(!1)},X=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,Q).then((q=>{if(0!==c){const q=g[c-1];q._babylonTransformNode&&(this._disposeTransformNode(q._babylonTransformNode),delete q._babylonTransformNode)}return q.LX(!0),q}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?s=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(X))}return this._loader.logClose(),await s}))}_loadMaterialAsync(q,c,U,J,Q){return this._nodeIndexLOD?null:B.LoadExtensionAsync(q,c,this.name,(async(q,s)=>{let g;const X=this._getLODs(q,c,this._loader.Vc.materials,s.ids);this._loader.logOpen(`${q}`);for(let c=0;c<X.length;c++){const q=X[c];0!==c&&(this._materialIndexLOD=c);const s=this._loader._loadMaterialAsync(`/materials/${q.index}`,q,U,J,(q=>{0===c&&Q(q)})).then((q=>{if(0!==c){Q(q);const U=X[c-1]._data;U[J]&&(this._disposeMaterials([U[J].babylonMaterial]),delete U[J])}return q}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?g=s:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(s))}return this._loader.logClose(),await g}))}_loadUriAsync(q,c,U){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Q=this._nodeIndexLOD-1;return this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new J,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(q,c,U)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Q=this._materialIndexLOD-1;return this._materialSignalLODs[Q]=this._materialSignalLODs[Q]||new J,this._materialSignalLODs[Q].promise.then((async()=>await this._loader.loadUriAsync(q,c,U)))}return null}loadBufferAsync(q,c,U,Q){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(q,c)=>{const s=U,g=s+Q-1;let X=q[c];return X?(X.start=Math.min(X.start,s),X.end=Math.max(X.end,g)):(X={start:s,end:g,loaded:new J},q[c]=X),await X.loaded.promise.then((q=>new Uint8Array(q.buffer,q.byteOffset+U-X.start,Q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(q,c){const U=q[c];U&&(this._loader.log(`Loading buffer range [${U.start}-${U.end}]`),this._loader.bin.readAsync(U.start,U.end-U.start+1).then((q=>{U.loaded.resolve(q)}),(q=>{U.loaded.reject(q)})))}_getLODs(q,c,U,J){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Q=[];for(let s=J.length-1;s>=0;s--)if(Q.push(d.Get(`${q}/ids/${J[s]}`,U,J[s])),Q.length===this.maxLODsToLoad)return Q;return Q.push(c),Q}_disposeTransformNode(q){const c=[],U=q.material;U&&c.push(U);for(const Q of q.getChildMeshes())Q.material&&c.push(Q.material);q.dispose();const J=c.filter((q=>this._loader.babylonScene.meshes.every((c=>c.material!=q))));this._disposeMaterials(J)}_disposeMaterials(q){const c={};for(const U of q){for(const q of U.getActiveTextures())c[q.uniqueId]=q;U.dispose()}for(const U in c)for(const q of this._loader.babylonScene.materials)q.hasTexture(c[U])&&delete c[U];for(const U in c)c[U].dispose()}}y(nU),z(nU,!0,(q=>new WU(q)));const DU="MSFT_minecraftMesh";class uU{constructor(q){this.name=DU,this._loader=q,this.enabled=this._loader.isExtensionUsed(DU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtraAsync(q,c,this.name,(async(J,Q)=>{if(Q){if(!(U instanceof p.d))throw new Error(`${J}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(q,c,U);return U.needAlphaBlending()&&(U.forceDepthWrite=!0,U.separateCullingPass=!0),U.Kc=U.forceDepthWrite,U.twoSidedLighting=!0,await Q}}))}}y(DU),z(DU,!0,(q=>new uU(q)));const KU="MSFT_sRGBFactors";class rU{constructor(q){this.name=KU,this._loader=q,this.enabled=this._loader.isExtensionUsed(KU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,c,U){return B.LoadExtraAsync(q,c,this.name,(async(J,Q)=>{if(Q){if(!(U instanceof p.d))throw new Error(`${J}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(q,c,U),s=U.Cq().getEngine().useExactSrgbConversions;return U.albedoTexture||U.albedoColor.toLinearSpaceToRef(U.albedoColor,s),U.reflectivityTexture||U.reflectivityColor.toLinearSpaceToRef(U.reflectivityColor,s),await Q}}))}}y(KU),z(KU,!0,(q=>new rU(q)));var HU=U(12630);const bU={};var hU=U(12686),oU=U(12664),aU=U(12633),pU=U(12648);function RU(q,c){for(const U of q)for(const q of U.dataOutputs)if(q.uniqueId===c)return q;throw new Error("Could not find data out connection with unique id "+c)}function IU(q,c){for(const U of q)if(U instanceof oU.e)for(const q of U.signalInputs)if(q.uniqueId===c)return q;throw new Error("Could not find signal in connection with unique id "+c)}async function tU(q,c){const J=await Promise.all(q.allBlocks.map((async q=>{const c=function(q){switch(q){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([U.e(58),U.e(59)]).then(U.bind(U,14041))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await U.e(60).then(U.bind(U,14046))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await U.e(61).then(U.bind(U,14049))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await U.e(62).then(U.bind(U,14054))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await U.e(63).then(U.bind(U,14063))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await U.e(64).then(U.bind(U,14065))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await U.e(65).then(U.bind(U,14072))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await U.e(66).then(U.bind(U,14074))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await U.e(67).then(U.bind(U,14077))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await U.e(75).then(U.bind(U,14118))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await U.e(76).then(U.bind(U,14123))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await U.e(77).then(U.bind(U,14130))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await U.e(78).then(U.bind(U,14139))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await U.e(79).then(U.bind(U,14144))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await U.e(80).then(U.bind(U,14147))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await U.e(81).then(U.bind(U,14149))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await U.e(82).then(U.bind(U,14154))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await U.e(83).then(U.bind(U,14160))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await U.e(84).then(U.bind(U,14162))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await U.e(85).then(U.bind(U,14171))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await U.e(86).then(U.bind(U,14177))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await U.e(87).then(U.bind(U,14182))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await U.e(88).then(U.bind(U,14188))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await U.e(89).then(U.bind(U,14195))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await U.e(90).then(U.bind(U,14202))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await U.e(91).then(U.bind(U,14207))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await U.e(92).then(U.bind(U,14213))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await U.e(93).then(U.bind(U,14220))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await U.e(72).then(U.bind(U,14227))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await U.e(94).then(U.bind(U,14235))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await U.e(95).then(U.bind(U,14243))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await U.e(96).then(U.bind(U,14248))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await U.e(73).then(U.bind(U,14251))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await U.e(68).then(U.bind(U,14084))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await U.e(74).then(U.bind(U,14255))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await U.e(69).then(U.bind(U,14107))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await U.e(70).then(U.bind(U,14116))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await U.e(71).then(U.bind(U,14264))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await U.e(97).then(U.bind(U,14266))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await U.e(98).then(U.bind(U,14271))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await U.e(99).then(U.bind(U,14275))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await U.e(100).then(U.bind(U,14280))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await U.e(101).then(U.bind(U,14284))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await U.e(102).then(U.bind(U,14293))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await U.e(103).then(U.bind(U,14299))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await U.e(104).then(U.bind(U,14305))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await U.e(105).then(U.bind(U,14311))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await U.e(106).then(U.bind(U,14314))).FlowGraphDataSwitchBlock;default:if(bU[q])return bU[q];throw new Error(`Unknown block name ${q}`)}}(q.className);return await c()})));return function(q,c,U){const J=c.coordinator.createGraph(),Q=[],s=c.valueParseFunction??aU.d;for(let g=0;g<q.allBlocks.length;g++){const X=iU(q.allBlocks[g],{mc:c.coordinator.config.mc,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.mc,valueParseFunction:s},U[g]);Q.push(X),X instanceof hU.e&&J.addEventBlock(X)}for(const g of Q){for(const q of g.dataInputs)for(const c of q.connectedPointIds){const U=RU(Q,c);q.connectTo(U)}if(g instanceof oU.e)for(const q of g.signalOutputs)for(const c of q.connectedPointIds){const U=IU(Q,c);q.connectTo(U)}}for(const g of q.executionContexts)CU(g,{graph:J,valueParseFunction:s},q.rightHanded);return J}(q,c,J)}function CU(q,c,U){const J=c.graph.createContext();q.enableLogging&&(J.enableLogging=!0),J.treatDataAsRightHanded=U||!1;const Q=c.valueParseFunction??aU.d;J.uniqueId=q.uniqueId;const s=J.Cq();if(q._assetsContext){var g,X,n,W,D,u,K,r,H,b;const c=q._assetsContext,U={meshes:null===(g=c.meshes)||void 0===g?void 0:g.map((q=>s.getMeshById(q))),lights:null===(X=c.lights)||void 0===X?void 0:X.map((q=>s.getLightByName(q))),cameras:null===(n=c.cameras)||void 0===n?void 0:n.map((q=>s.getCameraByName(q))),materials:null===(W=c.materials)||void 0===W?void 0:W.map((q=>s.getMaterialById(q))),textures:null===(D=c.textures)||void 0===D?void 0:D.map((q=>s.getTextureByName(q))),animations:null===(u=c.animations)||void 0===u?void 0:u.map((q=>s.animations.find((c=>c.name===q)))),skeletons:null===(K=c.skeletons)||void 0===K?void 0:K.map((q=>s.getSkeletonByName(q))),qK:null===(r=c.qK)||void 0===r?void 0:r.map((q=>s.getParticleSystemById(q))),animationGroups:null===(H=c.animationGroups)||void 0===H?void 0:H.map((q=>s.getAnimationGroupByName(q))),transformNodes:null===(b=c.transformNodes)||void 0===b?void 0:b.map((q=>s.getTransformNodeById(q))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],zK:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};J.assetsContext=U}for(const h in q._userVariables){const c=Q(h,q._userVariables,J.assetsContext,s);J.userVariables[h]=c}for(const h in q._connectionValues){const c=Q(h,q._connectionValues,J.assetsContext,s);J._setConnectionValueByKey(h,c)}return J}function iU(q,c,U){const J={},Q=c.valueParseFunction??aU.d;if(q.config)for(const g in q.config)J[g]=Q(g,q.config,c.assetsContainer||c.mc,c.mc);if((0,aU.l)(q.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");J.pathConverter=c.pathConverter}const s=new U(J);s.uniqueId=q.uniqueId;for(let g=0;g<q.dataInputs.length;g++){const c=s.getDataInput(q.dataInputs[g].name);if(!c)throw new Error("Could not find data input with name "+q.dataInputs[g].name+" in block "+q.className);c.deserialize(q.dataInputs[g])}for(let g=0;g<q.dataOutputs.length;g++){const c=s.getDataOutput(q.dataOutputs[g].name);if(!c)throw new Error("Could not find data output with name "+q.dataOutputs[g].name+" in block "+q.className);c.deserialize(q.dataOutputs[g])}return s.metadata=q.metadata,s.deserialize&&s.deserialize(q),s}function FU(q){const[c,U]=q.split(":");return vU({op:c,extension:U})}function vU(q){var c;let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=q.extension?null===(c=kU[q.extension])||void 0===c?void 0:c[q.op]:VU[q.op];if(!J&&(b.c.Warn(`No mapping found for operation ${q.op} and extension ${q.extension||"KHR_interactivity"}`),U)){const c={},U={flows:{}};if(q.inputValueSockets){c.values={};for(const U in q.inputValueSockets)c.values[U]={name:U}}return q.outputValueSockets&&(U.values={},Object.keys(q.outputValueSockets).forEach((q=>{U.values[q]={name:q}}))),{aD:[],inputs:c,outputs:U}}return J}function YU(q,c,U){kU[c]||(kU[c]={}),kU[c][q]=U}const kU={BABYLON:{"flow/log":{aD:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},VU={"event/onStart":{aD:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{aD:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{aD:["FlowGraphSendCustomEventBlock"],extraProcessor(q,c,U,J,Q){if("event/send"!==c.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const s=q.configuration.event.value[0];if("number"!==typeof s)throw new Error("Event id should be a number");const g=J.arrays.events[s],X=Q[0];return X.config||(X.config={}),X.config.eventId=g.eventId,X.config.eventData=g.eventData,Q}},"event/receive":{aD:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(q,c){var U;if(!q.configuration)return b.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const J=q.configuration.event;if(!J)return b.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Q=J.value[0];if("number"!==typeof Q)return b.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(U=c.events)||void 0===U?void 0:U[Q])?{valid:!0}:(b.c.Error(`Event with id ${Q} not found`),{valid:!1,error:`Event with id ${Q} not found`})},extraProcessor(q,c,U,J,Q){if("event/receive"!==c.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const s=q.configuration.event.value[0];if("number"!==typeof s)throw new Error("Event id should be a number");const g=J.arrays.events[s],X=Q[0];return X.config||(X.config={}),X.config.eventId=g.eventId,X.config.eventData=g.eventData,Q}},"math/e":OU("FlowGraphEBlock"),"math/pi":OU("FlowGraphPIBlock"),"math/inf":OU("FlowGraphInfBlock"),"math/nan":OU("FlowGraphNaNBlock"),"math/abs":OU("FlowGraphAbsBlock"),"math/sign":OU("FlowGraphSignBlock"),"math/trunc":OU("FlowGraphTruncBlock"),"math/floor":OU("FlowGraphFloorBlock"),"math/ceil":OU("FlowGraphCeilBlock"),"math/round":{aD:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q){var s;return(s=Q[0]).config||(s.config={}),Q[0].config.roundHalfAwayFromZero=!0,Q}},"math/fract":OU("FlowGraphFractBlock"),"math/neg":OU("FlowGraphNegationBlock"),"math/add":OU("FlowGraphAddBlock",["a","b"],!0),"math/sub":OU("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{aD:["FlowGraphMultiplyBlock"],extraProcessor(q,c,U,J,Q){var s;(s=Q[0]).config||(s.config={}),Q[0].config.useMatrixPerComponent=!0,Q[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(q.values||{}).find((c=>{var U;return void 0!==(null===(U=q.values)||void 0===U?void 0:U[c].type)&&(g=q.values[c].type,!0)})),-1!==g&&(Q[0].config.type=J.arrays.types[g].flowGraphType),Q},validation:q=>q.values?GU(q):{valid:!0}},"math/div":OU("FlowGraphDivideBlock",["a","b"],!0),"math/rem":OU("FlowGraphModuloBlock",["a","b"]),"math/min":OU("FlowGraphMinBlock",["a","b"]),"math/max":OU("FlowGraphMaxBlock",["a","b"]),"math/clamp":OU("FlowGraphClampBlock",["a","b","c"]),"math/saturate":OU("FlowGraphSaturateBlock"),"math/mix":OU("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":OU("FlowGraphEqualityBlock",["a","b"]),"math/lt":OU("FlowGraphLessThanBlock",["a","b"]),"math/le":OU("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":OU("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":OU("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":OU("FlowGraphIsNaNBlock"),"math/isinf":OU("FlowGraphIsInfBlock"),"math/select":{aD:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{aD:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":OU("FlowGraphSinBlock"),"math/cos":OU("FlowGraphCosBlock"),"math/tan":OU("FlowGraphTanBlock"),"math/asin":OU("FlowGraphASinBlock"),"math/acos":OU("FlowGraphACosBlock"),"math/atan":OU("FlowGraphATanBlock"),"math/atan2":OU("FlowGraphATan2Block",["a","b"]),"math/sinh":OU("FlowGraphSinhBlock"),"math/cosh":OU("FlowGraphCoshBlock"),"math/tanh":OU("FlowGraphTanhBlock"),"math/asinh":OU("FlowGraphASinhBlock"),"math/acosh":OU("FlowGraphACoshBlock"),"math/atanh":OU("FlowGraphATanhBlock"),"math/exp":OU("FlowGraphExponentialBlock"),"math/log":OU("FlowGraphLogBlock"),"math/log2":OU("FlowGraphLog2Block"),"math/log10":OU("FlowGraphLog10Block"),"math/sqrt":OU("FlowGraphSquareRootBlock"),"math/cbrt":OU("FlowGraphCubeRootBlock"),"math/pow":OU("FlowGraphPowerBlock",["a","b"]),"math/length":OU("FlowGraphLengthBlock"),"math/normalize":OU("FlowGraphNormalizeBlock"),"math/dot":OU("FlowGraphDotBlock",["a","b"]),"math/cross":OU("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":OU("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":OU("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{aD:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{aD:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{aD:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{aD:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{aD:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{aD:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{aD:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":OU("FlowGraphTransposeBlock"),"math/determinant":OU("FlowGraphDeterminantBlock"),"math/inverse":OU("FlowGraphInvertMatrixBlock"),"math/matmul":OU("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{aD:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ac",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q,s){const g=Q[0].dataInputs.find((q=>"rotationQuaternion"===q.name));if(!g)throw new Error("Rotation quaternion input not found");return s._connectionValues[g.uniqueId]&&(s._connectionValues[g.uniqueId].type="Quaternion"),Q}},"math/matDecompose":{aD:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ac"}}}},"math/quatConjugate":OU("FlowGraphConjugateBlock",["a"]),"math/quatMul":{aD:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q){var s;return(s=Q[0]).config||(s.config={}),Q[0].config.type="Quaternion",Q}},"math/quatAngleBetween":OU("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{aD:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":OU("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":OU("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{aD:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q){var s;return(s=Q[0]).config||(s.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract2x2":{aD:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{aD:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q){var s;return(s=Q[0]).config||(s.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract3x3":{aD:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{aD:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q){var s;return(s=Q[0]).config||(s.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract4x4":{aD:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{aD:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q,s){var g,X;(X=Q[0]).config||(X.config={});const n=Q[0].dataInputs[0];return Q[0].config.valueType=(null===(g=s._connectionValues[n.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",Q}},"math/and":{aD:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q,s){var g,X,n;(n=Q[0]).config||(n.config={});const W=Q[0].dataInputs[0],D=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(g=s._connectionValues[W.uniqueId])||void 0===g?void 0:g.type)??(null===(X=s._connectionValues[D.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",Q}},"math/or":{aD:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q,s){var g,X,n;(n=Q[0]).config||(n.config={});const W=Q[0].dataInputs[0],D=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(g=s._connectionValues[W.uniqueId])||void 0===g?void 0:g.type)??(null===(X=s._connectionValues[D.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",Q}},"math/xor":{aD:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,c,U,J,Q,s){var g,X,n;(n=Q[0]).config||(n.config={});const W=Q[0].dataInputs[0],D=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(g=s._connectionValues[W.uniqueId])||void 0===g?void 0:g.type)??(null===(X=s._connectionValues[D.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",Q}},"math/asr":OU("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":OU("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":OU("FlowGraphLeadingZerosBlock"),"math/ctz":OU("FlowGraphTrailingZerosBlock"),"math/popcnt":OU("FlowGraphOneBitsCounterBlock"),"math/rad":OU("FlowGraphDegToRadBlock"),"math/deg":OU("FlowGraphRadToDegBlock"),"type/boolToInt":OU("FlowGraphBooleanToInt"),"type/boolToFloat":OU("FlowGraphBooleanToFloat"),"type/intToBool":OU("FlowGraphIntToBoolean"),"type/intToFloat":OU("FlowGraphIntToFloat"),"type/floatToInt":OU("FlowGraphFloatToInt"),"type/floatToBool":OU("FlowGraphFloatToBoolean"),"flow/sequence":{aD:["FlowGraphSequenceBlock"],extraProcessor(q,c,U,J,Q){const s=Q[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(q.flows||[]).length,s.signalOutputs.forEach(((q,c)=>{q.name="out_"+c})),Q}},"flow/branch":{aD:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{aD:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(q){if(q.configuration&&q.configuration.cases){const c=q.configuration.cases.value;if(!c.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return b.c.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const U=new Set(c);q.configuration.cases.value=Array.from(U)}return{valid:!0}},extraProcessor(q,c,U,J,Q){if("flow/switch"!==c.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Q[0].signalOutputs.forEach((q=>{"default"!==q.name&&(q.name="out_"+q.name)})),Q}},"flow/while":{aD:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{aD:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(q,c,U,J,Q){const s=Q[0];return s.config||(s.config={}),s.config.incrementIndexWhenLoopDone=!0,Q}},"flow/doN":{aD:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{aD:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(q,c,U,J,Q){if("flow/multiGate"!==c.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const s=Q[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(q.flows).length,s.signalOutputs.forEach(((q,c)=>{q.name="out_"+c})),Q}},"flow/waitAll":{aD:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(q){var c,U;return"number"!==typeof(null===(c=q.configuration)||void 0===c||null===(U=c.inputFlows)||void 0===U?void 0:U.value[0])&&(q.configuration=q.configuration||{inputFlows:{value:[0]}},q.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{aD:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{aD:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{aD:["FlowGraphCancelDelayBlock"]},"variable/get":{aD:["FlowGraphGetVariableBlock"],validation(q){var c,U;return null!==(c=q.configuration)&&void 0!==c&&null!==(U=c.variable)&&void 0!==U&&U.value?{valid:!0}:(b.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,c)=>[c.getVariableName(q[0])]}}},"variable/set":{aD:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,c)=>[c.getVariableName(q[0])]}}},"variable/setMultiple":{aD:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(q,c)=>[q[0].map((q=>c.getVariableName(q)))]}},extraProcessor:(q,c,U,J,Q)=>(Q[0].dataInputs.forEach((q=>{q.name=J.getVariableName(+q.name)})),Q)},"variable/interpolate":{aD:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(q,c)=>[c.getVariableName(q[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:q=>!0===q[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",AU:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",AU:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",AU:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",AU:"FlowGraphPlayAnimationBlock"},out:{name:"out",AU:"FlowGraphPlayAnimationBlock"},done:{name:"done",AU:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(q,c,U,J,Q){var s,g,X;const n=Q[0],W=null===(s=q.configuration)||void 0===s?void 0:s.variable.value[0];if("number"!==typeof W)throw b.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const D=J.arrays.staticVariables[W];"undefined"===typeof n.config.animationType.value&&(J.arrays.staticVariables,n.config.animationType.value=(0,pU.N)(D.type));const u=Q[4];return u.config||(u.config={}),(g=u.config).variable||(g.variable={}),u.config.variable.value=J.getVariableName(W),(X=Q[3]).config||(X.config={}),Q}},"pointer/get":{aD:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",AU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",AU:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,c,U,J,Q)=>(Q.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),Q)},"pointer/set":{aD:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",AU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",AU:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,c,U,J,Q)=>(Q.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),Q)},"pointer/interpolate":{aD:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",AU:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",AU:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",AU:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",AU:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",AU:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",AU:"FlowGraphPlayAnimationBlock"},out:{name:"out",AU:"FlowGraphPlayAnimationBlock"},done:{name:"done",AU:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,c,U,J,Q)=>(Q.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(q.values||[]).forEach((U=>{var Q;const s=null===(Q=q.values)||void 0===Q?void 0:Q[U];if("value"===U&&s){const q=s.type;void 0!==q&&(c.config.animationType=J.arrays.types[q].flowGraphType)}})))})),Q)},"animation/start":{aD:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",AU:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(q,c)=>[q[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(q,c)=>[q[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){const X=Q[Q.length-1];return X.config||(X.config={}),X.config.glTF=g,Q}},"animation/stop":{aD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",AU:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){const X=Q[Q.length-1];return X.config||(X.config={}),X.config.glTF=g,Q}},"animation/stopAt":{aD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",AU:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(q,c)=>[q[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){const X=Q[Q.length-1];return X.config||(X.config={}),X.config.glTF=g,Q}},"math/switch":{aD:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(q){if(q.configuration&&q.configuration.cases){const c=q.configuration.cases.value;if(!c.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return b.c.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const U=new Set(c);q.configuration.cases.value=Array.from(U)}return{valid:!0}},extraProcessor(q,c,U,J,Q){const s=Q[0];return s.dataInputs.forEach((q=>{"default"!==q.name&&"case"!==q.name&&(q.name="in_"+q.name)})),s.config||(s.config={}),s.config.treatCasesAsIntegers=!0,Q}},"debug/log":{aD:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function OU(q){let c=arguments.length>2?arguments[2]:void 0;return{aD:[q],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((q,c)=>(q[c]={name:c},q)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(q,U,J,Q,s){var g;if(c){(g=s[0]).config||(g.config={}),s[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(q.values||{}).find((U=>{var J;return void 0!==(null===(J=q.values)||void 0===J?void 0:J[U].type)&&(c=q.values[U].type,!0)})),-1!==c&&(s[0].config.type=Q.arrays.types[c].flowGraphType)}return s},validation:q=>c?GU(q):{valid:!0}}}function GU(q){if(q.values){const c=Object.keys(q.values).map((c=>q.values[c].type)).filter((q=>void 0!==q));if(!c.every((q=>q===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}VU["math/compose"]=VU["math/matCompose"],VU["math/decompose"]=VU["math/matDecompose"];var SU=U(10995);const ZU={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"hc",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class xU{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=q,this._gltf=c,this._animationTargetFps=U,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const q of this._interactivityGraph.types)this._types.push(ZU[q.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const q of this._interactivityGraph.declarations){const c=vU(q);if(!c)throw b.c.Error(["No mapping found for declaration",q]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:q.extension?q.op+":"+q.extension:q.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const q of this._interactivityGraph.variables){const c=this._parseVariable(q);this._staticVariables.push(c)}}_parseVariable(q,c){const U=this._types[q.type];if(!U)throw b.c.Error(["No type found for variable",q]),new Error("Error parsing variables");if(q.value&&q.value.length!==U.length)throw b.c.Error(["Invalid value length for variable",q,U]),new Error("Error parsing variables");const J=q.value||[];if(!J.length)switch(U.flowGraphType){case"boolean":J.push(!1);break;case"FlowGraphInteger":J.push(0);break;case"number":J.push(NaN);break;case"Vector2":J.push(NaN,NaN);break;case"hc":J.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":J.fill(NaN,0,4);break;case"Matrix":J.fill(NaN,0,16);break;case"Matrix3D":J.fill(NaN,0,9)}return"number"===U.elementType&&"string"===typeof J[0]&&(J[0]=parseFloat(J[0])),{type:U.flowGraphType,value:c?c(J,this):J}}_parseEvents(){if(this._interactivityGraph.events)for(const q of this._interactivityGraph.events){const c={eventId:q.id||"internalEvent_"+this._internalEventsCounter++};q.values&&(c.eventData=Object.keys(q.values).map((c=>{var U;const J=null===(U=q.values)||void 0===U?void 0:U[c];if(!J)throw b.c.Error(["No value found for event key",c]),new Error("Error parsing events");const Q=this._types[J.type];if(!Q)throw b.c.Error(["No type found for event value",J]),new Error("Error parsing events");const s="undefined"!==typeof J.value?this._parseVariable(J):void 0;return{id:c,type:Q.flowGraphType,eventData:!0,value:s}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw b.c.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const U=this._mappings[c.declaration];if(!U)throw b.c.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(U.flowGraphMapping.validation){const J=U.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var q;if(!J.valid)throw new Error(`Error validating interactivity node ${null===(q=this._interactivityGraph.declarations)||void 0===q?void 0:q[c.declaration].op} - ${J.error}`)}const J=[];for(const q of U.flowGraphMapping.aD){const Q=this._getEmptyBlock(q,U.fullOperationName);this._parseNodeConfiguration(c,Q,U.flowGraphMapping,q),J.push(Q)}this._nodes.push({aD:J,fullOperationName:U.fullOperationName})}}_getEmptyBlock(q,c){return{uniqueId:(0,SU.b)(),className:q,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(q,c,U,J){const Q=c.config;if(q.configuration){const c=Object.keys(q.configuration);for(const X of c){var s,g;const c=null===(s=q.configuration)||void 0===s?void 0:s[X];if(!c)throw b.c.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const n=null===(g=U.configuration)||void 0===g?void 0:g[X];if(n&&n.AU?n.AU===J:0===U.aD.indexOf(J)){const q=(null===n||void 0===n?void 0:n.name)||X;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===n||void 0===n?void 0:n.defaultValue)?c.value.length>=0?Q[q]={value:1===c.value.length?c.value[0]:c.value}:b.c.Warn(["Invalid value for node configuration",c]):Q[q]={value:n.defaultValue},n&&n.dataTransformer&&(Q[q].value=n.dataTransformer([Q[q].value],this)[0])}}}}_parseNodeConnections(q){for(let t=0;t<this._nodes.length;t++){var c;const C=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[t];if(!C)throw b.c.Error(["No node found for interactivity node",this._nodes[t]]),new Error("Error parsing node connections");const i=this._nodes[t],F=this._mappings[C.declaration];if(!F)throw b.c.Error(["No mapping found for node",C]),new Error("Error parsing node connections");const v=C.flows||{},Y=Object.keys(v).sort();for(const q of Y){var U,J,Q,s;const c=v[q],W=null===(U=F.flowGraphMapping.outputs)||void 0===U||null===(J=U.flows)||void 0===J?void 0:J[q],D=(null===W||void 0===W?void 0:W.name)||q,u=this._createNewSocketConnection(D,!0);(W&&W.AU&&i.aD.find((q=>q.className===W.AU))||i.aD[0]).signalOutputs.push(u);const K=c.node,r=this._nodes[K];if(!r)throw b.c.Error(["No node found for input node id",K]),new Error("Error parsing node connections");const H=FU(r.fullOperationName);if(!H)throw b.c.Error(["No mapping found for input node",r]),new Error("Error parsing node connections");let h=null===(Q=H.inputs)||void 0===Q||null===(s=Q.flows)||void 0===s?void 0:s[c.socket||"in"],o=!1;if(!h)for(const q in null===(g=H.inputs)||void 0===g?void 0:g.flows){var g,X,n;if(q.startsWith("[")&&q.endsWith("]"))o=!0,h=null===(X=H.inputs)||void 0===X||null===(n=X.flows)||void 0===n?void 0:n[q]}const a=h?o?h.name.replace("$1",c.socket||""):h.name:c.socket||"in",p=h&&h.AU&&r.aD.find((q=>q.className===h.AU))||r.aD[0];let R=p.signalInputs.find((q=>q.name===a));R||(R=this._createNewSocketConnection(a),p.signalInputs.push(R)),R.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(R.uniqueId)}const k=C.values||{},V=Object.keys(k);for(const c of V){var W,D;const U=k[c];let J=null===(W=F.flowGraphMapping.inputs)||void 0===W||null===(D=W.values)||void 0===D?void 0:D[c],Q=!1;if(!J)for(const q in null===(u=F.flowGraphMapping.inputs)||void 0===u?void 0:u.values){var u,K,r;if(q.startsWith("[")&&q.endsWith("]"))Q=!0,J=null===(K=F.flowGraphMapping.inputs)||void 0===K||null===(r=K.values)||void 0===r?void 0:r[q]}const s=J?Q?J.name.replace("$1",c):J.name:c,g=this._createNewSocketConnection(s);if((J&&J.AU&&i.aD.find((q=>q.className===J.AU))||i.aD[0]).dataInputs.push(g),void 0!==U.value){const c=this._parseVariable(U,J&&J.dataTransformer);q._connectionValues[g.uniqueId]=c}else{if("undefined"===typeof U.node)throw b.c.Error(["Invalid value for value connection",U]),new Error("Error parsing node connections");{var H,h,o;const q=U.node,c=U.socket||"value",J=this._nodes[q];if(!J)throw b.c.Error(["No node found for output socket reference",U]),new Error("Error parsing node connections");const Q=FU(J.fullOperationName);if(!Q)throw b.c.Error(["No mapping found for output socket reference",U]),new Error("Error parsing node connections");let s=null===(H=Q.outputs)||void 0===H||null===(h=H.values)||void 0===h?void 0:h[c],X=!1;if(!s)for(const U in null===(a=Q.outputs)||void 0===a?void 0:a.values){var a,p,R;if(U.startsWith("[")&&U.endsWith("]"))X=!0,s=null===(p=Q.outputs)||void 0===p||null===(R=p.values)||void 0===R?void 0:R[U]}const n=s?X?s.name.replace("$1",c):null===(o=s)||void 0===o?void 0:o.name:c,W=s&&s.AU&&J.aD.find((q=>q.className===s.AU))||J.aD[0];let D=W.dataOutputs.find((q=>q.name===n));D||(D=this._createNewSocketConnection(n,!0),W.dataOutputs.push(D)),g.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(g.uniqueId)}}}if(F.flowGraphMapping.interBlockConnectors)for(const q of F.flowGraphMapping.interBlockConnectors){const c=q.input,U=q.output,J=q.isVariable;this._connectFlowGraphNodes(c,U,i.aD[q.inputBlockIndex],i.aD[q.outputBlockIndex],J)}if(F.flowGraphMapping.extraProcessor){var I;const c=null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[C.declaration];if(!c)throw b.c.Error(["No declaration found for extra processor",C]),new Error("Error parsing node connections");i.aD=F.flowGraphMapping.extraProcessor(C,c,F.flowGraphMapping,this,i.aD,q,this._gltf)}}}_createNewSocketConnection(q,c){return{uniqueId:(0,SU.b)(),name:q,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(q,c,U,J,Q){const s=Q?U.dataInputs:U.signalInputs,g=Q?J.dataOutputs:J.signalOutputs,X=s.find((c=>c.name===q))||this._createNewSocketConnection(q),n=g.find((q=>q.name===c))||this._createNewSocketConnection(c,!0);s.find((c=>c.name===q))||s.push(X),g.find((q=>q.name===c))||g.push(n),X.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(X.uniqueId)}getVariableName(q){return"staticVariable_"+q}serializeToFlowGraph(){const q={uniqueId:(0,SU.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(q);for(let c=0;c<this._staticVariables.length;c++){const U=this._staticVariables[c];q._userVariables[this.getVariableName(c)]=U}return{rightHanded:!0,allBlocks:this._nodes.reduce(((q,c)=>q.concat(c.aD)),[]),executionContexts:[q]}}}const zU="KHR_interactivity";class yU{constructor(q){this._loader=q,this.name=zU,this.enabled=this._loader.isExtensionUsed(zU),this._pathConverter=(0,M.l)(this._loader.Vc),q._skipStartAnimationStep=!0;const c=q.babylonScene;c&&function(q){(0,M.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!q.activeCamera)return new Q.g(NaN,NaN,NaN,NaN);const c=Q.g.FromRotationMatrix(q.activeCamera.getWorldMatrix()).normalize();return q.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>q.activeCamera}),(0,M.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!q.activeCamera)return new Q.p(NaN,NaN,NaN);const c=q.activeCamera.getWorldMatrix().getTranslation();return q.useRightHandedSystem||(c.x*=-1),c},type:"hc",getTarget:()=>q.activeCamera}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:q=>{var c;return(null===(c=q._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:q=>q._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:q=>{var c;return((null===(c=q._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:q=>{var c;return((null===(c=q._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:q=>{var c;return((null===(c=q._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,M.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:q=>{var c;return((null===(c=q._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var q;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,U=null===(q=this._loader.Vc.extensions)||void 0===q?void 0:q.KHR_interactivity;if(!U)return;const J=new HU.b({mc:c});J.dispatchEventsSynchronously=!1;const Q=U.graphs.map((q=>new xU(q,this._loader.Vc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Q.map((async q=>await tU(q,{coordinator:J,pathConverter:this._pathConverter})))),J.start()}}var MU;MU=async()=>(await Promise.resolve().then(U.bind(U,12706))).FlowGraphGLTFDataProvider,bU[`${zU}/${"FlowGraphGLTFDataProvider"}`]=MU,y(zU),z(zU,!0,(q=>new yU(q)));const TU="KHR_node_visibility";(0,M.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:q=>{const c=q._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(q,c)=>{var U,J;null===(U=c._primitiveBabylonMeshes)||void 0===U||U.forEach((q=>{q.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=q),null===(J=c._primitiveBabylonMeshes)||void 0===J||J.forEach((c=>{c.isVisible=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class mU{constructor(q){this.name=TU,this._loader=q,this.enabled=q.isExtensionUsed(TU)}async onReady(){var q;null===(q=this._loader.Vc.nodes)||void 0===q||q.forEach((q=>{var c,U,J,Q;(null===(c=q._primitiveBabylonMeshes)||void 0===c||c.forEach((q=>{q.inheritVisibility=!0})),null!==(U=q.extensions)&&void 0!==U&&U.KHR_node_visibility)&&(!1===(null===(J=q.extensions)||void 0===J?void 0:J.KHR_node_visibility.visible)&&(q._babylonTransformNode&&(q._babylonTransformNode.isVisible=!1),null===(Q=q._primitiveBabylonMeshes)||void 0===Q||Q.forEach((q=>{q.isVisible=!1}))))}))}dispose(){this._loader=null}}y(TU),z(TU,!0,(q=>new mU(q)));const dU="KHR_node_selectability";YU("event/onSelect",dU,{aD:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AU:"FlowGraphGetVariableBlock",dataTransformer:q=>["pickedMesh_"+q[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",AU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){var X,n,W,D,u,K;const r=Q[Q.length-1];r.config=r.config||{},r.config.glTF=g;const H=null===(X=q.configuration)||void 0===X||null===(n=X.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const b="pickedMesh_"+H;return Q[1].config.variable=b,s._userVariables[b]={className:"Mesh",id:null===g||void 0===g||null===(W=g.nodes)||void 0===W||null===(D=W[H]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===g||void 0===g||null===(u=g.nodes)||void 0===u||null===(K=u[H]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},Q}}),(0,M.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:q=>{const c=q._babylonTransformNode;return!c||void 0===c.Pn||c.Pn},set:(q,c)=>{var U;null===(U=c._primitiveBabylonMeshes)||void 0===U||U.forEach((c=>{c.Pn=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"Pn"],type:"boolean"});class eU{constructor(q){this.name=dU,this._loader=q,this.enabled=q.isExtensionUsed(dU)}async onReady(){var q;null===(q=this._loader.Vc.nodes)||void 0===q||q.forEach((q=>{var c,U,J;null!==(c=q.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(U=q.extensions)||void 0===U?void 0:U.KHR_node_selectability.selectable)&&(null===(J=q._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((q=>{q.Pn=!1})))}))}dispose(){this._loader=null}}y(dU),z(dU,!0,(q=>new eU(q)));const BU="KHR_node_hoverability",NU="targetMeshPointerOver_";YU("event/onHoverIn",BU,{aD:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AU:"FlowGraphGetVariableBlock",dataTransformer:q=>[NU+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",AU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){var X,n,W,D,u,K;const r=Q[Q.length-1];r.config=r.config||{},r.config.glTF=g;const H=null===(X=q.configuration)||void 0===X||null===(n=X.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const b=NU+H;return Q[1].config.variable=b,s._userVariables[b]={className:"Mesh",id:null===g||void 0===g||null===(W=g.nodes)||void 0===W||null===(D=W[H]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===g||void 0===g||null===(u=g.nodes)||void 0===u||null===(K=u[H]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},Q}});const PU="targetMeshPointerOut_";YU("event/onHoverOut",BU,{aD:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AU:"FlowGraphGetVariableBlock",dataTransformer:q=>[PU+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",AU:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,c,U,J,Q,s,g){var X,n,W,D,u,K;const r=Q[Q.length-1];r.config=r.config||{},r.config.glTF=g;const H=null===(X=q.configuration)||void 0===X||null===(n=X.nodeIndex)||void 0===n?void 0:n.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const b=PU+H;return Q[1].config.variable=b,s._userVariables[b]={className:"Mesh",id:null===g||void 0===g||null===(W=g.nodes)||void 0===W||null===(D=W[H]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===g||void 0===g||null===(u=g.nodes)||void 0===u||null===(K=u[H]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},Q}}),(0,M.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:q=>{const c=q._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(q,c)=>{var U;null===(U=c._primitiveBabylonMeshes)||void 0===U||U.forEach((c=>{c.pointerOverDisableMeshTesting=!q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class wU{constructor(q){this.name=BU,this._loader=q,this.enabled=q.isExtensionUsed(BU)}async onReady(){var q;null===(q=this._loader.Vc.nodes)||void 0===q||q.forEach((q=>{var c,U,J;null!==(c=q.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(U=q.extensions)||void 0===U?void 0:U.KHR_node_hoverability.hoverable)&&(null===(J=q._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((q=>{q.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}y(BU),z(BU,!0,(q=>new wU(q)));const LU="ExtrasAsMetadata";class lU{_assignExtras(q,c){if(c.extras&&Object.keys(c.extras).length>0){const U=q.metadata=q.metadata||{};(U.Vc=U.Vc||{}).extras=c.extras}}constructor(q){this.name=LU,this.enabled=!0,this._loader=q}dispose(){this._loader=null}loadNodeAsync(q,c,U){return this._loader.loadNodeAsync(q,c,(q=>{this._assignExtras(q,c),U(q)}))}loadCameraAsync(q,c,U){return this._loader.loadCameraAsync(q,c,(q=>{this._assignExtras(q,c),U(q)}))}createMaterial(q,c,U){const J=this._loader.createMaterial(q,c,U);return this._assignExtras(J,c),J}}y(LU),z(LU,!1,(q=>new lU(q)));U(12706)},12587:(q,c,U)=>{"use strict";U.d(c,{d:()=>G,f:()=>F,i:()=>i,j:()=>v});var J=U(10866),Q=U(10879),s=U(12228),g=U(11149),X=U(11107),n=U(11119),W=U(10886),D=U(10864),u=U(11144),K=U(11483),r=U(11151),H=U(11087);class b{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qK=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.zK=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture=q}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const c of this.skeletons)q=q.concat(c.bones);return q}}class h extends b{}class o{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const q=this.rootNodes;for(const J of q)J.dispose();q.length=0;const c=this.skeletons;for(const J of c)J.dispose();c.length=0;const U=this.animationGroups;for(const J of U)J.dispose();U.length=0}}class a extends b{constructor(q){super(),this._wasAddedToScene=!1,(q=q||D.c.LastCreatedScene)&&(this.mc=q,this.proceduralTextures=[],q.Cc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=q.getEngine().onContextRestoredObservable.add((()=>{for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();for(const q of this.qK)q.rebuild();for(const q of this.textures)q._rebuild()})))}_topologicalSort(q){const c=new Map;for(const g of q)c.set(g.uniqueId,g);const U={dependsOn:new Map,dependedBy:new Map};for(const g of q){const q=g.uniqueId;U.dependsOn.set(q,new Set),U.dependedBy.set(q,new Set)}for(const g of q){const q=g.uniqueId,J=U.dependsOn.get(q);if(g instanceof u.d){const Q=g.sourceMesh;c.has(Q.uniqueId)&&(J.add(Q.uniqueId),U.dependedBy.get(Q.uniqueId).add(q))}const Q=U.dependedBy.get(q);for(const s of g.getDescendants()){const J=s.uniqueId;if(c.has(J)){Q.add(J);U.dependsOn.get(J).add(q)}}}const J=[],Q=[];for(const g of q){const q=g.uniqueId;0===U.dependsOn.get(q).size&&(Q.push(g),c.delete(q))}const s=Q;for(;s.length>0;){const q=s.shift();J.push(q);const Q=U.dependedBy.get(q.uniqueId);for(const J of Array.from(Q.values())){const Q=U.dependsOn.get(J);Q.delete(q.uniqueId),0===Q.size&&c.get(J)&&(s.push(c.get(J)),c.delete(J))}}return c.size>0&&(W.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((q=>{W.c.Error(q.name)}))),J}_addNodeAndDescendantsToList(q,c,U,J){if(U&&(!J||J(U))&&!c.has(U.uniqueId)){q.push(U),c.add(U.uniqueId);for(const Q of U.getDescendants(!0))this._addNodeAndDescendantsToList(q,c,Q,J)}}_isNodeInContainer(q){return q instanceof n.c&&-1!==this.meshes.indexOf(q)||(q instanceof X.c&&-1!==this.transformNodes.indexOf(q)||(q instanceof K.c&&-1!==this.lights.indexOf(q)||q instanceof r.d&&-1!==this.cameras.indexOf(q)))}_isValidHierarchy(){for(const q of this.meshes)if(q.parent&&!this._isNodeInContainer(q.parent))return W.c.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.transformNodes)if(q.parent&&!this._isNodeInContainer(q.parent))return W.c.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.lights)if(q.parent&&!this._isNodeInContainer(q.parent))return W.c.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.cameras)if(q.parent&&!this._isNodeInContainer(q.parent))return W.c.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Q.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const J={},s={},X=new o,n=[],W=[],D={doNotInstantiate:!0,...U},u=[],K=new Set;for(const Q of this.transformNodes)null===Q.parent&&this._addNodeAndDescendantsToList(u,K,Q,D.predicate);for(const Q of this.meshes)null===Q.parent&&this._addNodeAndDescendantsToList(u,K,Q,D.predicate);const r=this._topologicalSort(u),H=(U,Q)=>{if(((c,U)=>{if(J[c.uniqueId]=U.uniqueId,s[U.uniqueId]=U,q&&(U.name=q(c.name)),U instanceof g.b){const q=U;if(q.morphTargetManager){const U=c.morphTargetManager;q.morphTargetManager=U.clone();for(let c=0;c<U.numTargets;c++){const Q=U.getTarget(c),g=q.morphTargetManager.getTarget(c);J[Q.uniqueId]=g.uniqueId,s[g.uniqueId]=g}}}})(U,Q),U.parent){const q=J[U.parent.uniqueId],c=s[q];Q.parent=c||U.parent}if(Q.position&&U.position&&Q.position.X(U.position),Q.rotationQuaternion&&U.rotationQuaternion&&Q.rotationQuaternion.X(U.rotationQuaternion),Q.rotation&&U.rotation&&Q.rotation.X(U.rotation),Q.ac&&U.ac&&Q.ac.X(U.ac),Q.material){const g=Q;if(g.material)if(c){const c=U.material;if(-1===W.indexOf(c)){let U=c.clone(q?q(c.name):"Clone of "+c.name);if(W.push(c),J[c.uniqueId]=U.uniqueId,s[U.uniqueId]=U,"MultiMaterial"===c.getClassName()){const Q=c;for(const c of Q.Sc)c&&(U=c.clone(q?q(c.name):"Clone of "+c.name),W.push(c),J[c.uniqueId]=U.uniqueId,s[U.uniqueId]=U);Q.Sc=Q.Sc.map((q=>q&&s[J[q.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=s[J[c.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.mc.multiMaterials.indexOf(g.material)&&this.mc.addMultiMaterial(g.material):-1===this.mc.materials.indexOf(g.material)&&this.mc.addMaterial(g.material)}null===Q.parent&&X.rootNodes.push(Q)};for(const Q of r)if("InstancedMesh"===Q.getClassName()){const q=Q,c=q.sourceMesh,U=J[c.uniqueId];H(q,("number"===typeof U?s[U]:c).createInstance(q.name))}else{let q=!0;"wc"===Q.getClassName()||"Node"===Q.getClassName()||Q.skeleton||!Q.getTotalVertices||0===Q.getTotalVertices()?q=!1:D.doNotInstantiate&&(q="function"===typeof D.doNotInstantiate?!D.doNotInstantiate(Q):!D.doNotInstantiate);const c=q?Q.createInstance(`instance of ${Q.name}`):Q.clone(`Clone of ${Q.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${Q.name}`);H(Q,c)}for(const Q of this.skeletons){if(D.predicate&&!D.predicate(Q))continue;const c=Q.clone(q?q(Q.name):"Clone of "+Q.name);for(const q of this.meshes)if(q.skeleton===Q&&!q.isAnInstance){const U=s[J[q.uniqueId]];if(!U||U.isAnInstance)continue;if(U.skeleton=c,-1!==n.indexOf(c))continue;n.push(c);for(const q of c.bones)q._linkedTransformNode&&(q._linkedTransformNode=s[J[q._linkedTransformNode.uniqueId]])}X.skeletons.push(c)}for(const Q of this.animationGroups){if(D.predicate&&!D.predicate(Q))continue;const c=Q.clone(q?q(Q.name):"Clone of "+Q.name,(q=>s[J[q.uniqueId]]||q));X.animationGroups.push(c)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Q.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.mc.environmentTexture=this.environmentTexture);for(const q of this.mc._serializableComponents)q.addFromContainer(this);this.mc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const U of this.cameras)q&&!q(U)||(this.mc.addCamera(U),c.push(U));for(const U of this.lights)q&&!q(U)||(this.mc.addLight(U),c.push(U));for(const U of this.meshes)q&&!q(U)||(this.mc.sD(U),c.push(U));for(const U of this.skeletons)q&&!q(U)||this.mc.addSkeleton(U);for(const U of this.animations)q&&!q(U)||this.mc.addAnimation(U);for(const U of this.animationGroups)q&&!q(U)||this.mc.addAnimationGroup(U);for(const U of this.multiMaterials)q&&!q(U)||this.mc.addMultiMaterial(U);for(const U of this.materials)q&&!q(U)||this.mc.addMaterial(U);for(const U of this.morphTargetManagers)q&&!q(U)||this.mc.addMorphTargetManager(U);for(const U of this.geometries)q&&!q(U)||this.mc.addGeometry(U);for(const U of this.transformNodes)q&&!q(U)||(this.mc.addTransformNode(U),c.push(U));for(const U of this.actionManagers)q&&!q(U)||this.mc.addActionManager(U);for(const U of this.textures)q&&!q(U)||this.mc.addTexture(U);for(const U of this.reflectionProbes)q&&!q(U)||this.mc.addReflectionProbe(U);for(const U of c)U.parent&&-1===this.mc.getNodes().indexOf(U.parent)&&(U.setParent?U.setParent(null):U.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Q.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.mc.environmentTexture&&(this.mc.environmentTexture=null);for(const q of this.mc._serializableComponents)q.removeFromContainer(this)}removeFromScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)q&&!q(c)||this.mc.removeCamera(c);for(const c of this.lights)q&&!q(c)||this.mc.removeLight(c);for(const c of this.meshes)q&&!q(c)||this.mc.QD(c,!0);for(const c of this.skeletons)q&&!q(c)||this.mc.removeSkeleton(c);for(const c of this.animations)q&&!q(c)||this.mc.removeAnimation(c);for(const c of this.animationGroups)q&&!q(c)||this.mc.removeAnimationGroup(c);for(const c of this.multiMaterials)q&&!q(c)||this.mc.removeMultiMaterial(c);for(const c of this.materials)q&&!q(c)||this.mc.removeMaterial(c);for(const c of this.morphTargetManagers)q&&!q(c)||this.mc.removeMorphTargetManager(c);for(const c of this.geometries)q&&!q(c)||this.mc.removeGeometry(c);for(const c of this.transformNodes)q&&!q(c)||this.mc.removeTransformNode(c);for(const c of this.actionManagers)q&&!q(c)||this.mc.removeActionManager(c);for(const c of this.textures)q&&!q(c)||this.mc.removeTexture(c);for(const c of this.reflectionProbes)q&&!q(c)||this.mc.removeReflectionProbe(c)}dispose(){const q=this.cameras.slice(0);for(const r of q)r.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const r of c)r.dispose();this.lights.length=0;const U=this.meshes.slice(0);for(const r of U)r.dispose();this.meshes.length=0;const J=this.skeletons.slice(0);for(const r of J)r.dispose();this.skeletons.length=0;const Q=this.animationGroups.slice(0);for(const r of Q)r.dispose();this.animationGroups.length=0;const s=this.multiMaterials.slice(0);for(const r of s)r.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const r of g)r.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const r of X)r.dispose();this.geometries.length=0;const n=this.transformNodes.slice(0);for(const r of n)r.dispose();this.transformNodes.length=0;const W=this.actionManagers.slice(0);for(const r of W)r.dispose();this.actionManagers.length=0;const D=this.textures.slice(0);for(const r of D)r.dispose();this.textures.length=0;const u=this.reflectionProbes.slice(0);for(const r of u)r.dispose();this.reflectionProbes.length=0;const K=this.morphTargetManagers.slice(0);for(const r of K)r.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const r of this.mc._serializableComponents)r.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.mc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(q,c,U){if(q&&c)for(const J of q){let q=!0;if(U)for(const c of U)if(J===c){q=!1;break}q&&(c.push(J),J._parentContainer=this)}}moveAllFromScene(q){this._wasAddedToScene=!1,void 0===q&&(q=new h);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.mc[c],this[c],q[c]));this.environmentTexture=this.mc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const q=new g.b("assetContainerRootMesh",this.mc);for(const c of this.meshes)c.parent||q.addChild(c);return this.meshes.unshift(q),q}mergeAnimationsTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.c.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!q)return W.c.Error("No scene available to merge animations to"),[];const J=U||(c=>{let U=null;const J=c.animations.length?c.animations[0].targetProperty:"",Q=c.name.split(".").join("").split("_primitive")[0];switch(J){case"position":case"rotationQuaternion":U=q.getTransformNodeByName(c.name)||q.getTransformNodeByName(Q);break;case"influence":U=q.getMorphTargetByName(c.name)||q.getMorphTargetByName(Q);break;default:U=q.getNodeByName(c.name)||q.getNodeByName(Q)}return U}),Q=this.getNodes();for(const X of Q){const q=J(X);if(null!==q){for(const c of X.animations){const U=q.animations.filter((q=>q.targetProperty===c.targetProperty));for(const c of U){const U=q.animations.indexOf(c,0);U>-1&&q.animations.splice(U,1)}}q.animations=q.animations.concat(X.animations)}}const s=[],g=this.animationGroups.slice();for(const X of g){s.push(X.clone(X.name,J));for(const q of X.animatables)q.stop()}for(const X of c){const c=J(X.target);c&&(q.beginAnimation(c,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),q.stopAnimation(X.target))}return s}populateRootNodes(){this.rootNodes.length=0;for(const q of this.meshes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.transformNodes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.lights)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.cameras)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)}addAllAssetsToContainer(q){if(!q)return;const c=[],U=new Set;for(c.push(q);c.length>0;){const q=c.pop();if(q instanceof g.b?(q.Dc&&-1===this.geometries.indexOf(q.Dc)&&this.geometries.push(q.Dc),this.meshes.push(q)):q instanceof u.d?this.meshes.push(q):q instanceof X.c?this.transformNodes.push(q):q instanceof K.c?this.lights.push(q):q instanceof r.d&&this.cameras.push(q),q instanceof n.c){if(q.material&&-1===this.materials.indexOf(q.material)){this.materials.push(q.material);for(const c of q.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}q.skeleton&&-1===this.skeletons.indexOf(q.skeleton)&&this.skeletons.push(q.skeleton),q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(q.morphTargetManager)&&this.morphTargetManagers.push(q.morphTargetManager)}for(const J of q.getChildren())U.has(J)||c.push(J);U.add(q)}this.populateRootNodes()}_getByTags(q,c,U){if(void 0===c)return q;const J=[];for(const Q in q){const s=q[Q];H.d&&H.d.MatchesQuery(s,c)&&(!U||U(s))&&J.push(s)}return J}getMeshesByTags(q,c){return this._getByTags(this.meshes,q,c)}getCamerasByTags(q,c){return this._getByTags(this.cameras,q,c)}getLightsByTags(q,c){return this._getByTags(this.lights,q,c)}getMaterialsByTags(q,c){return this._getByTags(this.materials,q,c).concat(this._getByTags(this.multiMaterials,q,c))}getTransformNodesByTags(q,c){return this._getByTags(this.transformNodes,q,c)}}var p=U(10930);class R{constructor(q){this.byteOffset=0,this.buffer=q}async loadAsync(q){const c=await this.buffer.readAsync(this.byteOffset,q);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,q}readUint8Array(q){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,q);return this._dataByteOffset+=q,this.byteOffset+=q,c}readString(q){return(0,p.i)(this.readUint8Array(q))}skipBytes(q){this._dataByteOffset+=q,this.byteOffset+=q}}var I=U(12589);const t="Z2xURg",C={name:"Vc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:q=>-1!==q.indexOf("asset")&&-1!==q.indexOf("version")||q.startsWith("data:base64,"+t)||q.startsWith("data:;base64,"+t)||q.startsWith("data:application/octet-stream;base64,"+t)||q.startsWith("data:model/gltf-binary;base64,"+t)};var i,F,v,Y=U(10922),k=U(10928);function V(q,c,U){try{return Promise.resolve(new Uint8Array(q,c,U))}catch(J){return Promise.reject(J)}}!function(q){q[q.AUTO=0]="AUTO",q[q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(q){q[q.NONE=0]="NONE",q[q.FIRST=1]="FIRST",q[q.ALL=2]="ALL"}(F||(F={})),function(q){q[q.LOADING=0]="LOADING",q[q.READY=1]="READY",q[q.COMPLETE=2]="COMPLETE"}(v||(v={}));class O{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=F.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=q=>Promise.resolve(q),this.extensionOptions={}}X(q){q&&(this.onParsed=q.onParsed,this.coordinateSystemMode=q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=q.loadSkins??this.loadSkins,this.loadMorphTargets=q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=q.compileMaterials??this.compileMaterials,this.useClipPlane=q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=q.useRangeRequests??this.useRangeRequests,this.createInstances=q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=q.customRootNode,this.onMeshLoaded=q.onMeshLoaded,this.onSkinLoaded=q.onSkinLoaded,this.onTextureLoaded=q.onTextureLoaded,this.onMaterialLoaded=q.onMaterialLoaded,this.onCameraLoaded=q.onCameraLoaded,this.extensionOptions=q.extensionOptions??this.extensionOptions)}}class G extends O{constructor(q){super(),this.onParsedObservable=new J.e,this.onMeshLoadedObservable=new J.e,this.onSkinLoadedObservable=new J.e,this.onTextureLoadedObservable=new J.e,this.onMaterialLoadedObservable=new J.e,this.onCameraLoadedObservable=new J.e,this.onCompleteObservable=new J.e,this.onErrorObservable=new J.e,this.Cc=new J.e,this.onExtensionLoadedObservable=new J.e,this.validate=!1,this.onValidatedObservable=new J.e,this._loader=null,this._state=null,this._requests=new Array,this.name=C.name,this.extensions=C.extensions,this.onLoaderStateChangedObservable=new J.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.X(q)}set onParsed(q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),q&&(this._onParsedObserver=this.onParsedObservable.add(q))}set onMeshLoaded(q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(q))}set onSkinLoaded(q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>q(c.node,c.skinnedNode))))}set onTextureLoaded(q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(q))}set onMaterialLoaded(q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(q))}set onCameraLoaded(q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(q))}set onComplete(q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(q)}set onError(q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(q)}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}set onExtensionLoaded(q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(q){this._loggingEnabled!==q&&(this._loggingEnabled=q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(q){this._capturePerformanceCounters!==q&&(this._capturePerformanceCounters=q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const q of this._requests)q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=q=>Promise.resolve(q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Cc.notifyObservers(void 0),this.Cc.clear()}loadFile(q,c,U,s,g,X,n,D){if(ArrayBuffer.isView(c))return this._loadBinary(q,c,U,s,n,D),null;this._progressCallback=g;const u=c.name||Q.e.GetFilename(c);if(X){if(this.useRangeRequests){this.validate&&W.c.Warn("glTF validation is not supported when range requests are enabled");const U={abort:()=>{},onCompleteObservable:new J.e},Q={readAsync:(U,J)=>new Promise(((Q,s)=>{this._loadFile(q,c,(q=>{Q(new Uint8Array(q))}),!0,(q=>{s(q)}),(q=>{q.setRequestHeader("Range",`bytes=${U}-${U+J-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new R(Q)).then((q=>{U.onCompleteObservable.notifyObservers(U),s(q)}),n?q=>n(void 0,q):void 0),U}return this._loadFile(q,c,(c=>{this._validate(q,new Uint8Array(c,0,c.byteLength),U,u),this._unpackBinaryAsync(new R({readAsync:(q,U)=>V(c,q,U),byteLength:c.byteLength})).then((q=>{s(q)}),n?q=>n(void 0,q):void 0)}),!0,n)}return this._loadFile(q,c,(c=>{try{this._validate(q,c,U,u),s({json:this._parseJson(c)})}catch{n&&n()}}),!1,n)}_loadBinary(q,c,U,J,Q,s){this._validate(q,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),U,s),this._unpackBinaryAsync(new R({readAsync:(q,U)=>function(q,c,U){try{if(c<0||c>=q.byteLength)throw new RangeError("Offset is out of range.");if(c+U>q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(q.buffer,q.byteOffset+c,U))}catch(J){return Promise.reject(J)}}(c,q,U),byteLength:c.byteLength})).then((q=>{J(q)}),Q?q=>Q(void 0,q):void 0)}importMeshAsync(q,c,U,J,Q,s){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(U),this._loader.importMeshAsync(q,c,null,U,J,Q,s))))}loadAsync(q,c,U,J,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(q,c,U,J,Q))))}loadAssetContainerAsync(q,c,U,J,Q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(c);const s=new a(q),g=[];this.onMaterialLoadedObservable.add((q=>{g.push(q)}));const X=[];this.onTextureLoadedObservable.add((q=>{X.push(q)}));const n=[];this.onCameraLoadedObservable.add((q=>{n.push(q)}));const W=[];return this.onMeshLoadedObservable.add((q=>{q.morphTargetManager&&W.push(q.morphTargetManager)})),this._loader.importMeshAsync(null,q,s,c,U,J,Q).then((q=>(Array.prototype.push.apply(s.geometries,q.geometries),Array.prototype.push.apply(s.meshes,q.meshes),Array.prototype.push.apply(s.qK,q.qK),Array.prototype.push.apply(s.skeletons,q.skeletons),Array.prototype.push.apply(s.animationGroups,q.animationGroups),Array.prototype.push.apply(s.materials,g),Array.prototype.push.apply(s.textures,X),Array.prototype.push.apply(s.lights,q.lights),Array.prototype.push.apply(s.transformNodes,q.transformNodes),Array.prototype.push.apply(s.cameras,n),Array.prototype.push.apply(s.morphTargetManagers,W),s)))}))}canDirectLoad(q){return C.canDirectLoad(q)}directLoad(q,c){if(c.startsWith("base64,"+t)||c.startsWith(";base64,"+t)||c.startsWith("application/octet-stream;base64,"+t)||c.startsWith("model/gltf-binary;base64,"+t)){const U=(0,Y.c)(c);return this._validate(q,new Uint8Array(U,0,U.byteLength)),this._unpackBinaryAsync(new R({readAsync:(q,c)=>V(U,q,c),byteLength:U.byteLength}))}return this._validate(q,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(q){return new G(q[C.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((q,c)=>{this.onCompleteObservable.addOnce((()=>{q()})),this.onErrorObservable.addOnce((q=>{c(q)}))}))}_setState(q){this._state!==q&&(this._state=q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(v[this._state]))}_loadFile(q,c,U,J,Q,s){const g=q._loadFile(c,U,(q=>{this._onProgress(q,g)}),!0,J,Q,s);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(q,c){if(!this._progressCallback)return;c._lengthComputable=q.lengthComputable,c._loaded=q.loaded,c._total=q.total;let U=!0,J=0,Q=0;for(const s of this._requests){if(void 0===s._lengthComputable||void 0===s._loaded||void 0===s._total)return;U=U&&s._lengthComputable,J+=s._loaded,Q+=s._total}this._progressCallback({lengthComputable:U,loaded:J,total:U?Q:0})}_validate(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),I.c.ValidateAsync(c,U,J,(c=>this.preprocessUrlAsync(U+c).then((c=>q._loadFileAsync(c,void 0,!0,!0).then((q=>new Uint8Array(q,0,q.byteLength))))))).then((q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(q),this.onValidatedObservable.clear()}),(q=>{this._endPerformanceCounter("Validate JSON"),Q.e.Warn(`Failed to validate: ${q.message}`),this.onValidatedObservable.clear()})))}_getLoader(q){const c=q.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const U=G._parseVersion(c.version);if(!U)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const q=G._parseVersion(c.minVersion);if(!q)throw new Error("Invalid minimum version: "+c.minVersion);if(G._compareVersion(q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const J={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[U.major];if(!J)throw new Error("Unsupported version: "+c.version);return J(this)}_parseJson(q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${q.length}`);const c=JSON.parse(q);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(q){return this._startPerformanceCounter("Unpack Binary"),q.loadAsync(20).then((()=>{const c=q.readUint32();if(1179937895!==c)throw new k.i("Unexpected magic: "+c,k.e.GLTFLoaderUnexpectedMagicError);const U=q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${U}`);const J=q.readUint32();let Q;switch(this.useRangeRequests||J===q.buffer.byteLength||W.c.Warn(`Length in header does not match actual data length: ${J} != ${q.buffer.byteLength}`),U){case 1:Q=this._unpackBinaryV1Async(q,J);break;case 2:Q=this._unpackBinaryV2Async(q,J);break;default:throw new Error("Unsupported version: "+U)}return this._endPerformanceCounter("Unpack Binary"),Q}))}_unpackBinaryV1Async(q,c){const U=q.readUint32(),J=q.readUint32();if(0!==J)throw new Error(`Unexpected content format: ${J}`);const Q=c-q.byteOffset,s={json:this._parseJson(q.readString(U)),bin:null};if(0!==Q){const c=q.byteOffset;s.bin={readAsync:(U,J)=>q.buffer.readAsync(c+U,J),byteLength:Q}}return Promise.resolve(s)}_unpackBinaryV2Async(q,c){const U=1313821514,J=5130562,Q=q.readUint32();if(q.readUint32()!==U)throw new Error("First chunk format is not JSON");return q.byteOffset+Q===c?q.loadAsync(Q).then((()=>({json:this._parseJson(q.readString(Q)),bin:null}))):q.loadAsync(Q+8).then((()=>{const s={json:this._parseJson(q.readString(Q)),bin:null},g=()=>{const Q=q.readUint32();switch(q.readUint32()){case U:throw new Error("Unexpected JSON chunk");case J:{const c=q.byteOffset;s.bin={readAsync:(U,J)=>q.buffer.readAsync(c+U,J),byteLength:Q},q.skipBytes(Q);break}default:q.skipBytes(Q)}return q.byteOffset!==c?q.loadAsync(8).then(g):Promise.resolve(s)};return g()}))}static _parseVersion(q){if("1.0"===q||"1.0.1"===q)return{major:1,minor:0};const c=(q+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(q,c){return q.major>c.major?1:q.major<c.major?-1:q.minor>c.minor?1:q.minor<c.minor?-1:0}_logOpen(q){this._log(q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(q){const c=G._logSpaces.substring(0,2*this._logIndentLevel);W.c.Log(`${c}${q}`)}_logDisabled(q){}_startPerformanceCounterEnabled(q){Q.e.StartPerformanceCounter(q)}_startPerformanceCounterDisabled(q){}_endPerformanceCounterEnabled(q){Q.e.EndPerformanceCounter(q)}_endPerformanceCounterDisabled(q){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,s.e)(new G)},12589:(q,c,U)=>{"use strict";U.d(c,{c:()=>g});var J=U(10879);function Q(q,c,U,J){const Q={externalResourceFunction:J};return U&&(Q.uri="file:"===c?U:c+U),ArrayBuffer.isView(q)?GLTFValidator.validateBytes(q,Q):GLTFValidator.validateString(q,Q)}function s(){const q=[];onmessage=c=>{const U=c.data;switch(U.id){case"init":importScripts(U.url);break;case"validate":Q(U.data,U.rootUrl,U.fileName,(c=>new Promise(((U,J)=>{const Q=q.length;q.push({resolve:U,reject:J}),postMessage({id:"getExternalResource",index:Q,uri:c})})))).then((q=>{postMessage({id:"validate.resolve",value:q})}),(q=>{postMessage({id:"validate.reject",reason:q})}));break;case"getExternalResource.resolve":q[U.index].resolve(U.value);break;case"getExternalResource.reject":q[U.index].reject(U.reason)}}}class g{static ValidateAsync(q,c,U,g){return"function"===typeof Worker?new Promise(((X,n)=>{const W=`${Q}(${s})()`,D=URL.createObjectURL(new Blob([W],{type:"application/javascript"})),u=new Worker(D),K=q=>{u.removeEventListener("error",K),u.removeEventListener("message",r),n(q)},r=q=>{const c=q.data;switch(c.id){case"getExternalResource":g(c.uri).then((q=>{u.postMessage({id:"getExternalResource.resolve",index:c.index,value:q},[q.buffer])}),(q=>{u.postMessage({id:"getExternalResource.reject",index:c.index,reason:q})}));break;case"validate.resolve":u.removeEventListener("error",K),u.removeEventListener("message",r),X(c.value),u.terminate();break;case"validate.reject":u.removeEventListener("error",K),u.removeEventListener("message",r),n(c.reason),u.terminate()}};if(u.addEventListener("error",K),u.addEventListener("message",r),u.postMessage({id:"init",url:J.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(q)){const J=q.slice();u.postMessage({id:"validate",data:J,rootUrl:c,fileName:U},[J.buffer])}else u.postMessage({id:"validate",data:q,rootUrl:c,fileName:U})})):(this._LoadScriptPromise||(this._LoadScriptPromise=J.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Q(q,c,U,g))))}}g.Configuration={url:`${J.e._DefaultCdnUrl}/gltf_validator.js`}},13113:(q,c,U)=>{"use strict";U.d(c,{e:()=>C});var J=U(11010),Q=U(11019),s=U(11082),g=U(10833),X=U(11416),n=U(11429),W=U(11031),D=U(11364),u=U(10850),K=U(10961);U(12366),U(12270),U(12282),U(12277),U(12291),U(12299),U(12303);const r="imageProcessingCompatibility",H="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";K.c.IncludesShadersStore[r]||(K.c.IncludesShadersStore[r]=H);const b="skyPixelShader",h="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";K.c.ShadersStore[b]||(K.c.ShadersStore[b]=h);U(12384),U(12305),U(12309),U(12319),U(12312);const o="skyVertexShader",a="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";K.c.ShadersStore[o]||(K.c.ShadersStore[o]=a);var p=U(11454),R=U(11104),I=U(11095);class t extends X.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class C extends n.d{constructor(q,c){super(q,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.p(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.p.Zero(),this.up=g.p.Up(),this.dithering=!1,this._cameraPosition=g.p.Zero(),this._skyOrientation=new g.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(q,c){const U=c._drawWrapper;if(this.isFrozen&&U.effect&&U._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new t);const J=c.materialDefines,Q=this.Cq();if(this._isReadyForSubMesh(c))return!0;if((0,I.S)(q,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,J),(0,I.H)(q,J,!0,!1),J.IMAGEPROCESSINGPOSTPROCESS!==Q.imageProcessingConfiguration.applyByPostProcess&&J.markAsMiscDirty(),J.DITHER!==this.dithering&&J.markAsMiscDirty(),J.isDirty){J.markAsProcessed(),Q.resetCachedMaterial();const q=new p.b;J.FOG&&q.addFallback(1,"FOG"),J.IMAGEPROCESSINGPOSTPROCESS=Q.imageProcessingConfiguration.applyByPostProcess,J.DITHER=this.dithering;const U=[W.h.PositionKind];J.VERTEXCOLOR&&U.push(W.h.ColorKind);const s="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,R.b)(g);const X=J.toString();c.setEffect(Q.getEngine().createEffect(s,U,g,[],X,q,this.onCompiled,this.onError),J,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(J._renderId=Q.getRenderId(),U._wasPreviouslyReady=!0,!0)}bindForSubMesh(q,c,U){const J=this.Cq(),Q=U.materialDefines;if(!Q)return;const s=U.effect;if(!s)return;this._activeEffect=s,this.bindOnlyWorldMatrix(q),this._activeEffect.setMatrix("viewProjection",J.getTransformMatrix()),this._mustRebind(J,s,U)&&((0,R.c)(s,this,J),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,I.m)(Q,s,J)),J.fogEnabled&&c.applyFog&&J.fogMode!==D.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",J.getViewMatrix()),(0,I.f)(J,c,this._activeEffect);const X=J.activeCamera;if(X){const q=X.getWorldMatrix();this._cameraPosition.x=q.m[12],this._cameraPosition.y=q.m[13],this._cameraPosition.z=q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const q=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(q),this.sunPosition.y=this.distance*Math.sin(-q),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(q),g.g.FromUnitVectorsToRef(g.p.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,U)}getAnimatables(){return[]}dispose(q){super.dispose(q)}clone(q){return s.e.Clone((()=>new C(q,this.Cq())),this)}serialize(){const q=super.serialize();return q.customType="BABYLON.SkyMaterial",q}getClassName(){return"SkyMaterial"}static Parse(q,c,U){return s.e.Parse((()=>new C(q.name,c)),q,c,U)}}(0,J.d)([(0,Q.N)()],C.prototype,"luminance",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"turbidity",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"rayleigh",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"mieCoefficient",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"mieDirectionalG",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"distance",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"inclination",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"azimuth",void 0),(0,J.d)([(0,Q.K)()],C.prototype,"sunPosition",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"useSunPosition",void 0),(0,J.d)([(0,Q.K)()],C.prototype,"cameraOffset",void 0),(0,J.d)([(0,Q.K)()],C.prototype,"up",void 0),(0,J.d)([(0,Q.N)()],C.prototype,"dithering",void 0),(0,u.f)("BABYLON.SkyMaterial",C)},11571:(q,c,U)=>{"use strict";function J(q,c){c.headers=q.headers||{},c.statusMessage=q.statusText,c.statusCode=q.status,c.data=q.response}function Q(q,c,U){return new Promise((function(Q,s){U=U||{};var g,X,n,W=new XMLHttpRequest,D=U.body,u=U.headers||{};for(g in U.timeout&&(W.timeout=U.timeout),W.ontimeout=W.onerror=function(q){q.timeout="timeout"==q.type,s(q)},W.open(q,c.href||c),W.onload=function(){for(n=W.getAllResponseHeaders().trim().split(/[\r\n]+/),J(W,W);X=n.shift();)X=X.split(": "),W.headers[X.shift().toLowerCase()]=X.join(": ");if((X=W.headers["content-type"])&&~X.indexOf("application/json"))try{W.data=JSON.parse(W.data,U.reviver)}catch(q){return J(W,q),s(q)}(W.status>=400?s:Q)(W)},typeof FormData<"u"&&D instanceof FormData||D&&"object"==typeof D&&(u["content-type"]="application/json",D=JSON.stringify(D)),W.withCredentials=!!U.withCredentials,u)W.setRequestHeader(g,u[g]);W.send(D)}))}U.r(c),U.d(c,{del:()=>n,get:()=>s,patch:()=>X,post:()=>g,put:()=>W,send:()=>Q});var s=Q.bind(Q,"GET"),g=Q.bind(Q,"POST"),X=Q.bind(Q,"PATCH"),n=Q.bind(Q,"DELETE"),W=Q.bind(Q,"PUT")},13248:(q,c,U)=>{"use strict";U.d(c,{b:()=>u});const J=.5*(Math.sqrt(3)-1),Q=(3-Math.sqrt(3))/6,s=1/3,g=1/6,X=(Math.sqrt(5)-1)/4,n=(5-Math.sqrt(5))/20,W=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),D=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const u=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof q?q:function(q){let c=0,U=0,J=0,Q=1;const s=function(){let q=4022871197;return function(c){c=c.toString();for(let U=0;U<c.length;U++){q+=c.charCodeAt(U);let J=.02519603282416938*q;q=J>>>0,J-=q,J*=q,q=J>>>0,J-=q,q+=4294967296*J}return 2.3283064365386963e-10*(q>>>0)}}();c=s(" "),U=s(" "),J=s(" "),c-=s(q),c<0&&(c+=1);U-=s(q),U<0&&(U+=1);J-=s(q),J<0&&(J+=1);return function(){const q=2091639*c+2.3283064365386963e-10*Q;return c=U,U=J,J=q-(Q=0|q)}}(q);this.p=function(q){const c=new Uint8Array(256);for(let U=0;U<256;U++)c[U]=U;for(let U=0;U<255;U++){const J=U+~~(q()*(256-U)),Q=c[U];c[U]=c[J],c[J]=Q}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let U=0;U<512;U++)this.perm[U]=this.p[255&U],this.permMod12[U]=this.perm[U]%12}noise2D(q,c){const U=this.permMod12,s=this.perm;let g=0,X=0,n=0;const D=(q+c)*J,u=Math.floor(q+D),K=Math.floor(c+D),r=(u+K)*Q,H=q-(u-r),b=c-(K-r);let h,o;H>b?(h=1,o=0):(h=0,o=1);const a=H-h+Q,p=b-o+Q,R=H-1+2*Q,I=b-1+2*Q,t=255&u,C=255&K;let i=.5-H*H-b*b;if(i>=0){const q=3*U[t+s[C]];i*=i,g=i*i*(W[q]*H+W[q+1]*b)}let F=.5-a*a-p*p;if(F>=0){const q=3*U[t+h+s[C+o]];F*=F,X=F*F*(W[q]*a+W[q+1]*p)}let v=.5-R*R-I*I;if(v>=0){const q=3*U[t+1+s[C+1]];v*=v,n=v*v*(W[q]*R+W[q+1]*I)}return 70*(g+X+n)}noise3D(q,c,U){const J=this.permMod12,Q=this.perm;let X,n,D,u;const K=(q+c+U)*s,r=Math.floor(q+K),H=Math.floor(c+K),b=Math.floor(U+K),h=(r+H+b)*g,o=q-(r-h),a=c-(H-h),p=U-(b-h);let R,I,t,C,i,F;o>=a?a>=p?(R=1,I=0,t=0,C=1,i=1,F=0):o>=p?(R=1,I=0,t=0,C=1,i=0,F=1):(R=0,I=0,t=1,C=1,i=0,F=1):a<p?(R=0,I=0,t=1,C=0,i=1,F=1):o<p?(R=0,I=1,t=0,C=0,i=1,F=1):(R=0,I=1,t=0,C=1,i=1,F=0);const v=o-R+g,Y=a-I+g,k=p-t+g,V=o-C+2*g,O=a-i+2*g,G=p-F+2*g,S=o-1+.5,Z=a-1+.5,x=p-1+.5,z=255&r,y=255&H,M=255&b;let T=.6-o*o-a*a-p*p;if(T<0)X=0;else{const q=3*J[z+Q[y+Q[M]]];T*=T,X=T*T*(W[q]*o+W[q+1]*a+W[q+2]*p)}let m=.6-v*v-Y*Y-k*k;if(m<0)n=0;else{const q=3*J[z+R+Q[y+I+Q[M+t]]];m*=m,n=m*m*(W[q]*v+W[q+1]*Y+W[q+2]*k)}let d=.6-V*V-O*O-G*G;if(d<0)D=0;else{const q=3*J[z+C+Q[y+i+Q[M+F]]];d*=d,D=d*d*(W[q]*V+W[q+1]*O+W[q+2]*G)}let e=.6-S*S-Z*Z-x*x;if(e<0)u=0;else{const q=3*J[z+1+Q[y+1+Q[M+1]]];e*=e,u=e*e*(W[q]*S+W[q+1]*Z+W[q+2]*x)}return 32*(X+n+D+u)}noise4D(q,c,U,J){const Q=this.perm;let s,g,W,u,K;const r=(q+c+U+J)*X,H=Math.floor(q+r),b=Math.floor(c+r),h=Math.floor(U+r),o=Math.floor(J+r),a=(H+b+h+o)*n,p=q-(H-a),R=c-(b-a),I=U-(h-a),t=J-(o-a);let C=0,i=0,F=0,v=0;p>R?C++:i++,p>I?C++:F++,p>t?C++:v++,R>I?i++:F++,R>t?i++:v++,I>t?F++:v++;const Y=C>=3?1:0,k=i>=3?1:0,V=F>=3?1:0,O=v>=3?1:0,G=C>=2?1:0,S=i>=2?1:0,Z=F>=2?1:0,x=v>=2?1:0,z=C>=1?1:0,y=i>=1?1:0,M=F>=1?1:0,T=v>=1?1:0,m=p-Y+n,d=R-k+n,e=I-V+n,B=t-O+n,N=p-G+2*n,P=R-S+2*n,w=I-Z+2*n,L=t-x+2*n,l=p-z+3*n,j=R-y+3*n,f=I-M+3*n,A=t-T+3*n,E=p-1+4*n,qq=R-1+4*n,cq=I-1+4*n,Uq=t-1+4*n,Jq=255&H,Qq=255&b,sq=255&h,gq=255&o;let Xq=.6-p*p-R*R-I*I-t*t;if(Xq<0)s=0;else{const q=Q[Jq+Q[Qq+Q[sq+Q[gq]]]]%32*4;Xq*=Xq,s=Xq*Xq*(D[q]*p+D[q+1]*R+D[q+2]*I+D[q+3]*t)}let nq=.6-m*m-d*d-e*e-B*B;if(nq<0)g=0;else{const q=Q[Jq+Y+Q[Qq+k+Q[sq+V+Q[gq+O]]]]%32*4;nq*=nq,g=nq*nq*(D[q]*m+D[q+1]*d+D[q+2]*e+D[q+3]*B)}let Wq=.6-N*N-P*P-w*w-L*L;if(Wq<0)W=0;else{const q=Q[Jq+G+Q[Qq+S+Q[sq+Z+Q[gq+x]]]]%32*4;Wq*=Wq,W=Wq*Wq*(D[q]*N+D[q+1]*P+D[q+2]*w+D[q+3]*L)}let Dq=.6-l*l-j*j-f*f-A*A;if(Dq<0)u=0;else{const q=Q[Jq+z+Q[Qq+y+Q[sq+M+Q[gq+T]]]]%32*4;Dq*=Dq,u=Dq*Dq*(D[q]*l+D[q+1]*j+D[q+2]*f+D[q+3]*A)}let uq=.6-E*E-qq*qq-cq*cq-Uq*Uq;if(uq<0)K=0;else{const q=Q[Jq+1+Q[Qq+1+Q[sq+1+Q[gq+1]]]]%32*4;uq*=uq,K=uq*uq*(D[q]*E+D[q+1]*qq+D[q+2]*cq+D[q+3]*Uq)}return 27*(s+g+W+u+K)}}}}]);