/*! For license information please see xkeybl.11.07746790.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[11],{11801:function(z,u){!function(z){"use strict";var u=function(z,Y){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,u){z.__proto__=u}||function(z,u){for(var Y in u)Object.prototype.hasOwnProperty.call(u,Y)&&(z[Y]=u[Y])},u(z,Y)};function Y(z,Y){if("function"!==typeof Y&&null!==Y)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function H(){this.constructor=z}u(z,Y),z.prototype=null===Y?Object.create(Y):(H.prototype=Y.prototype,new H)}function H(z,u,Y,H){var E,J=arguments.length,l=J<3?u:null===H?H=Object.getOwnPropertyDescriptor(u,Y):H;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)l=Reflect.decorate(z,u,Y,H);else for(var T=z.length-1;T>=0;T--)(E=z[T])&&(l=(J<3?E(l):J>3?E(u,Y,l):E(u,Y))||l);return J>3&&l&&Object.defineProperty(u,Y,l),l}function E(z,u,Y){if(Y||2===arguments.length)for(var H,E=0,J=u.length;E<J;E++)!H&&E in u||(H||(H=Array.prototype.slice.call(u,0,E)),H[E]=u[E]);return z.concat(H||Array.prototype.slice.call(u))}var J,l=255,T=213;z.OPERATION=void 0,(J=z.OPERATION||(z.OPERATION={}))[J.ADD=128]="ADD",J[J.REPLACE=0]="REPLACE",J[J.DELETE=64]="DELETE",J[J.DELETE_AND_ADD=192]="DELETE_AND_ADD",J[J.TOUCH=1]="TOUCH",J[J.CLEAR=10]="CLEAR";var b=function(){function u(z,u,Y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=z,this.setParent(u,Y)}return u.prototype.setParent=function(z,u,Y){var H=this;if(this.indexes||(this.indexes=this.ref instanceof Fz?this.ref._definition.indexes:{}),this.parent=z,this.parentIndex=Y,u)if(this.root=u,this.ref instanceof Fz){var E=this.ref._definition;for(var J in E.schema){var l=this.ref[J];if(l&&l.$changes){var T=E.indexes[J];l.$changes.setParent(this.ref,u,T)}}}else"object"===typeof this.ref&&this.ref.forEach((function(z,u){if(z instanceof Fz){var Y=z.$changes,E=H.ref.$changes.indexes[u];Y.setParent(H.ref,H.root,E)}}))},u.prototype.operation=function(z){this.changes.set(--this.currentCustomOperation,z)},u.prototype.change=function(u,Y){void 0===Y&&(Y=z.OPERATION.ADD);var H="number"===typeof u?u:this.indexes[u];this.assertValidIndex(H,u);var E=this.changes.get(H);E&&E.op!==z.OPERATION.DELETE&&E.op!==z.OPERATION.TOUCH||this.changes.set(H,{op:E&&E.op===z.OPERATION.DELETE?z.OPERATION.DELETE_AND_ADD:Y,index:H}),this.allChanges.add(H),this.changed=!0,this.touchParents()},u.prototype.touch=function(u){var Y="number"===typeof u?u:this.indexes[u];this.assertValidIndex(Y,u),this.changes.has(Y)||this.changes.set(Y,{op:z.OPERATION.TOUCH,index:Y}),this.allChanges.add(Y),this.touchParents()},u.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},u.prototype.getType=function(z){if(this.ref._definition)return(u=this.ref._definition).schema[u.fieldsByIndex[z]];var u,Y=(u=this.parent._definition).schema[u.fieldsByIndex[this.parentIndex]];return Object.values(Y)[0]},u.prototype.getChildrenFilter=function(){var z=this.parent._definition.childFilters;return z&&z[this.parentIndex]},u.prototype.getValue=function(z){return this.ref.getByIndex(z)},u.prototype.delete=function(u){var Y="number"===typeof u?u:this.indexes[u];if(void 0!==Y){var H=this.getValue(Y);this.changes.set(Y,{op:z.OPERATION.DELETE,index:Y}),this.allChanges.delete(Y),delete this.caches[Y],H&&H.$changes&&(H.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(u," (").concat(Y,")"))},u.prototype.discard=function(u,Y){var H=this;void 0===u&&(u=!1),void 0===Y&&(Y=!1),this.ref instanceof Fz||this.changes.forEach((function(u){if(u.op===z.OPERATION.DELETE){var Y=H.ref.getIndex(u.index);delete H.indexes[Y]}})),this.changes.clear(),this.changed=u,Y&&this.allChanges.clear(),this.currentCustomOperation=0},u.prototype.discardAll=function(){var z=this;this.changes.forEach((function(u){var Y=z.getValue(u.index);Y&&Y.$changes&&Y.$changes.discardAll()})),this.discard()},u.prototype.cache=function(z,u){this.caches[z]=u},u.prototype.clone=function(){return new u(this.ref,this.parent,this.root)},u.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},u.prototype.assertValidIndex=function(z,u){if(void 0===z)throw new Error('ChangeTree: missing index for field "'.concat(u,'"'))},u}();function L(z,u,Y,H){return z[u]||(z[u]=[]),z[u].push(Y),null===H||void 0===H||H.forEach((function(z,u){return Y(z,u)})),function(){return g(z[u],z[u].indexOf(Y))}}function D(u){var Y=this,H="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,J){u.push({refId:Y.$changes.refId,op:z.OPERATION.DELETE,field:J,value:void 0,previousValue:E}),H&&Y.$changes.root.removeRef(E.$changes.refId)}))}function g(z,u){if(-1===u||u>=z.length)return!1;for(var Y=z.length-1,H=u;H<Y;H++)z[H]=z[H+1];return z.length=Y,!0}var M=function(z,u){var Y=z.toString(),H=u.toString();return Y<H?-1:Y>H?1:0};function q(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,u){return"symbol"===typeof u||isNaN(u)?z[u]:z.at(u)},set:function(z,u,Y){if("symbol"===typeof u||isNaN(u))z[u]=Y;else{var H=Array.from(z.$items.keys()),E=parseInt(H[u]||u);void 0===Y||null===Y?z.deleteAt(E):z.setAt(E,Y)}return!0},deleteProperty:function(z,u){return"number"===typeof u?z.deleteAt(u):delete z[u],!0}})}var C=function(){function u(){for(var z=[],u=0;u<arguments.length;u++)z[u]=arguments[u];this.$changes=new b(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,z)}return u.prototype.KT=function(u,Y){return void 0===Y&&(Y=!0),L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,Y?this.$items:void 0)},u.prototype.cl=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return Array.isArray(z)||void 0!==z.array},Object.defineProperty(u.prototype,"length",{get:function(){return this.$items.size},set:function(z){0===z?this.clear():this.splice(z,this.length-z)},enumerable:!1,configurable:!0}),u.prototype.push=function(){for(var z,u=this,Y=[],H=0;H<arguments.length;H++)Y[H]=arguments[H];return Y.forEach((function(Y){z=u.$refId++,u.setAt(z,Y)})),z},u.prototype.pop=function(){var z=Array.from(this.$indexes.values()).pop();if(void 0!==z){this.$changes.delete(z),this.$indexes.delete(z);var u=this.$items.get(z);return this.$items.delete(z),u}},u.prototype.at=function(z){var u=Array.from(this.$items.keys())[z];return this.$items.get(u)},u.prototype.setAt=function(u,Y){var H,E;if(void 0!==Y&&null!==Y){if(this.$items.get(u)!==Y){void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,u);var J=null!==(E=null===(H=this.$changes.indexes[u])||void 0===H?void 0:H.op)&&void 0!==E?E:z.OPERATION.ADD;this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,Y),this.$changes.change(u,J)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},u.prototype.deleteAt=function(z){var u=Array.from(this.$items.keys())[z];return void 0!==u&&this.$deleteAt(u)},u.prototype.$deleteAt=function(z){return this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&D.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.concat=function(){for(var z,Y=[],H=0;H<arguments.length;H++)Y[H]=arguments[H];return new(u.bind.apply(u,E([void 0],(z=Array.from(this.$items.values())).concat.apply(z,Y),!1)))},u.prototype.join=function(z){return Array.from(this.$items.values()).join(z)},u.prototype.reverse=function(){var z=this,u=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Y,H){z.setAt(u[H],Y)})),this},u.prototype.shift=function(){var z=Array.from(this.$items.keys()).shift();if(void 0!==z){var u=this.$items.get(z);return this.$deleteAt(z),u}},u.prototype.slice=function(z,Y){var H=new u;return H.push.apply(H,Array.from(this.$items.values()).slice(z,Y)),H},u.prototype.sort=function(z){var u=this;void 0===z&&(z=M);var Y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(z).forEach((function(z,H){u.setAt(Y[H],z)})),this},u.prototype.splice=function(z,u){void 0===u&&(u=this.length-z);for(var Y=Array.from(this.$items.keys()),H=[],E=z;E<z+u;E++)H.push(this.$items.get(Y[E])),this.$deleteAt(Y[E]);return H},u.prototype.unshift=function(){for(var z=this,u=[],Y=0;Y<arguments.length;Y++)u[Y]=arguments[Y];var H=this.length,E=u.length,J=Array.from(this.$items.values());return u.forEach((function(u,Y){z.setAt(Y,u)})),J.forEach((function(u,Y){z.setAt(E+Y,u)})),H+E},u.prototype.indexOf=function(z,u){return Array.from(this.$items.values()).indexOf(z,u)},u.prototype.lastIndexOf=function(z,u){return void 0===u&&(u=this.length-1),Array.from(this.$items.values()).lastIndexOf(z,u)},u.prototype.every=function(z,u){return Array.from(this.$items.values()).every(z,u)},u.prototype.some=function(z,u){return Array.from(this.$items.values()).some(z,u)},u.prototype.forEach=function(z,u){Array.from(this.$items.values()).forEach(z,u)},u.prototype.map=function(z,u){return Array.from(this.$items.values()).map(z,u)},u.prototype.filter=function(z,u){return Array.from(this.$items.values()).filter(z,u)},u.prototype.reduce=function(z,u){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},u.prototype.reduceRight=function(z,u){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},u.prototype.find=function(z,u){return Array.from(this.$items.values()).find(z,u)},u.prototype.findIndex=function(z,u){return Array.from(this.$items.values()).findIndex(z,u)},u.prototype.fill=function(z,u,Y){throw new Error("ArraySchema#fill() not implemented")},u.prototype.copyWithin=function(z,u,Y){throw new Error("ArraySchema#copyWithin() not implemented")},u.prototype.toString=function(){return this.$items.toString()},u.prototype.toLocaleString=function(){return this.$items.toLocaleString()},u.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},u.prototype.includes=function(z,u){return Array.from(this.$items.values()).includes(z,u)},u.prototype.flatMap=function(z,u){throw new Error("ArraySchema#flatMap() is not supported.")},u.prototype.flat=function(z){throw new Error("ArraySchema#flat() is not supported.")},u.prototype.findLast=function(){var z=Array.from(this.$items.values());return z.findLast.apply(z,arguments)},u.prototype.findLastIndex=function(){var z=Array.from(this.$items.values());return z.findLastIndex.apply(z,arguments)},u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){return this.toArray().map((function(z){return"function"===typeof z.toJSON?z.toJSON():z}))},u.prototype.clone=function(z){return z?new(u.bind.apply(u,E([void 0],Array.from(this.$items.values()),!1))):new(u.bind.apply(u,E([void 0],this.map((function(z){return z.$changes?z.clone():z})),!1)))},u}();function K(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,u){return"symbol"!==typeof u&&"undefined"===typeof z[u]?z.get(u):z[u]},set:function(z,u,Y){return"symbol"!==typeof u&&-1===u.indexOf("$")&&"KT"!==u&&"cl"!==u&&"onChange"!==u?z.set(u,Y):z[u]=Y,!0},deleteProperty:function(z,u){return z.delete(u),!0}})}var h=function(){function u(z){var Y=this;if(this.$changes=new b(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z)if(z instanceof Map||z instanceof u)z.forEach((function(z,u){return Y.set(u,z)}));else for(var H in z)this.set(H,z[H])}return u.prototype.KT=function(u,Y){return void 0===Y&&(Y=!0),L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,Y?this.$items:void 0)},u.prototype.cl=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.map},u.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(u.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.set=function(u,Y){if(void 0===Y||null===Y)throw new Error("MapSchema#set('".concat(u,"', ").concat(Y,"): trying to set ").concat(Y," value on '").concat(u,"'."));u=u.toString();var H="undefined"!==typeof this.$changes.indexes[u],E=H?this.$changes.indexes[u]:this.$refId++,J=H?z.OPERATION.REPLACE:z.OPERATION.ADD,l=void 0!==Y.$changes;if(l&&Y.$changes.setParent(this,this.$changes.root,E),H){if(!l&&this.$items.get(u)===Y)return;l&&this.$items.get(u)!==Y&&(J=z.OPERATION.ADD)}else this.$changes.indexes[u]=E,this.$indexes.set(E,u);return this.$items.set(u,Y),this.$changes.change(u,J),this},u.prototype.get=function(z){return this.$items.get(z)},u.prototype.delete=function(z){return this.$changes.delete(z),this.$items.delete(z)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&D.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){return this.$items.has(z)},u.prototype.forEach=function(z){this.$items.forEach(z)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toJSON=function(){var z={};return this.forEach((function(u,Y){z[Y]="function"===typeof u.toJSON?u.toJSON():u})),z},u.prototype.clone=function(z){var Y;return z?Y=Object.assign(new u,this):(Y=new u,this.forEach((function(z,u){z.$changes?Y.set(u,z.clone()):Y.set(u,z)}))),Y},u}(),o={};function d(z,u){o[z]=u}function t(z){return o[z]}var W=function(){function z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return z.create=function(u){var Y=new z;return Y.schema=Object.assign({},u&&u.schema||{}),Y.indexes=Object.assign({},u&&u.indexes||{}),Y.fieldsByIndex=Object.assign({},u&&u.fieldsByIndex||{}),Y.descriptors=Object.assign({},u&&u.descriptors||{}),Y.deprecated=Object.assign({},u&&u.deprecated||{}),Y},z.prototype.addField=function(z,u){var Y=this.getNextFieldIndex();this.fieldsByIndex[Y]=z,this.indexes[z]=Y,this.schema[z]=Array.isArray(u)?{array:u[0]}:u},z.prototype.hasField=function(z){return void 0!==this.indexes[z]},z.prototype.addFilter=function(z,u){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[z]]=u,this.indexesWithFilters.push(this.indexes[z]),!0},z.prototype.addChildrenFilter=function(z,u){var Y=this.indexes[z],H=this.schema[z];if(t(Object.keys(H)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Y]=u,!0;console.warn("@filterChildren: field '".concat(z,"' can't have children. Ignoring filter."))},z.prototype.getChildrenFilter=function(z){return this.childFilters&&this.childFilters[this.indexes[z]]},z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},z}();function Z(z){return z._context&&z._context.useFilters}var s=function(){function z(){this.types={},this.schemas=new Map,this.useFilters=!1}return z.prototype.has=function(z){return this.schemas.has(z)},z.prototype.get=function(z){return this.types[z]},z.prototype.add=function(z,u){void 0===u&&(u=this.schemas.size),z._definition=W.create(z._definition),z._typeid=u,this.types[u]=z,this.schemas.set(z,u)},z.create=function(u){return void 0===u&&(u={}),function(Y){return u.context||(u.context=new z),i(Y,u)}},z}(),v=new s;function i(z,u){return void 0===u&&(u={}),function(Y,H){var J=u.context||v,l=Y.constructor;if(l._context=J,!z)throw new Error("".concat(l.name,': @type() reference provided for "').concat(H,"\" is undefined. Make sure you don't have any circular dependencies."));J.has(l)||J.add(l);var T=l._definition;if(T.addField(H,z),T.descriptors[H]){if(T.deprecated[H])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(H,"' definition on '").concat(l.name,"'.\nCheck @type() annotation"))}catch(o){var b=o.stack.split("\n")[4].trim();throw new Error("".concat(o.message," ").concat(b))}}var L=C.is(z),D=!L&&h.is(z);if("string"!==typeof z&&!Fz.is(z)){var g=Object.values(z)[0];"string"===typeof g||J.has(g)||J.add(g)}if(u.manual)T.descriptors[H]={enumerable:!0,configurable:!0,writable:!0};else{var M="_".concat(H);T.descriptors[M]={enumerable:!1,configurable:!1,writable:!0},T.descriptors[H]={get:function(){return this[M]},set:function(z){z!==this[M]&&(void 0!==z&&null!==z?(!L||z instanceof C||(z=new(C.bind.apply(C,E([void 0],z,!1)))),!D||z instanceof h||(z=new h(z)),void 0===z.$proxy&&(D?z=K(z):L&&(z=q(z))),this.$changes.change(H),z.$changes&&z.$changes.setParent(this,this.$changes.root,this._definition.indexes[H])):this[M]&&this.$changes.delete(H),this[M]=z)},enumerable:!0,configurable:!0}}}}function X(z){return function(u,Y){var H=u.constructor;H._definition.addFilter(Y,z)&&(H._context.useFilters=!0)}}function Q(z){return function(u,Y){var H=u.constructor;H._definition.addChildrenFilter(Y,z)&&(H._context.useFilters=!0)}}function V(z){return void 0===z&&(z=!0),function(u,Y){var H=u.constructor._definition;H.deprecated[Y]=!0,z&&(H.descriptors[Y]={get:function(){throw new Error("".concat(Y," is deprecated."))},set:function(z){},enumerable:!1,configurable:!0})}}function A(z,u,Y){for(var H in void 0===Y&&(Y={}),Y.context||(Y.context=z._context||Y.context||v),u)i(u[H],Y)(z.prototype,H);return z}function x(z){for(var u=0,Y=0,H=0,E=z.length;H<E;H++)(u=z.charCodeAt(H))<128?Y+=1:u<2048?Y+=2:u<55296||u>=57344?Y+=3:(H++,Y+=4);return Y}function G(z,u,Y){for(var H=0,E=0,J=Y.length;E<J;E++)(H=Y.charCodeAt(E))<128?z[u++]=H:H<2048?(z[u++]=192|H>>6,z[u++]=128|63&H):H<55296||H>=57344?(z[u++]=224|H>>12,z[u++]=128|H>>6&63,z[u++]=128|63&H):(E++,H=65536+((1023&H)<<10|1023&Y.charCodeAt(E)),z[u++]=240|H>>18,z[u++]=128|H>>12&63,z[u++]=128|H>>6&63,z[u++]=128|63&H)}function F(z,u){z.push(255&u)}function R(z,u){z.push(255&u)}function w(z,u){z.push(255&u),z.push(u>>8&255)}function c(z,u){z.push(255&u),z.push(u>>8&255)}function U(z,u){z.push(255&u),z.push(u>>8&255),z.push(u>>16&255),z.push(u>>24&255)}function O(z,u){var Y=u>>24,H=u>>16,E=u>>8,J=u;z.push(255&J),z.push(255&E),z.push(255&H),z.push(255&Y)}function n(z,u){var Y=Math.floor(u/Math.pow(2,32));O(z,u>>>0),O(z,Y)}function m(z,u){var Y=u/Math.pow(2,32)|0;O(z,u>>>0),O(z,Y)}function p(z,u){j(z,u)}function S(z,u){k(z,u)}var I=new Int32Array(2),y=new Float32Array(I.buffer),a=new Float64Array(I.buffer);function j(z,u){y[0]=u,U(z,I[0])}function k(z,u){a[0]=u,U(z,I[0]),U(z,I[1])}function P(z,u){return R(z,u?1:0)}function e(z,u){u||(u="");var Y=x(u),H=0;if(Y<32)z.push(160|Y),H=1;else if(Y<256)z.push(217),R(z,Y),H=2;else if(Y<65536)z.push(218),c(z,Y),H=3;else{if(!(Y<4294967296))throw new Error("String too long");z.push(219),O(z,Y),H=5}return G(z,z.length,u),H+Y}function N(z,u){return isNaN(u)?N(z,0):isFinite(u)?u!==(0|u)?(z.push(203),k(z,u),9):u>=0?u<128?(R(z,u),1):u<256?(z.push(204),R(z,u),2):u<65536?(z.push(205),c(z,u),3):u<4294967296?(z.push(206),O(z,u),5):(z.push(207),m(z,u),9):u>=-32?(z.push(224|u+32),1):u>=-128?(z.push(208),F(z,u),2):u>=-32768?(z.push(209),w(z,u),3):u>=-2147483648?(z.push(210),U(z,u),5):(z.push(211),n(z,u),9):N(z,u>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var B=Object.freeze({__proto__:null,utf8Write:G,int8:F,uint8:R,int16:w,uint16:c,int32:U,uint32:O,int64:n,uint64:m,float32:p,float64:S,writeFloat32:j,writeFloat64:k,boolean:P,string:e,number:N});function f(z,u,Y){for(var H="",E=0,J=u,l=u+Y;J<l;J++){var T=z[J];0!==(128&T)?192!==(224&T)?224!==(240&T)?240!==(248&T)?console.error("Invalid byte "+T.toString(16)):(E=(7&T)<<18|(63&z[++J])<<12|(63&z[++J])<<6|63&z[++J])>=65536?(E-=65536,H+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):H+=String.fromCharCode(E):H+=String.fromCharCode((15&T)<<12|(63&z[++J])<<6|63&z[++J]):H+=String.fromCharCode((31&T)<<6|63&z[++J]):H+=String.fromCharCode(T)}return H}function r(z,u){return zz(z,u)<<24>>24}function zz(z,u){return z[u.offset++]}function uz(z,u){return Yz(z,u)<<16>>16}function Yz(z,u){return z[u.offset++]|z[u.offset++]<<8}function Hz(z,u){return z[u.offset++]|z[u.offset++]<<8|z[u.offset++]<<16|z[u.offset++]<<24}function Ez(z,u){return Hz(z,u)>>>0}function Jz(z,u){return Mz(z,u)}function lz(z,u){return qz(z,u)}function Tz(z,u){var Y=Ez(z,u);return Hz(z,u)*Math.pow(2,32)+Y}function bz(z,u){var Y=Ez(z,u);return Ez(z,u)*Math.pow(2,32)+Y}var Lz=new Int32Array(2),Dz=new Float32Array(Lz.buffer),gz=new Float64Array(Lz.buffer);function Mz(z,u){return Lz[0]=Hz(z,u),Dz[0]}function qz(z,u){return Lz[0]=Hz(z,u),Lz[1]=Hz(z,u),gz[0]}function Cz(z,u){return zz(z,u)>0}function Kz(z,u){var Y,H=z[u.offset++];H<192?Y=31&H:217===H?Y=zz(z,u):218===H?Y=Yz(z,u):219===H&&(Y=Ez(z,u));var E=f(z,u.offset,Y);return u.offset+=Y,E}function hz(z,u){var Y=z[u.offset];return Y<192&&Y>160||217===Y||218===Y||219===Y}function oz(z,u){var Y=z[u.offset++];return Y<128?Y:202===Y?Mz(z,u):203===Y?qz(z,u):204===Y?zz(z,u):205===Y?Yz(z,u):206===Y?Ez(z,u):207===Y?bz(z,u):208===Y?r(z,u):209===Y?uz(z,u):210===Y?Hz(z,u):211===Y?Tz(z,u):Y>223?-1*(255-Y+1):void 0}function dz(z,u){var Y=z[u.offset];return Y<128||Y>=202&&Y<=211}function tz(z,u){return z[u.offset]<160}function Wz(z,u){return z[u.offset-1]===l&&(z[u.offset]<128||z[u.offset]>=202&&z[u.offset]<=211)}var Zz=Object.freeze({__proto__:null,int8:r,uint8:zz,int16:uz,uint16:Yz,int32:Hz,uint32:Ez,float32:Jz,float64:lz,int64:Tz,uint64:bz,readFloat32:Mz,readFloat64:qz,boolean:Cz,string:Kz,stringCheck:hz,number:oz,numberCheck:dz,arrayCheck:tz,switchStructureCheck:Wz}),sz=function(){function u(z){var u=this;this.$changes=new b(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return u.add(z)}))}return u.prototype.KT=function(u,Y){return void 0===Y&&(Y=!0),L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,Y?this.$items:void 0)},u.prototype.cl=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.collection},u.prototype.add=function(z){var u=this.$refId++;return void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,u),this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,z),this.$changes.change(u),u},u.prototype.at=function(z){var u=Array.from(this.$items.keys())[z];return this.$items.get(u)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(z){for(var u,Y,H=this.$items.entries();(Y=H.next())&&!Y.done;)if(z===Y.value[1]){u=Y.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&D.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){return Array.from(this.$items.values()).some((function(u){return u===z}))},u.prototype.forEach=function(z){var u=this;this.$items.forEach((function(Y,H,E){return z(Y,H,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var z=[];return this.forEach((function(u,Y){z.push("function"===typeof u.toJSON?u.toJSON():u)})),z},u.prototype.clone=function(z){var Y;return z?Y=Object.assign(new u,this):(Y=new u,this.forEach((function(z){z.$changes?Y.add(z.clone()):Y.add(z)}))),Y},u}(),vz=function(){function u(z){var u=this;this.$changes=new b(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return u.add(z)}))}return u.prototype.KT=function(u,Y){return void 0===Y&&(Y=!0),L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,u,Y?this.$items:void 0)},u.prototype.cl=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.is=function(z){return void 0!==z.set},u.prototype.add=function(u){var Y,H;if(this.has(u))return!1;var E=this.$refId++;void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,E);var J=null!==(H=null===(Y=this.$changes.indexes[E])||void 0===Y?void 0:Y.op)&&void 0!==H?H:z.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,u),this.$changes.change(E,J),E},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(z){for(var u,Y,H=this.$items.entries();(Y=H.next())&&!Y.done;)if(z===Y.value[1]){u=Y.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&D.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(z){for(var u,Y=this.$items.values(),H=!1;(u=Y.next())&&!u.done;)if(z===u.value){H=!0;break}return H},u.prototype.forEach=function(z){var u=this;this.$items.forEach((function(Y,H,E){return z(Y,H,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(z,u){this.$indexes.set(z,u)},u.prototype.getIndex=function(z){return this.$indexes.get(z)},u.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},u.prototype.deleteByIndex=function(z){var u=this.$indexes.get(z);this.$items.delete(u),this.$indexes.delete(z)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var z=[];return this.forEach((function(u,Y){z.push("function"===typeof u.toJSON?u.toJSON():u)})),z},u.prototype.clone=function(z){var Y;return z?Y=Object.assign(new u,this):(Y=new u,this.forEach((function(z){z.$changes?Y.add(z.clone()):Y.add(z)}))),Y},u}(),iz=function(){function z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return z.prototype.addRefId=function(z){this.refIds.has(z)||(this.refIds.add(z),this.containerIndexes.set(z,new Set))},z.get=function(u){return void 0===u.$filterState&&(u.$filterState=new z),u.$filterState},z}(),Xz=function(){function z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},z.prototype.addRef=function(z,u,Y){void 0===Y&&(Y=!0),this.refs.set(z,u),Y&&(this.refCounts[z]=(this.refCounts[z]||0)+1)},z.prototype.removeRef=function(z){this.refCounts[z]=this.refCounts[z]-1,this.deletedRefs.add(z)},z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},z.prototype.garbageCollectDeletedRefs=function(){var z=this;this.deletedRefs.forEach((function(u){if(!(z.refCounts[u]>0)){var Y=z.refs.get(u);if(Y instanceof Fz)for(var H in Y._definition.schema)"string"!==typeof Y._definition.schema[H]&&Y[H]&&Y[H].$changes&&z.removeRef(Y[H].$changes.refId);else{var E=Y.$changes.parent._definition,J=E.schema[E.fieldsByIndex[Y.$changes.parentIndex]];"function"===typeof Object.values(J)[0]&&Array.from(Y.values()).forEach((function(u){return z.removeRef(u.$changes.refId)}))}z.refs.delete(u),delete z.refCounts[u]}})),this.deletedRefs.clear()},z}(),Qz=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return Y(u,z),u}(Error);function Vz(z,u,Y,H){var E,J=!1;switch(u){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(z)&&console.log('trying to encode "NaN" in '.concat(Y.constructor.name,"#").concat(H));break;case"string":E="string",J=!0;break;case"boolean":return}if(typeof z!==E&&(!J||J&&null!==z)){var l="'".concat(JSON.stringify(z),"'").concat(z&&z.constructor&&" (".concat(z.constructor.name,")")||"");throw new Qz("a '".concat(E,"' was expected, but ").concat(l," was provided in ").concat(Y.constructor.name,"#").concat(H))}}function Az(z,u,Y,H){if(!(z instanceof u))throw new Qz("a '".concat(u.name,"' was expected, but '").concat(z.constructor.name,"' was provided in ").concat(Y.constructor.name,"#").concat(H))}function xz(z,u,Y,H,E){Vz(Y,z,H,E);var J=B[z];if(!J)throw new Qz("a '".concat(z,"' was expected, but ").concat(Y," was provided in ").concat(H.constructor.name,"#").concat(E));J(u,Y)}function Gz(z,u,Y){return Zz[z](u,Y)}var Fz=function(){function u(){for(var z=[],u=0;u<arguments.length;u++)z[u]=arguments[u];Object.defineProperties(this,{$changes:{value:new b(this,void 0,new Xz),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Y=this._definition.descriptors;Y&&Object.defineProperties(this,Y),z[0]&&this.assign(z[0])}return u.onError=function(z){console.error(z)},u.is=function(z){return z._definition&&void 0!==z._definition.schema},u.prototype.onChange=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,u)},u.prototype.cl=function(u){return L(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,u)},u.prototype.assign=function(z){return Object.assign(this,z),this},Object.defineProperty(u.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),u.prototype.setDirty=function(z,u){this.$changes.change(z,u)},u.prototype.listen=function(z,u,Y){var H=this;return void 0===Y&&(Y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[z]||(this.$callbacks[z]=[]),this.$callbacks[z].push(u),Y&&void 0!==this[z]&&u(this[z],void 0),function(){return g(H.$callbacks[z],H.$callbacks[z].indexOf(u))}},u.prototype.decode=function(Y,H,E){var J;void 0===H&&(H={offset:0}),void 0===E&&(E=this);var T=[],b=this.$changes.root,L=Y.length,D=0;for(b.refs.set(D,this);H.offset<L;){var g=Y[H.offset++];if(g!=l){var M=E.$changes,q=void 0!==E._definition,K=q?g>>6<<6:g;if(K!==z.OPERATION.CLEAR){var o=q?g%(K||255):oz(Y,H),d=q?E._definition.fieldsByIndex[o]:"",W=M.getType(o),Z=void 0,s=void 0,v=void 0;if(q?s=E["_".concat(d)]:(s=E.getByIndex(o),(K&z.OPERATION.ADD)===z.OPERATION.ADD?(v=E instanceof h?Kz(Y,H):o,E.setIndex(o,v)):v=E.getIndex(o)),(K&z.OPERATION.DELETE)===z.OPERATION.DELETE&&(K!==z.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(o),s&&s.$changes&&b.removeRef(s.$changes.refId),Z=null),void 0!==d){if(K===z.OPERATION.DELETE);else if(u.is(W)){var i=oz(Y,H);if(Z=b.refs.get(i),K!==z.OPERATION.REPLACE){var X=this.getSchemaType(Y,H,W);Z||((Z=this.createTypeInstance(X)).$changes.refId=i,s&&(Z.$callbacks=s.$callbacks,s.$changes.refId&&i!==s.$changes.refId&&b.removeRef(s.$changes.refId))),b.addRef(i,Z,Z!==s)}}else if("string"===typeof W)Z=Gz(W,Y,H);else{var Q=t(Object.keys(W)[0]),V=oz(Y,H),A=b.refs.has(V)?s||b.refs.get(V):new Q.constructor;if((Z=A.clone(!0)).$changes.refId=V,s&&(Z.$callbacks=s.$callbacks,s.$changes.refId&&V!==s.$changes.refId)){b.removeRef(s.$changes.refId);for(var x=s.entries(),G=void 0;(G=x.next())&&!G.done;){var F=(J=G.value)[0],R=J[1];T.push({refId:V,op:z.OPERATION.DELETE,field:F,value:void 0,previousValue:R})}}b.addRef(V,Z,A!==s)}if(null!==Z&&void 0!==Z)if(Z.$changes&&Z.$changes.setParent(M.ref,M.root,o),E instanceof u)E[d]=Z;else if(E instanceof h)F=v,E.$items.set(F,Z),E.$changes.allChanges.add(o);else if(E instanceof C)E.setAt(o,Z);else if(E instanceof sz){var w=E.add(Z);E.setIndex(o,w)}else E instanceof vz&&!1!==(w=E.add(Z))&&E.setIndex(o,w);s!==Z&&T.push({refId:D,op:K,field:d,dynamicIndex:v,value:Z,previousValue:s})}else{console.warn("@colyseus/schema: definition mismatch");for(var c={offset:H.offset};H.offset<L&&(!Wz(Y,H)||(c.offset=H.offset+1,!b.refs.has(oz(Y,c))));)H.offset++}}else E.clear(T)}else{D=oz(Y,H);var U=b.refs.get(D);if(!U)throw new Error('"refId" not found: '.concat(D));E=U}}return this._triggerChanges(T),b.garbageCollectDeletedRefs(),T},u.prototype.encode=function(Y,H,E){void 0===Y&&(Y=!1),void 0===H&&(H=[]),void 0===E&&(E=!1);for(var J=this.$changes,T=new WeakSet,b=[J],L=1,D=0;D<L;D++){var g=b[D],M=g.ref,q=M instanceof u;g.ensureRefId(),T.add(g),g!==J&&(g.changed||Y)&&(R(H,l),N(H,g.refId));for(var C=Y?Array.from(g.allChanges):Array.from(g.changes.values()),K=0,o=C.length;K<o;K++){var d=Y?{op:z.OPERATION.ADD,index:C[K]}:C[K],W=d.index,Z=q?M._definition.fieldsByIndex&&M._definition.fieldsByIndex[W]:W,s=H.length;if(d.op!==z.OPERATION.TOUCH)if(q)R(H,W|d.op);else{if(R(H,d.op),d.op===z.OPERATION.CLEAR)continue;N(H,W)}if(q||(d.op&z.OPERATION.ADD)!=z.OPERATION.ADD||M instanceof h&&e(H,g.ref.$indexes.get(W)),d.op!==z.OPERATION.DELETE){var v=g.getType(W),i=g.getValue(W);if(i&&i.$changes&&!T.has(i.$changes)&&(b.push(i.$changes),i.$changes.ensureRefId(),L++),d.op!==z.OPERATION.TOUCH){if(u.is(v))Az(i,v,M,Z),N(H,i.$changes.refId),(d.op&z.OPERATION.ADD)===z.OPERATION.ADD&&this.tryEncodeTypeId(H,v,i.constructor);else if("string"===typeof v)xz(v,H,i,M,Z);else{var X=t(Object.keys(v)[0]);Az(M["_".concat(Z)],X.constructor,M,Z),N(H,i.$changes.refId)}E&&g.cache(W,H.slice(s))}}}Y||E||g.discard()}return H},u.prototype.encodeAll=function(z){return this.encode(!0,[],z)},u.prototype.applyFilters=function(Y,H){var E,J;void 0===H&&(H=!1);for(var T=this,b=new Set,L=iz.get(Y),D=[this.$changes],g=1,M=[],q=function(q){var C=D[q];if(b.has(C.refId))return"continue";var K=C.ref,o=K instanceof u;R(M,l),N(M,C.refId);var d=L.refIds.has(C),t=H||!d;L.addRefId(C);var W=L.containerIndexes.get(C),Z=t?Array.from(C.allChanges):Array.from(C.changes.values());!H&&o&&K._definition.indexesWithFilters&&K._definition.indexesWithFilters.forEach((function(u){!W.has(u)&&C.allChanges.has(u)&&(t?Z.push(u):Z.push({op:z.OPERATION.ADD,index:u}))}));for(var s=0,v=Z.length;s<v;s++){var i=t?{op:z.OPERATION.ADD,index:Z[s]}:Z[s];if(i.op!==z.OPERATION.CLEAR){var X=i.index;if(i.op!==z.OPERATION.DELETE){var Q=C.getValue(X),V=C.getType(X);if(o){if((A=K._definition.filters&&K._definition.filters[X])&&!A.call(K,Y,Q,T)){Q&&Q.$changes&&b.add(Q.$changes.refId);continue}}else{var A,x=C.parent;if((A=C.getChildrenFilter())&&!A.call(x,Y,K.$indexes.get(X),Q,T)){Q&&Q.$changes&&b.add(Q.$changes.refId);continue}}if(Q.$changes&&(D.push(Q.$changes),g++),i.op!==z.OPERATION.TOUCH)if(i.op===z.OPERATION.ADD||o)M.push.apply(M,null!==(E=C.caches[X])&&void 0!==E?E:[]),W.add(X);else if(W.has(X))M.push.apply(M,null!==(J=C.caches[X])&&void 0!==J?J:[]);else{if(W.add(X),R(M,z.OPERATION.ADD),N(M,X),K instanceof h){var G=C.ref.$indexes.get(X);e(M,G)}Q.$changes?N(M,Q.$changes.refId):B[V](M,Q)}else Q.$changes&&!o&&(R(M,z.OPERATION.ADD),N(M,X),K instanceof h&&(G=C.ref.$indexes.get(X),e(M,G)),N(M,Q.$changes.refId))}else o?R(M,i.op|X):(R(M,i.op),N(M,X))}else R(M,i.op)}},C=0;C<g;C++)q(C);return M},u.prototype.clone=function(){var z,u=new this.constructor,Y=this._definition.schema;for(var H in Y)"object"===typeof this[H]&&"function"===typeof(null===(z=this[H])||void 0===z?void 0:z.clone)?u[H]=this[H].clone():u[H]=this[H];return u},u.prototype.toJSON=function(){var z=this._definition.schema,u=this._definition.deprecated,Y={};for(var H in z)u[H]||null===this[H]||"undefined"===typeof this[H]||(Y[H]="function"===typeof this[H].toJSON?this[H].toJSON():this["_".concat(H)]);return Y},u.prototype.discardAllChanges=function(){this.$changes.discardAll()},u.prototype.getByIndex=function(z){return this[this._definition.fieldsByIndex[z]]},u.prototype.deleteByIndex=function(z){this[this._definition.fieldsByIndex[z]]=void 0},u.prototype.tryEncodeTypeId=function(z,u,Y){u._typeid!==Y._typeid&&(R(z,T),N(z,Y._typeid))},u.prototype.getSchemaType=function(z,u,Y){var H;return z[u.offset]===T&&(u.offset++,H=this.constructor._context.get(oz(z,u))),H||Y},u.prototype.createTypeInstance=function(z){var u=new z;return u.$changes.root=this.$changes.root,u},u.prototype._triggerChanges=function(Y){for(var H,E,J,l,T,b,L,D,g,M=new Set,q=this.$changes.root.refs,C=function(C){var K=Y[C],h=K.refId,o=q.get(h),d=o.$callbacks;if((K.op&z.OPERATION.DELETE)===z.OPERATION.DELETE&&K.previousValue instanceof u&&(null===(E=null===(H=K.previousValue.$callbacks)||void 0===H?void 0:H[z.OPERATION.DELETE])||void 0===E||E.forEach((function(z){return z()}))),!d)return"continue";if(o instanceof u){if(!M.has(h))try{null===(J=null===d||void 0===d?void 0:d[z.OPERATION.REPLACE])||void 0===J||J.forEach((function(z){return z()}))}catch(t){u.onError(t)}try{d.hasOwnProperty(K.field)&&(null===(l=d[K.field])||void 0===l||l.forEach((function(z){return z(K.value,K.previousValue)})))}catch(t){u.onError(t)}}else K.op===z.OPERATION.ADD&&void 0===K.previousValue?null===(T=d[z.OPERATION.ADD])||void 0===T||T.forEach((function(z){var u;return z(K.value,null!==(u=K.dynamicIndex)&&void 0!==u?u:K.field)})):K.op===z.OPERATION.DELETE?void 0!==K.previousValue&&(null===(b=d[z.OPERATION.DELETE])||void 0===b||b.forEach((function(z){var u;return z(K.previousValue,null!==(u=K.dynamicIndex)&&void 0!==u?u:K.field)}))):K.op===z.OPERATION.DELETE_AND_ADD&&(void 0!==K.previousValue&&(null===(L=d[z.OPERATION.DELETE])||void 0===L||L.forEach((function(z){var u;return z(K.previousValue,null!==(u=K.dynamicIndex)&&void 0!==u?u:K.field)}))),null===(D=d[z.OPERATION.ADD])||void 0===D||D.forEach((function(z){var u;return z(K.value,null!==(u=K.dynamicIndex)&&void 0!==u?u:K.field)}))),K.value!==K.previousValue&&(null===(g=d[z.OPERATION.REPLACE])||void 0===g||g.forEach((function(z){var u;return z(K.value,null!==(u=K.dynamicIndex)&&void 0!==u?u:K.field)})));M.add(h)},K=0;K<Y.length;K++)C(K)},u._definition=W.create(),u}();function Rz(z){for(var u=[z.$changes],Y=1,H={},E=H,J=function(z){var Y=u[z];Y.changes.forEach((function(z){var u=Y.ref,H=z.index,J=u._definition?u._definition.fieldsByIndex[H]:u.$indexes.get(H);E[J]=Y.getValue(H)}))},l=0;l<Y;l++)J(l);return H}var wz={context:new s},cz=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return Y(u,z),H([i("string",wz)],u.prototype,"name",void 0),H([i("string",wz)],u.prototype,"type",void 0),H([i("number",wz)],u.prototype,"referencedType",void 0),u}(Fz),Uz=function(z){function u(){var u=null!==z&&z.apply(this,arguments)||this;return u.fields=new C,u}return Y(u,z),H([i("number",wz)],u.prototype,"id",void 0),H([i([cz],wz)],u.prototype,"fields",void 0),u}(Fz),Oz=function(z){function u(){var u=null!==z&&z.apply(this,arguments)||this;return u.types=new C,u}return Y(u,z),u.encode=function(z){var Y=z.constructor,H=new u;H.rootType=Y._typeid;var E=function(z,u){for(var Y in u){var E=new cz;E.name=Y;var J=void 0;if("string"===typeof u[Y])J=u[Y];else{var l=u[Y],T=void 0;Fz.is(l)?(J="ref",T=u[Y]):"string"===typeof l[J=Object.keys(l)[0]]?J+=":"+l[J]:T=l[J],E.referencedType=T?T._typeid:-1}E.type=J,z.fields.push(E)}H.types.push(z)},J=Y._context.types;for(var l in J){var T=new Uz;T.id=Number(l),E(T,J[l]._definition.schema)}return H.encodeAll()},u.decode=function(z,H){var E=new s,J=new u;J.decode(z,H);var l=J.types.reduce((function(z,u){var H=function(z){function u(){return null!==z&&z.apply(this,arguments)||this}return Y(u,z),u}(Fz),J=u.id;return z[J]=H,E.add(H,J),z}),{});J.types.forEach((function(z){var u=l[z.id];z.fields.forEach((function(z){var Y;if(void 0!==z.referencedType){var H=z.type,J=l[z.referencedType];if(!J){var T=z.type.split(":");H=T[0],J=T[1]}"ref"===H?i(J,{context:E})(u.prototype,z.name):i(((Y={})[H]=J,Y),{context:E})(u.prototype,z.name)}else i(z.type,{context:E})(u.prototype,z.name)}))}));var T=l[J.rootType],b=new T;for(var L in T._definition.schema){var D=T._definition.schema[L];"string"!==typeof D&&(b[L]="function"===typeof D?new D:new(t(Object.keys(D)[0]).constructor))}return b},H([i([Uz],wz)],u.prototype,"types",void 0),H([i("number",wz)],u.prototype,"rootType",void 0),u}(Fz);d("map",{constructor:h}),d("array",{constructor:C}),d("set",{constructor:vz}),d("collection",{constructor:sz}),z.ArraySchema=C,z.CollectionSchema=sz,z.Context=s,z.MapSchema=h,z.Reflection=Oz,z.ReflectionField=cz,z.ReflectionType=Uz,z.Schema=Fz,z.SchemaDefinition=W,z.SetSchema=vz,z.decode=Zz,z.defineTypes=A,z.deprecated=V,z.dumpChanges=Rz,z.encode=B,z.filter=X,z.filterChildren=Q,z.hasFilter=Z,z.registerType=d,z.type=i,Object.defineProperty(z,"__esModule",{value:!0})}(u)},12763:z=>{z.exports=function(z){return null!=z&&null!=z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}},12750:(z,u,Y)=>{"use strict";var H=Y(12754),E=Y(12761),J=Y(12763);Y.g.__TYPEDARRAY_POOL||(Y.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var l="undefined"!==typeof Uint8ClampedArray,T=Y.g.__TYPEDARRAY_POOL;T.UINT8C||(T.UINT8C=E([32,0])),T.BUFFER||(T.BUFFER=E([32,0]));var b=T.DATA,L=T.BUFFER;function D(z){if(z){var u=z.length||z.byteLength,Y=H.log2(u);b[Y].push(z)}}function g(z){z=H.nextPow2(z);var u=H.log2(z),Y=b[u];return Y.length>0?Y.pop():new ArrayBuffer(z)}function M(z){return new Uint8Array(g(z),0,z)}function q(z){return new Uint16Array(g(2*z),0,z)}function C(z){return new Uint32Array(g(4*z),0,z)}function K(z){return new Int8Array(g(z),0,z)}function h(z){return new Int16Array(g(2*z),0,z)}function o(z){return new Int32Array(g(4*z),0,z)}function d(z){return new Float32Array(g(4*z),0,z)}function t(z){return new Float64Array(g(8*z),0,z)}function W(z){return l?new Uint8ClampedArray(g(z),0,z):M(z)}function Z(z){return new DataView(g(z),0,z)}u.free=function(z){if(J(z))L[H.log2(z.length)].push(z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(z)&&(z=z.buffer),!z)return;var u=z.length||z.byteLength,Y=0|H.log2(u);b[Y].push(z)}},u.freeUint8=u.freeUint16=u.freeUint32=u.freeInt8=u.freeInt16=u.freeInt32=u.freeFloat32=u.freeFloat=u.freeFloat64=u.freeDouble=u.freeUint8Clamped=u.freeDataView=function(z){D(z.buffer)},u.freeArrayBuffer=D,u.freeBuffer=function(z){L[H.log2(z.length)].push(z)},u.malloc=function(z,u){if(void 0===u||"arraybuffer"===u)return g(z);switch(u){case"uint8":return M(z);case"uint16":return q(z);case"uint32":return C(z);case"int8":return K(z);case"int16":return h(z);case"int32":return o(z);case"float":case"float32":return d(z);case"double":case"float64":return t(z);case"uint8_clamped":return W(z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Z(z);default:return null}return null},u.mallocArrayBuffer=g,u.mallocUint8=M,u.mallocUint16=q,u.mallocUint32=C,u.mallocInt8=K,u.mallocInt16=h,u.mallocInt32=o,u.mallocFloat32=u.mallocFloat=d,u.mallocFloat64=u.mallocDouble=t,u.mallocUint8Clamped=W,u.mallocDataView=Z,u.clearCache=function(){for(var z=0;z<32;++z)T.UINT8[z].length=0,T.UINT16[z].length=0,T.UINT32[z].length=0,T.INT8[z].length=0,T.INT16[z].length=0,T.INT32[z].length=0,T.FLOAT[z].length=0,T.DOUBLE[z].length=0,T.UINT8C[z].length=0,b[z].length=0,L[z].length=0}},12834:(z,u,Y)=>{z.exports=E;var H=Y(125);function E(z,u){if(!(this instanceof E))return new E(z,u);var Y=H.create();H.add(Y,z,u),this.base=H.min(H.create(),z,Y),this.LD=H.clone(u),this.max=H.max(H.create(),z,Y),this.mag=H.length(this.LD)}var J=E.prototype;J.width=function(){return this.LD[0]},J.height=function(){return this.LD[1]},J.depth=function(){return this.LD[2]},J.x0=function(){return this.base[0]},J.y0=function(){return this.base[1]},J.z0=function(){return this.base[2]},J.x1=function(){return this.max[0]},J.y1=function(){return this.max[1]},J.z1=function(){return this.max[2]},J.translate=function(z){return H.add(this.max,this.max,z),H.add(this.base,this.base,z),this},J.setPosition=function(z){return H.add(this.max,z,this.LD),H.j(this.base,z),this},J.expand=function(z){var u=H.create(),Y=H.create();return H.max(u,z.max,this.max),H.min(Y,z.base,this.base),H.JY(u,u,Y),new E(Y,u)},J.intersects=function(z){return!(z.base[0]>this.max[0])&&(!(z.base[1]>this.max[1])&&(!(z.base[2]>this.max[2])&&(!(z.max[0]<this.base[0])&&(!(z.max[1]<this.base[1])&&!(z.max[2]<this.base[2])))))},J.touches=function(z){var u=this.union(z);return null!==u&&(0==u.width()||0==u.height()||0==u.depth())},J.union=function(z){if(!this.intersects(z))return null;var u=Math.max(z.base[0],this.base[0]),Y=Math.max(z.base[1],this.base[1]),H=Math.max(z.base[2],this.base[2]);return new E([u,Y,H],[Math.min(z.max[0],this.max[0])-u,Math.min(z.max[1],this.max[1])-Y,Math.min(z.max[2],this.max[2])-H])}},12754:(z,u)=>{"use strict";function Y(z){var u=32;return(z&=-z)&&u--,65535&z&&(u-=16),16711935&z&&(u-=8),252645135&z&&(u-=4),858993459&z&&(u-=2),1431655765&z&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(z){return(z>0)-(z<0)},u.abs=function(z){var u=z>>31;return(z^u)-u},u.min=function(z,u){return u^(z^u)&-(z<u)},u.max=function(z,u){return z^(z^u)&-(z<u)},u.isPow2=function(z){return!(z&z-1)&&!!z},u.log2=function(z){var u,Y;return u=(z>65535)<<4,u|=Y=((z>>>=u)>255)<<3,u|=Y=((z>>>=Y)>15)<<2,(u|=Y=((z>>>=Y)>3)<<1)|(z>>>=Y)>>1},u.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},u.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},u.countTrailingZeros=Y,u.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},u.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},u.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var H=new Array(256);!function(z){for(var u=0;u<256;++u){var Y=u,H=u,E=7;for(Y>>>=1;Y;Y>>>=1)H<<=1,H|=1&Y,--E;z[u]=H<<E&255}}(H),u.reverse=function(z){return H[255&z]<<24|H[z>>>8&255]<<16|H[z>>>16&255]<<8|H[z>>>24&255]},u.interleave2=function(z,u){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(z,u){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>u&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},u.interleave3=function(z,u,Y){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},u.deinterleave3=function(z,u){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>u&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},u.nextCombination=function(z){var u=z|z-1;return u+1|(~u&-~u)-1>>>Y(z)+1}},12744:(z,u,Y)=>{"use strict";z.exports=function(z,u,Y){switch(arguments.length){case 1:return H=[],L(E=z,E,D,!0),H;case 2:return"function"===typeof u?L(z,z,u,!0):function(z,u){return H=[],L(z,u,D,!1),H}(z,u);case 3:return L(z,u,Y,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var H,E=Y(12750),J=Y(12767),l=Y(12774);function T(z,u){for(var Y=0;Y<z;++Y)if(!(u[Y]<=u[Y+z]))return!0;return!1}function b(z,u,Y,H){for(var E=0,J=0,l=0,b=z.length;l<b;++l){var L=z[l];if(!T(u,L)){for(var D=0;D<2*u;++D)Y[E++]=L[D];H[J++]=l}}return J}function L(z,u,Y,H){var T=z.length,L=u.length;if(!(T<=0||L<=0)){var D=z[0].length>>>1;if(!(D<=0)){var g,M=E.mallocDouble(2*D*T),q=E.mallocInt32(T);if((T=b(z,D,M,q))>0){if(1===D&&H)J.init(T),g=J.sweepComplete(D,Y,0,T,M,q,0,T,M,q);else{var C=E.mallocDouble(2*D*L),K=E.mallocInt32(L);(L=b(u,D,C,K))>0&&(J.init(T+L),g=1===D?J.sweepBipartite(D,Y,0,T,M,q,0,L,C,K):l(D,Y,H,T,M,q,L,C,K),E.free(C),E.free(K))}E.free(M),E.free(q)}return g}}}function D(z,u){H.push([z,u])}},12779:(z,u)=>{"use strict";var Y="d",H="ax",E="fp",J="es",l="rs",T="re",b="rb",L="bs",D="be",g="bb",M=[Y,H,"vv",l,T,b,"ri",L,D,g,"bi"];function q(z){var u="bruteForce"+(z?"Full":"Partial"),H=[],l=M.slice();z||l.splice(3,0,E);var T=["function "+u+"("+l.join()+"){"];function b(u,E){var l=function(z,u,H){var E="bruteForce"+(z?"Red":"Blue")+(u?"Flip":"")+(H?"Full":""),l=["function ",E,"(",M.join(),"){","var ",J,"=2*",Y,";"],T="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",b="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(H?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return z?l.push(T,"Q",":",b):l.push(b,"Q",":",T),H?l.push("if(y1<x0||x1<y0)continue;"):u?l.push("if(y0<=x0||x1<y0)continue;"):l.push("if(y0<x0||x1<y0)continue;"),l.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),u?l.push("yi,xi"):l.push("xi,yi"),l.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:l.join("")}}(u,E,z);H.push(l.code),T.push("return "+l.name+"("+M.join()+");")}T.push("if(re-rs>be-bs){"),z?(b(!0,!1),T.push("}else{"),b(!1,!1)):(T.push("if(fp){"),b(!0,!0),T.push("}else{"),b(!0,!1),T.push("}}else{if(fp){"),b(!1,!0),T.push("}else{"),b(!1,!1),T.push("}")),T.push("}}return "+u);var L=H.join("")+T.join("");return new Function(L)()}u.partial=q(!1),u.full=q(!0)},12774:(z,u,Y)=>{"use strict";z.exports=function(z,u,Y,J,D,V,A,x,G){!function(z,u){var Y=8*E.log2(u+1)*(z+1)|0,J=E.nextPow2(W*Y);s.length<J&&(H.free(s),s=H.mallocInt32(J));var l=E.nextPow2(Z*Y);v.length<l&&(H.free(v),v=H.mallocDouble(l))}(z,J+A);var F,R=0,w=2*z;i(R++,0,0,J,0,A,Y?16:0,-1/0,1/0),Y||i(R++,0,0,A,0,J,1,-1/0,1/0);for(;R>0;){var c=(R-=1)*W,U=s[c],O=s[c+1],n=s[c+2],m=s[c+3],p=s[c+4],S=s[c+5],I=R*Z,y=v[I],a=v[I+1],j=1&S,k=!!(16&S),P=D,e=V,N=x,B=G;if(j&&(P=x,e=G,N=D,B=V),!(2&S&&O>=(n=h(z,U,O,n,P,e,a)))&&!(4&S&&(O=o(z,U,O,n,P,e,y))>=n)){var f=n-O,r=p-m;if(k){if(z*f*(f+r)<q){if(void 0!==(F=b.scanComplete(z,U,u,O,n,P,e,m,p,N,B)))return F;continue}}else{if(z*Math.min(f,r)<g){if(void 0!==(F=l(z,U,u,j,O,n,P,e,m,p,N,B)))return F;continue}if(z*f*r<M){if(void 0!==(F=b.scanBipartite(z,U,u,j,O,n,P,e,m,p,N,B)))return F;continue}}var zz=C(z,U,O,n,P,e,y,a);if(O<zz)if(z*(zz-O)<g){if(void 0!==(F=T(z,U+1,u,O,zz,P,e,m,p,N,B)))return F}else if(U===z-2){if(void 0!==(F=j?b.sweepBipartite(z,u,m,p,N,B,O,zz,P,e):b.sweepBipartite(z,u,O,zz,P,e,m,p,N,B)))return F}else i(R++,U+1,O,zz,m,p,j,-1/0,1/0),i(R++,U+1,m,p,O,zz,1^j,-1/0,1/0);if(zz<n){var uz=L(z,U,m,p,N,B),Yz=N[w*uz+U],Hz=K(z,U,uz,p,N,B,Yz);if(Hz<p&&i(R++,U,zz,n,Hz,p,(4|j)+(k?16:0),Yz,a),m<uz&&i(R++,U,zz,n,m,uz,(2|j)+(k?16:0),y,Yz),uz+1===Hz){if(void 0!==(F=k?Q(z,U,u,zz,n,P,e,uz,N,B[uz]):X(z,U,u,j,zz,n,P,e,uz,N,B[uz])))return F}else if(uz<Hz){var Ez;if(k){if(zz<(Ez=d(z,U,zz,n,P,e,Yz))){var Jz=K(z,U,zz,Ez,P,e,Yz);if(U===z-2){if(zz<Jz&&void 0!==(F=b.sweepComplete(z,u,zz,Jz,P,e,uz,Hz,N,B)))return F;if(Jz<Ez&&void 0!==(F=b.sweepBipartite(z,u,Jz,Ez,P,e,uz,Hz,N,B)))return F}else zz<Jz&&i(R++,U+1,zz,Jz,uz,Hz,16,-1/0,1/0),Jz<Ez&&(i(R++,U+1,Jz,Ez,uz,Hz,0,-1/0,1/0),i(R++,U+1,uz,Hz,Jz,Ez,1,-1/0,1/0))}}else zz<(Ez=j?t(z,U,zz,n,P,e,Yz):d(z,U,zz,n,P,e,Yz))&&(U===z-2?F=j?b.sweepBipartite(z,u,uz,Hz,N,B,zz,Ez,P,e):b.sweepBipartite(z,u,zz,Ez,P,e,uz,Hz,N,B):(i(R++,U+1,zz,Ez,uz,Hz,j,-1/0,1/0),i(R++,U+1,uz,Hz,zz,Ez,1^j,-1/0,1/0)))}}}}};var H=Y(12750),E=Y(12754),J=Y(12779),l=J.partial,T=J.full,b=Y(12767),L=Y(12784),D=Y(12791),g=128,M=1<<22,q=1<<22,C=D("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),K=D("lo===p0",["p0"]),h=D("lo<p0",["p0"]),o=D("hi<=p0",["p0"]),d=D("lo<=p0&&p0<=hi",["p0"]),t=D("lo<p0&&p0<=hi",["p0"]),W=6,Z=2,s=H.mallocInt32(1024),v=H.mallocDouble(1024);function i(z,u,Y,H,E,J,l,T,b){var L=W*z;s[L]=u,s[L+1]=Y,s[L+2]=H,s[L+3]=E,s[L+4]=J,s[L+5]=l;var D=Z*z;v[D]=T,v[D+1]=b}function X(z,u,Y,H,E,J,l,T,b,L,D){var g=2*z,M=b*g,q=L[M+u];z:for(var C=E,K=E*g;C<J;++C,K+=g){var h=l[K+u],o=l[K+u+z];if(!(q<h||o<q)&&(!H||q!==h)){for(var d,t=T[C],W=u+1;W<z;++W){h=l[K+W],o=l[K+W+z];var Z=L[M+W],s=L[M+W+z];if(o<Z||s<h)continue z}if(void 0!==(d=H?Y(D,t):Y(t,D)))return d}}}function Q(z,u,Y,H,E,J,l,T,b,L){var D=2*z,g=T*D,M=b[g+u];z:for(var q=H,C=H*D;q<E;++q,C+=D){var K=l[q];if(K!==L){var h=J[C+u],o=J[C+u+z];if(!(M<h||o<M)){for(var d=u+1;d<z;++d){h=J[C+d],o=J[C+d+z];var t=b[g+d],W=b[g+d+z];if(o<t||W<h)continue z}var Z=Y(K,L);if(void 0!==Z)return Z}}}}},12784:(z,u,Y)=>{"use strict";z.exports=function(z,u,Y,l,T,b){if(l<=Y+1)return Y;var L=Y,D=l,g=l+Y>>>1,M=2*z,q=g,C=T[M*g+u];for(;L<D;){if(D-L<E){J(z,u,L,D,T,b),C=T[M*g+u];break}var K=D-L,h=Math.random()*K+L|0,o=T[M*h+u],d=Math.random()*K+L|0,t=T[M*d+u],W=Math.random()*K+L|0,Z=T[M*W+u];o<=t?Z>=t?(q=d,C=t):o>=Z?(q=h,C=o):(q=W,C=Z):t>=Z?(q=d,C=t):Z>=o?(q=h,C=o):(q=W,C=Z);for(var s=M*(D-1),v=M*q,i=0;i<M;++i,++s,++v){var X=T[s];T[s]=T[v],T[v]=X}var Q=b[D-1];b[D-1]=b[q],b[q]=Q;for(s=M*(D-1),v=M*(q=H(z,u,L,D-1,T,b,C)),i=0;i<M;++i,++s,++v){X=T[s];T[s]=T[v],T[v]=X}Q=b[D-1];if(b[D-1]=b[q],b[q]=Q,g<q){for(D=q-1;L<D&&T[M*(D-1)+u]===C;)D-=1;D+=1}else{if(!(q<g))break;for(L=q+1;L<D&&T[M*L+u]===C;)L+=1}}return H(z,u,Y,g,T,b,T[M*g+u])};var H=Y(12791)("lo<p0",["p0"]),E=8;function J(z,u,Y,H,E,J){for(var l=2*z,T=l*(Y+1)+u,b=Y+1;b<H;++b,T+=l)for(var L=E[T],D=b,g=l*(b-1);D>Y&&E[g+u]>L;--D,g-=l){for(var M=g,q=g+l,C=0;C<l;++C,++M,++q){var K=E[M];E[M]=E[q],E[q]=K}var h=J[D];J[D]=J[D-1],J[D-1]=h}}},12791:z=>{"use strict";z.exports=function(z,Y){var H="abcdef".split("").concat(Y),E=[];z.indexOf("lo")>=0&&E.push("lo=e[k+n]");z.indexOf("hi")>=0&&E.push("hi=e[k+o]");return H.push(u.replace("_",E.join()).replace("$",z)),Function.apply(void 0,H)};var u="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12771:z=>{"use strict";z.exports=function(z,H){H<=4*u?Y(0,H-1,z):L(0,H-1,z)};var u=32;function Y(z,u,Y){for(var H=2*(z+1),E=z+1;E<=u;++E){for(var J=Y[H++],l=Y[H++],T=E,b=H-2;T-- >z;){var L=Y[b-2],D=Y[b-1];if(L<J)break;if(L===J&&D<l)break;Y[b]=L,Y[b+1]=D,b-=2}Y[b]=J,Y[b+1]=l}}function H(z,u,Y){u*=2;var H=Y[z*=2],E=Y[z+1];Y[z]=Y[u],Y[z+1]=Y[u+1],Y[u]=H,Y[u+1]=E}function E(z,u,Y){u*=2,Y[z*=2]=Y[u],Y[z+1]=Y[u+1]}function J(z,u,Y,H){u*=2,Y*=2;var E=H[z*=2],J=H[z+1];H[z]=H[u],H[z+1]=H[u+1],H[u]=H[Y],H[u+1]=H[Y+1],H[Y]=E,H[Y+1]=J}function l(z,u,Y,H,E){u*=2,E[z*=2]=E[u],E[u]=Y,E[z+1]=E[u+1],E[u+1]=H}function T(z,u,Y){u*=2;var H=Y[z*=2],E=Y[u];return!(H<E)&&(H!==E||Y[z+1]>Y[u+1])}function b(z,u,Y,H){var E=H[z*=2];return E<u||E===u&&H[z+1]<Y}function L(z,D,g){var M=(D-z+1)/6|0,q=z+M,C=D-M,K=z+D>>1,h=K-M,o=K+M,d=q,t=h,W=K,Z=o,s=C,v=z+1,i=D-1,X=0;T(d,t,g)&&(X=d,d=t,t=X),T(Z,s,g)&&(X=Z,Z=s,s=X),T(d,W,g)&&(X=d,d=W,W=X),T(t,W,g)&&(X=t,t=W,W=X),T(d,Z,g)&&(X=d,d=Z,Z=X),T(W,Z,g)&&(X=W,W=Z,Z=X),T(t,s,g)&&(X=t,t=s,s=X),T(t,W,g)&&(X=t,t=W,W=X),T(Z,s,g)&&(X=Z,Z=s,s=X);for(var Q=g[2*t],V=g[2*t+1],A=g[2*Z],x=g[2*Z+1],G=2*d,F=2*W,R=2*s,w=2*q,c=2*K,U=2*C,O=0;O<2;++O){var n=g[G+O],m=g[F+O],p=g[R+O];g[w+O]=n,g[c+O]=m,g[U+O]=p}E(h,z,g),E(o,D,g);for(var S=v;S<=i;++S)if(b(S,Q,V,g))S!==v&&H(S,v,g),++v;else if(!b(S,A,x,g))for(;;){if(b(i,A,x,g)){b(i,Q,V,g)?(J(S,v,i,g),++v,--i):(H(S,i,g),--i);break}if(--i<S)break}l(z,v-1,Q,V,g),l(D,i+1,A,x,g),v-2-z<=u?Y(z,v-2,g):L(z,v-2,g),D-(i+2)<=u?Y(i+2,D,g):L(i+2,D,g),i-v<=u?Y(v,i,g):L(v,i,g)}},12767:(z,u,Y)=>{"use strict";z.exports={init:function(z){var u=E.nextPow2(z);b.length<u&&(H.free(b),b=H.mallocInt32(u));L.length<u&&(H.free(L),L=H.mallocInt32(u));D.length<u&&(H.free(D),D=H.mallocInt32(u));g.length<u&&(H.free(g),g=H.mallocInt32(u));M.length<u&&(H.free(M),M=H.mallocInt32(u));q.length<u&&(H.free(q),q=H.mallocInt32(u));var Y=8*u;C.length<Y&&(H.free(C),C=H.mallocDouble(Y))},sweepBipartite:function(z,u,Y,H,E,T,M,q,o,d){for(var t=0,W=2*z,Z=z-1,s=W-1,v=Y;v<H;++v){var i=T[v],X=W*v;C[t++]=E[X+Z],C[t++]=-(i+1),C[t++]=E[X+s],C[t++]=i}for(v=M;v<q;++v){i=d[v]+l;var Q=W*v;C[t++]=o[Q+Z],C[t++]=-i,C[t++]=o[Q+s],C[t++]=i}var V=t>>>1;J(C,V);var A=0,x=0;for(v=0;v<V;++v){var G=0|C[2*v+1];if(G>=l)K(D,g,x--,G=G-l|0);else if(G>=0)K(b,L,A--,G);else if(G<=-l){G=-G-l|0;for(var F=0;F<A;++F){if(void 0!==(R=u(b[F],G)))return R}h(D,g,x++,G)}else{G=-G-1|0;for(F=0;F<x;++F){var R;if(void 0!==(R=u(G,D[F])))return R}h(b,L,A++,G)}}},sweepComplete:function(z,u,Y,H,E,l,T,o,d,t){for(var W=0,Z=2*z,s=z-1,v=Z-1,i=Y;i<H;++i){var X=l[i]+1<<1,Q=Z*i;C[W++]=E[Q+s],C[W++]=-X,C[W++]=E[Q+v],C[W++]=X}for(i=T;i<o;++i){X=t[i]+1<<1;var V=Z*i;C[W++]=d[V+s],C[W++]=1|-X,C[W++]=d[V+v],C[W++]=1|X}var A=W>>>1;J(C,A);var x=0,G=0,F=0;for(i=0;i<A;++i){var R=0|C[2*i+1],w=1&R;if(i<A-1&&R>>1===C[2*i+3]>>1&&(w=2,i+=1),R<0){for(var c=-(R>>1)-1,U=0;U<F;++U){if(void 0!==(O=u(M[U],c)))return O}if(0!==w)for(U=0;U<x;++U){if(void 0!==(O=u(b[U],c)))return O}if(1!==w)for(U=0;U<G;++U){var O;if(void 0!==(O=u(D[U],c)))return O}0===w?h(b,L,x++,c):1===w?h(D,g,G++,c):2===w&&h(M,q,F++,c)}else{c=(R>>1)-1;0===w?K(b,L,x--,c):1===w?K(D,g,G--,c):2===w&&K(M,q,F--,c)}}},scanBipartite:function(z,u,Y,H,E,T,D,g,M,q,o,d){var t=0,W=2*z,Z=u,s=u+z,v=1,i=1;H?i=l:v=l;for(var X=E;X<T;++X){var Q=X+v,V=W*X;C[t++]=D[V+Z],C[t++]=-Q,C[t++]=D[V+s],C[t++]=Q}for(X=M;X<q;++X){Q=X+i;var A=W*X;C[t++]=o[A+Z],C[t++]=-Q}var x=t>>>1;J(C,x);var G=0;for(X=0;X<x;++X){var F=0|C[2*X+1];if(F<0){var R=!1;if((Q=-F)>=l?(R=!H,Q-=l):(R=!!H,Q-=1),R)h(b,L,G++,Q);else{var w=d[Q],c=W*Q,U=o[c+u+1],O=o[c+u+1+z];z:for(var n=0;n<G;++n){var m=b[n],p=W*m;if(!(O<D[p+u+1]||D[p+u+1+z]<U)){for(var S=u+2;S<z;++S)if(o[c+S+z]<D[p+S]||D[p+S+z]<o[c+S])continue z;var I,y=g[m];if(void 0!==(I=H?Y(w,y):Y(y,w)))return I}}}}else K(b,L,G--,F-v)}},scanComplete:function(z,u,Y,H,E,T,L,D,g,M,q){for(var K=0,h=2*z,o=u,d=u+z,t=H;t<E;++t){var W=t+l,Z=h*t;C[K++]=T[Z+o],C[K++]=-W,C[K++]=T[Z+d],C[K++]=W}for(t=D;t<g;++t){W=t+1;var s=h*t;C[K++]=M[s+o],C[K++]=-W}var v=K>>>1;J(C,v);var i=0;for(t=0;t<v;++t){var X=0|C[2*t+1];if(X<0){if((W=-X)>=l)b[i++]=W-l;else{var Q=q[W-=1],V=h*W,A=M[V+u+1],x=M[V+u+1+z];z:for(var G=0;G<i;++G){var F=b[G],R=L[F];if(R===Q)break;var w=h*F;if(!(x<T[w+u+1]||T[w+u+1+z]<A)){for(var c=u+2;c<z;++c)if(M[V+c+z]<T[w+c]||T[w+c+z]<M[V+c])continue z;var U=Y(R,Q);if(void 0!==U)return U}}}}else{for(W=X-l,G=i-1;G>=0;--G)if(b[G]===W){for(c=G+1;c<i;++c)b[c-1]=b[c];break}--i}}}};var H=Y(12750),E=Y(12754),J=Y(12771),l=1<<28,T=1024,b=H.mallocInt32(T),L=H.mallocInt32(T),D=H.mallocInt32(T),g=H.mallocInt32(T),M=H.mallocInt32(T),q=H.mallocInt32(T),C=H.mallocDouble(8192);function K(z,u,Y,H){var E=u[H],J=z[Y-1];z[E]=J,u[J]=E}function h(z,u,Y,H){z[Y]=H,u[H]=Y}},12879:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12875:(z,u,Y)=>{var H=Y(12879),E=Y(12885),J=Object.hasOwnProperty,l=Object.create(null);for(var T in H)J.call(H,T)&&(l[H[T]]=T);var b=z.exports={to:{},get:{}};function L(z,u,Y){return Math.min(Math.max(u,z),Y)}function D(z){var u=Math.round(z).toString(16).toUpperCase();return u.length<2?"0"+u:u}b.get=function(z){var u,Y;switch(z.substring(0,3).toLowerCase()){case"hsl":u=b.get.hsl(z),Y="hsl";break;case"hwb":u=b.get.hwb(z),Y="hwb";break;default:u=b.get.rgb(z),Y="rgb"}return u?{model:Y,value:u}:null},b.get.rgb=function(z){if(!z)return null;var u,Y,E,l=[0,0,0,1];if(u=z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=u[2],u=u[1],Y=0;Y<3;Y++){var T=2*Y;l[Y]=parseInt(u.slice(T,T+2),16)}E&&(l[3]=parseInt(E,16)/255)}else if(u=z.match(/^#([a-f0-9]{3,4})$/i)){for(E=(u=u[1])[3],Y=0;Y<3;Y++)l[Y]=parseInt(u[Y]+u[Y],16);E&&(l[3]=parseInt(E+E,16)/255)}else if(u=z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Y=0;Y<3;Y++)l[Y]=parseInt(u[Y+1],0);u[4]&&(u[5]?l[3]=.01*parseFloat(u[4]):l[3]=parseFloat(u[4]))}else{if(!(u=z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(u=z.match(/^(\w+)$/))?"transparent"===u[1]?[0,0,0,0]:J.call(H,u[1])?((l=H[u[1]])[3]=1,l):null:null;for(Y=0;Y<3;Y++)l[Y]=Math.round(2.55*parseFloat(u[Y+1]));u[4]&&(u[5]?l[3]=.01*parseFloat(u[4]):l[3]=parseFloat(u[4]))}for(Y=0;Y<3;Y++)l[Y]=L(l[Y],0,255);return l[3]=L(l[3],0,1),l},b.get.hsl=function(z){if(!z)return null;var u=z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var Y=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,L(parseFloat(u[2]),0,100),L(parseFloat(u[3]),0,100),L(isNaN(Y)?1:Y,0,1)]}return null},b.get.hwb=function(z){if(!z)return null;var u=z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var Y=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,L(parseFloat(u[2]),0,100),L(parseFloat(u[3]),0,100),L(isNaN(Y)?1:Y,0,1)]}return null},b.to.hex=function(){var z=E(arguments);return"#"+D(z[0])+D(z[1])+D(z[2])+(z[3]<1?D(Math.round(255*z[3])):"")},b.to.rgb=function(){var z=E(arguments);return z.length<4||1===z[3]?"rgb("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+")":"rgba("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+", "+z[3]+")"},b.to.rgb.percent=function(){var z=E(arguments),u=Math.round(z[0]/255*100),Y=Math.round(z[1]/255*100),H=Math.round(z[2]/255*100);return z.length<4||1===z[3]?"rgb("+u+"%, "+Y+"%, "+H+"%)":"rgba("+u+"%, "+Y+"%, "+H+"%, "+z[3]+")"},b.to.hsl=function(){var z=E(arguments);return z.length<4||1===z[3]?"hsl("+z[0]+", "+z[1]+"%, "+z[2]+"%)":"hsla("+z[0]+", "+z[1]+"%, "+z[2]+"%, "+z[3]+")"},b.to.hwb=function(){var z=E(arguments),u="";return z.length>=4&&1!==z[3]&&(u=", "+z[3]),"hwb("+z[0]+", "+z[1]+"%, "+z[2]+"%"+u+")"},b.to.keyword=function(z){return l[z.slice(0,3)]}},12872:(z,u,Y)=>{const H=Y(12875),E=Y(12896),J=["keyword","gray","hex"],l={};for(const q of Object.keys(E))l[[...E[q].labels].sort().join("")]=q;const T={};function b(z,u){if(!(this instanceof b))return new b(z,u);if(u&&u in J&&(u=null),u&&!(u in E))throw new Error("Unknown model: "+u);let Y,L;if(null==z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(z instanceof b)this.model=z.model,this.color=[...z.color],this.valpha=z.valpha;else if("string"===typeof z){const u=H.get(z);if(null===u)throw new Error("Unable to parse color from string: "+z);this.model=u.model,L=E[this.model].channels,this.color=u.value.slice(0,L),this.valpha="number"===typeof u.value[L]?u.value[L]:1}else if(z.length>0){this.model=u||"rgb",L=E[this.model].channels;const Y=Array.prototype.slice.call(z,0,L);this.color=M(Y,L),this.valpha="number"===typeof z[L]?z[L]:1}else if("number"===typeof z)this.model="rgb",this.color=[z>>16&255,z>>8&255,255&z],this.valpha=1;else{this.valpha=1;const u=Object.keys(z);"alpha"in z&&(u.splice(u.indexOf("alpha"),1),this.valpha="number"===typeof z.alpha?z.alpha:0);const H=u.sort().join("");if(!(H in l))throw new Error("Unable to parse color from object: "+JSON.stringify(z));this.model=l[H];const{labels:J}=E[this.model],T=[];for(Y=0;Y<J.length;Y++)T.push(z[J[Y]]);this.color=M(T)}if(T[this.model])for(L=E[this.model].channels,Y=0;Y<L;Y++){const z=T[this.model][Y];z&&(this.color[Y]=z(this.color[Y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}b.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(z){let u=this.model in H.to?this:this.rgb();u=u.round("number"===typeof z?z:1);const Y=1===u.valpha?u.color:[...u.color,this.valpha];return H.to[u.model](Y)},percentString(z){const u=this.rgb().round("number"===typeof z?z:1),Y=1===u.valpha?u.color:[...u.color,this.valpha];return H.to.rgb.percent(Y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const z={},{channels:u}=E[this.model],{labels:Y}=E[this.model];for(let H=0;H<u;H++)z[Y[H]]=this.color[H];return 1!==this.valpha&&(z.alpha=this.valpha),z},unitArray(){const z=this.rgb().color;return z[0]/=255,z[1]/=255,z[2]/=255,1!==this.valpha&&z.push(this.valpha),z},unitObject(){const z=this.rgb().object();return z.r/=255,z.g/=255,z.b/=255,1!==this.valpha&&(z.alpha=this.valpha),z},round(z){return z=Math.max(z||0,0),new b([...this.color.map(L(z)),this.valpha],this.model)},alpha(z){return void 0!==z?new b([...this.color,Math.max(0,Math.min(1,z))],this.model):this.valpha},red:D("rgb",0,g(255)),green:D("rgb",1,g(255)),blue:D("rgb",2,g(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,(z=>(z%360+360)%360)),saturationl:D("hsl",1,g(100)),lightness:D("hsl",2,g(100)),saturationv:D("hsv",1,g(100)),value:D("hsv",2,g(100)),chroma:D("hcg",1,g(100)),gray:D("hcg",2,g(100)),white:D("hwb",1,g(100)),wblack:D("hwb",2,g(100)),cyan:D("cmyk",0,g(100)),magenta:D("cmyk",1,g(100)),yellow:D("cmyk",2,g(100)),black:D("cmyk",3,g(100)),x:D("xyz",0,g(95.047)),y:D("xyz",1,g(100)),z:D("xyz",2,g(108.833)),l:D("lab",0,g(100)),a:D("lab",1),b:D("lab",2),keyword(z){return void 0!==z?new b(z):E[this.model].keyword(this.color)},hex(z){return void 0!==z?new b(z):H.to.hex(this.rgb().round().color)},hexa(z){if(void 0!==z)return new b(z);const u=this.rgb().round().color;let Y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Y.length&&(Y="0"+Y),H.to.hex(u)+Y},rgbNumber(){const z=this.rgb().color;return(255&z[0])<<16|(255&z[1])<<8|255&z[2]},luminosity(){const z=this.rgb().color,u=[];for(const[Y,H]of z.entries()){const z=H/255;u[Y]=z<=.04045?z/12.92:((z+.055)/1.055)**2.4}return.2126*u[0]+.7152*u[1]+.0722*u[2]},contrast(z){const u=this.luminosity(),Y=z.luminosity();return u>Y?(u+.05)/(Y+.05):(Y+.05)/(u+.05)},level(z){const u=this.contrast(z);return u>=7?"AAA":u>=4.5?"AA":""},isDark(){const z=this.rgb().color;return(2126*z[0]+7152*z[1]+722*z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const z=this.rgb();for(let u=0;u<3;u++)z.color[u]=255-z.color[u];return z},lighten(z){const u=this.hsl();return u.color[2]+=u.color[2]*z,u},darken(z){const u=this.hsl();return u.color[2]-=u.color[2]*z,u},saturate(z){const u=this.hsl();return u.color[1]+=u.color[1]*z,u},desaturate(z){const u=this.hsl();return u.color[1]-=u.color[1]*z,u},whiten(z){const u=this.hwb();return u.color[1]+=u.color[1]*z,u},blacken(z){const u=this.hwb();return u.color[2]+=u.color[2]*z,u},grayscale(){const z=this.rgb().color,u=.3*z[0]+.59*z[1]+.11*z[2];return b.rgb(u,u,u)},fade(z){return this.alpha(this.valpha-this.valpha*z)},opaquer(z){return this.alpha(this.valpha+this.valpha*z)},rotate(z){const u=this.hsl();let Y=u.color[0];return Y=(Y+z)%360,Y=Y<0?360+Y:Y,u.color[0]=Y,u},mix(z,u){if(!z||!z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof z);const Y=z.rgb(),H=this.rgb(),E=void 0===u?.5:u,J=2*E-1,l=Y.alpha()-H.alpha(),T=((J*l===-1?J:(J+l)/(1+J*l))+1)/2,L=1-T;return b.rgb(T*Y.red()+L*H.red(),T*Y.green()+L*H.green(),T*Y.blue()+L*H.blue(),Y.alpha()*E+H.alpha()*(1-E))}};for(const q of Object.keys(E)){if(J.includes(q))continue;const{channels:z}=E[q];b.prototype[q]=function(){if(this.model===q)return new b(this);for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];return u.length>0?new b(u,q):new b([...(H=E[this.model][q].raw(this.color),Array.isArray(H)?H:[H]),this.valpha],q);var H},b[q]=function(){for(var u=arguments.length,Y=new Array(u),H=0;H<u;H++)Y[H]=arguments[H];let E=Y[0];return"number"===typeof E&&(E=M(Y,z)),new b(E,q)}}function L(z){return function(u){return function(z,u){return Number(z.toFixed(u))}(u,z)}}function D(z,u,Y){z=Array.isArray(z)?z:[z];for(const H of z)(T[H]||(T[H]=[]))[u]=Y;return z=z[0],function(H){let E;return void 0!==H?(Y&&(H=Y(H)),E=this[z](),E.color[u]=H,E):(E=this[z]().color[u],Y&&(E=Y(E)),E)}}function g(z){return function(u){return Math.max(0,Math.min(z,u))}}function M(z,u){for(let Y=0;Y<u;Y++)"number"!==typeof z[Y]&&(z[Y]=0);return z}z.exports=b},12901:(z,u,Y)=>{const H=Y(12906),E={};for(const l of Object.keys(H))E[H[l]]=l;const J={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};z.exports=J;for(const l of Object.keys(J)){if(!("channels"in J[l]))throw new Error("missing channels property: "+l);if(!("labels"in J[l]))throw new Error("missing channel labels property: "+l);if(J[l].labels.length!==J[l].channels)throw new Error("channel and label counts mismatch: "+l);const{channels:z,labels:u}=J[l];delete J[l].channels,delete J[l].labels,Object.defineProperty(J[l],"channels",{value:z}),Object.defineProperty(J[l],"labels",{value:u})}J.rgb.hsl=function(z){const u=z[0]/255,Y=z[1]/255,H=z[2]/255,E=Math.min(u,Y,H),J=Math.max(u,Y,H),l=J-E;let T,b;J===E?T=0:u===J?T=(Y-H)/l:Y===J?T=2+(H-u)/l:H===J&&(T=4+(u-Y)/l),T=Math.min(60*T,360),T<0&&(T+=360);const L=(E+J)/2;return b=J===E?0:L<=.5?l/(J+E):l/(2-J-E),[T,100*b,100*L]},J.rgb.hsv=function(z){let u,Y,H,E,J;const l=z[0]/255,T=z[1]/255,b=z[2]/255,L=Math.max(l,T,b),D=L-Math.min(l,T,b),g=function(z){return(L-z)/6/D+.5};return 0===D?(E=0,J=0):(J=D/L,u=g(l),Y=g(T),H=g(b),l===L?E=H-Y:T===L?E=1/3+u-H:b===L&&(E=2/3+Y-u),E<0?E+=1:E>1&&(E-=1)),[360*E,100*J,100*L]},J.rgb.hwb=function(z){const u=z[0],Y=z[1];let H=z[2];const E=J.rgb.hsl(z)[0],l=1/255*Math.min(u,Math.min(Y,H));return H=1-1/255*Math.max(u,Math.max(Y,H)),[E,100*l,100*H]},J.rgb.cmyk=function(z){const u=z[0]/255,Y=z[1]/255,H=z[2]/255,E=Math.min(1-u,1-Y,1-H);return[100*((1-u-E)/(1-E)||0),100*((1-Y-E)/(1-E)||0),100*((1-H-E)/(1-E)||0),100*E]},J.rgb.keyword=function(z){const u=E[z];if(u)return u;let Y,J=1/0;for(const E of Object.keys(H)){const u=H[E],b=(T=u,((l=z)[0]-T[0])**2+(l[1]-T[1])**2+(l[2]-T[2])**2);b<J&&(J=b,Y=E)}var l,T;return Y},J.keyword.rgb=function(z){return H[z]},J.rgb.xyz=function(z){let u=z[0]/255,Y=z[1]/255,H=z[2]/255;u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,Y=Y>.04045?((Y+.055)/1.055)**2.4:Y/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92;return[100*(.4124*u+.3576*Y+.1805*H),100*(.2126*u+.7152*Y+.0722*H),100*(.0193*u+.1192*Y+.9505*H)]},J.rgb.lab=function(z){const u=J.rgb.xyz(z);let Y=u[0],H=u[1],E=u[2];Y/=95.047,H/=100,E/=108.883,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*H-16,500*(Y-H),200*(H-E)]},J.hsl.rgb=function(z){const u=z[0]/360,Y=z[1]/100,H=z[2]/100;let E,J,l;if(0===Y)return l=255*H,[l,l,l];E=H<.5?H*(1+Y):H+Y-H*Y;const T=2*H-E,b=[0,0,0];for(let L=0;L<3;L++)J=u+1/3*-(L-1),J<0&&J++,J>1&&J--,l=6*J<1?T+6*(E-T)*J:2*J<1?E:3*J<2?T+(E-T)*(2/3-J)*6:T,b[L]=255*l;return b},J.hsl.hsv=function(z){const u=z[0];let Y=z[1]/100,H=z[2]/100,E=Y;const J=Math.max(H,.01);H*=2,Y*=H<=1?H:2-H,E*=J<=1?J:2-J;return[u,100*(0===H?2*E/(J+E):2*Y/(H+Y)),100*((H+Y)/2)]},J.hsv.rgb=function(z){const u=z[0]/60,Y=z[1]/100;let H=z[2]/100;const E=Math.floor(u)%6,J=u-Math.floor(u),l=255*H*(1-Y),T=255*H*(1-Y*J),b=255*H*(1-Y*(1-J));switch(H*=255,E){case 0:return[H,b,l];case 1:return[T,H,l];case 2:return[l,H,b];case 3:return[l,T,H];case 4:return[b,l,H];case 5:return[H,l,T]}},J.hsv.hsl=function(z){const u=z[0],Y=z[1]/100,H=z[2]/100,E=Math.max(H,.01);let J,l;l=(2-Y)*H;const T=(2-Y)*E;return J=Y*E,J/=T<=1?T:2-T,J=J||0,l/=2,[u,100*J,100*l]},J.hwb.rgb=function(z){const u=z[0]/360;let Y=z[1]/100,H=z[2]/100;const E=Y+H;let J;E>1&&(Y/=E,H/=E);const l=Math.floor(6*u),T=1-H;J=6*u-l,0!==(1&l)&&(J=1-J);const b=Y+J*(T-Y);let L,D,g;switch(l){default:case 6:case 0:L=T,D=b,g=Y;break;case 1:L=b,D=T,g=Y;break;case 2:L=Y,D=T,g=b;break;case 3:L=Y,D=b,g=T;break;case 4:L=b,D=Y,g=T;break;case 5:L=T,D=Y,g=b}return[255*L,255*D,255*g]},J.cmyk.rgb=function(z){const u=z[0]/100,Y=z[1]/100,H=z[2]/100,E=z[3]/100;return[255*(1-Math.min(1,u*(1-E)+E)),255*(1-Math.min(1,Y*(1-E)+E)),255*(1-Math.min(1,H*(1-E)+E))]},J.xyz.rgb=function(z){const u=z[0]/100,Y=z[1]/100,H=z[2]/100;let E,J,l;return E=3.2406*u+-1.5372*Y+-.4986*H,J=-.9689*u+1.8758*Y+.0415*H,l=.0557*u+-.204*Y+1.057*H,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,J=J>.0031308?1.055*J**(1/2.4)-.055:12.92*J,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,E=Math.min(Math.max(0,E),1),J=Math.min(Math.max(0,J),1),l=Math.min(Math.max(0,l),1),[255*E,255*J,255*l]},J.xyz.lab=function(z){let u=z[0],Y=z[1],H=z[2];u/=95.047,Y/=100,H/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,H=H>.008856?H**(1/3):7.787*H+16/116;return[116*Y-16,500*(u-Y),200*(Y-H)]},J.lab.xyz=function(z){let u,Y,H;Y=(z[0]+16)/116,u=z[1]/500+Y,H=Y-z[2]/200;const E=Y**3,J=u**3,l=H**3;return Y=E>.008856?E:(Y-16/116)/7.787,u=J>.008856?J:(u-16/116)/7.787,H=l>.008856?l:(H-16/116)/7.787,u*=95.047,Y*=100,H*=108.883,[u,Y,H]},J.lab.lch=function(z){const u=z[0],Y=z[1],H=z[2];let E;E=360*Math.atan2(H,Y)/2/Math.PI,E<0&&(E+=360);return[u,Math.sqrt(Y*Y+H*H),E]},J.lch.lab=function(z){const u=z[0],Y=z[1],H=z[2]/360*2*Math.PI;return[u,Y*Math.cos(H),Y*Math.sin(H)]},J.rgb.ansi16=function(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Y,H,E]=z;let l=null===u?J.rgb.hsv(z)[2]:u;if(l=Math.round(l/50),0===l)return 30;let T=30+(Math.round(E/255)<<2|Math.round(H/255)<<1|Math.round(Y/255));return 2===l&&(T+=60),T},J.hsv.ansi16=function(z){return J.rgb.ansi16(J.hsv.rgb(z),z[2])},J.rgb.ansi256=function(z){const u=z[0],Y=z[1],H=z[2];if(u===Y&&Y===H)return u<8?16:u>248?231:Math.round((u-8)/247*24)+232;return 16+36*Math.round(u/255*5)+6*Math.round(Y/255*5)+Math.round(H/255*5)},J.ansi16.rgb=function(z){let u=z%10;if(0===u||7===u)return z>50&&(u+=3.5),u=u/10.5*255,[u,u,u];const Y=.5*(1+~~(z>50));return[(1&u)*Y*255,(u>>1&1)*Y*255,(u>>2&1)*Y*255]},J.ansi256.rgb=function(z){if(z>=232){const u=10*(z-232)+8;return[u,u,u]}let u;z-=16;return[Math.floor(z/36)/5*255,Math.floor((u=z%36)/6)/5*255,u%6/5*255]},J.rgb.hex=function(z){const u=(((255&Math.round(z[0]))<<16)+((255&Math.round(z[1]))<<8)+(255&Math.round(z[2]))).toString(16).toUpperCase();return"000000".substring(u.length)+u},J.hex.rgb=function(z){const u=z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!u)return[0,0,0];let Y=u[0];3===u[0].length&&(Y=Y.split("").map((z=>z+z)).join(""));const H=parseInt(Y,16);return[H>>16&255,H>>8&255,255&H]},J.rgb.hcg=function(z){const u=z[0]/255,Y=z[1]/255,H=z[2]/255,E=Math.max(Math.max(u,Y),H),J=Math.min(Math.min(u,Y),H),l=E-J;let T,b;return T=l<1?J/(1-l):0,b=l<=0?0:E===u?(Y-H)/l%6:E===Y?2+(H-u)/l:4+(u-Y)/l,b/=6,b%=1,[360*b,100*l,100*T]},J.hsl.hcg=function(z){const u=z[1]/100,Y=z[2]/100,H=Y<.5?2*u*Y:2*u*(1-Y);let E=0;return H<1&&(E=(Y-.5*H)/(1-H)),[z[0],100*H,100*E]},J.hsv.hcg=function(z){const u=z[1]/100,Y=z[2]/100,H=u*Y;let E=0;return H<1&&(E=(Y-H)/(1-H)),[z[0],100*H,100*E]},J.hcg.rgb=function(z){const u=z[0]/360,Y=z[1]/100,H=z[2]/100;if(0===Y)return[255*H,255*H,255*H];const E=[0,0,0],J=u%1*6,l=J%1,T=1-l;let b=0;switch(Math.floor(J)){case 0:E[0]=1,E[1]=l,E[2]=0;break;case 1:E[0]=T,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=l;break;case 3:E[0]=0,E[1]=T,E[2]=1;break;case 4:E[0]=l,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=T}return b=(1-Y)*H,[255*(Y*E[0]+b),255*(Y*E[1]+b),255*(Y*E[2]+b)]},J.hcg.hsv=function(z){const u=z[1]/100,Y=u+z[2]/100*(1-u);let H=0;return Y>0&&(H=u/Y),[z[0],100*H,100*Y]},J.hcg.hsl=function(z){const u=z[1]/100,Y=z[2]/100*(1-u)+.5*u;let H=0;return Y>0&&Y<.5?H=u/(2*Y):Y>=.5&&Y<1&&(H=u/(2*(1-Y))),[z[0],100*H,100*Y]},J.hcg.hwb=function(z){const u=z[1]/100,Y=u+z[2]/100*(1-u);return[z[0],100*(Y-u),100*(1-Y)]},J.hwb.hcg=function(z){const u=z[1]/100,Y=1-z[2]/100,H=Y-u;let E=0;return H<1&&(E=(Y-H)/(1-H)),[z[0],100*H,100*E]},J.apple.rgb=function(z){return[z[0]/65535*255,z[1]/65535*255,z[2]/65535*255]},J.rgb.apple=function(z){return[z[0]/255*65535,z[1]/255*65535,z[2]/255*65535]},J.gray.rgb=function(z){return[z[0]/100*255,z[0]/100*255,z[0]/100*255]},J.gray.hsl=function(z){return[0,0,z[0]]},J.gray.hsv=J.gray.hsl,J.gray.hwb=function(z){return[0,100,z[0]]},J.gray.cmyk=function(z){return[0,0,0,z[0]]},J.gray.lab=function(z){return[z[0],0,0]},J.gray.hex=function(z){const u=255&Math.round(z[0]/100*255),Y=((u<<16)+(u<<8)+u).toString(16).toUpperCase();return"000000".substring(Y.length)+Y},J.rgb.gray=function(z){return[(z[0]+z[1]+z[2])/3/255*100]}},12896:(z,u,Y)=>{const H=Y(12901),E=Y(12909),J={};Object.keys(H).forEach((z=>{J[z]={},Object.defineProperty(J[z],"channels",{value:H[z].channels}),Object.defineProperty(J[z],"labels",{value:H[z].labels});const u=E(z);Object.keys(u).forEach((Y=>{const H=u[Y];J[z][Y]=function(z){const u=function(){for(var u=arguments.length,Y=new Array(u),H=0;H<u;H++)Y[H]=arguments[H];const E=Y[0];if(void 0===E||null===E)return E;E.length>1&&(Y=E);const J=z(Y);if("object"===typeof J)for(let z=J.length,l=0;l<z;l++)J[l]=Math.round(J[l]);return J};return"conversion"in z&&(u.conversion=z.conversion),u}(H),J[z][Y].raw=function(z){const u=function(){for(var u=arguments.length,Y=new Array(u),H=0;H<u;H++)Y[H]=arguments[H];const E=Y[0];return void 0===E||null===E?E:(E.length>1&&(Y=E),z(Y))};return"conversion"in z&&(u.conversion=z.conversion),u}(H)}))})),z.exports=J},12909:(z,u,Y)=>{const H=Y(12901);function E(z){const u=function(){const z={},u=Object.keys(H);for(let Y=u.length,H=0;H<Y;H++)z[u[H]]={distance:-1,parent:null};return z}(),Y=[z];for(u[z].distance=0;Y.length;){const z=Y.pop(),E=Object.keys(H[z]);for(let H=E.length,J=0;J<H;J++){const H=E[J],l=u[H];-1===l.distance&&(l.distance=u[z].distance+1,l.parent=z,Y.unshift(H))}}return u}function J(z,u){return function(Y){return u(z(Y))}}function l(z,u){const Y=[u[z].parent,z];let E=H[u[z].parent][z],l=u[z].parent;for(;u[l].parent;)Y.unshift(u[l].parent),E=J(H[u[l].parent][l],E),l=u[l].parent;return E.conversion=Y,E}z.exports=function(z){const u=E(z),Y={},H=Object.keys(u);for(let E=H.length,J=0;J<E;J++){const z=H[J];null!==u[z].parent&&(Y[z]=l(z,u))}return Y}},12906:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11805:function(z,u,Y){"use strict";var H=this&&this.__createBinding||(Object.create?function(z,u,Y,H){void 0===H&&(H=Y);var E=Object.getOwnPropertyDescriptor(u,Y);E&&!("get"in E?!u.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return u[Y]}}),Object.defineProperty(z,H,E)}:function(z,u,Y,H){void 0===H&&(H=Y),z[H]=u[Y]}),E=this&&this.__setModuleDefault||(Object.create?function(z,u){Object.defineProperty(z,"default",{enumerable:!0,value:u})}:function(z,u){z.default=u}),J=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var u={};if(null!=z)for(var Y in z)"default"!==Y&&Object.prototype.hasOwnProperty.call(z,Y)&&H(u,z,Y);return E(u,z),u},l=this&&this.__awaiter||function(z,u,Y,H){return new(Y||(Y=Promise))((function(E,J){function l(z){try{b(H.next(z))}catch(u){J(u)}}function T(z){try{b(H.throw(z))}catch(u){J(u)}}function b(z){var u;z.done?E(z.value):(u=z.value,u instanceof Y?u:new Y((function(z){z(u)}))).then(l,T)}b((H=H.apply(z,u||[])).next())}))};Object.defineProperty(u,"__esModule",{value:!0}),u.Auth=u.Platform=void 0;const T=J(Y(11730)),b=Y(11813),L="colyseus-auth-token";!function(z){z.ios="ios",z.android="android"}(u.Platform||(u.Platform={}));u.Auth=class{constructor(z){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=z.replace("ws","http"),(0,b.getItem)(L,(z=>this.token=z))}get hasToken(){return!!this.token}login(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l(this,void 0,void 0,(function*(){const u=Object.assign({},z);this.hasToken&&(u.token=this.token);const Y=yield this.request("post","/auth",u);this.token=Y.token,(0,b.setItem)(L,this.token);for(let z in Y)this.hasOwnProperty(z)&&(this[z]=Y[z]);return this.registerPingService(),this}))}save(){return l(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return l(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return l(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return l(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(z){return l(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:z})}))}acceptFriendRequest(z){return l(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:z})}))}declineFriendRequest(z){return l(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:z})}))}blockUser(z){return l(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:z})}))}unblockUser(z){return l(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:z})}))}request(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return l(this,void 0,void 0,(function*(){E.Accept="application/json",this.hasToken&&(E.Authorization="Bearer "+this.token);const J=[];for(const z in Y)J.push(`${z}=${Y[z]}`);const l=J.length>0?`?${J.join("&")}`:"",b={headers:E};return H&&(b.body=H),(yield T[z](`${this.endpoint}${u}${l}`,b)).data}))}logout(){this.token=void 0,(0,b.removeItem)(L),this.unregisterPingService()}registerPingService(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),z)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11723:function(z,u,Y){"use strict";var H,E=this&&this.__awaiter||function(z,u,Y,H){return new(Y||(Y=Promise))((function(E,J){function l(z){try{b(H.next(z))}catch(u){J(u)}}function T(z){try{b(H.throw(z))}catch(u){J(u)}}function b(z){var u;z.done?E(z.value):(u=z.value,u instanceof Y?u:new Y((function(z){z(u)}))).then(l,T)}b((H=H.apply(z,u||[])).next())}))};Object.defineProperty(u,"__esModule",{value:!0}),u.Client=u.MatchMakeError=void 0;const J=Y(11730),l=Y(11737),T=Y(11746);class b extends Error{constructor(z,u){super(z),this.code=u,Object.setPrototypeOf(this,b.prototype)}}u.MatchMakeError=b;const L="undefined"!==typeof window&&"undefined"!==typeof(null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";u.Client=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L;if("string"===typeof z){const u=new URL(z),Y="https:"===u.protocol||"wss:"===u.protocol,H=Number(u.port||(Y?443:80));this.settings={hostname:u.hostname,pathname:"/"!==u.pathname?u.pathname:"",port:H,secure:Y}}else void 0===z.port&&(z.port=z.secure?443:80),void 0===z.pathname&&(z.pathname=""),this.settings=z}joinOrCreate(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",z,u,Y)}))}create(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",z,u,Y)}))}join(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",z,u,Y)}))}joinById(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",z,u,Y)}))}reconnect(z,u){return E(this,void 0,void 0,(function*(){if("string"===typeof z&&"string"===typeof u)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Y,H]=z.split(":");return yield this.createMatchMakeRequest("reconnect",Y,{reconnectionToken:H},u)}))}getAvailableRooms(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield(0,J.get)(this.getHttpEndpoint(`${z}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(z,u,Y){return E(this,void 0,void 0,(function*(){const H=this.createRoom(z.room.name,u);H.roomId=z.room.roomId,H.sessionId=z.sessionId;const J={sessionId:H.sessionId};z.reconnectionToken&&(J.reconnectionToken=z.reconnectionToken);const T=Y||H;return H.connect(this.buildEndpoint(z.room,J),z.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${H.roomId}'...`);let Y=0;const J=()=>E(this,void 0,void 0,(function*(){Y++;try{yield this.consumeSeatReservation(z,u,T),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${H.roomId}'`)}catch(E){Y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Y} out of 8)`),setTimeout(J,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(J,2e3)}))),T),new Promise(((z,u)=>{const Y=(z,Y)=>u(new l.ServerError(z,Y));T.onError.once(Y),T.onJoin.once((()=>{T.onError.remove(Y),z(T)}))}))}))}createMatchMakeRequest(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield(0,J.post)(this.getHttpEndpoint(`${z}/${u}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Y)})).data;if(E.error)throw new b(E.error,E.code);return"reconnect"===z&&(E.reconnectionToken=Y.reconnectionToken),yield this.consumeSeatReservation(E,H,l)}))}createRoom(z,u){return new T.Room(z,u)}buildEndpoint(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=[];for(const E in u)u.hasOwnProperty(E)&&Y.push(`${E}=${u[E]}`);let H=this.settings.secure?"wss://":"ws://";return z.publicAddress?H+=`${z.publicAddress}`:H+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${H}/${z.processId}/${z.roomId}?${Y.join("&")}`}getHttpEndpoint(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${z}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11756:(z,u,Y)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Connection=void 0;const H=Y(11759);u.Connection=class{constructor(){this.events={},this.transport=new H.WebSocketTransport(this.events)}send(z){this.transport.send(z)}connect(z){this.transport.connect(z)}close(z,u){this.transport.close(z,u)}get isOpen(){return this.transport.isOpen}}},11772:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.utf8Length=u.utf8Read=u.ErrorCode=u.Protocol=void 0,function(z){z[z.HANDSHAKE=9]="HANDSHAKE",z[z.JOIN_ROOM=10]="JOIN_ROOM",z[z.ERROR=11]="ERROR",z[z.LEAVE_ROOM=12]="LEAVE_ROOM",z[z.ROOM_DATA=13]="ROOM_DATA",z[z.ROOM_STATE=14]="ROOM_STATE",z[z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",z[z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",z[z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(u.Protocol||(u.Protocol={})),function(z){z[z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",z[z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",z[z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",z[z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",z[z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",z[z.AUTH_FAILED=4215]="AUTH_FAILED",z[z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(u.ErrorCode||(u.ErrorCode={})),u.utf8Read=function(z,u){const Y=z[u++];for(var H="",E=0,J=u,l=u+Y;J<l;J++){var T=z[J];if(0!==(128&T))if(192!==(224&T))if(224!==(240&T)){if(240!==(248&T))throw new Error("Invalid byte "+T.toString(16));(E=(7&T)<<18|(63&z[++J])<<12|(63&z[++J])<<6|63&z[++J])>=65536?(E-=65536,H+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):H+=String.fromCharCode(E)}else H+=String.fromCharCode((15&T)<<12|(63&z[++J])<<6|63&z[++J]);else H+=String.fromCharCode((31&T)<<6|63&z[++J]);else H+=String.fromCharCode(T)}return H},u.utf8Length=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=0,Y=0;for(let H=0,E=z.length;H<E;H++)u=z.charCodeAt(H),u<128?Y+=1:u<2048?Y+=2:u<55296||u>=57344?Y+=3:(H++,Y+=4);return Y+1}},11746:function(z,u,Y){"use strict";var H=this&&this.__createBinding||(Object.create?function(z,u,Y,H){void 0===H&&(H=Y);var E=Object.getOwnPropertyDescriptor(u,Y);E&&!("get"in E?!u.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return u[Y]}}),Object.defineProperty(z,H,E)}:function(z,u,Y,H){void 0===H&&(H=Y),z[H]=u[Y]}),E=this&&this.__setModuleDefault||(Object.create?function(z,u){Object.defineProperty(z,"default",{enumerable:!0,value:u})}:function(z,u){z.default=u}),J=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var u={};if(null!=z)for(var Y in z)"default"!==Y&&Object.prototype.hasOwnProperty.call(z,Y)&&H(u,z,Y);return E(u,z),u};Object.defineProperty(u,"__esModule",{value:!0}),u.Room=void 0;const l=J(Y(11750)),T=Y(11756),b=Y(11772),L=Y(11781),D=Y(11784),g=Y(11792),M=Y(11801),q=Y(11737);class C{constructor(z,u){this.onStateChange=(0,g.createSignal)(),this.onError=(0,g.createSignal)(),this.onLeave=(0,g.createSignal)(),this.onJoin=(0,g.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,D.createNanoEvents)(),this.roomId=null,this.name=z,u&&(this.serializer=new((0,L.getSerializer)("schema")),this.rootSchema=u,this.serializer.state=new u),this.onError(((z,u)=>{var Y;return null===(Y=console.warn)||void 0===Y?void 0:Y.call(console,`colyseus.js - onError => (${z}) ${u}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const H=new T.Connection;Y.connection=H,H.events.onmessage=C.prototype.onMessageCallback.bind(Y),H.events.onclose=function(z){var H;if(!Y.hasJoined)return null===(H=console.warn)||void 0===H||H.call(console,`Room connection was closed unexpectedly (${z.code}): ${z.reason}`),void Y.onError.invoke(z.code,z.reason);z.code===q.CloseCode.DEVMODE_RESTART&&u?u():(Y.onLeave.invoke(z.code),Y.destroy())},H.events.onerror=function(z){var u;null===(u=console.warn)||void 0===u||u.call(console,`Room, onError (${z.code}): ${z.reason}`),Y.onError.invoke(z.code,z.reason)},H.connect(z)}leave(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((u=>{this.onLeave((z=>u(z))),this.connection?z?this.connection.send([b.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(q.CloseCode.CONSENTED)}))}onMessage(z,u){return this.onMessageHandlers.on(this.getMessageHandlerKey(z),u)}send(z,u){const Y=[b.Protocol.ROOM_DATA];let H;if("string"===typeof z?M.encode.string(Y,z):M.encode.number(Y,z),void 0!==u){const z=l.encode(u);H=new Uint8Array(Y.length+z.byteLength),H.set(new Uint8Array(Y),0),H.set(new Uint8Array(z),Y.length)}else H=new Uint8Array(Y);this.connection.send(H.buffer)}sendBytes(z,u){const Y=[b.Protocol.ROOM_DATA_BYTES];let H;"string"===typeof z?M.encode.string(Y,z):M.encode.number(Y,z),H=new Uint8Array(Y.length+(u.byteLength||u.length)),H.set(new Uint8Array(Y),0),H.set(new Uint8Array(u),Y.length),this.connection.send(H.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(z){const u=Array.from(new Uint8Array(z.data)),Y=u[0];if(Y===b.Protocol.JOIN_ROOM){let z=1;const Y=(0,b.utf8Read)(u,z);if(z+=(0,b.utf8Length)(Y),this.serializerId=(0,b.utf8Read)(u,z),z+=(0,b.utf8Length)(this.serializerId),!this.serializer){const z=(0,L.getSerializer)(this.serializerId);this.serializer=new z}u.length>z&&this.serializer.handshake&&this.serializer.handshake(u,{offset:z}),this.reconnectionToken=`${this.roomId}:${Y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([b.Protocol.JOIN_ROOM])}else if(Y===b.Protocol.ERROR){const z={offset:1},Y=M.decode.number(u,z),H=M.decode.string(u,z);this.onError.invoke(Y,H)}else if(Y===b.Protocol.LEAVE_ROOM)this.leave();else if(Y===b.Protocol.ROOM_DATA_SCHEMA){const z={offset:1},Y=this.serializer.getState().constructor._context.get(M.decode.number(u,z)),H=new Y;H.decode(u,z),this.dispatchMessage(Y,H)}else if(Y===b.Protocol.ROOM_STATE)u.shift(),this.setState(u);else if(Y===b.Protocol.ROOM_STATE_PATCH)u.shift(),this.patch(u);else if(Y===b.Protocol.ROOM_DATA){const Y={offset:1},H=M.decode.stringCheck(u,Y)?M.decode.string(u,Y):M.decode.number(u,Y),E=u.length>Y.offset?l.decode(z.data,Y.offset):void 0;this.dispatchMessage(H,E)}else if(Y===b.Protocol.ROOM_DATA_BYTES){const z={offset:1},Y=M.decode.stringCheck(u,z)?M.decode.string(u,z):M.decode.number(u,z);this.dispatchMessage(Y,new Uint8Array(u.slice(z.offset)))}}setState(z){this.serializer.setState(z),this.onStateChange.invoke(this.serializer.getState())}patch(z){this.serializer.patch(z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(z,u){var Y;const H=this.getMessageHandlerKey(z);this.onMessageHandlers.events[H]?this.onMessageHandlers.emit(H,u):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",z,u):null===(Y=console.warn)||void 0===Y||Y.call(console,`colyseus.js: onMessage() not registered for type '${z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(z){switch(typeof z){case"function":return`$${z._typeid}`;case"string":return z;case"number":return`i${z}`;default:throw new Error("invalid message type.")}}}u.Room=C},11813:(z,u)=>{"use strict";let Y;function H(){return Y||(Y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(z,u){this.cache[z]=u},getItem:function(z){this.cache[z]},removeItem:function(z){delete this.cache[z]}}),Y}Object.defineProperty(u,"__esModule",{value:!0}),u.getItem=u.removeItem=u.setItem=void 0,u.setItem=function(z,u){H().setItem(z,u)},u.removeItem=function(z){H().removeItem(z)},u.getItem=function(z,u){const Y=H().getItem(z);"undefined"!==typeof Promise&&Y instanceof Promise?Y.then((z=>u(z))):u(Y)}},11784:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createNanoEvents=void 0;u.createNanoEvents=()=>({emit(z){let u=this.events[z]||[];for(var Y=arguments.length,H=new Array(Y>1?Y-1:0),E=1;E<Y;E++)H[E-1]=arguments[E];for(let J=0,l=u.length;J<l;J++)u[J](...H)},events:{},on(z,u){var Y;return(null===(Y=this.events[z])||void 0===Y?void 0:Y.push(u))||(this.events[z]=[u]),()=>{var Y;this.events[z]=null===(Y=this.events[z])||void 0===Y?void 0:Y.filter((z=>u!==z))}}})},11792:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createSignal=u.EventEmitter=void 0;class Y{constructor(){this.handlers=[]}register(z){return this.handlers.push(z),this}invoke(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];this.handlers.forEach((z=>z.apply(this,u)))}invokeAsync(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];return Promise.all(this.handlers.map((z=>z.apply(this,u))))}remove(z){const u=this.handlers.indexOf(z);this.handlers[u]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}u.EventEmitter=Y,u.createSignal=function(){const z=new Y;function u(u){return z.register(u,null===this)}return u.once=u=>{const Y=function(){for(var H=arguments.length,E=new Array(H),J=0;J<H;J++)E[J]=arguments[J];u.apply(this,E),z.remove(Y)};z.register(Y)},u.remove=u=>z.remove(u),u.invoke=function(){return z.invoke(...arguments)},u.invokeAsync=function(){return z.invokeAsync(...arguments)},u.clear=()=>z.clear(),u}},11737:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.ServerError=u.CloseCode=void 0,function(z){z[z.CONSENTED=4e3]="CONSENTED",z[z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(u.CloseCode||(u.CloseCode={}));class Y extends Error{constructor(z,u){super(u),this.name="ServerError",this.code=z}}u.ServerError=Y},11706:(z,u,Y)=>{"use strict";u.d=void 0,Y(11714);var H=Y(11723);Object.defineProperty(u,"d",{enumerable:!0,get:function(){return H.Client}});var E=Y(11772);var J=Y(11746);var l=Y(11805);const T=Y(11815);const b=Y(11820),L=Y(11781);(0,L.registerSerializer)("schema",T.SchemaSerializer),(0,L.registerSerializer)("none",b.NoneSerializer)},11714:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=z=>null!==z&&"object"===typeof z&&z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11750:(z,u)=>{"use strict";function Y(z,u){if(this._offset=u,z instanceof ArrayBuffer)this._buffer=z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(z))throw new Error("Invalid argument");this._buffer=z.buffer,this._view=new DataView(this._buffer,z.byteOffset,z.byteLength)}}Object.defineProperty(u,"__esModule",{value:!0}),u.decode=u.encode=void 0,Y.prototype._array=function(z){for(var u=new Array(z),Y=0;Y<z;Y++)u[Y]=this._parse();return u},Y.prototype._map=function(z){for(var u={},Y=0;Y<z;Y++)u[this._parse()]=this._parse();return u},Y.prototype._str=function(z){var u=function(z,u,Y){for(var H="",E=0,J=u,l=u+Y;J<l;J++){var T=z.getUint8(J);if(0!==(128&T))if(192!==(224&T))if(224!==(240&T)){if(240!==(248&T))throw new Error("Invalid byte "+T.toString(16));(E=(7&T)<<18|(63&z.getUint8(++J))<<12|(63&z.getUint8(++J))<<6|63&z.getUint8(++J))>=65536?(E-=65536,H+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):H+=String.fromCharCode(E)}else H+=String.fromCharCode((15&T)<<12|(63&z.getUint8(++J))<<6|63&z.getUint8(++J));else H+=String.fromCharCode((31&T)<<6|63&z.getUint8(++J));else H+=String.fromCharCode(T)}return H}(this._view,this._offset,z);return this._offset+=z,u},Y.prototype._bin=function(z){var u=this._buffer.slice(this._offset,this._offset+z);return this._offset+=z,u},Y.prototype._parse=function(){var z,u=this._view.getUint8(this._offset++),Y=0,H=0,E=0,J=0;if(u<192)return u<128?u:u<144?this._map(15&u):u<160?this._array(15&u):this._str(31&u);if(u>223)return-1*(255-u+1);switch(u){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Y=this._view.getUint8(this._offset),this._offset+=1,this._bin(Y);case 197:return Y=this._view.getUint16(this._offset),this._offset+=2,this._bin(Y);case 198:return Y=this._view.getUint32(this._offset),this._offset+=4,this._bin(Y);case 199:if(Y=this._view.getUint8(this._offset),H=this._view.getInt8(this._offset+1),this._offset+=2,-1===H){var l=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),J=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+J)+l/1e6)}return[H,this._bin(Y)];case 200:return Y=this._view.getUint16(this._offset),H=this._view.getInt8(this._offset+2),this._offset+=3,[H,this._bin(Y)];case 201:return Y=this._view.getUint32(this._offset),H=this._view.getInt8(this._offset+4),this._offset+=5,[H,this._bin(Y)];case 202:return z=this._view.getFloat32(this._offset),this._offset+=4,z;case 203:return z=this._view.getFloat64(this._offset),this._offset+=8,z;case 204:return z=this._view.getUint8(this._offset),this._offset+=1,z;case 205:return z=this._view.getUint16(this._offset),this._offset+=2,z;case 206:return z=this._view.getUint32(this._offset),this._offset+=4,z;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,E+J;case 208:return z=this._view.getInt8(this._offset),this._offset+=1,z;case 209:return z=this._view.getInt16(this._offset),this._offset+=2,z;case 210:return z=this._view.getInt32(this._offset),this._offset+=4,z;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,E+J;case 212:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?void(this._offset+=1):[H,this._bin(1)];case 213:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(2)];case 214:return H=this._view.getInt8(this._offset),this._offset+=1,-1===H?(z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*z)):[H,this._bin(4)];case 215:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?(E=this._view.getInt32(this._offset)*Math.pow(2,32),J=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+J)):-1===H?(E=this._view.getUint32(this._offset),J=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+J)+(E>>>2)/1e6)):[H,this._bin(8)];case 216:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(16)];case 217:return Y=this._view.getUint8(this._offset),this._offset+=1,this._str(Y);case 218:return Y=this._view.getUint16(this._offset),this._offset+=2,this._str(Y);case 219:return Y=this._view.getUint32(this._offset),this._offset+=4,this._str(Y);case 220:return Y=this._view.getUint16(this._offset),this._offset+=2,this._array(Y);case 221:return Y=this._view.getUint32(this._offset),this._offset+=4,this._array(Y);case 222:return Y=this._view.getUint16(this._offset),this._offset+=2,this._map(Y);case 223:return Y=this._view.getUint32(this._offset),this._offset+=4,this._map(Y)}throw new Error("Could not parse")},u.decode=function(z){var u=new Y(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),H=u._parse();if(u._offset!==z.byteLength)throw new Error(z.byteLength-u._offset+" trailing bytes");return H};function H(z,u,Y){for(var H=0,E=0,J=Y.length;E<J;E++)(H=Y.charCodeAt(E))<128?z.setUint8(u++,H):H<2048?(z.setUint8(u++,192|H>>6),z.setUint8(u++,128|63&H)):H<55296||H>=57344?(z.setUint8(u++,224|H>>12),z.setUint8(u++,128|H>>6&63),z.setUint8(u++,128|63&H)):(E++,H=65536+((1023&H)<<10|1023&Y.charCodeAt(E)),z.setUint8(u++,240|H>>18),z.setUint8(u++,128|H>>12&63),z.setUint8(u++,128|H>>6&63),z.setUint8(u++,128|63&H))}function E(z,u,Y){var H=typeof Y,J=0,l=0,T=0,b=0,L=0,D=0;if("string"===H){if(L=function(z){for(var u=0,Y=0,H=0,E=z.length;H<E;H++)(u=z.charCodeAt(H))<128?Y+=1:u<2048?Y+=2:u<55296||u>=57344?Y+=3:(H++,Y+=4);return Y}(Y),L<32)z.push(160|L),D=1;else if(L<256)z.push(217,L),D=2;else if(L<65536)z.push(218,L>>8,L),D=3;else{if(!(L<4294967296))throw new Error("String too long");z.push(219,L>>24,L>>16,L>>8,L),D=5}return u.push({_str:Y,_length:L,_offset:z.length}),D+L}if("number"===H)return Math.floor(Y)===Y&&isFinite(Y)?Y>=0?Y<128?(z.push(Y),1):Y<256?(z.push(204,Y),2):Y<65536?(z.push(205,Y>>8,Y),3):Y<4294967296?(z.push(206,Y>>24,Y>>16,Y>>8,Y),5):(T=Y/Math.pow(2,32)|0,b=Y>>>0,z.push(207,T>>24,T>>16,T>>8,T,b>>24,b>>16,b>>8,b),9):Y>=-32?(z.push(Y),1):Y>=-128?(z.push(208,Y),2):Y>=-32768?(z.push(209,Y>>8,Y),3):Y>=-2147483648?(z.push(210,Y>>24,Y>>16,Y>>8,Y),5):(T=Math.floor(Y/Math.pow(2,32)),b=Y>>>0,z.push(211,T>>24,T>>16,T>>8,T,b>>24,b>>16,b>>8,b),9):(z.push(203),u.push({_float:Y,_length:8,_offset:z.length}),9);if("object"===H){if(null===Y)return z.push(192),1;if(Array.isArray(Y)){if((L=Y.length)<16)z.push(144|L),D=1;else if(L<65536)z.push(220,L>>8,L),D=3;else{if(!(L<4294967296))throw new Error("Array too large");z.push(221,L>>24,L>>16,L>>8,L),D=5}for(J=0;J<L;J++)D+=E(z,u,Y[J]);return D}if(Y instanceof Date){var g=Y.getTime(),M=Math.floor(g/1e3),q=1e6*(g-1e3*M);return M>=0&&q>=0&&M<=17179869183?0===q&&M<=4294967295?(z.push(214,255,M>>24,M>>16,M>>8,M),6):(T=M/4294967296,b=4294967295&M,z.push(215,255,q>>22,q>>14,q>>6,T,b>>24,b>>16,b>>8,b),10):(T=Math.floor(M/4294967296),b=M>>>0,z.push(199,12,255,q>>24,q>>16,q>>8,q,T>>24,T>>16,T>>8,T,b>>24,b>>16,b>>8,b),15)}if(Y instanceof ArrayBuffer){if((L=Y.byteLength)<256)z.push(196,L),D=2;else if(L<65536)z.push(197,L>>8,L),D=3;else{if(!(L<4294967296))throw new Error("Buffer too large");z.push(198,L>>24,L>>16,L>>8,L),D=5}return u.push({_bin:Y,_length:L,_offset:z.length}),D+L}if("function"===typeof Y.toJSON)return E(z,u,Y.toJSON());var C=[],K="",h=Object.keys(Y);for(J=0,l=h.length;J<l;J++)void 0!==Y[K=h[J]]&&"function"!==typeof Y[K]&&C.push(K);if((L=C.length)<16)z.push(128|L),D=1;else if(L<65536)z.push(222,L>>8,L),D=3;else{if(!(L<4294967296))throw new Error("Object too large");z.push(223,L>>24,L>>16,L>>8,L),D=5}for(J=0;J<L;J++)D+=E(z,u,K=C[J]),D+=E(z,u,Y[K]);return D}if("boolean"===H)return z.push(Y?195:194),1;if("undefined"===H)return z.push(192),1;if("function"===typeof Y.toJSON)return E(z,u,Y.toJSON());throw new Error("Could not encode")}u.encode=function(z){var u=[],Y=[],J=E(u,Y,z),l=new ArrayBuffer(J),T=new DataView(l),b=0,L=0,D=-1;Y.length>0&&(D=Y[0]._offset);for(var g,M=0,q=0,C=0,K=u.length;C<K;C++)if(T.setUint8(L+C,u[C]),C+1===D){if(M=(g=Y[b])._length,q=L+D,g._bin)for(var h=new Uint8Array(g._bin),o=0;o<M;o++)T.setUint8(q+o,h[o]);else g._str?H(T,q,g._str):void 0!==g._float&&T.setFloat64(q,g._float);L+=M,Y[++b]&&(D=Y[b]._offset)}return l}},11820:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.NoneSerializer=void 0;u.NoneSerializer=class{setState(z){}getState(){return null}patch(z){}teardown(){}handshake(z){}}},11815:(z,u,Y)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.SchemaSerializer=void 0;const H=Y(11801);u.SchemaSerializer=class{setState(z){return this.state.decode(z)}getState(){return this.state}patch(z){return this.state.decode(z)}teardown(){var z,u;null===(u=null===(z=this.state)||void 0===z?void 0:z.$changes)||void 0===u||u.root.clearRefs()}handshake(z,u){if(this.state){(new H.Reflection).decode(z,u)}else this.state=H.Reflection.decode(z,u)}}},11781:(z,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.getSerializer=u.registerSerializer=void 0;const Y={};u.registerSerializer=function(z,u){Y[z]=u},u.getSerializer=function(z){const u=Y[z];if(!u)throw new Error("missing serializer: "+z);return u}},11759:function(z,u,Y){"use strict";var H=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(u,"__esModule",{value:!0}),u.WebSocketTransport=void 0;const E=H(Y(11768)),J=globalThis.WebSocket||E.default;u.WebSocketTransport=class{constructor(z){this.events=z}send(z){z instanceof ArrayBuffer?this.ws.send(z):Array.isArray(z)&&this.ws.send(new Uint8Array(z).buffer)}connect(z){this.ws=new J(z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(z,u){this.ws.close(z,u)}get isOpen(){return this.ws.readyState===J.OPEN}}},11768:z=>{"use strict";z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12761:z=>{"use strict";function u(z,Y,H){var E=0|z[H];if(E<=0)return[];var J,l=new Array(E);if(H===z.length-1)for(J=0;J<E;++J)l[J]=Y;else for(J=0;J<E;++J)l[J]=u(z,Y,H+1);return l}z.exports=function(z,Y){switch("undefined"===typeof Y&&(Y=0),typeof z){case"number":if(z>0)return function(z,u){var Y,H;for(Y=new Array(z),H=0;H<z;++H)Y[H]=u;return Y}(0|z,Y);break;case"object":if("number"===typeof z.length)return u(z,Y,0)}return[]}},12717:(z,u,Y)=>{z.exports=function(){var z=this;this.components={},this.comps=this.components;var u=this.components,Y=1,E={},J=[],l=[],T={timeout:!1,removals:[],multiComps:[]};function b(z,Y){var H=u[Y],J=E[Y],l=J.hash[z];l&&(J.remove(z),H.cl&&(H.multi?(l.forEach((u=>{u&&H.cl(z,u)})),l.length=0):H.cl(z,l)),T.removals.push(J),L())}function L(){T.timeout||(T.timeout=!0,setTimeout(D,1))}function D(){T.timeout=!1,g()}function g(){T.multiComps.length&&function(z){for(var u=0;u<z.length;u++){var{entID:Y,data:H}=z[u],E=H.hash[Y];if(E){for(var J=0;J<E.length;J++)E[J]||(E.splice(J,1),J--);0===E.length&&(H.remove(Y),T.removals.push(H))}}z.length=0}(T.multiComps),T.removals.length&&function(z){for(var u=0;u<z.length;u++){z[u].flush()}z.length=0}(T.removals)}this.cg=E,this._systems=J,this._renderSystems=l,this.MD=function(u){var H=Y++;return Array.isArray(u)&&u.forEach((u=>z.zL(H,u))),H},this.deleteEntity=function(u){return Object.keys(E).forEach((z=>{E[z].hash[u]&&b(u,z)})),z},this.AD=function(z){if(!z)throw new Error("Missing component definition");var Y=z.name;if(!Y)throw new Error("Component definition must have a name property.");if("string"!==typeof Y)throw new Error("Component name must be a string.");if(""===Y)throw new Error("Component name must be a non-empty string.");if(E[Y])throw new Error(`Component ${Y} already exists.`);var T={};return T.name=Y,T.multi=!!z.multi,T.order=isNaN(z.order)?99:z.order,T.stateConstructor=z.stateConstructor||null,T.state=z.state||{},T.KT=z.KT||null,T.cl=z.cl||null,T.system=z.system||null,T.vT=z.vT||null,u[Y]=T,E[Y]=new H,E[Y]._pendingMultiCleanup=!1,E[Y]._multiCleanupIDs=T.multi?[]:null,T.system&&(J.push(Y),J.sort(((z,Y)=>u[z].order-u[Y].order))),T.vT&&(l.push(Y),l.sort(((z,Y)=>u[z].order-u[Y].order))),Y},this.overwriteComponent=function(z,Y){var H=u[z];if(!H)throw new Error(`Unknown component: ${z}`);if(!Y)throw new Error("Missing component definition");if(H.name!==Y.name)throw new Error("Overwriting component must use the same name property.");var T={};T.name=z,T.multi=!!Y.multi,T.order=isNaN(Y.order)?99:Y.order,T.state=Y.state||{},T.KT=Y.KT||null,T.cl=Y.cl||null,T.system=Y.system||null,T.vT=Y.vT||null,u[z]=T,E[z]._pendingMultiCleanup=!1,E[z]._multiCleanupIDs=T.multi?[]:null;var b=J.indexOf(z);T.system&&b<0&&J.push(z),!T.system&&b>=0&&J.splice(b,1),J.sort(((z,Y)=>u[z].order-u[Y].order));var L=l.indexOf(z);T.vT&&L<0&&l.push(z),!T.vT&&L>=0&&l.splice(L,1),l.sort(((z,Y)=>u[z].order-u[Y].order));var D=T.state;return this.NL(z).forEach((z=>{for(var u in D)u in z||(z[u]=D[u]);T.KT&&T.KT(z.ZT,z)})),z},this.deleteComponent=function(Y){var H=E[Y];if(!H)throw new Error(`Unknown component: ${Y}`);H.flush(),H.list.forEach((z=>{z&&b(z.ZT||z[0].ZT,Y)}));var T=J.indexOf(Y),L=l.indexOf(Y);return T>-1&&J.splice(T,1),L>-1&&l.splice(L,1),E[Y].dispose(),delete E[Y],delete u[Y],z},this.zL=function(z,Y,H){var J,l=u[Y],T=E[Y];if(!T)throw new Error(`Unknown component: ${Y}.`);if(T.hash[z]&&!l.multi)throw new Error(`Entity ${z} already has component: ${Y}.`);if(l.stateConstructor){if(!(J=new l.stateConstructor).hasOwnProperty("ZT"))throw new Error(`Component ${l.name} stateConstructor type does not have property __id`)}else J=Object.assign({},{ZT:z},l.state,H);if(J.ZT=z,l.multi){var b=T.hash[z];b||(b=[],T.add(z,b)),b.push(J)}else T.add(z,J);return l.KT&&l.KT(z,J),this},this.LL=function(z,u){var Y=E[u];if(!Y)throw new Error(`Unknown component: ${u}.`);return!!Y.hash[z]},this.EL=function(u,Y){if(!E[Y])throw new Error(`Unknown component: ${Y}.`);return b(u,Y),z},this.getState=function(z,u){var Y=E[u];if(!Y)throw new Error(`Unknown component: ${u}.`);return Y.hash[z]},this.NL=function(z){var u=E[z];if(!u)throw new Error(`Unknown component: ${z}.`);return g(),u.list},this.Fq=function(z){if(!E[z])throw new Error(`Unknown component: ${z}.`);var u=E[z].hash;return z=>u[z]},this.cq=function(z){if(!E[z])throw new Error(`Unknown component: ${z}.`);var u=E[z].hash;return z=>!!u[z]},this.Rl=function(Y){g();for(var H=0;H<J.length;H++){var l=J[H],T=u[l],b=E[l];T.system(Y,b.list),g()}return z},this.render=function(Y){g();for(var H=0;H<l.length;H++){var J=l[H],T=u[J],b=E[J];T.vT(Y,b.list),g()}return z},this.removeMultiComponent=function(Y,H,J){var l=u[H],b=E[H];if(!b)throw new Error(`Unknown component: ${H}.`);if(!l.multi)throw new Error("removeMultiComponent called on non-multi component");return function(z,u,Y,H){var E=Y.hash[z];if(E){var J=E[H];J&&(E[H]=null,u.cl&&u.cl(z,J),T.multiComps.push({entID:z,data:Y}),L())}}(Y,l,b,J),z}};var H=Y(12722)},12722:z=>{function u(z,u){var Y=z._map[u];if(delete z.hash[u],delete z._map[u],Y===z.list.length-1)z.list.pop();else{var H=z.list.pop();if(z.list[Y]=H,null===H||null===H[0]){var E=z.list.length;for(var J in z._map)if(z._map[J]===E)return void(z._map[J]=Y)}else{var l=H.ZT||H[0].ZT;z._map[l]=Y}}}z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(z,u){if("number"===typeof this._map[z]){var Y=this._map[z];this.hash[z]=u,this.list[Y]=u}else this._map[z]=this.list.length,this.hash[z]=u,this.list.push(u)}remove(z){var u=this._map[z];this.hash[z]=null,this.list[u]=null,this._pendingRemovals.push(z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var z=0;z<this._pendingRemovals.length;z++){var Y=this._pendingRemovals[z];null===this.hash[Y]&&u(this,Y)}this._pendingRemovals.length=0}}},12969:z=>{"use strict";z.exports=function(z,u,Y,H,E,J){var l=+u[0],T=+u[1],b=+u[2],L=+Y[0],D=+Y[1],g=+Y[2],M=Math.sqrt(L*L+D*D+g*g);if(0===M)throw new Error("Can't raycast along a zero vector");return function(z,u,Y,H,E,J,l,T,b,L){for(var D=0,g=Math.floor,M=0|g(u),q=0|g(Y),C=0|g(H),K=E>0?1:-1,h=J>0?1:-1,o=l>0?1:-1,d=Math.abs(1/E),t=Math.abs(1/J),W=Math.abs(1/l),Z=d<1/0?d*(K>0?M+1-u:u-M):1/0,s=t<1/0?t*(h>0?q+1-Y:Y-q):1/0,v=W<1/0?W*(o>0?C+1-H:H-C):1/0,i=-1;D<=T;){var X=z(M,q,C);if(X)return b&&(b[0]=u+D*E,b[1]=Y+D*J,b[2]=H+D*l),L&&(L[0]=L[1]=L[2]=0,0===i&&(L[0]=-K),1===i&&(L[1]=-h),2===i&&(L[2]=-o)),X;Z<s?Z<v?(M+=K,D=Z,Z+=d,i=0):(C+=o,D=v,v+=W,i=2):s<v?(q+=h,D=s,s+=t,i=1):(C+=o,D=v,v+=W,i=2)}return b&&(b[0]=u+D*E,b[1]=Y+D*J,b[2]=H+D*l),L&&(L[0]=L[1]=L[2]=0),0}(z,l,T,b,L/=M,D/=M,g/=M,H="undefined"===typeof H?64:+H,E,J)}},13006:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>J});var H=Y(718);function E(){this.FM=!1,this.stopPropagation=!1,this.RM=!1,this.disabled=!1}class J{constructor(z,u){this.version="0.7.0";var Y=Object.assign({},new E,u||{});this.element=z||document,this.FM=!!Y.FM,this.stopPropagation=!!Y.stopPropagation,this.RM=!!Y.RM,this.disabled=!!Y.disabled,this.filterEvents=(z,u)=>!0,this.down=new H.EventEmitter,this.up=new H.EventEmitter,this.state={},this.yL={dx:0,dy:0,sq:0,IL:0,vq:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?T(this):document.addEventListener("DOMContentLoaded",(z=>{T(this)}),{once:!0})}bind(z){for(var u=arguments.length,Y=new Array(u>1?u-1:0),H=1;H<u;H++)Y[H-1]=arguments[H];Y.forEach((u=>{var Y=this._keyBindmap[u]||[];Y.includes(z)||(Y.push(z),this._keyBindmap[u]=Y)})),this.state[z]=!!this.state[z],this.pressCount[z]=this.pressCount[z]||0,this.releaseCount[z]=this.releaseCount[z]||0}unbind(z){for(var u in this._keyBindmap){var Y=this._keyBindmap[u],H=Y.indexOf(z);H>-1&&Y.splice(H,1)}}getBindings(){var z={};for(var u in this._keyBindmap){this._keyBindmap[u].forEach((Y=>{z[Y]=z[Y]||[],z[Y].push(u)}))}return z}Rl(){l(this.yL),l(this.pressCount),l(this.releaseCount)}}function l(z){for(var u in z)z[u]=0}function T(z){window.addEventListener("keydown",C.bind(null,z,!0),!1),window.addEventListener("keyup",C.bind(null,z,!1),!1);var u={passive:!0};z.element.addEventListener("touchstart",g.bind(void 0,z),{passive:!1}),z.element.addEventListener("touchend",q.bind(void 0,z),u),z.element.addEventListener("mousedown",K.bind(null,z,!0),u),window.document.addEventListener("mouseup",K.bind(null,z,!1),u),z.element.addEventListener("touchmove",h.bind(null,z),u),z.element.addEventListener("mousemove",h.bind(null,z),u),window.PointerEvent,z.element.addEventListener("wheel",o.bind(null,z),u),z.element.addEventListener("contextmenu",d.bind(null,z),!1),window.addEventListener("blur",t.bind(null,z),!1)}var b=0,L=0,D=null;function g(z,u){u.preventDefault(),M(u)}function M(z){let u=!1;for(let Y=0;Y<z.touches.length;++Y)if(z.touches[Y].identifier===D){u=!0;break}if(!u){const u=z.changedTouches[0];b=u.clientX,L=u.clientY,D=u.identifier}}function q(z,u){for(var Y=u.changedTouches,H=0;H<Y.length;++H)Y[H].identifier===D&&(D=null)}function C(z,u,Y){W(Y.code,u,z,Y)}function K(z,u,Y){if("pointerId"in Y)if(u){if(null!==z._touches.currID)return;z._touches.currID=Y.pointerId}else{if(z._touches.currID!==Y.pointerId)return;z._touches.currID=null}return W("Mouse"+("button"in Y?Y.button+1:1),u,z,Y),!1}function h(z,u){var Y=u.movementX||u.mozMovementX||0,H=u.movementY||u.mozMovementY||0;if(u.touches&&0===(Y|H)){var E=function(z){M(z);for(let u=0;u<z.changedTouches.length;++u)if(z.changedTouches[u].identifier==D){const Y=z.changedTouches[u],H=[Y.clientX-b,Y.clientY-L];return b=Y.clientX,L=Y.clientY,H}return console.error(`Did not find touch id ${D}`),[0,0]}(u);Y=E[0],H=E[1]}z.yL.dx+=Y,z.yL.dy+=H}function o(z,u){var Y=1;switch(u.deltaMode){case 0:Y=1;break;case 1:Y=12;break;case 2:Y=z.element.clientHeight||window.innerHeight}z.yL.sq+=(u.deltaX||0)*Y,z.yL.IL+=(u.deltaY||0)*Y,z.yL.vq+=(u.deltaZ||0)*Y}function d(z,u){if(!z.RM)return u.preventDefault(),!1}function t(z){for(var u in z._keyStates)z._keyStates[u]&&(/^Mouse\d/.test(u)||W(u,!1,z,{code:u,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function W(z,u,Y,H){var E=Y._keyBindmap[z];E&&(Z(Y._keyStates[z],u)&&(Y._keyStates[z]=u,E.forEach((z=>{(!Y.filterEvents||Y.filterEvents(H,z))&&function(z,u,Y,H){var E=u?Y.pressCount:Y.releaseCount;E[z]=(E[z]||0)+1;var J=Y._bindPressCount[z]||0;(J+=u?1:-1)<0&&(J=0);Y._bindPressCount[z]=J;var l=Y.state[z];if(Z(l,J)){Y.state[z]=J>0;var T=u?Y.down:Y.up;Y.disabled||T.emit(z,H)}}(z,u,Y,H)}))),"button"in H||(Y.FM&&!H.defaultPrevented&&H.preventDefault(),Y.stopPropagation&&H.stopPropagation()))}function Z(z,u){return z?!u:u}},11928:z=>{"use strict";z.exports=function(z){for(var u=new Array(z),Y=0;Y<z;++Y)u[Y]=Y;return u}},11933:z=>{function u(z){return!!z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}z.exports=function(z){return null!=z&&(u(z)||function(z){return"function"===typeof z.readFloatLE&&"function"===typeof z.slice&&u(z.slice(0,0))}(z)||!!z._isBuffer)}},12974:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>H});class H{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ND=!1,this.BD=!1,this.PD=30,this.eD=0,this.gg=!1,this.fullscreen=!1,this.rD=function(z){},this.zg=function(){},this.lg=function(){},this.Ul=function(){},this.Eg=function(z){},this.onFullscreenChanged=function(z){},L((()=>{!function(z,u){z._nowObject=performance||Date,z._lastTick=0,z._renderAccum=0,z._rt=0,z._frameCB=T.bind(null,z),requestAnimationFrame(z._frameCB),u>0&&(z._intervalCB=l.bind(null,z),z._interval=setInterval(z._intervalCB,Math.max(u,1e3/z.PD/2)))}(this,u),function(z,u){if(!u)return;var Y=!1,H=!1;document.addEventListener("pointerlockchange",(H=>{Y=document.pointerLockElement===u,z.Eg(Y)})),document.addEventListener("fullscreenchange",(Y=>{H=document.fullscreenElement===u,z.onFullscreenChanged(H)})),Object.defineProperty(z,"gg",{get:()=>Y,set:z=>{z&&!Y?b(u):Y&&!z&&function(z){z.exitPointerLock&&z.exitPointerLock()}(document)}}),Object.defineProperty(z,"fullscreen",{get:()=>H,set:z=>{z&&!H?u.requestFullscreen():H&&!z&&document.exitFullscreen()}}),u.addEventListener("click",(E=>{z.ND&&!Y&&b(u),z.BD&&!H&&u.requestFullscreen()}));var E=()=>z.Ul();if(window.ResizeObserver){new ResizeObserver(E).observe(u)}else window.addEventListener("resize",E)}(this,z),this.lg()}))}}var E=3,J=20;function l(z){for(var u=1e3/z.PD,Y=z._nowObject.now()+J,H=0;z._nowObject.now()>=z._lastTick+u&&z._nowObject.now()<Y&&++H<=E;)z.rD(u),z._lastTick+=u;var l=5*(u+5),T=z._nowObject.now();if(T-z._lastTick>l)for(;T>=z._lastTick+u;)z._lastTick+=u}function T(z){requestAnimationFrame(z._frameCB),l(z);var u=z._nowObject.now(),Y=u-z._rt;if(z._rt=u,z.eD>0){z._renderAccum+=Y;var H=1e3/z.eD;if(z._renderAccum<H)return;z._renderAccum=Math.min(z._renderAccum-H,H)}var E=1e3/z.PD,J=(u-z._lastTick)/E;z.zg(Y,J,E)}function b(z){z.requestPointerLock&&z.requestPointerLock()}var L=z=>{if("loading"===document.readyState){var u=()=>{document.removeEventListener("readystatechange",u),z()};document.addEventListener("readystatechange",u)}else setTimeout(z,1)}},11921:(z,u,Y)=>{var H=Y(11928),E=Y(11933),J="undefined"!==typeof Float64Array;function l(z,u){return z[0]-u[0]}function T(){var z,u=this.stride,Y=new Array(u.length);for(z=0;z<Y.length;++z)Y[z]=[Math.abs(u[z]),z];Y.sort(l);var H=new Array(Y.length);for(z=0;z<H.length;++z)H[z]=Y[z][1];return H}function b(z,u){var Y=["View",u,"d",z].join("");u<0&&(Y="View_Nil"+z);var E="generic"===z;if(-1===u){var J="function "+Y+"(a){this.data=a;};var proto="+Y+".prototype;proto.dtype='"+z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Y+"(a){return new "+Y+"(a);}";return new Function(J)()}if(0===u){J="function "+Y+"(a,d) {this.data = a;this.offset = d};var proto="+Y+".prototype;proto.dtype='"+z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Y+"_copy() {return new "+Y+"(this.data,this.offset)};proto.pick=function "+Y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Y+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Y+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Y+"(a,b,c,d){return new "+Y+"(a,d)}";return new Function("TrivialArray",J)(L[z][0])}J=["'use strict'"];var l=H(u),b=l.map((function(z){return"i"+z})),D="this.offset+"+l.map((function(z){return"this.stride["+z+"]*i"+z})).join("+"),g=l.map((function(z){return"b"+z})).join(","),M=l.map((function(z){return"c"+z})).join(",");J.push("function "+Y+"(a,"+g+","+M+",d){this.data=a","this.shape=["+g+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+Y+".prototype","proto.dtype='"+z+"'","proto.dimension="+u),J.push("Object.defineProperty(proto,'size',{get:function "+Y+"_size(){return "+l.map((function(z){return"this.shape["+z+"]"})).join("*"),"}})"),1===u?J.push("proto.order=[0]"):(J.push("Object.defineProperty(proto,'order',{get:"),u<4?(J.push("function "+Y+"_order(){"),2===u?J.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&J.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):J.push("ORDER})")),J.push("proto.set=function "+Y+"_set("+b.join(",")+",v){"),E?J.push("return this.data.set("+D+",v)}"):J.push("return this.data["+D+"]=v}"),J.push("proto.get=function "+Y+"_get("+b.join(",")+"){"),E?J.push("return this.data.get("+D+")}"):J.push("return this.data["+D+"]}"),J.push("proto.index=function "+Y+"_index(",b.join(),"){return "+D+"}"),J.push("proto.hi=function "+Y+"_hi("+b.join(",")+"){return new "+Y+"(this.data,"+l.map((function(z){return["(typeof i",z,"!=='number'||i",z,"<0)?this.shape[",z,"]:i",z,"|0"].join("")})).join(",")+","+l.map((function(z){return"this.stride["+z+"]"})).join(",")+",this.offset)}");var q=l.map((function(z){return"a"+z+"=this.shape["+z+"]"})),C=l.map((function(z){return"c"+z+"=this.stride["+z+"]"}));J.push("proto.lo=function "+Y+"_lo("+b.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+C.join(","));for(var K=0;K<u;++K)J.push("if(typeof i"+K+"==='number'&&i"+K+">=0){d=i"+K+"|0;b+=c"+K+"*d;a"+K+"-=d}");J.push("return new "+Y+"(this.data,"+l.map((function(z){return"a"+z})).join(",")+","+l.map((function(z){return"c"+z})).join(",")+",b)}"),J.push("proto.step=function "+Y+"_step("+b.join(",")+"){var "+l.map((function(z){return"a"+z+"=this.shape["+z+"]"})).join(",")+","+l.map((function(z){return"b"+z+"=this.stride["+z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(K=0;K<u;++K)J.push("if(typeof i"+K+"==='number'){d=i"+K+"|0;if(d<0){c+=b"+K+"*(a"+K+"-1);a"+K+"=ceil(-a"+K+"/d)}else{a"+K+"=ceil(a"+K+"/d)}b"+K+"*=d}");J.push("return new "+Y+"(this.data,"+l.map((function(z){return"a"+z})).join(",")+","+l.map((function(z){return"b"+z})).join(",")+",c)}");var h=new Array(u),o=new Array(u);for(K=0;K<u;++K)h[K]="a[i"+K+"]",o[K]="b[i"+K+"]";J.push("proto.transpose=function "+Y+"_transpose("+b+"){"+b.map((function(z,u){return z+"=("+z+"===undefined?"+u+":"+z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Y+"(this.data,"+h.join(",")+","+o.join(",")+",this.offset)}"),J.push("proto.pick=function "+Y+"_pick("+b+"){var a=[],b=[],c=this.offset");for(K=0;K<u;++K)J.push("if(typeof i"+K+"==='number'&&i"+K+">=0){c=(c+this.stride["+K+"]*i"+K+")|0}else{a.push(this.shape["+K+"]);b.push(this.stride["+K+"])}");return J.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),J.push("return function construct_"+Y+"(data,shape,stride,offset){return new "+Y+"(data,"+l.map((function(z){return"shape["+z+"]"})).join(",")+","+l.map((function(z){return"stride["+z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",J.join("\n"))(L[z],T)}var L={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};z.exports=function(z,u,Y,H){if(void 0===z)return(0,L.array[0])([]);"number"===typeof z&&(z=[z]),void 0===u&&(u=[z.length]);var l=u.length;if(void 0===Y){Y=new Array(l);for(var T=l-1,D=1;T>=0;--T)Y[T]=D,D*=u[T]}if(void 0===H){H=0;for(T=0;T<l;++T)Y[T]<0&&(H-=(u[T]-1)*Y[T])}for(var g=function(z){if(E(z))return"buffer";if(J)switch(Object.prototype.toString.call(z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(z)?"array":"generic"}(z),M=L[g];M.length<=l+1;)M.push(b(g,M.length-1));return(0,M[l+1])(z,u,Y,H)}},12853:z=>{var u;self,u=()=>(()=>{"use strict";var z={d:(u,Y)=>{for(var H in Y)z.o(Y,H)&&!z.o(u,H)&&Object.defineProperty(u,H,{enumerable:!0,get:Y[H]})},o:(z,u)=>Object.prototype.hasOwnProperty.call(z,u)},u={};z.d(u,{default:()=>R});var Y,H=function(z,u){var Y=u.x-z.x,H=u.y-z.y;return Math.sqrt(Y*Y+H*H)},E=function(z){return z*(Math.PI/180)},J=new Map,l=function(z){J.has(z)&&clearTimeout(J.get(z)),J.set(z,setTimeout(z,100))},T=function(z,u,Y){for(var H,E=u.split(/[ ,]+/g),J=0;J<E.length;J+=1)H=E[J],z.addEventListener?z.addEventListener(H,Y,!1):z.attachEvent&&z.attachEvent(H,Y)},b=function(z,u,Y){for(var H,E=u.split(/[ ,]+/g),J=0;J<E.length;J+=1)H=E[J],z.removeEventListener?z.removeEventListener(H,Y):z.detachEvent&&z.detachEvent(H,Y)},L=function(z){return z.preventDefault(),z.type.match(/^touch/)?z.changedTouches:z},D=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},g=function(z,u){u.top||u.right||u.bottom||u.left?(z.style.top=u.top,z.style.right=u.right,z.style.bottom=u.bottom,z.style.left=u.left):(z.style.left=u.x+"px",z.style.top=u.y+"px")},M=function(z,u,Y){var H=q(z);for(var E in H)if(H.hasOwnProperty(E))if("string"==typeof u)H[E]=u+" "+Y;else{for(var J="",l=0,T=u.length;l<T;l+=1)J+=u[l]+" "+Y+", ";H[E]=J.slice(0,-2)}return H},q=function(z){var u={};return u[z]="",["webkit","Moz","o"].forEach((function(Y){u[Y+z.charAt(0).toUpperCase()+z.slice(1)]=""})),u},C=function(z,u){for(var Y in u)u.hasOwnProperty(Y)&&(z[Y]=u[Y]);return z},K=function(z,u){if(z.length)for(var Y=0,H=z.length;Y<H;Y+=1)u(z[Y]);else u(z)},h="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,o=window.matchMedia("(any-hover: none)").matches,d=!!("ontouchstart"in window),t=!!window.PointerEvent,W=!!window.MSPointerEvent,Z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},s={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function i(){}h&&!o?Y=Z:t?Y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:W?Y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:d?(Y=Z,v=s):Y=s,i.prototype.on=function(z,u){var Y,H=this,E=z.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var J=0;J<E.length;J+=1)Y=E[J],H._handlers_[Y]=H._handlers_[Y]||[],H._handlers_[Y].push(u);return H},i.prototype.off=function(z,u){var Y=this;return Y._handlers_=Y._handlers_||{},void 0===z?Y._handlers_={}:void 0===u?Y._handlers_[z]=null:Y._handlers_[z]&&Y._handlers_[z].indexOf(u)>=0&&Y._handlers_[z].splice(Y._handlers_[z].indexOf(u),1),Y},i.prototype.trigger=function(z,u){var Y,H=this,E=z.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var J=0;J<E.length;J+=1)Y=E[J],H._handlers_[Y]&&H._handlers_[Y].length&&H._handlers_[Y].forEach((function(z){z.call(H,{type:Y,target:H},u)}))},i.prototype.config=function(z){var u=this;u.options=u.defaults||{},z&&(u.options=function(z,u){var Y={};for(var H in z)z.hasOwnProperty(H)&&u.hasOwnProperty(H)?Y[H]=u[H]:z.hasOwnProperty(H)&&(Y[H]=z[H]);return Y}(u.options,z))},i.prototype.bindEvt=function(z,u){var H=this;return H._domHandlers_=H._domHandlers_||{},H._domHandlers_[u]=function(){"function"==typeof H["on"+u]?H["on"+u].apply(H,arguments):console.warn('[WARNING] : Missing "on'+u+'" handler.')},T(z,Y[u],H._domHandlers_[u]),v[u]&&T(z,v[u],H._domHandlers_[u]),H},i.prototype.unbindEvt=function(z,u){var H=this;return H._domHandlers_=H._domHandlers_||{},b(z,Y[u],H._domHandlers_[u]),v[u]&&b(z,v[u],H._domHandlers_[u]),delete H._domHandlers_[u],this};const X=i;function Q(z,u){return this.identifier=u.identifier,this.position=u.position,this.frontPosition=u.frontPosition,this.collection=z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(u),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Q.id,Q.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Q.prototype=new X,Q.constructor=Q,Q.id=0,Q.prototype.buildEl=function(z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Q.prototype.stylize=function(){if(this.options.dataOnly)return this;var z=this.options.fadeTime+"ms",u=function(){var z=q("borderRadius");for(var u in z)z.hasOwnProperty(u)&&(z[u]="50%");return z}(),Y=M("transition","opacity",z),H={};return H.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},H.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},H.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},C(H.el,Y),"circle"===this.options.shape&&C(H.back,u),C(H.front,u),this.applyStyles(H),this},Q.prototype.applyStyles=function(z){for(var u in this.ui)if(this.ui.hasOwnProperty(u))for(var Y in z[u])this.ui[u].style[Y]=z[u][Y];return this},Q.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Q.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Q.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Q.prototype.show=function(z){var u=this;return u.options.dataOnly||(clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.addToDom(),u.restCallback(),setTimeout((function(){u.ui.el.style.opacity=1}),0),u.showTimeout=setTimeout((function(){u.trigger("shown",u.instance),"function"==typeof z&&z.call(this)}),u.options.fadeTime)),u},Q.prototype.hide=function(z){var u=this;if(u.options.dataOnly)return u;if(u.ui.el.style.opacity=u.options.restOpacity,clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.removeTimeout=setTimeout((function(){var Y="dynamic"===u.options.mode?"none":"block";u.ui.el.style.display=Y,"function"==typeof z&&z.call(u),u.trigger("hidden",u.instance)}),u.options.fadeTime),u.options.restJoystick){var Y=u.options.restJoystick,H={};H.x=!0===Y||!1!==Y.x?0:u.instance.frontPosition.x,H.y=!0===Y||!1!==Y.y?0:u.instance.frontPosition.y,u.setPosition(z,H)}return u},Q.prototype.setPosition=function(z,u){var Y=this;Y.frontPosition={x:u.x,y:u.y};var H=Y.options.fadeTime+"ms",E={};E.front=M("transition",["transform"],H);var J={front:{}};J.front={transform:"translate("+Y.frontPosition.x+"px,"+Y.frontPosition.y+"px)"},Y.applyStyles(E),Y.applyStyles(J),Y.restTimeout=setTimeout((function(){"function"==typeof z&&z.call(Y),Y.restCallback()}),Y.options.fadeTime)},Q.prototype.restCallback=function(){var z=this,u={};u.front=M("transition","none",""),z.applyStyles(u),z.trigger("rested",z.instance)},Q.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Q.prototype.computeDirection=function(z){var u,Y,H,E=z.angle.radian,J=Math.PI/4,l=Math.PI/2;if(E>J&&E<3*J&&!z.lockX?u="up":E>-J&&E<=J&&!z.lockY?u="left":E>3*-J&&E<=-J&&!z.lockX?u="down":z.lockY||(u="right"),z.lockY||(Y=E>-l&&E<l?"left":"right"),z.lockX||(H=E>0?"up":"down"),z.force>this.options.threshold){var T,b={};for(T in this.direction)this.direction.hasOwnProperty(T)&&(b[T]=this.direction[T]);var L={};for(T in this.direction={x:Y,y:H,angle:u},z.direction=this.direction,b)b[T]===this.direction[T]&&(L[T]=!0);if(L.x&&L.y&&L.angle)return z;L.x&&L.y||this.trigger("plain",z),L.x||this.trigger("plain:"+Y,z),L.y||this.trigger("plain:"+H,z),L.angle||this.trigger("dir dir:"+u,z)}else this.resetDirection();return z};const V=Q;function A(z,u){var Y=this;Y.nipples=[],Y.idles=[],Y.actives=[],Y.ids=[],Y.pressureIntervals={},Y.manager=z,Y.id=A.id,A.id+=1,Y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Y.config(u),"static"!==Y.options.mode&&"semi"!==Y.options.mode||(Y.options.multitouch=!1),Y.options.multitouch||(Y.options.maxNumberOfNipples=1);var H=getComputedStyle(Y.options.zone.parentElement);return H&&"flex"===H.display&&(Y.parentIsFlex=!0),Y.updateBox(),Y.prepareNipples(),Y.wM(),Y.begin(),Y.nipples}A.prototype=new X,A.constructor=A,A.id=0,A.prototype.prepareNipples=function(){var z=this,u=z.nipples;u.on=z.on.bind(z),u.off=z.off.bind(z),u.options=z.options,u.destroy=z.destroy.bind(z),u.ids=z.ids,u.id=z.id,u.processOnMove=z.processOnMove.bind(z),u.processOnEnd=z.processOnEnd.bind(z),u.get=function(z){if(void 0===z)return u[0];for(var Y=0,H=u.length;Y<H;Y+=1)if(u[Y].identifier===z)return u[Y];return!1}},A.prototype.wM=function(){var z=this;z.bindEvt(z.options.zone,"start"),z.options.zone.style.touchAction="none",z.options.zone.style.msTouchAction="none"},A.prototype.begin=function(){var z=this,u=z.options;if("static"===u.mode){var Y=z.createNipple(u.position,z.manager.getIdentifier());Y.add(),z.idles.push(Y)}},A.prototype.createNipple=function(z,u){var Y=this,H=Y.manager.scroll,E={},J=Y.options,l=Y.parentIsFlex?H.x:H.x+Y.box.left,T=Y.parentIsFlex?H.y:H.y+Y.box.top;if(z.x&&z.y)E={x:z.x-l,y:z.y-T};else if(z.top||z.right||z.bottom||z.left){var b=document.createElement("DIV");b.style.display="hidden",b.style.top=z.top,b.style.right=z.right,b.style.bottom=z.bottom,b.style.left=z.left,b.style.position="absolute",J.zone.appendChild(b);var L=b.getBoundingClientRect();J.zone.removeChild(b),E=z,z={x:L.left+H.x,y:L.top+H.y}}var D=new V(Y,{color:J.color,size:J.size,threshold:J.threshold,fadeTime:J.fadeTime,dataOnly:J.dataOnly,restJoystick:J.restJoystick,restOpacity:J.restOpacity,mode:J.mode,identifier:u,position:z,zone:J.zone,frontPosition:{x:0,y:0},shape:J.shape});return J.dataOnly||(g(D.ui.el,E),g(D.ui.front,D.frontPosition)),Y.nipples.push(D),Y.trigger("added "+D.identifier+":added",D),Y.manager.trigger("added "+D.identifier+":added",D),Y.bindNipple(D),D},A.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},A.prototype.bindNipple=function(z){var u,Y=this,H=function(z,H){u=z.type+" "+H.id+":"+z.type,Y.trigger(u,H)};z.on("destroyed",Y.onDestroyed.bind(Y)),z.on("shown hidden rested dir plain",H),z.on("dir:up dir:right dir:down dir:left",H),z.on("plain:up plain:right plain:down plain:left",H)},A.prototype.pressureFn=function(z,u,Y){var H=this,E=0;clearInterval(H.pressureIntervals[Y]),H.pressureIntervals[Y]=setInterval(function(){var Y=z.force||z.pressure||z.webkitForce||0;Y!==E&&(u.trigger("pressure",Y),H.trigger("pressure "+u.identifier+":pressure",Y),E=Y)}.bind(H),100)},A.prototype.onstart=function(z){var u=this,Y=u.options,H=z;return z=L(z),u.updateBox(),K(z,(function(E){u.actives.length<Y.maxNumberOfNipples?u.processOnStart(E):H.type.match(/^touch/)&&(Object.keys(u.manager.ids).forEach((function(Y){if(Object.values(H.touches).findIndex((function(z){return z.identifier===Y}))<0){var E=[z[0]];E.identifier=Y,u.processOnEnd(E)}})),u.actives.length<Y.maxNumberOfNipples&&u.processOnStart(E))})),u.manager.bindDocument(),!1},A.prototype.processOnStart=function(z){var u,Y=this,E=Y.options,J=Y.manager.getIdentifier(z),l=z.force||z.pressure||z.webkitForce||0,T={x:z.pageX,y:z.pageY},b=Y.getOrCreate(J,T);b.identifier!==J&&Y.manager.removeIdentifier(b.identifier),b.identifier=J;var L=function(u){u.trigger("start",u),Y.trigger("start "+u.id+":start",u),u.show(),l>0&&Y.pressureFn(z,u,u.identifier),Y.processOnMove(z)};if((u=Y.idles.indexOf(b))>=0&&Y.idles.splice(u,1),Y.actives.push(b),Y.ids.push(b.identifier),"semi"!==E.mode)L(b);else{if(!(H(T,b.position)<=E.catchDistance))return b.destroy(),void Y.processOnStart(z);L(b)}return b},A.prototype.getOrCreate=function(z,u){var Y,H=this,E=H.options;return/(semi|static)/.test(E.mode)?(Y=H.idles[0])?(H.idles.splice(0,1),Y):"semi"===E.mode?H.createNipple(u,z):(console.warn("Coudln't find the needed nipple."),!1):Y=H.createNipple(u,z)},A.prototype.processOnMove=function(z){var u=this,Y=u.options,J=u.manager.getIdentifier(z),l=u.nipples.get(J),T=u.manager.scroll;if(function(z){return isNaN(z.buttons)?0!==z.pressure:0!==z.buttons}(z)){if(!l)return console.error("Found zombie joystick with ID "+J),void u.manager.removeIdentifier(J);if(Y.dynamicPage){var b=l.el.getBoundingClientRect();l.position={x:T.x+b.left,y:T.y+b.top}}l.identifier=J;var L=l.options.size/2,D={x:z.pageX,y:z.pageY};Y.lockX&&(D.y=l.position.y),Y.lockY&&(D.x=l.position.x);var g,M,q,C,K,h,o,d,t,W,Z=H(D,l.position),s=(g=D,q=(M=l.position).x-g.x,C=M.y-g.y,function(z){return z*(180/Math.PI)}(Math.atan2(C,q))),v=E(s),i=Z/L,X={distance:Z,position:D};if("circle"===l.options.shape?(K=Math.min(Z,L),o=l.position,d=K,W={x:0,y:0},t=E(t=s),W.x=o.x-d*Math.cos(t),W.y=o.y-d*Math.sin(t),h=W):(h=function(z,u,Y){return{x:Math.min(Math.max(z.x,u.x-Y),u.x+Y),y:Math.min(Math.max(z.y,u.y-Y),u.y+Y)}}(D,l.position,L),K=H(h,l.position)),Y.follow){if(Z>L){var Q=D.x-h.x,V=D.y-h.y;l.position.x+=Q,l.position.y+=V,l.el.style.top=l.position.y-(u.box.top+T.y)+"px",l.el.style.left=l.position.x-(u.box.left+T.x)+"px",Z=H(D,l.position)}}else D=h,Z=K;var A=D.x-l.position.x,x=D.y-l.position.y;l.frontPosition={x:A,y:x},Y.dataOnly||(l.ui.front.style.transform="translate("+A+"px,"+x+"px)");var G={identifier:l.identifier,position:D,force:i,pressure:z.force||z.pressure||z.webkitForce||0,distance:Z,angle:{radian:v,degree:s},vector:{x:A/L,y:-x/L},raw:X,instance:l,lockX:Y.lockX,lockY:Y.lockY};(G=l.computeDirection(G)).angle={radian:E(180-s),degree:180-s},l.trigger("move",G),u.trigger("move "+l.id+":move",G)}else this.processOnEnd(z)},A.prototype.processOnEnd=function(z){var u=this,Y=u.options,H=u.manager.getIdentifier(z),E=u.nipples.get(H),J=u.manager.removeIdentifier(E.identifier);E&&(Y.dataOnly||E.hide((function(){"dynamic"===Y.mode&&(E.trigger("removed",E),u.trigger("removed "+E.id+":removed",E),u.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(u.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),u.trigger("end "+E.id+":end",E),u.ids.indexOf(E.identifier)>=0&&u.ids.splice(u.ids.indexOf(E.identifier),1),u.actives.indexOf(E)>=0&&u.actives.splice(u.actives.indexOf(E),1),/(semi|static)/.test(Y.mode)?u.idles.push(E):u.nipples.indexOf(E)>=0&&u.nipples.splice(u.nipples.indexOf(E),1),u.manager.unbindDocument(),/(semi|static)/.test(Y.mode)&&(u.manager.ids[J.id]=J.identifier))},A.prototype.onDestroyed=function(z,u){var Y=this;Y.nipples.indexOf(u)>=0&&Y.nipples.splice(Y.nipples.indexOf(u),1),Y.actives.indexOf(u)>=0&&Y.actives.splice(Y.actives.indexOf(u),1),Y.idles.indexOf(u)>=0&&Y.idles.splice(Y.idles.indexOf(u),1),Y.ids.indexOf(u.identifier)>=0&&Y.ids.splice(Y.ids.indexOf(u.identifier),1),Y.manager.removeIdentifier(u.identifier),Y.manager.unbindDocument()},A.prototype.destroy=function(){var z=this;for(var u in z.unbindEvt(z.options.zone,"start"),z.nipples.forEach((function(z){z.destroy()})),z.pressureIntervals)z.pressureIntervals.hasOwnProperty(u)&&clearInterval(z.pressureIntervals[u]);z.trigger("destroyed",z.nipples),z.manager.unbindDocument(),z.off()};const x=A;function G(z){var u=this;u.ids={},u.index=0,u.collections=[],u.scroll=D(),u.config(z),u.prepareCollections();var Y=function(){var z;u.collections.forEach((function(Y){Y.forEach((function(Y){z=Y.el.getBoundingClientRect(),Y.position={x:u.scroll.x+z.left,y:u.scroll.y+z.top}}))}))};T(window,"resize",(function(){l(Y)}));var H=function(){u.scroll=D()};return T(window,"scroll",(function(){l(H)})),u.collections}G.prototype=new X,G.constructor=G,G.prototype.prepareCollections=function(){var z=this;z.collections.create=z.create.bind(z),z.collections.on=z.on.bind(z),z.collections.off=z.off.bind(z),z.collections.destroy=z.destroy.bind(z),z.collections.get=function(u){var Y;return z.collections.every((function(z){return!(Y=z.get(u))})),Y}},G.prototype.create=function(z){return this.createCollection(z)},G.prototype.createCollection=function(z){var u=this,Y=new x(u,z);return u.bindCollection(Y),u.collections.push(Y),Y},G.prototype.bindCollection=function(z){var u,Y=this,H=function(z,H){u=z.type+" "+H.id+":"+z.type,Y.trigger(u,H)};z.on("destroyed",Y.onDestroyed.bind(Y)),z.on("shown hidden rested dir plain",H),z.on("dir:up dir:right dir:down dir:left",H),z.on("plain:up plain:right plain:down plain:left",H)},G.prototype.bindDocument=function(){var z=this;z.binded||(z.bindEvt(document,"move").bindEvt(document,"end"),z.binded=!0)},G.prototype.unbindDocument=function(z){var u=this;Object.keys(u.ids).length&&!0!==z||(u.unbindEvt(document,"move").unbindEvt(document,"end"),u.binded=!1)},G.prototype.getIdentifier=function(z){var u;return z?void 0===(u=void 0===z.identifier?z.pointerId:z.identifier)&&(u=this.latest||0):u=this.index,void 0===this.ids[u]&&(this.ids[u]=this.index,this.index+=1),this.latest=u,this.ids[u]},G.prototype.removeIdentifier=function(z){var u={};for(var Y in this.ids)if(this.ids[Y]===z){u.id=Y,u.identifier=this.ids[Y],delete this.ids[Y];break}return u},G.prototype.onmove=function(z){return this.onAny("move",z),!1},G.prototype.onend=function(z){return this.onAny("end",z),!1},G.prototype.oncancel=function(z){return this.onAny("end",z),!1},G.prototype.onAny=function(z,u){var Y,H=this,E="processOn"+z.charAt(0).toUpperCase()+z.slice(1);u=L(u);var J=function(z,u,Y){Y.ids.indexOf(u)>=0&&(Y[E](z),z._found_=!0)};return K(u,(function(z){Y=H.getIdentifier(z),K(H.collections,J.bind(null,z,Y)),z._found_||H.removeIdentifier(Y)})),!1},G.prototype.destroy=function(){var z=this;z.unbindDocument(!0),z.ids={},z.index=0,z.collections.forEach((function(z){z.destroy()})),z.off()},G.prototype.onDestroyed=function(z,u){var Y=this;if(Y.collections.indexOf(u)<0)return!1;Y.collections.splice(Y.collections.indexOf(u),1)};var F=new G;const R={create:function(z){return F.create(z)},factory:F};return u.default})(),z.exports=u()},11953:(z,u,Y)=>{"use strict";const{Deflate:H,deflate:E,deflateRaw:J,gzip:l}=Y(11960),{Inflate:T,inflate:b,inflateRaw:L,ungzip:D}=Y(12020),g=Y(11995);z.exports.Deflate=H,z.exports.deflate=E,z.exports.deflateRaw=J,z.exports.gzip=l,z.exports.Inflate=T,z.exports.inflate=b,z.exports.inflateRaw=L,z.exports.ungzip=D,z.exports.constants=g},11960:(z,u,Y)=>{"use strict";const H=Y(11962),E=Y(12002),J=Y(12010),l=Y(11993),T=Y(12013),b=Object.prototype.toString,{Z_NO_FLUSH:L,Z_SYNC_FLUSH:D,Z_FULL_FLUSH:g,Z_FINISH:M,Z_OK:q,Z_STREAM_END:C,Z_DEFAULT_COMPRESSION:K,Z_DEFAULT_STRATEGY:h,Z_DEFLATED:o}=Y(11995);function d(z){this.options=E.assign({level:K,method:o,mz:16384,windowBits:15,memLevel:8,strategy:h},z||{});let u=this.options;u.raw&&u.windowBits>0?u.windowBits=-u.windowBits:u.gzip&&u.windowBits>0&&u.windowBits<16&&(u.windowBits+=16),this.err=0,this.bu="",this.ended=!1,this.chunks=[],this.strm=new T,this.strm.avail_out=0;let Y=H.deflateInit2(this.strm,u.level,u.method,u.windowBits,u.memLevel,u.strategy);if(Y!==q)throw new Error(l[Y]);if(u.header&&H.deflateSetHeader(this.strm,u.header),u.dictionary){let z;if(z="string"===typeof u.dictionary?J.string2buf(u.dictionary):"[object ArrayBuffer]"===b.call(u.dictionary)?new Uint8Array(u.dictionary):u.dictionary,Y=H.deflateSetDictionary(this.strm,z),Y!==q)throw new Error(l[Y]);this._dict_set=!0}}function t(z,u){const Y=new d(u);if(Y.push(z,!0),Y.err)throw Y.bu||l[Y.err];return Y.result}d.prototype.push=function(z,u){const Y=this.strm,E=this.options.mz;let l,T;if(this.ended)return!1;for(T=u===~~u?u:!0===u?M:L,"string"===typeof z?Y.input=J.string2buf(z):"[object ArrayBuffer]"===b.call(z)?Y.input=new Uint8Array(z):Y.input=z,Y.next_in=0,Y.avail_in=Y.input.length;;)if(0===Y.avail_out&&(Y.output=new Uint8Array(E),Y.next_out=0,Y.avail_out=E),(T===D||T===g)&&Y.avail_out<=6)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else{if(l=H.deflate(Y,T),l===C)return Y.next_out>0&&this.onData(Y.output.subarray(0,Y.next_out)),l=H.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===q;if(0!==Y.avail_out){if(T>0&&Y.next_out>0)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else if(0===Y.avail_in)break}else this.onData(Y.output)}return!0},d.prototype.onData=function(z){this.chunks.push(z)},d.prototype.onEnd=function(z){z===q&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.bu=this.strm.bu},z.exports.Deflate=d,z.exports.deflate=t,z.exports.deflateRaw=function(z,u){return(u=u||{}).raw=!0,t(z,u)},z.exports.gzip=function(z,u){return(u=u||{}).gzip=!0,t(z,u)},z.exports.constants=Y(11995)},12020:(z,u,Y)=>{"use strict";const H=Y(12028),E=Y(12002),J=Y(12010),l=Y(11993),T=Y(12013),b=Y(12037),L=Object.prototype.toString,{Z_NO_FLUSH:D,Z_FINISH:g,Z_OK:M,Z_STREAM_END:q,Z_NEED_DICT:C,Z_STREAM_ERROR:K,Z_DATA_ERROR:h,Z_MEM_ERROR:o}=Y(11995);function d(z){this.options=E.assign({mz:65536,windowBits:15,to:""},z||{});const u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,0===u.windowBits&&(u.windowBits=-15)),!(u.windowBits>=0&&u.windowBits<16)||z&&z.windowBits||(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&0===(15&u.windowBits)&&(u.windowBits|=15),this.err=0,this.bu="",this.ended=!1,this.chunks=[],this.strm=new T,this.strm.avail_out=0;let Y=H.inflateInit2(this.strm,u.windowBits);if(Y!==M)throw new Error(l[Y]);if(this.header=new b,H.inflateGetHeader(this.strm,this.header),u.dictionary&&("string"===typeof u.dictionary?u.dictionary=J.string2buf(u.dictionary):"[object ArrayBuffer]"===L.call(u.dictionary)&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(Y=H.inflateSetDictionary(this.strm,u.dictionary),Y!==M)))throw new Error(l[Y])}function t(z,u){const Y=new d(u);if(Y.push(z),Y.err)throw Y.bu||l[Y.err];return Y.result}d.prototype.push=function(z,u){const Y=this.strm,E=this.options.mz,l=this.options.dictionary;let T,b,d;if(this.ended)return!1;for(b=u===~~u?u:!0===u?g:D,"[object ArrayBuffer]"===L.call(z)?Y.input=new Uint8Array(z):Y.input=z,Y.next_in=0,Y.avail_in=Y.input.length;;){for(0===Y.avail_out&&(Y.output=new Uint8Array(E),Y.next_out=0,Y.avail_out=E),T=H.inflate(Y,b),T===C&&l&&(T=H.inflateSetDictionary(Y,l),T===M?T=H.inflate(Y,b):T===h&&(T=C));Y.avail_in>0&&T===q&&Y.state.wrap>0&&0!==z[Y.next_in];)H.inflateReset(Y),T=H.inflate(Y,b);switch(T){case K:case h:case C:case o:return this.onEnd(T),this.ended=!0,!1}if(d=Y.avail_out,Y.next_out&&(0===Y.avail_out||T===q))if("string"===this.options.to){let z=J.utf8border(Y.output,Y.next_out),u=Y.next_out-z,H=J.buf2string(Y.output,z);Y.next_out=u,Y.avail_out=E-u,u&&Y.output.set(Y.output.subarray(z,z+u),0),this.onData(H)}else this.onData(Y.output.length===Y.next_out?Y.output:Y.output.subarray(0,Y.next_out));if(T!==M||0!==d){if(T===q)return T=H.inflateEnd(this.strm),this.onEnd(T),this.ended=!0,!0;if(0===Y.avail_in)break}}return!0},d.prototype.onData=function(z){this.chunks.push(z)},d.prototype.onEnd=function(z){z===M&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.bu=this.strm.bu},z.exports.Inflate=d,z.exports.inflate=t,z.exports.inflateRaw=function(z,u){return(u=u||{}).raw=!0,t(z,u)},z.exports.ungzip=t,z.exports.constants=Y(11995)},12002:z=>{"use strict";const u=(z,u)=>Object.prototype.hasOwnProperty.call(z,u);z.exports.assign=function(z){const Y=Array.prototype.slice.call(arguments,1);for(;Y.length;){const H=Y.shift();if(H){if("object"!==typeof H)throw new TypeError(H+"must be non-object");for(const Y in H)u(H,Y)&&(z[Y]=H[Y])}}return z},z.exports.flattenChunks=z=>{let u=0;for(let H=0,E=z.length;H<E;H++)u+=z[H].length;const Y=new Uint8Array(u);for(let H=0,E=0,J=z.length;H<J;H++){let u=z[H];Y.set(u,E),E+=u.length}return Y}},12010:z=>{"use strict";let u=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(H){u=!1}const Y=new Uint8Array(256);for(let E=0;E<256;E++)Y[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;Y[254]=Y[254]=1,z.exports.string2buf=z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(z);let u,Y,H,E,J,l=z.length,T=0;for(E=0;E<l;E++)Y=z.charCodeAt(E),55296===(64512&Y)&&E+1<l&&(H=z.charCodeAt(E+1),56320===(64512&H)&&(Y=65536+(Y-55296<<10)+(H-56320),E++)),T+=Y<128?1:Y<2048?2:Y<65536?3:4;for(u=new Uint8Array(T),J=0,E=0;J<T;E++)Y=z.charCodeAt(E),55296===(64512&Y)&&E+1<l&&(H=z.charCodeAt(E+1),56320===(64512&H)&&(Y=65536+(Y-55296<<10)+(H-56320),E++)),Y<128?u[J++]=Y:Y<2048?(u[J++]=192|Y>>>6,u[J++]=128|63&Y):Y<65536?(u[J++]=224|Y>>>12,u[J++]=128|Y>>>6&63,u[J++]=128|63&Y):(u[J++]=240|Y>>>18,u[J++]=128|Y>>>12&63,u[J++]=128|Y>>>6&63,u[J++]=128|63&Y);return u};z.exports.buf2string=(z,H)=>{const E=H||z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(z.subarray(0,H));let J,l;const T=new Array(2*E);for(l=0,J=0;J<E;){let u=z[J++];if(u<128){T[l++]=u;continue}let H=Y[u];if(H>4)T[l++]=65533,J+=H-1;else{for(u&=2===H?31:3===H?15:7;H>1&&J<E;)u=u<<6|63&z[J++],H--;H>1?T[l++]=65533:u<65536?T[l++]=u:(u-=65536,T[l++]=55296|u>>10&1023,T[l++]=56320|1023&u)}}return((z,Y)=>{if(Y<65534&&z.subarray&&u)return String.fromCharCode.apply(null,z.length===Y?z:z.subarray(0,Y));let H="";for(let u=0;u<Y;u++)H+=String.fromCharCode(z[u]);return H})(T,l)},z.exports.utf8border=(z,u)=>{(u=u||z.length)>z.length&&(u=z.length);let H=u-1;for(;H>=0&&128===(192&z[H]);)H--;return H<0||0===H?u:H+Y[z[H]]>u?H:u}},11978:z=>{"use strict";z.exports=(z,u,Y,H)=>{let E=65535&z,J=z>>>16&65535,l=0;for(;0!==Y;){l=Y>2e3?2e3:Y,Y-=l;do{E=E+u[H++]|0,J=J+E|0}while(--l);E%=65521,J%=65521}return E|J<<16}},11995:z=>{"use strict";z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11984:z=>{"use strict";const u=new Uint32Array((()=>{let z,u=[];for(var Y=0;Y<256;Y++){z=Y;for(var H=0;H<8;H++)z=1&z?3988292384^z>>>1:z>>>1;u[Y]=z}return u})());z.exports=(z,Y,H,E)=>{const J=u,l=E+H;z^=-1;for(let u=E;u<l;u++)z=z>>>8^J[255&(z^Y[u])];return~z}},11962:(z,u,Y)=>{"use strict";const{_tr_init:H,_tr_stored_block:E,_tr_flush_block:J,_tr_tally:l,_tr_align:T}=Y(11969),b=Y(11978),L=Y(11984),D=Y(11993),{Z_NO_FLUSH:g,Z_PARTIAL_FLUSH:M,Z_FULL_FLUSH:q,Z_FINISH:C,Z_BLOCK:K,Z_OK:h,Z_STREAM_END:o,Z_STREAM_ERROR:d,Z_DATA_ERROR:t,Z_BUF_ERROR:W,Z_DEFAULT_COMPRESSION:Z,Z_FILTERED:s,Z_HUFFMAN_ONLY:v,Z_RLE:i,Z_FIXED:X,Z_DEFAULT_STRATEGY:Q,Z_UNKNOWN:V,Z_DEFLATED:A}=Y(11995),x=258,G=262,F=103,R=113,w=666,c=(z,u)=>(z.bu=D[u],u),U=z=>(z<<1)-(z>4?9:0),O=z=>{let u=z.length;for(;--u>=0;)z[u]=0};let n=(z,u,Y)=>(u<<z.hash_shift^Y)&z.hash_mask;const m=z=>{const u=z.state;let Y=u.pending;Y>z.avail_out&&(Y=z.avail_out),0!==Y&&(z.output.set(u.pending_buf.subarray(u.pending_out,u.pending_out+Y),z.next_out),z.next_out+=Y,u.pending_out+=Y,z.total_out+=Y,z.avail_out-=Y,u.pending-=Y,0===u.pending&&(u.pending_out=0))},p=(z,u)=>{J(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,u),z.block_start=z.strstart,m(z.strm)},S=(z,u)=>{z.pending_buf[z.pending++]=u},I=(z,u)=>{z.pending_buf[z.pending++]=u>>>8&255,z.pending_buf[z.pending++]=255&u},y=(z,u,Y,H)=>{let E=z.avail_in;return E>H&&(E=H),0===E?0:(z.avail_in-=E,u.set(z.input.subarray(z.next_in,z.next_in+E),Y),1===z.state.wrap?z.adler=b(z.adler,u,E,Y):2===z.state.wrap&&(z.adler=L(z.adler,u,E,Y)),z.next_in+=E,z.total_in+=E,E)},a=(z,u)=>{let Y,H,E=z.max_chain_length,J=z.strstart,l=z.prev_length,T=z.nice_match;const b=z.strstart>z.w_size-G?z.strstart-(z.w_size-G):0,L=z.window,D=z.w_mask,g=z.prev,M=z.strstart+x;let q=L[J+l-1],C=L[J+l];z.prev_length>=z.good_match&&(E>>=2),T>z.lookahead&&(T=z.lookahead);do{if(Y=u,L[Y+l]===C&&L[Y+l-1]===q&&L[Y]===L[J]&&L[++Y]===L[J+1]){J+=2,Y++;do{}while(L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&L[++J]===L[++Y]&&J<M);if(H=x-(M-J),J=M-x,H>l){if(z.match_start=u,l=H,H>=T)break;q=L[J+l-1],C=L[J+l]}}}while((u=g[u&D])>b&&0!==--E);return l<=z.lookahead?l:z.lookahead},j=z=>{const u=z.w_size;let Y,H,E,J,l;do{if(J=z.window_size-z.lookahead-z.strstart,z.strstart>=u+(u-G)){z.window.set(z.window.subarray(u,u+u),0),z.match_start-=u,z.strstart-=u,z.block_start-=u,H=z.hash_size,Y=H;do{E=z.head[--Y],z.head[Y]=E>=u?E-u:0}while(--H);H=u,Y=H;do{E=z.prev[--Y],z.prev[Y]=E>=u?E-u:0}while(--H);J+=u}if(0===z.strm.avail_in)break;if(H=y(z.strm,z.window,z.strstart+z.lookahead,J),z.lookahead+=H,z.lookahead+z.insert>=3)for(l=z.strstart-z.insert,z.ins_h=z.window[l],z.ins_h=n(z,z.ins_h,z.window[l+1]);z.insert&&(z.ins_h=n(z,z.ins_h,z.window[l+3-1]),z.prev[l&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=l,l++,z.insert--,!(z.lookahead+z.insert<3)););}while(z.lookahead<G&&0!==z.strm.avail_in)},k=(z,u)=>{let Y,H;for(;;){if(z.lookahead<G){if(j(z),z.lookahead<G&&u===g)return 1;if(0===z.lookahead)break}if(Y=0,z.lookahead>=3&&(z.ins_h=n(z,z.ins_h,z.window[z.strstart+3-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),0!==Y&&z.strstart-Y<=z.w_size-G&&(z.match_length=a(z,Y)),z.match_length>=3)if(H=l(z,z.strstart-z.match_start,z.match_length-3),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=3){z.match_length--;do{z.strstart++,z.ins_h=n(z,z.ins_h,z.window[z.strstart+3-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart}while(0!==--z.match_length);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=n(z,z.ins_h,z.window[z.strstart+1]);else H=l(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(H&&(p(z,!1),0===z.strm.avail_out))return 1}return z.insert=z.strstart<2?z.strstart:2,u===C?(p(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(p(z,!1),0===z.strm.avail_out)?1:2},P=(z,u)=>{let Y,H,E;for(;;){if(z.lookahead<G){if(j(z),z.lookahead<G&&u===g)return 1;if(0===z.lookahead)break}if(Y=0,z.lookahead>=3&&(z.ins_h=n(z,z.ins_h,z.window[z.strstart+3-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=2,0!==Y&&z.prev_length<z.max_lazy_match&&z.strstart-Y<=z.w_size-G&&(z.match_length=a(z,Y),z.match_length<=5&&(z.strategy===s||3===z.match_length&&z.strstart-z.match_start>4096)&&(z.match_length=2)),z.prev_length>=3&&z.match_length<=z.prev_length){E=z.strstart+z.lookahead-3,H=l(z,z.strstart-1-z.prev_match,z.prev_length-3),z.lookahead-=z.prev_length-1,z.prev_length-=2;do{++z.strstart<=E&&(z.ins_h=n(z,z.ins_h,z.window[z.strstart+3-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart)}while(0!==--z.prev_length);if(z.match_available=0,z.match_length=2,z.strstart++,H&&(p(z,!1),0===z.strm.avail_out))return 1}else if(z.match_available){if(H=l(z,0,z.window[z.strstart-1]),H&&p(z,!1),z.strstart++,z.lookahead--,0===z.strm.avail_out)return 1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(H=l(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<2?z.strstart:2,u===C?(p(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(p(z,!1),0===z.strm.avail_out)?1:2};function e(z,u,Y,H,E){this.good_length=z,this.max_lazy=u,this.nice_length=Y,this.max_chain=H,this.func=E}const N=[new e(0,0,0,0,((z,u)=>{let Y=65535;for(Y>z.pending_buf_size-5&&(Y=z.pending_buf_size-5);;){if(z.lookahead<=1){if(j(z),0===z.lookahead&&u===g)return 1;if(0===z.lookahead)break}z.strstart+=z.lookahead,z.lookahead=0;const H=z.block_start+Y;if((0===z.strstart||z.strstart>=H)&&(z.lookahead=z.strstart-H,z.strstart=H,p(z,!1),0===z.strm.avail_out))return 1;if(z.strstart-z.block_start>=z.w_size-G&&(p(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===C?(p(z,!0),0===z.strm.avail_out?3:4):(z.strstart>z.block_start&&(p(z,!1),z.strm.avail_out),1)})),new e(4,4,8,4,k),new e(4,5,16,8,k),new e(4,6,32,32,k),new e(4,4,16,16,P),new e(8,16,32,32,P),new e(8,16,128,128,P),new e(8,32,128,256,P),new e(32,128,258,1024,P),new e(32,258,258,4096,P)];function B(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f=z=>{if(!z||!z.state)return c(z,d);z.total_in=z.total_out=0,z.data_type=V;const u=z.state;return u.pending=0,u.pending_out=0,u.wrap<0&&(u.wrap=-u.wrap),u.status=u.wrap?42:R,z.adler=2===u.wrap?0:1,u.last_flush=g,H(u),h},r=z=>{const u=f(z);var Y;return u===h&&((Y=z.state).window_size=2*Y.w_size,O(Y.head),Y.max_lazy_match=N[Y.level].max_lazy,Y.good_match=N[Y.level].good_length,Y.nice_match=N[Y.level].nice_length,Y.max_chain_length=N[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=2,Y.match_available=0,Y.ins_h=0),u},zz=(z,u,Y,H,E,J)=>{if(!z)return d;let l=1;if(u===Z&&(u=6),H<0?(l=0,H=-H):H>15&&(l=2,H-=16),E<1||E>9||Y!==A||H<8||H>15||u<0||u>9||J<0||J>X)return c(z,d);8===H&&(H=9);const T=new B;return z.state=T,T.strm=z,T.wrap=l,T.gzhead=null,T.w_bits=H,T.w_size=1<<T.w_bits,T.w_mask=T.w_size-1,T.hash_bits=E+7,T.hash_size=1<<T.hash_bits,T.hash_mask=T.hash_size-1,T.hash_shift=~~((T.hash_bits+3-1)/3),T.window=new Uint8Array(2*T.w_size),T.head=new Uint16Array(T.hash_size),T.prev=new Uint16Array(T.w_size),T.lit_bufsize=1<<E+6,T.pending_buf_size=4*T.lit_bufsize,T.pending_buf=new Uint8Array(T.pending_buf_size),T.d_buf=1*T.lit_bufsize,T.l_buf=3*T.lit_bufsize,T.level=u,T.strategy=J,T.method=Y,r(z)};z.exports.deflateInit=(z,u)=>zz(z,u,A,15,8,Q),z.exports.deflateInit2=zz,z.exports.deflateReset=r,z.exports.deflateResetKeep=f,z.exports.deflateSetHeader=(z,u)=>z&&z.state?2!==z.state.wrap?d:(z.state.gzhead=u,h):d,z.exports.deflate=(z,u)=>{let Y,H;if(!z||!z.state||u>K||u<0)return z?c(z,d):d;const J=z.state;if(!z.output||!z.input&&0!==z.avail_in||J.status===w&&u!==C)return c(z,0===z.avail_out?W:d);J.strm=z;const b=J.last_flush;if(J.last_flush=u,42===J.status)if(2===J.wrap)z.adler=0,S(J,31),S(J,139),S(J,8),J.gzhead?(S(J,(J.gzhead.text?1:0)+(J.gzhead.hcrc?2:0)+(J.gzhead.extra?4:0)+(J.gzhead.name?8:0)+(J.gzhead.comment?16:0)),S(J,255&J.gzhead.time),S(J,J.gzhead.time>>8&255),S(J,J.gzhead.time>>16&255),S(J,J.gzhead.time>>24&255),S(J,9===J.level?2:J.strategy>=v||J.level<2?4:0),S(J,255&J.gzhead.os),J.gzhead.extra&&J.gzhead.extra.length&&(S(J,255&J.gzhead.extra.length),S(J,J.gzhead.extra.length>>8&255)),J.gzhead.hcrc&&(z.adler=L(z.adler,J.pending_buf,J.pending,0)),J.gzindex=0,J.status=69):(S(J,0),S(J,0),S(J,0),S(J,0),S(J,0),S(J,9===J.level?2:J.strategy>=v||J.level<2?4:0),S(J,3),J.status=R);else{let u=A+(J.w_bits-8<<4)<<8,Y=-1;Y=J.strategy>=v||J.level<2?0:J.level<6?1:6===J.level?2:3,u|=Y<<6,0!==J.strstart&&(u|=32),u+=31-u%31,J.status=R,I(J,u),0!==J.strstart&&(I(J,z.adler>>>16),I(J,65535&z.adler)),z.adler=1}if(69===J.status)if(J.gzhead.extra){for(Y=J.pending;J.gzindex<(65535&J.gzhead.extra.length)&&(J.pending!==J.pending_buf_size||(J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),m(z),Y=J.pending,J.pending!==J.pending_buf_size));)S(J,255&J.gzhead.extra[J.gzindex]),J.gzindex++;J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),J.gzindex===J.gzhead.extra.length&&(J.gzindex=0,J.status=73)}else J.status=73;if(73===J.status)if(J.gzhead.name){Y=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),m(z),Y=J.pending,J.pending===J.pending_buf_size)){H=1;break}H=J.gzindex<J.gzhead.name.length?255&J.gzhead.name.charCodeAt(J.gzindex++):0,S(J,H)}while(0!==H);J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),0===H&&(J.gzindex=0,J.status=91)}else J.status=91;if(91===J.status)if(J.gzhead.comment){Y=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),m(z),Y=J.pending,J.pending===J.pending_buf_size)){H=1;break}H=J.gzindex<J.gzhead.comment.length?255&J.gzhead.comment.charCodeAt(J.gzindex++):0,S(J,H)}while(0!==H);J.gzhead.hcrc&&J.pending>Y&&(z.adler=L(z.adler,J.pending_buf,J.pending-Y,Y)),0===H&&(J.status=F)}else J.status=F;if(J.status===F&&(J.gzhead.hcrc?(J.pending+2>J.pending_buf_size&&m(z),J.pending+2<=J.pending_buf_size&&(S(J,255&z.adler),S(J,z.adler>>8&255),z.adler=0,J.status=R)):J.status=R),0!==J.pending){if(m(z),0===z.avail_out)return J.last_flush=-1,h}else if(0===z.avail_in&&U(u)<=U(b)&&u!==C)return c(z,W);if(J.status===w&&0!==z.avail_in)return c(z,W);if(0!==z.avail_in||0!==J.lookahead||u!==g&&J.status!==w){let Y=J.strategy===v?((z,u)=>{let Y;for(;;){if(0===z.lookahead&&(j(z),0===z.lookahead)){if(u===g)return 1;break}if(z.match_length=0,Y=l(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,Y&&(p(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===C?(p(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(p(z,!1),0===z.strm.avail_out)?1:2})(J,u):J.strategy===i?((z,u)=>{let Y,H,E,J;const T=z.window;for(;;){if(z.lookahead<=x){if(j(z),z.lookahead<=x&&u===g)return 1;if(0===z.lookahead)break}if(z.match_length=0,z.lookahead>=3&&z.strstart>0&&(E=z.strstart-1,H=T[E],H===T[++E]&&H===T[++E]&&H===T[++E])){J=z.strstart+x;do{}while(H===T[++E]&&H===T[++E]&&H===T[++E]&&H===T[++E]&&H===T[++E]&&H===T[++E]&&H===T[++E]&&H===T[++E]&&E<J);z.match_length=x-(J-E),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=3?(Y=l(z,1,z.match_length-3),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(Y=l(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),Y&&(p(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,u===C?(p(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(p(z,!1),0===z.strm.avail_out)?1:2})(J,u):N[J.level].func(J,u);if(3!==Y&&4!==Y||(J.status=w),1===Y||3===Y)return 0===z.avail_out&&(J.last_flush=-1),h;if(2===Y&&(u===M?T(J):u!==K&&(E(J,0,0,!1),u===q&&(O(J.head),0===J.lookahead&&(J.strstart=0,J.block_start=0,J.insert=0))),m(z),0===z.avail_out))return J.last_flush=-1,h}return u!==C?h:J.wrap<=0?o:(2===J.wrap?(S(J,255&z.adler),S(J,z.adler>>8&255),S(J,z.adler>>16&255),S(J,z.adler>>24&255),S(J,255&z.total_in),S(J,z.total_in>>8&255),S(J,z.total_in>>16&255),S(J,z.total_in>>24&255)):(I(J,z.adler>>>16),I(J,65535&z.adler)),m(z),J.wrap>0&&(J.wrap=-J.wrap),0!==J.pending?h:o)},z.exports.deflateEnd=z=>{if(!z||!z.state)return d;const u=z.state.status;return 42!==u&&69!==u&&73!==u&&91!==u&&u!==F&&u!==R&&u!==w?c(z,d):(z.state=null,u===R?c(z,t):h)},z.exports.deflateSetDictionary=(z,u)=>{let Y=u.length;if(!z||!z.state)return d;const H=z.state,E=H.wrap;if(2===E||1===E&&42!==H.status||H.lookahead)return d;if(1===E&&(z.adler=b(z.adler,u,Y,0)),H.wrap=0,Y>=H.w_size){0===E&&(O(H.head),H.strstart=0,H.block_start=0,H.insert=0);let z=new Uint8Array(H.w_size);z.set(u.subarray(Y-H.w_size,Y),0),u=z,Y=H.w_size}const J=z.avail_in,l=z.next_in,T=z.input;for(z.avail_in=Y,z.next_in=0,z.input=u,j(H);H.lookahead>=3;){let z=H.strstart,u=H.lookahead-2;do{H.ins_h=n(H,H.ins_h,H.window[z+3-1]),H.prev[z&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=z,z++}while(--u);H.strstart=z,H.lookahead=2,j(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=2,H.match_available=0,z.next_in=l,z.input=T,z.avail_in=J,H.wrap=E,h},z.exports.deflateInfo="pako deflate (from Nodeca project)"},12037:z=>{"use strict";z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12030:z=>{"use strict";z.exports=function(z,u){let Y,H,E,J,l,T,b,L,D,g,M,q,C,K,h,o,d,t,W,Z,s,v,i,X;const Q=z.state;Y=z.next_in,i=z.input,H=Y+(z.avail_in-5),E=z.next_out,X=z.output,J=E-(u-z.avail_out),l=E+(z.avail_out-257),T=Q.dmax,b=Q.wsize,L=Q.whave,D=Q.wnext,g=Q.window,M=Q.hold,q=Q.bits,C=Q.lencode,K=Q.distcode,h=(1<<Q.lenbits)-1,o=(1<<Q.distbits)-1;z:do{q<15&&(M+=i[Y++]<<q,q+=8,M+=i[Y++]<<q,q+=8),d=C[M&h];u:for(;;){if(t=d>>>24,M>>>=t,q-=t,t=d>>>16&255,0===t)X[E++]=65535&d;else{if(!(16&t)){if(0===(64&t)){d=C[(65535&d)+(M&(1<<t)-1)];continue u}if(32&t){Q.mode=12;break z}z.bu="invalid literal/length code",Q.mode=30;break z}W=65535&d,t&=15,t&&(q<t&&(M+=i[Y++]<<q,q+=8),W+=M&(1<<t)-1,M>>>=t,q-=t),q<15&&(M+=i[Y++]<<q,q+=8,M+=i[Y++]<<q,q+=8),d=K[M&o];Y:for(;;){if(t=d>>>24,M>>>=t,q-=t,t=d>>>16&255,!(16&t)){if(0===(64&t)){d=K[(65535&d)+(M&(1<<t)-1)];continue Y}z.bu="invalid distance code",Q.mode=30;break z}if(Z=65535&d,t&=15,q<t&&(M+=i[Y++]<<q,q+=8,q<t&&(M+=i[Y++]<<q,q+=8)),Z+=M&(1<<t)-1,Z>T){z.bu="invalid distance too far back",Q.mode=30;break z}if(M>>>=t,q-=t,t=E-J,Z>t){if(t=Z-t,t>L&&Q.sane){z.bu="invalid distance too far back",Q.mode=30;break z}if(s=0,v=g,0===D){if(s+=b-t,t<W){W-=t;do{X[E++]=g[s++]}while(--t);s=E-Z,v=X}}else if(D<t){if(s+=b+D-t,t-=D,t<W){W-=t;do{X[E++]=g[s++]}while(--t);if(s=0,D<W){t=D,W-=t;do{X[E++]=g[s++]}while(--t);s=E-Z,v=X}}}else if(s+=D-t,t<W){W-=t;do{X[E++]=g[s++]}while(--t);s=E-Z,v=X}for(;W>2;)X[E++]=v[s++],X[E++]=v[s++],X[E++]=v[s++],W-=3;W&&(X[E++]=v[s++],W>1&&(X[E++]=v[s++]))}else{s=E-Z;do{X[E++]=X[s++],X[E++]=X[s++],X[E++]=X[s++],W-=3}while(W>2);W&&(X[E++]=X[s++],W>1&&(X[E++]=X[s++]))}break}}break}}while(Y<H&&E<l);W=q>>3,Y-=W,q-=W<<3,M&=(1<<q)-1,z.next_in=Y,z.next_out=E,z.avail_in=Y<H?H-Y+5:5-(Y-H),z.avail_out=E<l?l-E+257:257-(E-l),Q.hold=M,Q.bits=q}},12028:(z,u,Y)=>{"use strict";const H=Y(11978),E=Y(11984),J=Y(12030),l=Y(12034),{Z_FINISH:T,Z_BLOCK:b,Z_TREES:L,Z_OK:D,Z_STREAM_END:g,Z_NEED_DICT:M,Z_STREAM_ERROR:q,Z_DATA_ERROR:C,Z_MEM_ERROR:K,Z_BUF_ERROR:h,Z_DEFLATED:o}=Y(11995),d=12,t=30,W=z=>(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24);function Z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const s=z=>{if(!z||!z.state)return q;const u=z.state;return z.total_in=z.total_out=u.total=0,z.bu="",u.wrap&&(z.adler=1&u.wrap),u.mode=1,u.last=0,u.havedict=0,u.dmax=32768,u.head=null,u.hold=0,u.bits=0,u.lencode=u.lendyn=new Int32Array(852),u.distcode=u.distdyn=new Int32Array(592),u.sane=1,u.back=-1,D},v=z=>{if(!z||!z.state)return q;const u=z.state;return u.wsize=0,u.whave=0,u.wnext=0,s(z)},i=(z,u)=>{let Y;if(!z||!z.state)return q;const H=z.state;return u<0?(Y=0,u=-u):(Y=1+(u>>4),u<48&&(u&=15)),u&&(u<8||u>15)?q:(null!==H.window&&H.wbits!==u&&(H.window=null),H.wrap=Y,H.wbits=u,v(z))},X=(z,u)=>{if(!z)return q;const Y=new Z;z.state=Y,Y.window=null;const H=i(z,u);return H!==D&&(z.state=null),H};let Q,V,A=!0;const x=z=>{if(A){Q=new Int32Array(512),V=new Int32Array(32);let u=0;for(;u<144;)z.lens[u++]=8;for(;u<256;)z.lens[u++]=9;for(;u<280;)z.lens[u++]=7;for(;u<288;)z.lens[u++]=8;for(l(1,z.lens,0,288,Q,0,z.work,{bits:9}),u=0;u<32;)z.lens[u++]=5;l(2,z.lens,0,32,V,0,z.work,{bits:5}),A=!1}z.lencode=Q,z.lenbits=9,z.distcode=V,z.distbits=5},G=(z,u,Y,H)=>{let E;const J=z.state;return null===J.window&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new Uint8Array(J.wsize)),H>=J.wsize?(J.window.set(u.subarray(Y-J.wsize,Y),0),J.wnext=0,J.whave=J.wsize):(E=J.wsize-J.wnext,E>H&&(E=H),J.window.set(u.subarray(Y-H,Y-H+E),J.wnext),(H-=E)?(J.window.set(u.subarray(Y-H,Y),0),J.wnext=H,J.whave=J.wsize):(J.wnext+=E,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=E))),0};z.exports.inflateReset=v,z.exports.inflateReset2=i,z.exports.inflateResetKeep=s,z.exports.inflateInit=z=>X(z,15),z.exports.inflateInit2=X,z.exports.inflate=(z,u)=>{let Y,Z,s,v,i,X,Q,V,A,F,R,w,c,U,O,n,m,p,S,I,y,a,j=0;const k=new Uint8Array(4);let P,e;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!z||!z.state||!z.output||!z.input&&0!==z.avail_in)return q;Y=z.state,Y.mode===d&&(Y.mode=13),i=z.next_out,s=z.output,Q=z.avail_out,v=z.next_in,Z=z.input,X=z.avail_in,V=Y.hold,A=Y.bits,F=X,R=Q,a=D;z:for(;;)switch(Y.mode){case 1:if(0===Y.wrap){Y.mode=13;break}for(;A<16;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(2&Y.wrap&&35615===V){Y.check=0,k[0]=255&V,k[1]=V>>>8&255,Y.check=E(Y.check,k,2,0),V=0,A=0,Y.mode=2;break}if(Y.flags=0,Y.head&&(Y.head.done=!1),!(1&Y.wrap)||(((255&V)<<8)+(V>>8))%31){z.bu="incorrect header check",Y.mode=t;break}if((15&V)!==o){z.bu="unknown compression method",Y.mode=t;break}if(V>>>=4,A-=4,y=8+(15&V),0===Y.wbits)Y.wbits=y;else if(y>Y.wbits){z.bu="invalid window size",Y.mode=t;break}Y.dmax=1<<Y.wbits,z.adler=Y.check=1,Y.mode=512&V?10:d,V=0,A=0;break;case 2:for(;A<16;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(Y.flags=V,(255&Y.flags)!==o){z.bu="unknown compression method",Y.mode=t;break}if(57344&Y.flags){z.bu="unknown header flags set",Y.mode=t;break}Y.head&&(Y.head.text=V>>8&1),512&Y.flags&&(k[0]=255&V,k[1]=V>>>8&255,Y.check=E(Y.check,k,2,0)),V=0,A=0,Y.mode=3;case 3:for(;A<32;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.head&&(Y.head.time=V),512&Y.flags&&(k[0]=255&V,k[1]=V>>>8&255,k[2]=V>>>16&255,k[3]=V>>>24&255,Y.check=E(Y.check,k,4,0)),V=0,A=0,Y.mode=4;case 4:for(;A<16;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.head&&(Y.head.xflags=255&V,Y.head.os=V>>8),512&Y.flags&&(k[0]=255&V,k[1]=V>>>8&255,Y.check=E(Y.check,k,2,0)),V=0,A=0,Y.mode=5;case 5:if(1024&Y.flags){for(;A<16;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.length=V,Y.head&&(Y.head.extra_len=V),512&Y.flags&&(k[0]=255&V,k[1]=V>>>8&255,Y.check=E(Y.check,k,2,0)),V=0,A=0}else Y.head&&(Y.head.extra=null);Y.mode=6;case 6:if(1024&Y.flags&&(w=Y.length,w>X&&(w=X),w&&(Y.head&&(y=Y.head.extra_len-Y.length,Y.head.extra||(Y.head.extra=new Uint8Array(Y.head.extra_len)),Y.head.extra.set(Z.subarray(v,v+w),y)),512&Y.flags&&(Y.check=E(Y.check,Z,w,v)),X-=w,v+=w,Y.length-=w),Y.length))break z;Y.length=0,Y.mode=7;case 7:if(2048&Y.flags){if(0===X)break z;w=0;do{y=Z[v+w++],Y.head&&y&&Y.length<65536&&(Y.head.name+=String.fromCharCode(y))}while(y&&w<X);if(512&Y.flags&&(Y.check=E(Y.check,Z,w,v)),X-=w,v+=w,y)break z}else Y.head&&(Y.head.name=null);Y.length=0,Y.mode=8;case 8:if(4096&Y.flags){if(0===X)break z;w=0;do{y=Z[v+w++],Y.head&&y&&Y.length<65536&&(Y.head.comment+=String.fromCharCode(y))}while(y&&w<X);if(512&Y.flags&&(Y.check=E(Y.check,Z,w,v)),X-=w,v+=w,y)break z}else Y.head&&(Y.head.comment=null);Y.mode=9;case 9:if(512&Y.flags){for(;A<16;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(V!==(65535&Y.check)){z.bu="header crc mismatch",Y.mode=t;break}V=0,A=0}Y.head&&(Y.head.hcrc=Y.flags>>9&1,Y.head.done=!0),z.adler=Y.check=0,Y.mode=d;break;case 10:for(;A<32;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}z.adler=Y.check=W(V),V=0,A=0,Y.mode=11;case 11:if(0===Y.havedict)return z.next_out=i,z.avail_out=Q,z.next_in=v,z.avail_in=X,Y.hold=V,Y.bits=A,M;z.adler=Y.check=1,Y.mode=d;case d:if(u===b||u===L)break z;case 13:if(Y.last){V>>>=7&A,A-=7&A,Y.mode=27;break}for(;A<3;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}switch(Y.last=1&V,V>>>=1,A-=1,3&V){case 0:Y.mode=14;break;case 1:if(x(Y),Y.mode=20,u===L){V>>>=2,A-=2;break z}break;case 2:Y.mode=17;break;case 3:z.bu="invalid block type",Y.mode=t}V>>>=2,A-=2;break;case 14:for(V>>>=7&A,A-=7&A;A<32;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if((65535&V)!==(V>>>16^65535)){z.bu="invalid stored block lengths",Y.mode=t;break}if(Y.length=65535&V,V=0,A=0,Y.mode=15,u===L)break z;case 15:Y.mode=16;case 16:if(w=Y.length,w){if(w>X&&(w=X),w>Q&&(w=Q),0===w)break z;s.set(Z.subarray(v,v+w),i),X-=w,v+=w,Q-=w,i+=w,Y.length-=w;break}Y.mode=d;break;case 17:for(;A<14;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(Y.nlen=257+(31&V),V>>>=5,A-=5,Y.ndist=1+(31&V),V>>>=5,A-=5,Y.ncode=4+(15&V),V>>>=4,A-=4,Y.nlen>286||Y.ndist>30){z.bu="too many length or distance symbols",Y.mode=t;break}Y.have=0,Y.mode=18;case 18:for(;Y.have<Y.ncode;){for(;A<3;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.lens[N[Y.have++]]=7&V,V>>>=3,A-=3}for(;Y.have<19;)Y.lens[N[Y.have++]]=0;if(Y.lencode=Y.lendyn,Y.lenbits=7,P={bits:Y.lenbits},a=l(0,Y.lens,0,19,Y.lencode,0,Y.work,P),Y.lenbits=P.bits,a){z.bu="invalid code lengths set",Y.mode=t;break}Y.have=0,Y.mode=19;case 19:for(;Y.have<Y.nlen+Y.ndist;){for(;j=Y.lencode[V&(1<<Y.lenbits)-1],O=j>>>24,n=j>>>16&255,m=65535&j,!(O<=A);){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(m<16)V>>>=O,A-=O,Y.lens[Y.have++]=m;else{if(16===m){for(e=O+2;A<e;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(V>>>=O,A-=O,0===Y.have){z.bu="invalid bit length repeat",Y.mode=t;break}y=Y.lens[Y.have-1],w=3+(3&V),V>>>=2,A-=2}else if(17===m){for(e=O+3;A<e;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}V>>>=O,A-=O,y=0,w=3+(7&V),V>>>=3,A-=3}else{for(e=O+7;A<e;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}V>>>=O,A-=O,y=0,w=11+(127&V),V>>>=7,A-=7}if(Y.have+w>Y.nlen+Y.ndist){z.bu="invalid bit length repeat",Y.mode=t;break}for(;w--;)Y.lens[Y.have++]=y}}if(Y.mode===t)break;if(0===Y.lens[256]){z.bu="invalid code -- missing end-of-block",Y.mode=t;break}if(Y.lenbits=9,P={bits:Y.lenbits},a=l(1,Y.lens,0,Y.nlen,Y.lencode,0,Y.work,P),Y.lenbits=P.bits,a){z.bu="invalid literal/lengths set",Y.mode=t;break}if(Y.distbits=6,Y.distcode=Y.distdyn,P={bits:Y.distbits},a=l(2,Y.lens,Y.nlen,Y.ndist,Y.distcode,0,Y.work,P),Y.distbits=P.bits,a){z.bu="invalid distances set",Y.mode=t;break}if(Y.mode=20,u===L)break z;case 20:Y.mode=21;case 21:if(X>=6&&Q>=258){z.next_out=i,z.avail_out=Q,z.next_in=v,z.avail_in=X,Y.hold=V,Y.bits=A,J(z,R),i=z.next_out,s=z.output,Q=z.avail_out,v=z.next_in,Z=z.input,X=z.avail_in,V=Y.hold,A=Y.bits,Y.mode===d&&(Y.back=-1);break}for(Y.back=0;j=Y.lencode[V&(1<<Y.lenbits)-1],O=j>>>24,n=j>>>16&255,m=65535&j,!(O<=A);){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(n&&0===(240&n)){for(p=O,S=n,I=m;j=Y.lencode[I+((V&(1<<p+S)-1)>>p)],O=j>>>24,n=j>>>16&255,m=65535&j,!(p+O<=A);){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}V>>>=p,A-=p,Y.back+=p}if(V>>>=O,A-=O,Y.back+=O,Y.length=m,0===n){Y.mode=26;break}if(32&n){Y.back=-1,Y.mode=d;break}if(64&n){z.bu="invalid literal/length code",Y.mode=t;break}Y.extra=15&n,Y.mode=22;case 22:if(Y.extra){for(e=Y.extra;A<e;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.length+=V&(1<<Y.extra)-1,V>>>=Y.extra,A-=Y.extra,Y.back+=Y.extra}Y.was=Y.length,Y.mode=23;case 23:for(;j=Y.distcode[V&(1<<Y.distbits)-1],O=j>>>24,n=j>>>16&255,m=65535&j,!(O<=A);){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(0===(240&n)){for(p=O,S=n,I=m;j=Y.distcode[I+((V&(1<<p+S)-1)>>p)],O=j>>>24,n=j>>>16&255,m=65535&j,!(p+O<=A);){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}V>>>=p,A-=p,Y.back+=p}if(V>>>=O,A-=O,Y.back+=O,64&n){z.bu="invalid distance code",Y.mode=t;break}Y.offset=m,Y.extra=15&n,Y.mode=24;case 24:if(Y.extra){for(e=Y.extra;A<e;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}Y.offset+=V&(1<<Y.extra)-1,V>>>=Y.extra,A-=Y.extra,Y.back+=Y.extra}if(Y.offset>Y.dmax){z.bu="invalid distance too far back",Y.mode=t;break}Y.mode=25;case 25:if(0===Q)break z;if(w=R-Q,Y.offset>w){if(w=Y.offset-w,w>Y.whave&&Y.sane){z.bu="invalid distance too far back",Y.mode=t;break}w>Y.wnext?(w-=Y.wnext,c=Y.wsize-w):c=Y.wnext-w,w>Y.length&&(w=Y.length),U=Y.window}else U=s,c=i-Y.offset,w=Y.length;w>Q&&(w=Q),Q-=w,Y.length-=w;do{s[i++]=U[c++]}while(--w);0===Y.length&&(Y.mode=21);break;case 26:if(0===Q)break z;s[i++]=Y.length,Q--,Y.mode=21;break;case 27:if(Y.wrap){for(;A<32;){if(0===X)break z;X--,V|=Z[v++]<<A,A+=8}if(R-=Q,z.total_out+=R,Y.total+=R,R&&(z.adler=Y.check=Y.flags?E(Y.check,s,R,i-R):H(Y.check,s,R,i-R)),R=Q,(Y.flags?V:W(V))!==Y.check){z.bu="incorrect data check",Y.mode=t;break}V=0,A=0}Y.mode=28;case 28:if(Y.wrap&&Y.flags){for(;A<32;){if(0===X)break z;X--,V+=Z[v++]<<A,A+=8}if(V!==(4294967295&Y.total)){z.bu="incorrect length check",Y.mode=t;break}V=0,A=0}Y.mode=29;case 29:a=g;break z;case t:a=C;break z;case 31:return K;default:return q}return z.next_out=i,z.avail_out=Q,z.next_in=v,z.avail_in=X,Y.hold=V,Y.bits=A,(Y.wsize||R!==z.avail_out&&Y.mode<t&&(Y.mode<27||u!==T))&&G(z,z.output,z.next_out,R-z.avail_out)?(Y.mode=31,K):(F-=z.avail_in,R-=z.avail_out,z.total_in+=F,z.total_out+=R,Y.total+=R,Y.wrap&&R&&(z.adler=Y.check=Y.flags?E(Y.check,s,R,z.next_out-R):H(Y.check,s,R,z.next_out-R)),z.data_type=Y.bits+(Y.last?64:0)+(Y.mode===d?128:0)+(20===Y.mode||15===Y.mode?256:0),(0===F&&0===R||u===T)&&a===D&&(a=h),a)},z.exports.inflateEnd=z=>{if(!z||!z.state)return q;let u=z.state;return u.window&&(u.window=null),z.state=null,D},z.exports.inflateGetHeader=(z,u)=>{if(!z||!z.state)return q;const Y=z.state;return 0===(2&Y.wrap)?q:(Y.head=u,u.done=!1,D)},z.exports.inflateSetDictionary=(z,u)=>{const Y=u.length;let E,J,l;return z&&z.state?(E=z.state,0!==E.wrap&&11!==E.mode?q:11===E.mode&&(J=1,J=H(J,u,Y,0),J!==E.check)?C:(l=G(z,u,Y,Y),l?(E.mode=31,K):(E.havedict=1,D))):q},z.exports.inflateInfo="pako inflate (from Nodeca project)"},12034:z=>{"use strict";const u=15,Y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),H=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),J=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);z.exports=(z,l,T,b,L,D,g,M)=>{const q=M.bits;let C,K,h,o,d,t,W=0,Z=0,s=0,v=0,i=0,X=0,Q=0,V=0,A=0,x=0,G=null,F=0;const R=new Uint16Array(16),w=new Uint16Array(16);let c,U,O,n=null,m=0;for(W=0;W<=u;W++)R[W]=0;for(Z=0;Z<b;Z++)R[l[T+Z]]++;for(i=q,v=u;v>=1&&0===R[v];v--);if(i>v&&(i=v),0===v)return L[D++]=20971520,L[D++]=20971520,M.bits=1,0;for(s=1;s<v&&0===R[s];s++);for(i<s&&(i=s),V=1,W=1;W<=u;W++)if(V<<=1,V-=R[W],V<0)return-1;if(V>0&&(0===z||1!==v))return-1;for(w[1]=0,W=1;W<u;W++)w[W+1]=w[W]+R[W];for(Z=0;Z<b;Z++)0!==l[T+Z]&&(g[w[l[T+Z]]++]=Z);if(0===z?(G=n=g,t=19):1===z?(G=Y,F-=257,n=H,m-=257,t=256):(G=E,n=J,t=-1),x=0,Z=0,W=s,d=D,X=i,Q=0,h=-1,A=1<<i,o=A-1,1===z&&A>852||2===z&&A>592)return 1;for(;;){c=W-Q,g[Z]<t?(U=0,O=g[Z]):g[Z]>t?(U=n[m+g[Z]],O=G[F+g[Z]]):(U=96,O=0),C=1<<W-Q,K=1<<X,s=K;do{K-=C,L[d+(x>>Q)+K]=c<<24|U<<16|O}while(0!==K);for(C=1<<W-1;x&C;)C>>=1;if(0!==C?(x&=C-1,x+=C):x=0,Z++,0===--R[W]){if(W===v)break;W=l[T+g[Z]]}if(W>i&&(x&o)!==h){for(0===Q&&(Q=i),d+=s,X=W-Q,V=1<<X;X+Q<v&&(V-=R[X+Q],!(V<=0));)X++,V<<=1;if(A+=1<<X,1===z&&A>852||2===z&&A>592)return 1;h=x&o,L[h]=i<<24|X<<16|d-D}}return 0!==x&&(L[d+x]=W-Q<<24|64<<16),M.bits=i,0}},11993:z=>{"use strict";z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11969:z=>{"use strict";function u(z){let u=z.length;for(;--u>=0;)z[u]=0}const Y=256,H=286,E=30,J=15,l=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),T=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),b=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=new Array(576);u(D);const g=new Array(60);u(g);const M=new Array(512);u(M);const q=new Array(256);u(q);const C=new Array(29);u(C);const K=new Array(E);function h(z,u,Y,H,E){this.static_tree=z,this.extra_bits=u,this.extra_base=Y,this.elems=H,this.max_length=E,this.has_stree=z&&z.length}let o,d,t;function W(z,u){this.dyn_tree=z,this.max_code=0,this.stat_desc=u}u(K);const Z=z=>z<256?M[z]:M[256+(z>>>7)],s=(z,u)=>{z.pending_buf[z.pending++]=255&u,z.pending_buf[z.pending++]=u>>>8&255},v=(z,u,Y)=>{z.bi_valid>16-Y?(z.bi_buf|=u<<z.bi_valid&65535,s(z,z.bi_buf),z.bi_buf=u>>16-z.bi_valid,z.bi_valid+=Y-16):(z.bi_buf|=u<<z.bi_valid&65535,z.bi_valid+=Y)},i=(z,u,Y)=>{v(z,Y[2*u],Y[2*u+1])},X=(z,u)=>{let Y=0;do{Y|=1&z,z>>>=1,Y<<=1}while(--u>0);return Y>>>1},Q=(z,u,Y)=>{const H=new Array(16);let E,l,T=0;for(E=1;E<=J;E++)H[E]=T=T+Y[E-1]<<1;for(l=0;l<=u;l++){let u=z[2*l+1];0!==u&&(z[2*l]=X(H[u]++,u))}},V=z=>{let u;for(u=0;u<H;u++)z.dyn_ltree[2*u]=0;for(u=0;u<E;u++)z.dyn_dtree[2*u]=0;for(u=0;u<19;u++)z.bl_tree[2*u]=0;z.dyn_ltree[512]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0},A=z=>{z.bi_valid>8?s(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0},x=(z,u,Y,H)=>{const E=2*u,J=2*Y;return z[E]<z[J]||z[E]===z[J]&&H[u]<=H[Y]},G=(z,u,Y)=>{const H=z.heap[Y];let E=Y<<1;for(;E<=z.heap_len&&(E<z.heap_len&&x(u,z.heap[E+1],z.heap[E],z.depth)&&E++,!x(u,H,z.heap[E],z.depth));)z.heap[Y]=z.heap[E],Y=E,E<<=1;z.heap[Y]=H},F=(z,u,H)=>{let E,J,b,L,D=0;if(0!==z.last_lit)do{E=z.pending_buf[z.d_buf+2*D]<<8|z.pending_buf[z.d_buf+2*D+1],J=z.pending_buf[z.l_buf+D],D++,0===E?i(z,J,u):(b=q[J],i(z,b+Y+1,u),L=l[b],0!==L&&(J-=C[b],v(z,J,L)),E--,b=Z(E),i(z,b,H),L=T[b],0!==L&&(E-=K[b],v(z,E,L)))}while(D<z.last_lit);i(z,256,u)},R=(z,u)=>{const Y=u.dyn_tree,H=u.stat_desc.static_tree,E=u.stat_desc.has_stree,l=u.stat_desc.elems;let T,b,L,D=-1;for(z.heap_len=0,z.heap_max=573,T=0;T<l;T++)0!==Y[2*T]?(z.heap[++z.heap_len]=D=T,z.depth[T]=0):Y[2*T+1]=0;for(;z.heap_len<2;)L=z.heap[++z.heap_len]=D<2?++D:0,Y[2*L]=1,z.depth[L]=0,z.opt_len--,E&&(z.static_len-=H[2*L+1]);for(u.max_code=D,T=z.heap_len>>1;T>=1;T--)G(z,Y,T);L=l;do{T=z.heap[1],z.heap[1]=z.heap[z.heap_len--],G(z,Y,1),b=z.heap[1],z.heap[--z.heap_max]=T,z.heap[--z.heap_max]=b,Y[2*L]=Y[2*T]+Y[2*b],z.depth[L]=(z.depth[T]>=z.depth[b]?z.depth[T]:z.depth[b])+1,Y[2*T+1]=Y[2*b+1]=L,z.heap[1]=L++,G(z,Y,1)}while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],((z,u)=>{const Y=u.dyn_tree,H=u.max_code,E=u.stat_desc.static_tree,l=u.stat_desc.has_stree,T=u.stat_desc.extra_bits,b=u.stat_desc.extra_base,L=u.stat_desc.max_length;let D,g,M,q,C,K,h=0;for(q=0;q<=J;q++)z.bl_count[q]=0;for(Y[2*z.heap[z.heap_max]+1]=0,D=z.heap_max+1;D<573;D++)g=z.heap[D],q=Y[2*Y[2*g+1]+1]+1,q>L&&(q=L,h++),Y[2*g+1]=q,g>H||(z.bl_count[q]++,C=0,g>=b&&(C=T[g-b]),K=Y[2*g],z.opt_len+=K*(q+C),l&&(z.static_len+=K*(E[2*g+1]+C)));if(0!==h){do{for(q=L-1;0===z.bl_count[q];)q--;z.bl_count[q]--,z.bl_count[q+1]+=2,z.bl_count[L]--,h-=2}while(h>0);for(q=L;0!==q;q--)for(g=z.bl_count[q];0!==g;)M=z.heap[--D],M>H||(Y[2*M+1]!==q&&(z.opt_len+=(q-Y[2*M+1])*Y[2*M],Y[2*M+1]=q),g--)}})(z,u),Q(Y,D,z.bl_count)},w=(z,u,Y)=>{let H,E,J=-1,l=u[1],T=0,b=7,L=4;for(0===l&&(b=138,L=3),u[2*(Y+1)+1]=65535,H=0;H<=Y;H++)E=l,l=u[2*(H+1)+1],++T<b&&E===l||(T<L?z.bl_tree[2*E]+=T:0!==E?(E!==J&&z.bl_tree[2*E]++,z.bl_tree[32]++):T<=10?z.bl_tree[34]++:z.bl_tree[36]++,T=0,J=E,0===l?(b=138,L=3):E===l?(b=6,L=3):(b=7,L=4))},c=(z,u,Y)=>{let H,E,J=-1,l=u[1],T=0,b=7,L=4;for(0===l&&(b=138,L=3),H=0;H<=Y;H++)if(E=l,l=u[2*(H+1)+1],!(++T<b&&E===l)){if(T<L)do{i(z,E,z.bl_tree)}while(0!==--T);else 0!==E?(E!==J&&(i(z,E,z.bl_tree),T--),i(z,16,z.bl_tree),v(z,T-3,2)):T<=10?(i(z,17,z.bl_tree),v(z,T-3,3)):(i(z,18,z.bl_tree),v(z,T-11,7));T=0,J=E,0===l?(b=138,L=3):E===l?(b=6,L=3):(b=7,L=4)}};let U=!1;const O=(z,u,Y,H)=>{v(z,0+(H?1:0),3),((z,u,Y,H)=>{A(z),H&&(s(z,Y),s(z,~Y)),z.pending_buf.set(z.window.subarray(u,u+Y),z.pending),z.pending+=Y})(z,u,Y,!0)};z.exports._tr_init=z=>{U||((()=>{let z,u,Y,L,W;const Z=new Array(16);for(Y=0,L=0;L<28;L++)for(C[L]=Y,z=0;z<1<<l[L];z++)q[Y++]=L;for(q[Y-1]=L,W=0,L=0;L<16;L++)for(K[L]=W,z=0;z<1<<T[L];z++)M[W++]=L;for(W>>=7;L<E;L++)for(K[L]=W<<7,z=0;z<1<<T[L]-7;z++)M[256+W++]=L;for(u=0;u<=J;u++)Z[u]=0;for(z=0;z<=143;)D[2*z+1]=8,z++,Z[8]++;for(;z<=255;)D[2*z+1]=9,z++,Z[9]++;for(;z<=279;)D[2*z+1]=7,z++,Z[7]++;for(;z<=287;)D[2*z+1]=8,z++,Z[8]++;for(Q(D,287,Z),z=0;z<E;z++)g[2*z+1]=5,g[2*z]=X(z,5);o=new h(D,l,257,H,J),d=new h(g,T,0,E,J),t=new h(new Array(0),b,0,19,7)})(),U=!0),z.l_desc=new W(z.dyn_ltree,o),z.d_desc=new W(z.dyn_dtree,d),z.bl_desc=new W(z.bl_tree,t),z.bi_buf=0,z.bi_valid=0,V(z)},z.exports._tr_stored_block=O,z.exports._tr_flush_block=(z,u,H,E)=>{let J,l,T=0;z.level>0?(2===z.strm.data_type&&(z.strm.data_type=(z=>{let u,H=4093624447;for(u=0;u<=31;u++,H>>>=1)if(1&H&&0!==z.dyn_ltree[2*u])return 0;if(0!==z.dyn_ltree[18]||0!==z.dyn_ltree[20]||0!==z.dyn_ltree[26])return 1;for(u=32;u<Y;u++)if(0!==z.dyn_ltree[2*u])return 1;return 0})(z)),R(z,z.l_desc),R(z,z.d_desc),T=(z=>{let u;for(w(z,z.dyn_ltree,z.l_desc.max_code),w(z,z.dyn_dtree,z.d_desc.max_code),R(z,z.bl_desc),u=18;u>=3&&0===z.bl_tree[2*L[u]+1];u--);return z.opt_len+=3*(u+1)+5+5+4,u})(z),J=z.opt_len+3+7>>>3,l=z.static_len+3+7>>>3,l<=J&&(J=l)):J=l=H+5,H+4<=J&&-1!==u?O(z,u,H,E):4===z.strategy||l===J?(v(z,2+(E?1:0),3),F(z,D,g)):(v(z,4+(E?1:0),3),((z,u,Y,H)=>{let E;for(v(z,u-257,5),v(z,Y-1,5),v(z,H-4,4),E=0;E<H;E++)v(z,z.bl_tree[2*L[E]+1],3);c(z,z.dyn_ltree,u-1),c(z,z.dyn_dtree,Y-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,T+1),F(z,z.dyn_ltree,z.dyn_dtree)),V(z),E&&A(z)},z.exports._tr_tally=(z,u,H)=>(z.pending_buf[z.d_buf+2*z.last_lit]=u>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&u,z.pending_buf[z.l_buf+z.last_lit]=255&H,z.last_lit++,0===u?z.dyn_ltree[2*H]++:(z.matches++,u--,z.dyn_ltree[2*(q[H]+Y+1)]++,z.dyn_dtree[2*Z(u)]++),z.last_lit===z.lit_bufsize-1),z.exports._tr_align=z=>{v(z,2,3),i(z,256,D),(z=>{16===z.bi_valid?(s(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)})(z)}},12013:z=>{"use strict";z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.bu="",this.state=null,this.data_type=2,this.adler=0}},11900:z=>{function u(z,u,Y){for(var H=z.length,E=-1/0,J=1/0,l=0;l<H;l++){var T=(Y[0][l]-z[l])/u[l],b=(Y[1][l]-z[l])/u[l];if(T>b){var L=T;T=b,b=L}if(b<E||T>J)return 1/0;T>E&&(E=T),b<J&&(J=b)}return E>J?1/0:E}z.exports=function(z,Y,H,E){var J=u(Y,H,E);if(J===1/0)z=null;else{z=z||[];for(var l=0;l<Y.length;l++)z[l]=Y[l]+H[l]*J}return z},z.exports.distance=u},12936:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>l});var H=Y(32);const E=H.useLayoutEffect;const J=function(z){var u=(0,H.useRef)(z);return E((function(){u.current=z})),u};var l=function(z){var u=J(z);(0,H.Ju)((function(){var z=function(z){var Y;if(null!=u.current&&(Y=u.current(z)),z.defaultPrevented&&(z.returnValue=""),"string"===typeof Y)return z.returnValue=Y,Y};return window.addEventListener("beforeunload",z),function(){window.removeEventListener("beforeunload",z)}}),[])}},12885:(z,u,Y)=>{"use strict";var H=Y(12891),E=Array.prototype.concat,J=Array.prototype.slice,l=z.exports=function(z){for(var u=[],Y=0,l=z.length;Y<l;Y++){var T=z[Y];H(T)?u=E.call(u,J.call(T)):u.push(T)}return u};l.wrap=function(z){return function(){return z(l(arguments))}}},12891:z=>{z.exports=function(z){return!(!z||"string"===typeof z)&&(z instanceof Array||Array.isArray(z)||z.length>=0&&(z.splice instanceof Function||Object.getOwnPropertyDescriptor(z,z.length-1)&&"String"!==z.constructor.name))}},12839:z=>{"use strict";var u=[],Y=[],H=[],E=[],J=[],l=[],T=[],b=[],L=[],D=[],g=[],M=[];z.exports=function(z,q,C,K,h,o){for(var d=T,t=L,W=D,Z=M,s=0;s<3;s++)d[s]=+C[s],W[s]=+q.max[s],t[s]=+q.base[s];o||(o=1e-10);var v=function(z,T,L,D,M,q){var C=u,K=Y,h=H,o=E,d=J,t=l,W=b,Z=Math.floor,s=0,v=0,i=0,X=0,Q=0;if(V(),0===i)return 0;for(X=G();v<=i;){if(A(X)&&x())return s;X=G()}for(s+=i,Q=0;Q<3;Q++)D[Q]+=L[Q],M[Q]+=L[Q];return s;function V(){if(v=0,0!==(i=Math.sqrt(L[0]*L[0]+L[1]*L[1]+L[2]*L[2])))for(var z=0;z<3;z++){var u=L[z]>=0;o[z]=u?1:-1;var Y=u?M[z]:D[z];C[z]=u?D[z]:M[z],K[z]=F(Y,o[z]),h[z]=R(C[z],o[z]),W[z]=L[z]/i,d[z]=Math.abs(1/W[z]);var H=u?K[z]+1-Y:Y-K[z];t[z]=d[z]<1/0?d[z]*H:1/0}}function A(u){for(var Y=o[0],H=0===u?K[0]:h[0],E=K[0]+Y,J=o[1],l=1===u?K[1]:h[1],T=K[1]+J,b=o[2],L=2===u?K[2]:h[2],D=K[2]+b,g=H;g!=E;g+=Y)for(var M=l;M!=T;M+=J)for(var q=L;q!=D;q+=b)if(z(g,M,q))return!0;return!1}function x(){s+=v;var z=o[X],u=v/i,Y=g;for(Q=0;Q<3;Q++){var H=L[Q]*u;D[Q]+=H,M[Q]+=H,Y[Q]=L[Q]-H}if(z>0?M[X]=Math.round(M[X]):D[X]=Math.round(D[X]),T(s,X,z,Y))return!0;for(Q=0;Q<3;Q++)L[Q]=Y[Q];return V(),0===i}function G(){var z=t[0]<t[1]?t[0]<t[2]?0:2:t[1]<t[2]?1:2,u=t[z]-v;for(v=t[z],K[z]+=o[z],t[z]+=d[z],Q=0;Q<3;Q++)C[Q]+=u*W[Q],h[Q]=R(C[Q],o[Q]);return z}function F(z,u){return Z(z-u*q)}function R(z,u){return Z(z+u*q)}}(z,K,d,t,W,o);if(!h){for(s=0;s<3;s++)Z[s]=C[s]>0?W[s]-q.max[s]:t[s]-q.base[s];q.translate(Z)}return v}},11910:(z,u,Y)=>{var H=Y(11915);function E(z){for(var u,Y,E=0,J=z.length,l=0;l<z.length;){for(u=z[l],Y=0;l<J&&z[l]===u;)++l,++Y;E+=H.log2(Y)/7|0,E+=H.log2(u>>>0)/7|0,E+=2}return E}u.size=E,u.encode=function(z,u){u||(u=new Uint8Array(E(z)));for(var Y,H,J=0,l=u.length,T=0;T<z.length;){for(Y=z[T],H=0;T<z.length&&z[T]===Y;)++T,++H;for(;J<l&&H>=128;)u[J++]=128+(127&H),H>>>=7;if(J>=l)throw new Error("RLE buffer overflow");for(u[J++]=H,Y>>>=0;J<l&&Y>=128;)u[J++]=128+(127&Y),Y>>>=7;if(J>=l)throw new Error("RLE buffer overflow");u[J++]=Y}return u},u.decode=function(z,u){for(var Y,H,E,J,l=u.length,T=z.length,b=0,L=0;L<T;){for(Y=0,H=0;L<T&&z[L]>=128;)Y+=(127&z[L++])<<H,H+=7;if(Y+=z[L++]<<H,L>=T)throw new Error("RLE buffer underrun");if(b+Y>l)throw new Error("Chunk buffer overflow");for(E=0,H=0;L<T&&z[L]>=128;)E+=(127&z[L++])<<H,H+=7;if(L>=T)throw new Error("RLE buffer underrun");for(E+=z[L++]<<H,J=0;J<Y;++J)u[b++]=E}return u}},11915:(z,u)=>{"use strict";function Y(z){var u=32;return(z&=-z)&&u--,65535&z&&(u-=16),16711935&z&&(u-=8),252645135&z&&(u-=4),858993459&z&&(u-=2),1431655765&z&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(z){return(z>0)-(z<0)},u.abs=function(z){var u=z>>31;return(z^u)-u},u.min=function(z,u){return u^(z^u)&-(z<u)},u.max=function(z,u){return z^(z^u)&-(z<u)},u.isPow2=function(z){return!(z&z-1)&&!!z},u.log2=function(z){var u,Y;return u=(z>65535)<<4,u|=Y=((z>>>=u)>255)<<3,u|=Y=((z>>>=Y)>15)<<2,(u|=Y=((z>>>=Y)>3)<<1)|(z>>>=Y)>>1},u.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},u.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},u.countTrailingZeros=Y,u.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},u.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},u.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var H=new Array(256);!function(z){for(var u=0;u<256;++u){var Y=u,H=u,E=7;for(Y>>>=1;Y;Y>>>=1)H<<=1,H|=1&Y,--E;z[u]=H<<E&255}}(H),u.reverse=function(z){return H[255&z]<<24|H[z>>>8&255]<<16|H[z>>>16&255]<<8|H[z>>>24&255]},u.interleave2=function(z,u){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(z,u){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>u&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},u.interleave3=function(z,u,Y){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},u.deinterleave3=function(z,u){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>u&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},u.nextCombination=function(z){var u=z|z-1;return u+1|(~u&-~u)-1>>>Y(z)+1}},13012:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>g});var H=Y(12834),E=Y(125);class J{constructor(z,u,Y,J,l,T,b){this.eL=new H(z.base,z.LD),this.zE=u,this.friction=Y,this.restitution=J,this.ql=l,this.yq=T,this.Cl=!!b,this.bD=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xC=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.iL=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(z){E.j(this.eL.base,z.eL.base),E.j(this.eL.LD,z.eL.LD),E.j(this.eL.max,z.eL.max),this.eL.mag=z.eL.mag,this.zE=z.zE,this.friction=z.friction,this.restitution=z.restitution,this.ql=z.ql,this.yq=z.yq,this.Cl=z.Cl,this.bD=z.bD,this.fluidDrag=z.fluidDrag,this.xC=z.xC,this.preventFallOffEdge=z.preventFallOffEdge,this.rolledBackLastTick=z.rolledBackLastTick,E.j(this.iL,z.iL),E.j(this.resting,z.resting),this.inFluid=z.inFluid,this._ratioInFluid=z._ratioInFluid,E.j(this._forces,z._forces),E.j(this._impulses,z._impulses),this._sleepFrameCount=z._sleepFrameCount}setPosition(z){l(z),E.JY(z,z,this.eL.base),this.eL.translate(z),this.VL()}Ol(){return E.clone(this.eL.base)}applyForce(z){l(z),E.add(this._forces,this._forces,z),this.VL()}applyImpulse(z){l(z),E.add(this._impulses,this._impulses,z),this.VL()}VL(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var l=z=>{};var T=Y(12834),b=Y(125),L=Y(12839);function D(){this.bD=.1,this.fluidDrag=.4,this.tl=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function g(z,u,Y){z=Object.assign(new D,z),this.gravity=z.gravity||[0,-10,0],this.bD=z.bD||.1,this.tl=z.tl||2,this.fluidDrag=z.fluidDrag||.4,this.minBounceImpulse=z.minBounceImpulse,this.bodies=[],this.Mq=z.Mq,this.testSolid=u,this.testFluid=Y}g.prototype.Bq=function(z,u,Y,H,E,l){z=z||new T([0,0,0],[1,1,1]),"undefined"==typeof u&&(u=1),"undefined"==typeof Y&&(Y=1),"undefined"==typeof H&&(H=0),"undefined"==typeof E&&(E=1);var b=new J(z,u,Y,H,E,l);return this.bodies.push(b),b},g.prototype.fq=function(z){var u=this.bodies.indexOf(z);u<0||(this.bodies.splice(u,1),z.eL=z.yq=null)};var M=b.create(),q=b.create(),C=b.create(),K=b.create(),h=b.create(),o=b.create(),d=b.create(),t=new T([0,0,0],[1,1,1]),W=new J(t,1,1,0,1,(()=>{}),!1);function Z(z,u,Y){return u=Y,u*=1-(1-z.ratioInFluid)**2}g.prototype.Rl=function(z){z/=1e3;var u=n(0,b.squaredLength(this.gravity));this.bodies.forEach((Y=>function(z,u,Y,H){b.j(h,u.resting),z.Mq&&W.loadFromCopy(u);if(u.zE<=0)return b.set(u.iL,0,0,0),b.set(u._forces,0,0,0),void b.set(u._impulses,0,0,0);var E=H||0===u.ql;if(function(z,u,Y,H){if(u._sleepFrameCount>0)return!1;if(H)return!0;var E=!1,J=.5*Y*Y*u.ql;return b.scale(O,z.gravity,J),L(z.testSolid,u.eL,O,(function(){return E=!0,!0}),!0),E}(z,u,Y,E))return;u._sleepFrameCount--,function(z,u){var Y=u.eL,H=Math.floor(Y.base[0]),E=Math.floor(Y.base[2]),J=Math.floor(Y.base[1]),l=Math.floor(Y.max[1]);if(!z.testFluid(H,J,E))return u.inFluid=!1,void(u.ratioInFluid=0);var T=1,L=J+1;for(;L<=l&&z.testFluid(H,L,E);)T++,L++;var D=(J+T-Y.base[1])/Y.LD[1];D>1&&(D=1);var g=Y.LD[0]*Y.LD[1]*Y.LD[2]*D,M=v;b.scale(M,z.gravity,-z.tl*g*u.ql),u.applyForce(M),u.inFluid=!0,u.ratioInFluid=D}(z,u),p(u._forces),p(u._impulses),p(u.iL),p(u.resting),b.scale(M,u._forces,1/u.zE),b.Xl(M,M,z.gravity,u.ql),b.scale(q,u._impulses,1/u.zE),b.Xl(q,q,M,Y),b.add(u.iL,u.iL,q),u.friction&&(i(z,0,u,q,Y),i(z,1,u,q,Y),i(z,2,u,q,Y));var J=u.fluidDrag>=0?u.fluidDrag:z.fluidDrag,l=u.bD>=0?u.bD:z.bD,T=l,D=l;u.inFluid&&(T=Z(u,T,u.fluidDragHoriz>=0?u.fluidDragHoriz:J),D=Z(u,D,u.fluidDragVert>=0?u.fluidDragVert:J));T=Math.max(1-T*Y/u.zE,0),D=Math.max(1-D*Y/u.zE,0),b.set(s,T,D,T),b.multiply(u.iL,u.iL,s),b.scale(C,u.iL,Y),b.set(u._forces,0,0,0),b.set(u._impulses,0,0,0),u.Cl&&m(V,u.eL);b.j(o,C),b.set(d,0,0,0),u.preventFallOffEdge&&function(z,u,Y,H){if(!u.resting[1]||Y[1]>0)return;var E=w;m(E,u.eL);for(var J=0;J<3;J+=2){b.set(R,0,0,0),R[J]=Y[J];var l=!0;(l=(l=(l=(l=l&&!U(z,E.base[0]+R[0]+1e-5,E.base[1],E.base[2]+R[2]+1e-5))&&!U(z,E.max[0]+R[0]-1e-5,E.base[1],E.base[2]+R[2]+1e-5))&&!U(z,E.base[0]+R[0]+1e-5,E.base[1],E.max[2]+R[2]-1e-5))&&!U(z,E.max[0]+R[0]-1e-5,E.base[1],E.max[2]+R[2]-1e-5))?(H[J]=Y[J]>0?1:-1,Y[J]=0):0===J&&(b.set(c,Y[0],0,0),Q(z,E,c,H,u.slideOnCollision))}}(z,u,C,d);Q(z,u.eL,C,u.resting,u.slideOnCollision),u.Cl&&function(z,u,Y,H){if(u.resting[1]>=0&&!u.inFluid)return;var E=0!==u.resting[0],J=0!==u.resting[2];if(!E&&!J)return;var l=Math.abs(H[0]/H[2]),T=4;if(!E&&l>T)return;if(!J&&l<1/T)return;b.add(x,Y.base,H);var D=z.testSolid;L(D,Y,H,(function(z,u,Y,H){if(1!==u)return!0;H[u]=0}));var g=Y.base[1],M=u.inFluid?1.951:1.001,q=Math.floor(g+M)-g;b.set(G,0,q,0);var C=!1;if(L(D,Y,G,(function(z,u,Y,H){return C=!0,!0})),C)return;b.JY(F,x,Y.base),F[1]=0,Q(z,Y,F,A,!0);var K=n(Y.base[0],x[0]),h=n(Y.base[2],x[2]);if(E&&!K&&(!h||!J))return;if(J&&(!K||!E)&&!h)return;var o=!0;if(o=o&&!U(z,Y.base[0]+1e-5,Y.base[1],Y.base[2]+1e-5),o=o&&!U(z,Y.max[0]-1e-5,Y.base[1],Y.base[2]+1e-5),o=o&&!U(z,Y.base[0]+1e-5,Y.base[1],Y.max[2]-1e-5),o=o&&!U(z,Y.max[0]-1e-5,Y.base[1],Y.max[2]-1e-5),o)return;m(u.eL,Y),u.resting[0]=A[0],u.resting[2]=A[2],u.xC&&u.xC()}(z,u,V,o);for(var g=0;g<3;++g)u.resting[g]=u.resting[g]||d[g],K[g]=0,u.resting[g]&&(h[g]||(K[g]=-u.iL[g]),u.iL[g]=0);var t=b.length(K);t>.001&&(b.scale(K,K,u.zE),u.yq&&u.yq(K),u.restitution>0&&t>z.minBounceImpulse&&(b.scale(K,K,u.restitution),u.applyImpulse(K)));var X=b.squaredLength(u.iL);X>1e-5&&u.VL();z.Mq&&z.Mq(u)?(u.loadFromCopy(W),u.rolledBackLastTick=!0):u.rolledBackLastTick=!1}(this,Y,z,u)))};var s=b.create([0,0,0]);var v=b.create();function i(z,u,Y,H,E){var J=Y.resting[u],l=H[u];if(!Y.alwaysApplyHorizFriction||1!==u){if(0===J)return;if(J*l<=0)return}b.j(X,Y.iL),X[u]=0;var T=b.length(X);if(!n(T,0)){var L=Math.abs(Y.friction*z.gravity[u]*E),D=T>L?(T-L)/T:0;Y.iL[(u+1)%3]*=D,Y.iL[(u+2)%3]*=D}}var X=b.create();function Q(z,u,Y,H,E){return b.set(H,0,0,0),L(z.testSolid,u,Y,(function(z,u,Y,J){H[u]=Y,J[u]=0,E||(J[0]=0,J[1]=0,J[2]=0)}))}var V=new T([],[]),A=b.create(),x=b.create(),G=b.create(),F=b.create();var R=b.create(),w=new T([],[]),c=b.create();function U(z,u,Y,H){return z.testSolid(Math.floor(u),Math.floor(Y-1),Math.floor(H))}var O=b.create();function n(z,u){return Math.abs(z-u)<1e-5}function m(z,u){for(var Y=0;Y<3;Y++)z.base[Y]=u.base[Y],z.max[Y]=u.max[Y],z.LD[Y]=u.LD[Y]}var p=function(z){}},11946:z=>{"use strict";z.exports=function(z,u,Y,H){var E=self||window;try{try{var J;try{J=new E.Blob([z])}catch(L){(J=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(z),J=J.getBlob()}var l=E.URL||E.webkitURL,T=l.createObjectURL(J),b=new E[u](T,Y);return l.revokeObjectURL(T),b}catch(L){return new E[u]("data:application/javascript,".concat(encodeURIComponent(z)),Y)}}catch(L){if(!H)throw Error("Inline worker is not supported");return new E[u](H,Y)}}},11888:(z,u,Y)=>{"use strict";function H(z,u,Y,H,E){var J={};return Object.keys(H).forEach((function(z){J[z]=H[z]})),J.enumerable=!!J.enumerable,J.configurable=!!J.configurable,("value"in J||J.initializer)&&(J.writable=!0),J=Y.slice().reverse().reduce((function(Y,H){return H(z,u,Y)||Y}),J),E&&void 0!==J.initializer&&(J.value=J.initializer?J.initializer.call(E):void 0,J.initializer=void 0),void 0===J.initializer&&(Object.defineProperty(z,u,J),J=null),J}Y.d(u,{d:()=>H})},11882:(z,u,Y)=>{"use strict";function H(z,u,Y,H){Y&&Object.defineProperty(z,u,{enumerable:Y.enumerable,configurable:Y.configurable,writable:Y.writable,value:Y.initializer?Y.initializer.call(H):void 0})}Y.d(u,{e:()=>H})},12924:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>l,f:()=>g,j:()=>T,k:()=>J,o:()=>b,q:()=>E,u:()=>L,w:()=>D});var H=Y(11389);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(z){const u=Math.min(Math.max(z,0),2);this._easingMode=u}getEasingMode(){return this._easingMode}easeInCore(z){throw new Error("You must implement this method")}ease(z){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(z);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-z)}return z>=.5?.5*(1-this.easeInCore(2*(1-z)))+.5:.5*this.easeInCore(2*z)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class J extends E{easeInCore(z){return z=Math.max(0,Math.min(1,z)),1-Math.sqrt(1-z*z)}}class l extends E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=z}easeInCore(z){const u=Math.max(0,this.amplitude);return Math.pow(z,3)-z*u*Math.sin(3.141592653589793*z)}}class T extends E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=z,this.bounciness=u}easeInCore(z){const u=Math.max(0,this.bounces);let Y=this.bounciness;Y<=1&&(Y=1.001);const H=Math.pow(Y,u),E=1-Y,J=(1-H)/E+.5*H,l=z*J,T=Math.log(-l*(1-Y)+1)/Math.log(Y),b=Math.floor(T),L=b+1,D=(1-Math.pow(Y,b))/(E*J),g=.5*(D+(1-Math.pow(Y,L))/(E*J)),M=z-g,q=g-D;return-Math.pow(1/Y,u-b)/(q*q)*(M-q)*(M+q)}}class b extends E{easeInCore(z){return z*z*z}}class L extends E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=z,this.springiness=u}easeInCore(z){let u;const Y=Math.max(0,this.oscillations),H=Math.max(0,this.springiness);return u=0==H?z:(Math.exp(H*z)-1)/(Math.exp(H)-1),u*Math.sin((6.283185307179586*Y+1.5707963267948966)*z)}}class D extends E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=z}easeInCore(z){return this.exponent<=0?z:(Math.exp(this.exponent*z)-1)/(Math.exp(this.exponent)-1)}}class g extends E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=z,this.y1=u,this.x2=Y,this.y2=H}easeInCore(z){return H.c.Interpolate(z,this.x1,this.y1,this.x2,this.y2)}}},12451:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>l});var H=Y(10903),E=Y(10910),J=Y(11222);class l extends J.b{get _matrix(){return this._compose(),this.BM}set _matrix(z){(z.updateFlag!==this.BM.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.BM.J(z),this._markAsDirtyAndDecompose())}constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(z,u.iz(),!1),this.name=z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=u,this.BM=(null===E||void 0===E?void 0:E.clone())??H.b.Identity(),this._restMatrix=J??this.BM.clone(),this._bindMatrix=l??this.BM.clone(),this._index=T,this._absoluteMatrix=new H.b,this._absoluteBindMatrix=new H.b,this._absoluteInverseBindMatrix=new H.b,this._finalMatrix=new H.b,u.bones.push(this),this.setParent(Y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(z){this.setParent(z)}setParent(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==z){if(this.parent){const z=this.parent.children.indexOf(this);-1!==z&&this.parent.children.splice(z,1)}this._parentNode=z,this.parent&&this.parent.children.push(this),u&&this._updateAbsoluteBindMatrices(),this.uD()}}getLocalMatrix(){return this._compose(),this.BM}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(z){this._restMatrix.J(z)}setRestPose(z){this.setRestMatrix(z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(z){this.rl(z)}setBindPose(z){this.setBindMatrix(z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const z=H.i.Pl[0],u=H.i.Quaternion[0],Y=H.i.Pl[1];this.getRestMatrix().decompose(z,u,Y),this._linkedTransformNode.position.J(Y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??H.f.Identity(),this._linkedTransformNode.rotationQuaternion.J(u),this._linkedTransformNode.el.J(z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.xT}set position(z){this._decompose(),this.xT.J(z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(z){this.setRotation(z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(z){this.setRotationQuaternion(z)}get el(){return this.getScale()}set el(z){this.setScale(z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=H.p.Zero(),this._localRotation=H.f.Zero(),this.xT=H.p.Zero()),this.BM.decompose(this._localScaling,this._localRotation,this.xT))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,H.b.ComposeToRef(this._localScaling,this._localRotation,this.xT,this.BM)):this._needToCompose=!1)}rl(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.J(z),u&&this._updateAbsoluteBindMatrices(),Y?this._matrix=z:this.uD()}_updateAbsoluteBindMatrices(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z||(z=this._bindMatrix),this.parent?z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.J(z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),u)for(let Y=0;Y<this.children.length;Y++)this.children[Y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}uD(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.uD(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.uD(),this._needToDecompose=!0}_updatePosition(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const J=this.getLocalMatrix();if(0==u)E?(J.addAtIndex(12,z.x),J.addAtIndex(13,z.y),J.addAtIndex(14,z.z)):J.setTranslationFromFloats(z.x,z.y,z.z);else{let u=null;Y&&(u=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const T=l._TmpMats[0],b=l._TmpVecs[0];this.parent?Y&&u?(T.J(this.parent.getAbsoluteMatrix()),T.multiplyToRef(u,T)):T.J(this.parent.getAbsoluteMatrix()):H.b.IdentityToRef(T),E&&T.setTranslationFromFloats(0,0,0),T.invert(),H.p.TransformCoordinatesToRef(z,T,b),E?(J.addAtIndex(12,b.x),J.addAtIndex(13,b.y),J.addAtIndex(14,b.z)):J.setTranslationFromFloats(b.x,b.y,b.z)}this._markAsDirtyAndDecompose()}translate(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,u,Y,!0)}setPosition(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,u,Y,!1)}setAbsolutePosition(z,u){this.setPosition(z,1,u)}scale(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=this.getLocalMatrix(),T=l._TmpMats[0];H.b.ScalingToRef(z,u,Y,T),T.multiplyToRef(J,J),T.invert();for(const H of this.children){const E=H.getLocalMatrix();E.multiplyToRef(T,E),E.multiplyAtIndex(12,z),E.multiplyAtIndex(13,u),E.multiplyAtIndex(14,Y),H._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const H of this.children)H.scale(z,u,Y,E)}setScale(z){this._decompose(),this._localScaling.J(z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(z){this._decompose(),z.J(this._localScaling)}setYawPitchRoll(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4?arguments[4]:void 0;if(0===E){const T=l._TmpQuat;return H.f.RotationYawPitchRollToRef(z,u,Y,T),void this.setRotationQuaternion(T,E,J)}const T=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,J))return;const b=l._TmpMats[1];H.b.RotationYawPitchRollToRef(z,u,Y,b),T.multiplyToRef(b,b),this._rotateWithMatrix(b,E,J)}rotate(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const J=l._TmpMats[0];J.setTranslationFromFloats(0,0,0),H.b.RotationAxisToRef(z,u,J),this._rotateWithMatrix(J,Y,E)}setAxisAngle(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===Y){const J=l._TmpQuat;return H.f.RotationAxisToRef(z,u,J),void this.setRotationQuaternion(J,Y,E)}const J=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,E))return;const T=l._TmpMats[1];H.b.RotationAxisToRef(z,u,T),J.multiplyToRef(T,T),this._rotateWithMatrix(T,Y,E)}setRotation(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(z.y,z.x,z.z,u,Y)}setRotationQuaternion(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===u)return this._decompose(),this._localRotation.J(z),void this._markAsDirtyAndCompose();const E=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,Y))return;const J=l._TmpMats[1];H.b.FromQuaternionToRef(z,J),E.multiplyToRef(J,J),this._rotateWithMatrix(J,u,Y)}setRotationMatrix(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===u){const E=l._TmpQuat;return H.f.FromRotationMatrixToRef(z,E),void this.setRotationQuaternion(E,u,Y)}const E=l._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,Y))return;const J=l._TmpMats[1];J.J(z),E.multiplyToRef(z,J),this._rotateWithMatrix(J,u,Y)}_rotateWithMatrix(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const H=this.getLocalMatrix(),E=H.m[12],J=H.m[13],T=H.m[14],b=this.getParent(),L=l._TmpMats[3],D=l._TmpMats[4];b&&1==u?(Y?(L.J(Y.getWorldMatrix()),b.getAbsoluteMatrix().multiplyToRef(L,L)):L.J(b.getAbsoluteMatrix()),D.J(L),D.invert(),H.multiplyToRef(L,H),H.multiplyToRef(z,H),H.multiplyToRef(D,H)):1==u&&Y?(L.J(Y.getWorldMatrix()),D.J(L),D.invert(),H.multiplyToRef(L,H),H.multiplyToRef(z,H),H.multiplyToRef(D,H)):H.multiplyToRef(z,H),H.setTranslationFromFloats(E,J,T),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(z,u){const Y=l._TmpMats[2];return z.J(this.getAbsoluteMatrix()),u?(z.multiplyToRef(u.getWorldMatrix(),z),H.b.ScalingToRef(u.el.x,u.el.y,u.el.z,Y)):H.b.IdentityToRef(Y),z.invert(),!isNaN(z.m[0])&&(Y.multiplyAtIndex(0,this._scalingDeterminant),z.multiplyToRef(Y,z),!0)}Ol(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.p.Zero();return this.getPositionToRef(z,u,Y),Y}getPositionToRef(){let z=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const z=this.getLocalMatrix();u.x=z.m[12],u.y=z.m[13],u.z=z.m[14]}else{let Y=null;z&&(Y=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let H=l._TmpMats[0];z&&Y?(H.J(this.getAbsoluteMatrix()),H.multiplyToRef(Y,H)):H=this.getAbsoluteMatrix(),u.x=H.m[12],u.y=H.m[13],u.z=H.m[14]}}getAbsolutePosition(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=H.p.Zero();return this.getPositionToRef(1,z,u),u}getAbsolutePositionToRef(z,u){this.getPositionToRef(1,z,u)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.BM.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.J(this.BM);const z=this._skeleton.getPoseMatrix();z&&this._absoluteMatrix.multiplyToRef(z,this._absoluteMatrix)}const z=this.children,u=z.length;for(let Y=0;Y<u;Y++)z[Y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}sb(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.p.Zero();return this.getDirectionToRef(z,u,Y),Y}getDirectionToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,E=null;u&&(E=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.J(this.getAbsoluteMatrix()),u&&E&&J.multiplyToRef(E,J),H.p.TransformNormalToRef(z,J,Y),Y.normalize()}getRotation(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.p.Zero();return this.getRotationToRef(z,u,Y),Y}getRotationToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;const H=l._TmpQuat;this.getRotationQuaternionToRef(z,u,H),H.toEulerAnglesToRef(Y)}getRotationQuaternion(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.f.Identity();return this.getRotationQuaternionToRef(z,u,Y),Y}getRotationQuaternionToRef(){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),u.J(this._localRotation);else{const Y=l._TmpMats[0],H=this.getAbsoluteMatrix();z?H.multiplyToRef(z.getWorldMatrix(),Y):Y.J(H),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.decompose(void 0,u,void 0)}}getRotationMatrix(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0;const Y=H.b.Identity();return this.getRotationMatrixToRef(z,u,Y),Y}getRotationMatrixToRef(){let z=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(u);else{const Y=l._TmpMats[0],H=this.getAbsoluteMatrix();z?H.multiplyToRef(z.getWorldMatrix(),Y):Y.J(H),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.getRotationMatrixToRef(u)}}getAbsolutePositionFromLocal(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.p.Zero();return this.getAbsolutePositionFromLocalToRef(z,u,Y),Y}getAbsolutePositionFromLocalToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,E=null;u&&(E=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.J(this.getAbsoluteMatrix()),u&&E&&J.multiplyToRef(E,J),H.p.TransformCoordinatesToRef(z,J,Y)}getLocalPositionFromAbsolute(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=H.p.Zero();return this.getLocalPositionFromAbsoluteToRef(z,u,Y),Y}getLocalPositionFromAbsoluteToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,E=null;u&&(E=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=l._TmpMats[0];J.J(this.getAbsoluteMatrix()),u&&E&&J.multiplyToRef(E,J),J.invert(),H.p.TransformCoordinatesToRef(z,J,Y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const z=this._skeleton.bones.indexOf(this);if(-1!==z&&this._skeleton.bones.splice(z,1),this._parentNode&&this._parentNode.children){const z=this._parentNode.children,u=z.indexOf(this);-1!==u&&z.splice(u,1)}super.dispose()}}l._TmpVecs=(0,E.b)(2,H.p.Zero),l._TmpQuat=H.f.Identity(),l._TmpMats=(0,E.b)(5,H.b.Identity)},12917:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>R});var H=Y(11079),E=Y(11082),J=Y(10932),l=Y(10903),T=Y(10937),b=Y(11222),L=Y(11267),D=Y(11530),g=Y(10962),M=Y(10906);class q{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(z){this._idleRotationSpeed=z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(z){this._idleRotationWaitTime=z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(z){this._idleRotationSpinupTime=z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(z){this._attachedCamera=z;const u=this._attachedCamera.iz();this._onPrePointerObservableObserver=u.onPrePointerObservable.add((z=>{z.type!==D.d.POINTERDOWN?z.type===D.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const z=g.d.Now;let u=0;null!=this._lastFrameTime&&(u=z-this._lastFrameTime),this._lastFrameTime=z,this._applyUserInteraction();const Y=z-this._lastInteractionTime-this._idleRotationWaitTime,H=Math.max(Math.min(Y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*H,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(u/1e3))}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.iz();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(z){this._lastInteractionTime=z??g.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<M.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=g.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var C=Y(12924),K=Y(11619);class h{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(z){if(this._autoTransitionRange===z)return;this._autoTransitionRange=z;const u=this._attachedCamera;u&&(z?this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((z=>{if(z&&(z.pl(!0),z.getBoundingInfo)){const u=z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*u,this.upperRadiusTransitionRange=.05*u}})):this._onMeshTargetChangedObserver&&u.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(z){this._attachedCamera=z,this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(z){return!!this._attachedCamera&&(this._attachedCamera.radius===z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(z){if(!this._attachedCamera)return;this._radiusBounceTransition||(h.EasingFunction.setEasingMode(h.EasingMode),this._radiusBounceTransition=K.e.CreateAnimation("radius",K.e.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const u=K.e.TransitionTo("radius",this._attachedCamera.radius+z,this._attachedCamera,this._attachedCamera.iz(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));u&&this._animatables.push(u)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}h.EasingFunction=new C.c(.3),h.EasingMode=C.q.EASINGMODE_EASEOUT;class o{constructor(){this.onTargetFramingAnimationEndObservable=new J.e,this._mode=o.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(z){this._mode=z}get mode(){return this._mode}set radiusScale(z){this._radiusScale=z}get radiusScale(){return this._radiusScale}set positionScale(z){this._positionScale=z}get positionScale(){return this._positionScale}set defaultElevation(z){this._defaultElevation=z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(z){this._elevationReturnTime=z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(z){this._elevationReturnWaitTime=z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(z){this._framingTime=z}get framingTime(){return this._framingTime}init(){}attach(z){this._attachedCamera=z;const u=this._attachedCamera.iz();o.EasingFunction.setEasingMode(o.EasingMode),this._onPrePointerObservableObserver=u.onPrePointerObservable.add((z=>{z.type!==D.d.POINTERDOWN?z.type===D.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=z.onMeshTargetChangedObservable.add((z=>{z&&z.getBoundingInfo&&this.zoomOnMesh(z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.iz();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.pl(!0);const H=z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(H.minimumWorld,H.maximumWorld,u,Y)}zoomOnMeshHierarchy(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.pl(!0);const H=z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(H.min,H.max,u,Y)}zoomOnMeshesHierarchy(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new l.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new l.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let J=0;J<z.length;J++){const u=z[J].getHierarchyBoundingVectors(!0);l.p.CheckExtends(u.min,H,E),l.p.CheckExtends(u.max,H,E)}this.zoomOnBoundingInfo(H,E,u,Y)}zoomOnBoundingInfo(z,u){let Y,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const J=z.y,T=J+(u.y-J)*this._positionScale,b=u.JY(z).scale(.5);if(!isFinite(T))return!1;if(H)Y=new l.p(0,T,0);else{const u=z.add(b);Y=new l.p(u.x,T,u.z)}this._vectorTransition||(this._vectorTransition=K.e.CreateAnimation("target",K.e.ANIMATIONTYPE_VECTOR3,60,o.EasingFunction)),this._betaIsAnimating=!0;let L=K.e.TransitionTo("target",Y,this._attachedCamera,this._attachedCamera.iz(),60,this._vectorTransition,this._framingTime);L&&this._animatables.push(L);let D=0;if(this._mode===o.FitFrustumSidesMode){const Y=this._calculateLowerRadiusFromModelBoundingSphere(z,u);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=b.length()+this._attachedCamera.uT),D=Y}else this._mode===o.IgnoreBoundsSizeMode&&(D=this._calculateLowerRadiusFromModelBoundingSphere(z,u),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.uT));if(this.autoCorrectCameraLimitsAndSensibility){const Y=u.JY(z).length();this._attachedCamera.panningSensibility=5e3/Y,this._attachedCamera.wheelPrecision=100/D}return this._radiusTransition||(this._radiusTransition=K.e.CreateAnimation("radius",K.e.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),L=K.e.TransitionTo("radius",D,this._attachedCamera,this._attachedCamera.iz(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),L&&this._animatables.push(L),!0}_calculateLowerRadiusFromModelBoundingSphere(z,u){const Y=this._attachedCamera;if(!Y)return 0;let H=Y._calculateLowerRadiusFromModelBoundingSphere(z,u,this._radiusScale);return Y.lowerRadiusLimit&&this._mode===o.IgnoreBoundsSizeMode&&(H=H<Y.lowerRadiusLimit?Y.lowerRadiusLimit:H),Y.upperRadiusLimit&&(H=H>Y.upperRadiusLimit?Y.upperRadiusLimit:H),H}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const z=g.d.Now-this._lastInteractionTime,u=.5*Math.PI-this._defaultElevation,Y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Y&&z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=K.e.CreateAnimation("beta",K.e.ANIMATIONTYPE_FLOAT,60,o.EasingFunction));const z=K.e.TransitionTo("beta",u,this._attachedCamera,this._attachedCamera.iz(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));z&&this._animatables.push(z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=g.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}o.EasingFunction=new C.w,o.EasingMode=C.q.EASINGMODE_EASEINOUT,o.IgnoreBoundsSizeMode=0,o.FitFrustumSidesMode=1;var d=Y(11275),t=Y(11475),W=Y(12448),Z=Y(10945);class s{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(z){z=Z.e.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),Y=u.getInputElement();let H=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=J=>{var l,T;const b=J.event,L="touch"===b.pointerType;if(J.type!==D.d.POINTERMOVE&&-1===this.buttons.indexOf(b.button))return;const g=b.target;if(this._altKey=b.altKey,this._ctrlKey=b.ctrlKey,this._metaKey=b.metaKey,this._shiftKey=b.shiftKey,this._buttonsPressed=b.buttons,u.isPointerLock){const z=b.movementX,u=b.movementY;this.onTouch(null,z,u),this._pointA=null,this._pointB=null}else{if(J.type!==D.d.POINTERDOWN&&J.type!==D.d.POINTERDOUBLETAP&&L&&(null===(l=this._pointA)||void 0===l?void 0:l.pointerId)!==b.pointerId&&(null===(T=this._pointB)||void 0===T?void 0:T.pointerId)!==b.pointerId)return;if(J.type!==D.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!L)if(J.type===D.d.POINTERDOUBLETAP)this.onDoubleTap(b.pointerType);else if(J.type!==D.d.POINTERUP||this._currentMousePointerIdDown!==b.pointerId&&!L){if(J.type===D.d.POINTERMOVE)if(z||b.preventDefault(),this._pointA&&null===this._pointB){const z=b.clientX-this._pointA.x,u=b.clientY-this._pointA.y;this._pointA.x=b.clientX,this._pointA.y=b.clientY,this.onTouch(this._pointA,z,u)}else if(this._pointA&&this._pointB){const z=this._pointA.pointerId===b.pointerId?this._pointA:this._pointB;z.x=b.clientX,z.y=b.clientY;const u=this._pointA.x-this._pointB.x,Y=this._pointA.y-this._pointB.y,l=u*u+Y*Y,T={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:b.pointerId,type:J.type};this.onMultiTouch(this._pointA,this._pointB,H,l,E,T),E=T,H=l}}else{try{null===g||void 0===g||g.releasePointerCapture(b.pointerId)}catch(M){}L||(this._pointB=null),u._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==b.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==b.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==H||E)&&(this.onMultiTouch(this._pointA,this._pointB,H,0,E,null),H=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(b),z||b.preventDefault()}else{try{null===g||void 0===g||g.setPointerCapture(b.pointerId)}catch(M){}if(null===this._pointA)this._pointA={x:b.clientX,y:b.clientY,pointerId:b.pointerId,type:b.pointerType};else{if(null!==this._pointB)return;this._pointB={x:b.clientX,y:b.clientY,pointerId:b.pointerId,type:b.pointerType}}-1!==this._currentMousePointerIdDown||L||(this._currentMousePointerIdDown=b.pointerId),this.onButtonDown(b),z||(b.preventDefault(),Y&&Y.focus())}}},this._observer=this.camera.iz()._inputManager._addCameraPointerObserver(this._pointerInput,D.d.POINTERDOWN|D.d.POINTERUP|D.d.POINTERMOVE|D.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,H=0,E=null,this.onLostFocus()},this._contextMenuBind=z=>this.onContextMenu(z),Y&&Y.addEventListener("contextmenu",this._contextMenuBind,!1);const J=this.camera.iz().getEngine().getHostWindow();J&&Z.e.RegisterTopRootEvents(J,[{name:"blur",handler:this._onLostFocus}])}EM(){if(this._onLostFocus){const z=this.camera.iz().getEngine().getHostWindow();z&&Z.e.UnregisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.iz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const z=this.camera.iz().getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(z){}onTouch(z,u,Y){}onMultiTouch(z,u,Y,H,E,J){}onContextMenu(z){z.preventDefault()}onButtonDown(z){}onButtonUp(z){}onLostFocus(){}}(0,H.e)([(0,E.L)()],s.prototype,"buttons",void 0);class v extends s{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(z,u){if(0!==this.panningSensibility&&z&&u){const Y=u.x-z.x,H=u.y-z.y;this.camera.inertialPanningX+=-Y/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility}}_computePinchZoom(z,u){const Y=this.camera.radius||v.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Y*Math.sqrt(z)/Math.sqrt(u):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(u-z)*Y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(u-z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(z,u,Y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=Y/this.panningSensibility):(this.camera.inertialAlphaOffset-=u/this.angularSensibilityX,this.camera.inertialBetaOffset-=Y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(z,u,Y,H,E,J){0===Y&&null===E||0===H&&null===J||(this.multiTouchPanAndZoom?(this._computePinchZoom(Y,H),this._computeMultiTouchPanning(E,J)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(H)-Math.sqrt(Y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Y,H),this._isPinching=!0):this._computeMultiTouchPanning(E,J)):this.multiTouchPanning?this._computeMultiTouchPanning(E,J):this.pinchZoom&&this._computePinchZoom(Y,H))}onButtonDown(z){this._isPanClick=z.button===this.camera._panningMouseButton}onButtonUp(z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}v.MinimumRadiusForPinch=.001,(0,H.e)([(0,E.L)()],v.prototype,"buttons",void 0),(0,H.e)([(0,E.L)()],v.prototype,"angularSensibilityX",void 0),(0,H.e)([(0,E.L)()],v.prototype,"angularSensibilityY",void 0),(0,H.e)([(0,E.L)()],v.prototype,"pinchPrecision",void 0),(0,H.e)([(0,E.L)()],v.prototype,"pinchDeltaPercentage",void 0),(0,H.e)([(0,E.L)()],v.prototype,"useNaturalPinchZoom",void 0),(0,H.e)([(0,E.L)()],v.prototype,"pinchZoom",void 0),(0,H.e)([(0,E.L)()],v.prototype,"panningSensibility",void 0),(0,H.e)([(0,E.L)()],v.prototype,"multiTouchPanning",void 0),(0,H.e)([(0,E.L)()],v.prototype,"multiTouchPanAndZoom",void 0),W.d.ArcRotateCameraPointersInput=v;var i=Y(11539);class X{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(z){z=Z.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.iz(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const Y=u.event;if(!Y.metaKey)if(u.type===i.d.KEYDOWN){if(this._ctrlPressed=Y.ctrlKey,this._altPressed=Y.altKey,-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),Y.preventDefault&&(z||Y.preventDefault())}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){const u=this._keys.indexOf(Y.keyCode);u>=0&&this._keys.splice(u,1),Y.preventDefault&&(z||Y.preventDefault())}})))}EM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let u=0;u<this._keys.length;u++){const Y=this._keys[u];-1!==this.keysLeft.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX-=1/this.panningSensibility:z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset+=1/this.zoomingSensibility:z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX+=1/this.panningSensibility:z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset-=1/this.zoomingSensibility:z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Y)&&z.useInputToRestoreState&&z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,H.e)([(0,E.L)()],X.prototype,"keysUp",void 0),(0,H.e)([(0,E.L)()],X.prototype,"keysDown",void 0),(0,H.e)([(0,E.L)()],X.prototype,"keysLeft",void 0),(0,H.e)([(0,E.L)()],X.prototype,"keysRight",void 0),(0,H.e)([(0,E.L)()],X.prototype,"keysReset",void 0),(0,H.e)([(0,E.L)()],X.prototype,"panningSensibility",void 0),(0,H.e)([(0,E.L)()],X.prototype,"zoomingSensibility",void 0),(0,H.e)([(0,E.L)()],X.prototype,"useAltToZoom",void 0),(0,H.e)([(0,E.L)()],X.prototype,"angularSpeed",void 0),W.d.ArcRotateCameraKeyboardMoveInput=X;var Q=Y(11170),V=Y(11545);class A{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new l.p(0,0,0),this._globalOffset=new l.p(0,0,0),this._inertialPanning=l.p.Zero()}_computeDeltaFromMouseWheelLegacyEvent(z,u){let Y=0;const H=.01*z*this.wheelDeltaPercentage*u;return Y=z>0?H/(1+this.wheelDeltaPercentage):H*(1+this.wheelDeltaPercentage),Y}attachControl(z){z=Z.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==D.d.POINTERWHEEL)return;const Y=u.event;let H=0;const E=Y.deltaMode===V.b.DOM_DELTA_LINE?40:1,J=-Y.deltaY*E;if(this.customComputeDeltaFromMouseWheel)H=this.customComputeDeltaFromMouseWheel(J,this,Y);else if(this.wheelDeltaPercentage){if(H=this._computeDeltaFromMouseWheelLegacyEvent(J,this.camera.radius),H>0){let z=this.camera.radius,u=this.camera.inertialRadiusOffset+H;for(let Y=0;Y<20&&!(z<=u)&&!(Math.abs(u*this.camera.inertia)<.001);Y++)z-=u,u*=this.camera.inertia;z=(0,T.Clamp)(z,0,Number.MAX_VALUE),H=this._computeDeltaFromMouseWheelLegacyEvent(J,z)}}else H=J/(40*this.wheelPrecision);H&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(H)):this.camera.inertialRadiusOffset+=H),Y.preventDefault&&(z||Y.preventDefault())},this._observer=this.camera.iz()._inputManager._addCameraPointerObserver(this._wheel,D.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Bl(0)}EM(){this._observer&&(this.camera.iz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const z=this.camera;0+z.inertialAlphaOffset+z.inertialBetaOffset+z.inertialRadiusOffset&&(this._updateHitPlane(),z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const z=this.camera,u=z.target.JY(z.position);this._hitPlane=Q.b.FromPositionAndNormal(z.target,u)}_getPosition(){const z=this.camera,u=z.iz(),Y=u.createPickingRay(u.pointerX,u.pointerY,l.b.Identity(),z,!1);0===z.targetScreenOffset.x&&0===z.targetScreenOffset.y||(this._viewOffset.set(z.targetScreenOffset.x,z.targetScreenOffset.y,0),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),this._globalOffset=l.p.TransformNormal(this._viewOffset,z._cameraTransformMatrix),Y.origin.addInPlace(this._globalOffset));let H=0;return this._hitPlane&&(H=Y.intersectsPlane(this._hitPlane)??0),Y.origin.addInPlace(Y.direction.scaleInPlace(H))}_zoomToMouse(z){const u=this.camera,Y=1-u.inertia;if(u.lowerRadiusLimit){const H=u.lowerRadiusLimit??0;u.radius-(u.inertialRadiusOffset+z)/Y<H&&(z=(u.radius-H)*Y-u.inertialRadiusOffset)}if(u.upperRadiusLimit){const H=u.upperRadiusLimit??0;u.radius-(u.inertialRadiusOffset+z)/Y>H&&(z=(u.radius-H)*Y-u.inertialRadiusOffset)}const H=z/Y/u.radius,E=this._getPosition(),J=l.i.Pl[6];E.subtractToRef(u.target,J),J.scaleInPlace(H),J.scaleInPlace(Y),this._inertialPanning.addInPlace(J),u.inertialRadiusOffset+=z}_zeroIfClose(z){Math.abs(z.x)<M.e&&(z.x=0),Math.abs(z.y)<M.e&&(z.y=0),Math.abs(z.z)<M.e&&(z.z=0)}}(0,H.e)([(0,E.L)()],A.prototype,"wheelPrecision",void 0),(0,H.e)([(0,E.L)()],A.prototype,"zoomToMouseLocation",void 0),(0,H.e)([(0,E.L)()],A.prototype,"wheelDeltaPercentage",void 0),W.d.ArcRotateCameraMouseWheelInput=A;class x extends W.h{constructor(z){super(z)}addMouseWheel(){return this.add(new A),this}addPointers(){return this.add(new v),this}addKeyboard(){return this.add(new X),this}}var G=Y(10918);function F(z,u){return isNaN(z)?u:z}b.b.AddNodeConstructor("ArcRotateCamera",((z,u)=>()=>new R(z,0,0,1,l.p.Zero(),u)));class R extends t.b{get target(){return this._target}set target(z){this.setTarget(z)}get targetHost(){return this._targetHost}set targetHost(z){z&&this.setTarget(z)}getTarget(){return this.target}get position(){return this._position}set position(z){this.setPosition(z)}set upVector(z){this._upToYMatrix||(this._yToUpMatrix=new l.b,this._upToYMatrix=new l.b,this._upVector=l.p.Zero()),z.normalize(),this._upVector.J(z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){l.b.RotationAlignToRef(l.p.UpReadOnly,this._upVector,this._yToUpMatrix),l.b.RotationAlignToRef(this._upVector,l.p.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityX:0}set angularSensibilityX(z){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityX=z)}get angularSensibilityY(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityY:0}set angularSensibilityY(z){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityY=z)}get pinchPrecision(){const z=this.inputs.attached.pointers;return z?z.pinchPrecision:0}set pinchPrecision(z){const u=this.inputs.attached.pointers;u&&(u.pinchPrecision=z)}get pinchDeltaPercentage(){const z=this.inputs.attached.pointers;return z?z.pinchDeltaPercentage:0}set pinchDeltaPercentage(z){const u=this.inputs.attached.pointers;u&&(u.pinchDeltaPercentage=z)}get useNaturalPinchZoom(){const z=this.inputs.attached.pointers;return!!z&&z.useNaturalPinchZoom}set useNaturalPinchZoom(z){const u=this.inputs.attached.pointers;u&&(u.useNaturalPinchZoom=z)}get panningSensibility(){const z=this.inputs.attached.pointers;return z?z.panningSensibility:0}set panningSensibility(z){const u=this.inputs.attached.pointers;u&&(u.panningSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysUp=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysDown=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRight=z)}get wheelPrecision(){const z=this.inputs.attached.mousewheel;return z?z.wheelPrecision:0}set wheelPrecision(z){const u=this.inputs.attached.mousewheel;u&&(u.wheelPrecision=z)}get zoomToMouseLocation(){const z=this.inputs.attached.mousewheel;return!!z&&z.zoomToMouseLocation}set zoomToMouseLocation(z){const u=this.inputs.attached.mousewheel;u&&(u.zoomToMouseLocation=z)}get wheelDeltaPercentage(){const z=this.inputs.attached.mousewheel;return z?z.wheelDeltaPercentage:0}set wheelDeltaPercentage(z){const u=this.inputs.attached.mousewheel;u&&(u.wheelDeltaPercentage=z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(z){z!==this.useBouncingBehavior&&(z?(this._bouncingBehavior=new h,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(z){z!==this.useFramingBehavior&&(z?(this._framingBehavior=new o,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(z){z!==this.useAutoRotationBehavior&&(z?(this._autoRotationBehavior=new q,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(z,u,Y,H,E,T){var b;let L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(z,l.p.Zero(),T,L),b=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=l.p.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=l.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new l.b,this.panningAxis=new l.p(1,1,0),this._transformedDirection=new l.p,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new J.e,this.checkCollisions=!1,this.collisionRadius=new l.p(.5,.5,.5),this._previousPosition=l.p.Zero(),this._collisionVelocity=l.p.Zero(),this._newPosition=l.p.Zero(),this._computationVector=l.p.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new l.p(NaN,NaN,NaN),this._goalTargetScreenOffset=new l.m(NaN,NaN),this._onCollisionPositionChange=function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y?(b.setPosition(u),b.yq&&b.yq(Y)):b._previousPosition.J(b._position);const H=Math.cos(b.alpha),E=Math.sin(b.alpha),J=Math.cos(b.beta);let l=Math.sin(b.beta);0===l&&(l=1e-4);const T=b._getTargetPosition();b._computationVector.kl(b.radius*H*l,b.radius*J,b.radius*E*l),T.addToRef(b._computationVector,b._newPosition),b._position.J(b._newPosition);let L=b.upVector;b.allowUpsideDown&&b.beta<0&&(L=L.clone(),L=L.negate()),b._computeViewMatrix(b._position,T,L),b._viewMatrix.addAtIndex(12,b.targetScreenOffset.x),b._viewMatrix.addAtIndex(13,b.targetScreenOffset.y),b._collisionTriggered=!1},this._target=l.p.Zero(),E&&this.setTarget(E),this.alpha=u,this.beta=Y,this.radius=H,this.getViewMatrix(),this.inputs=new x(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new l.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=l.m.Zero()}_updateCache(z){z||super._updateCache(),this._cache._target.J(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.J(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?z.addToRef(this._targetBoundingCenter,this._target):this._target.J(z)}const z=this._getLockedTargetPosition();return z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>M.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,J=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=J?this._currentInterpolationFactor=J:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=F(z,this._goalAlpha),this._goalBeta=F(u,this._goalBeta),this._goalRadius=F(Y,this._goalRadius),this._goalTarget.set(F(H.x,this._goalTarget.x),F(H.y,this._goalTarget.y),F(H.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(F(E.x,this._goalTargetScreenOffset.x),F(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,T.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,T.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,T.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,T.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;u=Z.e.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=Y,this._panningMouseButton=H,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(u),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}EM(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){z=!0;const u=this.invertRotation?-1:1,Y=this._calculateHandednessMultiplier();let H=this.inertialAlphaOffset*Y;this.beta<0&&(H*=-1),this.alpha+=H*u,this.beta+=this.inertialBetaOffset*u,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<M.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<M.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*M.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){z=!0;const u=new l.p(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),l.p.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const z=this.upVector,u=l.p.CrossToRef(this._transformedDirection,z,this._transformedDirection);l.p.CrossToRef(z,u,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);l.p.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.J(this._transformedDirection)}else{if(this.parent){const z=l.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(z),z.transposeToRef(z),l.p.TransformCoordinatesToRef(this._transformedDirection,z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*M.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*M.e&&(this.inertialPanningY=0)}if(z)this.stopInterpolation();else if(this._isInterpolating){let z=!1;const u=this._scene.getEngine().getDeltaTime()/1e3,Y=1-Math.pow(2,-u/this._currentInterpolationFactor),H=F(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const u=l.i.Pl[0].set(F(this._goalTarget.x,this._target.x),F(this._goalTarget.y,this._target.y),F(this._goalTarget.z,this._target.z));l.p.LerpToRef(this.target,u,Y,this._target),10*l.p.Distance(this.target,u)/H<M.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.J(u),this.setTarget(this.target,!1,!0,!0)):z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const u=l.f.RotationAlphaBetaGammaToRef(F(this._goalAlpha,this.alpha),F(this._goalBeta,this.beta),0,l.i.Quaternion[0]),H=l.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,l.i.Quaternion[1]),E=l.f.SlerpToRef(H,u,Y,l.i.Quaternion[2]);E.normalize();const J=E.toAlphaBetaGammaToRef(l.i.Pl[0]);if(this.alpha=J.x,this.beta=J.y,E.isApprox(u,M.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const z=u.toAlphaBetaGammaToRef(l.i.Pl[0]);this.alpha=z.x,this.beta=z.y}else z=!0}if(isNaN(this._goalRadius)||(this.radius+=(H-this.radius)*Y,Math.abs(H/this.radius-1)<M.e?(this._goalRadius=NaN,this.radius=H):z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const u=l.i.Vector2[0].set(F(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),F(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));l.m.LerpToRef(this.targetScreenOffset,u,Y,this.targetScreenOffset),l.m.Distance(this.targetScreenOffset,u)<M.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.J(u)):z=!0}this._isInterpolating=z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||l.p.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const z=this.alpha;var u,Y;this.alpha=function(z){let u=Math.PI/2;return 0===z.x&&0===z.z||(u=Math.acos(z.x/Math.sqrt(Math.pow(z.x,2)+Math.pow(z.z,2)))),z.z<0&&(u=2*Math.PI-u),u}(this._computationVector),this.beta=(u=this._computationVector.y,Y=this.radius,Math.acos(u/Y));const H=Math.round((z-this.alpha)/(2*Math.PI));this.alpha+=2*H*Math.PI,this._checkLimits()}setPosition(z){this._position.equals(z)||(this._position.J(z),this.rebuildAnglesAndRadius())}setTarget(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(H=this.overrideCloneAlphaBetaRadius??H,z.pl)u&&z.getBoundingInfo?this._targetBoundingCenter=z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,z.pl(),this._targetHost=z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const u=z,H=this._getTargetPosition();if(H&&!Y&&H.equals(u))return;this._targetHost=null,this._target=u,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}H||this.rebuildAnglesAndRadius()}_getViewMatrix(){const z=Math.cos(this.alpha),u=Math.sin(this.alpha),Y=Math.cos(this.beta);let H=Math.sin(this.beta);0===H&&(H=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.kl(this.radius*z*H,this.radius*Y,this.radius*u*H),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||l.p.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.iz().collisionsEnabled&&this.checkCollisions){const z=this.iz().collisionCoordinator;this._collider||(this._collider=z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.J(this._newPosition);let z=this.upVector;this.allowUpsideDown&&H<0&&(z=z.negate()),this._computeViewMatrix(this._position,E,z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.J(E),this._viewMatrix}zoomOn(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=z||this.iz().meshes;const Y=L.b.MinMax(z);let H=this._calculateLowerRadiusFromModelBoundingSphere(Y.min,Y.max);if(H=Math.max(Math.min(H,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=H*this.zoomOnFactor,this.mode===d.d.ORTHOGRAPHIC_CAMERA){const z=this.iz().getEngine().getAspectRatio(this),u=H*this.zoomOnFactor/2;this.orthoLeft=-u*z,this.orthoRight=u*z,this.orthoBottom=-u,this.orthoTop=u}this.focusOn({min:Y.min,max:Y.max,distance:H},u)}focusOn(z){let u,Y,H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===z.min){const H=z||this.iz().meshes;u=L.b.MinMax(H),Y=l.p.Distance(u.min,u.max)}else{u=z,Y=z.distance}this._target=L.b.Center(u),H||(this.maxZ=2*Y)}createRigCamera(z,u){let Y=0;switch(this.cameraRigMode){case d.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.d.RIG_MODE_VR:Y=this._cameraRigParams.stereoHalfAngle*(0===u?1:-1);break;case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Y=this._cameraRigParams.stereoHalfAngle*(0===u?-1:1)}const H=new R(z,this.alpha+Y,this.beta,this.radius,this._target,this.iz());return H._cameraRigParams={},H.isRigCamera=!0,H.rigParent=this,H.upVector=this.upVector,H.mode=this.mode,H.orthoLeft=this.orthoLeft,H.orthoRight=this.orthoRight,H.orthoBottom=this.orthoBottom,H.orthoTop=this.orthoTop,H}_updateRigCameras(){const z=this._rigCameras[0],u=this._rigCameras[1];switch(z.beta=u.beta=this.beta,this.cameraRigMode){case d.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.d.RIG_MODE_VR:z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const H=l.p.Distance(z,u),E=this.iz().getEngine().getAspectRatio(this),J=Math.tan(this.fov/2),T=J*E,b=.5*H*Y,L=b*Math.sqrt(1+1/(T*T)),D=b*Math.sqrt(1+1/(J*J));return Math.max(L,D)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,H.e)([(0,E.L)()],R.prototype,"alpha",void 0),(0,H.e)([(0,E.L)()],R.prototype,"beta",void 0),(0,H.e)([(0,E.L)()],R.prototype,"radius",void 0),(0,H.e)([(0,E.L)()],R.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,H.e)([(0,E.K)("target")],R.prototype,"_target",void 0),(0,H.e)([(0,E.x)("targetHost")],R.prototype,"_targetHost",void 0),(0,H.e)([(0,E.L)()],R.prototype,"inertialAlphaOffset",void 0),(0,H.e)([(0,E.L)()],R.prototype,"inertialBetaOffset",void 0),(0,H.e)([(0,E.L)()],R.prototype,"inertialRadiusOffset",void 0),(0,H.e)([(0,E.L)()],R.prototype,"lowerAlphaLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"upperAlphaLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"lowerBetaLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"upperBetaLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"lowerRadiusLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"upperRadiusLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"lowerTargetYLimit",void 0),(0,H.e)([(0,E.L)()],R.prototype,"inertialPanningX",void 0),(0,H.e)([(0,E.L)()],R.prototype,"inertialPanningY",void 0),(0,H.e)([(0,E.L)()],R.prototype,"pinchToPanMaxDistance",void 0),(0,H.e)([(0,E.L)()],R.prototype,"panningDistanceLimit",void 0),(0,H.e)([(0,E.K)()],R.prototype,"panningOriginTarget",void 0),(0,H.e)([(0,E.L)()],R.prototype,"panningInertia",void 0),(0,H.e)([(0,E.L)()],R.prototype,"zoomToMouseLocation",null),(0,H.e)([(0,E.L)()],R.prototype,"zoomOnFactor",void 0),(0,H.e)([(0,E.G)()],R.prototype,"targetScreenOffset",void 0),(0,H.e)([(0,E.L)()],R.prototype,"allowUpsideDown",void 0),(0,H.e)([(0,E.L)()],R.prototype,"useInputToRestoreState",void 0),(0,H.e)([(0,E.L)()],R.prototype,"restoreStateInterpolationFactor",void 0),(0,G.d)("BABYLON.ArcRotateCamera",R)},12448:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>l,h:()=>T});var H=Y(10953),E=Y(11172),J=Y(11275),l={};class T{constructor(z){this.attachedToElement=!1,this.attached={},this.camera=z,this.checkInputs=()=>{}}add(z){const u=z.getSimpleName();this.attached[u]?H.b.Warn("camera input of type "+u+" already exists on camera"):(this.attached[u]=z,z.camera=this.camera,z.checkInputs&&(this.checkInputs=this._addCheckInputs(z.checkInputs.bind(z))),this.attachedToElement&&z.attachControl(this.noPreventDefault))}remove(z){for(const u in this.attached){const Y=this.attached[u];if(Y===z)return Y.EM(),Y.camera=null,delete this.attached[u],void this.rebuildInputCheck()}}removeByType(z){for(const u in this.attached){const Y=this.attached[u];Y.getClassName()===z&&(Y.EM(),Y.camera=null,delete this.attached[u],this.rebuildInputCheck())}}_addCheckInputs(z){const u=this.checkInputs;return()=>{u(),z()}}attachInput(z){this.attachedToElement&&z.attachControl(this.noPreventDefault)}attachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){z=!J.d.ForceAttachControlToAlwaysPreventDefault&&z,this.attachedToElement=!0,this.noPreventDefault=z;for(const u in this.attached)this.attached[u].attachControl(z)}}detachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const u in this.attached)this.attached[u].EM(),z&&(this.attached[u].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const z in this.attached){const u=this.attached[z];u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(z){const u={};for(const Y in this.attached){const z=this.attached[Y],H=E.d.Serialize(z);u[z.getClassName()]=H}z.inputsmgr=u}parse(z){const u=z.inputsmgr;if(u){this.clear();for(const z in u){const Y=l[z];if(Y){const H=u[z],J=E.d.Parse((()=>new Y),H,null);this.add(J)}}}else for(const Y in this.attached){const u=l[this.attached[Y].getClassName()];if(u){const H=E.d.Parse((()=>new u),z,null);this.remove(this.attached[Y]),this.add(H)}}}}},12439:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>s});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11475),T=Y(12448),b=Y(11539),L=Y(10945);class D{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(z){z=L.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.iz(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const Y=u.event;if(!Y.metaKey)if(u.type===b.d.KEYDOWN){if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),z||Y.preventDefault()}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){const u=this._keys.indexOf(Y.keyCode);u>=0&&this._keys.splice(u,1),z||Y.preventDefault()}})))}EM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let u=0;u<this._keys.length;u++){const Y=this._keys[u],H=z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Y)?z._localDirection.kl(-H,0,0):-1!==this.keysUp.indexOf(Y)?z._localDirection.kl(0,0,H):-1!==this.keysRight.indexOf(Y)?z._localDirection.kl(H,0,0):-1!==this.keysDown.indexOf(Y)?z._localDirection.kl(0,0,-H):-1!==this.keysUpward.indexOf(Y)?z._localDirection.kl(0,H,0):-1!==this.keysDownward.indexOf(Y)?z._localDirection.kl(0,-H,0):-1!==this.keysRotateLeft.indexOf(Y)?(z._localDirection.kl(0,0,0),z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Y)?(z._localDirection.kl(0,0,0),z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Y)?(z._localDirection.kl(0,0,0),z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Y)&&(z._localDirection.kl(0,0,0),z.cameraRotation.x+=this._getLocalRotation()),z.iz().useRightHandedSystem&&(z._localDirection.z*=-1),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),J.p.TransformNormalToRef(z._localDirection,z._cameraTransformMatrix,z._transformedDirection),z.cameraDirection.addInPlace(z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*z}}(0,H.e)([(0,E.L)()],D.prototype,"keysUp",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysUpward",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysDown",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysDownward",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysLeft",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysRight",void 0),(0,H.e)([(0,E.L)()],D.prototype,"rotationSpeed",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysRotateLeft",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysRotateRight",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysRotateUp",void 0),(0,H.e)([(0,E.L)()],D.prototype,"keysRotateDown",void 0),T.d.FreeCameraKeyboardMoveInput=D;var g=Y(10932),M=Y(11530);class q{constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new g.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(z){z=L.e.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),Y=u.getInputElement();this._pointerInput||(this._pointerInput=H=>{const E=H.event,J="touch"===E.pointerType;if(!this.touchEnabled&&J)return;if(H.type!==M.d.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const l=E.target;if(H.type===M.d.POINTERDOWN){if(J&&-1!==this._activePointerId||!J&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===l||void 0===l||l.setPointerCapture(E.pointerId)}catch(T){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},z||(E.preventDefault(),Y&&Y.focus()),u.isPointerLock&&this._onMouseMove&&this._onMouseMove(H.event)}else if(H.type===M.d.POINTERUP){if(J&&this._activePointerId!==E.pointerId||!J&&this._currentActiveButton!==E.button)return;try{null===l||void 0===l||l.releasePointerCapture(E.pointerId)}catch(T){}this._currentActiveButton=-1,this._previousPosition=null,z||E.preventDefault(),this._activePointerId=-1}else if(H.type===M.d.POINTERMOVE&&(this._activePointerId===E.pointerId||!J))if(u.isPointerLock&&this._onMouseMove)this._onMouseMove(H.event);else if(this._previousPosition){const u=this.camera._calculateHandednessMultiplier(),Y=(E.clientX-this._previousPosition.x)*u,H=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Y/this.angularSensibility,this.camera.cameraRotation.x+=H/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Y,offsetY:H}),this._previousPosition={x:E.clientX,y:E.clientY},z||E.preventDefault()}}),this._onMouseMove=Y=>{if(!u.isPointerLock)return;const H=this.camera._calculateHandednessMultiplier(),E=Y.movementX*H;this.camera.cameraRotation.y+=E/this.angularSensibility;const J=Y.movementY;this.camera.cameraRotation.x+=J/this.angularSensibility,this._previousPosition=null,z||Y.preventDefault()},this._observer=this.camera.iz()._inputManager._addCameraPointerObserver(this._pointerInput,M.d.POINTERDOWN|M.d.POINTERUP|M.d.POINTERMOVE),Y&&(this._contextMenuBind=z=>this.onContextMenu(z),Y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(z){z.preventDefault()}EM(){if(this._observer){if(this.camera.iz()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,H.e)([(0,E.L)()],q.prototype,"buttons",void 0),(0,H.e)([(0,E.L)()],q.prototype,"angularSensibility",void 0),T.d.FreeCameraMouseInput=q;var C,K=Y(11545);class h{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new g.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(z){z=L.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==M.d.POINTERWHEEL)return;const Y=u.event,H=Y.deltaMode===K.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*H*Y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*H*Y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*H*Y.deltaZ/this._normalize,Y.preventDefault&&(z||Y.preventDefault())},this._observer=this.camera.iz()._inputManager._addCameraPointerObserver(this._wheel,M.d.POINTERWHEEL)}EM(){this._observer&&(this.camera.iz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,H.e)([(0,E.L)()],h.prototype,"wheelPrecisionX",void 0),(0,H.e)([(0,E.L)()],h.prototype,"wheelPrecisionY",void 0),(0,H.e)([(0,E.L)()],h.prototype,"wheelPrecisionZ",void 0),function(z){z[z.MoveRelative=0]="MoveRelative",z[z.RotateRelative=1]="RotateRelative",z[z.MoveScene=2]="MoveScene"}(C||(C={}));class o extends h{constructor(){super(...arguments),this._moveRelative=J.p.Zero(),this._rotateRelative=J.p.Zero(),this._moveScene=J.p.Zero(),this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(z){null===z&&this._wheelXAction!==C.MoveRelative||(this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=z)}get wheelXMoveRelative(){return this._wheelXAction!==C.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(z){null===z&&this._wheelYAction!==C.MoveRelative||(this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=z)}get wheelYMoveRelative(){return this._wheelYAction!==C.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(z){null===z&&this._wheelZAction!==C.MoveRelative||(this._wheelZAction=C.MoveRelative,this._wheelZActionCoordinate=z)}get wheelZMoveRelative(){return this._wheelZAction!==C.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(z){null===z&&this._wheelXAction!==C.RotateRelative||(this._wheelXAction=C.RotateRelative,this._wheelXActionCoordinate=z)}get wheelXRotateRelative(){return this._wheelXAction!==C.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(z){null===z&&this._wheelYAction!==C.RotateRelative||(this._wheelYAction=C.RotateRelative,this._wheelYActionCoordinate=z)}get wheelYRotateRelative(){return this._wheelYAction!==C.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(z){null===z&&this._wheelZAction!==C.RotateRelative||(this._wheelZAction=C.RotateRelative,this._wheelZActionCoordinate=z)}get wheelZRotateRelative(){return this._wheelZAction!==C.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(z){null===z&&this._wheelXAction!==C.MoveScene||(this._wheelXAction=C.MoveScene,this._wheelXActionCoordinate=z)}get wheelXMoveScene(){return this._wheelXAction!==C.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(z){null===z&&this._wheelYAction!==C.MoveScene||(this._wheelYAction=C.MoveScene,this._wheelYActionCoordinate=z)}get wheelYMoveScene(){return this._wheelYAction!==C.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(z){null===z&&this._wheelZAction!==C.MoveScene||(this._wheelZAction=C.MoveScene,this._wheelZActionCoordinate=z)}get wheelZMoveScene(){return this._wheelZAction!==C.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Bl(0),this._rotateRelative.Bl(0),this._moveScene.Bl(0),this._updateCamera(),this.camera.iz().useRightHandedSystem&&(this._moveRelative.z*=-1);const z=J.b.Zero();this.camera.getViewMatrix().invertToRef(z);const u=J.p.Zero();J.p.TransformNormalToRef(this._moveRelative,z,u),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(u),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(z,u,Y){if(0===z)return;if(null===u||null===Y)return;let H=null;switch(u){case C.MoveRelative:H=this._moveRelative;break;case C.RotateRelative:H=this._rotateRelative;break;case C.MoveScene:H=this._moveScene}switch(Y){case 0:H.set(z,0,0);break;case 1:H.set(0,z,0);break;case 2:H.set(0,0,z)}}}(0,H.e)([(0,E.L)()],o.prototype,"wheelXMoveRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelYMoveRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelZMoveRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelXRotateRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelYRotateRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelZRotateRelative",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelXMoveScene",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelYMoveScene",null),(0,H.e)([(0,E.L)()],o.prototype,"wheelZMoveScene",null),T.d.FreeCameraMouseWheelInput=o;class d{constructor(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=L.e.IsSafari()}attachControl(z){z=L.e.BackCompatCameraNoPreventDefault(arguments);let u=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Y=>{const H=Y.event,E="mouse"===H.pointerType||this._isSafari&&"undefined"===typeof H.pointerType;if(this.allowMouse||!E)if(Y.type===M.d.POINTERDOWN){if(z||H.preventDefault(),this._pointerPressed.push(H.pointerId),1!==this._pointerPressed.length)return;u={x:H.clientX,y:H.clientY}}else if(Y.type===M.d.POINTERUP){z||H.preventDefault();const Y=this._pointerPressed.indexOf(H.pointerId);if(-1===Y)return;if(this._pointerPressed.splice(Y,1),0!=Y)return;u=null,this._offsetX=null,this._offsetY=null}else if(Y.type===M.d.POINTERMOVE){if(z||H.preventDefault(),!u)return;if(0!=this._pointerPressed.indexOf(H.pointerId))return;this._offsetX=H.clientX-u.x,this._offsetY=-(H.clientY-u.y)}}),this._observer=this.camera.iz()._inputManager._addCameraPointerObserver(this._pointerInput,M.d.POINTERDOWN|M.d.POINTERUP|M.d.POINTERMOVE),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.addEventListener("blur",this._onLostFocus)}}EM(){if(this._pointerInput){if(this._observer&&(this.camera.iz()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const z=this.camera,u=z._calculateHandednessMultiplier();z.cameraRotation.y=u*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const u=z._computeLocalCameraSpeed(),Y=new J.p(0,0,0!==this.touchMoveSensibility?u*this._offsetY/this.touchMoveSensibility:0);J.b.RotationYawPitchRollToRef(z.rotation.y,z.rotation.x,0,z._cameraRotationMatrix),z.cameraDirection.addInPlace(J.p.TransformCoordinates(Y,z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,H.e)([(0,E.L)()],d.prototype,"touchAngularSensibility",void 0),(0,H.e)([(0,E.L)()],d.prototype,"touchMoveSensibility",void 0),T.d.FreeCameraTouchInput=d;class t extends T.h{constructor(z){super(z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new D),this}addMouse(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new q(z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new o,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new d),this}clear(){super.clear(),this._mouseInput=null}}var W=Y(10918),Z=Y(11018);class s extends l.b{get angularSensibility(){const z=this.inputs.attached.mouse;return z?z.angularSensibility:0}set angularSensibility(z){const u=this.inputs.attached.mouse;u&&(u.angularSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysUp=z)}get keysUpward(){const z=this.inputs.attached.keyboard;return z?z.keysUpward:[]}set keysUpward(z){const u=this.inputs.attached.keyboard;u&&(u.keysUpward=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysDown=z)}get keysDownward(){const z=this.inputs.attached.keyboard;return z?z.keysDownward:[]}set keysDownward(z){const u=this.inputs.attached.keyboard;u&&(u.keysDownward=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRight=z)}get keysRotateLeft(){const z=this.inputs.attached.keyboard;return z?z.keysRotateLeft:[]}set keysRotateLeft(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateLeft=z)}get keysRotateRight(){const z=this.inputs.attached.keyboard;return z?z.keysRotateRight:[]}set keysRotateRight(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateRight=z)}get keysRotateUp(){const z=this.inputs.attached.keyboard;return z?z.keysRotateUp:[]}set keysRotateUp(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateUp=z)}get keysRotateDown(){const z=this.inputs.attached.keyboard;return z?z.keysRotateDown:[]}set keysRotateDown(z){const u=this.inputs.attached.keyboard;u&&(u.keysRotateDown=z)}constructor(z,u,Y){var H;super(z,u,Y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),H=this,this.ellipsoid=new J.p(.5,1,.5),this.ellipsoidOffset=new J.p(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=J.p.Zero(),this._diffPosition=J.p.Zero(),this._newPosition=J.p.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H._newPosition.J(u),H._newPosition.subtractToRef(H._oldPosition,H._diffPosition),H._diffPosition.length()>Z.e.CollisionsEpsilon&&(H.position.addToRef(H._diffPosition,H._deferredPositionUpdate),H._deferOnly?H._deferredUpdated=!0:H.position.J(H._deferredPositionUpdate),H.yq&&Y&&H.yq(Y))},this.inputs=new t(this),this.inputs.addKeyboard().addMouse()}attachControl(z,u){u=L.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(u)}EM(){this.inputs.detachElement(),this.cameraDirection=new J.p(0,0,0),this.cameraRotation=new J.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(z){this._collisionMask=isNaN(z)?-1:z}_collideWithWorld(z){let u;u=this.parent?J.p.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,u.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Y=this.iz().collisionCoordinator;this._collider||(this._collider=Y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let H=z;this.applyGravity&&(H=z.add(this.iz().gravity)),Y.getNewPosition(this._oldPosition,H,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=J.p.Zero(),this._transformedDirection=J.p.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(z){this._needMoveForGravity=z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.iz().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Eb"}}(0,H.e)([(0,E.K)()],s.prototype,"ellipsoid",void 0),(0,H.e)([(0,E.K)()],s.prototype,"ellipsoidOffset",void 0),(0,H.e)([(0,E.L)()],s.prototype,"checkCollisions",void 0),(0,H.e)([(0,E.L)()],s.prototype,"applyGravity",void 0),(0,W.d)("BABYLON.FreeCamera",s)},12983:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>J});var H=Y(11283),E=Y(12987);class J{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Y,this.Cg=[],this._maxBlockCapacity=u||64,this._selectionContent=new H.d(1024),this._creationFunc=z}update(z,u,Y){E.c._CreateBlocks(z,u,Y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}CD(z){for(let u=0;u<this.VD.length;u++){this.VD[u].addEntry(z)}}qD(z){for(let u=0;u<this.VD.length;u++){this.VD[u].removeEntry(z)}}select(z,u){this._selectionContent.reset();for(let Y=0;Y<this.VD.length;Y++){this.VD[Y].select(z,this._selectionContent,u)}return u?this._selectionContent.concat(this.Cg):this._selectionContent.concatWithNoDuplicate(this.Cg),this._selectionContent}intersects(z,u,Y){this._selectionContent.reset();for(let H=0;H<this.VD.length;H++){this.VD[H].intersects(z,u,this._selectionContent,Y)}return Y?this._selectionContent.concat(this.Cg):this._selectionContent.concatWithNoDuplicate(this.Cg),this._selectionContent}intersectsRay(z){this._selectionContent.reset();for(let u=0;u<this.VD.length;u++){this.VD[u].intersectsRay(z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Cg),this._selectionContent}}J.CreationFuncForMeshes=(z,u)=>{const Y=z.getBoundingInfo();!z.isBlocked&&Y.boundingBox.intersectsMinMax(u.tg,u.Wg)&&u.entries.push(z)},J.CreationFuncForSubMeshes=(z,u)=>{z.getBoundingInfo().boundingBox.intersectsMinMax(u.tg,u.Wg)&&u.entries.push(z)}},12987:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>J});var H=Y(10903),E=Y(11136);class J{constructor(z,u,Y,H,E,J){this.entries=[],this.ig=new Array,this._capacity=Y,this._depth=H,this._maxDepth=E,this._creationFunc=J,this._minPoint=z,this._maxPoint=u,this.ig.push(z.clone()),this.ig.push(u.clone()),this.ig.push(z.clone()),this.ig[2].x=u.x,this.ig.push(z.clone()),this.ig[3].y=u.y,this.ig.push(z.clone()),this.ig[4].z=u.z,this.ig.push(u.clone()),this.ig[5].z=z.z,this.ig.push(u.clone()),this.ig[6].x=z.x,this.ig.push(u.clone()),this.ig[7].y=z.y}get vY(){return this._capacity}get tg(){return this._minPoint}get Wg(){return this._maxPoint}addEntry(z){if(this.VD)for(let u=0;u<this.VD.length;u++){this.VD[u].addEntry(z)}else this._creationFunc(z,this),this.entries.length>this.vY&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(z){if(this.VD){for(let u=0;u<this.VD.length;u++){this.VD[u].removeEntry(z)}return}const u=this.entries.indexOf(z);u>-1&&this.entries.splice(u,1)}addEntries(z){for(let u=0;u<z.length;u++){const Y=z[u];this.addEntry(Y)}}select(z,u,Y){if(E.c.IsInFrustum(this.ig,z)){if(this.VD){for(let H=0;H<this.VD.length;H++){this.VD[H].select(z,u,Y)}return}Y?u.concat(this.entries):u.concatWithNoDuplicate(this.entries)}}intersects(z,u,Y,H){if(E.c.IntersectsSphere(this._minPoint,this._maxPoint,z,u)){if(this.VD){for(let E=0;E<this.VD.length;E++){this.VD[E].intersects(z,u,Y,H)}return}H?Y.concat(this.entries):Y.concatWithNoDuplicate(this.entries)}}intersectsRay(z,u){if(z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.VD){for(let Y=0;Y<this.VD.length;Y++){this.VD[Y].intersectsRay(z,u)}return}u.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){J._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(z,u,Y,E,l,T,b,L){b.VD=new Array;const D=new H.p((u.x-z.x)/2,(u.y-z.y)/2,(u.z-z.z)/2);for(let H=0;H<2;H++)for(let u=0;u<2;u++)for(let g=0;g<2;g++){const M=z.add(D.multiplyByFloats(H,u,g)),q=z.add(D.multiplyByFloats(H+1,u+1,g+1)),C=new J(M,q,E,l+1,T,L);C.addEntries(Y),b.VD.push(C)}}}},12993:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>D});var H=Y(11504),E=Y(10903),J=Y(11229),l=Y(12221),T=Y(11320),b=Y(12983),L=Y(10928);H.d.prototype.createOrUpdateSelectionOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Y=this._getComponent(T.c.NAME_OCTREE);Y||(Y=new D(this),this.ml(Y)),this.Mg||(this.Mg=new b.d(b.d.CreationFuncForMeshes,z,u));const H=this.getWorldExtends();return this.Mg.update(H.min,H.max,this.meshes),this.Mg},Object.defineProperty(H.d.prototype,"selectionOctree",{get:function(){return this.Mg},enumerable:!0,configurable:!0}),J.b.prototype.createOrUpdateSubmeshesOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Y=this.iz();let H=Y._getComponent(T.c.NAME_OCTREE);H||(H=new D(Y),Y.ml(H)),this._submeshesOctree||(this._submeshesOctree=new b.d(b.d.CreationFuncForSubMeshes,z,u)),this.pl(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.YT),this._submeshesOctree};class D{constructor(z){this.name=T.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new l.c(E.p.Zero(),new E.p(1,1,1)),(z=z||L.d.LastCreatedScene)&&(this.Cu=z,this.Cu.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Cu.getActiveSubMeshCandidates=z=>this.getActiveSubMeshCandidates(z),this.Cu.getCollidingSubMeshCandidates=(z,u)=>this.getCollidingSubMeshCandidates(z,u),this.Cu.getIntersectingSubMeshCandidates=(z,u)=>this.getIntersectingSubMeshCandidates(z,u))}register(){this.Cu.onMeshRemovedObservable.add((z=>{const u=this.Cu.selectionOctree;if(void 0!==u&&null!==u){const Y=u.Cg.indexOf(z);-1!==Y&&u.Cg.splice(Y,1)}})),this.Cu.onMeshImportedObservable.add((z=>{const u=this.Cu.selectionOctree;void 0!==u&&null!==u&&u.CD(z)}))}getActiveMeshCandidates(){var z;return(null===(z=this.Cu.Mg)||void 0===z?void 0:z.select(this.Cu.frustumPlanes))||this.Cu._getDefaultMeshCandidates()}getActiveSubMeshCandidates(z){if(z._submeshesOctree&&z.useOctreeForRenderingSelection){return z._submeshesOctree.select(this.Cu.frustumPlanes)}return this.Cu._getDefaultSubMeshCandidates(z)}getIntersectingSubMeshCandidates(z,u){if(z._submeshesOctree&&z.useOctreeForPicking){l.c.TransformToRef(u,z.getWorldMatrix(),this._tempRay);return z._submeshesOctree.intersectsRay(this._tempRay)}return this.Cu._getDefaultSubMeshCandidates(z)}getCollidingSubMeshCandidates(z,u){if(z._submeshesOctree&&z.useOctreeForCollisions){const Y=u._velocityWorldLength+Math.max(u._radius.x,u._radius.y,u._radius.z);return z._submeshesOctree.intersects(u._basePointWorld,Y)}return this.Cu._getDefaultSubMeshCandidates(z)}rebuild(){}dispose(){}}},12221:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>q});var H=Y(11504),E=Y(11275),J=Y(10906),l=Y(10903),T=Y(10910),b=Y(11124),L=Y(11248),D=Y(10928),g=Y(11547);const M={internalPickerForMesh:void 0};class q{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.e;this.origin=z,this.direction=u,this.length=Y,this.epsilon=H}clone(){return new q(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=q._TmpVector3[0].kl(z.x-Y,z.y-Y,z.z-Y),E=q._TmpVector3[1].kl(u.x+Y,u.y+Y,u.z+Y);let J,l,T,b,L=0,D=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<H.x||this.origin.x>E.x)return!1}else if(J=1/this.direction.x,l=(H.x-this.origin.x)*J,T=(E.x-this.origin.x)*J,T===-1/0&&(T=1/0),l>T&&(b=l,l=T,T=b),L=Math.max(l,L),D=Math.min(T,D),L>D)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<H.y||this.origin.y>E.y)return!1}else if(J=1/this.direction.y,l=(H.y-this.origin.y)*J,T=(E.y-this.origin.y)*J,T===-1/0&&(T=1/0),l>T&&(b=l,l=T,T=b),L=Math.max(l,L),D=Math.min(T,D),L>D)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<H.z||this.origin.z>E.z)return!1}else if(J=1/this.direction.z,l=(H.z-this.origin.z)*J,T=(E.z-this.origin.z)*J,T===-1/0&&(T=1/0),l>T&&(b=l,l=T,T=b),L=Math.max(l,L),D=Math.min(T,D),L>D)return!1;return!0}intersectsBox(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(z.minimum,z.maximum,u)}intersectsSphere(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=z.center.x-this.origin.x,H=z.center.y-this.origin.y,E=z.center.z-this.origin.z,J=Y*Y+H*H+E*E,l=z.radius+u,T=l*l;if(J<=T)return!0;const b=Y*this.direction.x+H*this.direction.y+E*this.direction.z;if(b<0)return!1;return J-b*b<=T}intersectsTriangle(z,u,Y){const H=q._TmpVector3[0],E=q._TmpVector3[1],J=q._TmpVector3[2],T=q._TmpVector3[3],L=q._TmpVector3[4];u.subtractToRef(z,H),Y.subtractToRef(z,E),l.p.CrossToRef(this.direction,E,J);const D=l.p.Dot(H,J);if(0===D)return null;const g=1/D;this.origin.subtractToRef(z,T);const M=l.p.Dot(T,J)*g;if(M<-this.epsilon||M>1+this.epsilon)return null;l.p.CrossToRef(T,H,L);const C=l.p.Dot(this.direction,L)*g;if(C<-this.epsilon||M+C>1+this.epsilon)return null;const K=l.p.Dot(E,L)*g;return K>this.length?null:new b.b(1-M-C,M,K)}intersectsPlane(z){let u;const Y=l.p.Dot(z.wl,this.direction);if(Math.abs(Y)<9.99999997475243e-7)return null;{const H=l.p.Dot(z.wl,this.origin);return u=(-z.d-H)/Y,u<0?u<-9.99999997475243e-7?null:0:u}}intersectsAxis(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(z){case"y":{const z=(this.origin.y-u)/this.direction.y;return z>0?null:new l.p(this.origin.x+this.direction.x*-z,u,this.origin.z+this.direction.z*-z)}case"x":{const z=(this.origin.x-u)/this.direction.x;return z>0?null:new l.p(u,this.origin.y+this.direction.y*-z,this.origin.z+this.direction.z*-z)}case"z":{const z=(this.origin.z-u)/this.direction.z;return z>0?null:new l.p(this.origin.x+this.direction.x*-z,this.origin.y+this.direction.y*-z,u)}default:return null}}intersectsMesh(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=l.i.Matrix[0];return z.getWorldMatrix().invertToRef(T),this._tmpRay?q.TransformToRef(this,T,this._tmpRay):this._tmpRay=q.Transform(this,T),z.intersects(this._tmpRay,u,Y,H,E,J)}intersectsMeshes(z,u,Y){Y?Y.length=0:Y=[];for(let H=0;H<z.length;H++){const E=this.intersectsMesh(z[H],u);E.hit&&Y.push(E)}return Y.sort(this._comparePickingInfo),Y}_comparePickingInfo(z,u){return z.distance<u.distance?-1:z.distance>u.distance?1:0}intersectionSegment(z,u,Y){const H=this.origin,E=l.i.Pl[0],J=l.i.Pl[1],T=l.i.Pl[2],b=l.i.Pl[3];u.subtractToRef(z,E),this.direction.scaleToRef(q._Rayl,T),H.addToRef(T,J),z.subtractToRef(H,b);const L=l.p.Dot(E,E),D=l.p.Dot(E,T),g=l.p.Dot(T,T),M=l.p.Dot(E,b),C=l.p.Dot(T,b),K=L*g-D*D;let h,o,d=K,t=K;K<q._Smallnum?(h=0,d=1,o=C,t=g):(h=D*C-g*M,o=L*C-D*M,h<0?(h=0,o=C,t=g):h>d&&(h=d,o=C+D,t=g)),o<0?(o=0,-M<0?h=0:-M>L?h=d:(h=-M,d=L)):o>t&&(o=t,-M+D<0?h=0:-M+D>L?h=d:(h=-M+D,d=L));const W=Math.abs(h)<q._Smallnum?0:h/d,Z=Math.abs(o)<q._Smallnum?0:o/t,s=l.i.Pl[4];T.scaleToRef(Z,s);const v=l.i.Pl[5];E.scaleToRef(W,v),v.addInPlace(b);const i=l.i.Pl[6];v.subtractToRef(s,i);return Z>0&&Z<=this.length&&i.lengthSquared()<Y*Y?v.length():-1}update(z,u,Y,H,E,J,T){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){q._RayDistant||(q._RayDistant=q.Zero()),q._RayDistant.unprojectRayToRef(z,u,Y,H,l.b.IdentityReadOnly,J,T);const b=l.i.Matrix[0];E.invertToRef(b),q.TransformToRef(q._RayDistant,b,this)}else this.unprojectRayToRef(z,u,Y,H,E,J,T);return this}static Zero(){return new q(l.p.Zero(),l.p.Zero())}static CreateNew(z,u,Y,H,E,J,l){return q.Zero().update(z,u,Y,H,E,J,l)}static CreateNewFromTo(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.IdentityReadOnly;const H=new q(new l.p(0,0,0),new l.p(0,0,0));return q.CreateFromToToRef(z,u,H,Y)}static CreateFromToToRef(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.b.IdentityReadOnly;Y.origin.J(z);const E=u.subtractToRef(z,Y.direction),J=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return Y.length=J,Y.direction.normalize(),q.TransformToRef(Y,H,Y)}static Transform(z,u){const Y=new q(new l.p(0,0,0),new l.p(0,0,0));return q.TransformToRef(z,u,Y),Y}static TransformToRef(z,u,Y){l.p.TransformCoordinatesToRef(z.origin,u,Y.origin),l.p.TransformNormalToRef(z.direction,u,Y.direction),Y.length=z.length,Y.epsilon=z.epsilon;const H=Y.direction,E=H.length();if(0!==E&&1!==E){const z=1/E;H.x*=z,H.y*=z,H.z*=z,Y.length*=E}return Y}unprojectRayToRef(z,u,Y,H,E,J,T){const b=l.i.Matrix[0];E.multiplyToRef(J,b),b.multiplyToRef(T,b),b.invert();const L=D.d.LastCreatedEngine,g=l.i.Pl[0];g.x=z/Y*2-1,g.y=-(u/H*2-1),g.z=null!==L&&void 0!==L&&L.useReverseDepthBuffer?1:null!==L&&void 0!==L&&L.isNDCHalfZRange?0:-1;const M=l.i.Pl[1].kl(g.x,g.y,1-1e-8),q=l.i.Pl[2],C=l.i.Pl[3];l.p._UnprojectFromInvertedMatrixToRef(g,b,q),l.p._UnprojectFromInvertedMatrixToRef(M,b,C),this.origin.J(q),C.subtractToRef(q,this.direction),this.direction.normalize()}}function C(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=q.Zero();return K(z,u,Y,H,l,E,J),l}function K(z,u,Y,H,E,J){let T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const L=z.getEngine();if(!J&&!(J=z.activeCamera))return z;const D=J.viewport,g=L.getRenderHeight(),{x:M,y:q,width:C,height:K}=D.toGlobal(L.getRenderWidth(),g),h=1/L.getHardwareScalingLevel();return u=u*h-M,Y=Y*h-(g-q-K),E.update(u,Y,C,K,H||l.b.IdentityReadOnly,T?l.b.IdentityReadOnly:J.getViewMatrix(),J.getProjectionMatrix(),b),z}function h(z,u,Y,H,E){if(!L.e)return z;const J=z.getEngine();if(!E&&!(E=z.activeCamera))throw new Error("Active camera not set");const T=E.viewport,b=J.getRenderHeight(),{x:D,y:g,width:M,height:q}=T.toGlobal(J.getRenderWidth(),b),C=l.b.Identity(),K=1/J.getHardwareScalingLevel();return u=u*K-D,Y=Y*K-(b-g-q),H.update(u,Y,M,q,C,C,E.getProjectionMatrix()),z}function o(z,u,Y,H,E,J,l,T){const b=u(H,Y.enableDistantPicking),L=Y.intersects(b,E,l,J,H,T);return L&&L.hit?!E&&null!=z&&L.distance>=z.distance?null:L:null}function d(z,u,Y,H,E,J){let T=null;const b=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),D=z.cameraToUseForPointers||z.activeCamera,g=M.internalPickerForMesh||o;for(let L=0;L<z.meshes.length;L++){const M=z.meshes[L];if(Y){if(!Y(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.YL)continue;const q=b&&M.isWorldMatrixCameraDependent(),C=M.pl(q,D);if(M.hasThinInstances&&M.thinInstanceEnablePicking){const z=g(T,u,M,C,!0,!0,J);if(z){if(E)return z;const b=l.i.Matrix[1],L=M.thinInstanceGetWorldMatrices();for(let z=0;z<L.length;z++){if(Y&&!Y(M,z))continue;L[z].multiplyToRef(C,b);const l=g(T,u,M,b,H,E,J,!0);if(l&&(T=l,T.thinInstanceIndex=z,H))return T}}}else{const z=g(T,u,M,C,H,E,J);if(z&&(T=z,H))return T}}return T||new L.e}function t(z,u,Y,H){if(!L.e)return null;const E=[],J=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),T=z.cameraToUseForPointers||z.activeCamera,b=M.internalPickerForMesh||o;for(let L=0;L<z.meshes.length;L++){const D=z.meshes[L];if(Y){if(!Y(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.YL)continue;const g=J&&D.isWorldMatrixCameraDependent(),M=D.pl(g,T);if(D.hasThinInstances&&D.thinInstanceEnablePicking){if(b(null,u,D,M,!0,!0,H)){const z=l.i.Matrix[1],J=D.thinInstanceGetWorldMatrices();for(let l=0;l<J.length;l++){if(Y&&!Y(D,l))continue;J[l].multiplyToRef(M,z);const T=b(null,u,D,z,!1,!1,H,!0);T&&(T.thinInstanceIndex=l,E.push(T))}}}else{const z=b(null,u,D,M,!1,!1,H);z&&E.push(z)}}return E}function W(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;H||(H=z.getWorldMatrix()),u.length=Y,E?u.origin.J(E):u.origin.J(z.position);const J=l.i.Pl[2];J.set(0,0,z._scene.useRightHandedSystem?-1:1);const T=l.i.Pl[3];return l.p.TransformNormalToRef(J,H,T),l.p.NormalizeToRef(T,u.direction),u}var Z,s;q._TmpVector3=(0,T.b)(6,l.p.Zero),q._RayDistant=q.Zero(),q._Smallnum=1e-8,q._Rayl=1e9,Z=H.d,(s=E.d)&&(s.prototype.getForwardRay=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;return W(this,new q(l.p.Zero(),l.p.Zero(),z),z,u,Y)},s.prototype.getForwardRayToRef=function(z){return W(this,z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Z&&(g.b._IsPickingAvailable=!0,Z.prototype.createPickingRay=function(z,u,Y,H){return C(this,z,u,Y,H,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),H.d.prototype.createPickingRayToRef=function(z,u,Y,H,E){return K(this,z,u,Y,H,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},H.d.prototype.createPickingRayInCameraSpace=function(z,u,Y){return function(z,u,Y,H){const E=q.Zero();return h(z,u,Y,E,H),E}(this,z,u,Y)},H.d.prototype.createPickingRayInCameraSpaceToRef=function(z,u,Y,H){return h(this,z,u,Y,H)},H.d.prototype.pickWithBoundingInfo=function(z,u,Y,H,E){return function(z,u,Y,H,E,J){if(!L.e)return null;const T=d(z,(H=>(z._tempPickingRay||(z._tempPickingRay=q.Zero()),K(z,u,Y,H,z._tempPickingRay,J||null),z._tempPickingRay)),H,E,!0);return T&&(T.ray=C(z,u,Y,l.b.Identity(),J||null)),T}(this,z,u,Y,H,E)},H.d.prototype.EY=function(z,u,Y,H,E,J){return function(z,u,Y,H,E,J,T){const b=d(z,((H,E)=>(z._tempPickingRay||(z._tempPickingRay=q.Zero()),K(z,u,Y,H,z._tempPickingRay,J||null,!1,E),z._tempPickingRay)),H,E,!1,T);return b&&(b.ray=C(z,u,Y,l.b.Identity(),J||null)),b}(this,z,u,Y,H,E,J)},H.d.prototype.pickWithRay=function(z,u,Y,H){return function(z,u,Y,H,E){const J=d(z,(Y=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=l.b.Identity()),Y.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=q.Zero()),q.TransformToRef(u,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),Y,H,!1,E);return J&&(J.ray=u),J}(this,z,u,Y,H)},H.d.prototype.multiPick=function(z,u,Y,H,E){return function(z,u,Y,H,E,J){return t(z,(H=>C(z,u,Y,H,E||null)),H,J)}(this,z,u,Y,H,E)},H.d.prototype.multiPickWithRay=function(z,u,Y){return function(z,u,Y,H){return t(z,(Y=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=l.b.Identity()),Y.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=q.Zero()),q.TransformToRef(u,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),Y,H)}(this,z,u,Y)}},12497:(z,u,Y)=>{"use strict";var H=Y(11046),E=Y(10953),J=Y(10980),l=Y(11064),T=Y(11018),b=Y(11058);T.e.prototype._partialLoadFile=function(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(z,(z=>{Y[u]=z,Y._internalCount++,6===Y._internalCount&&H(Y)}),void 0,void 0,!0,((z,u)=>{E&&z&&E(z.status+" "+z.statusText,u)}))},T.e.prototype._cascadeLoadFiles=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let J=0;J<6;J++)this._partialLoadFile(Y[J],J,E,u,H)},T.e.prototype._cascadeLoadImgs=function(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5?arguments[5]:void 0;const l=[];l._internalCount=0;for(let T=0;T<6;T++)this._partialLoadImg(H[T],T,l,z,u,Y,E,J)},T.e.prototype._partialLoadImg=function(z,u,Y,H,E,T){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0;const D=(0,l.b)();(0,J.s)(z,(z=>{Y[u]=z,Y._internalCount++,H&&H.removePendingData(D),6===Y._internalCount&&T&&T(E,Y)}),((z,u)=>{H&&H.removePendingData(D),b&&b(z,u)}),H?H.offlineProvider:null,L),H&&H.addPendingData(D)},T.e.prototype.createCubeTextureBase=function(z,u,Y,J){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,o=arguments.length>14&&void 0!==arguments[14]&&arguments[14],d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const t=C||new H.d(this,7);t.isCube=!0,t.url=z,t.generateMipMaps=!J,t._lodGenerationScale=M,t._lodGenerationOffset=q,t._useSRGBBuffer=!!o&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!J),t!==C&&(t.label=z.substring(0,60)),this._doNotHandleContextLost||(t._extension=D,t._files=Y,t._buffer=d);const W=z;this._transformTextureUrl&&!C&&(z=this._transformTextureUrl(z));const Z=D??function(z){const u=z.split("?")[0],Y=u.lastIndexOf(".");return Y>-1?u.substring(Y).toLowerCase():""}(z),s=(0,b.d)(Z),v=(z,u)=>{t.dispose(),T?T(z,u):z&&E.b.Warn(z)},i=(H,T)=>{z===W?H&&v(H.status+" "+H.statusText,T):(E.b.Warn(`Failed to load ${z}, falling back to the ${W}`),this.createCubeTextureBase(W,u,Y,!!J,l,v,L,D,g,M,q,t,K,h,o,d))};if(s)s.then((H=>{const E=z=>{K&&K(t,z),H.loadCubeData(z,t,g,l,((z,u)=>{v(z,u)}))};d?E(d):Y&&6===Y.length?H.supportCascades?this._cascadeLoadFiles(u,(z=>E(z.map((z=>new Uint8Array(z))))),Y,v):v("Textures type does not support cascades."):this._loadFile(z,(z=>E(new Uint8Array(z))),void 0,void 0,!0,i)}));else{if(!Y||0===Y.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(u,t,((z,u)=>{h&&h(z,u)}),Y,v)}return this._internalTexturesCache.push(t),t}},12999:(z,u,Y)=>{"use strict";Y(10953);var H=Y(11325);Y(11046),Y(11110),Y(10920),Y(11370),Y(11342);H.b},12523:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>E});var H=Y(10918);class E{constructor(z){this.value=this._toInt(z)}_toInt(z){return 0|z}add(z){return new E(this.value+z.value)}JY(z){return new E(this.value-z.value)}multiply(z){return new E(Math.imul(this.value,z.value))}divide(z){return new E(this.value/z.value)}getClassName(){return E.ClassName}equals(z){return this.value===z.value}static FromValue(z){return new E(z)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,H.d)("FlowGraphInteger",E)},12533:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>E,i:()=>J});var H=Y(10903);class E{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.NM=z}get m(){return this.NM}transformVector(z){return this.transformVectorToRef(z,new H.m)}transformVectorToRef(z,u){return u.x=z.x*this.NM[0]+z.y*this.NM[1],u.y=z.x*this.NM[2]+z.y*this.NM[3],u}al(){return this.toArray()}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<4;u++)z[u]=this.NM[u];return z}lY(z){for(let u=0;u<4;u++)this.NM[u]=z[u];return this}multiplyToRef(z,u){const Y=z.NM,H=this.NM,E=u.NM;return E[0]=Y[0]*H[0]+Y[1]*H[2],E[1]=Y[0]*H[1]+Y[1]*H[3],E[2]=Y[2]*H[0]+Y[3]*H[2],E[3]=Y[2]*H[1]+Y[3]*H[3],u}multiply(z){return this.multiplyToRef(z,new E)}divideToRef(z,u){const Y=this.NM,H=z.NM,E=u.NM;return E[0]=Y[0]/H[0],E[1]=Y[1]/H[1],E[2]=Y[2]/H[2],E[3]=Y[3]/H[3],u}divide(z){return this.divideToRef(z,new E)}addToRef(z,u){const Y=this.NM,H=z.m,E=u.m;return E[0]=Y[0]+H[0],E[1]=Y[1]+H[1],E[2]=Y[2]+H[2],E[3]=Y[3]+H[3],u}add(z){return this.addToRef(z,new E)}subtractToRef(z,u){const Y=this.NM,H=z.m,E=u.m;return E[0]=Y[0]-H[0],E[1]=Y[1]-H[1],E[2]=Y[2]-H[2],E[3]=Y[3]-H[3],u}JY(z){return this.subtractToRef(z,new E)}transpose(){const z=this.NM;return new E([z[0],z[2],z[1],z[3]])}determinant(){const z=this.NM;return z[0]*z[3]-z[1]*z[2]}inverse(){const z=this.determinant();if(0===z)throw new Error("Matrix is not invertible");const u=this.NM,Y=1/z;return new E([u[3]*Y,-u[1]*Y,-u[2]*Y,u[0]*Y])}equals(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.NM,H=z.m;return 0===u?Y[0]===H[0]&&Y[1]===H[1]&&Y[2]===H[2]&&Y[3]===H[3]:Math.abs(Y[0]-H[0])<u&&Math.abs(Y[1]-H[1])<u&&Math.abs(Y[2]-H[2])<u&&Math.abs(Y[3]-H[3])<u}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.NM.join(", ")})`}}class J{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.NM=z}get m(){return this.NM}transformVector(z){return this.transformVectorToRef(z,new H.p)}transformVectorToRef(z,u){const Y=this.NM;return u.x=z.x*Y[0]+z.y*Y[1]+z.z*Y[2],u.y=z.x*Y[3]+z.y*Y[4]+z.z*Y[5],u.z=z.x*Y[6]+z.y*Y[7]+z.z*Y[8],u}multiplyToRef(z,u){const Y=z.NM,H=this.NM,E=u.m;return E[0]=Y[0]*H[0]+Y[1]*H[3]+Y[2]*H[6],E[1]=Y[0]*H[1]+Y[1]*H[4]+Y[2]*H[7],E[2]=Y[0]*H[2]+Y[1]*H[5]+Y[2]*H[8],E[3]=Y[3]*H[0]+Y[4]*H[3]+Y[5]*H[6],E[4]=Y[3]*H[1]+Y[4]*H[4]+Y[5]*H[7],E[5]=Y[3]*H[2]+Y[4]*H[5]+Y[5]*H[8],E[6]=Y[6]*H[0]+Y[7]*H[3]+Y[8]*H[6],E[7]=Y[6]*H[1]+Y[7]*H[4]+Y[8]*H[7],E[8]=Y[6]*H[2]+Y[7]*H[5]+Y[8]*H[8],u}multiply(z){return this.multiplyToRef(z,new J)}divideToRef(z,u){const Y=this.NM,H=z.m,E=u.m;return E[0]=Y[0]/H[0],E[1]=Y[1]/H[1],E[2]=Y[2]/H[2],E[3]=Y[3]/H[3],E[4]=Y[4]/H[4],E[5]=Y[5]/H[5],E[6]=Y[6]/H[6],E[7]=Y[7]/H[7],E[8]=Y[8]/H[8],u}divide(z){return this.divideToRef(z,new J)}addToRef(z,u){const Y=this.NM,H=z.m,E=u.m;return E[0]=Y[0]+H[0],E[1]=Y[1]+H[1],E[2]=Y[2]+H[2],E[3]=Y[3]+H[3],E[4]=Y[4]+H[4],E[5]=Y[5]+H[5],E[6]=Y[6]+H[6],E[7]=Y[7]+H[7],E[8]=Y[8]+H[8],u}add(z){return this.addToRef(z,new J)}subtractToRef(z,u){const Y=this.NM,H=z.m,E=u.m;return E[0]=Y[0]-H[0],E[1]=Y[1]-H[1],E[2]=Y[2]-H[2],E[3]=Y[3]-H[3],E[4]=Y[4]-H[4],E[5]=Y[5]-H[5],E[6]=Y[6]-H[6],E[7]=Y[7]-H[7],E[8]=Y[8]-H[8],u}JY(z){return this.subtractToRef(z,new J)}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<9;u++)z[u]=this.NM[u];return z}al(){return this.toArray()}lY(z){for(let u=0;u<9;u++)this.NM[u]=z[u];return this}transpose(){const z=this.NM;return new J([z[0],z[3],z[6],z[1],z[4],z[7],z[2],z[5],z[8]])}determinant(){const z=this.NM;return z[0]*(z[4]*z[8]-z[5]*z[7])-z[1]*(z[3]*z[8]-z[5]*z[6])+z[2]*(z[3]*z[7]-z[4]*z[6])}inverse(){const z=this.determinant();if(0===z)throw new Error("Matrix is not invertible");const u=this.NM,Y=1/z;return new J([(u[4]*u[8]-u[5]*u[7])*Y,(u[2]*u[7]-u[1]*u[8])*Y,(u[1]*u[5]-u[2]*u[4])*Y,(u[5]*u[6]-u[3]*u[8])*Y,(u[0]*u[8]-u[2]*u[6])*Y,(u[2]*u[3]-u[0]*u[5])*Y,(u[3]*u[7]-u[4]*u[6])*Y,(u[1]*u[6]-u[0]*u[7])*Y,(u[0]*u[4]-u[1]*u[3])*Y])}equals(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.NM,H=z.m;return 0===u?Y[0]===H[0]&&Y[1]===H[1]&&Y[2]===H[2]&&Y[3]===H[3]&&Y[4]===H[4]&&Y[5]===H[5]&&Y[6]===H[6]&&Y[7]===H[7]&&Y[8]===H[8]:Math.abs(Y[0]-H[0])<u&&Math.abs(Y[1]-H[1])<u&&Math.abs(Y[2]-H[2])<u&&Math.abs(Y[3]-H[3])<u&&Math.abs(Y[4]-H[4])<u&&Math.abs(Y[5]-H[5])<u&&Math.abs(Y[6]-H[6])<u&&Math.abs(Y[7]-H[7])<u&&Math.abs(Y[8]-H[8])<u}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.NM.join(", ")})`}}},12539:(z,u,Y)=>{"use strict";var H;function E(z,u,Y,H){switch(u){case"Animation":return H?z.animations.find((z=>z.uniqueId===Y))??null:z.animations[Y]??null;case"AnimationGroup":return H?z.animationGroups.find((z=>z.uniqueId===Y))??null:z.animationGroups[Y]??null;case"Mesh":return H?z.meshes.find((z=>z.uniqueId===Y))??null:z.meshes[Y]??null;case"Material":return H?z.materials.find((z=>z.uniqueId===Y))??null:z.materials[Y]??null;case"vD":return H?z.cameras.find((z=>z.uniqueId===Y))??null:z.cameras[Y]??null;case"Light":return H?z.lights.find((z=>z.uniqueId===Y))??null:z.lights[Y]??null;default:return null}}Y.d(u,{e:()=>E}),function(z){z.Animation="Animation",z.AnimationGroup="AnimationGroup",z.Mesh="Mesh",z.Material="Material",z.vD="vD",z.Light="Light"}(H||(H={}))},12577:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>E});var H=Y(12580);class E extends H.e{constructor(z,u){if(super(z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),u)for(const Y of u)this._eventsSignalOutputs[Y]=this._registerSignalOutput(Y+"Event")}_executeOnTick(z){}_startPendingTasks(z){z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(z),this._resetAfterCanceled(z)),this._preparePendingTasks(z),z._addPendingBlock(this),this.out._activateSignal(z),z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(z){z._deleteExecutionVariable(this,"_initialized"),z._removePendingBlock(this)}}},12549:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>L});var H=Y(11064),E=Y(10918),J=Y(12557),l=Y(10932),T=Y(12521);class b extends J.c{constructor(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.defaultValue,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(z,u,Y),this.richType=H,this._defaultValue=E,this._optional=J,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new l.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(z){this._isDisabled!==z&&(this._isDisabled=z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(z,u){u._getConnectionValue(this)!==z&&(u._setConnectionValue(this,z),this.onValueChangedObservable.notifyObservers(z))}resetToDefaultValue(z){z._setConnectionValue(this,this._defaultValue)}connectTo(z){this._isDisabled||super.connectTo(z)}_getValueOrDefault(z){const u=z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(u):u}getValue(z){if(1===this.connectionType){z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(z);const u=this._getValueOrDefault(z);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}const u=this.isConnected()?this._connectedPoint[0].getValue(z):this._getValueOrDefault(z);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.richType={},this.richType.serialize(z.richType),z.optional=this._optional,(0,T.f)("defaultValue",this._defaultValue,z)}}(0,E.d)("FlowGraphDataConnection",b);class L{constructor(z){var u;this.config=z,this.uniqueId=(0,H.b)(),this.name=(null===(u=this.config)||void 0===u?void 0:u.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(z){}registerDataInput(z,u,Y){const H=new b(z,0,this,u,Y);return this.dataInputs.push(H),H}registerDataOutput(z,u,Y){const H=new b(z,1,this,u,Y);return this.dataOutputs.push(H),H}getDataInput(z){return this.dataInputs.find((u=>u.name===z))}getDataOutput(z){return this.dataOutputs.find((u=>u.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.f;if(z.uniqueId=this.uniqueId,z.config={},this.config){const Y=this.config,H=Object.keys(Y);for(const E of H)u(E,Y[E],z.config)}z.dataInputs=[],z.dataOutputs=[],z.className=this.getClassName();for(const Y of this.dataInputs){const u={};Y.serialize(u),z.dataInputs.push(u)}for(const Y of this.dataOutputs){const u={};Y.serialize(u),z.dataOutputs.push(u)}}deserialize(z){}_log(z,u,Y){var H;null===(H=z.logger)||void 0===H||H.addLogItem({action:u,payload:Y,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12557:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>J});var H,E=Y(11064);!function(z){z[z.Input=0]="Input",z[z.Output=1]="Output"}(H||(H={}));class J{constructor(z,u,Y){this._ownerBlock=Y,this._connectedPoint=[],this.uniqueId=(0,E.b)(),this.connectedPointIds=[],this.name=z,this._connectionType=u}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(z){if(this._connectionType===z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||z._isSingularConnection()&&z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(z),z._connectedPoint.push(this)}disconnectFrom(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this._connectedPoint.indexOf(z),H=z._connectedPoint.indexOf(this);-1!==Y&&-1!==H&&(u&&this._connectedPoint.splice(Y,1),z._connectedPoint.splice(H,1))}disconnectFromAll(){for(const z of this._connectedPoint)this.disconnectFrom(z,!1);this._connectedPoint.length=0}dispose(){for(const z of this._connectedPoint)this.disconnectFrom(z)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.uniqueId=this.uniqueId,z.name=this.name,z._connectionType=this._connectionType,z.connectedPointIds=[],z.className=this.getClassName();for(const u of this._connectedPoint)z.connectedPointIds.push(u.uniqueId)}getClassName(){return"FGConnection"}deserialize(z){this.uniqueId=z.uniqueId,this.name=z.name,this._connectionType=z._connectionType,this.connectedPointIds=z.connectedPointIds}}},12512:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>t});var H,E=Y(10932),J=Y(11079),l=Y(11082),T=Y(11064),b=Y(12521),L=Y(12539),D=Y(10953);!function(z){z.ExecuteBlock="ExecuteBlock",z.ExecuteEvent="ExecuteEvent",z.TriggerConnection="TriggerConnection",z.ContextVariableSet="ContextVariableSet",z.GlobalVariableSet="GlobalVariableSet",z.GlobalVariableDelete="GlobalVariableDelete",z.GlobalVariableGet="GlobalVariableGet",z.AddConnection="AddConnection",z.GetConnectionValue="GetConnectionValue",z.SetConnectionValue="SetConnectionValue",z.ActivateSignal="ActivateSignal",z.ContextVariableGet="ContextVariableGet"}(H||(H={}));class g{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(z){if(z.time||(z.time=Date.now()),this.log.push(z),this.logToConsole){var u;const Y=null===(u=z.payload)||void 0===u?void 0:u.value;"object"===typeof Y&&Y.getClassName?D.b.Log(`[FGLog] ${z.className}:${z.uniqueId.split("-")[0]} ${z.action} - ${JSON.stringify(Y.getClassName())}: ${Y.toString()}`):D.b.Log(`[FGLog] ${z.className}:${z.uniqueId.split("-")[0]} ${z.action} - ${JSON.stringify(z.payload)}`)}}getItemsOfType(z){return this.log.filter((u=>u.action===z))}}class M{get enableLogging(){return this._enableLogging}set enableLogging(z){this._enableLogging!==z&&(this._enableLogging=z,this._enableLogging?(this.logger=new g,this.logger.logToConsole=!0):this.logger=null)}constructor(z){this.uniqueId=(0,T.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=z,this.assetsContext=z.assetsContext??z.Cu}hasVariable(z){return z in this._userVariables}setVariable(z,u){var Y;this._userVariables[z]=u,null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:z,value:u}})}getAsset(z,u){return(0,L.e)(this.assetsContext,z,u)}getVariable(z){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:z,value:this._userVariables[z]}}),this._userVariables[z]}get userVariables(){return this._userVariables}iz(){return this._configuration.Cu}_getUniqueIdPrefixedName(z,u){return`${z.uniqueId}_${u}`}_getGlobalContextVariable(z,u){var Y;return null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:z,defaultValue:u,possibleValue:this._globalContextVariables[z]}}),this._hasGlobalContextVariable(z)?this._globalContextVariables[z]:u}_setGlobalContextVariable(z,u){var Y;null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:z,value:u}}),this._globalContextVariables[z]=u}_deleteGlobalContextVariable(z){var u;null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:z}}),delete this._globalContextVariables[z]}_hasGlobalContextVariable(z){return z in this._globalContextVariables}_setExecutionVariable(z,u,Y){this._executionVariables[this._getUniqueIdPrefixedName(z,u)]=Y}_getExecutionVariable(z,u,Y){return this._hasExecutionVariable(z,u)?this._executionVariables[this._getUniqueIdPrefixedName(z,u)]:Y}_deleteExecutionVariable(z,u){delete this._executionVariables[this._getUniqueIdPrefixedName(z,u)]}_hasExecutionVariable(z,u){return this._getUniqueIdPrefixedName(z,u)in this._executionVariables}_hasConnectionValue(z){return z.uniqueId in this._connectionValues}_setConnectionValue(z,u){var Y;this._connectionValues[z.uniqueId]=u,null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:z.uniqueId,value:u}})}_setConnectionValueByKey(z,u){this._connectionValues[z]=u}_getConnectionValue(z){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:z.uniqueId,value:this._connectionValues[z.uniqueId]}}),this._connectionValues[z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(z){this._pendingBlocks.includes(z)||(this._pendingBlocks.push(z),this._pendingBlocks.sort(((z,u)=>z.priority-u.priority)))}_removePendingBlock(z){const u=this._pendingBlocks.indexOf(z);-1!==u&&this._pendingBlocks.splice(u,1)}_clearPendingBlocks(){for(const z of this._pendingBlocks)z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(z){var u;this.onNodeExecutedObservable.notifyObservers(z),null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:z.getClassName(),uniqueId:z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(z){this._setGlobalContextVariable("timeSinceStart",z.timeSinceStart),this._setGlobalContextVariable("deltaTime",z.deltaTime);for(const Y of this._pendingBlocks){var u;null===(u=Y._executeOnTick)||void 0===u||u.call(Y,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.f;z.uniqueId=this.uniqueId,z._userVariables={};for(const H in this._userVariables)u(H,this._userVariables[H],z._userVariables);z._connectionValues={};for(const H in this._connectionValues)u(H,this._connectionValues[H],z._connectionValues);var Y;this.assetsContext!==this.iz()&&(z._assetsContext={meshes:this.assetsContext.meshes.map((z=>z.id)),materials:this.assetsContext.materials.map((z=>z.id)),textures:this.assetsContext.textures.map((z=>z.name)),animations:this.assetsContext.animations.map((z=>z.name)),lights:this.assetsContext.lights.map((z=>z.id)),cameras:this.assetsContext.cameras.map((z=>z.id)),bq:null===(Y=this.assetsContext.bq)||void 0===Y?void 0:Y.map((z=>z.name)),skeletons:this.assetsContext.skeletons.map((z=>z.id)),QM:this.assetsContext.QM.map((z=>z.name)),geometries:this.assetsContext.geometries.map((z=>z.id)),multiMaterials:this.assetsContext.multiMaterials.map((z=>z.id)),transformNodes:this.assetsContext.transformNodes.map((z=>z.id))})}getClassName(){return"FlowGraphContext"}}(0,J.e)([(0,l.L)()],M.prototype,"uniqueId",void 0);var q=Y(12546),C=Y(11530);class K{constructor(z){this.onEventTriggeredObservable=new E.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.fl.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:z}}),this._startingTime+=z})),this._meshPickedObserver=this._scene.onPointerObservable.add((z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:z})}),C.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((z=>{const u=z.pointerId,Y=z.mesh,H=this._pointerUnderMeshState[u];!H&&Y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:u,mesh:Y}}):H&&!Y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:u,mesh:H}}):H&&Y&&H!==Y&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:u,mesh:H,over:Y}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:u,mesh:Y,out:H}})),this._pointerUnderMeshState[u]=Y}),C.d.POINTERMOVE)}dispose(){var z,u,Y,H,E;null===(z=this._sceneDisposeObserver)||void 0===z||z.remove(),null===(u=this._sceneReadyObserver)||void 0===u||u.remove(),null===(Y=this._sceneOnBeforeRenderObserver)||void 0===Y||Y.remove(),null===(H=this._meshPickedObserver)||void 0===H||H.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var h,o=Y(12565);!function(z){z[z.Stopped=0]="Stopped",z[z.Started=1]="Started"}(h||(h={}));class d{get state(){return this._state}set state(z){this._state=z,this.onStateChangedObservable.notifyObservers(z)}constructor(z){this.onStateChangedObservable=new E.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=z.Cu,this._sceneEventCoordinator=new K(this._scene),this._coordinator=z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((z=>{for(const u of this._executionContexts){const Y=this._getContextualOrder(z.type,u);for(const H of Y)if(!H._executeEvent(u,z.payload))break}switch(z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const u of this._executionContexts)u._notifyOnTick(z.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const z=new M({Cu:this._scene,coordinator:this._coordinator});return this._executionContexts.push(z),z}getContext(z){return this._executionContexts[z]}addEventBlock(z){if("PointerOver"!==z.type&&"PointerOut"!==z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==z.type&&this._eventBlocks[z.type].push(z),1===this.state)for(const u of this._executionContexts)z._startPendingTasks(u);else this.onStateChangedObservable.addOnce((u=>{if(1===u)for(const Y of this._executionContexts)z._startPendingTasks(Y)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((z=>{1===z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const z of this._executionContexts)for(const u in this._eventBlocks){const Y=this._getContextualOrder(u,z);for(const u of Y)u._startPendingTasks(z)}}_getContextualOrder(z,u){const Y=this._eventBlocks[z].sort(((z,u)=>u.initPriority-z.initPriority));if("MeshPick"===z){const z=[];for(const H of Y){const E=H.asset.getValue(u);let J=0;for(;J<Y.length;J++){const z=Y[J].asset.getValue(u);if(E&&z&&(0,o.k)(E,z))break}z.splice(J,0,H)}return z}return Y}dispose(){var z;if(0!==this.state){this.state=0;for(const z of this._executionContexts)z._clearPendingBlocks();this._executionContexts.length=0;for(const z in this._eventBlocks)this._eventBlocks[z].length=0;null===(z=this._eventObserver)||void 0===z||z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(z){const u=[],Y=new Set;for(const H in this._eventBlocks)for(const z of this._eventBlocks[H])u.push(z),Y.add(z.uniqueId);for(;u.length>0;){const H=u.pop();z(H);for(const z of H.dataInputs)for(const H of z._connectedPoint)Y.has(H._ownerBlock.uniqueId)||(u.push(H._ownerBlock),Y.add(H._ownerBlock.uniqueId));if(H instanceof q.b)for(const z of H.signalOutputs)for(const H of z._connectedPoint)Y.has(H._ownerBlock.uniqueId)||(u.push(H._ownerBlock),Y.add(H._ownerBlock.uniqueId))}}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;z.allBlocks=[],this.visitAllBlocks((u=>{const Y={};u.serialize(Y),z.allBlocks.push(Y)})),z.executionContexts=[];for(const Y of this._executionContexts){const H={};Y.serialize(H,u),z.executionContexts.push(H)}}}class t{constructor(z){this.config=z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Cu.fl.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Cu.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const z=this._executeOnNextFrame.slice(0);if(z.length)for(const u of z){this.notifyCustomEvent(u.id,u.data,!1);const z=this._executeOnNextFrame.findIndex((z=>z.uniqueId===u.uniqueId));-1!==z&&this._executeOnNextFrame.splice(z,1)}}));(t.SceneCoordinators.get(this.config.Cu)??[]).push(this)}createGraph(){const z=new d({Cu:this.config.Cu,coordinator:this});return this._flowGraphs.push(z),z}removeGraph(z){const u=this._flowGraphs.indexOf(z);-1!==u&&(z.dispose(),this._flowGraphs.splice(u,1))}start(){for(const z of this._flowGraphs)z.start()}dispose(){var z,u;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(z=this._disposeObserver)||void 0===z||z.remove(),null===(u=this._onBeforeRenderObserver)||void 0===u||u.remove();const Y=t.SceneCoordinators.get(this.config.Cu)??[],H=Y.indexOf(this);-1!==H&&Y.splice(H,1)}serialize(z,u){z._flowGraphs=[];for(const Y of this._flowGraphs){const H={};Y.serialize(H,u),z._flowGraphs.push(H)}z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(z){let u=this._customEventsMap.get(z);return u||(u=new E.e,this._customEventsMap.set(z,u)),u}notifyCustomEvent(z,u){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:z,data:u,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(z)){const u=this._eventExecutionCounter.get(z);if(this._eventExecutionCounter.set(z,u+1),u>=t.MaxEventTypeExecutionPerFrame)return void(u===t.MaxEventTypeExecutionPerFrame&&D.b.Warn(`FlowGraphCoordinator: Too many executions of event "${z}".`))}else this._eventExecutionCounter.set(z,1);const Y=this._customEventsMap.get(z);Y&&Y.notifyObservers(u)}}t.MaxEventsPerType=30,t.MaxEventTypeExecutionPerFrame=30,t.SceneCoordinators=new Map},12573:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>E});var H=Y(12577);class E extends H.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(z){z._notifyExecuteNode(this),this.done._activateSignal(z)}}},12546:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>T});var H=Y(12549),E=Y(12557),J=Y(10918);class l extends E.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(z){super.connectTo(z),this._connectedPoint.sort(((z,u)=>u.priority-z.priority))}_activateSignal(z){var u;if(null===(u=z.logger)||void 0===u||u.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(z,this),z._increaseExecutionId();else for(const Y of this._connectedPoint)Y._activateSignal(z)}}(0,J.d)("FlowGraphSignalConnection",l);class T extends H.b{constructor(z){super(z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(z){const u=new l(z,0,this);return this.signalInputs.push(u),u}_registerSignalOutput(z){const u=new l(z,1,this);return this.signalOutputs.push(u),u}_unregisterSignalInput(z){const u=this.signalInputs.findIndex((u=>u.name===z));-1!==u&&(this.signalInputs[u].dispose(),this.signalInputs.splice(u,1))}_unregisterSignalOutput(z){const u=this.signalOutputs.findIndex((u=>u.name===z));-1!==u&&(this.signalOutputs[u].dispose(),this.signalOutputs.splice(u,1))}_reportError(z,u){this.error.payload="string"===typeof u?new Error(u):u,this.error._activateSignal(z)}getSignalInput(z){return this.signalInputs.find((u=>u.name===z))}getSignalOutput(z){return this.signalOutputs.find((u=>u.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.signalInputs=[],z.signalOutputs=[];for(const u of this.signalInputs){const Y={};u.serialize(Y),z.signalInputs.push(Y)}for(const u of this.signalOutputs){const Y={};u.serialize(Y),z.signalOutputs.push(Y)}}deserialize(z){for(let u=0;u<z.signalInputs.length;u++){const Y=this.getSignalInput(z.signalInputs[u].name);if(!Y)throw new Error("Could not find signal input with name "+z.signalInputs[u].name+" in block "+z.className);Y.deserialize(z.signalInputs[u])}for(let u=0;u<z.signalOutputs.length;u++){const Y=this.getSignalOutput(z.signalOutputs[u].name);if(!Y)throw new Error("Could not find signal output with name "+z.signalOutputs[u].name+" in block "+z.className);Y.deserialize(z.signalOutputs[u])}}getClassName(){return"FlowGraphExecutionBlock"}}},12580:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>E});var H=Y(12546);class E extends H.b{constructor(z){super(z),this.out=this._registerSignalOutput("out")}}},12531:(z,u,Y)=>{"use strict";Y.d(u,{A:()=>K,E:()=>X,G:()=>Q,K:()=>i,L:()=>v,e:()=>L,f:()=>M,g:()=>s,i:()=>h,k:()=>o,m:()=>d,p:()=>g,r:()=>Z,u:()=>D,w:()=>q,x:()=>C});var H,E=Y(10903),J=Y(11188),l=Y(12523),T=Y(12533);!function(z){z.Any="any",z.String="string",z.Number="number",z.Boolean="boolean",z.Object="object",z.Integer="FlowGraphInteger",z.Vector2="Vector2",z.Pl="Pl",z.Vector4="Vector4",z.Quaternion="Quaternion",z.Matrix="Matrix",z.Matrix2D="Matrix2D",z.Matrix3D="Matrix3D",z.o="o",z.zb="zb"}(H||(H={}));class b{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=z,this.defaultValue=u,this.animationType=Y}serialize(z){z.typeName=this.typeName,z.defaultValue=this.defaultValue}}const L=new b("any",void 0),D=new b("string",""),g=new b("number",0,0),M=new b("boolean",!1),q=new b("Vector2",E.m.Zero(),5),C=new b("Pl",E.p.Zero(),1),K=new b("Vector4",E.t.Zero()),h=new b("Matrix",E.b.Identity(),3),o=new b("Matrix2D",new T.e),d=new b("Matrix3D",new T.i),t=new b("o",J.c.Black(),4),W=new b("zb",new J.e(0,0,0,0),7),Z=new b("Quaternion",E.f.Identity(),2);Z.typeTransformer=z=>{if(z.getClassName){if("Vector4"===z.getClassName())return E.f.Nl(z.al());if("Pl"===z.getClassName())return E.f.FromEulerVector(z);if("Matrix"===z.getClassName())return E.f.FromRotationMatrix(z)}return z};const s=new b("FlowGraphInteger",new l.b(0),0);function v(z){const u=z;switch(typeof z){case"string":return D;case"number":return g;case"boolean":return M;case"object":if(u.getClassName)switch(u.getClassName()){case"Vector2":return q;case"Pl":return C;case"Vector4":return K;case"Matrix":return h;case"o":return t;case"zb":return W;case"Quaternion":return Z;case"FlowGraphInteger":return s;case"Matrix2D":return o;case"Matrix3D":return d}return L;default:return L}}function i(z){switch(z){case"string":return D;case"number":return g;case"boolean":return M;case"Vector2":return q;case"Pl":return C;case"Vector4":return K;case"Matrix":return h;case"o":return t;case"zb":return W;case"Quaternion":return Z;case"FlowGraphInteger":return s;case"Matrix2D":return o;case"Matrix3D":return d;default:return L}}function X(z){switch(z){case"number":default:return 0;case"Vector2":return 5;case"Pl":return 1;case"Matrix":return 3;case"o":return 4;case"zb":return 7;case"Quaternion":return 2}}function Q(z){switch(z){case 0:return g;case 5:return q;case 1:return C;case 3:return h;case 4:return t;case 7:return W;case 2:return Z;default:return L}}},12521:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>D,f:()=>L,h:()=>g});var H=Y(11188),E=Y(10903),J=Y(12523),l=Y(12531),T=Y(12533);function b(z){return"Vector2"===z||"Pl"===z||"Vector4"===z||"Quaternion"===z||"o"===z||"zb"===z}function L(z,u,Y){var H;const E=(null===u||void 0===u||null===(H=u.getClassName)||void 0===H?void 0:H.call(u))??"";if(b(E)||function(z){return"Matrix"===z||"Matrix2D"===z||"Matrix3D"===z}(E))Y[z]={value:u.al(),className:E};else if("FlowGraphInteger"===E)Y[z]={value:u.value,className:E};else if(E&&(u.id||u.name))Y[z]={id:u.id,name:u.name,className:E};else{if("object"===typeof u)throw new Error(`Could not serialize value ${u}`);Y[z]=u}}function D(z,u,Y,L){const g=u[z];let M;const q=(null===g||void 0===g?void 0:g.type)??(null===g||void 0===g?void 0:g.className);if(function(z){return"Mesh"===z||"AbstractMesh"===z||"GroundMesh"===z||"InstanceMesh"===z||"LinesMesh"===z||"GoldbergMesh"===z||"GreasedLineMesh"===z||"TrailMesh"===z}(q)){let z=L.meshes.filter((z=>g.id?z.id===g.id:z.name===g.name));0===z.length&&(z=L.transformNodes.filter((z=>g.id?z.id===g.id:z.name===g.name))),M=g.uniqueId?z.find((z=>z.uniqueId===g.uniqueId)):z[0]}else if(b(q))M=function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===z)return E.m.Nl(u);if("Pl"===z)return Y&&(u[2]*=-1),E.p.Nl(u);if("Vector4"===z)return E.t.Nl(u);if("Quaternion"===z)return Y&&(u[2]*=-1,u[3]*=-1),E.f.Nl(u);if("o"===z)return new H.c(u[0],u[1],u[2]);if("zb"===z)return new H.e(u[0],u[1],u[2],u[3]);throw new Error(`Unknown vector class name ${z}`)}(q,g.value);else if(function(z){return"AnimationGroup"===z}(q)){const z=L.animationGroups.filter((z=>z.name===g.name));M=1===z.length?z[0]:z.find((z=>z.uniqueId===g.uniqueId))}else M="Matrix"===q?E.b.Nl(g.value):"Matrix2D"===q?new T.e(g.value):"Matrix3D"===q?new T.i(g.value):"FlowGraphInteger"===q?J.b.FromValue(g.value):"number"===q||"string"===q||"boolean"===q?g.value[0]:g&&void 0!==g.value?g.value:Array.isArray(g)?g.reduce(((z,u)=>u.eventData?(z[u.id]={type:(0,l.K)(u.type)},"undefined"!==typeof u.value&&(z[u.id].value=D("value",u,Y,L)),z):z),{}):g;return M}function g(z){return"FlowGraphJsonPointerParserBlock"===z}},12565:(z,u,Y)=>{"use strict";function H(z,u){return!(!z.parent||z.parent!==u&&!H(z.parent,u))}function E(z){if(z.getClassName)return z.getClassName()}function J(z,u){return z===u&&("Vector2"===z||"Pl"===z||"Vector4"===z||"Quaternion"===z)}function l(z,u){return z===u&&("Matrix"===z||"Matrix2D"===z||"Matrix3D"===z)}function T(z,u){return"FlowGraphInteger"===z&&"FlowGraphInteger"===u}function b(z,u){const Y="number"===typeof z||"number"===typeof(null===z||void 0===z?void 0:z.value);return Y&&!u?!isNaN(L(z)):Y}function L(z){return"number"===typeof z?z:z.value}Y.d(u,{d:()=>T,e:()=>l,f:()=>J,i:()=>E,k:()=>H,l:()=>L,m:()=>b})},11938:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{SceneInstrumentation:()=>J});var H=Y(10945),E=Y(11405);class J{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(z){z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=z,z?(this._onBeforeActiveMeshesEvaluationObserver=this.Cu.onBeforeActiveMeshesEvaluationObservable.add((()=>{H.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Cu.onAfterActiveMeshesEvaluationObservable.add((()=>{H.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Cu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Cu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(z){z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=z,z?(this._onBeforeRenderTargetsRenderObserver=this.Cu.onBeforeRenderTargetsRenderObservable.add((()=>{H.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Cu.onAfterRenderTargetsRenderObservable.add((()=>{H.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Cu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Cu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(z){z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=z,z?(this._onBeforeParticlesRenderingObserver=this.Cu.onBeforeParticlesRenderingObservable.add((()=>{H.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Cu.onAfterParticlesRenderingObservable.add((()=>{H.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Cu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Cu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(z){z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=z,this.Cu.spriteManagers&&(z?(this._onBeforeSpritesRenderingObserver=this.Cu.onBeforeSpritesRenderingObservable.add((()=>{H.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Cu.onAfterSpritesRenderingObservable.add((()=>{H.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Cu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Cu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(z){z!==this._capturePhysicsTime&&this.Cu.onBeforePhysicsObservable&&(this._capturePhysicsTime=z,z?(this._onBeforePhysicsObserver=this.Cu.onBeforePhysicsObservable.add((()=>{H.e.StartPerformanceCounter("Jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Cu.onAfterPhysicsObservable.add((()=>{H.e.EndPerformanceCounter("Jb"),this._physicsTime.endMonitoring()}))):(this.Cu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Cu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(z){z!==this._captureAnimationsTime&&(this._captureAnimationsTime=z,z?this._onAfterAnimationsObserver=this.Cu.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Cu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(z){this._captureFrameTime=z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(z){this._captureInterFrameTime=z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(z){z!==this._captureRenderTime&&(this._captureRenderTime=z,z?(this._onBeforeDrawPhaseObserver=this.Cu.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),H.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Cu.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),H.e.EndPerformanceCounter("Main render")}))):(this.Cu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Cu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(z){z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=z,z?(this._onBeforeCameraRenderObserver=this.Cu.onBeforeCameraRenderObservable.add((z=>{this._cameraRenderTime.beginMonitoring(),H.e.StartPerformanceCounter(`Rendering camera ${z.name}`)})),this._onAfterCameraRenderObserver=this.Cu.onAfterCameraRenderObservable.add((z=>{this._cameraRenderTime.endMonitoring(!1),H.e.EndPerformanceCounter(`Rendering camera ${z.name}`)}))):(this.Cu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Cu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Cu.getEngine()._drawCalls}constructor(z){this.Cu=z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.d,this._captureFrameTime=!1,this._frameTime=new E.d,this._captureRenderTime=!1,this._renderTime=new E.d,this._captureInterFrameTime=!1,this._interFrameTime=new E.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.d,this._capturePhysicsTime=!1,this._physicsTime=new E.d,this._captureAnimationsTime=!1,this._animationsTime=new E.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(H.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Cu.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(H.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.oM(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.oM(),this._captureParticlesRenderTime&&this._particlesRenderTime.oM(),this._captureSpritesRenderTime&&this._spritesRenderTime.oM(),this._captureRenderTime&&this._renderTime.oM(),this._captureCameraRenderTime&&this._cameraRenderTime.oM()}))}dispose(){this._disposed||(this.Cu.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Cu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Cu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Cu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Cu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Cu.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Cu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Cu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Cu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Cu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Cu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Cu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Cu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Cu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Cu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Cu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Cu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Cu=null,this._disposed=!0)}}},12508:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>D});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11222),T=Y(11637),b=Y(11690),L=Y(10918);l.b.AddNodeConstructor("Light_Type_1",((z,u)=>()=>new D(z,J.p.Zero(),u)));class D extends b.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(z){this._shadowFrustumSize=z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(z){this._shadowOrthoScale=z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(z){this._orthoLeft=z}get orthoRight(){return this._orthoRight}set orthoRight(z){this._orthoRight=z}get orthoTop(){return this._orthoTop}set orthoTop(z){this._orthoTop=z}get orthoBottom(){return this._orthoBottom}set orthoBottom(z){this._orthoBottom=z}constructor(z,u,Y){super(z,Y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=u.scale(-1),this.direction=u}getClassName(){return"bb"}getTypeID(){return T.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(z,u,Y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(z):this._setDefaultAutoExtendShadowProjectionMatrix(z,u,Y)}_setDefaultFixedFrustumShadowProjectionMatrix(z){const u=this.iz().activeCamera;u&&J.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:u.uT,void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,z,this.iz().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(z,u,Y){const H=this.iz().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const z=J.p.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let H=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let l=0;l<Y.length;l++){const T=Y[l];if(!T)continue;const b=T.getBoundingInfo().boundingBox;for(let Y=0;Y<b.vectorsWorld.length;Y++)J.p.TransformCoordinatesToRef(b.vectorsWorld[Y],u,z),z.x<this._orthoLeft&&(this._orthoLeft=z.x),z.y<this._orthoBottom&&(this._orthoBottom=z.y),z.x>this._orthoRight&&(this._orthoRight=z.x),z.y>this._orthoTop&&(this._orthoTop=z.y),this.autoCalcShadowZBounds&&(z.z<H&&(H=z.z),z.z>E&&(E=z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=H,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,l=this._orthoTop-this._orthoBottom,T=void 0!==this.shadowMinZ?this.shadowMinZ:(null===H||void 0===H?void 0:H.uT)||0,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===H||void 0===H?void 0:H.maxZ)||1e4,L=this.iz().getEngine().useReverseDepthBuffer;J.b.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-l*this.shadowOrthoScale,this._orthoTop+l*this.shadowOrthoScale,L?b:T,L?T:b,z,this.iz().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,u){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,u),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,u),this)}transferToNodeMaterialEffect(z,u){return this.computeTransformedInformation()?(z.setFloat3(u,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(z.setFloat3(u,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(z){const u=this._scene.getEngine();return!u.useReverseDepthBuffer&&u.isNDCHalfZRange?0:1}getDepthMaxZ(z){const u=this._scene.getEngine();return u.useReverseDepthBuffer&&u.isNDCHalfZRange?0:1}prepareLightSpecificDefines(z,u){z["DIRLIGHT"+u]=!0}}(0,H.e)([(0,E.L)()],D.prototype,"shadowFrustumSize",null),(0,H.e)([(0,E.L)()],D.prototype,"shadowOrthoScale",null),(0,H.e)([(0,E.L)()],D.prototype,"autoUpdateExtends",void 0),(0,H.e)([(0,E.L)()],D.prototype,"autoCalcShadowZBounds",void 0),(0,H.e)([(0,E.L)("orthoLeft")],D.prototype,"_orthoLeft",void 0),(0,H.e)([(0,E.L)("orthoRight")],D.prototype,"_orthoRight",void 0),(0,H.e)([(0,E.L)("orthoTop")],D.prototype,"_orthoTop",void 0),(0,H.e)([(0,E.L)("orthoBottom")],D.prototype,"_orthoBottom",void 0),(0,L.d)("BABYLON.DirectionalLight",D)},12928:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>D});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11188),T=Y(11222),b=Y(11637),L=Y(10918);T.b.AddNodeConstructor("Light_Type_3",((z,u)=>()=>new D(z,J.p.Zero(),u)));class D extends b.e{constructor(z,u,Y){super(z,Y),this.groundColor=new l.c(0,0,0),this.direction=u||J.p.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Lb"}setDirectionToTarget(z){return this.direction=J.p.Normalize(z.JY(J.p.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(z,u){const Y=J.p.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Y.x,Y.y,Y.z,0,u),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.JT),u),this}transferToNodeMaterialEffect(z,u){const Y=J.p.Normalize(this.direction);return z.setFloat3(u,Y.x,Y.y,Y.z),this}pl(){return this._worldMatrix||(this._worldMatrix=J.b.Identity()),this._worldMatrix}getTypeID(){return b.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(z,u){z["HEMILIGHT"+u]=!0}}(0,H.e)([(0,E.j)()],D.prototype,"groundColor",void 0),(0,H.e)([(0,E.K)()],D.prototype,"direction",void 0),(0,L.d)("BABYLON.HemisphericLight",D)},12483:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>g});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11222),T=Y(11637),b=Y(11690),L=Y(11415),D=Y(10918);l.b.AddNodeConstructor("Light_Type_2",((z,u)=>()=>new g(z,J.p.Zero(),J.p.Zero(),0,0,u)));class g extends b.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(z){this._iesProfileTexture!==z&&(this._iesProfileTexture=z,this._iesProfileTexture&&g._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(z){this._angle=z,this._cosHalfAngle=Math.cos(.5*z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(z){this._innerAngle=z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(z){this._shadowAngleScale=z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(z){this._projectionTextureLightNear=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(z){this._projectionTextureLightFar=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(z){this._projectionTextureUpDirection=z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(z){this._projectionTexture!==z&&(this._projectionTexture=z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(g._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):g._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(z){return void 0!==z.onGeneratedObservable}static _IsTexture(z){return void 0!==z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(z){this._projectionTextureProjectionLightMatrix=z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(z,u,Y,H,E,l){super(z,l),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=J.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=J.p.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=J.p.Zero(),this._projectionTextureViewLightMatrix=J.b.Zero(),this._projectionTextureProjectionLightMatrix=J.b.Zero(),this._projectionTextureScalingMatrix=J.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=u,this.direction=Y,this.angle=H,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return T.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(z){super._setDirection(z),this._projectionTextureViewLightDirty=!0}_setPosition(z){super._setPosition(z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(z,u,Y){const H=this.iz().activeCamera;if(!H)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,l=void 0!==this.shadowMinZ?this.shadowMinZ:H.uT,T=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,b=this.iz().getEngine().useReverseDepthBuffer;J.b.PerspectiveFovLHToRef(E,1,b?T:l,b?l:T,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,b)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),J.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const z=this.projectionTextureLightFar,u=this.projectionTextureLightNear,Y=z/(z-u),H=-Y*u,E=1/Math.tan(this._angle/2);J.b.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,Y,1,0,0,H,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof L.b){const z=this._projectionTexture.uScale/2,u=this._projectionTexture.vScale/2;J.b.FromValuesToRef(z,0,0,0,0,u,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(z,u){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),z.setMatrix("textureProjectionMatrix"+u,this._projectionTextureMatrix),z.setTexture("projectionLightTexture"+u,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&z.setTexture("iesLightTexture"+u,this._iesProfileTexture),this}transferToEffect(z,u){let Y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,u),Y=J.p.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,u),Y=J.p.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Y.x,Y.y,Y.z,this._cosHalfAngle,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,u),this}transferToNodeMaterialEffect(z,u){let Y;return Y=this.computeTransformedInformation()?J.p.Normalize(this.transformedDirection):J.p.Normalize(this.direction),this.iz().useRightHandedSystem?z.setFloat3(u,-Y.x,-Y.y,-Y.z):z.setFloat3(u,Y.x,Y.y,Y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(z){const u=this._scene.getEngine(),Y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===z||void 0===z?void 0:z.uT)??0;return u.useReverseDepthBuffer&&u.isNDCHalfZRange?Y:this._scene.getEngine().isNDCHalfZRange?0:Y}getDepthMaxZ(z){const u=this._scene.getEngine(),Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===z||void 0===z?void 0:z.maxZ)??1e4;return u.useReverseDepthBuffer&&u.isNDCHalfZRange?0:Y}prepareLightSpecificDefines(z,u){z["SPOTLIGHT"+u]=!0,z["PROJECTEDLIGHTTEXTURE"+u]=!(!this.projectionTexture||!this.projectionTexture.isReady()),z["IESLIGHTTEXTURE"+u]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,H.e)([(0,E.L)()],g.prototype,"angle",null),(0,H.e)([(0,E.L)()],g.prototype,"innerAngle",null),(0,H.e)([(0,E.L)()],g.prototype,"shadowAngleScale",null),(0,H.e)([(0,E.L)()],g.prototype,"exponent",void 0),(0,H.e)([(0,E.L)()],g.prototype,"projectionTextureLightNear",null),(0,H.e)([(0,E.L)()],g.prototype,"projectionTextureLightFar",null),(0,H.e)([(0,E.L)()],g.prototype,"projectionTextureUpDirection",null),(0,H.e)([(0,E.C)("projectedLightTexture")],g.prototype,"_projectionTexture",void 0),(0,D.d)("BABYLON.SpotLight",g)},12206:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>l,h:()=>J,l:()=>T});const H={},E={};function J(z,u){H[z]=u}function l(z,u){E[z]=u}function T(z){return E[z]?E[z]:null}},12111:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>v,c:()=>c});var H,E=Y(10945),J=Y(10932),l=Y(11504),T=Y(10928),b=Y(10953),L=Y(11306),D=Y(10980),g=Y(10982),M=Y(11064),q=Y(11018),C=Y(10972);!function(z){z[z.Clean=0]="Clean",z[z.Stop=1]="Stop",z[z.Sync=2]="Sync",z[z.NoSync=3]="NoSync"}(H||(H={}));const K=new J.e,h={};let o=!1;function d(){return h[".babylon"]}function t(z,u){const Y=h[z];return Y||(b.b.Warn("Unable to find a plugin to load "+z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),u?d():void 0)}function W(z,u,Y){let H="Unable to load from "+(z.rawData?"binary data":z.url);return u?H+=`: ${u}`:Y&&(H+=`: ${Y}`),H}async function Z(z,u,Y,H,E,J,l,T,b){var L;const g="data:"===(M=z.url).substring(0,5)?M.substring(5):null;var M;if(z.rawData&&!l)throw"When using ArrayBufferView to load data the file extension must be provided.";const o=g||l?"":function(z){const u=z.indexOf("?");-1!==u&&(z=z.substring(0,u));const Y=z.lastIndexOf(".");return z.substring(Y,z.length).toLowerCase()}(z.url);let W=l?t(l,!0):g?function(z){for(const u in h){const Y=h[u].plugin;if(Y.canDirectLoad&&Y.canDirectLoad(z))return h[u]}return d()}(z.url):t(o,!1);if(!W&&o){if(z.url&&!z.url.startsWith("blob:")){const u=await async function(z,u){const Y=u.method||"GET";return await new Promise(((H,E)=>{const J=new C.d;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const z={};if(u.responseHeaders)for(const Y of u.responseHeaders)z[Y]=J.getResponseHeader(Y)||"";H({response:J.response,headerValues:z})}else E(`Unable to fetch data from ${z}. Error code: ${J.status}`)})),J.open(Y,z),J.send()}))}(z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Y=u.headerValues?u.headerValues["Content-Type"]:"";Y&&(W=function(z){for(const u in h){const Y=h[u];if(Y.mimeType===z)return Y}}(Y))}W||(W=d())}if(!W)throw new Error(`No plugin or fallback for ${l??z.url}`);if(!1===(null===b||void 0===b||null===(L=b[W.plugin.name])||void 0===L?void 0:L.enabled))throw new Error(`The '${W.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(z.rawData&&!W.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(z=>{if(W.plugin.createPlugin){const u=W.plugin.createPlugin(b??{});return u instanceof Promise?(u.then(z).catch((z=>{E("Error instantiating plugin.",z)})),null):(z(u),u)}return z(W.plugin),W.plugin})((b=>{var L;if(!b)throw`The loader plugin corresponding to the '${l}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(K.notifyObservers(b),g&&(b.canDirectLoad&&b.canDirectLoad(z.url)||!(0,D.m)(z.url))){if(b.directLoad){const z=b.directLoad(u,g);z instanceof Promise?z.then((z=>{Y(b,z)})).catch((z=>{E("Error in directLoad of _loadData: "+z,z)})):Y(b,z)}else Y(b,g);return}const M=W.isBinary,C=(z,H)=>{u.L?E("Scene has been disposed"):Y(b,z,H)};let h=null,o=!1;null===(L=b.fl)||void 0===L||L.add((()=>{o=!0,h&&(h.abort(),h=null),J()}));const d=()=>{if(o)return;const Y=(z,u)=>{E(null===z||void 0===z?void 0:z.statusText,u)};if(!b.loadFile&&z.rawData)throw"Plugin does not support loading ArrayBufferView.";h=b.loadFile?b.loadFile(u,z.rawData||z.file||z.url,z.rootUrl,C,H,M,Y,T):u._loadFile(z.file||z.url,C,H,!0,M,Y)},t=u.getEngine();let Z=t.enableOfflineSupport;if(Z){let Y=!1;for(const H of u.disableOfflineSupportExceptionRules)if(H.test(z.url)){Y=!0;break}Z=!Y}Z&&q.e.OfflineProviderFactory?u.offlineProvider=q.e.OfflineProviderFactory(z.url,d,t.disableManifestCheck):d()}))}function s(z,u){let Y,H,J=null,l=null;if(u)if(u.name)Y=`file:${u.name}`,H=u.name,J=u;else if(ArrayBuffer.isView(u))Y="",H=(0,M.b)(),l=u;else if(u.startsWith("data:"))Y=u,H="";else if(z){const J=u;if("/"===J.substring(0,1))return E.e.Error("Wrong sceneFilename parameter"),null;Y=z+J,H=J}else Y=u,H=E.e.GetFilename(u),z=E.e.GetFolderPath(u);else Y=z,H=E.e.GetFilename(z),z=E.e.GetFolderPath(z);return{url:Y,rootUrl:z,name:H,file:J,rawData:l}}function v(z){if("string"===typeof z.extensions){const u=z.extensions;h[u.toLowerCase()]={plugin:z,isBinary:!1}}else{const u=z.extensions,Y=Object.keys(u);for(const H of Y)h[H.toLowerCase()]={plugin:z,isBinary:u[H].isBinary,mimeType:u[H].mimeType}}}async function i(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.d.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!H)return b.b.Error("No scene available to import mesh to"),null;const q=s(u,Y);if(!q)return null;const C={};H.addPendingData(C);const K=()=>{H.removePendingData(C)},h=(z,u)=>{const Y=W(q,z,u);l?l(H,Y,new g.i(Y,g.f.SceneLoaderError,u)):b.b.Error(Y),K()},o=J?z=>{try{J(z)}catch(u){h("Error in onProgress callback: "+u,u)}}:void 0,d=(z,u,Y,J,l,T,b,L)=>{if(H.importedMeshesFiles.push(q.url),E)try{E(z,u,Y,J,l,T,b,L)}catch(D){h("Error in onSuccess callback: "+D,D)}H.removePendingData(C)};return await Z(q,H,((u,Y,E)=>{if(u.rewriteRootURL&&(q.rootUrl=u.rewriteRootURL(q.rootUrl,E)),u.importMesh){const E=[],J=[],l=[];if(!u.importMesh(z,H,Y,q.rootUrl,E,J,l,h))return;H.loadingPluginName=u.name,d(E,J,l,[],[],[],[],[])}else{u.importMeshAsync(z,H,Y,q.rootUrl,o,q.name).then((z=>{H.loadingPluginName=u.name,d(z.meshes,z.QM,z.skeletons,z.animationGroups,z.transformNodes,z.geometries,z.lights,z.spriteManagers)})).catch((z=>{h(z.message,z)}))}}),o,h,K,L,D,M)}async function X(z,u,Y,H,E,J,l,T){return await new Promise(((b,L)=>{try{i(z,u,Y,H,((z,u,Y,H,E,J,l,T)=>{b({meshes:z,QM:u,skeletons:Y,animationGroups:H,transformNodes:E,geometries:J,lights:l,spriteManagers:T})}),E,((z,u,Y)=>{L(Y||new Error(u))}),J,l,T).catch(L)}catch(g){L(g)}}))}async function Q(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.d.LastCreatedEngine,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Y?await A(z,u,new l.d(Y),H,J,b,L,D,g):E.e.Error("No engine available")}async function V(z,u,Y,H,E,J,l){return await new Promise(((T,b)=>{Q(z,u,Y,(z=>{T(z)}),H,((z,u,Y)=>{b(Y||new Error(u))}),E,J,l)}))}async function A(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.d.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return b.b.Error("No scene available to append to"),null;const q=s(z,u);if(!q)return null;const C={};Y.addPendingData(C);const K=()=>{Y.removePendingData(C)};L.e.ShowLoadingScreen&&!o&&(o=!0,Y.getEngine().displayLoadingUI(),Y.executeWhenReady((()=>{Y.getEngine().hideLoadingUI(),o=!1})));const h=(z,u)=>{const H=W(q,z,u);J?J(Y,H,new g.i(H,g.f.SceneLoaderError,u)):b.b.Error(H),K()},d=E?z=>{try{E(z)}catch(u){h("Error in onProgress callback",u)}}:void 0,t=()=>{if(H)try{H(Y)}catch(z){h("Error in onSuccess callback",z)}Y.removePendingData(C)};return await Z(q,Y,((z,u)=>{if(z.load){if(!z.load(Y,u,q.rootUrl,h))return;Y.loadingPluginName=z.name,t()}else{z.loadAsync(Y,u,q.rootUrl,d,q.name).then((()=>{Y.loadingPluginName=z.name,t()})).catch((z=>{h(z.message,z)}))}}),d,h,K,l,D,M)}async function x(z,u,Y,H,E,J,l){return await new Promise(((T,b)=>{try{A(z,u,Y,(z=>{T(z)}),H,((z,u,Y)=>{b(Y||new Error(u))}),E,J,l).catch(b)}catch(g){b(g)}}))}async function G(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.d.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return b.b.Error("No scene available to load asset container to"),null;const M=s(z,u);if(!M)return null;const q={};Y.addPendingData(q);const C=()=>{Y.removePendingData(q)},K=(z,u)=>{const H=W(M,z,u);J?J(Y,H,new g.i(H,g.f.SceneLoaderError,u)):b.b.Error(H),C()},h=E?z=>{try{E(z)}catch(u){K("Error in onProgress callback",u)}}:void 0,o=z=>{if(H)try{H(z)}catch(u){K("Error in onSuccess callback",u)}Y.removePendingData(q)};return await Z(M,Y,((z,u)=>{if(z.loadAssetContainer){const H=z.loadAssetContainer(Y,u,M.rootUrl,K);if(!H)return;H.populateRootNodes(),Y.loadingPluginName=z.name,o(H)}else if(z.loadAssetContainerAsync){z.loadAssetContainerAsync(Y,u,M.rootUrl,h,M.name).then((u=>{u.populateRootNodes(),Y.loadingPluginName=z.name,o(u)})).catch((z=>{K(z.message,z)}))}else K("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),h,K,C,l,L,D)}async function F(z,u,Y,H,E,J,l){return await new Promise(((T,b)=>{try{G(z,u,Y,(z=>{T(z)}),H,((z,u,Y)=>{b(Y||new Error(u))}),E,J,l).catch(b)}catch(g){b(g)}}))}async function R(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.d.LastCreatedScene,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Y)return void b.b.Error("No scene available to load animations to");if(H){for(const H of Y.animatables)H.reset();Y.stopAllAnimations();const z=Y.animationGroups.slice();for(const Y of z)Y.dispose();const u=Y.getNodes();for(const Y of u)Y.animations&&(Y.animations=[])}else switch(E){case 0:const z=Y.animationGroups.slice();for(const u of z)u.dispose();break;case 1:for(const u of Y.animationGroups)u.stop();break;case 2:for(const u of Y.animationGroups)u.reset(),u.restart();break;case 3:break;default:return void b.b.Error("Unknown animation group loading mode value '"+E+"'")}const C=Y.animatables.length;await G(z,u,Y,(z=>{z.mergeAnimationsTo(Y,Y.animatables.slice(C),J),z.dispose(),Y.onAnimationFileImportedObservable.notifyObservers(Y),l&&l(Y)}),L,D,g,M,q)}async function w(z,u,Y,H,E,J,l,T,b,L){return await new Promise(((D,M)=>{try{R(z,u,Y,H,E,J,(z=>{D(z)}),l,((z,u,Y)=>{M(Y||new Error(u))}),T,b,L).catch(M)}catch(g){M(g)}}))}class c{static get ForceFullSceneLoadingForIncremental(){return L.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(z){L.e.ForceFullSceneLoadingForIncremental=z}static get ShowLoadingScreen(){return L.e.ShowLoadingScreen}static set ShowLoadingScreen(z){L.e.ShowLoadingScreen=z}static get loggingLevel(){return L.e.loggingLevel}static set loggingLevel(z){L.e.loggingLevel=z}static get CleanBoneMatrixWeights(){return L.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(z){L.e.CleanBoneMatrixWeights=z}static GetDefaultPlugin(){return d()}static GetPluginForExtension(z){var u;return null===(u=t(z,!0))||void 0===u?void 0:u.plugin}static IsPluginForExtensionAvailable(z){return function(z){return!!h[z]}(z)}static RegisterPlugin(z){v(z)}static ImportMesh(z,u,Y,H,E,J,l,b,L){i(z,u,Y,H,E,J,l,b,L).catch((z=>null===l||void 0===l?void 0:l(T.d.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async ImportMeshAsync(z,u,Y,H,E,J,l){return await X(z,u,Y,H,E,J,l)}static Load(z,u,Y,H,E,J,l,b){Q(z,u,Y,H,E,J,l,b).catch((z=>null===J||void 0===J?void 0:J(T.d.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async LoadAsync(z,u,Y,H,E,J){return await V(z,u,Y,H,E,J)}static Append(z,u,Y,H,E,J,l,b){A(z,u,Y,H,E,J,l,b).catch((z=>null===J||void 0===J?void 0:J(Y??T.d.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async AppendAsync(z,u,Y,H,E,J){return await x(z,u,Y,H,E,J)}static LoadAssetContainer(z,u,Y,H,E,J,l,b){G(z,u,Y,H,E,J,l,b).catch((z=>null===J||void 0===J?void 0:J(Y??T.d.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async LoadAssetContainerAsync(z,u,Y,H,E,J){return await F(z,u,Y,H,E,J)}static ImportAnimations(z,u,Y,H,E,J,l,b,L,D,g){R(z,u,Y,H,E,J,l,b,L,D,g).catch((z=>null===L||void 0===L?void 0:L(Y??T.d.LastCreatedScene,null===z||void 0===z?void 0:z.message,z)))}static async ImportAnimationsAsync(z,u,Y,H,E,J,l,T,b,L,D){return await w(z,u,Y,H,E,J,T,L,D)}}c.NO_LOGGING=0,c.MINIMAL_LOGGING=1,c.SUMMARY_LOGGING=2,c.DETAILED_LOGGING=3,c.OnPluginActivatedObservable=K},12495:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>M});var H=Y(11079),E=Y(11082),J=Y(10945),l=Y(10903),T=Y(11397),b=Y(11415),L=Y(10918),D=Y(10932),g=Y(11172);Y(12497);class M extends T.c{set boundingBoxSize(z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(z))return;this._boundingBoxSize=z;const u=this.iz();u&&u.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(z){this._rotationY=z,this.setReflectionTextureMatrix(l.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(z,u,Y){let H="";for(const E of z)H+=E;return new M(H,u,null,Y,z)}static CreateFromPrefilteredData(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const J=new M(z,u,null,!1,null,null,null,void 0,!0,Y,H);return u.useDelayedTextureLoading=E,J}constructor(z,u){var Y;let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,o=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0;super(u),this.onLoadObservable=new D.e,this.boundingBoxPosition=l.p.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new l.b,this._buffer=null,this.name=z,this.url=z,this._noMipmap=E,this.jl=!1,this.isCube=!0,this._textureMatrix=l.b.Identity(),this.coordinatesMode=b.b.CUBIC_MODE;let t=null,W=null;null===H||Array.isArray(H)?(this._noMipmap=E,this._format=g,this._createPolynomials=C,t=H,this._loaderOptions=o,this._useSRGBBuffer=d,this._lodScale=K,this._lodOffset=h):(t=H.extensions??null,this._noMipmap=H.noMipmap??!1,J=H.files??null,W=H.buffer??null,this._format=H.format??5,M=H.prefiltered??!1,q=H.forcedExtension??null,this._createPolynomials=H.createPolynomials??!1,this._lodScale=H.lodScale??.8,this._lodOffset=H.lodOffset??0,this._loaderOptions=H.loaderOptions,this._useSRGBBuffer=H.useSRGBBuffer,T=H.P??null,L=H.onError??null),(z||J)&&this.updateURL(z,q,T,M,L,t,null===(Y=this.iz())||void 0===Y?void 0:Y.useDelayedTextureLoading,J,W)}getClassName(){return"CubeTexture"}updateURL(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=z),this.url=z,u&&(this._forcedExtension=u);const L=z.lastIndexOf("."),D=u||(L>-1?z.substring(L).toLowerCase():""),g=0===D.indexOf(".dds"),M=0===D.indexOf(".env"),q=0===D.indexOf(".basis");if(M?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=H,H&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),T)this._files=T;else if(q||M||g||J||(J=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,J){for(let u=0;u<J.length;u++)this._files.push(z+J[u]);this._extensions=J}this._buffer=b,l?(this.delayLoadState=4,this._delayedOnLoad=Y,this._delayedOnError=E):this._loadTexture(Y,E)}delayLoad(z){4===this.delayLoadState&&(z&&(this._forcedExtension=z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(z){var u,Y;if(z.updateFlag===this._textureMatrix.updateFlag)return;z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Y=this.iz())||void 0===Y||Y.markAllMaterialsAsDirty(1,(z=>-1!==z.getActiveTextures().indexOf(this))));if(this._textureMatrix=z,null===(u=this.iz())||void 0===u||!u.useRightHandedSystem)return;const H=l.i.Pl[0],E=l.i.Quaternion[0],J=l.i.Pl[1];this._textureMatrix.decompose(H,E,J),E.z*=-1,E.w*=-1,l.b.ComposeToRef(H,E,J,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var z;return null!==(z=this.iz())&&void 0!==z&&z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this.iz(),H=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var u;(this.onLoadObservable.notifyObservers(this),H)&&(H.dispose(),null===(u=this.iz())||void 0===u||u.markAllMaterialsAsDirty(1));z&&z()},l=(z,Y)=>{this._loadingError=!0,this._errorObject={message:z,exception:Y},u&&u(z,Y),b.b.OnTextureLoadErrorObservable.notifyObservers(this)};var T;this._texture?this._texture.isReady?J.e.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Y,this._lodScale,this._lodOffset,z,l,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Y,this._files,this._noMipmap,z,l,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(T=this._texture)||void 0===T||T.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(z,u,Y){const H=g.d.Parse((()=>{let H=!1;return z.prefiltered&&(H=z.prefiltered),new M(Y+(z.url??z.name),u,z.extensions,!1,z.files||null,null,null,void 0,H,z.forcedExtension)}),z,u);if(z.boundingBoxPosition&&(H.boundingBoxPosition=l.p.Nl(z.boundingBoxPosition)),z.boundingBoxSize&&(H.boundingBoxSize=l.p.Nl(z.boundingBoxSize)),z.animations)for(let E=0;E<z.animations.length;E++){const u=z.animations[E],Y=(0,L.c)("BABYLON.Animation");Y&&H.animations.push(Y.Parse(u))}return H}clone(){let z=0;const u=g.d.Clone((()=>{const u=new M(this.url,this.iz()||this._getEngine(),this._extensions,this._noMipmap,this._files);return z=u.uniqueId,u}),this);return u.uniqueId=z,u}}(0,H.e)([(0,E.L)()],M.prototype,"url",void 0),(0,H.e)([(0,E.K)()],M.prototype,"boundingBoxPosition",void 0),(0,H.e)([(0,E.K)()],M.prototype,"boundingBoxSize",null),(0,H.e)([(0,E.L)("rotationY")],M.prototype,"rotationY",null),(0,H.e)([(0,E.L)("files")],M.prototype,"_files",void 0),(0,H.e)([(0,E.L)("forcedExtension")],M.prototype,"_forcedExtension",void 0),(0,H.e)([(0,E.L)("extensions")],M.prototype,"_extensions",void 0),(0,H.e)([(0,E.u)("textureMatrix")],M.prototype,"_textureMatrix",void 0),(0,H.e)([(0,E.u)("textureMatrixRefraction")],M.prototype,"_textureMatrixRefraction",void 0),b.b._CubeTextureParser=M.Parse,(0,L.d)("BABYLON.CubeTexture",M)},12944:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>b});var H=Y(10953),E=Y(11415),J=Y(11070),l=Y(11333),T=Y(11046);l.ThinEngine.prototype.createDynamicTexture=function(z,u,Y,H){const E=new T.d(this,4);return E.baseWidth=z,E.baseHeight=u,Y&&(z=this.needPOTTextures?(0,J.e)(z,this._caps.maxTextureSize):z,u=this.needPOTTextures?(0,J.e)(u,this._caps.maxTextureSize):u),E.width=z,E.height=u,E.isReady=!1,E.generateMipMaps=Y,E.samplingMode=H,this.updateTextureSamplingMode(H,E),this._internalTexturesCache.push(E),E},l.ThinEngine.prototype.updateDynamicTexture=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!z)return;const l=this._gl,T=l.TEXTURE_2D,b=this._bindTextureDirectly(T,z,!0,J);this._unpackFlipY(void 0===Y?z.invertY:Y),H&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const L=this._getWebGLTextureType(z.type),D=this._getInternalFormat(E||z.format),g=this._getRGBABufferInternalSizedFormat(z.type,D);l.texImage2D(T,0,g,D,L,u),z.generateMipMaps&&l.generateMipmap(T),b||this._bindTextureDirectly(T,null),H&&l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(z.format=E),z._dynamicTextureSource=u,z._premulAlpha=H,z.invertY=Y||!1,z.isReady=!0};class b extends E.b{constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,T=arguments.length>6?arguments[6]:void 0;const b=!Y||Y._isScene;super(null,b?Y:null===Y||void 0===Y?void 0:Y.Cu,b?!H:Y,T,J,void 0,void 0,void 0,void 0,l),this.name=z,this.wrapU=E.b.CLAMP_ADDRESSMODE,this.wrapV=E.b.CLAMP_ADDRESSMODE,this._generateMipMaps=H;const L=this._getEngine();if(!L)return;if(u.getContext)this._canvas=u,this._ownCanvas=!1,this._texture=L.createDynamicTexture(this._canvas.width,this._canvas.height,H,J);else{this._canvas=L.createCanvas(1,1),this._ownCanvas=!0;const z=u;z.width||0===z.width?this._texture=L.createDynamicTexture(z.width,z.height,H,J):this._texture=L.createDynamicTexture(u,u,H,J)}const D=this.getSize();this._canvas.width!==D.width&&(this._canvas.width=D.width),this._canvas.height!==D.height&&(this._canvas.height=D.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(z){this._canvas.width=z.width,this._canvas.height=z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(z.width,z.height,this._generateMipMaps,this.samplingMode)}scale(z){const u=this.getSize();u.width*=z,u.height*=z,this._recreate(u)}scaleTo(z,u){const Y=this.getSize();Y.width=z,Y.height=u,this._recreate(Y)}getContext(){return this._context}clear(z){const u=this.getSize();z&&(this._context.fillStyle=z),this._context.clearRect(0,0,u.width,u.height)}update(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===z||z,u,this._format||void 0,void 0,Y)}drawText(z,u,Y,H,E,J,l){let T=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const b=this.getSize();if(J&&(this._context.fillStyle=J,this._context.fillRect(0,0,b.width,b.height)),this._context.font=H,null===u||void 0===u){const Y=this._context.measureText(z);u=(b.width-Y.width)/2}if(null===Y||void 0===Y){const z=parseInt(H.replace(/\D/g,""));Y=b.height/2+z/3.65}this._context.fillStyle=E||"",this._context.fillText(z,u,Y),T&&this.update(l)}dispose(){var z,u;(super.dispose(),this._ownCanvas)&&(null===(z=this._canvas)||void 0===z||null===(u=z.remove)||void 0===u||u.call(z));this._canvas=null,this._context=null}clone(){const z=this.iz();if(!z)return this;const u=this.getSize(),Y=new b(this.name,u,z,this._generateMipMaps);return Y.jl=this.jl,Y.level=this.level,Y.wrapU=this.wrapU,Y.wrapV=this.wrapV,Y}serialize(){const z=this.iz();z&&!z.isReady()&&H.b.Warn("The scene must be ready before serializing the dynamic texture");const u=super.serialize();return b._IsCanvasElement(this._canvas)&&(u.base64String=this._canvas.toDataURL()),u.invertY=this._invertY,u.samplingMode=this.samplingMode,u}static _IsCanvasElement(z){return void 0!==z.toDataURL}_rebuild(){this.update()}}},12400:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>E});var H=Y(11415);class E extends H.b{get depth(){return this._depth}constructor(z,u,Y,E,J,l){let T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:H.b.TRILINEAR_SAMPLINGMODE,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10?arguments[10]:void 0;super(null,l,!T,b),this.format=J,this._texture=l.getEngine().createRawTexture2DArray(z,u,Y,E,J,T,b,L,null,D,g),this._depth=E,this.is2DArray=!0}update(z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(z,u,Y,H,J){return new E(z,u,Y,H,5,J,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12225:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>T,h:()=>b,j:()=>J,m:()=>l});var H=Y(10937),E=Y(10903);function J(z,u){return`{X: ${z.x.toFixed(u)} Y: ${z.y.toFixed(u)}}`}function l(z,u){return`{X: ${z._x.toFixed(u)} Y: ${z._y.toFixed(u)} Z: ${z._z.toFixed(u)}}`}function T(z,u){return 2*Math.acos((0,H.Clamp)(E.f.Dot(z,u)))}function b(z,u){const Y=new E.f;return function(z,u,Y){const J=E.p.Cross(z,u),l=Math.acos((0,H.Clamp)(E.p.Dot(z,u),-1,1));E.f.RotationAxisToRef(J,l,Y)}(z,u,Y),Y}},12070:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>L});var H=Y(10903),E=Y(11188),J=Y(11267),l=Y(11231),T=Y(11309);Y(12078);function b(z){let u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],J=[];let b=[];const L=z.width||z.size||1,D=z.height||z.size||1,g=z.depth||z.size||1,M=z.wrap||!1;let q=void 0===z.topBaseAt?1:z.topBaseAt,C=void 0===z.bottomBaseAt?0:z.bottomBaseAt;q=(q+4)%4,C=(C+4)%4;let K=[2,0,3,1][q],h=[2,0,1,3][C],o=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(M){u=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],o=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const H=[17,18,19,16],E=[22,23,20,21];for(;K>0;)z.unshift(z.pop()),H.unshift(H.pop()),K--;for(;h>0;)Y.unshift(Y.pop()),E.unshift(E.pop()),h--;z=z.flat(),Y=Y.flat(),o=o.concat(z).concat(Y),u.push(H[0],H[2],H[3],H[0],H[1],H[2]),u.push(E[0],E[2],E[3],E[0],E[1],E[2])}const d=[L/2,D/2,g/2];b=o.reduce(((z,u,Y)=>z.concat(u*d[Y%3])),[]);const t=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,W=z.faceUV||new Array(6),Z=z.faceColors,s=[];for(let l=0;l<6;l++)void 0===W[l]&&(W[l]=new H.t(0,0,1,1)),Z&&void 0===Z[l]&&(Z[l]=new E.e(1,1,1,1));for(let H=0;H<6;H++)if(J.push(W[H].z,T.b?1-W[H].w:W[H].w),J.push(W[H].x,T.b?1-W[H].w:W[H].w),J.push(W[H].x,T.b?1-W[H].y:W[H].y),J.push(W[H].z,T.b?1-W[H].y:W[H].y),Z)for(let z=0;z<4;z++)s.push(Z[H].r,Z[H].g,Z[H].b,Z[H].a);l.e._ComputeSides(t,b,u,Y,J,z.frontUVs,z.backUVs);const v=new l.e;if(v.indices=u,v.Qz=b,v.Vz=Y,v.xz=J,Z){const z=t===l.e.DOUBLESIDE?s.concat(s):s;v.Az=z}return v}function L(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new J.b(z,Y);u.sideOrientation=J.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return b(u).Fz(H,u.updatable),H}l.e.CreateBox=b,J.b.CreateBox=function(z,u){return L(z,{size:u,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12213:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>T});var H=Y(11267),E=Y(11231),J=Y(11309);function l(z){const u=[],Y=[],H=[],l=[],T=z.radius||.5,b=z.tessellation||64,L=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,D=0===z.sideOrientation?0:z.sideOrientation||E.e.DEFAULTSIDE;u.push(0,0,0),l.push(.5,.5);const g=2*Math.PI*L,M=1===L?g/b:g/(b-1);let q=0;for(let E=0;E<b;E++){const z=Math.cos(q),Y=Math.sin(q),H=(z+1)/2,E=(1-Y)/2;u.push(T*z,T*Y,0),l.push(H,J.b?1-E:E),q+=M}1===L&&(u.push(u[3],u[4],u[5]),l.push(l[2],J.b?1-l[3]:l[3]));const C=u.length/3;for(let E=1;E<C-1;E++)Y.push(E+1,0,E);E.e.ComputeNormals(u,Y,H),E.e._ComputeSides(D,u,Y,H,l,z.frontUVs,z.backUVs);const K=new E.e;return K.indices=Y,K.Qz=u,K.Vz=H,K.xz=l,K}function T(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new H.b(z,Y);u.sideOrientation=H.b._GetDefaultSideOrientation(u.sideOrientation),E._originalBuilderSideOrientation=u.sideOrientation;return l(u).Fz(E,u.updatable),E}E.e.CreateDisc=l,H.b.CreateDisc=function(z,u,Y){return T(z,{radius:u,tessellation:Y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12078:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>h,c:()=>d,g:()=>o});var H=Y(10903),E=Y(11188),J=Y(11267),l=Y(11231),T=Y(11103);J.b._GroundMeshParser=(z,u)=>b.Parse(z,u);class b extends J.b{constructor(z,u){super(z,u),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=z,this._subdivisionsY=z,this.subdivide(z);const Y=this;Y.createOrUpdateSubmeshesOctree&&Y.createOrUpdateSubmeshesOctree(u)}getHeightAtCoordinates(z,u){const Y=this.getWorldMatrix(),E=H.i.Matrix[5];Y.invertToRef(E);const J=H.i.Pl[8];if(H.p.TransformCoordinatesFromFloatsToRef(z,0,u,E,J),z=J.x,u=J.z,z<this._minX||z>=this._maxX||u<=this._minZ||u>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const l=this._getFacetAt(z,u),T=-(l.x*z+l.z*u+l.w)/l.y;return H.p.TransformCoordinatesFromFloatsToRef(0,T,0,Y,J),J.y}getNormalAtCoordinates(z,u){const Y=new H.p(0,1,0);return this.getNormalAtCoordinatesToRef(z,u,Y),Y}getNormalAtCoordinatesToRef(z,u,Y){const E=this.getWorldMatrix(),J=H.i.Matrix[5];E.invertToRef(J);const l=H.i.Pl[8];if(H.p.TransformCoordinatesFromFloatsToRef(z,0,u,J,l),z=l.x,u=l.z,z<this._minX||z>this._maxX||u<this._minZ||u>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const T=this._getFacetAt(z,u);return H.p.TransformNormalFromFloatsToRef(T.x,T.y,T.z,E,Y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(z,u){const Y=Math.floor((z+this._maxX)*this._subdivisionsX/this._width),H=Math.floor(-(u+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[H*this._subdivisionsX+Y];let J;return J=u<E.slope.x*z+E.slope.y?E.facet1:E.facet2,J}_initHeightQuads(){const z=this._subdivisionsX,u=this._subdivisionsY;this._heightQuads=[];for(let Y=0;Y<u;Y++)for(let u=0;u<z;u++){const E={slope:H.m.Zero(),facet1:new H.t(0,0,0,0),facet2:new H.t(0,0,0,0)};this._heightQuads[Y*z+u]=E}return this}_computeHeightQuads(){const z=this.getVerticesData(T.f.PositionKind);if(!z)return this;const u=H.i.Pl[3],Y=H.i.Pl[2],E=H.i.Pl[1],J=H.i.Pl[0],l=H.i.Pl[4],b=H.i.Pl[5],L=H.i.Pl[6],D=H.i.Pl[7],g=H.i.Pl[8];let M=0,q=0,C=0,K=0,h=0,o=0,d=0;const t=this._subdivisionsX,W=this._subdivisionsY;for(let T=0;T<W;T++)for(let W=0;W<t;W++){M=3*W,q=T*(t+1)*3,C=(T+1)*(t+1)*3,u.x=z[q+M],u.y=z[q+M+1],u.z=z[q+M+2],Y.x=z[q+M+3],Y.y=z[q+M+4],Y.z=z[q+M+5],E.x=z[C+M],E.y=z[C+M+1],E.z=z[C+M+2],J.x=z[C+M+3],J.y=z[C+M+4],J.z=z[C+M+5],K=(J.z-u.z)/(J.x-u.x),h=u.z-K*u.x,Y.subtractToRef(u,l),E.subtractToRef(u,b),J.subtractToRef(u,L),H.p.CrossToRef(L,b,D),H.p.CrossToRef(l,L,g),D.normalize(),g.normalize(),o=-(D.x*u.x+D.y*u.y+D.z*u.z),d=-(g.x*Y.x+g.y*Y.y+g.z*Y.z);const Z=this._heightQuads[T*t+W];Z.slope.kl(K,h),Z.facet1.kl(D.x,D.y,D.z,o),Z.facet2.kl(g.x,g.y,g.z,d)}return this}serialize(z){super.serialize(z),z.subdivisionsX=this._subdivisionsX,z.subdivisionsY=this._subdivisionsY,z.minX=this._minX,z.maxX=this._maxX,z.uT=this._minZ,z.maxZ=this._maxZ,z.width=this._width,z.height=this._height}static Parse(z,u){const Y=new b(z.name,u);return Y._subdivisionsX=z.subdivisionsX||1,Y._subdivisionsY=z.subdivisionsY||1,Y._minX=z.minX,Y._maxX=z.maxX,Y._minZ=z.uT,Y._maxZ=z.maxZ,Y._width=z.width,Y._height=z.height,Y}}var L=Y(10945),D=Y(10928),g=Y(10906),M=Y(11309);function q(z){const u=[],Y=[],E=[],J=[];let T,b;const L=z.width||z.size||1,D=z.height||z.size||1,g=0|(z.subdivisionsX||z.subdivisions||1),q=0|(z.subdivisionsY||z.subdivisions||1);for(T=0;T<=q;T++)for(b=0;b<=g;b++){const z=new H.p(b*L/g-L/2,0,(q-T)*D/q-D/2),u=new H.p(0,1,0);Y.push(z.x,z.y,z.z),E.push(u.x,u.y,u.z),J.push(b/g,M.b?T/q:1-T/q)}for(T=0;T<q;T++)for(b=0;b<g;b++)u.push(b+1+(T+1)*(g+1)),u.push(b+1+T*(g+1)),u.push(b+T*(g+1)),u.push(b+(T+1)*(g+1)),u.push(b+1+(T+1)*(g+1)),u.push(b+T*(g+1));const C=new l.e;return C.indices=u,C.Qz=Y,C.Vz=E,C.xz=J,C}function C(z){const u=void 0!==z.xmin&&null!==z.xmin?z.xmin:-1,Y=void 0!==z.zmin&&null!==z.zmin?z.zmin:-1,E=void 0!==z.xmax&&null!==z.xmax?z.xmax:1,J=void 0!==z.zmax&&null!==z.zmax?z.zmax:1,T=z.subdivisions||{w:1,h:1},b=z.precision||{w:1,h:1},L=[],D=[],g=[],M=[];let q,C,K,h;T.h=T.h<1?1:T.h,T.w=T.w<1?1:T.w,b.w=b.w<1?1:b.w,b.h=b.h<1?1:b.h;const o=(E-u)/T.w,d=(J-Y)/T.h;function t(z,u,Y,E){const J=D.length/3,l=b.w+1;for(q=0;q<b.h;q++)for(C=0;C<b.w;C++){const z=[J+C+q*l,J+(C+1)+q*l,J+(C+1)+(q+1)*l,J+C+(q+1)*l];L.push(z[1]),L.push(z[2]),L.push(z[3]),L.push(z[0]),L.push(z[1]),L.push(z[3])}const T=H.p.Zero(),K=new H.p(0,1,0);for(q=0;q<=b.h;q++)for(T.z=q*(E-u)/b.h+u,C=0;C<=b.w;C++)T.x=C*(Y-z)/b.w+z,T.y=0,D.push(T.x,T.y,T.z),g.push(K.x,K.y,K.z),M.push(C/b.w,q/b.h)}for(K=0;K<T.h;K++)for(h=0;h<T.w;h++)t(u+h*o,Y+K*d,u+(h+1)*o,Y+(K+1)*d);const W=new l.e;return W.indices=L,W.Qz=D,W.Vz=g,W.xz=M,W}function K(z){const u=[],Y=[],J=[],T=[];let b,L;const D=z.colorFilter||new E.c(.3,.59,.11),M=z.alphaFilter||0;let q=!1;if(z.minHeight>z.maxHeight){q=!0;const u=z.maxHeight;z.maxHeight=z.minHeight,z.minHeight=u}for(b=0;b<=z.subdivisions;b++)for(L=0;L<=z.subdivisions;L++){const u=new H.p(L*z.width/z.subdivisions-z.width/2,0,(z.subdivisions-b)*z.height/z.subdivisions-z.height/2),E=4*(((u.x+z.width/2)/z.width*(z.bufferWidth-1)|0)+((1-(u.z+z.height/2)/z.height)*(z.bufferHeight-1)|0)*z.bufferWidth);let l=z.buffer[E]/255,C=z.buffer[E+1]/255,K=z.buffer[E+2]/255;const h=z.buffer[E+3]/255;q&&(l=1-l,C=1-C,K=1-K);const o=l*D.r+C*D.g+K*D.b;u.y=h>=M?z.minHeight+(z.maxHeight-z.minHeight)*o:z.minHeight-g.e,z.heightBuffer&&(z.heightBuffer[b*(z.subdivisions+1)+L]=u.y),Y.push(u.x,u.y,u.z),J.push(0,0,0),T.push(L/z.subdivisions,1-b/z.subdivisions)}for(b=0;b<z.subdivisions;b++)for(L=0;L<z.subdivisions;L++){const H=L+1+(b+1)*(z.subdivisions+1),E=L+1+b*(z.subdivisions+1),J=L+b*(z.subdivisions+1),l=L+(b+1)*(z.subdivisions+1),T=Y[3*H+1]>=z.minHeight,D=Y[3*E+1]>=z.minHeight,g=Y[3*J+1]>=z.minHeight;T&&D&&g&&(u.push(H),u.push(E),u.push(J));Y[3*l+1]>=z.minHeight&&T&&g&&(u.push(l),u.push(H),u.push(J))}l.e.ComputeNormals(Y,u,J);const C=new l.e;return C.indices=u,C.Qz=Y,C.Vz=J,C.xz=T,C}function h(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=new b(z,arguments.length>2?arguments[2]:void 0);Y._setReady(!1),Y._subdivisionsX=u.subdivisionsX||u.subdivisions||1,Y._subdivisionsY=u.subdivisionsY||u.subdivisions||1,Y._width=u.width||1,Y._height=u.height||1,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ;return q(u).Fz(Y,u.updatable),Y._setReady(!0),Y}function o(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new J.b(z,Y);return C(u).Fz(H,u.updatable),H}function d(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=Y.width||10,l=Y.height||10,T=Y.subdivisions||1,g=Y.minHeight||0,M=Y.maxHeight||1,q=Y.colorFilter||new E.c(.3,.59,.11),C=Y.alphaFilter||0,h=Y.updatable,o=Y.onReady;H=H||D.d.LastCreatedScene;const d=new b(z,H);let t;d._subdivisionsX=T,d._subdivisionsY=T,d._width=J,d._height=l,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1),Y.passHeightBufferInCallback&&(t=new Float32Array((T+1)*(T+1)));const W=(z,u,Y)=>{K({width:J,height:l,subdivisions:T,minHeight:g,maxHeight:M,colorFilter:q,buffer:z,bufferWidth:u,bufferHeight:Y,alphaFilter:C,heightBuffer:t}).Fz(d,h),o&&o(d,t),d._setReady(!0)};if("string"===typeof u){const z=z=>{var u;const Y=z.width,E=z.height;if(H.L)return;const J=null===(u=H)||void 0===u?void 0:u.getEngine().resizeImageBitmap(z,Y,E);W(J,Y,E)};L.e.LoadImage(u,z,Y.onError?Y.onError:()=>{},H.offlineProvider)}else W(u.data,u.width,u.height);return d}l.e.CreateGround=q,l.e.CreateTiledGround=C,l.e.CreateGroundFromHeightMap=K,J.b.CreateGround=(z,u,Y,H,E,J)=>h(z,{width:u,height:Y,subdivisions:H,updatable:J},E),J.b.CreateTiledGround=(z,u,Y,H,E,J,l,T,b)=>o(z,{xmin:u,zmin:Y,xmax:H,zmax:E,subdivisions:J,precision:l,updatable:b},T),J.b.CreateGroundFromHeightMap=(z,u,Y,H,E,J,l,T,b,L,D)=>d(z,u,{width:Y,height:H,subdivisions:E,minHeight:J,maxHeight:l,updatable:b,onReady:L,alphaFilter:D},T)},12685:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>q,f:()=>g,j:()=>M});var H=Y(10903),E=Y(11267),J=Y(11231),l=Y(11639),T=Y(11103),b=Y(10953);function L(z){const u=[],Y=[],H=z.lines,E=z.Az,l=[];let T=0;for(let J=0;J<H.length;J++){const z=H[J];for(let H=0;H<z.length;H++){const{x:b,y:L,z:D}=z[H];if(Y.push(b,L,D),E){const z=E[J],{r:u,g:Y,b:T,a:b}=z[H];l.push(u,Y,T,b)}H>0&&(u.push(T-1),u.push(T)),T++}}const b=new J.e;return b.indices=u,b.Qz=Y,E&&(b.Az=l),b}function D(z){const u=z.dashSize||3,Y=z.gapSize||1,E=z.dashNb||200,l=z.points,T=[],b=[],L=H.p.Zero();let D=0,g=0,M=0,q=0,C=0,K=0,h=0;for(h=0;h<l.length-1;h++)l[h+1].subtractToRef(l[h],L),D+=L.length();for(M=D/E,q=u*M/(u+Y),h=0;h<l.length-1;h++){l[h+1].subtractToRef(l[h],L),g=Math.floor(L.length()/M),L.normalize();for(let z=0;z<g;z++)C=M*z,T.push(l[h].x+C*L.x,l[h].y+C*L.y,l[h].z+C*L.z),T.push(l[h].x+(C+q)*L.x,l[h].y+(C+q)*L.y,l[h].z+(C+q)*L.z),b.push(K,K+1),K+=2}const o=new J.e;return o.Qz=T,o.indices=b,o}function g(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=u.instance,E=u.lines,J=u.Az;if(H){const z=H.getVerticesData(T.f.PositionKind);let u,Y;J&&(u=H.getVerticesData(T.f.ColorKind));let l=0,b=0;for(let H=0;H<E.length;H++){const T=E[H];for(let E=0;E<T.length;E++)z[l]=T[E].x,z[l+1]=T[E].y,z[l+2]=T[E].z,J&&u&&(Y=J[H],u[b]=Y[E].r,u[b+1]=Y[E].g,u[b+2]=Y[E].b,u[b+3]=Y[E].a,b+=4),l+=3}return H.updateVerticesData(T.f.PositionKind,z,!1,!1),J&&u&&H.updateVerticesData(T.f.ColorKind,u,!1,!1),H.refreshBoundingInfo(),H}const b=!!J,D=new l.e(z,Y,null,void 0,void 0,b,u.useVertexAlpha,u.material);return L(u).Fz(D,u.updatable),D}function M(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=u.Az?[u.Az]:null;return g(z,{lines:[u.points],updatable:u.updatable,instance:u.instance,Az:H,useVertexAlpha:u.useVertexAlpha,material:u.material},Y)}function q(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.points,T=u.instance,L=u.gapSize||1,g=u.dashSize||3;if(T){const z=z=>{const u=H.p.Zero(),Y=z.length/6;let E=0,l=0,b=0,L=0,D=0,g=0,M=0,q=0;for(M=0;M<J.length-1;M++)J[M+1].subtractToRef(J[M],u),E+=u.length();b=E/Y;const C=T._creationDataStorage.dashSize;for(L=C*b/(C+T._creationDataStorage.gapSize),M=0;M<J.length-1;M++)for(J[M+1].subtractToRef(J[M],u),l=Math.floor(u.length()/b),u.normalize(),q=0;q<l&&g<z.length;)D=b*q,z[g]=J[M].x+D*u.x,z[g+1]=J[M].y+D*u.y,z[g+2]=J[M].z+D*u.z,z[g+3]=J[M].x+(D+L)*u.x,z[g+4]=J[M].y+(D+L)*u.y,z[g+5]=J[M].z+(D+L)*u.z,g+=6,q++;for(;g<z.length;)z[g]=J[M].x,z[g+1]=J[M].y,z[g+2]=J[M].z,g+=3};return(u.dashNb||u.dashSize||u.gapSize||u.useVertexAlpha||u.material)&&b.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),T.updateMeshPositions(z,!1),T}const M=new l.e(z,Y,null,void 0,void 0,void 0,u.useVertexAlpha,u.material);return D(u).Fz(M,u.updatable),M._creationDataStorage=new E.e,M._creationDataStorage.dashSize=g,M._creationDataStorage.gapSize=L,M}J.e.CreateLineSystem=L,J.e.CreateDashedLines=D,E.b.RL=function(z,u){return M(z,{points:u,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.b.CreateDashedLines=function(z,u,Y,H,E){return q(z,{points:u,dashSize:Y,gapSize:H,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12113:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>T,i:()=>b});var H=Y(11267),E=Y(11231),J=Y(11309);function l(z){const u=[],Y=[],H=[],l=[],T=void 0!==z.width?z.width:void 0!==z.size?z.size:1,b=void 0!==z.height?z.height:void 0!==z.size?z.size:1,L=0===z.sideOrientation?0:z.sideOrientation||E.e.DEFAULTSIDE,D=T/2,g=b/2;Y.push(-D,-g,0),H.push(0,0,-1),l.push(0,J.b?1:0),Y.push(D,-g,0),H.push(0,0,-1),l.push(1,J.b?1:0),Y.push(D,g,0),H.push(0,0,-1),l.push(1,J.b?0:1),Y.push(-D,g,0),H.push(0,0,-1),l.push(0,J.b?0:1),u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),E.e._ComputeSides(L,Y,u,H,l,z.frontUVs,z.backUVs);const M=new E.e;return M.indices=u,M.Qz=Y,M.Vz=H,M.xz=l,M}function T(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new H.b(z,Y);u.sideOrientation=H.b._GetDefaultSideOrientation(u.sideOrientation),E._originalBuilderSideOrientation=u.sideOrientation;return l(u).Fz(E,u.updatable),u.sourcePlane&&(E.translate(u.sourcePlane.wl,-u.sourcePlane.d),E.setDirection(u.sourcePlane.wl.scale(-1))),E}const b={cL:T};E.e.cL=l,H.b.cL=(z,u,Y,H,E)=>T(z,{size:u,width:u,height:u,sideOrientation:E,updatable:H},Y)},12204:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>b});var H=Y(10903),E=Y(11267),J=Y(11231),l=Y(11309);function T(z){const u=0|(z.segments||32),Y=z.diameterX||z.diameter||1,E=z.diameterY||z.diameter||1,T=z.diameterZ||z.diameter||1,b=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,L=z.slice&&z.slice<=0?1:z.slice||1,D=0===z.sideOrientation?0:z.sideOrientation||J.e.DEFAULTSIDE,g=!!z.dedupTopBottomIndices,M=new H.p(Y/2,E/2,T/2),q=2+u,C=2*q,K=[],h=[],o=[],d=[];for(let J=0;J<=q;J++){const z=J/q,u=z*Math.PI*L;for(let Y=0;Y<=C;Y++){const E=Y/C,J=E*Math.PI*2*b,T=H.b.RotationZ(-u),L=H.b.RotationY(J),D=H.p.TransformCoordinates(H.p.Up(),T),g=H.p.TransformCoordinates(D,L),q=g.multiply(M),K=g.divide(M).normalize();h.push(q.x,q.y,q.z),o.push(K.x,K.y,K.z),d.push(E,l.b?1-z:z)}if(J>0){const z=h.length/3;for(let u=z-2*(C+1);u+C+2<z;u++)g?(J>1&&(K.push(u),K.push(u+1),K.push(u+C+1)),(J<q||L<1)&&(K.push(u+C+1),K.push(u+1),K.push(u+C+2))):(K.push(u),K.push(u+1),K.push(u+C+1),K.push(u+C+1),K.push(u+1),K.push(u+C+2))}}J.e._ComputeSides(D,h,K,o,d,z.frontUVs,z.backUVs);const t=new J.e;return t.indices=K,t.Qz=h,t.Vz=o,t.xz=d,t}function b(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return T(u).Fz(H,u.updatable),H}J.e.CreateSphere=T,E.b.CreateSphere=(z,u,Y,H,E,J)=>b(z,{segments:u,diameterX:Y,diameterY:Y,diameterZ:Y,sideOrientation:J,updatable:E},H)},12953:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>T});var H=Y(11662),E=Y(12502),J=Y(11674),l=Y(11231);class T{static get Configuration(){return{get decoder(){return E.d.DefaultConfiguration},set decoder(z){E.d.DefaultConfiguration=z}}}static set Configuration(z){E.d.DefaultConfiguration=z.decoder}static get DecoderAvailable(){return(0,H.i)(E.d.DefaultConfiguration)}static get Default(){return T._Default??(T._Default=new T),T._Default}static ResetDefault(z){T._Default&&(z||T._Default.dispose(),T._Default=null)}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.DefaultNumWorkers;const u="number"===typeof z?{...E.d.DefaultConfiguration,numWorkers:z}:{...E.d.DefaultConfiguration,...z};this._decoder=new E.d(u)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(z,u,Y){return this._decoder.decodeMeshToMeshDataAsync(z,u,Y)}async decodeMeshToGeometryAsync(z,u,Y,H){return await this._decoder.decodeMeshToGeometryAsync(z,u,Y,H)}async _decodeMeshToGeometryForGltfAsync(z,u,Y,H,E,J){return await this._decoder._decodeMeshToGeometryForGltfAsync(z,u,Y,H,E,J)}async decodeMeshAsync(z,u){const Y=await this._decoder.decodeMeshToMeshDataAsync(z,u),H=new l.e;Y.indices&&(H.indices=Y.indices);for(const E of Y.attributes){const z=J.b.GetFloatData(E.data,E.size,J.b.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,Y.totalVertices);H.set(z,E.kind)}return H}}T.DefaultNumWorkers=(0,H.e)(),T._Default=null},12502:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>L});var H=Y(11662),E=Y(10945),J=Y(11298),l=Y(11674),T=Y(10953),b=Y(11672);class L extends H.b{static get DefaultAvailable(){return(0,H.i)(L.DefaultConfiguration)}static get Default(){return L._Default??(L._Default=new L),L._Default}static ResetDefault(z){L._Default&&(z||L._Default.dispose(),L._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(z,u){return{module:await(u||DracoDecoderModule)({wasmBinary:z})}}_getWorkerContent(){return`${b.b}(${b.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultConfiguration)}decodeMeshToMeshDataAsync(z,u,Y){const H=z instanceof ArrayBuffer?new Int8Array(z):new Int8Array(z.buffer,z.byteOffset,z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async z=>await new Promise(((E,J)=>{z.push(((z,l)=>{let b=null;const L=[],D=u=>{z.removeEventListener("error",D),z.removeEventListener("message",g),J(u),l()},g=u=>{const H=u.data;switch(H.id){case"indices":b=H.data;break;case"attribute":L.push({kind:H.kind,data:H.data,size:H.size,byteOffset:H.byteOffset,byteStride:H.byteStride,normalized:(J=H.kind,M=H.normalized,Y&&void 0!==Y[J]?(M!==Y[J]&&T.b.Warn(`Normalized flag from Draco data (${M}) does not match normalized flag from glTF accessor (${Y[J]}). Using flag from glTF accessor.`),Y[J]):M)});break;case"decodeMeshDone":z.removeEventListener("error",D),z.removeEventListener("message",g),E({indices:b,attributes:L,totalVertices:H.totalVertices}),l()}var J,M};z.addEventListener("error",D),z.addEventListener("message",g);const M=H.slice();z.postMessage({id:"decodeMesh",dataView:M,attributes:u},[M.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((z=>{let Y=null;const E=[],J=(0,b.b)(z.module,H,u,(z=>{Y=z}),((z,u,Y,H,J,l)=>{E.push({kind:z,data:u,size:Y,byteOffset:H,byteStride:J,normalized:l})}));return{indices:Y,attributes:E,totalVertices:J}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(z,u,Y,H){const E=await this.decodeMeshToMeshDataAsync(Y,H),T=new J.b(z,u);E.indices&&T.setIndices(E.indices);for(const J of E.attributes)T.setVerticesBuffer(new l.b(u.getEngine(),J.data,J.kind,!1,void 0,J.byteStride,void 0,J.byteOffset,J.size,void 0,J.normalized,!0),E.totalVertices);return T}async _decodeMeshToGeometryForGltfAsync(z,u,Y,H,E,T){const b=await this.decodeMeshToMeshDataAsync(Y,H,E),L=new J.b(z,u);T&&(L._boundingInfo=T,L.useBoundingInfoFromGeometry=!0),b.indices&&L.setIndices(b.indices);for(const J of b.attributes)L.setVerticesBuffer(new l.b(u.getEngine(),J.data,J.kind,!1,void 0,J.byteStride,void 0,J.byteOffset,J.size,void 0,J.normalized,!0),b.totalVertices);return L}}L.DefaultConfiguration={wasmUrl:`${E.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.e._DefaultCdnUrl}/draco_decoder_gltf.js`},L._Default=null},12678:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>Tz});var H=Y(10903),E=Y(11267),J=Y(11103),l=Y(11231),T=Y(11309);function b(z){let u=z.pathArray;const Y=z.closeArray||!1,H=z.closePath||!1,E=z.invertUV||!1,b=Math.floor(u[0].length/2);let L=z.offset||b;L=L>b?b:Math.floor(L);const D=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,g=z.xz,M=z.Az,q=[],C=[],K=[],h=[],o=[],d=[],t=[],W=[];let Z;const s=[],v=[];let i,X,Q;if(u.length<2){const z=[],Y=[];for(X=0;X<u[0].length-L;X++)z.push(u[0][X]),Y.push(u[0][X+L]);u=[z,Y]}let V=0;const A=H?1:0,x=Y?1:0;let G,F,R,w,c,U;for(Z=u[0].length,i=0;i<u.length+x;i++){for(t[i]=0,o[i]=[0],G=i===u.length?u[0]:u[i],F=G.length,Z=Z<F?Z:F,Q=0;Q<F;)q.push(G[Q].x,G[Q].y,G[Q].z),Q>0&&(R=G[Q].JY(G[Q-1]).length(),w=R+t[i],o[i].push(w),t[i]=w),Q++;H&&(Q--,q.push(G[0].x,G[0].y,G[0].z),R=G[Q].JY(G[0]).length(),w=R+t[i],o[i].push(w),t[i]=w),s[i]=F+A,v[i]=V,V+=F+A}let O,n,m=null,p=null;for(X=0;X<Z+A;X++)for(W[X]=0,d[X]=[0],i=0;i<u.length-1+x;i++)c=u[i],U=i===u.length-1?u[0]:u[i+1],X===Z?(m=c[0],p=U[0]):(m=c[X],p=U[X]),R=p.JY(m).length(),w=R+W[X],d[X].push(w),W[X]=w;if(g)for(i=0;i<g.length;i++)h.push(g[i].x,T.b?1-g[i].y:g[i].y);else for(i=0;i<u.length+x;i++)for(X=0;X<Z+A;X++)O=0!=t[i]?o[i][X]/t[i]:0,n=0!=W[X]?d[X][i]/W[X]:0,E?h.push(n,O):h.push(O,T.b?1-n:n);i=0;let S=0,I=s[i]-1,y=s[i+1]-1,a=I<y?I:y,j=v[1]-v[0];const k=s.length-1;for(;S<=a&&i<k;)C.push(S,S+j,S+1),C.push(S+j+1,S+1,S+j),S+=1,S===a&&(i++,j=v[i+1]-v[i],I=s[i]-1,y=s[i+1]-1,S=v[i],a=I<y?I+S:y+S);if(l.e.ComputeNormals(q,C,K),H){let z=0,Y=0;for(i=0;i<u.length;i++){z=3*v[i],Y=i+1<u.length?3*(v[i+1]-1):K.length-3,K[z]=.5*(K[z]+K[Y]),K[z+1]=.5*(K[z+1]+K[Y+1]),K[z+2]=.5*(K[z+2]+K[Y+2]);const H=Math.sqrt(K[z]*K[z]+K[z+1]*K[z+1]+K[z+2]*K[z+2]);K[z]/=H,K[z+1]/=H,K[z+2]/=H,K[Y]=K[z],K[Y+1]=K[z+1],K[Y+2]=K[z+2]}}if(Y){let z=3*v[0],Y=3*v[u.length];for(X=0;X<Z+A;X++){K[z]=.5*(K[z]+K[Y]),K[z+1]=.5*(K[z+1]+K[Y+1]),K[z+2]=.5*(K[z+2]+K[Y+2]);const u=Math.sqrt(K[z]*K[z]+K[z+1]*K[z+1]+K[z+2]*K[z+2]);K[z]/=u,K[z+1]/=u,K[z+2]/=u,K[Y]=K[z],K[Y+1]=K[z+1],K[Y+2]=K[z+2],z+=3,Y+=3}}l.e._ComputeSides(D,q,C,K,h,z.frontUVs,z.backUVs);let P=null;if(M){P=new Float32Array(4*M.length);for(let z=0;z<M.length;z++)P[4*z]=M[z].r,P[4*z+1]=M[z].g,P[4*z+2]=M[z].b,P[4*z+3]=M[z].a}const e=new l.e,N=new Float32Array(q),B=new Float32Array(K),f=new Float32Array(h);return e.indices=C,e.Qz=N,e.Vz=B,e.xz=f,P&&e.set(P,J.f.ColorKind),H&&(e._idx=v),e}function L(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=u.pathArray,D=u.closeArray,g=u.closePath,M=E.b._GetDefaultSideOrientation(u.sideOrientation),q=u.instance,C=u.updatable;if(q){const z=H.i.Pl[0].Bl(Number.MAX_VALUE),Y=H.i.Pl[1].Bl(-Number.MAX_VALUE),b=u=>{let H=L[0].length;const J=q;let l=0;const T=J._originalBuilderSideOrientation===E.b.DOUBLESIDE?2:1;for(let E=1;E<=T;++E)for(let T=0;T<L.length;++T){const E=L[T],b=E.length;H=H<b?H:b;for(let J=0;J<H;++J){const H=E[J];u[l]=H.x,u[l+1]=H.y,u[l+2]=H.z,z.minimizeInPlaceFromFloats(H.x,H.y,H.z),Y.maximizeInPlaceFromFloats(H.x,H.y,H.z),l+=3}if(J._creationDataStorage&&J._creationDataStorage.closePath){const z=E[0];u[l]=z.x,u[l+1]=z.y,u[l+2]=z.z,l+=3}}},D=q.getVerticesData(J.f.PositionKind);if(b(D),q.hasBoundingInfo?q.getBoundingInfo().reConstruct(z,Y,q._worldMatrix):q.buildBoundingInfo(z,Y,q._worldMatrix),q.updateVerticesData(J.f.PositionKind,D,!1,!1),u.Az){const z=q.getVerticesData(J.f.ColorKind);for(let Y=0,H=0;Y<u.Az.length;Y++,H+=4){const E=u.Az[Y];z[H]=E.r,z[H+1]=E.g,z[H+2]=E.b,z[H+3]=E.a}q.updateVerticesData(J.f.ColorKind,z,!1,!1)}if(u.xz){const z=q.getVerticesData(J.f.UVKind);for(let Y=0;Y<u.xz.length;Y++)z[2*Y]=u.xz[Y].x,z[2*Y+1]=T.b?1-u.xz[Y].y:u.xz[Y].y;q.updateVerticesData(J.f.UVKind,z,!1,!1)}if(!q.areNormalsFrozen||q.isFacetDataEnabled){const z=q.Il(),u=q.getVerticesData(J.f.NormalKind),Y=q.isFacetDataEnabled?q.getFacetDataParameters():null;if(l.e.ComputeNormals(D,z,u,Y),q._creationDataStorage&&q._creationDataStorage.closePath){let z=0,Y=0;for(let H=0;H<L.length;H++)z=3*q._creationDataStorage.idx[H],Y=H+1<L.length?3*(q._creationDataStorage.idx[H+1]-1):u.length-3,u[z]=.5*(u[z]+u[Y]),u[z+1]=.5*(u[z+1]+u[Y+1]),u[z+2]=.5*(u[z+2]+u[Y+2]),u[Y]=u[z],u[Y+1]=u[z+1],u[Y+2]=u[z+2]}q.areNormalsFrozen||q.updateVerticesData(J.f.NormalKind,u,!1,!1)}return q}{const H=new E.b(z,Y);H._originalBuilderSideOrientation=M,H._creationDataStorage=new E.e;const J=b(u);return g&&(H._creationDataStorage.idx=J._idx),H._creationDataStorage.closePath=g,H._creationDataStorage.closeArray=D,J.Fz(H,C),H}}l.e.CreateRibbon=b,E.b.CreateRibbon=function(z,u){return L(z,{pathArray:u,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var D=Y(12213),g=Y(12070),M=Y(11188);function q(z){const u=z.pattern||E.b.NO_FLIP,Y=z.tileWidth||z.tileSize||1,H=z.tileHeight||z.tileSize||1,J=z.alignHorizontal||0,T=z.alignVertical||0,b=z.width||z.size||1,L=Math.floor(b/Y);let D=b-L*Y;const g=z.height||z.size||1,M=Math.floor(g/H);let q=g-M*H;const C=Y*L/2,K=H*M/2;let h=0,o=0,d=0,t=0,W=0,Z=0;if(D>0||q>0){switch(d=-C,t=-K,W=C,Z=K,J){case E.b.CENTER:D/=2,d-=D,W+=D;break;case E.b.LEFT:W+=D,h=-D/2;break;case E.b.RIGHT:d-=D,h=D/2}switch(T){case E.b.CENTER:q/=2,t-=q,Z+=q;break;case E.b.BOTTOM:Z+=q,o=-q/2;break;case E.b.TOP:t-=q,o=q/2}}const s=[],v=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],u!==E.b.ROTATE_TILE&&u!==E.b.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),u!==E.b.FLIP_TILE&&u!==E.b.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),u!==E.b.FLIP_N_ROTATE_TILE&&u!==E.b.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let X=[];const Q=[],V=[];let A=0;for(let l=0;l<M;l++)for(let z=0;z<L;z++)s.push(z*Y-C+h,l*H-K+o,0),s.push((z+1)*Y-C+h,l*H-K+o,0),s.push((z+1)*Y-C+h,(l+1)*H-K+o,0),s.push(z*Y-C+h,(l+1)*H-K+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),X=u===E.b.FLIP_TILE||u===E.b.ROTATE_TILE||u===E.b.FLIP_N_ROTATE_TILE?X.concat(i[(z%2+l%2)%2]):u===E.b.FLIP_ROW||u===E.b.ROTATE_ROW||u===E.b.FLIP_N_ROTATE_ROW?X.concat(i[l%2]):X.concat(i[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),A+=4;if(D>0||q>0){const z=q>0&&(T===E.b.CENTER||T===E.b.TOP),l=q>0&&(T===E.b.CENTER||T===E.b.BOTTOM),b=D>0&&(J===E.b.CENTER||J===E.b.RIGHT),g=D>0&&(J===E.b.CENTER||J===E.b.LEFT);let i,x,G,F,R=[];if(z&&b&&(s.push(d+h,t+o,0),s.push(-C+h,t+o,0),s.push(-C+h,t+q+o,0),s.push(d+h,t+q+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,i=1-D/Y,x=1-q/H,G=1,F=1,R=[i,x,G,x,G,F,i,F],u===E.b.ROTATE_ROW&&(R=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),u===E.b.FLIP_ROW&&(R=[1-i,x,1-G,x,1-G,F,1-i,F]),u===E.b.FLIP_N_ROTATE_ROW&&(R=[i,1-x,G,1-x,G,1-F,i,1-F]),X=X.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&g&&(s.push(C+h,t+o,0),s.push(W+h,t+o,0),s.push(W+h,t+q+o,0),s.push(C+h,t+q+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,i=0,x=1-q/H,G=D/Y,F=1,R=[i,x,G,x,G,F,i,F],(u===E.b.ROTATE_ROW||u===E.b.ROTATE_TILE&&L%2===0)&&(R=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),(u===E.b.FLIP_ROW||u===E.b.FLIP_TILE&&L%2===0)&&(R=[1-i,x,1-G,x,1-G,F,1-i,F]),(u===E.b.FLIP_N_ROTATE_ROW||u===E.b.FLIP_N_ROTATE_TILE&&L%2===0)&&(R=[i,1-x,G,1-x,G,1-F,i,1-F]),X=X.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l&&b&&(s.push(d+h,K+o,0),s.push(-C+h,K+o,0),s.push(-C+h,Z+o,0),s.push(d+h,Z+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,i=1-D/Y,x=0,G=1,F=q/H,R=[i,x,G,x,G,F,i,F],(u===E.b.ROTATE_ROW&&M%2===1||u===E.b.ROTATE_TILE&&M%1===0)&&(R=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),(u===E.b.FLIP_ROW&&M%2===1||u===E.b.FLIP_TILE&&M%2===0)&&(R=[1-i,x,1-G,x,1-G,F,1-i,F]),(u===E.b.FLIP_N_ROTATE_ROW&&M%2===1||u===E.b.FLIP_N_ROTATE_TILE&&M%2===0)&&(R=[i,1-x,G,1-x,G,1-F,i,1-F]),X=X.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l&&g&&(s.push(C+h,K+o,0),s.push(W+h,K+o,0),s.push(W+h,Z+o,0),s.push(C+h,Z+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,i=0,x=0,G=D/Y,F=q/H,R=[i,x,G,x,G,F,i,F],(u===E.b.ROTATE_ROW&&M%2===1||u===E.b.ROTATE_TILE&&(M+L)%2===1)&&(R=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),(u===E.b.FLIP_ROW&&M%2===1||u===E.b.FLIP_TILE&&(M+L)%2===1)&&(R=[1-i,x,1-G,x,1-G,F,1-i,F]),(u===E.b.FLIP_N_ROTATE_ROW&&M%2===1||u===E.b.FLIP_N_ROTATE_TILE&&(M+L)%2===1)&&(R=[i,1-x,G,1-x,G,1-F,i,1-F]),X=X.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z){const z=[];i=0,x=1-q/H,G=1,F=1,z[0]=[i,x,G,x,G,F,i,F],z[1]=[i,x,G,x,G,F,i,F],u!==E.b.ROTATE_TILE&&u!==E.b.ROTATE_ROW||(z[1]=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),u!==E.b.FLIP_TILE&&u!==E.b.FLIP_ROW||(z[1]=[1-i,x,1-G,x,1-G,F,1-i,F]),u!==E.b.FLIP_N_ROTATE_TILE&&u!==E.b.FLIP_N_ROTATE_ROW||(z[1]=[i,1-x,G,1-x,G,1-F,i,1-F]);for(let H=0;H<L;H++)s.push(H*Y-C+h,t+o,0),s.push((H+1)*Y-C+h,t+o,0),s.push((H+1)*Y-C+h,t+q+o,0),s.push(H*Y-C+h,t+q+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,X=u===E.b.FLIP_TILE||u===E.b.ROTATE_TILE||u===E.b.FLIP_N_ROTATE_TILE?X.concat(z[(H+1)%2]):u===E.b.FLIP_ROW||u===E.b.ROTATE_ROW||u===E.b.FLIP_N_ROTATE_ROW?X.concat(z[1]):X.concat(z[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const z=[];i=0,x=0,G=1,F=q/H,z[0]=[i,x,G,x,G,F,i,F],z[1]=[i,x,G,x,G,F,i,F],u!==E.b.ROTATE_TILE&&u!==E.b.ROTATE_ROW||(z[1]=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),u!==E.b.FLIP_TILE&&u!==E.b.FLIP_ROW||(z[1]=[1-i,x,1-G,x,1-G,F,1-i,F]),u!==E.b.FLIP_N_ROTATE_TILE&&u!==E.b.FLIP_N_ROTATE_ROW||(z[1]=[i,1-x,G,1-x,G,1-F,i,1-F]);for(let H=0;H<L;H++)s.push(H*Y-C+h,Z-q+o,0),s.push((H+1)*Y-C+h,Z-q+o,0),s.push((H+1)*Y-C+h,Z+o,0),s.push(H*Y-C+h,Z+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,X=u===E.b.FLIP_TILE||u===E.b.ROTATE_TILE||u===E.b.FLIP_N_ROTATE_TILE?X.concat(z[(H+M)%2]):u===E.b.FLIP_ROW||u===E.b.ROTATE_ROW||u===E.b.FLIP_N_ROTATE_ROW?X.concat(z[M%2]):X.concat(z[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const z=[];i=1-D/Y,x=0,G=1,F=1,z[0]=[i,x,G,x,G,F,i,F],z[1]=[i,x,G,x,G,F,i,F],u!==E.b.ROTATE_TILE&&u!==E.b.ROTATE_ROW||(z[1]=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),u!==E.b.FLIP_TILE&&u!==E.b.FLIP_ROW||(z[1]=[1-i,x,1-G,x,1-G,F,1-i,F]),u!==E.b.FLIP_N_ROTATE_TILE&&u!==E.b.FLIP_N_ROTATE_ROW||(z[1]=[i,1-x,G,1-x,G,1-F,i,1-F]);for(let Y=0;Y<M;Y++)s.push(d+h,Y*H-K+o,0),s.push(d+D+h,Y*H-K+o,0),s.push(d+D+h,(Y+1)*H-K+o,0),s.push(d+h,(Y+1)*H-K+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,X=u===E.b.FLIP_TILE||u===E.b.ROTATE_TILE||u===E.b.FLIP_N_ROTATE_TILE?X.concat(z[(Y+1)%2]):u===E.b.FLIP_ROW||u===E.b.ROTATE_ROW||u===E.b.FLIP_N_ROTATE_ROW?X.concat(z[Y%2]):X.concat(z[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const z=[];i=0,x=0,G=D/H,F=1,z[0]=[i,x,G,x,G,F,i,F],z[1]=[i,x,G,x,G,F,i,F],u!==E.b.ROTATE_TILE&&u!==E.b.ROTATE_ROW||(z[1]=[1-i,1-x,1-G,1-x,1-G,1-F,1-i,1-F]),u!==E.b.FLIP_TILE&&u!==E.b.FLIP_ROW||(z[1]=[1-i,x,1-G,x,1-G,F,1-i,F]),u!==E.b.FLIP_N_ROTATE_TILE&&u!==E.b.FLIP_N_ROTATE_ROW||(z[1]=[i,1-x,G,1-x,G,1-F,i,1-F]);for(let Y=0;Y<M;Y++)s.push(W-D+h,Y*H-K+o,0),s.push(W+h,Y*H-K+o,0),s.push(W+h,(Y+1)*H-K+o,0),s.push(W-D+h,(Y+1)*H-K+o,0),V.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,X=u===E.b.FLIP_TILE||u===E.b.ROTATE_TILE||u===E.b.FLIP_N_ROTATE_TILE?X.concat(z[(Y+L)%2]):u===E.b.FLIP_ROW||u===E.b.ROTATE_ROW||u===E.b.FLIP_N_ROTATE_ROW?X.concat(z[Y%2]):X.concat(z[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const x=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE;l.e._ComputeSides(x,s,V,v,X,z.frontUVs,z.backUVs);const G=new l.e;G.indices=V,G.Qz=s,G.Vz=v,G.xz=X;const F=x===l.e.DOUBLESIDE?Q.concat(Q):Q;return G.Az=F,G}function C(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return q(u).Fz(H,u.updatable),H}function K(z){const u=z.faceUV||new Array(6),Y=z.faceColors,J=z.pattern||E.b.NO_FLIP,b=z.width||z.size||1,L=z.height||z.size||1,D=z.depth||z.size||1,g=z.tileWidth||z.tileSize||1,C=z.tileHeight||z.tileSize||1,K=z.alignHorizontal||0,h=z.alignVertical||0,o=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===u[E]&&(u[E]=new H.t(0,0,1,1)),Y&&void 0===Y[E]&&(Y[E]=new M.e(1,1,1,1));const d=b/2,t=L/2,W=D/2,Z=[];for(let H=0;H<2;H++)Z[H]=q({pattern:J,tileWidth:g,tileHeight:C,width:b,height:L,alignVertical:h,alignHorizontal:K,sideOrientation:o});for(let H=2;H<4;H++)Z[H]=q({pattern:J,tileWidth:g,tileHeight:C,width:D,height:L,alignVertical:h,alignHorizontal:K,sideOrientation:o});let s=h;h===E.b.BOTTOM?s=E.b.TOP:h===E.b.TOP&&(s=E.b.BOTTOM);for(let H=4;H<6;H++)Z[H]=q({pattern:J,tileWidth:g,tileHeight:C,width:b,height:D,alignVertical:s,alignHorizontal:K,sideOrientation:o});let v=[],i=[],X=[],Q=[];const V=[],A=[],x=[],G=[];let F=0,R=0;for(let E=0;E<6;E++){const z=Z[E].Qz.length;A[E]=[],x[E]=[];for(let u=0;u<z/3;u++)A[E].push(new H.p(Z[E].Qz[3*u],Z[E].Qz[3*u+1],Z[E].Qz[3*u+2])),x[E].push(new H.p(Z[E].Vz[3*u],Z[E].Vz[3*u+1],Z[E].Vz[3*u+2]));F=Z[E].xz.length,G[E]=[];for(let Y=0;Y<F;Y+=2)G[E][Y]=u[E].x+(u[E].z-u[E].x)*Z[E].xz[Y],G[E][Y+1]=u[E].y+(u[E].w-u[E].y)*Z[E].xz[Y+1],T.b&&(G[E][Y+1]=1-G[E][Y+1]);if(X=X.concat(G[E]),Q=Q.concat(Z[E].indices.map((z=>z+R))),R+=A[E].length,Y)for(let u=0;u<4;u++)V.push(Y[E].r,Y[E].g,Y[E].b,Y[E].a)}const w=new H.p(0,0,W),c=H.b.RotationY(Math.PI);v=A[0].map((z=>H.p.TransformNormal(z,c).add(w))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]),i=x[0].map((z=>H.p.TransformNormal(z,c))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]),v=v.concat(A[1].map((z=>z.JY(w))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),i=i.concat(x[1].map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const U=new H.p(d,0,0),O=H.b.RotationY(-Math.PI/2);v=v.concat(A[2].map((z=>H.p.TransformNormal(z,O).add(U))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),i=i.concat(x[2].map((z=>H.p.TransformNormal(z,O))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const n=H.b.RotationY(Math.PI/2);v=v.concat(A[3].map((z=>H.p.TransformNormal(z,n).JY(U))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),i=i.concat(x[3].map((z=>H.p.TransformNormal(z,n))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const m=new H.p(0,t,0),p=H.b.RotationX(Math.PI/2);v=v.concat(A[4].map((z=>H.p.TransformNormal(z,p).add(m))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),i=i.concat(x[4].map((z=>H.p.TransformNormal(z,p))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[]));const S=H.b.RotationX(-Math.PI/2);v=v.concat(A[5].map((z=>H.p.TransformNormal(z,S).JY(m))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),i=i.concat(x[5].map((z=>H.p.TransformNormal(z,S))).map((z=>[z.x,z.y,z.z])).reduce(((z,u)=>z.concat(u)),[])),l.e._ComputeSides(o,v,Q,i,X);const I=new l.e;if(I.indices=Q,I.Qz=v,I.Vz=i,I.xz=X,Y){const z=o===l.e.DOUBLESIDE?V.concat(V):V;I.Az=z}return I}function h(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return K(u).Fz(H,u.updatable),H}l.e.CreateTiledPlane=q;l.e.CreateTiledBox=K;var o=Y(12204),d=Y(11504),t=Y(11256);function W(z){const u=z.height||2;let Y=0===z.diameterTop?0:z.diameterTop||z.diameter||1,J=0===z.diameterBottom?0:z.diameterBottom||z.diameter||1;Y=Y||1e-5,J=J||1e-5;const b=0|(z.tessellation||24),L=0|(z.subdivisions||1),D=!!z.hasRings,g=!!z.enclose,q=0===z.cap?0:z.cap||E.b.CAP_ALL,C=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,K=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,h=z.faceUV||new Array(3),o=z.faceColors,d=2+(1+(1!==C&&g?2:0))*(D?L:1);let W;for(W=0;W<d;W++)o&&void 0===o[W]&&(o[W]=new M.e(1,1,1,1));for(W=0;W<d;W++)h&&void 0===h[W]&&(h[W]=new H.t(0,0,1,1));const Z=[],s=[],v=[],i=[],X=[],Q=2*Math.PI*C/b;let V,A,x;const G=(J-Y)/2/u,F=H.p.Zero(),R=H.p.Zero(),w=H.p.Zero(),c=H.p.Zero(),U=H.p.Zero(),O=t.c.Y;let n,m,p,S=1,I=1,y=0,a=0;for(n=0;n<=L;n++)for(A=n/L,x=(A*(Y-J)+J)/2,S=D&&0!==n&&n!==L?2:1,p=0;p<S;p++){for(D&&(I+=p),g&&(I+=2*p),m=0;m<=b;m++)V=m*Q,F.x=Math.cos(-V)*x,F.y=-u/2+A*u,F.z=Math.sin(-V)*x,0===Y&&n===L?(R.x=v[v.length-3*(b+1)],R.y=v[v.length-3*(b+1)+1],R.z=v[v.length-3*(b+1)+2]):(R.x=F.x,R.z=F.z,R.y=Math.sqrt(R.x*R.x+R.z*R.z)*G,R.normalize()),0===m&&(w.J(F),c.J(R)),s.push(F.x,F.y,F.z),v.push(R.x,R.y,R.z),a=D?y!==I?h[I].y:h[I].w:h[I].y+(h[I].w-h[I].y)*A,i.push(h[I].x+(h[I].z-h[I].x)*m/b,T.b?1-a:a),o&&X.push(o[I].r,o[I].g,o[I].b,o[I].a);1!==C&&g&&(s.push(F.x,F.y,F.z),s.push(0,F.y,0),s.push(0,F.y,0),s.push(w.x,w.y,w.z),H.p.CrossToRef(O,R,U),U.normalize(),v.push(U.x,U.y,U.z,U.x,U.y,U.z),H.p.CrossToRef(c,O,U),U.normalize(),v.push(U.x,U.y,U.z,U.x,U.y,U.z),a=D?y!==I?h[I+1].y:h[I+1].w:h[I+1].y+(h[I+1].w-h[I+1].y)*A,i.push(h[I+1].x,T.b?1-a:a),i.push(h[I+1].z,T.b?1-a:a),a=D?y!==I?h[I+2].y:h[I+2].w:h[I+2].y+(h[I+2].w-h[I+2].y)*A,i.push(h[I+2].x,T.b?1-a:a),i.push(h[I+2].z,T.b?1-a:a),o&&(X.push(o[I+1].r,o[I+1].g,o[I+1].b,o[I+1].a),X.push(o[I+1].r,o[I+1].g,o[I+1].b,o[I+1].a),X.push(o[I+2].r,o[I+2].g,o[I+2].b,o[I+2].a),X.push(o[I+2].r,o[I+2].g,o[I+2].b,o[I+2].a))),y!==I&&(y=I)}const j=1!==C&&g?b+4:b;for(n=0,I=0;I<L;I++){let z=0,u=0,Y=0,H=0;for(m=0;m<b;m++)z=n*(j+1)+m,u=(n+1)*(j+1)+m,Y=n*(j+1)+(m+1),H=(n+1)*(j+1)+(m+1),Z.push(z,u,Y),Z.push(H,Y,u);1!==C&&g&&(Z.push(z+2,u+2,Y+2),Z.push(H+2,Y+2,u+2),Z.push(z+4,u+4,Y+4),Z.push(H+4,Y+4,u+4)),n=D?n+2:n+1}const k=z=>{const E=z?Y/2:J/2;if(0===E)return;let l,L,D;const g=z?h[d-1]:h[0];let M=null;o&&(M=z?o[d-1]:o[0]);const q=s.length/3,K=z?u/2:-u/2,t=new H.p(0,K,0);s.push(t.x,t.y,t.z),v.push(0,z?1:-1,0);const W=g.y+.5*(g.w-g.y);i.push(g.x+.5*(g.z-g.x),T.b?1-W:W),M&&X.push(M.r,M.g,M.b,M.a);const Q=new H.m(.5,.5);for(D=0;D<=b;D++){l=2*Math.PI*D*C/b;const u=Math.cos(-l),Y=Math.sin(-l);L=new H.p(u*E,K,Y*E);const J=new H.m(u*Q.x+.5,Y*Q.y+.5);s.push(L.x,L.y,L.z),v.push(0,z?1:-1,0);const q=g.y+(g.w-g.y)*J.y;i.push(g.x+(g.z-g.x)*J.x,T.b?1-q:q),M&&X.push(M.r,M.g,M.b,M.a)}for(D=0;D<b;D++)z?(Z.push(q),Z.push(q+(D+2)),Z.push(q+(D+1))):(Z.push(q),Z.push(q+(D+1)),Z.push(q+(D+2)))};q!==E.b.CAP_START&&q!==E.b.CAP_ALL||k(!1),q!==E.b.CAP_END&&q!==E.b.CAP_ALL||k(!0),l.e._ComputeSides(K,s,Z,v,i,z.frontUVs,z.backUVs);const P=new l.e;return P.indices=Z,P.Qz=s,P.Vz=v,P.xz=i,o&&(P.Az=X),P}function Z(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return W(u).Fz(H,u.updatable),H}function s(z){const u=[],Y=[],E=[],J=[],b=z.diameter||1,L=z.thickness||.5,D=0|(z.tessellation||16),g=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,M=D+1;for(let l=0;l<=D;l++){const z=l/D,g=l*Math.PI*2/D-Math.PI/2,q=H.b.Translation(b/2,0,0).multiply(H.b.RotationY(g));for(let b=0;b<=D;b++){const g=1-b/D,C=b*Math.PI*2/D+Math.PI,K=Math.cos(C),h=Math.sin(C);let o=new H.p(K,h,0),d=o.scale(L/2);const t=new H.m(z,g);d=H.p.TransformCoordinates(d,q),o=H.p.TransformNormal(o,q),Y.push(d.x,d.y,d.z),E.push(o.x,o.y,o.z),J.push(t.x,T.b?1-t.y:t.y);const W=(l+1)%M,Z=(b+1)%M;u.push(l*M+b),u.push(l*M+Z),u.push(W*M+b),u.push(l*M+Z),u.push(W*M+Z),u.push(W*M+b)}}l.e._ComputeSides(g,Y,u,E,J,z.frontUVs,z.backUVs);const q=new l.e;return q.indices=u,q.Qz=Y,q.Vz=E,q.xz=J,q}function v(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return s(u).Fz(H,u.updatable),H}l.e.CreateCylinder=W,E.b.CreateCylinder=(z,u,Y,H,J,l,T,b,L)=>{void 0!==T&&T instanceof d.d||(void 0!==T&&(L=b||E.b.DEFAULTSIDE,b=T),T=l,l=1);return Z(z,{height:u,diameterTop:Y,diameterBottom:H,tessellation:J,subdivisions:l,sideOrientation:L,updatable:b},T)};function i(z){const u=[],Y=[],E=[],J=[],b=z.radius||2,L=z.tube||.5,D=z.radialSegments||32,g=z.tubularSegments||32,M=z.p||2,q=z.q||3,C=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,K=z=>{const u=Math.cos(z),Y=Math.sin(z),E=q/M*z,J=Math.cos(E),l=b*(2+J)*.5*u,T=b*(2+J)*Y*.5,L=b*Math.sin(E)*.5;return new H.p(l,T,L)};let h,o;for(h=0;h<=D;h++){const z=h%D/D*2*M*Math.PI,u=K(z),E=K(z+.01),l=E.JY(u);let b=E.add(u);const q=H.p.Cross(l,b);for(b=H.p.Cross(q,l),q.normalize(),b.normalize(),o=0;o<g;o++){const z=o%g/g*2*Math.PI,H=-L*Math.cos(z),E=L*Math.sin(z);Y.push(u.x+H*b.x+E*q.x),Y.push(u.y+H*b.y+E*q.y),Y.push(u.z+H*b.z+E*q.z),J.push(h/D),J.push(T.b?1-o/g:o/g)}}for(h=0;h<D;h++)for(o=0;o<g;o++){const z=(o+1)%g,Y=h*g+o,H=(h+1)*g+o,E=(h+1)*g+z,J=h*g+z;u.push(J),u.push(H),u.push(Y),u.push(J),u.push(E),u.push(H)}l.e.ComputeNormals(Y,u,E),l.e._ComputeSides(C,Y,u,E,J,z.frontUVs,z.backUVs);const d=new l.e;return d.indices=u,d.Qz=Y,d.Vz=E,d.xz=J,d}function X(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return i(u).Fz(H,u.updatable),H}l.e.CreateTorus=s,E.b.CreateTorus=(z,u,Y,H,E,J,l)=>v(z,{diameter:u,thickness:Y,tessellation:H,sideOrientation:l,updatable:J},E);l.e.CreateTorusKnot=i,E.b.CreateTorusKnot=(z,u,Y,H,E,J,l,T,b,L)=>X(z,{radius:u,tube:Y,radialSegments:H,tubularSegments:E,p:J,q:l,sideOrientation:L,updatable:b},T);var Q=Y(12685),V=Y(11655),A=Y(11389);function x(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=u.path,J=u.shape,l=u.scale||1,T=u.rotation||0,b=0===u.cap?0:u.cap||E.b.NO_CAP,L=u.updatable,D=E.b._GetDefaultSideOrientation(u.sideOrientation),g=u.instance||null,M=u.invertUV||!1,q=u.closeShape||!1,C=u.closePath||!1,K=u.capFunction||null;return F(z,J,H,l,T,null,null,C,q,b,!1,Y,!!L,D,g,M,u.frontUVs||null,u.backUVs||null,u.firstNormal||null,!!u.adjustFrame,K)}function G(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=u.path,J=u.shape,l=u.scaleFunction||(()=>1),T=u.rotationFunction||(()=>0),b=u.closePath||u.ribbonCloseArray||!1,L=u.closeShape||u.ribbonClosePath||!1,D=0===u.cap?0:u.cap||E.b.NO_CAP,g=u.updatable,M=u.firstNormal||null,q=u.adjustFrame||!1,C=E.b._GetDefaultSideOrientation(u.sideOrientation),K=u.instance,h=u.invertUV||!1,o=u.capFunction||null;return F(z,J,H,null,null,l,T,b,L,D,!0,Y,!!g,C,K||null,h,u.frontUVs||null,u.backUVs||null,M,q,o||null)}function F(z,u,Y,J,l,T,b,D,g,M,q,C,K,h,o,d,t,W,Z,s,v){const i=(z,u,Y,J,l,T,b,L,D,g,M)=>{const q=Y.getTangents(),C=Y.getNormals(),K=Y.getBinormals(),h=Y.getDistances();if(M)for(let E=0;E<q.length;E++)if(0==q[E].x&&0==q[E].y&&0==q[E].z&&q[E].J(q[E-1]),0==C[E].x&&0==C[E].y&&0==C[E].z&&C[E].J(C[E-1]),0==K[E].x&&0==K[E].y&&0==K[E].z&&K[E].J(K[E-1]),E>0){let z=q[E-1];H.p.Dot(z,q[E])<0&&q[E].scaleInPlace(-1),z=C[E-1],H.p.Dot(z,C[E])<0&&C[E].scaleInPlace(-1),z=K[E-1],H.p.Dot(z,K[E])<0&&K[E].scaleInPlace(-1)}let o=0;const d=g&&L?L:()=>null!==T?T:0,t=g&&b?b:()=>null!==l?l:1;let W=D===E.b.NO_CAP||D===E.b.CAP_END?0:2;const Z=H.i.Matrix[0];for(let E=0;E<u.length;E++){const Y=[],l=d(E,h[E]),T=t(E,h[E]);H.b.RotationAxisToRef(q[E],o,Z);for(let J=0;J<z.length;J++){const l=q[E].scale(z[J].z).add(C[E].scale(z[J].x)).add(K[E].scale(z[J].y)),b=H.p.Zero();H.p.TransformCoordinatesToRef(l,Z,b),b.scaleInPlace(T).addInPlace(u[E]),Y[J]=b}J[W]=Y,o+=l,W++}const s=v||(z=>{const u=Array(),Y=H.p.Zero();let E;for(E=0;E<z.length;E++)Y.addInPlace(z[E]);for(Y.scaleInPlace(1/z.length),E=0;E<z.length;E++)u.push(Y);return u});switch(D){case E.b.NO_CAP:break;case E.b.CAP_START:J[0]=s(J[2]),J[1]=J[2];break;case E.b.CAP_END:J[W]=J[W-1],J[W+1]=s(J[W-1]);break;case E.b.CAP_ALL:J[0]=s(J[2]),J[1]=J[2],J[W]=J[W-1],J[W+1]=s(J[W-1])}return J};let X,Q;if(o){const z=o._creationDataStorage;return X=Z?z.path3D.update(Y,Z):z.path3D.update(Y),Q=i(u,Y,z.path3D,z.pathArray,J,l,T,b,z.cap,q,s),o=L("",{pathArray:Q,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:o},C||void 0)}X=Z?new A.g(Y,Z):new A.g(Y);Q=i(u,Y,X,new Array,J,l,T,b,M=M<0||M>3?0:M,q,s);const V=L(z,{pathArray:Q,closeArray:D,closePath:g,updatable:K,sideOrientation:h,invertUV:d,frontUVs:t||void 0,backUVs:W||void 0},C);return V._creationDataStorage.pathArray=Q,V._creationDataStorage.path3D=X,V._creationDataStorage.cap=M,V}function R(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.arc?u.arc<=0||u.arc>1?1:u.arc:1,l=void 0===u.closed||u.closed,T=u.shape,b=u.radius||1,D=u.tessellation||64,g=u.clip||0,M=u.updatable,q=E.b._GetDefaultSideOrientation(u.sideOrientation),C=u.cap||E.b.NO_CAP,K=2*Math.PI,h=[],o=u.invertUV||!1;let d=0,t=0;const W=K/D*J;let Z,s;for(d=0;d<=D-g;d++){for(s=[],C!=E.b.CAP_START&&C!=E.b.CAP_ALL||(s.push(new H.p(0,T[0].y,0)),s.push(new H.p(Math.cos(d*W)*T[0].x*b,T[0].y,Math.sin(d*W)*T[0].x*b))),t=0;t<T.length;t++)Z=new H.p(Math.cos(d*W)*T[t].x*b,T[t].y,Math.sin(d*W)*T[t].x*b),s.push(Z);C!=E.b.CAP_END&&C!=E.b.CAP_ALL||(s.push(new H.p(Math.cos(d*W)*T[T.length-1].x*b,T[T.length-1].y,Math.sin(d*W)*T[T.length-1].x*b)),s.push(new H.p(0,T[T.length-1].y,0))),h.push(s)}return L(z,{pathArray:h,closeArray:l,sideOrientation:q,updatable:M,invertUV:o,frontUVs:u.frontUVs,backUVs:u.backUVs},Y)}E.b.ExtrudeShape=function(z,u,Y,H,J,l){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0,D=arguments.length>9?arguments[9]:void 0;return x(z,{shape:u,path:Y,scale:H,rotation:J,cap:0===l?0:l||E.b.NO_CAP,sideOrientation:L,instance:D,updatable:b},T)},E.b.ExtrudeShapeCustom=(z,u,Y,H,J,l,T,b,L,D,g,M)=>G(z,{shape:u,path:Y,scaleFunction:H,rotationFunction:J,ribbonCloseArray:l,ribbonClosePath:T,cap:0===b?0:b||E.b.NO_CAP,sideOrientation:g,instance:M,updatable:D},L);E.b.CreateLathe=(z,u,Y,H,E,J,l)=>R(z,{shape:u,radius:Y,tessellation:H,sideOrientation:l,updatable:J},E);var w=Y(12113),c=Y(12078);function U(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.path;let l=u.instance,T=1;void 0!==u.radius?T=u.radius:l&&(T=l._creationDataStorage.radius);const b=u.tessellation||64,D=u.radiusFunction||null;let g=u.cap||E.b.NO_CAP;const M=u.invertUV||!1,q=u.updatable,C=E.b._GetDefaultSideOrientation(u.sideOrientation);u.arc=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1;const K=(z,u,Y,J,l,T,b,L)=>{const D=u.getTangents(),g=u.getNormals(),M=u.getDistances(),q=2*Math.PI/l*L,C=T||(()=>J);let K,h,o,d;const t=H.i.Matrix[0];let W=b===E.b.NO_CAP||b===E.b.CAP_END?0:2;for(let E=0;E<z.length;E++){h=C(E,M[E]),K=Array(),o=g[E];for(let u=0;u<l;u++)H.b.RotationAxisToRef(D[E],q*u,t),d=K[u]?K[u]:H.p.Zero(),H.p.TransformCoordinatesToRef(o,t,d),d.scaleInPlace(h).addInPlace(z[E]),K[u]=d;Y[W]=K,W++}const Z=(u,Y)=>{const H=Array();for(let E=0;E<u;E++)H.push(z[Y]);return H};switch(b){case E.b.NO_CAP:break;case E.b.CAP_START:Y[0]=Z(l,0),Y[1]=Y[2].slice(0);break;case E.b.CAP_END:Y[W]=Y[W-1].slice(0),Y[W+1]=Z(l,z.length-1);break;case E.b.CAP_ALL:Y[0]=Z(l,0),Y[1]=Y[2].slice(0),Y[W]=Y[W-1].slice(0),Y[W+1]=Z(l,z.length-1)}return Y};let h,o;if(l){const z=l._creationDataStorage,Y=u.arc||z.arc;return h=z.path3D.update(J),o=K(J,h,z.pathArray,T,z.tessellation,D,z.cap,Y),l=L("",{pathArray:o,instance:l}),z.path3D=h,z.pathArray=o,z.arc=Y,z.radius=T,l}h=new A.g(J);g=g<0||g>3?0:g,o=K(J,h,new Array,T,b,D,g,u.arc);const d=L(z,{pathArray:o,closePath:!0,closeArray:!1,updatable:q,sideOrientation:C,invertUV:M,frontUVs:u.frontUVs,backUVs:u.backUVs},Y);return d._creationDataStorage.pathArray=o,d._creationDataStorage.path3D=h,d._creationDataStorage.tessellation=b,d._creationDataStorage.cap=g,d._creationDataStorage.arc=u.arc,d._creationDataStorage.radius=T,d}function O(z){const u=[];u[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},u[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},u[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},u[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},u[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},u[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},u[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},u[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},u[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},u[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},u[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},u[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},u[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},u[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},u[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Y=z.type&&(z.type<0||z.type>=u.length)?0:z.type||0,E=z.size,J=z.sizeX||E||1,b=z.sizeY||E||1,L=z.sizeZ||E||1,D=z.custom||u[Y],g=D.face.length,q=z.faceUV||new Array(g),C=z.faceColors,K=void 0===z.flat||z.flat,h=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,o=[],d=[],t=[],W=[],Z=[];let s=0,v=0;const i=[];let X,Q,V,A,x,G,F=0,R=0;if(K)for(R=0;R<g;R++)C&&void 0===C[R]&&(C[R]=new M.e(1,1,1,1)),q&&void 0===q[R]&&(q[R]=new H.t(0,0,1,1));if(K)for(R=0;R<g;R++){const z=D.face[R].length;for(V=2*Math.PI/z,A=.5*Math.tan(V/2),x=.5,F=0;F<z;F++)o.push(D.vertex[D.face[R][F]][0]*J,D.vertex[D.face[R][F]][1]*b,D.vertex[D.face[R][F]][2]*L),i.push(s),s++,X=q[R].x+(q[R].z-q[R].x)*(.5+A),Q=q[R].y+(q[R].w-q[R].y)*(x-.5),W.push(X,T.b?1-Q:Q),G=A*Math.cos(V)-x*Math.sin(V),x=A*Math.sin(V)+x*Math.cos(V),A=G,C&&Z.push(C[R].r,C[R].g,C[R].b,C[R].a);for(F=0;F<z-2;F++)d.push(i[0+v],i[F+2+v],i[F+1+v]);v+=z}else{for(F=0;F<D.vertex.length;F++)o.push(D.vertex[F][0]*J,D.vertex[F][1]*b,D.vertex[F][2]*L),W.push(0,T.b?1:0);for(R=0;R<g;R++)for(F=0;F<D.face[R].length-2;F++)d.push(D.face[R][0],D.face[R][F+2],D.face[R][F+1])}l.e.ComputeNormals(o,d,t),l.e._ComputeSides(h,o,d,t,W,z.frontUVs,z.backUVs);const w=new l.e;return w.Qz=o,w.indices=d,w.Vz=t,w.xz=W,C&&K&&(w.Az=Z),w}function n(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return O(u).Fz(H,u.updatable),H}E.b.CreateTube=(z,u,Y,H,E,J,l,T,b,L)=>U(z,{path:u,radius:Y,tessellation:H,radiusFunction:E,arc:1,cap:J,updatable:T,sideOrientation:b,instance:L},l);function m(z){const u=z.sideOrientation||l.e.DEFAULTSIDE,Y=z.radius||1,E=void 0===z.flat||z.flat,J=0|(z.subdivisions||4),b=z.radiusX||Y,L=z.radiusY||Y,D=z.radiusZ||Y,g=(1+Math.sqrt(5))/2,M=[-1,g,-0,1,g,0,-1,-g,0,1,-g,0,0,-1,-g,0,1,-g,0,-1,g,0,1,g,g,0,1,g,0,-1,-g,0,1,-g,0,-1],q=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],C=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],K=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],o=[],d=[],t=[],W=[];let Z=0;const s=new Array(3),v=new Array(3);let i;for(i=0;i<3;i++)s[i]=H.p.Zero(),v[i]=H.m.Zero();for(let l=0;l<20;l++){for(i=0;i<3;i++){const z=q[3*l+i];s[i].kl(M[3*C[z]],M[3*C[z]+1],M[3*C[z]+2]),s[i].normalize(),v[i].kl(.134765625*K[2*z]+.05859375+-.0390625*h[l],.2333984375*K[2*z+1]+.025390625+.01953125*h[l])}const z=(z,u,Y,l)=>{const g=H.p.Lerp(s[0],s[2],u/J),M=H.p.Lerp(s[1],s[2],u/J),q=J===u?s[2]:H.p.Lerp(g,M,z/(J-u));let C;if(q.normalize(),E){const z=H.p.Lerp(s[0],s[2],l/J),u=H.p.Lerp(s[1],s[2],l/J);C=H.p.Lerp(z,u,Y/(J-l))}else C=new H.p(q.x,q.y,q.z);C.x/=b,C.y/=L,C.z/=D,C.normalize();const K=H.m.Lerp(v[0],v[2],u/J),h=H.m.Lerp(v[1],v[2],u/J),i=J===u?v[2]:H.m.Lerp(K,h,z/(J-u));d.push(q.x*b,q.y*L,q.z*D),t.push(C.x,C.y,C.z),W.push(i.x,T.b?1-i.y:i.y),o.push(Z),Z++};for(let u=0;u<J;u++)for(let Y=0;Y+u<J;Y++)z(Y,u,Y+1/3,u+1/3),z(Y+1,u,Y+1/3,u+1/3),z(Y,u+1,Y+1/3,u+1/3),Y+u+1<J&&(z(Y+1,u,Y+2/3,u+2/3),z(Y+1,u+1,Y+2/3,u+2/3),z(Y,u+1,Y+2/3,u+2/3))}l.e._ComputeSides(u,d,o,t,W,z.frontUVs,z.backUVs);const X=new l.e;return X.indices=o,X.Qz=d,X.Vz=t,X.xz=W,X}function p(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new E.b(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),H._originalBuilderSideOrientation=u.sideOrientation;return m(u).Fz(H,u.updatable),H}l.e.CreatePolyhedron=O,E.b.CreatePolyhedron=(z,u,Y)=>n(z,u,Y);l.e.CreateIcoSphere=m,E.b.CreateIcoSphere=(z,u,Y)=>p(z,u,Y);var S=Y(10937);const I=new H.p(1,0,0),y=new H.p(-1,0,0),a=new H.p(0,1,0),j=new H.p(0,-1,0),k=new H.p(0,0,1),P=new H.p(0,0,-1);class e{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.p.Zero(),u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.p.Up(),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.m.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=z,this.wl=u,this.uv=Y,this.vertexIdx=E,this.vertexIdxForBones=J,this.localPositionOverride=l,this.localNormalOverride=T,this.matrixIndicesOverride=b,this.matrixWeightsOverride=L}clone(){var z,u,Y,H;return new e(this.position.clone(),this.wl.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(z=this.localPositionOverride)||void 0===z?void 0:z.slice(),null===(u=this.localNormalOverride)||void 0===u?void 0:u.slice(),null===(Y=this.matrixIndicesOverride)||void 0===Y?void 0:Y.slice(),null===(H=this.matrixWeightsOverride)||void 0===H?void 0:H.slice())}}function N(z,u,Y){var b,L,D,g,M;const q=!!u.skeleton,C=!(null===(b=u.morphTargetManager)||void 0===b||!b.numTargets),K=Y.localMode||q,h=u.Il(),o=q||C?u.tT(!0,!0):u.getVerticesData(J.f.PositionKind),d=q||C?u.getNormalsData(!0,!0):u.getVerticesData(J.f.NormalKind),t=K?q?u.getVerticesData(J.f.PositionKind):o:null,W=K?q?u.getVerticesData(J.f.NormalKind):d:null,Z=u.getVerticesData(J.f.UVKind),s=q?u.getVerticesData(J.f.MatricesIndicesKind):null,v=q?u.getVerticesData(J.f.MatricesWeightsKind):null,i=q?u.getVerticesData(J.f.MatricesIndicesExtraKind):null,X=q?u.getVerticesData(J.f.MatricesWeightsExtraKind):null,Q=Y.position||H.p.Zero();let V=Y.wl||H.p.Up();const A=Y.size||H.p.One(),x=Y.angle||0;if(!V){const z=new H.p(0,0,1),Y=u.iz().activeCamera,E=H.p.TransformCoordinates(z,Y.getWorldMatrix());V=Y.globalPosition.JY(E)}const G=-Math.atan2(V.z,V.x)-Math.PI/2,F=Math.sqrt(V.x*V.x+V.z*V.z),R=Math.atan2(V.y,F),w=new l.e;w.indices=[],w.Qz=[],w.Vz=[],w.xz=[],w.matricesIndices=q?[]:null,w.matricesWeights=q?[]:null,w.matricesIndicesExtra=i?[]:null,w.matricesWeightsExtra=X?[]:null;let c=0;const U=(z,u)=>{const E=new e;if(!h||!o||!d)return E;const J=h[z];if(E.vertexIdx=3*J,E.vertexIdxForBones=4*J,E.position=new H.p(o[3*J],o[3*J+1],o[3*J+2]),H.p.TransformCoordinatesToRef(E.position,u,E.position),E.wl=new H.p(d[3*J],d[3*J+1],d[3*J+2]),H.p.TransformNormalToRef(E.wl,u,E.wl),Y.captureUVS&&Z){const z=Z[2*J+1];E.uv=new H.m(Z[2*J],T.b?1-z:z)}return E},O=[0,0,0,0],n=(z,u)=>{if(0===z.length)return z;const Y=.5*Math.abs(H.p.Dot(A,u)),E=(z,u,Y,H)=>{for(let E=0;E<H;++E)if(z[Y+E]===u)return Y+E;return-1},J=(z,J)=>{const l=H.p.GetClipFactor(z.position,J.position,u,Y);let T=O,b=O;if(s&&v){const u=z.matrixIndicesOverride?0:z.vertexIdxForBones,Y=z.matrixIndicesOverride??s,H=z.matrixWeightsOverride??v,L=J.matrixIndicesOverride?0:J.vertexIdxForBones,D=J.matrixIndicesOverride??s,g=J.matrixWeightsOverride??v;T=[0,0,0,0],b=[0,0,0,0];let M=0;for(let z=0;z<4;++z)if(H[u+z]>0){const J=E(D,Y[u+z],L,4);T[M]=Y[u+z],b[M]=(0,S.Lerp)(H[u+z],J>=0?g[J]:0,l),M++}for(let z=0;z<4&&M<4;++z){const H=D[L+z];-1===E(Y,H,u,4)&&(T[M]=H,b[M]=(0,S.Lerp)(0,g[L+z],l),M++)}const q=b[0]+b[1]+b[2]+b[3];b[0]/=q,b[1]/=q,b[2]/=q,b[3]/=q}const L=z.localPositionOverride?z.localPositionOverride[0]:(null===t||void 0===t?void 0:t[z.vertexIdx])??0,D=z.localPositionOverride?z.localPositionOverride[1]:(null===t||void 0===t?void 0:t[z.vertexIdx+1])??0,g=z.localPositionOverride?z.localPositionOverride[2]:(null===t||void 0===t?void 0:t[z.vertexIdx+2])??0,M=J.localPositionOverride?J.localPositionOverride[0]:(null===t||void 0===t?void 0:t[J.vertexIdx])??0,q=J.localPositionOverride?J.localPositionOverride[1]:(null===t||void 0===t?void 0:t[J.vertexIdx+1])??0,C=J.localPositionOverride?J.localPositionOverride[2]:(null===t||void 0===t?void 0:t[J.vertexIdx+2])??0,K=z.localNormalOverride?z.localNormalOverride[0]:(null===W||void 0===W?void 0:W[z.vertexIdx])??0,h=z.localNormalOverride?z.localNormalOverride[1]:(null===W||void 0===W?void 0:W[z.vertexIdx+1])??0,o=z.localNormalOverride?z.localNormalOverride[2]:(null===W||void 0===W?void 0:W[z.vertexIdx+2])??0,d=K+((J.localNormalOverride?J.localNormalOverride[0]:(null===W||void 0===W?void 0:W[J.vertexIdx])??0)-K)*l,Z=h+((J.localNormalOverride?J.localNormalOverride[1]:(null===W||void 0===W?void 0:W[J.vertexIdx+1])??0)-h)*l,i=o+((J.localNormalOverride?J.localNormalOverride[2]:(null===W||void 0===W?void 0:W[J.vertexIdx+2])??0)-o)*l,X=Math.sqrt(d*d+Z*Z+i*i);return new e(H.p.Lerp(z.position,J.position,l),H.p.Lerp(z.wl,J.wl,l).normalize(),H.m.Lerp(z.uv,J.uv,l),-1,-1,t?[L+(M-L)*l,D+(q-D)*l,g+(C-g)*l]:null,W?[d/X,Z/X,i/X]:null,T,b)};let l=null;z.length>3&&(l=[]);for(let T=0;T<z.length;T+=3){let E=0,b=null,L=null,D=null,g=null;const M=H.p.Dot(z[T].position,u)-Y>0,q=H.p.Dot(z[T+1].position,u)-Y>0,C=H.p.Dot(z[T+2].position,u)-Y>0;switch(E=(M?1:0)+(q?1:0)+(C?1:0),E){case 0:z.length>3?(l.push(z[T]),l.push(z[T+1]),l.push(z[T+2])):l=z;break;case 1:if(l=l??new Array,M&&(b=z[T+1],L=z[T+2],D=J(z[T],b),g=J(z[T],L)),q){b=z[T],L=z[T+2],D=J(z[T+1],b),g=J(z[T+1],L),l.push(D),l.push(L.clone()),l.push(b.clone()),l.push(L.clone()),l.push(D.clone()),l.push(g);break}C&&(b=z[T],L=z[T+1],D=J(z[T+2],b),g=J(z[T+2],L)),b&&L&&D&&g&&(l.push(b.clone()),l.push(L.clone()),l.push(D),l.push(g),l.push(D.clone()),l.push(L.clone()));break;case 2:l=l??new Array,M||(b=z[T].clone(),L=J(b,z[T+1]),D=J(b,z[T+2]),l.push(b),l.push(L),l.push(D)),q||(b=z[T+1].clone(),L=J(b,z[T+2]),D=J(b,z[T]),l.push(b),l.push(L),l.push(D)),C||(b=z[T+2].clone(),L=J(b,z[T]),D=J(b,z[T+1]),l.push(b),l.push(L),l.push(D))}}return l},m=u instanceof E.b?u:null,p=null===m||void 0===m?void 0:m._thinInstanceDataStorage.matrixData,N=(null===m||void 0===m?void 0:m.ET)||1,B=H.i.Matrix[0];B.J(H.b.IdentityReadOnly);for(let E=0;E<N;++E){if(null!==m&&void 0!==m&&m.hasThinInstances&&p){const z=16*E;B.setRowFromFloats(0,p[z+0],p[z+1],p[z+2],p[z+3]),B.setRowFromFloats(1,p[z+4],p[z+5],p[z+6],p[z+7]),B.setRowFromFloats(2,p[z+8],p[z+9],p[z+10],p[z+11]),B.setRowFromFloats(3,p[z+12],p[z+13],p[z+14],p[z+15])}const z=H.b.RotationYawPitchRoll(G,R,x).multiply(H.b.Translation(Q.x,Q.y,Q.z)),J=H.b.Invert(z),l=u.getWorldMatrix(),b=B.multiply(l).multiply(J),L=new Array(3);for(let u=0;u<h.length;u+=3){let z=L;if(z[0]=U(u,b),z[1]=U(u+1,b),z[2]=U(u+2,b),!(Y.cullBackFaces&&-z[0].wl.z<=0&&-z[1].wl.z<=0&&-z[2].wl.z<=0)&&(z=n(z,I),z&&(z=n(z,y),z&&(z=n(z,a),z&&(z=n(z,j),z&&(z=n(z,k),z&&(z=n(z,P),z)))))))for(let u=0;u<z.length;u++){const H=z[u];if(w.indices.push(c),K?(H.localPositionOverride?(w.Qz[3*c]=H.localPositionOverride[0],w.Qz[3*c+1]=H.localPositionOverride[1],w.Qz[3*c+2]=H.localPositionOverride[2]):t&&(w.Qz[3*c]=t[H.vertexIdx],w.Qz[3*c+1]=t[H.vertexIdx+1],w.Qz[3*c+2]=t[H.vertexIdx+2]),H.localNormalOverride?(w.Vz[3*c]=H.localNormalOverride[0],w.Vz[3*c+1]=H.localNormalOverride[1],w.Vz[3*c+2]=H.localNormalOverride[2]):W&&(w.Vz[3*c]=W[H.vertexIdx],w.Vz[3*c+1]=W[H.vertexIdx+1],w.Vz[3*c+2]=W[H.vertexIdx+2])):(H.position.toArray(w.Qz,3*c),H.wl.toArray(w.Vz,3*c)),w.matricesIndices&&w.matricesWeights&&(H.matrixIndicesOverride?(w.matricesIndices[4*c]=H.matrixIndicesOverride[0],w.matricesIndices[4*c+1]=H.matrixIndicesOverride[1],w.matricesIndices[4*c+2]=H.matrixIndicesOverride[2],w.matricesIndices[4*c+3]=H.matrixIndicesOverride[3]):(s&&(w.matricesIndices[4*c]=s[H.vertexIdxForBones],w.matricesIndices[4*c+1]=s[H.vertexIdxForBones+1],w.matricesIndices[4*c+2]=s[H.vertexIdxForBones+2],w.matricesIndices[4*c+3]=s[H.vertexIdxForBones+3]),i&&w.matricesIndicesExtra&&(w.matricesIndicesExtra[4*c]=i[H.vertexIdxForBones],w.matricesIndicesExtra[4*c+1]=i[H.vertexIdxForBones+1],w.matricesIndicesExtra[4*c+2]=i[H.vertexIdxForBones+2],w.matricesIndicesExtra[4*c+3]=i[H.vertexIdxForBones+3])),H.matrixWeightsOverride?(w.matricesWeights[4*c]=H.matrixWeightsOverride[0],w.matricesWeights[4*c+1]=H.matrixWeightsOverride[1],w.matricesWeights[4*c+2]=H.matrixWeightsOverride[2],w.matricesWeights[4*c+3]=H.matrixWeightsOverride[3]):(v&&(w.matricesWeights[4*c]=v[H.vertexIdxForBones],w.matricesWeights[4*c+1]=v[H.vertexIdxForBones+1],w.matricesWeights[4*c+2]=v[H.vertexIdxForBones+2],w.matricesWeights[4*c+3]=v[H.vertexIdxForBones+3]),X&&w.matricesWeightsExtra&&(w.matricesWeightsExtra[4*c]=X[H.vertexIdxForBones],w.matricesWeightsExtra[4*c+1]=X[H.vertexIdxForBones+1],w.matricesWeightsExtra[4*c+2]=X[H.vertexIdxForBones+2],w.matricesWeightsExtra[4*c+3]=X[H.vertexIdxForBones+3]))),Y.captureUVS)H.uv.toArray(w.xz,2*c);else{w.xz.push(.5+H.position.x/A.x);const z=.5+H.position.y/A.y;w.xz.push(T.b?1-z:z)}c++}}}0===w.indices.length&&(w.indices=null),0===w.Qz.length&&(w.Qz=null),0===w.Vz.length&&(w.Vz=null),0===w.xz.length&&(w.xz=null),0===(null===(L=w.matricesIndices)||void 0===L?void 0:L.length)&&(w.matricesIndices=null),0===(null===(D=w.matricesWeights)||void 0===D?void 0:D.length)&&(w.matricesWeights=null),0===(null===(g=w.matricesIndicesExtra)||void 0===g?void 0:g.length)&&(w.matricesIndicesExtra=null),0===(null===(M=w.matricesWeightsExtra)||void 0===M?void 0:M.length)&&(w.matricesWeightsExtra=null);const f=new E.b(z,u.iz());return w.Fz(f),K?(f.skeleton=u.skeleton,f.parent=u):(f.position=Q.clone(),f.rotation=new H.p(R,G,x)),f.pl(!0),f.refreshBoundingInfo(!0,!0),f}function B(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const u=0|Math.max(z.subdivisions?z.subdivisions:2,1),Y=0|Math.max(z.tessellation?z.tessellation:16,3),E=Math.max(z.height?z.height:1,0),J=Math.max(z.radius?z.radius:.25,0),b=0|Math.max(z.capSubdivisions?z.capSubdivisions:6,1),L=Y,D=u,g=Math.max(z.radiusTop?z.radiusTop:J,0),M=Math.max(z.radiusBottom?z.radiusBottom:J,0),q=E-(g+M),C=2*Math.PI,K=Math.max(z.topCapSubdivisions?z.topCapSubdivisions:b,1),h=Math.max(z.bottomCapSubdivisions?z.bottomCapSubdivisions:b,1),o=Math.acos((M-g)/E);let d=[];const t=[],W=[],Z=[];let s=0;const v=[],i=.5*q,X=.5*Math.PI;let Q,V;const A=H.p.Zero(),x=H.p.Zero(),G=Math.cos(o),F=Math.sin(o),R=new H.m(g*F,i+g*G).JY(new H.m(M*F,M*G-i)).length(),w=g*o+R+M*(X-o);let c=0;for(V=0;V<=K;V++){const z=[],u=X-o*(V/K);c+=g*o/K;const Y=Math.cos(u),H=Math.sin(u),E=Y*g;for(Q=0;Q<=L;Q++){const u=Q/L,J=u*C+0,l=Math.sin(J),b=Math.cos(J);x.x=E*l,x.y=i+H*g,x.z=E*b,t.push(x.x,x.y,x.z),A.set(Y*l,H,Y*b),W.push(A.x,A.y,A.z),Z.push(u,T.b?c/w:1-c/w),z.push(s),s++}v.push(z)}const U=E-g-M+G*g-G*M,O=F*(M-g)/U;for(V=1;V<=D;V++){const z=[];c+=R/D;const u=F*(V*(M-g)/D+g);for(Q=0;Q<=L;Q++){const Y=Q/L,H=Y*C+0,E=Math.sin(H),J=Math.cos(H);x.x=u*E,x.y=i+G*g-V*U/D,x.z=u*J,t.push(x.x,x.y,x.z),A.set(E,O,J).normalize(),W.push(A.x,A.y,A.z),Z.push(Y,T.b?c/w:1-c/w),z.push(s),s++}v.push(z)}for(V=1;V<=h;V++){const z=[],u=X-o-(Math.PI-o)*(V/h);c+=M*o/h;const Y=Math.cos(u),H=Math.sin(u),E=Y*M;for(Q=0;Q<=L;Q++){const u=Q/L,J=u*C+0,l=Math.sin(J),b=Math.cos(J);x.x=E*l,x.y=H*M-i,x.z=E*b,t.push(x.x,x.y,x.z),A.set(Y*l,H,Y*b),W.push(A.x,A.y,A.z),Z.push(u,T.b?c/w:1-c/w),z.push(s),s++}v.push(z)}for(Q=0;Q<L;Q++)for(V=0;V<K+D+h;V++){const z=v[V][Q],u=v[V+1][Q],Y=v[V+1][Q+1],H=v[V][Q+1];d.push(z),d.push(u),d.push(H),d.push(u),d.push(Y),d.push(H)}if(d=d.reverse(),z.orientation&&!z.orientation.equals(H.p.Up())){const u=new H.b;z.orientation.clone().scale(.5*Math.PI).cross(H.p.Up()).toQuaternion().toRotationMatrix(u);const Y=H.p.Zero();for(let z=0;z<t.length;z+=3)Y.set(t[z],t[z+1],t[z+2]),H.p.TransformCoordinatesToRef(Y.clone(),u,Y),t[z]=Y.x,t[z+1]=Y.y,t[z+2]=Y.z}const n=new l.e;return n.Qz=t,n.Vz=W,n.xz=Z,n.indices=d,n}function f(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:H.p.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new E.b(z,Y);return B(u).Fz(J,u.updatable),J}E.b.CreateDecal=(z,u,Y,H,E,J)=>N(z,u,{position:Y,wl:H,size:E,angle:J});E.b.CreateCapsule=(z,u,Y)=>f(z,u,Y),l.e.CreateCapsule=B;var r=Y(10953),zz=Y(10906);class uz{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=z,this.y=u,z!==Math.floor(z)&&(z=Math.floor(z),r.b.Warn("x is not an integer, floor(x) used")),u!==Math.floor(u)&&(u=Math.floor(u),r.b.Warn("y is not an integer, floor(y) used"))}clone(){return new uz(this.x,this.y)}rotate60About(z){const u=this.x;return this.x=z.x+z.y-this.y,this.y=u+this.y-z.x,this}rotateNeg60About(z){const u=this.x;return this.x=u+this.y-z.y,this.y=z.x+z.y-u,this}rotate120(z,u){z!==Math.floor(z)&&(z=Math.floor(z),r.b.Warn("m not an integer only floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),r.b.Warn("n not an integer only floor(n) used"));const Y=this.x;return this.x=z-Y-this.y,this.y=u+Y,this}rotateNeg120(z,u){z!==Math.floor(z)&&(z=Math.floor(z),r.b.Warn("m is not an integer, floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),r.b.Warn("n is not an integer,   floor(n) used"));const Y=this.x;return this.x=this.y-u,this.y=z+u-Y-this.y,this}toCartesianOrigin(z,u){const Y=H.p.Zero();return Y.x=z.x+2*this.x*u+this.y*u,Y.y=z.y+Math.sqrt(3)*this.y*u,Y}static Zero(){return new uz(0,0)}}class Yz{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Hz("icosahedron","Regular",[[0,zz.f,-1],[-zz.f,1,0],[-1,0,-zz.f],[1,0,-zz.f],[zz.f,1,0],[0,zz.f,1],[-1,0,zz.f],[-zz.f,-1,0],[0,-zz.f,-1],[zz.f,-1,0],[1,0,zz.f],[0,-zz.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let z=12;const u={},Y=this.m,H=this.n;let E,J,l,T,b,L=Y,D=1,g=0;0!==H&&(L=(0,S.HighestCommonFactor)(Y,H)),D=Y/L,g=H/L;const M=uz.Zero(),q=new uz(Y,H),C=new uz(-H,Y+H),K=uz.Zero(),h=uz.Zero(),o=uz.Zero();let d,t,W,Z,s=[];const v=[],i=this.vertByDist,X=(Y,H,E,J)=>{d=Y+"|"+E,t=H+"|"+J,d in u||t in u?d in u&&!(t in u)?u[t]=u[d]:t in u&&!(d in u)&&(u[d]=u[t]):(u[d]=z,u[t]=z,z++),i[E][0]>2?v[u[d]]=[-i[E][0],i[E][1],u[d]]:v[u[d]]=[s[i[E][0]],i[E][1],u[d]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Q=0;Q<20;Q++){if(s=this.IDATA.face[Q],l=s[2],T=s[1],b=s[0],W=M.x+"|"+M.y,d=Q+"|"+W,d in u||(u[d]=l,v[l]=[s[i[W][0]],i[W][1]]),W=q.x+"|"+q.y,d=Q+"|"+W,d in u||(u[d]=T,v[T]=[s[i[W][0]],i[W][1]]),W=C.x+"|"+C.y,d=Q+"|"+W,d in u||(u[d]=b,v[b]=[s[i[W][0]],i[W][1]]),E=this.IDATA.edgematch[Q][0],J=this.IDATA.edgematch[Q][1],"B"===J)for(let z=1;z<L;z++)h.x=Y-z*(D+g),h.y=H+z*D,o.x=-z*g,o.y=z*(D+g),W=h.x+"|"+h.y,Z=o.x+"|"+o.y,X(Q,E,W,Z);if("O"===J)for(let z=1;z<L;z++)o.x=-z*g,o.y=z*(D+g),K.x=z*D,K.y=z*g,W=o.x+"|"+o.y,Z=K.x+"|"+K.y,X(Q,E,W,Z);if(E=this.IDATA.edgematch[Q][2],J=this.IDATA.edgematch[Q][3],J&&"A"===J)for(let z=1;z<L;z++)K.x=z*D,K.y=z*g,h.x=Y-(L-z)*(D+g),h.y=H+(L-z)*D,W=K.x+"|"+K.y,Z=h.x+"|"+h.y,X(Q,E,W,Z);for(let Y=0;Y<this.vertices.length;Y++)W=this.vertices[Y].x+"|"+this.vertices[Y].y,d=Q+"|"+W,d in u||(u[d]=z++,i[W][0]>2?v[u[d]]=[-i[W][0],i[W][1],u[d]]:v[u[d]]=[s[i[W][0]],i[W][1],u[d]])}this.closestTo=v,this.vecToidx=u}calcCoeffs(){const z=this.m,u=this.n,Y=Math.sqrt(3)/3,H=z*z+u*u+z*u;this.coau=(z+u)/H,this.cobu=-u/H,this.coav=-Y*(z-u)/H,this.cobv=Y*(2*z+u)/H}createInnerFacets(){const z=this.m,u=this.n;for(let Y=0;Y<u+z+1;Y++)for(let z=this.min[Y];z<this.max[Y]+1;z++)z<this.max[Y]&&z<this.max[Y+1]+1&&this.innerFacets.push(["|"+z+"|"+Y,"|"+z+"|"+(Y+1),"|"+(z+1)+"|"+Y]),Y>0&&z<this.max[Y-1]&&z+1<this.max[Y]+1&&this.innerFacets.push(["|"+z+"|"+Y,"|"+(z+1)+"|"+Y,"|"+(z+1)+"|"+(Y-1)])}edgeVecsABOB(){const z=this.m,u=this.n,Y=new uz(-u,z+u);for(let H=1;H<z+u;H++){const z=new uz(this.min[H],H),u=new uz(this.min[H-1],H-1),E=new uz(this.min[H+1],H+1),J=z.clone(),l=u.clone(),T=E.clone();J.rotate60About(Y),l.rotate60About(Y),T.rotate60About(Y);const b=new uz(this.max[J.y],J.y),L=new uz(this.max[J.y-1],J.y-1),D=new uz(this.max[J.y-1]-1,J.y-1);J.x===b.x&&J.y===b.y||(J.x!==L.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,L,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,D,b])):J.y===T.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,u,L]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([z,L,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,u,L]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,L,b])))}}mapABOBtoOBOA(){const z=new uz(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const Y=[];for(let H=0;H<3;H++)z.x=this.isoVecsABOB[u][H].x,z.y=this.isoVecsABOB[u][H].y,0===this.vertexTypes[u][H]&&z.rotateNeg120(this.m,this.n),Y.push(z.clone());this.isoVecsOBOA.push(Y)}}mapABOBtoBAOA(){const z=new uz(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const Y=[];for(let H=0;H<3;H++)z.x=this.isoVecsABOB[u][H].x,z.y=this.isoVecsABOB[u][H].y,1===this.vertexTypes[u][H]&&z.rotate120(this.m,this.n),Y.push(z.clone());this.isoVecsBAOA.push(Y)}}MapToFace(z,u){const Y=this.IDATA.face[z],E=Y[2],J=Y[1],l=Y[0],T=H.p.Nl(this.IDATA.vertex[E]),b=H.p.Nl(this.IDATA.vertex[J]),L=H.p.Nl(this.IDATA.vertex[l]),D=b.JY(T),g=L.JY(T),M=D.scale(this.coau).add(g.scale(this.cobu)),q=D.scale(this.coav).add(g.scale(this.cobv)),C=[];let K,h=H.i.Pl[0];for(let H=0;H<this.cartesian.length;H++)h=M.scale(this.cartesian[H].x).add(q.scale(this.cartesian[H].y)).add(T),C[H]=[h.x,h.y,h.z],K=z+"|"+this.vertices[H].x+"|"+this.vertices[H].y,u.vertex[this.vecToidx[K]]=[h.x,h.y,h.z]}build(z,u){const Y=[],H=uz.Zero(),E=new uz(z,u),J=new uz(-u,z+u);Y.push(H,E,J);for(let W=u;W<z+1;W++)for(let u=0;u<z+1-W;u++)Y.push(new uz(u,W));if(u>0){const H=(0,S.HighestCommonFactor)(z,u),E=z/H,J=u/H;for(let T=1;T<H;T++)Y.push(new uz(T*E,T*J)),Y.push(new uz(-T*J,T*(E+J))),Y.push(new uz(z-T*(E+J),u+T*E));const l=z/u;for(let T=1;T<u;T++)for(let H=0;H<T*l;H++)Y.push(new uz(H,T)),Y.push(new uz(H,T).rotate120(z,u)),Y.push(new uz(H,T).rotateNeg120(z,u))}Y.sort(((z,u)=>z.x-u.x)),Y.sort(((z,u)=>z.y-u.y));const l=new Array(z+u+1),T=new Array(z+u+1);for(let W=0;W<l.length;W++)l[W]=1/0,T[W]=-1/0;let b=0,L=0;const D=Y.length;for(let W=0;W<D;W++)L=Y[W].x,b=Y[W].y,l[b]=Math.min(L,l[b]),T[b]=Math.max(L,T[b]);const g=(Y,H)=>{const E=Y.clone();return"A"===H&&E.rotateNeg120(z,u),"B"===H&&E.rotate120(z,u),E.x<0?E.y:E.x+E.y},M=[],q=[],C=[],K=[],h={},o=[];let d=-1,t=-1;for(let W=0;W<D;W++)M[W]=Y[W].toCartesianOrigin(new uz(0,0),.5),q[W]=g(Y[W],"O"),C[W]=g(Y[W],"A"),K[W]=g(Y[W],"B"),q[W]===C[W]&&C[W]===K[W]?(d=3,t=q[W]):q[W]===C[W]?(d=4,t=q[W]):C[W]===K[W]?(d=5,t=C[W]):K[W]===q[W]&&(d=6,t=q[W]),q[W]<C[W]&&q[W]<K[W]&&(d=2,t=q[W]),C[W]<q[W]&&C[W]<K[W]&&(d=1,t=C[W]),K[W]<C[W]&&K[W]<q[W]&&(d=0,t=K[W]),o.push([d,t,Y[W].x,Y[W].y]);o.sort(((z,u)=>z[2]-u[2])),o.sort(((z,u)=>z[3]-u[3])),o.sort(((z,u)=>z[1]-u[1])),o.sort(((z,u)=>z[0]-u[0]));for(let W=0;W<o.length;W++)h[o[W][2]+"|"+o[W][3]]=[o[W][0],o[W][1],W];return this.m=z,this.n=u,this.vertices=Y,this.vertByDist=h,this.cartesian=M,this.min=l,this.max=T,this}}class Hz{constructor(z,u,Y,H){this.name=z,this.category=u,this.vertex=Y,this.face=H}}class Ez extends Hz{innerToData(z,u){for(let Y=0;Y<u.innerFacets.length;Y++)this.face.push(u.innerFacets[Y].map((Y=>u.vecToidx[z+Y])))}mapABOBtoDATA(z,u){const Y=u.IDATA.edgematch[z][0];for(let H=0;H<u.isoVecsABOB.length;H++){const E=[];for(let J=0;J<3;J++)0===u.vertexTypes[H][J]?E.push(z+"|"+u.isoVecsABOB[H][J].x+"|"+u.isoVecsABOB[H][J].y):E.push(Y+"|"+u.isoVecsABOB[H][J].x+"|"+u.isoVecsABOB[H][J].y);this.face.push([u.vecToidx[E[0]],u.vecToidx[E[1]],u.vecToidx[E[2]]])}}mapOBOAtoDATA(z,u){const Y=u.IDATA.edgematch[z][0];for(let H=0;H<u.isoVecsOBOA.length;H++){const E=[];for(let J=0;J<3;J++)1===u.vertexTypes[H][J]?E.push(z+"|"+u.isoVecsOBOA[H][J].x+"|"+u.isoVecsOBOA[H][J].y):E.push(Y+"|"+u.isoVecsOBOA[H][J].x+"|"+u.isoVecsOBOA[H][J].y);this.face.push([u.vecToidx[E[0]],u.vecToidx[E[1]],u.vecToidx[E[2]]])}}mapBAOAtoDATA(z,u){const Y=u.IDATA.edgematch[z][2];for(let H=0;H<u.isoVecsBAOA.length;H++){const E=[];for(let J=0;J<3;J++)1===u.vertexTypes[H][J]?E.push(z+"|"+u.isoVecsBAOA[H][J].x+"|"+u.isoVecsBAOA[H][J].y):E.push(Y+"|"+u.isoVecsBAOA[H][J].x+"|"+u.isoVecsBAOA[H][J].y);this.face.push([u.vecToidx[E[0]],u.vecToidx[E[1]],u.vecToidx[E[2]]])}}orderData(z){const u=[];for(let J=0;J<13;J++)u[J]=[];const Y=z.closestTo;for(let J=0;J<Y.length;J++)Y[J][0]>-1?Y[J][1]>0&&u[Y[J][0]].push([J,Y[J][1]]):u[12].push([J,Y[J][0]]);const H=[];for(let J=0;J<12;J++)H[J]=J;let E=12;for(let J=0;J<12;J++){u[J].sort(((z,u)=>z[1]-u[1]));for(let z=0;z<u[J].length;z++)H[u[J][z][0]]=E++}for(let J=0;J<u[12].length;J++)H[u[12][J][0]]=E++;for(let J=0;J<this.vertex.length;J++)this.vertex[J].push(H[J]);this.vertex.sort(((z,u)=>z[3]-u[3]));for(let J=0;J<this.vertex.length;J++)this.vertex[J].pop();for(let J=0;J<this.face.length;J++)for(let z=0;z<this.face[J].length;z++)this.face[J][z]=H[this.face[J][z]];this.sharedNodes=u[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(z,u){const Y=[],H=[];let E=u.pop();H.push(E);let J=this.face[E].indexOf(z);J=(J+2)%3;let l=this.face[E][J];Y.push(l);let T=0;for(;u.length>0;)E=u[T],this.face[E].indexOf(l)>-1?(J=(this.face[E].indexOf(l)+1)%3,l=this.face[E][J],Y.push(l),H.push(E),u.splice(T,1),T=0):T++;return this.adjacentFaces.push(Y),H}toGoldbergPolyhedronData(){const z=new Hz("GeoDual","Goldberg",[],[]);z.name="GD dual";const u=this.vertex.length,Y=new Array(u);for(let b=0;b<u;b++)Y[b]=[];for(let b=0;b<this.face.length;b++)for(let z=0;z<3;z++)Y[this.face[b][z]].push(b);let H=0,E=0,J=0,l=[],T=[];this.adjacentFaces=[];for(let b=0;b<Y.length;b++){z.face[b]=this.setOrder(b,Y[b].concat([]));for(const u of Y[b]){H=0,E=0,J=0,l=this.face[u];for(let z=0;z<3;z++)T=this.vertex[l[z]],H+=T[0],E+=T[1],J+=T[2];z.vertex[u]=[H/3,E/3,J/3]}}return z}static BuildGeodesicData(z){const u=new Ez("Geodesic-m-n","Geodesic",[[0,zz.f,-1],[-zz.f,1,0],[-1,0,-zz.f],[1,0,-zz.f],[zz.f,1,0],[0,zz.f,1],[-1,0,zz.f],[-zz.f,-1,0],[0,-zz.f,-1],[zz.f,-1,0],[1,0,zz.f],[0,-zz.f,1]],[]);z.setIndices(),z.calcCoeffs(),z.createInnerFacets(),z.edgeVecsABOB(),z.mapABOBtoOBOA(),z.mapABOBtoBAOA();for(let Y=0;Y<z.IDATA.face.length;Y++)z.MapToFace(Y,u),u.innerToData(Y,z),"B"===z.IDATA.edgematch[Y][1]&&u.mapABOBtoDATA(Y,z),"O"===z.IDATA.edgematch[Y][1]&&u.mapOBOAtoDATA(Y,z),"A"===z.IDATA.edgematch[Y][3]&&u.mapBAOAtoDATA(Y,z);u.orderData(z);return u.vertex=u.vertex.map((function(z){const u=z[0],Y=z[1],H=z[2],E=Math.sqrt(u*u+Y*Y+H*H);return z[0]*=1/E,z[1]*=1/E,z[2]*=1/E,z})),u}}E.b._GoldbergMeshParser=(z,u)=>Jz.Parse(z,u);class Jz extends E.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(z,u){return void 0===u?(z>this.goldbergData.nbUnsharedFaces-1&&(r.b.Warn("Maximum number of unshared faces used"),z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+z):(z>11&&(r.b.Warn("Last pole used"),z=11),u>this.goldbergData.nbFacesAtPole-1&&(r.b.Warn("Maximum number of faces at a pole used"),u=this.goldbergData.nbFacesAtPole-1),12+z*this.goldbergData.nbFacesAtPole+u)}_changeGoldbergFaceColors(z){for(let Y=0;Y<z.length;Y++){const u=z[Y][0],H=z[Y][1],E=z[Y][2];for(let z=u;z<H+1;z++)this.goldbergData.faceColors[z]=E}const u=[];for(let Y=0;Y<12;Y++)for(let z=0;z<5;z++)u.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);for(let Y=12;Y<this.goldbergData.faceColors.length;Y++)for(let z=0;z<6;z++)u.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);return u}setGoldbergFaceColors(z){const u=this._changeGoldbergFaceColors(z);this.Uz(J.f.ColorKind,u)}updateGoldbergFaceColors(z){const u=this._changeGoldbergFaceColors(z);this.updateVerticesData(J.f.ColorKind,u)}_changeGoldbergFaceUVs(z){const u=this.getVerticesData(J.f.UVKind);for(let Y=0;Y<z.length;Y++){const H=z[Y][0],E=z[Y][1],J=z[Y][2],l=z[Y][3],T=z[Y][4],b=[],L=[];let D,g;for(let z=0;z<5;z++)D=J.x+l*Math.cos(T+z*Math.PI/2.5),g=J.y+l*Math.sin(T+z*Math.PI/2.5),D<0&&(D=0),D>1&&(D=1),b.push(D,g);for(let z=0;z<6;z++)D=J.x+l*Math.cos(T+z*Math.PI/3),g=J.y+l*Math.sin(T+z*Math.PI/3),D<0&&(D=0),D>1&&(D=1),L.push(D,g);for(let z=H;z<Math.min(12,E+1);z++)for(let Y=0;Y<5;Y++)u[10*z+2*Y]=b[2*Y],u[10*z+2*Y+1]=b[2*Y+1];for(let z=Math.max(12,H);z<E+1;z++)for(let Y=0;Y<6;Y++)u[12*z-24+2*Y]=L[2*Y],u[12*z-23+2*Y]=L[2*Y+1]}return u}setGoldbergFaceUVs(z){const u=this._changeGoldbergFaceUVs(z);this.Uz(J.f.UVKind,u)}updateGoldbergFaceUVs(z){const u=this._changeGoldbergFaceUVs(z);this.updateVerticesData(J.f.UVKind,u)}placeOnGoldbergFaceAt(z,u,Y){const E=H.p.RotationFromAxis(this.goldbergData.faceXaxis[u],this.goldbergData.faceYaxis[u],this.goldbergData.faceZaxis[u]);z.rotation=E,z.position=this.goldbergData.faceCenters[u].add(this.goldbergData.faceXaxis[u].scale(Y.x)).add(this.goldbergData.faceYaxis[u].scale(Y.y)).add(this.goldbergData.faceZaxis[u].scale(Y.z))}serialize(z){super.serialize(z),z.type="GoldbergMesh";const u={};if(u.adjacentFaces=this.goldbergData.adjacentFaces,u.nbSharedFaces=this.goldbergData.nbSharedFaces,u.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,u.nbFaces=this.goldbergData.nbFaces,u.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){u.faceColors=[];for(const z of this.goldbergData.faceColors)u.faceColors.push(z.al())}if(this.goldbergData.faceCenters){u.faceCenters=[];for(const z of this.goldbergData.faceCenters)u.faceCenters.push(z.al())}if(this.goldbergData.faceZaxis){u.faceZaxis=[];for(const z of this.goldbergData.faceZaxis)u.faceZaxis.push(z.al())}if(this.goldbergData.faceYaxis){u.faceYaxis=[];for(const z of this.goldbergData.faceYaxis)u.faceYaxis.push(z.al())}if(this.goldbergData.faceXaxis){u.faceXaxis=[];for(const z of this.goldbergData.faceXaxis)u.faceXaxis.push(z.al())}z.goldbergData=u}static Parse(z,u){const Y=z.goldbergData;Y.faceColors=Y.faceColors.map((z=>M.e.Nl(z))),Y.faceCenters=Y.faceCenters.map((z=>H.p.Nl(z))),Y.faceZaxis=Y.faceZaxis.map((z=>H.p.Nl(z))),Y.faceXaxis=Y.faceXaxis.map((z=>H.p.Nl(z))),Y.faceYaxis=Y.faceYaxis.map((z=>H.p.Nl(z)));const E=new Jz(z.name,u);return E.goldbergData=Y,E}}var lz=Y(11650);const Tz={CreateBox:g.e,CreateTiledBox:h,CreateSphere:o.d,CreateDisc:D.c,CreateIcoSphere:p,CreateRibbon:L,CreateCylinder:Z,CreateTorus:v,CreateTorusKnot:X,CreateLineSystem:Q.f,RL:Q.j,CreateDashedLines:Q.d,ExtrudeShape:x,ExtrudeShapeCustom:G,CreateLathe:R,CreateTiledPlane:C,cL:w.e,CreateGround:c.d,CreateTiledGround:c.g,CreateGroundFromHeightMap:c.c,CreatePolygon:V.d,ExtrudePolygon:V.g,CreateTube:U,CreatePolyhedron:n,CreateGeodesic:function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=u.m||1;H!==Math.floor(H)&&(H=Math.floor(H),r.b.Warn("m not an integer only floor(m) used"));let E=u.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),r.b.Warn("n not an integer only floor(n) used")),E>H){const z=E;E=H,H=z,r.b.Warn("n > m therefore m and n swapped")}const J=new Yz;return J.build(H,E),n(z,{custom:Ez.BuildGeodesicData(J),size:u.size,sizeX:u.sizeX,sizeY:u.sizeY,sizeZ:u.sizeZ,faceUV:u.faceUV,faceColors:u.faceColors,flat:u.flat,updatable:u.updatable,sideOrientation:u.sideOrientation,frontUVs:u.frontUVs,backUVs:u.backUVs},Y)},CreateGoldberg:function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=u.size,b=u.sizeX||J||1,L=u.sizeY||J||1,D=u.sizeZ||J||1;let g=u.m||1;g!==Math.floor(g)&&(g=Math.floor(g),r.b.Warn("m not an integer only floor(m) used"));let q=u.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),r.b.Warn("n not an integer only floor(n) used")),q>g){const z=q;q=g,g=z,r.b.Warn("n > m therefore m and n swapped")}const C=new Yz;C.build(g,q);const K=Ez.BuildGeodesicData(C),h=K.toGoldbergPolyhedronData(),o=new Jz(z,Y);u.sideOrientation=E.b._GetDefaultSideOrientation(u.sideOrientation),o._originalBuilderSideOrientation=u.sideOrientation;(function(z,u){const Y=z.size,E=z.sizeX||Y||1,J=z.sizeY||Y||1,b=z.sizeZ||Y||1,L=0===z.sideOrientation?0:z.sideOrientation||l.e.DEFAULTSIDE,D=[],g=[],M=[],q=[];let C=1/0,K=-1/0,h=1/0,o=-1/0;for(let H=0;H<u.vertex.length;H++)C=Math.min(C,u.vertex[H][0]*E),K=Math.max(K,u.vertex[H][0]*E),h=Math.min(h,u.vertex[H][1]*J),o=Math.max(o,u.vertex[H][1]*J);let d=0;for(let l=0;l<u.face.length;l++){const z=u.face[l],Y=H.p.Nl(u.vertex[z[0]]),L=H.p.Nl(u.vertex[z[2]]),t=H.p.Nl(u.vertex[z[1]]),W=L.JY(Y),Z=t.JY(Y),s=H.p.Cross(Z,W).normalize();for(let H=0;H<z.length;H++){M.push(s.x,s.y,s.z);const Y=u.vertex[z[H]];D.push(Y[0]*E,Y[1]*J,Y[2]*b);const l=(Y[1]*J-h)/(o-h);q.push((Y[0]*E-C)/(K-C),T.b?1-l:l)}for(let u=0;u<z.length-2;u++)g.push(d,d+u+2,d+u+1);d+=z.length}l.e._ComputeSides(L,D,g,M,q);const t=new l.e;return t.Qz=D,t.indices=g,t.Vz=M,t.xz=q,t})(u,h).Fz(o,u.updatable),o.goldbergData.nbSharedFaces=K.sharedNodes,o.goldbergData.nbUnsharedFaces=K.poleNodes,o.goldbergData.adjacentFaces=K.adjacentFaces,o.goldbergData.nbFaces=o.goldbergData.nbSharedFaces+o.goldbergData.nbUnsharedFaces,o.goldbergData.nbFacesAtPole=(o.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<K.vertex.length;E++)o.goldbergData.faceCenters.push(H.p.Nl(K.vertex[E])),o.goldbergData.faceCenters[E].x*=b,o.goldbergData.faceCenters[E].y*=L,o.goldbergData.faceCenters[E].z*=D,o.goldbergData.faceColors.push(new M.e(1,1,1,1));for(let E=0;E<h.face.length;E++){const z=h.face[E],u=H.p.Nl(h.vertex[z[0]]),Y=H.p.Nl(h.vertex[z[2]]),J=H.p.Nl(h.vertex[z[1]]),l=Y.JY(u),T=J.JY(u),b=H.p.Cross(T,l).normalize(),L=H.p.Cross(T,b).normalize();o.goldbergData.faceXaxis.push(T.normalize()),o.goldbergData.faceYaxis.push(b),o.goldbergData.faceZaxis.push(L)}return o},CreateDecal:N,CreateCapsule:f,CreateText:lz.h}},12131:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>Tu});var H=Y(10903),E=Y(11559);class J extends E.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var l=Y(11188),T=(Y(11363),Y(10918));class b{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(z){this._targetStopDuration!==z&&(this._targetStopDuration=z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(z){this._noiseTexture!==z&&(this._noiseTexture=z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(z){this._animationSheetEnabled!==z&&(this._animationSheetEnabled=z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(z){this._isAnimationSheetEnabled!=z&&(this._isAnimationSheetEnabled=z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){this._useLogarithmicDepth=z&&this.iz().getEngine().getCaps().fragmentDepthSupported}iz(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(z){switch(z){case b.BLENDMODE_MULTIPLYADD:return;case b.BLENDMODE_ADD:z=1;break;case b.BLENDMODE_ONEONE:z=6;break;case b.BLENDMODE_STANDARD:z=2;break;case b.BLENDMODE_MULTIPLY:z=4;break;case b.BLENDMODE_SUBTRACT:z=3}this._engine.setAlphaMode(z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:H.p.Zero()}set direction1(z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:H.p.Zero()}set direction2(z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:H.p.Zero()}set minEmitBox(z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:H.p.Zero()}set maxEmitBox(z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=z)}get billboardMode(){return this._billboardMode}set billboardMode(z){this._billboardMode!==z&&(this._billboardMode=z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(z){this._isBillboardBased!==z&&(this._isBillboardBased=z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z)}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(!z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=z)}_reset(){}_removeGradientAndTexture(z,u,Y){if(!u)return this;let H=0;for(const E of u){if(E.gradient===z){u.splice(H,1);break}H++}return Y&&Y.dispose(),this}constructor(z){this.animations=[],this.renderingGroupId=0,this.k=H.p.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new H.p(10,10,10),this.onAnimationEnd=null,this.blendMode=b.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new H.m(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.AL=new H.p(0,0,0),this._useLogarithmicDepth=!1,this.gravity=H.p.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new l.e(1,1,1,1),this.color2=new l.e(1,1,1,1),this.colorDead=new l.e(0,0,0,1),this.textureMask=new l.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new J,this.id=z,this.name=z}createPointEmitter(z,u){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new H.p(0,1,0),arguments.length>2&&void 0!==arguments[2]||new H.p(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new H.p(0,1,0),arguments.length>4&&void 0!==arguments[4]||new H.p(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new H.p(0,1,0),arguments.length>3&&void 0!==arguments[3]||new H.p(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(z,u,Y,H){throw new Error("Method not implemented.")}}b.BLENDMODE_ONEONE=0,b.BLENDMODE_STANDARD=1,b.BLENDMODE_ADD=2,b.BLENDMODE_MULTIPLY=3,b.BLENDMODE_MULTIPLYADD=4,b.BLENDMODE_SUBTRACT=-1,(0,T.d)("BABYLON.BaseParticleSystem",b);var L=Y(10937),D=Y(10959);class g{constructor(){this.direction1=new H.p(0,1,0),this.direction2=new H.p(0,1,0),this.minEmitBox=new H.p(-.5,-.5,-.5),this.maxEmitBox=new H.p(.5,.5,.5)}startDirectionFunction(z,u,Y,E){const J=(0,L.RandomRange)(this.direction1.x,this.direction2.x),l=(0,L.RandomRange)(this.direction1.y,this.direction2.y),T=(0,L.RandomRange)(this.direction1.z,this.direction2.z);if(E)return u.x=J,u.y=l,void(u.z=T);H.p.TransformNormalFromFloatsToRef(J,l,T,z,u)}startPositionFunction(z,u,Y,E){const J=(0,L.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),l=(0,L.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),T=(0,L.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return u.x=J,u.y=l,void(u.z=T);H.p.TransformCoordinatesFromFloatsToRef(J,l,T,z,u)}clone(){const z=new g;return D.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2),z.setVector3("minEmitBox",this.minEmitBox),z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3),z.addUniform("minEmitBox",3),z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.al(),z.direction2=this.direction2.al(),z.minEmitBox=this.minEmitBox.al(),z.maxEmitBox=this.maxEmitBox.al(),z}parse(z){H.p.FromArrayToRef(z.direction1,0,this.direction1),H.p.FromArrayToRef(z.direction2,0,this.direction2),H.p.FromArrayToRef(z.minEmitBox,0,this.minEmitBox),H.p.FromArrayToRef(z.maxEmitBox,0,this.maxEmitBox)}}class M{get radius(){return this._radius}set radius(z){this._radius=z,this._buildHeight()}get angle(){return this._angle}set angle(z){this._angle=z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=u,this.radius=z}startDirectionFunction(z,u,Y,E){E?H.i.Pl[0].J(Y.xT).normalize():Y.position.subtractToRef(z.getTranslation(),H.i.Pl[0]).normalize();const J=(0,L.RandomRange)(0,this.directionRandomizer),l=(0,L.RandomRange)(0,this.directionRandomizer),T=(0,L.RandomRange)(0,this.directionRandomizer);u.x=H.i.Pl[0].x+J,u.y=H.i.Pl[0].y+l,u.z=H.i.Pl[0].z+T,u.normalize()}startPositionFunction(z,u,Y,E){const J=(0,L.RandomRange)(0,2*Math.PI);let l;this.emitFromSpawnPointOnly?l=1e-4:(l=(0,L.RandomRange)(0,this.heightRange),l=1-l*l);let T=this._radius-(0,L.RandomRange)(0,this._radius*this.radiusRange);T*=l;const b=T*Math.sin(J),D=T*Math.cos(J),g=l*this._height;if(E)return u.x=b,u.y=g,void(u.z=D);H.p.TransformCoordinatesFromFloatsToRef(b,g,D,z,u)}clone(){const z=new M(this._radius,this._angle,this.directionRandomizer);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat2("radius",this._radius,this.radiusRange),z.setFloat("coneAngle",this._angle),z.setFloat2("height",this._height,this.heightRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",2),z.addUniform("coneAngle",1),z.addUniform("height",2),z.addUniform("directionRandomizer",1)}getEffectDefines(){let z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(z+="\n#define CONEEMITTERSPAWNPOINT"),z}getClassName(){return"ConeParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this._radius,z.angle=this._angle,z.directionRandomizer=this.directionRandomizer,z.radiusRange=this.radiusRange,z.heightRange=this.heightRange,z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,z}parse(z){this.radius=z.radius,this.angle=z.angle,this.directionRandomizer=z.directionRandomizer,this.radiusRange=void 0!==z.radiusRange?z.radiusRange:1,this.heightRange=void 0!==z.radiusRange?z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==z.emitFromSpawnPointOnly&&z.emitFromSpawnPointOnly}}class q extends M{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0);super(z,u),this.direction1=Y,this.direction2=E}startDirectionFunction(z,u){const Y=(0,L.RandomRange)(this.direction1.x,this.direction2.x),E=(0,L.RandomRange)(this.direction1.y,this.direction2.y),J=(0,L.RandomRange)(this.direction1.z,this.direction2.z);H.p.TransformNormalFromFloatsToRef(Y,E,J,z,u)}clone(){const z=new q(this.radius,this.angle,this.direction1,this.direction2);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.al(),z.direction2=this.direction2.al(),z}parse(z){super.parse(z),this.direction1.J(z.direction1),this.direction2.J(z.direction2)}}class C{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=z,this.height=u,this.radiusRange=Y,this.directionRandomizer=E,this._tempVector=H.p.Zero()}startDirectionFunction(z,u,Y,E,J){Y.position.subtractToRef(z.getTranslation(),this._tempVector),this._tempVector.normalize(),H.p.TransformNormalToRef(this._tempVector,J,this._tempVector);const l=(0,L.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let T=Math.atan2(this._tempVector.x,this._tempVector.z);T+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=l,this._tempVector.x=Math.sin(T),this._tempVector.z=Math.cos(T),this._tempVector.normalize(),E?u.J(this._tempVector):H.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,z,u)}startPositionFunction(z,u,Y,E){const J=(0,L.RandomRange)(-this.height/2,this.height/2),l=(0,L.RandomRange)(0,2*Math.PI),T=(0,L.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),b=Math.sqrt(T)*this.radius,D=b*Math.cos(l),g=b*Math.sin(l);E?u.kl(D,J,g):H.p.TransformCoordinatesFromFloatsToRef(D,J,g,z,u)}clone(){const z=new C(this.radius,this.directionRandomizer);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.height=this.height,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.height=z.height,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class K extends C{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0),J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.p(0,1,0);super(z,u,Y),this.direction1=E,this.direction2=J}startDirectionFunction(z,u,Y,E){const J=(0,L.RandomRange)(this.direction1.x,this.direction2.x),l=(0,L.RandomRange)(this.direction1.y,this.direction2.y),T=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?u.kl(J,l,T):H.p.TransformNormalFromFloatsToRef(J,l,T,z,u)}clone(){const z=new K(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.al(),z.direction2=this.direction2.al(),z}parse(z){super.parse(z),H.p.FromArrayToRef(z.direction1,0,this.direction1),H.p.FromArrayToRef(z.direction2,0,this.direction2)}}class h{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=u,this.directionRandomizer=Y}startDirectionFunction(z,u,Y,E){const J=Y.position.JY(z.getTranslation()).normalize(),l=(0,L.RandomRange)(0,this.directionRandomizer),T=(0,L.RandomRange)(0,this.directionRandomizer),b=(0,L.RandomRange)(0,this.directionRandomizer);J.x+=l,J.y+=T,J.z+=b,J.normalize(),E?u.J(J):H.p.TransformNormalFromFloatsToRef(J.x,J.y,J.z,z,u)}startPositionFunction(z,u,Y,E){const J=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),l=(0,L.RandomRange)(0,1),T=(0,L.RandomRange)(0,2*Math.PI),b=Math.acos(2*l-1),D=J*Math.cos(T)*Math.sin(b),g=J*Math.cos(b),M=J*Math.sin(T)*Math.sin(b);E?u.kl(D,Math.abs(g),M):H.p.TransformCoordinatesFromFloatsToRef(D,Math.abs(g),M,z,u)}clone(){const z=new h(this.radius,this.directionRandomizer);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class o{constructor(){this.direction1=new H.p(0,1,0),this.direction2=new H.p(0,1,0)}startDirectionFunction(z,u,Y,E){const J=(0,L.RandomRange)(this.direction1.x,this.direction2.x),l=(0,L.RandomRange)(this.direction1.y,this.direction2.y),T=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?u.kl(J,l,T):H.p.TransformNormalFromFloatsToRef(J,l,T,z,u)}startPositionFunction(z,u,Y,E){E?u.kl(0,0,0):H.p.TransformCoordinatesFromFloatsToRef(0,0,0,z,u)}clone(){const z=new o;return D.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.al(),z.direction2=this.direction2.al(),z}parse(z){H.p.FromArrayToRef(z.direction1,0,this.direction1),H.p.FromArrayToRef(z.direction2,0,this.direction2)}}class d{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=u,this.directionRandomizer=Y}startDirectionFunction(z,u,Y,E){const J=Y.position.JY(z.getTranslation()).normalize(),l=(0,L.RandomRange)(0,this.directionRandomizer),T=(0,L.RandomRange)(0,this.directionRandomizer),b=(0,L.RandomRange)(0,this.directionRandomizer);J.x+=l,J.y+=T,J.z+=b,J.normalize(),E?u.J(J):H.p.TransformNormalFromFloatsToRef(J.x,J.y,J.z,z,u)}startPositionFunction(z,u,Y,E){const J=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),l=(0,L.RandomRange)(0,1),T=(0,L.RandomRange)(0,2*Math.PI),b=Math.acos(2*l-1),D=J*Math.cos(T)*Math.sin(b),g=J*Math.cos(b),M=J*Math.sin(T)*Math.sin(b);E?u.kl(D,g,M):H.p.TransformCoordinatesFromFloatsToRef(D,g,M,z,u)}clone(){const z=new d(this.radius,this.directionRandomizer);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class t extends d{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.p(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0);super(z),this.direction1=u,this.direction2=Y}startDirectionFunction(z,u){const Y=(0,L.RandomRange)(this.direction1.x,this.direction2.x),E=(0,L.RandomRange)(this.direction1.y,this.direction2.y),J=(0,L.RandomRange)(this.direction1.z,this.direction2.z);H.p.TransformNormalFromFloatsToRef(Y,E,J,z,u)}clone(){const z=new t(this.radius,this.direction1,this.direction2);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.al(),z.direction2=this.direction2.al(),z}parse(z){super.parse(z),this.direction1.J(z.direction1),this.direction2.J(z.direction2)}}class W{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(z,u,Y,E){const J=H.i.Pl[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Y,J);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Y,J);const z=H.i.Pl[1];J.subtractToRef(Y.position,z),z.scaleToRef(1/Y.lifeTime,J)}else J.set(0,0,0);E?u.J(J):H.p.TransformNormalToRef(J,z,u)}startPositionFunction(z,u,Y,E){const J=H.i.Pl[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Y,J):J.set(0,0,0),E?u.J(J):H.p.TransformCoordinatesToRef(J,z,u)}clone(){const z=new W;return D.b.DeepCopy(this,z),z}applyToShader(z){}buildUniformLayout(z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.particlePositionGenerator=this.particlePositionGenerator,z.particleDestinationGenerator=this.particleDestinationGenerator,z}parse(z){z.particlePositionGenerator&&(this.particlePositionGenerator=z.particlePositionGenerator),z.particleDestinationGenerator&&(this.particleDestinationGenerator=z.particleDestinationGenerator)}}var Z=Y(11103);class s{get mesh(){return this._mesh}set mesh(z){this._mesh!==z&&(this._mesh=z,z?(this._indices=z.Il(),this._positions=z.getVerticesData(Z.f.PositionKind),this._normals=z.getVerticesData(Z.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=H.p.Zero(),this._mesh=null,this.direction1=new H.p(0,1,0),this.direction2=new H.p(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=z}startDirectionFunction(z,u,Y,E){if(this.useMeshNormalsForDirection&&this._normals)return void H.p.TransformNormalToRef(this._storedNormal,z,u);const J=(0,L.RandomRange)(this.direction1.x,this.direction2.x),l=(0,L.RandomRange)(this.direction1.y,this.direction2.y),T=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?u.kl(J,l,T):H.p.TransformNormalFromFloatsToRef(J,l,T,z,u)}startPositionFunction(z,u,Y,E){if(!this._indices||!this._positions)return;const J=3*(Math.random()*(this._indices.length/3)|0),l=Math.random(),T=Math.random()*(1-l),b=1-l-T,L=this._indices[J],D=this._indices[J+1],g=this._indices[J+2],M=H.i.Pl[0],q=H.i.Pl[1],C=H.i.Pl[2],K=H.i.Pl[3];H.p.FromArrayToRef(this._positions,3*L,M),H.p.FromArrayToRef(this._positions,3*D,q),H.p.FromArrayToRef(this._positions,3*g,C),K.x=l*M.x+T*q.x+b*C.x,K.y=l*M.y+T*q.y+b*C.y,K.z=l*M.z+T*q.z+b*C.z,E?u.kl(K.x,K.y,K.z):H.p.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,z,u),this.useMeshNormalsForDirection&&this._normals&&(H.p.FromArrayToRef(this._normals,3*L,M),H.p.FromArrayToRef(this._normals,3*D,q),H.p.FromArrayToRef(this._normals,3*g,C),this._storedNormal.x=l*M.x+T*q.x+b*C.x,this._storedNormal.y=l*M.y+T*q.y+b*C.y,this._storedNormal.z=l*M.z+T*q.z+b*C.z)}clone(){const z=new s(this.mesh);return D.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var z;const u={};return u.type=this.getClassName(),u.direction1=this.direction1.al(),u.direction2=this.direction2.al(),u.meshId=null===(z=this.mesh)||void 0===z?void 0:z.id,u.useMeshNormalsForDirection=this.useMeshNormalsForDirection,u}parse(z,u){H.p.FromArrayToRef(z.direction1,0,this.direction1),H.p.FromArrayToRef(z.direction2,0,this.direction2),z.meshId&&u&&(this.mesh=u.getLastMeshById(z.meshId)),this.useMeshNormalsForDirection=z.useMeshNormalsForDirection}}class v{_isUbo(z){return void 0!==z.addUniform}constructor(z){this._isUbo(z)?(this.setMatrix3x3=z.updateMatrix3x3.bind(z),this.setMatrix2x2=z.updateMatrix2x2.bind(z),this.setFloat=z.updateFloat.bind(z),this.setFloat2=z.updateFloat2.bind(z),this.setFloat3=z.updateFloat3.bind(z),this.setFloat4=z.updateFloat4.bind(z),this.setFloatArray=z.updateFloatArray.bind(z),this.setArray=z.updateArray.bind(z),this.setIntArray=z.updateIntArray.bind(z),this.setMatrix=z.rl.bind(z),this.setMatrices=z.updateMatrices.bind(z),this.setVector3=z.updateVector3.bind(z),this.setVector4=z.updateVector4.bind(z),this.setColor3=z.updateColor3.bind(z),this.setColor4=z.updateColor4.bind(z),this.setDirectColor4=z.updateDirectColor4.bind(z),this.setInt=z.updateInt.bind(z),this.setInt2=z.updateInt2.bind(z),this.setInt3=z.updateInt3.bind(z),this.setInt4=z.updateInt4.bind(z)):(this.setMatrix3x3=z.setMatrix3x3.bind(z),this.setMatrix2x2=z.setMatrix2x2.bind(z),this.setFloat=z.setFloat.bind(z),this.setFloat2=z.setFloat2.bind(z),this.setFloat3=z.setFloat3.bind(z),this.setFloat4=z.setFloat4.bind(z),this.setFloatArray=z.setFloatArray.bind(z),this.setArray=z.setArray.bind(z),this.setIntArray=z.setIntArray.bind(z),this.setMatrix=z.setMatrix.bind(z),this.setMatrices=z.setMatrices.bind(z),this.setVector3=z.setVector3.bind(z),this.setVector4=z.setVector4.bind(z),this.setColor3=z.setColor3.bind(z),this.setColor4=z.setColor4.bind(z),this.setDirectColor4=z.setDirectColor4.bind(z),this.setInt=z.setInt.bind(z),this.setInt2=z.setInt2.bind(z),this.setInt3=z.setInt3.bind(z),this.setInt4=z.setInt4.bind(z))}}var i=Y(11029);const X="gpuUpdateParticlesPixelShader",Q="#version 300 es\nvoid main() {discard;}\n";i.b.ShadersStore[X]||(i.b.ShadersStore[X]=Q);const V="gpuUpdateParticlesVertexShader",A="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.b.ShadersStore[V]||(i.b.ShadersStore[V]=A);(0,T.d)("BABYLON.WebGL2ParticleSystem",class{constructor(z,u){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=z,this._engine=u,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var z;return(null===(z=this._updateEffect)||void 0===z?void 0:z.isReady())??!1}createUpdateBuffer(z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof W&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new v(this._updateEffect)}createVertexBuffers(z,u){this._updateVAO.push(this._createUpdateVAO(z)),this._renderVAO.push(this._engine.recordVertexArrayObject(u,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=u}createParticleBuffer(z){return z}bindDrawBuffers(z,u,Y){Y?this._engine.bindBuffers(this._renderVertexBuffers,Y,u):this._engine.bindVertexArrayObject(this._renderVAO[z],null)}preUpdateParticleBuffer(){const z=this._engine;if(this._engine.enableEffect(this._updateEffect),!z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(z,u,Y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[z],null);const H=this._engine;H.bindTransformFeedbackBuffer(u.getBuffer()),H.setRasterizerState(!1),H.beginTransformFeedback(!0),H.drawArraysType(3,0,Y),H.endTransformFeedback(),H.setRasterizerState(!0),H.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let z=0;z<this._updateVAO.length;z++)this._engine.releaseVertexArrayObject(this._updateVAO[z]);this._updateVAO.length=0;for(let z=0;z<this._renderVAO.length;z++)this._engine.releaseVertexArrayObject(this._renderVAO[z]);this._renderVAO.length=0}_createUpdateVAO(z){const u={};u.position=z.createVertexBuffer("position",0,3);let Y=3;u.age=z.createVertexBuffer("age",Y,1),Y+=1,u.size=z.createVertexBuffer("size",Y,3),Y+=3,u.life=z.createVertexBuffer("life",Y,1),Y+=1,u.seed=z.createVertexBuffer("seed",Y,4),Y+=4,u.direction=z.createVertexBuffer("direction",Y,3),Y+=3,this._parent.particleEmitterType instanceof W&&(u.initialPosition=z.createVertexBuffer("initialPosition",Y,3),Y+=3),this._parent._colorGradientsTexture||(u.color=z.createVertexBuffer("color",Y,4),Y+=4),this._parent._isBillboardBased||(u.initialDirection=z.createVertexBuffer("initialDirection",Y,3),Y+=3),this._parent.noiseTexture&&(u.noiseCoordinates1=z.createVertexBuffer("noiseCoordinates1",Y,3),Y+=3,u.noiseCoordinates2=z.createVertexBuffer("noiseCoordinates2",Y,3),Y+=3),this._parent._angularSpeedGradientsTexture?(u.angle=z.createVertexBuffer("angle",Y,1),Y+=1):(u.angle=z.createVertexBuffer("angle",Y,2),Y+=2),this._parent._isAnimationSheetEnabled&&(u.cellIndex=z.createVertexBuffer("cellIndex",Y,1),Y+=1,this._parent.spriteRandomStartCell&&(u.cellStartOffset=z.createVertexBuffer("cellStartOffset",Y,1),Y+=1));const H=this._engine.recordVertexArrayObject(u,null,this._updateEffect);return this._engine.bindArrayBuffer(null),H}});class x{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,H=arguments.length>3?arguments[3]:void 0;this._engine=z,this._label=H,this._engine._storageBuffers.push(this),this._create(u,Y)}_create(z,u){this._bufferSize=z,this._creationFlags=u,this._buffer=this._engine.createStorageBuffer(z,u,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(z,u,Y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,z,u,Y)}async read(z,u,Y,H){return await this._engine.readFromStorageBuffer(this._buffer,z,u,Y,H)}dispose(){const z=this._engine._storageBuffers,u=z.indexOf(this);-1!==u&&(z[u]=z[z.length-1],z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var G=Y(11079),F=Y(11082),R=Y(11172),w=Y(11415),c=Y(11552),U=Y(10953),O=Y(11049),n=Y(11405);class m{constructor(){this._gpuTimeInFrameId=-1,this.counter=new n.d}_addDuration(z,u){z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(u,!1),this._gpuTimeInFrameId=z):this.counter.addCount(u,!1))}}var p=Y(11009);class S{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=z,this._engine=u,this.uniqueId=c.b.UniqueId,u.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new m),this._engine.getCaps().supportComputeShaders?H.bindingsMapping?(this._context=u.createComputeContext(),this._shaderPath=Y,this._options={bindingsMapping:{},defines:[],...H}):U.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):U.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const H=this._bindings[z];this._bindings[z]={type:Y?0:4,object:u,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!H||H.object!==u||H.type!==this._bindings[z].type)}setStorageTexture(z,u){const Y=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==u),this._bindings[z]={type:1,object:u,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setExternalTexture(z,u){const Y=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==u),this._bindings[z]={type:6,object:u,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setVideoTexture(z,u){return!!u.externalTexture&&(this.setExternalTexture(z,u.externalTexture),!0)}setUniformBuffer(z,u){const Y=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==u),this._bindings[z]={type:S._BufferIsDataBuffer(u)?7:2,object:u,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setStorageBuffer(z,u){const Y=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==u),this._bindings[z]={type:S._BufferIsDataBuffer(u)?7:3,object:u,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setTextureSampler(z,u){const Y=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!Y||!u.compareSampler(Y.object)),this._bindings[z]={type:5,object:u,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}isReady(){let z=this._effect;for(const E in this._bindings){const z=this._bindings[E],u=z.type,Y=z.object;switch(u){case 0:case 4:case 1:if(!Y.isReady())return!1;break;case 6:if(!Y.isReady())return!1;break}}const u=[],Y=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)u.push(this._options.defines[E]);const H=u.join("\n");return this._cachedDefines!==H&&(this._cachedDefines=H,z=this._engine.createComputeEffect(Y,{defines:H,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=z),!!z.isReady()}dispatch(z,u,Y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,z,u,Y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Y=S._BufferIsDataBuffer(z)?z:z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Y,u,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const u in this._bindings){const Y=this._bindings[u];if(!this._options.bindingsMapping[u])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+u+"'");switch(Y.type){case 0:{const H=this._samplers[u],E=Y.object;var z;if(!H||!E._texture||!H.compareSampler(E._texture))this._samplers[u]=(new O.c).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(z=E._texture)||void 0===z?void 0:z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const z=Y.object;z.getBuffer()!==Y.buffer&&(Y.buffer=z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,p.f)((()=>this.dispatch(z,u,Y)),E,void 0,H)}))}serialize(){const z=R.d.Serialize(this);z.options=this._options,z.shaderPath=this._shaderPath,z.wM={},z.textures={};for(const u in this._bindings){const Y=this._bindings[u],H=Y.object;switch(Y.type){case 0:case 4:case 1:{const E=H.serialize();E&&(z.textures[u]=E,z.wM[u]={type:Y.type});break}}}return z}static Parse(z,u,Y){const H=R.d.Parse((()=>new S(z.name,u.getEngine(),z.shaderPath,z.options)),z,u,Y);for(const E in z.textures){const J=z.wM[E],l=w.b.Parse(z.textures[E],u,Y);0===J.type?H.setTexture(E,l):4===J.type?H.setTexture(E,l,!1):H.setStorageTexture(E,l)}return H}static _BufferIsDataBuffer(z){return void 0!==z.underlyingResource}}(0,G.e)([(0,F.L)()],S.prototype,"name",void 0),(0,G.e)([(0,F.L)()],S.prototype,"fastMode",void 0),(0,T.d)("BABYLON.ComputeShader",S);var I=Y(11163);const y="gpuUpdateParticlesComputeShader",a="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.b.ShadersStoreWGSL[y]||(i.b.ShadersStoreWGSL[y]=a);(0,T.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(z,u){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=z,this._engine=u}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var z;return(null===(z=this._updateComputeShader)||void 0===z?void 0:z.isReady())??!1}createUpdateBuffer(z){var u;const Y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Y.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Y.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new S("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Y,defines:z.split("\n")}),null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=new I.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new v(this._simParamsComputeShader)}createVertexBuffers(z,u){this._renderVertexBuffers.push(u)}createParticleBuffer(z){const u=new x(this._engine,4*z.length,11,"ComputeShaderParticleSystemBuffer");return u.update(z),this._bufferComputeShader.push(u),u.getBuffer()}bindDrawBuffers(z,u,Y){this._engine.bindBuffers(this._renderVertexBuffers[z],Y,u)}preUpdateParticleBuffer(){}updateParticleBuffer(z,u,Y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^z]),this._updateComputeShader.dispatch(Math.ceil(Y/64))}releaseBuffers(){var z;for(let u=0;u<this._bufferComputeShader.length;++u)this._bufferComputeShader[u].dispose();this._bufferComputeShader.length=0,null===(z=this._simParamsComputeShader)||void 0===z||z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class j{constructor(z,u,Y){this.gradient=z,this.color1=u,this.color2=Y}getColorToRef(z){this.color2?l.e.LerpToRef(this.color1,this.color2,Math.random(),z):z.J(this.color1)}}class k{constructor(z,u){this.gradient=z,this.color=u}}class P{constructor(z,u,Y){this.gradient=z,this.factor1=u,this.factor2=Y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class e{static GetCurrentGradient(z,u,Y){if(u[0].gradient>z)return void Y(u[0],u[0],1);for(let E=0;E<u.length-1;E++){const H=u[E],J=u[E+1];if(z>=H.gradient&&z<=J.gradient){return void Y(H,J,(z-H.gradient)/(J.gradient-H.gradient))}}const H=u.length-1;Y(u[H],u[H],1)}}var N=Y(10932),B=Y(11461),f=Y(10928);class r{constructor(z){this.particleSystem=z,this.position=H.p.Zero(),this.direction=H.p.Zero(),this.color=new l.e(0,0,0,0),this.colorStep=new l.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new H.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new l.e(0,0,0,0),this._currentColor2=new l.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=r._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let z=this.age,u=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===u?(u=1,z=this._randomCellOffset):z+=this._randomCellOffset);const Y=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let H;H=this._initialSpriteCellLoop?(0,L.Clamp)(z*u%this.lifeTime/this.lifeTime):(0,L.Clamp)(z*u/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+H*Y|0}_inheritParticleInfoToSubEmitter(z){if(z.particleSystem.k.position){const u=z.particleSystem.k;if(u.position.J(this.position),z.inheritDirection){const z=H.i.Pl[0];this.direction.normalizeToRef(z),u.setDirection(z,0,Math.PI/2)}}else{z.particleSystem.k.J(this.position)}this.direction.scaleToRef(z.inheritedVelocityAmount/2,H.i.Pl[0]),z.particleSystem._inheritedVelocityOffset.J(H.i.Pl[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(z)}_reset(){this.age=0,this.id=r._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(z){z.position.J(this.position),this._initialDirection?z._initialDirection?z._initialDirection.J(this._initialDirection):z._initialDirection=this._initialDirection.clone():z._initialDirection=null,z.direction.J(this.direction),this.xT&&(z.xT?z.xT.J(this.xT):z.xT=this.xT.clone()),z.color.J(this.color),z.colorStep.J(this.colorStep),z.lifeTime=this.lifeTime,z.age=this.age,z._randomCellOffset=this._randomCellOffset,z.size=this.size,z.scale.J(this.scale),z.angle=this.angle,z.angularSpeed=this.angularSpeed,z.particleSystem=this.particleSystem,z.cellIndex=this.cellIndex,z.id=this.id,z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(z._currentColorGradient=this._currentColorGradient,z._currentColor1.J(this._currentColor1),z._currentColor2.J(this._currentColor2)),this._currentSizeGradient&&(z._currentSizeGradient=this._currentSizeGradient,z._currentSize1=this._currentSize1,z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,z._currentAngularSpeed1=this._currentAngularSpeed1,z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(z._currentVelocityGradient=this._currentVelocityGradient,z._currentVelocity1=this._currentVelocity1,z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,z._currentLimitVelocity1=this._currentLimitVelocity1,z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(z._currentDragGradient=this._currentDragGradient,z._currentDrag1=this._currentDrag1,z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(z._initialStartSpriteCellId=this._initialStartSpriteCellId,z._initialEndSpriteCellId=this._initialEndSpriteCellId,z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(z.remapData&&this.remapData?z.remapData.J(this.remapData):z.remapData=new H.t(0,0,0,0)),this._randomNoiseCoordinates1&&(z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.J(this._randomNoiseCoordinates1),z._randomNoiseCoordinates2.J(this._randomNoiseCoordinates2)):(z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}r._Count=0;var zz=Y(11156),uz=(Y(11355),Y(11212)),Yz=Y(11195),Hz=Y(11522);function Ez(z,u){const Y=(0,L.RandomRange)(0,1);l.e.LerpToRef(u.color1,u.color2,Y,z.color),u.colorDead.subtractToRef(z.color,u._colorDiff),u._colorDiff.scaleToRef(1/z.lifeTime,z.colorStep)}function Jz(z,u){z._currentColorGradient=u._colorGradients[0],z._currentColorGradient.getColorToRef(z.color),z._currentColor1.J(z.color),u._colorGradients.length>1?u._colorGradients[1].getColorToRef(z._currentColor2):z._currentColor2.J(z.color)}function lz(z,u){const Y=u._colorGradients;e.GetCurrentGradient(u._ratio,Y,((u,Y,H)=>{u!==z._currentColorGradient&&(z._currentColor1.J(z._currentColor2),Y.getColorToRef(z._currentColor2),z._currentColorGradient=u),l.e.LerpToRef(z._currentColor1,z._currentColor2,H,z.color)}))}function Tz(z,u){z.colorStep.scaleToRef(u._scaledUpdateSpeed,u._scaledColorStep),z.color.addInPlace(u._scaledColorStep),z.color.a<0&&(z.color.a=0)}function bz(z,u){e.GetCurrentGradient(u._ratio,u._angularSpeedGradients,((u,Y,H)=>{u!==z._currentAngularSpeedGradient&&(z._currentAngularSpeed1=z._currentAngularSpeed2,z._currentAngularSpeed2=Y.getFactor(),z._currentAngularSpeedGradient=u),z.angularSpeed=(0,L.Lerp)(z._currentAngularSpeed1,z._currentAngularSpeed2,H)}))}function Lz(z,u){z.angle+=z.angularSpeed*u._scaledUpdateSpeed}function Dz(z,u){u.particleEmitterType.startDirectionFunction(u._emitterWorldMatrix,z.direction,z,u.isLocal,u._emitterInverseWorldMatrix)}function gz(z,u){u.startDirectionFunction(u._emitterWorldMatrix,z.direction,z,u.isLocal)}function Mz(z,u){z._currentVelocityGradient=u._velocityGradients[0],z._currentVelocity1=z._currentVelocityGradient.getFactor(),u._velocityGradients.length>1?z._currentVelocity2=u._velocityGradients[1].getFactor():z._currentVelocity2=z._currentVelocity1}function qz(z,u){z._currentLimitVelocityGradient=u._limitVelocityGradients[0],z._currentLimitVelocity1=z._currentLimitVelocityGradient.getFactor(),u._limitVelocityGradients.length>1?z._currentLimitVelocity2=u._limitVelocityGradients[1].getFactor():z._currentLimitVelocity2=z._currentLimitVelocity1}function Cz(z,u){e.GetCurrentGradient(u._ratio,u._velocityGradients,((Y,H,E)=>{Y!==z._currentVelocityGradient&&(z._currentVelocity1=z._currentVelocity2,z._currentVelocity2=H.getFactor(),z._currentVelocityGradient=Y),u._directionScale*=(0,L.Lerp)(z._currentVelocity1,z._currentVelocity2,E)}))}function Kz(z,u){e.GetCurrentGradient(u._ratio,u._limitVelocityGradients,((Y,H,E)=>{Y!==z._currentLimitVelocityGradient&&(z._currentLimitVelocity1=z._currentLimitVelocity2,z._currentLimitVelocity2=H.getFactor(),z._currentLimitVelocityGradient=Y);const J=(0,L.Lerp)(z._currentLimitVelocity1,z._currentLimitVelocity2,E);z.direction.length()>J&&z.direction.scaleInPlace(u.limitVelocityDamping)}))}function hz(z,u){z.direction.scaleToRef(u._directionScale,u._scaledDirection)}function oz(z,u){u.particleEmitterType.startPositionFunction(u._emitterWorldMatrix,z.position,z,u.isLocal)}function dz(z,u){u.startPositionFunction(u._emitterWorldMatrix,z.position,z,u.isLocal)}function tz(z,u){z.xT?z.xT.J(z.position):z.xT=z.position.clone(),H.p.TransformCoordinatesToRef(z.xT,u._emitterWorldMatrix,z.position)}function Wz(z,u){u.isLocal&&z.xT?(z.xT.addInPlace(u._scaledDirection),H.p.TransformCoordinatesToRef(z.xT,u._emitterWorldMatrix,z.position)):z.position.addInPlace(u._scaledDirection)}function Zz(z,u){z._currentDragGradient=u._dragGradients[0],z._currentDrag1=z._currentDragGradient.getFactor(),u._dragGradients.length>1?z._currentDrag2=u._dragGradients[1].getFactor():z._currentDrag2=z._currentDrag1}function sz(z,u){e.GetCurrentGradient(u._ratio,u._dragGradients,((Y,H,E)=>{Y!==z._currentDragGradient&&(z._currentDrag1=z._currentDrag2,z._currentDrag2=H.getFactor(),z._currentDragGradient=Y);const J=(0,L.Lerp)(z._currentDrag1,z._currentDrag2,E);u._scaledDirection.scaleInPlace(1-J)}))}function vz(z,u){z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.kl(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2.kl(Math.random(),Math.random(),Math.random())):(z._randomNoiseCoordinates1=new H.p(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2=new H.p(Math.random(),Math.random(),Math.random()))}function iz(z,u){const Y=u._noiseTextureData,E=u._noiseTextureSize;if(Y&&E&&z._randomNoiseCoordinates1){const J=u._fetchR(z._randomNoiseCoordinates1.x,z._randomNoiseCoordinates1.y,E.width,E.height,Y),l=u._fetchR(z._randomNoiseCoordinates1.z,z._randomNoiseCoordinates2.x,E.width,E.height,Y),T=u._fetchR(z._randomNoiseCoordinates2.y,z._randomNoiseCoordinates2.z,E.width,E.height,Y),b=H.i.Pl[0],L=H.i.Pl[1];b.kl((2*J-1)*u.noiseStrength.x,(2*l-1)*u.noiseStrength.y,(2*T-1)*u.noiseStrength.z),b.scaleToRef(u._tempScaledUpdateSpeed,L),z.direction.addInPlace(L)}}function Xz(z,u){u.gravity.scaleToRef(u._tempScaledUpdateSpeed,u._scaledGravity),z.direction.addInPlace(u._scaledGravity)}function Qz(z,u){z.size=(0,L.RandomRange)(u.minSize,u.maxSize),z.scale.kl((0,L.RandomRange)(u.minScaleX,u.maxScaleX),(0,L.RandomRange)(u.minScaleY,u.maxScaleY))}function Vz(z,u){z._currentSizeGradient=u._sizeGradients[0],z._currentSize1=z._currentSizeGradient.getFactor(),z.size=z._currentSize1,u._sizeGradients.length>1?z._currentSize2=u._sizeGradients[1].getFactor():z._currentSize2=z._currentSize1,z.scale.kl((0,L.RandomRange)(u.minScaleX,u.maxScaleX),(0,L.RandomRange)(u.minScaleY,u.maxScaleY))}function Az(z,u){const Y=u._actualFrame/u.targetStopDuration;e.GetCurrentGradient(Y,u._startSizeGradients,((Y,H,E)=>{Y!==u._currentStartSizeGradient&&(u._currentStartSize1=u._currentStartSize2,u._currentStartSize2=H.getFactor(),u._currentStartSizeGradient=Y);const J=(0,L.Lerp)(u._currentStartSize1,u._currentStartSize2,E);z.scale.scaleInPlace(J)}))}function xz(z,u){e.GetCurrentGradient(u._ratio,u._sizeGradients,((u,Y,H)=>{u!==z._currentSizeGradient&&(z._currentSize1=z._currentSize2,z._currentSize2=Y.getFactor(),z._currentSizeGradient=u),z.size=(0,L.Lerp)(z._currentSize1,z._currentSize2,H)}))}function Gz(z,u){z.remapData=new H.t(0,1,0,1)}function Fz(z,u){u._colorRemapGradients&&u._colorRemapGradients.length>0&&e.GetCurrentGradient(u._ratio,u._colorRemapGradients,((u,Y,H)=>{const E=(0,L.Lerp)(u.factor1,Y.factor1,H),J=(0,L.Lerp)(u.factor2,Y.factor2,H);z.remapData.x=E,z.remapData.y=J-E})),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&e.GetCurrentGradient(u._ratio,u._alphaRemapGradients,((u,Y,H)=>{const E=(0,L.Lerp)(u.factor1,Y.factor1,H),J=(0,L.Lerp)(u.factor2,Y.factor2,H);z.remapData.z=E,z.remapData.w=J-E}))}function Rz(z,u){const Y=(0,L.Clamp)(u._actualFrame/u.targetStopDuration);e.GetCurrentGradient(Y,u._lifeTimeGradients,((u,H)=>{const E=u,J=H,l=E.getFactor(),T=J.getFactor(),b=(Y-E.gradient)/(J.gradient-E.gradient);z.lifeTime=(0,L.Lerp)(l,T,b)})),u._emitPower=(0,L.RandomRange)(u.minEmitPower,u.maxEmitPower)}function wz(z,u){z.lifeTime=(0,L.RandomRange)(u.minLifeTime,u.maxLifeTime),u._emitPower=(0,L.RandomRange)(u.minEmitPower,u.maxEmitPower)}function cz(z,u){0===u._emitPower?(z._initialDirection?z._initialDirection.J(z.direction):z._initialDirection=z.direction.clone(),z.direction.set(0,0,0)):(z._initialDirection=null,z.direction.scaleInPlace(u._emitPower)),z.direction.addInPlace(u._inheritedVelocityOffset)}function Uz(z,u){z.angularSpeed=(0,L.RandomRange)(u.minAngularSpeed,u.maxAngularSpeed),z.angle=(0,L.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function Oz(z,u){z._currentAngularSpeedGradient=u._angularSpeedGradients[0],z.angularSpeed=z._currentAngularSpeedGradient.getFactor(),z._currentAngularSpeed1=z.angularSpeed,u._angularSpeedGradients.length>1?z._currentAngularSpeed2=u._angularSpeedGradients[1].getFactor():z._currentAngularSpeed2=z._currentAngularSpeed1,z.angle=(0,L.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function nz(z,u){z._initialStartSpriteCellId=u.startSpriteCellID,z._initialEndSpriteCellId=u.endSpriteCellID,z._initialSpriteCellLoop=u.spriteCellLoop}function mz(z,u){z.previousItem=u.previousItem,z.nextItem=u,u.previousItem&&(u.previousItem.nextItem=z),u.previousItem=z}function pz(z,u){z.previousItem=u,z.nextItem=u.nextItem,u.nextItem&&(u.nextItem.previousItem=z),u.nextItem=z}function Sz(z,u){let Y=u;for(;Y.nextItem;)Y=Y.nextItem;z.previousItem=Y,z.nextItem=Y.nextItem,Y.nextItem=z}function Iz(z){z.previousItem&&(z.previousItem.nextItem=z.nextItem),z.nextItem&&(z.nextItem.previousItem=z.previousItem)}class yz extends b{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(z){this._startDirectionFunction!==z&&(this._startDirectionFunction=z,this._directionProcessing.process=z?gz:Dz)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(z){this._startPositionFunction!==z&&(this._startPositionFunction=z,this._positionCreation.process=z?dz:oz)}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}get L(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(z){this._useRampGradients!==z&&(this._useRampGradients=z,this._resetEffect(),z?(this._rampCreation={process:Gz,previousItem:null,nextItem:null},pz(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Fz,previousItem:null,nextItem:null},pz(this._remapGradientProcessing,this._gravityProcessing)):(Iz(this._rampCreation),Iz(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(z){this._isLocal!==z&&(this._isLocal=z,z?(this._isLocalCreation={process:tz,previousItem:null,nextItem:null},pz(this._isLocalCreation,this._positionCreation)):Iz(this._isLocalCreation))}get particles(){return this.AM}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(z){this._animationSheetEnabled!==z&&(this._animationSheetEnabled=z,z?(this._sheetCreation={process:nz,previousItem:null,nextItem:null},pz(this._sheetCreation,this._colorCreation)):Iz(this._sheetCreation),this._reset())}getActiveCount(){return this.AM.length}getClassName(){return"Yb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._customWrappers[u])||void 0===z?void 0:z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[z]??this._customWrappers[0]}setCustomEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new zz.e(this._engine),this._customWrappers[u].effect=z,this._customWrappers[u].drawContext&&(this._customWrappers[u].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new N.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(z){if(this.noiseTexture!==z){if(this._noiseTexture=z,!z)return Iz(this._noiseCreation),void Iz(this._noiseProcessing);this._noiseCreation={process:vz,previousItem:null,nextItem:null},pz(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:iz,previousItem:null,nextItem:null},pz(this._noiseProcessing,this._positionProcessing)}}constructor(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(z),this._emitterInverseWorldMatrix=H.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new H.p,this.fl=new N.e,this.onStoppedObservable=new N.e,this.onStartedObservable=new N.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.AM=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new l.e(0,0,0,0),this._colorDiff=new l.e(0,0,0,0),this._scaledDirection=H.p.Zero(),this._scaledGravity=H.p.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=z=>{},this.recycleParticle=z=>{const u=this.AM.pop();u!==z&&u.copyTo(z),this._stockParticles.push(u)},this._createParticle=()=>{let z;return 0!==this._stockParticles.length?(z=this._stockParticles.pop(),z._reset()):z=new r(this),this._prepareParticle(z),z},this.paused=!1,this._shadersLoaded=!1,this._capacity=u,this._epsilon=T,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=H.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.QM.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:wz,previousItem:null,nextItem:null},this._positionCreation={process:oz,previousItem:null,nextItem:null},pz(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Dz,previousItem:null,nextItem:null},pz(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:cz,previousItem:null,nextItem:null},pz(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Qz,previousItem:null,nextItem:null},pz(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Uz,previousItem:null,nextItem:null},pz(this._angleCreation,this._sizeCreation),this._colorCreation={process:Ez,previousItem:null,nextItem:null},pz(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,b||(this._colorProcessing={process:Tz,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Lz,previousItem:null,nextItem:null},pz(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:hz,previousItem:null,nextItem:null},pz(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Wz,previousItem:null,nextItem:null},pz(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Xz,previousItem:null,nextItem:null},pz(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=J,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new zz.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new g,this.updateFunction=z=>{var u;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(u=this.noiseTexture.getContent())||void 0===u||u.then((z=>{this._noiseTextureData=z})));const Y=z===this.AM;for(let H=0;H<z.length;H++){const u=z[H];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=u.age;if(u.age+=this._tempScaledUpdateSpeed,u.age>u.lifeTime){const z=u.age-E,Y=u.lifeTime-E;this._tempScaledUpdateSpeed=Y*this._tempScaledUpdateSpeed/z,u.age=u.lifeTime}this._ratio=u.age/u.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let J=this._updateQueueStart;for(;J;)J.process(u,this),J=J.nextItem;if(this._isAnimationSheetEnabled&&!b&&u.updateCellIndex(),u._inheritParticleInfoToSubEmitters(),u.age>=u.lifeTime){if(this._emitFromParticle(u),u._attachedSubEmitters){for(const z of u._attachedSubEmitters)z.particleSystem.disposeOnStop=!0,z.particleSystem.stop();u._attachedSubEmitters=null}this.recycleParticle(u),Y&&H--}else;}}}serialize(z){throw new Error("Method not implemented.")}clone(z,u){throw new Error("Method not implemented.")}_addFactorGradient(z,u,Y,H){const E=new P(u,Y,H);z.push(E),z.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0))}_removeFactorGradient(z,u){if(!z)return;let Y=0;for(const H of z){if(H.gradient===u){z.splice(Y,1);break}Y++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Rz:this._lifeTimeCreation.process=wz}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Az,previousItem:null,nextItem:null},pz(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Iz(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(z){this.targetStopDuration!==z&&(this._targetStopDuration=z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(z,u,Y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,z,u,Y),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(z){return this._removeFactorGradient(this._lifeTimeGradients,z),this._syncLifeTimeCreation(),this}addSizeGradient(z,u,Y){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Vz,this._sizeGradientProcessing={process:xz,previousItem:null,nextItem:null},mz(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,z,u,Y),this}removeSizeGradient(z){var u;return this._removeFactorGradient(this._sizeGradients,z),0===(null===(u=this._sizeGradients)||void 0===u?void 0:u.length)&&(Iz(this._sizeGradientProcessing),this._sizeCreation.process=Qz),this}addColorRemapGradient(z,u,Y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,z,u,Y),this}removeColorRemapGradient(z){return this._removeFactorGradient(this._colorRemapGradients,z),this}addAlphaRemapGradient(z,u,Y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,z,u,Y),this}removeAlphaRemapGradient(z){return this._removeFactorGradient(this._alphaRemapGradients,z),this}addAngularSpeedGradient(z,u,Y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Oz,this._angularSpeedGradientProcessing={process:bz,previousItem:null,nextItem:null},mz(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,z,u,Y),this}removeAngularSpeedGradient(z){var u;return this._removeFactorGradient(this._angularSpeedGradients,z),0===(null===(u=this._angularSpeedGradients)||void 0===u?void 0:u.length)&&(this._angleCreation.process=Uz,Iz(this._angularSpeedGradientProcessing)),this}addVelocityGradient(z,u,Y){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Mz,previousItem:null,nextItem:null},pz(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Cz,previousItem:null,nextItem:null},mz(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,z,u,Y),this}removeVelocityGradient(z){var u;return this._removeFactorGradient(this._velocityGradients,z),0===(null===(u=this._velocityGradients)||void 0===u?void 0:u.length)&&(Iz(this._velocityCreation),Iz(this._velocityGradientProcessing)),this}addLimitVelocityGradient(z,u,Y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:qz,previousItem:null,nextItem:null},pz(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Kz,previousItem:null,nextItem:null},pz(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,z,u,Y),this}removeLimitVelocityGradient(z){var u;return this._removeFactorGradient(this._limitVelocityGradients,z),0===(null===(u=this._limitVelocityGradients)||void 0===u?void 0:u.length)&&(Iz(this._limitVelocityCreation),Iz(this._limitVelocityGradientProcessing)),this}addDragGradient(z,u,Y){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Zz,previousItem:null,nextItem:null},mz(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:sz,previousItem:null,nextItem:null},mz(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,z,u,Y),this}removeDragGradient(z){var u;return this._removeFactorGradient(this._dragGradients,z),0===(null===(u=this._dragGradients)||void 0===u?void 0:u.length)&&(Iz(this._dragCreation),Iz(this._dragGradientProcessing)),this}addEmitRateGradient(z,u,Y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,z,u,Y),this}removeEmitRateGradient(z){return this._removeFactorGradient(this._emitRateGradients,z),this}addStartSizeGradient(z,u,Y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,z,u,Y),this._syncStartSizeCreation(),this}removeStartSizeGradient(z){return this._removeFactorGradient(this._startSizeGradients,z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const z=new Uint8Array(4*this._rawTextureWidth),u=l.g.o[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const H=Y/this._rawTextureWidth;e.GetCurrentGradient(H,this._rampGradients,((H,E,J)=>{l.c.LerpToRef(H.color,E.color,J,u),z[4*Y]=255*u.r,z[4*Y+1]=255*u.g,z[4*Y+2]=255*u.b,z[4*Y+3]=255}))}this._rampGradientsTexture=B.e.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(z,u){this._rampGradients||(this._rampGradients=[]);const Y=new k(z,u);return this._rampGradients.push(Y),this._syncRampGradientTexture(),this}removeRampGradient(z){return this._removeGradientAndTexture(z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(z,u,Y){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Jz,this._colorProcessing.process=lz);const H=new j(z,u,Y);return this._colorGradients.push(H),this._colorGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this}removeColorGradient(z){if(!this._colorGradients)return this;let u=0;for(const Y of this._colorGradients){if(Y.gradient===z){this._colorGradients.splice(u,1);break}u++}return 0===this._colorGradients.length&&(this._colorCreation.process=Ez,this._colorProcessing.process=Tz),this}resetDrawCache(){if(this._drawWrappers){for(const z of this._drawWrappers)if(z)for(const u of z)null===u||void 0===u||u.dispose();this._drawWrappers=[]}}_fetchR(z,u,Y,H,E){return E[4*(((z=.5*Math.abs(z)+.5)*Y%Y|0)+((u=.5*Math.abs(u)+.5)*H%H|0)*Y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const z=this._engine,u=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*u),this._vertexBuffer=new Z.d(z,this._vertexData,!0,u);let Y=0;const H=this._vertexBuffer.createVertexBuffer(Z.f.PositionKind,Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.f.PositionKind]=H,Y+=3;const E=this._vertexBuffer.createVertexBuffer(Z.f.ColorKind,Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.f.ColorKind]=E,Y+=4;const J=this._vertexBuffer.createVertexBuffer("angle",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=J,Y+=1;const l=this._vertexBuffer.createVertexBuffer("size",Y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=l,Y+=2,this._isAnimationSheetEnabled){const z=this._vertexBuffer.createVertexBuffer("cellIndex",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=z,Y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const z=this._vertexBuffer.createVertexBuffer("direction",Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=z,Y+=3}if(this._useRampGradients){const z=this._vertexBuffer.createVertexBuffer("remapData",Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=z,Y+=4}let T;if(this._useInstancing){const u=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Z.d(z,u,!1,2),T=this._spriteBuffer.createVertexBuffer("offset",0,2)}else T=this._vertexBuffer.createVertexBuffer("offset",Y,2,this._vertexBufferSize,this._useInstancing),Y+=2;this._vertexBuffers.offset=T,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const z=[],u=[];let Y=0;for(let H=0;H<this._capacity;H++)z.push(Y),z.push(Y+1),z.push(Y+2),z.push(Y),z.push(Y+2),z.push(Y+3),u.push(Y,Y+1,Y+1,Y+2,Y+2,Y+3,Y+3,Y,Y,Y+3),Y+=4;this._indexBuffer=this._engine.createIndexBuffer(z),this._linesIndexBuffer=this._engine.createIndexBuffer(u)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(z)setTimeout((()=>{this.start(0)}),z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var u;-1!==(null===(u=this.k)||void 0===u?void 0:u.getClassName().indexOf("Mesh"))&&this.k.pl(!0);const z=this.noiseTexture;if(z&&z.onGeneratedObservable)z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),z.render()}))}));else for(let u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(z))}_postStop(z){}reset(){this._stockParticles.length=0,this.AM.length=0}_appendParticleVertex(z,u,Y,E){let J=z*this._vertexBufferSize;if(this._vertexData[J++]=u.position.x+this.AL.x,this._vertexData[J++]=u.position.y+this.AL.y,this._vertexData[J++]=u.position.z+this.AL.z,this._vertexData[J++]=u.color.r,this._vertexData[J++]=u.color.g,this._vertexData[J++]=u.color.b,this._vertexData[J++]=u.color.a,this._vertexData[J++]=u.angle,this._vertexData[J++]=u.scale.x*u.size,this._vertexData[J++]=u.scale.y*u.size,this._isAnimationSheetEnabled&&(this._vertexData[J++]=u.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[J++]=u.direction.x,this._vertexData[J++]=u.direction.y,this._vertexData[J++]=u.direction.z);else if(u._initialDirection){let z=u._initialDirection;this.isLocal&&(H.p.TransformNormalToRef(z,this._emitterWorldMatrix,H.i.Pl[0]),z=H.i.Pl[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[J++]=z.x,this._vertexData[J++]=z.y,this._vertexData[J++]=z.z}else{let z=u.direction;this.isLocal&&(H.p.TransformNormalToRef(z,this._emitterWorldMatrix,H.i.Pl[0]),z=H.i.Pl[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[J++]=z.x,this._vertexData[J++]=z.y,this._vertexData[J++]=z.z}this._useRampGradients&&u.remapData&&(this._vertexData[J++]=u.remapData.x,this._vertexData[J++]=u.remapData.y,this._vertexData[J++]=u.remapData.z,this._vertexData[J++]=u.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Y?Y=this._epsilon:1===Y&&(Y=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[J++]=Y,this._vertexData[J++]=E)}_prepareParticle(z){}_createNewOnes(z){let u;for(let Y=0;Y<z&&this.AM.length!==this._capacity;Y++){u=this._createParticle(),this.AM.push(u);let z=this._createQueueStart;for(;z;)z.process(u,this),z=z.nextItem;u._inheritParticleInfoToSubEmitters()}}_update(z){if(this._alive=this.AM.length>0,this.k.position){const z=this.k;this._emitterWorldMatrix=z.getWorldMatrix()}else{const z=this.k;this._emitterWorldMatrix=H.b.Translation(z.x,z.y,z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.AM),this._createNewOnes(z)}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=[Z.f.PositionKind,Z.f.ColorKind,"angle","offset","size"];return z&&H.push("cellIndex"),u||H.push("direction"),Y&&H.push("remapData"),H}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,uz.b)(H),z&&H.push("particlesInfos"),u&&H.push("logarithmicDepthConstant"),Y&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uz.l)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&z.push("#define FOG")),this._isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),u===b.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case 2:z.push("#define BILLBOARDY");break;case 8:case 9:z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:z.push("#define BILLBOARDMODE_ALL")}Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,u,Y){u.push(...yz._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),z.push(...yz._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Hz.f)(z,this._imageProcessingConfigurationDefines),(0,Hz.b)(Y,this._imageProcessingConfigurationDefines))}_getWrapper(z){const u=this._getCustomDrawWrapper(z);if(null!==u&&void 0!==u&&u.effect)return u;const Y=[];this.fillDefines(Y,z);const H=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[H];E||(E=this._drawWrappers[H]=[]);let J=E[z];J||(J=new zz.e(this._engine),J.drawContext&&(J.drawContext.useInstancing=this._useInstancing),E[z]=J);const l=Y.join("\n");if(J.defines!==l){const z=[],u=[],Y=[];this.fillUniformsAttributesAndSamplerNames(u,z,Y),J.setEffect(this._engine.createEffect("particles",z,u,Y,l,void 0,void 0,void 0,void 0,this._shaderLanguage),l)}return J}animate(){var z;let u,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Y?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this.manualEmitCount>-1)u=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const u=this._actualFrame/this.targetStopDuration;e.GetCurrentGradient(u,this._emitRateGradients,((u,Y,H)=>{u!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Y.getFactor(),this._currentEmitRateGradient=u),z=(0,L.Lerp)(this._currentEmitRate1,this._currentEmitRate2,H)}))}u=z*this._scaledUpdateSpeed|0,this._newPartsExcess+=z*this._scaledUpdateSpeed-u}if(this._newPartsExcess>1&&(u+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?u=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(u),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Y){let z=0;for(let u=0;u<this.AM.length;u++){const Y=this.AM[u];this._appendParticleVertices(z,Y),z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.AM.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(z,u){this._appendParticleVertex(z++,u,0,0),this._useInstancing||(this._appendParticleVertex(z++,u,1,0),this._appendParticleVertex(z++,u,1,1),this._appendParticleVertex(z++,u,0,1))}rebuild(){var z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(z=this._spriteBuffer)||void 0===z||z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!yz.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Y.bind(Y,12293)),Promise.resolve().then(Y.bind(Y,12250))])):await Promise.all([Promise.resolve().then(Y.bind(Y,12240)),Promise.resolve().then(Y.bind(Y,12229))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==b.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(b.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(b.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(z){const u=this._getWrapper(z),Y=u.effect,E=this._engine;E.enableEffect(u);const J=this.defaultViewMatrix??this._scene.getViewMatrix();if(Y.setTexture("diffuseSampler",this.particleTexture),Y.setMatrix("view",J),Y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();Y.setFloat3("particlesInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,this.spriteCellWidth/z.width)}if(Y.setVector2("translationPivot",this.translationPivot),Y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;Y.setVector3("eyePosition",z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Y.setTexture("rampSampler",this._rampGradientsTexture));const l=Y.defines;var T,b,L,D,g,M;(this._scene&&((0,uz.f)(Y,this,this._scene),this.applyFog&&(0,Yz.f)(this._scene,void 0,Y)),l.indexOf("#define BILLBOARDMODE_ALL")>=0&&(J.invertToRef(H.i.Matrix[0]),Y.setMatrix("invView",H.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Y):E.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:null,Y);(this.useLogarithmicDepth&&this._scene&&(0,Yz.h)(l,Y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Y),this._setEngineBasedOnBlendMode(z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Y),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?E.drawElementsType(6,0,10,this.AM.length):E.drawArraysType(7,0,4,this.AM.length):null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?E.drawElementsType(1,0,10*this.AM.length):E.drawElementsType(0,0,6*this.AM.length);return this.AM.length}render(){if(!this.isReady()||!this.AM.length)return 0;const z=this._engine;z.setState&&(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0));let u=0;return u=this.blendMode===b.BLENDMODE_MULTIPLYADD?this._render(b.BLENDMODE_MULTIPLY)+this._render(b.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),u}_onDispose(){}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(u,Y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const z=this._scene.QM.indexOf(this);z>-1&&this._scene.QM.splice(z,1),this._scene._activeParticleSystems.dispose()}this.fl.notifyObservers(this),this.fl.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}yz.ForceGLSL=!1;var az,jz=Y(10970);!function(z){z[z.ATTACHED=0]="ATTACHED",z[z.END=1]="END"}(az||(az={}));class kz{constructor(z){if(this.particleSystem=z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!z.k||!z.k.dispose){const u=(0,T.c)("BABYLON.AbstractMesh");z.k=new u("SubemitterSystemEmitter",z.iz()),z._disposeEmitterOnDispose=!0}}clone(){let z=this.particleSystem.k;if(z){if(z instanceof H.p)z=z.clone();else if(-1!==z.getClassName().indexOf("Mesh")){z=new((0,T.c)("BABYLON.Mesh"))("",z.iz()),z.isVisible=!1}}else z=new H.p;const u=new kz(this.particleSystem.clone(this.particleSystem.name,z));return u.particleSystem.name+="Clone",u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem._disposeEmitterOnDispose=!0,u.particleSystem.disposeOnStop=!0,u}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem=this.particleSystem.serialize(z),u}static _ParseParticleSystem(z,u,Y){throw(0,jz.e)("ParseParticle")}static Parse(z,u,Y){const H=z.particleSystem,E=new kz(kz._ParseParticleSystem(H,u,Y,!0));return E.type=z.type,E.inheritDirection=z.inheritDirection,E.inheritedVelocityAmount=z.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var Pz=Y(11018);function ez(z,u){const Y=new o;return Y.direction1=z,Y.direction2=u,Y}function Nz(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Bz(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.p(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0);return new t(z,u,Y)}function rz(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function zu(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0),J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.p(0,1,0);return new K(z,u,Y,E,J)}function uu(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new M(z,u)}function Yu(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0);return new q(z,u,Y,E)}const Hu=H.p.Zero(),Eu=H.p.Zero(),Ju=H.p.Zero();class lu{constructor(){this.strength=0,this.position=H.p.Zero()}_processParticle(z,u){this.position.subtractToRef(z.position,Hu);const Y=Hu.lengthSquared()+1;Hu.normalize().scaleToRef(this.strength/Y,Eu),Eu.scaleToRef(u._tempScaledUpdateSpeed,Ju),z.direction.addInPlace(Ju)}serialize(){return{position:this.position.al(),strength:this.strength}}}class Tu extends yz{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const u=Math.floor(Math.random()*this._subEmitters.length);for(const Y of this._subEmitters[u])if(1===Y.type){const u=Y.clone();z._inheritParticleInfoToSubEmitter(u),u.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(u.particleSystem),u.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(z,u){const Y=ez(z,u);return this.particleEmitterType=Y,Y}get flowMap(){return this._flowMap}set flowMap(z){this._flowMap!==z&&(this._flowMap=z,this._flowMapUpdate&&(Iz(this._flowMapUpdate),this._flowMapUpdate=null),z&&(this._flowMapUpdate={process:z=>{var u;const Y=null===(u=this.iz())||void 0===u?void 0:u.getTransformMatrix();this._flowMap._processParticle(z,this.flowMapStrength*this._tempScaledUpdateSpeed,Y)},previousItem:null,nextItem:null},pz(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(z){this._attractors.push(z),1===this._attractors.length&&(this._attractorUpdate={process:z=>{for(const u of this._attractors)u._processParticle(z,this)},previousItem:null,nextItem:null},pz(this._attractorUpdate,this._directionProcessing))}removeAttractor(z){const u=this._attractors.indexOf(z);-1!==u&&this._attractors.splice(u,1),0===this._attractors.length&&Iz(this._attractorUpdate)}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(z)}createHemisphericEmitter(){const z=Nz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=Bz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=fz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=rz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=zu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.p(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=Yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,u,Y,H){const E=new g;return this.particleEmitterType=E,this.direction1=z,this.direction2=u,this.minEmitBox=Y,this.maxEmitBox=H,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const z of this.subEmitters)z instanceof Tu?this._subEmitters.push([new kz(z)]):z instanceof kz?this._subEmitters.push([z]):z instanceof Array&&this._subEmitters.push(z)}_stopSubEmitters(){if(this.activeSubSystems){for(const z of this.activeSubSystems)z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==z&&this._rootParticleSystem.activeSubSystems.splice(z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(z){z&&this._stopSubEmitters()}_prepareParticle(z){if(this._subEmitters&&this._subEmitters.length>0){const u=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];z._attachedSubEmitters=[];for(const Y of u)if(0===Y.type){const u=Y.clone();z._attachedSubEmitters.push(u),u.particleSystem.start()}}}_onDispose(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),z&&this.particles)for(const Y of this.particles)if(Y._attachedSubEmitters)for(let z=Y._attachedSubEmitters.length-1;z>=0;z-=1)Y._attachedSubEmitters[z].dispose();if(u&&this.activeSubSystems)for(let Y=this.activeSubSystems.length-1;Y>=0;Y-=1)this.activeSubSystems[Y].dispose();if(this._subEmitters&&this._subEmitters.length){for(let z=0;z<this._subEmitters.length;z++)for(const u of this._subEmitters[z])u.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(z,u,Y,E){let J;J=Y instanceof Pz.e?null:Y;const b=(0,T.c)("BABYLON.Texture");if(b&&J&&(z.texture?u.particleTexture=b.Parse(z.texture,J,E):z.textureName&&(u.particleTexture=new b(E+z.textureName,J,!1,void 0===z.invertY||z.invertY),u.particleTexture.name=z.textureName)),z.emitterId||0===z.emitterId||void 0!==z.k?z.emitterId&&J?u.k=J.getLastMeshById(z.emitterId):u.k=H.p.Nl(z.k):u.k=H.p.Zero(),u.isLocal=!!z.isLocal,void 0!==z.renderingGroupId&&(u.renderingGroupId=z.renderingGroupId),void 0!==z.isBillboardBased&&(u.isBillboardBased=z.isBillboardBased),void 0!==z.billboardMode&&(u.billboardMode=z.billboardMode),void 0!==z.useLogarithmicDepth&&(u.useLogarithmicDepth=z.useLogarithmicDepth),z.animations){for(let Y=0;Y<z.animations.length;Y++){const H=z.animations[Y],E=(0,T.c)("BABYLON.Animation");E&&u.animations.push(E.Parse(H))}u.beginAnimationOnStart=z.beginAnimationOnStart,u.beginAnimationFrom=z.beginAnimationFrom,u.beginAnimationTo=z.beginAnimationTo,u.beginAnimationLoop=z.beginAnimationLoop}if(z.autoAnimate&&J&&J.beginAnimation(u,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),u.startDelay=0|z.startDelay,u.minAngularSpeed=z.minAngularSpeed,u.maxAngularSpeed=z.maxAngularSpeed,u.minSize=z.minSize,u.maxSize=z.maxSize,z.minScaleX&&(u.minScaleX=z.minScaleX,u.maxScaleX=z.maxScaleX,u.minScaleY=z.minScaleY,u.maxScaleY=z.maxScaleY),void 0!==z.preWarmCycles&&(u.preWarmCycles=z.preWarmCycles,u.preWarmStepOffset=z.preWarmStepOffset),void 0!==z.minInitialRotation&&(u.minInitialRotation=z.minInitialRotation,u.maxInitialRotation=z.maxInitialRotation),u.minLifeTime=z.minLifeTime,u.maxLifeTime=z.maxLifeTime,u.minEmitPower=z.minEmitPower,u.maxEmitPower=z.maxEmitPower,u.emitRate=z.emitRate,u.gravity=H.p.Nl(z.gravity),z.noiseStrength&&(u.noiseStrength=H.p.Nl(z.noiseStrength)),u.color1=l.e.Nl(z.color1),u.color2=l.e.Nl(z.color2),u.colorDead=l.e.Nl(z.colorDead),u.updateSpeed=z.updateSpeed,u.targetStopDuration=z.targetStopDuration,u.blendMode=z.blendMode,z.colorGradients)for(const H of z.colorGradients)u.addColorGradient(H.gradient,l.e.Nl(H.color1),H.color2?l.e.Nl(H.color2):void 0);if(z.rampGradients){for(const Y of z.rampGradients)u.addRampGradient(Y.gradient,l.c.Nl(Y.color));u.useRampGradients=z.useRampGradients}if(z.colorRemapGradients)for(const H of z.colorRemapGradients)u.addColorRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.alphaRemapGradients)for(const H of z.alphaRemapGradients)u.addAlphaRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.sizeGradients)for(const H of z.sizeGradients)u.addSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.angularSpeedGradients)for(const H of z.angularSpeedGradients)u.addAngularSpeedGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.velocityGradients)for(const H of z.velocityGradients)u.addVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.dragGradients)for(const H of z.dragGradients)u.addDragGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.emitRateGradients)for(const H of z.emitRateGradients)u.addEmitRateGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.startSizeGradients)for(const H of z.startSizeGradients)u.addStartSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.lifeTimeGradients)for(const H of z.lifeTimeGradients)u.addLifeTimeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(z.limitVelocityGradients){for(const Y of z.limitVelocityGradients)u.addLimitVelocityGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);u.limitVelocityDamping=z.limitVelocityDamping}if(z.noiseTexture&&J){const Y=(0,T.c)("BABYLON.ProceduralTexture");u.noiseTexture=Y.Parse(z.noiseTexture,J,E)}let L;if(z.particleEmitterType){switch(z.particleEmitterType.type){case"SphereParticleEmitter":L=new d;break;case"SphereDirectedParticleEmitter":L=new t;break;case"ConeEmitter":case"ConeParticleEmitter":L=new M;break;case"ConeDirectedParticleEmitter":L=new q;break;case"CylinderParticleEmitter":L=new C;break;case"CylinderDirectedParticleEmitter":L=new K;break;case"HemisphericParticleEmitter":L=new h;break;case"PointParticleEmitter":L=new o;break;case"MeshParticleEmitter":L=new s;break;case"CustomParticleEmitter":L=new W;break;default:L=new g}L.parse(z.particleEmitterType,J)}else L=new g,L.parse(z,J);u.particleEmitterType=L,u.startSpriteCellID=z.startSpriteCellID,u.endSpriteCellID=z.endSpriteCellID,u.spriteCellLoop=z.spriteCellLoop??!0,u.spriteCellWidth=z.spriteCellWidth,u.spriteCellHeight=z.spriteCellHeight,u.spriteCellChangeSpeed=z.spriteCellChangeSpeed,u.spriteRandomStartCell=z.spriteRandomStartCell,u.disposeOnStop=z.disposeOnStop??!1,u.manualEmitCount=z.manualEmitCount??-1}static Parse(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0;const T=z.name;let b,L,D=null,g=null;if(u instanceof Pz.e?b=u:(L=u,b=L.getEngine()),z.customShader&&b.createEffectForParticles){g=z.customShader;const u=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";D=b.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,u)}const M=new Tu(T,J||z.vY,u,D,z.isAnimationSheetEnabled);if(M.customShader=g,M._rootUrl=Y,z.id&&(M.id=z.id),z.subEmitters){M.subEmitters=[];for(const H of z.subEmitters){const z=[];for(const E of H)z.push(kz.Parse(E,u,Y));M.subEmitters.push(z)}}if(z.attractors)for(const l of z.attractors){const z=new lu;z.position=H.p.Nl(l.position),z.strength=l.strength,M.addAttractor(z)}return Tu._Parse(z,M,u,Y),z.textureMask&&(M.textureMask=l.e.Nl(z.textureMask)),z.AL&&(M.AL=H.p.Nl(z.AL)),z.preventAutoStart&&(M.preventAutoStart=z.preventAutoStart),E||M.preventAutoStart||M.start(),M}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};if(Tu._Serialize(u,this,z),u.textureMask=this.textureMask.al(),u.customShader=this.customShader,u.preventAutoStart=this.preventAutoStart,u.AL=this.AL.al(),this.subEmitters){u.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Y of this._subEmitters){const H=[];for(const u of Y)H.push(u.serialize(z));u.subEmitters.push(H)}}if(this._attractors&&this._attractors.length){u.attractors=[];for(const z of this._attractors)u.attractors.push(z.serialize())}return u}static _Serialize(z,u,Y){if(z.name=u.name,z.id=u.id,z.vY=u.getCapacity(),z.disposeOnStop=u.disposeOnStop,z.manualEmitCount=u.manualEmitCount,u.k.position){const Y=u.k;z.emitterId=Y.id}else{const Y=u.k;z.k=Y.al()}u.particleEmitterType&&(z.particleEmitterType=u.particleEmitterType.serialize()),u.particleTexture&&(Y?z.texture=u.particleTexture.serialize():(z.textureName=u.particleTexture.name,z.invertY=!!u.particleTexture._invertY)),z.isLocal=u.isLocal,R.d.AppendSerializedAnimations(u,z),z.beginAnimationOnStart=u.beginAnimationOnStart,z.beginAnimationFrom=u.beginAnimationFrom,z.beginAnimationTo=u.beginAnimationTo,z.beginAnimationLoop=u.beginAnimationLoop,z.startDelay=u.startDelay,z.renderingGroupId=u.renderingGroupId,z.isBillboardBased=u.isBillboardBased,z.billboardMode=u.billboardMode,z.minAngularSpeed=u.minAngularSpeed,z.maxAngularSpeed=u.maxAngularSpeed,z.minSize=u.minSize,z.maxSize=u.maxSize,z.minScaleX=u.minScaleX,z.maxScaleX=u.maxScaleX,z.minScaleY=u.minScaleY,z.maxScaleY=u.maxScaleY,z.minEmitPower=u.minEmitPower,z.maxEmitPower=u.maxEmitPower,z.minLifeTime=u.minLifeTime,z.maxLifeTime=u.maxLifeTime,z.emitRate=u.emitRate,z.gravity=u.gravity.al(),z.noiseStrength=u.noiseStrength.al(),z.color1=u.color1.al(),z.color2=u.color2.al(),z.colorDead=u.colorDead.al(),z.updateSpeed=u.updateSpeed,z.targetStopDuration=u.targetStopDuration,z.blendMode=u.blendMode,z.preWarmCycles=u.preWarmCycles,z.preWarmStepOffset=u.preWarmStepOffset,z.minInitialRotation=u.minInitialRotation,z.maxInitialRotation=u.maxInitialRotation,z.startSpriteCellID=u.startSpriteCellID,z.spriteCellLoop=u.spriteCellLoop,z.endSpriteCellID=u.endSpriteCellID,z.spriteCellChangeSpeed=u.spriteCellChangeSpeed,z.spriteCellWidth=u.spriteCellWidth,z.spriteCellHeight=u.spriteCellHeight,z.spriteRandomStartCell=u.spriteRandomStartCell,z.isAnimationSheetEnabled=u.isAnimationSheetEnabled,z.useLogarithmicDepth=u.useLogarithmicDepth;const H=u.getColorGradients();if(H){z.colorGradients=[];for(const u of H){const Y={gradient:u.gradient,color1:u.color1.al()};u.color2?Y.color2=u.color2.al():Y.color2=u.color1.al(),z.colorGradients.push(Y)}}const E=u.getRampGradients();if(E){z.rampGradients=[];for(const u of E){const Y={gradient:u.gradient,color:u.color.al()};z.rampGradients.push(Y)}z.useRampGradients=u.useRampGradients}const J=u.getColorRemapGradients();if(J){z.colorRemapGradients=[];for(const u of J){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.colorRemapGradients.push(Y)}}const l=u.getAlphaRemapGradients();if(l){z.alphaRemapGradients=[];for(const u of l){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.alphaRemapGradients.push(Y)}}const T=u.getSizeGradients();if(T){z.sizeGradients=[];for(const u of T){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.sizeGradients.push(Y)}}const b=u.getAngularSpeedGradients();if(b){z.angularSpeedGradients=[];for(const u of b){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.angularSpeedGradients.push(Y)}}const L=u.getVelocityGradients();if(L){z.velocityGradients=[];for(const u of L){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.velocityGradients.push(Y)}}const D=u.getDragGradients();if(D){z.dragGradients=[];for(const u of D){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.dragGradients.push(Y)}}const g=u.getEmitRateGradients();if(g){z.emitRateGradients=[];for(const u of g){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.emitRateGradients.push(Y)}}const M=u.getStartSizeGradients();if(M){z.startSizeGradients=[];for(const u of M){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.startSizeGradients.push(Y)}}const q=u.getLifeTimeGradients();if(q){z.lifeTimeGradients=[];for(const u of q){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.lifeTimeGradients.push(Y)}}const C=u.getLimitVelocityGradients();if(C){z.limitVelocityGradients=[];for(const u of C){const Y={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?Y.factor2=u.factor2:Y.factor2=u.factor1,z.limitVelocityGradients.push(Y)}z.limitVelocityDamping=u.limitVelocityDamping}u.noiseTexture&&(z.noiseTexture=u.noiseTexture.serialize())}clone(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let E=null;const J=this._engine;if(J.createEffectForParticles&&null!=this.customShader){E=this.customShader;const z=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",u=J.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,z);H[0]?H[0].effect=u:this.setCustomEffect(u,0)}const l=this.serialize(Y),T=Tu.Parse(l,this._scene||this._engine,this._rootUrl);return T.name=z,T.customShader=E,T._customWrappers=H,void 0===u&&(u=this.k),this.noiseTexture&&(T.noiseTexture=this.noiseTexture.clone()),T.k=u,this.preventAutoStart||T.start(),T}}Tu.BILLBOARDMODE_Y=2,Tu.BILLBOARDMODE_ALL=7,Tu.BILLBOARDMODE_STRETCHED=8,Tu.BILLBOARDMODE_STRETCHED_LOCAL=9,kz._ParseParticleSystem=Tu.Parse;var bu=Y(11508),Lu=Y(11504),Du=Y(11325);Du.b.prototype.createTransformFeedback=function(){const z=this._gl.createTransformFeedback();if(!z)throw new Error("Unable to create Transform Feedback");return z},Du.b.prototype.deleteTransformFeedback=function(z){this._gl.deleteTransformFeedback(z)},Du.b.prototype.bindTransformFeedback=function(z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,z)},Du.b.prototype.beginTransformFeedback=function(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(z?this._gl.POINTS:this._gl.TRIANGLES)},Du.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Du.b.prototype.setTranformFeedbackVaryings=function(z,u){this._gl.transformFeedbackVaryings(z,u,this._gl.INTERLEAVED_ATTRIBS)},Du.b.prototype.bindTransformFeedbackBuffer=function(z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z?z.underlyingResource:null)},Du.b.prototype.readTransformFeedbackBuffer=function(z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z)};const gu="clipPlaneFragmentDeclaration2",Mu="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[gu]||(i.b.IncludesShadersStore[gu]=Mu);Y(12139),Y(12141),Y(12146),Y(12149),Y(12155),Y(12157),Y(12166),Y(12174);const qu="gpuRenderParticlesPixelShader",Cu="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.b.ShadersStore[qu]||(i.b.ShadersStore[qu]=Cu);const Ku="clipPlaneVertexDeclaration2",hu="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[Ku]||(i.b.IncludesShadersStore[Ku]=hu);Y(12182),Y(12185),Y(12189),Y(12195);const ou="gpuRenderParticlesVertexShader",du="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.b.ShadersStore[ou]||(i.b.ShadersStore[ou]=du);class tu extends b{static get IsSupported(){if(!f.d.LastCreatedEngine)return!1;const z=f.d.LastCreatedEngine.getCaps();return z.supportTransformFeedbacks||z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(z){this._maxActiveParticleCount=Math.min(z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(z){this.maxActiveParticleCount=z}createPointEmitter(z,u){const Y=ez(z,u);return this.particleEmitterType=Y,Y}createHemisphericEmitter(){const z=Nz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=Bz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=fz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=rz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=zu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.p(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=Yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.p(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,u,Y,H){const E=new g;return this.particleEmitterType=E,this.direction1=z,this.direction2=u,this.minEmitBox=Y,this.maxEmitBox=H,E}get flowMap(){return this._flowMap}set flowMap(z){this._flowMap!==z&&(this._flowMap=z)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Tu.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Tu.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Tu.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";z?setTimeout((()=>{this.start(0)}),z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._customWrappers[u])||void 0===z?void 0:z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[z]??this._customWrappers[0]}setCustomEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new zz.e(this._engine),this._customWrappers[u].effect=z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new N.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(z,u,Y){return super._removeGradientAndTexture(z,u,Y),this._releaseBuffers(),this}addColorGradient(z,u){this._colorGradients||(this._colorGradients=[]);const Y=new j(z,u);return this._colorGradients.push(Y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(z&&this._colorGradients.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(z){return this._removeGradientAndTexture(z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const u in this._drawWrappers){var z;null===(z=this._drawWrappers[u].drawContext)||void 0===z||z.reset()}}_addFactorGradient(z,u,Y){const H=new P(u,Y);z.push(H),this._releaseBuffers()}addSizeGradient(z,u){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,z,u),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(z){return this._removeGradientAndTexture(z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(z,u){if(!z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&z.sort(((z,u)=>z.gradient<u.gradient?-1:z.gradient>u.gradient?1:0));const Y=this;Y[u]&&(Y[u].dispose(),Y[u]=null)}addAngularSpeedGradient(z,u){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,z,u),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(z){return this._removeGradientAndTexture(z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(z,u){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,z,u),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(z){return this._removeGradientAndTexture(z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(z,u){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,z,u),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(z){return this._removeGradientAndTexture(z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(z,u){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,z,u),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(z){return this._removeGradientAndTexture(z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.fl=new N.e,this.onStoppedObservable=new N.e,this.onStartedObservable=new N.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=H.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.QM.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,T.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,T.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,T.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,T.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new zz.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new zz.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(u=u??{}).randomTextureSize||delete u.randomTextureSize;const l={vY:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...u},b=u;isFinite(b)&&(l.vY=b),this._capacity=l.vY,this._maxActiveParticleCount=l.vY,this._currentActiveCount=0,this._isAnimationSheetEnabled=J,this.particleEmitterType=new g;const L=Math.min(this._engine.getCaps().maxTextureSize,l.randomTextureSize);let D=[];for(let H=0;H<L;++H)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture=new B.e(new Float32Array(D),L,1,5,Y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,D=[];for(let H=0;H<L;++H)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture2=new B.e(new Float32Array(D),L,1,5,Y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=L}_reset(){this._releaseBuffers()}_createVertexBuffers(z,u,Y){const H={};H.position=u.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;H.age=u.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,H.size=u.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,H.life=u.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===Tu.BILLBOARDMODE_STRETCHED&&(H.direction=u.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof W&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(H.color=u.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(H.initialDirection=u.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(H.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),H.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),H.angle=u.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(H.cellIndex=u.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(H.cellStartOffset=u.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),H.offset=Y.createVertexBuffer("offset",0,2),H.uv=Y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(H),this._platform.createVertexBuffers(z,H),this.resetDrawCache()}_initialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!z)return;const u=this._engine,Y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof W&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof W,J=H.i.Pl[0];let l=0;for(let H=0;H<this._capacity;H++)if(Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(H,null,J),Y.push(J.x),Y.push(J.y),Y.push(J.z)):(Y.push(0),Y.push(0),Y.push(0)),this._platform.alignDataInBuffer&&Y.push(0),l+=16,E&&(this.particleEmitterType.particlePositionGenerator(H,null,J),Y.push(J.x),Y.push(J.y),Y.push(J.z),this._platform.alignDataInBuffer&&Y.push(0),l+=4),this._colorGradientsTexture||(Y.push(0),Y.push(0),Y.push(0),Y.push(0),l+=4),this.isBillboardBased||(Y.push(0),Y.push(0),Y.push(0),this._platform.alignDataInBuffer&&Y.push(0),l+=4),this.noiseTexture&&(Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),l+=8),Y.push(0),l+=1,this._angularSpeedGradientsTexture||(Y.push(0),l+=1),this._isAnimationSheetEnabled&&(Y.push(0),l+=1,this.spriteRandomStartCell&&(Y.push(0),l+=1)),this._platform.alignDataInBuffer){let z=3-(l+3&3);for(l+=z;z-- >0;)Y.push(0)}const T=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),b=this._platform.createParticleBuffer(Y),L=this._platform.createParticleBuffer(Y);this._buffer0=new Z.d(u,b,!1,this._attributesStrideSize),this._buffer1=new Z.d(u,L,!1,this._attributesStrideSize),this._spriteBuffer=new Z.d(u,T,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(z+="\n#define DRAGGRADIENTS"),this._flowMap&&(z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(z+="\n#define NOISE"),this.isLocal&&(z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===z||(this._cachedUpdateDefines=z,this._updateBuffer=this._platform.createUpdateBuffer(z)),this._platform.isUpdateBufferReady()}_getWrapper(z){const u=this._getCustomDrawWrapper(z);if(null!==u&&void 0!==u&&u.effect)return u;const Y=[];this.fillDefines(Y,z);let H=this._drawWrappers[z];H||(H=new zz.e(this._engine),H.drawContext&&(H.drawContext.useInstancing=!0),this._drawWrappers[z]=H);const E=Y.join("\n");if(H.defines!==E){const z=[],u=[],Y=[];this.fillUniformsAttributesAndSamplerNames(u,z,Y),H.setEffect(this._engine.createEffect("gpuRenderParticles",z,u,Y,E),E)}return H}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[Z.f.PositionKind,"age","life","size","angle"];return z||E.push(Z.f.ColorKind),u&&E.push("cellIndex"),Y||E.push("initialDirection"),H&&E.push("direction"),E.push("offset",Z.f.UVKind),E}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["emitterWM","AL","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,uz.b)(H),z&&H.push("sheetInfos"),u&&H.push("logarithmicDepthConstant"),Y&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uz.l)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Lu.d.FOGMODE_NONE&&z.push("#define FOG")),u===Tu.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&z.push("#define LOCAL"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case Tu.BILLBOARDMODE_Y:z.push("#define BILLBOARDY");break;case Tu.BILLBOARDMODE_STRETCHED:z.push("#define BILLBOARDSTRETCHED");break;case Tu.BILLBOARDMODE_ALL:z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,u,Y){u.push(...tu._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Tu.BILLBOARDMODE_STRETCHED)),z.push(...tu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(bu.e.PrepareUniforms(z,this._imageProcessingConfigurationDefines),bu.e.PrepareSamplers(Y,this._imageProcessingConfigurationDefines))}animate(){var z;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(u?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(z,u){const Y=this[u];if(!z||!z.length||Y)return;const H=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const u=E/this._rawTextureWidth;e.GetCurrentGradient(u,z,((z,u,Y)=>{H[E]=(0,L.Lerp)(z.factor1,u.factor1,Y)}))}this[u]=B.e.CreateRTexture(H,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[u].name=u.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const z=new Uint8Array(4*this._rawTextureWidth),u=l.g.zb[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const H=Y/this._rawTextureWidth;e.GetCurrentGradient(H,this._colorGradients,((H,E,J)=>{l.e.LerpToRef(H.color1,E.color1,J,u),z[4*Y]=255*u.r,z[4*Y+1]=255*u.g,z[4*Y+2]=255*u.b,z[4*Y+3]=255*u.a}))}this._colorGradientsTexture=B.e.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(z,u){var Y,E,J,l;const T=this._getWrapper(z),b=T.effect;this._engine.enableEffect(T);const L=(null===(Y=this._scene)||void 0===Y?void 0:Y.getViewMatrix())||H.b.IdentityReadOnly;if(b.setMatrix("view",L),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),b.setTexture("diffuseSampler",this.particleTexture),b.setVector2("translationPivot",this.translationPivot),b.setVector3("AL",this.AL),this.isLocal&&b.setMatrix("emitterWM",u),this._colorGradientsTexture?b.setTexture("colorGradientSampler",this._colorGradientsTexture):b.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();b.setFloat3("sheetInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;b.setVector3("eyePosition",z.globalPosition)}const D=b.defines;if(this._scene&&((0,uz.f)(b,this,this._scene),this.applyFog&&(0,Yz.f)(this._scene,void 0,b)),D.indexOf("#define BILLBOARDMODE_ALL")>=0){const z=L.clone();z.invert(),b.setMatrix("invView",z)}return this.useLogarithmicDepth&&this._scene&&(0,Yz.h)(D,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(z),this._platform.bindDrawBuffers(this._targetIndex,b,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(l=this._scene)&&void 0!==l&&l.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(z){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!z)if(this.k.position){z=this.k.getWorldMatrix()}else{const u=this.k;z=H.i.Matrix[0],H.b.TranslationToRef(u.x,u.y,u.z,z)}const u=this._engine,Y=u.getDepthWrite();if(u.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const z=this.iz();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,u.setDepthWrite(Y)}render(){let z,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!u&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let z=0;z<this.preWarmCycles;z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const z=0|this._accumulatedCount;this._accumulatedCount-=z,this._currentActiveCount+=z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){z=this.k.getWorldMatrix()}else{const u=this.k;z=H.i.Matrix[0],H.b.TranslationToRef(u.x,u.y,u.z,z)}const E=this._engine;this.updateInAnimate||this._update(z);let J=0;return u||Y||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),J=this.blendMode===Tu.BLENDMODE_MULTIPLYADD?this._render(Tu.BLENDMODE_MULTIPLY,z)+this._render(Tu.BLENDMODE_ADD,z):this._render(this.blendMode,z),this._engine.setAlphaMode(0)),J}rebuild(){const z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const u in this._drawWrappers){this._drawWrappers[u].dispose()}if(this._drawWrappers={},this._scene){const z=this._scene.QM.indexOf(this);z>-1&&this._scene.QM.splice(z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let u=0;u<this._renderVertexBuffers.length;++u){const z=this._renderVertexBuffers[u];for(const u in z)z[u].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.fl.notifyObservers(this),this.fl.clear()}clone(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let E=null;const J=this._engine;if(J.createEffectForParticles&&null!=this.customShader){E=this.customShader;const z=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";H[0]=J.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,z,void 0,void 0,void 0,this)}const l=this.serialize(Y),T=tu.Parse(l,this._scene||this._engine,this._rootUrl);return T.name=z,T.customShader=E,T._customWrappers=H,void 0===u&&(u=this.k),this.noiseTexture&&(T.noiseTexture=this.noiseTexture.clone()),T.k=u,T}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return Tu._Serialize(u,this,z),u.activeParticleCount=this.activeParticleCount,u.randomTextureSize=this._randomTextureSize,u.customShader=this.customShader,u}static Parse(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const J=z.name;let l,T;u instanceof Pz.e?l=u:(T=u,l=T.getEngine());const b=new tu(J,{vY:E||z.vY,randomTextureSize:z.randomTextureSize},u,null,z.isAnimationSheetEnabled);if(b._rootUrl=Y,z.customShader&&l.createEffectForParticles){const u=z.customShader,Y=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",H=l.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,Y,void 0,void 0,void 0,b);b.setCustomEffect(H,0),b.customShader=u}return z.id&&(b.id=z.id),z.activeParticleCount&&(b.activeParticleCount=z.activeParticleCount),Tu._Parse(z,b,u,Y),z.preventAutoStart&&(b.preventAutoStart=z.preventAutoStart),H||b.preventAutoStart||b.start(),b}}var Wu=Y(10945),Zu=Y(12204),su=Y(11616);class vu{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const u of this.systems)u.k=z;this._emitterNode=z}setEmitterAsSphere(z,u,Y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:z,renderingGroupId:u};const H=(0,Zu.d)("emitterSphere",{diameter:z.diameter,segments:z.segments},Y);H.renderingGroupId=u;const E=new su.e("emitterSphereMaterial",Y);E.emissiveColor=z.color,H.material=E;for(const J of this.systems)J.k=H;this._emitterNode=H}start(z){for(const u of this.systems)z&&(u.k=z),u.start()}dispose(){for(const z of this.systems)z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={systems:[]};for(const Y of this.systems)u.systems.push(Y.serialize(z));return this._emitterNode&&(u.k=this._emitterCreationOptions),u}static Parse(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;const E=new vu,J=this.BaseAssetsUrl+"/textures/";u=u||f.d.LastCreatedScene;for(const l of z.systems)E.systems.push(Y?tu.Parse(l,u,J,!0,H):Tu.Parse(l,u,J,!0,H));if(z.k){const Y=z.k.options;if("Sphere"===z.k.kind)E.setEmitterAsSphere({diameter:Y.diameter,segments:Y.segments,color:l.c.Nl(Y.color)},z.k.renderingGroupId,u)}return E}}vu.BaseAssetsUrl="https://assets.babylonjs.com/particles";var iu=Y(10972);class Xu{static CreateDefault(z){let u,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,H=arguments.length>2?arguments[2]:void 0;u=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new tu("default system",{vY:Y},H):new Tu("default system",Y,H),u.k=z;const E=Wu.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return u.particleTexture=new w.b(E,u.iz()),u.createConeEmitter(.1,Math.PI/4),u.color1=new l.e(1,1,1,1),u.color2=new l.e(1,1,1,1),u.colorDead=new l.e(1,1,1,0),u.minSize=.1,u.maxSize=.1,u.minEmitPower=2,u.maxEmitPower=2,u.updateSpeed=1/60,u.emitRate=30,u}static CreateAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;u||(u=f.d.LastCreatedScene);const E={};return u.addPendingData(E),new Promise(((J,l)=>{if(Y&&!tu.IsSupported)return u.removePendingData(E),l("Particle system with GPU is not supported.");Wu.e.LoadFile(`${Xu.BaseAssetsUrl}/systems/${z}.json`,(z=>{u.removePendingData(E);const l=JSON.parse(z.toString());return J(vu.Parse(l,u,Y,H))}),void 0,void 0,void 0,(()=>(u.removePendingData(E),l(`An error occurred with the creation of your particle system. Check if your type '${z}' exists.`))))}))}static ExportSet(z){const u=new vu;for(const Y of z)u.systems.push(Y);return u}static ParseFromFileAsync(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",J=arguments.length>5?arguments[5]:void 0;return new Promise(((l,T)=>{const b=new iu.d;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const u=JSON.parse(b.responseText);let T;T=H?tu.Parse(u,Y,E,!1,J):Tu.Parse(u,Y,E,!1,J),z&&(T.name=z),l(T)}else T("Unable to load the particle system")})),b.open("GET",u),b.send()}))}static ParseFromSnippetAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===z){const z=this.CreateDefault(null);return z.start(),Promise.resolve(z)}return new Promise(((J,l)=>{const T=new iu.d;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const l=JSON.parse(JSON.parse(T.responseText).jsonPayload),b=JSON.parse(l.particleSystem);let L;L=Y?tu.Parse(b,u,H,!1,E):Tu.Parse(b,u,H,!1,E),L.snippetId=z,J(L)}else l("Unable to load the snippet "+z)})),T.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),T.send()}))}}Xu.BaseAssetsUrl=vu.BaseAssetsUrl,Xu.SnippetUrl="https://snippet.babylonjs.com",Xu.CreateFromSnippetAsync=Xu.ParseFromSnippetAsync;var Qu=Y(11267),Vu=Y(11320),Au=Y(12206);(0,Au.h)(Vu.c.NAME_PARTICLESYSTEM,((z,u,Y,H)=>{const E=(0,Au.l)(Vu.c.NAME_PARTICLESYSTEM);if(E&&void 0!==z.QM&&null!==z.QM)for(let J=0,l=z.QM.length;J<l;J++){const l=z.QM[J];Y.QM.push(E(l,u,H))}})),(0,Au.d)(Vu.c.NAME_PARTICLESYSTEM,((z,u,Y)=>{if(z.activeParticleCount){return tu.Parse(z,u,Y)}return Tu.Parse(z,u,Y)})),Pz.e.prototype.createEffectForParticles=function(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",J=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0,b=arguments.length>7?arguments[7]:void 0,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,g=[],M=[];const q=[];return b?b.fillUniformsAttributesAndSamplerNames(M,g,q):(g=Tu._GetAttributeNamesOrOptions(),M=Tu._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==b&&void 0!==b&&b.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===H.indexOf("diffuseSampler")&&H.push("diffuseSampler"),this.createEffect({vertex:D??(null===b||void 0===b?void 0:b.vertexShaderName)??"particles",fragmentElement:z},g,M.concat(u),q.concat(H),E,J,l,T,void 0,L,(async()=>{0===L?await Promise.resolve().then(Y.bind(Y,12240)):await Promise.resolve().then(Y.bind(Y,12293))}))},Qu.b.prototype.getEmittedParticleSystems=function(){const z=[];for(let u=0;u<this.iz().QM.length;u++){const Y=this.iz().QM[u];Y.k===this&&z.push(Y)}return z},Qu.b.prototype.getHierarchyEmittedParticleSystems=function(){const z=[],u=this.getDescendants();u.push(this);for(let Y=0;Y<this.iz().QM.length;Y++){const H=this.iz().QM[Y],E=H.k;E.position&&-1!==u.indexOf(E)&&z.push(H)}return z};Y(11131),Y(11144),Y(11229);Y(11231),Y(12213),Y(11256),Y(11098),Y(11316);Y(11386);var xu;Y(12221),Y(11397);!function(z){z[z.Color=2]="Color",z[z.UV=1]="UV",z[z.Random=0]="Random",z[z.Stated=3]="Stated"}(xu||(xu={}));var Gu=Y(11408);const Fu=new H.p(0,0,0),Ru=new H.p(0,0,0),wu=new H.p(0,0,0);class cu{constructor(z,u,Y){this.width=z,this.height=u,this.data=Y}processFlowable(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;if(!Y)return;Y instanceof H.b?H.p.TransformCoordinatesToRef(z.position,Y,wu):(wu.x=Y.x,wu.y=Y.y,wu.z=Y.z);const E=.5*wu.x+.5,J=1-(.5*wu.y+.5),l=Math.floor(E*this.width),T=Math.floor(J*this.height);if(l<0||l>=this.width||T<0||T>=this.height)return;const b=4*(T*this.width+l),L=this.data[b]/255*2-1,D=this.data[b+1]/255*2-1,g=this.data[b+2]/255*2-1,M=this.data[b+3]/255;Fu.set(L,D,g),Fu.scaleToRef(u*M,Ru),z.direction.addInPlace(Ru)}_processParticle(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;this.processFlowable(z,u,Y)}static async FromUrlAsync(z){return await new Promise(((u,Y)=>{const H=document.createElement("canvas"),E=H.getContext("2d");let J=null;const l=new Image;l.crossOrigin="anonymous",l.src=z,l.onerror=u=>{Y(new Error(`Failed to load image: ${z} : ${u}`))},l.onload=()=>{H.width=l.width,H.height=l.height,E.drawImage(l,0,0),J=E.getImageData(0,0,H.width,H.height),u(new cu(H.width,H.height,J.data))}}))}static async ExtractFromTextureAsync(z){return await new Promise(((u,Y)=>{if(!z.isReady())return void z.onLoadObservable.addOnce((async()=>{try{const Y=await this.ExtractFromTextureAsync(z);u(Y)}catch(H){Y(H)}}));const H=z.getSize();Gu.j.GetTextureDataAsync(z,H.width,H.height).then((z=>{u(new cu(H.width,H.height,new Uint8ClampedArray(z)))})).catch(Y)}))}}var Uu,Ou,nu,mu,pu,Su,Iu,yu,au;!function(z){z[z.Int=1]="Int",z[z.Float=2]="Float",z[z.Vector2=4]="Vector2",z[z.Pl=8]="Pl",z[z.Matrix=16]="Matrix",z[z.Particle=32]="Particle",z[z.Texture=64]="Texture",z[z.zb=128]="zb",z[z.FloatGradient=256]="FloatGradient",z[z.Vector2Gradient=512]="Vector2Gradient",z[z.Vector3Gradient=1024]="Vector3Gradient",z[z.Color4Gradient=2048]="Color4Gradient",z[z.System=4096]="System",z[z.AutoDetect=8192]="AutoDetect",z[z.BasedOnInput=16384]="BasedOnInput",z[z.Undefined=32768]="Undefined",z[z.All=65535]="All"}(Uu||(Uu={})),function(z){z[z.Compatible=0]="Compatible",z[z.TypeIncompatible=1]="TypeIncompatible",z[z.HierarchyIssue=2]="HierarchyIssue"}(Ou||(Ou={})),function(z){z[z.Input=0]="Input",z[z.Output=1]="Output"}(nu||(nu={}));class ju{get direction(){return this._direction}get type(){if(this._type===Uu.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Uu.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(z){this._type=z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((z=>z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(z,u,Y){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Uu.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new N.e,this.onDisconnectionObservable=new N.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=u,this.name=z,this._direction=Y}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(z){var u;return this.isConnected?null!==(u=this._connectedPoint)&&void 0!==u&&u._storedFunction?this._connectedPoint._storedFunction(z):this._connectedPoint._storedValue:this.value}canConnectTo(z){return 0===this.checkCompatibilityState(z)}checkCompatibilityState(z){const u=this._ownerBlock,Y=z.ownerBlock;if(this.type!==z.type&&z.innerType!==Uu.AutoDetect)return z.acceptedConnectionPointTypes&&-1!==z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(z.excludedConnectionPointTypes&&-1!==z.excludedConnectionPointTypes.indexOf(this.type))return 1;let H=Y,E=u;return 0===this.direction&&(H=u,E=Y),H.isAnAncestorOf(E)?2:0}connectTo(z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${z.ownerBlock.name}".${z.name}`;return this._endpoints.push(z),z._connectedPoint=this,this.onConnectionObservable.notifyObservers(z),z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(z){const u=this._endpoints.indexOf(z);return-1===u||(this._endpoints.splice(u,1),z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(z),z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(z){let u=1;for(;u<Uu.All;)z&u||this.excludedConnectionPointTypes.push(u),u<<=1}serialize(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u={};return u.name=this.name,u.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.al?(u.valueType="BABYLON."+this.value.getClassName(),u.value=this.value.al()):(u.valueType="number",u.value=this.value)),z&&this.connectedPoint&&(u.inputName=this.name,u.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,u.targetConnectionName=this.connectedPoint.name,u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),u}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ku{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(z){this._name=z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new N.e,this.fl=new N.e,this.onInputChangedObservable=new N.e,this.visibleOnFrame=!1,this._name=z,this.uniqueId=c.b.UniqueId}_inputRename(z){return z}_outputRename(z){return z}isAnAncestorOf(z){for(const u of this._outputs)if(u.hasEndpoints)for(const Y of u.endpoints){if(Y.ownerBlock===z)return!0;if(Y.ownerBlock.isAnAncestorOf(z))return!0}return!1}isAnAncestorOfType(z){if(this.getClassName()===z)return!0;for(const u of this._outputs)if(u.hasEndpoints)for(const Y of u.endpoints)if(Y.ownerBlock.isAnAncestorOfType(z))return!0;return!1}getInputByName(z){const u=this._inputs.filter((u=>u.name===z));return u.length?u[0]:null}_linkConnectionTypes(z,u){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[u]._acceptedConnectionPointType=this._inputs[z]:(this._inputs[z]._linkedConnectionSource=this._inputs[u],this._inputs[z]._isMainLinkSource=!0),this._inputs[u]._linkedConnectionSource=this._inputs[z]}registerInput(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0;const l=new ju(z,this,0);return l.type=u,l.isOptional=Y,l.defaultValue=H,l.value=H,l.valueMin=E,l.valueMax=J,this._inputs.push(l),this.onInputChangedObservable.notifyObservers(l),this}registerOutput(z,u,Y){return(Y=Y??new ju(z,this,1)).type=u,this._outputs.push(Y),this}_build(z){}_customBuildStep(z){}build(z){if(this._buildId===z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((z=>z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=z.buildId;for(const u of this._inputs){if(!u.connectedPoint){u.isOptional||z.notConnectedNonOptionalInputs.push(u);continue}const Y=u.connectedPoint.ownerBlock;Y&&Y!==this&&!Y.isSystem&&Y.build(z)}return this._customBuildStep(z),z.verbose&&U.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const z={};z.customType="BABYLON."+this.getClassName(),z.id=this.uniqueId,z.name=this.name,z.visibleOnFrame=this.visibleOnFrame,z.inputs=[],z.outputs=[];for(const u of this.inputs)z.inputs.push(u.serialize());for(const u of this.outputs)z.outputs.push(u.serialize(!1));return z}_deserialize(z){this._name=z.name,this.comments=z.comments,this.visibleOnFrame=!!z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(z)}_deserializePortDisplayNamesAndExposedOnFrame(z){const u=z.inputs,Y=z.outputs;if(u)for(const H of u){const z=this.inputs.find((z=>z.name===H.name));if(!z)return;if(H.displayName&&(z.displayName=H.displayName),H.isExposedOnFrame&&(z.isExposedOnFrame=H.isExposedOnFrame,z.exposedPortPosition=H.exposedPortPosition),void 0!==H.value&&null!==H.value)if("number"===H.valueType)z.value=H.value;else{const u=(0,T.c)(H.valueType);u&&(z.value=u.Nl(H.value))}}if(Y)for(let H=0;H<Y.length;H++){const z=Y[H];z.displayName&&(this.outputs[H].displayName=z.displayName),z.isExposedOnFrame&&(this.outputs[H].isExposedOnFrame=z.isExposedOnFrame,this.outputs[H].exposedPortPosition=z.exposedPortPosition)}}clone(){const z=this.serialize(),u=(0,T.c)(z.customType);if(u){const Y=new u;return Y._deserialize(z),Y}return null}dispose(){this.fl.notifyObservers(this),this.fl.clear();for(const z of this.inputs)z.dispose();for(const z of this.outputs)z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Pu(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",H=arguments.length>3?arguments[3]:void 0;return(E,J)=>{let l=E._propStore;l||(l=[],E._propStore=l),l.push({propertyName:J,displayName:z,type:u,groupName:Y,options:H??{},className:E.getClassName()})}}(0,G.e)([(0,F.L)("comment")],ku.prototype,"comments",void 0),function(z){z[z.Boolean=0]="Boolean",z[z.Float=1]="Float",z[z.Int=2]="Int",z[z.Vector2=3]="Vector2",z[z.List=4]="List",z[z.zb=5]="zb",z[z.SamplingMode=6]="SamplingMode",z[z.TextureFormat=7]="TextureFormat",z[z.TextureType=8]="TextureType"}(mu||(mu={})),function(z){z[z.None=0]="None",z[z.Position=1]="Position",z[z.Direction=2]="Direction",z[z.Age=3]="Age",z[z.Lifetime=4]="Lifetime",z[z.Color=5]="Color",z[z.ScaledDirection=6]="ScaledDirection",z[z.Scale=7]="Scale",z[z.AgeGradient=8]="AgeGradient",z[z.Angle=9]="Angle",z[z.SpriteCellIndex=16]="SpriteCellIndex",z[z.SpriteCellStart=17]="SpriteCellStart",z[z.SpriteCellEnd=18]="SpriteCellEnd"}(pu||(pu={})),function(z){z[z.None=0]="None",z[z.Time=1]="Time",z[z.Delta=2]="Delta",z[z.Emitter=3]="Emitter"}(Su||(Su={}));class eu{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let z="";for(const u of this.notConnectedNonOptionalInputs)z+=`input ${u.name} from block ${u.ownerBlock.name}[${u.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(z)throw"Build of Node Particle System Set failed:\n"+z}adapt(z,u){const Y=z.getConnectedValue(this)||0;if(z.type===u)return Y;switch(u){case Uu.Vector2:return new H.m(Y,Y);case Uu.Pl:return new H.p(Y,Y,Y);case Uu.zb:return new l.e(Y,Y,Y,Y)}return null}getContextualValue(z){if(!this.particleContext||!this.systemContext)return null;switch(z){case pu.Position:return this.particleContext.position;case pu.Direction:return this.particleContext.direction;case pu.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case pu.Color:return this.particleContext.color;case pu.Age:return this.particleContext.age;case pu.Lifetime:return this.particleContext.lifeTime;case pu.Angle:return this.particleContext.angle;case pu.Scale:return this.particleContext.scale;case pu.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case pu.SpriteCellEnd:return this.systemContext.endSpriteCellID;case pu.SpriteCellIndex:return this.particleContext.cellIndex;case pu.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(z){if(!this.particleContext||!this.systemContext)return null;switch(z){case Su.Time:return this.systemContext._actualFrame;case Su.Delta:return this.systemContext._scaledUpdateSpeed;case Su.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function Nu(z,u,Y){const H=new eu;H.Cu=u;const E=z.createSystem(H);return E.canStart=()=>!0,E.k=Y.clone(),E.disposeOnStop=!0,E.start(),E}class Bu extends ku{constructor(z){super(z),this.blendMode=b.BLENDMODE_ONEONE,this.vY=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Uu.Particle),this.registerInput("texture",Uu.Texture),this.registerInput("onStart",Uu.System,!0),this.registerInput("onEnd",Uu.System,!0),this.registerOutput("system",Uu.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(z){z.vY=this.vY,z.buildId=this._buildId++,this.build(z);const u=this.particle.getConnectedValue(z);return u.particleTexture=this.texture.getConnectedValue(z),u.emitRate=this.emitRate,u.blendMode=this.blendMode,u.name=this.name,u._nodeGenerated=!0,u._targetStopDuration=this.targetStopDuration,u.startDelay=this.startDelay,this.system._storedValue=this,u.canStart=()=>!this.doNoStart,u.onStartedObservable.add((Y=>{const H=this.onStart.getConnectedValue(z);H&&Y.onStartedObservable.addOnce((()=>{z.systemContext=u;const Y=Nu(H,z.Cu,z.emitterPosition);this.fl.addOnce((()=>{Y.dispose()}))}));const E=this.onEnd.getConnectedValue(z);E&&Y.onStoppedObservable.addOnce((()=>{z.systemContext=u;const Y=Nu(E,z.Cu,z.emitterPosition);this.fl.addOnce((()=>{Y.dispose()}))}))})),this.fl.addOnce((()=>{u.dispose()})),u}serialize(){const z=super.serialize();return z.vY=this.vY,z.emitRate=this.emitRate,z.blendMode=this.blendMode,z.doNoStart=this.doNoStart,z.targetStopDuration=this.targetStopDuration,z.startDelay=this.startDelay,z}_deserialize(z){super._deserialize(z),this.vY=z.vY,this.emitRate=z.emitRate,this.doNoStart=!!z.doNoStart,void 0!==z.blendMode&&(this.blendMode=z.blendMode),void 0!==z.targetStopDuration&&(this.targetStopDuration=z.targetStopDuration),void 0!==z.startDelay&&(this.startDelay=z.startDelay)}}(0,G.e)([Pu("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:b.BLENDMODE_ONEONE},{label:"Standard",value:b.BLENDMODE_STANDARD},{label:"Add",value:b.BLENDMODE_ADD},{label:"Multiply",value:b.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:b.BLENDMODE_MULTIPLYADD}]})],Bu.prototype,"blendMode",void 0),(0,G.e)([Pu("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Bu.prototype,"vY",void 0),(0,G.e)([Pu("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bu.prototype,"emitRate",void 0),(0,G.e)([Pu("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bu.prototype,"targetStopDuration",void 0),(0,G.e)([Pu("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bu.prototype,"startDelay",void 0),(0,G.e)([Pu("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Bu.prototype,"doNoStart",void 0),(0,T.d)("BABYLON.SystemBlock",Bu);class fu extends ku{get type(){if(this._type===Uu.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Uu.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Uu.Vector2,this._type;case"Pl":return this._type=Uu.Pl,this._type;case"zb":return this._type=Uu.zb,this._type;case"Matrix":return this._type=Uu.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===pu.None&&this._systemSource!==Su.None}get systemSource(){return this._systemSource}set systemSource(z){if(this._systemSource=z,z!==Su.None){switch(this._contextualSource=pu.None,this._type=Uu.Float,z){case Su.Time:case Su.Delta:this._type=Uu.Float;break;case Su.Emitter:this._type=Uu.Pl}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==pu.None}get contextualValue(){return this._contextualSource}set contextualValue(z){if(this._contextualSource=z,z!==pu.None){switch(this._systemSource=Su.None,z){case pu.Scale:this._type=Uu.Vector2;break;case pu.Position:case pu.Direction:case pu.ScaledDirection:this._type=Uu.Pl;break;case pu.Color:this._type=Uu.zb;break;case pu.Age:case pu.Lifetime:case pu.Angle:case pu.AgeGradient:this._type=Uu.Float;break;case pu.SpriteCellEnd:case pu.SpriteCellStart:case pu.SpriteCellIndex:this._type=Uu.Int}this.output&&(this.output.type=this._type)}}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uu.AutoDetect;super(z),this._type=Uu.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new N.e,this._systemSource=Su.None,this._contextualSource=pu.None,this._type=u,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",u)}get value(){return this._storedValue}set value(z){this.type===Uu.Float&&this.min!==this.max&&(z=Math.max(this.min,z),z=Math.min(this.max,z)),this._storedValue=z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(z){this._valueCallback=z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Uu.Int:case Uu.Float:this.value=0;break;case Uu.Vector2:this.value=H.m.Zero();break;case Uu.Pl:this.value=H.p.Zero();break;case Uu.zb:this.value=new l.e(1,1,1,1);break;case Uu.Matrix:this.value=H.b.Identity()}}_build(z){super._build(z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=z=>z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=z=>z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const z=super.serialize();return z.type=this.type,z.contextualValue=this.contextualValue,z.systemSource=this.systemSource,z.min=this.min,z.max=this.max,z.groupInInspector=this.groupInInspector,z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.al?(z.valueType="BABYLON."+this._storedValue.getClassName(),z.value=this._storedValue.al()):(z.valueType="number",z.value=this._storedValue)),z}_deserialize(z){if(super._deserialize(z),this._type=z.type,this.contextualValue=z.contextualValue,this.systemSource=z.systemSource||Su.None,this.min=z.min||0,this.max=z.max||0,this.groupInInspector=z.groupInInspector||"",void 0!==z.displayInInspector&&(this.displayInInspector=z.displayInInspector),z.valueType)if("number"===z.valueType)this._storedValue=z.value;else{const u=(0,T.c)(z.valueType);u&&(this._storedValue=u.Nl(z.value))}}}(0,T.d)("BABYLON.ParticleInputBlock",fu);class ru extends ku{get url(){return this._url}set url(z){this._url!==z&&(this._cachedData=null,this._url=z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(z){this._textureDataUrl!==z&&(this._cachedData=null,this._textureDataUrl=z,this._url="",this._sourceTexture=null)}set sourceTexture(z){this._sourceTexture!==z&&(this._cachedData=null,this._sourceTexture=z,this._url="",this._textureDataUrl="")}constructor(z){super(z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Uu.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const z=this.texture._storedValue;return await new Promise(((u,Y)=>{if(!z.isReady())return void z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),u(this._cachedData)}catch(z){Y(z)}}));const H=z.getSize();Gu.j.GetTextureDataAsync(z,H.width,H.height).then((Y=>{this._cachedData={width:H.width,height:H.height,data:new Uint8ClampedArray(Y)},z.dispose(),u(this._cachedData)})).catch(Y)}))}_build(z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new w.b(this._textureDataUrl,z.Cu):this.texture._storedValue=new w.b(this._url,z.Cu):this.texture._storedValue=null}serialize(){const z=super.serialize();return z.url=this.url,z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(z.textureDataUrl=this.textureDataUrl),z}_deserialize(z){super._deserialize(z),this.url=z.url,this.serializedCachedData=!!z.serializedCachedData,z.textureDataUrl&&(this.textureDataUrl=z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,T.d)("BABYLON.ParticleTextureSourceBlock",ru);class zY extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("position",Uu.Pl),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.position.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.position.J(this.position.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}}(0,T.d)("BABYLON.UpdatePositionBlock",zY),function(z){z[z.Add=0]="Add",z[z.Subtract=1]="Subtract",z[z.Multiply=2]="Multiply",z[z.Divide=3]="Divide",z[z.Max=4]="Max",z[z.Min=5]="Min"}(Iu||(Iu={}));class uY extends ku{constructor(z){super(z),this.operation=Iu.Add,this.registerInput("left",Uu.AutoDetect),this.registerInput("right",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this.output._typeConnectionSource=this.left;const u=[Uu.Matrix,Uu.Particle,Uu.Texture,Uu.System,Uu.FloatGradient,Uu.Color4Gradient,Uu.Vector2Gradient,Uu.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...u),this.right.excludedConnectionPointTypes.push(...u),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(z){let u;const Y=this.left,E=this.right;if(!Y.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const J=Y.type===Uu.Float||Y.type===Uu.Int,T=E.type===Uu.Float||E.type===Uu.Int,b=J&&T;switch(this.operation){case Iu.Add:u=b?z=>Y.getConnectedValue(z)+E.getConnectedValue(z):J?z=>z.adapt(Y,E.type).add(E.getConnectedValue(z)):z=>Y.getConnectedValue(z).add(z.adapt(E,Y.type));break;case Iu.Subtract:u=b?z=>Y.getConnectedValue(z)-E.getConnectedValue(z):J?z=>z.adapt(Y,E.type).JY(E.getConnectedValue(z)):z=>Y.getConnectedValue(z).JY(z.adapt(E,Y.type));break;case Iu.Multiply:u=b?z=>Y.getConnectedValue(z)*E.getConnectedValue(z):J?z=>z.adapt(Y,E.type).multiply(E.getConnectedValue(z)):z=>Y.getConnectedValue(z).multiply(z.adapt(E,Y.type));break;case Iu.Divide:u=b?z=>Y.getConnectedValue(z)/E.getConnectedValue(z):J?z=>z.adapt(Y,E.type).divide(E.getConnectedValue(z)):z=>Y.getConnectedValue(z).divide(z.adapt(E,Y.type));break;case Iu.Min:if(b)u=z=>Math.min(Y.getConnectedValue(z),E.getConnectedValue(z));else{const[z,T]=J?[E,Y]:[Y,E];switch(z.type){case Uu.Vector2:u=u=>H.m.Minimize(z.getConnectedValue(u),u.adapt(T,z.type));break;case Uu.Pl:u=u=>H.p.Minimize(z.getConnectedValue(u),u.adapt(T,z.type));break;case Uu.zb:u=u=>{const Y=z.getConnectedValue(u),{r:H,g:E,b:J,a:b}=u.adapt(T,z.type);return new l.e(Math.min(Y.r,H),Math.min(Y.g,E),Math.min(Y.b,J),Math.min(Y.a,b))}}}break;case Iu.Max:if(!b){const[z,T]=J?[E,Y]:[Y,E];switch(z.type){case Uu.Vector2:u=u=>H.m.Maximize(z.getConnectedValue(u),u.adapt(T,z.type));break;case Uu.Pl:u=u=>H.p.Maximize(z.getConnectedValue(u),u.adapt(T,z.type));break;case Uu.zb:u=u=>{const Y=z.getConnectedValue(u),{r:H,g:E,b:J,a:b}=u.adapt(T,z.type);return new l.e(Math.max(Y.r,H),Math.min(Y.g,E),Math.min(Y.b,J),Math.min(Y.a,b))}}break}u=z=>Math.max(Y.getConnectedValue(z),E.getConnectedValue(z))}this.output._storedFunction=z=>Y.type===Uu.Int?0|u(z):u(z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Uu.Int||this.left.type===Uu.Float&&this.right.type!==Uu.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[z,u]of[[this.left,this.right],[this.right,this.left]])z.acceptedConnectionPointTypes=[Uu.Int,Uu.Float],u.isConnected&&(z.acceptedConnectionPointTypes.push(u.type),u.type!==Uu.Int&&u.type!==Uu.Float||z.acceptedConnectionPointTypes.push(Uu.Vector2,Uu.Pl,Uu.zb))}dispose(){super.dispose();for(const z of this._connectionObservers)z.remove();this._connectionObservers.length=0}serialize(){const z=super.serialize();return z.operation=this.operation,z}_deserialize(z){super._deserialize(z),this.operation=z.operation}}(0,G.e)([Pu("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Iu.Add},{label:"Subtract",value:Iu.Subtract},{label:"Multiply",value:Iu.Multiply},{label:"Divide",value:Iu.Divide},{label:"Max",value:Iu.Max},{label:"Min",value:Iu.Min}]})],uY.prototype,"operation",void 0),(0,T.d)("BABYLON.ParticleMathBlock",uY);class YY extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("direction1",Uu.Pl,!0,new H.p(0,1,0)),this.registerInput("direction2",Uu.Pl,!0,new H.p(0,1,0)),this.registerInput("minEmitBox",Uu.Pl,!0,new H.p(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Uu.Pl,!0,new H.p(.5,.5,.5)),this.registerOutput("output",Uu.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.direction1.getConnectedValue(z),J=this.direction2.getConnectedValue(z),l=(0,L.RandomRange)(E.x,J.x),T=(0,L.RandomRange)(E.y,J.y),b=(0,L.RandomRange)(E.z,J.z);z.isEmitterTransformNode?H.p.TransformNormalFromFloatsToRef(l,T,b,z.emitterWorldMatrix,Y.direction):Y.direction.kl(l,T,b)},u._positionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.minEmitBox.getConnectedValue(z),J=this.maxEmitBox.getConnectedValue(z),l=(0,L.RandomRange)(E.x,J.x),T=(0,L.RandomRange)(E.y,J.y),b=(0,L.RandomRange)(E.z,J.z);z.isEmitterTransformNode?H.p.TransformCoordinatesFromFloatsToRef(l,T,b,z.emitterWorldMatrix,Y.position):(Y.position.kl(l,T,b),Y.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}}(0,T.d)("BABYLON.BoxShapeBlock",YY);class HY extends ku{constructor(z){super(z),this.registerInput("emitPower",Uu.Float,!0,1),this.registerInput("lifeTime",Uu.Float,!0,1),this.registerInput("color",Uu.zb,!0,new l.e(1,1,1,1)),this.registerInput("scale",Uu.Vector2,!0,new H.m(1,1)),this.registerInput("angle",Uu.Float,!0,0),this.registerOutput("particle",Uu.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(z){const u=new Tu(this.name,z.vY,z.Cu,null,!1,void 0,!0);u.particleEmitterType=new o,u._lifeTimeCreation.process=(u,Y)=>{z.particleContext=u,u.lifeTime=this.lifeTime.getConnectedValue(z),Y._emitPower=this.emitPower.getConnectedValue(z)},u._colorCreation.process=u=>{z.particleContext=u,u.color.J(this.color.getConnectedValue(z))},u._sizeCreation.process=u=>{z.particleContext=u,u.size=1,u.scale.J(this.scale.getConnectedValue(z))},u._angleCreation.process=u=>{z.particleContext=u,u.angle=this.angle.getConnectedValue(z)},this.particle._storedValue=u}}(0,T.d)("BABYLON.CreateParticleBlock",HY);class EY{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const z=[];for(const u of this.attachedBlocks)u.isInput&&z.push(u);return z}constructor(z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new N.e,this.name=z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(z)&&this.attachedBlocks.push(z);for(const Y of z.inputs){const H=Y.connectedPoint;if(H){const Y=H.ownerBlock;Y!==z&&this._initializeBlock(Y,u)}}}async buildAsync(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Y=>{const H=new vu;for(const z of this._systemBlocks)this._initializeBlock(z);for(const E of this.systemBlocks){const Y=new eu;Y.buildId=this._buildId++,Y.Cu=z,Y.verbose=u;const J=E.createSystem(Y);Y.emitErrors(),H.systems.push(J)}this.onBuildObservable.notifyObservers(this),Y(H)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const z=new Bu("Particle system"),u=new zY("Update position");u.output.connectTo(z.particle);const Y=new fu("Position");Y.contextualValue=pu.Position;const H=new fu("Scaled direction");H.contextualValue=pu.ScaledDirection;const E=new uY("Add");E.operation=Iu.Add,Y.output.connectTo(E.left),H.output.connectTo(E.right),E.output.connectTo(u.position);const J=new HY("Create particle"),l=new YY("Box shape");J.particle.connectTo(l.particle),l.output.connectTo(u.particle);const T=new ru("Texture");T.texture.connectTo(z.texture),T.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(z)}removeBlock(z){const u=this.attachedBlocks.indexOf(z);if(u>-1&&this.attachedBlocks.splice(u,1),z.isSystem){const u=this._systemBlocks.indexOf(z);u>-1&&this._systemBlocks.splice(u,1)}}parseSerializedObject(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u||this.clear();const Y={};for(const H of z.VD){const z=(0,T.c)(H.customType);if(z){const u=new z;u._deserialize(H),Y[H.id]=u,this.attachedBlocks.push(u),u.isSystem&&this._systemBlocks.push(u)}}for(const H of this.attachedBlocks)if(H.isTeleportOut){const z=H,u=z._tempEntryPointUniqueId;if(u){const H=Y[u];H&&H.attachToEndpoint(z)}}for(let H=0;H<z.VD.length;H++){const E=z.VD[H],J=Y[E.id];J&&(J.inputs.length&&E.inputs.some((z=>z.targetConnectionName))&&!u||this._restoreConnections(J,z,Y))}if(z.locations||z.editorData&&z.editorData.locations){const H=z.locations||z.editorData.locations;for(const z of H)Y[z.ME]&&(z.ME=Y[z.ME].uniqueId);u&&this.editorData&&this.editorData.locations&&H.concat(this.editorData.locations),z.locations?this.editorData={locations:H}:(this.editorData=z.editorData,this.editorData.locations=H);const E=[];for(const z in Y)E[z]=Y[z].uniqueId;this.editorData.map=E}this.comment=z.comment}_restoreConnections(z,u,Y){for(const H of z.outputs)for(const E of u.VD){const J=Y[E.id];if(J)for(const l of E.inputs)if(Y[l.targetBlockId]!==z||l.targetConnectionName!==H.name);else{const z=J.getInputByName(l.inputName);if(!z||z.isConnected)continue;H.connectTo(z,!0),this._restoreConnections(J,u,Y)}}}serialize(z){const u=z?{}:R.d.Serialize(this);u.editorData=JSON.parse(JSON.stringify(this.editorData));let Y=[];z?Y=z:u.customType="BABYLON.NodeParticleSystemSet",u.VD=[];for(const H of Y)u.VD.push(H.serialize());if(!z)for(const H of this.attachedBlocks)-1===Y.indexOf(H)&&u.VD.push(H.serialize());return u}dispose(){for(const z of this.attachedBlocks)z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(z){const u=new EY(z);return u.setToDefault(),u}static Parse(z){const u=R.d.Parse((()=>new EY(z.name)),z,null);return u.parseSerializedObject(z),u}static ParseFromSnippetAsync(z,u){return"_BLANK"===z?Promise.resolve(EY.CreateDefault("blank")):new Promise(((Y,H)=>{const E=new iu.d;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const l=JSON.parse(JSON.parse(E.responseText).jsonPayload),T=JSON.parse(l.nodeParticle);u||(u=R.d.Parse((()=>new EY(z)),T,null)),u.parseSerializedObject(T),u.snippetId=z;try{Y(u)}catch(J){H(J)}}else H("Unable to load the snippet "+z)})),E.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),E.send()}))}}EY.EditorURL=`${Wu.e._DefaultCdnUrl}/v${Pz.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,EY.SnippetUrl="https://snippet.babylonjs.com",(0,G.e)([(0,F.L)()],EY.prototype,"name",void 0),(0,G.e)([(0,F.L)("comment")],EY.prototype,"comment",void 0),function(z){z[z.None=0]="None",z[z.PerParticle=1]="PerParticle",z[z.PerSystem=2]="PerSystem"}(yu||(yu={}));class JY extends ku{constructor(z){super(z),this._currentLockId=-2,this.lockMode=yu.PerParticle,this.registerInput("min",Uu.AutoDetect,!0,0),this.registerInput("max",Uu.AutoDetect,!0,1),this.registerOutput("output",Uu.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Uu.Float|Uu.Int|Uu.Vector2|Uu.Pl|Uu.zb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Uu.Float|Uu.Int|Uu.Vector2|Uu.Pl|Uu.zb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Uu.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let z=null;switch(this._currentLockId=-2,this.min.type){case Uu.AutoDetect:case Uu.Int:case Uu.Float:z=z=>{const u=this.min.getConnectedValue(z)||0,Y=this.max.getConnectedValue(z)||1;return u+Math.random()*(Y-u)};break;case Uu.Vector2:z=z=>{const u=this.min.getConnectedValue(z)||H.m.Zero(),Y=this.max.getConnectedValue(z)||H.m.One();return new H.m(u.x+Math.random()*(Y.x-u.x),u.y+Math.random()*(Y.y-u.y))};break;case Uu.Pl:z=z=>{const u=this.min.getConnectedValue(z)||H.p.Zero(),Y=this.max.getConnectedValue(z)||H.p.One();return new H.p(u.x+Math.random()*(Y.x-u.x),u.y+Math.random()*(Y.y-u.y),u.z+Math.random()*(Y.z-u.z))};break;case Uu.zb:z=z=>{const u=this.min.getConnectedValue(z)||new l.e(0,0,0,0),Y=this.max.getConnectedValue(z)||new l.e(1,1,1,1);return new l.e(u.x+Math.random()*(Y.x-u.x),u.y+Math.random()*(Y.y-u.y),u.z+Math.random()*(Y.z-u.z),u.w+Math.random()*(Y.w-u.w))}}this.output._storedFunction=u=>{var Y;let H=0;switch(this.lockMode){case yu.PerParticle:H=(null===(Y=u.particleContext)||void 0===Y?void 0:Y.id)||-1;break;case yu.PerSystem:H=u.buildId||0}return this._currentLockId!==H&&(this.lockMode!==yu.None&&(this._currentLockId=H),this.output._storedValue=z(u)),this.output._storedValue}}serialize(){const z=super.serialize();return z.lockMode=this.lockMode,z}_deserialize(z){super._deserialize(z),this.lockMode=z.lockMode}}(0,G.e)([Pu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yu.None},{label:"Per particle",value:yu.PerParticle},{label:"Per system",value:yu.PerSystem}]})],JY.prototype,"lockMode",void 0),(0,T.d)("BABYLON.ParticleRandomBlock",JY);class lY extends ku{constructor(z){super(z),this._currentLockId=-2,this.lockMode=yu.PerParticle,this.registerInput("min",Uu.AutoDetect),this.registerInput("max",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const u=[Uu.Matrix,Uu.Particle,Uu.Texture,Uu.System,Uu.FloatGradient,Uu.Color4Gradient,Uu.Vector2Gradient,Uu.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...u),this.max.excludedConnectionPointTypes.push(...u)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let z=null;switch(this._currentLockId=-2,this.min.type){case Uu.Float:case Uu.Int:z=z=>{const u=this.min.getConnectedValue(z),Y=this.max.getConnectedValue(z);return Math.random()*(Y-u)+u};break;case Uu.Vector2:z=z=>{const u=this.min.getConnectedValue(z),Y=this.max.getConnectedValue(z);return new H.m(Math.random()*(Y.x-u.x)+u.x,Math.random()*(Y.y-u.y)+u.y)};break;case Uu.Pl:z=z=>{const u=this.min.getConnectedValue(z),Y=this.max.getConnectedValue(z);return new H.p(Math.random()*(Y.x-u.x)+u.x,Math.random()*(Y.y-u.y)+u.y,Math.random()*(Y.z-u.z)+u.z)};break;case Uu.zb:z=z=>{const u=this.min.getConnectedValue(z),Y=this.max.getConnectedValue(z);return new l.e(Math.random()*(Y.r-u.r)+u.r,Math.random()*(Y.g-u.g)+u.g,Math.random()*(Y.b-u.b)+u.b,Math.random()*(Y.a-u.a)+u.a)}}this.output._storedFunction=u=>{var Y;let H=0;switch(this.lockMode){case yu.PerParticle:H=(null===(Y=u.particleContext)||void 0===Y?void 0:Y.id)||-1;break;case yu.PerSystem:H=u.buildId||0}return this._currentLockId!==H&&(this.lockMode!==yu.None&&(this._currentLockId=H),this.output._storedValue=z(u)),this.output._storedValue}}serialize(){const z=super.serialize();return z.lockMode=this.lockMode,z}_deserialize(z){super._deserialize(z),void 0!==z.lockMode&&(this.lockMode=z.lockMode)}}(0,G.e)([Pu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yu.None},{label:"Per particle",value:yu.PerParticle},{label:"Per system",value:yu.PerSystem}]})],lY.prototype,"lockMode",void 0),(0,T.d)("BABYLON.RandomRangeBlock",lY);(0,T.d)("BABYLON.ParticleLerpBlock",class extends ku{constructor(z){super(z),this.registerInput("left",Uu.AutoDetect),this.registerInput("right",Uu.AutoDetect),this.registerInput("gradient",Uu.Float,!0,0,0,1),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Uu.Float|Uu.Int|Uu.Vector2|Uu.Pl|Uu.zb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=(z,u,Y)=>(1-z)*u+z*Y;this.output._storedFunction=u=>{const Y=this.left.getConnectedValue(u),E=this.right.getConnectedValue(u),J=this.gradient.getConnectedValue(u);switch(this.left.type){case Uu.Int:case Uu.Float:return z(J,Y,E);case Uu.Vector2:return new H.m(z(J,Y.x,E.x),z(J,Y.y,E.y));case Uu.Pl:return new H.p(z(J,Y.x,E.x),z(J,Y.y,E.y),z(J,Y.z,E.z));case Uu.zb:return new l.e(z(J,Y.r,E.r),z(J,Y.g,E.g),z(J,Y.b,E.b),z(J,Y.a,E.a))}return 0}}});(0,T.d)("BABYLON.UpdateDirectionBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("direction",Uu.Pl),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.direction.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.direction.J(this.direction.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}});(0,T.d)("BABYLON.UpdateColorBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("color",Uu.zb),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.color.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.color.J(this.color.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}});(0,T.d)("BABYLON.UpdateScaleBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("scale",Uu.Vector2),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.scale.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.scale.J(this.scale.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}});(0,T.d)("BABYLON.UpdateAngleBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("angle",Uu.Float),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.angle.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.angle=this.angle.getConnectedValue(z)},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}});(0,T.d)("BABYLON.BasicPositionUpdateBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(z){const u=this.particle.getConnectedValue(z),Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.direction.scaleToRef(u._directionScale,u._scaledDirection),Y.position.addInPlace(u._scaledDirection)},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y,this.output._storedValue=u}});(0,T.d)("BABYLON.BasicSpriteUpdateBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(z){const u=this.particle.getConnectedValue(z),Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.updateCellIndex()},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y,this.output._storedValue=u}});(0,T.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("cellIndex",Uu.Int),this.registerOutput("output",Uu.Particle),this.cellIndex.acceptedConnectionPointTypes=[Uu.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(z){const u=this.particle.getConnectedValue(z);if(this.output._storedValue=u,!this.cellIndex.isConnected)return;const Y={process:Y=>{z.particleContext=Y,z.systemContext=u,Y.cellIndex=Math.floor(this.cellIndex.getConnectedValue(z))},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y}});class TY extends ku{constructor(z){super(z),this.strength=1,this.registerInput("particle",Uu.Particle),this.registerInput("flowMap",Uu.Texture),this.registerOutput("output",Uu.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(z){var u;const Y=this.particle.getConnectedValue(z),H=z.Cu;let E;(null===(u=this.flowMap.connectedPoint)||void 0===u?void 0:u.ownerBlock).extractTextureContentAsync().then((z=>{z&&(E=new cu(z.width,z.height,z.data))}));const J={process:z=>{const u=H.getTransformMatrix();E&&E._processParticle(z,this.strength*Y._tempScaledUpdateSpeed,u)},previousItem:null,nextItem:null};Y._updateQueueStart?Sz(J,Y._updateQueueStart):Y._updateQueueStart=J,this.output._storedValue=Y}serialize(){const z=super.serialize();return z.strength=this.strength,z}_deserialize(z){super._deserialize(z),this.strength=z.strength}}(0,G.e)([Pu("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],TY.prototype,"strength",void 0),(0,T.d)("BABYLON.UpdateFlowMapBlock",TY);(0,T.d)("BABYLON.SphereShapeBlock",class extends ku{constructor(z){super(z),this.registerInput("input",Uu.Particle),this.registerInput("radius",Uu.Float,!0,1),this.registerInput("radiusRange",Uu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Uu.Float,!0,0,0,1),this.registerOutput("output",Uu.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(z){const u=this.input.getConnectedValue(z);u._directionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.directionRandomizer.getConnectedValue(z),J=Y.position.JY(z.emitterPosition).normalize(),l=(0,L.RandomRange)(0,E),T=(0,L.RandomRange)(0,E),b=(0,L.RandomRange)(0,E);J.x+=l,J.y+=T,J.z+=b,J.normalize(),z.isEmitterTransformNode?H.p.TransformNormalFromFloatsToRef(l,T,b,z.emitterWorldMatrix,Y.direction):Y.direction.kl(l,T,b)},u._positionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.radius.getConnectedValue(z),J=this.radiusRange.getConnectedValue(z),l=E-(0,L.RandomRange)(0,E*J),T=(0,L.RandomRange)(0,1),b=(0,L.RandomRange)(0,2*Math.PI),D=Math.acos(2*T-1),g=l*Math.cos(b)*Math.sin(D),M=l*Math.cos(D),q=l*Math.sin(b)*Math.sin(D);z.isEmitterTransformNode?H.p.TransformCoordinatesFromFloatsToRef(g,M,q,z.emitterWorldMatrix,Y.position):(Y.position.kl(g,M,q),Y.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});(0,T.d)("BABYLON.PointShapeBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("direction1",Uu.Pl,!0,new H.p(0,1,0)),this.registerInput("direction2",Uu.Pl,!0,new H.p(0,1,0)),this.registerOutput("output",Uu.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.direction1.getConnectedValue(z),J=this.direction2.getConnectedValue(z),l=(0,L.RandomRange)(E.x,J.x),T=(0,L.RandomRange)(E.y,J.y),b=(0,L.RandomRange)(E.z,J.z);z.isEmitterTransformNode?H.p.TransformNormalFromFloatsToRef(l,T,b,z.emitterWorldMatrix,Y.direction):Y.direction.kl(l,T,b)},u._positionCreation.process=Y=>{z.systemContext=u,z.isEmitterTransformNode?H.p.TransformCoordinatesFromFloatsToRef(0,0,0,z.emitterWorldMatrix,Y.position):Y.position.J(z.emitterPosition)},this.output._storedValue=u}});(0,T.d)("BABYLON.CustomShapeBlock",class extends ku{constructor(z){super(z),this.registerInput("particle",Uu.Particle),this.registerInput("position",Uu.Pl,!0,new H.p(0,0,0)),this.registerInput("direction",Uu.Pl,!0,new H.p(0,1,0)),this.registerOutput("output",Uu.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.direction.getConnectedValue(z);z.isEmitterTransformNode?H.p.TransformNormalToRef(E,z.emitterWorldMatrix,Y.direction):Y.direction.J(E)},u._positionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.position.getConnectedValue(z);z.isEmitterTransformNode?H.p.TransformCoordinatesToRef(E,z.emitterWorldMatrix,Y.position):(Y.position.J(E),Y.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});(0,T.d)("BABYLON.CylinderShapeBlock",class extends ku{constructor(z){super(z),this._tempVector=H.p.Zero(),this.registerInput("particle",Uu.Particle),this.registerInput("radius",Uu.Float,!0,1),this.registerInput("height",Uu.Float,!0,1,0),this.registerInput("radiusRange",Uu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Uu.Float,!0,0,0,1),this.registerOutput("output",Uu.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(z){const u=this.particle.getConnectedValue(z);u._directionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.directionRandomizer.getConnectedValue(z);Y.position.subtractToRef(z.emitterPosition,this._tempVector),this._tempVector.normalize(),z.isEmitterTransformNode&&H.p.TransformNormalToRef(this._tempVector,z.emitterInverseWorldMatrix,this._tempVector);const J=(0,L.RandomRange)(-E/2,E/2);let l=Math.atan2(this._tempVector.x,this._tempVector.z);l+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=J,this._tempVector.x=Math.sin(l),this._tempVector.z=Math.cos(l),this._tempVector.normalize(),z.isEmitterTransformNode?H.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,z.emitterWorldMatrix,Y.direction):Y.direction.J(this._tempVector)},u._positionCreation.process=Y=>{z.particleContext=Y,z.systemContext=u;const E=this.height.getConnectedValue(z),J=this.radiusRange.getConnectedValue(z),l=this.radius.getConnectedValue(z),T=(0,L.RandomRange)(-E/2,E/2),b=(0,L.RandomRange)(0,2*Math.PI),D=(0,L.RandomRange)((1-J)*(1-J),1),g=Math.sqrt(D)*l,M=g*Math.cos(b),q=g*Math.sin(b);z.isEmitterTransformNode?H.p.TransformCoordinatesFromFloatsToRef(M,T,q,z.emitterWorldMatrix,Y.position):(Y.position.kl(M,T,q),Y.position.addInPlace(z.emitterPosition))},this.output._storedValue=u}});class bY extends ku{constructor(z){super(z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Uu.Particle),this.registerOutput("output",Uu.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);const u=this.particle.getConnectedValue(z);u._isAnimationSheetEnabled=!0,u.spriteCellWidth=this.width,u.spriteCellHeight=this.height,u.startSpriteCellID=this.start,u.endSpriteCellID=this.end,u.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=u}serialize(){const z=super.serialize();return z.width=this.width,z.height=this.height,z.start=this.start,z.end=this.end,z.randomStartCell=this.randomStartCell,z}_deserialize(z){super._deserialize(z),this.width=z.width,this.height=z.height,this.start=z.start,this.end=z.end,this.randomStartCell=z.randomStartCell}}(0,G.e)([Pu("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bY.prototype,"start",void 0),(0,G.e)([Pu("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bY.prototype,"end",void 0),(0,G.e)([Pu("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bY.prototype,"width",void 0),(0,G.e)([Pu("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bY.prototype,"height",void 0),(0,G.e)([Pu("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bY.prototype,"loop",void 0),(0,G.e)([Pu("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bY.prototype,"randomStartCell",void 0),(0,T.d)("BABYLON.SetupSpriteSheetBlock",bY);class LY extends ku{constructor(z){super(z),this.reference=0,this.registerInput("value",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=z=>{switch(z){case Uu.Float:return Uu.FloatGradient;case Uu.Vector2:return Uu.Vector2Gradient;case Uu.Pl:return Uu.Vector3Gradient;case Uu.zb:return Uu.Color4Gradient}return z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Uu.Float|Uu.Vector2|Uu.Pl|Uu.zb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=z=>null}serialize(){const z=super.serialize();return z.reference=this.reference,z}_deserialize(z){super._deserialize(z),this.reference=z.reference}}(0,G.e)([Pu("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],LY.prototype,"reference",void 0),(0,T.d)("BABYLON.ParticleGradientValueBlock",LY);(0,T.d)("BABYLON.ParticleGradientBlock",class extends ku{constructor(z){super(z),this._entryCount=1,this.registerInput("gradient",Uu.Float,!0,1,0,1),this.registerInput("value0",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=z=>{switch(z){case Uu.FloatGradient:return Uu.Float;case Uu.Vector2Gradient:return Uu.Vector2;case Uu.Vector3Gradient:return Uu.Pl;case Uu.Color4Gradient:return Uu.zb}return z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Uu.FloatGradient|Uu.Vector2Gradient|Uu.Vector3Gradient|Uu.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(z){this._inputs[z].onConnectionObservable.add((()=>{this._entryCount>z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Uu.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const z=[];for(let Y=1;Y<this._inputs.length;Y++){var u;if(this._inputs[Y].isConnected)z.push(null===(u=this._inputs[Y].connectedPoint)||void 0===u?void 0:u.ownerBlock)}z.sort(((z,u)=>z.reference-u.reference)),this.output._storedFunction=u=>{const Y=this.gradient.getConnectedValue(u);if(1===z.length)return z[0].value.getConnectedValue(u);let E=null;for(let J=z.length-1;J>=0;J--){const T=z[J];if(T.reference<=Y){const z=T.value.getConnectedValue(u);if(E){const J=E.value.getConnectedValue(u),b=E.reference,D=T.reference,g=Math.max(0,Math.min(1,(Y-D)/(b-D)));switch(this.output.type){case Uu.Float:return(0,L.Lerp)(z,J,g);case Uu.Vector2:return H.m.Lerp(z,J,g);case Uu.Pl:return H.p.Lerp(z,J,g);case Uu.zb:return l.e.Lerp(z,J,g)}}return z}E=T}return 0}}});(0,T.d)("BABYLON.ParticleConverterBlock",class extends ku{constructor(z){super(z),this.registerInput("color ",Uu.zb,!0),this.registerInput("xyz ",Uu.Pl,!0),this.registerInput("xy ",Uu.Vector2,!0),this.registerInput("zw ",Uu.Vector2,!0),this.registerInput("x ",Uu.Float,!0),this.registerInput("y ",Uu.Float,!0),this.registerInput("z ",Uu.Float,!0),this.registerInput("w ",Uu.Float,!0),this.registerOutput("color",Uu.zb),this.registerOutput("xyz",Uu.Pl),this.registerOutput("xy",Uu.Vector2),this.registerOutput("zw",Uu.Vector2),this.registerOutput("x",Uu.Float),this.registerOutput("y",Uu.Float),this.registerOutput("z",Uu.Float),this.registerOutput("w",Uu.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(z){return"color "===z?"colorIn":"xyz "===z?"xyzIn":"xy "===z?"xyIn":"zw "===z?"zwIn":"x "===z?"xIn":"y "===z?"yIn":"z "===z?"zIn":"w "===z?"wIn":z}_outputRename(z){switch(z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return z}}_build(z){super._build(z);const u=this.xIn,Y=this.yIn,E=this.zIn,J=this.wIn,T=this.xyIn,b=this.zwIn,L=this.xyzIn,D=this.colorIn,g=this.colorOut,M=this.xyzOut,q=this.xyOut,C=this.zwOut,K=this.xOut,h=this.yOut,o=this.zOut,d=this.wOut,t=z=>{if(D.isConnected)return D.getConnectedValue(z);let H=0,g=0,M=0,q=0;if(u.isConnected&&(H=u.getConnectedValue(z)),Y.isConnected&&(g=Y.getConnectedValue(z)),E.isConnected&&(M=E.getConnectedValue(z)),J.isConnected&&(q=J.getConnectedValue(z)),T.isConnected){const u=T.getConnectedValue(z);u&&(H=u.x,g=u.y)}if(b.isConnected){const u=b.getConnectedValue(z);u&&(M=u.x,q=u.y)}if(L.isConnected){const u=L.getConnectedValue(z);u&&(H=u.x,g=u.y,M=u.z)}return new l.e(H,g,M,q)};g._storedFunction=z=>t(z),M._storedFunction=z=>{const u=t(z);return new H.p(u.r,u.g,u.b)},q._storedFunction=z=>{const u=t(z);return new H.m(u.r,u.g)},C._storedFunction=z=>{const u=t(z);return new H.m(u.b,u.a)},K._storedFunction=z=>t(z).r,h._storedFunction=z=>t(z).g,o._storedFunction=z=>t(z).b,d._storedFunction=z=>t(z).a}}),function(z){z[z.Cos=0]="Cos",z[z.Sin=1]="Sin",z[z.Abs=2]="Abs",z[z.Exp=3]="Exp",z[z.Exp2=4]="Exp2",z[z.Round=5]="Round",z[z.Floor=6]="Floor",z[z.Ceiling=7]="Ceiling",z[z.Sqrt=8]="Sqrt",z[z.Log=9]="Log",z[z.Tan=10]="Tan",z[z.ArcTan=11]="ArcTan",z[z.ArcCos=12]="ArcCos",z[z.ArcSin=13]="ArcSin",z[z.Sign=14]="Sign",z[z.Negate=15]="Negate",z[z.OneMinus=16]="OneMinus",z[z.Reciprocal=17]="Reciprocal",z[z.ToDegrees=18]="ToDegrees",z[z.ToRadians=19]="ToRadians",z[z.Fract=20]="Fract"}(au||(au={}));class DY extends ku{constructor(z){super(z),this.operation=au.Cos,this.registerInput("input",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Uu.Float|Uu.Int|Uu.Vector2|Uu.Pl|Uu.zb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);let u=null;switch(this.operation){case au.Cos:u=z=>Math.cos(z);break;case au.Sin:u=z=>Math.sin(z);break;case au.Abs:u=z=>Math.abs(z);break;case au.Exp:u=z=>Math.exp(z);break;case au.Exp2:u=z=>Math.pow(2,z);break;case au.Round:u=z=>Math.round(z);break;case au.Floor:u=z=>Math.floor(z);break;case au.Ceiling:u=z=>Math.ceil(z);break;case au.Sqrt:u=z=>Math.sqrt(z);break;case au.Log:u=z=>Math.log(z);break;case au.Tan:u=z=>Math.tan(z);break;case au.ArcTan:u=z=>Math.atan(z);break;case au.ArcCos:u=z=>Math.acos(z);break;case au.ArcSin:u=z=>Math.asin(z);break;case au.Sign:u=z=>Math.sign(z);break;case au.Negate:u=z=>-z;break;case au.OneMinus:u=z=>1-z;break;case au.Reciprocal:u=z=>1/z;break;case au.ToRadians:u=z=>z*Math.PI/180;break;case au.ToDegrees:u=z=>180*z/Math.PI;break;case au.Fract:u=z=>z>=0?z-Math.floor(z):z-Math.ceil(z)}if(!u)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Uu.Int:case Uu.Float:this.output._storedFunction=z=>{const Y=this.input.getConnectedValue(z);return u(Y)};break;case Uu.Vector2:this.output._storedFunction=z=>{const Y=this.input.getConnectedValue(z);return new H.m(u(Y.x),u(Y.y))};break;case Uu.Pl:this.output._storedFunction=z=>{const Y=this.input.getConnectedValue(z);return new H.p(u(Y.x),u(Y.y),u(Y.z))};break;case Uu.zb:this.output._storedFunction=z=>{const Y=this.input.getConnectedValue(z);return new l.e(u(Y.r),u(Y.g),u(Y.b),u(Y.a))}}return this}serialize(){const z=super.serialize();return z.operation=this.operation,z}_deserialize(z){super._deserialize(z),this.operation=z.operation}}(0,G.e)([Pu("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:au.Cos},{label:"Sin",value:au.Sin},{label:"Abs",value:au.Abs},{label:"Exp",value:au.Exp},{label:"Exp2",value:au.Exp2},{label:"Round",value:au.Round},{label:"Floor",value:au.Floor},{label:"Ceiling",value:au.Ceiling},{label:"Sqrt",value:au.Sqrt},{label:"Log",value:au.Log},{label:"Tan",value:au.Tan},{label:"ArcTan",value:au.ArcTan},{label:"ArcCos",value:au.ArcCos},{label:"ArcSin",value:au.ArcSin},{label:"Sign",value:au.Sign},{label:"Negate",value:au.Negate},{label:"OneMinus",value:au.OneMinus},{label:"Reciprocal",value:au.Reciprocal},{label:"ToDegrees",value:au.ToDegrees},{label:"ToRadians",value:au.ToRadians},{label:"Fract",value:au.Fract}]})],DY.prototype,"operation",void 0),(0,T.d)("BABYLON.ParticleTrigonometryBlock",DY);var gY,MY=Y(12225);class qY extends ku{constructor(z){super(z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Uu.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Uu.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Uu.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Uu.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Uu.System),this._inputs[0].excludedConnectionPointTypes.push(Uu.Particle),this._inputs[0].excludedConnectionPointTypes.push(Uu.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const u=z=>{const u=this.input.getConnectedValue(z);if(this.log.length>=this.stackSize)return u;if(null===u||void 0===u)return this.log.push(["null",""]),u;switch(this.input.type){case Uu.Vector2:this.log.push([(0,MY.j)(u,4),u.toString()]);break;case Uu.Pl:this.log.push([(0,MY.m)(u,4),u.toString()]);break;case Uu.zb:this.log.push([`{R: ${u.r.toFixed(4)} G: ${u.g.toFixed(4)} B: ${u.b.toFixed(4)} A: ${u.a.toFixed(4)}}`,u.toString()]);break;default:this.log.push([u.toString(),u.toString()])}return u};this.output.isConnected?this.output._storedFunction=u:this.output._storedValue=u(z)}serialize(){const z=super.serialize();return z.stackSize=this.stackSize,z}_deserialize(z){super._deserialize(z),this.stackSize=z.stackSize}}(0,G.e)([Pu("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],qY.prototype,"stackSize",void 0),(0,T.d)("BABYLON.ParticleDebugBlock",qY);(0,T.d)("BABYLON.ParticleElbowBlock",class extends ku{constructor(z){super(z),this.registerInput("input",Uu.AutoDetect),this.registerOutput("output",Uu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(z){super._build(z);const u=this._outputs[0],Y=this._inputs[0];u._storedFunction=z=>Y.getConnectedValue(z)}});(0,T.d)("BABYLON.ParticleTeleportInBlock",class extends ku{get endpoints(){return this._endpoints}constructor(z){super(z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Uu.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(z){if(this.getClassName()===z)return!0;for(const u of this.endpoints)if(u.isAnAncestorOfType(z))return!0;return!1}isAnAncestorOf(z){for(const u of this.endpoints){if(u===z)return!0;if(u.isAnAncestorOf(z))return!0}return!1}attachToEndpoint(z){z.detach(),this._endpoints.push(z),z._entryPoint=this,z._outputs[0]._typeConnectionSource=this._inputs[0],z._tempEntryPointUniqueId=null,z.name="> "+this.name}detachFromEndpoint(z){const u=this._endpoints.indexOf(z);-1!==u&&(this._endpoints.splice(u,1),z._outputs[0]._typeConnectionSource=null,z._entryPoint=null)}_build(){for(const z of this._endpoints)z.output._storedFunction=z=>this.input.getConnectedValue(z)}});(0,T.d)("BABYLON.ParticleTeleportOutBlock",class extends ku{constructor(z){super(z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Uu.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(z){this.entryPoint&&this.entryPoint.build(z)}clone(){const z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(z),z}serialize(){var z;const u=super.serialize();return u.entryPoint=(null===(z=this.entryPoint)||void 0===z?void 0:z.uniqueId)??"",u}_deserialize(z){super._deserialize(z),this._tempEntryPointUniqueId=z.entryPoint}}),function(z){z[z.Equal=0]="Equal",z[z.NotEqual=1]="NotEqual",z[z.LessThan=2]="LessThan",z[z.GreaterThan=3]="GreaterThan",z[z.LessOrEqual=4]="LessOrEqual",z[z.GreaterOrEqual=5]="GreaterOrEqual",z[z.Xor=6]="Xor",z[z.Or=7]="Or",z[z.And=8]="And"}(gY||(gY={}));class CY extends ku{constructor(z){super(z),this.test=gY.Equal,this.epsilon=0,this.registerInput("left",Uu.Float),this.registerInput("right",Uu.Float,!0,0),this.registerInput("ifTrue",Uu.AutoDetect,!0,1),this.registerInput("ifFalse",Uu.AutoDetect,!0,0),this.registerOutput("output",Uu.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Uu.Float,this._inputs[0].acceptedConnectionPointTypes.push(Uu.Int),this._inputs[1].acceptedConnectionPointTypes.push(Uu.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const z=z=>{const u=this.left.getConnectedValue(z),Y=this.right.getConnectedValue(z);let H=!1;switch(this.test){case gY.Equal:H=(0,L.WithinEpsilon)(u,Y,this.epsilon);break;case gY.NotEqual:H=!(0,L.WithinEpsilon)(u,Y,this.epsilon);break;case gY.LessThan:H=u<Y+this.epsilon;break;case gY.GreaterThan:H=u>Y-this.epsilon;break;case gY.LessOrEqual:H=u<=Y+this.epsilon;break;case gY.GreaterOrEqual:H=u>=Y-this.epsilon;break;case gY.Xor:H=!!u&&!Y||!u&&!!Y;break;case gY.Or:H=!!u||!!Y;break;case gY.And:H=!!u&&!!Y}return H};this.output._storedFunction=u=>z(u)?this.ifTrue.getConnectedValue(u):this.ifFalse.getConnectedValue(u)}serialize(){const z=super.serialize();return z.test=this.test,z.epsilon=this.epsilon,z}_deserialize(z){super._deserialize(z),this.test=z.test,void 0!==z.epsilon&&(this.epsilon=z.epsilon)}}(0,G.e)([Pu("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:gY.Equal},{label:"NotEqual",value:gY.NotEqual},{label:"LessThan",value:gY.LessThan},{label:"GreaterThan",value:gY.GreaterThan},{label:"LessOrEqual",value:gY.LessOrEqual},{label:"GreaterOrEqual",value:gY.GreaterOrEqual},{label:"Xor",value:gY.Xor},{label:"Or",value:gY.Or},{label:"And",value:gY.And}]})],CY.prototype,"test",void 0),(0,G.e)([Pu("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CY.prototype,"epsilon",void 0),(0,T.d)("BABYLON.ParticleConditionBlock",CY);class KY extends ku{constructor(z){super(z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Uu.Particle),this.registerInput("condition",Uu.Float,!0,0),this.registerInput("system",Uu.System),this.registerOutput("output",Uu.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(z){this._triggerCount=0;const u=this.input.getConnectedValue(z),Y={process:Y=>{if(z.particleContext=Y,z.systemContext=u,0!==this.condition.getConnectedValue(z)&&(0===this.limit||this._triggerCount<this.limit)){const H=(new Date).getTime();if(this._previousOne&&H-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=H;const E=this.system.getConnectedValue(z);if(E){const H=Nu(E,z.Cu,Y.position);H.fl.addOnce((()=>{this._triggerCount--})),u.fl.addOnce((()=>{H.dispose()}))}}},previousItem:null,nextItem:null};u._updateQueueStart?Sz(Y,u._updateQueueStart):u._updateQueueStart=Y,this.output._storedValue=u}serialize(){const z=super.serialize();return z.limit=this.limit,z.delay=this.delay,z}_deserialize(z){super._deserialize(z),void 0!==z.limit&&(this.limit=z.limit),void 0!==z.delay&&(this.delay=z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,G.e)([Pu("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KY.prototype,"limit",void 0),(0,G.e)([Pu("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KY.prototype,"delay",void 0),(0,T.d)("BABYLON.ParticleTriggerBlock",KY);Y(12229),Y(12240),Y(12250),Y(12293)},12282:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12252:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12310:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneVertex",J="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12299:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12290:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogFragment",J="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12277:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12312:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogVertex",J="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12303:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogVertexDeclaration",J="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12269:(z,u,Y)=>{"use strict";var H=Y(11029);const E="helperFunctions",J="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12258:(z,u,Y)=>{"use strict";var H=Y(11029);const E="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12272:(z,u,Y)=>{"use strict";var H=Y(11029);const E="imageProcessingFunctions",J="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12266:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12287:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12315:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";H.b.IncludesShadersStoreWGSL[E]||(H.b.IncludesShadersStoreWGSL[E]=J)},12250:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{particlesPixelShaderWGSL:()=>l});var H=Y(11029);Y(12252),Y(12258),Y(12266),Y(12269),Y(12272),Y(12277),Y(12282),Y(12287),Y(12290);const E="particlesPixelShader",J="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.b.ShadersStoreWGSL[E]||(H.b.ShadersStoreWGSL[E]=J);const l={name:E,shader:J}},12293:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{particlesVertexShaderWGSL:()=>l});var H=Y(11029);Y(12299),Y(12303),Y(12266),Y(12310),Y(12312),Y(12315);const E="particlesVertexShader",J="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.b.ShadersStoreWGSL[E]||(H.b.ShadersStoreWGSL[E]=J);const l={name:E,shader:J}},12157:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12232:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12185:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneVertex",J="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12248:(z,u,Y)=>{"use strict";var H=Y(11029);const E="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12174:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogFragment",J="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12155:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12189:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogVertex",J="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12182:(z,u,Y)=>{"use strict";var H=Y(11029);const E="fogVertexDeclaration",J="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12146:(z,u,Y)=>{"use strict";var H=Y(11029);const E="helperFunctions",J="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12139:(z,u,Y)=>{"use strict";var H=Y(11029);const E="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12149:(z,u,Y)=>{"use strict";var H=Y(11029);const E="imageProcessingFunctions",J="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12141:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12166:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12195:(z,u,Y)=>{"use strict";var H=Y(11029);const E="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";H.b.IncludesShadersStore[E]||(H.b.IncludesShadersStore[E]=J)},12229:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{particlesPixelShader:()=>l});var H=Y(11029);Y(12232),Y(12139),Y(12141),Y(12146),Y(12149),Y(12155),Y(12157),Y(12166),Y(12174);const E="particlesPixelShader",J="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.b.ShadersStore[E]||(H.b.ShadersStore[E]=J);const l={name:E,shader:J}},12240:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{particlesVertexShader:()=>l});var H=Y(11029);Y(12248),Y(12182),Y(12141),Y(12185),Y(12189),Y(12195);const E="particlesVertexShader",J="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.b.ShadersStore[E]||(H.b.ShadersStore[E]=J);const l={name:E,shader:J}},12582:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{FlowGraphGLTFDataProvider:()=>J});var H=Y(12549),E=Y(12531);class J extends H.b{constructor(z){var u,Y;super();const H=z.glTF,J=(null===(u=H.animations)||void 0===u?void 0:u.map((z=>z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.e,J);const l=(null===(Y=H.nodes)||void 0===Y?void 0:Y.map((z=>z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.e,l)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12476:(z,u,Y)=>{"use strict";Y.d(u,{b:()=>h,f:()=>C,j:()=>q,l:()=>K});var H=Y(10903),E=Y(11464),J=Y(11188),l=Y(12483);const T=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class b{constructor(z,u){this._gltf=z,this._infoTree=u}convert(z){let u,Y=this._gltf,H=this._infoTree;if(!z.startsWith("/"))throw new Error("Path must start with a /");const E=z.split("/");if(E.shift(),E[E.length-1].includes(".length")){const z=E[E.length-1].split(".");E.pop(),E.push(...z)}let J=!1;for(const b of E){const E="length"===b;if(E&&!H.__array__)throw new Error(`Path ${z} is invalid`);if(H.__ignoreObjectTree__&&(J=!0),H.__array__&&!E)H=H.__array__;else if(H=H[b],!H)throw new Error(`Path ${z} is invalid`);if(!J)if(void 0===Y){if(!T.find((u=>u.regex.test(z))))throw new Error(`Path ${z} is invalid`)}else if(!E){var l;Y=null===(l=Y)||void 0===l?void 0:l[b]}(H.__target__||E)&&(u=Y)}return{object:u,info:H}}}function L(z,u,Y,H){const E=D(z,u);return H?E[Y][H]:E[Y]}function D(z,u,Y){var H,J;return null===(H=z._data)||void 0===H||null===(J=H[(null===Y||void 0===Y?void 0:Y.fillMode)??E.b.MATERIAL_TriangleFillMode])||void 0===J?void 0:J.babylonMaterial}function g(z,u){return{offset:{componentsCount:2,type:"Vector2",get:(Y,E,J)=>{const l=L(Y,J,z,u);return new H.m(null===l||void 0===l?void 0:l.uOffset,null===l||void 0===l?void 0:l.vOffset)},getTarget:D,set:(Y,H,E,J)=>{const l=L(H,J,z,u);l.uOffset=Y.x,l.vOffset=Y.y},getPropertyName:[()=>`${z}${u?"."+u:""}.uOffset`,()=>`${z}${u?"."+u:""}.vOffset`]},rotation:{type:"number",get:(Y,H,E)=>{var J;return null===(J=L(Y,E,z,u))||void 0===J?void 0:J.wAng},getTarget:D,set:(Y,H,E,J)=>L(H,J,z,u).wAng=Y,getPropertyName:[()=>`${z}${u?"."+u:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Y,E,J)=>{const l=L(Y,J,z,u);return new H.m(null===l||void 0===l?void 0:l.uScale,null===l||void 0===l?void 0:l.vScale)},getTarget:D,set:(Y,H,E,J)=>{const l=L(H,J,z,u);l.uScale=Y.x,l.vScale=Y.y},getPropertyName:[()=>`${z}${u?"."+u:""}.uScale`,()=>`${z}${u?"."+u:""}.vScale`]}}}const M={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:z=>{var u,Y;return new H.m((null===(u=z._babylonCamera)||void 0===u?void 0:u.orthoLeft)??0,(null===(Y=z._babylonCamera)||void 0===Y?void 0:Y.orthoRight)??0)},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.orthoLeft=z.x,u._babylonCamera.orthoRight=z.y)},getTarget:z=>z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:z=>{var u,Y;return new H.m((null===(u=z._babylonCamera)||void 0===u?void 0:u.orthoBottom)??0,(null===(Y=z._babylonCamera)||void 0===Y?void 0:Y.orthoTop)??0)},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.orthoBottom=z.x,u._babylonCamera.orthoTop=z.y)},getTarget:z=>z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.maxZ},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=z)},getTarget:z=>z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.uT},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.uT=z)},getTarget:z=>z,getPropertyName:[()=>"uT"]}},perspective:{aspectRatio:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.getEngine().getAspectRatio(z._babylonCamera)},getTarget:z=>z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.fov},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.fov=z)},getTarget:z=>z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.maxZ},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=z)},getTarget:z=>z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:z=>{var u;return null===(u=z._babylonCamera)||void 0===u?void 0:u.uT},set:(z,u)=>{u._babylonCamera&&(u._babylonCamera.uT=z)},getTarget:z=>z,getPropertyName:[()=>"uT"]}}}},nodes:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Pl",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.position},set:(z,u)=>{var Y;return null===(Y=u._babylonTransformNode)||void 0===Y?void 0:Y.position.J(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.rotationQuaternion},set:(z,u)=>{var Y,H;return null===(Y=u._babylonTransformNode)||void 0===Y||null===(H=Y.rotationQuaternion)||void 0===H?void 0:H.J(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Pl",get:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.el},set:(z,u)=>{var Y;return null===(Y=u._babylonTransformNode)||void 0===Y?void 0:Y.el.J(z)},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"el"]},weights:{length:{type:"number",get:z=>z._numMorphTargets,getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(z,u)=>{var Y,H;return void 0!==u?null===(Y=z._primitiveBabylonMeshes)||void 0===Y||null===(H=Y[0].morphTargetManager)||void 0===H?void 0:H.getTarget(u).influence:void 0},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(z,u)=>[0],getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:z=>{var u,Y,E;return H.b.Compose(null===(u=z._babylonTransformNode)||void 0===u?void 0:u.el,null===(Y=z._babylonTransformNode)||void 0===Y?void 0:Y.rotationQuaternion,null===(E=z._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:z=>z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:z=>{var u,Y,E,J;const l=H.b.Identity();let T=z.parent;for(;T&&T.parent;)T=T.parent;const b=(null===(u=z._babylonTransformNode)||void 0===u?void 0:u.position._isDirty)||(null===(Y=z._babylonTransformNode)||void 0===Y||null===(E=Y.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(J=z._babylonTransformNode)||void 0===J?void 0:J.el._isDirty);if(T){var L;const u=null===(L=T._babylonTransformNode)||void 0===L?void 0:L.pl(!0).invert();var D,g;if(u)null===(D=z._babylonTransformNode)||void 0===D||null===(g=D.pl(b))||void 0===g||g.multiplyToRef(u,l)}else z._babylonTransformNode&&l.J(z._babylonTransformNode.pl(b));return l},getTarget:z=>z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:z=>{var u,Y;return null===(u=z._babylonTransformNode)||void 0===u||null===(Y=u.getChildren((z=>z instanceof l.c),!0)[0])||void 0===Y?void 0:Y.JT},getTarget:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.getChildren((z=>z instanceof l.c),!0)[0]},set:(z,u)=>{if(u._babylonTransformNode){const Y=u._babylonTransformNode.getChildren((z=>z instanceof l.c),!0)[0];Y&&(Y.JT=z)}}},color:{type:"o",get:z=>{var u,Y;return null===(u=z._babylonTransformNode)||void 0===u||null===(Y=u.getChildren((z=>z instanceof l.c),!0)[0])||void 0===Y?void 0:Y.lT},getTarget:z=>{var u;return null===(u=z._babylonTransformNode)||void 0===u?void 0:u.getChildren((z=>z instanceof l.c),!0)[0]},set:(z,u)=>{if(u._babylonTransformNode){const Y=u._babylonTransformNode.getChildren((z=>z instanceof l.c),!0)[0];Y&&(Y.lT=z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"o",get:(z,u,Y)=>D(z,u,Y).emissiveColor,set:(z,u,Y,H)=>D(u,Y,H).emissiveColor.J(z),getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:g("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(z,u,Y)=>{var H;return null===(H=L(z,Y,"bumpTexture"))||void 0===H?void 0:H.level},set:(z,u,Y,H)=>{const E=L(u,H,"bumpTexture");E&&(E.level=z)},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:g("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(z,u,Y)=>D(z,u,Y).ambientTextureStrength,set:(z,u,Y,H)=>{const E=D(u,Y,H);E&&(E.ambientTextureStrength=z)},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:g("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"zb",get:(z,u,Y)=>{const H=D(z,u,Y);return J.e.FromColor3(H.albedoColor,H.alpha)},set:(z,u,Y,H)=>{const E=D(u,Y,H);E.albedoColor.set(z.r,z.g,z.b),E.alpha=z.a},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:g("albedoTexture")}},metallicFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).metallic,set:(z,u,Y,H)=>{const E=D(u,Y,H);E&&(E.metallic=z)},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).roughness,set:(z,u,Y,H)=>{const E=D(u,Y,H);E&&(E.roughness=z)},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:g("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(z,u,Y)=>D(z,u,Y).anisotropy.JT,set:(z,u,Y,H)=>{D(u,Y,H).anisotropy.JT=z},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(z,u,Y)=>D(z,u,Y).anisotropy.angle,set:(z,u,Y,H)=>{D(u,Y,H).anisotropy.angle=z},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:g("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).clearCoat.JT,set:(z,u,Y,H)=>{D(u,Y,H).clearCoat.JT=z},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).clearCoat.roughness,set:(z,u,Y,H)=>{D(u,Y,H).clearCoat.roughness=z},getTarget:(z,u,Y)=>D(z,u,Y),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:g("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(z,u,Y)=>{var H;return null===(H=D(z,u,Y).clearCoat.bumpTexture)||void 0===H?void 0:H.level},getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).clearCoat.bumpTexture.level=z},extensions:{KHR_texture_transform:g("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:g("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(z,u,Y)=>D(z,u,Y).subSurface.dispersion,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.dispersion=z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(z,u,Y)=>D(z,u,Y).emissiveIntensity,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).emissiveIntensity=z}},KHR_materials_ior:{ior:{type:"number",get:(z,u,Y)=>D(z,u,Y).indexOfRefraction,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).indexOfRefraction=z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).iridescence.JT,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).iridescence.JT=z},iridescenceIor:{type:"number",get:(z,u,Y)=>D(z,u,Y).iridescence.indexOfRefraction,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).iridescence.indexOfRefraction=z},iridescenceTexture:{extensions:{KHR_texture_transform:g("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(z,u,Y)=>D(z,u,Y).iridescence.maximumThickness,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).iridescence.maximumThickness=z},iridescenceThicknessMinimum:{type:"number",get:(z,u,Y)=>D(z,u,Y).iridescence.minimumThickness,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).iridescence.minimumThickness=z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:g("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"o",get:(z,u,Y)=>D(z,u,Y).sheen.color,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).sheen.color.J(z)},sheenColorTexture:{extensions:{KHR_texture_transform:g("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).sheen.JT,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).sheen.JT=z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:g("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).metallicF0Factor,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).metallicF0Factor=z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"o",get:(z,u,Y)=>D(z,u,Y).metallicReflectanceColor,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).metallicReflectanceColor.J(z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:g("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:g("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).subSurface.refractionIntensity,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.refractionIntensity=z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).subSurface.translucencyIntensity,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.translucencyIntensity=z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"o",get:(z,u,Y)=>D(z,u,Y).subSurface.translucencyColor,getTarget:D,set:(z,u,Y,H)=>{var E;return z&&(null===(E=D(u,Y,H).subSurface.translucencyColor)||void 0===E?void 0:E.J(z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"o",get:(z,u,Y)=>D(z,u,Y).subSurface.tintColor,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.tintColor.J(z)},attenuationDistance:{type:"number",get:(z,u,Y)=>D(z,u,Y).subSurface.tintColorAtDistance,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.tintColorAtDistance=z},thicknessFactor:{type:"number",get:(z,u,Y)=>D(z,u,Y).subSurface.maximumThickness,getTarget:D,set:(z,u,Y,H)=>D(u,Y,H).subSurface.maximumThickness=z},thicknessTexture:{extensions:{KHR_texture_transform:g("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonLight)),getPropertyName:[z=>"length"]},__array__:{__target__:!0,color:{type:"o",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.lT},set:(z,u)=>{var Y;return null===(Y=u._babylonLight)||void 0===Y?void 0:Y.lT.J(z)},getTarget:z=>z._babylonLight,getPropertyName:[z=>"diffuse"]},JT:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.JT},set:(z,u)=>u._babylonLight?u._babylonLight.JT=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"intensity"]},range:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.range},set:(z,u)=>u._babylonLight?u._babylonLight.range=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"range"]},spot:{innerConeAngle:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.innerAngle},set:(z,u)=>u._babylonLight?u._babylonLight.innerAngle=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:z=>{var u;return null===(u=z._babylonLight)||void 0===u?void 0:u.angle},set:(z,u)=>u._babylonLight?u._babylonLight.angle=z:void 0,getTarget:z=>z._babylonLight,getPropertyName:[z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonLight)),getPropertyName:[z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonTexture)),getPropertyName:[z=>"length"]},__array__:{__target__:!0,JT:{type:"number",get:z=>{var u;return null===(u=z._babylonTexture)||void 0===u?void 0:u.level},set:(z,u)=>{u._babylonTexture&&(u._babylonTexture.level=z)},getTarget:z=>z._babylonTexture},rotation:{type:"Quaternion",get:z=>{var u;return z._babylonTexture&&H.f.FromRotationMatrix(null===(u=z._babylonTexture)||void 0===u?void 0:u.getReflectionTextureMatrix())},set:(z,u)=>{var Y;u._babylonTexture&&(null!==(Y=u._babylonTexture.iz())&&void 0!==Y&&Y.useRightHandedSystem||(z=H.f.Inverse(z)),H.b.FromQuaternionToRef(z,u._babylonTexture.getReflectionTextureMatrix()))},getTarget:z=>z._babylonTexture}}}}},animations:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:z=>z.length,getTarget:z=>z.map((z=>{var u;return null===(u=z.primitives[0]._instanceData)||void 0===u?void 0:u.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function q(z){return new b(z,M)}function C(z){const u=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let Y=M;for(const H of u)H&&(Y=Y[H]);if(Y&&Y.type&&Y.get)return Y}function K(z,u){const Y=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let H=M;for(const E of Y)E&&(H=H[E]);H&&H.type&&H.get&&(H.interpolation=u)}function h(z,u){const Y=z.split("/").map((z=>z.replace(/{}/g,"__array__")));let H=M;for(const E of Y)if(E){if(!H[E]){if("?"===E){H.__ignoreObjectTree__=!0;continue}H[E]={},"__array__"===E&&(H[E].__target__=!0)}H=H[E]}Object.assign(H,u)}},12485:(z,u,Y)=>{"use strict";Y.r(u),Y.d(u,{AnimationPropertyInfo:()=>L,TransformNodeAnimationPropertyInfo:()=>D,WeightAnimationPropertyInfo:()=>g,getQuaternion:()=>T,getVector3:()=>l,getWeights:()=>b});var H=Y(11619),E=Y(10903),J=Y(12476);function l(z,u,Y,H){return E.p.Nl(u,Y).scaleInPlace(H)}function T(z,u,Y,H){return E.f.Nl(u,Y).scaleInPlace(H)}function b(z,u,Y,H){const E=new Array(z._numMorphTargets);for(let J=0;J<E.length;J++)E[J]=u[Y++]*H;return E}class L{constructor(z,u,Y,H){this.type=z,this.name=u,this.getValue=Y,this.getStride=H}_buildAnimation(z,u,Y){const E=new H.e(z,this.name,u,this.type);return E.setKeys(Y),E}}class D extends L{buildAnimations(z,u,Y,H){const E=[];return E.push({babylonAnimatable:z._babylonTransformNode,babylonAnimation:this._buildAnimation(u,Y,H)}),E}}class g extends L{buildAnimations(z,u,Y,E){const J=[];if(z._numMorphTargets)for(let l=0;l<z._numMorphTargets;l++){const T=new H.e(`${u}_${l}`,this.name,Y,this.type);if(T.setKeys(E.map((z=>({frame:z.frame,inTangent:z.inTangent?z.inTangent[l]:void 0,value:z.value[l],outTangent:z.outTangent?z.outTangent[l]:void 0,interpolation:z.interpolation})))),z._primitiveBabylonMeshes)for(const u of z._primitiveBabylonMeshes)if(u.morphTargetManager){const z=u.morphTargetManager.getTarget(l),Y=T.clone();z.animations.push(Y),J.push({babylonAnimatable:z,babylonAnimation:Y})}}return J}}(0,J.l)("/nodes/{}/translation",[new D(H.e.ANIMATIONTYPE_VECTOR3,"position",l,(()=>3))]),(0,J.l)("/nodes/{}/rotation",[new D(H.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",T,(()=>4))]),(0,J.l)("/nodes/{}/scale",[new D(H.e.ANIMATIONTYPE_VECTOR3,"el",l,(()=>3))]),(0,J.l)("/nodes/{}/weights",[new g(H.e.ANIMATIONTYPE_FLOAT,"influence",b,(z=>z._numMorphTargets))])},12436:(z,u,Y)=>{"use strict";class H{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((z,u)=>{this._resolve=z,this._reject=u}))}}var E=Y(10903),J=Y(11188),l=Y(10945),T=Y(11275),b=Y(12439),L=Y(12451),D=Y(10932),g=Y(11461),M=Y(11619),q=Y(11626),C=Y(10928),K=Y(10953),h=Y(10959);class o{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(z){this._useTextureToStoreBoneMatrices=z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(z,u,Y){this.name=z,this.id=u,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new D.e,this.bones=[],this._scene=Y||C.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const H=this._scene.getEngine().getCaps();this._canUseTextureForBones=H.textureFloat&&H.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((z=>!z.getParent()))}getTransformMatrices(z){if(this.needInitialSkinMatrix){if(!z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return z._bonesTransformMatrices||this.prepare(!0),z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(z){return this.needInitialSkinMatrix&&z._transformMatrixTexture?z._transformMatrixTexture:this._transformMatrixTexture}iz(){return this._scene}toString(z){let u=`Name: ${this.name}, nBones: ${this.bones.length}`;if(u+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,z){u+=", Ranges: {";let z=!0;for(const Y in this._ranges)z&&(u+=", ",z=!1),u+=Y;u+="}"}return u}getBoneIndexByName(z){for(let u=0,Y=this.bones.length;u<Y;u++)if(this.bones[u].name===z)return u;return-1}createAnimationRange(z,u,Y){if(!this._ranges[z]){this._ranges[z]=new q.d(z,u,Y);for(let H=0,E=this.bones.length;H<E;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].createRange(z,u,Y)}}deleteAnimationRange(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Y=0,H=this.bones.length;Y<H;Y++)this.bones[Y].animations[0]&&this.bones[Y].animations[0].deleteRange(z,u);this._ranges[z]=null}getAnimationRange(z){return this._ranges[z]||null}getAnimationRanges(){const z=[];let u;for(u in this._ranges)z.push(this._ranges[u]);return z}copyAnimationRange(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[u]||!z.getAnimationRange(u))return!1;let H=!0;const E=this._getHighestAnimationFrame()+1,J={},l=z.bones;let T,b;for(b=0,T=l.length;b<T;b++)J[l[b].name]=l[b];this.bones.length!==l.length&&(K.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${l.length}`),H=!1);const L=Y&&this.dimensionsAtRest&&z.dimensionsAtRest?this.dimensionsAtRest.divide(z.dimensionsAtRest):null;for(b=0,T=this.bones.length;b<T;b++){const z=this.bones[b].name,l=J[z];l?H=H&&this.bones[b].copyAnimationRange(l,u,E,Y,L):(K.b.Warn("copyAnimationRange: not same rig, missing source bone "+z),H=!1)}const D=z.getAnimationRange(u);return D&&(this._ranges[u]=new q.d(u,D.from+E,D.to+E)),H}returnToRest(){for(const z of this.bones)-1!==z._index&&z.returnToRest()}_getHighestAnimationFrame(){let z=0;for(let u=0,Y=this.bones.length;u<Y;u++)if(this.bones[u].animations[0]){const Y=this.bones[u].animations[0].getHighestFrame();z<Y&&(z=Y)}return z}beginAnimation(z,u,Y,H){const E=this.getAnimationRange(z);return E?this._scene.beginAnimation(this,E.from,E.to,u,Y,H):null}static MakeAnimationAdditive(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const H=z.getAnimationRange(Y);if(!H)return null;const E=z._scene.getAllAnimatablesByTarget(z);let J=null;for(let T=0;T<E.length;T++){const z=E[T];if(z.fromFrame===(null===H||void 0===H?void 0:H.from)&&z.toFrame===(null===H||void 0===H?void 0:H.to)){J=z;break}}const l=z.getAnimatables();for(let T=0;T<l.length;T++){const z=l[T].animations;if(z)for(let H=0;H<z.length;H++)M.e.MakeAnimationAdditive(z[H],u,Y)}return J&&(J.isAdditive=!0),z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(z){this._meshesWithPoseMatrix.push(z)}_unregisterMeshWithPoseMatrix(z){const u=this._meshesWithPoseMatrix.indexOf(z);u>-1&&this._meshesWithPoseMatrix.splice(u,1)}_computeTransformMatrices(z,u){this.onBeforeComputeObservable.notifyObservers(this);for(let Y=0;Y<this.bones.length;Y++){const H=this.bones[Y];H._childUpdateId++;const E=H.getParent();if(E?H.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),H.getFinalMatrix()):u?H.getLocalMatrix().multiplyToRef(u,H.getFinalMatrix()):H.getFinalMatrix().J(H.getLocalMatrix()),-1!==H._index){const u=null===H._index?Y:H._index;H.getAbsoluteInverseBindMatrix().multiplyToArray(H.getFinalMatrix(),z,16*u)}}this._identity.copyToArray(z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const z=this.iz().getRenderId();if(this._currentRenderId===z)return;this._currentRenderId=z}if(this._numBonesWithLinkedTransformNode>0)for(const z of this.bones)if(z._linkedTransformNode){const u=z._linkedTransformNode;z.position=u.position,u.rotationQuaternion?z.rotationQuaternion=u.rotationQuaternion:z.rotation=u.rotation,z.el=u.el}if(this.needInitialSkinMatrix)for(const z of this._meshesWithPoseMatrix){const u=z.getPoseMatrix();let Y=this._isDirty;if(z._bonesTransformMatrices&&z._bonesTransformMatrices.length===16*(this.bones.length+1)||(z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Y=!0),Y){if(this._synchronizedWithMesh!==z){this._synchronizedWithMesh=z;for(const z of this.bones)if(!z.getParent()){z.getBindMatrix().multiplyToRef(u,E.i.Matrix[1]),z._updateAbsoluteBindMatrices(E.i.Matrix[1])}if(this.isUsingTextureForMatrices){const u=4*(this.bones.length+1);z._transformMatrixTexture&&z._transformMatrixTexture.getSize().width===u||(z._transformMatrixTexture&&z._transformMatrixTexture.dispose(),z._transformMatrixTexture=g.e.CreateRGBATexture(z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(z._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&z._transformMatrixTexture&&z._transformMatrixTexture.update(z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=g.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let z=0;z<this.bones.length;z++)this._animatables.push(this.bones[z])}return this._animatables}clone(z,u){const Y=new o(z,u||z,this._scene);Y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){const z=this.bones[H];let u=null;const E=z.getParent();if(E){const z=this.bones.indexOf(E);u=Y.bones[z]}const J=new L.d(z.name,Y,u,z.getBindMatrix().clone(),z.getRestMatrix().clone());J._index=z._index,z._linkedTransformNode&&J.linkTransformNode(z._linkedTransformNode),h.b.DeepCopy(z.animations,J.animations)}if(this._ranges){Y._ranges={};for(const z in this._ranges){const u=this._ranges[z];u&&(Y._ranges[z]=u.clone())}}return this._isDirty=!0,Y.prepare(!0),Y}enableBlending(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const u of this.bones)for(const Y of u.animations)Y.enableBlending=!0,Y.blendingSpeed=z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.iz().stopAnimation(this),this.iz().removeSkeleton(this),this._parentContainer){const z=this._parentContainer.skeletons.indexOf(this);z>-1&&this._parentContainer.skeletons.splice(z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const z={};z.name=this.name,z.id=this.id,this.dimensionsAtRest&&(z.dimensionsAtRest=this.dimensionsAtRest.al()),z.bones=[],z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Y=0;Y<this.bones.length;Y++){var u;const H=this.bones[Y],E=H.getParent(),J={parentBoneIndex:E?this.bones.indexOf(E):-1,index:H.getIndex(),name:H.name,id:H.id,matrix:H.getBindMatrix().al(),rest:H.getRestMatrix().al(),linkedTransformNodeId:null===(u=H.getTransformNode())||void 0===u?void 0:u.id};z.bones.push(J),H.length&&(J.length=H.length),H.metadata&&(J.metadata=H.metadata),H.animations&&H.animations.length>0&&(J.animation=H.animations[0].serialize()),z.ranges=[];for(const u in this._ranges){const Y=this._ranges[u];if(!Y)continue;const H={};H.name=u,H.from=Y.from,H.to=Y.to,z.ranges.push(H)}}return z}static Parse(z,u){const Y=new o(z.name,z.id,u);let H;for(z.dimensionsAtRest&&(Y.dimensionsAtRest=E.p.Nl(z.dimensionsAtRest)),Y.needInitialSkinMatrix=z.needInitialSkinMatrix,H=0;H<z.bones.length;H++){const u=z.bones[H],J=z.bones[H].index;let l=null;u.parentBoneIndex>-1&&(l=Y.bones[u.parentBoneIndex]);const T=u.rest?E.b.Nl(u.rest):null,b=new L.d(u.name,Y,l,E.b.Nl(u.matrix),T,null,J);void 0!==u.id&&null!==u.id&&(b.id=u.id),u.length&&(b.length=u.length),u.metadata&&(b.metadata=u.metadata),u.animation&&b.animations.push(M.e.Parse(u.animation)),void 0!==u.linkedTransformNodeId&&null!==u.linkedTransformNodeId&&(Y._hasWaitingData=!0,b._waitingTransformNodeId=u.linkedTransformNodeId)}if(z.ranges)for(H=0;H<z.ranges.length;H++){const u=z.ranges[H];Y.createAnimationRange(u.name,u.from,u.to)}return Y}computeAbsoluteMatrices(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(z)}getPoseMatrix(){let z=null;return this._meshesWithPoseMatrix.length>0&&(z=this._meshesWithPoseMatrix[0].getPoseMatrix()),z}sortBones(){const z=[],u=new Array(this.bones.length);for(let Y=0;Y<this.bones.length;Y++)this._sortBones(Y,z,u);this.bones=z}_sortBones(z,u,Y){if(Y[z])return;Y[z]=!0;const H=this.bones[z];if(!H)return;void 0===H._index&&(H._index=z);const E=H.getParent();E&&this._sortBones(this.bones.indexOf(E),u,Y),u.push(H)}setCurrentPoseAsRest(){for(const z of this.bones)z.setCurrentPoseAsRest()}}var d=Y(11077),t=Y(11479),W=Y(11415),Z=Y(11218),s=Y(11103),v=Y(11298),i=Y(11229),X=Y(11267),Q=Y(11633),V=Y(11283),A=Y(12400);class x{set areUpdatesFrozen(z){z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new V.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,z||(z=C.d.LastCreatedScene),this._scene=z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=z.canUseGLVertexID&&z.textureFloat&&z.maxVertexTextureImageUnits>0&&z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return x.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?x.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(z){this._numMaxInfluencers!==z&&(this._numMaxInfluencers=z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(z){this._useTextureToStoreTargets!==z&&(this._useTextureToStoreTargets=z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var z;return x.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(z=this._scene)&&void 0!==z&&z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(z){return this._activeTargets.data[z]}getTarget(z){return this._targets[z]}getTargetByName(z){for(const u of this._targets)if(u.name===z)return u;return null}addTarget(z){this._targets.push(z),this._targetInfluenceChangedObservers.push(z.onInfluenceChanged.add((z=>{this.areUpdatesFrozen&&z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(z)}))),this._targetDataLayoutChangedObservers.push(z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(z){const u=this._targets.indexOf(z);u>=0&&(this._targets.splice(u,1),z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(u,1)[0]),z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(u,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(z)}_bind(z){z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),z.setTexture("morphTargets",this._targetStoreTexture),z.setInt("morphTargetCount",this.numInfluencers)}clone(){const z=new x(this._scene);for(const u of this._targets)z.addTarget(u.clone());return z.enablePositionMorphing=this.enablePositionMorphing,z.enableNormalMorphing=this.enableNormalMorphing,z.enableTangentMorphing=this.enableTangentMorphing,z.enableUVMorphing=this.enableUVMorphing,z.enableUV2Morphing=this.enableUV2Morphing,z.enableColorMorphing=this.enableColorMorphing,z}serialize(){const z={};z.id=this.uniqueId,z.targets=[];for(const u of this._targets)z.targets.push(u.serialize());return z}_syncActiveTargets(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const u=!!this._targetStoreTexture,Y=this.isUsingTextureForTargets;(this._mustSynchronize||u!==Y)&&(this._mustSynchronize=!1,this.synchronize());let H=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const J of this._targets)if(E++,0!==J.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=x.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(J),this._morphTargetTextureIndices[H]=E,this._tempInfluences[H++]=J.influence}this._morphTargetTextureIndices.length!==H&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,H)),this._influences&&this._influences.length===H||(this._influences=new Float32Array(H));for(let J=0;J<H;J++)this._influences[J]=this._tempInfluences[J];if(z&&this._scene)for(const J of this._scene.meshes)J.morphTargetManager===this&&(Y?J._markSubMeshesAsAttributesDirty():J._syncGeometryWithMorphTargetManager())}synchronize(){var z;if(!this._scene||this.areUpdatesFrozen)return;const u=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(z=this._targetStoreTexture)||void 0===z||z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>u.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Y of this._targets){this._supportsPositions=this._supportsPositions&&Y.hasPositions,this._supportsNormals=this._supportsNormals&&Y.hasNormals,this._supportsTangents=this._supportsTangents&&Y.hasTangents,this._supportsUVs=this._supportsUVs&&Y.hasUVs,this._supportsUV2s=this._supportsUV2s&&Y.hasUV2s,this._supportsColors=this._supportsColors&&Y.hasColors;const z=Y.vertexCount;if(0===this._vertexCount)this._vertexCount=z;else if(this._vertexCount!==z)return void K.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Y.name}": ${z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const z=u.getCaps().maxTextureSize;this._textureWidth>z&&(this._textureHeight=Math.ceil(this._textureWidth/z),this._textureWidth=z);const Y=this._targets.length,H=new Float32Array(Y*this._textureWidth*this._textureHeight*4);let E=0;for(let u=0;u<Y;u++){const z=this._targets[u],Y=z.getPositions(),J=z.getNormals(),l=z.getUVs(),T=z.getTangents(),b=z.getUV2s(),L=z.getColors();E=u*this._textureWidth*this._textureHeight*4;for(let u=0;u<this._vertexCount;u++)this._supportsPositions&&Y&&(H[E]=Y[3*u],H[E+1]=Y[3*u+1],H[E+2]=Y[3*u+2],E+=4),this._supportsNormals&&J&&(H[E]=J[3*u],H[E+1]=J[3*u+1],H[E+2]=J[3*u+2],E+=4),this._supportsUVs&&l&&(H[E]=l[2*u],H[E+1]=l[2*u+1],E+=4),this._supportsTangents&&T&&(H[E]=T[3*u],H[E+1]=T[3*u+1],H[E+2]=T[3*u+2],E+=4),this._supportsUV2s&&b&&(H[E]=b[2*u],H[E+1]=b[2*u+1],E+=4),this._supportsColors&&L&&(H[E]=L[4*u],H[E+1]=L[4*u+1],H[E+2]=L[4*u+2],H[E+3]=L[4*u+3],E+=4)}this._targetStoreTexture=A.c.CreateRGBATexture(H,this._textureWidth,this._textureHeight,Y,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Y of this._scene.meshes)Y.morphTargetManager===this&&Y._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const z=this._parentContainer.morphTargetManagers.indexOf(this);z>-1&&this._parentContainer.morphTargetManagers.splice(z,1),this._parentContainer=null}for(const z of this._targets)this._scene.stopAnimation(z)}}static Parse(z,u){const Y=new x(u);for(const H of z.targets)Y.addTarget(Q.d.Parse(H,u));return Y}}x.EnableTextureStorage=!0,x.MaxActiveMorphTargetsInVertexAttributeMode=8,x.ConstantTargetCountForTextureMode=0;var G=Y(12459),F=Y(10980),R=Y(11131);const w=new Map,c=w;function U(z,u,Y){O(z)&&K.b.Warn(`Extension with the name '${z}' already exists`),w.set(z,{isGLTFExtension:u,factory:Y})}function O(z){return w.delete(z)}var n=Y(12476),m=Y(11682),p=Y(11117);class S{static Get(z,u,Y){if(!u||void 0==Y||!u[Y])throw new Error(`${z}: Failed to find index (${Y})`);return u[Y]}static TryGet(z,u){return z&&void 0!=u&&z[u]?z[u]:null}static Assign(z){if(z)for(let u=0;u<z.length;u++)z[u].index=u}}function I(z){if(z.min&&z.max){const u=z.min,Y=z.max,H=E.i.Pl[0].kl(u[0],u[1],u[2]),J=E.i.Pl[1].kl(Y[0],Y[1],Y[2]);if(z.normalized&&5126!==z.componentType){let u=1;switch(z.componentType){case 5120:u=127;break;case 5121:u=255;break;case 5122:u=32767;break;case 5123:u=65535}const Y=1/u;H.scaleInPlace(Y),J.scaleInPlace(Y)}return new R.e(H,J)}return null}class y{static RegisterExtension(z,u){U(z,!1,u)}static UnregisterExtension(z){return O(z)}get zT(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((z=>z.dispose&&z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(z,u,Y,H,E,J){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=u,this._assetContainer=Y,this._loadData(H);let J=null;if(z){const u={};if(this._gltf.nodes)for(const z of this._gltf.nodes)z.name&&(u[z.name]=z.index);J=(z instanceof Array?z:[z]).map((z=>{const Y=u[z];if(void 0===Y)throw new Error(`Failed to find node '${z}'`);return Y}))}return await this._loadAsync(E,l,J,(()=>({meshes:this._getMeshes(),QM:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=z,this._loadData(u),await this._loadAsync(Y,E,null,(()=>{}))}async _loadAsync(z,u,Y,H){return await Promise.resolve().then((async()=>{this._rootUrl=z,this._uniqueRootUrl=!z.startsWith("file:")&&u?z:`${z}${Date.now()}/`,this._fileName=u,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${G.l[G.l.LOADING]} => ${G.l[G.l.READY]}`,J=`${G.l[G.l.LOADING]} => ${G.l[G.l.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(J),this._parent._setState(G.l.LOADING),this._extensionsOnLoading();const T=new Array;if(!this.parent.loadOnlyMaterials)if(Y)T.push(this.loadSceneAsync("/nodes",{nodes:Y,index:-1}));else if(void 0!=this._gltf.Cu||this._gltf.scenes&&this._gltf.scenes[0]){const z=S.Get("/scene",this._gltf.scenes,this._gltf.Cu||0);T.push(this.loadSceneAsync(`/scenes/${z.index}`,z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let z=0;z<this._gltf.materials.length;++z){const u=this._gltf.materials[z],Y="/materials/"+z,H=d.d.TriangleFillMode;T.push(this._loadMaterialAsync(Y,u,null,H,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&T.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&T.push(this._compileShadowGeneratorsAsync());const b=Promise.all(T).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.oT(!0);for(const z of this._babylonScene.materials){const u=z;void 0!==u.maxSimultaneousLights&&(u.maxSimultaneousLights=Math.max(u.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(G.l.READY),this._skipStartAnimationStep||this._startAnimations(),H()}));return await b.then((z=>(this._parent._endPerformanceCounter(E),l.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(J),this._parent._setState(G.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(z=>{this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()}))})),z)))})).catch((z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()),z}))}_loadData(z){if(this._gltf=z.json,this._setupData(),z.bin){const u=this._gltf.buffers;if(u&&u[0]&&!u[0].uri){const Y=u[0];(Y.byteLength<z.bin.byteLength-3||Y.byteLength>z.bin.byteLength)&&K.b.Warn(`Binary buffer length (${Y.byteLength}) from JSON does not match chunk length (${z.bin.byteLength})`),this._bin=z.bin}else K.b.Warn("Unexpected BIN chunk")}}_setupData(){if(S.Assign(this._gltf.accessors),S.Assign(this._gltf.animations),S.Assign(this._gltf.buffers),S.Assign(this._gltf.bufferViews),S.Assign(this._gltf.cameras),S.Assign(this._gltf.images),S.Assign(this._gltf.materials),S.Assign(this._gltf.meshes),S.Assign(this._gltf.nodes),S.Assign(this._gltf.samplers),S.Assign(this._gltf.scenes),S.Assign(this._gltf.skins),S.Assign(this._gltf.textures),this._gltf.nodes){const z={};for(const Y of this._gltf.nodes)if(Y.children)for(const u of Y.children)z[u]=Y.index;const u=this._createRootNode();for(const Y of this._gltf.nodes){const H=z[Y.index];Y.parent=void 0===H?u:this._gltf.nodes[H]}}}async _loadExtensionsAsync(){const z=[];if(c.forEach(((u,Y)=>{var H;!1===(null===(H=this.parent.extensionOptions[Y])||void 0===H?void 0:H.enabled)?u.isGLTFExtension&&this.isExtensionUsed(Y)&&K.b.Warn(`Extension ${Y} is used but has been explicitly disabled.`):u.isGLTFExtension&&!this.isExtensionUsed(Y)||z.push((async()=>{const z=await u.factory(this);return z.name!==Y&&K.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${z.name} !== ${Y}`),this._parent.onExtensionLoadedObservable.notifyObservers(z),z})())})),this._extensions.push(...await Promise.all(z)),this._extensions.sort(((z,u)=>(z.order||Number.MAX_VALUE)-(u.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Y of this._gltf.extensionsRequired){if(!this._extensions.some((z=>z.name===Y&&z.enabled))){var u;if(!1===(null===(u=this.parent.extensionOptions[Y])||void 0===u?void 0:u.enabled))throw new Error(`Required extension ${Y} is disabled`);throw new Error(`Required extension ${Y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new X.b("__root__",this._babylonScene);this._rootBabylonMesh=z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.oT(!1);const u={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case G.i.AUTO:this._babylonScene.useRightHandedSystem||(u.rotation=[0,1,0,0],u.scale=[1,1,-1],y._LoadTransform(u,this._rootBabylonMesh));break;case G.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(z),u}loadSceneAsync(z,u){const Y=this._extensionsLoadSceneAsync(z,u);if(Y)return Y;const H=new Array;if(this.logOpen(`${z} ${u.name||""}`),u.nodes)for(const E of u.nodes){const u=S.Get(`${z}/nodes/${E}`,this._gltf.nodes,E);H.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(z=>{z.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return H.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(H).then((()=>{}))}_forEachPrimitive(z,u){if(z._primitiveBabylonMeshes)for(const Y of z._primitiveBabylonMeshes)u(Y)}_getGeometries(){const z=[],u=this._gltf.nodes;if(u)for(const Y of u)this._forEachPrimitive(Y,(u=>{const Y=u.Sl;Y&&-1===z.indexOf(Y)&&z.push(Y)}));return z}_getMeshes(){const z=[];this._rootBabylonMesh instanceof i.b&&z.push(this._rootBabylonMesh);const u=this._gltf.nodes;if(u)for(const Y of u)this._forEachPrimitive(Y,(u=>{z.push(u)}));return z}_getTransformNodes(){const z=[],u=this._gltf.nodes;if(u)for(const Y of u)Y._babylonTransformNode&&"ub"===Y._babylonTransformNode.getClassName()&&z.push(Y._babylonTransformNode),Y._babylonTransformNodeForSkin&&z.push(Y._babylonTransformNodeForSkin);return z}_getSkeletons(){const z=[],u=this._gltf.skins;if(u)for(const Y of u)Y._data&&z.push(Y._data.babylonSkeleton);return z}_getAnimationGroups(){const z=[],u=this._gltf.animations;if(u)for(const Y of u)Y._babylonAnimationGroup&&z.push(Y._babylonAnimationGroup);return z}_startAnimations(){switch(this._parent.animationStartMode){case G.g.NONE:break;case G.g.FIRST:{const z=this._getAnimationGroups();0!==z.length&&z[0].start(!0);break}case G.g.ALL:{const z=this._getAnimationGroups();for(const u of z)u.start(!0);break}default:return void K.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadNodeAsync(z,u,Y);if(H)return H;if(u._babylonTransformNode)throw new Error(`${z}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${z} ${u.name||""}`);const J=H=>{if(y.AddPointerMetadata(H,z),y._LoadTransform(u,H),void 0!=u.camera){const Y=S.Get(`${z}/camera`,this._gltf.cameras,u.camera);E.push(this.loadCameraAsync(`/cameras/${Y.index}`,Y,(z=>{z.parent=H,this._babylonScene.useRightHandedSystem||(H.el.x=-1)})))}if(u.children)for(const Y of u.children){const u=S.Get(`${z}/children/${Y}`,this._gltf.nodes,Y);E.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(z=>{z.parent=H})))}Y(H)},l=void 0!=u.mesh,T=this._parent.loadSkins&&void 0!=u.skin;if(!l||T){const z=u.name||`node${u.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new Z.d(z,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==u.mesh?u._babylonTransformNode=Y:u._babylonTransformNodeForSkin=Y,J(Y)}if(l)if(T){const Y=S.Get(`${z}/mesh`,this._gltf.meshes,u.mesh);E.push(this._loadMeshAsync(`/meshes/${Y.index}`,u,Y,(Y=>{const H=u._babylonTransformNodeForSkin;Y.metadata=(0,m.e)(H.metadata,Y.metadata||{});const J=S.Get(`${z}/skin`,this._gltf.skins,u.skin);E.push(this._loadSkinAsync(`/skins/${J.index}`,u,J,(z=>{this._forEachPrimitive(u,(u=>{u.skeleton=z})),this._postSceneLoadActions.push((()=>{if(void 0!=J.skeleton){const z=S.Get(`/skins/${J.index}/skeleton`,this._gltf.nodes,J.skeleton).parent;u.index===z.index?Y.parent=H.parent:Y.parent=z._babylonTransformNode}else Y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:H,skinnedNode:Y})}))})))})))}else{const Y=S.Get(`${z}/mesh`,this._gltf.meshes,u.mesh);E.push(this._loadMeshAsync(`/meshes/${Y.index}`,u,Y,J))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(u,(z=>{const u=z;!u.isAnInstance&&u.Sl&&u.Sl.useBoundingInfoFromGeometry?z.wz():z.refreshBoundingInfo(!0,!0)})),u._babylonTransformNode)))}_loadMeshAsync(z,u,Y,H){const E=Y.primitives;if(!E||!E.length)throw new Error(`${z}: Primitives are missing`);void 0==E[0].index&&S.Assign(E);const J=new Array;this.logOpen(`${z} ${Y.name||""}`);const l=u.name||`node${u.index}`;if(1===E.length){const H=Y.primitives[0];J.push(this._loadMeshPrimitiveAsync(`${z}/primitives/${H.index}`,l,u,Y,H,(z=>{u._babylonTransformNode=z,u._primitiveBabylonMeshes=[z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,u._babylonTransformNode=new Z.d(l,this._babylonScene),u._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._primitiveBabylonMeshes=[];for(const H of E)J.push(this._loadMeshPrimitiveAsync(`${z}/primitives/${H.index}`,`${l}_primitive${H.index}`,u,Y,H,(z=>{z.parent=u._babylonTransformNode,u._primitiveBabylonMeshes.push(z)})))}return H(u._babylonTransformNode),this.logClose(),Promise.all(J).then((()=>u._babylonTransformNode))}_loadMeshPrimitiveAsync(z,u,Y,H,E,J){const l=this._extensionsLoadMeshPrimitiveAsync(z,u,Y,H,E,J);if(l)return l;this.logOpen(`${z}`);const T=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Y.skin&&!H.primitives[0].targets;let b,L;if(T&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,b=E._instanceData.babylonSourceMesh.createInstance(u),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L=E._instanceData.promise;else{const J=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new X.b(u,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.sideOrientation=this._babylonScene.useRightHandedSystem?d.d.CounterClockWiseSideOrientation:d.d.ClockWiseSideOrientation,this._createMorphTargets(z,Y,H,E,l),J.push(this._loadVertexDataAsync(z,E,l).then((async u=>await this._loadMorphTargetsAsync(z,E,l,u).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,u.Fz(l),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const D=y._GetDrawMode(z,E.mode);if(void 0==E.material){let z=this._defaultBabylonMaterialData[D];z||(z=this._createDefaultMaterial("__GLTFLoader._default",D),this._parent.onMaterialLoadedObservable.notifyObservers(z),this._defaultBabylonMaterialData[D]=z),l.material=z}else if(!this.parent.skipMaterials){const u=S.Get(`${z}/material`,this._gltf.materials,E.material);J.push(this._loadMaterialAsync(`/materials/${u.index}`,u,l,D,(z=>{l.material=z})))}L=Promise.all(J),T&&(E._instanceData={babylonSourceMesh:l,promise:L}),b=l}return y.AddPointerMetadata(b,z),this._parent.onMeshLoadedObservable.notifyObservers(b),J(b),this.logClose(),L.then((()=>b))}_loadVertexDataAsync(z,u,Y){const H=this._extensionsLoadVertexDataAsync(z,u,Y);if(H)return H;const E=u.attributes;if(!E)throw new Error(`${z}: Attributes are missing`);const J=new Array,l=new v.b(Y.name,this._babylonScene);if(void 0==u.indices)Y.isUnIndexed=!0;else{const Y=S.Get(`${z}/indices`,this._gltf.accessors,u.indices);J.push(this._loadIndicesAccessorAsync(`/accessors/${Y.index}`,Y).then((z=>{l.setIndices(z)})))}const T=(u,H,T)=>{if(void 0==E[u])return;Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(H)&&Y._delayInfo.push(H);const b=S.Get(`${z}/attributes/${u}`,this._gltf.accessors,E[u]);J.push(this._loadVertexAccessorAsync(`/accessors/${b.index}`,b,H).then((z=>{if(z.getKind()===s.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Y.skeleton){const z=I(b);z&&(l._boundingInfo=z,l.useBoundingInfoFromGeometry=!0)}l.setVerticesBuffer(z,b.count)}))),H==s.f.MatricesIndicesExtraKind&&(Y.numBoneInfluencers=8),T&&T(b)};return T("POSITION",s.f.PositionKind),T("NORMAL",s.f.NormalKind),T("TANGENT",s.f.TangentKind),T("TEXCOORD_0",s.f.UVKind),T("TEXCOORD_1",s.f.UV2Kind),T("TEXCOORD_2",s.f.UV3Kind),T("TEXCOORD_3",s.f.UV4Kind),T("TEXCOORD_4",s.f.UV5Kind),T("TEXCOORD_5",s.f.UV6Kind),T("JOINTS_0",s.f.MatricesIndicesKind),T("WEIGHTS_0",s.f.MatricesWeightsKind),T("JOINTS_1",s.f.MatricesIndicesExtraKind),T("WEIGHTS_1",s.f.MatricesWeightsExtraKind),T("COLOR_0",s.f.ColorKind,(z=>{"VEC4"===z.type&&(Y.hasVertexAlpha=!0)})),Promise.all(J).then((()=>l))}_createMorphTargets(z,u,Y,H,E){if(!H.targets||!this._parent.loadMorphTargets)return;if(void 0==u._numMorphTargets)u._numMorphTargets=H.targets.length;else if(H.targets.length!==u._numMorphTargets)throw new Error(`${z}: Primitives do not have the same number of targets`);const J=Y.extras?Y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new x(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let l=0;l<H.targets.length;l++){const z=u.weights?u.weights[l]:Y.weights?Y.weights[l]:0,H=J?J[l]:`morphTarget${l}`;E.morphTargetManager.addTarget(new Q.d(H,z,E.iz()))}}_loadMorphTargetsAsync(z,u,Y,H){if(!u.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,J=Y.morphTargetManager;for(let l=0;l<J.numTargets;l++){const Y=J.getTarget(l);E.push(this._loadMorphTargetVertexDataAsync(`${z}/targets/${l}`,H,u.targets[l],Y))}return Promise.all(E).then((()=>{J.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(z,u,Y,H){const E=new Array,J=(H,J,l)=>{if(void 0==Y[H])return;const T=u.getVertexBuffer(J);if(!T)return;const b=S.Get(`${z}/${H}`,this._gltf.accessors,Y[H]);E.push(this._loadFloatAccessorAsync(`/accessors/${b.index}`,b).then((z=>{l(T,z)})))};return J("POSITION",s.f.PositionKind,((z,u)=>{const Y=new Float32Array(u.length);z.forEach(u.length,((z,H)=>{Y[H]=u[H]+z})),H.setPositions(Y)})),J("NORMAL",s.f.NormalKind,((z,u)=>{const Y=new Float32Array(u.length);z.forEach(Y.length,((z,H)=>{Y[H]=u[H]+z})),H.setNormals(Y)})),J("TANGENT",s.f.TangentKind,((z,u)=>{const Y=new Float32Array(u.length/3*4);let E=0;z.forEach(u.length/3*4,((z,H)=>{(H+1)%4!==0&&(Y[E]=u[E]+z,E++)})),H.setTangents(Y)})),J("TEXCOORD_0",s.f.UVKind,((z,u)=>{const Y=new Float32Array(u.length);z.forEach(u.length,((z,H)=>{Y[H]=u[H]+z})),H.setUVs(Y)})),J("TEXCOORD_1",s.f.UV2Kind,((z,u)=>{const Y=new Float32Array(u.length);z.forEach(u.length,((z,H)=>{Y[H]=u[H]+z})),H.setUV2s(Y)})),J("COLOR_0",s.f.ColorKind,((u,Y)=>{let E=null;const J=u.getSize();if(3===J){E=new Float32Array(Y.length/3*4),u.forEach(Y.length,((z,u)=>{const H=Math.floor(u/3),J=u%3;E[4*H+J]=Y[3*H+J]+z}));for(let z=0;z<Y.length/3;++z)E[4*z+3]=1}else{if(4!==J)throw new Error(`${z}: Invalid number of components (${J}) for COLOR_0 attribute`);E=new Float32Array(Y.length),u.forEach(Y.length,((z,u)=>{E[u]=Y[u]+z}))}H.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(z,u){if(void 0!=z.skin)return;let Y=E.p.Zero(),H=E.f.Identity(),J=E.p.One();if(z.matrix){E.b.Nl(z.matrix).decompose(J,H,Y)}else z.translation&&(Y=E.p.Nl(z.translation)),z.rotation&&(H=E.f.Nl(z.rotation)),z.scale&&(J=E.p.Nl(z.scale));u.position=Y,u.rotationQuaternion=H,u.el=J}_loadSkinAsync(z,u,Y,H){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(z,u,Y);if(E)return E;if(Y._data)return H(Y._data.babylonSkeleton),Y._data.promise;const J=`skeleton${Y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new o(Y.name||J,J,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(z,Y,l);const T=this._loadSkinInverseBindMatricesDataAsync(z,Y).then((z=>{this._updateBoneMatrices(l,z)}));return Y._data={babylonSkeleton:l,promise:T},H(l),T}_loadBones(z,u,Y){if(void 0==u.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Y=this._findSkeletonRootNode(`${z}/joints`,u.joints);if(Y)if(void 0===u.skeleton)u.skeleton=Y.index;else{const H=(z,u)=>{for(;u.parent;u=u.parent)if(u.parent===z)return!0;return!1},E=S.Get(`${z}/skeleton`,this._gltf.nodes,u.skeleton);E===Y||H(E,Y)||(K.b.Warn(`${z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),u.skeleton=Y.index)}else K.b.Warn(`${z}: Failed to find common root`)}const H={};for(const E of u.joints){const J=S.Get(`${z}/joints/${E}`,this._gltf.nodes,E);this._loadBone(J,u,Y,H)}}_findSkeletonRootNode(z,u){if(0===u.length)return null;const Y={};for(const E of u){const u=[];let H=S.Get(`${z}/${E}`,this._gltf.nodes,E);for(;-1!==H.index;)u.unshift(H),H=H.parent;Y[E]=u}let H=null;for(let E=0;;++E){let z=Y[u[0]];if(E>=z.length)return H;const J=z[E];for(let l=1;l<u.length;++l)if(z=Y[u[l]],E>=z.length||J!==z[E])return H;H=J}}_loadBone(z,u,Y,H){z._isJoint=!0;let E=H[z.index];if(E)return E;let J=null;z.index!==u.skeleton&&(z.parent&&-1!==z.parent.index?J=this._loadBone(z.parent,u,Y,H):void 0!==u.skeleton&&K.b.Warn(`/skins/${u.index}/skeleton: Skeleton node is not a common root`));const l=u.joints.indexOf(z.index);return E=new L.d(z.name||`joint${z.index}`,Y,J,this._getNodeMatrix(z),null,null,l),H[z.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(z._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(z,u){if(void 0==u.inverseBindMatrices)return Promise.resolve(null);const Y=S.Get(`${z}/inverseBindMatrices`,this._gltf.accessors,u.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y)}_updateBoneMatrices(z,u){for(const Y of z.bones){const z=E.b.Identity(),H=Y._index;u&&-1!==H&&(E.b.FromArrayToRef(u,16*H,z),z.invertToRef(z));const J=Y.getParent();J&&z.multiplyToRef(J.getAbsoluteInverseBindMatrix(),z),Y.rl(z,!1,!1),Y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(z){return z.matrix?E.b.Nl(z.matrix):E.b.Compose(z.scale?E.p.Nl(z.scale):E.p.One(),z.rotation?E.f.Nl(z.rotation):E.f.Identity(),z.translation?E.p.Nl(z.translation):E.p.Zero())}loadCameraAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadCameraAsync(z,u,Y);if(H)return H;const J=new Array;this.logOpen(`${z} ${u.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new b.c(u.name||`camera${u.index}`,E.p.Zero(),this._babylonScene,!1);switch(l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonCamera=l,l.setTarget(new E.p(0,0,-1)),u.type){case"perspective":{const Y=u.perspective;if(!Y)throw new Error(`${z}: Camera perspective properties are missing`);l.fov=Y.yfov,l.uT=Y.znear,l.maxZ=Y.zfar||0;break}case"orthographic":if(!u.orthographic)throw new Error(`${z}: Camera orthographic properties are missing`);l.mode=T.d.ORTHOGRAPHIC_CAMERA,l.orthoLeft=-u.orthographic.xmag,l.orthoRight=u.orthographic.xmag,l.orthoBottom=-u.orthographic.ymag,l.orthoTop=u.orthographic.ymag,l.uT=u.orthographic.znear,l.maxZ=u.orthographic.zfar;break;default:throw new Error(`${z}: Invalid camera type (${u.type})`)}return y.AddPointerMetadata(l,z),this._parent.onCameraLoadedObservable.notifyObservers(l),Y(l),this.logClose(),Promise.all(J).then((()=>l))}_loadAnimationsAsync(){const z=this._gltf.animations;if(!z)return Promise.resolve();const u=new Array;for(let Y=0;Y<z.length;Y++){const H=z[Y];u.push(this.loadAnimationAsync(`/animations/${H.index}`,H).then((z=>{0===z.targetedAnimations.length&&z.dispose()})))}return Promise.all(u).then((()=>{}))}loadAnimationAsync(z,u){const H=this._extensionsLoadAnimationAsync(z,u);return H||Y.e(58).then(Y.bind(Y,13920)).then((Y=>{let{AnimationGroup:H}=Y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new H(u.name||`animation${u.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonAnimationGroup=E;const J=new Array;S.Assign(u.channels),S.Assign(u.samplers);for(const l of u.channels)J.push(this._loadAnimationChannelAsync(`${z}/channels/${l.index}`,z,u,l,((z,u)=>{z.animations=z.animations||[],z.animations.push(u),E.addTargetedAnimation(u,z)})));return Promise.all(J).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(z,u,H,E,J){const l=this._extensionsLoadAnimationChannelAsync(z,u,H,E,J);if(l)return await l;if(void 0==E.target.node)return await Promise.resolve();const T=S.Get(`${z}/target/node`,this._gltf.nodes,E.target.node),b=E.target.path,L="weights"===b;if(L&&!T._numMorphTargets||!L&&!T._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!L&&!T._isJoint)return await Promise.resolve();let D;switch(await Promise.resolve().then(Y.bind(Y,12485)),b){case"translation":var g;D=null===(g=(0,n.f)("/nodes/{}/translation"))||void 0===g?void 0:g.interpolation;break;case"rotation":var M;D=null===(M=(0,n.f)("/nodes/{}/rotation"))||void 0===M?void 0:M.interpolation;break;case"scale":var q;D=null===(q=(0,n.f)("/nodes/{}/scale"))||void 0===q?void 0:q.interpolation;break;case"weights":var C;D=null===(C=(0,n.f)("/nodes/{}/weights"))||void 0===C?void 0:C.interpolation;break;default:throw new Error(`${z}/target/path: Invalid value (${E.target.path})`)}if(!D)throw new Error(`${z}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const K={object:T,info:D};return await this._loadAnimationChannelFromTargetInfoAsync(z,u,H,E,K,J)}_loadAnimationChannelFromTargetInfoAsync(z,u,Y,H,E,J){const l=this.parent.targetFps,T=1/l,b=S.Get(`${z}/sampler`,Y.samplers,H.sampler);return this._loadAnimationSamplerAsync(`${u}/samplers/${H.sampler}`,b).then((z=>{let u=0;const b=E.object,L=E.info;for(const E of L){const L=E.getStride(b),D=z.input,g=z.output,M=new Array(D.length);let q=0;switch(z.interpolation){case"STEP":for(let z=0;z<D.length;z++){const u=E.getValue(b,g,q,1);q+=L,M[z]={frame:D[z]*l,value:u,interpolation:1}}break;case"CUBICSPLINE":for(let z=0;z<D.length;z++){const u=E.getValue(b,g,q,T);q+=L;const Y=E.getValue(b,g,q,1);q+=L;const H=E.getValue(b,g,q,T);q+=L,M[z]={frame:D[z]*l,inTangent:u,value:Y,outTangent:H}}break;case"LINEAR":for(let z=0;z<D.length;z++){const u=E.getValue(b,g,q,1);q+=L,M[z]={frame:D[z]*l,value:u}}}if(q>0){const z=`${Y.name||`animation${Y.index}`}_channel${H.index}_${u}`,T=E.buildAnimations(b,z,l,M);for(const Y of T)u++,J(Y.babylonAnimatable,Y.babylonAnimation)}}}))}_loadAnimationSamplerAsync(z,u){if(u._data)return u._data;const Y=u.interpolation||"LINEAR";switch(Y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${z}/interpolation: Invalid value (${u.interpolation})`)}const H=S.Get(`${z}/input`,this._gltf.accessors,u.input),E=S.Get(`${z}/output`,this._gltf.accessors,u.output);return u._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${H.index}`,H),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((z=>{let[u,H]=z;return{input:u,interpolation:Y,output:H}})),u._data}loadBufferAsync(z,u,Y,H){const E=this._extensionsLoadBufferAsync(z,u,Y,H);if(E)return E;if(!u._data)if(u.uri)u._data=this.loadUriAsync(`${z}/uri`,u,u.uri);else{if(!this._bin)throw new Error(`${z}: Uri is missing or the binary glTF is missing its binary chunk`);u._data=this._bin.readAsync(0,u.byteLength)}return u._data.then((u=>{try{return new Uint8Array(u.buffer,u.byteOffset+Y,H)}catch(E){throw new Error(`${z}: ${E.message}`)}}))}loadBufferViewAsync(z,u){const Y=this._extensionsLoadBufferViewAsync(z,u);if(Y)return Y;if(u._data)return u._data;const H=S.Get(`${z}/buffer`,this._gltf.buffers,u.buffer);return u._data=this.loadBufferAsync(`/buffers/${H.index}`,H,u.byteOffset||0,u.byteLength),u._data}_loadAccessorAsync(z,u,Y){if(u._data)return u._data;const H=y._GetNumComponents(z,u.type),E=H*s.f.GetTypeByteLength(u.componentType),J=H*u.count;if(void 0==u.bufferView)u._data=Promise.resolve(new Y(J));else{const l=S.Get(`${z}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((T=>{if(5126!==u.componentType||u.normalized||l.byteStride&&l.byteStride!==E){const z=new Y(J);return s.f.ForEach(T,u.byteOffset||0,l.byteStride||E,H,u.componentType,z.length,u.normalized||!1,((u,Y)=>{z[Y]=u})),z}return y._GetTypedArray(z,u.componentType,T,u.byteOffset,J)}))}if(u.sparse){const J=u.sparse;u._data=u._data.then((l=>{const T=l,b=S.Get(`${z}/sparse/indices/bufferView`,this._gltf.bufferViews,J.indices.bufferView),L=S.Get(`${z}/sparse/values/bufferView`,this._gltf.bufferViews,J.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${b.index}`,b),this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)]).then((l=>{let[b,L]=l;const D=y._GetTypedArray(`${z}/sparse/indices`,J.indices.componentType,b,J.indices.byteOffset,J.count),g=H*J.count;let M;if(5126!==u.componentType||u.normalized){const l=y._GetTypedArray(`${z}/sparse/values`,u.componentType,L,J.values.byteOffset,g);M=new Y(g),s.f.ForEach(l,0,E,H,u.componentType,M.length,u.normalized||!1,((z,u)=>{M[u]=z}))}else M=y._GetTypedArray(`${z}/sparse/values`,u.componentType,L,J.values.byteOffset,g);let q=0;for(let z=0;z<D.length;z++){let u=D[z]*H;for(let z=0;z<H;z++)T[u++]=M[q++]}return T}))}))}return u._data}_loadFloatAccessorAsync(z,u){return this._loadAccessorAsync(z,u,Float32Array)}_loadIndicesAccessorAsync(z,u){if("SCALAR"!==u.type)throw new Error(`${z}/type: Invalid value ${u.type}`);if(5121!==u.componentType&&5123!==u.componentType&&5125!==u.componentType)throw new Error(`${z}/componentType: Invalid value ${u.componentType}`);if(u._data)return u._data;if(u.sparse){const Y=y._GetTypedArrayConstructor(`${z}/componentType`,u.componentType);u._data=this._loadAccessorAsync(z,u,Y)}else{const Y=S.Get(`${z}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((Y=>y._GetTypedArray(z,u.componentType,Y,u.byteOffset,u.count)))}return u._data}_loadVertexBufferViewAsync(z){if(z._babylonBuffer)return z._babylonBuffer;const u=this._babylonScene.getEngine();return z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((z=>new s.d(u,z,!1))),z._babylonBuffer}_loadVertexAccessorAsync(z,u,Y){var H;if(null!==(H=u._babylonVertexBuffer)&&void 0!==H&&H[Y])return u._babylonVertexBuffer[Y];u._babylonVertexBuffer||(u._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(u.sparse||void 0==u.bufferView)u._babylonVertexBuffer[Y]=this._loadFloatAccessorAsync(z,u).then((z=>new s.f(E,z,Y,!1)));else{const H=S.Get(`${z}/bufferView`,this._gltf.bufferViews,u.bufferView);u._babylonVertexBuffer[Y]=this._loadVertexBufferViewAsync(H).then((J=>{const l=y._GetNumComponents(z,u.type);return new s.f(E,J,Y,!1,void 0,H.byteStride,void 0,u.byteOffset,l,u.componentType,u.normalized,!0,void 0,!0)}))}return u._babylonVertexBuffer[Y]}_loadMaterialMetallicRoughnessPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return u&&(u.baseColorFactor?(Y.albedoColor=J.c.Nl(u.baseColorFactor),Y.alpha=u.baseColorFactor[3]):Y.albedoColor=J.c.White(),Y.metallic=void 0==u.metallicFactor?1:u.metallicFactor,Y.roughness=void 0==u.roughnessFactor?1:u.roughnessFactor,u.baseColorTexture&&H.push(this.loadTextureInfoAsync(`${z}/baseColorTexture`,u.baseColorTexture,(z=>{z.name=`${Y.name} (Base Color)`,Y.albedoTexture=z}))),u.metallicRoughnessTexture&&(u.metallicRoughnessTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${z}/metallicRoughnessTexture`,u.metallicRoughnessTexture,(z=>{z.name=`${Y.name} (Metallic Roughness)`,Y.metallicTexture=z}))),Y.useMetallnessFromMetallicTextureBlue=!0,Y.useRoughnessFromMetallicTextureGreen=!0,Y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(H).then((()=>{}))}_loadMaterialAsync(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const J=this._extensionsLoadMaterialAsync(z,u,Y,H,E);if(J)return J;u._data=u._data||{};let l=u._data[H];if(!l){this.logOpen(`${z} ${u.name||""}`);const Y=this.createMaterial(z,u,H);l={babylonMaterial:Y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(z,u,Y)},u._data[H]=l,y.AddPointerMetadata(Y,z),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this.logClose()}return Y&&(l.babylonMeshes.push(Y),Y.fl.addOnce((()=>{const z=l.babylonMeshes.indexOf(Y);-1!==z&&l.babylonMeshes.splice(z,1)}))),E(l.babylonMaterial),l.promise.then((()=>l.babylonMaterial))}_createDefaultMaterial(z,u){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new t.c(z,this._babylonScene);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.fillMode=u,Y.enableSpecularAntiAliasing=!0,Y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Y.transparencyMode=t.c.PBRMATERIAL_OPAQUE,Y.metallic=1,Y.roughness=1,Y}createMaterial(z,u,Y){const H=this._extensionsCreateMaterial(z,u,Y);if(H)return H;const E=u.name||`material${u.index}`;return this._createDefaultMaterial(E,Y)}loadMaterialPropertiesAsync(z,u,Y){const H=this._extensionsLoadMaterialPropertiesAsync(z,u,Y);if(H)return H;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(z,u,Y)),u.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${z}/pbrMetallicRoughness`,u.pbrMetallicRoughness,Y)),this.loadMaterialAlphaProperties(z,u,Y),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.emissiveColor=u.emissiveFactor?J.c.Nl(u.emissiveFactor):new J.c(0,0,0),u.doubleSided&&(Y.yl=!1,Y.twoSidedLighting=!0),u.normalTexture&&(u.normalTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${z}/normalTexture`,u.normalTexture,(z=>{z.name=`${Y.name} (Normal)`,Y.bumpTexture=z}))),Y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=u.normalTexture.scale&&Y.bumpTexture&&(Y.bumpTexture.level=u.normalTexture.scale),Y.forceIrradianceInFragment=!0),u.occlusionTexture&&(u.occlusionTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${z}/occlusionTexture`,u.occlusionTexture,(z=>{z.name=`${Y.name} (Occlusion)`,Y.ambientTexture=z}))),Y.useAmbientInGrayScale=!0,void 0!=u.occlusionTexture.strength&&(Y.ambientTextureStrength=u.occlusionTexture.strength)),u.emissiveTexture&&H.push(this.loadTextureInfoAsync(`${z}/emissiveTexture`,u.emissiveTexture,(z=>{z.name=`${Y.name} (Emissive)`,Y.emissiveTexture=z}))),Promise.all(H).then((()=>{}))}loadMaterialAlphaProperties(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);switch(u.alphaMode||"OPAQUE"){case"OPAQUE":Y.transparencyMode=t.c.PBRMATERIAL_OPAQUE,Y.alpha=1;break;case"MASK":Y.transparencyMode=t.c.PBRMATERIAL_ALPHATEST,Y.alphaCutOff=void 0==u.alphaCutoff?.5:u.alphaCutoff,Y.albedoTexture&&(Y.albedoTexture.jl=!0);break;case"BLEND":Y.transparencyMode=t.c.PBRMATERIAL_ALPHABLEND,Y.albedoTexture&&(Y.albedoTexture.jl=!0,Y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${z}/alphaMode: Invalid value (${u.alphaMode})`)}}loadTextureInfoAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureInfoAsync(z,u,Y);if(H)return H;if(this.logOpen(`${z}`),u.texCoord>=6)throw new Error(`${z}/texCoord: Invalid value (${u.texCoord})`);const E=S.Get(`${z}/index`,this._gltf.textures,u.index);E._textureInfo=u;const J=this._loadTextureAsync(`/textures/${u.index}`,E,(H=>{H.coordinatesIndex=u.texCoord||0,y.AddPointerMetadata(H,z),this._parent.onTextureLoadedObservable.notifyObservers(H),Y(H)}));return this.logClose(),J}_loadTextureAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureAsync(z,u,Y);if(H)return H;this.logOpen(`${z} ${u.name||""}`);const E=void 0==u.sampler?y.DefaultSampler:S.Get(`${z}/sampler`,this._gltf.samplers,u.sampler),J=S.Get(`${z}/source`,this._gltf.images,u.source),l=this._createTextureAsync(z,E,J,Y,void 0,!u._textureInfo.nonColorData);return this.logClose(),l}_createTextureAsync(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},J=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;const T=this._loadSampler(`/samplers/${u.index}`,u),b=new Array,L=new H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D={noMipmap:T.noMipMaps,invertY:!1,samplingMode:T.samplingMode,P:()=>{this._disposed||L.resolve()},onError:(u,Y)=>{this._disposed||L.reject(new Error(`${z}: ${Y&&Y.message?Y.message:u||"Failed to load texture"}`))},mimeType:Y.mimeType??(0,F.i)(Y.uri??""),loaderOptions:J,useSRGBBuffer:!!l&&this._parent.useSRGBBuffers},g=new W.b(null,this._babylonScene,D);return g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.push(L.promise),b.push(this.loadImageAsync(`/images/${Y.index}`,Y).then((z=>{const u=Y.uri||`${this._fileName}#image${Y.index}`,H=`data:${this._uniqueRootUrl}${u}`;g.updateURL(H,z);const E=g.getInternalTexture();E&&(E.label=Y.name)}))),g.wrapU=T.wrapU,g.wrapV=T.wrapV,E(g),this._parent.useGltfTextureNames&&(g.name=Y.name||Y.uri||`image${Y.index}`),Promise.all(b).then((()=>g))}_loadSampler(z,u){return u._data||(u._data={noMipMaps:9728===u.minFilter||9729===u.minFilter,samplingMode:y._GetTextureSamplingMode(z,u),wrapU:y._GetTextureWrapMode(`${z}/wrapS`,u.wrapS),wrapV:y._GetTextureWrapMode(`${z}/wrapT`,u.wrapT)}),u._data}loadImageAsync(z,u){if(!u._data){if(this.logOpen(`${z} ${u.name||""}`),u.uri)u._data=this.loadUriAsync(`${z}/uri`,u,u.uri);else{const Y=S.Get(`${z}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)}this.logClose()}return u._data}loadUriAsync(z,u,Y){const H=this._extensionsLoadUriAsync(z,u,Y);if(H)return H;if(!y._ValidateUri(Y))throw new Error(`${z}: '${Y}' is invalid`);if((0,F.m)(Y)){const u=new Uint8Array((0,F.e)(Y));return this.log(`${z}: Decoded ${Y.substring(0,64)}... (${u.length} bytes)`),Promise.resolve(u)}return this.log(`${z}: Loading ${Y}`),this._parent.preprocessUrlAsync(this._rootUrl+Y).then((u=>new Promise(((H,E)=>{this._parent._loadFile(this._babylonScene,u,(u=>{this._disposed||(this.log(`${z}: Loaded ${Y} (${u.byteLength} bytes)`),H(new Uint8Array(u)))}),!0,(u=>{E(new F.n(`${z}: Failed to load '${Y}'${u?": "+u.status+" "+u.statusText:""}`,u))}))}))))}static AddPointerMetadata(z,u){z.metadata=z.metadata||{};const Y=z._internalMetadata=z._internalMetadata||{},H=Y.zT=Y.zT||{};(H.pointers=H.pointers||[]).push(u)}static _GetTextureWrapMode(z,u){switch(u=void 0==u?10497:u){case 33071:return W.b.CLAMP_ADDRESSMODE;case 33648:return W.b.MIRROR_ADDRESSMODE;case 10497:return W.b.WRAP_ADDRESSMODE;default:return K.b.Warn(`${z}: Invalid value (${u})`),W.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(z,u){const Y=void 0==u.magFilter?9729:u.magFilter,H=void 0==u.minFilter?9987:u.minFilter;if(9729===Y)switch(H){case 9728:return W.b.LINEAR_NEAREST;case 9729:return W.b.LINEAR_LINEAR;case 9984:return W.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return W.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return W.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return W.b.LINEAR_LINEAR_MIPLINEAR;default:return K.b.Warn(`${z}/minFilter: Invalid value (${H})`),W.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Y&&K.b.Warn(`${z}/magFilter: Invalid value (${Y})`),H){case 9728:return W.b.NEAREST_NEAREST;case 9729:return W.b.NEAREST_LINEAR;case 9984:return W.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return W.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return W.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return W.b.NEAREST_LINEAR_MIPLINEAR;default:return K.b.Warn(`${z}/minFilter: Invalid value (${H})`),W.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(z,u){try{return(0,p.p)(u)}catch(Y){throw new Error(`${z}: ${Y.message}`)}}static _GetTypedArray(z,u,Y,H,E){const J=Y.buffer;H=Y.byteOffset+(H||0);const l=y._GetTypedArrayConstructor(`${z}/componentType`,u),T=s.f.GetTypeByteLength(u);return H%T!==0?(K.b.Warn(`${z}: Copying buffer as byte offset (${H}) is not a multiple of component type byte length (${T})`),new l(J.slice(H,H+E*T),0)):new l(J,H,E)}static _GetNumComponents(z,u){switch(u){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${z}: Invalid type (${u})`)}static _ValidateUri(z){return l.e.IsBase64(z)||-1===z.indexOf("..")}static _GetDrawMode(z,u){switch(void 0==u&&(u=4),u){case 0:return d.d.PointListDrawMode;case 1:return d.d.LineListDrawMode;case 2:return d.d.LineLoopDrawMode;case 3:return d.d.LineStripDrawMode;case 4:return d.d.TriangleFillMode;case 5:return d.d.TriangleStripDrawMode;case 6:return d.d.TriangleFanDrawMode}throw new Error(`${z}: Invalid mesh primitive mode (${u})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const z=new Array;if(this._gltf.materials)for(const u of this._gltf.materials)if(u._data)for(const Y in u._data){const H=u._data[Y];for(const u of H.babylonMeshes){u.pl(!0);const Y=H.babylonMaterial;z.push(Y.forceCompilationAsync(u)),z.push(Y.forceCompilationAsync(u,{useInstances:!0})),this._parent.useClipPlane&&(z.push(Y.forceCompilationAsync(u,{clipPlane:!0})),z.push(Y.forceCompilationAsync(u,{clipPlane:!0,useInstances:!0})))}}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const z=new Array,u=this._babylonScene.lights;for(const Y of u){const u=Y.getShadowGenerator();u&&z.push(u.forceCompilationAsync())}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(z){for(const u of this._extensions)u.enabled&&z(u)}_applyExtensions(z,u,Y){for(const H of this._extensions)if(H.enabled){const E=`${H.name}.${u}`,J=z;J._activeLoaderExtensionFunctions=J._activeLoaderExtensionFunctions||{};const l=J._activeLoaderExtensionFunctions;if(!l[E]){l[E]=!0;try{const z=Y(H);if(z)return z}finally{delete l[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((z=>z.onLoading&&z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((z=>z.onReady&&z.onReady()))}_extensionsLoadSceneAsync(z,u){return this._applyExtensions(u,"loadScene",(Y=>Y.loadSceneAsync&&Y.loadSceneAsync(z,u)))}_extensionsLoadNodeAsync(z,u,Y){return this._applyExtensions(u,"loadNode",(H=>H.loadNodeAsync&&H.loadNodeAsync(z,u,Y)))}_extensionsLoadCameraAsync(z,u,Y){return this._applyExtensions(u,"loadCamera",(H=>H.loadCameraAsync&&H.loadCameraAsync(z,u,Y)))}_extensionsLoadVertexDataAsync(z,u,Y){return this._applyExtensions(u,"loadVertexData",(H=>H._loadVertexDataAsync&&H._loadVertexDataAsync(z,u,Y)))}_extensionsLoadMeshPrimitiveAsync(z,u,Y,H,E,J){return this._applyExtensions(E,"loadMeshPrimitive",(l=>l._loadMeshPrimitiveAsync&&l._loadMeshPrimitiveAsync(z,u,Y,H,E,J)))}_extensionsLoadMaterialAsync(z,u,Y,H,E){return this._applyExtensions(u,"loadMaterial",(J=>J._loadMaterialAsync&&J._loadMaterialAsync(z,u,Y,H,E)))}_extensionsCreateMaterial(z,u,Y){return this._applyExtensions(u,"createMaterial",(H=>H.createMaterial&&H.createMaterial(z,u,Y)))}_extensionsLoadMaterialPropertiesAsync(z,u,Y){return this._applyExtensions(u,"loadMaterialProperties",(H=>H.loadMaterialPropertiesAsync&&H.loadMaterialPropertiesAsync(z,u,Y)))}_extensionsLoadTextureInfoAsync(z,u,Y){return this._applyExtensions(u,"loadTextureInfo",(H=>H.loadTextureInfoAsync&&H.loadTextureInfoAsync(z,u,Y)))}_extensionsLoadTextureAsync(z,u,Y){return this._applyExtensions(u,"loadTexture",(H=>H._loadTextureAsync&&H._loadTextureAsync(z,u,Y)))}_extensionsLoadAnimationAsync(z,u){return this._applyExtensions(u,"loadAnimation",(Y=>Y.loadAnimationAsync&&Y.loadAnimationAsync(z,u)))}_extensionsLoadAnimationChannelAsync(z,u,Y,H,E){return this._applyExtensions(Y,"loadAnimationChannel",(J=>J._loadAnimationChannelAsync&&J._loadAnimationChannelAsync(z,u,Y,H,E)))}_extensionsLoadSkinAsync(z,u,Y){return this._applyExtensions(Y,"loadSkin",(H=>H._loadSkinAsync&&H._loadSkinAsync(z,u,Y)))}_extensionsLoadUriAsync(z,u,Y){return this._applyExtensions(u,"loadUri",(H=>H._loadUriAsync&&H._loadUriAsync(z,u,Y)))}_extensionsLoadBufferViewAsync(z,u){return this._applyExtensions(u,"loadBufferView",(Y=>Y.loadBufferViewAsync&&Y.loadBufferViewAsync(z,u)))}_extensionsLoadBufferAsync(z,u,Y,H){return this._applyExtensions(u,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(z,u,Y,H)))}static LoadExtensionAsync(z,u,Y,H){if(!u.extensions)return null;const E=u.extensions[Y];return E?H(`${z}/extensions/${Y}`,E):null}static LoadExtraAsync(z,u,Y,H){if(!u.extras)return null;const E=u.extras[Y];return E?H(`${z}/extras/${Y}`,E):null}isExtensionUsed(z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(z)}logOpen(z){this._parent._logOpen(z)}logClose(){this._parent._logClose()}log(z){this._parent._log(z)}startPerformanceCounter(z){this._parent._startPerformanceCounter(z)}endPerformanceCounter(z){this._parent._endPerformanceCounter(z)}}y.DefaultSampler={index:-1},G.c._CreateGLTF2Loader=z=>new y(z);var a=Y(12485),j=Y(11378),k=Y(11172),P=Y(12493),e=Y(12495);class N extends e.c{constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",z),this._texture=z.getEngine().createRawCubeTexture(u,Y,H,E,J,l,T,b)}update(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,z,u,Y,H,E)}updateRGBDAsync(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.i)(this._texture,z,u,Y,H).then((()=>{}))}clone(){return k.d.Clone((()=>{const z=this.iz(),u=this._texture,Y=new N(z,u._bufferViewArray,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression);return 13===u.source&&Y.updateRGBDAsync(u._bufferViewArrayArray,u._sphericalPolynomial,u._lodGenerationScale,u._lodGenerationOffset),Y}),this)}}const B="EXT_lights_image_based";class f{constructor(z){this.name=B,this._loader=z,this.enabled=this._loader.isExtensionUsed(B)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.zT.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights}}loadSceneAsync(z,u){return y.LoadExtensionAsync(z,u,this.name,(async(Y,H)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(z,u)),this._loader.logOpen(`${Y}`);const J=S.Get(`${Y}/light`,this._lights,H.nl);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${H.nl}`,J).then((z=>{this._loader.babylonScene.environmentTexture=z}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(z,u){if(!u._loaded){const Y=new Array;this._loader.logOpen(`${z}`);const H=new Array(u.specularImages.length);for(let E=0;E<u.specularImages.length;E++){const J=u.specularImages[E];H[E]=new Array(J.length);for(let u=0;u<J.length;u++){const l=`${z}/specularImages/${E}/${u}`;this._loader.logOpen(`${l}`);const T=J[u],b=S.Get(l,this._loader.zT.images,T);Y.push(this._loader.loadImageAsync(`/images/${T}`,b).then((z=>{H[E][u]=z}))),this._loader.logClose()}}this._loader.logClose(),u._loaded=Promise.all(Y).then((async()=>{const Y=new N(this._loader.babylonScene,null,u.specularImageSize);if(Y.name=u.name||"environment",u._babylonTexture=Y,void 0!=u.JT&&(Y.level=u.JT),u.rotation){let z=E.f.Nl(u.rotation);this._loader.babylonScene.useRightHandedSystem||(z=E.f.Inverse(z)),E.b.FromQuaternionToRef(z,Y.getReflectionTextureMatrix())}if(!u.irradianceCoefficients)throw new Error(`${z}: Irradiance coefficients are missing`);const J=j.d.Nl(u.irradianceCoefficients);J.scaleInPlace(u.JT),J.convertIrradianceToLambertianRadiance();const l=j.h.FromHarmonics(J),T=(H.length-1)/Math.log2(u.specularImageSize);return await Y.updateRGBDAsync(H,l,T)}))}return u._loaded.then((()=>u._babylonTexture))}}O(B),U(B,!0,(z=>new f(z)));Y(11657);const r="EXT_mesh_gpu_instancing";class zz{constructor(z){this.name=r,this._loader=z,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadNodeAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(z,H)=>{this._loader._disableInstancedMesh++;const J=this._loader.loadNodeAsync(`/nodes/${u.index}`,u,Y);if(this._loader._disableInstancedMesh--,!u._primitiveBabylonMeshes)return await J;const l=new Array;let T=0;const b=u=>{if(void 0==H.attributes[u])return void l.push(Promise.resolve(null));const Y=S.Get(`${z}/attributes/${u}`,this._loader.zT.accessors,H.attributes[u]);if(l.push(this._loader._loadFloatAccessorAsync(`/accessors/${Y.bufferView}`,Y)),0===T)T=Y.count;else if(T!==Y.count)throw new Error(`${z}/attributes: Instance buffer accessors do not have the same count.`)};return b("TRANSLATION"),b("ROTATION"),b("SCALE"),await J.then((async z=>{const[Y,H,J]=await Promise.all(l),b=new Float32Array(16*T);E.i.Pl[0].kl(0,0,0),E.i.Quaternion[0].kl(0,0,0,1),E.i.Pl[1].kl(1,1,1);for(let u=0;u<T;++u)Y&&E.p.FromArrayToRef(Y,3*u,E.i.Pl[0]),H&&E.f.FromArrayToRef(H,4*u,E.i.Quaternion[0]),J&&E.p.FromArrayToRef(J,3*u,E.i.Pl[1]),E.b.ComposeToRef(E.i.Pl[1],E.i.Quaternion[0],E.i.Pl[0],E.i.Matrix[0]),E.i.Matrix[0].copyToArray(b,16*u);for(const E of u._primitiveBabylonMeshes)E.pg("matrix",b,16,!0);return z}))}))}}O(r),U(r,!0,(z=>new zz(z)));let uz=0,Yz=null;class Hz{static get Default(){return Hz._Default||(Hz._Default=new Hz),Hz._Default}constructor(){const z=Hz.Configuration.decoder;this._decoderModulePromise=l.e.LoadBabylonScriptAsync(z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(z,u,Y,H,E){await this._decoderModulePromise,0===uz&&(MeshoptDecoder.useWorkers(1),uz=1);const J=await MeshoptDecoder.decodeGltfBufferAsync(u,Y,z,H,E);return null!==Yz&&clearTimeout(Yz),Yz=setTimeout((()=>{MeshoptDecoder.useWorkers(0),uz=0,Yz=null}),1e3),J}}Hz.Configuration={decoder:{url:`${l.e._DefaultCdnUrl}/meshopt_decoder.js`}},Hz._Default=null;const Ez="EXT_meshopt_compression";class Jz{constructor(z){this.name=Ez,this.enabled=z.isExtensionUsed(Ez),this._loader=z}dispose(){this._loader=null}loadBufferViewAsync(z,u){return y.LoadExtensionAsync(z,u,this.name,(async(Y,H)=>{const E=u;if(E._meshOptData)return await E._meshOptData;const J=S.Get(`${z}/buffer`,this._loader.zT.buffers,H.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${J.index}`,J,H.byteOffset||0,H.byteLength).then((async z=>await Hz.Default.decodeGltfBufferAsync(z,H.count,H.byteStride,H.mode,H.filter))),await E._meshOptData}))}}O(Ez),U(Ez,!0,(z=>new Jz(z)));const lz="EXT_texture_webp";class Tz{constructor(z){this.name=lz,this._loader=z,this.enabled=z.isExtensionUsed(lz)}dispose(){this._loader=null}_loadTextureAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=void 0==u.sampler?y.DefaultSampler:S.Get(`${z}/sampler`,this._loader.zT.samplers,u.sampler),l=S.Get(`${H}/source`,this._loader.zT.images,E.source);return await this._loader._createTextureAsync(z,J,l,(z=>{Y(z)}),void 0,!u._textureInfo.nonColorData)}))}}O(lz),U(lz,!0,(z=>new Tz(z)));const bz="EXT_texture_avif";class Lz{constructor(z){this.name=bz,this._loader=z,this.enabled=z.isExtensionUsed(bz)}dispose(){this._loader=null}_loadTextureAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=void 0==u.sampler?y.DefaultSampler:S.Get(`${z}/sampler`,this._loader.zT.samplers,u.sampler),l=S.Get(`${H}/source`,this._loader.zT.images,E.source);return await this._loader._createTextureAsync(z,J,l,(z=>{Y(z)}),void 0,!u._textureInfo.nonColorData)}))}}O(bz),U(bz,!0,(z=>new Lz(z)));var Dz=Y(12483),gz=Y(11637);const Mz="EXT_lights_ies";class qz{constructor(z){this.name=Mz,this._loader=z,this.enabled=this._loader.isExtensionUsed(Mz)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.zT.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights,S.Assign(this._lights)}}loadNodeAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,l)=>{let T,b;this._loader._allMaterialsDirtyRequired=!0;const L=await this._loader.loadNodeAsync(z,u,(z=>{b=S.Get(H,this._lights,l.nl);const u=b.name||z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,T=new Dz.c(u,E.p.Zero(),E.p.Backward(),0,1,this._loader.babylonScene),T.angle=Math.PI/2,T.innerAngle=0,T._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,b._babylonLight=T,T.falloffType=gz.e.FALLOFF_GLTF,T.lT=l.color?J.c.Nl(l.color):J.c.White(),T.JT=l.multiplier||1,T.range=Number.MAX_VALUE,T.parent=z,this._loader._babylonLights.push(T),y.AddPointerMetadata(T,H),Y(z)}));let D;if(b.uri)D=await this._loader.loadUriAsync(z,b,b.uri);else{const u=S.Get(`${z}/bufferView`,this._loader.zT.bufferViews,b.bufferView);D=await this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return T.iesProfileTexture=new W.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,D,!0,void 0,void 0,void 0,void 0,".ies"),L}))}}O(Mz),U(Mz,!0,(z=>new qz(z)));var Cz=Y(12502);const Kz="KHR_draco_mesh_compression";class hz{constructor(z){this.name=Kz,this.useNormalizedFlagFromAccessor=!0,this._loader=z,this.enabled=Cz.d.DefaultAvailable&&this._loader.isExtensionUsed(Kz)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{if(void 0!=u.mode&&4!==u.mode&&5!==u.mode)throw new Error(`${z}: Unsupported mode ${u.mode}`);const J={},l={},T=(z,H)=>{const T=E.attributes[z];if(void 0!=T&&(Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(H)&&Y._delayInfo.push(H),J[H]=T,this.useNormalizedFlagFromAccessor)){const Y=S.TryGet(this._loader.zT.accessors,u.attributes[z]);Y&&(l[H]=Y.normalized||!1)}};T("POSITION",s.f.PositionKind),T("NORMAL",s.f.NormalKind),T("TANGENT",s.f.TangentKind),T("TEXCOORD_0",s.f.UVKind),T("TEXCOORD_1",s.f.UV2Kind),T("TEXCOORD_2",s.f.UV3Kind),T("TEXCOORD_3",s.f.UV4Kind),T("TEXCOORD_4",s.f.UV5Kind),T("TEXCOORD_5",s.f.UV6Kind),T("JOINTS_0",s.f.MatricesIndicesKind),T("WEIGHTS_0",s.f.MatricesWeightsKind),T("COLOR_0",s.f.ColorKind);const b=S.Get(H,this._loader.zT.bufferViews,E.bufferView);return b._dracoBabylonGeometry||(b._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((async H=>{const E=this.dracoDecoder||Cz.d.Default,T=S.TryGet(this._loader.zT.accessors,u.attributes.POSITION),b=this._loader.parent.alwaysComputeBoundingBox||Y.skeleton||!T?null:I(T);return await E._decodeMeshToGeometryForGltfAsync(Y.name,this._loader.babylonScene,H,J,l,b).catch((u=>{throw new Error(`${z}: ${u.message}`)}))}))),await b._dracoBabylonGeometry}))}}O(Kz),U(Kz,!0,(z=>new hz(z)));var oz=Y(12508),dz=Y(11079),tz=Y(11082),Wz=Y(11222),Zz=Y(11690),sz=Y(10918);Wz.b.AddNodeConstructor("Light_Type_0",((z,u)=>()=>new vz(z,E.p.Zero(),u)));class vz extends Zz.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(z){this._shadowAngle=z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(z){const u=this.needCube();if(this._direction=z,this.needCube()!==u&&this._shadowGenerators){const z=this._shadowGenerators.values();for(let u=z.next();!0!==u.done;u=z.next()){u.value.recreateShadowMap()}}}constructor(z,u,Y){super(z,Y),this._shadowAngle=Math.PI/2,this.position=u}getClassName(){return"PointLight"}getTypeID(){return gz.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(z){if(this.direction)return super.getShadowDirection(z);switch(z){case 0:return new E.p(1,0,0);case 1:return new E.p(-1,0,0);case 2:return new E.p(0,-1,0);case 3:return new E.p(0,1,0);case 4:return new E.p(0,0,1);case 5:return new E.p(0,0,-1)}return E.p.Zero()}_setDefaultShadowProjectionMatrix(z,u,Y){const H=this.iz().activeCamera;if(!H)return;const J=void 0!==this.shadowMinZ?this.shadowMinZ:H.uT,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,T=this.iz().getEngine().useReverseDepthBuffer;E.b.PerspectiveFovLHToRef(this.shadowAngle,1,T?l:J,T?J:l,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,T)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,u){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,u):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,u),this}transferToNodeMaterialEffect(z,u){return this.computeTransformedInformation()?z.setFloat3(u,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):z.setFloat3(u,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(z,u){z["POINTLIGHT"+u]=!0}}(0,dz.e)([(0,tz.L)()],vz.prototype,"shadowAngle",null),(0,sz.d)("BABYLON.PointLight",vz);const iz="KHR_lights_punctual";class Xz{constructor(z){this.name=iz,this._loader=z,this.enabled=this._loader.isExtensionUsed(iz)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.zT.extensions;if(z&&z[this.name]){const u=z[this.name];this._lights=u.lights,S.Assign(this._lights)}}loadNodeAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,l)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(z,u,(z=>{let u;const T=S.Get(H,this._lights,l.nl),b=T.name||z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,T.type){case"directional":{const z=new oz.d(b,E.p.Backward(),this._loader.babylonScene);z.position.Bl(0),u=z;break}case"point":u=new vz(b,E.p.Zero(),this._loader.babylonScene);break;case"spot":{const z=new Dz.c(b,E.p.Zero(),E.p.Backward(),0,1,this._loader.babylonScene);z.angle=2*(T.spot&&T.spot.outerConeAngle||Math.PI/4),z.innerAngle=2*(T.spot&&T.spot.innerConeAngle||0),u=z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${H}: Invalid light type (${T.type})`)}u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,T._babylonLight=u,u.falloffType=gz.e.FALLOFF_GLTF,u.lT=T.color?J.c.Nl(T.color):J.c.White(),u.JT=void 0==T.JT?1:T.JT,u.range=void 0==T.range?Number.MAX_VALUE:T.range,u.parent=z,this._loader._babylonLights.push(u),y.AddPointerMetadata(u,H),Y(z)})))))}}O(iz),U(iz,!0,(z=>new Xz(z)));const Qz="KHR_materials_pbrSpecularGlossiness";class Vz{constructor(z){this.name=Qz,this.order=200,this._loader=z,this.enabled=this._loader.isExtensionUsed(Qz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialBasePropertiesAsync(z,u,Y)),J.push(this._loadSpecularGlossinessPropertiesAsync(H,E,Y)),this._loader.loadMaterialAlphaProperties(z,u,Y),await Promise.all(J).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.metallic=null,Y.roughness=null,u.diffuseFactor?(Y.albedoColor=J.c.Nl(u.diffuseFactor),Y.alpha=u.diffuseFactor[3]):Y.albedoColor=J.c.White(),Y.reflectivityColor=u.specularFactor?J.c.Nl(u.specularFactor):J.c.White(),Y.microSurface=void 0==u.glossinessFactor?1:u.glossinessFactor,u.diffuseTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTexture`,u.diffuseTexture,(z=>{z.name=`${Y.name} (Diffuse)`,Y.albedoTexture=z}))),u.specularGlossinessTexture&&(H.push(this._loader.loadTextureInfoAsync(`${z}/specularGlossinessTexture`,u.specularGlossinessTexture,(z=>{z.name=`${Y.name} (Specular Glossiness)`,Y.reflectivityTexture=z,Y.reflectivityTexture.jl=!0}))),Y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(H).then((()=>{}))}}O(Qz),U(Qz,!0,(z=>new Vz(z)));const Az="KHR_materials_unlit";class xz{constructor(z){this.name=Az,this.order=210,this._loader=z,this.enabled=this._loader.isExtensionUsed(Az)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async()=>await this._loadUnlitPropertiesAsync(z,u,Y)))}_loadUnlitPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;Y.unlit=!0;const E=u.pbrMetallicRoughness;return E&&(E.baseColorFactor?(Y.albedoColor=J.c.Nl(E.baseColorFactor),Y.alpha=E.baseColorFactor[3]):Y.albedoColor=J.c.White(),E.baseColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/baseColorTexture`,E.baseColorTexture,(z=>{z.name=`${Y.name} (Base Color)`,Y.albedoTexture=z})))),u.doubleSided&&(Y.yl=!1,Y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(z,u,Y),Promise.all(H).then((()=>{}))}}O(Az),U(Az,!0,(z=>new xz(z)));const Gz="KHR_materials_clearcoat";class Fz{constructor(z){this.name=Gz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(Gz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadClearCoatPropertiesAsync(H,E,Y)),await Promise.all(J)}))}_loadClearCoatPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.clearCoat.isEnabled=!0,Y.clearCoat.useRoughnessFromMainTexture=!1,Y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=u.clearcoatFactor?Y.clearCoat.JT=u.clearcoatFactor:Y.clearCoat.JT=0,u.clearcoatTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatTexture`,u.clearcoatTexture,(z=>{z.name=`${Y.name} (ClearCoat)`,Y.clearCoat.texture=z}))),void 0!=u.clearcoatRoughnessFactor?Y.clearCoat.roughness=u.clearcoatRoughnessFactor:Y.clearCoat.roughness=0,u.clearcoatRoughnessTexture&&(u.clearcoatRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatRoughnessTexture`,u.clearcoatRoughnessTexture,(z=>{z.name=`${Y.name} (ClearCoat Roughness)`,Y.clearCoat.textureRoughness=z})))),u.clearcoatNormalTexture&&(u.clearcoatNormalTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatNormalTexture`,u.clearcoatNormalTexture,(z=>{z.name=`${Y.name} (ClearCoat Normal)`,Y.clearCoat.bumpTexture=z}))),Y.invertNormalMapX=!Y.iz().useRightHandedSystem,Y.invertNormalMapY=Y.iz().useRightHandedSystem,void 0!=u.clearcoatNormalTexture.scale&&(Y.clearCoat.bumpTexture.level=u.clearcoatNormalTexture.scale)),Promise.all(H).then((()=>{}))}}O(Gz),U(Gz,!0,(z=>new Fz(z)));const Rz="KHR_materials_iridescence";class wz{constructor(z){this.name=Rz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(Rz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadIridescencePropertiesAsync(H,E,Y)),await Promise.all(J).then((()=>{}))}))}_loadIridescencePropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.iridescence.isEnabled=!0,Y.iridescence.JT=u.iridescenceFactor??0,Y.iridescence.indexOfRefraction=u.iridescenceIor??u.iridescenceIOR??1.3,Y.iridescence.minimumThickness=u.iridescenceThicknessMinimum??100,Y.iridescence.maximumThickness=u.iridescenceThicknessMaximum??400,u.iridescenceTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/iridescenceTexture`,u.iridescenceTexture,(z=>{z.name=`${Y.name} (Iridescence)`,Y.iridescence.texture=z}))),u.iridescenceThicknessTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/iridescenceThicknessTexture`,u.iridescenceThicknessTexture,(z=>{z.name=`${Y.name} (Iridescence Thickness)`,Y.iridescence.thicknessTexture=z}))),Promise.all(H).then((()=>{}))}}O(Rz),U(Rz,!0,(z=>new wz(z)));const cz="KHR_materials_anisotropy";class Uz{constructor(z){this.name=cz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(cz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadIridescencePropertiesAsync(H,E,Y)),await Promise.all(J)}))}async _loadIridescencePropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;Y.anisotropy.isEnabled=!0,Y.anisotropy.JT=u.anisotropyStrength??0,Y.anisotropy.angle=u.anisotropyRotation??0,u.anisotropyTexture&&(u.anisotropyTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${z}/anisotropyTexture`,u.anisotropyTexture,(z=>{z.name=`${Y.name} (Anisotropy Intensity)`,Y.anisotropy.texture=z})))),await Promise.all(H)}}O(cz),U(cz,!0,(z=>new Uz(z)));const Oz="KHR_materials_emissive_strength";class nz{constructor(z){this.name=Oz,this.order=170,this._loader=z,this.enabled=this._loader.isExtensionUsed(Oz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>await this._loader.loadMaterialPropertiesAsync(z,u,Y).then((()=>{this._loadEmissiveProperties(H,E,Y)}))))}_loadEmissiveProperties(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);void 0!==u.emissiveStrength&&(Y.emissiveIntensity=u.emissiveStrength)}}O(Oz),U(Oz,!0,(z=>new nz(z)));const mz="KHR_materials_sheen";class pz{constructor(z){this.name=mz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(mz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadSheenPropertiesAsync(H,E,Y)),await Promise.all(J).then((()=>{}))}))}_loadSheenPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.sheen.isEnabled=!0,Y.sheen.JT=1,void 0!=u.sheenColorFactor?Y.sheen.color=J.c.Nl(u.sheenColorFactor):Y.sheen.color=J.c.Black(),u.sheenColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/sheenColorTexture`,u.sheenColorTexture,(z=>{z.name=`${Y.name} (Sheen Color)`,Y.sheen.texture=z}))),void 0!==u.sheenRoughnessFactor?Y.sheen.roughness=u.sheenRoughnessFactor:Y.sheen.roughness=0,u.sheenRoughnessTexture&&(u.sheenRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${z}/sheenRoughnessTexture`,u.sheenRoughnessTexture,(z=>{z.name=`${Y.name} (Sheen Roughness)`,Y.sheen.textureRoughness=z})))),Y.sheen.albedoScaling=!0,Y.sheen.useRoughnessFromMainTexture=!1,Promise.all(H).then((()=>{}))}}O(mz),U(mz,!0,(z=>new pz(z)));var Sz=Y(11464);const Iz="KHR_materials_specular";class yz{constructor(z){this.name=Iz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(Iz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;if(J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadSpecularPropertiesAsync(H,E,Y)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&Y instanceof t.c){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Y.brdf.dielectricSpecularModel=Sz.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Y.brdf.conductorSpecularModel=Sz.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(J).then((()=>{}))}))}_loadSpecularPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return void 0!==u.specularFactor&&(Y.metallicF0Factor=u.specularFactor),void 0!==u.specularColorFactor&&(Y.metallicReflectanceColor=J.c.Nl(u.specularColorFactor)),u.specularTexture&&(u.specularTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${z}/specularTexture`,u.specularTexture,(z=>{z.name=`${Y.name} (Specular)`,Y.metallicReflectanceTexture=z,Y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),u.specularColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/specularColorTexture`,u.specularColorTexture,(z=>{z.name=`${Y.name} (Specular Color)`,Y.reflectanceTexture=z}))),Promise.all(H).then((()=>{}))}}O(Iz),U(Iz,!0,(z=>new yz(z)));const az="KHR_materials_ior";class jz{constructor(z){this.name=az,this.order=180,this._loader=z,this.enabled=this._loader.isExtensionUsed(az)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadIorPropertiesAsync(H,E,Y)),await Promise.all(J).then((()=>{}))}))}_loadIorPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);return void 0!==u.ior?Y.indexOfRefraction=u.ior:Y.indexOfRefraction=jz._DEFAULT_IOR,Promise.resolve()}}jz._DEFAULT_IOR=1.5,O(az),U(az,!0,(z=>new jz(z)));const kz="KHR_materials_variants";class Pz{constructor(z){this.name=kz,this._loader=z,this.enabled=this._loader.isExtensionUsed(kz)}dispose(){this._loader=null}static GetAvailableVariants(z){const u=this._GetExtensionMetadata(z);return u?Object.keys(u.variants):[]}getAvailableVariants(z){return Pz.GetAvailableVariants(z)}static SelectVariant(z,u){const Y=this._GetExtensionMetadata(z);if(!Y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${kz} extension`);const H=z=>{const u=Y.variants[z];if(u)for(const Y of u)Y.mesh.material=Y.material};if(u instanceof Array)for(const E of u)H(E);else H(u);Y.lastSelected=u}selectVariant(z,u){Pz.SelectVariant(z,u)}static Reset(z){const u=this._GetExtensionMetadata(z);if(!u)throw new Error(`Cannot reset on a glTF mesh that does not have the ${kz} extension`);for(const Y of u.original)Y.mesh.material=Y.material;u.lastSelected=null}reset(z){Pz.Reset(z)}static GetLastSelectedVariant(z){const u=this._GetExtensionMetadata(z);if(!u)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${kz} extension`);return u.lastSelected}getLastSelectedVariant(z){return Pz.GetLastSelectedVariant(z)}static _GetExtensionMetadata(z){var u,Y;return(null===z||void 0===z||null===(u=z._internalMetadata)||void 0===u||null===(Y=u.zT)||void 0===Y?void 0:Y[kz])||null}onLoading(){const z=this._loader.zT.extensions;if(z&&z[this.name]){const u=z[this.name];this._variants=u.variants}}onReady(){const z=this._loader.rootBabylonMesh;if(z){var u;const Y=this._loader.parent.extensionOptions[kz];null!==Y&&void 0!==Y&&Y.defaultVariant&&Pz.SelectVariant(z,Y.defaultVariant),null===Y||void 0===Y||null===(u=Y.onLoaded)||void 0===u||u.call(Y,{get variants(){return Pz.GetAvailableVariants(z)},get selectedVariant(){const u=Pz.GetLastSelectedVariant(z);return u?Array.isArray(u)?u[0]:u:Pz.GetAvailableVariants(z)[0]},set selectedVariant(u){Pz.SelectVariant(z,u)}})}}_loadMeshPrimitiveAsync(z,u,Y,H,E,J){return y.LoadExtensionAsync(z,E,this.name,(async(l,T)=>{const b=new Array;return b.push(this._loader._loadMeshPrimitiveAsync(z,u,Y,H,E,(u=>{if(J(u),u instanceof X.b){const Y=y._GetDrawMode(z,E.mode),H=this._loader.rootBabylonMesh,J=H?H._internalMetadata=H._internalMetadata||{}:{},L=J.zT=J.zT||{},D=L[kz]=L[kz]||{lastSelected:null,original:[],variants:{}};D.original.push({mesh:u,material:u.material});for(let z=0;z<T.mappings.length;++z){const E=T.mappings[z],J=S.Get(`${l}/mappings/${z}/material`,this._loader.zT.materials,E.material);b.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,J,u,Y,(z=>{for(let Y=0;Y<E.variants.length;++Y){const J=E.variants[Y],l=S.Get(`/extensions/${kz}/variants/${J}`,this._variants,J);D.variants[l.name]=D.variants[l.name]||[],D.variants[l.name].push({mesh:u,material:z}),u.onClonedObservable.add((z=>{const Y=z;let E=null,J=Y;do{if(J=J.parent,!J)return;E=Pz._GetExtensionMetadata(J)}while(null===E);if(H&&E===Pz._GetExtensionMetadata(H)){J._internalMetadata={};for(const z in H._internalMetadata)J._internalMetadata[z]=H._internalMetadata[z];J._internalMetadata.zT=[];for(const z in H._internalMetadata.zT)J._internalMetadata.zT[z]=H._internalMetadata.zT[z];J._internalMetadata.zT[kz]={lastSelected:null,original:[],variants:{}};for(const z of E.original)J._internalMetadata.zT[kz].original.push({mesh:z.mesh,material:z.material});for(const z in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,z)){J._internalMetadata.zT[kz].variants[z]=[];for(const u of E.variants[z])J._internalMetadata.zT[kz].variants[z].push({mesh:u.mesh,material:u.material})}E=J._internalMetadata.zT[kz]}for(const H of E.original)H.mesh===u&&(H.mesh=Y);for(const H of E.variants[l.name])H.mesh===u&&(H.mesh=Y)}))}})))}}}))),await Promise.all(b).then((z=>{let[u]=z;return u}))}))}}O(kz),U(kz,!0,(z=>new Pz(z)));var ez=Y(11420);class Nz{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Sz.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(z,u){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Nz._GetDefaultOptions(),...z},this._scene=u,this._scene._transmissionHelper=this,this.onErrorObservable=new D.e,this._scene.fl.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(z){if(!Object.keys(z).filter((u=>this._options[u]!==z[u])).length)return;const u={...this._options,...z},Y=this._options;this._options=u,u.renderSize===Y.renderSize&&u.renderTargetTextureType===Y.renderTargetTextureType&&u.generateMipmaps===Y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=u.samples,this._opaqueRenderTarget.lodGenerationScale=u.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=u.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(z){return!!z&&!!(z instanceof t.c&&z.subSurface.isRefractionEnabled)}_addMesh(z){this._materialObservers[z.uniqueId]=z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),l.e.SetImmediate((()=>{this._shouldRenderAsTransmission(z.material)?(z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(z)&&this._transparentMeshesCache.push(z)):-1===this._opaqueMeshesCache.indexOf(z)&&this._opaqueMeshesCache.push(z)}))}_removeMesh(z){z.onMaterialChangedObservable.remove(this._materialObservers[z.uniqueId]),delete this._materialObservers[z.uniqueId];let u=this._transparentMeshesCache.indexOf(z);-1!==u&&this._transparentMeshesCache.splice(u,1),u=this._opaqueMeshesCache.indexOf(z),-1!==u&&this._opaqueMeshesCache.splice(u,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(z){const u=this._transparentMeshesCache.indexOf(z),Y=this._opaqueMeshesCache.indexOf(z);this._shouldRenderAsTransmission(z.material)?(z.material instanceof t.c&&(z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Y?(this._opaqueMeshesCache.splice(Y,1),this._transparentMeshesCache.push(z)):-1===u&&this._transparentMeshesCache.push(z)):-1!==u?(this._transparentMeshesCache.splice(u,1),this._opaqueMeshesCache.push(z)):-1===Y&&this._opaqueMeshesCache.push(z)}_isRenderTargetValid(){var z;return null!==(null===(z=this._opaqueRenderTarget)||void 0===z?void 0:z.getInternalTexture())}_setupRenderTargets(){var z;let u;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ez.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(z=this._options.clearColor)||void 0===z?void 0:z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((z=>{u=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?z.clearColor.J(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=u}));for(const Y of this._transparentMeshesCache)this._shouldRenderAsTransmission(Y.material)&&(Y.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Bz="KHR_materials_transmission";class fz{constructor(z){this.name=Bz,this.order=175,this._loader=z,this.enabled=this._loader.isExtensionUsed(Bz),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadTransparentPropertiesAsync(H,u,Y,E)),await Promise.all(J).then((()=>{}))}))}_loadTransparentPropertiesAsync(z,u,Y,H){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const E=Y;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===H.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var J;E.subSurface.refractionIntensity=H.transmissionFactor;const z=E.iz();if(E.subSurface.refractionIntensity&&!z._transmissionHelper)new Nz({},E.iz());else if(E.subSurface.refractionIntensity&&(null===(J=z._transmissionHelper)||void 0===J||!J._isRenderTargetValid())){var l;null===(l=z._transmissionHelper)||void 0===l||l._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,H.transmissionTexture?(H.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${z}/transmissionTexture`,H.transmissionTexture,void 0).then((z=>{z.name=`${Y.name} (Transmission)`,E.subSurface.refractionIntensityTexture=z,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(Bz),U(Bz,!0,(z=>new fz(z)));const rz="KHR_materials_diffuse_transmission";class zu{constructor(z){this.name=rz,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(rz),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadTranslucentPropertiesAsync(H,u,Y,E)),await Promise.all(J).then((()=>{}))}))}_loadTranslucentPropertiesAsync(z,u,Y,H){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const E=Y;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===H.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=H.diffuseTransmissionFactor;const l=new Array;return E.subSurface.useGltfStyleTextures=!0,H.diffuseTransmissionTexture&&(H.diffuseTransmissionTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTransmissionTexture`,H.diffuseTransmissionTexture).then((z=>{z.name=`${Y.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=z})))),void 0!==H.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=J.c.Nl(H.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=J.c.White(),H.diffuseTransmissionColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTransmissionColorTexture`,H.diffuseTransmissionColorTexture).then((z=>{z.name=`${Y.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=z}))),Promise.all(l).then((()=>{}))}}O(rz),U(rz,!0,(z=>new zu(z)));const uu="KHR_materials_volume";class Yu{constructor(z){this.name=uu,this.order=173,this._loader=z,this.enabled=this._loader.isExtensionUsed(uu),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadVolumePropertiesAsync(H,u,Y,E)),await Promise.all(J).then((()=>{}))}))}_loadVolumePropertiesAsync(z,u,Y,H){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);if(!Y.subSurface.isRefractionEnabled&&!Y.subSurface.isTranslucencyEnabled||!H.thicknessFactor)return Promise.resolve();Y.subSurface.volumeIndexOfRefraction=Y.indexOfRefraction;const E=void 0!==H.attenuationDistance?H.attenuationDistance:Number.MAX_VALUE;return Y.subSurface.tintColorAtDistance=E,void 0!==H.attenuationColor&&3==H.attenuationColor.length&&Y.subSurface.tintColor.kl(H.attenuationColor[0],H.attenuationColor[1],H.attenuationColor[2]),Y.subSurface.minimumThickness=0,Y.subSurface.maximumThickness=H.thicknessFactor,Y.subSurface.useThicknessAsDepth=!0,H.thicknessTexture?(H.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${z}/thicknessTexture`,H.thicknessTexture).then((z=>{z.name=`${Y.name} (Thickness)`,Y.subSurface.thicknessTexture=z,Y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(uu),U(uu,!0,(z=>new Yu(z)));const Hu="KHR_materials_dispersion";class Eu{constructor(z){this.name=Hu,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(Hu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadDispersionPropertiesAsync(H,u,Y,E)),await Promise.all(J).then((()=>{}))}))}_loadDispersionPropertiesAsync(z,u,Y,H){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);return Y.subSurface.isRefractionEnabled&&H.dispersion?(Y.subSurface.isDispersionEnabled=!0,Y.subSurface.dispersion=H.dispersion,Promise.resolve()):Promise.resolve()}}O(Hu),U(Hu,!0,(z=>new Eu(z)));const Ju="EXT_materials_diffuse_roughness";class lu{constructor(z){this.name=Ju,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(Ju)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=new Array;return J.push(this._loader.loadMaterialPropertiesAsync(z,u,Y)),J.push(this._loadDiffuseRoughnessPropertiesAsync(H,E,Y)),await Promise.all(J).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(z,u,Y){if(!(Y instanceof t.c))throw new Error(`${z}: Material type not supported`);const H=new Array;return Y.brdf.baseDiffuseModel=Sz.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=u.diffuseRoughnessFactor?Y.baseDiffuseRoughness=u.diffuseRoughnessFactor:Y.baseDiffuseRoughness=0,u.diffuseRoughnessTexture&&H.push(this._loader.loadTextureInfoAsync(`${z}/diffuseRoughnessTexture`,u.diffuseRoughnessTexture,(z=>{z.name=`${Y.name} (Diffuse Roughness)`,Y.baseDiffuseRoughnessTexture=z}))),Promise.all(H).then((()=>{}))}}O(Ju),U(Ju,!0,(z=>new lu(z)));const Tu="KHR_mesh_quantization";class bu{constructor(z){this.name=Tu,this.enabled=z.isExtensionUsed(Tu)}dispose(){}}O(Tu),U(Tu,!0,(z=>new bu(z)));const Lu="KHR_texture_basisu";class Du{constructor(z){this.name=Lu,this._loader=z,this.enabled=z.isExtensionUsed(Lu)}dispose(){this._loader=null}_loadTextureAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>{const J=void 0==u.sampler?y.DefaultSampler:S.Get(`${z}/sampler`,this._loader.zT.samplers,u.sampler),l=S.Get(`${H}/source`,this._loader.zT.images,E.source);return await this._loader._createTextureAsync(z,J,l,(z=>{Y(z)}),u._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!u._textureInfo.nonColorData)}))}}O(Lu),U(Lu,!0,(z=>new Du(z)));const gu="KHR_texture_transform";class Mu{constructor(z){this.name=gu,this._loader=z,this.enabled=this._loader.isExtensionUsed(gu)}dispose(){this._loader=null}loadTextureInfoAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(H,E)=>await this._loader.loadTextureInfoAsync(z,u,(z=>{if(!(z instanceof W.b))throw new Error(`${H}: Texture type not supported`);E.offset&&(z.uOffset=E.offset[0],z.vOffset=E.offset[1]),z.uRotationCenter=0,z.vRotationCenter=0,E.rotation&&(z.wAng=-E.rotation),E.scale&&(z.uScale=E.scale[0],z.vScale=E.scale[1]),void 0!=E.texCoord&&(z.coordinatesIndex=E.texCoord),Y(z)}))))}}O(gu),U(gu,!0,(z=>new Mu(z)));const qu="KHR_xmp_json_ld";class Cu{constructor(z){this.name=qu,this.order=100,this._loader=z,this.enabled=this._loader.isExtensionUsed(qu)}dispose(){this._loader=null}onLoading(){var z,u,Y;if(null===this._loader.rootBabylonMesh)return;const H=null===(z=this._loader.zT.extensions)||void 0===z?void 0:z.KHR_xmp_json_ld,E=null===(u=this._loader.zT.asset)||void 0===u||null===(Y=u.extensions)||void 0===Y?void 0:Y.KHR_xmp_json_ld;if(H&&E){const z=+E.packet;H.packets&&z<H.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=H.packets[z])}}}function Ku(z,u,Y,H){return J.c.Nl(u,Y).scale(H)}function hu(z,u,Y,H){return u[Y]*H}function ou(z,u,Y,H){return-u[Y]*H}function du(z,u,Y,H){return u[Y+1]*H}function tu(z,u,Y,H){return u[Y]*H*2}function Wu(z){return{scale:[new su(M.e.ANIMATIONTYPE_FLOAT,`${z}.uScale`,hu,(()=>2)),new su(M.e.ANIMATIONTYPE_FLOAT,`${z}.vScale`,du,(()=>2))],offset:[new su(M.e.ANIMATIONTYPE_FLOAT,`${z}.uOffset`,hu,(()=>2)),new su(M.e.ANIMATIONTYPE_FLOAT,`${z}.vOffset`,du,(()=>2))],rotation:[new su(M.e.ANIMATIONTYPE_FLOAT,`${z}.wAng`,ou,(()=>1))]}}O(qu),U(qu,!0,(z=>new Cu(z)));class Zu extends a.AnimationPropertyInfo{buildAnimations(z,u,Y,H){return[{babylonAnimatable:z._babylonCamera,babylonAnimation:this._buildAnimation(u,Y,H)}]}}class su extends a.AnimationPropertyInfo{buildAnimations(z,u,Y,H){const E=[];for(const J in z._data)E.push({babylonAnimatable:z._data[J].babylonMaterial,babylonAnimation:this._buildAnimation(u,Y,H)});return E}}class vu extends a.AnimationPropertyInfo{buildAnimations(z,u,Y,H){return[{babylonAnimatable:z._babylonLight,babylonAnimation:this._buildAnimation(u,Y,H)}]}}(0,n.l)("/cameras/{}/orthographic/xmag",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"orthoLeft",ou,(()=>1)),new Zu(M.e.ANIMATIONTYPE_FLOAT,"orthoRight",du,(()=>1))]),(0,n.l)("/cameras/{}/orthographic/ymag",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"orthoBottom",ou,(()=>1)),new Zu(M.e.ANIMATIONTYPE_FLOAT,"orthoTop",du,(()=>1))]),(0,n.l)("/cameras/{}/orthographic/zfar",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"maxZ",hu,(()=>1))]),(0,n.l)("/cameras/{}/orthographic/znear",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"uT",hu,(()=>1))]),(0,n.l)("/cameras/{}/perspective/yfov",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"fov",hu,(()=>1))]),(0,n.l)("/cameras/{}/perspective/zfar",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"maxZ",hu,(()=>1))]),(0,n.l)("/cameras/{}/perspective/znear",[new Zu(M.e.ANIMATIONTYPE_FLOAT,"uT",hu,(()=>1))]),(0,n.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new su(M.e.ANIMATIONTYPE_COLOR3,"albedoColor",Ku,(()=>4)),new su(M.e.ANIMATIONTYPE_FLOAT,"alpha",(function(z,u,Y,H){return u[Y+3]*H}),(()=>4))]),(0,n.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"metallic",hu,(()=>1))]),(0,n.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"roughness",hu,(()=>1))]);const iu=Wu("albedoTexture");(0,n.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",iu.scale),(0,n.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",iu.offset),(0,n.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",iu.rotation);const Xu=Wu("metallicTexture");(0,n.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Xu.scale),(0,n.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Xu.offset),(0,n.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Xu.rotation),(0,n.l)("/materials/{}/emissiveFactor",[new su(M.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Ku,(()=>3))]);const Qu=Wu("bumpTexture");(0,n.l)("/materials/{}/normalTexture/scale",[new su(M.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",hu,(()=>1))]),(0,n.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Qu.scale),(0,n.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Qu.offset),(0,n.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Qu.rotation),(0,n.l)("/materials/{}/occlusionTexture/strength",[new su(M.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",hu,(()=>1))]);const Vu=Wu("ambientTexture");(0,n.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Vu.scale),(0,n.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Vu.offset),(0,n.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Vu.rotation);const Au=Wu("emissiveTexture");(0,n.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Au.scale),(0,n.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Au.offset),(0,n.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Au.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new su(M.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new su(M.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",hu,(()=>1))]);const xu=Wu("anisotropy.texture");(0,n.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",xu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",xu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",xu.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",hu,(()=>1))]);const Gu=Wu("clearCoat.texture");(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Gu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Gu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Gu.rotation);const Fu=Wu("clearCoat.bumpTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new su(M.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Fu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Fu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Fu.rotation);const Ru=Wu("clearCoat.textureRoughness");(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Ru.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Ru.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Ru.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new su(M.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new su(M.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new su(M.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new su(M.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new su(M.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",hu,(()=>1))]);const wu=Wu("iridescence.texture");(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",wu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",wu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",wu.rotation);const cu=Wu("iridescence.thicknessTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",cu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",cu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",cu.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new su(M.e.ANIMATIONTYPE_COLOR3,"sheen.color",Ku,(()=>3))]),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",hu,(()=>1))]);const Uu=Wu("sheen.texture");(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Uu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Uu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Uu.rotation);const Ou=Wu("sheen.textureRoughness");(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Ou.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Ou.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Ou.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new su(M.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ku,(()=>3))]);const nu=Wu("metallicReflectanceTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",nu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",nu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",nu.rotation);const mu=Wu("reflectanceTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",mu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",mu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",mu.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",hu,(()=>1))]);const pu=Wu("subSurface.refractionIntensityTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",pu.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",pu.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",pu.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new su(M.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ku,(()=>3))]),(0,n.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new su(M.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",hu,(()=>1))]),(0,n.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",hu,(()=>1))]);const Su=Wu("subSurface.thicknessTexture");(0,n.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Su.scale),(0,n.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Su.offset),(0,n.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Su.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new su(M.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",hu,(()=>1))]);const Iu=Wu("subSurface.translucencyIntensityTexture");(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Iu.scale),(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Iu.offset),(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Iu.rotation),(0,n.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new su(M.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ku,(()=>3))]);const yu=Wu("subSurface.translucencyColorTexture");(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",yu.scale),(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",yu.offset),(0,n.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",yu.rotation),(0,n.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new vu(M.e.ANIMATIONTYPE_COLOR3,"diffuse",Ku,(()=>3))]),(0,n.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new vu(M.e.ANIMATIONTYPE_FLOAT,"intensity",hu,(()=>1))]),(0,n.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new vu(M.e.ANIMATIONTYPE_FLOAT,"range",hu,(()=>1))]),(0,n.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new vu(M.e.ANIMATIONTYPE_FLOAT,"innerAngle",tu,(()=>1))]),(0,n.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new vu(M.e.ANIMATIONTYPE_FLOAT,"angle",tu,(()=>1))]),(0,n.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new vu(M.e.ANIMATIONTYPE_COLOR3,"diffuse",Ku,(()=>3))]),(0,n.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new vu(M.e.ANIMATIONTYPE_FLOAT,"intensity",hu,(()=>1))]);const au="KHR_animation_pointer";class ju{constructor(z){this.name=au,this._loader=z,this._pathToObjectConverter=(0,n.j)(this._loader.zT)}get enabled(){return this._loader.isExtensionUsed(au)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(z,u,Y,H,E){var J;const l=null===(J=H.target.extensions)||void 0===J?void 0:J.KHR_animation_pointer;if(!l||!this._pathToObjectConverter)return null;"pointer"!==H.target.path&&K.b.Warn(`${z}/target/path: Value (${H.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=H.target.node&&K.b.Warn(`${z}/target/node: Value (${H.target.node}) must not be present when using the ${this.name} extension`);const T=`${z}/extensions/${this.name}`,b=l.pointer;if(!b)throw new Error(`${T}: Pointer is missing`);try{const J=this._pathToObjectConverter.convert(b);if(!J.info.interpolation)throw new Error(`${T}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(z,u,Y,H,{object:J.object,info:J.info.interpolation},E)}catch(L){return K.b.Warn(`${T}/pointer: Invalid pointer (${b}) skipped`),null}}}O(au),U(au,!0,(z=>new ju(z)));class ku{constructor(z,u,Y){this.frame=z,this.action=u,this.onlyOnce=Y,this.isDone=!1}_clone(){return new ku(this.frame,this.action,this.onlyOnce)}}var Pu=Y(10970),eu=Y(11018),Nu=Y(11009);class Bu{get loop(){return this._loop}set loop(z){z!==this._loop&&(this._loop=z,this.updateOptions({loop:z}))}get currentTime(){var z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(z=eu.e.audioEngine)&&void 0!==z&&z.audioContext&&(this.isPlaying||this.isPaused)){const z=this.isPaused?0:eu.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(z){if(z==this._spatialSound)return;const u=this.isPlaying;this.pause(),z?(this._spatialSound=z,this._updateSpatialParameters()):this._disableSpatialSound(),u&&this.play()}constructor(z,u,Y){var H;let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new D.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.p.Zero(),this._localDirection=new E.p(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=z,Y=Y||C.d.LastCreatedScene)if(this._scene=Y,Bu._SceneComponentInitialization(Y),this._readyToPlayCallback=J,this._customAttenuationFunction=(z,u,Y,H,E)=>u<Y?z*(1-u/Y):0,T&&(this.autoplay=T.autoplay||!1,this._loop=T.loop||!1,void 0!==T.volume&&(this._volume=T.volume),this._spatialSound=T.spatialSound??!1,this.maxDistance=T.maxDistance??100,this.useCustomAttenuation=T.useCustomAttenuation??!1,this.rolloffFactor=T.rolloffFactor||1,this.refDistance=T.refDistance||1,this.distanceModel=T.distanceModel||"linear",this._playbackRate=T.playbackRate||1,this._streaming=T.streaming??!1,this._length=T.length,this._offset=T.offset),null!==(H=eu.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&eu.e.audioEngine.audioContext){this._soundGain=eu.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let z=!0;if(u)try{"string"===typeof u?(this._urlType="String",this._url=u):u instanceof ArrayBuffer?this._urlType="ArrayBuffer":u instanceof HTMLMediaElement?this._urlType="MediaElement":u instanceof MediaStream?this._urlType="MediaStream":u instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(u)&&(this._urlType="Array");let Y=[],H=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eu.e.audioEngine.audioContext.createMediaElementSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eu.e.audioEngine.audioContext.createMediaStreamSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":u.byteLength>0&&(H=!0,this._soundLoaded(u));break;case"AudioBuffer":this._audioBufferLoaded(u);break;case"String":Y.push(u);case"Array":0===Y.length&&(Y=u);for(let z=0;z<Y.length;z++){const u=Y[z];if(H=T&&T.skipCodecCheck||-1!==u.indexOf(".mp3",u.length-4)&&eu.e.audioEngine.isMP3supported||-1!==u.indexOf(".ogg",u.length-4)&&eu.e.audioEngine.isOGGsupported||-1!==u.indexOf(".wav",u.length-4)||-1!==u.indexOf(".m4a",u.length-4)||-1!==u.indexOf(".mp4",u.length-4)||-1!==u.indexOf("blob:"),H){this._streaming?(this._htmlAudioElement=new Audio(u),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,l.e.SetCorsBehavior(u,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(u,(z=>{this._soundLoaded(z)}),void 0,!0,!0,(z=>{z&&K.b.Error("XHR "+z.status+" error on: "+u+"."),K.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:z=!1}z?H||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):K.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(b){K.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),eu.e.audioEngine&&!eu.e.audioEngine.WarnedWebAudioUnsupported&&(K.b.Error("Web Audio is not supported by your browser."),eu.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var z;null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(z){var u;null!==(u=eu.e.audioEngine)&&void 0!==u&&u.audioContext&&(this._audioBuffer=z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(z){var u;null!==(u=eu.e.audioEngine)&&void 0!==u&&u.audioContext&&eu.e.audioEngine.audioContext.decodeAudioData(z,(z=>{this._audioBufferLoaded(z)}),(z=>{K.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+z)}))}setAudioBuffer(z){var u;null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this._audioBuffer=z,this._isReadyToPlay=!0)}updateOptions(z){z&&(this.loop=z.loop??this.loop,this.maxDistance=z.maxDistance??this.maxDistance,this.useCustomAttenuation=z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=z.rolloffFactor??this.rolloffFactor,this.refDistance=z.refDistance??this.refDistance,this.distanceModel=z.distanceModel??this.distanceModel,this._playbackRate=z.playbackRate??this._playbackRate,this._length=z.length??void 0,this.spatialSound=z.spatialSound??this._spatialSound,this._setOffset(z.offset??void 0),this.setVolume(z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var z;null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&eu.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??eu.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(z=this._soundPanner)||void 0===z||z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var z;null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(z){var u;null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(z),this._isOutputConnected=!0)}setDirectionalCone(z,u,Y){u<z?K.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=z,this._coneOuterAngle=u,this._coneOuterGain=Y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!=this._coneInnerAngle){var u;if(this._coneOuterAngle<z)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z,null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!=this._coneOuterAngle){var u;if(z<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z,null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(z){var u;z.equals(this._position)||(this._position.J(z),null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(z){var u;this._localDirection=z,null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const z=this._connectedTransformNode.getWorldMatrix(),u=E.p.TransformNormal(this._localDirection,z);u.normalize(),this._soundPanner.orientationX.value=u.x,this._soundPanner.orientationY.value=u.y,this._soundPanner.orientationZ.value=u.z}updateDistanceFromListener(){var z;if(null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.JY(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(z){this._customAttenuationFunction=z}play(z,u,Y){var H;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(H=eu.e.audioEngine)&&void 0!==H&&H.audioContext)try{var E,J;this._clearTimeoutsAndObservers();let H=z?(null===(E=eu.e.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+z:null===(J=eu.e.audioEngine)||void 0===J?void 0:J.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=eu.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const z=()=>{var Y;if(null!==(Y=eu.e.audioEngine)&&void 0!==Y&&Y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=u??0;const Y=this._htmlAudioElement.play();void 0!==Y&&Y.catch((()=>{var u,Y;(null===(u=eu.e.audioEngine)||void 0===u||u.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Y=eu.e.audioEngine)||void 0===Y?void 0:Y.onAudioUnlockedObservable.addOnce((()=>{z()})))}))}else{var H;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(H=eu.e.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{z()}))}};z()}}else{var l;const E=()=>{var E;if(null!==(E=eu.e.audioEngine)&&void 0!==E&&E.audioContext){var J;if(Y=Y||this._length,void 0!==u&&this._setOffset(u),this._soundSource){const z=this._soundSource;z.onended=()=>{z.disconnect()}}if(this._soundSource=null===(J=eu.e.audioEngine)||void 0===J?void 0:J.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var l;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==u&&(this._soundSource.loopStart=u),void 0!==Y&&(this._soundSource.loopEnd=(0|u)+Y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},H=z?(null===(l=eu.e.audioEngine)||void 0===l?void 0:l.audioContext.currentTime)+z:eu.e.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(H,E,this.loop?void 0:Y)}}};"suspended"===(null===(l=eu.e.audioEngine)||void 0===l?void 0:l.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var z;"suspended"===(null===(z=eu.e.audioEngine)||void 0===z?void 0:z.audioContext.state)?(eu.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=eu.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=H,this.isPlaying=!0,this.isPaused=!1}catch(T){K.b.Error("Error while trying to play audio: "+this.name+", "+T.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(z){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Y=this._streamingSource)||void 0===Y||Y.disconnect();this.isPlaying=!1}else if(null!==(u=eu.e.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource){const u=z?eu.e.audioEngine.audioContext.currentTime+z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(u)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var u;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(u=this._streamingSource)||void 0===u||u.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(z=eu.e.audioEngine)&&void 0!==z&&z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=eu.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(z,u){var Y;null!==(Y=eu.e.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._soundGain&&(u&&eu.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(eu.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,eu.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(z,eu.e.audioEngine.audioContext.currentTime+u)):this._soundGain.gain.value=z),this._volume=z}setPlaybackRate(z){this._playbackRate=z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=z=>this._onRegisterAfterWorldMatrixUpdate(z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(z){var u;if(z.getBoundingInfo){const u=z.getBoundingInfo();this.setPosition(u.boundingSphere.centerWorld)}else this.setPosition(z.absolutePosition);null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const z=()=>{(0,Nu.f)((()=>this._isReadyToPlay),(()=>{Y._audioBuffer=this.getAudioBuffer(),Y._isReadyToPlay=!0,Y.autoplay&&Y.play(0,this._offset,this._length)}),void 0,300)},u={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Y=new Bu(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,u);return this.useCustomAttenuation&&Y.setAttenuationFunction(this._customAttenuationFunction),Y.setPosition(this._position),Y.setPlaybackRate(this._playbackRate),z(),Y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(z.connectedMeshId=this._connectedTransformNode.id),z.position=this._position.al(),z.refDistance=this.refDistance,z.distanceModel=this.distanceModel,z.isDirectional=this._isDirectional,z.localDirectionToMesh=this._localDirection.al(),z.coneInnerAngle=this._coneInnerAngle,z.coneOuterAngle=this._coneOuterAngle,z.coneOuterGain=this._coneOuterGain),z}static Parse(z,u,Y,H){const J=z.name;let l;l=z.url?Y+z.url:Y+J;const T={autoplay:z.autoplay,loop:z.loop,volume:z.volume,spatialSound:z.spatialSound,maxDistance:z.maxDistance,rolloffFactor:z.rolloffFactor,refDistance:z.refDistance,distanceModel:z.distanceModel,playbackRate:z.playbackRate};let b;if(H){const z=()=>{(0,Nu.f)((()=>H._isReadyToPlay),(()=>{b._audioBuffer=H.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,b._offset,b._length)}),void 0,300)};b=new Bu(J,new ArrayBuffer(0),u,null,T),z()}else b=new Bu(J,l,u,(()=>{u.removePendingData(b)}),T),u.addPendingData(b);if(z.position){const u=E.p.Nl(z.position);b.setPosition(u)}if(z.isDirectional&&(b.setDirectionalCone(z.coneInnerAngle||360,z.coneOuterAngle||360,z.coneOuterGain||0),z.localDirectionToMesh)){const u=E.p.Nl(z.localDirectionToMesh);b.setLocalDirectionToMesh(u)}if(z.connectedMeshId){const Y=u.getMeshById(z.connectedMeshId);Y&&b.attachToMesh(Y)}return z.metadata&&(b.metadata=z.metadata),b}_setOffset(z){this._offset!==z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=z)}_clearTimeoutsAndObservers(){var z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(z=eu.e.audioEngine)||void 0===z||z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Bu._SceneComponentInitialization=z=>{throw(0,Pu.e)("AudioSceneComponent")},(0,sz.d)("BABYLON.Sound",Bu);class fu{constructor(z,u,Y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],u.length!==Y.length)throw new Error("Sounds length does not equal weights length");this.loop=z,this._weights=Y;let H=0;for(const J of Y)H+=J;const E=H>0?1/H:0;for(let J=0;J<this._weights.length;J++)this._weights[J]*=E;this._sounds=u;for(const J of this._sounds)J.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!==this._coneInnerAngle){if(this._coneOuterAngle<z)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z;for(const u of this._sounds)u.directionalConeInnerAngle=z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!==this._coneOuterAngle){if(z<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z;for(const u of this._sounds)u.directionalConeOuterAngle=z}}get volume(){return this._volume}set volume(z){if(z!==this._volume)for(const u of this._sounds)u.setVolume(z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(z){if(!this.isPaused){this.stop();const z=Math.random();let u=0;for(let Y=0;Y<this._weights.length;Y++)if(u+=this._weights[Y],z<=u){this._currentIndex=Y;break}}const u=this._sounds[this._currentIndex??0];u.isReady()?u.play(0,this.isPaused?void 0:z):u.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class ru{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(z=z||C.d.LastCreatedScene)&&(this._scene=z,this.soundCollection=[],this._options=u,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var z;null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&eu.e.audioEngine.audioContext&&(this._outputAudioNode=eu.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(eu.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(eu.e.audioEngine&&eu.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(z){var u;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==z.soundTrackId&&(-1===z.soundTrackId?this._scene.mainSoundTrack.removeSound(z):this._scene.soundTracks&&this._scene.soundTracks[z.soundTrackId].removeSound(z)),this.soundCollection.push(z),z.soundTrackId=this.id}removeSound(z){const u=this.soundCollection.indexOf(z);-1!==u&&this.soundCollection.splice(u,1)}setVolume(z){var u;null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=z)}switchPanningModelToHRTF(){var z;if(null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var z;if(null!==(z=eu.e.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToEqualPower()}connectToAnalyser(z){var u;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=z,null!==(u=eu.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,eu.e.audioEngine.masterGain))}}var zY=Y(11320),uY=Y(11504),YY=Y(10948);eu.e.AudioEngineFactory=(z,u,Y)=>new HY(z,u,Y);class HY{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new D.e,this.onAudioLockedObservable=new D.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,YY.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const H=document.createElement("audio");this._hostElement=z,this._audioContext=u,this._audioDestination=Y;try{H&&H.canPlayType&&(H.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||H.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{H&&H.canPlayType&&H.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var z,u;if("running"===(null===(z=this._audioContext)||void 0===z?void 0:z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(u=this._audioContext)||void 0===u||u.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{K.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var z;null===(z=this._audioContext)||void 0===z||z.addEventListener("statechange",(()=>{var z;this.unlocked&&"running"!==(null===(z=this._audioContext)||void 0===z?void 0:z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var z;return null!==(z=this._audioContext)&&void 0!==z&&z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(z){this.canUseWebAudio=!1,K.b.Error("Web Audio: "+z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",u=document.createElement("style");u.appendChild(document.createTextNode(z)),document.getElementsByTagName("head")[0].appendChild(u),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(z=this._audioContext)||void 0===z||z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=z)}connectToAnalyser(z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var EY=Y(10962);(0,Y(12206).h)(zY.c.NAME_AUDIO,((z,u,Y,H)=>{let E,J=[];if(Y.bq=Y.bq||[],void 0!==z.bq&&null!==z.bq)for(let T=0,b=z.bq.length;T<b;T++){var l;const b=z.bq[T];null!==(l=eu.e.audioEngine)&&void 0!==l&&l.canUseWebAudio?(b.url||(b.url=b.name),J[b.url]?Y.bq.push(Bu.Parse(b,u,H,J[b.url])):(E=Bu.Parse(b,u,H),J[b.url]=E,Y.bq.push(E))):Y.bq.push(new Bu(b.name,null,u))}J=[]})),Object.defineProperty(uY.d.prototype,"mainSoundTrack",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),this._mainSoundTrack||(this._mainSoundTrack=new ru(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),uY.d.prototype.getSoundByName=function(z){let u;for(u=0;u<this.mainSoundTrack.soundCollection.length;u++)if(this.mainSoundTrack.soundCollection[u].name===z)return this.mainSoundTrack.soundCollection[u];if(this.soundTracks)for(let Y=0;Y<this.soundTracks.length;Y++)for(u=0;u<this.soundTracks[Y].soundCollection.length;u++)if(this.soundTracks[Y].soundCollection[u].name===z)return this.soundTracks[Y].soundCollection[u];return null},Object.defineProperty(uY.d.prototype,"audioEnabled",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),z.audioEnabled},set:function(z){let u=this._getComponent(zY.c.NAME_AUDIO);u||(u=new JY(this),this.ml(u)),z?u.enableAudio():u.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(uY.d.prototype,"headphone",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),z.headphone},set:function(z){let u=this._getComponent(zY.c.NAME_AUDIO);u||(u=new JY(this),this.ml(u)),z?u.switchAudioModeForHeadphones():u.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(uY.d.prototype,"audioListenerPositionProvider",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),z.audioListenerPositionProvider},set:function(z){let u=this._getComponent(zY.c.NAME_AUDIO);if(u||(u=new JY(this),this.ml(u)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");u.audioListenerPositionProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(uY.d.prototype,"audioListenerRotationProvider",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),z.audioListenerRotationProvider},set:function(z){let u=this._getComponent(zY.c.NAME_AUDIO);if(u||(u=new JY(this),this.ml(u)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");u.audioListenerRotationProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(uY.d.prototype,"audioPositioningRefreshRate",{get:function(){let z=this._getComponent(zY.c.NAME_AUDIO);return z||(z=new JY(this),this.ml(z)),z.audioPositioningRefreshRate},set:function(z){let u=this._getComponent(zY.c.NAME_AUDIO);u||(u=new JY(this),this.ml(u)),u.audioPositioningRefreshRate=z},enumerable:!0,configurable:!0});class JY{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(z){this.name=zY.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.p,this._cachedCameraPosition=new E.p,this._lastCheck=0,this._invertMatrixTemp=new E.b,this._cameraDirectionTemp=new E.p,(z=z||C.d.LastCreatedScene)&&(this.Cu=z,z.soundTracks=[],z.bq=[])}register(){this.Cu._afterRenderStage.registerStep(zY.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(z){if(z.bq=[],this.Cu.soundTracks)for(let u=0;u<this.Cu.soundTracks.length;u++){const Y=this.Cu.soundTracks[u];for(let u=0;u<Y.soundCollection.length;u++)z.bq.push(Y.soundCollection[u].serialize())}}addFromContainer(z){if(z.bq)for(const u of z.bq)u.play(),u.autoplay=!0,this.Cu.mainSoundTrack.addSound(u)}removeFromContainer(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(z.bq)for(const Y of z.bq)Y.stop(),Y.autoplay=!1,this.Cu.mainSoundTrack.removeSound(Y),u&&Y.dispose()}dispose(){const z=this.Cu;if(z._mainSoundTrack&&z.mainSoundTrack.dispose(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].dispose()}disableAudio(){const z=this.Cu;let u;for(this._audioEnabled=!1,eu.e.audioEngine&&eu.e.audioEngine.audioContext&&eu.e.audioEngine.audioContext.suspend(),u=0;u<z.mainSoundTrack.soundCollection.length;u++)z.mainSoundTrack.soundCollection[u].pause();if(z.soundTracks)for(u=0;u<z.soundTracks.length;u++)for(let Y=0;Y<z.soundTracks[u].soundCollection.length;Y++)z.soundTracks[u].soundCollection[Y].pause()}enableAudio(){const z=this.Cu;let u;for(this._audioEnabled=!0,eu.e.audioEngine&&eu.e.audioEngine.audioContext&&eu.e.audioEngine.audioContext.resume(),u=0;u<z.mainSoundTrack.soundCollection.length;u++)z.mainSoundTrack.soundCollection[u].isPaused&&z.mainSoundTrack.soundCollection[u].play();if(z.soundTracks)for(u=0;u<z.soundTracks.length;u++)for(let Y=0;Y<z.soundTracks[u].soundCollection.length;Y++)z.soundTracks[u].soundCollection[Y].isPaused&&z.soundTracks[u].soundCollection[Y].play()}switchAudioModeForHeadphones(){const z=this.Cu;if(this._headphone=!0,z.mainSoundTrack.switchPanningModelToHRTF(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const z=this.Cu;if(this._headphone=!1,z.mainSoundTrack.switchPanningModelToEqualPower(),z.soundTracks)for(let u=0;u<z.soundTracks.length;u++)z.soundTracks[u].switchPanningModelToEqualPower()}_afterRender(){const z=EY.d.Now;if(this._lastCheck&&z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=z;const u=this.Cu;if(!this._audioEnabled||!u._mainSoundTrack||!u.soundTracks||0===u._mainSoundTrack.soundCollection.length&&1===u.soundTracks.length)return;const Y=eu.e.audioEngine;if(Y&&Y.audioContext){let z,H=u.activeCamera;if(u.activeCameras&&u.activeCameras.length>0&&(H=u.activeCameras[0]),this.audioListenerPositionProvider){const z=this.audioListenerPositionProvider();Y.audioContext.listener.setPosition(z.x||0,z.y||0,z.z||0)}else H?this._cachedCameraPosition.equals(H.globalPosition)||(this._cachedCameraPosition.J(H.globalPosition),Y.audioContext.listener.setPosition(H.globalPosition.x,H.globalPosition.y,H.globalPosition.z)):Y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const z=this.audioListenerRotationProvider();Y.audioContext.listener.setOrientation(z.x||0,z.y||0,z.z||0,0,1,0)}else H?(H.rigCameras&&H.rigCameras.length>0&&(H=H.rigCameras[0]),H.getViewMatrix().invertToRef(this._invertMatrixTemp),E.p.TransformNormalToRef(JY._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.J(this._cameraDirectionTemp),Y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(z=0;z<u.mainSoundTrack.soundCollection.length;z++){const Y=u.mainSoundTrack.soundCollection[z];Y.useCustomAttenuation&&Y.updateDistanceFromListener()}if(u.soundTracks)for(z=0;z<u.soundTracks.length;z++)for(let Y=0;Y<u.soundTracks[z].soundCollection.length;Y++){const H=u.soundTracks[z].soundCollection[Y];H.useCustomAttenuation&&H.updateDistanceFromListener()}}}}JY._CameraDirection=new E.p(0,0,-1),Bu._SceneComponentInitialization=z=>{let u=z._getComponent(zY.c.NAME_AUDIO);u||(u=new JY(z),z.ml(u))};const lY="MSFT_audio_emitter";class TY{constructor(z){this.name=lY,this._loader=z,this.enabled=this._loader.isExtensionUsed(lY)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const z=this._loader.zT.extensions;if(z&&z[this.name]){const u=z[this.name];this._clips=u.clips,this._emitters=u.emitters,S.Assign(this._clips),S.Assign(this._emitters)}}loadSceneAsync(z,u){return y.LoadExtensionAsync(z,u,this.name,(async(Y,H)=>{const E=new Array;E.push(this._loader.loadSceneAsync(z,u));for(const z of H.emitters){const u=S.Get(`${Y}/emitters`,this._emitters,z);if(void 0!=u.refDistance||void 0!=u.maxDistance||void 0!=u.rolloffFactor||void 0!=u.distanceModel||void 0!=u.innerAngle||void 0!=u.outerAngle)throw new Error(`${Y}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${Y}/emitters/${u.index}`,u))}await Promise.all(E)}))}loadNodeAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(z,H)=>{const J=new Array,T=await this._loader.loadNodeAsync(z,u,(u=>{for(const Y of H.emitters){const H=S.Get(`${z}/emitters`,this._emitters,Y);J.push(this._loadEmitterAsync(`${z}/emitters/${H.index}`,H).then((()=>{for(const z of H._babylonSounds)z.attachToMesh(u),void 0==H.innerAngle&&void 0==H.outerAngle||(z.setLocalDirectionToMesh(E.p.Forward()),z.setDirectionalCone(2*l.e.ToDegrees(void 0==H.innerAngle?Math.PI:H.innerAngle),2*l.e.ToDegrees(void 0==H.outerAngle?Math.PI:H.outerAngle),0))})))}Y(u)}));return await Promise.all(J),T}))}loadAnimationAsync(z,u){return y.LoadExtensionAsync(z,u,this.name,(async(Y,H)=>{const E=await this._loader.loadAnimationAsync(z,u),J=new Array;S.Assign(H.events);for(const l of H.events)J.push(this._loadAnimationEventAsync(`${Y}/events/${l.index}`,z,u,l,E));return await Promise.all(J),E}))}_loadClipAsync(z,u){if(u._objectURL)return u._objectURL;let Y;if(u.uri)Y=this._loader.loadUriAsync(z,u,u.uri);else{const H=S.Get(`${z}/bufferView`,this._loader.zT.bufferViews,u.bufferView);Y=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return u._objectURL=Y.then((z=>URL.createObjectURL(new Blob([z],{type:u.mimeType})))),u._objectURL}_loadEmitterAsync(z,u){if(u._babylonSounds=u._babylonSounds||[],!u._babylonData){const z=new Array,Y=u.name||`emitter${u.index}`,H={loop:!1,autoplay:!1,volume:void 0==u.volume?1:u.volume};for(let J=0;J<u.clips.length;J++){const E=`/extensions/${this.name}/clips`,l=S.Get(E,this._clips,u.clips[J].clip);z.push(this._loadClipAsync(`${E}/${u.clips[J].clip}`,l).then((z=>{const E=u._babylonSounds[J]=new Bu(Y,z,this._loader.babylonScene,null,H);E.refDistance=u.refDistance||1,E.maxDistance=u.maxDistance||256,E.rolloffFactor=u.rolloffFactor||1,E.distanceModel=u.distanceModel||"exponential"})))}const E=Promise.all(z).then((()=>{const z=u.clips.map((z=>z.weight||1)),Y=new fu(u.loop||!1,u._babylonSounds,z);u.innerAngle&&(Y.directionalConeInnerAngle=2*l.e.ToDegrees(u.innerAngle)),u.outerAngle&&(Y.directionalConeOuterAngle=2*l.e.ToDegrees(u.outerAngle)),u.volume&&(Y.volume=u.volume),u._babylonData.sound=Y}));u._babylonData={loaded:E}}return u._babylonData.loaded}_getEventAction(z,u,Y,H,E){switch(Y){case"play":return z=>{const Y=(E||0)+(z-H);u.play(Y)};case"stop":return()=>{u.stop()};case"pause":return()=>{u.pause()};default:throw new Error(`${z}: Unsupported action ${Y}`)}}_loadAnimationEventAsync(z,u,Y,H,E){if(0==E.targetedAnimations.length)return Promise.resolve();const J=E.targetedAnimations[0],l=H.k,T=S.Get(`/extensions/${this.name}/emitters`,this._emitters,l);return this._loadEmitterAsync(z,T).then((()=>{const u=T._babylonData.sound;if(u){const Y=new ku(H.time,this._getEventAction(z,u,H.action,H.time,H.startOffset));J.animation.addEvent(Y),E.onAnimationGroupEndObservable.add((()=>{u.stop()})),E.onAnimationGroupPauseObservable.add((()=>{u.pause()}))}}))}}O(lY),U(lY,!0,(z=>new TY(z)));const bY="MSFT_lod";class LY{constructor(z){var u;this.name=bY,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new D.e,this.onMaterialLODsLoadedObservable=new D.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=z,this.maxLODsToLoad=(null===(u=this._loader.parent.extensionOptions[bY])||void 0===u?void 0:u.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(bY)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let z=0;z<this._nodePromiseLODs.length;z++){const u=Promise.all(this._nodePromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter(`Node LOD ${z}`),this._loader.log(`Loaded node LOD ${z}`)),this.onNodeLODsLoadedObservable.notifyObservers(z),z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${z+1}`),this._loadBufferLOD(this._nodeBufferLODs,z+1),this._nodeSignalLODs[z]&&this._nodeSignalLODs[z].resolve())}));this._loader._completePromises.push(u)}for(let z=0;z<this._materialPromiseLODs.length;z++){const u=Promise.all(this._materialPromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter(`Material LOD ${z}`),this._loader.log(`Loaded material LOD ${z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(z),z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${z+1}`),this._loadBufferLOD(this._materialBufferLODs,z+1),this._materialSignalLODs[z]&&this._materialSignalLODs[z].resolve())}));this._loader._completePromises.push(u)}}loadSceneAsync(z,u){const Y=this._loader.loadSceneAsync(z,u);return this._loadBufferLOD(this._bufferLODs,0),Y}loadNodeAsync(z,u,Y){return y.LoadExtensionAsync(z,u,this.name,(async(z,E)=>{let J;const l=this._getLODs(z,u,this._loader.zT.nodes,E.ids);this._loader.logOpen(`${z}`);for(let u=0;u<l.length;u++){const z=l[u];0!==u&&(this._nodeIndexLOD=u,this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new H);const E=z=>{Y(z),z.oT(!1)},T=this._loader.loadNodeAsync(`/nodes/${z.index}`,z,E).then((z=>{if(0!==u){const z=l[u-1];z._babylonTransformNode&&(this._disposeTransformNode(z._babylonTransformNode),delete z._babylonTransformNode)}return z.oT(!0),z}));this._nodePromiseLODs[u]=this._nodePromiseLODs[u]||[],0===u?J=T:(this._nodeIndexLOD=null,this._nodePromiseLODs[u].push(T))}return this._loader.logClose(),await J}))}_loadMaterialAsync(z,u,Y,H,E){return this._nodeIndexLOD?null:y.LoadExtensionAsync(z,u,this.name,(async(z,J)=>{let l;const T=this._getLODs(z,u,this._loader.zT.materials,J.ids);this._loader.logOpen(`${z}`);for(let u=0;u<T.length;u++){const z=T[u];0!==u&&(this._materialIndexLOD=u);const J=this._loader._loadMaterialAsync(`/materials/${z.index}`,z,Y,H,(z=>{0===u&&E(z)})).then((z=>{if(0!==u){E(z);const Y=T[u-1]._data;Y[H]&&(this._disposeMaterials([Y[H].babylonMaterial]),delete Y[H])}return z}));this._materialPromiseLODs[u]=this._materialPromiseLODs[u]||[],0===u?l=J:(this._materialIndexLOD=null,this._materialPromiseLODs[u].push(J))}return this._loader.logClose(),await l}))}_loadUriAsync(z,u,Y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new H,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(z,u,Y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new H,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(z,u,Y)))}return null}loadBufferAsync(z,u,Y,E){if(this._loader.parent.useRangeRequests&&!u.uri){if(!this._loader.bin)throw new Error(`${z}: Uri is missing or the binary glTF is missing its binary chunk`);const u=async(z,u)=>{const J=Y,l=J+E-1;let T=z[u];return T?(T.start=Math.min(T.start,J),T.end=Math.max(T.end,l)):(T={start:J,end:l,loaded:new H},z[u]=T),await T.loaded.promise.then((z=>new Uint8Array(z.buffer,z.byteOffset+Y-T.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?u(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?u(this._materialBufferLODs,this._materialIndexLOD):u(this._bufferLODs,0)}return null}_loadBufferLOD(z,u){const Y=z[u];Y&&(this._loader.log(`Loading buffer range [${Y.start}-${Y.end}]`),this._loader.bin.readAsync(Y.start,Y.end-Y.start+1).then((z=>{Y.loaded.resolve(z)}),(z=>{Y.loaded.reject(z)})))}_getLODs(z,u,Y,H){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let J=H.length-1;J>=0;J--)if(E.push(S.Get(`${z}/ids/${H[J]}`,Y,H[J])),E.length===this.maxLODsToLoad)return E;return E.push(u),E}_disposeTransformNode(z){const u=[],Y=z.material;Y&&u.push(Y);for(const E of z.getChildMeshes())E.material&&u.push(E.material);z.dispose();const H=u.filter((z=>this._loader.babylonScene.meshes.every((u=>u.material!=z))));this._disposeMaterials(H)}_disposeMaterials(z){const u={};for(const Y of z){for(const z of Y.getActiveTextures())u[z.uniqueId]=z;Y.dispose()}for(const Y in u)for(const z of this._loader.babylonScene.materials)z.hasTexture(u[Y])&&delete u[Y];for(const Y in u)u[Y].dispose()}}O(bY),U(bY,!0,(z=>new LY(z)));const DY="MSFT_minecraftMesh";class gY{constructor(z){this.name=DY,this._loader=z,this.enabled=this._loader.isExtensionUsed(DY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtraAsync(z,u,this.name,(async(H,E)=>{if(E){if(!(Y instanceof t.c))throw new Error(`${H}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(z,u,Y);return Y.needAlphaBlending()&&(Y.forceDepthWrite=!0,Y.separateCullingPass=!0),Y.yl=Y.forceDepthWrite,Y.twoSidedLighting=!0,await E}}))}}O(DY),U(DY,!0,(z=>new gY(z)));const MY="MSFT_sRGBFactors";class qY{constructor(z){this.name=MY,this._loader=z,this.enabled=this._loader.isExtensionUsed(MY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,u,Y){return y.LoadExtraAsync(z,u,this.name,(async(H,E)=>{if(E){if(!(Y instanceof t.c))throw new Error(`${H}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(z,u,Y),J=Y.iz().getEngine().useExactSrgbConversions;return Y.albedoTexture||Y.albedoColor.toLinearSpaceToRef(Y.albedoColor,J),Y.reflectivityTexture||Y.reflectivityColor.toLinearSpaceToRef(Y.reflectivityColor,J),await E}}))}}O(MY),U(MY,!0,(z=>new qY(z)));var CY=Y(12512);const KY={};var hY=Y(12573),oY=Y(12546),dY=Y(12521),tY=Y(12531);function WY(z,u){for(const Y of z)for(const z of Y.dataOutputs)if(z.uniqueId===u)return z;throw new Error("Could not find data out connection with unique id "+u)}function ZY(z,u){for(const Y of z)if(Y instanceof oY.b)for(const z of Y.signalInputs)if(z.uniqueId===u)return z;throw new Error("Could not find signal in connection with unique id "+u)}async function sY(z,u){const H=await Promise.all(z.allBlocks.map((async z=>{const u=function(z){switch(z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Y.e(58),Y.e(59)]).then(Y.bind(Y,13924))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Y.e(60).then(Y.bind(Y,13929))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Y.e(61).then(Y.bind(Y,13934))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Y.e(62).then(Y.bind(Y,13936))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Y.e(63).then(Y.bind(Y,13943))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Y.e(64).then(Y.bind(Y,13945))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Y.e(65).then(Y.bind(Y,13953))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Y.e(66).then(Y.bind(Y,13960))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Y.e(67).then(Y.bind(Y,13962))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Y.e(75).then(Y.bind(Y,14014))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Y.e(76).then(Y.bind(Y,14016))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Y.e(77).then(Y.bind(Y,14023))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Y.e(78).then(Y.bind(Y,14031))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Y.e(79).then(Y.bind(Y,14035))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Y.e(80).then(Y.bind(Y,14043))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Y.e(81).then(Y.bind(Y,14051))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Y.e(82).then(Y.bind(Y,14053))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Y.e(83).then(Y.bind(Y,14062))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Y.e(84).then(Y.bind(Y,14068))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Y.e(85).then(Y.bind(Y,14075))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Y.e(86).then(Y.bind(Y,14083))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Y.e(87).then(Y.bind(Y,14091))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14099))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14106))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Y.e(90).then(Y.bind(Y,14111))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Y.e(91).then(Y.bind(Y,14114))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Y.e(92).then(Y.bind(Y,14119))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Y.e(93).then(Y.bind(Y,14122))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Y.e(72).then(Y.bind(Y,14127))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Y.e(94).then(Y.bind(Y,14134))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Y.e(95).then(Y.bind(Y,14137))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Y.e(96).then(Y.bind(Y,14141))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Y.e(73).then(Y.bind(Y,14144))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Y.e(68).then(Y.bind(Y,13971))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Y.e(74).then(Y.bind(Y,14150))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Y.e(69).then(Y.bind(Y,14e3))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Y.e(70).then(Y.bind(Y,14007))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Y.e(71).then(Y.bind(Y,14158))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Y.e(97).then(Y.bind(Y,14160))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Y.e(98).then(Y.bind(Y,14168))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Y.e(99).then(Y.bind(Y,14175))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Y.e(100).then(Y.bind(Y,14182))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Y.e(101).then(Y.bind(Y,14185))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Y.e(102).then(Y.bind(Y,14193))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Y.e(103).then(Y.bind(Y,14196))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Y.e(104).then(Y.bind(Y,14201))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Y.e(105).then(Y.bind(Y,14208))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Y.e(106).then(Y.bind(Y,14217))).FlowGraphDataSwitchBlock;default:if(KY[z])return KY[z];throw new Error(`Unknown block name ${z}`)}}(z.className);return await u()})));return function(z,u,Y){const H=u.coordinator.createGraph(),E=[],J=u.valueParseFunction??dY.b;for(let l=0;l<z.allBlocks.length;l++){const T=iY(z.allBlocks[l],{Cu:u.coordinator.config.Cu,pathConverter:u.pathConverter,assetsContainer:u.coordinator.config.Cu,valueParseFunction:J},Y[l]);E.push(T),T instanceof hY.b&&H.addEventBlock(T)}for(const l of E){for(const z of l.dataInputs)for(const u of z.connectedPointIds){const Y=WY(E,u);z.connectTo(Y)}if(l instanceof oY.b)for(const z of l.signalOutputs)for(const u of z.connectedPointIds){const Y=ZY(E,u);z.connectTo(Y)}}for(const l of z.executionContexts)vY(l,{graph:H,valueParseFunction:J},z.rightHanded);return H}(z,u,H)}function vY(z,u,Y){const H=u.graph.createContext();z.enableLogging&&(H.enableLogging=!0),H.treatDataAsRightHanded=Y||!1;const E=u.valueParseFunction??dY.b;H.uniqueId=z.uniqueId;const J=H.iz();if(z._assetsContext){var l,T,b,L,D,g,M,q,C,K;const u=z._assetsContext,Y={meshes:null===(l=u.meshes)||void 0===l?void 0:l.map((z=>J.getMeshById(z))),lights:null===(T=u.lights)||void 0===T?void 0:T.map((z=>J.getLightByName(z))),cameras:null===(b=u.cameras)||void 0===b?void 0:b.map((z=>J.getCameraByName(z))),materials:null===(L=u.materials)||void 0===L?void 0:L.map((z=>J.getMaterialById(z))),textures:null===(D=u.textures)||void 0===D?void 0:D.map((z=>J.getTextureByName(z))),animations:null===(g=u.animations)||void 0===g?void 0:g.map((z=>J.animations.find((u=>u.name===z)))),skeletons:null===(M=u.skeletons)||void 0===M?void 0:M.map((z=>J.getSkeletonByName(z))),QM:null===(q=u.QM)||void 0===q?void 0:q.map((z=>J.getParticleSystemById(z))),animationGroups:null===(C=u.animationGroups)||void 0===C?void 0:C.map((z=>J.getAnimationGroupByName(z))),transformNodes:null===(K=u.transformNodes)||void 0===K?void 0:K.map((z=>J.getTransformNodeById(z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],bq:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};H.assetsContext=Y}for(const h in z._userVariables){const u=E(h,z._userVariables,H.assetsContext,J);H.userVariables[h]=u}for(const h in z._connectionValues){const u=E(h,z._connectionValues,H.assetsContext,J);H._setConnectionValueByKey(h,u)}return H}function iY(z,u,Y){const H={},E=u.valueParseFunction??dY.b;if(z.config)for(const l in z.config)H[l]=E(l,z.config,u.assetsContainer||u.Cu,u.Cu);if((0,dY.h)(z.className)){if(!u.pathConverter)throw new Error("Path converter is required for this block");H.pathConverter=u.pathConverter}const J=new Y(H);J.uniqueId=z.uniqueId;for(let l=0;l<z.dataInputs.length;l++){const u=J.getDataInput(z.dataInputs[l].name);if(!u)throw new Error("Could not find data input with name "+z.dataInputs[l].name+" in block "+z.className);u.deserialize(z.dataInputs[l])}for(let l=0;l<z.dataOutputs.length;l++){const u=J.getDataOutput(z.dataOutputs[l].name);if(!u)throw new Error("Could not find data output with name "+z.dataOutputs[l].name+" in block "+z.className);u.deserialize(z.dataOutputs[l])}return J.metadata=z.metadata,J.deserialize&&J.deserialize(z),J}function XY(z){const[u,Y]=z.split(":");return QY({op:u,extension:Y})}function QY(z){var u;let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=z.extension?null===(u=AY[z.extension])||void 0===u?void 0:u[z.op]:xY[z.op];if(!H&&(K.b.Warn(`No mapping found for operation ${z.op} and extension ${z.extension||"KHR_interactivity"}`),Y)){const u={},Y={flows:{}};if(z.inputValueSockets){u.values={};for(const Y in z.inputValueSockets)u.values[Y]={name:Y}}return z.outputValueSockets&&(Y.values={},Object.keys(z.outputValueSockets).forEach((z=>{Y.values[z]={name:z}}))),{VD:[],inputs:u,outputs:Y}}return H}function VY(z,u,Y){AY[u]||(AY[u]={}),AY[u][z]=Y}const AY={BABYLON:{"flow/log":{VD:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},xY={"event/onStart":{VD:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{VD:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{VD:["FlowGraphSendCustomEventBlock"],extraProcessor(z,u,Y,H,E){if("event/send"!==u.op||!z.configuration||1!==Object.keys(z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const J=z.configuration.event.value[0];if("number"!==typeof J)throw new Error("Event id should be a number");const l=H.arrays.events[J],T=E[0];return T.config||(T.config={}),T.config.eventId=l.eventId,T.config.eventData=l.eventData,E}},"event/receive":{VD:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(z,u){var Y;if(!z.configuration)return K.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const H=z.configuration.event;if(!H)return K.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=H.value[0];if("number"!==typeof E)return K.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Y=u.events)||void 0===Y?void 0:Y[E])?{valid:!0}:(K.b.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(z,u,Y,H,E){if("event/receive"!==u.op||!z.configuration||1!==Object.keys(z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const J=z.configuration.event.value[0];if("number"!==typeof J)throw new Error("Event id should be a number");const l=H.arrays.events[J],T=E[0];return T.config||(T.config={}),T.config.eventId=l.eventId,T.config.eventData=l.eventData,E}},"math/e":GY("FlowGraphEBlock"),"math/pi":GY("FlowGraphPIBlock"),"math/inf":GY("FlowGraphInfBlock"),"math/nan":GY("FlowGraphNaNBlock"),"math/abs":GY("FlowGraphAbsBlock"),"math/sign":GY("FlowGraphSignBlock"),"math/trunc":GY("FlowGraphTruncBlock"),"math/floor":GY("FlowGraphFloorBlock"),"math/ceil":GY("FlowGraphCeilBlock"),"math/round":{VD:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E){var J;return(J=E[0]).config||(J.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":GY("FlowGraphFractBlock"),"math/neg":GY("FlowGraphNegationBlock"),"math/add":GY("FlowGraphAddBlock",["a","b"],!0),"math/sub":GY("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{VD:["FlowGraphMultiplyBlock"],extraProcessor(z,u,Y,H,E){var J;(J=E[0]).config||(J.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let l=-1;return Object.keys(z.values||{}).find((u=>{var Y;return void 0!==(null===(Y=z.values)||void 0===Y?void 0:Y[u].type)&&(l=z.values[u].type,!0)})),-1!==l&&(E[0].config.type=H.arrays.types[l].flowGraphType),E},validation:z=>z.values?FY(z):{valid:!0}},"math/div":GY("FlowGraphDivideBlock",["a","b"],!0),"math/rem":GY("FlowGraphModuloBlock",["a","b"]),"math/min":GY("FlowGraphMinBlock",["a","b"]),"math/max":GY("FlowGraphMaxBlock",["a","b"]),"math/clamp":GY("FlowGraphClampBlock",["a","b","c"]),"math/saturate":GY("FlowGraphSaturateBlock"),"math/mix":GY("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":GY("FlowGraphEqualityBlock",["a","b"]),"math/lt":GY("FlowGraphLessThanBlock",["a","b"]),"math/le":GY("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":GY("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":GY("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":GY("FlowGraphIsNaNBlock"),"math/isinf":GY("FlowGraphIsInfBlock"),"math/select":{VD:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{VD:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":GY("FlowGraphSinBlock"),"math/cos":GY("FlowGraphCosBlock"),"math/tan":GY("FlowGraphTanBlock"),"math/asin":GY("FlowGraphASinBlock"),"math/acos":GY("FlowGraphACosBlock"),"math/atan":GY("FlowGraphATanBlock"),"math/atan2":GY("FlowGraphATan2Block",["a","b"]),"math/sinh":GY("FlowGraphSinhBlock"),"math/cosh":GY("FlowGraphCoshBlock"),"math/tanh":GY("FlowGraphTanhBlock"),"math/asinh":GY("FlowGraphASinhBlock"),"math/acosh":GY("FlowGraphACoshBlock"),"math/atanh":GY("FlowGraphATanhBlock"),"math/exp":GY("FlowGraphExponentialBlock"),"math/log":GY("FlowGraphLogBlock"),"math/log2":GY("FlowGraphLog2Block"),"math/log10":GY("FlowGraphLog10Block"),"math/sqrt":GY("FlowGraphSquareRootBlock"),"math/cbrt":GY("FlowGraphCubeRootBlock"),"math/pow":GY("FlowGraphPowerBlock",["a","b"]),"math/length":GY("FlowGraphLengthBlock"),"math/normalize":GY("FlowGraphNormalizeBlock"),"math/dot":GY("FlowGraphDotBlock",["a","b"]),"math/cross":GY("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":GY("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":GY("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{VD:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{VD:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{VD:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{VD:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{VD:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{VD:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{VD:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":GY("FlowGraphTransposeBlock"),"math/determinant":GY("FlowGraphDeterminantBlock"),"math/inverse":GY("FlowGraphInvertMatrixBlock"),"math/matmul":GY("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{VD:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"el",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E,J){const l=E[0].dataInputs.find((z=>"rotationQuaternion"===z.name));if(!l)throw new Error("Rotation quaternion input not found");return J._connectionValues[l.uniqueId]&&(J._connectionValues[l.uniqueId].type="Quaternion"),E}},"math/matDecompose":{VD:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"el"}}}},"math/quatConjugate":GY("FlowGraphConjugateBlock",["a"]),"math/quatMul":{VD:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E){var J;return(J=E[0]).config||(J.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":GY("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{VD:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":GY("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":GY("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{VD:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E){var J;return(J=E[0]).config||(J.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{VD:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{VD:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E){var J;return(J=E[0]).config||(J.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{VD:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{VD:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E){var J;return(J=E[0]).config||(J.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{VD:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{VD:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E,J){var l,T;(T=E[0]).config||(T.config={});const b=E[0].dataInputs[0];return E[0].config.valueType=(null===(l=J._connectionValues[b.uniqueId])||void 0===l?void 0:l.type)??"FlowGraphInteger",E}},"math/and":{VD:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E,J){var l,T,b;(b=E[0]).config||(b.config={});const L=E[0].dataInputs[0],D=E[0].dataInputs[1];return E[0].config.valueType=(null===(l=J._connectionValues[L.uniqueId])||void 0===l?void 0:l.type)??(null===(T=J._connectionValues[D.uniqueId])||void 0===T?void 0:T.type)??"FlowGraphInteger",E}},"math/or":{VD:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E,J){var l,T,b;(b=E[0]).config||(b.config={});const L=E[0].dataInputs[0],D=E[0].dataInputs[1];return E[0].config.valueType=(null===(l=J._connectionValues[L.uniqueId])||void 0===l?void 0:l.type)??(null===(T=J._connectionValues[D.uniqueId])||void 0===T?void 0:T.type)??"FlowGraphInteger",E}},"math/xor":{VD:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(z,u,Y,H,E,J){var l,T,b;(b=E[0]).config||(b.config={});const L=E[0].dataInputs[0],D=E[0].dataInputs[1];return E[0].config.valueType=(null===(l=J._connectionValues[L.uniqueId])||void 0===l?void 0:l.type)??(null===(T=J._connectionValues[D.uniqueId])||void 0===T?void 0:T.type)??"FlowGraphInteger",E}},"math/asr":GY("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":GY("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":GY("FlowGraphLeadingZerosBlock"),"math/ctz":GY("FlowGraphTrailingZerosBlock"),"math/popcnt":GY("FlowGraphOneBitsCounterBlock"),"math/rad":GY("FlowGraphDegToRadBlock"),"math/deg":GY("FlowGraphRadToDegBlock"),"type/boolToInt":GY("FlowGraphBooleanToInt"),"type/boolToFloat":GY("FlowGraphBooleanToFloat"),"type/intToBool":GY("FlowGraphIntToBoolean"),"type/intToFloat":GY("FlowGraphIntToFloat"),"type/floatToInt":GY("FlowGraphFloatToInt"),"type/floatToBool":GY("FlowGraphFloatToBoolean"),"flow/sequence":{VD:["FlowGraphSequenceBlock"],extraProcessor(z,u,Y,H,E){const J=E[0];return J.config||(J.config={}),J.config.outputSignalCount=Object.keys(z.flows||[]).length,J.signalOutputs.forEach(((z,u)=>{z.name="out_"+u})),E}},"flow/branch":{VD:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{VD:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(z){if(z.configuration&&z.configuration.cases){const u=z.configuration.cases.value;if(!u.every((z=>"number"===typeof z&&/^-?\d+$/.test(z.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),z.configuration.cases.value=[],{valid:!0};const Y=new Set(u);z.configuration.cases.value=Array.from(Y)}return{valid:!0}},extraProcessor(z,u,Y,H,E){if("flow/switch"!==u.op||!z.flows||0===Object.keys(z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((z=>{"default"!==z.name&&(z.name="out_"+z.name)})),E}},"flow/while":{VD:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{VD:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(z,u,Y,H,E){const J=E[0];return J.config||(J.config={}),J.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{VD:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{VD:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(z,u,Y,H,E){if("flow/multiGate"!==u.op||!z.flows||0===Object.keys(z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const J=E[0];return J.config||(J.config={}),J.config.outputSignalCount=Object.keys(z.flows).length,J.signalOutputs.forEach(((z,u)=>{z.name="out_"+u})),E}},"flow/waitAll":{VD:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(z){var u,Y;return"number"!==typeof(null===(u=z.configuration)||void 0===u||null===(Y=u.inputFlows)||void 0===Y?void 0:Y.value[0])&&(z.configuration=z.configuration||{inputFlows:{value:[0]}},z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{VD:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{VD:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{VD:["FlowGraphCancelDelayBlock"]},"variable/get":{VD:["FlowGraphGetVariableBlock"],validation(z){var u,Y;return null!==(u=z.configuration)&&void 0!==u&&null!==(Y=u.variable)&&void 0!==Y&&Y.value?{valid:!0}:(K.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]}}},"variable/set":{VD:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]}}},"variable/setMultiple":{VD:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(z,u)=>[z[0].map((z=>u.getVariableName(z)))]}},extraProcessor:(z,u,Y,H,E)=>(E[0].dataInputs.forEach((z=>{z.name=H.getVariableName(+z.name)})),E)},"variable/interpolate":{VD:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(z,u)=>[u.getVariableName(z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:z=>!0===z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",bY:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",bY:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",bY:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",bY:"FlowGraphPlayAnimationBlock"},out:{name:"out",bY:"FlowGraphPlayAnimationBlock"},done:{name:"done",bY:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(z,u,Y,H,E){var J,l,T;const b=E[0],L=null===(J=z.configuration)||void 0===J?void 0:J.variable.value[0];if("number"!==typeof L)throw K.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const D=H.arrays.staticVariables[L];"undefined"===typeof b.config.animationType.value&&(H.arrays.staticVariables,b.config.animationType.value=(0,tY.E)(D.type));const g=E[4];return g.config||(g.config={}),(l=g.config).variable||(l.variable={}),g.config.variable.value=H.getVariableName(L),(T=E[3]).config||(T.config={}),E}},"pointer/get":{VD:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",bY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",bY:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,Y,H,E)=>(E.forEach((z=>{"FlowGraphJsonPointerParserBlock"===z.className&&(z.config||(z.config={}),z.config.outputValue=!0)})),E)},"pointer/set":{VD:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",bY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",bY:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,Y,H,E)=>(E.forEach((z=>{"FlowGraphJsonPointerParserBlock"===z.className&&(z.config||(z.config={}),z.config.outputValue=!0)})),E)},"pointer/interpolate":{VD:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",bY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",bY:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",bY:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",bY:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",bY:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",bY:"FlowGraphPlayAnimationBlock"},out:{name:"out",bY:"FlowGraphPlayAnimationBlock"},done:{name:"done",bY:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(z,u,Y,H,E)=>(E.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className?(u.config||(u.config={}),u.config.outputValue=!0):"FlowGraphInterpolationBlock"===u.className&&(u.config||(u.config={}),Object.keys(z.values||[]).forEach((Y=>{var E;const J=null===(E=z.values)||void 0===E?void 0:E[Y];if("value"===Y&&J){const z=J.type;void 0!==z&&(u.config.animationType=H.arrays.types[z].flowGraphType)}})))})),E)},"animation/start":{VD:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",bY:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){const T=E[E.length-1];return T.config||(T.config={}),T.config.glTF=l,E}},"animation/stop":{VD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",bY:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){const T=E[E.length-1];return T.config||(T.config={}),T.config.glTF=l,E}},"animation/stopAt":{VD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",bY:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(z,u)=>[z[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){const T=E[E.length-1];return T.config||(T.config={}),T.config.glTF=l,E}},"math/switch":{VD:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(z){if(z.configuration&&z.configuration.cases){const u=z.configuration.cases.value;if(!u.every((z=>"number"===typeof z&&/^-?\d+$/.test(z.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),z.configuration.cases.value=[],{valid:!0};const Y=new Set(u);z.configuration.cases.value=Array.from(Y)}return{valid:!0}},extraProcessor(z,u,Y,H,E){const J=E[0];return J.dataInputs.forEach((z=>{"default"!==z.name&&"case"!==z.name&&(z.name="in_"+z.name)})),J.config||(J.config={}),J.config.treatCasesAsIntegers=!0,E}},"debug/log":{VD:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function GY(z){let u=arguments.length>2?arguments[2]:void 0;return{VD:[z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((z,u)=>(z[u]={name:u},z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(z,Y,H,E,J){var l;if(u){(l=J[0]).config||(l.config={}),J[0].config.preventIntegerFloatArithmetic=!0;let u=-1;Object.keys(z.values||{}).find((Y=>{var H;return void 0!==(null===(H=z.values)||void 0===H?void 0:H[Y].type)&&(u=z.values[Y].type,!0)})),-1!==u&&(J[0].config.type=E.arrays.types[u].flowGraphType)}return J},validation:z=>u?FY(z):{valid:!0}}}function FY(z){if(z.values){const u=Object.keys(z.values).map((u=>z.values[u].type)).filter((z=>void 0!==z));if(!u.every((z=>z===u[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}xY["math/compose"]=xY["math/matCompose"],xY["math/decompose"]=xY["math/matDecompose"];var RY=Y(11064);const wY={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Pl",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class cY{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=z,this._gltf=u,this._animationTargetFps=Y,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const z of this._interactivityGraph.types)this._types.push(wY[z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const z of this._interactivityGraph.declarations){const u=QY(z);if(!u)throw K.b.Error(["No mapping found for declaration",z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:u,fullOperationName:z.extension?z.op+":"+z.extension:z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const z of this._interactivityGraph.variables){const u=this._parseVariable(z);this._staticVariables.push(u)}}_parseVariable(z,u){const Y=this._types[z.type];if(!Y)throw K.b.Error(["No type found for variable",z]),new Error("Error parsing variables");if(z.value&&z.value.length!==Y.length)throw K.b.Error(["Invalid value length for variable",z,Y]),new Error("Error parsing variables");const H=z.value||[];if(!H.length)switch(Y.flowGraphType){case"boolean":H.push(!1);break;case"FlowGraphInteger":H.push(0);break;case"number":H.push(NaN);break;case"Vector2":H.push(NaN,NaN);break;case"Pl":H.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":H.fill(NaN,0,4);break;case"Matrix":H.fill(NaN,0,16);break;case"Matrix3D":H.fill(NaN,0,9)}return"number"===Y.elementType&&"string"===typeof H[0]&&(H[0]=parseFloat(H[0])),{type:Y.flowGraphType,value:u?u(H,this):H}}_parseEvents(){if(this._interactivityGraph.events)for(const z of this._interactivityGraph.events){const u={eventId:z.id||"internalEvent_"+this._internalEventsCounter++};z.values&&(u.eventData=Object.keys(z.values).map((u=>{var Y;const H=null===(Y=z.values)||void 0===Y?void 0:Y[u];if(!H)throw K.b.Error(["No value found for event key",u]),new Error("Error parsing events");const E=this._types[H.type];if(!E)throw K.b.Error(["No type found for event value",H]),new Error("Error parsing events");const J="undefined"!==typeof H.value?this._parseVariable(H):void 0;return{id:u,type:E.flowGraphType,eventData:!0,value:J}}))),this._events.push(u)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const u of this._interactivityGraph.nodes){if("number"!==typeof u.declaration)throw K.b.Error(["No declaration found for node",u]),new Error("Error parsing nodes");const Y=this._mappings[u.declaration];if(!Y)throw K.b.Error(["No mapping found for node",u]),new Error("Error parsing nodes");if(Y.flowGraphMapping.validation){const H=Y.flowGraphMapping.validation(u,this._interactivityGraph,this._gltf);var z;if(!H.valid)throw new Error(`Error validating interactivity node ${null===(z=this._interactivityGraph.declarations)||void 0===z?void 0:z[u.declaration].op} - ${H.error}`)}const H=[];for(const z of Y.flowGraphMapping.VD){const E=this._getEmptyBlock(z,Y.fullOperationName);this._parseNodeConfiguration(u,E,Y.flowGraphMapping,z),H.push(E)}this._nodes.push({VD:H,fullOperationName:Y.fullOperationName})}}_getEmptyBlock(z,u){return{uniqueId:(0,RY.b)(),className:z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:u,metadata:{}}}_parseNodeConfiguration(z,u,Y,H){const E=u.config;if(z.configuration){const u=Object.keys(z.configuration);for(const T of u){var J,l;const u=null===(J=z.configuration)||void 0===J?void 0:J[T];if(!u)throw K.b.Error(["No value found for node configuration",T]),new Error("Error parsing node configuration");const b=null===(l=Y.configuration)||void 0===l?void 0:l[T];if(b&&b.bY?b.bY===H:0===Y.VD.indexOf(H)){const z=(null===b||void 0===b?void 0:b.name)||T;u&&"undefined"!==typeof u.value||"undefined"===typeof(null===b||void 0===b?void 0:b.defaultValue)?u.value.length>=0?E[z]={value:1===u.value.length?u.value[0]:u.value}:K.b.Warn(["Invalid value for node configuration",u]):E[z]={value:b.defaultValue},b&&b.dataTransformer&&(E[z].value=b.dataTransformer([E[z].value],this)[0])}}}}_parseNodeConnections(z){for(let s=0;s<this._nodes.length;s++){var u;const v=null===(u=this._interactivityGraph.nodes)||void 0===u?void 0:u[s];if(!v)throw K.b.Error(["No node found for interactivity node",this._nodes[s]]),new Error("Error parsing node connections");const i=this._nodes[s],X=this._mappings[v.declaration];if(!X)throw K.b.Error(["No mapping found for node",v]),new Error("Error parsing node connections");const Q=v.flows||{},V=Object.keys(Q).sort();for(const z of V){var Y,H,E,J;const u=Q[z],L=null===(Y=X.flowGraphMapping.outputs)||void 0===Y||null===(H=Y.flows)||void 0===H?void 0:H[z],D=(null===L||void 0===L?void 0:L.name)||z,g=this._createNewSocketConnection(D,!0);(L&&L.bY&&i.VD.find((z=>z.className===L.bY))||i.VD[0]).signalOutputs.push(g);const M=u.node,q=this._nodes[M];if(!q)throw K.b.Error(["No node found for input node id",M]),new Error("Error parsing node connections");const C=XY(q.fullOperationName);if(!C)throw K.b.Error(["No mapping found for input node",q]),new Error("Error parsing node connections");let h=null===(E=C.inputs)||void 0===E||null===(J=E.flows)||void 0===J?void 0:J[u.socket||"in"],o=!1;if(!h)for(const z in null===(l=C.inputs)||void 0===l?void 0:l.flows){var l,T,b;if(z.startsWith("[")&&z.endsWith("]"))o=!0,h=null===(T=C.inputs)||void 0===T||null===(b=T.flows)||void 0===b?void 0:b[z]}const d=h?o?h.name.replace("$1",u.socket||""):h.name:u.socket||"in",t=h&&h.bY&&q.VD.find((z=>z.className===h.bY))||q.VD[0];let W=t.signalInputs.find((z=>z.name===d));W||(W=this._createNewSocketConnection(d),t.signalInputs.push(W)),W.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(W.uniqueId)}const A=v.values||{},x=Object.keys(A);for(const u of x){var L,D;const Y=A[u];let H=null===(L=X.flowGraphMapping.inputs)||void 0===L||null===(D=L.values)||void 0===D?void 0:D[u],E=!1;if(!H)for(const z in null===(g=X.flowGraphMapping.inputs)||void 0===g?void 0:g.values){var g,M,q;if(z.startsWith("[")&&z.endsWith("]"))E=!0,H=null===(M=X.flowGraphMapping.inputs)||void 0===M||null===(q=M.values)||void 0===q?void 0:q[z]}const J=H?E?H.name.replace("$1",u):H.name:u,l=this._createNewSocketConnection(J);if((H&&H.bY&&i.VD.find((z=>z.className===H.bY))||i.VD[0]).dataInputs.push(l),void 0!==Y.value){const u=this._parseVariable(Y,H&&H.dataTransformer);z._connectionValues[l.uniqueId]=u}else{if("undefined"===typeof Y.node)throw K.b.Error(["Invalid value for value connection",Y]),new Error("Error parsing node connections");{var C,h,o;const z=Y.node,u=Y.socket||"value",H=this._nodes[z];if(!H)throw K.b.Error(["No node found for output socket reference",Y]),new Error("Error parsing node connections");const E=XY(H.fullOperationName);if(!E)throw K.b.Error(["No mapping found for output socket reference",Y]),new Error("Error parsing node connections");let J=null===(C=E.outputs)||void 0===C||null===(h=C.values)||void 0===h?void 0:h[u],T=!1;if(!J)for(const Y in null===(d=E.outputs)||void 0===d?void 0:d.values){var d,t,W;if(Y.startsWith("[")&&Y.endsWith("]"))T=!0,J=null===(t=E.outputs)||void 0===t||null===(W=t.values)||void 0===W?void 0:W[Y]}const b=J?T?J.name.replace("$1",u):null===(o=J)||void 0===o?void 0:o.name:u,L=J&&J.bY&&H.VD.find((z=>z.className===J.bY))||H.VD[0];let D=L.dataOutputs.find((z=>z.name===b));D||(D=this._createNewSocketConnection(b,!0),L.dataOutputs.push(D)),l.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(l.uniqueId)}}}if(X.flowGraphMapping.interBlockConnectors)for(const z of X.flowGraphMapping.interBlockConnectors){const u=z.input,Y=z.output,H=z.isVariable;this._connectFlowGraphNodes(u,Y,i.VD[z.inputBlockIndex],i.VD[z.outputBlockIndex],H)}if(X.flowGraphMapping.extraProcessor){var Z;const u=null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[v.declaration];if(!u)throw K.b.Error(["No declaration found for extra processor",v]),new Error("Error parsing node connections");i.VD=X.flowGraphMapping.extraProcessor(v,u,X.flowGraphMapping,this,i.VD,z,this._gltf)}}}_createNewSocketConnection(z,u){return{uniqueId:(0,RY.b)(),name:z,_connectionType:u?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(z,u,Y,H,E){const J=E?Y.dataInputs:Y.signalInputs,l=E?H.dataOutputs:H.signalOutputs,T=J.find((u=>u.name===z))||this._createNewSocketConnection(z),b=l.find((z=>z.name===u))||this._createNewSocketConnection(u,!0);J.find((u=>u.name===z))||J.push(T),l.find((z=>z.name===u))||l.push(b),T.connectedPointIds.push(b.uniqueId),b.connectedPointIds.push(T.uniqueId)}getVariableName(z){return"staticVariable_"+z}serializeToFlowGraph(){const z={uniqueId:(0,RY.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(z);for(let u=0;u<this._staticVariables.length;u++){const Y=this._staticVariables[u];z._userVariables[this.getVariableName(u)]=Y}return{rightHanded:!0,allBlocks:this._nodes.reduce(((z,u)=>z.concat(u.VD)),[]),executionContexts:[z]}}}const UY="KHR_interactivity";class OY{constructor(z){this._loader=z,this.name=UY,this.enabled=this._loader.isExtensionUsed(UY),this._pathConverter=(0,n.j)(this._loader.zT),z._skipStartAnimationStep=!0;const u=z.babylonScene;u&&function(z){(0,n.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!z.activeCamera)return new E.f(NaN,NaN,NaN,NaN);const u=E.f.FromRotationMatrix(z.activeCamera.getWorldMatrix()).normalize();return z.useRightHandedSystem||(u.w*=-1,u.x*=-1),u},type:"Quaternion",getTarget:()=>z.activeCamera}),(0,n.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!z.activeCamera)return new E.p(NaN,NaN,NaN);const u=z.activeCamera.getWorldMatrix().getTranslation();return z.useRightHandedSystem||(u.x*=-1),u},type:"Pl",getTarget:()=>z.activeCamera}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:z=>{var u;return(null===(u=z._babylonAnimationGroup)||void 0===u?void 0:u.isPlaying)??!1},type:"boolean",getTarget:z=>z._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:z=>{var u;return((null===(u=z._babylonAnimationGroup)||void 0===u?void 0:u.from)??0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:z=>{var u;return((null===(u=z._babylonAnimationGroup)||void 0===u?void 0:u.to)??0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:z=>{var u;return((null===(u=z._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup}),(0,n.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:z=>{var u;return((null===(u=z._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:z=>z._babylonAnimationGroup})}(u)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var z;if(!this._loader.babylonScene||!this._pathConverter)return;const u=this._loader.babylonScene,Y=null===(z=this._loader.zT.extensions)||void 0===z?void 0:z.KHR_interactivity;if(!Y)return;const H=new CY.b({Cu:u});H.dispatchEventsSynchronously=!1;const E=Y.graphs.map((z=>new cY(z,this._loader.zT,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async z=>await sY(z,{coordinator:H,pathConverter:this._pathConverter})))),H.start()}}var nY;nY=async()=>(await Promise.resolve().then(Y.bind(Y,12582))).FlowGraphGLTFDataProvider,KY[`${UY}/${"FlowGraphGLTFDataProvider"}`]=nY,O(UY),U(UY,!0,(z=>new OY(z)));const mY="KHR_node_visibility";(0,n.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.isVisible||u.isVisible},set:(z,u)=>{var Y,H;null===(Y=u._primitiveBabylonMeshes)||void 0===Y||Y.forEach((z=>{z.inheritVisibility=!0})),u._babylonTransformNode&&(u._babylonTransformNode.isVisible=z),null===(H=u._primitiveBabylonMeshes)||void 0===H||H.forEach((u=>{u.isVisible=z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class pY{constructor(z){this.name=mY,this._loader=z,this.enabled=z.isExtensionUsed(mY)}async onReady(){var z;null===(z=this._loader.zT.nodes)||void 0===z||z.forEach((z=>{var u,Y,H,E;(null===(u=z._primitiveBabylonMeshes)||void 0===u||u.forEach((z=>{z.inheritVisibility=!0})),null!==(Y=z.extensions)&&void 0!==Y&&Y.KHR_node_visibility)&&(!1===(null===(H=z.extensions)||void 0===H?void 0:H.KHR_node_visibility.visible)&&(z._babylonTransformNode&&(z._babylonTransformNode.isVisible=!1),null===(E=z._primitiveBabylonMeshes)||void 0===E||E.forEach((z=>{z.isVisible=!1}))))}))}dispose(){this._loader=null}}O(mY),U(mY,!0,(z=>new pY(z)));const SY="KHR_node_selectability";VY("event/onSelect",SY,{VD:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bY:"FlowGraphGetVariableBlock",dataTransformer:z=>["pickedMesh_"+z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",bY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){var T,b,L,D,g,M;const q=E[E.length-1];q.config=q.config||{},q.config.glTF=l;const C=null===(T=z.configuration)||void 0===T||null===(b=T.nodeIndex)||void 0===b?void 0:b.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const K="pickedMesh_"+C;return E[1].config.variable=K,J._userVariables[K]={className:"Mesh",id:null===l||void 0===l||null===(L=l.nodes)||void 0===L||null===(D=L[C]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===l||void 0===l||null===(g=l.nodes)||void 0===g||null===(M=g[C]._babylonTransformNode)||void 0===M?void 0:M.uniqueId},E}}),(0,n.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.YL||u.YL},set:(z,u)=>{var Y;null===(Y=u._primitiveBabylonMeshes)||void 0===Y||Y.forEach((u=>{u.YL=z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"YL"],type:"boolean"});class IY{constructor(z){this.name=SY,this._loader=z,this.enabled=z.isExtensionUsed(SY)}async onReady(){var z;null===(z=this._loader.zT.nodes)||void 0===z||z.forEach((z=>{var u,Y,H;null!==(u=z.extensions)&&void 0!==u&&u.KHR_node_selectability&&!1===(null===(Y=z.extensions)||void 0===Y?void 0:Y.KHR_node_selectability.selectable)&&(null===(H=z._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((z=>{z.YL=!1})))}))}dispose(){this._loader=null}}O(SY),U(SY,!0,(z=>new IY(z)));const yY="KHR_node_hoverability",aY="targetMeshPointerOver_";VY("event/onHoverIn",yY,{VD:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bY:"FlowGraphGetVariableBlock",dataTransformer:z=>[aY+z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",bY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){var T,b,L,D,g,M;const q=E[E.length-1];q.config=q.config||{},q.config.glTF=l;const C=null===(T=z.configuration)||void 0===T||null===(b=T.nodeIndex)||void 0===b?void 0:b.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const K=aY+C;return E[1].config.variable=K,J._userVariables[K]={className:"Mesh",id:null===l||void 0===l||null===(L=l.nodes)||void 0===L||null===(D=L[C]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===l||void 0===l||null===(g=l.nodes)||void 0===g||null===(M=g[C]._babylonTransformNode)||void 0===M?void 0:M.uniqueId},E}});const jY="targetMeshPointerOut_";VY("event/onHoverOut",yY,{VD:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bY:"FlowGraphGetVariableBlock",dataTransformer:z=>[jY+z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",bY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(z,u,Y,H,E,J,l){var T,b,L,D,g,M;const q=E[E.length-1];q.config=q.config||{},q.config.glTF=l;const C=null===(T=z.configuration)||void 0===T||null===(b=T.nodeIndex)||void 0===b?void 0:b.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const K=jY+C;return E[1].config.variable=K,J._userVariables[K]={className:"Mesh",id:null===l||void 0===l||null===(L=l.nodes)||void 0===L||null===(D=L[C]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===l||void 0===l||null===(g=l.nodes)||void 0===g||null===(M=g[C]._babylonTransformNode)||void 0===M?void 0:M.uniqueId},E}}),(0,n.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:z=>{const u=z._babylonTransformNode;return!u||void 0===u.pointerOverDisableMeshTesting||u.pointerOverDisableMeshTesting},set:(z,u)=>{var Y;null===(Y=u._primitiveBabylonMeshes)||void 0===Y||Y.forEach((u=>{u.pointerOverDisableMeshTesting=!z}))},getTarget:z=>z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class kY{constructor(z){this.name=yY,this._loader=z,this.enabled=z.isExtensionUsed(yY)}async onReady(){var z;null===(z=this._loader.zT.nodes)||void 0===z||z.forEach((z=>{var u,Y,H;null!==(u=z.extensions)&&void 0!==u&&u.KHR_node_hoverability&&!1===(null===(Y=z.extensions)||void 0===Y?void 0:Y.KHR_node_hoverability.hoverable)&&(null===(H=z._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((z=>{z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}O(yY),U(yY,!0,(z=>new kY(z)));const PY="ExtrasAsMetadata";class eY{_assignExtras(z,u){if(u.extras&&Object.keys(u.extras).length>0){const Y=z.metadata=z.metadata||{};(Y.zT=Y.zT||{}).extras=u.extras}}constructor(z){this.name=PY,this.enabled=!0,this._loader=z}dispose(){this._loader=null}loadNodeAsync(z,u,Y){return this._loader.loadNodeAsync(z,u,(z=>{this._assignExtras(z,u),Y(z)}))}loadCameraAsync(z,u,Y){return this._loader.loadCameraAsync(z,u,(z=>{this._assignExtras(z,u),Y(z)}))}createMaterial(z,u,Y){const H=this._loader.createMaterial(z,u,Y);return this._assignExtras(H,u),H}}O(PY),U(PY,!1,(z=>new eY(z)));Y(12582)},12459:(z,u,Y)=>{"use strict";Y.d(u,{c:()=>F,g:()=>X,i:()=>i,l:()=>Q});var H=Y(10932),E=Y(10945),J=Y(12111),l=Y(11267),T=Y(11218),b=Y(11229),L=Y(10953),D=Y(10928),g=Y(11259),M=Y(11637),q=Y(11275),C=Y(11181);class K{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.QM=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.bq=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(z){this._environmentTexture=z}getNodes(){let z=[];z=z.concat(this.meshes),z=z.concat(this.lights),z=z.concat(this.cameras),z=z.concat(this.transformNodes);for(const u of this.skeletons)z=z.concat(u.bones);return z}}class h extends K{}class o{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const z=this.rootNodes;for(const H of z)H.dispose();z.length=0;const u=this.skeletons;for(const H of u)H.dispose();u.length=0;const Y=this.animationGroups;for(const H of Y)H.dispose();Y.length=0}}class d extends K{constructor(z){super(),this._wasAddedToScene=!1,(z=z||D.d.LastCreatedScene)&&(this.Cu=z,this.proceduralTextures=[],z.fl.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=z.getEngine().onContextRestoredObservable.add((()=>{for(const z of this.geometries)z._rebuild();for(const z of this.meshes)z._rebuild();for(const z of this.QM)z.rebuild();for(const z of this.textures)z._rebuild()})))}_topologicalSort(z){const u=new Map;for(const l of z)u.set(l.uniqueId,l);const Y={dependsOn:new Map,dependedBy:new Map};for(const l of z){const z=l.uniqueId;Y.dependsOn.set(z,new Set),Y.dependedBy.set(z,new Set)}for(const l of z){const z=l.uniqueId,H=Y.dependsOn.get(z);if(l instanceof g.e){const E=l.sourceMesh;u.has(E.uniqueId)&&(H.add(E.uniqueId),Y.dependedBy.get(E.uniqueId).add(z))}const E=Y.dependedBy.get(z);for(const J of l.getDescendants()){const H=J.uniqueId;if(u.has(H)){E.add(H);Y.dependsOn.get(H).add(z)}}}const H=[],E=[];for(const l of z){const z=l.uniqueId;0===Y.dependsOn.get(z).size&&(E.push(l),u.delete(z))}const J=E;for(;J.length>0;){const z=J.shift();H.push(z);const E=Y.dependedBy.get(z.uniqueId);for(const H of Array.from(E.values())){const E=Y.dependsOn.get(H);E.delete(z.uniqueId),0===E.size&&u.get(H)&&(J.push(u.get(H)),u.delete(H))}}return u.size>0&&(L.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),u.forEach((z=>{L.b.Error(z.name)}))),H}_addNodeAndDescendantsToList(z,u,Y,H){if(Y&&(!H||H(Y))&&!u.has(Y.uniqueId)){z.push(Y),u.add(Y.uniqueId);for(const E of Y.getDescendants(!0))this._addNodeAndDescendantsToList(z,u,E,H)}}_isNodeInContainer(z){return z instanceof b.b&&-1!==this.meshes.indexOf(z)||(z instanceof T.d&&-1!==this.transformNodes.indexOf(z)||(z instanceof M.e&&-1!==this.lights.indexOf(z)||z instanceof q.d&&-1!==this.cameras.indexOf(z)))}_isValidHierarchy(){for(const z of this.meshes)if(z.parent&&!this._isNodeInContainer(z.parent))return L.b.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.transformNodes)if(z.parent&&!this._isNodeInContainer(z.parent))return L.b.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.lights)if(z.parent&&!this._isNodeInContainer(z.parent))return L.b.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.cameras)if(z.parent&&!this._isNodeInContainer(z.parent))return L.b.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const H={},J={},T=new o,b=[],L=[],D={doNotInstantiate:!0,...Y},g=[],M=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(g,M,E,D.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(g,M,E,D.predicate);const q=this._topologicalSort(g),C=(Y,E)=>{if(((u,Y)=>{if(H[u.uniqueId]=Y.uniqueId,J[Y.uniqueId]=Y,z&&(Y.name=z(u.name)),Y instanceof l.b){const z=Y;if(z.morphTargetManager){const Y=u.morphTargetManager;z.morphTargetManager=Y.clone();for(let u=0;u<Y.numTargets;u++){const E=Y.getTarget(u),l=z.morphTargetManager.getTarget(u);H[E.uniqueId]=l.uniqueId,J[l.uniqueId]=l}}}})(Y,E),Y.parent){const z=H[Y.parent.uniqueId],u=J[z];E.parent=u||Y.parent}if(E.position&&Y.position&&E.position.J(Y.position),E.rotationQuaternion&&Y.rotationQuaternion&&E.rotationQuaternion.J(Y.rotationQuaternion),E.rotation&&Y.rotation&&E.rotation.J(Y.rotation),E.el&&Y.el&&E.el.J(Y.el),E.material){const l=E;if(l.material)if(u){const u=Y.material;if(-1===L.indexOf(u)){let Y=u.clone(z?z(u.name):"Clone of "+u.name);if(L.push(u),H[u.uniqueId]=Y.uniqueId,J[Y.uniqueId]=Y,"MultiMaterial"===u.getClassName()){const E=u;for(const u of E.HT)u&&(Y=u.clone(z?z(u.name):"Clone of "+u.name),L.push(u),H[u.uniqueId]=Y.uniqueId,J[Y.uniqueId]=Y);E.HT=E.HT.map((z=>z&&J[H[z.uniqueId]]))}}"InstancedMesh"!==l.getClassName()&&(l.material=J[H[u.uniqueId]])}else"MultiMaterial"===l.material.getClassName()?-1===this.Cu.multiMaterials.indexOf(l.material)&&this.Cu.addMultiMaterial(l.material):-1===this.Cu.materials.indexOf(l.material)&&this.Cu.addMaterial(l.material)}null===E.parent&&T.rootNodes.push(E)};for(const E of q)if("InstancedMesh"===E.getClassName()){const z=E,u=z.sourceMesh,Y=H[u.uniqueId];C(z,("number"===typeof Y?J[Y]:u).createInstance(z.name))}else{let z=!0;"ub"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?z=!1:D.doNotInstantiate&&(z="function"===typeof D.doNotInstantiate?!D.doNotInstantiate(E):!D.doNotInstantiate);const u=z?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!u)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);C(E,u)}for(const E of this.skeletons){if(D.predicate&&!D.predicate(E))continue;const u=E.clone(z?z(E.name):"Clone of "+E.name);for(const z of this.meshes)if(z.skeleton===E&&!z.isAnInstance){const Y=J[H[z.uniqueId]];if(!Y||Y.isAnInstance)continue;if(Y.skeleton=u,-1!==b.indexOf(u))continue;b.push(u);for(const z of u.bones)z._linkedTransformNode&&(z._linkedTransformNode=J[H[z._linkedTransformNode.uniqueId]])}T.skeletons.push(u)}for(const E of this.animationGroups){if(D.predicate&&!D.predicate(E))continue;const u=E.clone(z?z(E.name):"Clone of "+E.name,(z=>J[H[z.uniqueId]]||z));T.animationGroups.push(u)}return T}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Cu.environmentTexture=this.environmentTexture);for(const z of this.Cu._serializableComponents)z.addFromContainer(this);this.Cu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=[];for(const Y of this.cameras)z&&!z(Y)||(this.Cu.addCamera(Y),u.push(Y));for(const Y of this.lights)z&&!z(Y)||(this.Cu.addLight(Y),u.push(Y));for(const Y of this.meshes)z&&!z(Y)||(this.Cu.CD(Y),u.push(Y));for(const Y of this.skeletons)z&&!z(Y)||this.Cu.addSkeleton(Y);for(const Y of this.animations)z&&!z(Y)||this.Cu.addAnimation(Y);for(const Y of this.animationGroups)z&&!z(Y)||this.Cu.addAnimationGroup(Y);for(const Y of this.multiMaterials)z&&!z(Y)||this.Cu.addMultiMaterial(Y);for(const Y of this.materials)z&&!z(Y)||this.Cu.addMaterial(Y);for(const Y of this.morphTargetManagers)z&&!z(Y)||this.Cu.addMorphTargetManager(Y);for(const Y of this.geometries)z&&!z(Y)||this.Cu.addGeometry(Y);for(const Y of this.transformNodes)z&&!z(Y)||(this.Cu.addTransformNode(Y),u.push(Y));for(const Y of this.actionManagers)z&&!z(Y)||this.Cu.addActionManager(Y);for(const Y of this.textures)z&&!z(Y)||this.Cu.addTexture(Y);for(const Y of this.reflectionProbes)z&&!z(Y)||this.Cu.addReflectionProbe(Y);for(const Y of u)Y.parent&&-1===this.Cu.getNodes().indexOf(Y.parent)&&(Y.setParent?Y.setParent(null):Y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Cu.environmentTexture&&(this.Cu.environmentTexture=null);for(const z of this.Cu._serializableComponents)z.removeFromContainer(this)}removeFromScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const u of this.cameras)z&&!z(u)||this.Cu.removeCamera(u);for(const u of this.lights)z&&!z(u)||this.Cu.removeLight(u);for(const u of this.meshes)z&&!z(u)||this.Cu.qD(u,!0);for(const u of this.skeletons)z&&!z(u)||this.Cu.removeSkeleton(u);for(const u of this.animations)z&&!z(u)||this.Cu.removeAnimation(u);for(const u of this.animationGroups)z&&!z(u)||this.Cu.removeAnimationGroup(u);for(const u of this.multiMaterials)z&&!z(u)||this.Cu.removeMultiMaterial(u);for(const u of this.materials)z&&!z(u)||this.Cu.removeMaterial(u);for(const u of this.morphTargetManagers)z&&!z(u)||this.Cu.removeMorphTargetManager(u);for(const u of this.geometries)z&&!z(u)||this.Cu.removeGeometry(u);for(const u of this.transformNodes)z&&!z(u)||this.Cu.removeTransformNode(u);for(const u of this.actionManagers)z&&!z(u)||this.Cu.removeActionManager(u);for(const u of this.textures)z&&!z(u)||this.Cu.removeTexture(u);for(const u of this.reflectionProbes)z&&!z(u)||this.Cu.removeReflectionProbe(u)}dispose(){const z=this.cameras.slice(0);for(const q of z)q.dispose();this.cameras.length=0;const u=this.lights.slice(0);for(const q of u)q.dispose();this.lights.length=0;const Y=this.meshes.slice(0);for(const q of Y)q.dispose();this.meshes.length=0;const H=this.skeletons.slice(0);for(const q of H)q.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const q of E)q.dispose();this.animationGroups.length=0;const J=this.multiMaterials.slice(0);for(const q of J)q.dispose();this.multiMaterials.length=0;const l=this.materials.slice(0);for(const q of l)q.dispose();this.materials.length=0;const T=this.geometries.slice(0);for(const q of T)q.dispose();this.geometries.length=0;const b=this.transformNodes.slice(0);for(const q of b)q.dispose();this.transformNodes.length=0;const L=this.actionManagers.slice(0);for(const q of L)q.dispose();this.actionManagers.length=0;const D=this.textures.slice(0);for(const q of D)q.dispose();this.textures.length=0;const g=this.reflectionProbes.slice(0);for(const q of g)q.dispose();this.reflectionProbes.length=0;const M=this.morphTargetManagers.slice(0);for(const q of M)q.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const q of this.Cu._serializableComponents)q.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Cu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(z,u,Y){if(z&&u)for(const H of z){let z=!0;if(Y)for(const u of Y)if(H===u){z=!1;break}z&&(u.push(H),H._parentContainer=this)}}moveAllFromScene(z){this._wasAddedToScene=!1,void 0===z&&(z=new h);for(const u in this)Object.prototype.hasOwnProperty.call(this,u)&&(this[u]=this[u]||("_environmentTexture"===u?null:[]),this._moveAssets(this.Cu[u],this[u],z[u]));this.environmentTexture=this.Cu.environmentTexture,this.removeAllFromScene()}createRootMesh(){const z=new l.b("assetContainerRootMesh",this.Cu);for(const u of this.meshes)u.parent||z.addChild(u);return this.meshes.unshift(z),z}mergeAnimationsTo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.d.LastCreatedScene,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!z)return L.b.Error("No scene available to merge animations to"),[];const H=Y||(u=>{let Y=null;const H=u.animations.length?u.animations[0].targetProperty:"",E=u.name.split(".").join("").split("_primitive")[0];switch(H){case"position":case"rotationQuaternion":Y=z.getTransformNodeByName(u.name)||z.getTransformNodeByName(E);break;case"influence":Y=z.getMorphTargetByName(u.name)||z.getMorphTargetByName(E);break;default:Y=z.getNodeByName(u.name)||z.getNodeByName(E)}return Y}),E=this.getNodes();for(const T of E){const z=H(T);if(null!==z){for(const u of T.animations){const Y=z.animations.filter((z=>z.targetProperty===u.targetProperty));for(const u of Y){const Y=z.animations.indexOf(u,0);Y>-1&&z.animations.splice(Y,1)}}z.animations=z.animations.concat(T.animations)}}const J=[],l=this.animationGroups.slice();for(const T of l){J.push(T.clone(T.name,H));for(const z of T.animatables)z.stop()}for(const T of u){const u=H(T.target);u&&(z.beginAnimation(u,T.fromFrame,T.toFrame,T.loopAnimation,T.speedRatio,T.onAnimationEnd?T.onAnimationEnd:void 0,void 0,!0,void 0,T.onAnimationLoop?T.onAnimationLoop:void 0),z.stopAnimation(T.target))}return J}populateRootNodes(){this.rootNodes.length=0;for(const z of this.meshes)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.transformNodes)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.lights)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z);for(const z of this.cameras)z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)}addAllAssetsToContainer(z){if(!z)return;const u=[],Y=new Set;for(u.push(z);u.length>0;){const z=u.pop();if(z instanceof l.b?(z.Sl&&-1===this.geometries.indexOf(z.Sl)&&this.geometries.push(z.Sl),this.meshes.push(z)):z instanceof g.e?this.meshes.push(z):z instanceof T.d?this.transformNodes.push(z):z instanceof M.e?this.lights.push(z):z instanceof q.d&&this.cameras.push(z),z instanceof b.b){if(z.material&&-1===this.materials.indexOf(z.material)){this.materials.push(z.material);for(const u of z.material.getActiveTextures())-1===this.textures.indexOf(u)&&this.textures.push(u)}z.skeleton&&-1===this.skeletons.indexOf(z.skeleton)&&this.skeletons.push(z.skeleton),z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(z.morphTargetManager)&&this.morphTargetManagers.push(z.morphTargetManager)}for(const H of z.getChildren())Y.has(H)||u.push(H);Y.add(z)}this.populateRootNodes()}_getByTags(z,u,Y){if(void 0===u)return z;const H=[];for(const E in z){const J=z[E];C.e&&C.e.MatchesQuery(J,u)&&(!Y||Y(J))&&H.push(J)}return H}getMeshesByTags(z,u){return this._getByTags(this.meshes,z,u)}getCamerasByTags(z,u){return this._getByTags(this.cameras,z,u)}getLightsByTags(z,u){return this._getByTags(this.lights,z,u)}getMaterialsByTags(z,u){return this._getByTags(this.materials,z,u).concat(this._getByTags(this.multiMaterials,z,u))}getTransformNodesByTags(z,u){return this._getByTags(this.transformNodes,z,u)}}var t=Y(10990);class W{constructor(z){this.byteOffset=0,this.buffer=z}async loadAsync(z){const u=await this.buffer.readAsync(this.byteOffset,z);this._dataView=new DataView(u.buffer,u.byteOffset,u.byteLength),this._dataByteOffset=0}readUint32(){const z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,z}readUint8Array(z){const u=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,z);return this._dataByteOffset+=z,this.byteOffset+=z,u}readString(z){return(0,t.e)(this.readUint8Array(z))}skipBytes(z){this._dataByteOffset+=z,this.byteOffset+=z}}var Z=Y(12468);const s="Z2xURg",v={name:"zT",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:z=>-1!==z.indexOf("asset")&&-1!==z.indexOf("version")||z.startsWith("data:base64,"+s)||z.startsWith("data:;base64,"+s)||z.startsWith("data:application/octet-stream;base64,"+s)||z.startsWith("data:model/gltf-binary;base64,"+s)};var i,X,Q,V=Y(10980),A=Y(10982);function x(z,u,Y){try{return Promise.resolve(new Uint8Array(z,u,Y))}catch(H){return Promise.reject(H)}}!function(z){z[z.AUTO=0]="AUTO",z[z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(z){z[z.NONE=0]="NONE",z[z.FIRST=1]="FIRST",z[z.ALL=2]="ALL"}(X||(X={})),function(z){z[z.LOADING=0]="LOADING",z[z.READY=1]="READY",z[z.COMPLETE=2]="COMPLETE"}(Q||(Q={}));class G{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=X.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=z=>Promise.resolve(z),this.extensionOptions={}}J(z){z&&(this.onParsed=z.onParsed,this.coordinateSystemMode=z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=z.loadSkins??this.loadSkins,this.loadMorphTargets=z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=z.compileMaterials??this.compileMaterials,this.useClipPlane=z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=z.useRangeRequests??this.useRangeRequests,this.createInstances=z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=z.customRootNode,this.onMeshLoaded=z.onMeshLoaded,this.onSkinLoaded=z.onSkinLoaded,this.onTextureLoaded=z.onTextureLoaded,this.onMaterialLoaded=z.onMaterialLoaded,this.onCameraLoaded=z.onCameraLoaded,this.extensionOptions=z.extensionOptions??this.extensionOptions)}}class F extends G{constructor(z){super(),this.onParsedObservable=new H.e,this.onMeshLoadedObservable=new H.e,this.onSkinLoadedObservable=new H.e,this.onTextureLoadedObservable=new H.e,this.onMaterialLoadedObservable=new H.e,this.onCameraLoadedObservable=new H.e,this.onCompleteObservable=new H.e,this.onErrorObservable=new H.e,this.fl=new H.e,this.onExtensionLoadedObservable=new H.e,this.validate=!1,this.onValidatedObservable=new H.e,this._loader=null,this._state=null,this._requests=new Array,this.name=v.name,this.extensions=v.extensions,this.onLoaderStateChangedObservable=new H.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.J(z)}set onParsed(z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),z&&(this._onParsedObserver=this.onParsedObservable.add(z))}set onMeshLoaded(z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(z))}set onSkinLoaded(z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((u=>z(u.node,u.skinnedNode))))}set onTextureLoaded(z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(z))}set onMaterialLoaded(z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(z))}set onCameraLoaded(z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(z))}set onComplete(z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(z)}set onError(z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(z)}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}set onExtensionLoaded(z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(z){this._loggingEnabled!==z&&(this._loggingEnabled=z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(z){this._capturePerformanceCounters!==z&&(this._capturePerformanceCounters=z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const z of this._requests)z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=z=>Promise.resolve(z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.fl.notifyObservers(void 0),this.fl.clear()}loadFile(z,u,Y,J,l,T,b,D){if(ArrayBuffer.isView(u))return this._loadBinary(z,u,Y,J,b,D),null;this._progressCallback=l;const g=u.name||E.e.GetFilename(u);if(T){if(this.useRangeRequests){this.validate&&L.b.Warn("glTF validation is not supported when range requests are enabled");const Y={abort:()=>{},onCompleteObservable:new H.e},E={readAsync:(Y,H)=>new Promise(((E,J)=>{this._loadFile(z,u,(z=>{E(new Uint8Array(z))}),!0,(z=>{J(z)}),(z=>{z.setRequestHeader("Range",`bytes=${Y}-${Y+H-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new W(E)).then((z=>{Y.onCompleteObservable.notifyObservers(Y),J(z)}),b?z=>b(void 0,z):void 0),Y}return this._loadFile(z,u,(u=>{this._validate(z,new Uint8Array(u,0,u.byteLength),Y,g),this._unpackBinaryAsync(new W({readAsync:(z,Y)=>x(u,z,Y),byteLength:u.byteLength})).then((z=>{J(z)}),b?z=>b(void 0,z):void 0)}),!0,b)}return this._loadFile(z,u,(u=>{try{this._validate(z,u,Y,g),J({json:this._parseJson(u)})}catch{b&&b()}}),!1,b)}_loadBinary(z,u,Y,H,E,J){this._validate(z,new Uint8Array(u.buffer,u.byteOffset,u.byteLength),Y,J),this._unpackBinaryAsync(new W({readAsync:(z,Y)=>function(z,u,Y){try{if(u<0||u>=z.byteLength)throw new RangeError("Offset is out of range.");if(u+Y>z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(z.buffer,z.byteOffset+u,Y))}catch(H){return Promise.reject(H)}}(u,z,Y),byteLength:u.byteLength})).then((z=>{H(z)}),E?z=>E(void 0,z):void 0)}importMeshAsync(z,u,Y,H,E,J){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Y),this.onParsedObservable.clear(),this._log(`Loading ${J||""}`),this._loader=this._getLoader(Y),this._loader.importMeshAsync(z,u,null,Y,H,E,J))))}loadAsync(z,u,Y,H,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(u),this._loader.loadAsync(z,u,Y,H,E))))}loadAssetContainerAsync(z,u,Y,H,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(u);const J=new d(z),l=[];this.onMaterialLoadedObservable.add((z=>{l.push(z)}));const T=[];this.onTextureLoadedObservable.add((z=>{T.push(z)}));const b=[];this.onCameraLoadedObservable.add((z=>{b.push(z)}));const L=[];return this.onMeshLoadedObservable.add((z=>{z.morphTargetManager&&L.push(z.morphTargetManager)})),this._loader.importMeshAsync(null,z,J,u,Y,H,E).then((z=>(Array.prototype.push.apply(J.geometries,z.geometries),Array.prototype.push.apply(J.meshes,z.meshes),Array.prototype.push.apply(J.QM,z.QM),Array.prototype.push.apply(J.skeletons,z.skeletons),Array.prototype.push.apply(J.animationGroups,z.animationGroups),Array.prototype.push.apply(J.materials,l),Array.prototype.push.apply(J.textures,T),Array.prototype.push.apply(J.lights,z.lights),Array.prototype.push.apply(J.transformNodes,z.transformNodes),Array.prototype.push.apply(J.cameras,b),Array.prototype.push.apply(J.morphTargetManagers,L),J)))}))}canDirectLoad(z){return v.canDirectLoad(z)}directLoad(z,u){if(u.startsWith("base64,"+s)||u.startsWith(";base64,"+s)||u.startsWith("application/octet-stream;base64,"+s)||u.startsWith("model/gltf-binary;base64,"+s)){const Y=(0,V.e)(u);return this._validate(z,new Uint8Array(Y,0,Y.byteLength)),this._unpackBinaryAsync(new W({readAsync:(z,u)=>x(Y,z,u),byteLength:Y.byteLength}))}return this._validate(z,u),Promise.resolve({json:this._parseJson(u)})}createPlugin(z){return new F(z[v.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((z,u)=>{this.onCompleteObservable.addOnce((()=>{z()})),this.onErrorObservable.addOnce((z=>{u(z)}))}))}_setState(z){this._state!==z&&(this._state=z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Q[this._state]))}_loadFile(z,u,Y,H,E,J){const l=z._loadFile(u,Y,(z=>{this._onProgress(z,l)}),!0,H,E,J);return l.onCompleteObservable.add((()=>{l._lengthComputable=!0,l._total=l._loaded})),this._requests.push(l),l}_onProgress(z,u){if(!this._progressCallback)return;u._lengthComputable=z.lengthComputable,u._loaded=z.loaded,u._total=z.total;let Y=!0,H=0,E=0;for(const J of this._requests){if(void 0===J._lengthComputable||void 0===J._loaded||void 0===J._total)return;Y=Y&&J._lengthComputable,H+=J._loaded,E+=J._total}this._progressCallback({lengthComputable:Y,loaded:H,total:Y?E:0})}_validate(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Z.d.ValidateAsync(u,Y,H,(u=>this.preprocessUrlAsync(Y+u).then((u=>z._loadFileAsync(u,void 0,!0,!0).then((z=>new Uint8Array(z,0,z.byteLength))))))).then((z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(z),this.onValidatedObservable.clear()}),(z=>{this._endPerformanceCounter("Validate JSON"),E.e.Warn(`Failed to validate: ${z.message}`),this.onValidatedObservable.clear()})))}_getLoader(z){const u=z.json.asset||{};this._log(`Asset version: ${u.version}`),u.minVersion&&this._log(`Asset minimum version: ${u.minVersion}`),u.generator&&this._log(`Asset generator: ${u.generator}`);const Y=F._parseVersion(u.version);if(!Y)throw new Error("Invalid version: "+u.version);if(void 0!==u.minVersion){const z=F._parseVersion(u.minVersion);if(!z)throw new Error("Invalid minimum version: "+u.minVersion);if(F._compareVersion(z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+u.minVersion)}const H={1:F._CreateGLTF1Loader,2:F._CreateGLTF2Loader}[Y.major];if(!H)throw new Error("Unsupported version: "+u.version);return H(this)}_parseJson(z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${z.length}`);const u=JSON.parse(z);return this._endPerformanceCounter("Parse JSON"),u}_unpackBinaryAsync(z){return this._startPerformanceCounter("Unpack Binary"),z.loadAsync(20).then((()=>{const u=z.readUint32();if(1179937895!==u)throw new A.i("Unexpected magic: "+u,A.f.GLTFLoaderUnexpectedMagicError);const Y=z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Y}`);const H=z.readUint32();let E;switch(this.useRangeRequests||H===z.buffer.byteLength||L.b.Warn(`Length in header does not match actual data length: ${H} != ${z.buffer.byteLength}`),Y){case 1:E=this._unpackBinaryV1Async(z,H);break;case 2:E=this._unpackBinaryV2Async(z,H);break;default:throw new Error("Unsupported version: "+Y)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(z,u){const Y=z.readUint32(),H=z.readUint32();if(0!==H)throw new Error(`Unexpected content format: ${H}`);const E=u-z.byteOffset,J={json:this._parseJson(z.readString(Y)),bin:null};if(0!==E){const u=z.byteOffset;J.bin={readAsync:(Y,H)=>z.buffer.readAsync(u+Y,H),byteLength:E}}return Promise.resolve(J)}_unpackBinaryV2Async(z,u){const Y=1313821514,H=5130562,E=z.readUint32();if(z.readUint32()!==Y)throw new Error("First chunk format is not JSON");return z.byteOffset+E===u?z.loadAsync(E).then((()=>({json:this._parseJson(z.readString(E)),bin:null}))):z.loadAsync(E+8).then((()=>{const J={json:this._parseJson(z.readString(E)),bin:null},l=()=>{const E=z.readUint32();switch(z.readUint32()){case Y:throw new Error("Unexpected JSON chunk");case H:{const u=z.byteOffset;J.bin={readAsync:(Y,H)=>z.buffer.readAsync(u+Y,H),byteLength:E},z.skipBytes(E);break}default:z.skipBytes(E)}return z.byteOffset!==u?z.loadAsync(8).then(l):Promise.resolve(J)};return l()}))}static _parseVersion(z){if("1.0"===z||"1.0.1"===z)return{major:1,minor:0};const u=(z+"").match(/^(\d+)\.(\d+)/);return u?{major:parseInt(u[1]),minor:parseInt(u[2])}:null}static _compareVersion(z,u){return z.major>u.major?1:z.major<u.major?-1:z.minor>u.minor?1:z.minor<u.minor?-1:0}_logOpen(z){this._log(z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(z){const u=F._logSpaces.substring(0,2*this._logIndentLevel);L.b.Log(`${u}${z}`)}_logDisabled(z){}_startPerformanceCounterEnabled(z){E.e.StartPerformanceCounter(z)}_startPerformanceCounterDisabled(z){}_endPerformanceCounterEnabled(z){E.e.EndPerformanceCounter(z)}_endPerformanceCounterDisabled(z){}}F.IncrementalLoading=!0,F.HomogeneousCoordinates=!1,F._logSpaces="                                ",(0,J.b)(new F)},12468:(z,u,Y)=>{"use strict";Y.d(u,{d:()=>l});var H=Y(10945);function E(z,u,Y,H){const E={externalResourceFunction:H};return Y&&(E.uri="file:"===u?Y:u+Y),ArrayBuffer.isView(z)?GLTFValidator.validateBytes(z,E):GLTFValidator.validateString(z,E)}function J(){const z=[];onmessage=u=>{const Y=u.data;switch(Y.id){case"init":importScripts(Y.url);break;case"validate":E(Y.data,Y.rootUrl,Y.fileName,(u=>new Promise(((Y,H)=>{const E=z.length;z.push({resolve:Y,reject:H}),postMessage({id:"getExternalResource",index:E,uri:u})})))).then((z=>{postMessage({id:"validate.resolve",value:z})}),(z=>{postMessage({id:"validate.reject",reason:z})}));break;case"getExternalResource.resolve":z[Y.index].resolve(Y.value);break;case"getExternalResource.reject":z[Y.index].reject(Y.reason)}}}class l{static ValidateAsync(z,u,Y,l){return"function"===typeof Worker?new Promise(((T,b)=>{const L=`${E}(${J})()`,D=URL.createObjectURL(new Blob([L],{type:"application/javascript"})),g=new Worker(D),M=z=>{g.removeEventListener("error",M),g.removeEventListener("message",q),b(z)},q=z=>{const u=z.data;switch(u.id){case"getExternalResource":l(u.uri).then((z=>{g.postMessage({id:"getExternalResource.resolve",index:u.index,value:z},[z.buffer])}),(z=>{g.postMessage({id:"getExternalResource.reject",index:u.index,reason:z})}));break;case"validate.resolve":g.removeEventListener("error",M),g.removeEventListener("message",q),T(u.value),g.terminate();break;case"validate.reject":g.removeEventListener("error",M),g.removeEventListener("message",q),b(u.reason),g.terminate()}};if(g.addEventListener("error",M),g.addEventListener("message",q),g.postMessage({id:"init",url:H.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(z)){const H=z.slice();g.postMessage({id:"validate",data:H,rootUrl:u,fileName:Y},[H.buffer])}else g.postMessage({id:"validate",data:z,rootUrl:u,fileName:Y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=H.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(z,u,Y,l))))}}l.Configuration={url:`${H.e._DefaultCdnUrl}/gltf_validator.js`}},12951:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>v});var H=Y(11079),E=Y(11082),J=Y(11172),l=Y(10903),T=Y(11559),b=Y(11577),L=Y(11103),D=Y(11504),g=Y(10918),M=Y(11029);Y(12232),Y(12141),Y(12155),Y(12146),Y(12157),Y(12166),Y(12174);const q="imageProcessingCompatibility",C="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";M.b.IncludesShadersStore[q]||(M.b.IncludesShadersStore[q]=C);const K="skyPixelShader",h="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";M.b.ShadersStore[K]||(M.b.ShadersStore[K]=h);Y(12248),Y(12182),Y(12185),Y(12195),Y(12189);const o="skyVertexShader",d="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";M.b.ShadersStore[o]||(M.b.ShadersStore[o]=d);var t=Y(11600),W=Y(11212),Z=Y(11195);class s extends T.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class v extends b.d{constructor(z,u){super(z,u),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new l.p(0,100,0),this.useSunPosition=!1,this.cameraOffset=l.p.Zero(),this.up=l.p.Up(),this.dithering=!1,this._cameraPosition=l.p.Zero(),this._skyOrientation=new l.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(z,u){const Y=u._drawWrapper;if(this.isFrozen&&Y.effect&&Y._wasPreviouslyReady)return!0;u.materialDefines||(u.materialDefines=new s);const H=u.materialDefines,E=this.iz();if(this._isReadyForSubMesh(u))return!0;if((0,Z.O)(z,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,H),(0,Z.E)(z,H,!0,!1),H.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&H.markAsMiscDirty(),H.DITHER!==this.dithering&&H.markAsMiscDirty(),H.isDirty){H.markAsProcessed(),E.resetCachedMaterial();const z=new t.b;H.FOG&&z.addFallback(1,"FOG"),H.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,H.DITHER=this.dithering;const Y=[L.f.PositionKind];H.VERTEXCOLOR&&Y.push(L.f.ColorKind);const J="sky",l=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,W.b)(l);const T=H.toString();u.setEffect(E.getEngine().createEffect(J,Y,l,[],T,z,this.onCompiled,this.onError),H,this._materialContext)}return!(!u.effect||!u.effect.isReady())&&(H._renderId=E.getRenderId(),Y._wasPreviouslyReady=!0,!0)}bindForSubMesh(z,u,Y){const H=this.iz(),E=Y.materialDefines;if(!E)return;const J=Y.effect;if(!J)return;this._activeEffect=J,this.bindOnlyWorldMatrix(z),this._activeEffect.setMatrix("viewProjection",H.getTransformMatrix()),this._mustRebind(H,J,Y)&&((0,W.f)(J,this,H),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Z.h)(E,J,H)),H.fogEnabled&&u.applyFog&&H.fogMode!==D.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",H.getViewMatrix()),(0,Z.f)(H,u,this._activeEffect);const T=H.activeCamera;if(T){const z=T.getWorldMatrix();this._cameraPosition.x=z.m[12],this._cameraPosition.y=z.m[13],this._cameraPosition.z=z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const z=Math.PI*(this.inclination-.5),u=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(u)*Math.cos(z),this.sunPosition.y=this.distance*Math.sin(-z),this.sunPosition.z=this.distance*Math.sin(u)*Math.cos(z),l.f.FromUnitVectorsToRef(l.p.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(u,this._activeEffect,Y)}getAnimatables(){return[]}dispose(z){super.dispose(z)}clone(z){return J.d.Clone((()=>new v(z,this.iz())),this)}serialize(){const z=super.serialize();return z.customType="BABYLON.SkyMaterial",z}getClassName(){return"SkyMaterial"}static Parse(z,u,Y){return J.d.Parse((()=>new v(z.name,u)),z,u,Y)}}(0,H.e)([(0,E.L)()],v.prototype,"luminance",void 0),(0,H.e)([(0,E.L)()],v.prototype,"turbidity",void 0),(0,H.e)([(0,E.L)()],v.prototype,"rayleigh",void 0),(0,H.e)([(0,E.L)()],v.prototype,"mieCoefficient",void 0),(0,H.e)([(0,E.L)()],v.prototype,"mieDirectionalG",void 0),(0,H.e)([(0,E.L)()],v.prototype,"distance",void 0),(0,H.e)([(0,E.L)()],v.prototype,"inclination",void 0),(0,H.e)([(0,E.L)()],v.prototype,"azimuth",void 0),(0,H.e)([(0,E.K)()],v.prototype,"sunPosition",void 0),(0,H.e)([(0,E.L)()],v.prototype,"useSunPosition",void 0),(0,H.e)([(0,E.K)()],v.prototype,"cameraOffset",void 0),(0,H.e)([(0,E.K)()],v.prototype,"up",void 0),(0,H.e)([(0,E.L)()],v.prototype,"dithering",void 0),(0,g.d)("BABYLON.SkyMaterial",v)},11730:(z,u,Y)=>{"use strict";function H(z,u){u.headers=z.headers||{},u.statusMessage=z.statusText,u.statusCode=z.status,u.data=z.response}function E(z,u,Y){return new Promise((function(E,J){Y=Y||{};var l,T,b,L=new XMLHttpRequest,D=Y.body,g=Y.headers||{};for(l in Y.timeout&&(L.timeout=Y.timeout),L.ontimeout=L.onerror=function(z){z.timeout="timeout"==z.type,J(z)},L.open(z,u.href||u),L.onload=function(){for(b=L.getAllResponseHeaders().trim().split(/[\r\n]+/),H(L,L);T=b.shift();)T=T.split(": "),L.headers[T.shift().toLowerCase()]=T.join(": ");if((T=L.headers["content-type"])&&~T.indexOf("application/json"))try{L.data=JSON.parse(L.data,Y.reviver)}catch(z){return H(L,z),J(z)}(L.status>=400?J:E)(L)},typeof FormData<"u"&&D instanceof FormData||D&&"object"==typeof D&&(g["content-type"]="application/json",D=JSON.stringify(D)),L.withCredentials=!!Y.withCredentials,g)L.setRequestHeader(l,g[l]);L.send(D)}))}Y.r(u),Y.d(u,{del:()=>b,get:()=>J,patch:()=>T,post:()=>l,put:()=>L,send:()=>E});var J=E.bind(E,"GET"),l=E.bind(E,"POST"),T=E.bind(E,"PATCH"),b=E.bind(E,"DELETE"),L=E.bind(E,"PUT")},13071:(z,u,Y)=>{"use strict";Y.d(u,{e:()=>g});const H=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,J=1/3,l=1/6,T=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,L=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),D=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const g=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const u="function"==typeof z?z:function(z){let u=0,Y=0,H=0,E=1;const J=function(){let z=4022871197;return function(u){u=u.toString();for(let Y=0;Y<u.length;Y++){z+=u.charCodeAt(Y);let H=.02519603282416938*z;z=H>>>0,H-=z,H*=z,z=H>>>0,H-=z,z+=4294967296*H}return 2.3283064365386963e-10*(z>>>0)}}();u=J(" "),Y=J(" "),H=J(" "),u-=J(z),u<0&&(u+=1);Y-=J(z),Y<0&&(Y+=1);H-=J(z),H<0&&(H+=1);return function(){const z=2091639*u+2.3283064365386963e-10*E;return u=Y,Y=H,H=z-(E=0|z)}}(z);this.p=function(z){const u=new Uint8Array(256);for(let Y=0;Y<256;Y++)u[Y]=Y;for(let Y=0;Y<255;Y++){const H=Y+~~(z()*(256-Y)),E=u[Y];u[Y]=u[H],u[H]=E}return u}(u),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Y=0;Y<512;Y++)this.perm[Y]=this.p[255&Y],this.permMod12[Y]=this.perm[Y]%12}noise2D(z,u){const Y=this.permMod12,J=this.perm;let l=0,T=0,b=0;const D=(z+u)*H,g=Math.floor(z+D),M=Math.floor(u+D),q=(g+M)*E,C=z-(g-q),K=u-(M-q);let h,o;C>K?(h=1,o=0):(h=0,o=1);const d=C-h+E,t=K-o+E,W=C-1+2*E,Z=K-1+2*E,s=255&g,v=255&M;let i=.5-C*C-K*K;if(i>=0){const z=3*Y[s+J[v]];i*=i,l=i*i*(L[z]*C+L[z+1]*K)}let X=.5-d*d-t*t;if(X>=0){const z=3*Y[s+h+J[v+o]];X*=X,T=X*X*(L[z]*d+L[z+1]*t)}let Q=.5-W*W-Z*Z;if(Q>=0){const z=3*Y[s+1+J[v+1]];Q*=Q,b=Q*Q*(L[z]*W+L[z+1]*Z)}return 70*(l+T+b)}noise3D(z,u,Y){const H=this.permMod12,E=this.perm;let T,b,D,g;const M=(z+u+Y)*J,q=Math.floor(z+M),C=Math.floor(u+M),K=Math.floor(Y+M),h=(q+C+K)*l,o=z-(q-h),d=u-(C-h),t=Y-(K-h);let W,Z,s,v,i,X;o>=d?d>=t?(W=1,Z=0,s=0,v=1,i=1,X=0):o>=t?(W=1,Z=0,s=0,v=1,i=0,X=1):(W=0,Z=0,s=1,v=1,i=0,X=1):d<t?(W=0,Z=0,s=1,v=0,i=1,X=1):o<t?(W=0,Z=1,s=0,v=0,i=1,X=1):(W=0,Z=1,s=0,v=1,i=1,X=0);const Q=o-W+l,V=d-Z+l,A=t-s+l,x=o-v+2*l,G=d-i+2*l,F=t-X+2*l,R=o-1+.5,w=d-1+.5,c=t-1+.5,U=255&q,O=255&C,n=255&K;let m=.6-o*o-d*d-t*t;if(m<0)T=0;else{const z=3*H[U+E[O+E[n]]];m*=m,T=m*m*(L[z]*o+L[z+1]*d+L[z+2]*t)}let p=.6-Q*Q-V*V-A*A;if(p<0)b=0;else{const z=3*H[U+W+E[O+Z+E[n+s]]];p*=p,b=p*p*(L[z]*Q+L[z+1]*V+L[z+2]*A)}let S=.6-x*x-G*G-F*F;if(S<0)D=0;else{const z=3*H[U+v+E[O+i+E[n+X]]];S*=S,D=S*S*(L[z]*x+L[z+1]*G+L[z+2]*F)}let I=.6-R*R-w*w-c*c;if(I<0)g=0;else{const z=3*H[U+1+E[O+1+E[n+1]]];I*=I,g=I*I*(L[z]*R+L[z+1]*w+L[z+2]*c)}return 32*(T+b+D+g)}noise4D(z,u,Y,H){const E=this.perm;let J,l,L,g,M;const q=(z+u+Y+H)*T,C=Math.floor(z+q),K=Math.floor(u+q),h=Math.floor(Y+q),o=Math.floor(H+q),d=(C+K+h+o)*b,t=z-(C-d),W=u-(K-d),Z=Y-(h-d),s=H-(o-d);let v=0,i=0,X=0,Q=0;t>W?v++:i++,t>Z?v++:X++,t>s?v++:Q++,W>Z?i++:X++,W>s?i++:Q++,Z>s?X++:Q++;const V=v>=3?1:0,A=i>=3?1:0,x=X>=3?1:0,G=Q>=3?1:0,F=v>=2?1:0,R=i>=2?1:0,w=X>=2?1:0,c=Q>=2?1:0,U=v>=1?1:0,O=i>=1?1:0,n=X>=1?1:0,m=Q>=1?1:0,p=t-V+b,S=W-A+b,I=Z-x+b,y=s-G+b,a=t-F+2*b,j=W-R+2*b,k=Z-w+2*b,P=s-c+2*b,e=t-U+3*b,N=W-O+3*b,B=Z-n+3*b,f=s-m+3*b,r=t-1+4*b,zz=W-1+4*b,uz=Z-1+4*b,Yz=s-1+4*b,Hz=255&C,Ez=255&K,Jz=255&h,lz=255&o;let Tz=.6-t*t-W*W-Z*Z-s*s;if(Tz<0)J=0;else{const z=E[Hz+E[Ez+E[Jz+E[lz]]]]%32*4;Tz*=Tz,J=Tz*Tz*(D[z]*t+D[z+1]*W+D[z+2]*Z+D[z+3]*s)}let bz=.6-p*p-S*S-I*I-y*y;if(bz<0)l=0;else{const z=E[Hz+V+E[Ez+A+E[Jz+x+E[lz+G]]]]%32*4;bz*=bz,l=bz*bz*(D[z]*p+D[z+1]*S+D[z+2]*I+D[z+3]*y)}let Lz=.6-a*a-j*j-k*k-P*P;if(Lz<0)L=0;else{const z=E[Hz+F+E[Ez+R+E[Jz+w+E[lz+c]]]]%32*4;Lz*=Lz,L=Lz*Lz*(D[z]*a+D[z+1]*j+D[z+2]*k+D[z+3]*P)}let Dz=.6-e*e-N*N-B*B-f*f;if(Dz<0)g=0;else{const z=E[Hz+U+E[Ez+O+E[Jz+n+E[lz+m]]]]%32*4;Dz*=Dz,g=Dz*Dz*(D[z]*e+D[z+1]*N+D[z+2]*B+D[z+3]*f)}let gz=.6-r*r-zz*zz-uz*uz-Yz*Yz;if(gz<0)M=0;else{const z=E[Hz+1+E[Ez+1+E[Jz+1+E[lz+1]]]]%32*4;gz*=gz,M=gz*gz*(D[z]*r+D[z+1]*zz+D[z+2]*uz+D[z+3]*Yz)}return 27*(J+l+L+g+M)}}}}]);