"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[20],{12631:(a,O,i)=>{i.r(O),i.d(O,{Dispose:()=>h,DumpData:()=>e,DumpDataAsync:()=>P,DumpFramebuffer:()=>I,DumpTools:()=>j});var H=i(12505),b=i(12184),G=i(12412),q=i(12236);let Q,k=null;async function I(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const Q=await i.readPixels(0,0,a,O);e(a,O,new Uint8Array(Q.buffer),H,b,G,!0,void 0,q)}async function P(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0;return await new Promise((k=>{e(a,O,i,(a=>k(a)),H,b,G,q,Q)}))}function e(a,O,I,P){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8?arguments[8]:void 0;(async function(){return k||(k=new Promise(((a,O)=>{let b,G=null;const k={rb:!0,depth:!1,hb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,12537)).then((I=>{let{ThinEngine:P}=I;const e=q.b.Instances.length;try{b=new OffscreenCanvas(100,100),G=new P(b,!1,k)}catch(F){var j;e<q.b.Instances.length&&(null===(j=q.b.Instances.pop())||void 0===j||j.dispose()),b=document.createElement("canvas"),G=new P(b,!1,k)}q.b.Instances.pop(),q.b.OnEnginesDisposedObservable.add((a=>{G&&a!==G&&!G.h&&0===q.b.Instances.length&&h()})),G.getCaps().parallelShaderCompile=void 0;const Z=new H.b(G);i.e(52).then(i.bind(i,14893)).then((i=>{let{passPixelShader:q}=i;if(!G)return void O("Engine is not defined");const k=new H.e({jO:G,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});Q={canvas:b,jO:G,renderer:Z,wrapper:k},a(Q)}))})).catch(O)}))),await k})().then((i=>{if(i.jO.setSize(a,O,!0),I instanceof Float32Array){const a=new Uint8Array(I.length);let O=I.length;for(;O--;){const i=I[O];a[O]=Math.round(255*(0,G.Clamp)(i))}I=a}const H=i.jO.createRawTexture(I,a,O,5,!1,!Z,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",H),i.renderer.draw(),F?b.Tools.ToBlob(i.canvas,(a=>{const O=new FileReader;O.onload=a=>{const O=a.target.result;P&&P(O)},O.readAsArrayBuffer(a)}),e,r):b.Tools.EncodeScreenshotCanvasData(i.canvas,P,e,j,r),H.dispose()}))}function h(){var a;Q?(Q.wrapper.dispose(),Q.renderer.dispose(),Q.jO.dispose()):null===(a=k)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.jO.dispose()}));k=null,Q=null}const j={DumpData:e,DumpDataAsync:P,DumpFramebuffer:I,Dispose:h};b.Tools.DumpData=e,b.Tools.DumpDataAsync=P,b.Tools.DumpFramebuffer=I}}]);