"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[20],{12614:(E,H,d)=>{d.r(H),d.d(H,{Dispose:()=>V,DumpData:()=>M,DumpDataAsync:()=>S,DumpFramebuffer:()=>t,DumpTools:()=>C});var n=d(12509),Z=d(12228),I=d(12406),g=d(12268);let l,r=null;async function t(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",I=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const l=await d.readPixels(0,0,E,H);M(E,H,new Uint8Array(l.buffer),n,Z,I,!0,void 0,g)}async function S(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Z=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;return await new Promise((r=>{M(E,H,d,(E=>r(E)),n,Z,I,g,l)}))}function M(E,H,t,S){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((E,H)=>{let Z,I=null;const r={Ud:!0,depth:!1,ed:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(d.bind(d,12524)).then((t=>{let{ThinEngine:S}=t;const M=g.b.Instances.length;try{Z=new OffscreenCanvas(100,100),I=new S(Z,!1,r)}catch(R){var C;M<g.b.Instances.length&&(null===(C=g.b.Instances.pop())||void 0===C||C.dispose()),Z=document.createElement("canvas"),I=new S(Z,!1,r)}g.b.Instances.pop(),g.b.OnEnginesDisposedObservable.add((E=>{I&&E!==I&&!I.M&&0===g.b.Instances.length&&V()})),I.getCaps().parallelShaderCompile=void 0;const w=new n.e(I);d.e(52).then(d.bind(d,14888)).then((d=>{let{passPixelShader:g}=d;if(!I)return void H("Engine is not defined");const r=new n.g({CH:I,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});l={canvas:Z,CH:I,renderer:w,wrapper:r},E(l)}))})).catch(H)}))),await r})().then((d=>{if(d.CH.setSize(E,H,!0),t instanceof Float32Array){const E=new Uint8Array(t.length);let H=t.length;for(;H--;){const d=t[H];E[H]=Math.round(255*(0,I.Clamp)(d))}t=E}const n=d.CH.createRawTexture(t,E,H,5,!1,!w,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",n),d.renderer.draw(),R?Z.Tools.ToBlob(d.canvas,(E=>{const H=new FileReader;H.onload=E=>{const H=E.target.result;S&&S(H)},H.readAsArrayBuffer(E)}),M,Q):Z.Tools.EncodeScreenshotCanvasData(d.canvas,S,M,C,Q),n.dispose()}))}function V(){var E;l?(l.wrapper.dispose(),l.renderer.dispose(),l.CH.dispose()):null===(E=r)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.CH.dispose()}));r=null,l=null}const C={DumpData:M,DumpDataAsync:S,DumpFramebuffer:t,Dispose:V};Z.Tools.DumpData=M,Z.Tools.DumpDataAsync=S,Z.Tools.DumpFramebuffer=t}}]);