"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[20],{12635:(t,U,y)=>{y.r(U),y.d(U,{Dispose:()=>h,DumpData:()=>L,DumpDataAsync:()=>M,DumpFramebuffer:()=>G,DumpTools:()=>Q});var I=y(12505),r=y(12198),Y=y(12404),mt=y(12250);let X,P=null;async function G(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,mt=arguments.length>6?arguments[6]:void 0;const X=await y.readPixels(0,0,t,U);L(t,U,new Uint8Array(X.buffer),I,r,Y,!0,void 0,mt)}async function M(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((P=>{L(t,U,y,(t=>P(t)),I,r,Y,mt,X)}))}function L(t,U,G,M){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8?arguments[8]:void 0;(async function(){return P||(P=new Promise(((t,U)=>{let r,Y=null;const P={o:!0,depth:!1,EX:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(y.bind(y,12543)).then((G=>{let{ThinEngine:M}=G;const L=mt.d.Instances.length;try{r=new OffscreenCanvas(100,100),Y=new M(r,!1,P)}catch(E){var Q;L<mt.d.Instances.length&&(null===(Q=mt.d.Instances.pop())||void 0===Q||Q.dispose()),r=document.createElement("canvas"),Y=new M(r,!1,P)}mt.d.Instances.pop(),mt.d.OnEnginesDisposedObservable.add((t=>{Y&&t!==Y&&!Y.G&&0===mt.d.Instances.length&&h()})),Y.getCaps().parallelShaderCompile=void 0;const F=new I.c(Y);y.e(52).then(y.bind(y,14647)).then((y=>{let{passPixelShader:mt}=y;if(!Y)return void U("Engine is not defined");const P=new I.f({wU:Y,name:mt.name,fragmentShader:mt.shader,samplerNames:["textureSampler"]});X={canvas:r,wU:Y,renderer:F,wrapper:P},t(X)}))})).catch(U)}))),await P})().then((y=>{if(y.wU.setSize(t,U,!0),G instanceof Float32Array){const t=new Uint8Array(G.length);let U=G.length;for(;U--;){const y=G[U];t[U]=Math.round(255*(0,Y.Clamp)(y))}G=t}const I=y.wU.createRawTexture(G,t,U,5,!1,!F,1);y.renderer.setViewport(),y.renderer.applyEffectWrapper(y.wrapper),y.wrapper.effect._bindTexture("textureSampler",I),y.renderer.draw(),E?r.Tools.ToBlob(y.canvas,(t=>{const U=new FileReader;U.onload=t=>{const U=t.target.result;M&&M(U)},U.readAsArrayBuffer(t)}),L,w):r.Tools.EncodeScreenshotCanvasData(y.canvas,M,L,Q,w),I.dispose()}))}function h(){var t;X?(X.wrapper.dispose(),X.renderer.dispose(),X.wU.dispose()):null===(t=P)||void 0===t||t.then((t=>{t.wrapper.dispose(),t.renderer.dispose(),t.wU.dispose()}));P=null,X=null}const Q={DumpData:L,DumpDataAsync:M,DumpFramebuffer:G,Dispose:h};r.Tools.DumpData=L,r.Tools.DumpDataAsync=M,r.Tools.DumpFramebuffer=G}}]);