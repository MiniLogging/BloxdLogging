"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[20],{12439:(i,x,e)=>{e.r(x),e.d(x,{Dispose:()=>K,DumpData:()=>A,DumpDataAsync:()=>g,DumpFramebuffer:()=>b,DumpTools:()=>L});var j=e(12346),E=e(12061),a=e(12264),Y=e(12108);let J,u=null;async function b(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const J=await e.readPixels(0,0,i,x);A(i,x,new Uint8Array(J.buffer),j,E,a,!0,void 0,Y)}async function g(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((u=>{A(i,x,e,(i=>u(i)),j,E,a,Y,J)}))}function A(i,x,b,g){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8?arguments[8]:void 0;(async function(){return u||(u=new Promise(((i,x)=>{let E,a=null;const u={o:!0,depth:!1,Ve:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,12367)).then((b=>{let{ThinEngine:g}=b;const A=Y.e.Instances.length;try{E=new OffscreenCanvas(100,100),a=new g(E,!1,u)}catch(M){var L;A<Y.e.Instances.length&&(null===(L=Y.e.Instances.pop())||void 0===L||L.dispose()),E=document.createElement("canvas"),a=new g(E,!1,u)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((i=>{a&&i!==a&&!a.M&&0===Y.e.Instances.length&&K()})),a.getCaps().parallelShaderCompile=void 0;const o=new j.c(a);e.e(52).then(e.bind(e,14656)).then((e=>{let{passPixelShader:Y}=e;if(!a)return void x("Engine is not defined");const u=new j.e({tx:a,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});J={canvas:E,tx:a,renderer:o,wrapper:u},i(J)}))})).catch(x)}))),await u})().then((e=>{if(e.tx.setSize(i,x,!0),b instanceof Float32Array){const i=new Uint8Array(b.length);let x=b.length;for(;x--;){const e=b[x];i[x]=Math.round(255*(0,a.Clamp)(e))}b=i}const j=e.tx.createRawTexture(b,i,x,5,!1,!o,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",j),e.renderer.draw(),M?E.Tools.ToBlob(e.canvas,(i=>{const x=new FileReader;x.onload=i=>{const x=i.target.result;g&&g(x)},x.readAsArrayBuffer(i)}),A,z):E.Tools.EncodeScreenshotCanvasData(e.canvas,g,A,L,z),j.dispose()}))}function K(){var i;J?(J.wrapper.dispose(),J.renderer.dispose(),J.tx.dispose()):null===(i=u)||void 0===i||i.then((i=>{i.wrapper.dispose(),i.renderer.dispose(),i.tx.dispose()}));u=null,J=null}const L={DumpData:A,DumpDataAsync:g,DumpFramebuffer:b,Dispose:K};E.Tools.DumpData=A,E.Tools.DumpDataAsync=g,E.Tools.DumpFramebuffer=b}}]);