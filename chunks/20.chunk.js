"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[20],{11989:(b,n,i)=>{i.r(n),i.d(n,{Dispose:()=>Z,DumpData:()=>N,DumpDataAsync:()=>mb,DumpFramebuffer:()=>B,DumpTools:()=>T});var e=i(11872),V=i(11605),Q=i(11796),U=i(11646);let Y,L=null;async function B(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const Y=await i.readPixels(0,0,b,n);N(b,n,new Uint8Array(Y.buffer),e,V,Q,!0,void 0,U)}async function mb(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;return await new Promise((L=>{N(b,n,i,(b=>L(b)),e,V,Q,U,Y)}))}function N(b,n,B,mb){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",T=arguments.length>5?arguments[5]:void 0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return L||(L=new Promise(((b,n)=>{let V,Q=null;const L={de:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,11898)).then((B=>{let{ThinEngine:mb}=B;const N=U.d.Instances.length;try{V=new OffscreenCanvas(100,100),Q=new mb(V,!1,L)}catch(K){var T;N<U.d.Instances.length&&(null===(T=U.d.Instances.pop())||void 0===T||T.dispose()),V=document.createElement("canvas"),Q=new mb(V,!1,L)}U.d.Instances.pop(),U.d.OnEnginesDisposedObservable.add((b=>{Q&&b!==Q&&!Q.N&&0===U.d.Instances.length&&Z()})),Q.getCaps().parallelShaderCompile=void 0;const z=new e.c(Q);i.e(52).then(i.bind(i,14339)).then((i=>{let{passPixelShader:U}=i;if(!Q)return void n("Engine is not defined");const L=new e.f({In:Q,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});Y={canvas:V,In:Q,renderer:z,wrapper:L},b(Y)}))})).catch(n)}))),await L})().then((i=>{if(i.In.setSize(b,n,!0),B instanceof Float32Array){const b=new Uint8Array(B.length);let n=B.length;for(;n--;){const i=B[n];b[n]=Math.round(255*(0,Q.Clamp)(i))}B=b}const e=i.In.createRawTexture(B,b,n,5,!1,!z,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",e),i.renderer.draw(),K?V.Tools.ToBlob(i.canvas,(b=>{const n=new FileReader;n.onload=b=>{const n=b.target.result;mb&&mb(n)},n.readAsArrayBuffer(b)}),N,I):V.Tools.EncodeScreenshotCanvasData(i.canvas,mb,N,T,I),e.dispose()}))}function Z(){var b;Y?(Y.wrapper.dispose(),Y.renderer.dispose(),Y.In.dispose()):null===(b=L)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.In.dispose()}));L=null,Y=null}const T={DumpData:N,DumpDataAsync:mb,DumpFramebuffer:B,Dispose:Z};V.Tools.DumpData=N,V.Tools.DumpDataAsync=mb,V.Tools.DumpFramebuffer=B}}]);