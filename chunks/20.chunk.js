"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[20],{12639:(e,d,v)=>{v.r(d),v.d(d,{Dispose:()=>g,DumpData:()=>k,DumpDataAsync:()=>V,DumpFramebuffer:()=>W,DumpTools:()=>F});var P=v(12523),p=v(12240),L=v(12440),B=v(12281);let X,z=null;async function W(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const X=await v.readPixels(0,0,e,d);k(e,d,new Uint8Array(X.buffer),P,p,L,!0,void 0,B)}async function V(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((z=>{k(e,d,v,(e=>z(e)),P,p,L,B,X)}))}function k(e,d,W,V){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8?arguments[8]:void 0;(async function(){return z||(z=new Promise(((e,d)=>{let p,L=null;const z={Td:!0,depth:!1,hd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(v.bind(v,12553)).then((W=>{let{ThinEngine:V}=W;const k=B.c.Instances.length;try{p=new OffscreenCanvas(100,100),L=new V(p,!1,z)}catch(G){var F;k<B.c.Instances.length&&(null===(F=B.c.Instances.pop())||void 0===F||F.dispose()),p=document.createElement("canvas"),L=new V(p,!1,z)}B.c.Instances.pop(),B.c.OnEnginesDisposedObservable.add((e=>{L&&e!==L&&!L.W&&0===B.c.Instances.length&&g()})),L.getCaps().parallelShaderCompile=void 0;const w=new P.c(L);v.e(52).then(v.bind(v,14925)).then((v=>{let{passPixelShader:B}=v;if(!L)return void d("Engine is not defined");const z=new P.f({Ad:L,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});X={canvas:p,Ad:L,renderer:w,wrapper:z},e(X)}))})).catch(d)}))),await z})().then((v=>{if(v.Ad.setSize(e,d,!0),W instanceof Float32Array){const e=new Uint8Array(W.length);let d=W.length;for(;d--;){const v=W[d];e[d]=Math.round(255*(0,L.Clamp)(v))}W=e}const P=v.Ad.createRawTexture(W,e,d,5,!1,!w,1);v.renderer.setViewport(),v.renderer.applyEffectWrapper(v.wrapper),v.wrapper.effect._bindTexture("textureSampler",P),v.renderer.draw(),G?p.Tools.ToBlob(v.canvas,(e=>{const d=new FileReader;d.onload=e=>{const d=e.target.result;V&&V(d)},d.readAsArrayBuffer(e)}),k,U):p.Tools.EncodeScreenshotCanvasData(v.canvas,V,k,F,U),P.dispose()}))}function g(){var e;X?(X.wrapper.dispose(),X.renderer.dispose(),X.Ad.dispose()):null===(e=z)||void 0===e||e.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.Ad.dispose()}));z=null,X=null}const F={DumpData:k,DumpDataAsync:V,DumpFramebuffer:W,Dispose:g};p.Tools.DumpData=k,p.Tools.DumpDataAsync=V,p.Tools.DumpFramebuffer=W}}]);