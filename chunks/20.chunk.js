"use strict";(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[20],{11441:(G,A,j)=>{j.r(A),j.d(A,{Dispose:()=>F,DumpData:()=>H,DumpDataAsync:()=>h,DumpFramebuffer:()=>d,DumpTools:()=>R});var u=j(11318),k=j(11043),B=j(11237),x=j(11085);let s,O=null;async function d(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,x=arguments.length>6?arguments[6]:void 0;const s=await j.readPixels(0,0,G,A);H(G,A,new Uint8Array(s.buffer),u,k,B,!0,void 0,x)}async function h(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0;return await new Promise((O=>{H(G,A,j,(G=>O(G)),u,k,B,x,s)}))}function H(G,A,d,h){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8?arguments[8]:void 0;(async function(){return O||(O=new Promise(((G,A)=>{let k,B=null;const O={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(j.bind(j,11352)).then((d=>{let{ThinEngine:h}=d;const H=x.d.Instances.length;try{k=new OffscreenCanvas(100,100),B=new h(k,!1,O)}catch(S){var R;H<x.d.Instances.length&&(null===(R=x.d.Instances.pop())||void 0===R||R.dispose()),k=document.createElement("canvas"),B=new h(k,!1,O)}x.d.Instances.pop(),x.d.OnEnginesDisposedObservable.add((G=>{B&&G!==B&&!B.H&&0===x.d.Instances.length&&F()})),B.getCaps().parallelShaderCompile=void 0;const U=new u.e(B);j.e(52).then(j.bind(j,13681)).then((j=>{let{passPixelShader:x}=j;if(!B)return void A("Engine is not defined");const O=new u.i({UA:B,name:x.name,fragmentShader:x.shader,samplerNames:["textureSampler"]});s={canvas:k,UA:B,renderer:U,wrapper:O},G(s)}))})).catch(A)}))),await O})().then((j=>{if(j.UA.setSize(G,A,!0),d instanceof Float32Array){const G=new Uint8Array(d.length);let A=d.length;for(;A--;){const j=d[A];G[A]=Math.round(255*(0,B.Clamp)(j))}d=G}const u=j.UA.createRawTexture(d,G,A,5,!1,!U,1);j.renderer.setViewport(),j.renderer.applyEffectWrapper(j.wrapper),j.wrapper.effect._bindTexture("textureSampler",u),j.renderer.draw(),S?k.Tools.ToBlob(j.canvas,(G=>{const A=new FileReader;A.onload=G=>{const A=G.target.result;h&&h(A)},A.readAsArrayBuffer(G)}),H,C):k.Tools.EncodeScreenshotCanvasData(j.canvas,h,H,R,C),u.dispose()}))}function F(){var G;s?(s.wrapper.dispose(),s.renderer.dispose(),s.UA.dispose()):null===(G=O)||void 0===G||G.then((G=>{G.wrapper.dispose(),G.renderer.dispose(),G.UA.dispose()}));O=null,s=null}const R={DumpData:H,DumpDataAsync:h,DumpFramebuffer:d,Dispose:F};k.Tools.DumpData=H,k.Tools.DumpDataAsync=h,k.Tools.DumpFramebuffer=d}}]);