"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[34],{13367:(h,d,m)=>{m.r(d),m.d(d,{ReadExrDataAsync:()=>qh,_ExrTextureLoader:()=>Mh});var j=m(11121),A=m(11099);const b=4,w=4,a=1,D=2,S=8,M=65536,q=M>>3,E=14,I=65537,R=1<<E,Z=R-1,L=59,B=63,V=2+B-L;var v,C;!function(h){h[h.NO_COMPRESSION=0]="NO_COMPRESSION",h[h.RLE_COMPRESSION=1]="RLE_COMPRESSION",h[h.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",h[h.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",h[h.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",h[h.PXR24_COMPRESSION=5]="PXR24_COMPRESSION"}(v||(v={})),function(h){h[h.INCREASING_Y=0]="INCREASING_Y",h[h.DECREASING_Y=1]="DECREASING_Y"}(C||(C={}));const T=function(){const h=new ArrayBuffer(4),d=new Float32Array(h),m=new Uint32Array(h),j=new Uint32Array(512),A=new Uint32Array(512);for(let D=0;D<256;++D){const h=D-127;h<-27?(j[D]=0,j[256|D]=32768,A[D]=24,A[256|D]=24):h<-14?(j[D]=1024>>-h-14,j[256|D]=1024>>-h-14|32768,A[D]=-h-1,A[256|D]=-h-1):h<=15?(j[D]=h+15<<10,j[256|D]=h+15<<10|32768,A[D]=13,A[256|D]=13):h<128?(j[D]=31744,j[256|D]=64512,A[D]=24,A[256|D]=24):(j[D]=31744,j[256|D]=64512,A[D]=13,A[256|D]=13)}const b=new Uint32Array(2048),w=new Uint32Array(64),a=new Uint32Array(64);for(let D=1;D<1024;++D){let h=D<<13,d=0;for(;0===(8388608&h);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,b[D]=h|d}for(let D=1024;D<2048;++D)b[D]=939524096+(D-1024<<13);for(let D=1;D<31;++D)w[D]=D<<23;w[31]=1199570944,w[32]=2147483648;for(let D=33;D<63;++D)w[D]=2147483648+(D-32<<23);w[63]=3347054592;for(let D=1;D<64;++D)32!==D&&(a[D]=1024);return{floatView:d,uint32View:m,baseTable:j,shiftTable:A,mantissaTable:b,exponentTable:w,offsetTable:a}}();function o(h,d){const m=new Uint8Array(h);let j=0;for(;0!=m[d.value+j];)j+=1;const A=(new TextDecoder).decode(m.slice(d.value,d.value+j));return d.value=d.value+j+1,A}function y(h,d){const m=h.getInt32(d.value,!0);return d.value+=b,m}function i(h,d){const m=h.getUint32(d.value,!0);return d.value+=b,m}function g(h,d){const m=h.getUint8(d.value);return d.value+=a,m}function F(h,d){const m=h.getUint16(d.value,!0);return d.value+=D,m}function f(h,d){const m=h[d.value];return d.value+=a,m}function H(h,d){let m;return m="getBigInt64"in DataView.prototype?Number(h.getBigInt64(d.value,!0)):h.getUint32(d.value+4,!0)+Number(h.getUint32(d.value,!0)<<32),d.value+=S,m}function c(h,d){const m=h.getFloat32(d.value,!0);return d.value+=w,m}function k(h,d){return function(h){const d=(31744&h)>>10,m=1023&h;return(h>>15?-1:1)*(d?31===d?m?NaN:1/0:Math.pow(2,d-15)*(1+m/1024):m/1024*6103515625e-14)}(F(h,d))}function l(h,d){return function(h){if(Math.abs(h)>65504)throw new Error("Value out of range.Consider using float instead of half-float.");h=(0,A.Clamp)(h,-65504,65504),T.floatView[0]=h;const d=T.uint32View[0],m=d>>23&511;return T.baseTable[m]+((8388607&d)>>T.shiftTable[m])}(c(h,d))}function K(h,d,m,j){switch(m){case"string":case"stringvector":case"iccProfile":return function(h,d,m){const j=(new TextDecoder).decode(new Uint8Array(h).slice(d.value,d.value+m));return d.value=d.value+m,j}(h.buffer,d,j);case"chlist":return function(h,d,m){const j=d.value,A=[];for(;d.value<j+m-1;){const m=o(h.buffer,d),j=y(h,d),b=g(h,d);d.value+=3;const w=y(h,d),a=y(h,d);A.push({name:m,pixelType:j,pLinear:b,xSampling:w,ySampling:a})}return d.value+=1,A}(h,d,j);case"chromaticities":return function(h,d){return{redX:c(h,d),redY:c(h,d),greenX:c(h,d),greenY:c(h,d),blueX:c(h,d),blueY:c(h,d),whiteX:c(h,d),whiteY:c(h,d)}}(h,d);case"compression":return function(h,d){return g(h,d)}(h,d);case"box2i":return function(h,d){return{xMin:y(h,d),yMin:y(h,d),xMax:y(h,d),yMax:y(h,d)}}(h,d);case"lineOrder":return function(h,d){const m=g(h,d);return C[m]}(h,d);case"float":return c(h,d);case"v2f":return function(h,d){return[c(h,d),c(h,d)]}(h,d);case"v3f":return function(h,d){return[c(h,d),c(h,d),c(h,d)]}(h,d);case"int":return y(h,d);case"rational":return function(h,d){return[y(h,d),i(h,d)]}(h,d);case"timecode":return function(h,d){return[i(h,d),i(h,d)]}(h,d);case"preview":return d.value+=j,"skipped";default:return void(d.value+=j)}}function N(h){for(let d=1;d<h.length;d++){const m=h[d-1]+h[d]-128;h[d]=m}}function W(h,d){let m=0,j=Math.floor((h.length+1)/2),A=0;const b=h.length-1;for(;!(A>b)&&(d[A++]=h[m++],!(A>b));)d[A++]=h[j++]}const r=20000630;function Y(h,d){if(h.getUint32(0,!0)!=r)throw new Error("Incorrect OpenEXR format");const m=h.getUint8(4),A=h.getUint8(5),b={singleTile:!!(2&A),longName:!!(4&A),deepFormat:!!(8&A),multiPart:!!(16&A)};d.value=8;const w={};let a=!0;for(;a;){const m=o(h.buffer,d);if(m){const A=o(h.buffer,d),b=K(h,d,A,i(h,d));void 0===b?j.c.Warn(`Unknown header attribute type ${A}'.`):w[m]=b}else a=!1}if(0!=(-5&A))throw new Error("Unsupported file format");return{version:m,spec:b,...w}}const x=32768,Q=65535;function t(h,d,m,j,A){for(;m<h;)d=d<<8|f(j,A),m+=8;return{l:d>>(m-=h)&(1<<h)-1,c:d,lc:m}}function U(h,d,m,j){return{c:h=h<<8|f(m,j),lc:d+=8}}function s(h,d,m,j,A,b,w,a,D){if(h==d){if(j<8){const h=U(m,j,A,b);m=h.c,j=h.lc}let h=m>>(j-=8);if(h=new Uint8Array([h])[0],a.value+h>D)return null;const d=w[a.value-1];for(;h-- >0;)w[a.value++]=d}else{if(!(a.value<D))return null;w[a.value++]=h}return{c:m,lc:j}}const J=new Array(59);function O(h,d,m,j,A,b){const w=d;let a=0,D=0;for(;j<=A;j++){if(w.value-d.value>m)return;let S=t(6,a,D,h,w);const M=S.l;if(a=S.c,D=S.lc,b[j]=M,M==B){if(w.value-d.value>m)throw new Error("Error in HufUnpackEncTable");S=t(8,a,D,h,w);let M=S.l+V;if(a=S.c,D=S.lc,j+M>A+1)throw new Error("Error in HufUnpackEncTable");for(;M--;)b[j++]=0;j--}else if(M>=L){let h=M-L+2;if(j+h>A+1)throw new Error("Error in HufUnpackEncTable");for(;h--;)b[j++]=0;j--}}!function(h){for(let m=0;m<=58;++m)J[m]=0;for(let m=0;m<I;++m)J[h[m]]+=1;let d=0;for(let m=58;m>0;--m){const h=d+J[m]>>1;J[m]=d,d=h}for(let m=0;m<I;++m){const d=h[m];d>0&&(h[m]=d|J[d]++<<6)}}(b)}function n(h){return 63&h}function p(h){return h>>6}function e(h,d,m,j,A,b){const w=m.value,a=i(d,m),D=i(d,m);m.value+=4;const S=i(d,m);if(m.value+=4,a<0||a>=I||D<0||D>=I)throw new Error("Wrong HUF_ENCSIZE");const M=new Array(I),q=new Array(R);!function(h){for(let d=0;d<R;d++)h[d]={},h[d].len=0,h[d].lit=0,h[d].p=null}(q);if(O(h,m,j-(m.value-w),a,D,M),S>8*(j-(m.value-w)))throw new Error("Wrong hufUncompress");!function(h,d,m,j){for(;d<=m;d++){const m=p(h[d]),A=n(h[d]);if(m>>A)throw new Error("Invalid table entry");if(A>E){const h=j[m>>A-E];if(h.len)throw new Error("Invalid table entry");if(h.lit++,h.p){const d=h.p;h.p=new Array(h.lit);for(let m=0;m<h.lit-1;++m)h.p[m]=d[m]}else h.p=new Array(1);h.p[h.lit-1]=d}else if(A){let h=0;for(let b=1<<E-A;b>0;b--){const b=j[(m<<E-A)+h];if(b.len||b.p)throw new Error("Invalid table entry");b.len=A,b.lit=d,h++}}}}(M,a,D,q),function(h,d,m,j,A,b,w,a,D){let S=0,M=0;const q=w,I=Math.trunc(j.value+(A+7)/8);for(;j.value<I;){let A=U(S,M,m,j);for(S=A.c,M=A.lc;M>=E;){const w=d[S>>M-E&Z];if(w.len){M-=w.len;const h=s(w.lit,b,S,M,m,j,a,D,q);h&&(S=h.c,M=h.lc)}else{if(!w.p)throw new Error("hufDecode issues");let d;for(d=0;d<w.lit;d++){const E=n(h[w.p[d]]);for(;M<E&&j.value<I;)A=U(S,M,m,j),S=A.c,M=A.lc;if(M>=E&&p(h[w.p[d]])==(S>>M-E&(1<<E)-1)){M-=E;const h=s(w.p[d],b,S,M,m,j,a,D,q);h&&(S=h.c,M=h.lc);break}}if(d==w.lit)throw new Error("HufDecode issues")}}}const R=8-A&7;for(S>>=R,M-=R;M>0;){const h=d[S<<E-M&Z];if(!h.len)throw new Error("HufDecode issues");{M-=h.len;const d=s(h.lit,b,S,M,m,j,a,D,q);d&&(S=d.c,M=d.lc)}}}(M,q,h,m,S,D,b,A,{value:0})}function X(h){return 65535&h}function z(h){const d=X(h);return d>32767?d-65536:d}function u(h,d){const m=z(h),j=z(d),A=m+(1&j)+(j>>1);return{a:A,b:A-j}}function P(h,d){const m=X(h),j=X(d),A=m-(j>>1)&Q;return{a:j+A-x&Q,b:A}}function G(h,d,m,j,A,b,w){const a=w<16384,D=m>A?A:m;let S,M,q=1;for(;q<=D;)q<<=1;for(q>>=1,S=q,q>>=1;q>=1;){M=0;const w=M+b*(A-S),D=b*q,E=b*S,I=j*q,R=j*S;let Z,L,B,V;for(;M<=w;M+=E){let A=M;const b=M+j*(m-S);for(;A<=b;A+=R){const m=A+I,j=A+D,b=j+I;if(a){let w=u(h[A+d],h[j+d]);Z=w.a,B=w.b,w=u(h[m+d],h[b+d]),L=w.a,V=w.b,w=u(Z,L),h[A+d]=w.a,h[m+d]=w.b,w=u(B,V),h[j+d]=w.a,h[b+d]=w.b}else{let w=P(h[A+d],h[j+d]);Z=w.a,B=w.b,w=P(h[m+d],h[b+d]),L=w.a,V=w.b,w=P(Z,L),h[A+d]=w.a,h[m+d]=w.b,w=P(B,V),h[j+d]=w.a,h[b+d]=w.b}}if(m&q){const m=A+D;let j;j=a?u(h[A+d],h[m+d]):P(h[A+d],h[m+d]),Z=j.a,h[m+d]=j.b,h[A+d]=Z}}if(A&q){let A=M;const b=M+j*(m-S);for(;A<=b;A+=R){const m=A+I;let j;j=a?u(h[A+d],h[m+d]):P(h[A+d],h[m+d]),Z=j.a,h[m+d]=j.b,h[A+d]=Z}}S=q,q>>=1}return M}function hh(h){return new DataView(h.array.buffer,h.offset.value,h.size)}function dh(h){const d=h.viewer.buffer.slice(h.offset.value,h.offset.value+h.size),m=new Uint8Array(function(h){let d=h.byteLength;const m=[];let j=0;const A=new DataView(h);for(;d>0;){const h=A.getInt8(j++);if(h<0){const b=-h;d-=b+1;for(let h=0;h<b;h++)m.push(A.getUint8(j++))}else{const b=h;d-=2;const w=A.getUint8(j++);for(let h=0;h<b+1;h++)m.push(w)}}return m}(d)),j=new Uint8Array(m.length);return N(m),W(m,j),new DataView(j.buffer)}function mh(h){const d=h.array.slice(h.offset.value,h.offset.value+h.size),m=fflate.unzlibSync(d),j=new Uint8Array(m.length);return N(m),W(m,j),new DataView(j.buffer)}function jh(h){const d=h.array.slice(h.offset.value,h.offset.value+h.size),m=fflate.unzlibSync(d),j=h.lines*h.channels*h.width,A=1==h.type?new Uint16Array(j):new Uint32Array(j);let b=0,w=0;const a=new Array(4);for(let D=0;D<h.lines;D++)for(let d=0;d<h.channels;d++){let d=0;switch(h.type){case 1:a[0]=b,a[1]=a[0]+h.width,b=a[1]+h.width;for(let j=0;j<h.width;++j){d+=m[a[0]++]<<8|m[a[1]++],A[w]=d,w++}break;case 2:a[0]=b,a[1]=a[0]+h.width,a[2]=a[1]+h.width,b=a[2]+h.width;for(let j=0;j<h.width;++j){d+=m[a[0]++]<<24|m[a[1]++]<<16|m[a[2]++]<<8,A[w]=d,w++}}}return new DataView(A.buffer)}function Ah(h){const d=h.viewer,m={value:h.offset.value},j=new Uint16Array(h.width*h.scanlineBlockSize*(h.channels*h.type)),A=new Uint8Array(q);let b=0;const w=new Array(h.channels);for(let D=0;D<h.channels;D++)w[D]={},w[D].start=b,w[D].end=w[D].start,w[D].nx=h.width,w[D].ny=h.lines,w[D].size=h.type,b+=w[D].nx*w[D].ny*w[D].size;const a=F(d,m),S=F(d,m);if(S>=q)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(a<=S)for(let D=0;D<S-a+1;D++)A[D+a]=g(d,m);const E=new Uint16Array(M),I=function(h,d){let m=0;for(let A=0;A<M;++A)(0==A||h[A>>3]&1<<(7&A))&&(d[m++]=A);const j=m-1;for(;m<M;)d[m++]=0;return j}(A,E),R=i(d,m);e(h.array,d,m,R,j,b);for(let D=0;D<h.channels;++D){const h=w[D];for(let d=0;d<w[D].size;++d)G(j,h.start+d,h.nx,h.size,h.ny,h.nx*h.size,I)}!function(h,d,m){for(let j=0;j<m;++j)d[j]=h[d[j]]}(E,j,b);let Z=0;const L=new Uint8Array(j.buffer.byteLength);for(let M=0;M<h.lines;M++)for(let d=0;d<h.channels;d++){const h=w[d],m=h.nx*h.size,A=new Uint8Array(j.buffer,h.end*D,m*D);L.set(A,Z),Z+=m*D,h.end+=m}return new DataView(L.buffer)}var bh,wh=m(11107);!function(h){h[h.Float=0]="Float",h[h.HalfFloat=1]="HalfFloat"}(bh||(bh={}));class ah{}async function Dh(h,d,m,j){const A={size:0,viewer:d,array:new Uint8Array(d.buffer),offset:m,width:h.dataWindow.xMax-h.dataWindow.xMin+1,height:h.dataWindow.yMax-h.dataWindow.yMin+1,channels:h.channels.length,channelLineOffsets:{},scanOrder:()=>0,bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:()=>0,format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0};switch(h.compression){case v.NO_COMPRESSION:A.lines=1,A.uncompress=hh;break;case v.RLE_COMPRESSION:A.lines=1,A.uncompress=dh;break;case v.ZIPS_COMPRESSION:A.lines=1,A.uncompress=mh,await wh.e.LoadScriptAsync(ah.FFLATEUrl);break;case v.ZIP_COMPRESSION:A.lines=16,A.uncompress=mh,await wh.e.LoadScriptAsync(ah.FFLATEUrl);break;case v.PIZ_COMPRESSION:A.lines=32,A.uncompress=Ah;break;case v.PXR24_COMPRESSION:A.lines=16,A.uncompress=jh,await wh.e.LoadScriptAsync(ah.FFLATEUrl);break;default:throw new Error(v[h.compression]+" is unsupported")}A.scanlineBlockSize=A.lines;const b={};for(const w of h.channels)switch(w.name){case"R":case"G":case"B":case"A":case"Y":b[w.name]=!0,A.type=w.pixelType}let a=!1;if(b.R&&b.G&&b.B&&b.A)A.outputChannels=4,A.decodeChannels={R:0,G:1,B:2,A:3};else if(b.R&&b.G&&b.B)a=!0,A.outputChannels=4,A.decodeChannels={R:0,G:1,B:2,A:3};else if(b.R&&b.G)A.outputChannels=2,A.decodeChannels={R:0,G:1};else if(b.R)A.outputChannels=1,A.decodeChannels={R:0};else{if(!b.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");A.outputChannels=1,A.decodeChannels={Y:0}}if(1===A.type)switch(j){case bh.Float:A.getter=k,A.inputSize=D;break;case bh.HalfFloat:A.getter=F,A.inputSize=D}else{if(2!==A.type)throw new Error("Unsupported pixelType "+A.type+" for "+h.compression);switch(j){case bh.Float:A.getter=c,A.inputSize=w;break;case bh.HalfFloat:A.getter=l,A.inputSize=w}}A.blockCount=A.height/A.scanlineBlockSize;for(let w=0;w<A.blockCount;w++)H(d,m);const S=A.width*A.height*A.outputChannels;switch(j){case bh.Float:A.byteArray=new Float32Array(S),A.textureType=1,a&&A.byteArray.fill(1,0,S);break;case bh.HalfFloat:A.byteArray=new Uint16Array(S),A.textureType=2,a&&A.byteArray.fill(15360,0,S);break;default:throw new Error("Unsupported type: "+j)}let M=0;for(const w of h.channels)void 0!==A.decodeChannels[w.name]&&(A.channelLineOffsets[w.name]=M*A.width),M+=2*w.pixelType;return A.bytesPerLine=A.width*M,A.outLineWidth=A.width*A.outputChannels,"INCREASING_Y"===h.lineOrder?A.scanOrder=h=>h:A.scanOrder=h=>A.height-1-h,4==A.outputChannels?(A.format=5,A.linearSpace=!0):(A.format=6,A.linearSpace=!1),A}function Sh(h,d,m,j){const A={value:0};for(let b=0;b<h.height/h.scanlineBlockSize;b++){const w=y(m,j)-d.dataWindow.yMin;h.size=i(m,j),h.lines=w+h.scanlineBlockSize>h.height?h.height-w:h.scanlineBlockSize;const a=h.size<h.lines*h.bytesPerLine&&h.uncompress?h.uncompress(h):hh(h);j.value+=h.size;for(let m=0;m<h.scanlineBlockSize;m++){const j=b*h.scanlineBlockSize,w=m+h.scanOrder(j);if(w>=h.height)continue;const D=m*h.bytesPerLine,S=(h.height-1-w)*h.outLineWidth;for(let m=0;m<h.channels;m++){const j=d.channels[m].name,b=h.channelLineOffsets[j],w=h.decodeChannels[j];if(void 0!==w){A.value=D+b;for(let d=0;d<h.width;d++){const m=S+d*h.outputChannels+w;h.byteArray&&(h.byteArray[m]=h.getter(a,A))}}}}}}ah.DefaultOutputType=bh.HalfFloat,ah.FFLATEUrl="https://unpkg.com/fflate@0.8.2";class Mh{constructor(){this.supportCascades=!1}loadCubeData(h,d,m,j,A){throw".exr not supported in Cube."}loadData(h,d,m){const A=new DataView(h.buffer),b={value:0},w=Y(A,b);Dh(w,A,b,ah.DefaultOutputType).then((h=>{Sh(h,w,A,b);const j=w.dataWindow.xMax-w.dataWindow.xMin+1,a=w.dataWindow.yMax-w.dataWindow.yMin+1;m(j,a,d.generateMipMaps,!1,(()=>{const m=d.getEngine();d.format=w.format,d.type=h.textureType,d.invertY=!1,d._gammaSpace=!w.linearSpace,h.byteArray&&m._uploadDataToTextureDirectly(d,h.byteArray,0,0,void 0,!0)}))})).catch((h=>{j.c.Error("Failed to load EXR texture: ",h)}))}}async function qh(h){const d=new DataView(h),m={value:0},A=Y(d,m);try{const h=await Dh(A,d,m,bh.Float);return Sh(h,A,d,m),h.byteArray?{width:A.dataWindow.xMax-A.dataWindow.xMin+1,height:A.dataWindow.yMax-A.dataWindow.yMin+1,data:new Float32Array(h.byteArray)}:(j.c.Error("Failed to decode EXR data: No byte array available."),{width:0,height:0,data:null})}catch(b){j.c.Error("Failed to load EXR data: ",b)}return{width:0,height:0,data:null}}}}]);