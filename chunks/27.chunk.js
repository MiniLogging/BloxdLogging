"use strict";(self.wj3aziuz228=self.wj3aziuz228||[]).push([[27],{12982:(u,R,I)=>{I.d(R,{d:()=>T,h:()=>E,j:()=>z,m:()=>b,q:()=>X,t:()=>P,u:()=>r});var B=I(12481),U=I(12518),K=I(12491),C=I(12433),D=I(12988),s=I(12888),t=I(12502),G=I(12337),S=I(12507);const b=Object.freeze(new B.Quaternion(0,0,0,0)),r=Object.freeze(B.PR.Zero()),P=Object.freeze(B.Vector2.Zero()),X=Object.freeze(t.c.Zero()),E=Object.freeze(U.fR.Black()),z=Object.freeze(new U.TD(0,0,0,0)),f={key:0,repeatCount:0,loopMode:2};class T{static _PrepareAnimation(u,R,I,K,C,D,s,G){let S;if(!isNaN(parseFloat(C))&&isFinite(C)?S=T.ANIMATIONTYPE_FLOAT:C instanceof B.Quaternion?S=T.ANIMATIONTYPE_QUATERNION:C instanceof B.PR?S=T.ANIMATIONTYPE_VECTOR3:C instanceof B.Vector2?S=T.ANIMATIONTYPE_VECTOR2:C instanceof U.fR?S=T.ANIMATIONTYPE_COLOR3:C instanceof U.TD?S=T.ANIMATIONTYPE_COLOR4:C instanceof t.c&&(S=T.ANIMATIONTYPE_SIZE),void 0==S)return null;const b=new T(u,R,I,S,s),r=[{frame:0,value:C},{frame:K,value:D}];return b.setKeys(r),void 0!==G&&b.setEasingFunction(G),b}static CreateAnimation(u,R,I,B){const U=new T(u+"Animation",u,I,R,T.ANIMATIONLOOPMODE_CONSTANT);return U.setEasingFunction(B),U}static CreateAndStartAnimation(u,R,I,B,U,K,C,D,s,t,G){const S=T._PrepareAnimation(u,I,B,U,K,C,D,s);return S?(R.eu&&(G=R.eu()),G?G.beginDirectAnimation(R,[S],0,U,S.loopMode!==T.ANIMATIONLOOPMODE_CONSTANT,1,t):null):null}static CreateAndStartHierarchyAnimation(u,R,I,B,U,K,C,D,s,t,G){const S=T._PrepareAnimation(u,B,U,K,C,D,s,t);if(!S)return null;return R.eu().beginDirectHierarchyAnimation(R,I,[S],0,K,1===S.loopMode,1,G)}static CreateMergeAndStartAnimation(u,R,I,B,U,K,C,D,s,t){const G=T._PrepareAnimation(u,I,B,U,K,C,D,s);return G?(R.animations.push(G),R.eu().beginAnimation(R,0,U,1===G.loopMode,1,t)):null}static MakeAnimationAdditive(u,R,I){let U;U="object"===typeof R?R:{referenceFrame:R??0,range:I,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let K=u;if(U.cloneOriginalAnimation&&(K=u.clone(),K.name=U.clonedAnimationName||K.name),!K._keys.length)return K;const C=U.referenceFrame&&U.referenceFrame>=0?U.referenceFrame:0;let D=0;const s=K._keys[0];let t=K._keys.length-1;const G=K._keys[t],S={referenceValue:s.value,referencePosition:B.TmpVectors.PR[0],referenceQuaternion:B.TmpVectors.Quaternion[0],referenceScaling:B.TmpVectors.PR[1],keyPosition:B.TmpVectors.PR[2],keyQuaternion:B.TmpVectors.Quaternion[1],keyScaling:B.TmpVectors.PR[3]};let b=s.frame,r=G.frame;if(U.range){const u=K.getRange(U.range);u&&(b=u.from,r=u.to)}else b=U.fromFrame??b,r=U.toFrame??r;if(b!==s.frame&&(D=K.createKeyForFrame(b)),r!==G.frame&&(t=K.createKeyForFrame(r)),1===K._keys.length){const u=K._getKeyValue(K._keys[0]);S.referenceValue=u.clone?u.clone():u}else if(C<=s.frame){const u=K._getKeyValue(s.value);S.referenceValue=u.clone?u.clone():u}else if(C>=G.frame){const u=K._getKeyValue(G.value);S.referenceValue=u.clone?u.clone():u}else{f.key=0;const u=K._interpolate(C,f);S.referenceValue=u.clone?u.clone():u}K.dataType===T.ANIMATIONTYPE_QUATERNION?S.referenceValue.normalize().conjugateInPlace():K.dataType===T.ANIMATIONTYPE_MATRIX&&(S.referenceValue.decompose(S.referenceScaling,S.referenceQuaternion,S.referencePosition),S.referenceQuaternion.normalize().conjugateInPlace());let P=Number.MAX_VALUE;const X=U.clipKeys?[]:null;for(let E=D;E<=t;E++){let u=K._keys[E];if((X||U.cloneOriginalAnimation)&&(u={frame:u.frame,value:u.value.clone?u.value.clone():u.value,inTangent:u.inTangent,outTangent:u.outTangent,interpolation:u.interpolation,lockedTangent:u.lockedTangent},X&&(P===Number.MAX_VALUE&&(P=u.frame),u.frame-=P,X.push(u))),!E||K.dataType===T.ANIMATIONTYPE_FLOAT||u.value!==s.value)switch(K.dataType){case T.ANIMATIONTYPE_MATRIX:u.value.decompose(S.keyScaling,S.keyQuaternion,S.keyPosition),S.keyPosition.RS(S.referencePosition),S.keyScaling.divideInPlace(S.referenceScaling),S.referenceQuaternion.multiplyToRef(S.keyQuaternion,S.keyQuaternion),B.Matrix.ComposeToRef(S.keyScaling,S.keyQuaternion,S.keyPosition,u.value);break;case T.ANIMATIONTYPE_QUATERNION:S.referenceValue.multiplyToRef(u.value,u.value);break;case T.ANIMATIONTYPE_VECTOR2:case T.ANIMATIONTYPE_VECTOR3:case T.ANIMATIONTYPE_COLOR3:case T.ANIMATIONTYPE_COLOR4:u.value.subtractToRef(S.referenceValue,u.value);break;case T.ANIMATIONTYPE_SIZE:u.value.width-=S.referenceValue.width,u.value.height-=S.referenceValue.height;break;default:u.value-=S.referenceValue}}return X&&K.setKeys(X,!0),K}static TransitionTo(u,R,I,B,U,K,C){let D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(C<=0)return I[u]=R,D&&D(),null;const s=U*(C/1e3);K.setKeys([{frame:0,value:I[u].clone?I[u].clone():I[u]},{frame:s,value:R}]),I.animations||(I.animations=[]),I.animations.push(K);const t=B.beginAnimation(I,0,s,!1);return t.onAnimationEnd=D,t}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const u of this._runtimeAnimations)if(!u.isStopped())return!0;return!1}constructor(u,R,I,B,U,K){this.name=u,this.targetProperty=R,this.framePerSecond=I,this.dataType=B,this.loopMode=U,this.enableBlending=K,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=R.split("."),this.dataType=B,this.loopMode=void 0===U?T.ANIMATIONLOOPMODE_CYCLE:U,this.uniqueId=T._UniqueIdGenerator++}toString(u){let R="Name: "+this.name+", property: "+this.targetProperty;if(R+=", datatype: "+["Float","PR","Quaternion","Matrix","fR","Vector2"][this.dataType],R+=", nKeys: "+(this._keys?this._keys.length:"none"),R+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),u){R+=", Ranges: {";let u=!0;for(const I in this._ranges)u&&(R+=", ",u=!1),R+=I;R+="}"}return R}addEvent(u){this._events.push(u),this._events.sort(((u,R)=>u.frame-R.frame))}removeEvents(u){for(let R=0;R<this._events.length;R++)this._events[R].frame===u&&(this._events.splice(R,1),R--)}getEvents(){return this._events}createRange(u,R,I){this._ranges[u]||(this._ranges[u]=new D.b(u,R,I))}deleteRange(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=this._ranges[u];if(I){if(R){const u=I.from,R=I.to;for(let I=this._keys.length-1;I>=0;I--)this._keys[I].frame>=u&&this._keys[I].frame<=R&&this._keys.splice(I,1)}this._ranges[u]=null}}getRange(u){return this._ranges[u]}getKeys(){return this._keys}getHighestFrame(){let u=0;for(let R=0,I=this._keys.length;R<I;R++)u<this._keys[R].frame&&(u=this._keys[R].frame);return u}getEasingFunction(){return this._easingFunction}setEasingFunction(u){this._easingFunction=u}floatInterpolateFunction(u,R,I){return(0,K.Lerp)(u,R,I)}floatInterpolateFunctionWithTangents(u,R,I,B,U){return(0,K.Hermite)(u,R,I,B,U)}quaternionInterpolateFunction(u,R,I){return B.Quaternion.Slerp(u,R,I)}quaternionInterpolateFunctionWithTangents(u,R,I,U,K){return B.Quaternion.Hermite(u,R,I,U,K).normalize()}vector3InterpolateFunction(u,R,I){return B.PR.Lerp(u,R,I)}vector3InterpolateFunctionWithTangents(u,R,I,U,K){return B.PR.Hermite(u,R,I,U,K)}vector2InterpolateFunction(u,R,I){return B.Vector2.Lerp(u,R,I)}vector2InterpolateFunctionWithTangents(u,R,I,U,K){return B.Vector2.Hermite(u,R,I,U,K)}sizeInterpolateFunction(u,R,I){return t.c.Lerp(u,R,I)}color3InterpolateFunction(u,R,I){return U.fR.Lerp(u,R,I)}color3InterpolateFunctionWithTangents(u,R,I,B,K){return U.fR.Hermite(u,R,I,B,K)}color4InterpolateFunction(u,R,I){return U.TD.Lerp(u,R,I)}color4InterpolateFunctionWithTangents(u,R,I,B,K){return U.TD.Hermite(u,R,I,B,K)}_getKeyValue(u){return"function"===typeof u?u():u}evaluate(u){return f.key=0,this._interpolate(u,f)}_interpolate(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(R.loopMode===T.ANIMATIONLOOPMODE_CONSTANT&&R.repeatCount>0)return R.highLimitValue.clone?R.highLimitValue.clone():R.highLimitValue;const B=this._keys;let U;if(this._coreAnimation)U=this._coreAnimation._key;else{const K=B.length;for(U=R.key;U>=0&&u<B[U].frame;)--U;for(;U+1<=K-1&&u>=B[U+1].frame;)++U;if(R.key=U,U<0)return I?void 0:this._getKeyValue(B[0].value);if(U+1>K-1)return I?void 0:this._getKeyValue(B[K-1].value);this._key=U}const K=B[U],C=B[U+1];if(I&&(u===K.frame||u===C.frame))return;const D=this._getKeyValue(K.value),s=this._getKeyValue(C.value);if(1===K.interpolation)return C.frame>u?D:s;const t=void 0!==K.outTangent&&void 0!==C.inTangent,G=C.frame-K.frame;let S=(u-K.frame)/G;const f=K.easingFunction||this.getEasingFunction();switch(f&&(S=f.ease(S)),this.dataType){case T.ANIMATIONTYPE_FLOAT:{const u=t?this.floatInterpolateFunctionWithTangents(D,K.outTangent*G,s,C.inTangent*G,S):this.floatInterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(R.offsetValue??0)*R.repeatCount+u}break}case T.ANIMATIONTYPE_QUATERNION:{const u=t?this.quaternionInterpolateFunctionWithTangents(D,K.outTangent.scale(G),s,C.inTangent.scale(G),S):this.quaternionInterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.addInPlace((R.offsetValue||b).scale(R.repeatCount))}return u}case T.ANIMATIONTYPE_VECTOR3:{const u=t?this.vector3InterpolateFunctionWithTangents(D,K.outTangent.scale(G),s,C.inTangent.scale(G),S):this.vector3InterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((R.offsetValue||r).scale(R.repeatCount))}break}case T.ANIMATIONTYPE_VECTOR2:{const u=t?this.vector2InterpolateFunctionWithTangents(D,K.outTangent.scale(G),s,C.inTangent.scale(G),S):this.vector2InterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((R.offsetValue||P).scale(R.repeatCount))}break}case T.ANIMATIONTYPE_SIZE:switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(D,s,S);case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(D,s,S).add((R.offsetValue||X).scale(R.repeatCount))}break;case T.ANIMATIONTYPE_COLOR3:{const u=t?this.color3InterpolateFunctionWithTangents(D,K.outTangent.scale(G),s,C.inTangent.scale(G),S):this.color3InterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((R.offsetValue||E).scale(R.repeatCount))}break}case T.ANIMATIONTYPE_COLOR4:{const u=t?this.color4InterpolateFunctionWithTangents(D,K.outTangent.scale(G),s,C.inTangent.scale(G),S):this.color4InterpolateFunction(D,s,S);switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return u;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((R.offsetValue||z).scale(R.repeatCount))}break}case T.ANIMATIONTYPE_MATRIX:switch(R.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return T.AllowMatricesInterpolation?this.matrixInterpolateFunction(D,s,S,R.workValue):D;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return D}}return 0}matrixInterpolateFunction(u,R,I,U){return T.AllowMatrixDecomposeForInterpolation?U?(B.Matrix.DecomposeLerpToRef(u,R,I,U),U):B.Matrix.DecomposeLerp(u,R,I):U?(B.Matrix.LerpToRef(u,R,I,U),U):B.Matrix.Lerp(u,R,I)}clone(){const u=new T(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed,this._keys&&u.setKeys(this._keys),this._ranges){u._ranges={};for(const R in this._ranges){const I=this._ranges[R];I&&(u._ranges[R]=I.clone())}}return u}setKeys(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=R?u:u.slice(0)}createKeyForFrame(u){f.key=0;const R=this._interpolate(u,f,!0);if(!R)return this._keys[f.key].frame===u?f.key:f.key+1;const I={frame:u,value:R.clone?R.clone():R};return this._keys.splice(f.key+1,0,I),f.key+1}serialize(){const u={};u.name=this.name,u.property=this.targetProperty,u.framePerSecond=this.framePerSecond,u.dataType=this.dataType,u.loopBehavior=this.loopMode,u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed;const R=this.dataType;u.keys=[];const I=this.getKeys();for(let B=0;B<I.length;B++){const U=I[B],K={};switch(K.frame=U.frame,R){case T.ANIMATIONTYPE_FLOAT:K.values=[U.value],void 0!==U.inTangent&&K.values.push(U.inTangent),void 0!==U.outTangent&&(void 0===U.inTangent&&K.values.push(void 0),K.values.push(U.outTangent)),void 0!==U.interpolation&&(void 0===U.inTangent&&K.values.push(void 0),void 0===U.outTangent&&K.values.push(void 0),K.values.push(U.interpolation));break;case T.ANIMATIONTYPE_QUATERNION:case T.ANIMATIONTYPE_MATRIX:case T.ANIMATIONTYPE_VECTOR3:case T.ANIMATIONTYPE_COLOR3:case T.ANIMATIONTYPE_COLOR4:K.values=U.value.sD(),void 0!=U.inTangent&&K.values.push(U.inTangent.sD()),void 0!=U.outTangent&&(void 0===U.inTangent&&K.values.push(void 0),K.values.push(U.outTangent.sD())),void 0!==U.interpolation&&(void 0===U.inTangent&&K.values.push(void 0),void 0===U.outTangent&&K.values.push(void 0),K.values.push(U.interpolation))}u.keys.push(K)}u.ranges=[];for(const B in this._ranges){const R=this._ranges[B];if(!R)continue;const I={};I.name=B,I.from=R.from,I.to=R.to,u.ranges.push(I)}return u}static _UniversalLerp(u,R,I){const B=u.constructor;return B.Lerp?B.Lerp(u,R,I):B.Slerp?B.Slerp(u,R,I):u.toFixed?u*(1-I)+I*R:R}static Parse(u){const R=new T(u.name,u.property,u.framePerSecond,u.dataType,u.loopBehavior),I=u.dataType,K=[];let C,D;for(u.enableBlending&&(R.enableBlending=u.enableBlending),u.blendingSpeed&&(R.blendingSpeed=u.blendingSpeed),D=0;D<u.keys.length;D++){const R=u.keys[D];let s,t,G;switch(I){case T.ANIMATIONTYPE_FLOAT:C=R.values[0],R.values.length>=2&&(s=R.values[1]),R.values.length>=3&&(t=R.values[2]),R.values.length>=4&&(G=R.values[3]);break;case T.ANIMATIONTYPE_QUATERNION:if(C=B.Quaternion.TR(R.values),R.values.length>=8){const u=B.Quaternion.TR(R.values.slice(4,8));u.equals(B.Quaternion.Zero())||(s=u)}if(R.values.length>=12){const u=B.Quaternion.TR(R.values.slice(8,12));u.equals(B.Quaternion.Zero())||(t=u)}R.values.length>=13&&(G=R.values[12]);break;case T.ANIMATIONTYPE_MATRIX:C=B.Matrix.TR(R.values),R.values.length>=17&&(G=R.values[16]);break;case T.ANIMATIONTYPE_COLOR3:C=U.fR.TR(R.values),R.values[3]&&(s=U.fR.TR(R.values[3])),R.values[4]&&(t=U.fR.TR(R.values[4])),R.values[5]&&(G=R.values[5]);break;case T.ANIMATIONTYPE_COLOR4:C=U.TD.TR(R.values),R.values[4]&&(s=U.TD.TR(R.values[4])),R.values[5]&&(t=U.TD.TR(R.values[5])),R.values[6]&&(G=U.TD.TR(R.values[6]));break;case T.ANIMATIONTYPE_VECTOR3:default:C=B.PR.TR(R.values),R.values[3]&&(s=B.PR.TR(R.values[3])),R.values[4]&&(t=B.PR.TR(R.values[4])),R.values[5]&&(G=R.values[5])}const S={};S.frame=R.frame,S.value=C,void 0!=s&&(S.inTangent=s),void 0!=t&&(S.outTangent=t),void 0!=G&&(S.interpolation=G),K.push(S)}if(R.setKeys(K),u.ranges)for(D=0;D<u.ranges.length;D++)C=u.ranges[D],R.createRange(C.name,C.from,C.to);return R}static AppendSerializedAnimations(u,R){S.e.AppendSerializedAnimations(u,R)}static async ParseFromFileAsync(u,R){return await new Promise(((I,B)=>{const U=new G.c;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){let R=JSON.parse(U.responseText);if(R.animations&&(R=R.animations),R.length){const u=[];for(const I of R)u.push(this.Parse(I));I(u)}else{const B=this.Parse(R);u&&(B.name=u),I(B)}}else B("Unable to load the animation")})),U.open("GET",R),U.send()}))}static async ParseFromSnippetAsync(u){return await new Promise(((R,I)=>{const B=new G.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const I=JSON.parse(JSON.parse(B.responseText).jsonPayload);if(I.animations){const B=JSON.parse(I.animations),U=[];for(const R of B.animations){const I=this.Parse(R);I.snippetId=u,U.push(I)}R(U)}else{const B=JSON.parse(I.animation),U=this.Parse(B);U.snippetId=u,R(U)}}else I("Unable to load the snippet "+u)})),B.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),B.send()}))}}T._UniqueIdGenerator=0,T.AllowMatricesInterpolation=!1,T.AllowMatrixDecomposeForInterpolation=!0,T.SnippetUrl="https://snippet.babylonjs.com",T.ANIMATIONTYPE_FLOAT=0,T.ANIMATIONTYPE_VECTOR3=1,T.ANIMATIONTYPE_QUATERNION=2,T.ANIMATIONTYPE_MATRIX=3,T.ANIMATIONTYPE_COLOR3=4,T.ANIMATIONTYPE_COLOR4=7,T.ANIMATIONTYPE_VECTOR2=5,T.ANIMATIONTYPE_SIZE=6,T.ANIMATIONLOOPMODE_RELATIVE=0,T.ANIMATIONLOOPMODE_CYCLE=1,T.ANIMATIONLOOPMODE_CONSTANT=2,T.ANIMATIONLOOPMODE_YOYO=4,T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,T.CreateFromSnippetAsync=T.ParseFromSnippetAsync,(0,C.e)("BABYLON.Animation",T),s.d._AnimationRangeFactory=(u,R,I)=>new D.b(u,R,I)},12988:(u,R,I)=>{I.d(R,{b:()=>B});class B{constructor(u,R,I){this.name=u,this.from=R,this.to=I}clone(){return new B(this.name,this.from,this.to)}}},12910:(u,R,I)=>{I.d(R,{e:()=>E});var B=I(12466),U=I(12472),K=I(12570),C=I(12294),D=I(12303),s=I(12481),t=I(12888),G=I(12315),S=I(12433),b=I(12335),r=I(12584),P=I(12676),X=I(12507);class E extends t.d{get position(){return this._position}set position(u){this._position=u}set upVector(u){this._upVector=u}get upVector(){return this._upVector}get screenArea(){let u=0,R=0;if(this.mode===E.PERSPECTIVE_CAMERA)this.fovMode===E.FOVMODE_VERTICAL_FIXED?(R=2*this.GD*Math.tan(this.fov/2),u=this.getEngine().getAspectRatio(this)*R):(u=2*this.GD*Math.tan(this.fov/2),R=u/this.getEngine().getAspectRatio(this));else{const I=this.getEngine().getRenderWidth()/2,B=this.getEngine().getRenderHeight()/2;u=(this.orthoRight??I)-(this.orthoLeft??-I),R=(this.orthoTop??B)-(this.orthoBottom??-B)}return u*R}set orthoLeft(u){this._orthoLeft=u;for(const R of this._rigCameras)R.orthoLeft=u}get orthoLeft(){return this._orthoLeft}set orthoRight(u){this._orthoRight=u;for(const R of this._rigCameras)R.orthoRight=u}get orthoRight(){return this._orthoRight}set orthoBottom(u){this._orthoBottom=u;for(const R of this._rigCameras)R.orthoBottom=u}get orthoBottom(){return this._orthoBottom}set orthoTop(u){this._orthoTop=u;for(const R of this._rigCameras)R.orthoTop=u}get orthoTop(){return this._orthoTop}setFocalLength(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(R/(2*u))}set mode(u){this._mode=u;for(const R of this._rigCameras)R.mode=u}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(u,R,I){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(u,I,!1),this._position=s.PR.Zero(),this._upVector=s.PR.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.GD=1,this.maxZ=1e4,this.inertia=.9,this._mode=E.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new r.b(0,0,1,1),this.layerMask=268435455,this.fovMode=E.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=E.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new D.c,this.onProjectionMatrixChangedObservable=new D.c,this.onAfterCheckInputsObservable=new D.c,this.onRestoreStateObservable=new D.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new s.Matrix,this._postProcesses=new Array,this._activeMeshes=new K.f(256),this._globalPosition=s.PR.Zero(),this._computedViewMatrix=s.Matrix.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=s.Matrix.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=s.Quaternion.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.eu().addCamera(this),B&&!this.eu().activeCamera&&(this.eu().activeCamera=this),this.position=R,this.renderPassId=this.eu().getEngine().createRenderPassId(`Camera ${u}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"bG"}toString(u){let R="Name: "+this.name;if(R+=", type: "+this.getClassName(),this.animations)for(let I=0;I<this.animations.length;I++)R+=", animation[0]: "+this.animations[I].toString(u);return R}applyVerticalCorrection(){const u=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-u.x:u.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(u){return-1!==this._activeMeshes.indexOf(u)}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(u)for(const R of this._postProcesses)if(R&&!R.isReady())return!1;return super.isReady(u)}_initCache(){super._initCache(),this._cache.position=new s.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new s.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.GD=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(u){u||super._updateCache(),this._cache.position.B(this.position),this._cache.upVector.B(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let u=this._cache.mode===this.mode&&this._cache.GD===this.GD&&this._cache.maxZ===this.maxZ;if(!u)return!1;const R=this.getEngine();return this.mode===E.PERSPECTIVE_CAMERA?u=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===R.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(u=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===R.getRenderWidth()&&this._cache.renderHeight===R.getRenderHeight(),this.oblique&&(u=u&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),u}attachControl(u,R){}gS(u){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==E.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let u=0;u<this._postProcesses.length;u++)if(null!==this._postProcesses[u])return this._postProcesses[u];return null}_cascadePostProcessesToRigCams(){const u=this._getFirstPostProcess();u&&u.markTextureDirty();for(let R=0,I=this._rigCameras.length;R<I;R++){const u=this._rigCameras[R],I=u._rigPostProcess;if(I){"pass"===I.getEffectName()&&(u.isIntermediate=0===this._postProcesses.length),u._postProcesses=this._postProcesses.slice(0).concat(I),I.markTextureDirty()}else u._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!u.isReusable()&&this._postProcesses.indexOf(u)>-1?(G.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==R||R<0?this._postProcesses.push(u):null===this._postProcesses[R]?this._postProcesses[R]=u:this._postProcesses.splice(R,0,u),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ot(),this._postProcesses.indexOf(u))}detachPostProcess(u){const R=this._postProcesses.indexOf(u);-1!==R&&(this._postProcesses[R]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Ot(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return s.Matrix.Identity()}getViewMatrix(u){return!u&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.eu().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(u){this._doNotComputeProjectionMatrix=!0,void 0!==u&&(this._projectionMatrix=u)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(u){if(this._doNotComputeProjectionMatrix||!u&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.GD=this.GD,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const R=this.getEngine(),I=this.eu(),B=R.FC;if(this.mode===E.PERSPECTIVE_CAMERA){let u;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=R.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.GD<=0&&(this.GD=.1),u=I.useRightHandedSystem?s.Matrix.PerspectiveFovRHToRef:s.Matrix.PerspectiveFovLHToRef,u(this.fov,R.getAspectRatio(this),B?this.maxZ:this.GD,B?this.GD:this.maxZ,this._projectionMatrix,this.fovMode===E.FOVMODE_VERTICAL_FIXED,R.isNDCHalfZRange,this.projectionPlaneTilt,B)}else{var U,K,C;const u=R.getRenderWidth()/2,D=R.getRenderHeight()/2;I.useRightHandedSystem?this.oblique?s.Matrix.ObliqueOffCenterRHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-D,this.orthoTop??D,B?this.maxZ:this.GD,B?this.GD:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,R.isNDCHalfZRange):s.Matrix.OrthoOffCenterRHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-D,this.orthoTop??D,B?this.maxZ:this.GD,B?this.GD:this.maxZ,this._projectionMatrix,R.isNDCHalfZRange):this.oblique?s.Matrix.ObliqueOffCenterLHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-D,this.orthoTop??D,B?this.maxZ:this.GD,B?this.GD:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,R.isNDCHalfZRange):s.Matrix.OrthoOffCenterLHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-D,this.orthoTop??D,B?this.maxZ:this.GD,B?this.GD:this.maxZ,this._projectionMatrix,R.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(U=this.oblique)||void 0===U?void 0:U.angle,this._cache.obliqueLength=null===(K=this.oblique)||void 0===K?void 0:K.length,this._cache.obliqueOffset=null===(C=this.oblique)||void 0===C?void 0:C.offset,this._cache.renderWidth=R.getRenderWidth(),this._cache.renderHeight=R.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(u){return(this.radius||(this.target?s.PR.Distance(this.position,this.target):this.position.length()))+u}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?P.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=P.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),R&&this.rigCameras.length>0){let R=!1;for(const I of this.rigCameras)I._updateFrustumPlanes(),R=R||u.isInFrustum(I._frustumPlanes);return R}return u.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(u){return this._updateFrustumPlanes(),u.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,b.c)("Ray")}getForwardRayToRef(u){throw(0,b.c)("Ray")}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.eu().stopAnimation(this),this.eu().removeCamera(this);this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this._parentContainer){const u=this._parentContainer.cameras.indexOf(this);u>-1&&this._parentContainer.cameras.splice(u,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==E.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let u=this._postProcesses.length;for(;--u>=0;){const R=this._postProcesses[u];R&&R.dispose(this)}}let I=this.customRenderTargets.length;for(;--I>=0;)this.customRenderTargets[I].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.eu().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(u,R)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(u,R){if(this.cameraRigMode!==u){for(;this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this.cameraRigMode=u,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=R.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=C.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==E.RIG_MODE_NONE){const u=this.createRigCamera(this.name+"_L",0);u&&(u._isLeftCamera=!0);const R=this.createRigCamera(this.name+"_R",1);R&&(R._isRightCamera=!0),u&&R&&(this._rigCameras.push(u),this._rigCameras.push(R))}this._setRigMode(R),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(u){}_getVRProjectionMatrix(){return s.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.GD,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(u,R){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[u]=R,"interaxialDistance"===u&&(this._cameraRigParams.stereoHalfAngle=C.Tools.ToRadians(R/.0637))}createRigCamera(u,R){return null}_updateRigCameras(){for(let u=0;u<this._rigCameras.length;u++)this._rigCameras[u].GD=this.GD,this._rigCameras[u].maxZ=this.maxZ,this._rigCameras[u].fov=this.fov,this._rigCameras[u].upVector.B(this.upVector);this.cameraRigMode===E.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const u=X.e.Serialize(this);return u.uniqueId=this.uniqueId,u.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(u),this.inputs&&this.inputs.serialize(u),X.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}clone(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=X.e.Clone(E.GetConstructorFromName(this.getClassName(),u,this.eu(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return I.name=u,I.parent=R,this.onClonedObservable.notifyObservers(I),I}zs(u){const R=s.PR.Zero();return this.getDirectionToRef(u,R),R}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(u,R){s.PR.TransformNormalToRef(u,this.getWorldMatrix(),R)}static GetConstructorFromName(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const K=t.d.Construct(u,R,I,{interaxial_distance:B,isStereoscopicSideBySide:U});return K||(()=>E._CreateDefaultParsedCamera(R,I))}bD(){return this.getWorldMatrix()}static Parse(u,R){const I=u.type,B=E.GetConstructorFromName(I,u.name,R,u.interaxial_distance,u.isStereoscopicSideBySide),U=X.e.Parse(B,u,R);if(void 0!==u.parentId&&(U._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(U._waitingParentInstanceIndex=u.parentInstanceIndex),U.inputs&&(U.inputs.parse(u),U._setupInputs()),u.upVector&&(U.upVector=s.PR.TR(u.upVector)),U.setPosition&&(U.position.ED(0,0,0),U.setPosition(s.PR.TR(u.position))),u.target&&U.setTarget&&U.setTarget(s.PR.TR(u.target)),u.cameraRigMode){const R=u.interaxial_distance?{interaxialDistance:u.interaxial_distance}:{};U.setCameraRigMode(u.cameraRigMode,R)}if(u.animations){for(let R=0;R<u.animations.length;R++){const I=u.animations[R],B=(0,S.c)("BABYLON.Animation");B&&U.animations.push(B.Parse(I))}t.d.ParseAnimationRanges(U,u,R)}return u.autoAnimate&&R.beginAnimation(U,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&U.WD(u.isEnabled),U}_calculateHandednessMultiplier(){let u=this.eu().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(u*=-1),u}}E._CreateDefaultParsedCamera=(u,R)=>{throw(0,b.c)("UniversalCamera")},E.PERSPECTIVE_CAMERA=0,E.ORTHOGRAPHIC_CAMERA=1,E.FOVMODE_VERTICAL_FIXED=0,E.FOVMODE_HORIZONTAL_FIXED=1,E.RIG_MODE_NONE=0,E.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,E.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,E.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,E.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,E.RIG_MODE_STEREOSCOPIC_INTERLACED=14,E.RIG_MODE_VR=20,E.RIG_MODE_CUSTOM=22,E.ForceAttachControlToAlwaysPreventDefault=!1,(0,B.c)([(0,U.O)("position")],E.prototype,"_position",void 0),(0,B.c)([(0,U.O)("upVector")],E.prototype,"_upVector",void 0),(0,B.c)([(0,U.S)()],E.prototype,"orthoLeft",null),(0,B.c)([(0,U.S)()],E.prototype,"orthoRight",null),(0,B.c)([(0,U.S)()],E.prototype,"orthoBottom",null),(0,B.c)([(0,U.S)()],E.prototype,"orthoTop",null),(0,B.c)([(0,U.S)()],E.prototype,"fov",void 0),(0,B.c)([(0,U.S)()],E.prototype,"projectionPlaneTilt",void 0),(0,B.c)([(0,U.S)()],E.prototype,"GD",void 0),(0,B.c)([(0,U.S)()],E.prototype,"maxZ",void 0),(0,B.c)([(0,U.S)()],E.prototype,"inertia",void 0),(0,B.c)([(0,U.S)()],E.prototype,"mode",null),(0,B.c)([(0,U.S)()],E.prototype,"layerMask",void 0),(0,B.c)([(0,U.S)()],E.prototype,"fovMode",void 0),(0,B.c)([(0,U.S)()],E.prototype,"cameraRigMode",void 0),(0,B.c)([(0,U.S)()],E.prototype,"interaxialDistance",void 0),(0,B.c)([(0,U.S)()],E.prototype,"isStereoscopicSideBySide",void 0)},12946:(u,R,I)=>{I.d(R,{c:()=>S});var B=I(12466),U=I(12472),K=I(12910),C=I(12481),D=I(12485),s=I(12669);I(12888).d.AddNodeConstructor("TargetCamera",((u,R)=>()=>new S(u,C.PR.Zero(),R)));const t=C.Matrix.Zero(),G=C.Quaternion.Identity();class S extends K.e{constructor(u,R,I){super(u,R,I,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new C.PR(0,0,0),this.cameraRotation=new C.Vector2(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=C.PR.Zero(),this._initialFocalDistance=1,this._viewMatrix=C.Matrix.Zero(),this._cameraTransformMatrix=C.Matrix.Zero(),this._cameraRotationMatrix=C.Matrix.Zero(),this._transformedReferencePoint=C.PR.Zero(),this._deferredPositionUpdate=new C.PR,this._deferredRotationQuaternionUpdate=new C.Quaternion,this._deferredRotationUpdate=new C.PR,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=C.PR.Forward(this.eu().useRightHandedSystem),this.rotation=new C.PR(0,this.eu().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(u){this.getWorldMatrix();const R=C.TmpVectors.PR[0],I=C.TmpVectors.PR[1];return I.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(I,R),R.scaleInPlace(u),this.globalPosition.add(R)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const u=this.lockedTarget;u.bD().getTranslationToRef(u.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.ED(0,0,0),this.cameraRotation.ED(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new C.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new C.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new C.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(u){u||super._updateCache();const R=this._getLockedTargetPosition();R?this._cache.lockedTarget?this._cache.lockedTarget.B(R):this._cache.lockedTarget=R.clone():this._cache.lockedTarget=null,this._cache.rotation.B(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.B(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const u=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(u):!u)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const u=this.getEngine();return this.speed*Math.sqrt(u.getDeltaTime()/(100*u.getFps()))}setTarget(u){this.upVector.normalize(),this._initialFocalDistance=u.XR(this.position).length(),this.position.z===u.z&&(this.position.z+=D.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.eu().useRightHandedSystem?C.Matrix.LookAtRHToRef(this.position,u,C.PR.UpReadOnly,t):C.Matrix.LookAtLHToRef(this.position,u,C.PR.UpReadOnly,t),t.invert();const R=this.rotationQuaternion||G;C.Quaternion.FromRotationMatrixToRef(t,R),R.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(u){this.setTarget(u)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(C.TmpVectors.Matrix[0]),C.PR.TransformNormalToRef(this.cameraDirection,C.TmpVectors.Matrix[0],C.TmpVectors.PR[0]),this._deferredPositionUpdate.addInPlace(C.TmpVectors.PR[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.B(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.B(this._deferredPositionUpdate)}_checkInputs(){const u=this.invertRotation?-this.inverseRotationSpeed:1,R=this._decideIfNeedsToMove(),I=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.B(this.rotation),this._deferredPositionUpdate.B(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.B(this.rotationQuaternion),R&&this._updatePosition(),I){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*u,this._deferredRotationUpdate.y+=this.cameraRotation.y*u,!this.noRotationConstraint){const u=1.570796;this._deferredRotationUpdate.x>u&&(this._deferredRotationUpdate.x=u),this._deferredRotationUpdate.x<-u&&(this._deferredRotationUpdate.x=-u)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.B(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(C.Quaternion.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.B(this._deferredRotationQuaternionUpdate))}}R&&(Math.abs(this.cameraDirection.x)<this.speed*D.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*D.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*D.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),I&&(Math.abs(this.cameraRotation.x)<this.speed*D.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*D.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):C.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return C.PR.TransformNormalToRef(C.PR.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),C.PR.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?s.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(C.Quaternion.FromEulerVectorToRef(this.rotation,G),s.c.Y.rotateByQuaternionToRef(G,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(u,R,I){if(this.eu().useRightHandedSystem?C.Matrix.LookAtRHToRef(u,R,I,this._viewMatrix):C.Matrix.LookAtLHToRef(u,R,I,this._viewMatrix),this.parent){const u=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(u,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.B(u)}createRigCamera(u,R){if(this.cameraRigMode!==K.e.RIG_MODE_NONE){const R=new S(u,this.position.clone(),this.eu());return R.isRigCamera=!0,R.rigParent=this,this.cameraRigMode===K.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new C.Quaternion),R._cameraRigParams={},R.rotationQuaternion=new C.Quaternion),R.mode=this.mode,R.orthoLeft=this.orthoLeft,R.orthoRight=this.orthoRight,R.orthoTop=this.orthoTop,R.orthoBottom=this.orthoBottom,R}return null}_updateRigCameras(){const u=this._rigCameras[0],R=this._rigCameras[1];switch(this.bD(),this.cameraRigMode){case K.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case K.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case K.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const I=this.cameraRigMode===K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,B=this.cameraRigMode===K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*I,u),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*B,R);break}case K.e.RIG_MODE_VR:u.rotationQuaternion?(u.rotationQuaternion.B(this.rotationQuaternion),R.rotationQuaternion.B(this.rotationQuaternion)):(u.rotation.B(this.rotation),R.rotation.B(this.rotation)),u.position.B(this.position),R.position.B(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(u,R){this.getTarget().subtractToRef(this.position,S._TargetFocalPoint),S._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const I=S._TargetFocalPoint.addInPlace(this.position);C.Matrix.TranslationToRef(-I.x,-I.y,-I.z,S._TargetTransformMatrix),S._TargetTransformMatrix.multiplyToRef(C.Matrix.RotationAxis(R.upVector,u),S._RigCamTransformMatrix),C.Matrix.TranslationToRef(I.x,I.y,I.z,S._TargetTransformMatrix),S._RigCamTransformMatrix.multiplyToRef(S._TargetTransformMatrix,S._RigCamTransformMatrix),C.PR.TransformCoordinatesToRef(this.position,S._RigCamTransformMatrix,R.position),R.setTarget(I)}getClassName(){return"TargetCamera"}}S._RigCamTransformMatrix=new C.Matrix,S._TargetTransformMatrix=new C.Matrix,S._TargetFocalPoint=new C.PR,(0,B.c)([(0,U.S)()],S.prototype,"updateUpVectorFromRotation",void 0),(0,B.c)([(0,U.O)()],S.prototype,"rotation",void 0),(0,B.c)([(0,U.S)()],S.prototype,"speed",void 0),(0,B.c)([(0,U.F)("lockedTargetId")],S.prototype,"lockedTarget",void 0)},12940:(u,R,I)=>{I.d(R,{e:()=>B});class B{}B.AUTOSAMPLERSUFFIX="Sampler",B.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",B.ALPHA_DISABLE=0,B.ALPHA_ADD=1,B.ALPHA_COMBINE=2,B.ALPHA_SUBTRACT=3,B.ALPHA_MULTIPLY=4,B.ALPHA_MAXIMIZED=5,B.ALPHA_ONEONE=6,B.ALPHA_PREMULTIPLIED=7,B.ALPHA_PREMULTIPLIED_PORTERDUFF=8,B.ALPHA_INTERPOLATE=9,B.ALPHA_SCREENMODE=10,B.ALPHA_ONEONE_ONEONE=11,B.ALPHA_ALPHATOCOLOR=12,B.ALPHA_REVERSEONEMINUS=13,B.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,B.ALPHA_ONEONE_ONEZERO=15,B.ALPHA_EXCLUSION=16,B.ALPHA_LAYER_ACCUMULATE=17,B.ALPHA_EQUATION_ADD=0,B.ALPHA_EQUATION_SUBSTRACT=1,B.ALPHA_EQUATION_REVERSE_SUBTRACT=2,B.ALPHA_EQUATION_MAX=3,B.ALPHA_EQUATION_MIN=4,B.ALPHA_EQUATION_DARKEN=5,B.DELAYLOADSTATE_NONE=0,B.DELAYLOADSTATE_LOADED=1,B.DELAYLOADSTATE_LOADING=2,B.DELAYLOADSTATE_NOTLOADED=4,B.NEVER=512,B.ALWAYS=519,B.LESS=513,B.EQUAL=514,B.LEQUAL=515,B.GREATER=516,B.GEQUAL=518,B.NOTEQUAL=517,B.KEEP=7680,B.ZERO=0,B.REPLACE=7681,B.INCR=7682,B.DECR=7683,B.INVERT=5386,B.INCR_WRAP=34055,B.DECR_WRAP=34056,B.TEXTURE_CLAMP_ADDRESSMODE=0,B.TEXTURE_WRAP_ADDRESSMODE=1,B.TEXTURE_MIRROR_ADDRESSMODE=2,B.TEXTURE_CREATIONFLAG_STORAGE=1,B.TEXTUREFORMAT_ALPHA=0,B.TEXTUREFORMAT_LUMINANCE=1,B.TEXTUREFORMAT_LUMINANCE_ALPHA=2,B.TEXTUREFORMAT_RGB=4,B.TEXTUREFORMAT_RGBA=5,B.TEXTUREFORMAT_RED=6,B.TEXTUREFORMAT_R=6,B.TEXTUREFORMAT_R16_UNORM=33322,B.TEXTUREFORMAT_RG16_UNORM=33324,B.TEXTUREFORMAT_RGB16_UNORM=32852,B.TEXTUREFORMAT_RGBA16_UNORM=32859,B.TEXTUREFORMAT_R16_SNORM=36760,B.TEXTUREFORMAT_RG16_SNORM=36761,B.TEXTUREFORMAT_RGB16_SNORM=36762,B.TEXTUREFORMAT_RGBA16_SNORM=36763,B.TEXTUREFORMAT_RG=7,B.TEXTUREFORMAT_RED_INTEGER=8,B.TEXTUREFORMAT_R_INTEGER=8,B.TEXTUREFORMAT_RG_INTEGER=9,B.TEXTUREFORMAT_RGB_INTEGER=10,B.TEXTUREFORMAT_RGBA_INTEGER=11,B.TEXTUREFORMAT_BGRA=12,B.TEXTUREFORMAT_DEPTH24_STENCIL8=13,B.TEXTUREFORMAT_DEPTH32_FLOAT=14,B.TEXTUREFORMAT_DEPTH16=15,B.TEXTUREFORMAT_DEPTH24=16,B.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,B.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,B.TEXTUREFORMAT_STENCIL8=19,B.TEXTUREFORMAT_UNDEFINED=4294967295,B.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,B.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,B.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,B.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,B.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,B.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,B.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,B.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,B.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,B.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,B.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,B.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,B.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,B.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,B.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,B.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,B.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,B.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,B.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,B.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,B.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,B.TEXTURETYPE_UNSIGNED_BYTE=0,B.TEXTURETYPE_UNSIGNED_INT=0,B.TEXTURETYPE_FLOAT=1,B.TEXTURETYPE_HALF_FLOAT=2,B.TEXTURETYPE_BYTE=3,B.TEXTURETYPE_SHORT=4,B.TEXTURETYPE_UNSIGNED_SHORT=5,B.TEXTURETYPE_INT=6,B.TEXTURETYPE_UNSIGNED_INTEGER=7,B.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,B.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,B.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,B.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,B.TEXTURETYPE_UNSIGNED_INT_24_8=12,B.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,B.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,B.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,B.TEXTURETYPE_UNDEFINED=16,B.TEXTURE_2D=3553,B.TEXTURE_2D_ARRAY=35866,B.TEXTURE_CUBE_MAP=34067,B.TEXTURE_CUBE_MAP_ARRAY=3735928559,B.TEXTURE_3D=32879,B.TEXTURE_NEAREST_SAMPLINGMODE=1,B.TEXTURE_NEAREST_NEAREST=1,B.TEXTURE_BILINEAR_SAMPLINGMODE=2,B.TEXTURE_LINEAR_LINEAR=2,B.TEXTURE_TRILINEAR_SAMPLINGMODE=3,B.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,B.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,B.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,B.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,B.TEXTURE_NEAREST_LINEAR=7,B.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,B.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,B.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,B.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,B.TEXTURE_LINEAR_NEAREST=12,B.TEXTURE_EXPLICIT_MODE=0,B.TEXTURE_SPHERICAL_MODE=1,B.TEXTURE_PLANAR_MODE=2,B.TEXTURE_CUBIC_MODE=3,B.TEXTURE_PROJECTION_MODE=4,B.TEXTURE_SKYBOX_MODE=5,B.TEXTURE_INVCUBIC_MODE=6,B.TEXTURE_EQUIRECTANGULAR_MODE=7,B.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,B.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,B.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,B.TEXTURE_FILTERING_QUALITY_HIGH=64,B.TEXTURE_FILTERING_QUALITY_MEDIUM=16,B.TEXTURE_FILTERING_QUALITY_LOW=8,B.SCALEMODE_FLOOR=1,B.SCALEMODE_NEAREST=2,B.SCALEMODE_CEILING=3,B.MATERIAL_TextureDirtyFlag=1,B.MATERIAL_LightDirtyFlag=2,B.MATERIAL_FresnelDirtyFlag=4,B.MATERIAL_AttributesDirtyFlag=8,B.MATERIAL_MiscDirtyFlag=16,B.MATERIAL_PrePassDirtyFlag=32,B.MATERIAL_ImageProcessingDirtyFlag=64,B.MATERIAL_AllDirtyFlag=127,B.MATERIAL_TriangleFillMode=0,B.MATERIAL_WireFrameFillMode=1,B.MATERIAL_PointFillMode=2,B.MATERIAL_PointListDrawMode=3,B.MATERIAL_LineListDrawMode=4,B.MATERIAL_LineLoopDrawMode=5,B.MATERIAL_LineStripDrawMode=6,B.MATERIAL_TriangleStripDrawMode=7,B.MATERIAL_TriangleFanDrawMode=8,B.MATERIAL_ClockWiseSideOrientation=0,B.MATERIAL_CounterClockWiseSideOrientation=1,B.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,B.MATERIAL_DIFFUSE_MODEL_BURLEY=1,B.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,B.MATERIAL_DIFFUSE_MODEL_LEGACY=3,B.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,B.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,B.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,B.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,B.ACTION_NothingTrigger=0,B.ACTION_OnPickTrigger=1,B.ACTION_OnLeftPickTrigger=2,B.ACTION_OnRightPickTrigger=3,B.ACTION_OnCenterPickTrigger=4,B.ACTION_OnPickDownTrigger=5,B.ACTION_OnDoublePickTrigger=6,B.ACTION_OnPickUpTrigger=7,B.ACTION_OnPickOutTrigger=16,B.ACTION_OnLongPressTrigger=8,B.ACTION_OnPointerOverTrigger=9,B.ACTION_OnPointerOutTrigger=10,B.ACTION_OnEveryFrameTrigger=11,B.ACTION_OnIntersectionEnterTrigger=12,B.ACTION_OnIntersectionExitTrigger=13,B.ACTION_OnKeyDownTrigger=14,B.ACTION_OnKeyUpTrigger=15,B.PARTICLES_BILLBOARDMODE_Y=2,B.PARTICLES_BILLBOARDMODE_ALL=7,B.PARTICLES_BILLBOARDMODE_STRETCHED=8,B.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,B.MESHES_CULLINGSTRATEGY_STANDARD=0,B.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,B.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,B.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,B.SCENELOADER_NO_LOGGING=0,B.SCENELOADER_MINIMAL_LOGGING=1,B.SCENELOADER_SUMMARY_LOGGING=2,B.SCENELOADER_DETAILED_LOGGING=3,B.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,B.PREPASS_POSITION_TEXTURE_TYPE=1,B.PREPASS_VELOCITY_TEXTURE_TYPE=2,B.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,B.PREPASS_COLOR_TEXTURE_TYPE=4,B.PREPASS_DEPTH_TEXTURE_TYPE=5,B.PREPASS_NORMAL_TEXTURE_TYPE=6,B.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,B.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,B.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,B.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,B.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,B.PREPASS_ALBEDO_TEXTURE_TYPE=12,B.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,B.BUFFER_CREATIONFLAG_READ=1,B.BUFFER_CREATIONFLAG_WRITE=2,B.BUFFER_CREATIONFLAG_READWRITE=3,B.BUFFER_CREATIONFLAG_UNIFORM=4,B.BUFFER_CREATIONFLAG_VERTEX=8,B.BUFFER_CREATIONFLAG_INDEX=16,B.BUFFER_CREATIONFLAG_STORAGE=32,B.BUFFER_CREATIONFLAG_INDIRECT=64,B.RENDERPASS_MAIN=0,B.INPUT_ALT_KEY=18,B.INPUT_CTRL_KEY=17,B.INPUT_META_KEY1=91,B.INPUT_META_KEY2=92,B.INPUT_META_KEY3=93,B.INPUT_SHIFT_KEY=16,B.SNAPSHOTRENDERING_STANDARD=0,B.SNAPSHOTRENDERING_FAST=1,B.PERSPECTIVE_CAMERA=0,B.ORTHOGRAPHIC_CAMERA=1,B.FOVMODE_VERTICAL_FIXED=0,B.FOVMODE_HORIZONTAL_FIXED=1,B.RIG_MODE_NONE=0,B.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,B.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,B.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,B.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,B.RIG_MODE_STEREOSCOPIC_INTERLACED=14,B.RIG_MODE_VR=20,B.RIG_MODE_CUSTOM=22,B.MAX_SUPPORTED_UV_SETS=6,B.GL_ALPHA_EQUATION_ADD=32774,B.GL_ALPHA_EQUATION_MIN=32775,B.GL_ALPHA_EQUATION_MAX=32776,B.GL_ALPHA_EQUATION_SUBTRACT=32778,B.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,B.GL_ALPHA_FUNCTION_SRC=768,B.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,B.GL_ALPHA_FUNCTION_SRC_ALPHA=770,B.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,B.GL_ALPHA_FUNCTION_DST_ALPHA=772,B.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,B.GL_ALPHA_FUNCTION_DST_COLOR=774,B.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,B.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,B.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,B.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,B.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,B.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,B.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,B.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,B.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,B.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,B.SnippetUrl="https://snippet.babylonjs.com",B.FOGMODE_NONE=0,B.FOGMODE_EXP=1,B.FOGMODE_EXP2=2,B.FOGMODE_LINEAR=3,B.BYTE=5120,B.UNSIGNED_BYTE=5121,B.SHORT=5122,B.UNSIGNED_SHORT=5123,B.INT=5124,B.UNSIGNED_INT=5125,B.FLOAT=5126,B.PositionKind="position",B.NormalKind="normal",B.TangentKind="tangent",B.UVKind="uv",B.UV2Kind="uv2",B.UV3Kind="uv3",B.UV4Kind="uv4",B.UV5Kind="uv5",B.UV6Kind="uv6",B.ColorKind="color",B.ColorInstanceKind="instanceColor",B.MatricesIndicesKind="matricesIndices",B.MatricesWeightsKind="matricesWeights",B.MatricesIndicesExtraKind="matricesIndicesExtra",B.MatricesWeightsExtraKind="matricesWeightsExtra",B.ANIMATIONTYPE_FLOAT=0,B.ANIMATIONTYPE_VECTOR3=1,B.ANIMATIONTYPE_QUATERNION=2,B.ANIMATIONTYPE_MATRIX=3,B.ANIMATIONTYPE_COLOR3=4,B.ANIMATIONTYPE_COLOR4=7,B.ANIMATIONTYPE_VECTOR2=5,B.ANIMATIONTYPE_SIZE=6,B.ShadowMinZ=0,B.ShadowMaxZ=1e4},12999:(u,R,I)=>{I.d(R,{d:()=>b});var B=I(12466),U=I(12472),K=I(12481),C=I(12518),D=I(12888),s=I(12724),t=I(12433),G=I(12776),S=I(12507);class b extends D.d{get range(){return this._range}set range(u){this._range=u,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(u){this._intensityMode=u,this._computePhotometricScale()}get radius(){return this._radius}set radius(u){this._radius=u,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(u){this._shadowEnabled!==u&&(this._shadowEnabled=u,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(u){this._includedOnlyMeshes=u,this._hookArrayForIncludedOnly(u)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(u){this._excludedMeshes=u,this._hookArrayForExcluded(u)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(u){this._excludeWithLayerMask=u,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(u){this._includeOnlyWithLayerMask=u,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(u){this._lightmapMode!==u&&(this._lightmapMode=u,this._markMeshesAsLightDirty())}getViewMatrix(u){return null}getProjectionMatrix(u,R){return null}constructor(u,R){super(u,R,!1),this.eD=new C.fR(1,1,1),this.rG=new C.fR(1,1,1),this.falloffType=b.FALLOFF_DEFAULT,this.qD=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=b.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.eu().addLight(this),this._uniformBuffer=new s.e(this.eu().getEngine(),void 0,void 0,u),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(u,R){return this}_bindLight(u,R,I,B){let U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const K=u.toString();let D=!1;if(this._uniformBuffer.bindToEffect(I,"Light"+K),this._renderId!==R.getRenderId()||this._lastUseSpecular!==B||!this._uniformBuffer.useUbo){this._renderId=R.getRenderId(),this._lastUseSpecular=B;const u=this.getScaledIntensity();this.transferToEffect(I,K),this.eD.scaleToRef(u,C.TmpColors.fR[0]),this._uniformBuffer.updateColor4("vLightDiffuse",C.TmpColors.fR[0],this.range,K),B&&(this.rG.scaleToRef(u,C.TmpColors.fR[1]),this._uniformBuffer.updateColor4("vLightSpecular",C.TmpColors.fR[1],this.radius,K)),D=!0}if(this.transferTexturesToEffect(I,K),R.shadowsEnabled&&this.shadowEnabled&&U){const u=this.getShadowGenerator(R.activeCamera)??this.getShadowGenerator();u&&(u.bindShadowLight(K,I),D=!0)}D?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(u){let R="Name: "+this.name;if(R+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let I=0;I<this.animations.length;I++)R+=", animation[0]: "+this.animations[I].toString(u);return R}_syncParentEnabledState(){super._syncParentEnabledState(),this.C()||this._resyncMeshes()}WD(u){super.WD(u),this._resyncMeshes()}getShadowGenerator(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(u)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return K.PR.Zero()}canAffectMesh(u){return!u||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(u))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(u))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&u.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&u.layerMask)))}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const u=this._shadowGenerators.values();for(let R=u.next();!0!==R.done;R=u.next()){R.value.dispose()}this._shadowGenerators=null}if(this.eu().stopAnimation(this),this._parentContainer){const u=this._parentContainer.lights.indexOf(this);u>-1&&this._parentContainer.lights.splice(u,1),this._parentContainer=null}for(const I of this.eu().meshes)I._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.eu().removeLight(this),super.dispose(u,R)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.qD}clone(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=b.GetConstructorFromName(this.getTypeID(),u,this.eu());if(!I)return null;const B=S.e.Clone(I,this);return u&&(B.name=u),R&&(B.parent=R),B.WD(this.isEnabled()),this.onClonedObservable.notifyObservers(B),B}serialize(){const u=S.e.Serialize(this);if(u.uniqueId=this.uniqueId,u.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(u),this.excludedMeshes.length>0){u.excludedMeshesIds=[];for(const R of this.excludedMeshes)u.excludedMeshesIds.push(R.id)}if(this.includedOnlyMeshes.length>0){u.includedOnlyMeshesIds=[];for(const R of this.includedOnlyMeshes)u.includedOnlyMeshesIds.push(R.id)}return S.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}static GetConstructorFromName(u,R,I){const B=D.d.Construct("Light_Type_"+u,R,I);return B||null}static Parse(u,R){const I=b.GetConstructorFromName(u.type,u.name,R);if(!I)return null;const B=S.e.Parse(I,u,R);if(u.excludedMeshesIds&&(B._excludedMeshesIds=u.excludedMeshesIds),u.includedOnlyMeshesIds&&(B._includedOnlyMeshesIds=u.includedOnlyMeshesIds),void 0!==u.parentId&&(B._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(B._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.falloffType&&(B.falloffType=u.falloffType),void 0!==u.lightmapMode&&(B.lightmapMode=u.lightmapMode),u.animations){for(let R=0;R<u.animations.length;R++){const I=u.animations[R],U=(0,t.c)("BABYLON.Animation");U&&B.animations.push(U.Parse(I))}D.d.ParseAnimationRanges(B,u,R)}return u.autoAnimate&&R.beginAnimation(B,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&B.WD(u.isEnabled),B}_hookArrayForExcluded(u){var R=this;const I=u.push;u.push=function(){for(var B=arguments.length,U=new Array(B),K=0;K<B;K++)U[K]=arguments[K];const C=I.apply(u,U);for(const u of U)u._resyncLightSource(R);return C};const B=u.splice;u.splice=(R,I)=>{const U=B.apply(u,[R,I]);for(const u of U)u._resyncLightSource(this);return U};for(const U of u)U._resyncLightSource(this)}_hookArrayForIncludedOnly(u){var R=this;const I=u.push;u.push=function(){for(var B=arguments.length,U=new Array(B),K=0;K<B;K++)U[K]=arguments[K];const C=I.apply(u,U);return R._resyncMeshes(),C};const B=u.splice;u.splice=(R,I)=>{const U=B.apply(u,[R,I]);return this._resyncMeshes(),U},this._resyncMeshes()}_resyncMeshes(){for(const u of this.eu().meshes)u._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const u of this.eu().meshes)-1!==u.lightSources.indexOf(this)&&u._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.eu().resetCachedMaterial()}_getPhotometricScale(){let u=0;const R=this.getTypeID();let I=this.intensityMode;switch(I===b.INTENSITYMODE_AUTOMATIC&&(I=R===b.LIGHTTYPEID_DIRECTIONALLIGHT?b.INTENSITYMODE_ILLUMINANCE:b.INTENSITYMODE_LUMINOUSINTENSITY),R){case b.LIGHTTYPEID_POINTLIGHT:case b.LIGHTTYPEID_SPOTLIGHT:switch(I){case b.INTENSITYMODE_LUMINOUSPOWER:u=1/(4*Math.PI);break;case b.INTENSITYMODE_LUMINOUSINTENSITY:u=1;break;case b.INTENSITYMODE_LUMINANCE:u=this.radius*this.radius}break;case b.LIGHTTYPEID_DIRECTIONALLIGHT:switch(I){case b.INTENSITYMODE_ILLUMINANCE:u=1;break;case b.INTENSITYMODE_LUMINANCE:{let R=this.radius;R=Math.max(R,.001);u=2*Math.PI*(1-Math.cos(R));break}}break;case b.LIGHTTYPEID_HEMISPHERICLIGHT:u=1}return u}_reorderLightsInScene(){const u=this.eu();0!=this._renderPriority&&(u.requireLightSorting=!0),this.eu().sortLightsByPriority()}_isReady(){return!0}}b.FALLOFF_DEFAULT=G.d.FALLOFF_DEFAULT,b.FALLOFF_PHYSICAL=G.d.FALLOFF_PHYSICAL,b.FALLOFF_GLTF=G.d.FALLOFF_GLTF,b.FALLOFF_STANDARD=G.d.FALLOFF_STANDARD,b.LIGHTMAP_DEFAULT=G.d.LIGHTMAP_DEFAULT,b.LIGHTMAP_SPECULAR=G.d.LIGHTMAP_SPECULAR,b.LIGHTMAP_SHADOWSONLY=G.d.LIGHTMAP_SHADOWSONLY,b.INTENSITYMODE_AUTOMATIC=G.d.INTENSITYMODE_AUTOMATIC,b.INTENSITYMODE_LUMINOUSPOWER=G.d.INTENSITYMODE_LUMINOUSPOWER,b.INTENSITYMODE_LUMINOUSINTENSITY=G.d.INTENSITYMODE_LUMINOUSINTENSITY,b.INTENSITYMODE_ILLUMINANCE=G.d.INTENSITYMODE_ILLUMINANCE,b.INTENSITYMODE_LUMINANCE=G.d.INTENSITYMODE_LUMINANCE,b.LIGHTTYPEID_POINTLIGHT=G.d.LIGHTTYPEID_POINTLIGHT,b.LIGHTTYPEID_DIRECTIONALLIGHT=G.d.LIGHTTYPEID_DIRECTIONALLIGHT,b.LIGHTTYPEID_SPOTLIGHT=G.d.LIGHTTYPEID_SPOTLIGHT,b.LIGHTTYPEID_HEMISPHERICLIGHT=G.d.LIGHTTYPEID_HEMISPHERICLIGHT,b.LIGHTTYPEID_RECT_AREALIGHT=G.d.LIGHTTYPEID_RECT_AREALIGHT,(0,B.c)([(0,U.p)()],b.prototype,"diffuse",void 0),(0,B.c)([(0,U.p)()],b.prototype,"specular",void 0),(0,B.c)([(0,U.S)()],b.prototype,"falloffType",void 0),(0,B.c)([(0,U.S)()],b.prototype,"intensity",void 0),(0,B.c)([(0,U.S)()],b.prototype,"range",null),(0,B.c)([(0,U.S)()],b.prototype,"intensityMode",null),(0,B.c)([(0,U.S)()],b.prototype,"radius",null),(0,B.c)([(0,U.S)()],b.prototype,"_renderPriority",void 0),(0,B.c)([(0,U.e)("_reorderLightsInScene")],b.prototype,"renderPriority",void 0),(0,B.c)([(0,U.S)("shadowEnabled")],b.prototype,"_shadowEnabled",void 0),(0,B.c)([(0,U.S)("excludeWithLayerMask")],b.prototype,"_excludeWithLayerMask",void 0),(0,B.c)([(0,U.S)("includeOnlyWithLayerMask")],b.prototype,"_includeOnlyWithLayerMask",void 0),(0,B.c)([(0,U.S)("lightmapMode")],b.prototype,"_lightmapMode",void 0)},13051:(u,R,I)=>{I.d(R,{d:()=>s});var B=I(12466),U=I(12472),K=I(12481),C=I(12999),D=I(12669);class s extends C.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=K.Matrix.Identity(),this._projectionMatrix=K.Matrix.Identity()}_setPosition(u){this._position=u}get position(){return this._position}set position(u){this._setPosition(u)}_setDirection(u){this._direction=u}get direction(){return this._direction}set direction(u){this._setDirection(u)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(u){this._shadowMinZ=u,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(u){this._shadowMaxZ=u,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=K.PR.Zero()),K.PR.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=K.PR.Zero()),K.PR.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(u){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(u){return this.direction=K.PR.Normalize(u.XR(this.position)),this.direction}getRotation(){this.direction.normalize();const u=K.PR.Cross(this.direction,D.c.Y),R=K.PR.Cross(u,this.direction);return K.PR.RotationFromAxis(u,R,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=K.PR.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}bD(u){return!u&&this.isSynchronized()?(this._currentRenderId=this.eu().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.B(this.position),this._worldMatrix||(this._worldMatrix=K.Matrix.Identity()),K.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(u){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===u||void 0===u?void 0:u.GD)||0}getDepthMaxZ(u){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===u||void 0===u?void 0:u.maxZ)||1e4}setShadowProjectionMatrix(u,R,I){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(R,I,u):this._setDefaultShadowProjectionMatrix(u,R,I),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(u){const R=K.TmpVectors.PR[0];let I=this.position;this.computeTransformedInformation()&&(I=this.transformedPosition),K.PR.NormalizeToRef(this.getShadowDirection(u),R),1===Math.abs(K.PR.Dot(R,K.PR.Up()))&&(R.z=1e-13);const B=K.TmpVectors.PR[1];return I.addToRef(R,B),K.Matrix.LookAtLHToRef(I,B,K.PR.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(u,R){return this.setShadowProjectionMatrix(this._projectionMatrix,u??this._viewMatrix,R??[]),this._projectionMatrix}}(0,B.c)([(0,U.O)()],s.prototype,"position",null),(0,B.c)([(0,U.O)()],s.prototype,"direction",null),(0,B.c)([(0,U.S)()],s.prototype,"shadowMinZ",null),(0,B.c)([(0,U.S)()],s.prototype,"shadowMaxZ",null)},12921:(u,R,I)=>{I.d(R,{d:()=>B});class B{static get ForceFullSceneLoadingForIncremental(){return B._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){B._ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return B._ShowLoadingScreen}static set ShowLoadingScreen(u){B._ShowLoadingScreen=u}static get loggingLevel(){return B._LoggingLevel}static set loggingLevel(u){B._LoggingLevel=u}static get CleanBoneMatrixWeights(){return B._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){B._CleanBoneMatrixWeights=u}}B._ForceFullSceneLoadingForIncremental=!1,B._ShowLoadingScreen=!0,B._CleanBoneMatrixWeights=!1,B._LoggingLevel=0},12969:(u,R,I)=>{I.d(R,{e:()=>W});var B=I(12466),U=I(12472),K=I(12315),C=I(12570),D=I(12957),s=I(12703),t=I(12481),G=I(12549),S=I(12851),b=I(12865);class r extends S.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class P extends b.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRBRDF",90,new r,R),this._useEnergyConservation=P.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=P.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=P.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=P.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=P.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=P.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=P.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=P.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=P.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=P.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=P.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=P.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=P.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=P.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=P.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=P.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=P.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=P.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16],this._enable(!0)}prepareDefines(u){u.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,u.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,u.SPHERICAL_HARMONICS=this._useSphericalHarmonics,u.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,u.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,u.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,u.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,u.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,u.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}P.DEFAULT_USE_ENERGY_CONSERVATION=!0,P.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,P.DEFAULT_USE_SPHERICAL_HARMONICS=!0,P.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,P.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,P.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,P.DEFAULT_DIFFUSE_MODEL=0,P.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,P.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"useEnergyConservation",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"useSphericalHarmonics",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"mixIblRadianceWithIrradiance",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"useLegacySpecularEnergyConservation",void 0),(0,B.c)([(0,U.S)("baseDiffuseModel"),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"baseDiffuseModel",void 0),(0,B.c)([(0,U.S)("dielectricSpecularModel"),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"dielectricSpecularModel",void 0),(0,B.c)([(0,U.S)("conductorSpecularModel"),(0,U.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"conductorSpecularModel",void 0);var X=I(12849),E=I(12518),z=I(12709),f=I(12796),T=I(12787),Q=I(12460),V=I(12853),q=(I(12974),I(12782)),e=I(12831);class Y extends S.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class M extends b.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRClearCoat",100,new Y,R),this._isEnabled=!1,this.isEnabled=!1,this.qD=1,this.roughness=0,this._indexOfRefraction=M._DefaultIndexOfRefraction,this.indexOfRefraction=M._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=E.fR.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,R,I){if(!this._isEnabled)return!0;const B=this._material._disableBumpMap;if(u._areTexturesDirty&&R.texturesEnabled){if(this._texture&&V.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&V.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(I.getCaps().standardDerivatives&&this._bumpTexture&&V.b.ClearCoatBumpTextureEnabled&&!B&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&V.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,R){this._isEnabled?(u.CLEARCOAT=!0,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,u._areTexturesDirty&&R.texturesEnabled&&(this._texture&&V.b.ClearCoatTextureEnabled?(0,e.P)(this._texture,u,"CLEARCOAT_TEXTURE"):u.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&V.b.ClearCoatTextureEnabled?(0,e.P)(this._textureRoughness,u,"CLEARCOAT_TEXTURE_ROUGHNESS"):u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&V.b.ClearCoatBumpTextureEnabled?(0,e.P)(this._bumpTexture,u,"CLEARCOAT_BUMP"):u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===M._DefaultIndexOfRefraction,this._isTintEnabled?(u.CLEARCOAT_TINT=!0,this._tintTexture&&V.b.ClearCoatTintTextureEnabled?((0,e.P)(this._tintTexture,u,"CLEARCOAT_TINT_TEXTURE"),u.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):u.CLEARCOAT_TINT_TEXTURE=!1):(u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1))):(u.CLEARCOAT=!1,u.CLEARCOAT_TEXTURE=!1,u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.CLEARCOAT_DEFAULTIOR=!1,u.CLEARCOAT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,u.CLEARCOAT_BUMPDIRECTUV=0,u.CLEARCOAT_REMAP_F0=!1,u.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(u,R,I,B){if(!this._isEnabled)return;const U=B.materialDefines,K=this._material.isFrozen,C=this._material._disableBumpMap,D=this._material._invertNormalMapX,s=this._material._invertNormalMapY;if(!u.useUbo||!K||!u.isSync){var t,G,S,b;if((this._texture||this._textureRoughness)&&V.b.ClearCoatTextureEnabled)u.updateFloat4("vClearCoatInfos",(null===(t=this._texture)||void 0===t?void 0:t.coordinatesIndex)??0,(null===(G=this._texture)||void 0===G?void 0:G.level)??0,(null===(S=this._textureRoughness)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(b=this._textureRoughness)||void 0===b?void 0:b.level)??0),this._texture&&(0,e.o)(this._texture,u,"clearCoat"),this._textureRoughness&&!U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.o)(this._textureRoughness,u,"clearCoatRoughness");this._bumpTexture&&I.getCaps().standardDerivatives&&V.b.ClearCoatTextureEnabled&&!C&&(u.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,e.o)(this._bumpTexture,u,"clearCoatBump"),R._mirroredCameraPosition?u.updateFloat2("vClearCoatTangentSpaceParams",D?1:-1,s?1:-1):u.updateFloat2("vClearCoatTangentSpaceParams",D?-1:1,s?-1:1)),this._tintTexture&&V.b.ClearCoatTintTextureEnabled&&(u.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,e.o)(this._tintTexture,u,"clearCoatTint")),u.updateFloat2("vClearCoatParams",this.qD,this.roughness);const B=1-this._indexOfRefraction,K=1+this._indexOfRefraction,r=Math.pow(-B/K,2),P=1/this._indexOfRefraction;u.updateFloat4("vClearCoatRefractionParams",r,P,B,K),this._isTintEnabled&&(u.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),u.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}R.texturesEnabled&&(this._texture&&V.b.ClearCoatTextureEnabled&&u.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&V.b.ClearCoatTextureEnabled&&u.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&I.getCaps().standardDerivatives&&V.b.ClearCoatBumpTextureEnabled&&!C&&u.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&V.b.ClearCoatTintTextureEnabled&&u.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(u){return this._texture===u||(this._textureRoughness===u||(this._bumpTexture===u||this._tintTexture===u))}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness),this._bumpTexture&&u.push(this._bumpTexture),this._tintTexture&&u.push(this._tintTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&u.push(this._tintTexture)}dispose(u){var R,I,B,U;u&&(null===(R=this._texture)||void 0===R||R.dispose(),null===(I=this._textureRoughness)||void 0===I||I.dispose(),null===(B=this._bumpTexture)||void 0===B||B.dispose(),null===(U=this._tintTexture)||void 0===U||U.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(u,R,I){return u.CLEARCOAT_BUMP&&R.addFallback(I++,"CLEARCOAT_BUMP"),u.CLEARCOAT_TINT&&R.addFallback(I++,"CLEARCOAT_TINT"),u.CLEARCOAT&&R.addFallback(I++,"CLEARCOAT"),I}getSamplers(u){u.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}M._DefaultIndexOfRefraction=1.5,(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,B.c)([(0,U.S)()],M.prototype,"intensity",void 0),(0,B.c)([(0,U.S)()],M.prototype,"roughness",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMainTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"textureRoughness",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"remapF0OnInterfaceChange",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTintEnabled",void 0),(0,B.c)([(0,U.p)()],M.prototype,"tintColor",void 0),(0,B.c)([(0,U.S)()],M.prototype,"tintColorAtDistance",void 0),(0,B.c)([(0,U.S)()],M.prototype,"tintThickness",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"tintTexture",void 0);class o extends S.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class j extends b.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRIridescence",110,new o,R),this._isEnabled=!1,this.isEnabled=!1,this.qD=1,this.minimumThickness=j._DefaultMinimumThickness,this.maximumThickness=j._DefaultMaximumThickness,this.indexOfRefraction=j._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,R){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&R.texturesEnabled){if(this._texture&&V.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&V.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,R){this._isEnabled?(u.IRIDESCENCE=!0,u._areTexturesDirty&&R.texturesEnabled&&(this._texture&&V.b.IridescenceTextureEnabled?(0,e.P)(this._texture,u,"IRIDESCENCE_TEXTURE"):u.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&V.b.IridescenceTextureEnabled?(0,e.P)(this._thicknessTexture,u,"IRIDESCENCE_THICKNESS_TEXTURE"):u.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(u.IRIDESCENCE=!1,u.IRIDESCENCE_TEXTURE=!1,u.IRIDESCENCE_THICKNESS_TEXTURE=!1,u.IRIDESCENCE_TEXTUREDIRECTUV=0,u.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(u,R){if(!this._isEnabled)return;const I=this._material.isFrozen;if(!u.useUbo||!I||!u.isSync){var B,U,K,C;if((this._texture||this._thicknessTexture)&&V.b.IridescenceTextureEnabled)u.updateFloat4("vIridescenceInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(U=this._texture)||void 0===U?void 0:U.level)??0,(null===(K=this._thicknessTexture)||void 0===K?void 0:K.coordinatesIndex)??0,(null===(C=this._thicknessTexture)||void 0===C?void 0:C.level)??0),this._texture&&(0,e.o)(this._texture,u,"iridescence"),this._thicknessTexture&&(0,e.o)(this._thicknessTexture,u,"iridescenceThickness");u.updateFloat4("vIridescenceParams",this.qD,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}R.texturesEnabled&&(this._texture&&V.b.IridescenceTextureEnabled&&u.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&V.b.IridescenceTextureEnabled&&u.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(u){return this._texture===u||this._thicknessTexture===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._thicknessTexture&&u.push(this._thicknessTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture)}dispose(u){var R,I;u&&(null===(R=this._texture)||void 0===R||R.dispose(),null===(I=this._thicknessTexture)||void 0===I||I.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(u,R,I){return u.IRIDESCENCE&&R.addFallback(I++,"IRIDESCENCE"),I}getSamplers(u){u.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}j._DefaultMinimumThickness=100,j._DefaultMaximumThickness=400,j._DefaultIndexOfRefraction=1.3,(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isEnabled",void 0),(0,B.c)([(0,U.S)()],j.prototype,"intensity",void 0),(0,B.c)([(0,U.S)()],j.prototype,"minimumThickness",void 0),(0,B.c)([(0,U.S)()],j.prototype,"maximumThickness",void 0),(0,B.c)([(0,U.S)()],j.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"texture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"thicknessTexture",void 0);class h extends S.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class x extends b.c{set angle(u){this.direction.x=Math.cos(u),this.direction.y=Math.sin(u)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRAnisotropic",110,new h,R),this._isEnabled=!1,this.isEnabled=!1,this.qD=1,this.direction=new t.Vector2(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16]}isReadyForSubMesh(u,R){return!this._isEnabled||!(u._areTexturesDirty&&R.texturesEnabled&&this._texture&&V.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(u,R,I){this._isEnabled?(u.ANISOTROPIC=this._isEnabled,this._isEnabled&&!I.isVerticesDataPresent(G.i.TangentKind)&&(u._needUVs=!0,u.MAINUV1=!0),u._areTexturesDirty&&R.texturesEnabled&&(this._texture&&V.b.AnisotropicTextureEnabled?(0,e.P)(this._texture,u,"ANISOTROPIC_TEXTURE"):u.ANISOTROPIC_TEXTURE=!1),u._areMiscDirty&&(u.ANISOTROPIC_LEGACY=this._legacy)):(u.ANISOTROPIC=!1,u.ANISOTROPIC_TEXTURE=!1,u.ANISOTROPIC_TEXTUREDIRECTUV=0,u.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(u,R){if(!this._isEnabled)return;const I=this._material.isFrozen;u.useUbo&&I&&u.isSync||(this._texture&&V.b.AnisotropicTextureEnabled&&(u.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,e.o)(this._texture,u,"anisotropy")),u.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.qD)),R.texturesEnabled&&this._texture&&V.b.AnisotropicTextureEnabled&&u.setTexture("anisotropySampler",this._texture)}hasTexture(u){return this._texture===u}getActiveTextures(u){this._texture&&u.push(this._texture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture)}dispose(u){u&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(u,R,I){return u.ANISOTROPIC&&R.addFallback(I++,"ANISOTROPIC"),I}getSamplers(u){u.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(u,R,I){super.parse(u,R,I),void 0===u.legacy&&(this.legacy=!0)}}(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0),(0,B.c)([(0,U.S)()],x.prototype,"intensity",void 0),(0,B.c)([(0,U.K)()],x.prototype,"direction",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"legacy",void 0);class g extends S.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class v extends b.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"Sheen",120,new g,R),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.qD=1,this.color=E.fR.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,R){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&R.texturesEnabled){if(this._texture&&V.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&V.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,R){this._isEnabled?(u.SHEEN=!0,u.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,u.SHEEN_ROUGHNESS=null!==this._roughness,u.SHEEN_ALBEDOSCALING=this._albedoScaling,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u._areTexturesDirty&&R.texturesEnabled&&(this._texture&&V.b.SheenTextureEnabled?((0,e.P)(this._texture,u,"SHEEN_TEXTURE"),u.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):u.SHEEN_TEXTURE=!1,this._textureRoughness&&V.b.SheenTextureEnabled?(0,e.P)(this._textureRoughness,u,"SHEEN_TEXTURE_ROUGHNESS"):u.SHEEN_TEXTURE_ROUGHNESS=!1)):(u.SHEEN=!1,u.SHEEN_TEXTURE=!1,u.SHEEN_TEXTURE_ROUGHNESS=!1,u.SHEEN_LINKWITHALBEDO=!1,u.SHEEN_ROUGHNESS=!1,u.SHEEN_ALBEDOSCALING=!1,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.SHEEN_GAMMATEXTURE=!1,u.SHEEN_TEXTUREDIRECTUV=0,u.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(u,R,I,B){if(!this._isEnabled)return;const U=B.materialDefines,K=this._material.isFrozen;if(!u.useUbo||!K||!u.isSync){var C,D,s,t;if((this._texture||this._textureRoughness)&&V.b.SheenTextureEnabled)u.updateFloat4("vSheenInfos",(null===(C=this._texture)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(D=this._texture)||void 0===D?void 0:D.level)??0,(null===(s=this._textureRoughness)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(t=this._textureRoughness)||void 0===t?void 0:t.level)??0),this._texture&&(0,e.o)(this._texture,u,"sheen"),this._textureRoughness&&!U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.o)(this._textureRoughness,u,"sheenRoughness");u.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.qD),null!==this._roughness&&u.updateFloat("vSheenRoughness",this._roughness)}R.texturesEnabled&&(this._texture&&V.b.SheenTextureEnabled&&u.setTexture("sheenSampler",this._texture),this._textureRoughness&&!U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&V.b.SheenTextureEnabled&&u.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(u){return this._texture===u||this._textureRoughness===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness)}dispose(u){var R,I;u&&(null===(R=this._texture)||void 0===R||R.dispose(),null===(I=this._textureRoughness)||void 0===I||I.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(u,R,I){return u.SHEEN&&R.addFallback(I++,"SHEEN"),I}getSamplers(u){u.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkSheenWithAlbedo",void 0),(0,B.c)([(0,U.S)()],v.prototype,"intensity",void 0),(0,B.c)([(0,U.p)()],v.prototype,"color",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoScaling",void 0);class p extends S.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class l extends b.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(u){this._scene.enableSubSurfaceForPrePass()&&u&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(u))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(u){this._volumeIndexOfRefraction=u>=1?u:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRSubSurface",130,new p,R),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=E.fR.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=E.fR.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=l.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=l.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=u.eu(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=u._dirtyCallbacks[32]}isReadyForSubMesh(u,R){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(u._areTexturesDirty&&R.texturesEnabled){if(this._thicknessTexture&&V.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&V.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&V.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const u=this._getRefractionTexture(R);if(u&&V.b.RefractionTextureEnabled&&!u.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,R){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return u.SUBSURFACE=!1,u.SS_DISPERSION=!1,u.SS_TRANSLUCENCY=!1,u.SS_SCATTERING=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,u.SS_HAS_THICKNESS=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,u.SS_REFRACTIONMAP_3D=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,u.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,u.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(u.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(u._areTexturesDirty){if(u.SUBSURFACE=!0,u.SS_DISPERSION=this._isDispersionEnabled,u.SS_TRANSLUCENCY=this._isTranslucencyEnabled,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,u.SS_SCATTERING=this._isScatteringEnabled,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_HAS_THICKNESS=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_REFRACTIONMAP_3D=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,u.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,u._areTexturesDirty&&R.texturesEnabled&&(this._thicknessTexture&&V.b.ThicknessTextureEnabled&&(0,e.P)(this._thicknessTexture,u,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&V.b.RefractionIntensityTextureEnabled&&(0,e.P)(this._refractionIntensityTexture,u,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&V.b.TranslucencyIntensityTextureEnabled&&(0,e.P)(this._translucencyIntensityTexture,u,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&V.b.TranslucencyColorTextureEnabled&&((0,e.P)(this._translucencyColorTexture,u,"SS_TRANSLUCENCYCOLOR_TEXTURE"),u.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),u.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,u.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&R.texturesEnabled){const I=this._getRefractionTexture(R);I&&V.b.RefractionTextureEnabled&&(u.SS_REFRACTION=!0,u.SS_REFRACTIONMAP_3D=I.isCube,u.SS_GAMMAREFRACTION=I.gammaSpace,u.SS_RGBDREFRACTION=I.isRGBD,u.SS_LINEARSPECULARREFRACTION=I.linearSpecularLOD,u.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&I.isCube?!I.invertZ:I.invertZ,u.SS_LODINREFRACTIONALPHA=I.lodLevelInAlpha,u.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,u.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=I.isCube&&I.boundingBoxSize,u.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(u.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(u,R,I,B){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)u.updateFloat2("vThicknessParam",0,0);else{B.getRenderingMesh().getWorldMatrix().decompose(t.TmpVectors.PR[0]);const R=Math.max(Math.abs(t.TmpVectors.PR[0].x),Math.abs(t.TmpVectors.PR[0].y),Math.abs(t.TmpVectors.PR[0].z));u.updateFloat2("vThicknessParam",this.minimumThickness*R,(this.maximumThickness-this.minimumThickness)*R)}}bindForSubMesh(u,R,I,B){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const U=B.materialDefines,K=this._material.isFrozen,C=this._material.realTimeFiltering,D=U.LODBASEDMICROSFURACE,s=this._getRefractionTexture(R);if(!u.useUbo||!K||!u.isSync){if(this._thicknessTexture&&V.b.ThicknessTextureEnabled&&(u.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,e.o)(this._thicknessTexture,u,"thickness")),this._refractionIntensityTexture&&V.b.RefractionIntensityTextureEnabled&&U.SS_REFRACTIONINTENSITY_TEXTURE&&(u.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,e.o)(this._refractionIntensityTexture,u,"refractionIntensity")),this._translucencyColorTexture&&V.b.TranslucencyColorTextureEnabled&&U.SS_TRANSLUCENCYCOLOR_TEXTURE&&(u.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,e.o)(this._translucencyColorTexture,u,"translucencyColor")),this._translucencyIntensityTexture&&V.b.TranslucencyIntensityTextureEnabled&&U.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(u.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,e.o)(this._translucencyIntensityTexture,u,"translucencyIntensity")),s&&V.b.RefractionTextureEnabled){u.SD("refractionMatrix",s.getRefractionTextureMatrix());let R=1;s.isCube||s.depth&&(R=s.depth);const I=s.getSize().width,B=this.volumeIndexOfRefraction;if(u.updateFloat4("vRefractionInfos",s.level,1/B,R,this._invertRefractionY?-1:1),u.updateFloat4("vRefractionMicrosurfaceInfos",I,s.lodGenerationScale,s.lodGenerationOffset,1/this.indexOfRefraction),C&&u.updateFloat2("vRefractionFilteringInfo",I,Math.log2(I)),s.boundingBoxSize){const R=s;u.updateVector3("vRefractionPosition",R.boundingBoxPosition),u.updateVector3("vRefractionSize",R.boundingBoxSize)}}this._isScatteringEnabled&&u.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),u.updateColor3("vDiffusionDistance",this.diffusionDistance),u.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),u.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),u.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),u.updateFloat("dispersion",this.dispersion)}R.texturesEnabled&&(this._thicknessTexture&&V.b.ThicknessTextureEnabled&&u.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&V.b.RefractionIntensityTextureEnabled&&U.SS_REFRACTIONINTENSITY_TEXTURE&&u.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&V.b.TranslucencyIntensityTextureEnabled&&U.SS_TRANSLUCENCYINTENSITY_TEXTURE&&u.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&V.b.TranslucencyColorTextureEnabled&&U.SS_TRANSLUCENCYCOLOR_TEXTURE&&u.setTexture("translucencyColorSampler",this._translucencyColorTexture),s&&V.b.RefractionTextureEnabled&&(D?u.setTexture("refractionSampler",s):(u.setTexture("refractionSampler",s._lodTextureMid||s),u.setTexture("refractionSamplerLow",s._lodTextureLow||s),u.setTexture("refractionSamplerHigh",s._lodTextureHigh||s))))}_getRefractionTexture(u){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?u.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(u){V.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&u.push(this._refractionTexture)}hasTexture(u){return this._thicknessTexture===u||(this._refractionTexture===u||(this._refractionIntensityTexture===u||(this._translucencyIntensityTexture===u||this._translucencyColorTexture===u)))}hasRenderTargetTextures(){return!!(V.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(u){this._thicknessTexture&&u.push(this._thicknessTexture),this._refractionTexture&&u.push(this._refractionTexture),this._translucencyColorTexture&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&u.push(this._translucencyIntensityTexture)}getAnimatables(u){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&u.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&u.push(this._translucencyIntensityTexture)}dispose(u){u&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(u,R,I){return u.SS_SCATTERING&&R.addFallback(I++,"SS_SCATTERING"),u.SS_TRANSLUCENCY&&R.addFallback(I++,"SS_TRANSLUCENCY"),I}getSamplers(u){u.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}l.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,l.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isRefractionEnabled",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isTranslucencyEnabled",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isDispersionEnabled",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markScenePrePassDirty")],l.prototype,"isScatteringEnabled",void 0),(0,B.c)([(0,U.S)()],l.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,B.c)([(0,U.S)()],l.prototype,"refractionIntensity",void 0),(0,B.c)([(0,U.S)()],l.prototype,"translucencyIntensity",void 0),(0,B.c)([(0,U.S)()],l.prototype,"useAlbedoToTintRefraction",void 0),(0,B.c)([(0,U.S)()],l.prototype,"useAlbedoToTintTranslucency",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"thicknessTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,U.S)()],l.prototype,"_volumeIndexOfRefraction",void 0),(0,B.c)([(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"volumeIndexOfRefraction",null),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"invertRefractionY",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkRefractionWithTransparency",void 0),(0,B.c)([(0,U.S)()],l.prototype,"minimumThickness",void 0),(0,B.c)([(0,U.S)()],l.prototype,"maximumThickness",void 0),(0,B.c)([(0,U.S)()],l.prototype,"useThicknessAsDepth",void 0),(0,B.c)([(0,U.p)()],l.prototype,"tintColor",void 0),(0,B.c)([(0,U.S)()],l.prototype,"tintColorAtDistance",void 0),(0,B.c)([(0,U.S)()],l.prototype,"dispersion",void 0),(0,B.c)([(0,U.p)()],l.prototype,"diffusionDistance",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useMaskFromThicknessTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionIntensityTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyIntensityTexture",void 0),(0,B.c)([(0,U.p)()],l.prototype,"translucencyColor",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyColorTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useGltfStyleTextures",void 0),(0,B.c)([(0,U.S)()],l.prototype,"applyAlbedoAfterSubSurface",void 0),(0,B.c)([(0,U.S)()],l.prototype,"legacyTransluceny",void 0);var Z=I(12861),c=I(12840),k=I(12872);const w={effect:null,subMesh:null};class i extends S.d{constructor(u){super(u),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class W extends T.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(u){this._realTimeFiltering=u,this.Ot(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(u){this._realTimeFilteringQuality=u,this.Ot(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=u||this.eu().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(u,R){super(u,R,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||W.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new t.Vector4(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=W.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=E.fR.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new E.fR(0,0,0),this._albedoColor=new E.fR(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new E.fR(1,1,1),this._reflectionColor=new E.fR(1,1,1),this._emissiveColor=new E.fR(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=W.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new C.f(16),this._globalAmbientColor=new E.fR(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new P(this),this.clearCoat=new M(this),this.iridescence=new j(this),this.anisotropy=new x(this),this.sheen=new v(this),this.subSurface=new l(this),this.detailMap=new Z.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),V.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,D.c)(this.eu()),this.prePassConfiguration=new X.d}get hasRenderTargetTextures(){return!!(V.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var u;return this._transparencyMode===W.PBRMATERIAL_OPAQUE||this._transparencyMode===W.PBRMATERIAL_ALPHATEST||(null===(u=this.subSurface)||void 0===u?void 0:u.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var u;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(u=this.subSurface)||void 0===u||!u.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===W.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.tD&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==W.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.tD||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(u,R,I){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const B=R._drawWrapper;if(B.effect&&this.isFrozen&&B._wasPreviouslyReady&&B._wasPreviouslyUsingInstances===I)return!0;R.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),R.materialDefines=new i(this._eventInfo.defineNames));const U=R.materialDefines;if(this._isReadyForSubMesh(R))return!0;const C=this.eu(),D=C.getEngine();if(U._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,C.texturesEnabled)){if(this._albedoTexture&&V.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&V.b.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&V.b.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&V.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&V.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const u=this._getReflectionTexture();if(u&&V.b.ReflectionTextureEnabled){if(!u.isReadyOrNotBlocking())return!1;var s;if(u.irradianceTexture){if(!u.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!u.sphericalPolynomial&&null!==(s=u.getInternalTexture())&&void 0!==s&&s._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&V.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&V.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(V.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(D.getCaps().standardDerivatives&&this._bumpTexture&&V.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&V.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=U,this._eventInfo.subMesh=R,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(U._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(U.AREALIGHTUSED)for(let K=0;K<u.lightSources.length;K++)if(!u.lightSources[K]._isReady())return!1;D.getCaps().standardDerivatives||u.isVerticesDataPresent(G.i.NormalKind)||(u.createNormals(!0),K.b.Warn("PBRMaterial: Normals have been created for the mesh: "+u.name));const t=R.effect,S=U._areLightsDisposed;let b=this._prepareEffect(u,U,this.onCompiled,this.onError,I,null,R.getRenderingMesh().hasThinInstances),r=!1;if(b)if(this._onEffectCreatedObservable&&(w.effect=b,w.subMesh=R,this._onEffectCreatedObservable.notifyObservers(w)),this.allowShaderHotSwapping&&t&&!b.isReady()){if(b=t,U.markAsUnprocessed(),r=this.isFrozen,S)return U._areLightsDisposed=!0,!1}else C.resetCachedMaterial(),R.setEffect(b,U,this._materialContext);return!(!R.effect||!R.effect.isReady())&&(U._renderId=C.getRenderId(),B._wasPreviouslyReady=!r,B._wasPreviouslyUsingInstances=!!I,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(u,R){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(u,R,K,C,D),!R.isDirty)return null;R.markAsProcessed();const s=this.eu().getEngine(),t=new q.e;let S=0;R.USESPHERICALINVERTEX&&t.addFallback(S++,"USESPHERICALINVERTEX"),R.FOG&&t.addFallback(S,"FOG"),R.SPECULARAA&&t.addFallback(S,"SPECULARAA"),R.POINTSIZE&&t.addFallback(S,"POINTSIZE"),R.LOGARITHMICDEPTH&&t.addFallback(S,"LOGARITHMICDEPTH"),R.PARALLAX&&t.addFallback(S,"PARALLAX"),R.PARALLAX_RHS&&t.addFallback(S,"PARALLAX_RHS"),R.PARALLAXOCCLUSION&&t.addFallback(S++,"PARALLAXOCCLUSION"),R.ENVIRONMENTBRDF&&t.addFallback(S++,"ENVIRONMENTBRDF"),R.TANGENT&&t.addFallback(S++,"TANGENT"),R.BUMP&&t.addFallback(S++,"BUMP"),S=(0,e.q)(R,t,this._maxSimultaneousLights,S++),R.SPECULARTERM&&t.addFallback(S++,"SPECULARTERM"),R.USESPHERICALFROMREFLECTIONMAP&&t.addFallback(S++,"USESPHERICALFROMREFLECTIONMAP"),R.USEIRRADIANCEMAP&&t.addFallback(S++,"USEIRRADIANCEMAP"),R.LIGHTMAP&&t.addFallback(S++,"LIGHTMAP"),R.NORMAL&&t.addFallback(S++,"NORMAL"),R.AMBIENT&&t.addFallback(S++,"AMBIENT"),R.EMISSIVE&&t.addFallback(S++,"EMISSIVE"),R.VERTEXCOLOR&&t.addFallback(S++,"VERTEXCOLOR"),R.MORPHTARGETS&&t.addFallback(S++,"MORPHTARGETS"),R.MULTIVIEW&&t.addFallback(0,"MULTIVIEW");const b=[G.i.PositionKind];R.NORMAL&&b.push(G.i.NormalKind),R.TANGENT&&b.push(G.i.TangentKind);for(let I=1;I<=6;++I)R["UV"+I]&&b.push(`uv${1===I?"":I}`);R.VERTEXCOLOR&&b.push(G.i.ColorKind),(0,e.s)(b,u,R,t),(0,e.w)(b,R),(0,e.y)(b,u,R),(0,e.r)(b,u,R);let r="pbr";const P=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],E=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],f=["Material","Scene","Mesh"],T={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:R.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=t,this._eventInfo.fallbackRank=S,this._eventInfo.defines=R,this._eventInfo.uniforms=P,this._eventInfo.attributes=b,this._eventInfo.samplers=E,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=u,this._eventInfo.indexParameters=T,this._callbackPluginEventGeneric(128,this._eventInfo),k.b.AddUniformsAndSamplers(P,E),X.d.AddUniforms(P),X.d.AddSamplers(E),(0,c.e)(P),z.e&&(z.e.PrepareUniforms(P,R),z.e.PrepareSamplers(E,R)),(0,e.ab)({uniformsNames:P,uniformBuffersNames:f,samplers:E,defines:R,maxSimultaneousLights:this._maxSimultaneousLights});const Q={};this.customShaderNameResolve&&(r=this.customShaderNameResolve(r,P,f,E,R,b,Q));const V=R.toString(),Y=s.createEffect(r,{attributes:b,uniformsNames:P,uniformBuffersNames:f,samplers:E,defines:V,fallbacks:t,onCompiled:B,onError:U,indexParameters:T,processFinalCode:Q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:R.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([I.e(41),I.e(71)]).then(I.bind(I,15512)),Promise.all([I.e(39),I.e(72)]).then(I.bind(I,15538))]):await Promise.all([Promise.all([I.e(34),I.e(73)]).then(I.bind(I,15547)),Promise.all([I.e(33),I.e(74)]).then(I.bind(I,15575))]),this._shadersLoaded=!0}},s);return this._eventInfo.customCode=void 0,Y}_prepareDefines(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const K=this.eu(),C=K.getEngine();(0,e.M)(K,u,R,!0,this._maxSimultaneousLights,this._disableLighting),R._needNormals=!0,(0,e.S)(K,R);const D=this.needAlphaBlendingForMesh(u)&&this.eu().useOrderIndependentTransparency;if((0,e.Z)(K,R,this.canRenderToMRT&&!D),(0,e.W)(K,R,D),k.b.PrepareDefines(C.currentRenderPassId,u,R),R.METALLICWORKFLOW=this.isMetallicWorkflow(),R._areTexturesDirty){R._needUVs=!1;for(let u=1;u<=6;++u)R["MAINUV"+u]=!1;if(K.texturesEnabled){R.ALBEDODIRECTUV=0,R.BASE_WEIGHTDIRECTUV=0,R.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,R.AMBIENTDIRECTUV=0,R.OPACITYDIRECTUV=0,R.EMISSIVEDIRECTUV=0,R.REFLECTIVITYDIRECTUV=0,R.MICROSURFACEMAPDIRECTUV=0,R.METALLIC_REFLECTANCEDIRECTUV=0,R.REFLECTANCEDIRECTUV=0,R.BUMPDIRECTUV=0,R.LIGHTMAPDIRECTUV=0,C.getCaps().textureLOD&&(R.LODBASEDMICROSFURACE=!0),this._albedoTexture&&V.b.DiffuseTextureEnabled?((0,e.P)(this._albedoTexture,R,"ALBEDO"),R.GAMMAALBEDO=this._albedoTexture.gammaSpace):R.ALBEDO=!1,this._baseWeightTexture&&V.b.BaseWeightTextureEnabled?(0,e.P)(this._baseWeightTexture,R,"BASE_WEIGHT"):R.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&V.b.BaseDiffuseRoughnessTextureEnabled?(0,e.P)(this._baseDiffuseRoughnessTexture,R,"BASE_DIFFUSE_ROUGHNESS"):R.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&V.b.AmbientTextureEnabled?((0,e.P)(this._ambientTexture,R,"AMBIENT"),R.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):R.AMBIENT=!1,this._opacityTexture&&V.b.OpacityTextureEnabled?((0,e.P)(this._opacityTexture,R,"OPACITY"),R.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):R.OPACITY=!1;const u=this._getReflectionTexture();if(u&&V.b.ReflectionTextureEnabled){switch(R.REFLECTION=!0,R.GAMMAREFLECTION=u.gammaSpace,R.RGBDREFLECTION=u.isRGBD,R.LODINREFLECTIONALPHA=u.lodLevelInAlpha,R.LINEARSPECULARREFLECTION=u.linearSpecularLOD,R.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(R.NUM_SAMPLES=""+this.realTimeFilteringQuality,C._features.needTypeSuffixInShaderConstants&&(R.NUM_SAMPLES=R.NUM_SAMPLES+"u"),R.REALTIME_FILTERING=!0,this.eu().iblCdfGenerator&&(R.IBL_CDF_FILTERING=!0)):R.REALTIME_FILTERING=!1,R.INVERTCUBICMAP=u.coordinatesMode===Q.b.INVCUBIC_MODE,R.REFLECTIONMAP_3D=u.isCube,R.REFLECTIONMAP_OPPOSITEZ=R.REFLECTIONMAP_3D&&this.eu().useRightHandedSystem?!u.invertZ:u.invertZ,R.REFLECTIONMAP_CUBIC=!1,R.REFLECTIONMAP_EXPLICIT=!1,R.REFLECTIONMAP_PLANAR=!1,R.REFLECTIONMAP_PROJECTION=!1,R.REFLECTIONMAP_SKYBOX=!1,R.REFLECTIONMAP_SPHERICAL=!1,R.REFLECTIONMAP_EQUIRECTANGULAR=!1,R.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,R.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,u.coordinatesMode){case Q.b.EXPLICIT_MODE:R.REFLECTIONMAP_EXPLICIT=!0;break;case Q.b.PLANAR_MODE:R.REFLECTIONMAP_PLANAR=!0;break;case Q.b.PROJECTION_MODE:R.REFLECTIONMAP_PROJECTION=!0;break;case Q.b.SKYBOX_MODE:R.REFLECTIONMAP_SKYBOX=!0;break;case Q.b.SPHERICAL_MODE:R.REFLECTIONMAP_SPHERICAL=!0;break;case Q.b.EQUIRECTANGULAR_MODE:R.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Q.b.FIXED_EQUIRECTANGULAR_MODE:R.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Q.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:R.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Q.b.CUBIC_MODE:case Q.b.INVCUBIC_MODE:default:R.REFLECTIONMAP_CUBIC=!0,R.USE_LOCAL_REFLECTIONMAP_CUBIC=!!u.boundingBoxSize}u.coordinatesMode!==Q.b.SKYBOX_MODE&&(u.irradianceTexture?(R.USEIRRADIANCEMAP=!0,R.USESPHERICALFROMREFLECTIONMAP=!1,R.USESPHERICALINVERTEX=!1,u.irradianceTexture._dominantDirection&&(R.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):u.isCube&&(R.USESPHERICALFROMREFLECTIONMAP=!0,R.USEIRRADIANCEMAP=!1,R.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||C.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?R.USESPHERICALINVERTEX=!1:R.USESPHERICALINVERTEX=!0))}else R.REFLECTION=!1,R.REFLECTIONMAP_3D=!1,R.REFLECTIONMAP_SPHERICAL=!1,R.REFLECTIONMAP_PLANAR=!1,R.REFLECTIONMAP_CUBIC=!1,R.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,R.REFLECTIONMAP_PROJECTION=!1,R.REFLECTIONMAP_SKYBOX=!1,R.REFLECTIONMAP_EXPLICIT=!1,R.REFLECTIONMAP_EQUIRECTANGULAR=!1,R.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,R.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,R.INVERTCUBICMAP=!1,R.USESPHERICALFROMREFLECTIONMAP=!1,R.USEIRRADIANCEMAP=!1,R.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,R.USESPHERICALINVERTEX=!1,R.REFLECTIONMAP_OPPOSITEZ=!1,R.LODINREFLECTIONALPHA=!1,R.GAMMAREFLECTION=!1,R.RGBDREFLECTION=!1,R.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&V.b.LightmapTextureEnabled?((0,e.P)(this._lightmapTexture,R,"LIGHTMAP"),R.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,R.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,R.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):R.LIGHTMAP=!1,this._emissiveTexture&&V.b.EmissiveTextureEnabled?((0,e.P)(this._emissiveTexture,R,"EMISSIVE"),R.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):R.EMISSIVE=!1,V.b.SpecularTextureEnabled?(this._metallicTexture?((0,e.P)(this._metallicTexture,R,"REFLECTIVITY"),R.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,R.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,R.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,R.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,R.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,e.P)(this._reflectivityTexture,R,"REFLECTIVITY"),R.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,R.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,R.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):R.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(R.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,e.P)(this._metallicReflectanceTexture,R,"METALLIC_REFLECTANCE"),R.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):R.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,e.P)(this._reflectanceTexture,R,"REFLECTANCE"),R.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):R.REFLECTANCE=!1):(R.METALLIC_REFLECTANCE=!1,R.REFLECTANCE=!1),this._microSurfaceTexture?(0,e.P)(this._microSurfaceTexture,R,"MICROSURFACEMAP"):R.MICROSURFACEMAP=!1):(R.REFLECTIVITY=!1,R.MICROSURFACEMAP=!1),C.getCaps().standardDerivatives&&this._bumpTexture&&V.b.BumpTextureEnabled&&!this._disableBumpMap?((0,e.P)(this._bumpTexture,R,"BUMP"),this._useParallax&&this._albedoTexture&&V.b.DiffuseTextureEnabled?(R.PARALLAX=!0,R.PARALLAX_RHS=K.useRightHandedSystem,R.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):R.PARALLAX=!1,R.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(R.BUMP=!1,R.PARALLAX=!1,R.PARALLAX_RHS=!1,R.PARALLAXOCCLUSION=!1,R.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&V.b.ReflectionTextureEnabled?(R.ENVIRONMENTBRDF=!0,R.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(R.ENVIRONMENTBRDF=!1,R.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?R.ALPHAFROMALBEDO=!0:R.ALPHAFROMALBEDO=!1}R.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===W.LIGHTFALLOFF_STANDARD?(R.USEPHYSICALLIGHTFALLOFF=!1,R.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===W.LIGHTFALLOFF_GLTF?(R.USEPHYSICALLIGHTFALLOFF=!1,R.USEGLTFLIGHTFALLOFF=!0):(R.USEPHYSICALLIGHTFALLOFF=!0,R.USEGLTFLIGHTFALLOFF=!1),R.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.XD&&this._twoSidedLighting?R.TWOSIDEDLIGHTING=!0:R.TWOSIDEDLIGHTING=!1,R.MIRRORED=!!K._mirroredCameraPosition,R.SPECULARAA=C.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(R._areTexturesDirty||R._areMiscDirty)&&(R.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,R.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,R.ALPHABLEND=this.needAlphaBlendingForMesh(u),R.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,R.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),R._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(R),R.FORCENORMALFORWARD=this._forceNormalForward,R.RADIANCEOCCLUSION=this._useRadianceOcclusion,R.HORIZONOCCLUSION=this._useHorizonOcclusion,R._areMiscDirty&&((0,e.Q)(u,K,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(u),R,this._applyDecalMapAfterDetailMap),R.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!u.isVerticesDataPresent(G.i.NormalKind),R.DEBUGMODE=this._debugMode),(0,e.I)(K,C,this,R,!!I,B,U),this._eventInfo.defines=R,this._eventInfo.mesh=u,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,e.G)(u,R,!0,!0,!0,this._transparencyMode!==W.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(u,R,I){const B={clipPlane:!1,useInstances:!1,...I};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const I=new i(this._eventInfo.defineNames),U=this._prepareEffect(u,I,void 0,void 0,B.useInstances,B.clipPlane,u.hasThinInstances);this._onEffectCreatedObservable&&(w.effect=U,w.subMesh=null,this._onEffectCreatedObservable.notifyObservers(w)),U.isReady()?R&&R(this):U.onCompileObservable.add((()=>{R&&R(this)}))})()}buildUniformLayout(){const u=this._uniformBuffer;u.addUniform("vAlbedoInfos",2),u.addUniform("vBaseWeightInfos",2),u.addUniform("vBaseDiffuseRoughnessInfos",2),u.addUniform("vAmbientInfos",4),u.addUniform("vOpacityInfos",2),u.addUniform("vEmissiveInfos",2),u.addUniform("vLightmapInfos",2),u.addUniform("vReflectivityInfos",3),u.addUniform("vMicroSurfaceSamplerInfos",2),u.addUniform("vReflectionInfos",2),u.addUniform("vReflectionFilteringInfo",2),u.addUniform("vReflectionPosition",3),u.addUniform("vReflectionSize",3),u.addUniform("vBumpInfos",3),u.addUniform("albedoMatrix",16),u.addUniform("baseWeightMatrix",16),u.addUniform("baseDiffuseRoughnessMatrix",16),u.addUniform("ambientMatrix",16),u.addUniform("opacityMatrix",16),u.addUniform("emissiveMatrix",16),u.addUniform("lightmapMatrix",16),u.addUniform("reflectivityMatrix",16),u.addUniform("microSurfaceSamplerMatrix",16),u.addUniform("bumpMatrix",16),u.addUniform("vTangentSpaceParams",2),u.addUniform("reflectionMatrix",16),u.addUniform("vReflectionColor",3),u.addUniform("vAlbedoColor",4),u.addUniform("baseWeight",1),u.addUniform("baseDiffuseRoughness",1),u.addUniform("vLightingIntensity",4),u.addUniform("vReflectionMicrosurfaceInfos",3),u.addUniform("vReflectionDominantDirection",3),u.addUniform("pointSize",1),u.addUniform("vReflectivityColor",4),u.addUniform("vEmissiveColor",3),u.addUniform("vAmbientColor",3),u.addUniform("vDebugMode",2),u.addUniform("vMetallicReflectanceFactors",4),u.addUniform("vMetallicReflectanceInfos",2),u.addUniform("metallicReflectanceMatrix",16),u.addUniform("vReflectanceInfos",2),u.addUniform("reflectanceMatrix",16),u.addUniform("vSphericalL00",3),u.addUniform("vSphericalL1_1",3),u.addUniform("vSphericalL10",3),u.addUniform("vSphericalL11",3),u.addUniform("vSphericalL2_2",3),u.addUniform("vSphericalL2_1",3),u.addUniform("vSphericalL20",3),u.addUniform("vSphericalL21",3),u.addUniform("vSphericalL22",3),u.addUniform("vSphericalX",3),u.addUniform("vSphericalY",3),u.addUniform("vSphericalZ",3),u.addUniform("vSphericalXX_ZZ",3),u.addUniform("vSphericalYY_ZZ",3),u.addUniform("vSphericalZZ",3),u.addUniform("vSphericalXY",3),u.addUniform("vSphericalYZ",3),u.addUniform("vSphericalZX",3),u.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(u,R,I){const B=this.eu(),U=I.materialDefines;if(!U)return;const K=I.effect;if(!K)return;this._activeEffect=K,R.getMeshUniformBuffer().bindToEffect(K,"Mesh"),R.transferToEffect(u);const C=B.getEngine();this._uniformBuffer.bindToEffect(K,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,B,R,u,this.isFrozen),k.b.Bind(C.currentRenderPassId,this._activeEffect,R,u,this);const D=B.activeCamera;D?this._uniformBuffer.updateFloat4("cameraInfo",D.GD,D.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=I,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),U.OBJECTSPACE_NORMALMAP&&(u.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const t=this._mustRebind(B,K,I,R.visibility);(0,e.b)(R,this._activeEffect,this.prePassConfiguration);let G=null;const S=this._uniformBuffer;if(t){if(this.bindViewProjection(K),G=this._getReflectionTexture(),!S.useUbo||!this.isFrozen||!S.isSync||I._drawWrapper._forceRebindOnNextCall){var b;if(B.texturesEnabled){if(this._albedoTexture&&V.b.DiffuseTextureEnabled&&(S.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,e.o)(this._albedoTexture,S,"albedo")),this._baseWeightTexture&&V.b.BaseWeightTextureEnabled&&(S.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,e.o)(this._baseWeightTexture,S,"baseWeight")),this._baseDiffuseRoughnessTexture&&V.b.BaseDiffuseRoughnessTextureEnabled&&(S.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,e.o)(this._baseDiffuseRoughnessTexture,S,"baseDiffuseRoughness")),this._ambientTexture&&V.b.AmbientTextureEnabled&&(S.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,e.o)(this._ambientTexture,S,"ambient")),this._opacityTexture&&V.b.OpacityTextureEnabled&&(S.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,e.o)(this._opacityTexture,S,"opacity")),G&&V.b.ReflectionTextureEnabled){if(S.SD("reflectionMatrix",G.getReflectionTextureMatrix()),S.updateFloat2("vReflectionInfos",G.level*B.iblIntensity,0),G.boundingBoxSize){const u=G;S.updateVector3("vReflectionPosition",u.boundingBoxPosition),S.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this.realTimeFiltering){const u=G.getSize().width;S.updateFloat2("vReflectionFilteringInfo",u,Math.log2(u))}if(U.USEIRRADIANCEMAP)U.USEIRRADIANCEMAP&&U.USE_IRRADIANCE_DOMINANT_DIRECTION&&S.updateVector3("vReflectionDominantDirection",G.irradianceTexture._dominantDirection);else{const u=G.sphericalPolynomial;if(U.USESPHERICALFROMREFLECTIONMAP&&u)if(U.SPHERICAL_HARMONICS){const R=u.preScaledHarmonics;S.updateVector3("vSphericalL00",R.l00),S.updateVector3("vSphericalL1_1",R.l1_1),S.updateVector3("vSphericalL10",R.l10),S.updateVector3("vSphericalL11",R.l11),S.updateVector3("vSphericalL2_2",R.l2_2),S.updateVector3("vSphericalL2_1",R.l2_1),S.updateVector3("vSphericalL20",R.l20),S.updateVector3("vSphericalL21",R.l21),S.updateVector3("vSphericalL22",R.l22)}else S.updateFloat3("vSphericalX",u.x.x,u.x.y,u.x.z),S.updateFloat3("vSphericalY",u.y.x,u.y.y,u.y.z),S.updateFloat3("vSphericalZ",u.z.x,u.z.y,u.z.z),S.updateFloat3("vSphericalXX_ZZ",u.xx.x-u.zz.x,u.xx.y-u.zz.y,u.xx.z-u.zz.z),S.updateFloat3("vSphericalYY_ZZ",u.yy.x-u.zz.x,u.yy.y-u.zz.y,u.yy.z-u.zz.z),S.updateFloat3("vSphericalZZ",u.zz.x,u.zz.y,u.zz.z),S.updateFloat3("vSphericalXY",u.xy.x,u.xy.y,u.xy.z),S.updateFloat3("vSphericalYZ",u.yz.x,u.yz.y,u.yz.z),S.updateFloat3("vSphericalZX",u.zx.x,u.zx.y,u.zx.z)}S.updateFloat3("vReflectionMicrosurfaceInfos",G.getSize().width,G.lodGenerationScale,G.lodGenerationOffset)}this._emissiveTexture&&V.b.EmissiveTextureEnabled&&(S.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,e.o)(this._emissiveTexture,S,"emissive")),this._lightmapTexture&&V.b.LightmapTextureEnabled&&(S.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,e.o)(this._lightmapTexture,S,"lightmap")),V.b.SpecularTextureEnabled&&(this._metallicTexture?(S.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,e.o)(this._metallicTexture,S,"reflectivity")):this._reflectivityTexture&&(S.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,e.o)(this._reflectivityTexture,S,"reflectivity")),this._metallicReflectanceTexture&&(S.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,e.o)(this._metallicReflectanceTexture,S,"metallicReflectance")),this._reflectanceTexture&&U.REFLECTANCE&&(S.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,e.o)(this._reflectanceTexture,S,"reflectance")),this._microSurfaceTexture&&(S.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,e.o)(this._microSurfaceTexture,S,"microSurfaceSampler"))),this._bumpTexture&&C.getCaps().standardDerivatives&&V.b.BumpTextureEnabled&&!this._disableBumpMap&&(S.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,e.o)(this._bumpTexture,S,"bump"),B._mirroredCameraPosition?S.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):S.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&S.updateFloat("pointSize",this.pointSize),U.METALLICWORKFLOW){var r;E.TmpColors.TD[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,E.TmpColors.TD[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const u=(null===(r=this.subSurface)||void 0===r?void 0:r._indexOfRefraction)??1.5,R=1;E.TmpColors.TD[0].b=u;const I=Math.pow((u-R)/(u+R),2);E.TmpColors.TD[0].a=I,S.updateDirectColor4("vReflectivityColor",E.TmpColors.TD[0]),S.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else S.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);S.updateColor3("vEmissiveColor",V.b.EmissiveTextureEnabled?this._emissiveColor:E.fR.BlackReadOnly),S.updateColor3("vReflectionColor",this._reflectionColor),!U.SS_REFRACTION&&null!==(b=this.subSurface)&&void 0!==b&&b._linkRefractionWithTransparency?S.updateColor4("vAlbedoColor",this._albedoColor,1):S.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),S.updateFloat("baseWeight",this._baseWeight),S.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*B.environmentIntensity,this._lightingInfos.w=this._specularIntensity,S.updateVector4("vLightingIntensity",this._lightingInfos),B.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),S.updateColor3("vAmbientColor",this._globalAmbientColor),S.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(B.texturesEnabled){if(this._albedoTexture&&V.b.DiffuseTextureEnabled&&S.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&V.b.BaseWeightTextureEnabled&&S.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&V.b.BaseDiffuseRoughnessTextureEnabled&&S.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&V.b.AmbientTextureEnabled&&S.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&V.b.OpacityTextureEnabled&&S.setTexture("opacitySampler",this._opacityTexture),G&&V.b.ReflectionTextureEnabled){U.LODBASEDMICROSFURACE?S.setTexture("reflectionSampler",G):(S.setTexture("reflectionSampler",G._lodTextureMid||G),S.setTexture("reflectionSamplerLow",G._lodTextureLow||G),S.setTexture("reflectionSamplerHigh",G._lodTextureHigh||G)),U.USEIRRADIANCEMAP&&S.setTexture("irradianceSampler",G.irradianceTexture);const u=this.eu().iblCdfGenerator;this.realTimeFiltering&&u&&S.setTexture("icdfSampler",u.getIcdfTexture())}U.ENVIRONMENTBRDF&&S.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&V.b.EmissiveTextureEnabled&&S.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&V.b.LightmapTextureEnabled&&S.setTexture("lightmapSampler",this._lightmapTexture),V.b.SpecularTextureEnabled&&(this._metallicTexture?S.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&S.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&S.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&U.REFLECTANCE&&S.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&S.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&C.getCaps().standardDerivatives&&V.b.BumpTextureEnabled&&!this._disableBumpMap&&S.setTexture("bumpSampler",this._bumpTexture)}this.eu().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(R)&&this.eu().depthPeelingRenderer.bind(K),this._eventInfo.subMesh=I,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,c.g)(this._activeEffect,this,B),this.bindEyePosition(K)}else B.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(t||!this.isFrozen){var P;if(B.lightsEnabled&&!this._disableLighting&&(0,e.f)(B,R,this._activeEffect,U,this._maxSimultaneousLights),(B.fogEnabled&&R.applyFog&&B.fogMode!==s.c.FOGMODE_NONE||G||this.subSurface.refractionTexture||R.receiveShadows||U.PREPASS)&&this.bindView(K),(0,e.d)(B,R,this._activeEffect,!0),U.NUM_MORPH_INFLUENCERS&&(0,e.l)(R,this._activeEffect),U.BAKED_VERTEX_ANIMATION_TEXTURE)null===(P=R.bakedVertexAnimationManager)||void 0===P||P.bind(K,U.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,e.j)(U,this._activeEffect,B)}this._afterBind(R,this._activeEffect,I),S.update()}getAnimatables(){const u=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&u.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&u.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&u.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&u.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&u.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&u.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&u.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?u.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&u.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&u.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&u.push(this._microSurfaceTexture),u}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.eu().environmentTexture}getActiveTextures(){const u=super.getActiveTextures();return this._albedoTexture&&u.push(this._albedoTexture),this._baseWeightTexture&&u.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&u.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&u.push(this._ambientTexture),this._opacityTexture&&u.push(this._opacityTexture),this._reflectionTexture&&u.push(this._reflectionTexture),this._emissiveTexture&&u.push(this._emissiveTexture),this._reflectivityTexture&&u.push(this._reflectivityTexture),this._metallicTexture&&u.push(this._metallicTexture),this._metallicReflectanceTexture&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&u.push(this._microSurfaceTexture),this._bumpTexture&&u.push(this._bumpTexture),this._lightmapTexture&&u.push(this._lightmapTexture),u}hasTexture(u){return!!super.hasTexture(u)||(this._albedoTexture===u||(this._baseWeightTexture===u||(this._baseDiffuseRoughnessTexture===u||(this._ambientTexture===u||(this._opacityTexture===u||(this._reflectionTexture===u||(this._emissiveTexture===u||(this._reflectivityTexture===u||(this._metallicTexture===u||(this._metallicReflectanceTexture===u||(this._reflectanceTexture===u||(this._microSurfaceTexture===u||(this._bumpTexture===u||this._lightmapTexture===u)))))))))))))}setPrePassRenderer(){var u;if(null===(u=this.subSurface)||void 0===u||!u.isScatteringEnabled)return!1;const R=this.eu().enableSubSurfaceForPrePass();return R&&(R.enabled=!0),!0}dispose(u,R){var I,B,U,K,C,D,s,t,G,S,b,r,P,X;(this._breakShaderLoadedCheck=!0,R)&&(this._environmentBRDFTexture&&this.eu().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(I=this._albedoTexture)||void 0===I||I.dispose(),null===(B=this._baseWeightTexture)||void 0===B||B.dispose(),null===(U=this._baseDiffuseRoughnessTexture)||void 0===U||U.dispose(),null===(K=this._ambientTexture)||void 0===K||K.dispose(),null===(C=this._opacityTexture)||void 0===C||C.dispose(),null===(D=this._reflectionTexture)||void 0===D||D.dispose(),null===(s=this._emissiveTexture)||void 0===s||s.dispose(),null===(t=this._metallicTexture)||void 0===t||t.dispose(),null===(G=this._reflectivityTexture)||void 0===G||G.dispose(),null===(S=this._bumpTexture)||void 0===S||S.dispose(),null===(b=this._lightmapTexture)||void 0===b||b.dispose(),null===(r=this._metallicReflectanceTexture)||void 0===r||r.dispose(),null===(P=this._reflectanceTexture)||void 0===P||P.dispose(),null===(X=this._microSurfaceTexture)||void 0===X||X.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(u,R)}}W.PBRMATERIAL_OPAQUE=f.c.MATERIAL_OPAQUE,W.PBRMATERIAL_ALPHATEST=f.c.MATERIAL_ALPHATEST,W.PBRMATERIAL_ALPHABLEND=f.c.MATERIAL_ALPHABLEND,W.PBRMATERIAL_ALPHATESTANDBLEND=f.c.MATERIAL_ALPHATESTANDBLEND,W.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,W.LIGHTFALLOFF_PHYSICAL=0,W.LIGHTFALLOFF_GLTF=1,W.LIGHTFALLOFF_STANDARD=2,W.ForceGLSL=!1,(0,B.c)([(0,U.y)()],W.prototype,"_imageProcessingConfiguration",void 0),(0,B.c)([(0,U.e)("_markAllSubMeshesAsMiscDirty")],W.prototype,"debugMode",void 0)},12952:(u,R,I)=>{I.d(R,{c:()=>S});var B=I(12466),U=I(12472),K=I(12957),C=I(12518),D=I(12969),s=I(12433),t=I(12796),G=I(12507);class S extends D.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(u){this.subSurface.refractionTexture=u,u?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(u){this.subSurface.indexOfRefraction=u}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(u){this.subSurface.invertRefractionY=u}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(u){this.subSurface.linkRefractionWithTransparency=u,u&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===D.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(u){u!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=u?D.e.LIGHTFALLOFF_PHYSICAL:D.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===D.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(u){u!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=u?D.e.LIGHTFALLOFF_GLTF:D.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(u){this.imageProcessingConfiguration.colorCurvesEnabled=u}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(u){this.imageProcessingConfiguration.colorGradingEnabled=u}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(u){this._imageProcessingConfiguration.toneMappingEnabled=u}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(u){this._imageProcessingConfiguration.exposure=u}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(u){this._imageProcessingConfiguration.contrast=u}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(u){this._imageProcessingConfiguration.colorGradingTexture=u}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(u){this._imageProcessingConfiguration.colorCurves=u}constructor(u,R){super(u,R,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=C.fR.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new C.fR(0,0,0),this.albedoColor=new C.fR(1,1,1),this.baseWeight=1,this.reflectivityColor=new C.fR(1,1,1),this.reflectionColor=new C.fR(1,1,1),this.emissiveColor=new C.fR(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,K.c)(this.eu())}getClassName(){return"PBRMaterial"}clone(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const B=G.e.Clone((()=>new S(u,this.eu())),this,{cloneTexturesOnlyOnce:R});return B.id=u,B.name=u,this.RD.copyTo(B.RD),this._clonePlugins(B,I),B}serialize(){const u=super.serialize();return u.customType="BABYLON.PBRMaterial",u}static Parse(u,R,I){const B=G.e.Parse((()=>new S(u.name,R)),u,R,I);return u.RD&&B.RD.parse(u.RD,R,I),t.c._ParsePlugins(u,B,R,I),u.clearCoat&&B.clearCoat.parse(u.clearCoat,R,I),u.anisotropy&&B.anisotropy.parse(u.anisotropy,R,I),u.brdf&&B.brdf.parse(u.brdf,R,I),u.sheen&&B.sheen.parse(u.sheen,R,I),u.subSurface&&B.subSurface.parse(u.subSurface,R,I),u.iridescence&&B.iridescence.parse(u.iridescence,R,I),B}}S.PBRMATERIAL_OPAQUE=D.e.PBRMATERIAL_OPAQUE,S.PBRMATERIAL_ALPHATEST=D.e.PBRMATERIAL_ALPHATEST,S.PBRMATERIAL_ALPHABLEND=D.e.PBRMATERIAL_ALPHABLEND,S.PBRMATERIAL_ALPHATESTANDBLEND=D.e.PBRMATERIAL_ALPHATESTANDBLEND,S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=D.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"directIntensity",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveIntensity",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentIntensity",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularIntensity",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"disableBumpMap",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseWeightTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseDiffuseRoughnessTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureStrength",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallic",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicF0Factor",void 0),(0,B.c)([(0,U.p)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceColor",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectanceTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurfaceTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,B.c)([(0,U.J)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty",null)],S.prototype,"lightmapTexture",void 0),(0,B.c)([(0,U.p)("ambient"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientColor",void 0),(0,B.c)([(0,U.p)("albedo"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoColor",void 0),(0,B.c)([(0,U.S)("baseWeight"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseWeight",void 0),(0,B.c)([(0,U.S)("baseDiffuseRoughness"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"baseDiffuseRoughness",void 0),(0,B.c)([(0,U.p)("reflectivity"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityColor",void 0),(0,B.c)([(0,U.p)("reflection"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionColor",void 0),(0,B.c)([(0,U.p)("emissive"),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveColor",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurface",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromAlbedoTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"forceAlphaTest",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"alphaCutOff",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientInGrayScale",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,B.c)([(0,U.S)()],S.prototype,"usePhysicalLightFalloff",null),(0,B.c)([(0,U.S)()],S.prototype,"useGLTFLightFalloff",null),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOverAlpha",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"parallaxScaleBias",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceIrradianceInFragment",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAlphaFresnel",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLinearAlphaFresnel",void 0),(0,B.c)([(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentBRDFTexture",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceNormalForward",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"enableSpecularAntiAliasing",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useHorizonOcclusion",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOcclusion",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"unlit",void 0),(0,B.c)([(0,U.S)(),(0,U.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,s.e)("BABYLON.PBRMaterial",S)},12937:(u,R,I)=>{I.d(R,{d:()=>U});var B=I(12460);class U extends B.b{constructor(u,R,I,U,K){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9?arguments[9]:void 0,S=arguments.length>10?arguments[10]:void 0,b=arguments.length>11?arguments[11]:void 0;super(null,K,!C,D,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,G),this.format=U,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==t||(s=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==t||(s=1),this._texture=this._engine.createRawTexture(u,R,I,U,C,D,s,null,t,G??0,S??!1),this.wrapU=B.b.CLAMP_ADDRESSMODE,this.wrapV=B.b.CLAMP_ADDRESSMODE,this._waitingForData=!!b&&!u)}update(u){this._getEngine().updateRawTexture(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const u=new U(null,this.getSize().width,this.getSize().height,this.format,this.eu(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return u._texture=this._texture,this._texture.incrementReferences(),u}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(u,R,I,B){return new U(u,R,I,1,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(u,R,I,B){return new U(u,R,I,2,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(u,R,I,B){return new U(u,R,I,0,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(u,R,I,B){return new U(u,R,I,4,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(u,R,I,B){return new U(u,R,I,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(u,R,I,B){return new U(u,R,I,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(u,R,I,K){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.b.TRILINEAR_SAMPLINGMODE;return new U(u,R,I,6,K,C,D,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(u,R,I,K){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.b.TRILINEAR_SAMPLINGMODE;return new U(u,R,I,6,K,C,D,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12929:(u,R,I)=>{I.d(R,{c:()=>C});var B=I(12796),U=I(12514),K=I(12433);class C extends B.c{get QD(){return this._subMaterials}set QD(u){this._subMaterials=u,this._hookArray(u)}getChildren(){return this.QD}constructor(u,R){super(u,R,!0),this._waitingSubMaterialsUniqueIds=[],this.eu().addMultiMaterial(this),this.QD=[],this._storeEffectOnSubMeshes=!0}_hookArray(u){var R=this;const I=u.push;u.push=function(){for(var B=arguments.length,U=new Array(B),K=0;K<B;K++)U[K]=arguments[K];const C=I.apply(u,U);return R._markAllSubMeshesAsTexturesDirty(),C};const B=u.splice;u.splice=(R,I)=>{const U=B.apply(u,[R,I]);return this._markAllSubMeshesAsTexturesDirty(),U}}getSubMaterial(u){return u<0||u>=this.QD.length?this.eu().defaultMaterial:this.QD[u]}getActiveTextures(){return super.getActiveTextures().concat(...this.QD.map((u=>u?u.getActiveTextures():[])))}hasTexture(u){if(super.hasTexture(u))return!0;for(let I=0;I<this.QD.length;I++){var R;if(null!==(R=this.QD[I])&&void 0!==R&&R.hasTexture(u))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(u,R,I){for(let B=0;B<this.QD.length;B++){const U=this.QD[B];if(U){if(U._storeEffectOnSubMeshes){if(!U.isReadyForSubMesh(u,R,I))return!1;continue}if(!U.isReady(u))return!1}}return!0}clone(u,R){const I=new C(u,this.eu());for(let B=0;B<this.QD.length;B++){let U=null;const K=this.QD[B];U=R&&K?K.clone(u+"-"+K.name):this.QD[B],I.QD.push(U)}return I}serialize(){const u={};u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,U.e&&(u.tags=U.e.GetTags(this)),u.materialsUniqueIds=[],u.materials=[];for(let R=0;R<this.QD.length;R++){const I=this.QD[R];I?(u.materialsUniqueIds.push(I.uniqueId),u.materials.push(I.id)):(u.materialsUniqueIds.push(null),u.materials.push(null))}return u}dispose(u,R,I){const B=this.eu();if(!B)return;if(I)for(let K=0;K<this.QD.length;K++){const I=this.QD[K];I&&I.dispose(u,R)}const U=B.multiMaterials.indexOf(this);U>=0&&B.multiMaterials.splice(U,1),super.dispose(u,R)}static ParseMultiMaterial(u,R){const I=new C(u.name,R);if(I.id=u.id,I._loadedUniqueId=u.uniqueId,U.e&&U.e.AddTagsTo(I,u.tags),u.materialsUniqueIds)I._waitingSubMaterialsUniqueIds=u.materialsUniqueIds;else for(const B of u.materials)I.QD.push(R.getLastMaterialById(B));return I}}(0,K.e)("BABYLON.MultiMaterial",C)},13013:(u,R,I)=>{I.d(R,{c:()=>z,d:()=>f});var B=I(12481),U=I(12518),K=I(12907),C=I(12892),D=I(12315),s=I(12549),t=I(12681),G=I(12485),S=I(12346);class b extends B.Vector2{constructor(u,R){super(u.x,u.y),this.index=R}}class r{constructor(){this.elements=[]}add(u){const R=[];for(const I of u){const u=new b(I,this.elements.length);R.push(u),this.elements.push(u)}return R}computeBounds(){const u=new B.Vector2(this.elements[0].x,this.elements[0].y),R=new B.Vector2(this.elements[0].x,this.elements[0].y);for(const I of this.elements)I.x<u.x?u.x=I.x:I.x>R.x&&(R.x=I.x),I.y<u.y?u.y=I.y:I.y>R.y&&(R.y=I.y);return{min:u,max:R,width:R.x-u.x,height:R.y-u.y}}}class P{_addToepoint(u){for(const R of u)this._epoints.push(R.x,R.y)}constructor(u,R,I){let B,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new r,this._outlinepoints=new r,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=U,this._name=u,this._scene=I||S.e.LastCreatedScene,B=R instanceof t.j?R.getPoints():R,this._addToepoint(B),this._points.add(B),this._outlinepoints.add(B),"undefined"===typeof this.bjsEarcut&&D.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(u){this._points.add(u);const R=new r;return R.add(u),this._holes.push(R),this._eholes.push(this._epoints.length/2),this._addToepoint(u),this}build(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const B=new K.b(this._name,this._scene),U=this.buildVertexData(R,I);return B.Zu(s.i.PositionKind,U.Mu,u),B.Zu(s.i.NormalKind,U.ou,u),B.Zu(s.i.UVKind,U.hu,u),B.setIndices(U.indices),B}buildVertexData(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const I=new C.b,B=[],U=[],K=[],D=this._points.computeBounds();for(const C of this._points.elements)B.push(0,1,0),U.push(C.x,0,C.y),K.push((C.x-D.min.x)/D.width,(C.y-D.min.y)/D.height);const s=[],t=this.bjsEarcut(this._epoints,this._eholes,2);for(let C=0;C<t.length;C++)s.push(t[C]);if(u>0){const I=U.length/3;for(const R of this._points.elements)B.push(0,-1,0),U.push(R.x,-u,R.y),K.push(1-(R.x-D.min.x)/D.width,1-(R.y-D.min.y)/D.height);const C=s.length;for(let u=0;u<C;u+=3){const R=s[u+0],B=s[u+1],U=s[u+2];s.push(U+I),s.push(B+I),s.push(R+I)}this._addSide(U,B,K,s,D,this._outlinepoints,u,!1,R);for(const t of this._holes)this._addSide(U,B,K,s,D,t,u,!0,R)}return I.indices=s,I.Mu=U,I.ou=B,I.hu=K,I}_addSide(u,R,I,U,K,C,D,s,t){let S=u.length/3,b=0;for(let r=0;r<C.elements.length;r++){const P=C.elements[r],X=C.elements[(r+1)%C.elements.length];u.push(P.x,0,P.y),u.push(P.x,-D,P.y),u.push(X.x,0,X.y),u.push(X.x,-D,X.y);const E=C.elements[(r+C.elements.length-1)%C.elements.length],z=C.elements[(r+2)%C.elements.length];let f=new B.PR(-(X.y-P.y),0,X.x-P.x),T=new B.PR(-(P.y-E.y),0,P.x-E.x),Q=new B.PR(-(z.y-X.y),0,z.x-X.x);s||(f=f.scale(-1),T=T.scale(-1),Q=Q.scale(-1));const V=f.normalizeToNew();let q=T.normalizeToNew(),e=Q.normalizeToNew();const Y=B.PR.Dot(q,V);q=Y>t?Y<G.c-1?new B.PR(P.x,0,P.y).XR(new B.PR(X.x,0,X.y)).normalize():T.add(f).normalize():V;const M=B.PR.Dot(Q,f);e=M>t?M<G.c-1?new B.PR(X.x,0,X.y).XR(new B.PR(P.x,0,P.y)).normalize():Q.add(f).normalize():V,I.push(b/K.width,0),I.push(b/K.width,1),b+=f.length(),I.push(b/K.width,0),I.push(b/K.width,1),R.push(q.x,q.y,q.z),R.push(q.x,q.y,q.z),R.push(e.x,e.y,e.z),R.push(e.x,e.y,e.z),s?(U.push(S),U.push(S+2),U.push(S+1),U.push(S+1),U.push(S+2),U.push(S+3)):(U.push(S),U.push(S+1),U.push(S+2),U.push(S+1),U.push(S+3),U.push(S+2)),S+=4}}}var X=I(12528);function E(u,R,I,K,D,t,G){const S=I||new Array(3),b=K,r=[],P=G||!1;for(let C=0;C<3;C++)void 0===S[C]&&(S[C]=new B.Vector4(0,0,1,1)),b&&void 0===b[C]&&(b[C]=new U.TD(1,1,1,1));const E=u.getVerticesData(s.i.PositionKind),z=u.getVerticesData(s.i.NormalKind),f=u.getVerticesData(s.i.UVKind),T=u.PD(),Q=E.length/9;let V=0,q=0,e=0,Y=0,M=0;const o=[0];if(P)for(let B=Q;B<E.length/3;B+=4)q=E[3*(B+2)]-E[3*B],e=E[3*(B+2)+2]-E[3*B+2],Y=Math.sqrt(q*q+e*e),M+=Y,o.push(M);let j=0,h=0;for(let B=0;B<z.length;B+=3)Math.abs(z[B+1])<.001&&(h=1),Math.abs(z[B+1]-1)<.001&&(h=0),Math.abs(z[B+1]+1)<.001&&(h=2),j=B/3,1===h?(V=j-Q,f[2*j]=V%4<1.5?P?S[h].x+(S[h].z-S[h].x)*o[Math.floor(V/4)]/M:S[h].x:P?S[h].x+(S[h].z-S[h].x)*o[Math.floor(V/4)+1]/M:S[h].z,f[2*j+1]=V%2===0?X.d?1-S[h].w:S[h].w:X.d?1-S[h].y:S[h].y):(f[2*j]=(1-f[2*j])*S[h].x+f[2*j]*S[h].z,f[2*j+1]=(1-f[2*j+1])*S[h].y+f[2*j+1]*S[h].w,X.d&&(f[2*j+1]=1-f[2*j+1])),b&&r.push(b[h].r,b[h].g,b[h].b,b[h].a);C.b._ComputeSides(R,E,T,z,f,D,t);const x=new C.b;if(x.indices=T,x.Mu=E,x.ou=z,x.hu=f,b){const u=R===C.b.DOUBLESIDE?r.concat(r):r;x.ju=u}return x}function z(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;R.sideOrientation=K.b._GetDefaultSideOrientation(R.sideOrientation);const C=R.shape,D=R.holes||[],s=R.depth||0,t=R.smoothingThreshold||2,G=[];let b=[];for(let K=0;K<C.length;K++)G[K]=new B.Vector2(C[K].x,C[K].z);G[0].equalsWithEpsilon(G[G.length-1],1e-8)&&G.pop();const r=new P(u,G,I||S.e.LastCreatedScene,U);for(let K=0;K<D.length;K++){b=[];for(let u=0;u<D[K].length;u++)b.push(new B.Vector2(D[K][u].x,D[K][u].z));r.addHole(b)}const X=r.build(!1,s,t);X._originalBuilderSideOrientation=R.sideOrientation;return E(X,R.sideOrientation,R.faceUV,R.faceColors,R.frontUVs,R.backUVs,R.wrap).gu(X,R.updatable),X}function f(u,R){return z(u,R,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}C.b.CreatePolygon=E,K.b.CreatePolygon=function(u,R,I,B,U,K){return z(u,{shape:R,holes:B,updatable:U,sideOrientation:K},I,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},K.b.ExtrudePolygon=function(u,R,I,B,U,K,C){return f(u,{shape:R,holes:U,depth:I,updatable:K,sideOrientation:C},B,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},13010:(u,R,I)=>{I.d(R,{b:()=>G,d:()=>S});var B=I(12681),U=I(12481),K=I(12907),C=I(12883),D=I(13013);class s{constructor(u){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=u}moveTo(u,R){this._currentPath=new B.j(u,R),this._tempPaths.push(this._currentPath)}lineTo(u,R){this._currentPath.addLineTo(u,R)}quadraticCurveTo(u,R,I,B){this._currentPath.addQuadraticCurveTo(u,R,I,B,this._resolution)}bezierCurveTo(u,R,I,B,U,K){this._currentPath.addBezierCurveTo(u,R,I,B,U,K,this._resolution)}extractHoles(){for(const u of this._tempPaths)u.area()>0?this._holes.push(u):this._paths.push(u);if(!this._paths.length&&this._holes.length){const u=this._holes;this._holes=this._paths,this._paths=u}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function t(u,R,I,B,U,K){const C=K.glyphs[u]||K.glyphs["?"];if(!C)return null;const D=new s(U);if(C.o){const u=C.o.split(" ");for(let U=0,K=u.length;U<K;){switch(u[U++]){case"m":{const K=parseInt(u[U++])*R+I,C=parseInt(u[U++])*R+B;D.moveTo(K,C);break}case"l":{const K=parseInt(u[U++])*R+I,C=parseInt(u[U++])*R+B;D.lineTo(K,C);break}case"q":{const K=parseInt(u[U++])*R+I,C=parseInt(u[U++])*R+B,s=parseInt(u[U++])*R+I,t=parseInt(u[U++])*R+B;D.quadraticCurveTo(s,t,K,C);break}case"b":{const K=parseInt(u[U++])*R+I,C=parseInt(u[U++])*R+B,s=parseInt(u[U++])*R+I,t=parseInt(u[U++])*R+B,G=parseInt(u[U++])*R+I,S=parseInt(u[U++])*R+B;D.bezierCurveTo(s,t,G,S,K,C);break}}}}return D.extractHoles(),{offsetX:C.ha*R,shapePath:D}}function G(u,R,I,B){const U=Array.from(u),K=R/B.resolution,C=(B.boundingBox.yMax-B.boundingBox.yMin+B.underlineThickness)*K,D=[];let s=0,G=0;for(let S=0;S<U.length;S++){const u=U[S];if("\n"===u)s=0,G-=C;else{const R=t(u,K,s,G,I,B);R&&(s+=R.offsetX,D.push(R.shapePath))}}return D}function S(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const S=G(R,B.size||50,B.resolution||8,I),b=[];let r=0;for(const C of S){if(!C.paths.length)continue;const R=C.holes.slice();for(const I of C.paths){var P,X;const C=[],G=[],S=I.getPoints();for(const u of S)G.push(new U.PR(u.x,0,u.y));const E=R.slice();for(const u of E){const B=u.getPoints();let K=!1;for(const u of B)if(I.isPointInside(u)){K=!0;break}if(!K)continue;const D=[];for(const u of B)D.push(new U.PR(u.x,0,u.y));C.push(D),R.splice(R.indexOf(u),1)}if(!C.length&&R.length)for(const u of R){const R=u.getPoints(),I=[];for(const u of R)I.push(new U.PR(u.x,0,u.y));C.push(I)}const z=(0,D.d)(u,{shape:G,holes:C.length?C:void 0,depth:B.depth||1,faceUV:B.faceUV||(null===(P=B.perLetterFaceUV)||void 0===P?void 0:P.call(B,r)),faceColors:B.faceColors||(null===(X=B.perLetterFaceColors)||void 0===X?void 0:X.call(B,r)),sideOrientation:K.b._GetDefaultSideOrientation(B.sideOrientation||K.b.DOUBLESIDE)},s,t);b.push(z),r++}}const E=K.b.MergeMeshes(b,!0,!0);if(E){const R=E.getBoundingInfo().boundingBox;E.position.x+=-(R.minimumWorld.x+R.maximumWorld.x)/2,E.position.y+=-(R.minimumWorld.y+R.maximumWorld.y)/2,E.position.z+=-(R.minimumWorld.z+R.maximumWorld.z)/2+R.extendSize.z,E.name=u;const I=new C.e("pivot",s);I.rotation.x=-Math.PI/2,E.parent=I,E.bakeCurrentTransformIntoVertices(),E.parent=null,I.dispose()}return E}},13022:(u,R,I)=>{I.d(R,{c:()=>s,d:()=>C,e:()=>D});var B=I(12294),U=I(13025),K=I(13032);function C(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function D(u){return!!(u.wasmUrl&&(u.wasmBinary||u.wasmBinaryUrl)&&"object"===typeof WebAssembly||u.fallbackUrl)}class s{constructor(u){if(u.workerPool)return void(this._workerPoolPromise=Promise.resolve(u.workerPool));const R=u.wasmBinary,I=u.numWorkers??C(),D=I&&"function"===typeof Worker&&"function"===typeof URL,s=D||!u.jsModule,t=u.wasmUrl&&u.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:s?B.Tools.GetBabylonScriptURL(u.wasmUrl,!0):"",wasmBinaryPromise:R?Promise.resolve(R):B.Tools.LoadFileAsync(B.Tools.GetBabylonScriptURL(u.wasmBinaryUrl,!0))}:{url:s?B.Tools.GetBabylonScriptURL(u.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};D?this._workerPoolPromise=t.wasmBinaryPromise.then((u=>{const R=this._getWorkerContent(),B=URL.createObjectURL(new Blob([R],{type:"application/javascript"}));return new U.b(I,(()=>{const R=new Worker(B);return(0,K.l)(R,u,t.url)}))})):this._modulePromise=t.wasmBinaryPromise.then((async R=>{if(!this._isModuleAvailable()&&!u.jsModule){if(!t.url)throw new Error("Draco codec module is not available");await B.Tools.LoadBabylonScriptAsync(t.url)}return await this._createModuleAsync(R,u.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((u=>{u.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},13032:(u,R,I)=>{function B(u,R,I,B){const U=u;let K=null,C=null,D=null,s=null;const t={},G=R.find((u=>"POSITION"===u.dracoName));if(!G)throw new Error("Position attribute is required for Draco encoding");if(!I){const u=G.data.length/G.size;I=new(u>65535?Uint32Array:Uint16Array)(u);for(let R=0;R<u;R++)I[R]=R}try{K=new U.Encoder,C=new U.MeshBuilder,D=new U.Mesh,C.AddFacesToMesh(D,I.length/3,I);const u=new Map([[Float32Array,(u,R,I,B,U,K)=>u.AddFloatAttribute(R,I,B,U,K)],[Uint32Array,(u,R,I,B,U,K)=>u.AddUInt32Attribute(R,I,B,U,K)],[Uint16Array,(u,R,I,B,U,K)=>u.AddUInt16Attribute(R,I,B,U,K)],[Uint8Array,(u,R,I,B,U,K)=>u.AddUInt8Attribute(R,I,B,U,K)],[Int32Array,(u,R,I,B,U,K)=>u.AddInt32Attribute(R,I,B,U,K)],[Int16Array,(u,R,I,B,U,K)=>u.AddInt16Attribute(R,I,B,U,K)],[Int8Array,(u,R,I,B,U,K)=>u.AddInt8Attribute(R,I,B,U,K)]]);for(const I of R){I.data instanceof Uint8ClampedArray&&(I.data=new Uint8Array(I.data));const R=u.get(I.data.constructor),s=I.data.length/I.size;t[I.kind]=R(C,D,U[I.dracoName],s,I.size,I.data),B.quantizationBits&&B.quantizationBits[I.dracoName]&&K.SetAttributeQuantization(U[I.dracoName],B.quantizationBits[I.dracoName])}B.method&&K.SetEncodingMethod(U[B.method]),void 0!==B.encodeSpeed&&void 0!==B.decodeSpeed&&K.SetSpeedOptions(B.encodeSpeed,B.decodeSpeed),s=new U.DracoInt8Array;const G=K.EncodeMeshToDracoBuffer(D,s);if(G<=0)throw new Error("Draco encoding failed.");const S=new Int8Array(G);for(let R=0;R<G;R++)S[R]=s.GetValue(R);return{data:S,attributeIds:t}}finally{D&&U.destroy(D),C&&U.destroy(C),K&&U.destroy(K),s&&U.destroy(s)}}function U(){let u;onmessage=R=>{const I=R.data;switch(I.id){case"init":{I.url&&importScripts(I.url);const R=I.wasmBinary?{wasmBinary:I.wasmBinary}:{};u=DracoEncoderModule(R),postMessage({id:"initDone"});break}case"encodeMesh":if(!u)throw new Error("Draco encoder module is not available");u.then((u=>{const R=B(u,I.attributes,I.indices,I.options);postMessage({id:"encodeMeshDone",encodedMeshData:R},R?[R.data.buffer]:void 0)}))}}}function K(u,R,I,B,U){const K=u;let C=null,D=null,s=null;try{let u;C=new K.Decoder,D=new K.DecoderBuffer,D.Init(R,R.byteLength);const t=C.GetEncodedGeometryType(D);switch(t){case K.TRIANGULAR_MESH:{const R=new K.Mesh;if(u=C.DecodeBufferToMesh(D,R),!u.ok()||0===R.ptr)throw new Error(u.error_msg());const I=3*R.num_faces(),U=4*I,t=K._malloc(U);try{C.GetTrianglesUInt32Array(R,U,t);const u=new Uint32Array(I);u.set(new Uint32Array(K.HEAPF32.buffer,t,I)),B(u)}finally{K._free(t)}s=R;break}case K.POINT_CLOUD:{const R=new K.PointCloud;if(u=C.DecodeBufferToPointCloud(D,R),!u.ok()||!R.ptr)throw new Error(u.error_msg());s=R;break}default:throw new Error(`Invalid geometry type ${t}`)}const G=s.num_points(),S=(u,R,I,B)=>{const C=B.data_type(),D=B.num_components(),s=B.normalized(),t=B.byte_stride(),S=B.byte_offset(),b={[K.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:K.HEAPF32},[K.DT_INT8]:{typedArrayConstructor:Int8Array,heap:K.HEAP8},[K.DT_INT16]:{typedArrayConstructor:Int16Array,heap:K.HEAP16},[K.DT_INT32]:{typedArrayConstructor:Int32Array,heap:K.HEAP32},[K.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:K.HEAPU8},[K.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:K.HEAPU16},[K.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:K.HEAPU32}}[C];if(!b)throw new Error(`Invalid data type ${C}`);const r=G*D,P=r*b.typedArrayConstructor.BYTES_PER_ELEMENT,X=K._malloc(P);try{u.GetAttributeDataArrayForAllPoints(R,B,C,P,X);const K=new b.typedArrayConstructor(b.heap.buffer,X,r);U(I,K.slice(),D,S,t,s)}finally{K._free(X)}};if(I)for(const R in I){const u=I[R],B=C.GetAttributeByUniqueId(s,u);S(C,s,R,B)}else{const u={position:K.POSITION,normal:K.NORMAL,color:K.COLOR,uv:K.TEX_COORD};for(const R in u){const I=C.GetAttributeId(s,u[R]);if(-1!==I){const u=C.GetAttribute(s,I);S(C,s,R,u)}}}return G}finally{s&&K.destroy(s),D&&K.destroy(D),C&&K.destroy(C)}}function C(){let u;onmessage=R=>{const I=R.data;switch(I.id){case"init":{I.url&&importScripts(I.url);const R=I.wasmBinary?{wasmBinary:I.wasmBinary}:{};u=DracoDecoderModule(R),postMessage({id:"initDone"});break}case"decodeMesh":if(!u)throw new Error("Draco decoder module is not available");u.then((u=>{const R=K(u,I.dataView,I.attributes,(u=>{postMessage({id:"indices",data:u},[u.buffer])}),((u,R,I,B,U,K)=>{postMessage({id:"attribute",kind:u,data:R,size:I,byteOffset:B,byteStride:U,normalized:K},[R.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:R})}))}}}async function D(u,R,I){return await new Promise(((B,U)=>{const K=R=>{u.removeEventListener("error",K),u.removeEventListener("message",C),U(R)},C=R=>{"initDone"===R.data.id&&(u.removeEventListener("error",K),u.removeEventListener("message",C),B(u))};if(u.addEventListener("error",K),u.addEventListener("message",C),R){const B=R.slice(0);u.postMessage({id:"init",url:I,wasmBinary:B},[B])}else u.postMessage({id:"init",url:I})}))}I.d(R,{d:()=>K,f:()=>C,i:()=>B,j:()=>U,l:()=>D})},12890:(u,R,I)=>{I.d(R,{b:()=>e});var B=I(12466),U=I(12303),K=I(12481),C=I(12549),D=I(12892),s=I(12883),t=I(12733),G=I(12808),S=I(12724);class b{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new K.PR(0,0,0),this._diffPositionForCollisions=new K.PR(0,0,0),this._collisionResponse=!0}}var r=I(12335),P=I(12824),X=I(12518),E=I(12485),z=I(12669),f=I(12433),T=I(12472),Q=I(12377);class V{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=K.PR.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class q{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new V,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new b,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class e extends s.e{static get BILLBOARDMODE_NONE(){return s.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return s.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return s.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return s.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return s.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return s.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(u){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=u}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(u){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=u}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=u}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=u}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(u){this._internalAbstractMeshDataInfo._collisionRetryCount=u}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(u){this._internalAbstractMeshDataInfo._morphTargetManager!==u&&(this._internalAbstractMeshDataInfo._morphTargetManager=u,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(u){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==u&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=u,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(u){return!!super._updateNonUniformScalingState(u)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(u){this._internalAbstractMeshDataInfo._rawBoundingInfo=u}set BP(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(u)}set onCollisionPositionChange(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(u)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(u){if(this._internalAbstractMeshDataInfo._visibility===u)return;const R=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=u,(1===R&&1!==u||1!==R&&1===u)&&this._markSubMeshesAsDirty((u=>{u.markAsMiscDirty(),u.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(u){this._internalAbstractMeshDataInfo._inheritVisibility=u}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let u=this._parentNode;for(;u;){const R=u.isVisible;if("undefined"!==typeof R)return R;u=u.parent}}return this._isVisible}set isVisible(u){this._isVisible=u}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(u){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=u}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(u){this._internalAbstractMeshDataInfo._renderingGroupId=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){this._setMaterial(u)}_setMaterial(u){this._internalAbstractMeshDataInfo._material!==u&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=u,u&&u.meshMap&&(u.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.DD&&(this.resetDrawCache(void 0,null==u),this._unBindEffect()))}getMaterialForRenderPass(u){var R;return null===(R=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===R?void 0:R[u]}setMaterialForRenderPass(u,R){var I;this.resetDrawCache(u),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const B=this._internalAbstractMeshDataInfo._materialForRenderPass[u];null!==B&&void 0!==B&&null!==(I=B.meshMap)&&void 0!==I&&I[this.uniqueId]&&(B.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[u]=R,R&&R.meshMap&&(R.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(u){this._internalAbstractMeshDataInfo._receiveShadows!==u&&(this._internalAbstractMeshDataInfo._receiveShadows=u,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(u){this._internalAbstractMeshDataInfo._hasVertexAlpha!==u&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=u,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(u){this._internalAbstractMeshDataInfo._useVertexColors!==u&&(this._internalAbstractMeshDataInfo._useVertexColors=u,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(u){this._internalAbstractMeshDataInfo._numBoneInfluencers!==u&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=u,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(u){this._internalAbstractMeshDataInfo._applyFog!==u&&(this._internalAbstractMeshDataInfo._applyFog=u,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(u){this._internalAbstractMeshDataInfo._enableDistantPicking=u}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(u){u!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=u,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(u)?-1:u}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=u}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(u)?-1:u}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(u){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=u}get lightSources(){return this._lightSources}set skeleton(u){const R=this._internalAbstractMeshDataInfo._skeleton;R&&R.needInitialSkinMatrix&&R._unregisterMeshWithPoseMatrix(this),u&&u.needInitialSkinMatrix&&u._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=u,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(u){var R;let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(u,I,!1),R=this,this._internalAbstractMeshDataInfo=new q,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.PS=e.XS,this.onCollideObservable=new U.c,this.onCollisionPositionChangeObservable=new U.c,this.onMaterialChangedObservable=new U.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Zs=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=X.fR.Red(),this.outlineWidth=.02,this.overlayColor=X.fR.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.kt=!1,this.vu=!1,this.actionManager=null,this.ellipsoid=new K.PR(.5,1,.5),this.ellipsoidOffset=new K.PR(0,0,0),this.edgesWidth=1,this.edgesColor=new X.TD(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,hD:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new U.c,this._onCollisionPositionChange=function(u,I){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.subtractToRef(R._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,R._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),R._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Q.d.CollisionsEpsilon&&R.position.addInPlace(R._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),B&&R.onCollideObservable.notifyObservers(B),R.onCollisionPositionChangeObservable.notifyObservers(R.position)},I=this.eu(),I.UG(this),this._resyncLightSources(),this._uniformBuffer=new S.e(this.eu().getEngine(),void 0,void 0,u,!this.eu().getEngine().isWebGPU),this._buildUniformLayout(),I.performancePriority){case 2:this.vu=!0;case 1:this.kt=!0,this.Zs=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(u){const R=this._uniformBuffer;R.SD("world",u),R.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),R.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(u){let R="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");R+=", # of submeshes: "+(this.DD?this.DD.length:0);const I=this._internalAbstractMeshDataInfo._skeleton;return I&&(R+=", skeleton: "+I.name),u&&(R+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],R+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.hD?"YES":"NO")),R}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==s.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(R||this.actionManager.isRecursive)){if(!u)return this.actionManager;if(this.actionManager.hasSpecificTrigger(u))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.DD){for(const u of this.DD)u._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const u of this.eu().lights)u.isEnabled()&&u.canAffectMesh(this)&&this._lightSources.push(u);this._markSubMeshesAsLightDirty()}_resyncLightSource(u){const R=u.isEnabled()&&u.canAffectMesh(this),I=this._lightSources.indexOf(u);let B=!1;if(-1===I){if(!R)return;this._lightSources.push(u)}else{if(R)return;B=!0,this._lightSources.splice(I,1)}this._markSubMeshesAsLightDirty(B)}_unBindEffect(){for(const u of this.DD)u.setEffect(null)}_removeLightSource(u,R){const I=this._lightSources.indexOf(u);-1!==I&&(this._lightSources.splice(I,1),this._markSubMeshesAsLightDirty(R))}_markSubMeshesAsDirty(u){if(this.DD)for(const R of this.DD)for(let I=0;I<R._drawWrappers.length;++I){const B=R._drawWrappers[I];B&&B.defines&&B.defines.markAllAsDirty&&u(B.defines)}}_markSubMeshesAsLightDirty(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((R=>R.markAsLightDirty(u)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((u=>u.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((u=>u.markAsMiscDirty()))}Ot(u){return this._currentRenderId=Number.MAX_VALUE,super.Ot(u),this._isDirty=!0,this}resetDrawCache(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.DD)for(const I of this.DD)I.resetDrawCache(u,R)}get isBlocked(){return!1}getLOD(u){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}PD(){return null}getVerticesData(u){return null}Zu(u,R,I,B){return this}updateVerticesData(u,R,I,B){return this}setIndices(u,R){return this}isVerticesDataPresent(u){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.pu()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(u){return this._boundingInfo=u,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(u,R,I){return this._boundingInfo=new G.c(u,R,I),this._boundingInfo}normalizeToUnitCube(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(u,R,I)}get useBones(){return this.skeleton&&this.eu().skeletonsEnabled&&this.isVerticesDataPresent(C.i.MatricesIndicesKind)&&this.isVerticesDataPresent(C.i.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(u){}_activate(u,R){return this._renderId=u,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===s.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(u,R,I){return this.position.addInPlace(this.calcMovePOV(u,R,I)),this}calcMovePOV(u,R,I){const B=new K.Matrix;(this.rotationQuaternion?this.rotationQuaternion:K.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(B);const U=K.PR.Zero(),C=this.definedFacingForward?-1:1;return K.PR.TransformCoordinatesFromFloatsToRef(u*C,R,I*C,B,U),U}rotatePOV(u,R,I){return this.rotation.addInPlace(this.calcRotatePOV(u,R,I)),this}calcRotatePOV(u,R,I){const B=this.definedFacingForward?1:-1;return new K.PR(u*B,R,I*B)}lu(u,R){if(u){const I=(0,P.g)(u,0,this.getTotalVertices(),R);this._boundingInfo?this._boundingInfo.reConstruct(I.minimum,I.maximum):this._boundingInfo=new G.c(I.minimum,I.maximum)}if(this.DD)for(let I=0;I<this.DD.length;I++)this.DD[I].refreshBoundingInfo(u);this.pu()}_refreshBoundingInfoDirect(u){if(this._boundingInfo?this._boundingInfo.reConstruct(u.minimum,u.maximum):this._boundingInfo=new G.c(u.minimum,u.maximum),this.DD)for(let R=0;R<this.DD.length;R++)this.DD[R].refreshBoundingInfo(null);this.pu()}static _ApplySkeleton(u,R,I,B,U,D,s){!function(u,R,I,B,U,D,s){const t=K.TmpVectors.PR[0],G=K.TmpVectors.Matrix[0],S=K.TmpVectors.Matrix[1],b=R===C.i.NormalKind?K.PR.TransformNormalFromFloatsToRef:K.PR.TransformCoordinatesFromFloatsToRef;for(let C=0,r=0;C<u.length;C+=3,r+=4){let R,P;for(G.reset(),R=0;R<4;R++)P=U[r+R],P>0&&(K.Matrix.FromFloat32ArrayToRefScaled(I,Math.floor(16*B[r+R]),P,S),G.addToSelf(S));if(D&&s)for(R=0;R<4;R++)P=s[r+R],P>0&&(K.Matrix.FromFloat32ArrayToRefScaled(I,Math.floor(16*D[r+R]),P,S),G.addToSelf(S));b(u[C],u[C+1],u[C+2],G,t),t.toArray(u,C)}}(u,R,I,B,U,D,s)}_getData(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.i.PositionKind;const B=u.cache,U=u=>{if(B){const R=B._vertexData||(B._vertexData={});return R[u]||this.copyVerticesData(u,R),R[u]}return this.getVerticesData(u)};if(R||(R=U(I)),!R)return null;if(B?(B._outputData?B._outputData.set(R):B._outputData=new Float32Array(R),R=B._outputData):(u.applyMorph&&this.morphTargetManager||u.applySkeleton&&this.skeleton)&&(R=R.slice()),u.applyMorph&&this.morphTargetManager&&function(u,R,I){let B=null;switch(R){case C.i.PositionKind:B=u=>u.getPositions();break;case C.i.NormalKind:B=u=>u.getNormals();break;case C.i.TangentKind:B=u=>u.getTangents();break;case C.i.UVKind:B=u=>u.getUVs();break;case C.i.UV2Kind:B=u=>u.getUV2s();break;case C.i.ColorKind:B=u=>u.getColors();break;default:return}for(let U=0;U<u.length;U++){let R=u[U];for(let K=0;K<I.numTargets;K++){const C=I.getTarget(K),D=C.influence;if(0!==D){const I=B(C);I&&(R+=(I[U]-u[U])*D)}}u[U]=R}}(R,I,this.morphTargetManager),u.applySkeleton&&this.skeleton){const u=U(C.i.MatricesIndicesKind),B=U(C.i.MatricesWeightsKind);if(B&&u){const K=this.numBoneInfluencers>4,D=K?U(C.i.MatricesIndicesExtraKind):null,s=K?U(C.i.MatricesWeightsExtraKind):null,t=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(R,I,t,u,B,D,s)}}if(!1!==u.updatePositionsArray&&I===C.i.PositionKind){const u=this._internalAbstractMeshDataInfo._positions||[],I=u.length;if(u.length=R.length/3,I<u.length)for(let R=I;R<u.length;R++)u[R]=new K.PR;for(let B=0,U=0;B<u.length;B++,U+=3)u[B].ED(R[U],R[U+1],R[U+2]);this._internalAbstractMeshDataInfo._positions=u}return R}getNormalsData(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:u,applyMorph:R,updatePositionsArray:!1},null,C.i.NormalKind)}vD(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:u,applyMorph:R,updatePositionsArray:!1},I,C.i.PositionKind)}pu(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new G.c(K.PR.Zero(),K.PR.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(u){if(!this.DD)return this;const R=this.DD.length;for(let I=0;I<R;I++){const B=this.DD[I];(R>1||!B.IsGlobal)&&B.updateBoundingInfo(u)}return this}_afterComputeWorldMatrix(){this.vu||(this._boundingInfoIsDirty=!0)}isInFrustum(u){return this.getBoundingInfo().isInFrustum(u,this.PS)}isCompletelyInFrustum(u){return this.getBoundingInfo().isCompletelyInFrustum(u)}intersectsMesh(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;const B=this.getBoundingInfo(),U=u.getBoundingInfo();if(B.intersects(U,R))return!0;if(I)for(const K of this.getChildMeshes())if(K.intersectsMesh(u,R,!0))return!0;return!1}intersectsPoint(u){return this.getBoundingInfo().intersectsPoint(u)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(u){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=u}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const I=this.eu().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=I.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,I.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,u,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,R),this}_collideForSubMesh(u,R,I){var B;if(this._generatePointsArray(),!this._positions)return this;if(!u._lastColliderWorldVertices||!u._lastColliderTransformMatrix.equals(R)){u._lastColliderTransformMatrix=R.clone(),u._lastColliderWorldVertices=[],u._trianglePlanes=[];const I=u.verticesStart,B=u.verticesStart+u.verticesCount;for(let U=I;U<B;U++)u._lastColliderWorldVertices.push(K.PR.TransformCoordinates(this._positions[U],R))}return I._collide(u._trianglePlanes,u._lastColliderWorldVertices,this.PD(),u.indexStart,u.indexStart+u.indexCount,u.verticesStart,!!u.cu(),this,this._shouldConvertRHS(),7===(null===(B=u.cu())||void 0===B?void 0:B.fillMode)),this}_processCollisionsForSubMeshes(u,R){const I=this._scene.getCollidingSubMeshCandidates(this,u),B=I.length;for(let U=0;U<B;U++){const K=I.data[U];B>1&&!K._checkCollision(u)||this._collideForSubMesh(K,R,u)}return this}_shouldConvertRHS(){return!1}_checkCollision(u){if(!this.getBoundingInfo()._checkCollision(u))return this;const R=K.TmpVectors.Matrix[0],I=K.TmpVectors.Matrix[1];return K.Matrix.ScalingToRef(1/u._radius.x,1/u._radius.y,1/u._radius.z,R),this.worldMatrixFromCache.multiplyToRef(R,I),this._processCollisionsForSubMeshes(u,I),this}_generatePointsArray(){return!1}intersects(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const D=new t.b,s=this.getClassName(),G="InstancedLinesMesh"===s||"LinesMesh"===s||"GreasedLineMesh"===s?this.intersectionThreshold:0,S=this.getBoundingInfo();if(!this.DD)return D;if(!C&&(!u.intersectsSphere(S.boundingSphere,G)||!u.intersectsBox(S.boundingBox,G)))return D;if(B)return D.hit=!C,D.pickedMesh=C?null:this,D.distance=C?0:K.PR.Distance(u.origin,S.boundingSphere.center),D.subMeshId=0,D;if(!this._generatePointsArray())return D;let b=null;const r=this._scene.getIntersectingSubMeshCandidates(this,u),P=r.length;let X=!1;for(let K=0;K<P;K++){const u=r.data[K].cu();if(u&&(7==u.fillMode||0==u.fillMode||1==u.fillMode||2==u.fillMode||4==u.fillMode)){X=!0;break}}if(!X)return D.hit=!0,D.pickedMesh=this,D.distance=K.PR.Distance(u.origin,S.boundingSphere.center),D.subMeshId=-1,D;for(let K=0;K<P;K++){const B=r.data[K];if(P>1&&!C&&!B.canIntersects(u))continue;const U=B.intersects(u,this._positions,this.PD(),R,I);if(U&&(R||!b||U.distance<b.distance)&&(b=U,b.subMeshId=K,R))break}if(b){const R=U??this.getWorldMatrix(),I=K.TmpVectors.PR[0],B=K.TmpVectors.PR[1];K.PR.TransformCoordinatesToRef(u.origin,R,I),u.direction.scaleToRef(b.distance,B);const C=K.PR.TransformNormal(B,R).addInPlace(I);return D.hit=!0,D.distance=K.PR.Distance(I,C),D.pickedPoint=C,D.pickedMesh=this,D.bu=b.bu||0,D.bv=b.bv||0,D.subMeshFaceId=b.faceId,D.faceId=b.faceId+r.data[b.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),D.subMeshId=b.subMeshId,D}return D}clone(u,R,I){return null}releaseSubMeshes(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.DD)for(;this.DD.length;)this.DD[0].dispose(u);else this.DD=[];return this}dispose(u){let R,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const B=this.eu();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),B.freeActiveMeshes(),B.freeRenderingGroups(),B.renderingManager.maintainStateBetweenFrames&&B.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((u=>u!==this&&u.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),R=0;R<this._intersectionsInProgress.length;R++){const u=this._intersectionsInProgress[R],I=u._intersectionsInProgress.indexOf(this);u._intersectionsInProgress.splice(I,1)}this._intersectionsInProgress.length=0;const U=B.lights;for(const C of U){let u=C.includedOnlyMeshes.indexOf(this);-1!==u&&C.includedOnlyMeshes.splice(u,1),u=C.excludedMeshes.indexOf(this),-1!==u&&C.excludedMeshes.splice(u,1);const R=C.getShadowGenerators();if(R){const I=R.values();for(let R=I.next();!0!==R.done;R=I.next()){const I=R.value.getShadowMap();I&&I.renderList&&(u=I.renderList.indexOf(this),-1!==u&&I.renderList.splice(u,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const K=B.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,K.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),K.wipeCaches(),B.BG(this),this._parentContainer){const u=this._parentContainer.meshes.indexOf(this);u>-1&&this._parentContainer.meshes.splice(u,1),this._parentContainer=null}if(I&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!u)for(R=0;R<B.nS.length;R++)B.nS[R].BR===this&&(B.nS[R].dispose(),R--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(u,I)}_initFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetNormals||(u.facetNormals=[]),u.facetPositions||(u.facetPositions=[]),u.facetPartitioning||(u.facetPartitioning=new Array),u.facetNb=this.PD().length/3|0,u.partitioningSubdivisions=u.partitioningSubdivisions?u.partitioningSubdivisions:10,u.partitioningBBoxRatio=u.partitioningBBoxRatio?u.partitioningBBoxRatio:1.01;for(let R=0;R<u.facetNb;R++)u.facetNormals[R]=K.PR.Zero(),u.facetPositions[R]=K.PR.Zero();return u.facetDataEnabled=!0,this}updateFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetDataEnabled||this._initFacetData();const R=this.getVerticesData(C.i.PositionKind),I=this.PD(),B=this.getVerticesData(C.i.NormalKind),U=this.getBoundingInfo();if(u.facetDepthSort&&!u.facetDepthSortEnabled){if(u.facetDepthSortEnabled=!0,I instanceof Uint16Array)u.depthSortedIndices=new Uint16Array(I);else if(I instanceof Uint32Array)u.depthSortedIndices=new Uint32Array(I);else{let R=!1;for(let u=0;u<I.length;u++)if(I[u]>65535){R=!0;break}u.depthSortedIndices=R?new Uint32Array(I):new Uint16Array(I)}if(u.facetDepthSortFunction=function(u,R){return R.sqDistance-u.sqDistance},!u.facetDepthSortFrom){const R=this.eu().activeCamera;u.facetDepthSortFrom=R?R.position:K.PR.Zero()}u.depthSortedFacets=[];for(let R=0;R<u.facetNb;R++){const I={ind:3*R,sqDistance:0};u.depthSortedFacets.push(I)}u.invertedMatrix=K.Matrix.Identity(),u.facetDepthSortOrigin=K.PR.Zero()}u.bbSize.x=U.maximum.x-U.minimum.x>E.c?U.maximum.x-U.minimum.x:E.c,u.bbSize.y=U.maximum.y-U.minimum.y>E.c?U.maximum.y-U.minimum.y:E.c,u.bbSize.z=U.maximum.z-U.minimum.z>E.c?U.maximum.z-U.minimum.z:E.c;let s=u.bbSize.x>u.bbSize.y?u.bbSize.x:u.bbSize.y;if(s=s>u.bbSize.z?s:u.bbSize.z,u.subDiv.max=u.partitioningSubdivisions,u.subDiv.X=Math.floor(u.subDiv.max*u.bbSize.x/s),u.subDiv.Y=Math.floor(u.subDiv.max*u.bbSize.y/s),u.subDiv.Z=Math.floor(u.subDiv.max*u.bbSize.z/s),u.subDiv.X=u.subDiv.X<1?1:u.subDiv.X,u.subDiv.Y=u.subDiv.Y<1?1:u.subDiv.Y,u.subDiv.Z=u.subDiv.Z<1?1:u.subDiv.Z,u.facetParameters.facetNormals=this.getFacetLocalNormals(),u.facetParameters.facetPositions=this.getFacetLocalPositions(),u.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),u.facetParameters.bInfo=U,u.facetParameters.bbSize=u.bbSize,u.facetParameters.subDiv=u.subDiv,u.facetParameters.ratio=this.partitioningBBoxRatio,u.facetParameters.depthSort=u.facetDepthSort,u.facetDepthSort&&u.facetDepthSortEnabled&&(this.bD(!0),this._worldMatrix.invertToRef(u.invertedMatrix),K.PR.TransformCoordinatesToRef(u.facetDepthSortFrom,u.invertedMatrix,u.facetDepthSortOrigin),u.facetParameters.distanceTo=u.facetDepthSortOrigin),u.facetParameters.depthSortedFacets=u.depthSortedFacets,B&&D.b.ComputeNormals(R,I,B,u.facetParameters),u.facetDepthSort&&u.facetDepthSortEnabled){u.depthSortedFacets.sort(u.facetDepthSortFunction);const R=u.depthSortedIndices.length/3|0;for(let B=0;B<R;B++){const R=u.depthSortedFacets[B].ind;u.depthSortedIndices[3*B]=I[R],u.depthSortedIndices[3*B+1]=I[R+1],u.depthSortedIndices[3*B+2]=I[R+2]}this.updateIndices(u.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetNormals||this.updateFacetData(),u.facetNormals}getFacetLocalPositions(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPositions||this.updateFacetData(),u.facetPositions}getFacetLocalPartitioning(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPartitioning||this.updateFacetData(),u.facetPartitioning}getFacetPosition(u){const R=K.PR.Zero();return this.getFacetPositionToRef(u,R),R}getFacetPositionToRef(u,R){const I=this.getFacetLocalPositions()[u],B=this.getWorldMatrix();return K.PR.TransformCoordinatesToRef(I,B,R),this}getFacetNormal(u){const R=K.PR.Zero();return this.getFacetNormalToRef(u,R),R}getFacetNormalToRef(u,R){const I=this.getFacetLocalNormals()[u];return K.PR.TransformNormalToRef(I,this.getWorldMatrix(),R),this}getFacetsAtLocalCoordinates(u,R,I){const B=this.getBoundingInfo(),U=this._internalAbstractMeshDataInfo._facetData,K=Math.floor((u-B.minimum.x*U.partitioningBBoxRatio)*U.subDiv.X*U.partitioningBBoxRatio/U.bbSize.x),C=Math.floor((R-B.minimum.y*U.partitioningBBoxRatio)*U.subDiv.Y*U.partitioningBBoxRatio/U.bbSize.y),D=Math.floor((I-B.minimum.z*U.partitioningBBoxRatio)*U.subDiv.Z*U.partitioningBBoxRatio/U.bbSize.z);return K<0||K>U.subDiv.max||C<0||C>U.subDiv.max||D<0||D>U.subDiv.max?null:U.facetPartitioning[K+U.subDiv.max*C+U.subDiv.max*U.subDiv.max*D]}getClosestFacetAtCoordinates(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const D=this.getWorldMatrix(),s=K.TmpVectors.Matrix[5];D.invertToRef(s);const t=K.TmpVectors.PR[8];K.PR.TransformCoordinatesFromFloatsToRef(u,R,I,s,t);const G=this.getClosestFacetAtLocalCoordinates(t.x,t.y,t.z,B,U,C);return B&&K.PR.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,D,B),G}getClosestFacetAtLocalCoordinates(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],C=null,D=0,s=0,t=0,G=0,S=0,b=0,r=0,P=0;const X=this.getFacetLocalPositions(),E=this.getFacetLocalNormals(),z=this.getFacetsAtLocalCoordinates(u,R,I);if(!z)return null;let f,T,Q,V=Number.MAX_VALUE,q=V;for(let e=0;e<z.length;e++)f=z[e],T=E[f],Q=X[f],G=(u-Q.x)*T.x+(R-Q.y)*T.y+(I-Q.z)*T.z,(!U||U&&K&&G>=0||U&&!K&&G<=0)&&(G=T.x*Q.x+T.y*Q.y+T.z*Q.z,S=-(T.x*u+T.y*R+T.z*I-G)/(T.x*T.x+T.y*T.y+T.z*T.z),b=u+T.x*S,r=R+T.y*S,P=I+T.z*S,D=b-u,s=r-R,t=P-I,q=D*D+s*s+t*t,q<V&&(V=q,C=f,B&&(B.x=b,B.y=r,B.z=P)));return C}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetDataEnabled&&(u.facetDataEnabled=!1,u.facetPositions=[],u.facetNormals=[],u.facetPartitioning=new Array,u.facetParameters={},u.depthSortedIndices=new Uint32Array(0)),this}updateIndices(u,R){return this}createNormals(u){const R=this.getVerticesData(C.i.PositionKind),I=this.PD();let B;return B=this.isVerticesDataPresent(C.i.NormalKind)?this.getVerticesData(C.i.NormalKind):[],D.b.ComputeNormals(R,I,B,{useRightHandedSystem:this.eu().useRightHandedSystem}),this.Zu(C.i.NormalKind,B,u),this}async optimizeIndicesAsync(){const u=this.PD();if(!u)return this;const{OptimizeIndices:R}=await I.e(70).then(I.bind(I,15481));return R(u),this.setIndices(u,this.getTotalVertices()),this}alignWithNormal(u,R){R||(R=z.c.Y);const I=K.TmpVectors.PR[0],B=K.TmpVectors.PR[1];return K.PR.CrossToRef(R,u,B),K.PR.CrossToRef(u,B,I),this.rotationQuaternion?K.Quaternion.RotationQuaternionFromAxisToRef(I,u,B,this.rotationQuaternion):K.PR.RotationFromAxisToRef(I,u,B,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,r.c)("EdgesRenderer")}enableEdgesRendering(u,R,I){throw(0,r.c)("EdgesRenderer")}dS(){return this._scene.nS.filter((u=>u.BR===this))}}e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.XS=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,B.c)([T.i.filter((function(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];let[B,U,K,C,D]=R;return!Array.isArray(B)&&!Array.isArray(U)&&!Array.isArray(K)&&!Array.isArray(C)&&!Array.isArray(D)}))],e,"_ApplySkeleton",null),(0,f.e)("BABYLON.AbstractMesh",e)},13041:(u,R,I)=>{I.d(R,{b:()=>B.i});var B=I(12549)},12919:(u,R,I)=>{I.d(R,{d:()=>E});var B=I(12481),U=I(12518),K=I(12892),C=I(12549),D=I(12798),s=I(12921),t=I(12808),G=I(12294),S=I(12514),b=I(12824),r=I(12346),P=I(12528),X=I(12560);class E{get boundingBias(){return this._boundingBias}set boundingBias(u){this._boundingBias?this._boundingBias.B(u):this._boundingBias=u.clone(),this.pu(!0,null)}static CreateGeometryForMesh(u){const R=new E(E.RandomId(),u.eu());return R.gu(u),R}get meshes(){return this._meshes}constructor(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new B.PR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new B.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=R||r.e.LastCreatedScene,this._scene&&(this.id=u,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=U,I?this.setAllVerticesData(I,U):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),K&&(this.gu(K),K.bD(!0)))}get extend(){return this._extend}eu(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let u=0;u<this._meshes.length;u++)if(!this._meshes[u].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const u=new Set;for(const R in this._vertexBuffers)u.add(this._vertexBuffers[R].getWrapperBuffer());u.forEach((u=>{u._rebuild()}))}setAllVerticesData(u,R){u.applyToGeometry(this,R),this._notifyUpdate()}Zu(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;I&&Array.isArray(R)&&(R=new Float32Array(R));const U=new C.i(this._engine,R,u,{updatable:I,postponeInternalCreation:0===this._meshes.length,stride:B,label:"Geometry_"+this.id+"_"+u});this.setVerticesBuffer(U)}removeVerticesData(u){this._vertexBuffers[u]&&(this._vertexBuffers[u].dispose(),delete this._vertexBuffers[u]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const U=u.getKind();this._vertexBuffers[U]&&I&&this._vertexBuffers[U].dispose(),u._buffer&&u._buffer._increaseReferences(),this._vertexBuffers[U]=u;const K=this._meshes,D=K.length;if(U===C.i.PositionKind){this._totalVertices=R??u._maxVerticesCount,this._updateExtend(u.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const I=this._extend&&this._extend.minimum||new B.PR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),U=this._extend&&this._extend.maximum||new B.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let u=0;u<D;u++){const R=K[u];R.buildBoundingInfo(I,U),R._createGlobalSubMesh(R.isUnIndexed),R.bD(!0),R.synchronizeInstances()}}this._notifyUpdate(U)}updateVerticesDataDirectly(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=this.getVertexBuffer(u);U&&(U.updateDirectly(R,I,B),this._notifyUpdate(u))}updateVerticesData(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this.getVertexBuffer(u);B&&(B.update(R),u===C.i.PositionKind&&this.pu(I,R),this._notifyUpdate(u))}pu(u,R){if(u&&this._updateExtend(R),this._resetPointsArrayCache(),u){const u=this._meshes;for(const R of u){R.hasBoundingInfo?R.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):R.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const u=R.DD;for(const R of u)R.refreshBoundingInfo()}}}_bind(u,R,I,B){if(!u)return;void 0===R&&(R=this._indexBuffer);const U=this.getVertexBuffers();if(!U)return;if(R!=this._indexBuffer||!this._vertexArrayObjects&&!B)return void this._engine.bindBuffers(U,R,u,I);const K=B||this._vertexArrayObjects,C=this._engine;K[u.key]||(K[u.key]=C.recordVertexArrayObject(U,R,u,I)),C.bindVertexArrayObject(K[u.key],R)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(u,R,I){const B=this.getVertexBuffer(u);return B?B.getFloatData(this._totalVertices,I||R&&1!==this._meshes.length):null}copyVerticesData(u,R){const I=this.getVertexBuffer(u);if(!I)return;R[u]||(R[u]=new Float32Array(this._totalVertices*I.getSize()));const B=I.getData();B&&(0,X.g)(B,I.getSize(),I.type,I.byteOffset,I.byteStride,I.normalized,this._totalVertices,R[u])}isVertexBufferUpdatable(u){const R=this._vertexBuffers[u];return!!R&&R.isUpdatable()}getVertexBuffer(u){return this.isReady()?this._vertexBuffers[u]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(u){return this._vertexBuffers?void 0!==this._vertexBuffers[u]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}getVerticesDataKinds(){const u=[];let R;if(!this._vertexBuffers&&this._delayInfo)for(R in this._delayInfo)u.push(R);else for(R in this._vertexBuffers)u.push(R);return u}updateIndices(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const B=u.length!==this._indices.length;if(I||(this._indices=u.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,u,R),B)for(const u of this._meshes)u._createGlobalSubMesh(!0)}else this.setIndices(u,null,!0)}setIndexBuffer(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=u,this._totalVertices=R,this._totalIndices=I,u.is32Bits=null===B?R>65535:B;for(const U of this._meshes)U._createGlobalSubMesh(!0),U.synchronizeInstances();this._notifyUpdate()}setIndices(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=u,this._indexBufferIsUpdatable=I,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,I,"Geometry_"+this.id+"_IndexBuffer")),void 0!=R&&(this._totalVertices=R);for(const U of this._meshes)U._createGlobalSubMesh(!B),U.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}PD(u,R){if(!this.isReady())return null;const I=this._indices;return R||u&&1!==this._meshes.length?I.slice():I}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u&&this._vertexArrayObjects&&this._vertexArrayObjects[u.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[u.key]),delete this._vertexArrayObjects[u.key])}releaseForMesh(u,R){const I=this._meshes,B=I.indexOf(u);-1!==B&&(I.splice(B,1),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject(),u._geometry=null,0===I.length&&R&&this.dispose())}gu(u){if(u._geometry===this)return;const R=u._geometry;R&&R.releaseForMesh(u),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject();const I=this._meshes;u._geometry=this,u._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),I.push(u),this.isReady()?this._applyToMesh(u):this._boundingInfo&&u.setBoundingInfo(this._boundingInfo)}_updateExtend(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!u&&(u=this.getVerticesData(C.i.PositionKind),!u))return;this._extend=(0,b.g)(u,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(u){const R=this._meshes.length;for(const I in this._vertexBuffers)1===R&&this._vertexBuffers[I].create(),I===C.i.PositionKind&&(this._extend||this._updateExtend(),u.buildBoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(u.isUnIndexed),u.pu());1===R&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),u._syncGeometryWithMorphTargetManager(),u.synchronizeInstances()}_notifyUpdate(u){this.onGeometryUpdated&&this.onGeometryUpdated(this,u),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const R of this._meshes)R._markSubMeshesAsAttributesDirty()}load(u,R){2!==this.delayLoadState&&(this.isReady()?R&&R():(this.delayLoadState=2,this._queueLoad(u,R)))}_queueLoad(u,R){this.delayLoadingFile&&(u.addPendingData(this),u._loadFile(this.delayLoadingFile,(I=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(I),this),this.delayLoadState=1,this._delayInfo=[],u.removePendingData(this);const B=this._meshes,U=B.length;for(let u=0;u<U;u++)this._applyToMesh(B[u]);R&&R()}),void 0,!0))}toLeftHanded(){const u=this.PD(!1);if(null!=u&&u.length>0){for(let R=0;R<u.length;R+=3){const I=u[R+0];u[R+0]=u[R+2],u[R+2]=I}this.setIndices(u)}const R=this.getVerticesData(C.i.PositionKind,!1);if(null!=R&&R.length>0){for(let u=0;u<R.length;u+=3)R[u+2]=-R[u+2];this.Zu(C.i.PositionKind,R,!1)}const I=this.getVerticesData(C.i.NormalKind,!1);if(null!=I&&I.length>0){for(let u=0;u<I.length;u+=3)I[u+2]=-I[u+2];this.Zu(C.i.NormalKind,I,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const u=this.getVerticesData(C.i.PositionKind);if(!u||0===u.length)return!1;for(let R=3*this._positionsCache.length,I=this._positionsCache.length;R<u.length;R+=3,++I)this._positionsCache[I]=B.PR.TR(u,R);for(let R=0,I=0;R<u.length;R+=3,++I)this._positionsCache[I].set(u[0+R],u[1+R],u[2+R]);return this._positionsCache.length=u.length/3,this._positions=this._positionsCache,!0}C(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const I in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[I]);this._vertexArrayObjects={};const u=this._meshes,R=u.length;for(let I=0;I<R;I++)u[I]._invalidateInstanceVertexArrayObject()}}dispose(){const u=this._meshes,R=u.length;let I;for(I=0;I<R;I++)this.releaseForMesh(u[I]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const B in this._vertexBuffers)this._vertexBuffers[B].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const u=this._parentContainer.geometries.indexOf(this);u>-1&&this._parentContainer.geometries.splice(u,1),this._parentContainer=null}this._isDisposed=!0}i(u){const R=new K.b;R.indices=[];const I=this.PD();if(I)for(let K=0;K<I.length;K++)R.indices.push(I[K]);let B,U=!1,C=!1;for(B in this._vertexBuffers){const u=this.getVerticesData(B);if(u&&(u instanceof Float32Array?R.set(new Float32Array(u),B):R.set(u.slice(0),B),!C)){const u=this.getVertexBuffer(B);u&&(U=u.isUpdatable(),C=!U)}}const D=new E(u,this._scene,R,U);for(B in D.delayLoadState=this.delayLoadState,D.delayLoadingFile=this.delayLoadingFile,D._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)D._delayInfo=D._delayInfo||[],D._delayInfo.push(B);return D._boundingInfo=new t.c(this._extend.minimum,this._extend.maximum),D}serialize(){const u={};return u.id=this.id,u.uniqueId=this.uniqueId,u.updatable=this._updatable,S.e&&S.e.HasTags(this)&&(u.tags=S.e.GetTags(this)),u}_toNumberArray(u){return Array.isArray(u)?u:Array.prototype.slice.call(u)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const u in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,u)&&(this._vertexBuffers[u]._buffer._data=null)}serializeVerticeData(){const u=this.serialize();return this.isVerticesDataPresent(C.i.PositionKind)&&(u.Mu=this._toNumberArray(this.getVerticesData(C.i.PositionKind)),this.isVertexBufferUpdatable(C.i.PositionKind)&&(u.positionsUpdatable=!0)),this.isVerticesDataPresent(C.i.NormalKind)&&(u.ou=this._toNumberArray(this.getVerticesData(C.i.NormalKind)),this.isVertexBufferUpdatable(C.i.NormalKind)&&(u.normalsUpdatable=!0)),this.isVerticesDataPresent(C.i.TangentKind)&&(u.tangents=this._toNumberArray(this.getVerticesData(C.i.TangentKind)),this.isVertexBufferUpdatable(C.i.TangentKind)&&(u.tangentsUpdatable=!0)),this.isVerticesDataPresent(C.i.UVKind)&&(u.hu=this._toNumberArray(this.getVerticesData(C.i.UVKind)),this.isVertexBufferUpdatable(C.i.UVKind)&&(u.uvsUpdatable=!0)),this.isVerticesDataPresent(C.i.UV2Kind)&&(u.uvs2=this._toNumberArray(this.getVerticesData(C.i.UV2Kind)),this.isVertexBufferUpdatable(C.i.UV2Kind)&&(u.uvs2Updatable=!0)),this.isVerticesDataPresent(C.i.UV3Kind)&&(u.uvs3=this._toNumberArray(this.getVerticesData(C.i.UV3Kind)),this.isVertexBufferUpdatable(C.i.UV3Kind)&&(u.uvs3Updatable=!0)),this.isVerticesDataPresent(C.i.UV4Kind)&&(u.uvs4=this._toNumberArray(this.getVerticesData(C.i.UV4Kind)),this.isVertexBufferUpdatable(C.i.UV4Kind)&&(u.uvs4Updatable=!0)),this.isVerticesDataPresent(C.i.UV5Kind)&&(u.uvs5=this._toNumberArray(this.getVerticesData(C.i.UV5Kind)),this.isVertexBufferUpdatable(C.i.UV5Kind)&&(u.uvs5Updatable=!0)),this.isVerticesDataPresent(C.i.UV6Kind)&&(u.uvs6=this._toNumberArray(this.getVerticesData(C.i.UV6Kind)),this.isVertexBufferUpdatable(C.i.UV6Kind)&&(u.uvs6Updatable=!0)),this.isVerticesDataPresent(C.i.ColorKind)&&(u.ju=this._toNumberArray(this.getVerticesData(C.i.ColorKind)),this.isVertexBufferUpdatable(C.i.ColorKind)&&(u.colorsUpdatable=!0)),this.isVerticesDataPresent(C.i.MatricesIndicesKind)&&(u.matricesIndices=this._toNumberArray(this.getVerticesData(C.i.MatricesIndicesKind)),u.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(C.i.MatricesIndicesKind)&&(u.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(C.i.MatricesWeightsKind)&&(u.matricesWeights=this._toNumberArray(this.getVerticesData(C.i.MatricesWeightsKind)),this.isVertexBufferUpdatable(C.i.MatricesWeightsKind)&&(u.matricesWeightsUpdatable=!0)),u.indices=this._toNumberArray(this.PD()),u}static ExtractFromMesh(u,R){const I=u._geometry;return I?I.i(R):null}static RandomId(){return G.Tools.RandomId()}static _GetGeometryByLoadedUniqueId(u,R){for(let I=0;I<R.geometries.length;I++)if(R.geometries[I]._loadedUniqueId===u)return R.geometries[I];return null}static _ImportGeometry(u,R){const I=R.eu(),B=u.geometryUniqueId,K=u.geometryId;if(B||K){const u=B?this._GetGeometryByLoadedUniqueId(B,I):I.getGeometryById(K);u&&u.gu(R)}else if(u instanceof ArrayBuffer){const I=R._binaryInfo;if(I.positionsAttrDesc&&I.positionsAttrDesc.count>0){const B=new Float32Array(u,I.positionsAttrDesc.offset,I.positionsAttrDesc.count);R.Zu(C.i.PositionKind,B,!1)}if(I.normalsAttrDesc&&I.normalsAttrDesc.count>0){const B=new Float32Array(u,I.normalsAttrDesc.offset,I.normalsAttrDesc.count);R.Zu(C.i.NormalKind,B,!1)}if(I.tangetsAttrDesc&&I.tangetsAttrDesc.count>0){const B=new Float32Array(u,I.tangetsAttrDesc.offset,I.tangetsAttrDesc.count);R.Zu(C.i.TangentKind,B,!1)}if(I.uvsAttrDesc&&I.uvsAttrDesc.count>0){const B=new Float32Array(u,I.uvsAttrDesc.offset,I.uvsAttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UVKind,B,!1)}if(I.uvs2AttrDesc&&I.uvs2AttrDesc.count>0){const B=new Float32Array(u,I.uvs2AttrDesc.offset,I.uvs2AttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UV2Kind,B,!1)}if(I.uvs3AttrDesc&&I.uvs3AttrDesc.count>0){const B=new Float32Array(u,I.uvs3AttrDesc.offset,I.uvs3AttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UV3Kind,B,!1)}if(I.uvs4AttrDesc&&I.uvs4AttrDesc.count>0){const B=new Float32Array(u,I.uvs4AttrDesc.offset,I.uvs4AttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UV4Kind,B,!1)}if(I.uvs5AttrDesc&&I.uvs5AttrDesc.count>0){const B=new Float32Array(u,I.uvs5AttrDesc.offset,I.uvs5AttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UV5Kind,B,!1)}if(I.uvs6AttrDesc&&I.uvs6AttrDesc.count>0){const B=new Float32Array(u,I.uvs6AttrDesc.offset,I.uvs6AttrDesc.count);if(P.d)for(let u=1;u<B.length;u+=2)B[u]=1-B[u];R.Zu(C.i.UV6Kind,B,!1)}if(I.colorsAttrDesc&&I.colorsAttrDesc.count>0){const B=new Float32Array(u,I.colorsAttrDesc.offset,I.colorsAttrDesc.count);R.Zu(C.i.ColorKind,B,!1,I.colorsAttrDesc.stride)}if(I.matricesIndicesAttrDesc&&I.matricesIndicesAttrDesc.count>0){const B=new Int32Array(u,I.matricesIndicesAttrDesc.offset,I.matricesIndicesAttrDesc.count),U=[];for(let u=0;u<B.length;u++){const R=B[u];U.push(255&R),U.push((65280&R)>>8),U.push((16711680&R)>>16),U.push(R>>24&255)}R.Zu(C.i.MatricesIndicesKind,U,!1)}if(I.matricesIndicesExtraAttrDesc&&I.matricesIndicesExtraAttrDesc.count>0){const B=new Int32Array(u,I.matricesIndicesExtraAttrDesc.offset,I.matricesIndicesExtraAttrDesc.count),U=[];for(let u=0;u<B.length;u++){const R=B[u];U.push(255&R),U.push((65280&R)>>8),U.push((16711680&R)>>16),U.push(R>>24&255)}R.Zu(C.i.MatricesIndicesExtraKind,U,!1)}if(I.matricesWeightsAttrDesc&&I.matricesWeightsAttrDesc.count>0){const B=new Float32Array(u,I.matricesWeightsAttrDesc.offset,I.matricesWeightsAttrDesc.count);R.Zu(C.i.MatricesWeightsKind,B,!1)}if(I.indicesAttrDesc&&I.indicesAttrDesc.count>0){const B=new Int32Array(u,I.indicesAttrDesc.offset,I.indicesAttrDesc.count);R.setIndices(B,null)}if(I.subMeshesAttrDesc&&I.subMeshesAttrDesc.count>0){const B=new Int32Array(u,I.subMeshesAttrDesc.offset,5*I.subMeshesAttrDesc.count);R.DD=[];for(let u=0;u<I.subMeshesAttrDesc.count;u++){const I=B[5*u+0],U=B[5*u+1],K=B[5*u+2],C=B[5*u+3],s=B[5*u+4];D.b.AddToMesh(I,U,K,C,s,R)}}}else if(u.Mu&&u.ou&&u.indices){if(R.Zu(C.i.PositionKind,u.Mu,u.Mu._updatable||u.positionsUpdatable),R.Zu(C.i.NormalKind,u.ou,u.ou._updatable||u.normalsUpdatable),u.tangents&&R.Zu(C.i.TangentKind,u.tangents,u.tangents._updatable||u.tangentsUpdatable),u.hu&&R.Zu(C.i.UVKind,u.hu,u.hu._updatable||u.uvsUpdatable),u.uvs2&&R.Zu(C.i.UV2Kind,u.uvs2,u.uvs2._updatable||u.uvs2Updatable),u.uvs3&&R.Zu(C.i.UV3Kind,u.uvs3,u.uvs3._updatable||u.uvs3Updatable),u.uvs4&&R.Zu(C.i.UV4Kind,u.uvs4,u.uvs4._updatable||u.uvs4Updatable),u.uvs5&&R.Zu(C.i.UV5Kind,u.uvs5,u.uvs5._updatable||u.uvs5Updatable),u.uvs6&&R.Zu(C.i.UV6Kind,u.uvs6,u.uvs6._updatable||u.uvs6Updatable),u.ju&&R.Zu(C.i.ColorKind,U.TD.CheckColors4(u.ju,u.Mu.length/3),u.ju._updatable),u.matricesIndices)if(u.matricesIndices._isExpanded||u.matricesIndicesExpanded)delete u.matricesIndices._isExpanded,delete u.matricesIndicesExpanded,R.Zu(C.i.MatricesIndicesKind,u.matricesIndices,u.matricesIndices._updatable||u.matricesIndicesUpdatable);else{const I=[];for(let R=0;R<u.matricesIndices.length;R++){const B=u.matricesIndices[R];I.push(255&B),I.push((65280&B)>>8),I.push((16711680&B)>>16),I.push(B>>24&255)}R.Zu(C.i.MatricesIndicesKind,I,u.matricesIndices._updatable||u.matricesIndicesUpdatable)}if(u.matricesIndicesExtra)if(u.matricesIndicesExtraExpanded||u.matricesIndicesExtra._isExpanded)delete u.matricesIndices._isExpanded,delete u.matricesIndicesExtraExpanded,R.Zu(C.i.MatricesIndicesExtraKind,u.matricesIndicesExtra,u.matricesIndicesExtra._updatable||u.matricesIndicesExtraUpdatable);else{const I=[];for(let R=0;R<u.matricesIndicesExtra.length;R++){const B=u.matricesIndicesExtra[R];I.push(255&B),I.push((65280&B)>>8),I.push((16711680&B)>>16),I.push(B>>24&255)}R.Zu(C.i.MatricesIndicesExtraKind,I,u.matricesIndicesExtra._updatable||u.matricesIndicesExtraUpdatable)}u.matricesWeights&&(E._CleanMatricesWeights(u,R),R.Zu(C.i.MatricesWeightsKind,u.matricesWeights,u.matricesWeights._updatable)),u.matricesWeightsExtra&&R.Zu(C.i.MatricesWeightsExtraKind,u.matricesWeightsExtra,u.matricesWeights._updatable),R.setIndices(u.indices,null)}if(u.DD){R.DD=[];for(let I=0;I<u.DD.length;I++){const B=u.DD[I];D.b.AddToMesh(B.materialIndex,B.verticesStart,B.verticesCount,B.indexStart,B.indexCount,R)}}R._shouldGenerateFlatShading&&(R.convertToFlatShadedMesh(),R._shouldGenerateFlatShading=!1),R.bD(!0),I.onMeshImportedObservable.notifyObservers(R)}static _CleanMatricesWeights(u,R){const I=.001;if(!s.d.CleanBoneMatrixWeights)return;let B=0;if(!(u.skeletonId>-1))return;{const I=R.eu().getLastSkeletonById(u.skeletonId);if(!I)return;B=I.bones.length}const U=R.getVerticesData(C.i.MatricesIndicesKind),K=R.getVerticesData(C.i.MatricesIndicesExtraKind),D=u.matricesWeights,t=u.matricesWeightsExtra,G=u.numBoneInfluencer,S=D.length;for(let C=0;C<S;C+=4){let u=0,R=-1;for(let B=0;B<4;B++){const U=D[C+B];u+=U,U<I&&R<0&&(R=B)}if(t)for(let B=0;B<4;B++){const U=t[C+B];u+=U,U<I&&R<0&&(R=B+4)}if((R<0||R>G-1)&&(R=G-1),u>I){const R=1/u;for(let u=0;u<4;u++)D[C+u]*=R;if(t)for(let u=0;u<4;u++)t[C+u]*=R}else R>=4?(t[C+R-4]=1-u,K[C+R-4]=B):(D[C+R]=1-u,U[C+R]=B)}R.Zu(C.i.MatricesIndicesKind,U),u.matricesWeightsExtra&&R.Zu(C.i.MatricesIndicesExtraKind,K)}static Parse(u,R,I){const U=new E(u.id,R,void 0,u.updatable);return U._loadedUniqueId=u.uniqueId,S.e&&S.e.AddTagsTo(U,u.tags),u.delayLoadingFile?(U.delayLoadState=4,U.delayLoadingFile=I+u.delayLoadingFile,U._boundingInfo=new t.c(B.PR.TR(u.boundingBoxMinimum),B.PR.TR(u.boundingBoxMaximum)),U._delayInfo=[],u.hasUVs&&U._delayInfo.push(C.i.UVKind),u.hasUVs2&&U._delayInfo.push(C.i.UV2Kind),u.hasUVs3&&U._delayInfo.push(C.i.UV3Kind),u.hasUVs4&&U._delayInfo.push(C.i.UV4Kind),u.hasUVs5&&U._delayInfo.push(C.i.UV5Kind),u.hasUVs6&&U._delayInfo.push(C.i.UV6Kind),u.hasColors&&U._delayInfo.push(C.i.ColorKind),u.hasMatricesIndices&&U._delayInfo.push(C.i.MatricesIndicesKind),u.hasMatricesWeights&&U._delayInfo.push(C.i.MatricesWeightsKind),U._delayLoadingFunction=K.b.ImportVertexData):K.b.ImportVertexData(u,U),R.pushGeometry(U,!0),U}}},12903:(u,R,I)=>{I.d(R,{d:()=>b});var B=I(12481),U=I(12315),K=I(12890),C=I(12907),D=I(12320),s=I(12883),t=I(12549),G=I(12294),S=I(12433);C.b._instancedMeshFactory=(u,R)=>{const I=new b(u,R);if(R.instancedBuffers){I.instancedBuffers={};for(const u in R.instancedBuffers)I.instancedBuffers[u]=R.instancedBuffers[u]}return I};class b extends K.b{constructor(u,R){super(u,R.eu()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,R.ur(this),this._sourceMesh=R,this._unIndexed=R._unIndexed,this.position.B(R.position),this.rotation.B(R.rotation),this.zD.B(R.zD),R.rotationQuaternion&&(this.rotationQuaternion=R.rotationQuaternion.clone()),this.animations=R.animations.slice();for(const I of R.getAnimationRanges())null!=I&&this.createAnimationRange(I.name,I.from,I.to);if(this.infiniteDistance=R.infiniteDistance,this.setPivotMatrix(R.getPivotMatrix()),R.skeleton||R.morphTargetManager||!R.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const u=R.getBoundingInfo();this.buildBoundingInfo(u.minimum,u.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(u){var R;(null===(R=this._sourceMesh)||void 0===R?void 0:R.receiveShadows)!==u&&G.Tools.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(u){var R;(null===(R=this._sourceMesh)||void 0===R?void 0:R.material)!==u&&G.Tools.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(u){var R;(null===(R=this._sourceMesh)||void 0===R?void 0:R.visibility)!==u&&G.Tools.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(u){var R;(null===(R=this._sourceMesh)||void 0===R?void 0:R.skeleton)!==u&&G.Tools.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(u){this._sourceMesh&&u!==this._sourceMesh.renderingGroupId&&U.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get rD(){return this._sourceMesh._geometry}createInstance(u){return this._sourceMesh.createInstance(u)}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(u,!0)}getVerticesData(u,R,I){return this._sourceMesh.getVerticesData(u,R,I)}copyVerticesData(u,R){this._sourceMesh.copyVerticesData(u,R)}Zu(u,R,I,B){return this.sourceMesh&&this.sourceMesh.Zu(u,R,I,B),this.sourceMesh}updateVerticesData(u,R,I,B){return this.sourceMesh&&this.sourceMesh.updateVerticesData(u,R,I,B),this.sourceMesh}setIndices(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(u,R),this.sourceMesh}isVerticesDataPresent(u){return this._sourceMesh.isVerticesDataPresent(u)}PD(){return this._sourceMesh.PD()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let u,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;u="object"===typeof R?R:{applySkeleton:R,applyMorph:I};const B=this._sourceMesh.rD?this._sourceMesh.rD.boundingBias:null;return this.lu(this._sourceMesh._getData(u,null,t.i.PositionKind),B),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(u,R){if(super._activate(u,R),this._sourceMesh.DD||U.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,u),R){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==s.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new B.Matrix);const u=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,B.TmpVectors.PR[7].B(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.B(this._currentLOD.bD(!0)),this._currentLOD.position.B(B.TmpVectors.PR[7]),this._currentLOD._masterMesh=u,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(u){if(!u)return this;const R=this.sourceMesh.getLODLevels();if(R&&0!==R.length){const R=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(u,R.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(u){return this.sourceMesh._preActivateForIntermediateRendering(u)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.DD)for(let u=0;u<this._sourceMesh.DD.length;u++)this._sourceMesh.DD[u].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}pu(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;const B=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(u);if(D.d.DeepCopy(this,B,["name","DD","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","FS","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","rD"],[]),this.refreshBoundingInfo(),R&&(B.parent=R),!I)for(let U=0;U<this.eu().meshes.length;U++){const u=this.eu().meshes[U];u.parent===this&&u.clone(u.name,B)}return B.bD(!0),this.onClonedObservable.notifyObservers(B),B}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.mr(this),super.dispose(u,R)}_serializeAsParent(u){super._serializeAsParent(u),u.parentId=this._sourceMesh.uniqueId,u.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0,R&&R.newSourcedMesh);B&&I&&I(this,B);for(const U of this.getChildTransformNodes(!0))U.instantiateHierarchy(B,R,I);return B}}C.b.prototype.registerInstancedBuffer=function(u,R){var I,B;if(null===(I=this._userInstancedBuffersStorage)||void 0===I||null===(B=I.vertexBuffers[u])||void 0===B||B.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const u of this.instances)u.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[u]=null,this._userInstancedBuffersStorage.strides[u]=R,this._userInstancedBuffersStorage.sizes[u]=32*R,this._userInstancedBuffersStorage.data[u]=new Float32Array(this._userInstancedBuffersStorage.sizes[u]),this._userInstancedBuffersStorage.vertexBuffers[u]=new t.i(this.getEngine(),this._userInstancedBuffersStorage.data[u],u,!0,!1,R,!0);for(const U of this.instances)U.instancedBuffers[u]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},C.b.prototype._processInstancedBuffers=function(u,R){const I=u?u.length:0;for(const B in this.instancedBuffers){let U=this._userInstancedBuffersStorage.sizes[B];const K=this._userInstancedBuffersStorage.strides[B],C=(I+1)*K;for(;U<C;)U*=2;this._userInstancedBuffersStorage.data[B].length!=U&&(this._userInstancedBuffersStorage.data[B]=new Float32Array(U),this._userInstancedBuffersStorage.sizes[B]=U,this._userInstancedBuffersStorage.vertexBuffers[B]&&(this._userInstancedBuffersStorage.vertexBuffers[B].dispose(),this._userInstancedBuffersStorage.vertexBuffers[B]=null));const D=this._userInstancedBuffersStorage.data[B];let s=0;if(R){const u=this.instancedBuffers[B];u.toArray?u.toArray(D,s):u.copyToArray?u.copyToArray(D,s):D[s]=u,s+=K}for(let R=0;R<I;R++){const I=u[R].instancedBuffers[B];I.toArray?I.toArray(D,s):I.copyToArray?I.copyToArray(D,s):D[s]=I,s+=K}this._userInstancedBuffersStorage.vertexBuffers[B]?this._userInstancedBuffersStorage.vertexBuffers[B].updateDirectly(D,0):(this._userInstancedBuffersStorage.vertexBuffers[B]=new t.i(this.getEngine(),this._userInstancedBuffersStorage.data[B],B,!0,!1,K,!0),this._invalidateInstanceVertexArrayObject())}},C.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const u in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[u]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},C.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const u in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[u]&&this._userInstancedBuffersStorage.vertexBuffers[u].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,S.e)("BABYLON.InstancedMesh",b)},13002:(u,R,I)=>{I.d(R,{c:()=>t});var B=I(12518),U=I(12549),K=I(12907),C=I(12903),D=I(12796),s=I(12701);K.b._LinesMeshParser=(u,R)=>t.Parse(u,R);class t extends K.b{_isShaderMaterial(u){return"ShaderMaterial"===u.getClassName()}constructor(u){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0,D=arguments.length>7?arguments[7]:void 0;super(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R,arguments.length>4?arguments[4]:void 0),this.useVertexColor=K,this.useVertexAlpha=C,this.color=new B.fR(1,1,1),this.alpha=1,this._shaderLanguage=0,R&&(this.color=R.color.clone(),this.alpha=R.alpha,this.useVertexColor=R.useVertexColor,this.useVertexAlpha=R.useVertexAlpha),this.intersectionThreshold=.1;const G={attributes:[U.i.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?G.defines.push("#define VERTEXALPHA"):G.needAlphaBlending=!1,this.useVertexColor?(G.defines.push("#define VERTEXCOLOR"),G.attributes.push(U.i.ColorKind)):(G.uniforms.push("color"),this._color4=new B.TD),D)this.material=D;else{this.eu().getEngine().isWebGPU&&!t.ForceGLSL&&(this._shaderLanguage=1),G.shaderLanguage=this._shaderLanguage,G.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([I.e(44).then(I.bind(I,15581)),I.e(40).then(I.bind(I,15589))]):await Promise.all([I.e(38).then(I.bind(I,15597)),I.e(37).then(I.bind(I,15600))])},this.material=new s.ShaderMaterial("colorShader",this.eu(),"color",G,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(u){this._lineMaterial=u,this._lineMaterial.fillMode=D.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(u){}_bind(u,R){if(!this._geometry)return this;const I=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(R,I):this._geometry._bind(R,I,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:u,g:R,b:I}=this.color;this._color4.set(u,R,I,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(u,R,I){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const B=this.eu().getEngine();return this._unIndexed?B.drawArraysType(D.c.LineListDrawMode,u.verticesStart,u.verticesCount,I):B.drawElementsType(D.c.LineListDrawMode,u.indexStart,u.indexCount,I),this}dispose(u){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(u)}clone(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;if(R&&void 0===R._addToSceneRootNodes){const I=R;return I.source=this,new t(u,this.eu(),I.parent,I.source,I.doNotCloneChildren)}return new t(u,this.eu(),R,this,I)}createInstance(u){const R=new G(u,this);if(this.instancedBuffers){R.instancedBuffers={};for(const u in this.instancedBuffers)R.instancedBuffers[u]=this.instancedBuffers[u]}return R}serialize(u){super.serialize(u),u.color=this.color.sD(),u.alpha=this.alpha}static Parse(u,R){const I=new t(u.name,R);return I.color=B.fR.TR(u.color),I.alpha=u.alpha,I}}t.ForceGLSL=!1;class G extends C.d{constructor(u,R){super(u,R),this.intersectionThreshold=R.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},12907:(u,R,I)=>{I.d(R,{b:()=>p,c:()=>o});var B=I(12303),U=I(12294),K=I(12320),C=I(12514),D=I(12894),s=I(12910),t=I(12481),G=I(12518),S=I(12888),b=I(12549),r=I(12892),P=I(12919),X=I(12890),E=I(12798),z=I(12796),f=I(12929),T=I(12921),Q=I(12507),V=I(12315),q=I(12433),e=I(12335),Y=I(12740);class M{constructor(u,R){this.distanceOrScreenCoverage=u,this.mesh=R}}class o{}class j{constructor(){this.visibleInstances={},this.batchCache=new h,this.batchCacheReplacementModeInFrozenMode=new h,this.instancesBufferSize=2048}}class h{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class x{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class g{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const v={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class p extends X.b{static _GetDefaultSideOrientation(u){return u||p.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(u){this._internalMeshDataInfo._useLODScreenCoverage=u,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(u&&this._internalMeshDataInfo._sourcePositions&&(this.Zu(b.i.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Zu(b.i.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new B.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new B.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new B.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new B.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new B.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(u){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(u)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(u){this._internalMeshDataInfo._forcedInstanceCount=u}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(u){this._internalMeshDataInfo._sideOrientation=u,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===u||!this._scene.useRightHandedSystem&&0===u}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(u){this.sideOrientation=u,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(u){this._internalMeshDataInfo._overrideRenderingFillMode=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){u&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(u.sideOrientation=null),this._setMaterial(u)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(u){this._unIndexed!==u&&(this._unIndexed=u,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(u){this._instanceDataStorage.manualUpdate=u}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(u){this._instanceDataStorage.previousManualUpdate=u}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(u){this._instanceDataStorage.forceMatrixUpdates=u}_copySource(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=this.eu();if(u._geometry&&u._geometry.gu(this),K.d.DeepCopy(u,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","rD","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","FS","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=u,U.useClonedMeshMap&&(u._internalMeshDataInfo.meshMap||(u._internalMeshDataInfo.meshMap={}),u._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=u._originalBuilderSideOrientation,this._creationDataStorage=u._creationDataStorage,u._ranges){const R=u._ranges;for(const u in R)Object.prototype.hasOwnProperty.call(R,u)&&R[u]&&this.createAnimationRange(u,R[u].from,R[u].to)}if(u.metadata&&u.metadata.clone?this.metadata=u.metadata.clone():this.metadata=u.metadata,this._internalMetadata=u._internalMetadata,C.e&&C.e.HasTags(u)&&C.e.AddTagsTo(this,C.e.GetTags(u,!0)),this.WD(u.isEnabled(!1)),this.parent=u.parent,this.setPivotMatrix(u.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+u.id,this.material=u.material,!R){const U=u.getDescendants(!0);for(let u=0;u<U.length;u++){const K=U[u];K._isMesh?(v.parent=this,v.doNotCloneChildren=R,v.clonePhysicsImpostor=I,v.cloneThinInstances=B,K.clone(this.name+"."+K.name,v)):K.clone&&K.clone(this.name+"."+K.name,this)}}if(u.morphTargetManager&&(this.morphTargetManager=u.morphTargetManager),U.getPhysicsEngine){const R=U.getPhysicsEngine();if(I&&R)if(1===R.getPluginVersion()){const I=R.getImpostorForPhysicsObject(u);I&&(this.physicsImpostor=I.clone(this))}else 2===R.getPluginVersion()&&u.physicsBody&&u.physicsBody.clone(this)}for(let K=0;K<U.nS.length;K++){const R=U.nS[K];R.BR===u&&R.clone(R.name,this)}if(this.skeleton=u.skeleton,B&&(u._thinInstanceDataStorage.matrixData?(this.zS("matrix",new Float32Array(u._thinInstanceDataStorage.matrixData),16,!u._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=u._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=u._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=u._thinInstanceDataStorage.matrixBufferSize,u._userThinInstanceBuffersStorage)){const R=u._userThinInstanceBuffersStorage;for(const u in R.data){var D,s;this.zS(u,new Float32Array(R.data[u]),R.strides[u],!(null!==(D=R.vertexBuffers)&&void 0!==D&&null!==(s=D[u])&&void 0!==s&&s.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[u]=R.sizes[u]}}this.refreshBoundingInfo(!0,!0),this.bD(!0)}constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0,C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(u,R),this._internalMeshDataInfo=new g,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new j,this._thinInstanceDataStorage=new x,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=p.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,R=this.eu(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(u,R,I)=>{u&&I&&(this._uniformBuffer?this.transferToEffect(R):I.bindOnlyWorldMatrix(R))};let D=null,s=!1;if(I&&void 0===I._addToSceneRootNodes){const u=I;D=u.parent??null,U=u.source??null,K=u.doNotCloneChildren??!1,C=u.clonePhysicsImpostor??!0,s=u.cloneThinInstances??!1}else D=I;U&&this._copySource(U,K,C,s),null!==D&&(this.parent=D),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=u=>{u.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new B.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),U&&U.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;const B=0===this.getTotalVertices()||R&&R.doNotInstantiate&&(!0===R.doNotInstantiate||R.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),u||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));B.parent=u||this.parent,B.position=this.position.clone(),B.zD=this.zD.clone(),this.rotationQuaternion?B.rotationQuaternion=this.rotationQuaternion.clone():B.rotation=this.rotation.clone(),I&&I(this,B);for(const U of this.getChildTransformNodes(!0))"InstancedMesh"===U.getClassName()&&"Mesh"===B.getClassName()&&U.sourceMesh===this?U.instantiateHierarchy(B,{doNotInstantiate:R&&R.doNotInstantiate||!1,newSourcedMesh:B},I):U.instantiateHierarchy(B,R,I);return B}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(u){let R=super.toString(u);if(R+=", n vertices: "+this.getTotalVertices(),R+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let I=0;I<this.animations.length;I++)R+=", animation[0]: "+this.animations[I].toString(u);if(u)if(this._geometry){const u=this.PD(),I=this.getVerticesData(b.i.PositionKind);I&&u&&(R+=", flat shading: "+(I.length/3===u.length?"YES":"NO"))}else R+=", flat shading: UNKNOWN";return R}_unBindEffect(){super._unBindEffect();for(const u of this.instances)u._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const u=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((R,I)=>R.distanceOrScreenCoverage<I.distanceOrScreenCoverage?u:R.distanceOrScreenCoverage>I.distanceOrScreenCoverage?-u:0))}addLODLevel(u,R){if(R&&R._masterMesh)return V.b.Warn("You cannot use a mesh as LOD level twice"),this;const I=new M(u,R);return this._internalMeshDataInfo._LODLevels.push(I),R&&(R._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(u){const R=this._internalMeshDataInfo;for(let I=0;I<R._LODLevels.length;I++){const B=R._LODLevels[I];if(B.distanceOrScreenCoverage===u)return B.mesh}return null}removeLODLevel(u){const R=this._internalMeshDataInfo;for(let I=0;I<R._LODLevels.length;I++)R._LODLevels[I].mesh===u&&(R._LODLevels.splice(I,1),u&&(u._masterMesh=null));return this._sortLODLevels(),this}getLOD(u,R){const I=this._internalMeshDataInfo;if(!I._LODLevels||0===I._LODLevels.length)return this;const B=R||this.getBoundingInfo().boundingSphere,U=u.mode===s.e.ORTHOGRAPHIC_CAMERA?u.GD:B.centerWorld.XR(u.globalPosition).length();let K=U,C=1;if(I._useLODScreenCoverage){const R=u.screenArea;let I=B.radiusWorld*u.GD/U;I=I*I*Math.PI,K=I/R,C=-1}if(C*I._LODLevels[I._LODLevels.length-1].distanceOrScreenCoverage>C*K)return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,this),this;for(let D=0;D<I._LODLevels.length;D++){const u=I._LODLevels[D];if(C*u.distanceOrScreenCoverage<C*K){if(u.mesh){if(4===u.mesh.delayLoadState)return u.mesh._checkDelayState(),this;if(2===u.mesh.delayLoadState)return this;u.mesh._preActivate(),u.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,u.mesh),u.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,this),this}get rD(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(u,R,I,B){var U,K;if(!this._geometry)return null;let C=B||null===(U=this._userInstancedBuffersStorage)||void 0===U||null===(K=U.vertexBuffers[u])||void 0===K?void 0:K.getFloatData(this.instances.length+1,I||R&&1!==this._geometry.meshes.length);return C||(C=this._geometry.getVerticesData(u,R,I)),C}copyVerticesData(u,R){this._geometry&&this._geometry.copyVerticesData(u,R)}getVertexBuffer(u,R){var I;return this._geometry?(R||null===(I=this._userInstancedBuffersStorage)||void 0===I?void 0:I.vertexBuffers[u])??this._geometry.getVertexBuffer(u):null}isVerticesDataPresent(u,R){var I;return this._geometry?!R&&void 0!==(null===(I=this._userInstancedBuffersStorage)||void 0===I?void 0:I.vertexBuffers[u])||this._geometry.isVerticesDataPresent(u):!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}isVertexBufferUpdatable(u,R){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(u);if(!R){var I;const R=null===(I=this._userInstancedBuffersStorage)||void 0===I?void 0:I.vertexBuffers[u];if(R)return R.isUpdatable()}return this._geometry.isVertexBufferUpdatable(u)}getVerticesDataKinds(u){if(!this._geometry){const u=[];if(this._delayInfo)for(const R of this._delayInfo)u.push(R);return u}const R=this._geometry.getVerticesDataKinds();if(!u&&this._userInstancedBuffersStorage)for(const I in this._userInstancedBuffersStorage.vertexBuffers)-1===R.indexOf(I)&&R.push(I);return R}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}PD(u,R){return this._geometry?this._geometry.PD(u,R):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(u))return!1;if(!this.DD||0===this.DD.length)return!0;if(!u)return!0;const I=this.getEngine(),B=this.eu(),U=R||I.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.bD();const K=this.material||B.defaultMaterial;if(K)if(K._storeEffectOnSubMeshes)for(const b of this.DD){const u=b.cu();if(u)if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,b,U))return!1}else if(!u.isReady(this,U))return!1}else if(!K.isReady(this,U))return!1;const C=I.currentRenderPassId;for(const b of this.lightSources){const u=b.getShadowGenerators();if(!u)continue;const R=u.values();for(let B=R.next();!0!==B.done;B=R.next()){var D,s,t,G;const u=B.value;if(u&&(null===(D=u.getShadowMap())||void 0===D||!D.renderList||null!==(s=u.getShadowMap())&&void 0!==s&&s.renderList&&-1!==(null===(t=u.getShadowMap())||void 0===t||null===(G=t.renderList)||void 0===G?void 0:G.indexOf(this)))){const R=u.getShadowMap().renderPassIds??[I.currentRenderPassId];for(let B=0;B<R.length;++B){I.currentRenderPassId=R[B];for(const R of this.DD){var S;if(!u.isReady(R,U,(null===(S=R.cu())||void 0===S?void 0:S.needAlphaBlendingForMesh(this))??!1))return I.currentRenderPassId=C,!1}}I.currentRenderPassId=C}}}for(const b of this._internalMeshDataInfo._LODLevels)if(b.mesh&&!b.mesh.isReady(U))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}YG(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(u){this._instanceDataStorage.overridenInstanceCount=u}_preActivate(){const u=this._internalMeshDataInfo,R=this.eu().getRenderId();return u._preActivateId===R||(u._preActivateId=R,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(u){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=u),this}_registerInstanceForRenderId(u,R){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:R,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[R]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=R,this._instanceDataStorage.visibleInstances[R]=new Array),this._instanceDataStorage.visibleInstances[R].push(u),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.vu||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let u,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;u="object"===typeof R?R:{applySkeleton:R,applyMorph:I};const B=this.rD?this.rD.boundingBias:null;return this.lu(this._getData(u,null,b.i.PositionKind),B),this}_createGlobalSubMesh(u){const R=this.getTotalVertices();if(!R||!this.PD())return null;if(this.DD&&this.DD.length>0){const I=this.PD();if(!I)return null;const B=I.length;let U=!1;if(u)U=!0;else for(const u of this.DD){if(u.indexStart+u.indexCount>B){U=!0;break}if(u.verticesStart+u.verticesCount>R){U=!0;break}}if(!U)return this.DD[0]}return this.releaseSubMeshes(),new E.b(0,0,R,0,this.getTotalIndices()||R,this)}subdivide(u){if(u<1)return;const R=this.getTotalIndices();let I=R/u|0,B=0;for(;I%3!==0;)I++;this.releaseSubMeshes();for(let U=0;U<u&&!(B>=R);U++)E.b.CreateFromIndices(0,B,U===u-1?R-B:I,this,void 0,!1),B+=I;this.refreshBoundingInfo(),this.synchronizeInstances()}Zu(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Zu(u,R,I,B);else{const B=new r.b;B.set(R,u);const U=this.eu();new P.d(P.d.RandomId(),U,B,I,this)}return this}removeVerticesData(u){this._geometry&&this._geometry.removeVerticesData(u)}markVerticesDataAsUpdatable(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=this.getVertexBuffer(u);I&&I.isUpdatable()!==R&&this.Zu(u,this.getVerticesData(u),R)}setVerticesBuffer(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=P.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(u,null,R),this}updateVerticesData(u,R,I,B){return this._geometry?(B?(this.makeGeometryUnique(),this.updateVerticesData(u,R,I,!1)):this._geometry.updateVerticesData(u,R,I),this):this}updateMeshPositions(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=this.getVerticesData(b.i.PositionKind);if(!I)return this;if(u(I),this.updateVerticesData(b.i.PositionKind,I,!1,!1),R){const u=this.PD(),R=this.getVerticesData(b.i.NormalKind);if(!R)return this;r.b.ComputeNormals(I,u,R),this.updateVerticesData(b.i.NormalKind,R,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const u=this._geometry,R=this._geometry.i(P.d.RandomId());return u.releaseForMesh(this,!0),R.gu(this),this}setIndexBuffer(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=this._geometry;U||(U=new P.d(P.d.RandomId(),this.eu(),void 0,void 0,this)),U.setIndexBuffer(u,R,I,B)}setIndices(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(u,R,I,B);else{const R=new r.b;R.indices=u;const B=this.eu();new P.d(P.d.RandomId(),B,R,I,this)}return this}updateIndices(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(u,R,I),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(u,R,I){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const U=this.eu().getEngine();let K;if(this._unIndexed)if(this._getRenderingFillMode(I)===z.c.WireFrameFillMode)K=u._getLinesIndexBuffer(this.PD(),U);else K=null;else switch(this._getRenderingFillMode(I)){case z.c.PointFillMode:K=null;break;case z.c.WireFrameFillMode:K=u._getLinesIndexBuffer(this.PD(),U);break;default:case z.c.TriangleFillMode:K=this._geometry.getIndexBuffer()}return this._bindDirect(R,K,B)}_bindDirect(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(u),I&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(u,R,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(u,R),this):this}_draw(u,R,I){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const B=this.eu().getEngine();return this._unIndexed&&R!==z.c.WireFrameFillMode||R==z.c.PointFillMode?B.drawArraysType(R,u.verticesStart,u.verticesCount,this.forcedInstanceCount||I):R==z.c.WireFrameFillMode?B.drawElementsType(R,0,u._linesIndexCount,this.forcedInstanceCount||I):B.drawElementsType(R,u.indexStart,u.indexCount,this.forcedInstanceCount||I),this}registerBeforeRender(u){return this.onBeforeRenderObservable.add(u),this}unregisterBeforeRender(u){return this.onBeforeRenderObservable.removeCallback(u),this}registerAfterRender(u){return this.onAfterRenderObservable.add(u),this}unregisterAfterRender(u){return this.onAfterRenderObservable.removeCallback(u),this}_getInstancesRenderList(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(R)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[u]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[u]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const I=this.eu(),B=I._isInIntermediateRendering(),U=B?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,K=this._instanceDataStorage.batchCache;if(K.mustReturn=!1,K.renderSelf[u]=R||!U&&this.isEnabled()&&this.isVisible,K.visibleInstances[u]=null,this._instanceDataStorage.visibleInstances&&!R){const R=this._instanceDataStorage.visibleInstances,U=I.getRenderId(),C=B?R.intermediateDefaultRenderId:R.defaultRenderId;K.visibleInstances[u]=R[U],!K.visibleInstances[u]&&C&&(K.visibleInstances[u]=R[C])}return K.hardwareInstancedRendering[u]=!R&&this._instanceDataStorage.hardwareInstancedRendering&&null!==K.visibleInstances[u]&&void 0!==K.visibleInstances[u],this._instanceDataStorage.previousBatch=K,K}_updateInstancedBuffers(u,R,I,B,U,K){const C=R.visibleInstances[u._id],D=C?C.length:0,s=this._instanceDataStorage;let G=s.instancesBuffer,S=s.instancesPreviousBuffer,r=0,P=0;const X=R.renderSelf[u._id],E=!G||I!==s.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!s.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||s.isFrozen&&!E)P=(X?1:0)+D;else{const R=this.getWorldMatrix();if(X&&(this._scene.needsPreviousWorldMatrices&&(s.masterMeshPreviousWorldMatrix?(s.masterMeshPreviousWorldMatrix.copyToArray(s.instancesPreviousData,r),s.masterMeshPreviousWorldMatrix.B(R)):(s.masterMeshPreviousWorldMatrix=R.clone(),s.masterMeshPreviousWorldMatrix.copyToArray(s.instancesPreviousData,r))),R.copyToArray(s.instancesData,r),r+=16,P++),C){var z;if(p.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(z=u.cu())&&void 0!==z&&z.needAlphaBlendingForMesh(u.getRenderingMesh())){const u=this._scene.activeCamera.globalPosition;for(let R=0;R<C.length;R++){const I=C[R];I._distanceToCamera=t.PR.Distance(I.getBoundingInfo().boundingSphere.centerWorld,u)}C.sort(((u,R)=>u._distanceToCamera>R._distanceToCamera?-1:u._distanceToCamera<R._distanceToCamera?1:0))}for(let u=0;u<C.length;u++){const R=C[u],I=R.getWorldMatrix();I.copyToArray(s.instancesData,r),this._scene.needsPreviousWorldMatrices&&(R._previousWorldMatrix?(R._previousWorldMatrix.copyToArray(s.instancesPreviousData,r),R._previousWorldMatrix.B(I)):(R._previousWorldMatrix=I.clone(),R._previousWorldMatrix.copyToArray(s.instancesPreviousData,r))),r+=16,P++}}}E?(G&&G.dispose(),S&&S.dispose(),G=new b.e(B,s.instancesData,!0,16,!1,!0),s.instancesBuffer=G,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=G.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=G.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=G.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=G.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(S=new b.e(B,s.instancesPreviousData,!0,16,!1,!0),s.instancesPreviousBuffer=S,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=S.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=S.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=S.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=S.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(G.updateDirectly(s.instancesData,0,P),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||S.updateDirectly(s.instancesPreviousData,0,P)),this._processInstancedBuffers(C,X),K&&void 0!==U&&(this.eu()._activeIndices.addCount(u.indexCount*P,!1),B._currentDrawContext&&(B._currentDrawContext.useInstancing=!0),this._bind(u,K,U),this._draw(u,U,P)),!this._scene.needsPreviousWorldMatrices||E||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||S.updateDirectly(s.instancesData,0,P)}_renderWithInstances(u,R,I,B,U){const K=I.visibleInstances[u._id],C=K?K.length:0,D=this._instanceDataStorage,s=D.instancesBufferSize,t=16*(C+1)*4;for(;D.instancesBufferSize<t;)D.instancesBufferSize*=2;return D.instancesData&&s==D.instancesBufferSize||(D.instancesData=new Float32Array(D.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!D.instancesPreviousData||s!=D.instancesBufferSize)&&(D.instancesPreviousData=new Float32Array(D.instancesBufferSize/4)),this._updateInstancedBuffers(u,I,s,U,R,B),U.unbindInstanceAttributes(),this}_renderWithThinInstances(u,R,I,B){var U;const K=(null===(U=this._thinInstanceDataStorage)||void 0===U?void 0:U.instancesCount)??0;this.eu()._activeIndices.addCount(u.indexCount*K,!1),B._currentDrawContext&&(B._currentDrawContext.useInstancing=!0),this._bind(u,I,R),this._draw(u,R,K),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,K):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),B.unbindInstanceAttributes()}_processInstancedBuffers(u,R){}_processRendering(u,R,I,B,U,K,C,D){const s=this.eu(),t=s.getEngine();if(B=this._getRenderingFillMode(B),K&&R.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(R,B,I,t),this;if(K)this._renderWithInstances(R,B,U,I,t);else{t._currentDrawContext&&(t._currentDrawContext.useInstancing=!1);let I=0;U.renderSelf[R._id]&&(C&&C(!1,u.getWorldMatrix(),D),I++,this._draw(R,B,this._instanceDataStorage.overridenInstanceCount));const K=U.visibleInstances[R._id];if(K){const u=K.length;I+=u;for(let I=0;I<u;I++){const u=K[I].getWorldMatrix();C&&C(!0,u,D),this._draw(R,B)}}s._activeIndices.addCount(R.indexCount*I,!1)}return this}_rebuild(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(u&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const R in this._userInstancedBuffersStorage.vertexBuffers){const I=this._userInstancedBuffersStorage.vertexBuffers[R];I&&(u&&I.dispose(),this._userInstancedBuffersStorage.vertexBuffers[R]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(u)}_freeze(){if(this.DD){for(let u=0;u<this.DD.length;u++)this._getInstancesRenderList(u);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(u,R,I,B){let U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const K=this._scene.getEngine(),C=K.currentRenderPassId;if(void 0!==u&&(K.currentRenderPassId=u),B)(!U||U&&B.isInFrustum(this._scene._frustumPlanes))&&this.render(B,!!R,I);else for(let D=0;D<this.DD.length;D++){const u=this.DD[D];(!U||U&&u.isInFrustum(this._scene._frustumPlanes))&&this.render(u,!!R,I)}return void 0!==u&&(K.currentRenderPassId=C),this}directRender(){if(!this.DD)return this;for(const u of this.DD)this.render(u,!1);return this}render(u,R,I){var B,U,K;const C=this.eu();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const D=(null===(B=C.activeCameras)||void 0===B?void 0:B.length)??0;if((D>1&&C.activeCamera===C.activeCameras[0]||D<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const s=this._getInstancesRenderList(u._id,!!I);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const t=C.getEngine();let G=0,S=null;this.ignoreCameraMaxZ&&C.activeCamera&&!C._isInIntermediateRendering()&&(G=C.activeCamera.maxZ,S=C.activeCamera,C.activeCamera.maxZ=0,C.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const b=u.getRenderingMesh(),r=s.hardwareInstancedRendering[u._id]||b.hasThinInstances||!!this._userInstancedBuffersStorage&&!u.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,P=this._instanceDataStorage,X=u.cu();if(!X)return S&&(S.maxZ=G,C.updateTransformMatrix(!0)),this;if(P.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===X){if(X._storeEffectOnSubMeshes&&(null===(U=u._drawWrapper)||void 0===U||!U._wasPreviouslyReady)||!X._storeEffectOnSubMeshes&&!X._getDrawWrapper()._wasPreviouslyReady)return S&&(S.maxZ=G,C.updateTransformMatrix(!0)),this}else{if(X._storeEffectOnSubMeshes){if(!X.isReadyForSubMesh(this,u,r))return S&&(S.maxZ=G,C.updateTransformMatrix(!0)),this}else if(!X.isReady(this,r))return S&&(S.maxZ=G,C.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=X}let E;R&&t.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),E=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?u._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const f=(null===(K=E)||void 0===K?void 0:K.effect)??null;for(const z of C._beforeRenderingMeshStage)z.action(this,u,s,f);if(!E||!f)return S&&(S.maxZ=G,C.updateTransformMatrix(!0)),this;const T=I||this;let Q;if(P.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.XD&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)Q=P.sideOrientation;else{const u=T._getWorldMatrixDeterminant();Q=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),u<0&&(Q=Q===z.c.ClockWiseSideOrientation?z.c.CounterClockWiseSideOrientation:z.c.ClockWiseSideOrientation),P.sideOrientation=Q}const V=this._internalMeshDataInfo._effectiveMaterial._preBind(E,Q);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&t.setDepthWrite(!0);const q=this._internalMeshDataInfo._effectiveMaterial,e=q.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),r||this._bind(u,f,e,!1);const Y=T.getWorldMatrix();q._storeEffectOnSubMeshes?q.bindForSubMesh(Y,this,u):q.bind(Y,this),!q.XD&&q.separateCullingPass&&(t.setState(!0,q.zOffset,!1,!V,q.cullBackFaces,q.RD,q.zOffsetUnits),this._processRendering(this,u,f,e,s,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),t.setState(!0,q.zOffset,!1,V,q.cullBackFaces,q.RD,q.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(u)),this._processRendering(this,u,f,e,s,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const z of C._afterRenderingMeshStage)z.action(this,u,s,f);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),S&&(S.maxZ=G,C.updateTransformMatrix(!0)),2!==C.performancePriority||P.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(b.i.MatricesWeightsKind)&&(this.isVerticesDataPresent(b.i.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const u=this.getVerticesData(b.i.MatricesWeightsKind),R=u.length;for(let I=0;I<R;I+=4){const R=u[I]+u[I+1]+u[I+2]+u[I+3];if(0===R)u[I]=1;else{const B=1/R;u[I]*=B,u[I+1]*=B,u[I+2]*=B,u[I+3]*=B}}this.Zu(b.i.MatricesWeightsKind,u)}_normalizeSkinWeightsAndExtra(){const u=this.getVerticesData(b.i.MatricesWeightsExtraKind),R=this.getVerticesData(b.i.MatricesWeightsKind),I=R.length;for(let B=0;B<I;B+=4){let I=R[B]+R[B+1]+R[B+2]+R[B+3];if(I+=u[B]+u[B+1]+u[B+2]+u[B+3],0===I)R[B]=1;else{const U=1/I;R[B]*=U,R[B+1]*=U,R[B+2]*=U,R[B+3]*=U,u[B]*=U,u[B+1]*=U,u[B+2]*=U,u[B+3]*=U}}this.Zu(b.i.MatricesWeightsKind,R),this.Zu(b.i.MatricesWeightsKind,u)}validateSkinning(){const u=this.getVerticesData(b.i.MatricesWeightsExtraKind),R=this.getVerticesData(b.i.MatricesWeightsKind);if(null===R||null==this.skeleton)return{skinned:!1,valid:!0,BD:"not skinned"};const I=R.length;let B=0,U=0,K=0,C=0;const D=null===u?4:8,s=[];for(let b=0;b<=D;b++)s[b]=0;for(let b=0;b<I;b+=4){let I=R[b],t=I,G=0===t?0:1;for(let U=1;U<D;U++){const K=U<4?R[b+U]:u[b+U-4];K>I&&B++,0!==K&&G++,t+=K,I=K}if(s[G]++,G>K&&(K=G),0===t)U++;else{const I=1/t;let B=0;for(let U=0;U<D;U++)B+=U<4?Math.abs(R[b+U]-R[b+U]*I):Math.abs(u[b+U-4]-u[b+U-4]*I);B>.001&&C++}}const t=this.skeleton.bones.length,G=this.getVerticesData(b.i.MatricesIndicesKind),S=this.getVerticesData(b.i.MatricesIndicesExtraKind);let r=0;for(let b=0;b<I;b+=4)for(let u=0;u<D;u++){const R=u<4?G[b+u]:S[b+u-4];(R>=t||R<0)&&r++}return{skinned:!0,valid:0===U&&0===C&&0===r,BD:"Number of Weights = "+I/4+"\nMaximum influences = "+K+"\nMissing Weights = "+U+"\nNot Sorted = "+B+"\nNot Normalized = "+C+"\nWeightCounts = ["+s+"]\nNumber of bones = "+t+"\nBad Bone Indices = "+r}}_checkDelayState(){const u=this.eu();return this._geometry?this._geometry.load(u):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(u)),this}_queueLoad(u){u.addPendingData(this);const R=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return U.Tools.LoadFile(this.delayLoadingFile,(R=>{R instanceof ArrayBuffer?this._delayLoadingFunction(R,this):this._delayLoadingFunction(JSON.parse(R),this);for(const u of this.instances)u.refreshBoundingInfo(),u._syncSubMeshes();this.delayLoadState=1,u.removePendingData(this)}),(()=>{}),u.offlineProvider,R),this}isInFrustum(u){return 2!==this.delayLoadState&&(!!super.isInFrustum(u)&&(this._checkDelayState(),!0))}setMaterialById(u){const R=this.eu().materials;let I;for(I=R.length-1;I>-1;I--)if(R[I].id===u)return this.material=R[I],this;const B=this.eu().multiMaterials;for(I=B.length-1;I>-1;I--)if(B[I].id===u)return this.material=B[I],this;return this}getAnimatables(){const u=[];return this.material&&u.push(this.material),this.skeleton&&u.push(this.skeleton),u}bakeTransformIntoVertices(u){if(!this.isVerticesDataPresent(b.i.PositionKind))return this;const R=this.DD.splice(0);this._resetPointsArrayCache();let I=this.getVerticesData(b.i.PositionKind);const B=t.PR.Zero();let U;for(U=0;U<I.length;U+=3)t.PR.TransformCoordinatesFromFloatsToRef(I[U],I[U+1],I[U+2],u,B).toArray(I,U);if(this.Zu(b.i.PositionKind,I,this.getVertexBuffer(b.i.PositionKind).isUpdatable()),this.isVerticesDataPresent(b.i.NormalKind)){for(I=this.getVerticesData(b.i.NormalKind),U=0;U<I.length;U+=3)t.PR.TransformNormalFromFloatsToRef(I[U],I[U+1],I[U+2],u,B).normalize().toArray(I,U);this.Zu(b.i.NormalKind,I,this.getVertexBuffer(b.i.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(b.i.TangentKind)){for(I=this.getVerticesData(b.i.TangentKind),U=0;U<I.length;U+=4)t.PR.TransformNormalFromFloatsToRef(I[U],I[U+1],I[U+2],u,B).normalize().toArray(I,U);this.Zu(b.i.TangentKind,I,this.getVertexBuffer(b.i.TangentKind).isUpdatable())}return u.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.DD=R,this}bakeCurrentTransformIntoVertices(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.bD(!0)),this.resetLocalMatrix(u),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(R&&void 0===R._addToSceneRootNodes){const I=R;return v.source=this,v.doNotCloneChildren=I.doNotCloneChildren,v.clonePhysicsImpostor=I.clonePhysicsImpostor,v.cloneThinInstances=I.cloneThinInstances,new p(u,this.eu(),v)}return new p(u,this.eu(),R,this,I,B)}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const I=this._internalMeshDataInfo;if(I._onBeforeDrawObservable&&I._onBeforeDrawObservable.clear(),I._onBeforeBindObservable&&I._onBeforeBindObservable.clear(),I._onBeforeRenderObservable&&I._onBeforeRenderObservable.clear(),I._onAfterRenderObservable&&I._onAfterRenderObservable.clear(),I._onBetweenPassObservable&&I._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(I.meshMap)for(const u in I.meshMap){const R=I.meshMap[u];R&&(R._internalMeshDataInfo._source=null,I.meshMap[u]=void 0)}I._source&&I._source._internalMeshDataInfo.meshMap&&(I._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const u=this.eu().meshes;for(const R of u){const u=R;u._internalMeshDataInfo&&u._internalMeshDataInfo._source&&u._internalMeshDataInfo._source===this&&(u._internalMeshDataInfo._source=null)}}I._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(u,R)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(u,R,I,B,K,C){let D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0;const t=this.eu();return U.Tools.LoadImage(u,(u=>{const U=u.width,s=u.height,t=this.getEngine().createCanvas(U,s).getContext("2d");t.drawImage(u,0,0);const G=t.getImageData(0,0,U,s).data;this.applyDisplacementMapFromBuffer(G,U,s,R,I,K,C,D),B&&B(this)}),s||(()=>{}),t.offlineProvider),this}applyDisplacementMapFromBuffer(u,R,I,B,U,K,C){let D=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(b.i.PositionKind)||!this.isVerticesDataPresent(b.i.NormalKind)||!this.isVerticesDataPresent(b.i.UVKind))return V.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const s=this.getVerticesData(b.i.PositionKind,!0,!0),G=this.getVerticesData(b.i.NormalKind),S=this.getVerticesData(b.i.UVKind);let P=t.PR.Zero();const X=t.PR.Zero(),E=t.Vector2.Zero();K=K||t.Vector2.Zero(),C=C||new t.Vector2(1,1);for(let b=0;b<s.length;b+=3){t.PR.FromArrayToRef(s,b,P),t.PR.FromArrayToRef(G,b,X),t.Vector2.FromArrayToRef(S,b/3*2,E);const D=4*((Math.abs(E.x*C.x+K.x%1)*(R-1)%R|0)+(Math.abs(E.y*C.y+K.y%1)*(I-1)%I|0)*R),r=.3*(u[D]/255)+.59*(u[D+1]/255)+.11*(u[D+2]/255);X.normalize(),X.scaleInPlace(B+(U-B)*r),P=P.add(X),P.toArray(s,b)}return r.b.ComputeNormals(s,this.PD(),G),D?(this.Zu(b.i.PositionKind,s),this.Zu(b.i.NormalKind,G),this.Zu(b.i.UVKind,S)):(this.updateVerticesData(b.i.PositionKind,s),this.updateVerticesData(b.i.NormalKind,G)),this}_getFlattenedNormals(u,R){const I=new Float32Array(3*u.length);let B=0;const U=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let K=0;K<u.length;K+=3){const C=t.PR.TR(R,3*u[K]),D=t.PR.TR(R,3*u[K+1]),s=t.PR.TR(R,3*u[K+2]),G=C.XR(D),S=s.XR(D),b=t.PR.Normalize(t.PR.Cross(G,S));U&&b.scaleInPlace(-1);for(let u=0;u<3;u++)I[B++]=b.x,I[B++]=b.y,I[B++]=b.z}return I}_convertToUnIndexedMesh(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R=this.getVerticesDataKinds().filter((u=>{var R;return!(null!==(R=this.getVertexBuffer(u))&&void 0!==R&&R.getIsInstanced())})),I=this.PD(),B={},U=(u,R)=>{const B=new Float32Array(I.length*R);let U=0;for(let K=0;K<I.length;K++)for(let C=0;C<R;C++)B[U++]=u[I[K]*R+C];return B},K=this.getBoundingInfo(),C=this.rD?this.DD.slice(0):[];for(const D of R)B[D]=this.getVerticesData(D);for(const D of R){const R=this.getVertexBuffer(D),K=R.getSize();if(u&&D===b.i.NormalKind){const u=this._getFlattenedNormals(I,B[b.i.PositionKind]);this.Zu(b.i.NormalKind,u,R.isUpdatable(),K)}else this.Zu(D,U(B[D],K),R.isUpdatable(),K)}if(this.morphTargetManager){for(let R=0;R<this.morphTargetManager.numTargets;R++){const B=this.morphTargetManager.getTarget(R),K=B.getPositions();B.setPositions(U(K,3));const C=B.getNormals();C&&B.setNormals(u?this._getFlattenedNormals(I,K):U(C,3));const D=B.getTangents();D&&B.setTangents(U(D,3));const s=B.getUVs();s&&B.setUVs(U(s,2));const t=B.getColors();t&&B.setColors(U(t,4))}this.morphTargetManager.synchronize()}for(let D=0;D<I.length;D++)I[D]=D;this.setIndices(I),this._unIndexed=!0,this.releaseSubMeshes();for(const D of C){const u=D.getBoundingInfo();E.b.AddToMesh(D.materialIndex,D.indexStart,D.indexCount,D.indexStart,D.indexCount,this).setBoundingInfo(u)}return this.setBoundingInfo(K),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R=r.b.ExtractFromMesh(this);let I;if(u&&this.isVerticesDataPresent(b.i.NormalKind)&&R.ou){for(I=0;I<R.ou.length;I++)R.ou[I]*=-1;this.Zu(b.i.NormalKind,R.ou,this.isVertexBufferUpdatable(b.i.NormalKind))}if(R.indices){let u;for(I=0;I<R.indices.length;I+=3)u=R.indices[I+1],R.indices[I+1]=R.indices[I+2],R.indices[I+2]=u;this.setIndices(R.indices,null,this.isVertexBufferUpdatable(b.i.PositionKind),!0)}return this}increaseVertices(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const R=r.b.ExtractFromMesh(this),I=R.indices&&!Array.isArray(R.indices)&&Array.from?Array.from(R.indices):R.indices,B=R.Mu&&!Array.isArray(R.Mu)&&Array.from?Array.from(R.Mu):R.Mu,U=R.hu&&!Array.isArray(R.hu)&&Array.from?Array.from(R.hu):R.hu,K=R.ou&&!Array.isArray(R.ou)&&Array.from?Array.from(R.ou):R.ou;if(I&&B){R.indices=I,R.Mu=B,U&&(R.hu=U),K&&(R.ou=K);const C=u+1,D=[];for(let u=0;u<C+1;u++)D[u]=[];let s,G;const S=new t.PR(0,0,0),r=new t.PR(0,0,0),P=new t.Vector2(0,0),X=[],E=[],z=[];let f,T,Q,V=B.length;U&&(T=U.length),K&&(Q=K.length);for(let u=0;u<I.length;u+=3){E[0]=I[u],E[1]=I[u+1],E[2]=I[u+2];for(let u=0;u<3;u++)if(s=E[u],G=E[(u+1)%3],void 0===z[s]&&void 0===z[G]?(z[s]=[],z[G]=[]):(void 0===z[s]&&(z[s]=[]),void 0===z[G]&&(z[G]=[])),void 0===z[s][G]&&void 0===z[G][s]){z[s][G]=[],S.x=(B[3*G]-B[3*s])/C,S.y=(B[3*G+1]-B[3*s+1])/C,S.z=(B[3*G+2]-B[3*s+2])/C,K&&(r.x=(K[3*G]-K[3*s])/C,r.y=(K[3*G+1]-K[3*s+1])/C,r.z=(K[3*G+2]-K[3*s+2])/C),U&&(P.x=(U[2*G]-U[2*s])/C,P.y=(U[2*G+1]-U[2*s+1])/C),z[s][G].push(s);for(let u=1;u<C;u++)z[s][G].push(B.length/3),B[V++]=B[3*s]+u*S.x,B[V++]=B[3*s+1]+u*S.y,B[V++]=B[3*s+2]+u*S.z,K&&(K[Q++]=K[3*s]+u*r.x,K[Q++]=K[3*s+1]+u*r.y,K[Q++]=K[3*s+2]+u*r.z),U&&(U[T++]=U[2*s]+u*P.x,U[T++]=U[2*s+1]+u*P.y);z[s][G].push(G),z[G][s]=[],f=z[s][G].length;for(let u=0;u<f;u++)z[G][s][u]=z[s][G][f-1-u]}D[0][0]=I[u],D[1][0]=z[I[u]][I[u+1]][1],D[1][1]=z[I[u]][I[u+2]][1];for(let R=2;R<C;R++){D[R][0]=z[I[u]][I[u+1]][R],D[R][R]=z[I[u]][I[u+2]][R],S.x=(B[3*D[R][R]]-B[3*D[R][0]])/R,S.y=(B[3*D[R][R]+1]-B[3*D[R][0]+1])/R,S.z=(B[3*D[R][R]+2]-B[3*D[R][0]+2])/R,K&&(r.x=(K[3*D[R][R]]-K[3*D[R][0]])/R,r.y=(K[3*D[R][R]+1]-K[3*D[R][0]+1])/R,r.z=(K[3*D[R][R]+2]-K[3*D[R][0]+2])/R),U&&(P.x=(U[2*D[R][R]]-U[2*D[R][0]])/R,P.y=(U[2*D[R][R]+1]-U[2*D[R][0]+1])/R);for(let u=1;u<R;u++)D[R][u]=B.length/3,B[V++]=B[3*D[R][0]]+u*S.x,B[V++]=B[3*D[R][0]+1]+u*S.y,B[V++]=B[3*D[R][0]+2]+u*S.z,K&&(K[Q++]=K[3*D[R][0]]+u*r.x,K[Q++]=K[3*D[R][0]+1]+u*r.y,K[Q++]=K[3*D[R][0]+2]+u*r.z),U&&(U[T++]=U[2*D[R][0]]+u*P.x,U[T++]=U[2*D[R][0]+1]+u*P.y)}D[C]=z[I[u+1]][I[u+2]],X.push(D[0][0],D[1][0],D[1][1]);for(let u=1;u<C;u++){let R;for(R=0;R<u;R++)X.push(D[u][R],D[u+1][R],D[u+1][R+1]),X.push(D[u][R],D[u+1][R+1],D[u][R+1]);X.push(D[u][R],D[u+1][R],D[u+1][R+1])}}R.indices=X,R.gu(this,this.isVertexBufferUpdatable(b.i.PositionKind))}else V.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const u=r.b.ExtractFromMesh(this),R=u.hu,I=u.indices,B=u.Mu,U=u.ju,K=u.matricesIndices,C=u.matricesWeights,D=u.matricesIndicesExtra,s=u.matricesWeightsExtra;if(void 0===I||void 0===B||null===I||null===B)V.b.Warn("VertexData contains empty entries");else{const t=[],G=[],S=[],P=[],X=[],E=[],z=[],f=[];let T=[],Q=0;const V={};let q,e;for(let u=0;u<I.length;u+=3){e=[I[u],I[u+1],I[u+2]],T=[];for(let u=0;u<3;u++){T[u]="";for(let R=0;R<3;R++)Math.abs(B[3*e[u]+R])<1e-8&&(B[3*e[u]+R]=0),T[u]+=B[3*e[u]+R]+"|"}if(T[0]!=T[1]&&T[0]!=T[2]&&T[1]!=T[2])for(let u=0;u<3;u++){if(q=V[T[u]],void 0===q){V[T[u]]=Q,q=Q++;for(let R=0;R<3;R++)t.push(B[3*e[u]+R]);if(null!==U&&void 0!==U)for(let R=0;R<4;R++)P.push(U[4*e[u]+R]);if(null!==R&&void 0!==R)for(let I=0;I<2;I++)S.push(R[2*e[u]+I]);if(null!==K&&void 0!==K)for(let R=0;R<4;R++)X.push(K[4*e[u]+R]);if(null!==C&&void 0!==C)for(let R=0;R<4;R++)E.push(C[4*e[u]+R]);if(null!==D&&void 0!==D)for(let R=0;R<4;R++)z.push(D[4*e[u]+R]);if(null!==s&&void 0!==s)for(let R=0;R<4;R++)f.push(s[4*e[u]+R])}G.push(q)}}const Y=[];r.b.ComputeNormals(t,G,Y),u.Mu=t,u.indices=G,u.ou=Y,null!==R&&void 0!==R&&(u.hu=S),null!==U&&void 0!==U&&(u.ju=P),null!==K&&void 0!==K&&(u.matricesIndices=X),null!==C&&void 0!==C&&(u.matricesWeights=E),null!==D&&void 0!==D&&(u.matricesIndicesExtra=z),null!==C&&void 0!==C&&(u.matricesWeightsExtra=f),u.gu(this,this.isVertexBufferUpdatable(b.i.PositionKind))}}static _instancedMeshFactory(u,R){throw(0,e.c)("InstancedMesh")}static _PhysicsImpostorParser(u,R,I){throw(0,e.c)("PhysicsImpostor")}createInstance(u){const R=p._instancedMeshFactory(u,this);return R.parent=this.parent,R}synchronizeInstances(){for(let u=0;u<this.instances.length;u++){this.instances[u]._syncSubMeshes()}return this}optimizeIndices(u){const R=this.PD(),I=this.getVerticesData(b.i.PositionKind);if(!I||!R)return this;const B=[];for(let U=0;U<I.length;U+=3)B.push(t.PR.TR(I,U));const K=[];return U.AsyncLoop.SyncAsyncForLoop(B.length,40,(u=>{const R=B.length-1-u,I=B[R];for(let U=0;U<R;++U){const u=B[U];if(I.equals(u)){K[R]=U;break}}}),(()=>{for(let u=0;u<R.length;++u)R[u]=K[R[u]]||R[u];const I=this.DD.slice(0);this.setIndices(R),this.DD=I,u&&u(this)})),this}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,u.type=this.getClassName(),C.e&&C.e.HasTags(this)&&(u.tags=C.e.GetTags(this)),u.position=this.position.sD(),this.rotationQuaternion?u.rotationQuaternion=this.rotationQuaternion.sD():this.rotation&&(u.rotation=this.rotation.sD()),u.zD=this.zD.sD(),this._postMultiplyPivotMatrix?u.pivotMatrix=this.getPivotMatrix().sD():u.localMatrix=this.getPivotMatrix().sD(),u.isEnabled=this.isEnabled(!1),u.isVisible=this.isVisible,u.infiniteDistance=this.infiniteDistance,u.pickable=this.Zs,u.receiveShadows=this.receiveShadows,u.billboardMode=this.billboardMode,u.visibility=this.visibility,u.kt=this.kt,u.checkCollisions=this.checkCollisions,u.ellipsoid=this.ellipsoid.sD(),u.ellipsoidOffset=this.ellipsoidOffset.sD(),u.vu=this.vu,u.isBlocker=this.isBlocker,u.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(u),u.isUnIndexed=this.isUnIndexed;const R=this._geometry;if(R&&this.DD){u.geometryUniqueId=R.uniqueId,u.geometryId=R.id,u.DD=[];for(let R=0;R<this.DD.length;R++){const I=this.DD[R];u.DD.push({materialIndex:I.materialIndex,verticesStart:I.verticesStart,verticesCount:I.verticesCount,indexStart:I.indexStart,indexCount:I.indexCount})}}if(this.material?this.material.doNotSerialize||(u.materialUniqueId=this.material.uniqueId,u.materialId=this.material.id):(this.material=null,u.materialUniqueId=this._scene.defaultMaterial.uniqueId,u.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(u.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(u.skeletonId=this.skeleton.id,u.numBoneInfluencers=this.numBoneInfluencers),this.eu()._getComponent(Y.b.NAME_PHYSICSENGINE)){const R=this.getPhysicsImpostor();R&&(u.physicsMass=R.getParam("bB"),u.physicsFriction=R.getParam("friction"),u.physicsRestitution=R.getParam("bB"),u.physicsImpostor=R.type)}this.metadata&&(u.metadata=this.metadata),u.instances=[];for(let I=0;I<this.instances.length;I++){const R=this.instances[I];if(R.doNotSerialize)continue;const B={name:R.name,id:R.id,isEnabled:R.isEnabled(!1),isVisible:R.isVisible,Zs:R.Zs,checkCollisions:R.checkCollisions,position:R.position.sD(),zD:R.zD.sD()};if(R.parent&&R.parent._serializeAsParent(B),R.rotationQuaternion?B.rotationQuaternion=R.rotationQuaternion.sD():R.rotation&&(B.rotation=R.rotation.sD()),this.eu()._getComponent(Y.b.NAME_PHYSICSENGINE)){const u=R.getPhysicsImpostor();u&&(B.physicsMass=u.getParam("bB"),B.physicsFriction=u.getParam("friction"),B.physicsRestitution=u.getParam("bB"),B.physicsImpostor=u.type)}R.metadata&&(B.metadata=R.metadata),R.actionManager&&(B.actions=R.actionManager.serialize(R.name)),u.instances.push(B),Q.e.AppendSerializedAnimations(R,B),B.ranges=R.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(u.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.zt},this._userThinInstanceBuffersStorage)){const R={data:{},sizes:{},strides:{}};for(const u in this._userThinInstanceBuffersStorage.data)R.data[u]=Array.from(this._userThinInstanceBuffersStorage.data[u]),R.sizes[u]=this._userThinInstanceBuffersStorage.sizes[u],R.strides[u]=this._userThinInstanceBuffersStorage.strides[u];u.thinInstances.userThinInstance=R}return Q.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.layerMask=this.layerMask,u.alphaIndex=this.alphaIndex,u.hasVertexAlpha=this.hasVertexAlpha,u.overlayAlpha=this.overlayAlpha,u.overlayColor=this.overlayColor.sD(),u.renderOverlay=this.renderOverlay,u.applyFog=this.applyFog,this.actionManager&&(u.actions=this.actionManager.serialize(this.name)),u}_syncGeometryWithMorphTargetManager(){if(!this.rD)return;this._markSubMeshesAsAttributesDirty();const u=this._internalAbstractMeshDataInfo._morphTargetManager;if(u&&u.vertexCount){if(u.vertexCount!==this.getTotalVertices())return V.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(u.isUsingTextureForTargets)return;for(let R=0;R<u.numInfluencers;R++){const I=u.getActiveTarget(R),B=I.getPositions();if(!B)return void V.b.Error("Invalid morph target. Target must have positions.");this.rD.Zu(b.i.PositionKind+R,B,!1,3);const U=I.getNormals();U&&this.rD.Zu(b.i.NormalKind+R,U,!1,3);const K=I.getTangents();K&&this.rD.Zu(b.i.TangentKind+R,K,!1,3);const C=I.getUVs();C&&this.rD.Zu(b.i.UVKind+"_"+R,C,!1,2);const D=I.getUV2s();D&&this.rD.Zu(b.i.UV2Kind+"_"+R,D,!1,2);const s=I.getColors();s&&this.rD.Zu(b.i.ColorKind+R,s,!1,4)}}else{let u=0;for(;this.rD.isVerticesDataPresent(b.i.PositionKind+u);)this.rD.removeVerticesData(b.i.PositionKind+u),this.rD.isVerticesDataPresent(b.i.NormalKind+u)&&this.rD.removeVerticesData(b.i.NormalKind+u),this.rD.isVerticesDataPresent(b.i.TangentKind+u)&&this.rD.removeVerticesData(b.i.TangentKind+u),this.rD.isVerticesDataPresent(b.i.UVKind+u)&&this.rD.removeVerticesData(b.i.UVKind+"_"+u),this.rD.isVerticesDataPresent(b.i.UV2Kind+u)&&this.rD.removeVerticesData(b.i.UV2Kind+"_"+u),this.rD.isVerticesDataPresent(b.i.ColorKind+u)&&this.rD.removeVerticesData(b.i.ColorKind+u),u++}}static Parse(u,R,I){let B;if(B=u.type&&"LinesMesh"===u.type?p._LinesMeshParser(u,R):u.type&&"GroundMesh"===u.type?p._GroundMeshParser(u,R):u.type&&"GoldbergMesh"===u.type?p._GoldbergMeshParser(u,R):u.type&&"GreasedLineMesh"===u.type?p._GreasedLineMeshParser(u,R):u.type&&"TrailMesh"===u.type?p._TrailMeshParser(u,R):new p(u.name,R),B.id=u.id,B._waitingParsedUniqueId=u.uniqueId,C.e&&C.e.AddTagsTo(B,u.tags),B.position=t.PR.TR(u.position),void 0!==u.metadata&&(B.metadata=u.metadata),u.rotationQuaternion?B.rotationQuaternion=t.Quaternion.TR(u.rotationQuaternion):u.rotation&&(B.rotation=t.PR.TR(u.rotation)),B.zD=t.PR.TR(u.zD),u.localMatrix?B.setPreTransformMatrix(t.Matrix.TR(u.localMatrix)):u.pivotMatrix&&B.setPivotMatrix(t.Matrix.TR(u.pivotMatrix)),B.WD(u.isEnabled),B.isVisible=u.isVisible,B.infiniteDistance=u.infiniteDistance,B.kt=!!u.kt,B.showBoundingBox=u.showBoundingBox,B.showSubMeshesBoundingBox=u.showSubMeshesBoundingBox,void 0!==u.applyFog&&(B.applyFog=u.applyFog),void 0!==u.pickable&&(B.Zs=u.pickable),void 0!==u.alphaIndex&&(B.alphaIndex=u.alphaIndex),B.receiveShadows=u.receiveShadows,void 0!==u.billboardMode&&(B.billboardMode=u.billboardMode),void 0!==u.visibility&&(B.visibility=u.visibility),B.checkCollisions=u.checkCollisions,B.vu=!!u.vu,u.ellipsoid&&(B.ellipsoid=t.PR.TR(u.ellipsoid)),u.ellipsoidOffset&&(B.ellipsoidOffset=t.PR.TR(u.ellipsoidOffset)),null!=u.overrideMaterialSideOrientation&&(B.sideOrientation=u.overrideMaterialSideOrientation),void 0!==u.sideOrientation&&(B.sideOrientation=u.sideOrientation),void 0!==u.isBlocker&&(B.isBlocker=u.isBlocker),B._shouldGenerateFlatShading=u.useFlatShading,u.hD&&(B._waitingData.hD=u.hD),void 0!==u.parentId&&(B._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(B._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.actions&&(B._waitingData.actions=u.actions),void 0!==u.overlayAlpha&&(B.overlayAlpha=u.overlayAlpha),void 0!==u.overlayColor&&(B.overlayColor=G.fR.TR(u.overlayColor)),void 0!==u.renderOverlay&&(B.renderOverlay=u.renderOverlay),B.isUnIndexed=!!u.isUnIndexed,B.hasVertexAlpha=u.hasVertexAlpha,u.delayLoadingFile?(B.delayLoadState=4,B.delayLoadingFile=I+u.delayLoadingFile,B.buildBoundingInfo(t.PR.TR(u.boundingBoxMinimum),t.PR.TR(u.boundingBoxMaximum)),u._binaryInfo&&(B._binaryInfo=u._binaryInfo),B._delayInfo=[],u.hasUVs&&B._delayInfo.push(b.i.UVKind),u.hasUVs2&&B._delayInfo.push(b.i.UV2Kind),u.hasUVs3&&B._delayInfo.push(b.i.UV3Kind),u.hasUVs4&&B._delayInfo.push(b.i.UV4Kind),u.hasUVs5&&B._delayInfo.push(b.i.UV5Kind),u.hasUVs6&&B._delayInfo.push(b.i.UV6Kind),u.hasColors&&B._delayInfo.push(b.i.ColorKind),u.hasMatricesIndices&&B._delayInfo.push(b.i.MatricesIndicesKind),u.hasMatricesWeights&&B._delayInfo.push(b.i.MatricesWeightsKind),B._delayLoadingFunction=P.d._ImportGeometry,T.d.ForceFullSceneLoadingForIncremental&&B._checkDelayState()):P.d._ImportGeometry(u,B),u.materialUniqueId?B._waitingMaterialId=u.materialUniqueId:u.materialId&&(B._waitingMaterialId=u.materialId),u.morphTargetManagerId>-1&&(B._waitingMorphTargetManagerId=u.morphTargetManagerId),void 0!==u.skeletonId&&null!==u.skeletonId&&(B.skeleton=R.getLastSkeletonById(u.skeletonId),u.numBoneInfluencers&&(B.numBoneInfluencers=u.numBoneInfluencers)),u.animations){for(let R=0;R<u.animations.length;R++){const I=u.animations[R],U=(0,q.c)("BABYLON.Animation");U&&B.animations.push(U.Parse(I))}S.d.ParseAnimationRanges(B,u,R)}if(u.autoAnimate&&R.beginAnimation(B,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),u.layerMask&&!isNaN(u.layerMask)?B.layerMask=Math.abs(parseInt(u.layerMask)):B.layerMask=268435455,u.physicsImpostor&&(B.physicsImpostor=p._PhysicsImpostorParser(R,B,u)),u.lodMeshIds&&(B._waitingData.lods={ids:u.lodMeshIds,distances:u.lodDistances?u.lodDistances:null,coverages:u.lodCoverages?u.lodCoverages:null}),u.instances)for(let U=0;U<u.instances.length;U++){const I=u.instances[U],K=B.createInstance(I.name);if(I.id&&(K.id=I.id),C.e&&(I.tags?C.e.AddTagsTo(K,I.tags):C.e.AddTagsTo(K,u.tags)),K.position=t.PR.TR(I.position),void 0!==I.metadata&&(K.metadata=I.metadata),void 0!==I.parentId&&(K._waitingParentId=I.parentId),void 0!==I.parentInstanceIndex&&(K._waitingParentInstanceIndex=I.parentInstanceIndex),void 0!==I.isEnabled&&null!==I.isEnabled&&K.WD(I.isEnabled),void 0!==I.isVisible&&null!==I.isVisible&&(K.isVisible=I.isVisible),void 0!==I.Zs&&null!==I.Zs&&(K.Zs=I.Zs),I.rotationQuaternion?K.rotationQuaternion=t.Quaternion.TR(I.rotationQuaternion):I.rotation&&(K.rotation=t.PR.TR(I.rotation)),K.zD=t.PR.TR(I.zD),void 0!=I.checkCollisions&&null!=I.checkCollisions&&(K.checkCollisions=I.checkCollisions),void 0!=I.pickable&&null!=I.pickable&&(K.Zs=I.pickable),void 0!=I.showBoundingBox&&null!=I.showBoundingBox&&(K.showBoundingBox=I.showBoundingBox),void 0!=I.showSubMeshesBoundingBox&&null!=I.showSubMeshesBoundingBox&&(K.showSubMeshesBoundingBox=I.showSubMeshesBoundingBox),void 0!=I.alphaIndex&&null!=I.showSubMeshesBoundingBox&&(K.alphaIndex=I.alphaIndex),I.physicsImpostor&&(K.physicsImpostor=p._PhysicsImpostorParser(R,K,I)),void 0!==I.actions&&(K._waitingData.actions=I.actions),I.animations){for(let u=0;u<I.animations.length;u++){const R=I.animations[u],B=(0,q.c)("BABYLON.Animation");B&&K.animations.push(B.Parse(R))}S.d.ParseAnimationRanges(K,I,R),I.autoAnimate&&R.beginAnimation(K,I.autoAnimateFrom,I.autoAnimateTo,I.autoAnimateLoop,I.autoAnimateSpeed||1)}}if(u.thinInstances){const R=u.thinInstances;if(B.zt=!!R.enablePicking,R.matrixData?(B.zS("matrix",new Float32Array(R.matrixData),16,!1),B._thinInstanceDataStorage.matrixBufferSize=R.matrixBufferSize,B._thinInstanceDataStorage.instancesCount=R.instancesCount):B._thinInstanceDataStorage.matrixBufferSize=R.matrixBufferSize,u.thinInstances.userThinInstance){const R=u.thinInstances.userThinInstance;for(const u in R.data)B.zS(u,new Float32Array(R.data[u]),R.strides[u],!1),B._userThinInstanceBuffersStorage.sizes[u]=R.sizes[u]}}return B}setPositionsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourcePositions){const R=this.getVerticesData(b.i.PositionKind);if(!R)return u._sourcePositions;u._sourcePositions=new Float32Array(R),this.isVertexBufferUpdatable(b.i.PositionKind)||this.Zu(b.i.PositionKind,R,!0)}return u._sourcePositions}setNormalsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourceNormals){const R=this.getVerticesData(b.i.NormalKind);if(!R)return u._sourceNormals;u._sourceNormals=new Float32Array(R),this.isVertexBufferUpdatable(b.i.NormalKind)||this.Zu(b.i.NormalKind,R,!0)}return u._sourceNormals}applySkeleton(u){if(!this.rD)return this;if(this.rD._softwareSkinningFrameId==this.eu().getFrameId())return this;if(this.rD._softwareSkinningFrameId=this.eu().getFrameId(),!this.isVerticesDataPresent(b.i.PositionKind))return this;if(!this.isVerticesDataPresent(b.i.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(b.i.MatricesWeightsKind))return this;const R=this.isVerticesDataPresent(b.i.NormalKind),I=this._internalMeshDataInfo;if(!I._sourcePositions){const u=this.DD.slice();this.setPositionsForCPUSkinning(),this.DD=u}R&&!I._sourceNormals&&this.setNormalsForCPUSkinning();let B=this.getVerticesData(b.i.PositionKind);if(!B)return this;B instanceof Float32Array||(B=new Float32Array(B));let U=this.getVerticesData(b.i.NormalKind);if(R){if(!U)return this;U instanceof Float32Array||(U=new Float32Array(U))}const K=this.getVerticesData(b.i.MatricesIndicesKind),C=this.getVerticesData(b.i.MatricesWeightsKind);if(!C||!K)return this;const D=this.numBoneInfluencers>4,s=D?this.getVerticesData(b.i.MatricesIndicesExtraKind):null,G=D?this.getVerticesData(b.i.MatricesWeightsExtraKind):null,S=u.getTransformMatrices(this),r=t.PR.Zero(),P=new t.Matrix,X=new t.Matrix;let E,z=0;for(let b=0;b<B.length;b+=3,z+=4){let u;for(E=0;E<4;E++)u=C[z+E],u>0&&(t.Matrix.FromFloat32ArrayToRefScaled(S,Math.floor(16*K[z+E]),u,X),P.addToSelf(X));if(D)for(E=0;E<4;E++)u=G[z+E],u>0&&(t.Matrix.FromFloat32ArrayToRefScaled(S,Math.floor(16*s[z+E]),u,X),P.addToSelf(X));t.PR.TransformCoordinatesFromFloatsToRef(I._sourcePositions[b],I._sourcePositions[b+1],I._sourcePositions[b+2],P,r),r.toArray(B,b),R&&(t.PR.TransformNormalFromFloatsToRef(I._sourceNormals[b],I._sourceNormals[b+1],I._sourceNormals[b+2],P,r),r.toArray(U,b)),P.reset()}return this.updateVerticesData(b.i.PositionKind,B),R&&this.updateVerticesData(b.i.NormalKind,U),this}static MinMax(u){let R=null,I=null;for(const B of u){const u=B.getBoundingInfo().boundingBox;R&&I?(R.minimizeInPlace(u.minimumWorld),I.maximizeInPlace(u.maximumWorld)):(R=u.minimumWorld,I=u.maximumWorld)}return R&&I?{min:R,max:I}:{min:t.PR.Zero(),max:t.PR.Zero()}}static Center(u){const R=u instanceof Array?p.MinMax(u):u;return t.PR.Center(R.min,R.max)}static MergeMeshes(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],I=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;return(0,D.l)(p._MergeMeshesCoroutine(u,R,I,B,U,K,!1))}static async MergeMeshesAsync(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],I=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;return await(0,D.k)(p._MergeMeshesCoroutine(u,R,I,B,U,K,!0),(0,D.d)())}static*_MergeMeshesCoroutine(u){let R,I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2?arguments[2]:void 0,U=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0,D=arguments.length>6?arguments[6]:void 0;if(0===(u=u.filter(Boolean)).length)return null;if(!B){let I=0;for(R=0;R<u.length;R++)if(I+=u[R].getTotalVertices(),I>=65536)return V.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}C&&(K=!1);const s=new Array,t=new Array,G=new Array,S=u[0].sideOrientation;for(R=0;R<u.length;R++){const I=u[R];if(I.isAnInstance)return V.b.Warn("Cannot merge instance meshes."),null;if(S!==I.sideOrientation)return V.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(K&&G.push(I.getTotalIndices()),C)if(I.material){const u=I.material;if(u instanceof f.c){for(let R=0;R<u.QD.length;R++)s.indexOf(u.QD[R])<0&&s.push(u.QD[R]);for(let R=0;R<I.DD.length;R++)t.push(s.indexOf(u.QD[I.DD[R].materialIndex])),G.push(I.DD[R].indexCount)}else{s.indexOf(u)<0&&s.push(u);for(let R=0;R<I.DD.length;R++)t.push(s.indexOf(u)),G.push(I.DD[R].indexCount)}}else for(let u=0;u<I.DD.length;u++)t.push(0),G.push(I.DD[u].indexCount)}const b=u[0],P=u=>{const R=u.bD(!0);return{vertexData:r.b.ExtractFromMesh(u,!1,!1),transform:R}},{vertexData:X,transform:z}=P(b);D&&(yield);const T=new Array(u.length-1);for(let r=1;r<u.length;r++)T[r-1]=P(u[r]),D&&(yield);const Q=X._mergeCoroutine(z,T,B,D,!I);let q=Q.next();for(;!q.done;)D&&(yield),q=Q.next();const e=q.value;U||(U=new p(b.name+"_merged",b.eu()));const Y=e._applyToCoroutine(U,void 0,D);let M=Y.next();for(;!M.done;)D&&(yield),M=Y.next();if(U.checkCollisions=b.checkCollisions,U.sideOrientation=b.sideOrientation,I)for(R=0;R<u.length;R++)u[R].dispose();if(K||C){U.releaseSubMeshes(),R=0;let u=0;for(;R<G.length;)E.b.CreateFromIndices(0,u,G[R],U,void 0,!1),u+=G[R],R++;for(const R of U.DD)R.refreshBoundingInfo();U.bD(!0)}if(C){const u=new f.c(b.name+"_merged",b.eu());u.QD=s;for(let R=0;R<U.DD.length;R++)U.DD[R].materialIndex=t[R];U.material=u}else U.material=b.material;return U}ur(u){u._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(u)}mr(u){const R=u._indexInSourceMeshInstanceArray;if(-1!=R){if(R!==this.instances.length-1){const u=this.instances[this.instances.length-1];this.instances[R]=u,u._indexInSourceMeshInstanceArray=R}u._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===z.c.CounterClockWiseSideOrientation}_getRenderingFillMode(u){const R=this.eu();return R.forcePointsCloud?z.c.PointFillMode:R.forceWireframe?z.c.WireFrameFillMode:this.overrideRenderingFillMode??u}setMaterialByID(u){return this.setMaterialById(u)}static CreateRibbon(u,R,I,B,U,K,C,D,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(u,R,I,B,U,K){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(u,R,I,B,U){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(u,R,I,B,U,K){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(u,R,I,B){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(u,R,I,B,U,K,C,D,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(u,R,I,B,U,K,C){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(u,R,I,B,U,K,C,D,s,t){throw new Error("Import MeshBuilder to populate this function")}static Et(u,R,I,B,U){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(u,R,I,B,U,K,C,D){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(u,R,I,B,U,K,C){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(u,R,I,B,U,K,C,D){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(u,R,I,B,U,K,C,D,s,t){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(u,R,I,B,U,K,C,D,s,t,G,S){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(u,R,I,B,U,K,C){throw new Error("Import MeshBuilder to populate this function")}static Tt(u,R,I,B,U){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(u,R,I,B,U,K){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(u,R,I,B,U,K,C,D,s){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(u,R,I,B,U,K,C,D,s,t,G){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(u,R,I,B,U,K,C,D,s,t){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(u,R,I){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(u,R,I){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(u,R,I,B,U,K){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(u,R,I){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(u){throw new Error("Import MeshBuilder to populate this function")}}p.FRONTSIDE=r.b.FRONTSIDE,p.BACKSIDE=r.b.BACKSIDE,p.DOUBLESIDE=r.b.DOUBLESIDE,p.DEFAULTSIDE=r.b.DEFAULTSIDE,p.NO_CAP=0,p.CAP_START=1,p.CAP_END=2,p.CAP_ALL=3,p.NO_FLIP=0,p.FLIP_TILE=1,p.ROTATE_TILE=2,p.FLIP_ROW=3,p.ROTATE_ROW=4,p.FLIP_N_ROTATE_TILE=5,p.FLIP_N_ROTATE_ROW=6,p.CENTER=0,p.LEFT=1,p.RIGHT=2,p.TOP=3,p.BOTTOM=4,p.INSTANCEDMESH_SORT_TRANSPARENT=!1,p._GroundMeshParser=(u,R)=>{throw(0,e.c)("GroundMesh")},p._GoldbergMeshParser=(u,R)=>{throw(0,e.c)("GoldbergMesh")},p._LinesMeshParser=(u,R)=>{throw(0,e.c)("LinesMesh")},p._GreasedLineMeshParser=(u,R)=>{throw(0,e.c)("GreasedLineMesh")},p._GreasedLineRibbonMeshParser=(u,R)=>{throw(0,e.c)("GreasedLineRibbonMesh")},p._TrailMeshParser=(u,R)=>{throw(0,e.c)("TrailMesh")},(0,q.e)("BABYLON.Mesh",p)},12892:(u,R,I)=>{I.d(R,{b:()=>P});var B=I(12466),U=I(12481),K=I(12549),C=I(12335),D=I(12518),s=I(12315),t=I(12472),G=I(12894),S=I(12355),b=I(12798);class r{}class P{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,G.g)(this._applyToCoroutine.bind(this)),this.uniqueId=P._UniqueIdGenerator,P._UniqueIdGenerator++}set(u,R){switch(u.length||s.b.Warn(`Setting vertex data kind '${R}' with an empty array`),R){case K.i.PositionKind:this.Mu=u;break;case K.i.NormalKind:this.ou=u;break;case K.i.TangentKind:this.tangents=u;break;case K.i.UVKind:this.hu=u;break;case K.i.UV2Kind:this.uvs2=u;break;case K.i.UV3Kind:this.uvs3=u;break;case K.i.UV4Kind:this.uvs4=u;break;case K.i.UV5Kind:this.uvs5=u;break;case K.i.UV6Kind:this.uvs6=u;break;case K.i.ColorKind:this.ju=u;break;case K.i.MatricesIndicesKind:this.matricesIndices=u;break;case K.i.MatricesWeightsKind:this.matricesWeights=u;break;case K.i.MatricesIndicesExtraKind:this.matricesIndicesExtra=u;break;case K.i.MatricesWeightsExtraKind:this.matricesWeightsExtra=u}}gu(u,R){return this._applyTo(u,R,!1),this}applyToGeometry(u,R){return this._applyTo(u,R,!1),this}updateMesh(u){return this._update(u),this}updateGeometry(u){return this._update(u),this}*_applyToCoroutine(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;if(this.Mu&&(u.Zu(K.i.PositionKind,this.Mu,R),I&&(yield)),this.ou&&(u.Zu(K.i.NormalKind,this.ou,R),I&&(yield)),this.tangents&&(u.Zu(K.i.TangentKind,this.tangents,R),I&&(yield)),this.hu&&(u.Zu(K.i.UVKind,this.hu,R),I&&(yield)),this.uvs2&&(u.Zu(K.i.UV2Kind,this.uvs2,R),I&&(yield)),this.uvs3&&(u.Zu(K.i.UV3Kind,this.uvs3,R),I&&(yield)),this.uvs4&&(u.Zu(K.i.UV4Kind,this.uvs4,R),I&&(yield)),this.uvs5&&(u.Zu(K.i.UV5Kind,this.uvs5,R),I&&(yield)),this.uvs6&&(u.Zu(K.i.UV6Kind,this.uvs6,R),I&&(yield)),this.ju){const B=this.Mu&&this.ju.length===this.Mu.length?3:4;u.Zu(K.i.ColorKind,this.ju,R,B),this.hasVertexAlpha&&void 0!==u.hasVertexAlpha&&(u.hasVertexAlpha=!0),I&&(yield)}if(this.matricesIndices&&(u.Zu(K.i.MatricesIndicesKind,this.matricesIndices,R),I&&(yield)),this.matricesWeights&&(u.Zu(K.i.MatricesWeightsKind,this.matricesWeights,R),I&&(yield)),this.matricesIndicesExtra&&(u.Zu(K.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,R),I&&(yield)),this.matricesWeightsExtra&&(u.Zu(K.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,R),I&&(yield)),this.indices?(u.setIndices(this.indices,null,R),I&&(yield)):u.setIndices([],null),u.DD&&this.materialInfos&&this.materialInfos.length>1){const R=u;R.DD=[];for(const u of this.materialInfos)new b.b(u.materialIndex,u.verticesStart,u.verticesCount,u.indexStart,u.indexCount,R)}return this}_update(u,R,I){return this.Mu&&u.updateVerticesData(K.i.PositionKind,this.Mu,R,I),this.ou&&u.updateVerticesData(K.i.NormalKind,this.ou,R,I),this.tangents&&u.updateVerticesData(K.i.TangentKind,this.tangents,R,I),this.hu&&u.updateVerticesData(K.i.UVKind,this.hu,R,I),this.uvs2&&u.updateVerticesData(K.i.UV2Kind,this.uvs2,R,I),this.uvs3&&u.updateVerticesData(K.i.UV3Kind,this.uvs3,R,I),this.uvs4&&u.updateVerticesData(K.i.UV4Kind,this.uvs4,R,I),this.uvs5&&u.updateVerticesData(K.i.UV5Kind,this.uvs5,R,I),this.uvs6&&u.updateVerticesData(K.i.UV6Kind,this.uvs6,R,I),this.ju&&u.updateVerticesData(K.i.ColorKind,this.ju,R,I),this.matricesIndices&&u.updateVerticesData(K.i.MatricesIndicesKind,this.matricesIndices,R,I),this.matricesWeights&&u.updateVerticesData(K.i.MatricesWeightsKind,this.matricesWeights,R,I),this.matricesIndicesExtra&&u.updateVerticesData(K.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,R,I),this.matricesWeightsExtra&&u.updateVerticesData(K.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,R,I),this.indices&&u.setIndices(this.indices,null),this}static _TransformVector3Coordinates(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const K=U.TmpVectors.PR[0],C=U.TmpVectors.PR[1];for(let D=I;D<I+B;D+=3)U.PR.FromArrayToRef(u,D,K),U.PR.TransformCoordinatesToRef(K,R,C),u[D]=C.x,u[D+1]=C.y,u[D+2]=C.z}static _TransformVector3Normals(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const K=U.TmpVectors.PR[0],C=U.TmpVectors.PR[1];for(let D=I;D<I+B;D+=3)U.PR.FromArrayToRef(u,D,K),U.PR.TransformNormalToRef(K,R,C),u[D]=C.x,u[D+1]=C.y,u[D+2]=C.z}static _TransformVector4Normals(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const K=U.TmpVectors.Vector4[0],C=U.TmpVectors.Vector4[1];for(let D=I;D<I+B;D+=4)U.Vector4.FromArrayToRef(u,D,K),U.Vector4.TransformNormalToRef(K,R,C),u[D]=C.x,u[D+1]=C.y,u[D+2]=C.z,u[D+3]=C.w}static _FlipFaces(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.length;for(let B=R;B<R+I;B+=3){const R=u[B+1];u[B+1]=u[B+2],u[B+2]=R}}transform(u){const R=u.determinant()<0;return this.Mu&&P._TransformVector3Coordinates(this.Mu,u),this.ou&&P._TransformVector3Normals(this.ou,u),this.tangents&&P._TransformVector4Normals(this.tangents,u),R&&this.indices&&P._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const u=[];for(const R of this.materialInfos){const I=new P;if(this.Mu&&(I.Mu=this.Mu.slice(3*R.verticesStart,3*(R.verticesCount+R.verticesStart))),this.ou&&(I.ou=this.ou.slice(3*R.verticesStart,3*(R.verticesCount+R.verticesStart))),this.tangents&&(I.tangents=this.tangents.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.ju&&(I.ju=this.ju.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.hu&&(I.hu=this.hu.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.uvs2&&(I.uvs2=this.uvs2.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.uvs3&&(I.uvs3=this.uvs3.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.uvs4&&(I.uvs4=this.uvs4.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.uvs5&&(I.uvs5=this.uvs5.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.uvs6&&(I.uvs6=this.uvs6.slice(2*R.verticesStart,2*(R.verticesCount+R.verticesStart))),this.matricesIndices&&(I.matricesIndices=this.matricesIndices.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.matricesIndicesExtra&&(I.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.matricesWeights&&(I.matricesWeights=this.matricesWeights.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.matricesWeightsExtra&&(I.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*R.verticesStart,4*(R.verticesCount+R.verticesStart))),this.indices){I.indices=[];for(let u=R.indexStart;u<R.indexStart+R.indexCount;u++)I.indices.push(this.indices[u]-R.verticesStart)}const B=new r;B.indexStart=0,B.indexCount=I.indices?I.indices.length:0,B.materialIndex=R.materialIndex,B.verticesStart=0,B.verticesCount=(I.Mu?I.Mu.length:0)/3,I.materialInfos=[B],u.push(I)}return u}merge(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const K=Array.isArray(u)?u.map((u=>({vertexData:u}))):[{vertexData:u}];return(0,G.l)(this._mergeCoroutine(void 0,K,R,!1,I,B,U))}*_mergeCoroutine(u,R){var I,B;let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let G=R.map((u=>u.vertexData)),S=this;if(t)for(const K of G)K&&(K._validate(),!this.ou&&K.ou&&(this.ou=new Float32Array(this.Mu.length)),!this.tangents&&K.tangents&&(this.tangents=new Float32Array(this.Mu.length/3*4)),!this.hu&&K.hu&&(this.hu=new Float32Array(this.Mu.length/3*2)),!this.uvs2&&K.uvs2&&(this.uvs2=new Float32Array(this.Mu.length/3*2)),!this.uvs3&&K.uvs3&&(this.uvs3=new Float32Array(this.Mu.length/3*2)),!this.uvs4&&K.uvs4&&(this.uvs4=new Float32Array(this.Mu.length/3*2)),!this.uvs5&&K.uvs5&&(this.uvs5=new Float32Array(this.Mu.length/3*2)),!this.uvs6&&K.uvs6&&(this.uvs6=new Float32Array(this.Mu.length/3*2)),!this.ju&&K.ju&&(this.ju=new Float32Array(this.Mu.length/3*4),this.ju.fill(1)),!this.matricesIndices&&K.matricesIndices&&(this.matricesIndices=new Float32Array(this.Mu.length/3*4)),!this.matricesWeights&&K.matricesWeights&&(this.matricesWeights=new Float32Array(this.Mu.length/3*4)),!this.matricesIndicesExtra&&K.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Mu.length/3*4)),!this.matricesWeightsExtra&&K.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Mu.length/3*4)));for(const K of G)if(K)if(t)this.ou&&!K.ou&&(K.ou=new Float32Array(K.Mu.length)),this.tangents&&!K.tangents&&(K.tangents=new Float32Array(K.Mu.length/3*4)),this.hu&&!K.hu&&(K.hu=new Float32Array(K.Mu.length/3*2)),this.uvs2&&!K.uvs2&&(K.uvs2=new Float32Array(K.Mu.length/3*2)),this.uvs3&&!K.uvs3&&(K.uvs3=new Float32Array(K.Mu.length/3*2)),this.uvs4&&!K.uvs4&&(K.uvs4=new Float32Array(K.Mu.length/3*2)),this.uvs5&&!K.uvs5&&(K.uvs5=new Float32Array(K.Mu.length/3*2)),this.uvs6&&!K.uvs6&&(K.uvs6=new Float32Array(K.Mu.length/3*2)),this.ju&&!K.ju&&(K.ju=new Float32Array(K.Mu.length/3*4),K.ju.fill(1)),this.matricesIndices&&!K.matricesIndices&&(K.matricesIndices=new Float32Array(K.Mu.length/3*4)),this.matricesWeights&&!K.matricesWeights&&(K.matricesWeights=new Float32Array(K.Mu.length/3*4)),this.matricesIndicesExtra&&!K.matricesIndicesExtra&&(K.matricesIndicesExtra=new Float32Array(K.Mu.length/3*4)),this.matricesWeightsExtra&&!K.matricesWeightsExtra&&(K.matricesWeightsExtra=new Float32Array(K.Mu.length/3*4));else if(K._validate(),!this.ou!==!K.ou||!this.tangents!==!K.tangents||!this.hu!==!K.hu||!this.uvs2!==!K.uvs2||!this.uvs3!==!K.uvs3||!this.uvs4!==!K.uvs4||!this.uvs5!==!K.uvs5||!this.uvs6!==!K.uvs6||!this.ju!==!K.ju||!this.matricesIndices!==!K.matricesIndices||!this.matricesWeights!==!K.matricesWeights||!this.matricesIndicesExtra!==!K.matricesIndicesExtra||!this.matricesWeightsExtra!==!K.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(s){let I=0,B=0,U=0;const K=[];let C=null;const D=[];for(const R of this.splitBasedOnMaterialID())D.push({vertexData:R,transform:u});for(const u of R)if(u.vertexData)for(const R of u.vertexData.splitBasedOnMaterialID())D.push({vertexData:R,transform:u.transform});D.sort(((u,R)=>{const I=u.vertexData.materialInfos?u.vertexData.materialInfos[0].materialIndex:0,B=R.vertexData.materialInfos?R.vertexData.materialInfos[0].materialIndex:0;return I>B?1:I===B?0:-1}));for(const u of D){const R=u.vertexData;if(I=R.materialInfos?R.materialInfos[0].materialIndex:0,C&&C.materialIndex===I)C.indexCount+=R.indices.length,C.verticesCount+=R.Mu.length/3;else{const u=new r;u.materialIndex=I,u.indexStart=B,u.indexCount=R.indices.length,u.verticesStart=U,u.verticesCount=R.Mu.length/3,K.push(u),C=u}B+=R.indices.length,U+=R.Mu.length/3}const s=D.splice(0,1)[0];S=s.vertexData,u=s.transform,G=D.map((u=>u.vertexData)),R=D,this.materialInfos=K}const b=G.reduce(((u,R)=>{var I;return u+((null===(I=R.indices)||void 0===I?void 0:I.length)??0)}),(null===(I=S.indices)||void 0===I?void 0:I.length)??0);let X=D||G.some((u=>u.indices===S.indices))?null===(B=S.indices)||void 0===B?void 0:B.slice():S.indices;if(b>0){var E;let I=(null===(E=X)||void 0===E?void 0:E.length)??0;if(X||(X=new Array(b)),X.length!==b){if(Array.isArray(X))X.length=b;else{const u=U||X instanceof Uint32Array?new Uint32Array(b):new Uint16Array(b);u.set(X),X=u}u&&u.determinant()<0&&P._FlipFaces(X,0,I)}let B=S.Mu?S.Mu.length/3:0;for(const{vertexData:u,transform:U}of R)if(u.indices){for(let R=0;R<u.indices.length;R++)X[I+R]=u.indices[R]+B;U&&U.determinant()<0&&P._FlipFaces(X,I,u.indices.length),B+=u.Mu.length/3,I+=u.indices.length,C&&(yield)}}return this.indices=X,this.Mu=P._MergeElement(K.i.PositionKind,S.Mu,u,R.map((u=>[u.vertexData.Mu,u.transform]))),C&&(yield),S.ou&&(this.ou=P._MergeElement(K.i.NormalKind,S.ou,u,R.map((u=>[u.vertexData.ou,u.transform]))),C&&(yield)),S.tangents&&(this.tangents=P._MergeElement(K.i.TangentKind,S.tangents,u,R.map((u=>[u.vertexData.tangents,u.transform]))),C&&(yield)),S.hu&&(this.hu=P._MergeElement(K.i.UVKind,S.hu,u,R.map((u=>[u.vertexData.hu,u.transform]))),C&&(yield)),S.uvs2&&(this.uvs2=P._MergeElement(K.i.UV2Kind,S.uvs2,u,R.map((u=>[u.vertexData.uvs2,u.transform]))),C&&(yield)),S.uvs3&&(this.uvs3=P._MergeElement(K.i.UV3Kind,S.uvs3,u,R.map((u=>[u.vertexData.uvs3,u.transform]))),C&&(yield)),S.uvs4&&(this.uvs4=P._MergeElement(K.i.UV4Kind,S.uvs4,u,R.map((u=>[u.vertexData.uvs4,u.transform]))),C&&(yield)),S.uvs5&&(this.uvs5=P._MergeElement(K.i.UV5Kind,S.uvs5,u,R.map((u=>[u.vertexData.uvs5,u.transform]))),C&&(yield)),S.uvs6&&(this.uvs6=P._MergeElement(K.i.UV6Kind,S.uvs6,u,R.map((u=>[u.vertexData.uvs6,u.transform]))),C&&(yield)),S.ju&&(this.ju=P._MergeElement(K.i.ColorKind,S.ju,u,R.map((u=>[u.vertexData.ju,u.transform]))),(void 0!==S.hasVertexAlpha||R.some((u=>void 0!==u.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=S.hasVertexAlpha||R.some((u=>u.vertexData.hasVertexAlpha))),C&&(yield)),S.matricesIndices&&(this.matricesIndices=P._MergeElement(K.i.MatricesIndicesKind,S.matricesIndices,u,R.map((u=>[u.vertexData.matricesIndices,u.transform]))),C&&(yield)),S.matricesWeights&&(this.matricesWeights=P._MergeElement(K.i.MatricesWeightsKind,S.matricesWeights,u,R.map((u=>[u.vertexData.matricesWeights,u.transform]))),C&&(yield)),S.matricesIndicesExtra&&(this.matricesIndicesExtra=P._MergeElement(K.i.MatricesIndicesExtraKind,S.matricesIndicesExtra,u,R.map((u=>[u.vertexData.matricesIndicesExtra,u.transform]))),C&&(yield)),S.matricesWeightsExtra&&(this.matricesWeightsExtra=P._MergeElement(K.i.MatricesWeightsExtraKind,S.matricesWeightsExtra,u,R.map((u=>[u.vertexData.matricesWeightsExtra,u.transform])))),this}static _MergeElement(u,R,I,B){const U=B.filter((u=>null!==u[0]&&void 0!==u[0]));if(!R&&0==U.length)return R;if(!R)return this._MergeElement(u,U[0][0],U[0][1],U.slice(1));const C=U.reduce(((u,R)=>u+R[0].length),R.length),D=u===K.i.PositionKind?P._TransformVector3Coordinates:u===K.i.NormalKind?P._TransformVector3Normals:u===K.i.TangentKind?P._TransformVector4Normals:()=>{};if(R instanceof Float32Array){const u=new Float32Array(C);u.set(R),I&&D(u,I,0,R.length);let B=R.length;for(const[R,I]of U)u.set(R,B),I&&D(u,I,B,R.length),B+=R.length;return u}{const u=new Array(C);for(let I=0;I<R.length;I++)u[I]=R[I];I&&D(u,I,0,R.length);let B=R.length;for(const[R,I]of U){for(let I=0;I<R.length;I++)u[B+I]=R[I];I&&D(u,I,B,R.length),B+=R.length}return u}}_validate(){if(!this.Mu)throw new S.h("Positions are required",S.d.MeshInvalidPositionsError);const u=(u,R)=>{const I=K.i.DeduceStride(u);if(R.length%I!==0)throw new Error("The "+u+"s array count must be a multiple of "+I);return R.length/I},R=u(K.i.PositionKind,this.Mu),I=(I,B)=>{const U=u(I,B);if(U!==R)throw new Error("The "+I+"s element count ("+U+") does not match the positions count ("+R+")")};this.ou&&I(K.i.NormalKind,this.ou),this.tangents&&I(K.i.TangentKind,this.tangents),this.hu&&I(K.i.UVKind,this.hu),this.uvs2&&I(K.i.UV2Kind,this.uvs2),this.uvs3&&I(K.i.UV3Kind,this.uvs3),this.uvs4&&I(K.i.UV4Kind,this.uvs4),this.uvs5&&I(K.i.UV5Kind,this.uvs5),this.uvs6&&I(K.i.UV6Kind,this.uvs6),this.ju&&I(K.i.ColorKind,this.ju),this.matricesIndices&&I(K.i.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&I(K.i.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&I(K.i.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&I(K.i.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const u=this.serialize();return P.Parse(u)}serialize(){const u={};if(this.Mu&&(u.Mu=Array.from(this.Mu)),this.ou&&(u.ou=Array.from(this.ou)),this.tangents&&(u.tangents=Array.from(this.tangents)),this.hu&&(u.hu=Array.from(this.hu)),this.uvs2&&(u.uvs2=Array.from(this.uvs2)),this.uvs3&&(u.uvs3=Array.from(this.uvs3)),this.uvs4&&(u.uvs4=Array.from(this.uvs4)),this.uvs5&&(u.uvs5=Array.from(this.uvs5)),this.uvs6&&(u.uvs6=Array.from(this.uvs6)),this.ju&&(u.ju=Array.from(this.ju),u.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(u.matricesIndices=Array.from(this.matricesIndices),u.matricesIndicesExpanded=!0),this.matricesWeights&&(u.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(u.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),u.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(u.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),u.indices=this.indices?Array.from(this.indices):[],this.materialInfos){u.materialInfos=[];for(const R of this.materialInfos){const I={indexStart:R.indexStart,indexCount:R.indexCount,materialIndex:R.materialIndex,verticesStart:R.verticesStart,verticesCount:R.verticesCount};u.materialInfos.push(I)}}return u}static ExtractFromMesh(u,R,I){return P._ExtractFrom(u,R,I)}static ExtractFromGeometry(u,R,I){return P._ExtractFrom(u,R,I)}static _ExtractFrom(u,R,I){const B=new P;if(u.isVerticesDataPresent(K.i.PositionKind)&&(B.Mu=u.getVerticesData(K.i.PositionKind,R,I)),u.isVerticesDataPresent(K.i.NormalKind)&&(B.ou=u.getVerticesData(K.i.NormalKind,R,I)),u.isVerticesDataPresent(K.i.TangentKind)&&(B.tangents=u.getVerticesData(K.i.TangentKind,R,I)),u.isVerticesDataPresent(K.i.UVKind)&&(B.hu=u.getVerticesData(K.i.UVKind,R,I)),u.isVerticesDataPresent(K.i.UV2Kind)&&(B.uvs2=u.getVerticesData(K.i.UV2Kind,R,I)),u.isVerticesDataPresent(K.i.UV3Kind)&&(B.uvs3=u.getVerticesData(K.i.UV3Kind,R,I)),u.isVerticesDataPresent(K.i.UV4Kind)&&(B.uvs4=u.getVerticesData(K.i.UV4Kind,R,I)),u.isVerticesDataPresent(K.i.UV5Kind)&&(B.uvs5=u.getVerticesData(K.i.UV5Kind,R,I)),u.isVerticesDataPresent(K.i.UV6Kind)&&(B.uvs6=u.getVerticesData(K.i.UV6Kind,R,I)),u.isVerticesDataPresent(K.i.ColorKind)){const U=u.rD||u,C=U.getVertexBuffer(K.i.ColorKind),D=U.getVerticesData(K.i.ColorKind,R,I);if(3===C.getSize()){const u=new Float32Array(4*D.length/3);for(let R=0,I=0;R<D.length;R+=3,I+=4)u[I]=D[R],u[I+1]=D[R+1],u[I+2]=D[R+2],u[I+3]=1;B.ju=u}else{if(4!==C.getSize())throw new Error(`Unexpected number of color components: ${C.getSize()}`);B.ju=D}}return u.isVerticesDataPresent(K.i.MatricesIndicesKind)&&(B.matricesIndices=u.getVerticesData(K.i.MatricesIndicesKind,R,I)),u.isVerticesDataPresent(K.i.MatricesWeightsKind)&&(B.matricesWeights=u.getVerticesData(K.i.MatricesWeightsKind,R,I)),u.isVerticesDataPresent(K.i.MatricesIndicesExtraKind)&&(B.matricesIndicesExtra=u.getVerticesData(K.i.MatricesIndicesExtraKind,R,I)),u.isVerticesDataPresent(K.i.MatricesWeightsExtraKind)&&(B.matricesWeightsExtra=u.getVerticesData(K.i.MatricesWeightsExtraKind,R,I)),B.indices=u.PD(R,I),B}static CreateRibbon(u){throw(0,C.c)("ribbonBuilder")}static CreateBox(u){throw(0,C.c)("boxBuilder")}static CreateTiledBox(u){throw(0,C.c)("tiledBoxBuilder")}static CreateTiledPlane(u){throw(0,C.c)("tiledPlaneBuilder")}static CreateSphere(u){throw(0,C.c)("sphereBuilder")}static CreateCylinder(u){throw(0,C.c)("cylinderBuilder")}static CreateTorus(u){throw(0,C.c)("torusBuilder")}static CreateLineSystem(u){throw(0,C.c)("linesBuilder")}static CreateDashedLines(u){throw(0,C.c)("linesBuilder")}static CreateGround(u){throw(0,C.c)("groundBuilder")}static CreateTiledGround(u){throw(0,C.c)("groundBuilder")}static CreateGroundFromHeightMap(u){throw(0,C.c)("groundBuilder")}static Tt(u){throw(0,C.c)("planeBuilder")}static CreateDisc(u){throw(0,C.c)("discBuilder")}static CreatePolygon(u,R,I,B,U,K,D){throw(0,C.c)("polygonBuilder")}static CreateIcoSphere(u){throw(0,C.c)("icoSphereBuilder")}static CreatePolyhedron(u){throw(0,C.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||U.PR.Up();throw(0,C.c)("capsuleBuilder")}static CreateTorusKnot(u){throw(0,C.c)("torusKnotBuilder")}static ComputeNormals(u,R,I,B){let K=0,C=0,D=0,s=0,t=0,G=0,S=0,b=0,r=0,P=0,X=0,E=0,z=0,f=0,T=0,Q=0,V=0,q=0,e=0,Y=0,M=!1,o=!1,j=!1,h=!1,x=1,g=0,v=null;B&&(M=!!B.facetNormals,o=!!B.facetPositions,j=!!B.facetPartitioning,x=!0===B.useRightHandedSystem?-1:1,g=B.ratio||0,h=!!B.depthSort,v=B.distanceTo,h&&void 0===v&&(v=U.PR.Zero()));let p=0,l=0,Z=0,c=0;for(j&&B&&B.bbSize&&(p=B.subDiv.X*g/B.bbSize.x,l=B.subDiv.Y*g/B.bbSize.y,Z=B.subDiv.Z*g/B.bbSize.z,c=B.subDiv.max*B.subDiv.max,B.facetPartitioning.length=0),K=0;K<u.length;K++)I[K]=0;const k=R.length/3|0;for(K=0;K<k;K++){if(E=3*R[3*K],z=E+1,f=E+2,T=3*R[3*K+1],Q=T+1,V=T+2,q=3*R[3*K+2],e=q+1,Y=q+2,C=u[E]-u[T],D=u[z]-u[Q],s=u[f]-u[V],t=u[q]-u[T],G=u[e]-u[Q],S=u[Y]-u[V],b=x*(D*S-s*G),r=x*(s*t-C*S),P=x*(C*G-D*t),X=Math.sqrt(b*b+r*r+P*P),X=0===X?1:X,b/=X,r/=X,P/=X,M&&B&&(B.facetNormals[K].x=b,B.facetNormals[K].y=r,B.facetNormals[K].z=P),o&&B&&(B.facetPositions[K].x=(u[E]+u[T]+u[q])/3,B.facetPositions[K].y=(u[z]+u[Q]+u[e])/3,B.facetPositions[K].z=(u[f]+u[V]+u[Y])/3),j&&B){const R=Math.floor((B.facetPositions[K].x-B.bInfo.minimum.x*g)*p),I=Math.floor((B.facetPositions[K].y-B.bInfo.minimum.y*g)*l),U=Math.floor((B.facetPositions[K].z-B.bInfo.minimum.z*g)*Z),C=Math.floor((u[E]-B.bInfo.minimum.x*g)*p),D=Math.floor((u[z]-B.bInfo.minimum.y*g)*l),s=Math.floor((u[f]-B.bInfo.minimum.z*g)*Z),t=Math.floor((u[T]-B.bInfo.minimum.x*g)*p),G=Math.floor((u[Q]-B.bInfo.minimum.y*g)*l),S=Math.floor((u[V]-B.bInfo.minimum.z*g)*Z),b=Math.floor((u[q]-B.bInfo.minimum.x*g)*p),r=Math.floor((u[e]-B.bInfo.minimum.y*g)*l),P=Math.floor((u[Y]-B.bInfo.minimum.z*g)*Z),X=C+B.subDiv.max*D+c*s,M=t+B.subDiv.max*G+c*S,o=b+B.subDiv.max*r+c*P,j=R+B.subDiv.max*I+c*U;B.facetPartitioning[j]=B.facetPartitioning[j]?B.facetPartitioning[j]:[],B.facetPartitioning[X]=B.facetPartitioning[X]?B.facetPartitioning[X]:[],B.facetPartitioning[M]=B.facetPartitioning[M]?B.facetPartitioning[M]:[],B.facetPartitioning[o]=B.facetPartitioning[o]?B.facetPartitioning[o]:[],B.facetPartitioning[X].push(K),M!=X&&B.facetPartitioning[M].push(K),o!=M&&o!=X&&B.facetPartitioning[o].push(K),j!=X&&j!=M&&j!=o&&B.facetPartitioning[j].push(K)}if(h&&B&&B.facetPositions){const u=B.depthSortedFacets[K];u.ind=3*K,u.sqDistance=U.PR.DistanceSquared(B.facetPositions[K],v)}I[E]+=b,I[z]+=r,I[f]+=P,I[T]+=b,I[Q]+=r,I[V]+=P,I[q]+=b,I[e]+=r,I[Y]+=P}for(K=0;K<I.length/3;K++)b=I[3*K],r=I[3*K+1],P=I[3*K+2],X=Math.sqrt(b*b+r*r+P*P),X=0===X?1:X,b/=X,r/=X,P/=X,I[3*K]=b,I[3*K+1]=r,I[3*K+2]=P}static _ComputeSides(u,R,I,B,K,C,D){const s=I.length,t=B.length;let G,S;switch(u=u||P.DEFAULTSIDE){case P.FRONTSIDE:break;case P.BACKSIDE:for(G=0;G<s;G+=3){const u=I[G];I[G]=I[G+2],I[G+2]=u}for(S=0;S<t;S++)B[S]=-B[S];break;case P.DOUBLESIDE:{const u=R.length,b=u/3;for(let I=0;I<u;I++)R[u+I]=R[I];for(G=0;G<s;G+=3)I[G+s]=I[G+2]+b,I[G+1+s]=I[G+1]+b,I[G+2+s]=I[G]+b;for(S=0;S<t;S++)B[t+S]=-B[S];const r=K.length;let P=0;for(P=0;P<r;P++)K[P+r]=K[P];for(C=C||new U.Vector4(0,0,1,1),D=D||new U.Vector4(0,0,1,1),P=0,G=0;G<r/2;G++)K[P]=C.x+(C.z-C.x)*K[P],K[P+1]=C.y+(C.w-C.y)*K[P+1],K[P+r]=D.x+(D.z-D.x)*K[P+r],K[P+r+1]=D.y+(D.w-D.y)*K[P+r+1],P+=2;break}}}static Parse(u){const R=new P,I=u.Mu;I&&R.set(I,K.i.PositionKind);const B=u.ou;B&&R.set(B,K.i.NormalKind);const U=u.tangents;U&&R.set(U,K.i.TangentKind);const C=u.hu;C&&R.set(C,K.i.UVKind);const s=u.uvs2;s&&R.set(s,K.i.UV2Kind);const t=u.uvs3;t&&R.set(t,K.i.UV3Kind);const G=u.uvs4;G&&R.set(G,K.i.UV4Kind);const S=u.uvs5;S&&R.set(S,K.i.UV5Kind);const b=u.uvs6;b&&R.set(b,K.i.UV6Kind);const X=u.ju;X&&(R.set(D.TD.CheckColors4(X,I.length/3),K.i.ColorKind),void 0!==u.hasVertexAlpha&&(R.hasVertexAlpha=u.hasVertexAlpha));const E=u.matricesIndices;E&&R.set(E,K.i.MatricesIndicesKind);const z=u.matricesWeights;z&&R.set(z,K.i.MatricesWeightsKind);const f=u.indices;f&&(R.indices=f);const T=u.materialInfos;if(T){R.materialInfos=[];for(const u of T){const I=new r;I.indexCount=u.indexCount,I.indexStart=u.indexStart,I.verticesCount=u.verticesCount,I.verticesStart=u.verticesStart,I.materialIndex=u.materialIndex,R.materialInfos.push(I)}}return R}static ImportVertexData(u,R){const I=P.Parse(u);R.setAllVerticesData(I,u.updatable)}}P.FRONTSIDE=0,P.BACKSIDE=1,P.DOUBLESIDE=2,P.DEFAULTSIDE=0,P._UniqueIdGenerator=0,(0,B.c)([t.i.filter((function(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];let[B]=R;return!Array.isArray(B)}))],P,"_TransformVector3Coordinates",null),(0,B.c)([t.i.filter((function(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];let[B]=R;return!Array.isArray(B)}))],P,"_TransformVector3Normals",null),(0,B.c)([t.i.filter((function(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];let[B]=R;return!Array.isArray(B)}))],P,"_TransformVector4Normals",null),(0,B.c)([t.i.filter((function(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];let[B]=R;return!Array.isArray(B)}))],P,"_FlipFaces",null)},13020:(u,R,I)=>{var B=I(12907),U=I(12549),K=I(12481),C=I(12315),D=I(12808);B.b.prototype.thinInstanceAdd=function(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.eu().getEngine().getCaps().instancedArrays)return C.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(u)?u.length:1);const I=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(u))for(let B=0;B<u.length;++B)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,u[B],B===u.length-1&&R);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,u,R);return I},B.b.prototype.thinInstanceAddSelf=function(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(K.Matrix.IdentityReadOnly,u)},B.b.prototype.thinInstanceRegisterAttribute=function(u,R){u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),this.removeVerticesData(u),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[u]=R,this._userThinInstanceBuffersStorage.sizes[u]=R*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[u]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[u]),this._userThinInstanceBuffersStorage.vertexBuffers[u]=new U.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[u],u,!0,!1,R,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])},B.b.prototype.thinInstanceSetMatrixAt=function(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||u>=this._thinInstanceDataStorage.instancesCount)return!1;const B=this._thinInstanceDataStorage.matrixData;return R.copyToArray(B,16*u),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[u]=R),I&&(this.fS("matrix"),this.vu||this.thinInstanceRefreshBoundingInfo(!1)),!0},B.b.prototype.thinInstanceSetAttributeAt=function(u,R,I){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[u]||R>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(u,0),this._userThinInstanceBuffersStorage.data[u].set(I,R*this._userThinInstanceBuffersStorage.strides[u]),B&&this.fS(u),!0)},Object.defineProperty(B.b.prototype,"VD",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(u){var R;const I=this._thinInstanceDataStorage.matrixData??(null===(R=this.source)||void 0===R?void 0:R._thinInstanceDataStorage.matrixData);u<=(I?I.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=u)},enumerable:!0,configurable:!0}),B.b.prototype._thinInstanceCreateMatrixBuffer=function(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=new U.e(this.getEngine(),R,!I,16,!1,!0);for(let U=0;U<4;U++)this.setVerticesBuffer(B.createVertexBuffer(u+U,4*U,4));return B},B.b.prototype.zS=function(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var K;if(I=I||16,"matrix"===u)null===(K=this._thinInstanceDataStorage.matrixBuffer)||void 0===K||K.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=R?R.length:32*I,this._thinInstanceDataStorage.matrixData=R,this._thinInstanceDataStorage.worldMatrices=null,null!==R?(this._thinInstanceDataStorage.instancesCount=R.length/I,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",R,B),this.vu||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.vu||this.refreshBoundingInfo());else if("previousMatrix"===u){var C;null===(C=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===C||C.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=R,null!==R&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",R,B))}else{var D;if(u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),null===R)null!==(D=this._userThinInstanceBuffersStorage)&&void 0!==D&&D.data[u]&&(this.removeVerticesData(u),delete this._userThinInstanceBuffersStorage.data[u],delete this._userThinInstanceBuffersStorage.strides[u],delete this._userThinInstanceBuffersStorage.sizes[u],delete this._userThinInstanceBuffersStorage.vertexBuffers[u]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[u]=R,this._userThinInstanceBuffersStorage.strides[u]=I,this._userThinInstanceBuffersStorage.sizes[u]=R.length,this._userThinInstanceBuffersStorage.vertexBuffers[u]=new U.i(this.getEngine(),R,u,!B,!1,I,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},B.b.prototype.fS=function(u){var R;if("matrix"===u)this.Kr&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(u),null===(R=this._thinInstanceDataStorage.matrixBuffer)||void 0===R||R.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===u){var I;this.Kr&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(u),null===(I=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===I||I.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var B;u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[u]&&(this.Kr&&!this._userThinInstanceBuffersStorage.vertexBuffers[u].isUpdatable()&&this._thinInstanceRecreateBuffer(u),this._userThinInstanceBuffersStorage.vertexBuffers[u].updateDirectly(this._userThinInstanceBuffersStorage.data[u],0))}},B.b.prototype.thinInstancePartialBufferUpdate=function(u,R,I){var B;"matrix"===u?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(R,I):(u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[u]&&this._userThinInstanceBuffersStorage.vertexBuffers[u].updateDirectly(R,I))},B.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const u=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let R=0;R<this._thinInstanceDataStorage.instancesCount;++R)this._thinInstanceDataStorage.worldMatrices[R]=K.Matrix.TR(u,16*R)}return this._thinInstanceDataStorage.worldMatrices},B.b.prototype.thinInstanceRefreshBoundingInfo=function(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const B=this._thinInstanceDataStorage.boundingVectors;if(u||!this.rawBoundingInfo){B.length=0,this.refreshBoundingInfo(R,I);const u=this.getBoundingInfo();this.rawBoundingInfo=new D.c(u.minimum,u.maximum)}const U=this.getBoundingInfo(),C=this._thinInstanceDataStorage.matrixData;if(0===B.length)for(let K=0;K<U.boundingBox.vectors.length;++K)B.push(U.boundingBox.vectors[K].clone());K.TmpVectors.PR[0].fD(Number.POSITIVE_INFINITY),K.TmpVectors.PR[1].fD(Number.NEGATIVE_INFINITY);for(let D=0;D<this._thinInstanceDataStorage.instancesCount;++D){K.Matrix.FromArrayToRef(C,16*D,K.TmpVectors.Matrix[0]);for(let u=0;u<B.length;++u)K.PR.TransformCoordinatesToRef(B[u],K.TmpVectors.Matrix[0],K.TmpVectors.PR[2]),K.TmpVectors.PR[0].minimizeInPlace(K.TmpVectors.PR[2]),K.TmpVectors.PR[1].maximizeInPlace(K.TmpVectors.PR[2])}U.reConstruct(K.TmpVectors.PR[0],K.TmpVectors.PR[1]),this.pu()},B.b.prototype._thinInstanceRecreateBuffer=function(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var I;if("matrix"===u)null===(I=this._thinInstanceDataStorage.matrixBuffer)||void 0===I||I.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,R);else if("previousMatrix"===u){var B;if(this._scene.needsPreviousWorldMatrices)null===(B=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,R)}else{var K;u===U.i.ColorKind&&(u=U.i.ColorInstanceKind),null===(K=this._userThinInstanceBuffersStorage.vertexBuffers[u])||void 0===K||K.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[u]=new U.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[u],u,!R,!1,this._userThinInstanceBuffersStorage.strides[u],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},B.b.prototype._thinInstanceUpdateBufferSize=function(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u===U.i.ColorKind&&(u=U.i.ColorInstanceKind);const I="matrix"===u;if(!I&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[u]))return;const B=I?16:this._userThinInstanceBuffersStorage.strides[u],K=I?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[u];let C=I?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[u];const D=(this._thinInstanceDataStorage.instancesCount+R)*B;let s=K;for(;s<D;)s*=2;if(!C||K!=s){if(C){const u=new Float32Array(s);u.set(C,0),C=u}else C=new Float32Array(s);var t,G,S;if(I){if(null===(t=this._thinInstanceDataStorage.matrixBuffer)||void 0===t||t.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",C,!1),this._thinInstanceDataStorage.matrixData=C,this._thinInstanceDataStorage.matrixBufferSize=s,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(G=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===G||G.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",C,!1)}else null===(S=this._userThinInstanceBuffersStorage.vertexBuffers[u])||void 0===S||S.dispose(),this._userThinInstanceBuffersStorage.data[u]=C,this._userThinInstanceBuffersStorage.sizes[u]=s,this._userThinInstanceBuffersStorage.vertexBuffers[u]=new U.i(this.getEngine(),C,u,!0,!1,B,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},B.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},B.b.prototype._disposeThinInstanceSpecificData=function(){var u;null!==(u=this._thinInstanceDataStorage)&&void 0!==u&&u.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},12883:(u,R,I)=>{I.d(R,{e:()=>G});var B=I(12466),U=I(12472),K=I(12507),C=I(12303),D=I(12481),s=I(12888),t=I(12433);class G extends s.d{get billboardMode(){return this._billboardMode}set billboardMode(u){this._billboardMode!==u&&(this._billboardMode=u,this._cache.useBillboardPosition=0!==(this._billboardMode&G.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(u){this._infiniteDistance!==u&&(this._infiniteDistance=u)}constructor(u){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new D.PR(0,0,1),this._up=new D.PR(0,1,0),this._right=new D.PR(1,0,0),this._position=D.PR.Zero(),this._rotation=D.PR.Zero(),this._rotationQuaternion=null,this._scaling=D.PR.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=G.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Dr=D.Matrix.Zero(),this._usePivotMatrix=!1,this._absolutePosition=D.PR.Zero(),this._absoluteScaling=D.PR.Zero(),this._absoluteRotationQuaternion=D.Quaternion.Identity(),this._pivotMatrix=D.Matrix.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new C.c,this._nonUniformScaling=!1,R&&this.eu().addTransformNode(this)}getClassName(){return"Rb"}get position(){return this._position}set position(u){this._position=u,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(u){this._rotation=u,this._rotationQuaternion=null,this._markAsDirtyInternal()}get zD(){return this._scaling}set zD(u){this._scaling=u,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(u){this._rotationQuaternion=u,u&&this._rotation.fD(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return D.PR.TransformNormalFromFloatsToRef(0,0,this.eu().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return D.PR.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return D.PR.TransformNormalFromFloatsToRef(this.eu().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(u){return this._poseMatrix?(this._poseMatrix.B(u),this):(this._poseMatrix=u.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=D.Matrix.Identity()),this._poseMatrix}_isSynchronized(){const u=this._cache;return this._billboardMode===u.billboardMode&&this._billboardMode===G.BILLBOARDMODE_NONE&&(!u.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const u=this._cache;u.localMatrixUpdated=!1,u.billboardMode=-1,u.infiniteDistance=!1,u.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(u){return this.setPivotMatrix(u,!1)}setPivotMatrix(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.B(u),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=R,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=D.Matrix.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0);B&&I&&I(this,B);for(const U of this.getChildTransformNodes(!0))U.instantiateHierarchy(B,R,I);return B}hD(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.fD(0),this._rotationQuaternion=this._rotationQuaternion||D.Quaternion.Identity(),u.decompose(this._scaling,this._rotationQuaternion,this._position),this.bD(!0)):(this._worldMatrix=u,this._absolutePosition.ED(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.bD(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.bD(!0),this}get FS(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.bD(),this._absolutePosition}setAbsolutePosition(u){if(!u)return this;let R,I,B;if(void 0===u.x){if(arguments.length<3)return this;R=arguments[0],I=arguments[1],B=arguments[2]}else R=u.x,I=u.y,B=u.z;if(this.parent){const u=D.TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(u),D.PR.TransformCoordinatesFromFloatsToRef(R,I,B,u,this.position)}else this.position.x=R,this.position.y=I,this.position.z=B;return this._absolutePosition.B(u),this}setPositionWithLocalVector(u){return this.bD(),this.position=D.PR.TransformNormal(u,this.Dr),this}getPositionExpressedInLocalSpace(){this.bD();const u=D.TmpVectors.Matrix[0];return this.Dr.invertToRef(u),D.PR.TransformNormal(this.position,u)}locallyTranslate(u){return this.bD(!0),this.position=D.PR.TransformCoordinates(u,this.Dr),this}lookAt(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const K=G._LookAtVectorCache,C=0===U?this.position:this.getAbsolutePosition();if(u.subtractToRef(C,K),this.setDirection(K,R,I,B),1===U&&this.parent)if(this.rotationQuaternion){const u=D.TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);const R=D.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.invert(),u.multiplyToRef(R,u),this.rotationQuaternion.fromRotationMatrix(u)}else{const u=D.TmpVectors.Quaternion[0];D.Quaternion.FromEulerVectorToRef(this.rotation,u);const R=D.TmpVectors.Matrix[0];u.toRotationMatrix(R);const I=D.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.invert(),R.multiplyToRef(I,R),u.fromRotationMatrix(R),u.toEulerAnglesToRef(this.rotation)}return this}zs(u){const R=D.PR.Zero();return this.getDirectionToRef(u,R),R}getDirectionToRef(u,R){return D.PR.TransformNormalToRef(u,this.getWorldMatrix(),R),this}setDirection(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const U=-Math.atan2(u.z,u.x)+Math.PI/2,K=Math.sqrt(u.x*u.x+u.z*u.z),C=-Math.atan2(u.y,K);return this.rotationQuaternion?D.Quaternion.RotationYawPitchRollToRef(U+R,C+I,B,this.rotationQuaternion):(this.rotation.x=C+I,this.rotation.y=U+R,this.rotation.z=B),this}setPivotPoint(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.eu().getRenderId()&&this.bD(!0);const I=this.getWorldMatrix();if(1==R){const R=D.TmpVectors.Matrix[0];I.invertToRef(R),u=D.PR.TransformCoordinates(u,R)}return this.setPivotMatrix(D.Matrix.Translation(-u.x,-u.y,-u.z),!0)}getPivotPoint(){const u=D.PR.Zero();return this.getPivotPointToRef(u),u}getPivotPointToRef(u){return u.x=-this._pivotMatrix.m[12],u.y=-this._pivotMatrix.m[13],u.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const u=D.PR.Zero();return this.getAbsolutePivotPointToRef(u),u}getAbsolutePivotPointToRef(u){return this.getPivotPointToRef(u),D.PR.TransformCoordinatesToRef(u,this.getWorldMatrix(),u),this}Ot(u){if(this._isDirty)return this;if(this._children)for(const R of this._children)R.Ot(u);return super.Ot(u)}setParent(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!u&&!this.parent)return this;const B=D.TmpVectors.Quaternion[0],U=D.TmpVectors.PR[0],K=D.TmpVectors.PR[1],C=D.TmpVectors.Matrix[1];D.Matrix.IdentityToRef(C);const s=D.TmpVectors.Matrix[0];this.bD(!0);let t=this.rotationQuaternion;return t||(t=G._TmpRotation,D.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,t)),D.Matrix.ComposeToRef(this.zD,t,this.position,s),this.parent&&s.multiplyToRef(this.parent.bD(!0),s),u&&(u.bD(!0).invertToRef(C),s.multiplyToRef(C,s)),s.decompose(K,B,U,R?this:void 0),this.rotationQuaternion?this.rotationQuaternion.B(B):B.toEulerAnglesToRef(this.rotation),this.zD.B(K),this.position.B(U),this.parent=u,I&&this.setPivotMatrix(D.Matrix.Identity()),this}addChild(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.setParent(this,R),this}removeChild(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.parent!==this||u.setParent(null,R),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(u){return this._nonUniformScaling!==u&&(this._nonUniformScaling=u,!0)}attachToBone(u,R){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=R,this.parent=u,u.getSkeleton().prepare(!0),u.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=u?this._currentParentWhenAttachingToBone:null,this):(u&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(u,R,I){let B;if(u.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.fD(0)),I&&0!==I){if(this.parent){const I=this.parent.getWorldMatrix(),B=D.TmpVectors.Matrix[0];I.invertToRef(B),u=D.PR.TransformNormal(u,B),I.determinant()<0&&(R*=-1)}B=D.Quaternion.RotationAxisToRef(u,R,G._RotationAxisCache),B.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else B=D.Quaternion.RotationAxisToRef(u,R,G._RotationAxisCache),this.rotationQuaternion.multiplyToRef(B,this.rotationQuaternion);return this}rotateAround(u,R,I){R.normalize(),this.rotationQuaternion||(this.rotationQuaternion=D.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.fD(0));const B=D.TmpVectors.PR[0],U=D.TmpVectors.PR[1],K=D.TmpVectors.PR[2],C=D.TmpVectors.Quaternion[0],s=D.TmpVectors.Matrix[0],t=D.TmpVectors.Matrix[1],G=D.TmpVectors.Matrix[2],S=D.TmpVectors.Matrix[3];return u.subtractToRef(this.position,B),D.Matrix.TranslationToRef(B.x,B.y,B.z,s),D.Matrix.TranslationToRef(-B.x,-B.y,-B.z,t),D.Matrix.RotationAxisToRef(R,I,G),t.multiplyToRef(G,S),S.multiplyToRef(s,S),S.decompose(U,C,K),this.position.addInPlace(K),C.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(u,R,I){const B=u.scale(R);if(I&&0!==I)this.setAbsolutePosition(this.getAbsolutePosition().add(B));else{const u=this.getPositionExpressedInLocalSpace().add(B);this.setPositionWithLocalVector(u)}return this}addRotation(u,R,I){let B;this.rotationQuaternion?B=this.rotationQuaternion:(B=D.TmpVectors.Quaternion[1],D.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,B));const U=D.TmpVectors.Quaternion[0];return D.Quaternion.RotationYawPitchRollToRef(R,u,I,U),B.multiplyInPlace(U),this.rotationQuaternion||B.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==G.BILLBOARDMODE_NONE}bD(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const I=this.eu().getRenderId();if(!this._isDirty&&!u&&(this._currentRenderId===I||this.isSynchronized()))return this._currentRenderId=I,this._worldMatrix;R=R||this.eu().activeCamera,this._updateCache();const B=this._cache;B.pivotMatrixUpdated=!1,B.billboardMode=this.billboardMode,B.infiniteDistance=this.infiniteDistance,B.parent=this._parentNode,this._currentRenderId=I,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const U=this._getEffectiveParent(),K=G._TmpScaling;let C,s=this._position;if(this._infiniteDistance&&!this.parent&&R){const u=R.getWorldMatrix(),I=new D.PR(u.m[12],u.m[13],u.m[14]);s=G._TmpTranslation,s.ED(this._position.x+I.x,this._position.y+I.y,this._position.z+I.z)}if(K.ED(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,C=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(D.Quaternion.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.ED(0,0,0))}}else C=G._TmpRotation,D.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,C);if(this._usePivotMatrix){const u=D.TmpVectors.Matrix[1];D.Matrix.ScalingToRef(K.x,K.y,K.z,u);const R=D.TmpVectors.Matrix[0];C.toRotationMatrix(R),this._pivotMatrix.multiplyToRef(u,D.TmpVectors.Matrix[4]),D.TmpVectors.Matrix[4].multiplyToRef(R,this.Dr),this._postMultiplyPivotMatrix&&this.Dr.multiplyToRef(this._pivotMatrixInverse,this.Dr),this.Dr.addTranslationFromFloats(s.x,s.y,s.z)}else D.Matrix.ComposeToRef(K,C,s,this.Dr);if(U&&U.getWorldMatrix){if(u&&U.bD(u),this.billboardMode){if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),u.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),D.TmpVectors.Matrix[7])}else D.TmpVectors.Matrix[7].B(U.getWorldMatrix());const u=D.TmpVectors.PR[5],R=D.TmpVectors.PR[6],I=D.TmpVectors.Quaternion[0];D.TmpVectors.Matrix[7].decompose(R,I,u),D.Matrix.ScalingToRef(R.x,R.y,R.z,D.TmpVectors.Matrix[7]),D.TmpVectors.Matrix[7].setTranslation(u),G.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(I,u),this.Dr.setTranslation(u)),this.Dr.multiplyToRef(D.TmpVectors.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),this.Dr.multiplyToRef(u.getFinalMatrix(),D.TmpVectors.Matrix[6]),D.TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Dr.multiplyToRef(U.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.B(this.Dr);if(R&&this.billboardMode)if(B.useBillboardPosition){if(B.useBillboardPosition){const u=D.TmpVectors.PR[0];this._worldMatrix.getTranslationToRef(u);const I=R.globalPosition;this._worldMatrix.invertToRef(D.TmpVectors.Matrix[1]);const B=D.TmpVectors.PR[1];D.PR.TransformCoordinatesToRef(I,D.TmpVectors.Matrix[1],B),B.normalize();const U=-Math.atan2(B.z,B.x)+Math.PI/2,K=Math.sqrt(B.x*B.x+B.z*B.z),C=-Math.atan2(B.y,K);if(D.Quaternion.RotationYawPitchRollToRef(U,C,0,D.TmpVectors.Quaternion[0]),(this.billboardMode&G.BILLBOARDMODE_ALL)!==G.BILLBOARDMODE_ALL){const u=D.TmpVectors.PR[1];D.TmpVectors.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&G.BILLBOARDMODE_X)!==G.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&G.BILLBOARDMODE_Y)!==G.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&G.BILLBOARDMODE_Z)!==G.BILLBOARDMODE_Z&&(u.z=0),D.Matrix.RotationYawPitchRollToRef(u.y,u.x,u.z,D.TmpVectors.Matrix[0])}else D.Matrix.FromQuaternionToRef(D.TmpVectors.Quaternion[0],D.TmpVectors.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(D.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(D.TmpVectors.PR[0])}}else{const u=D.TmpVectors.PR[0];if(this._worldMatrix.getTranslationToRef(u),D.TmpVectors.Matrix[1].B(R.getViewMatrix()),D.TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0),D.TmpVectors.Matrix[1].invertToRef(D.TmpVectors.Matrix[0]),(this.billboardMode&G.BILLBOARDMODE_ALL)!==G.BILLBOARDMODE_ALL){D.TmpVectors.Matrix[0].decompose(void 0,D.TmpVectors.Quaternion[0],void 0);const u=D.TmpVectors.PR[1];D.TmpVectors.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&G.BILLBOARDMODE_X)!==G.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&G.BILLBOARDMODE_Y)!==G.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&G.BILLBOARDMODE_Z)!==G.BILLBOARDMODE_Z&&(u.z=0),D.Matrix.RotationYawPitchRollToRef(u.y,u.x,u.z,D.TmpVectors.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(D.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(D.TmpVectors.PR[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):U&&U._nonUniformScaling?this._updateNonUniformScalingState(U._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.ED(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=D.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.bD(),u){const u=this.getChildren();for(let R=0;R<u.length;++R){const I=u[R];if(I){I.bD();const u=D.TmpVectors.Matrix[0];I.Dr.multiplyToRef(this.Dr,u);const R=D.TmpVectors.Quaternion[0];u.decompose(I.zD,R,I.position),I.rotationQuaternion?I.rotationQuaternion.B(R):R.toEulerAnglesToRef(I.rotation)}}}this.zD.ED(1,1,1),this.position.ED(0,0,0),this.rotation.ED(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=D.Quaternion.Identity()),this._worldMatrix=D.Matrix.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.add(u),this}unregisterAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.removeCallback(u),this}getPositionInCameraSpace(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u||(u=this.eu().activeCamera),D.PR.TransformCoordinates(this.getAbsolutePosition(),u.getViewMatrix())}getDistanceToCamera(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u||(u=this.eu().activeCamera),this.getAbsolutePosition().XR(u.globalPosition).length()}clone(u,R,I){const B=K.e.Clone((()=>new G(u,this.eu())),this);if(B.name=u,B.id=u,R&&(B.parent=R),!I){const R=this.getDescendants(!0);for(let I=0;I<R.length;I++){const U=R[I];U.clone&&U.clone(u+"."+U.name,B)}}return B}serialize(u){const R=K.e.Serialize(this,u);return R.type=this.getClassName(),R.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(R),R.localMatrix=this.getPivotMatrix().sD(),R.isEnabled=this.isEnabled(),K.e.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R}static Parse(u,R,I){const B=K.e.Parse((()=>new G(u.name,R)),u,R,I);if(u.localMatrix?B.setPreTransformMatrix(D.Matrix.TR(u.localMatrix)):u.pivotMatrix&&B.setPivotMatrix(D.Matrix.TR(u.pivotMatrix)),B.WD(u.isEnabled),B._waitingParsedUniqueId=u.uniqueId,void 0!==u.parentId&&(B._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(B._waitingParentInstanceIndex=u.parentInstanceIndex),u.animations){for(let R=0;R<u.animations.length;R++){const I=u.animations[R],U=(0,t.c)("BABYLON.Animation");U&&B.animations.push(U.Parse(I))}s.d.ParseAnimationRanges(B,u,R)}return u.autoAnimate&&R.beginAnimation(B,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),B}getChildTransformNodes(u,R){const I=[];return this._getDescendants(I,u,(u=>(!R||R(u))&&u instanceof G)),I}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.eu().stopAnimation(this),this.eu().removeTransformNode(this),this._parentContainer){const u=this._parentContainer.transformNodes.indexOf(this);u>-1&&this._parentContainer.transformNodes.splice(u,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),u){const u=this.getChildTransformNodes(!0);for(const R of u)R.parent=null,R.bD(!0)}super.dispose(u,R)}normalizeToUnitCube(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0,B=null,U=null;R&&(this.rotationQuaternion?(U=this.rotationQuaternion.clone(),this.rotationQuaternion.ED(0,0,0,1)):this.rotation&&(B=this.rotation.clone(),this.rotation.ED(0,0,0)));const K=this.getHierarchyBoundingVectors(u,I),C=K.max.XR(K.min),D=Math.max(C.x,C.y,C.z);if(0===D)return this;const s=1/D;return this.zD.scaleInPlace(s),R&&(this.rotationQuaternion&&U?this.rotationQuaternion.B(U):this.rotation&&B&&this.rotation.B(B)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}G.BILLBOARDMODE_NONE=0,G.BILLBOARDMODE_X=1,G.BILLBOARDMODE_Y=2,G.BILLBOARDMODE_Z=4,G.BILLBOARDMODE_ALL=7,G.BILLBOARDMODE_USE_POSITION=128,G.BillboardUseParentOrientation=!1,G._TmpRotation=D.Quaternion.Zero(),G._TmpScaling=D.PR.Zero(),G._TmpTranslation=D.PR.Zero(),G._LookAtVectorCache=new D.PR(0,0,0),G._RotationAxisCache=new D.Quaternion,(0,B.c)([(0,U.O)("position")],G.prototype,"_position",void 0),(0,B.c)([(0,U.O)("rotation")],G.prototype,"_rotation",void 0),(0,B.c)([(0,U.G)("rotationQuaternion")],G.prototype,"_rotationQuaternion",void 0),(0,B.c)([(0,U.O)("zD")],G.prototype,"_scaling",void 0),(0,B.c)([(0,U.S)("billboardMode")],G.prototype,"_billboardMode",void 0),(0,B.c)([(0,U.S)()],G.prototype,"scalingDeterminant",void 0),(0,B.c)([(0,U.S)("infiniteDistance")],G.prototype,"_infiniteDistance",void 0),(0,B.c)([(0,U.S)()],G.prototype,"ignoreNonUniformScaling",void 0),(0,B.c)([(0,U.S)()],G.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12957:(u,R,I)=>{I.d(R,{c:()=>C});var B=I(12460),U=I(12964);let K=0;const C=u=>{if(!u.environmentBRDFTexture){const R=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const I=u._blockEntityCollection;u._blockEntityCollection=!1;const C=B.b.CreateFromBase64String("data:image/png;base64,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","EnvironmentBRDFTexture"+K++,u,!0,!1,B.b.BILINEAR_SAMPLINGMODE);u._blockEntityCollection=I;const D=u.getEngine().getLoadedTexturesCache(),s=D.indexOf(C.getInternalTexture());-1!==s&&D.splice(s,1),C.isRGBD=!0,C.wrapU=B.b.CLAMP_ADDRESSMODE,C.wrapV=B.b.CLAMP_ADDRESSMODE,u.environmentBRDFTexture=C,u.useDelayedTextureLoading=R,U.d.ExpandRGBDTexture(C);const t=u.getEngine().onContextRestoredObservable.add((()=>{C.isRGBD=!0;const R=u.onBeforeRenderObservable.add((()=>{C.isReady()&&(u.onBeforeRenderObservable.remove(R),U.d.ExpandRGBDTexture(C))}))}));u.uD.add((()=>{u.getEngine().onContextRestoredObservable.remove(t)}))}return u.environmentBRDFTexture}},12894:(u,R,I)=>{function B(u,R,I){try{const B=u.next();B.done?R(B):B.value?B.value.then((()=>{B.value=void 0,R(B)}),I):R(B)}catch(B){I(B)}}function U(){let u,R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(I,U,K)=>{const C=performance.now();void 0===u||C-u>R?(u=C,setTimeout((()=>{B(I,U,K)}),0)):B(I,U,K)}}function K(u,R,I,B,U){const K=()=>{let C;const D=u=>{u.done?I(u.value):void 0===C?C=!0:K()};do{C=void 0,U&&U.aborted?B(new Error("Aborted")):R(u,D,B),void 0===C&&(C=!1)}while(C)};K()}function C(u,R){let I;return K(u,B,(u=>I=u),(u=>{throw u}),R),I}async function D(u,R,I){return await new Promise(((B,U)=>{K(u,R,B,U,I)}))}function s(u,R){return function(){return C(u(...arguments),R)}}I.d(R,{d:()=>U,g:()=>s,k:()=>D,l:()=>C})},13049:(u,R,I)=>{function B(){const u=u=>!!u&&"object"===typeof u;for(var R=arguments.length,I=new Array(R),U=0;U<R;U++)I[U]=arguments[U];return I.reduce(((R,I)=>{const U=Object.keys(I);for(const K of U){const U=R[K],C=I[K];Array.isArray(U)&&Array.isArray(C)?R[K]=U.concat(...C):u(U)&&u(C)?R[K]=B(U,C):R[K]=C}return R}),{})}I.d(R,{d:()=>B})},13025:(u,R,I)=>{I.d(R,{b:()=>U});class B{constructor(u){this._pendingActions=new Array,this._workerInfos=u.map((u=>({workerPromise:Promise.resolve(u),idle:!0})))}dispose(){for(const u of this._workerInfos)u.workerPromise.then((u=>{u.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(u){this._executeOnIdleWorker(u)||this._pendingActions.push(u)}_executeOnIdleWorker(u){for(const R of this._workerInfos)if(R.idle)return this._execute(R,u),!0;return!1}_execute(u,R){u.idle=!1,u.workerPromise.then((I=>{R(I,(()=>{const R=this._pendingActions.shift();R?this._execute(u,R):u.idle=!0}))}))}}class U extends B{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.DefaultOptions;super([]),this._maxWorkers=u,this._createWorkerAsync=R,this._options=I}push(u){if(!this._executeOnIdleWorker(u))if(this._workerInfos.length<this._maxWorkers){const R={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(R),this._execute(R,u)}else this._pendingActions.push(u)}_execute(u,R){u.timeoutId&&(clearTimeout(u.timeoutId),delete u.timeoutId),super._execute(u,((I,B)=>{R(I,(()=>{B(),u.idle&&(u.timeoutId=setTimeout((()=>{u.workerPromise.then((u=>{u.terminate()}));const R=this._workerInfos.indexOf(u);-1!==R&&this._workerInfos.splice(R,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}U.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12995:(u,R,I)=>{I.d(R,{b:()=>G});var B=I(12466),U=I(12303),K=I(12346),C=I(12549),D=I(12472),s=I(12507),t=I(12433);class G{get influence(){return this._influence}set influence(u){if(this._influence===u)return;const R=this._influence;this._influence=u,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===R||0===u)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=u,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new U.c,this._onDataLayoutChanged=new U.c,this._animationPropertiesOverride=null,this.id=u,this._scene=I||K.e.LastCreatedScene,this.influence=R,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(u){const R=this.hasPositions;this._positions=u,R!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(u){const R=this.hasNormals;this._normals=u,R!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(u){const R=this.hasTangents;this._tangents=u,R!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(u){const R=this.hasUVs;this._uvs=u,R!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(u){const R=this.hasUV2s;this._uv2s=u,R!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(u){const R=this.hasColors;this._colors=u,R!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const u=s.e.Clone((()=>new G(this.name,this.influence,this._scene)),this);return u._positions=this._positions,u._normals=this._normals,u._tangents=this._tangents,u._uvs=this._uvs,u._uv2s=this._uv2s,u._colors=this._colors,u}serialize(){const u={};return u.name=this.name,u.influence=this.influence,u.Mu=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(u.id=this.id),this.hasNormals&&(u.ou=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(u.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(u.hu=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(u.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(u.ju=Array.prototype.slice.call(this.getColors())),s.e.AppendSerializedAnimations(this,u),u}getClassName(){return"MorphTarget"}static Parse(u,R){const I=new G(u.name,u.influence);if(I.setPositions(u.Mu),null!=u.id&&(I.id=u.id),u.ou&&I.setNormals(u.ou),u.tangents&&I.setTangents(u.tangents),u.hu&&I.setUVs(u.hu),u.uv2s&&I.setUV2s(u.uv2s),u.ju&&I.setColors(u.ju),u.animations){for(let R=0;R<u.animations.length;R++){const B=u.animations[R],U=(0,t.c)("BABYLON.Animation");U&&I.animations.push(U.Parse(B))}u.autoAnimate&&R&&R.beginAnimation(I,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1)}return I}static FromMesh(u,R,I){R||(R=u.name);const B=new G(R,I,u.eu());return B.setPositions(u.getVerticesData(C.i.PositionKind)),u.isVerticesDataPresent(C.i.NormalKind)&&B.setNormals(u.getVerticesData(C.i.NormalKind)),u.isVerticesDataPresent(C.i.TangentKind)&&B.setTangents(u.getVerticesData(C.i.TangentKind)),u.isVerticesDataPresent(C.i.UVKind)&&B.setUVs(u.getVerticesData(C.i.UVKind)),u.isVerticesDataPresent(C.i.UV2Kind)&&B.setUV2s(u.getVerticesData(C.i.UV2Kind)),u.isVerticesDataPresent(C.i.ColorKind)&&B.setColors(u.getVerticesData(C.i.ColorKind)),B}}(0,B.c)([(0,D.S)()],G.prototype,"id",void 0)},12888:(u,R,I)=>{I.d(R,{d:()=>S});var B=I(12466),U=I(12481),K=I(12472),C=I(12303),D=I(12346),s=I(12335),t=I(12507);class G{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new C.c,this._onClonedObservable=new C.c}}class S{static AddNodeConstructor(u,R){this._NodeConstructors[u]=R}static Construct(u,R,I,B){const U=this._NodeConstructors[u];return U?U(R,I,B):null}set accessibilityTag(u){this._accessibilityTag=u,this.onAccessibilityTagChangedObservable.notifyObservers(u)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(u){this._nodeDataStorage._doNotSerialize=u}C(){return this._nodeDataStorage._isDisposed}set parent(u){if(this._parentNode===u)return;const R=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const R=this._parentNode._children.indexOf(this);-1!==R&&this._parentNode._children.splice(R,1),u||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=u,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),R||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(u){u.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const u=this._scene.rootNodes,R=u.length-1;u[this._nodeDataStorage._sceneRootNodesIndex]=u[R],u[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}getClassName(){return"Node"}set onDispose(u){this._onDisposeObserver&&this.uD.remove(this._onDisposeObserver),this._onDisposeObserver=this.uD.add(u)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new G,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new C.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=U.Matrix.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.uD=new C.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=u,this.id=u,this._scene=R||D.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),I&&this._addToSceneRootNodes()}eu(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(u)||(u.init(),this._scene.isLoading&&!R?this._scene.onDataLoadedObservable.addOnce((()=>{u.attach(this)})):u.attach(this),this._behaviors.push(u)),this}removeBehavior(u){const R=this._behaviors.indexOf(u);return-1===R||(this._behaviors[R].detach(),this._behaviors.splice(R,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(u){for(const R of this._behaviors)if(R.name===u)return R;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.bD(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(u){!u&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(u){return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_updateCache(u){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Ot(u){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const u of this._children)u._syncParentEnabledState()}WD(u){this._nodeDataStorage._isEnabled!==u&&(this._nodeDataStorage._isEnabled=u,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(u))}isDescendantOf(u){return!!this.parent&&(this.parent===u||this.parent.isDescendantOf(u))}_getDescendants(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;if(this._children)for(let B=0;B<this._children.length;B++){const U=this._children[B];I&&!I(U)||u.push(U),R||U._getDescendants(u,!1,I)}}getDescendants(u,R){const I=[];return this._getDescendants(I,u,R),I}getChildMeshes(u,R){const I=[];return this._getDescendants(I,u,(u=>(!R||R(u))&&void 0!==u.PS)),I}getChildren(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(R,u)}_setReady(u){u!==this._nodeDataStorage._isReady&&(u?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(u){for(let R=0;R<this.animations.length;R++){const I=this.animations[R];if(I.name===u)return I}return null}createAnimationRange(u,R,I){if(!this._ranges[u]){this._ranges[u]=S._AnimationRangeFactory(u,R,I);for(let B=0,U=this.animations.length;B<U;B++)this.animations[B]&&this.animations[B].createRange(u,R,I)}}deleteAnimationRange(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let I=0,B=this.animations.length;I<B;I++)this.animations[I]&&this.animations[I].deleteRange(u,R);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}clone(u,R,I){const B=t.e.Clone((()=>new S(u,this.eu())),this);if(R&&(B.parent=R),!I){const R=this.getDescendants(!0);for(let I=0;I<R.length;I++){const U=R[I];U.clone(u+"."+U.name,B)}}return B}getAnimationRanges(){const u=[];let R;for(R in this._ranges)u.push(this._ranges[R]);return u}beginAnimation(u,R,I,B){const U=this.getAnimationRange(u);return U?this._scene.beginAnimation(this,U.from,U.to,R,I,B):null}serializeAnimationRanges(){const u=[];for(const R in this._ranges){const I=this._ranges[R];if(!I)continue;const B={};B.name=R,B.from=I.from,B.to=I.to,u.push(B)}return u}bD(u){return this._worldMatrix||(this._worldMatrix=U.Matrix.Identity()),this._worldMatrix}dispose(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!u){const I=this.getDescendants(!0);for(const B of I)B.dispose(u,R)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.uD.notifyObservers(this),this.uD.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const I of this._behaviors)I.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(u,R,I){if(R.ranges)for(let B=0;B<R.ranges.length;B++){const I=R.ranges[B];u.createAnimationRange(I.name,I.from,I.to)}}getHierarchyBoundingVectors(){let u,R,I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.eu().incrementRenderId(),this.bD(!0);const K=this;if(K.getBoundingInfo&&K.DD){const I=K.getBoundingInfo();u=I.boundingBox.minimumWorld.clone(),R=I.boundingBox.maximumWorld.clone()}else u=new U.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R=new U.PR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(I){const I=this.getDescendants(!1);for(const K of I){const I=K;if(I.bD(!0),B&&!B(I))continue;if(!I.getBoundingInfo||0===I.getTotalVertices())continue;const C=I.getBoundingInfo().boundingBox,D=C.minimumWorld,s=C.maximumWorld;U.PR.CheckExtends(D,u,R),U.PR.CheckExtends(s,u,R)}}return{min:u,max:R}}}S._AnimationRangeFactory=(u,R,I)=>{throw(0,s.c)("AnimationRange")},S._NodeConstructors={},(0,B.c)([(0,K.S)()],S.prototype,"name",void 0),(0,B.c)([(0,K.S)()],S.prototype,"id",void 0),(0,B.c)([(0,K.S)()],S.prototype,"uniqueId",void 0),(0,B.c)([(0,K.S)()],S.prototype,"state",void 0),(0,B.c)([(0,K.S)()],S.prototype,"metadata",void 0)}}]);