"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[27],{13035:(o,v,V)=>{V.d(v,{b:()=>t,c:()=>c,d:()=>R,f:()=>f,g:()=>T,k:()=>S,m:()=>l});var g=V(12488),E=V(12547),I=V(12511),Q=V(12449),U=V(13040),n=V(12932),O=V(12526),h=V(12332),x=V(12535);const f=Object.freeze(new g.Quaternion(0,0,0,0)),l=Object.freeze(g.cv.Zero()),S=Object.freeze(g.Vector2.Zero()),T=Object.freeze(O.b.Zero()),c=Object.freeze(E.Lv.Black()),R=Object.freeze(new E.sU(0,0,0,0)),j={key:0,repeatCount:0,loopMode:2};class t{static _PrepareAnimation(o,v,V,I,Q,U,n,h){let x;if(!isNaN(parseFloat(Q))&&isFinite(Q)?x=t.ANIMATIONTYPE_FLOAT:Q instanceof g.Quaternion?x=t.ANIMATIONTYPE_QUATERNION:Q instanceof g.cv?x=t.ANIMATIONTYPE_VECTOR3:Q instanceof g.Vector2?x=t.ANIMATIONTYPE_VECTOR2:Q instanceof E.Lv?x=t.ANIMATIONTYPE_COLOR3:Q instanceof E.sU?x=t.ANIMATIONTYPE_COLOR4:Q instanceof O.b&&(x=t.ANIMATIONTYPE_SIZE),void 0==x)return null;const f=new t(o,v,V,x,n),l=[{frame:0,value:Q},{frame:I,value:U}];return f.setKeys(l),void 0!==h&&f.setEasingFunction(h),f}static CreateAnimation(o,v,V,g){const E=new t(o+"Animation",o,V,v,t.ANIMATIONLOOPMODE_CONSTANT);return E.setEasingFunction(g),E}static CreateAndStartAnimation(o,v,V,g,E,I,Q,U,n,O,h){const x=t._PrepareAnimation(o,V,g,E,I,Q,U,n);return x?(v.Fo&&(h=v.Fo()),h?h.beginDirectAnimation(v,[x],0,E,x.loopMode!==t.ANIMATIONLOOPMODE_CONSTANT,1,O):null):null}static CreateAndStartHierarchyAnimation(o,v,V,g,E,I,Q,U,n,O,h){const x=t._PrepareAnimation(o,g,E,I,Q,U,n,O);if(!x)return null;return v.Fo().beginDirectHierarchyAnimation(v,V,[x],0,I,1===x.loopMode,1,h)}static CreateMergeAndStartAnimation(o,v,V,g,E,I,Q,U,n,O){const h=t._PrepareAnimation(o,V,g,E,I,Q,U,n);return h?(v.animations.push(h),v.Fo().beginAnimation(v,0,E,1===h.loopMode,1,O)):null}static MakeAnimationAdditive(o,v,V){let E;E="object"===typeof v?v:{referenceFrame:v??0,range:V,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let I=o;if(E.cloneOriginalAnimation&&(I=o.clone(),I.name=E.clonedAnimationName||I.name),!I._keys.length)return I;const Q=E.referenceFrame&&E.referenceFrame>=0?E.referenceFrame:0;let U=0;const n=I._keys[0];let O=I._keys.length-1;const h=I._keys[O],x={referenceValue:n.value,referencePosition:g.TmpVectors.cv[0],referenceQuaternion:g.TmpVectors.Quaternion[0],referenceScaling:g.TmpVectors.cv[1],keyPosition:g.TmpVectors.cv[2],keyQuaternion:g.TmpVectors.Quaternion[1],keyScaling:g.TmpVectors.cv[3]};let f=n.frame,l=h.frame;if(E.range){const o=I.getRange(E.range);o&&(f=o.from,l=o.to)}else f=E.fromFrame??f,l=E.toFrame??l;if(f!==n.frame&&(U=I.createKeyForFrame(f)),l!==h.frame&&(O=I.createKeyForFrame(l)),1===I._keys.length){const o=I._getKeyValue(I._keys[0]);x.referenceValue=o.clone?o.clone():o}else if(Q<=n.frame){const o=I._getKeyValue(n.value);x.referenceValue=o.clone?o.clone():o}else if(Q>=h.frame){const o=I._getKeyValue(h.value);x.referenceValue=o.clone?o.clone():o}else{j.key=0;const o=I._interpolate(Q,j);x.referenceValue=o.clone?o.clone():o}I.dataType===t.ANIMATIONTYPE_QUATERNION?x.referenceValue.normalize().conjugateInPlace():I.dataType===t.ANIMATIONTYPE_MATRIX&&(x.referenceValue.decompose(x.referenceScaling,x.referenceQuaternion,x.referencePosition),x.referenceQuaternion.normalize().conjugateInPlace());let S=Number.MAX_VALUE;const T=E.clipKeys?[]:null;for(let c=U;c<=O;c++){let o=I._keys[c];if((T||E.cloneOriginalAnimation)&&(o={frame:o.frame,value:o.value.clone?o.value.clone():o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation,lockedTangent:o.lockedTangent},T&&(S===Number.MAX_VALUE&&(S=o.frame),o.frame-=S,T.push(o))),!c||I.dataType===t.ANIMATIONTYPE_FLOAT||o.value!==n.value)switch(I.dataType){case t.ANIMATIONTYPE_MATRIX:o.value.decompose(x.keyScaling,x.keyQuaternion,x.keyPosition),x.keyPosition.Lx(x.referencePosition),x.keyScaling.divideInPlace(x.referenceScaling),x.referenceQuaternion.multiplyToRef(x.keyQuaternion,x.keyQuaternion),g.Matrix.ComposeToRef(x.keyScaling,x.keyQuaternion,x.keyPosition,o.value);break;case t.ANIMATIONTYPE_QUATERNION:x.referenceValue.multiplyToRef(o.value,o.value);break;case t.ANIMATIONTYPE_VECTOR2:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:o.value.subtractToRef(x.referenceValue,o.value);break;case t.ANIMATIONTYPE_SIZE:o.value.width-=x.referenceValue.width,o.value.height-=x.referenceValue.height;break;default:o.value-=x.referenceValue}}return T&&I.setKeys(T,!0),I}static TransitionTo(o,v,V,g,E,I,Q){let U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(Q<=0)return V[o]=v,U&&U(),null;const n=E*(Q/1e3);I.setKeys([{frame:0,value:V[o].clone?V[o].clone():V[o]},{frame:n,value:v}]),V.animations||(V.animations=[]),V.animations.push(I);const O=g.beginAnimation(V,0,n,!1);return O.onAnimationEnd=U,O}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const o of this._runtimeAnimations)if(!o.isStopped())return!0;return!1}constructor(o,v,V,g,E,I){this.name=o,this.targetProperty=v,this.framePerSecond=V,this.dataType=g,this.loopMode=E,this.enableBlending=I,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=v.split("."),this.dataType=g,this.loopMode=void 0===E?t.ANIMATIONLOOPMODE_CYCLE:E,this.uniqueId=t._UniqueIdGenerator++}toString(o){let v="Name: "+this.name+", property: "+this.targetProperty;if(v+=", datatype: "+["Float","cv","Quaternion","Matrix","Lv","Vector2"][this.dataType],v+=", nKeys: "+(this._keys?this._keys.length:"none"),v+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),o){v+=", Ranges: {";let o=!0;for(const V in this._ranges)o&&(v+=", ",o=!1),v+=V;v+="}"}return v}addEvent(o){this._events.push(o),this._events.sort(((o,v)=>o.frame-v.frame))}removeEvents(o){for(let v=0;v<this._events.length;v++)this._events[v].frame===o&&(this._events.splice(v,1),v--)}getEvents(){return this._events}createRange(o,v,V){this._ranges[o]||(this._ranges[o]=new U.e(o,v,V))}deleteRange(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this._ranges[o];if(V){if(v){const o=V.from,v=V.to;for(let V=this._keys.length-1;V>=0;V--)this._keys[V].frame>=o&&this._keys[V].frame<=v&&this._keys.splice(V,1)}this._ranges[o]=null}}getRange(o){return this._ranges[o]}getKeys(){return this._keys}getHighestFrame(){let o=0;for(let v=0,V=this._keys.length;v<V;v++)o<this._keys[v].frame&&(o=this._keys[v].frame);return o}getEasingFunction(){return this._easingFunction}setEasingFunction(o){this._easingFunction=o}floatInterpolateFunction(o,v,V){return(0,I.Lerp)(o,v,V)}floatInterpolateFunctionWithTangents(o,v,V,g,E){return(0,I.Hermite)(o,v,V,g,E)}quaternionInterpolateFunction(o,v,V){return g.Quaternion.Slerp(o,v,V)}quaternionInterpolateFunctionWithTangents(o,v,V,E,I){return g.Quaternion.Hermite(o,v,V,E,I).normalize()}vector3InterpolateFunction(o,v,V){return g.cv.Lerp(o,v,V)}vector3InterpolateFunctionWithTangents(o,v,V,E,I){return g.cv.Hermite(o,v,V,E,I)}vector2InterpolateFunction(o,v,V){return g.Vector2.Lerp(o,v,V)}vector2InterpolateFunctionWithTangents(o,v,V,E,I){return g.Vector2.Hermite(o,v,V,E,I)}sizeInterpolateFunction(o,v,V){return O.b.Lerp(o,v,V)}color3InterpolateFunction(o,v,V){return E.Lv.Lerp(o,v,V)}color3InterpolateFunctionWithTangents(o,v,V,g,I){return E.Lv.Hermite(o,v,V,g,I)}color4InterpolateFunction(o,v,V){return E.sU.Lerp(o,v,V)}color4InterpolateFunctionWithTangents(o,v,V,g,I){return E.sU.Hermite(o,v,V,g,I)}_getKeyValue(o){return"function"===typeof o?o():o}evaluate(o){return j.key=0,this._interpolate(o,j)}_interpolate(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(v.loopMode===t.ANIMATIONLOOPMODE_CONSTANT&&v.repeatCount>0)return v.highLimitValue.clone?v.highLimitValue.clone():v.highLimitValue;const g=this._keys;let E;if(this._coreAnimation)E=this._coreAnimation._key;else{const I=g.length;for(E=v.key;E>=0&&o<g[E].frame;)--E;for(;E+1<=I-1&&o>=g[E+1].frame;)++E;if(v.key=E,E<0)return V?void 0:this._getKeyValue(g[0].value);if(E+1>I-1)return V?void 0:this._getKeyValue(g[I-1].value);this._key=E}const I=g[E],Q=g[E+1];if(V&&(o===I.frame||o===Q.frame))return;const U=this._getKeyValue(I.value),n=this._getKeyValue(Q.value);if(1===I.interpolation)return Q.frame>o?U:n;const O=void 0!==I.outTangent&&void 0!==Q.inTangent,h=Q.frame-I.frame;let x=(o-I.frame)/h;const j=I.easingFunction||this.getEasingFunction();switch(j&&(x=j.ease(x)),this.dataType){case t.ANIMATIONTYPE_FLOAT:{const o=O?this.floatInterpolateFunctionWithTangents(U,I.outTangent*h,n,Q.inTangent*h,x):this.floatInterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(v.offsetValue??0)*v.repeatCount+o}break}case t.ANIMATIONTYPE_QUATERNION:{const o=O?this.quaternionInterpolateFunctionWithTangents(U,I.outTangent.scale(h),n,Q.inTangent.scale(h),x):this.quaternionInterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return o.addInPlace((v.offsetValue||f).scale(v.repeatCount))}return o}case t.ANIMATIONTYPE_VECTOR3:{const o=O?this.vector3InterpolateFunctionWithTangents(U,I.outTangent.scale(h),n,Q.inTangent.scale(h),x):this.vector3InterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return o.add((v.offsetValue||l).scale(v.repeatCount))}break}case t.ANIMATIONTYPE_VECTOR2:{const o=O?this.vector2InterpolateFunctionWithTangents(U,I.outTangent.scale(h),n,Q.inTangent.scale(h),x):this.vector2InterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return o.add((v.offsetValue||S).scale(v.repeatCount))}break}case t.ANIMATIONTYPE_SIZE:switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(U,n,x);case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(U,n,x).add((v.offsetValue||T).scale(v.repeatCount))}break;case t.ANIMATIONTYPE_COLOR3:{const o=O?this.color3InterpolateFunctionWithTangents(U,I.outTangent.scale(h),n,Q.inTangent.scale(h),x):this.color3InterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return o.add((v.offsetValue||c).scale(v.repeatCount))}break}case t.ANIMATIONTYPE_COLOR4:{const o=O?this.color4InterpolateFunctionWithTangents(U,I.outTangent.scale(h),n,Q.inTangent.scale(h),x):this.color4InterpolateFunction(U,n,x);switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return o;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return o.add((v.offsetValue||R).scale(v.repeatCount))}break}case t.ANIMATIONTYPE_MATRIX:switch(v.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return t.AllowMatricesInterpolation?this.matrixInterpolateFunction(U,n,x,v.workValue):U;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U}}return 0}matrixInterpolateFunction(o,v,V,E){return t.AllowMatrixDecomposeForInterpolation?E?(g.Matrix.DecomposeLerpToRef(o,v,V,E),E):g.Matrix.DecomposeLerp(o,v,V):E?(g.Matrix.LerpToRef(o,v,V,E),E):g.Matrix.Lerp(o,v,V)}clone(){const o=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(o.enableBlending=this.enableBlending,o.blendingSpeed=this.blendingSpeed,this._keys&&o.setKeys(this._keys),this._ranges){o._ranges={};for(const v in this._ranges){const V=this._ranges[v];V&&(o._ranges[v]=V.clone())}}return o}setKeys(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=v?o:o.slice(0)}createKeyForFrame(o){j.key=0;const v=this._interpolate(o,j,!0);if(!v)return this._keys[j.key].frame===o?j.key:j.key+1;const V={frame:o,value:v.clone?v.clone():v};return this._keys.splice(j.key+1,0,V),j.key+1}serialize(){const o={};o.name=this.name,o.property=this.targetProperty,o.framePerSecond=this.framePerSecond,o.dataType=this.dataType,o.loopBehavior=this.loopMode,o.enableBlending=this.enableBlending,o.blendingSpeed=this.blendingSpeed;const v=this.dataType;o.keys=[];const V=this.getKeys();for(let g=0;g<V.length;g++){const E=V[g],I={};switch(I.frame=E.frame,v){case t.ANIMATIONTYPE_FLOAT:I.values=[E.value],void 0!==E.inTangent&&I.values.push(E.inTangent),void 0!==E.outTangent&&(void 0===E.inTangent&&I.values.push(void 0),I.values.push(E.outTangent)),void 0!==E.interpolation&&(void 0===E.inTangent&&I.values.push(void 0),void 0===E.outTangent&&I.values.push(void 0),I.values.push(E.interpolation));break;case t.ANIMATIONTYPE_QUATERNION:case t.ANIMATIONTYPE_MATRIX:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:I.values=E.value.Dg(),void 0!=E.inTangent&&I.values.push(E.inTangent.Dg()),void 0!=E.outTangent&&(void 0===E.inTangent&&I.values.push(void 0),I.values.push(E.outTangent.Dg())),void 0!==E.interpolation&&(void 0===E.inTangent&&I.values.push(void 0),void 0===E.outTangent&&I.values.push(void 0),I.values.push(E.interpolation))}o.keys.push(I)}o.ranges=[];for(const g in this._ranges){const v=this._ranges[g];if(!v)continue;const V={};V.name=g,V.from=v.from,V.to=v.to,o.ranges.push(V)}return o}static _UniversalLerp(o,v,V){const g=o.constructor;return g.Lerp?g.Lerp(o,v,V):g.Slerp?g.Slerp(o,v,V):o.toFixed?o*(1-V)+V*v:v}static Parse(o){const v=new t(o.name,o.property,o.framePerSecond,o.dataType,o.loopBehavior),V=o.dataType,I=[];let Q,U;for(o.enableBlending&&(v.enableBlending=o.enableBlending),o.blendingSpeed&&(v.blendingSpeed=o.blendingSpeed),U=0;U<o.keys.length;U++){const v=o.keys[U];let n,O,h;switch(V){case t.ANIMATIONTYPE_FLOAT:Q=v.values[0],v.values.length>=2&&(n=v.values[1]),v.values.length>=3&&(O=v.values[2]),v.values.length>=4&&(h=v.values[3]);break;case t.ANIMATIONTYPE_QUATERNION:if(Q=g.Quaternion.bv(v.values),v.values.length>=8){const o=g.Quaternion.bv(v.values.slice(4,8));o.equals(g.Quaternion.Zero())||(n=o)}if(v.values.length>=12){const o=g.Quaternion.bv(v.values.slice(8,12));o.equals(g.Quaternion.Zero())||(O=o)}v.values.length>=13&&(h=v.values[12]);break;case t.ANIMATIONTYPE_MATRIX:Q=g.Matrix.bv(v.values),v.values.length>=17&&(h=v.values[16]);break;case t.ANIMATIONTYPE_COLOR3:Q=E.Lv.bv(v.values),v.values[3]&&(n=E.Lv.bv(v.values[3])),v.values[4]&&(O=E.Lv.bv(v.values[4])),v.values[5]&&(h=v.values[5]);break;case t.ANIMATIONTYPE_COLOR4:Q=E.sU.bv(v.values),v.values[4]&&(n=E.sU.bv(v.values[4])),v.values[5]&&(O=E.sU.bv(v.values[5])),v.values[6]&&(h=E.sU.bv(v.values[6]));break;case t.ANIMATIONTYPE_VECTOR3:default:Q=g.cv.bv(v.values),v.values[3]&&(n=g.cv.bv(v.values[3])),v.values[4]&&(O=g.cv.bv(v.values[4])),v.values[5]&&(h=v.values[5])}const x={};x.frame=v.frame,x.value=Q,void 0!=n&&(x.inTangent=n),void 0!=O&&(x.outTangent=O),void 0!=h&&(x.interpolation=h),I.push(x)}if(v.setKeys(I),o.ranges)for(U=0;U<o.ranges.length;U++)Q=o.ranges[U],v.createRange(Q.name,Q.from,Q.to);return v}static AppendSerializedAnimations(o,v){x.c.AppendSerializedAnimations(o,v)}static async ParseFromFileAsync(o,v){return await new Promise(((V,g)=>{const E=new h.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){let v=JSON.parse(E.responseText);if(v.animations&&(v=v.animations),v.length){const o=[];for(const V of v)o.push(this.Parse(V));V(o)}else{const g=this.Parse(v);o&&(g.name=o),V(g)}}else g("Unable to load the animation")})),E.open("GET",v),E.send()}))}static async ParseFromSnippetAsync(o){return await new Promise(((v,V)=>{const g=new h.b;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const V=JSON.parse(JSON.parse(g.responseText).jsonPayload);if(V.animations){const g=JSON.parse(V.animations),E=[];for(const v of g.animations){const V=this.Parse(v);V.snippetId=o,E.push(V)}v(E)}else{const g=JSON.parse(V.animation),E=this.Parse(g);E.snippetId=o,v(E)}}else V("Unable to load the snippet "+o)})),g.open("GET",this.SnippetUrl+"/"+o.replace(/#/g,"/")),g.send()}))}}t._UniqueIdGenerator=0,t.AllowMatricesInterpolation=!1,t.AllowMatrixDecomposeForInterpolation=!0,t.SnippetUrl="https://snippet.babylonjs.com",t.ANIMATIONTYPE_FLOAT=0,t.ANIMATIONTYPE_VECTOR3=1,t.ANIMATIONTYPE_QUATERNION=2,t.ANIMATIONTYPE_MATRIX=3,t.ANIMATIONTYPE_COLOR3=4,t.ANIMATIONTYPE_COLOR4=7,t.ANIMATIONTYPE_VECTOR2=5,t.ANIMATIONTYPE_SIZE=6,t.ANIMATIONLOOPMODE_RELATIVE=0,t.ANIMATIONLOOPMODE_CYCLE=1,t.ANIMATIONLOOPMODE_CONSTANT=2,t.ANIMATIONLOOPMODE_YOYO=4,t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,t.CreateFromSnippetAsync=t.ParseFromSnippetAsync,(0,Q.h)("BABYLON.Animation",t),n.c._AnimationRangeFactory=(o,v,V)=>new U.e(o,v,V)},13040:(o,v,V)=>{V.d(v,{e:()=>g});class g{constructor(o,v,V){this.name=o,this.from=v,this.to=V}clone(){return new g(this.name,this.from,this.to)}}},12967:(o,v,V)=>{V.d(v,{e:()=>c});var g=V(12473),E=V(12479),I=V(12593),Q=V(12291),U=V(12297),n=V(12488),O=V(12932),h=V(12308),x=V(12449),f=V(12325),l=V(12609),S=V(12714),T=V(12535);class c extends O.c{get position(){return this._position}set position(o){this._position=o}set upVector(o){this._upVector=o}get upVector(){return this._upVector}get screenArea(){let o=0,v=0;if(this.mode===c.PERSPECTIVE_CAMERA)this.fovMode===c.FOVMODE_VERTICAL_FIXED?(v=2*this.Xg*Math.tan(this.fov/2),o=this.getEngine().getAspectRatio(this)*v):(o=2*this.Xg*Math.tan(this.fov/2),v=o/this.getEngine().getAspectRatio(this));else{const V=this.getEngine().getRenderWidth()/2,g=this.getEngine().getRenderHeight()/2;o=(this.orthoRight??V)-(this.orthoLeft??-V),v=(this.orthoTop??g)-(this.orthoBottom??-g)}return o*v}set orthoLeft(o){this._orthoLeft=o;for(const v of this._rigCameras)v.orthoLeft=o}get orthoLeft(){return this._orthoLeft}set orthoRight(o){this._orthoRight=o;for(const v of this._rigCameras)v.orthoRight=o}get orthoRight(){return this._orthoRight}set orthoBottom(o){this._orthoBottom=o;for(const v of this._rigCameras)v.orthoBottom=o}get orthoBottom(){return this._orthoBottom}set orthoTop(o){this._orthoTop=o;for(const v of this._rigCameras)v.orthoTop=o}get orthoTop(){return this._orthoTop}setFocalLength(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(v/(2*o))}set mode(o){this._mode=o;for(const v of this._rigCameras)v.mode=o}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(o,v,V){let g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(o,V,!1),this._position=n.cv.Zero(),this._upVector=n.cv.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Xg=1,this.maxZ=1e4,this.inertia=.9,this._mode=c.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new l.e(0,0,1,1),this.layerMask=268435455,this.fovMode=c.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=c.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new U.e,this.onProjectionMatrixChangedObservable=new U.e,this.onAfterCheckInputsObservable=new U.e,this.onRestoreStateObservable=new U.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new n.Matrix,this._postProcesses=new Array,this._activeMeshes=new I.d(256),this._globalPosition=n.cv.Zero(),this._computedViewMatrix=n.Matrix.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=n.Matrix.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=n.Quaternion.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.Fo().addCamera(this),g&&!this.Fo().activeCamera&&(this.Fo().activeCamera=this),this.position=v,this.renderPassId=this.Fo().getEngine().createRenderPassId(`Camera ${o}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"jh"}toString(o){let v="Name: "+this.name;if(v+=", type: "+this.getClassName(),this.animations)for(let V=0;V<this.animations.length;V++)v+=", animation[0]: "+this.animations[V].toString(o);return v}applyVerticalCorrection(){const o=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-o.x:o.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(o){return-1!==this._activeMeshes.indexOf(o)}isReady(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(o)for(const v of this._postProcesses)if(v&&!v.isReady())return!1;return super.isReady(o)}_initCache(){super._initCache(),this._cache.position=new n.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new n.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Xg=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(o){o||super._updateCache(),this._cache.position.U(this.position),this._cache.upVector.U(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let o=this._cache.mode===this.mode&&this._cache.Xg===this.Xg&&this._cache.maxZ===this.maxZ;if(!o)return!1;const v=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?o=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===v.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(o=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===v.getRenderWidth()&&this._cache.renderHeight===v.getRenderHeight(),this.oblique&&(o=o&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),o}attachControl(o,v){}Qf(o){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let o=0;o<this._postProcesses.length;o++)if(null!==this._postProcesses[o])return this._postProcesses[o];return null}_cascadePostProcessesToRigCams(){const o=this._getFirstPostProcess();o&&o.markTextureDirty();for(let v=0,V=this._rigCameras.length;v<V;v++){const o=this._rigCameras[v],V=o._rigPostProcess;if(V){"pass"===V.getEffectName()&&(o.isIntermediate=0===this._postProcesses.length),o._postProcesses=this._postProcesses.slice(0).concat(V),V.markTextureDirty()}else o._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!o.isReusable()&&this._postProcesses.indexOf(o)>-1?(h.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==v||v<0?this._postProcesses.push(o):null===this._postProcesses[v]?this._postProcesses[v]=o:this._postProcesses.splice(v,0,o),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.eO(),this._postProcesses.indexOf(o))}detachPostProcess(o){const v=this._postProcesses.indexOf(o);-1!==v&&(this._postProcesses[v]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.eO(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return n.Matrix.Identity()}getViewMatrix(o){return!o&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.Fo().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(o){this._doNotComputeProjectionMatrix=!0,void 0!==o&&(this._projectionMatrix=o)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(o){if(this._doNotComputeProjectionMatrix||!o&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Xg=this.Xg,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const v=this.getEngine(),V=this.Fo(),g=v.Ug;if(this.mode===c.PERSPECTIVE_CAMERA){let o;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=v.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Xg<=0&&(this.Xg=.1),o=V.useRightHandedSystem?n.Matrix.PerspectiveFovRHToRef:n.Matrix.PerspectiveFovLHToRef,o(this.fov,v.getAspectRatio(this),g?this.maxZ:this.Xg,g?this.Xg:this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED,v.isNDCHalfZRange,this.projectionPlaneTilt,g)}else{var E,I,Q;const o=v.getRenderWidth()/2,U=v.getRenderHeight()/2;V.useRightHandedSystem?this.oblique?n.Matrix.ObliqueOffCenterRHToRef(this.orthoLeft??-o,this.orthoRight??o,this.orthoBottom??-U,this.orthoTop??U,g?this.maxZ:this.Xg,g?this.Xg:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,v.isNDCHalfZRange):n.Matrix.OrthoOffCenterRHToRef(this.orthoLeft??-o,this.orthoRight??o,this.orthoBottom??-U,this.orthoTop??U,g?this.maxZ:this.Xg,g?this.Xg:this.maxZ,this._projectionMatrix,v.isNDCHalfZRange):this.oblique?n.Matrix.ObliqueOffCenterLHToRef(this.orthoLeft??-o,this.orthoRight??o,this.orthoBottom??-U,this.orthoTop??U,g?this.maxZ:this.Xg,g?this.Xg:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,v.isNDCHalfZRange):n.Matrix.OrthoOffCenterLHToRef(this.orthoLeft??-o,this.orthoRight??o,this.orthoBottom??-U,this.orthoTop??U,g?this.maxZ:this.Xg,g?this.Xg:this.maxZ,this._projectionMatrix,v.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(E=this.oblique)||void 0===E?void 0:E.angle,this._cache.obliqueLength=null===(I=this.oblique)||void 0===I?void 0:I.length,this._cache.obliqueOffset=null===(Q=this.oblique)||void 0===Q?void 0:Q.offset,this._cache.renderWidth=v.getRenderWidth(),this._cache.renderHeight=v.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(o){return(this.radius||(this.target?n.cv.Distance(this.position,this.target):this.position.length()))+o}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?S.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=S.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),v&&this.rigCameras.length>0){let v=!1;for(const V of this.rigCameras)V._updateFrustumPlanes(),v=v||o.isInFrustum(V._frustumPlanes);return v}return o.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(o){return this._updateFrustumPlanes(),o.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,f.b)("Ray")}getForwardRayToRef(o){throw(0,f.b)("Ray")}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.Fo().stopAnimation(this),this.Fo().removeCamera(this);this._rigCameras.length>0;){const o=this._rigCameras.pop();o&&o.dispose()}if(this._parentContainer){const o=this._parentContainer.cameras.indexOf(this);o>-1&&this._parentContainer.cameras.splice(o,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==c.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let o=this._postProcesses.length;for(;--o>=0;){const v=this._postProcesses[o];v&&v.dispose(this)}}let V=this.customRenderTargets.length;for(;--V>=0;)this.customRenderTargets[V].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.Fo().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(o,v)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(o,v){if(this.cameraRigMode!==o){for(;this._rigCameras.length>0;){const o=this._rigCameras.pop();o&&o.dispose()}if(this.cameraRigMode=o,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=v.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Q.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==c.RIG_MODE_NONE){const o=this.createRigCamera(this.name+"_L",0);o&&(o._isLeftCamera=!0);const v=this.createRigCamera(this.name+"_R",1);v&&(v._isRightCamera=!0),o&&v&&(this._rigCameras.push(o),this._rigCameras.push(v))}this._setRigMode(v),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(o){}_getVRProjectionMatrix(){return n.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Xg,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(o,v){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[o]=v,"interaxialDistance"===o&&(this._cameraRigParams.stereoHalfAngle=Q.Tools.ToRadians(v/.0637))}createRigCamera(o,v){return null}_updateRigCameras(){for(let o=0;o<this._rigCameras.length;o++)this._rigCameras[o].Xg=this.Xg,this._rigCameras[o].maxZ=this.maxZ,this._rigCameras[o].fov=this.fov,this._rigCameras[o].upVector.U(this.upVector);this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const o=T.c.Serialize(this);return o.uniqueId=this.uniqueId,o.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(o),this.inputs&&this.inputs.serialize(o),T.c.AppendSerializedAnimations(this,o),o.ranges=this.serializeAnimationRanges(),o.isEnabled=this.isEnabled(),o}clone(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=T.c.Clone(c.GetConstructorFromName(this.getClassName(),o,this.Fo(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return V.name=o,V.parent=v,this.onClonedObservable.notifyObservers(V),V}jn(o){const v=n.cv.Zero();return this.getDirectionToRef(o,v),v}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(o,v){n.cv.TransformNormalToRef(o,this.getWorldMatrix(),v)}static GetConstructorFromName(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const I=O.c.Construct(o,v,V,{interaxial_distance:g,isStereoscopicSideBySide:E});return I||(()=>c._CreateDefaultParsedCamera(v,V))}Ag(){return this.getWorldMatrix()}static Parse(o,v){const V=o.type,g=c.GetConstructorFromName(V,o.name,v,o.interaxial_distance,o.isStereoscopicSideBySide),E=T.c.Parse(g,o,v);if(void 0!==o.parentId&&(E._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(E._waitingParentInstanceIndex=o.parentInstanceIndex),E.inputs&&(E.inputs.parse(o),E._setupInputs()),o.upVector&&(E.upVector=n.cv.bv(o.upVector)),E.setPosition&&(E.position.RU(0,0,0),E.setPosition(n.cv.bv(o.position))),o.target&&E.setTarget&&E.setTarget(n.cv.bv(o.target)),o.cameraRigMode){const v=o.interaxial_distance?{interaxialDistance:o.interaxial_distance}:{};E.setCameraRigMode(o.cameraRigMode,v)}if(o.animations){for(let v=0;v<o.animations.length;v++){const V=o.animations[v],g=(0,x.d)("BABYLON.Animation");g&&E.animations.push(g.Parse(V))}O.c.ParseAnimationRanges(E,o,v)}return o.autoAnimate&&v.beginAnimation(E,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),void 0!==o.isEnabled&&E.eU(o.isEnabled),E}_calculateHandednessMultiplier(){let o=this.Fo().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(o*=-1),o}}c._CreateDefaultParsedCamera=(o,v)=>{throw(0,f.b)("UniversalCamera")},c.PERSPECTIVE_CAMERA=0,c.ORTHOGRAPHIC_CAMERA=1,c.FOVMODE_VERTICAL_FIXED=0,c.FOVMODE_HORIZONTAL_FIXED=1,c.RIG_MODE_NONE=0,c.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c.RIG_MODE_STEREOSCOPIC_INTERLACED=14,c.RIG_MODE_VR=20,c.RIG_MODE_CUSTOM=22,c.ForceAttachControlToAlwaysPreventDefault=!1,(0,g.c)([(0,E.G)("position")],c.prototype,"_position",void 0),(0,g.c)([(0,E.G)("upVector")],c.prototype,"_upVector",void 0),(0,g.c)([(0,E.K)()],c.prototype,"orthoLeft",null),(0,g.c)([(0,E.K)()],c.prototype,"orthoRight",null),(0,g.c)([(0,E.K)()],c.prototype,"orthoBottom",null),(0,g.c)([(0,E.K)()],c.prototype,"orthoTop",null),(0,g.c)([(0,E.K)()],c.prototype,"fov",void 0),(0,g.c)([(0,E.K)()],c.prototype,"projectionPlaneTilt",void 0),(0,g.c)([(0,E.K)()],c.prototype,"Xg",void 0),(0,g.c)([(0,E.K)()],c.prototype,"maxZ",void 0),(0,g.c)([(0,E.K)()],c.prototype,"inertia",void 0),(0,g.c)([(0,E.K)()],c.prototype,"mode",null),(0,g.c)([(0,E.K)()],c.prototype,"layerMask",void 0),(0,g.c)([(0,E.K)()],c.prototype,"fovMode",void 0),(0,g.c)([(0,E.K)()],c.prototype,"cameraRigMode",void 0),(0,g.c)([(0,E.K)()],c.prototype,"interaxialDistance",void 0),(0,g.c)([(0,E.K)()],c.prototype,"isStereoscopicSideBySide",void 0)},13005:(o,v,V)=>{V.d(v,{c:()=>x});var g=V(12473),E=V(12479),I=V(12967),Q=V(12488),U=V(12497),n=V(12706);V(12932).c.AddNodeConstructor("TargetCamera",((o,v)=>()=>new x(o,Q.cv.Zero(),v)));const O=Q.Matrix.Zero(),h=Q.Quaternion.Identity();class x extends I.e{constructor(o,v,V){super(o,v,V,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new Q.cv(0,0,0),this.cameraRotation=new Q.Vector2(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=Q.cv.Zero(),this._initialFocalDistance=1,this._viewMatrix=Q.Matrix.Zero(),this._cameraTransformMatrix=Q.Matrix.Zero(),this._cameraRotationMatrix=Q.Matrix.Zero(),this._transformedReferencePoint=Q.cv.Zero(),this._deferredPositionUpdate=new Q.cv,this._deferredRotationQuaternionUpdate=new Q.Quaternion,this._deferredRotationUpdate=new Q.cv,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=Q.cv.Forward(this.Fo().useRightHandedSystem),this.rotation=new Q.cv(0,this.Fo().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(o){this.getWorldMatrix();const v=Q.TmpVectors.cv[0],V=Q.TmpVectors.cv[1];return V.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(V,v),v.scaleInPlace(o),this.globalPosition.add(v)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const o=this.lockedTarget;o.Ag().getTranslationToRef(o.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.RU(0,0,0),this.cameraRotation.RU(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new Q.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Q.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Q.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(o){o||super._updateCache();const v=this._getLockedTargetPosition();v?this._cache.lockedTarget?this._cache.lockedTarget.U(v):this._cache.lockedTarget=v.clone():this._cache.lockedTarget=null,this._cache.rotation.U(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.U(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const o=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(o):!o)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const o=this.getEngine();return this.speed*Math.sqrt(o.getDeltaTime()/(100*o.getFps()))}setTarget(o){this.upVector.normalize(),this._initialFocalDistance=o.Rv(this.position).length(),this.position.z===o.z&&(this.position.z+=U.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.Fo().useRightHandedSystem?Q.Matrix.LookAtRHToRef(this.position,o,Q.cv.UpReadOnly,O):Q.Matrix.LookAtLHToRef(this.position,o,Q.cv.UpReadOnly,O),O.invert();const v=this.rotationQuaternion||h;Q.Quaternion.FromRotationMatrixToRef(O,v),v.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(o){this.setTarget(o)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(Q.TmpVectors.Matrix[0]),Q.cv.TransformNormalToRef(this.cameraDirection,Q.TmpVectors.Matrix[0],Q.TmpVectors.cv[0]),this._deferredPositionUpdate.addInPlace(Q.TmpVectors.cv[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.U(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.U(this._deferredPositionUpdate)}_checkInputs(){const o=this.invertRotation?-this.inverseRotationSpeed:1,v=this._decideIfNeedsToMove(),V=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.U(this.rotation),this._deferredPositionUpdate.U(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.U(this.rotationQuaternion),v&&this._updatePosition(),V){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*o,this._deferredRotationUpdate.y+=this.cameraRotation.y*o,!this.noRotationConstraint){const o=1.570796;this._deferredRotationUpdate.x>o&&(this._deferredRotationUpdate.x=o),this._deferredRotationUpdate.x<-o&&(this._deferredRotationUpdate.x=-o)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.U(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Q.Quaternion.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.U(this._deferredRotationQuaternionUpdate))}}v&&(Math.abs(this.cameraDirection.x)<this.speed*U.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*U.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*U.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),V&&(Math.abs(this.cameraRotation.x)<this.speed*U.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*U.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Q.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return Q.cv.TransformNormalToRef(Q.cv.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Q.cv.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?n.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Q.Quaternion.FromEulerVectorToRef(this.rotation,h),n.e.Y.rotateByQuaternionToRef(h,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(o,v,V){if(this.Fo().useRightHandedSystem?Q.Matrix.LookAtRHToRef(o,v,V,this._viewMatrix):Q.Matrix.LookAtLHToRef(o,v,V,this._viewMatrix),this.parent){const o=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.U(o)}createRigCamera(o,v){if(this.cameraRigMode!==I.e.RIG_MODE_NONE){const v=new x(o,this.position.clone(),this.Fo());return v.isRigCamera=!0,v.rigParent=this,this.cameraRigMode===I.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Q.Quaternion),v._cameraRigParams={},v.rotationQuaternion=new Q.Quaternion),v.mode=this.mode,v.orthoLeft=this.orthoLeft,v.orthoRight=this.orthoRight,v.orthoTop=this.orthoTop,v.orthoBottom=this.orthoBottom,v}return null}_updateRigCameras(){const o=this._rigCameras[0],v=this._rigCameras[1];switch(this.Ag(),this.cameraRigMode){case I.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case I.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case I.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case I.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case I.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const V=this.cameraRigMode===I.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,g=this.cameraRigMode===I.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*V,o),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*g,v);break}case I.e.RIG_MODE_VR:o.rotationQuaternion?(o.rotationQuaternion.U(this.rotationQuaternion),v.rotationQuaternion.U(this.rotationQuaternion)):(o.rotation.U(this.rotation),v.rotation.U(this.rotation)),o.position.U(this.position),v.position.U(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(o,v){this.getTarget().subtractToRef(this.position,x._TargetFocalPoint),x._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const V=x._TargetFocalPoint.addInPlace(this.position);Q.Matrix.TranslationToRef(-V.x,-V.y,-V.z,x._TargetTransformMatrix),x._TargetTransformMatrix.multiplyToRef(Q.Matrix.RotationAxis(v.upVector,o),x._RigCamTransformMatrix),Q.Matrix.TranslationToRef(V.x,V.y,V.z,x._TargetTransformMatrix),x._RigCamTransformMatrix.multiplyToRef(x._TargetTransformMatrix,x._RigCamTransformMatrix),Q.cv.TransformCoordinatesToRef(this.position,x._RigCamTransformMatrix,v.position),v.setTarget(V)}getClassName(){return"TargetCamera"}}x._RigCamTransformMatrix=new Q.Matrix,x._TargetTransformMatrix=new Q.Matrix,x._TargetFocalPoint=new Q.cv,(0,g.c)([(0,E.K)()],x.prototype,"updateUpVectorFromRotation",void 0),(0,g.c)([(0,E.G)()],x.prototype,"rotation",void 0),(0,g.c)([(0,E.K)()],x.prototype,"speed",void 0),(0,g.c)([(0,E.y)("lockedTargetId")],x.prototype,"lockedTarget",void 0)},12996:(o,v,V)=>{V.d(v,{c:()=>g});class g{}g.AUTOSAMPLERSUFFIX="Sampler",g.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",g.ALPHA_DISABLE=0,g.ALPHA_ADD=1,g.ALPHA_COMBINE=2,g.ALPHA_SUBTRACT=3,g.ALPHA_MULTIPLY=4,g.ALPHA_MAXIMIZED=5,g.ALPHA_ONEONE=6,g.ALPHA_PREMULTIPLIED=7,g.ALPHA_PREMULTIPLIED_PORTERDUFF=8,g.ALPHA_INTERPOLATE=9,g.ALPHA_SCREENMODE=10,g.ALPHA_ONEONE_ONEONE=11,g.ALPHA_ALPHATOCOLOR=12,g.ALPHA_REVERSEONEMINUS=13,g.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,g.ALPHA_ONEONE_ONEZERO=15,g.ALPHA_EXCLUSION=16,g.ALPHA_LAYER_ACCUMULATE=17,g.ALPHA_EQUATION_ADD=0,g.ALPHA_EQUATION_SUBSTRACT=1,g.ALPHA_EQUATION_REVERSE_SUBTRACT=2,g.ALPHA_EQUATION_MAX=3,g.ALPHA_EQUATION_MIN=4,g.ALPHA_EQUATION_DARKEN=5,g.DELAYLOADSTATE_NONE=0,g.DELAYLOADSTATE_LOADED=1,g.DELAYLOADSTATE_LOADING=2,g.DELAYLOADSTATE_NOTLOADED=4,g.NEVER=512,g.ALWAYS=519,g.LESS=513,g.EQUAL=514,g.LEQUAL=515,g.GREATER=516,g.GEQUAL=518,g.NOTEQUAL=517,g.KEEP=7680,g.ZERO=0,g.REPLACE=7681,g.INCR=7682,g.DECR=7683,g.INVERT=5386,g.INCR_WRAP=34055,g.DECR_WRAP=34056,g.TEXTURE_CLAMP_ADDRESSMODE=0,g.TEXTURE_WRAP_ADDRESSMODE=1,g.TEXTURE_MIRROR_ADDRESSMODE=2,g.TEXTURE_CREATIONFLAG_STORAGE=1,g.TEXTUREFORMAT_ALPHA=0,g.TEXTUREFORMAT_LUMINANCE=1,g.TEXTUREFORMAT_LUMINANCE_ALPHA=2,g.TEXTUREFORMAT_RGB=4,g.TEXTUREFORMAT_RGBA=5,g.TEXTUREFORMAT_RED=6,g.TEXTUREFORMAT_R=6,g.TEXTUREFORMAT_R16_UNORM=33322,g.TEXTUREFORMAT_RG16_UNORM=33324,g.TEXTUREFORMAT_RGB16_UNORM=32852,g.TEXTUREFORMAT_RGBA16_UNORM=32859,g.TEXTUREFORMAT_R16_SNORM=36760,g.TEXTUREFORMAT_RG16_SNORM=36761,g.TEXTUREFORMAT_RGB16_SNORM=36762,g.TEXTUREFORMAT_RGBA16_SNORM=36763,g.TEXTUREFORMAT_RG=7,g.TEXTUREFORMAT_RED_INTEGER=8,g.TEXTUREFORMAT_R_INTEGER=8,g.TEXTUREFORMAT_RG_INTEGER=9,g.TEXTUREFORMAT_RGB_INTEGER=10,g.TEXTUREFORMAT_RGBA_INTEGER=11,g.TEXTUREFORMAT_BGRA=12,g.TEXTUREFORMAT_DEPTH24_STENCIL8=13,g.TEXTUREFORMAT_DEPTH32_FLOAT=14,g.TEXTUREFORMAT_DEPTH16=15,g.TEXTUREFORMAT_DEPTH24=16,g.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,g.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,g.TEXTUREFORMAT_STENCIL8=19,g.TEXTUREFORMAT_UNDEFINED=4294967295,g.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,g.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,g.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,g.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,g.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,g.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,g.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,g.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,g.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,g.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,g.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,g.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,g.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,g.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,g.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,g.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,g.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,g.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,g.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,g.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,g.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,g.TEXTURETYPE_UNSIGNED_BYTE=0,g.TEXTURETYPE_UNSIGNED_INT=0,g.TEXTURETYPE_FLOAT=1,g.TEXTURETYPE_HALF_FLOAT=2,g.TEXTURETYPE_BYTE=3,g.TEXTURETYPE_SHORT=4,g.TEXTURETYPE_UNSIGNED_SHORT=5,g.TEXTURETYPE_INT=6,g.TEXTURETYPE_UNSIGNED_INTEGER=7,g.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,g.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,g.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,g.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,g.TEXTURETYPE_UNSIGNED_INT_24_8=12,g.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,g.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,g.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,g.TEXTURETYPE_UNDEFINED=16,g.TEXTURE_2D=3553,g.TEXTURE_2D_ARRAY=35866,g.TEXTURE_CUBE_MAP=34067,g.TEXTURE_CUBE_MAP_ARRAY=3735928559,g.TEXTURE_3D=32879,g.TEXTURE_NEAREST_SAMPLINGMODE=1,g.TEXTURE_NEAREST_NEAREST=1,g.TEXTURE_BILINEAR_SAMPLINGMODE=2,g.TEXTURE_LINEAR_LINEAR=2,g.TEXTURE_TRILINEAR_SAMPLINGMODE=3,g.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,g.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,g.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,g.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,g.TEXTURE_NEAREST_LINEAR=7,g.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,g.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,g.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,g.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,g.TEXTURE_LINEAR_NEAREST=12,g.TEXTURE_EXPLICIT_MODE=0,g.TEXTURE_SPHERICAL_MODE=1,g.TEXTURE_PLANAR_MODE=2,g.TEXTURE_CUBIC_MODE=3,g.TEXTURE_PROJECTION_MODE=4,g.TEXTURE_SKYBOX_MODE=5,g.TEXTURE_INVCUBIC_MODE=6,g.TEXTURE_EQUIRECTANGULAR_MODE=7,g.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,g.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,g.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,g.TEXTURE_FILTERING_QUALITY_HIGH=64,g.TEXTURE_FILTERING_QUALITY_MEDIUM=16,g.TEXTURE_FILTERING_QUALITY_LOW=8,g.SCALEMODE_FLOOR=1,g.SCALEMODE_NEAREST=2,g.SCALEMODE_CEILING=3,g.MATERIAL_TextureDirtyFlag=1,g.MATERIAL_LightDirtyFlag=2,g.MATERIAL_FresnelDirtyFlag=4,g.MATERIAL_AttributesDirtyFlag=8,g.MATERIAL_MiscDirtyFlag=16,g.MATERIAL_PrePassDirtyFlag=32,g.MATERIAL_ImageProcessingDirtyFlag=64,g.MATERIAL_AllDirtyFlag=127,g.MATERIAL_TriangleFillMode=0,g.MATERIAL_WireFrameFillMode=1,g.MATERIAL_PointFillMode=2,g.MATERIAL_PointListDrawMode=3,g.MATERIAL_LineListDrawMode=4,g.MATERIAL_LineLoopDrawMode=5,g.MATERIAL_LineStripDrawMode=6,g.MATERIAL_TriangleStripDrawMode=7,g.MATERIAL_TriangleFanDrawMode=8,g.MATERIAL_ClockWiseSideOrientation=0,g.MATERIAL_CounterClockWiseSideOrientation=1,g.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,g.MATERIAL_DIFFUSE_MODEL_BURLEY=1,g.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,g.MATERIAL_DIFFUSE_MODEL_LEGACY=3,g.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,g.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,g.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,g.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,g.ACTION_NothingTrigger=0,g.ACTION_OnPickTrigger=1,g.ACTION_OnLeftPickTrigger=2,g.ACTION_OnRightPickTrigger=3,g.ACTION_OnCenterPickTrigger=4,g.ACTION_OnPickDownTrigger=5,g.ACTION_OnDoublePickTrigger=6,g.ACTION_OnPickUpTrigger=7,g.ACTION_OnPickOutTrigger=16,g.ACTION_OnLongPressTrigger=8,g.ACTION_OnPointerOverTrigger=9,g.ACTION_OnPointerOutTrigger=10,g.ACTION_OnEveryFrameTrigger=11,g.ACTION_OnIntersectionEnterTrigger=12,g.ACTION_OnIntersectionExitTrigger=13,g.ACTION_OnKeyDownTrigger=14,g.ACTION_OnKeyUpTrigger=15,g.PARTICLES_BILLBOARDMODE_Y=2,g.PARTICLES_BILLBOARDMODE_ALL=7,g.PARTICLES_BILLBOARDMODE_STRETCHED=8,g.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,g.MESHES_CULLINGSTRATEGY_STANDARD=0,g.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,g.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,g.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,g.SCENELOADER_NO_LOGGING=0,g.SCENELOADER_MINIMAL_LOGGING=1,g.SCENELOADER_SUMMARY_LOGGING=2,g.SCENELOADER_DETAILED_LOGGING=3,g.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,g.PREPASS_POSITION_TEXTURE_TYPE=1,g.PREPASS_VELOCITY_TEXTURE_TYPE=2,g.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,g.PREPASS_COLOR_TEXTURE_TYPE=4,g.PREPASS_DEPTH_TEXTURE_TYPE=5,g.PREPASS_NORMAL_TEXTURE_TYPE=6,g.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,g.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,g.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,g.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,g.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,g.PREPASS_ALBEDO_TEXTURE_TYPE=12,g.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,g.BUFFER_CREATIONFLAG_READ=1,g.BUFFER_CREATIONFLAG_WRITE=2,g.BUFFER_CREATIONFLAG_READWRITE=3,g.BUFFER_CREATIONFLAG_UNIFORM=4,g.BUFFER_CREATIONFLAG_VERTEX=8,g.BUFFER_CREATIONFLAG_INDEX=16,g.BUFFER_CREATIONFLAG_STORAGE=32,g.BUFFER_CREATIONFLAG_INDIRECT=64,g.RENDERPASS_MAIN=0,g.INPUT_ALT_KEY=18,g.INPUT_CTRL_KEY=17,g.INPUT_META_KEY1=91,g.INPUT_META_KEY2=92,g.INPUT_META_KEY3=93,g.INPUT_SHIFT_KEY=16,g.SNAPSHOTRENDERING_STANDARD=0,g.SNAPSHOTRENDERING_FAST=1,g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_CUSTOM=22,g.MAX_SUPPORTED_UV_SETS=6,g.GL_ALPHA_EQUATION_ADD=32774,g.GL_ALPHA_EQUATION_MIN=32775,g.GL_ALPHA_EQUATION_MAX=32776,g.GL_ALPHA_EQUATION_SUBTRACT=32778,g.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,g.GL_ALPHA_FUNCTION_SRC=768,g.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,g.GL_ALPHA_FUNCTION_SRC_ALPHA=770,g.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,g.GL_ALPHA_FUNCTION_DST_ALPHA=772,g.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,g.GL_ALPHA_FUNCTION_DST_COLOR=774,g.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,g.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,g.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,g.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,g.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,g.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,g.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,g.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,g.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,g.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,g.SnippetUrl="https://snippet.babylonjs.com",g.FOGMODE_NONE=0,g.FOGMODE_EXP=1,g.FOGMODE_EXP2=2,g.FOGMODE_LINEAR=3,g.BYTE=5120,g.UNSIGNED_BYTE=5121,g.SHORT=5122,g.UNSIGNED_SHORT=5123,g.INT=5124,g.UNSIGNED_INT=5125,g.FLOAT=5126,g.PositionKind="position",g.NormalKind="normal",g.TangentKind="tangent",g.UVKind="uv",g.UV2Kind="uv2",g.UV3Kind="uv3",g.UV4Kind="uv4",g.UV5Kind="uv5",g.UV6Kind="uv6",g.ColorKind="color",g.ColorInstanceKind="instanceColor",g.MatricesIndicesKind="matricesIndices",g.MatricesWeightsKind="matricesWeights",g.MatricesIndicesExtraKind="matricesIndicesExtra",g.MatricesWeightsExtraKind="matricesWeightsExtra",g.ANIMATIONTYPE_FLOAT=0,g.ANIMATIONTYPE_VECTOR3=1,g.ANIMATIONTYPE_QUATERNION=2,g.ANIMATIONTYPE_MATRIX=3,g.ANIMATIONTYPE_COLOR3=4,g.ANIMATIONTYPE_COLOR4=7,g.ANIMATIONTYPE_VECTOR2=5,g.ANIMATIONTYPE_SIZE=6,g.ShadowMinZ=0,g.ShadowMaxZ=1e4},13049:(o,v,V)=>{V.d(v,{c:()=>f});var g=V(12473),E=V(12479),I=V(12488),Q=V(12547),U=V(12932),n=V(12766),O=V(12449),h=V(12808),x=V(12535);class f extends U.c{get range(){return this._range}set range(o){this._range=o,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(o){this._intensityMode=o,this._computePhotometricScale()}get radius(){return this._radius}set radius(o){this._radius=o,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(o){this._shadowEnabled!==o&&(this._shadowEnabled=o,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(o){this._includedOnlyMeshes=o,this._hookArrayForIncludedOnly(o)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(o){this._excludedMeshes=o,this._hookArrayForExcluded(o)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(o){this._excludeWithLayerMask=o,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(o){this._includeOnlyWithLayerMask=o,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(o){this._lightmapMode!==o&&(this._lightmapMode=o,this._markMeshesAsLightDirty())}getViewMatrix(o){return null}getProjectionMatrix(o,v){return null}constructor(o,v){super(o,v,!1),this.mn=new Q.Lv(1,1,1),this.th=new Q.Lv(1,1,1),this.falloffType=f.FALLOFF_DEFAULT,this.uU=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=f.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.Fo().addLight(this),this._uniformBuffer=new n.e(this.Fo().getEngine(),void 0,void 0,o),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(o,v){return this}_bindLight(o,v,V,g){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const I=o.toString();let U=!1;if(this._uniformBuffer.bindToEffect(V,"Light"+I),this._renderId!==v.getRenderId()||this._lastUseSpecular!==g||!this._uniformBuffer.useUbo){this._renderId=v.getRenderId(),this._lastUseSpecular=g;const o=this.getScaledIntensity();this.transferToEffect(V,I),this.mn.scaleToRef(o,Q.TmpColors.Lv[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Q.TmpColors.Lv[0],this.range,I),g&&(this.th.scaleToRef(o,Q.TmpColors.Lv[1]),this._uniformBuffer.updateColor4("vLightSpecular",Q.TmpColors.Lv[1],this.radius,I)),U=!0}if(this.transferTexturesToEffect(V,I),v.shadowsEnabled&&this.shadowEnabled&&E){const o=this.getShadowGenerator(v.activeCamera)??this.getShadowGenerator();o&&(o.bindShadowLight(I,V),U=!0)}U?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(o){let v="Name: "+this.name;if(v+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let V=0;V<this.animations.length;V++)v+=", animation[0]: "+this.animations[V].toString(o);return v}_syncParentEnabledState(){super._syncParentEnabledState(),this.l()||this._resyncMeshes()}eU(o){super.eU(o),this._resyncMeshes()}getShadowGenerator(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(o)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return I.cv.Zero()}canAffectMesh(o){return!o||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(o))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(o))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&o.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&o.layerMask)))}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const o=this._shadowGenerators.values();for(let v=o.next();!0!==v.done;v=o.next()){v.value.dispose()}this._shadowGenerators=null}if(this.Fo().stopAnimation(this),this._parentContainer){const o=this._parentContainer.lights.indexOf(this);o>-1&&this._parentContainer.lights.splice(o,1),this._parentContainer=null}for(const V of this.Fo().meshes)V._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.Fo().removeLight(this),super.dispose(o,v)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.uU}clone(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=f.GetConstructorFromName(this.getTypeID(),o,this.Fo());if(!V)return null;const g=x.c.Clone(V,this);return o&&(g.name=o),v&&(g.parent=v),g.eU(this.isEnabled()),this.onClonedObservable.notifyObservers(g),g}serialize(){const o=x.c.Serialize(this);if(o.uniqueId=this.uniqueId,o.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(o),this.excludedMeshes.length>0){o.excludedMeshesIds=[];for(const v of this.excludedMeshes)o.excludedMeshesIds.push(v.id)}if(this.includedOnlyMeshes.length>0){o.includedOnlyMeshesIds=[];for(const v of this.includedOnlyMeshes)o.includedOnlyMeshesIds.push(v.id)}return x.c.AppendSerializedAnimations(this,o),o.ranges=this.serializeAnimationRanges(),o.isEnabled=this.isEnabled(),o}static GetConstructorFromName(o,v,V){const g=U.c.Construct("Light_Type_"+o,v,V);return g||null}static Parse(o,v){const V=f.GetConstructorFromName(o.type,o.name,v);if(!V)return null;const g=x.c.Parse(V,o,v);if(o.excludedMeshesIds&&(g._excludedMeshesIds=o.excludedMeshesIds),o.includedOnlyMeshesIds&&(g._includedOnlyMeshesIds=o.includedOnlyMeshesIds),void 0!==o.parentId&&(g._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(g._waitingParentInstanceIndex=o.parentInstanceIndex),void 0!==o.falloffType&&(g.falloffType=o.falloffType),void 0!==o.lightmapMode&&(g.lightmapMode=o.lightmapMode),o.animations){for(let v=0;v<o.animations.length;v++){const V=o.animations[v],E=(0,O.d)("BABYLON.Animation");E&&g.animations.push(E.Parse(V))}U.c.ParseAnimationRanges(g,o,v)}return o.autoAnimate&&v.beginAnimation(g,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),void 0!==o.isEnabled&&g.eU(o.isEnabled),g}_hookArrayForExcluded(o){var v=this;const V=o.push;o.push=function(){for(var g=arguments.length,E=new Array(g),I=0;I<g;I++)E[I]=arguments[I];const Q=V.apply(o,E);for(const o of E)o._resyncLightSource(v);return Q};const g=o.splice;o.splice=(v,V)=>{const E=g.apply(o,[v,V]);for(const o of E)o._resyncLightSource(this);return E};for(const E of o)E._resyncLightSource(this)}_hookArrayForIncludedOnly(o){var v=this;const V=o.push;o.push=function(){for(var g=arguments.length,E=new Array(g),I=0;I<g;I++)E[I]=arguments[I];const Q=V.apply(o,E);return v._resyncMeshes(),Q};const g=o.splice;o.splice=(v,V)=>{const E=g.apply(o,[v,V]);return this._resyncMeshes(),E},this._resyncMeshes()}_resyncMeshes(){for(const o of this.Fo().meshes)o._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const o of this.Fo().meshes)-1!==o.lightSources.indexOf(this)&&o._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.Fo().resetCachedMaterial()}_getPhotometricScale(){let o=0;const v=this.getTypeID();let V=this.intensityMode;switch(V===f.INTENSITYMODE_AUTOMATIC&&(V=v===f.LIGHTTYPEID_DIRECTIONALLIGHT?f.INTENSITYMODE_ILLUMINANCE:f.INTENSITYMODE_LUMINOUSINTENSITY),v){case f.LIGHTTYPEID_POINTLIGHT:case f.LIGHTTYPEID_SPOTLIGHT:switch(V){case f.INTENSITYMODE_LUMINOUSPOWER:o=1/(4*Math.PI);break;case f.INTENSITYMODE_LUMINOUSINTENSITY:o=1;break;case f.INTENSITYMODE_LUMINANCE:o=this.radius*this.radius}break;case f.LIGHTTYPEID_DIRECTIONALLIGHT:switch(V){case f.INTENSITYMODE_ILLUMINANCE:o=1;break;case f.INTENSITYMODE_LUMINANCE:{let v=this.radius;v=Math.max(v,.001);o=2*Math.PI*(1-Math.cos(v));break}}break;case f.LIGHTTYPEID_HEMISPHERICLIGHT:o=1}return o}_reorderLightsInScene(){const o=this.Fo();0!=this._renderPriority&&(o.requireLightSorting=!0),this.Fo().sortLightsByPriority()}_isReady(){return!0}}f.FALLOFF_DEFAULT=h.b.FALLOFF_DEFAULT,f.FALLOFF_PHYSICAL=h.b.FALLOFF_PHYSICAL,f.FALLOFF_GLTF=h.b.FALLOFF_GLTF,f.FALLOFF_STANDARD=h.b.FALLOFF_STANDARD,f.LIGHTMAP_DEFAULT=h.b.LIGHTMAP_DEFAULT,f.LIGHTMAP_SPECULAR=h.b.LIGHTMAP_SPECULAR,f.LIGHTMAP_SHADOWSONLY=h.b.LIGHTMAP_SHADOWSONLY,f.INTENSITYMODE_AUTOMATIC=h.b.INTENSITYMODE_AUTOMATIC,f.INTENSITYMODE_LUMINOUSPOWER=h.b.INTENSITYMODE_LUMINOUSPOWER,f.INTENSITYMODE_LUMINOUSINTENSITY=h.b.INTENSITYMODE_LUMINOUSINTENSITY,f.INTENSITYMODE_ILLUMINANCE=h.b.INTENSITYMODE_ILLUMINANCE,f.INTENSITYMODE_LUMINANCE=h.b.INTENSITYMODE_LUMINANCE,f.LIGHTTYPEID_POINTLIGHT=h.b.LIGHTTYPEID_POINTLIGHT,f.LIGHTTYPEID_DIRECTIONALLIGHT=h.b.LIGHTTYPEID_DIRECTIONALLIGHT,f.LIGHTTYPEID_SPOTLIGHT=h.b.LIGHTTYPEID_SPOTLIGHT,f.LIGHTTYPEID_HEMISPHERICLIGHT=h.b.LIGHTTYPEID_HEMISPHERICLIGHT,f.LIGHTTYPEID_RECT_AREALIGHT=h.b.LIGHTTYPEID_RECT_AREALIGHT,(0,g.c)([(0,E.m)()],f.prototype,"diffuse",void 0),(0,g.c)([(0,E.m)()],f.prototype,"specular",void 0),(0,g.c)([(0,E.K)()],f.prototype,"falloffType",void 0),(0,g.c)([(0,E.K)()],f.prototype,"intensity",void 0),(0,g.c)([(0,E.K)()],f.prototype,"range",null),(0,g.c)([(0,E.K)()],f.prototype,"intensityMode",null),(0,g.c)([(0,E.K)()],f.prototype,"radius",null),(0,g.c)([(0,E.K)()],f.prototype,"_renderPriority",void 0),(0,g.c)([(0,E.d)("_reorderLightsInScene")],f.prototype,"renderPriority",void 0),(0,g.c)([(0,E.K)("shadowEnabled")],f.prototype,"_shadowEnabled",void 0),(0,g.c)([(0,E.K)("excludeWithLayerMask")],f.prototype,"_excludeWithLayerMask",void 0),(0,g.c)([(0,E.K)("includeOnlyWithLayerMask")],f.prototype,"_includeOnlyWithLayerMask",void 0),(0,g.c)([(0,E.K)("lightmapMode")],f.prototype,"_lightmapMode",void 0)},13099:(o,v,V)=>{V.d(v,{e:()=>n});var g=V(12473),E=V(12479),I=V(12488),Q=V(13049),U=V(12706);class n extends Q.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=I.Matrix.Identity(),this._projectionMatrix=I.Matrix.Identity()}_setPosition(o){this._position=o}get position(){return this._position}set position(o){this._setPosition(o)}_setDirection(o){this._direction=o}get direction(){return this._direction}set direction(o){this._setDirection(o)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(o){this._shadowMinZ=o,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(o){this._shadowMaxZ=o,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=I.cv.Zero()),I.cv.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=I.cv.Zero()),I.cv.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(o){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(o){return this.direction=I.cv.Normalize(o.Rv(this.position)),this.direction}getRotation(){this.direction.normalize();const o=I.cv.Cross(this.direction,U.e.Y),v=I.cv.Cross(o,this.direction);return I.cv.RotationFromAxis(o,v,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=I.cv.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Ag(o){return!o&&this.isSynchronized()?(this._currentRenderId=this.Fo().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.U(this.position),this._worldMatrix||(this._worldMatrix=I.Matrix.Identity()),I.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(o){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Xg)||0}getDepthMaxZ(o){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)||1e4}setShadowProjectionMatrix(o,v,V){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(v,V,o):this._setDefaultShadowProjectionMatrix(o,v,V),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(o){const v=I.TmpVectors.cv[0];let V=this.position;this.computeTransformedInformation()&&(V=this.transformedPosition),I.cv.NormalizeToRef(this.getShadowDirection(o),v),1===Math.abs(I.cv.Dot(v,I.cv.Up()))&&(v.z=1e-13);const g=I.TmpVectors.cv[1];return V.addToRef(v,g),I.Matrix.LookAtLHToRef(V,g,I.cv.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(o,v){return this.setShadowProjectionMatrix(this._projectionMatrix,o??this._viewMatrix,v??[]),this._projectionMatrix}}(0,g.c)([(0,E.G)()],n.prototype,"position",null),(0,g.c)([(0,E.G)()],n.prototype,"direction",null),(0,g.c)([(0,E.K)()],n.prototype,"shadowMinZ",null),(0,g.c)([(0,E.K)()],n.prototype,"shadowMaxZ",null)},12979:(o,v,V)=>{V.d(v,{e:()=>g});class g{static get ForceFullSceneLoadingForIncremental(){return g._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(o){g._ForceFullSceneLoadingForIncremental=o}static get ShowLoadingScreen(){return g._ShowLoadingScreen}static set ShowLoadingScreen(o){g._ShowLoadingScreen=o}static get loggingLevel(){return g._LoggingLevel}static set loggingLevel(o){g._LoggingLevel=o}static get CleanBoneMatrixWeights(){return g._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(o){g._CleanBoneMatrixWeights=o}}g._ForceFullSceneLoadingForIncremental=!1,g._ShowLoadingScreen=!0,g._CleanBoneMatrixWeights=!1,g._LoggingLevel=0},13020:(o,v,V)=>{V.d(v,{c:()=>H});var g=V(12473),E=V(12479),I=V(12308),Q=V(12593),U=V(13014),n=V(12747),O=V(12488),h=V(12577),x=V(12892),f=V(12910);class l extends x.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class S extends f.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"PBRBRDF",90,new l,v),this._useEnergyConservation=S.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=S.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=S.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=S.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=S.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=S.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=S.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=S.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=S.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=S.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=S.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=S.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=S.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=S.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=S.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=S.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=S.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=S.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=o._dirtyCallbacks[16],this._enable(!0)}prepareDefines(o){o.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,o.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,o.SPHERICAL_HARMONICS=this._useSphericalHarmonics,o.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,o.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,o.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,o.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,o.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,o.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}S.DEFAULT_USE_ENERGY_CONSERVATION=!0,S.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,S.DEFAULT_USE_SPHERICAL_HARMONICS=!0,S.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,S.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,S.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,S.DEFAULT_DIFFUSE_MODEL=0,S.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,S.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"useEnergyConservation",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"useSphericalHarmonics",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"mixIblRadianceWithIrradiance",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"useLegacySpecularEnergyConservation",void 0),(0,g.c)([(0,E.K)("baseDiffuseModel"),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"baseDiffuseModel",void 0),(0,g.c)([(0,E.K)("dielectricSpecularModel"),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"dielectricSpecularModel",void 0),(0,g.c)([(0,E.K)("conductorSpecularModel"),(0,E.d)("_markAllSubMeshesAsMiscDirty")],S.prototype,"conductorSpecularModel",void 0);var T=V(12890),c=V(12547),R=V(12753),j=V(12829),t=V(12825),s=V(12471),L=V(12900),b=(V(13027),V(12817)),u=V(12878);class mo extends x.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class a extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"PBRClearCoat",100,new mo,v),this._isEnabled=!1,this.isEnabled=!1,this.uU=1,this.roughness=0,this._indexOfRefraction=a._DefaultIndexOfRefraction,this.indexOfRefraction=a._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=c.Lv.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=o._dirtyCallbacks[1]}isReadyForSubMesh(o,v,V){if(!this._isEnabled)return!0;const g=this._material._disableBumpMap;if(o._areTexturesDirty&&v.texturesEnabled){if(this._texture&&L.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(V.getCaps().standardDerivatives&&this._bumpTexture&&L.b.ClearCoatBumpTextureEnabled&&!g&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(o,v){this._isEnabled?(o.CLEARCOAT=!0,o.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,o.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,o._areTexturesDirty&&v.texturesEnabled&&(this._texture&&L.b.ClearCoatTextureEnabled?(0,u.R)(this._texture,o,"CLEARCOAT_TEXTURE"):o.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&L.b.ClearCoatTextureEnabled?(0,u.R)(this._textureRoughness,o,"CLEARCOAT_TEXTURE_ROUGHNESS"):o.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&L.b.ClearCoatBumpTextureEnabled?(0,u.R)(this._bumpTexture,o,"CLEARCOAT_BUMP"):o.CLEARCOAT_BUMP=!1,o.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===a._DefaultIndexOfRefraction,this._isTintEnabled?(o.CLEARCOAT_TINT=!0,this._tintTexture&&L.b.ClearCoatTintTextureEnabled?((0,u.R)(this._tintTexture,o,"CLEARCOAT_TINT_TEXTURE"),o.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):o.CLEARCOAT_TINT_TEXTURE=!1):(o.CLEARCOAT_TINT=!1,o.CLEARCOAT_TINT_TEXTURE=!1))):(o.CLEARCOAT=!1,o.CLEARCOAT_TEXTURE=!1,o.CLEARCOAT_TEXTURE_ROUGHNESS=!1,o.CLEARCOAT_BUMP=!1,o.CLEARCOAT_TINT=!1,o.CLEARCOAT_TINT_TEXTURE=!1,o.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,o.CLEARCOAT_DEFAULTIOR=!1,o.CLEARCOAT_TEXTUREDIRECTUV=0,o.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,o.CLEARCOAT_BUMPDIRECTUV=0,o.CLEARCOAT_REMAP_F0=!1,o.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,o.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(o,v,V,g){if(!this._isEnabled)return;const E=g.materialDefines,I=this._material.isFrozen,Q=this._material._disableBumpMap,U=this._material._invertNormalMapX,n=this._material._invertNormalMapY;if(!o.useUbo||!I||!o.isSync){var O,h,x,f;if((this._texture||this._textureRoughness)&&L.b.ClearCoatTextureEnabled)o.updateFloat4("vClearCoatInfos",(null===(O=this._texture)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(h=this._texture)||void 0===h?void 0:h.level)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(f=this._textureRoughness)||void 0===f?void 0:f.level)??0),this._texture&&(0,u.o)(this._texture,o,"clearCoat"),this._textureRoughness&&!E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.o)(this._textureRoughness,o,"clearCoatRoughness");this._bumpTexture&&V.getCaps().standardDerivatives&&L.b.ClearCoatTextureEnabled&&!Q&&(o.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,u.o)(this._bumpTexture,o,"clearCoatBump"),v._mirroredCameraPosition?o.updateFloat2("vClearCoatTangentSpaceParams",U?1:-1,n?1:-1):o.updateFloat2("vClearCoatTangentSpaceParams",U?-1:1,n?-1:1)),this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&(o.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,u.o)(this._tintTexture,o,"clearCoatTint")),o.updateFloat2("vClearCoatParams",this.uU,this.roughness);const g=1-this._indexOfRefraction,I=1+this._indexOfRefraction,l=Math.pow(-g/I,2),S=1/this._indexOfRefraction;o.updateFloat4("vClearCoatRefractionParams",l,S,g,I),this._isTintEnabled&&(o.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),o.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}v.texturesEnabled&&(this._texture&&L.b.ClearCoatTextureEnabled&&o.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.b.ClearCoatTextureEnabled&&o.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&V.getCaps().standardDerivatives&&L.b.ClearCoatBumpTextureEnabled&&!Q&&o.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&o.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(o){return this._texture===o||(this._textureRoughness===o||(this._bumpTexture===o||this._tintTexture===o))}getActiveTextures(o){this._texture&&o.push(this._texture),this._textureRoughness&&o.push(this._textureRoughness),this._bumpTexture&&o.push(this._bumpTexture),this._tintTexture&&o.push(this._tintTexture)}getAnimatables(o){this._texture&&this._texture.animations&&this._texture.animations.length>0&&o.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&o.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&o.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&o.push(this._tintTexture)}dispose(o){var v,V,g,E;o&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(V=this._textureRoughness)||void 0===V||V.dispose(),null===(g=this._bumpTexture)||void 0===g||g.dispose(),null===(E=this._tintTexture)||void 0===E||E.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(o,v,V){return o.CLEARCOAT_BUMP&&v.addFallback(V++,"CLEARCOAT_BUMP"),o.CLEARCOAT_TINT&&v.addFallback(V++,"CLEARCOAT_TINT"),o.CLEARCOAT&&v.addFallback(V++,"CLEARCOAT"),V}getSamplers(o){o.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}a._DefaultIndexOfRefraction=1.5,(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isEnabled",void 0),(0,g.c)([(0,E.K)()],a.prototype,"intensity",void 0),(0,g.c)([(0,E.K)()],a.prototype,"roughness",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"indexOfRefraction",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"texture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRoughnessFromMainTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"textureRoughness",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"remapF0OnInterfaceChange",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"bumpTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"isTintEnabled",void 0),(0,g.c)([(0,E.m)()],a.prototype,"tintColor",void 0),(0,g.c)([(0,E.K)()],a.prototype,"tintColorAtDistance",void 0),(0,g.c)([(0,E.K)()],a.prototype,"tintThickness",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"tintTexture",void 0);class F extends x.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class i extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"PBRIridescence",110,new F,v),this._isEnabled=!1,this.isEnabled=!1,this.uU=1,this.minimumThickness=i._DefaultMinimumThickness,this.maximumThickness=i._DefaultMaximumThickness,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=o._dirtyCallbacks[1]}isReadyForSubMesh(o,v){if(!this._isEnabled)return!0;if(o._areTexturesDirty&&v.texturesEnabled){if(this._texture&&L.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&L.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(o,v){this._isEnabled?(o.IRIDESCENCE=!0,o._areTexturesDirty&&v.texturesEnabled&&(this._texture&&L.b.IridescenceTextureEnabled?(0,u.R)(this._texture,o,"IRIDESCENCE_TEXTURE"):o.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&L.b.IridescenceTextureEnabled?(0,u.R)(this._thicknessTexture,o,"IRIDESCENCE_THICKNESS_TEXTURE"):o.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(o.IRIDESCENCE=!1,o.IRIDESCENCE_TEXTURE=!1,o.IRIDESCENCE_THICKNESS_TEXTURE=!1,o.IRIDESCENCE_TEXTUREDIRECTUV=0,o.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(o,v){if(!this._isEnabled)return;const V=this._material.isFrozen;if(!o.useUbo||!V||!o.isSync){var g,E,I,Q;if((this._texture||this._thicknessTexture)&&L.b.IridescenceTextureEnabled)o.updateFloat4("vIridescenceInfos",(null===(g=this._texture)||void 0===g?void 0:g.coordinatesIndex)??0,(null===(E=this._texture)||void 0===E?void 0:E.level)??0,(null===(I=this._thicknessTexture)||void 0===I?void 0:I.coordinatesIndex)??0,(null===(Q=this._thicknessTexture)||void 0===Q?void 0:Q.level)??0),this._texture&&(0,u.o)(this._texture,o,"iridescence"),this._thicknessTexture&&(0,u.o)(this._thicknessTexture,o,"iridescenceThickness");o.updateFloat4("vIridescenceParams",this.uU,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}v.texturesEnabled&&(this._texture&&L.b.IridescenceTextureEnabled&&o.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&L.b.IridescenceTextureEnabled&&o.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(o){return this._texture===o||this._thicknessTexture===o}getActiveTextures(o){this._texture&&o.push(this._texture),this._thicknessTexture&&o.push(this._thicknessTexture)}getAnimatables(o){this._texture&&this._texture.animations&&this._texture.animations.length>0&&o.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&o.push(this._thicknessTexture)}dispose(o){var v,V;o&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(V=this._thicknessTexture)||void 0===V||V.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(o,v,V){return o.IRIDESCENCE&&v.addFallback(V++,"IRIDESCENCE"),V}getSamplers(o){o.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}i._DefaultMinimumThickness=100,i._DefaultMaximumThickness=400,i._DefaultIndexOfRefraction=1.3,(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,g.c)([(0,E.K)()],i.prototype,"intensity",void 0),(0,g.c)([(0,E.K)()],i.prototype,"minimumThickness",void 0),(0,g.c)([(0,E.K)()],i.prototype,"maximumThickness",void 0),(0,g.c)([(0,E.K)()],i.prototype,"indexOfRefraction",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0);class J extends x.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class d extends f.c{set angle(o){this.direction.x=Math.cos(o),this.direction.y=Math.sin(o)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"PBRAnisotropic",110,new J,v),this._isEnabled=!1,this.isEnabled=!1,this.uU=1,this.direction=new O.Vector2(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=o._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=o._dirtyCallbacks[16]}isReadyForSubMesh(o,v){return!this._isEnabled||!(o._areTexturesDirty&&v.texturesEnabled&&this._texture&&L.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(o,v,V){this._isEnabled?(o.ANISOTROPIC=this._isEnabled,this._isEnabled&&!V.isVerticesDataPresent(h.e.TangentKind)&&(o._needUVs=!0,o.MAINUV1=!0),o._areTexturesDirty&&v.texturesEnabled&&(this._texture&&L.b.AnisotropicTextureEnabled?(0,u.R)(this._texture,o,"ANISOTROPIC_TEXTURE"):o.ANISOTROPIC_TEXTURE=!1),o._areMiscDirty&&(o.ANISOTROPIC_LEGACY=this._legacy)):(o.ANISOTROPIC=!1,o.ANISOTROPIC_TEXTURE=!1,o.ANISOTROPIC_TEXTUREDIRECTUV=0,o.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(o,v){if(!this._isEnabled)return;const V=this._material.isFrozen;o.useUbo&&V&&o.isSync||(this._texture&&L.b.AnisotropicTextureEnabled&&(o.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,u.o)(this._texture,o,"anisotropy")),o.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.uU)),v.texturesEnabled&&this._texture&&L.b.AnisotropicTextureEnabled&&o.setTexture("anisotropySampler",this._texture)}hasTexture(o){return this._texture===o}getActiveTextures(o){this._texture&&o.push(this._texture)}getAnimatables(o){this._texture&&this._texture.animations&&this._texture.animations.length>0&&o.push(this._texture)}dispose(o){o&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(o,v,V){return o.ANISOTROPIC&&v.addFallback(V++,"ANISOTROPIC"),V}getSamplers(o){o.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(o,v,V){super.parse(o,v,V),void 0===o.legacy&&(this.legacy=!0)}}(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isEnabled",void 0),(0,g.c)([(0,E.K)()],d.prototype,"intensity",void 0),(0,g.c)([(0,E.E)()],d.prototype,"direction",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"texture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],d.prototype,"legacy",void 0);class N extends x.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class Y extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"Sheen",120,new N,v),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.uU=1,this.color=c.Lv.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=o._dirtyCallbacks[1]}isReadyForSubMesh(o,v){if(!this._isEnabled)return!0;if(o._areTexturesDirty&&v.texturesEnabled){if(this._texture&&L.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(o,v){this._isEnabled?(o.SHEEN=!0,o.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,o.SHEEN_ROUGHNESS=null!==this._roughness,o.SHEEN_ALBEDOSCALING=this._albedoScaling,o.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,o._areTexturesDirty&&v.texturesEnabled&&(this._texture&&L.b.SheenTextureEnabled?((0,u.R)(this._texture,o,"SHEEN_TEXTURE"),o.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):o.SHEEN_TEXTURE=!1,this._textureRoughness&&L.b.SheenTextureEnabled?(0,u.R)(this._textureRoughness,o,"SHEEN_TEXTURE_ROUGHNESS"):o.SHEEN_TEXTURE_ROUGHNESS=!1)):(o.SHEEN=!1,o.SHEEN_TEXTURE=!1,o.SHEEN_TEXTURE_ROUGHNESS=!1,o.SHEEN_LINKWITHALBEDO=!1,o.SHEEN_ROUGHNESS=!1,o.SHEEN_ALBEDOSCALING=!1,o.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,o.SHEEN_GAMMATEXTURE=!1,o.SHEEN_TEXTUREDIRECTUV=0,o.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(o,v,V,g){if(!this._isEnabled)return;const E=g.materialDefines,I=this._material.isFrozen;if(!o.useUbo||!I||!o.isSync){var Q,U,n,O;if((this._texture||this._textureRoughness)&&L.b.SheenTextureEnabled)o.updateFloat4("vSheenInfos",(null===(Q=this._texture)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(U=this._texture)||void 0===U?void 0:U.level)??0,(null===(n=this._textureRoughness)||void 0===n?void 0:n.coordinatesIndex)??0,(null===(O=this._textureRoughness)||void 0===O?void 0:O.level)??0),this._texture&&(0,u.o)(this._texture,o,"sheen"),this._textureRoughness&&!E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.o)(this._textureRoughness,o,"sheenRoughness");o.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.uU),null!==this._roughness&&o.updateFloat("vSheenRoughness",this._roughness)}v.texturesEnabled&&(this._texture&&L.b.SheenTextureEnabled&&o.setTexture("sheenSampler",this._texture),this._textureRoughness&&!E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.b.SheenTextureEnabled&&o.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(o){return this._texture===o||this._textureRoughness===o}getActiveTextures(o){this._texture&&o.push(this._texture),this._textureRoughness&&o.push(this._textureRoughness)}getAnimatables(o){this._texture&&this._texture.animations&&this._texture.animations.length>0&&o.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&o.push(this._textureRoughness)}dispose(o){var v,V;o&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(V=this._textureRoughness)||void 0===V||V.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(o,v,V){return o.SHEEN&&v.addFallback(V++,"SHEEN"),V}getSamplers(o){o.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isEnabled",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"linkSheenWithAlbedo",void 0),(0,g.c)([(0,E.K)()],Y.prototype,"intensity",void 0),(0,g.c)([(0,E.m)()],Y.prototype,"color",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"texture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMainTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"roughness",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"textureRoughness",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"albedoScaling",void 0);class q extends x.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class P extends f.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(o){this._scene.enableSubSurfaceForPrePass()&&o&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(o))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(o){this._volumeIndexOfRefraction=o>=1?o:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(o,"PBRSubSurface",130,new q,v),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=c.Lv.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=c.Lv.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=P.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=P.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=o.Fo(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=o._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=o._dirtyCallbacks[32]}isReadyForSubMesh(o,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(o._areTexturesDirty&&v.texturesEnabled){if(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const o=this._getRefractionTexture(v);if(o&&L.b.RefractionTextureEnabled&&!o.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(o,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return o.SUBSURFACE=!1,o.SS_DISPERSION=!1,o.SS_TRANSLUCENCY=!1,o.SS_SCATTERING=!1,o.SS_REFRACTION=!1,o.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,o.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,o.SS_THICKNESSANDMASK_TEXTURE=!1,o.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,o.SS_HAS_THICKNESS=!1,o.SS_REFRACTIONINTENSITY_TEXTURE=!1,o.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,o.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,o.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,o.SS_REFRACTIONMAP_3D=!1,o.SS_REFRACTIONMAP_OPPOSITEZ=!1,o.SS_LODINREFRACTIONALPHA=!1,o.SS_GAMMAREFRACTION=!1,o.SS_RGBDREFRACTION=!1,o.SS_LINEARSPECULARREFRACTION=!1,o.SS_LINKREFRACTIONTOTRANSPARENCY=!1,o.SS_ALBEDOFORREFRACTIONTINT=!1,o.SS_ALBEDOFORTRANSLUCENCYTINT=!1,o.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,o.SS_USE_THICKNESS_AS_DEPTH=!1,o.SS_USE_GLTF_TEXTURES=!1,o.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,o.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,o.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(o.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(o._areTexturesDirty){if(o.SUBSURFACE=!0,o.SS_DISPERSION=this._isDispersionEnabled,o.SS_TRANSLUCENCY=this._isTranslucencyEnabled,o.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,o.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,o.SS_SCATTERING=this._isScatteringEnabled,o.SS_THICKNESSANDMASK_TEXTURE=!1,o.SS_REFRACTIONINTENSITY_TEXTURE=!1,o.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,o.SS_HAS_THICKNESS=!1,o.SS_USE_GLTF_TEXTURES=!1,o.SS_REFRACTION=!1,o.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,o.SS_REFRACTIONMAP_3D=!1,o.SS_GAMMAREFRACTION=!1,o.SS_RGBDREFRACTION=!1,o.SS_LINEARSPECULARREFRACTION=!1,o.SS_REFRACTIONMAP_OPPOSITEZ=!1,o.SS_LODINREFRACTIONALPHA=!1,o.SS_LINKREFRACTIONTOTRANSPARENCY=!1,o.SS_ALBEDOFORREFRACTIONTINT=!1,o.SS_ALBEDOFORTRANSLUCENCYTINT=!1,o.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,o.SS_USE_THICKNESS_AS_DEPTH=!1,o.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,o.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,o._areTexturesDirty&&v.texturesEnabled&&(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&(0,u.R)(this._thicknessTexture,o,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&(0,u.R)(this._refractionIntensityTexture,o,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&(0,u.R)(this._translucencyIntensityTexture,o,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&((0,u.R)(this._translucencyColorTexture,o,"SS_TRANSLUCENCYCOLOR_TEXTURE"),o.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),o.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,o.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,o.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,o.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&v.texturesEnabled){const V=this._getRefractionTexture(v);V&&L.b.RefractionTextureEnabled&&(o.SS_REFRACTION=!0,o.SS_REFRACTIONMAP_3D=V.isCube,o.SS_GAMMAREFRACTION=V.gammaSpace,o.SS_RGBDREFRACTION=V.isRGBD,o.SS_LINEARSPECULARREFRACTION=V.linearSpecularLOD,o.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&V.isCube?!V.invertZ:V.invertZ,o.SS_LODINREFRACTIONALPHA=V.lodLevelInAlpha,o.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,o.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,o.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=V.isCube&&V.boundingBoxSize,o.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(o.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(o,v,V,g){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)o.updateFloat2("vThicknessParam",0,0);else{g.getRenderingMesh().getWorldMatrix().decompose(O.TmpVectors.cv[0]);const v=Math.max(Math.abs(O.TmpVectors.cv[0].x),Math.abs(O.TmpVectors.cv[0].y),Math.abs(O.TmpVectors.cv[0].z));o.updateFloat2("vThicknessParam",this.minimumThickness*v,(this.maximumThickness-this.minimumThickness)*v)}}bindForSubMesh(o,v,V,g){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const E=g.materialDefines,I=this._material.isFrozen,Q=this._material.realTimeFiltering,U=E.LODBASEDMICROSFURACE,n=this._getRefractionTexture(v);if(!o.useUbo||!I||!o.isSync){if(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&(o.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,u.o)(this._thicknessTexture,o,"thickness")),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&E.SS_REFRACTIONINTENSITY_TEXTURE&&(o.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,u.o)(this._refractionIntensityTexture,o,"refractionIntensity")),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&E.SS_TRANSLUCENCYCOLOR_TEXTURE&&(o.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,u.o)(this._translucencyColorTexture,o,"translucencyColor")),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&E.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(o.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,u.o)(this._translucencyIntensityTexture,o,"translucencyIntensity")),n&&L.b.RefractionTextureEnabled){o.Bg("refractionMatrix",n.getRefractionTextureMatrix());let v=1;n.isCube||n.depth&&(v=n.depth);const V=n.getSize().width,g=this.volumeIndexOfRefraction;if(o.updateFloat4("vRefractionInfos",n.level,1/g,v,this._invertRefractionY?-1:1),o.updateFloat4("vRefractionMicrosurfaceInfos",V,n.lodGenerationScale,n.lodGenerationOffset,1/this.indexOfRefraction),Q&&o.updateFloat2("vRefractionFilteringInfo",V,Math.log2(V)),n.boundingBoxSize){const v=n;o.updateVector3("vRefractionPosition",v.boundingBoxPosition),o.updateVector3("vRefractionSize",v.boundingBoxSize)}}this._isScatteringEnabled&&o.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),o.updateColor3("vDiffusionDistance",this.diffusionDistance),o.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),o.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),o.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),o.updateFloat("dispersion",this.dispersion)}v.texturesEnabled&&(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&o.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&E.SS_REFRACTIONINTENSITY_TEXTURE&&o.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&E.SS_TRANSLUCENCYINTENSITY_TEXTURE&&o.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&E.SS_TRANSLUCENCYCOLOR_TEXTURE&&o.setTexture("translucencyColorSampler",this._translucencyColorTexture),n&&L.b.RefractionTextureEnabled&&(U?o.setTexture("refractionSampler",n):(o.setTexture("refractionSampler",n._lodTextureMid||n),o.setTexture("refractionSamplerLow",n._lodTextureLow||n),o.setTexture("refractionSamplerHigh",n._lodTextureHigh||n))))}_getRefractionTexture(o){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?o.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(o){L.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&o.push(this._refractionTexture)}hasTexture(o){return this._thicknessTexture===o||(this._refractionTexture===o||(this._refractionIntensityTexture===o||(this._translucencyIntensityTexture===o||this._translucencyColorTexture===o)))}hasRenderTargetTextures(){return!!(L.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(o){this._thicknessTexture&&o.push(this._thicknessTexture),this._refractionTexture&&o.push(this._refractionTexture),this._translucencyColorTexture&&o.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&o.push(this._translucencyIntensityTexture)}getAnimatables(o){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&o.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&o.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&o.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&o.push(this._translucencyIntensityTexture)}dispose(o){o&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(o,v,V){return o.SS_SCATTERING&&v.addFallback(V++,"SS_SCATTERING"),o.SS_TRANSLUCENCY&&v.addFallback(V++,"SS_TRANSLUCENCY"),V}getSamplers(o){o.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}P.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,P.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isRefractionEnabled",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isTranslucencyEnabled",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isDispersionEnabled",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markScenePrePassDirty")],P.prototype,"isScatteringEnabled",void 0),(0,g.c)([(0,E.K)()],P.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,g.c)([(0,E.K)()],P.prototype,"refractionIntensity",void 0),(0,g.c)([(0,E.K)()],P.prototype,"translucencyIntensity",void 0),(0,g.c)([(0,E.K)()],P.prototype,"useAlbedoToTintRefraction",void 0),(0,g.c)([(0,E.K)()],P.prototype,"useAlbedoToTintTranslucency",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"thicknessTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"indexOfRefraction",void 0),(0,g.c)([(0,E.K)()],P.prototype,"_volumeIndexOfRefraction",void 0),(0,g.c)([(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"volumeIndexOfRefraction",null),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"invertRefractionY",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkRefractionWithTransparency",void 0),(0,g.c)([(0,E.K)()],P.prototype,"minimumThickness",void 0),(0,g.c)([(0,E.K)()],P.prototype,"maximumThickness",void 0),(0,g.c)([(0,E.K)()],P.prototype,"useThicknessAsDepth",void 0),(0,g.c)([(0,E.m)()],P.prototype,"tintColor",void 0),(0,g.c)([(0,E.K)()],P.prototype,"tintColorAtDistance",void 0),(0,g.c)([(0,E.K)()],P.prototype,"dispersion",void 0),(0,g.c)([(0,E.m)()],P.prototype,"diffusionDistance",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useMaskFromThicknessTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionIntensityTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyIntensityTexture",void 0),(0,g.c)([(0,E.m)()],P.prototype,"translucencyColor",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyColorTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useGltfStyleTextures",void 0),(0,g.c)([(0,E.K)()],P.prototype,"applyAlbedoAfterSubSurface",void 0),(0,g.c)([(0,E.K)()],P.prototype,"legacyTransluceny",void 0);var M=V(12903),W=V(12884),w=V(12915);const z={effect:null,subMesh:null};class y extends x.b{constructor(o){super(o),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class H extends t.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(o){this._realTimeFiltering=o,this.eO(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(o){this._realTimeFilteringQuality=o,this.eO(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(o){o!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=o||this.Fo().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(o,v){super(o,v,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||H.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new O.Vector4(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=H.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=c.Lv.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new c.Lv(0,0,0),this._albedoColor=new c.Lv(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new c.Lv(1,1,1),this._reflectionColor=new c.Lv(1,1,1),this._emissiveColor=new c.Lv(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=H.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new Q.d(16),this._globalAmbientColor=new c.Lv(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new S(this),this.clearCoat=new a(this),this.iridescence=new i(this),this.anisotropy=new d(this),this.sheen=new Y(this),this.subSurface=new P(this),this.detailMap=new M.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,U.e)(this.Fo()),this.prePassConfiguration=new T.d}get hasRenderTargetTextures(){return!!(L.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var o;return this._transparencyMode===H.PBRMATERIAL_OPAQUE||this._transparencyMode===H.PBRMATERIAL_ALPHATEST||(null===(o=this.subSurface)||void 0===o?void 0:o.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var o;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(o=this.subSurface)||void 0===o||!o.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===H.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Kg&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==H.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Kg||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(o,v,V){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const g=v._drawWrapper;if(g.effect&&this.isFrozen&&g._wasPreviouslyReady&&g._wasPreviouslyUsingInstances===V)return!0;v.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),v.materialDefines=new y(this._eventInfo.defineNames));const E=v.materialDefines;if(this._isReadyForSubMesh(v))return!0;const Q=this.Fo(),U=Q.getEngine();if(E._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Q.texturesEnabled)){if(this._albedoTexture&&L.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&L.b.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&L.b.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&L.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&L.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const o=this._getReflectionTexture();if(o&&L.b.ReflectionTextureEnabled){if(!o.isReadyOrNotBlocking())return!1;var n;if(o.irradianceTexture){if(!o.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!o.sphericalPolynomial&&null!==(n=o.getInternalTexture())&&void 0!==n&&n._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&L.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&L.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(L.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(U.getCaps().standardDerivatives&&this._bumpTexture&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&L.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=E,this._eventInfo.subMesh=v,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(E._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(E.AREALIGHTUSED)for(let I=0;I<o.lightSources.length;I++)if(!o.lightSources[I]._isReady())return!1;U.getCaps().standardDerivatives||o.isVerticesDataPresent(h.e.NormalKind)||(o.createNormals(!0),I.b.Warn("PBRMaterial: Normals have been created for the mesh: "+o.name));const O=v.effect,x=E._areLightsDisposed;let f=this._prepareEffect(o,E,this.onCompiled,this.onError,V,null,v.getRenderingMesh().hasThinInstances),l=!1;if(f)if(this._onEffectCreatedObservable&&(z.effect=f,z.subMesh=v,this._onEffectCreatedObservable.notifyObservers(z)),this.allowShaderHotSwapping&&O&&!f.isReady()){if(f=O,E.markAsUnprocessed(),l=this.isFrozen,x)return E._areLightsDisposed=!0,!1}else Q.resetCachedMaterial(),v.setEffect(f,E,this._materialContext);return!(!v.effect||!v.effect.isReady())&&(E._renderId=Q.getRenderId(),g._wasPreviouslyReady=!l,g._wasPreviouslyUsingInstances=!!V,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(o,v){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(o,v,I,Q,U),!v.isDirty)return null;v.markAsProcessed();const n=this.Fo().getEngine(),O=new b.d;let x=0;v.USESPHERICALINVERTEX&&O.addFallback(x++,"USESPHERICALINVERTEX"),v.FOG&&O.addFallback(x,"FOG"),v.SPECULARAA&&O.addFallback(x,"SPECULARAA"),v.POINTSIZE&&O.addFallback(x,"POINTSIZE"),v.LOGARITHMICDEPTH&&O.addFallback(x,"LOGARITHMICDEPTH"),v.PARALLAX&&O.addFallback(x,"PARALLAX"),v.PARALLAX_RHS&&O.addFallback(x,"PARALLAX_RHS"),v.PARALLAXOCCLUSION&&O.addFallback(x++,"PARALLAXOCCLUSION"),v.ENVIRONMENTBRDF&&O.addFallback(x++,"ENVIRONMENTBRDF"),v.TANGENT&&O.addFallback(x++,"TANGENT"),v.BUMP&&O.addFallback(x++,"BUMP"),x=(0,u.q)(v,O,this._maxSimultaneousLights,x++),v.SPECULARTERM&&O.addFallback(x++,"SPECULARTERM"),v.USESPHERICALFROMREFLECTIONMAP&&O.addFallback(x++,"USESPHERICALFROMREFLECTIONMAP"),v.USEIRRADIANCEMAP&&O.addFallback(x++,"USEIRRADIANCEMAP"),v.LIGHTMAP&&O.addFallback(x++,"LIGHTMAP"),v.NORMAL&&O.addFallback(x++,"NORMAL"),v.AMBIENT&&O.addFallback(x++,"AMBIENT"),v.EMISSIVE&&O.addFallback(x++,"EMISSIVE"),v.VERTEXCOLOR&&O.addFallback(x++,"VERTEXCOLOR"),v.MORPHTARGETS&&O.addFallback(x++,"MORPHTARGETS"),v.MULTIVIEW&&O.addFallback(0,"MULTIVIEW");const f=[h.e.PositionKind];v.NORMAL&&f.push(h.e.NormalKind),v.TANGENT&&f.push(h.e.TangentKind);for(let V=1;V<=6;++V)v["UV"+V]&&f.push(`uv${1===V?"":V}`);v.VERTEXCOLOR&&f.push(h.e.ColorKind),(0,u.w)(f,o,v,O),(0,u.z)(f,v),(0,u.C)(f,o,v),(0,u.s)(f,o,v);let l="pbr";const S=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],c=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],j=["Material","Scene","Mesh"],t={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:v.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=O,this._eventInfo.fallbackRank=x,this._eventInfo.defines=v,this._eventInfo.uniforms=S,this._eventInfo.attributes=f,this._eventInfo.samplers=c,this._eventInfo.uniformBuffersNames=j,this._eventInfo.customCode=void 0,this._eventInfo.mesh=o,this._eventInfo.indexParameters=t,this._callbackPluginEventGeneric(128,this._eventInfo),w.e.AddUniformsAndSamplers(S,c),T.d.AddUniforms(S),T.d.AddSamplers(c),(0,W.b)(S),R.c&&(R.c.PrepareUniforms(S,v),R.c.PrepareSamplers(c,v)),(0,u.$)({uniformsNames:S,uniformBuffersNames:j,samplers:c,defines:v,maxSimultaneousLights:this._maxSimultaneousLights});const s={};this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,S,j,c,v,f,s));const L=v.toString(),mo=n.createEffect(l,{attributes:f,uniformsNames:S,uniformBuffersNames:j,samplers:c,defines:L,fallbacks:O,onCompiled:g,onError:E,indexParameters:t,processFinalCode:s.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:v.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([V.e(41),V.e(71)]).then(V.bind(V,15568)),Promise.all([V.e(39),V.e(72)]).then(V.bind(V,15590))]):await Promise.all([Promise.all([V.e(34),V.e(73)]).then(V.bind(V,15592)),Promise.all([V.e(33),V.e(74)]).then(V.bind(V,15617))]),this._shadersLoaded=!0}},n);return this._eventInfo.customCode=void 0,mo}_prepareDefines(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const I=this.Fo(),Q=I.getEngine();(0,u.N)(I,o,v,!0,this._maxSimultaneousLights,this._disableLighting),v._needNormals=!0,(0,u.V)(I,v);const U=this.needAlphaBlendingForMesh(o)&&this.Fo().useOrderIndependentTransparency;if((0,u.X)(I,v,this.canRenderToMRT&&!U),(0,u.W)(I,v,U),w.e.PrepareDefines(Q.currentRenderPassId,o,v),v.METALLICWORKFLOW=this.isMetallicWorkflow(),v._areTexturesDirty){v._needUVs=!1;for(let o=1;o<=6;++o)v["MAINUV"+o]=!1;if(I.texturesEnabled){v.ALBEDODIRECTUV=0,v.BASE_WEIGHTDIRECTUV=0,v.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,v.AMBIENTDIRECTUV=0,v.OPACITYDIRECTUV=0,v.EMISSIVEDIRECTUV=0,v.REFLECTIVITYDIRECTUV=0,v.MICROSURFACEMAPDIRECTUV=0,v.METALLIC_REFLECTANCEDIRECTUV=0,v.REFLECTANCEDIRECTUV=0,v.BUMPDIRECTUV=0,v.LIGHTMAPDIRECTUV=0,Q.getCaps().textureLOD&&(v.LODBASEDMICROSFURACE=!0),this._albedoTexture&&L.b.DiffuseTextureEnabled?((0,u.R)(this._albedoTexture,v,"ALBEDO"),v.GAMMAALBEDO=this._albedoTexture.gammaSpace):v.ALBEDO=!1,this._baseWeightTexture&&L.b.BaseWeightTextureEnabled?(0,u.R)(this._baseWeightTexture,v,"BASE_WEIGHT"):v.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&L.b.BaseDiffuseRoughnessTextureEnabled?(0,u.R)(this._baseDiffuseRoughnessTexture,v,"BASE_DIFFUSE_ROUGHNESS"):v.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&L.b.AmbientTextureEnabled?((0,u.R)(this._ambientTexture,v,"AMBIENT"),v.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):v.AMBIENT=!1,this._opacityTexture&&L.b.OpacityTextureEnabled?((0,u.R)(this._opacityTexture,v,"OPACITY"),v.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):v.OPACITY=!1;const o=this._getReflectionTexture();if(o&&L.b.ReflectionTextureEnabled){switch(v.REFLECTION=!0,v.GAMMAREFLECTION=o.gammaSpace,v.RGBDREFLECTION=o.isRGBD,v.LODINREFLECTIONALPHA=o.lodLevelInAlpha,v.LINEARSPECULARREFLECTION=o.linearSpecularLOD,v.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(v.NUM_SAMPLES=""+this.realTimeFilteringQuality,Q._features.needTypeSuffixInShaderConstants&&(v.NUM_SAMPLES=v.NUM_SAMPLES+"u"),v.REALTIME_FILTERING=!0,this.Fo().iblCdfGenerator&&(v.IBL_CDF_FILTERING=!0)):v.REALTIME_FILTERING=!1,v.INVERTCUBICMAP=o.coordinatesMode===s.e.INVCUBIC_MODE,v.REFLECTIONMAP_3D=o.isCube,v.REFLECTIONMAP_OPPOSITEZ=v.REFLECTIONMAP_3D&&this.Fo().useRightHandedSystem?!o.invertZ:o.invertZ,v.REFLECTIONMAP_CUBIC=!1,v.REFLECTIONMAP_EXPLICIT=!1,v.REFLECTIONMAP_PLANAR=!1,v.REFLECTIONMAP_PROJECTION=!1,v.REFLECTIONMAP_SKYBOX=!1,v.REFLECTIONMAP_SPHERICAL=!1,v.REFLECTIONMAP_EQUIRECTANGULAR=!1,v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,o.coordinatesMode){case s.e.EXPLICIT_MODE:v.REFLECTIONMAP_EXPLICIT=!0;break;case s.e.PLANAR_MODE:v.REFLECTIONMAP_PLANAR=!0;break;case s.e.PROJECTION_MODE:v.REFLECTIONMAP_PROJECTION=!0;break;case s.e.SKYBOX_MODE:v.REFLECTIONMAP_SKYBOX=!0;break;case s.e.SPHERICAL_MODE:v.REFLECTIONMAP_SPHERICAL=!0;break;case s.e.EQUIRECTANGULAR_MODE:v.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case s.e.FIXED_EQUIRECTANGULAR_MODE:v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case s.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case s.e.CUBIC_MODE:case s.e.INVCUBIC_MODE:default:v.REFLECTIONMAP_CUBIC=!0,v.USE_LOCAL_REFLECTIONMAP_CUBIC=!!o.boundingBoxSize}o.coordinatesMode!==s.e.SKYBOX_MODE&&(o.irradianceTexture?(v.USEIRRADIANCEMAP=!0,v.USESPHERICALFROMREFLECTIONMAP=!1,v.USESPHERICALINVERTEX=!1,o.irradianceTexture._dominantDirection&&(v.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):o.isCube&&(v.USESPHERICALFROMREFLECTIONMAP=!0,v.USEIRRADIANCEMAP=!1,v.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||Q.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?v.USESPHERICALINVERTEX=!1:v.USESPHERICALINVERTEX=!0))}else v.REFLECTION=!1,v.REFLECTIONMAP_3D=!1,v.REFLECTIONMAP_SPHERICAL=!1,v.REFLECTIONMAP_PLANAR=!1,v.REFLECTIONMAP_CUBIC=!1,v.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,v.REFLECTIONMAP_PROJECTION=!1,v.REFLECTIONMAP_SKYBOX=!1,v.REFLECTIONMAP_EXPLICIT=!1,v.REFLECTIONMAP_EQUIRECTANGULAR=!1,v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,v.INVERTCUBICMAP=!1,v.USESPHERICALFROMREFLECTIONMAP=!1,v.USEIRRADIANCEMAP=!1,v.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,v.USESPHERICALINVERTEX=!1,v.REFLECTIONMAP_OPPOSITEZ=!1,v.LODINREFLECTIONALPHA=!1,v.GAMMAREFLECTION=!1,v.RGBDREFLECTION=!1,v.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&L.b.LightmapTextureEnabled?((0,u.R)(this._lightmapTexture,v,"LIGHTMAP"),v.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,v.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,v.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):v.LIGHTMAP=!1,this._emissiveTexture&&L.b.EmissiveTextureEnabled?((0,u.R)(this._emissiveTexture,v,"EMISSIVE"),v.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):v.EMISSIVE=!1,L.b.SpecularTextureEnabled?(this._metallicTexture?((0,u.R)(this._metallicTexture,v,"REFLECTIVITY"),v.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,v.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,v.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,v.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,v.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,u.R)(this._reflectivityTexture,v,"REFLECTIVITY"),v.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,v.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,v.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):v.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(v.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,u.R)(this._metallicReflectanceTexture,v,"METALLIC_REFLECTANCE"),v.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):v.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,u.R)(this._reflectanceTexture,v,"REFLECTANCE"),v.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):v.REFLECTANCE=!1):(v.METALLIC_REFLECTANCE=!1,v.REFLECTANCE=!1),this._microSurfaceTexture?(0,u.R)(this._microSurfaceTexture,v,"MICROSURFACEMAP"):v.MICROSURFACEMAP=!1):(v.REFLECTIVITY=!1,v.MICROSURFACEMAP=!1),Q.getCaps().standardDerivatives&&this._bumpTexture&&L.b.BumpTextureEnabled&&!this._disableBumpMap?((0,u.R)(this._bumpTexture,v,"BUMP"),this._useParallax&&this._albedoTexture&&L.b.DiffuseTextureEnabled?(v.PARALLAX=!0,v.PARALLAX_RHS=I.useRightHandedSystem,v.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):v.PARALLAX=!1,v.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(v.BUMP=!1,v.PARALLAX=!1,v.PARALLAX_RHS=!1,v.PARALLAXOCCLUSION=!1,v.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&L.b.ReflectionTextureEnabled?(v.ENVIRONMENTBRDF=!0,v.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(v.ENVIRONMENTBRDF=!1,v.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?v.ALPHAFROMALBEDO=!0:v.ALPHAFROMALBEDO=!1}v.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===H.LIGHTFALLOFF_STANDARD?(v.USEPHYSICALLIGHTFALLOFF=!1,v.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===H.LIGHTFALLOFF_GLTF?(v.USEPHYSICALLIGHTFALLOFF=!1,v.USEGLTFLIGHTFALLOFF=!0):(v.USEPHYSICALLIGHTFALLOFF=!0,v.USEGLTFLIGHTFALLOFF=!1),v.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.cU&&this._twoSidedLighting?v.TWOSIDEDLIGHTING=!0:v.TWOSIDEDLIGHTING=!1,v.MIRRORED=!!I._mirroredCameraPosition,v.SPECULARAA=Q.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(v._areTexturesDirty||v._areMiscDirty)&&(v.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,v.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,v.ALPHABLEND=this.needAlphaBlendingForMesh(o),v.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,v.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),v._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(v),v.FORCENORMALFORWARD=this._forceNormalForward,v.RADIANCEOCCLUSION=this._useRadianceOcclusion,v.HORIZONOCCLUSION=this._useHorizonOcclusion,v._areMiscDirty&&((0,u.U)(o,I,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(o),v,this._applyDecalMapAfterDetailMap),v.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!o.isVerticesDataPresent(h.e.NormalKind),v.DEBUGMODE=this._debugMode),(0,u.K)(I,Q,this,v,!!V,g,E),this._eventInfo.defines=v,this._eventInfo.mesh=o,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,u.I)(o,v,!0,!0,!0,this._transparencyMode!==H.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(o,v,V){const g={clipPlane:!1,useInstances:!1,...V};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const V=new y(this._eventInfo.defineNames),E=this._prepareEffect(o,V,void 0,void 0,g.useInstances,g.clipPlane,o.hasThinInstances);this._onEffectCreatedObservable&&(z.effect=E,z.subMesh=null,this._onEffectCreatedObservable.notifyObservers(z)),E.isReady()?v&&v(this):E.onCompileObservable.add((()=>{v&&v(this)}))})()}buildUniformLayout(){const o=this._uniformBuffer;o.addUniform("vAlbedoInfos",2),o.addUniform("vBaseWeightInfos",2),o.addUniform("vBaseDiffuseRoughnessInfos",2),o.addUniform("vAmbientInfos",4),o.addUniform("vOpacityInfos",2),o.addUniform("vEmissiveInfos",2),o.addUniform("vLightmapInfos",2),o.addUniform("vReflectivityInfos",3),o.addUniform("vMicroSurfaceSamplerInfos",2),o.addUniform("vReflectionInfos",2),o.addUniform("vReflectionFilteringInfo",2),o.addUniform("vReflectionPosition",3),o.addUniform("vReflectionSize",3),o.addUniform("vBumpInfos",3),o.addUniform("albedoMatrix",16),o.addUniform("baseWeightMatrix",16),o.addUniform("baseDiffuseRoughnessMatrix",16),o.addUniform("ambientMatrix",16),o.addUniform("opacityMatrix",16),o.addUniform("emissiveMatrix",16),o.addUniform("lightmapMatrix",16),o.addUniform("reflectivityMatrix",16),o.addUniform("microSurfaceSamplerMatrix",16),o.addUniform("bumpMatrix",16),o.addUniform("vTangentSpaceParams",2),o.addUniform("reflectionMatrix",16),o.addUniform("vReflectionColor",3),o.addUniform("vAlbedoColor",4),o.addUniform("baseWeight",1),o.addUniform("baseDiffuseRoughness",1),o.addUniform("vLightingIntensity",4),o.addUniform("vReflectionMicrosurfaceInfos",3),o.addUniform("vReflectionDominantDirection",3),o.addUniform("pointSize",1),o.addUniform("vReflectivityColor",4),o.addUniform("vEmissiveColor",3),o.addUniform("vAmbientColor",3),o.addUniform("vDebugMode",2),o.addUniform("vMetallicReflectanceFactors",4),o.addUniform("vMetallicReflectanceInfos",2),o.addUniform("metallicReflectanceMatrix",16),o.addUniform("vReflectanceInfos",2),o.addUniform("reflectanceMatrix",16),o.addUniform("vSphericalL00",3),o.addUniform("vSphericalL1_1",3),o.addUniform("vSphericalL10",3),o.addUniform("vSphericalL11",3),o.addUniform("vSphericalL2_2",3),o.addUniform("vSphericalL2_1",3),o.addUniform("vSphericalL20",3),o.addUniform("vSphericalL21",3),o.addUniform("vSphericalL22",3),o.addUniform("vSphericalX",3),o.addUniform("vSphericalY",3),o.addUniform("vSphericalZ",3),o.addUniform("vSphericalXX_ZZ",3),o.addUniform("vSphericalYY_ZZ",3),o.addUniform("vSphericalZZ",3),o.addUniform("vSphericalXY",3),o.addUniform("vSphericalYZ",3),o.addUniform("vSphericalZX",3),o.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(o,v,V){const g=this.Fo(),E=V.materialDefines;if(!E)return;const I=V.effect;if(!I)return;this._activeEffect=I,v.getMeshUniformBuffer().bindToEffect(I,"Mesh"),v.transferToEffect(o);const Q=g.getEngine();this._uniformBuffer.bindToEffect(I,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,g,v,o,this.isFrozen),w.e.Bind(Q.currentRenderPassId,this._activeEffect,v,o,this);const U=g.activeCamera;U?this._uniformBuffer.updateFloat4("cameraInfo",U.Xg,U.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=V,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),E.OBJECTSPACE_NORMALMAP&&(o.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const O=this._mustRebind(g,I,V,v.visibility);(0,u.c)(v,this._activeEffect,this.prePassConfiguration);let h=null;const x=this._uniformBuffer;if(O){if(this.bindViewProjection(I),h=this._getReflectionTexture(),!x.useUbo||!this.isFrozen||!x.isSync||V._drawWrapper._forceRebindOnNextCall){var f;if(g.texturesEnabled){if(this._albedoTexture&&L.b.DiffuseTextureEnabled&&(x.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,u.o)(this._albedoTexture,x,"albedo")),this._baseWeightTexture&&L.b.BaseWeightTextureEnabled&&(x.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,u.o)(this._baseWeightTexture,x,"baseWeight")),this._baseDiffuseRoughnessTexture&&L.b.BaseDiffuseRoughnessTextureEnabled&&(x.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,u.o)(this._baseDiffuseRoughnessTexture,x,"baseDiffuseRoughness")),this._ambientTexture&&L.b.AmbientTextureEnabled&&(x.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,u.o)(this._ambientTexture,x,"ambient")),this._opacityTexture&&L.b.OpacityTextureEnabled&&(x.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,u.o)(this._opacityTexture,x,"opacity")),h&&L.b.ReflectionTextureEnabled){if(x.Bg("reflectionMatrix",h.getReflectionTextureMatrix()),x.updateFloat2("vReflectionInfos",h.level*g.iblIntensity,0),h.boundingBoxSize){const o=h;x.updateVector3("vReflectionPosition",o.boundingBoxPosition),x.updateVector3("vReflectionSize",o.boundingBoxSize)}if(this.realTimeFiltering){const o=h.getSize().width;x.updateFloat2("vReflectionFilteringInfo",o,Math.log2(o))}if(E.USEIRRADIANCEMAP)E.USEIRRADIANCEMAP&&E.USE_IRRADIANCE_DOMINANT_DIRECTION&&x.updateVector3("vReflectionDominantDirection",h.irradianceTexture._dominantDirection);else{const o=h.sphericalPolynomial;if(E.USESPHERICALFROMREFLECTIONMAP&&o)if(E.SPHERICAL_HARMONICS){const v=o.preScaledHarmonics;x.updateVector3("vSphericalL00",v.l00),x.updateVector3("vSphericalL1_1",v.l1_1),x.updateVector3("vSphericalL10",v.l10),x.updateVector3("vSphericalL11",v.l11),x.updateVector3("vSphericalL2_2",v.l2_2),x.updateVector3("vSphericalL2_1",v.l2_1),x.updateVector3("vSphericalL20",v.l20),x.updateVector3("vSphericalL21",v.l21),x.updateVector3("vSphericalL22",v.l22)}else x.updateFloat3("vSphericalX",o.x.x,o.x.y,o.x.z),x.updateFloat3("vSphericalY",o.y.x,o.y.y,o.y.z),x.updateFloat3("vSphericalZ",o.z.x,o.z.y,o.z.z),x.updateFloat3("vSphericalXX_ZZ",o.xx.x-o.zz.x,o.xx.y-o.zz.y,o.xx.z-o.zz.z),x.updateFloat3("vSphericalYY_ZZ",o.yy.x-o.zz.x,o.yy.y-o.zz.y,o.yy.z-o.zz.z),x.updateFloat3("vSphericalZZ",o.zz.x,o.zz.y,o.zz.z),x.updateFloat3("vSphericalXY",o.xy.x,o.xy.y,o.xy.z),x.updateFloat3("vSphericalYZ",o.yz.x,o.yz.y,o.yz.z),x.updateFloat3("vSphericalZX",o.zx.x,o.zx.y,o.zx.z)}x.updateFloat3("vReflectionMicrosurfaceInfos",h.getSize().width,h.lodGenerationScale,h.lodGenerationOffset)}this._emissiveTexture&&L.b.EmissiveTextureEnabled&&(x.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,u.o)(this._emissiveTexture,x,"emissive")),this._lightmapTexture&&L.b.LightmapTextureEnabled&&(x.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,u.o)(this._lightmapTexture,x,"lightmap")),L.b.SpecularTextureEnabled&&(this._metallicTexture?(x.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,u.o)(this._metallicTexture,x,"reflectivity")):this._reflectivityTexture&&(x.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,u.o)(this._reflectivityTexture,x,"reflectivity")),this._metallicReflectanceTexture&&(x.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,u.o)(this._metallicReflectanceTexture,x,"metallicReflectance")),this._reflectanceTexture&&E.REFLECTANCE&&(x.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,u.o)(this._reflectanceTexture,x,"reflectance")),this._microSurfaceTexture&&(x.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,u.o)(this._microSurfaceTexture,x,"microSurfaceSampler"))),this._bumpTexture&&Q.getCaps().standardDerivatives&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&(x.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,u.o)(this._bumpTexture,x,"bump"),g._mirroredCameraPosition?x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&x.updateFloat("pointSize",this.pointSize),E.METALLICWORKFLOW){var l;c.TmpColors.sU[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,c.TmpColors.sU[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const o=(null===(l=this.subSurface)||void 0===l?void 0:l._indexOfRefraction)??1.5,v=1;c.TmpColors.sU[0].b=o;const V=Math.pow((o-v)/(o+v),2);c.TmpColors.sU[0].a=V,x.updateDirectColor4("vReflectivityColor",c.TmpColors.sU[0]),x.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else x.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);x.updateColor3("vEmissiveColor",L.b.EmissiveTextureEnabled?this._emissiveColor:c.Lv.BlackReadOnly),x.updateColor3("vReflectionColor",this._reflectionColor),!E.SS_REFRACTION&&null!==(f=this.subSurface)&&void 0!==f&&f._linkRefractionWithTransparency?x.updateColor4("vAlbedoColor",this._albedoColor,1):x.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),x.updateFloat("baseWeight",this._baseWeight),x.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*g.environmentIntensity,this._lightingInfos.w=this._specularIntensity,x.updateVector4("vLightingIntensity",this._lightingInfos),g.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),x.updateColor3("vAmbientColor",this._globalAmbientColor),x.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(g.texturesEnabled){if(this._albedoTexture&&L.b.DiffuseTextureEnabled&&x.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&L.b.BaseWeightTextureEnabled&&x.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&L.b.BaseDiffuseRoughnessTextureEnabled&&x.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&L.b.AmbientTextureEnabled&&x.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.b.OpacityTextureEnabled&&x.setTexture("opacitySampler",this._opacityTexture),h&&L.b.ReflectionTextureEnabled){E.LODBASEDMICROSFURACE?x.setTexture("reflectionSampler",h):(x.setTexture("reflectionSampler",h._lodTextureMid||h),x.setTexture("reflectionSamplerLow",h._lodTextureLow||h),x.setTexture("reflectionSamplerHigh",h._lodTextureHigh||h)),E.USEIRRADIANCEMAP&&x.setTexture("irradianceSampler",h.irradianceTexture);const o=this.Fo().iblCdfGenerator;this.realTimeFiltering&&o&&x.setTexture("icdfSampler",o.getIcdfTexture())}E.ENVIRONMENTBRDF&&x.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&L.b.EmissiveTextureEnabled&&x.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.b.LightmapTextureEnabled&&x.setTexture("lightmapSampler",this._lightmapTexture),L.b.SpecularTextureEnabled&&(this._metallicTexture?x.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&x.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&x.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&E.REFLECTANCE&&x.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&x.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&Q.getCaps().standardDerivatives&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&x.setTexture("bumpSampler",this._bumpTexture)}this.Fo().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(v)&&this.Fo().depthPeelingRenderer.bind(I),this._eventInfo.subMesh=V,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,W.c)(this._activeEffect,this,g),this.bindEyePosition(I)}else g.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(O||!this.isFrozen){var S;if(g.lightsEnabled&&!this._disableLighting&&(0,u.h)(g,v,this._activeEffect,E,this._maxSimultaneousLights),(g.fogEnabled&&v.applyFog&&g.fogMode!==n.b.FOGMODE_NONE||h||this.subSurface.refractionTexture||v.receiveShadows||E.PREPASS)&&this.bindView(I),(0,u.e)(g,v,this._activeEffect,!0),E.NUM_MORPH_INFLUENCERS&&(0,u.k)(v,this._activeEffect),E.BAKED_VERTEX_ANIMATION_TEXTURE)null===(S=v.bakedVertexAnimationManager)||void 0===S||S.bind(I,E.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,u.j)(E,this._activeEffect,g)}this._afterBind(v,this._activeEffect,V),x.update()}getAnimatables(){const o=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&o.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&o.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&o.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&o.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&o.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&o.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&o.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?o.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&o.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&o.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&o.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&o.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&o.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&o.push(this._microSurfaceTexture),o}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.Fo().environmentTexture}getActiveTextures(){const o=super.getActiveTextures();return this._albedoTexture&&o.push(this._albedoTexture),this._baseWeightTexture&&o.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&o.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&o.push(this._ambientTexture),this._opacityTexture&&o.push(this._opacityTexture),this._reflectionTexture&&o.push(this._reflectionTexture),this._emissiveTexture&&o.push(this._emissiveTexture),this._reflectivityTexture&&o.push(this._reflectivityTexture),this._metallicTexture&&o.push(this._metallicTexture),this._metallicReflectanceTexture&&o.push(this._metallicReflectanceTexture),this._reflectanceTexture&&o.push(this._reflectanceTexture),this._microSurfaceTexture&&o.push(this._microSurfaceTexture),this._bumpTexture&&o.push(this._bumpTexture),this._lightmapTexture&&o.push(this._lightmapTexture),o}hasTexture(o){return!!super.hasTexture(o)||(this._albedoTexture===o||(this._baseWeightTexture===o||(this._baseDiffuseRoughnessTexture===o||(this._ambientTexture===o||(this._opacityTexture===o||(this._reflectionTexture===o||(this._emissiveTexture===o||(this._reflectivityTexture===o||(this._metallicTexture===o||(this._metallicReflectanceTexture===o||(this._reflectanceTexture===o||(this._microSurfaceTexture===o||(this._bumpTexture===o||this._lightmapTexture===o)))))))))))))}setPrePassRenderer(){var o;if(null===(o=this.subSurface)||void 0===o||!o.isScatteringEnabled)return!1;const v=this.Fo().enableSubSurfaceForPrePass();return v&&(v.enabled=!0),!0}dispose(o,v){var V,g,E,I,Q,U,n,O,h,x,f,l,S,T;(this._breakShaderLoadedCheck=!0,v)&&(this._environmentBRDFTexture&&this.Fo().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(V=this._albedoTexture)||void 0===V||V.dispose(),null===(g=this._baseWeightTexture)||void 0===g||g.dispose(),null===(E=this._baseDiffuseRoughnessTexture)||void 0===E||E.dispose(),null===(I=this._ambientTexture)||void 0===I||I.dispose(),null===(Q=this._opacityTexture)||void 0===Q||Q.dispose(),null===(U=this._reflectionTexture)||void 0===U||U.dispose(),null===(n=this._emissiveTexture)||void 0===n||n.dispose(),null===(O=this._metallicTexture)||void 0===O||O.dispose(),null===(h=this._reflectivityTexture)||void 0===h||h.dispose(),null===(x=this._bumpTexture)||void 0===x||x.dispose(),null===(f=this._lightmapTexture)||void 0===f||f.dispose(),null===(l=this._metallicReflectanceTexture)||void 0===l||l.dispose(),null===(S=this._reflectanceTexture)||void 0===S||S.dispose(),null===(T=this._microSurfaceTexture)||void 0===T||T.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(o,v)}}H.PBRMATERIAL_OPAQUE=j.e.MATERIAL_OPAQUE,H.PBRMATERIAL_ALPHATEST=j.e.MATERIAL_ALPHATEST,H.PBRMATERIAL_ALPHABLEND=j.e.MATERIAL_ALPHABLEND,H.PBRMATERIAL_ALPHATESTANDBLEND=j.e.MATERIAL_ALPHATESTANDBLEND,H.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,H.LIGHTFALLOFF_PHYSICAL=0,H.LIGHTFALLOFF_GLTF=1,H.LIGHTFALLOFF_STANDARD=2,H.ForceGLSL=!1,(0,g.c)([(0,E.s)()],H.prototype,"_imageProcessingConfiguration",void 0),(0,g.c)([(0,E.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"debugMode",void 0)},13011:(o,v,V)=>{V.d(v,{d:()=>x});var g=V(12473),E=V(12479),I=V(13014),Q=V(12547),U=V(13020),n=V(12449),O=V(12829),h=V(12535);class x extends U.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(o){this.subSurface.refractionTexture=o,o?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(o){this.subSurface.indexOfRefraction=o}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(o){this.subSurface.invertRefractionY=o}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(o){this.subSurface.linkRefractionWithTransparency=o,o&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===U.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(o){o!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=o?U.c.LIGHTFALLOFF_PHYSICAL:U.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===U.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(o){o!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=o?U.c.LIGHTFALLOFF_GLTF:U.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(o){this._attachImageProcessingConfiguration(o),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(o){this.imageProcessingConfiguration.colorCurvesEnabled=o}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(o){this.imageProcessingConfiguration.colorGradingEnabled=o}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(o){this._imageProcessingConfiguration.toneMappingEnabled=o}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(o){this._imageProcessingConfiguration.exposure=o}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(o){this._imageProcessingConfiguration.contrast=o}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(o){this._imageProcessingConfiguration.colorGradingTexture=o}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(o){this._imageProcessingConfiguration.colorCurves=o}constructor(o,v){super(o,v,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Q.Lv.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Q.Lv(0,0,0),this.albedoColor=new Q.Lv(1,1,1),this.baseWeight=1,this.reflectivityColor=new Q.Lv(1,1,1),this.reflectionColor=new Q.Lv(1,1,1),this.emissiveColor=new Q.Lv(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,I.e)(this.Fo())}getClassName(){return"PBRMaterial"}clone(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const g=h.c.Clone((()=>new x(o,this.Fo())),this,{cloneTexturesOnlyOnce:v});return g.id=o,g.name=o,this.Rg.copyTo(g.Rg),this._clonePlugins(g,V),g}serialize(){const o=super.serialize();return o.customType="BABYLON.PBRMaterial",o}static Parse(o,v,V){const g=h.c.Parse((()=>new x(o.name,v)),o,v,V);return o.Rg&&g.Rg.parse(o.Rg,v,V),O.e._ParsePlugins(o,g,v,V),o.clearCoat&&g.clearCoat.parse(o.clearCoat,v,V),o.anisotropy&&g.anisotropy.parse(o.anisotropy,v,V),o.brdf&&g.brdf.parse(o.brdf,v,V),o.sheen&&g.sheen.parse(o.sheen,v,V),o.subSurface&&g.subSurface.parse(o.subSurface,v,V),o.iridescence&&g.iridescence.parse(o.iridescence,v,V),g}}x.PBRMATERIAL_OPAQUE=U.c.PBRMATERIAL_OPAQUE,x.PBRMATERIAL_ALPHATEST=U.c.PBRMATERIAL_ALPHATEST,x.PBRMATERIAL_ALPHABLEND=U.c.PBRMATERIAL_ALPHABLEND,x.PBRMATERIAL_ALPHATESTANDBLEND=U.c.PBRMATERIAL_ALPHATESTANDBLEND,x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=U.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"directIntensity",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveIntensity",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentIntensity",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"specularIntensity",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"disableBumpMap",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseWeightTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseDiffuseRoughnessTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureStrength",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"opacityTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallic",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"roughness",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicF0Factor",void 0),(0,g.c)([(0,E.m)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceColor",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectanceTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurfaceTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,g.c)([(0,E.C)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty",null)],x.prototype,"lightmapTexture",void 0),(0,g.c)([(0,E.m)("ambient"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientColor",void 0),(0,g.c)([(0,E.m)("albedo"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoColor",void 0),(0,g.c)([(0,E.K)("baseWeight"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseWeight",void 0),(0,g.c)([(0,E.K)("baseDiffuseRoughness"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseDiffuseRoughness",void 0),(0,g.c)([(0,E.m)("reflectivity"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityColor",void 0),(0,g.c)([(0,E.m)("reflection"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionColor",void 0),(0,g.c)([(0,E.m)("emissive"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveColor",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurface",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLightmapAsShadowmap",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"useAlphaFromAlbedoTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"forceAlphaTest",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"alphaCutOff",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useSpecularOverAlpha",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientInGrayScale",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,g.c)([(0,E.K)()],x.prototype,"usePhysicalLightFalloff",null),(0,g.c)([(0,E.K)()],x.prototype,"useGLTFLightFalloff",null),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOverAlpha",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useObjectSpaceNormalMap",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallax",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallaxOcclusion",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"parallaxScaleBias",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"disableLighting",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceIrradianceInFragment",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"maxSimultaneousLights",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapX",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapY",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"twoSidedLighting",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAlphaFresnel",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLinearAlphaFresnel",void 0),(0,g.c)([(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentBRDFTexture",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceNormalForward",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"enableSpecularAntiAliasing",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useHorizonOcclusion",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOcclusion",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"unlit",void 0),(0,g.c)([(0,E.K)(),(0,E.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"applyDecalMapAfterDetailMap",void 0),(0,n.h)("BABYLON.PBRMaterial",x)},12989:(o,v,V)=>{V.d(v,{e:()=>E});var g=V(12471);class E extends g.e{constructor(o,v,V,E,I){let Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,x=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0;super(null,I,!Q,U,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,h),this.format=E,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==O||(n=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==O||(n=1),this._texture=this._engine.createRawTexture(o,v,V,E,Q,U,n,null,O,h??0,x??!1),this.wrapU=g.e.CLAMP_ADDRESSMODE,this.wrapV=g.e.CLAMP_ADDRESSMODE,this._waitingForData=!!f&&!o)}update(o){this._getEngine().updateRawTexture(this._texture,o,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const o=new E(null,this.getSize().width,this.getSize().height,this.format,this.Fo(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return o._texture=this._texture,this._texture.incrementReferences(),o}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(o,v,V,g){return new E(o,v,V,1,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(o,v,V,g){return new E(o,v,V,2,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(o,v,V,g){return new E(o,v,V,0,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(o,v,V,g){return new E(o,v,V,4,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(o,v,V,g){return new E(o,v,V,5,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(o,v,V,g){return new E(o,v,V,5,g,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(o,v,V,I){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:g.e.TRILINEAR_SAMPLINGMODE;return new E(o,v,V,6,I,Q,U,n,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(o,v,V,I){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:g.e.TRILINEAR_SAMPLINGMODE;return new E(o,v,V,6,I,Q,U,n,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12981:(o,v,V)=>{V.d(v,{e:()=>Q});var g=V(12829),E=V(12538),I=V(12449);class Q extends g.e{get LU(){return this._subMaterials}set LU(o){this._subMaterials=o,this._hookArray(o)}getChildren(){return this.LU}constructor(o,v){super(o,v,!0),this._waitingSubMaterialsUniqueIds=[],this.Fo().addMultiMaterial(this),this.LU=[],this._storeEffectOnSubMeshes=!0}_hookArray(o){var v=this;const V=o.push;o.push=function(){for(var g=arguments.length,E=new Array(g),I=0;I<g;I++)E[I]=arguments[I];const Q=V.apply(o,E);return v._markAllSubMeshesAsTexturesDirty(),Q};const g=o.splice;o.splice=(v,V)=>{const E=g.apply(o,[v,V]);return this._markAllSubMeshesAsTexturesDirty(),E}}getSubMaterial(o){return o<0||o>=this.LU.length?this.Fo().defaultMaterial:this.LU[o]}getActiveTextures(){return super.getActiveTextures().concat(...this.LU.map((o=>o?o.getActiveTextures():[])))}hasTexture(o){if(super.hasTexture(o))return!0;for(let V=0;V<this.LU.length;V++){var v;if(null!==(v=this.LU[V])&&void 0!==v&&v.hasTexture(o))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(o,v,V){for(let g=0;g<this.LU.length;g++){const E=this.LU[g];if(E){if(E._storeEffectOnSubMeshes){if(!E.isReadyForSubMesh(o,v,V))return!1;continue}if(!E.isReady(o))return!1}}return!0}clone(o,v){const V=new Q(o,this.Fo());for(let g=0;g<this.LU.length;g++){let E=null;const I=this.LU[g];E=v&&I?I.clone(o+"-"+I.name):this.LU[g],V.LU.push(E)}return V}serialize(){const o={};o.name=this.name,o.id=this.id,o.uniqueId=this.uniqueId,E.e&&(o.tags=E.e.GetTags(this)),o.materialsUniqueIds=[],o.materials=[];for(let v=0;v<this.LU.length;v++){const V=this.LU[v];V?(o.materialsUniqueIds.push(V.uniqueId),o.materials.push(V.id)):(o.materialsUniqueIds.push(null),o.materials.push(null))}return o}dispose(o,v,V){const g=this.Fo();if(!g)return;if(V)for(let I=0;I<this.LU.length;I++){const V=this.LU[I];V&&V.dispose(o,v)}const E=g.multiMaterials.indexOf(this);E>=0&&g.multiMaterials.splice(E,1),super.dispose(o,v)}static ParseMultiMaterial(o,v){const V=new Q(o.name,v);if(V.id=o.id,V._loadedUniqueId=o.uniqueId,E.e&&E.e.AddTagsTo(V,o.tags),o.materialsUniqueIds)V._waitingSubMaterialsUniqueIds=o.materialsUniqueIds;else for(const g of o.materials)V.LU.push(v.getLastMaterialById(g));return V}}(0,I.h)("BABYLON.MultiMaterial",Q)},13067:(o,v,V)=>{V.d(v,{c:()=>R,g:()=>j});var g=V(12488),E=V(12547),I=V(12958),Q=V(12944),U=V(12308),n=V(12577),O=V(12719),h=V(12497),x=V(12339);class f extends g.Vector2{constructor(o,v){super(o.x,o.y),this.index=v}}class l{constructor(){this.elements=[]}add(o){const v=[];for(const V of o){const o=new f(V,this.elements.length);v.push(o),this.elements.push(o)}return v}computeBounds(){const o=new g.Vector2(this.elements[0].x,this.elements[0].y),v=new g.Vector2(this.elements[0].x,this.elements[0].y);for(const V of this.elements)V.x<o.x?o.x=V.x:V.x>v.x&&(v.x=V.x),V.y<o.y?o.y=V.y:V.y>v.y&&(v.y=V.y);return{min:o,max:v,width:v.x-o.x,height:v.y-o.y}}}class S{_addToepoint(o){for(const v of o)this._epoints.push(v.x,v.y)}constructor(o,v,V){let g,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new l,this._outlinepoints=new l,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=E,this._name=o,this._scene=V||x.d.LastCreatedScene,g=v instanceof O.k?v.getPoints():v,this._addToepoint(g),this._points.add(g),this._outlinepoints.add(g),"undefined"===typeof this.bjsEarcut&&U.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(o){this._points.add(o);const v=new l;return v.add(o),this._holes.push(v),this._eholes.push(this._epoints.length/2),this._addToepoint(o),this}build(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const g=new I.e(this._name,this._scene),E=this.buildVertexData(v,V);return g.zo(n.e.PositionKind,E.Jo,o),g.zo(n.e.NormalKind,E.do,o),g.zo(n.e.UVKind,E.Yo,o),g.setIndices(E.indices),g}buildVertexData(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const V=new Q.d,g=[],E=[],I=[],U=this._points.computeBounds();for(const Q of this._points.elements)g.push(0,1,0),E.push(Q.x,0,Q.y),I.push((Q.x-U.min.x)/U.width,(Q.y-U.min.y)/U.height);const n=[],O=this.bjsEarcut(this._epoints,this._eholes,2);for(let Q=0;Q<O.length;Q++)n.push(O[Q]);if(o>0){const V=E.length/3;for(const v of this._points.elements)g.push(0,-1,0),E.push(v.x,-o,v.y),I.push(1-(v.x-U.min.x)/U.width,1-(v.y-U.min.y)/U.height);const Q=n.length;for(let o=0;o<Q;o+=3){const v=n[o+0],g=n[o+1],E=n[o+2];n.push(E+V),n.push(g+V),n.push(v+V)}this._addSide(E,g,I,n,U,this._outlinepoints,o,!1,v);for(const O of this._holes)this._addSide(E,g,I,n,U,O,o,!0,v)}return V.indices=n,V.Jo=E,V.do=g,V.Yo=I,V}_addSide(o,v,V,E,I,Q,U,n,O){let x=o.length/3,f=0;for(let l=0;l<Q.elements.length;l++){const S=Q.elements[l],T=Q.elements[(l+1)%Q.elements.length];o.push(S.x,0,S.y),o.push(S.x,-U,S.y),o.push(T.x,0,T.y),o.push(T.x,-U,T.y);const c=Q.elements[(l+Q.elements.length-1)%Q.elements.length],R=Q.elements[(l+2)%Q.elements.length];let j=new g.cv(-(T.y-S.y),0,T.x-S.x),t=new g.cv(-(S.y-c.y),0,S.x-c.x),s=new g.cv(-(R.y-T.y),0,R.x-T.x);n||(j=j.scale(-1),t=t.scale(-1),s=s.scale(-1));const L=j.normalizeToNew();let b=t.normalizeToNew(),u=s.normalizeToNew();const mo=g.cv.Dot(b,L);b=mo>O?mo<h.d-1?new g.cv(S.x,0,S.y).Rv(new g.cv(T.x,0,T.y)).normalize():t.add(j).normalize():L;const a=g.cv.Dot(s,j);u=a>O?a<h.d-1?new g.cv(T.x,0,T.y).Rv(new g.cv(S.x,0,S.y)).normalize():s.add(j).normalize():L,V.push(f/I.width,0),V.push(f/I.width,1),f+=j.length(),V.push(f/I.width,0),V.push(f/I.width,1),v.push(b.x,b.y,b.z),v.push(b.x,b.y,b.z),v.push(u.x,u.y,u.z),v.push(u.x,u.y,u.z),n?(E.push(x),E.push(x+2),E.push(x+1),E.push(x+1),E.push(x+2),E.push(x+3)):(E.push(x),E.push(x+1),E.push(x+2),E.push(x+1),E.push(x+3),E.push(x+2)),x+=4}}}var T=V(12564);function c(o,v,V,I,U,O,h){const x=V||new Array(3),f=I,l=[],S=h||!1;for(let Q=0;Q<3;Q++)void 0===x[Q]&&(x[Q]=new g.Vector4(0,0,1,1)),f&&void 0===f[Q]&&(f[Q]=new E.sU(1,1,1,1));const c=o.getVerticesData(n.e.PositionKind),R=o.getVerticesData(n.e.NormalKind),j=o.getVerticesData(n.e.UVKind),t=o.QQ(),s=c.length/9;let L=0,b=0,u=0,mo=0,a=0;const F=[0];if(S)for(let g=s;g<c.length/3;g+=4)b=c[3*(g+2)]-c[3*g],u=c[3*(g+2)+2]-c[3*g+2],mo=Math.sqrt(b*b+u*u),a+=mo,F.push(a);let i=0,J=0;for(let g=0;g<R.length;g+=3)Math.abs(R[g+1])<.001&&(J=1),Math.abs(R[g+1]-1)<.001&&(J=0),Math.abs(R[g+1]+1)<.001&&(J=2),i=g/3,1===J?(L=i-s,j[2*i]=L%4<1.5?S?x[J].x+(x[J].z-x[J].x)*F[Math.floor(L/4)]/a:x[J].x:S?x[J].x+(x[J].z-x[J].x)*F[Math.floor(L/4)+1]/a:x[J].z,j[2*i+1]=L%2===0?T.e?1-x[J].w:x[J].w:T.e?1-x[J].y:x[J].y):(j[2*i]=(1-j[2*i])*x[J].x+j[2*i]*x[J].z,j[2*i+1]=(1-j[2*i+1])*x[J].y+j[2*i+1]*x[J].w,T.e&&(j[2*i+1]=1-j[2*i+1])),f&&l.push(f[J].r,f[J].g,f[J].b,f[J].a);Q.d._ComputeSides(v,c,t,R,j,U,O);const d=new Q.d;if(d.indices=t,d.Jo=c,d.do=R,d.Yo=j,f){const o=v===Q.d.DOUBLESIDE?l.concat(l):l;d.No=o}return d}function R(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;v.sideOrientation=I.e._GetDefaultSideOrientation(v.sideOrientation);const Q=v.shape,U=v.holes||[],n=v.depth||0,O=v.smoothingThreshold||2,h=[];let f=[];for(let I=0;I<Q.length;I++)h[I]=new g.Vector2(Q[I].x,Q[I].z);h[0].equalsWithEpsilon(h[h.length-1],1e-8)&&h.pop();const l=new S(o,h,V||x.d.LastCreatedScene,E);for(let I=0;I<U.length;I++){f=[];for(let o=0;o<U[I].length;o++)f.push(new g.Vector2(U[I][o].x,U[I][o].z));l.addHole(f)}const T=l.build(!1,n,O);T._originalBuilderSideOrientation=v.sideOrientation;return c(T,v.sideOrientation,v.faceUV,v.faceColors,v.frontUVs,v.backUVs,v.wrap).Po(T,v.updatable),T}function j(o,v){return R(o,v,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}Q.d.CreatePolygon=c,I.e.CreatePolygon=function(o,v,V,g,E,I){return R(o,{shape:v,holes:g,updatable:E,sideOrientation:I},V,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},I.e.ExtrudePolygon=function(o,v,V,g,E,I,Q){return j(o,{shape:v,holes:E,depth:V,updatable:I,sideOrientation:Q},g,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},13058:(o,v,V)=>{V.d(v,{c:()=>h,g:()=>x});var g=V(12719),E=V(12488),I=V(12958),Q=V(12928),U=V(13067);class n{constructor(o){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=o}moveTo(o,v){this._currentPath=new g.k(o,v),this._tempPaths.push(this._currentPath)}lineTo(o,v){this._currentPath.addLineTo(o,v)}quadraticCurveTo(o,v,V,g){this._currentPath.addQuadraticCurveTo(o,v,V,g,this._resolution)}bezierCurveTo(o,v,V,g,E,I){this._currentPath.addBezierCurveTo(o,v,V,g,E,I,this._resolution)}extractHoles(){for(const o of this._tempPaths)o.area()>0?this._holes.push(o):this._paths.push(o);if(!this._paths.length&&this._holes.length){const o=this._holes;this._holes=this._paths,this._paths=o}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function O(o,v,V,g,E,I){const Q=I.glyphs[o]||I.glyphs["?"];if(!Q)return null;const U=new n(E);if(Q.o){const o=Q.o.split(" ");for(let E=0,I=o.length;E<I;){switch(o[E++]){case"m":{const I=parseInt(o[E++])*v+V,Q=parseInt(o[E++])*v+g;U.moveTo(I,Q);break}case"l":{const I=parseInt(o[E++])*v+V,Q=parseInt(o[E++])*v+g;U.lineTo(I,Q);break}case"q":{const I=parseInt(o[E++])*v+V,Q=parseInt(o[E++])*v+g,n=parseInt(o[E++])*v+V,O=parseInt(o[E++])*v+g;U.quadraticCurveTo(n,O,I,Q);break}case"b":{const I=parseInt(o[E++])*v+V,Q=parseInt(o[E++])*v+g,n=parseInt(o[E++])*v+V,O=parseInt(o[E++])*v+g,h=parseInt(o[E++])*v+V,x=parseInt(o[E++])*v+g;U.bezierCurveTo(n,O,h,x,I,Q);break}}}}return U.extractHoles(),{offsetX:Q.ha*v,shapePath:U}}function h(o,v,V,g){const E=Array.from(o),I=v/g.resolution,Q=(g.boundingBox.yMax-g.boundingBox.yMin+g.underlineThickness)*I,U=[];let n=0,h=0;for(let x=0;x<E.length;x++){const o=E[x];if("\n"===o)n=0,h-=Q;else{const v=O(o,I,n,h,V,g);v&&(n+=v.offsetX,U.push(v.shapePath))}}return U}function x(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const x=h(v,g.size||50,g.resolution||8,V),f=[];let l=0;for(const Q of x){if(!Q.paths.length)continue;const v=Q.holes.slice();for(const V of Q.paths){var S,T;const Q=[],h=[],x=V.getPoints();for(const o of x)h.push(new E.cv(o.x,0,o.y));const c=v.slice();for(const o of c){const g=o.getPoints();let I=!1;for(const o of g)if(V.isPointInside(o)){I=!0;break}if(!I)continue;const U=[];for(const o of g)U.push(new E.cv(o.x,0,o.y));Q.push(U),v.splice(v.indexOf(o),1)}if(!Q.length&&v.length)for(const o of v){const v=o.getPoints(),V=[];for(const o of v)V.push(new E.cv(o.x,0,o.y));Q.push(V)}const R=(0,U.g)(o,{shape:h,holes:Q.length?Q:void 0,depth:g.depth||1,faceUV:g.faceUV||(null===(S=g.perLetterFaceUV)||void 0===S?void 0:S.call(g,l)),faceColors:g.faceColors||(null===(T=g.perLetterFaceColors)||void 0===T?void 0:T.call(g,l)),sideOrientation:I.e._GetDefaultSideOrientation(g.sideOrientation||I.e.DOUBLESIDE)},n,O);f.push(R),l++}}const c=I.e.MergeMeshes(f,!0,!0);if(c){const v=c.getBoundingInfo().boundingBox;c.position.x+=-(v.minimumWorld.x+v.maximumWorld.x)/2,c.position.y+=-(v.minimumWorld.y+v.maximumWorld.y)/2,c.position.z+=-(v.minimumWorld.z+v.maximumWorld.z)/2+v.extendSize.z,c.name=o;const V=new Q.b("pivot",n);V.rotation.x=-Math.PI/2,c.parent=V,c.bakeCurrentTransformIntoVertices(),c.parent=null,V.dispose()}return c}},13077:(o,v,V)=>{V.d(v,{b:()=>n,d:()=>Q,f:()=>U});var g=V(12291),E=V(13085),I=V(13091);function Q(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function U(o){return!!(o.wasmUrl&&(o.wasmBinary||o.wasmBinaryUrl)&&"object"===typeof WebAssembly||o.fallbackUrl)}class n{constructor(o){if(o.workerPool)return void(this._workerPoolPromise=Promise.resolve(o.workerPool));const v=o.wasmBinary,V=o.numWorkers??Q(),U=V&&"function"===typeof Worker&&"function"===typeof URL,n=U||!o.jsModule,O=o.wasmUrl&&o.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:n?g.Tools.GetBabylonScriptURL(o.wasmUrl,!0):"",wasmBinaryPromise:v?Promise.resolve(v):g.Tools.LoadFileAsync(g.Tools.GetBabylonScriptURL(o.wasmBinaryUrl,!0))}:{url:n?g.Tools.GetBabylonScriptURL(o.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};U?this._workerPoolPromise=O.wasmBinaryPromise.then((o=>{const v=this._getWorkerContent(),g=URL.createObjectURL(new Blob([v],{type:"application/javascript"}));return new E.b(V,(()=>{const v=new Worker(g);return(0,I.n)(v,o,O.url)}))})):this._modulePromise=O.wasmBinaryPromise.then((async v=>{if(!this._isModuleAvailable()&&!o.jsModule){if(!O.url)throw new Error("Draco codec module is not available");await g.Tools.LoadBabylonScriptAsync(O.url)}return await this._createModuleAsync(v,o.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((o=>{o.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},13091:(o,v,V)=>{function g(o,v,V,g){const E=o;let I=null,Q=null,U=null,n=null;const O={},h=v.find((o=>"POSITION"===o.dracoName));if(!h)throw new Error("Position attribute is required for Draco encoding");if(!V){const o=h.data.length/h.size;V=new(o>65535?Uint32Array:Uint16Array)(o);for(let v=0;v<o;v++)V[v]=v}try{I=new E.Encoder,Q=new E.MeshBuilder,U=new E.Mesh,Q.AddFacesToMesh(U,V.length/3,V);const o=new Map([[Float32Array,(o,v,V,g,E,I)=>o.AddFloatAttribute(v,V,g,E,I)],[Uint32Array,(o,v,V,g,E,I)=>o.AddUInt32Attribute(v,V,g,E,I)],[Uint16Array,(o,v,V,g,E,I)=>o.AddUInt16Attribute(v,V,g,E,I)],[Uint8Array,(o,v,V,g,E,I)=>o.AddUInt8Attribute(v,V,g,E,I)],[Int32Array,(o,v,V,g,E,I)=>o.AddInt32Attribute(v,V,g,E,I)],[Int16Array,(o,v,V,g,E,I)=>o.AddInt16Attribute(v,V,g,E,I)],[Int8Array,(o,v,V,g,E,I)=>o.AddInt8Attribute(v,V,g,E,I)]]);for(const V of v){V.data instanceof Uint8ClampedArray&&(V.data=new Uint8Array(V.data));const v=o.get(V.data.constructor),n=V.data.length/V.size;O[V.kind]=v(Q,U,E[V.dracoName],n,V.size,V.data),g.quantizationBits&&g.quantizationBits[V.dracoName]&&I.SetAttributeQuantization(E[V.dracoName],g.quantizationBits[V.dracoName])}g.method&&I.SetEncodingMethod(E[g.method]),void 0!==g.encodeSpeed&&void 0!==g.decodeSpeed&&I.SetSpeedOptions(g.encodeSpeed,g.decodeSpeed),n=new E.DracoInt8Array;const h=I.EncodeMeshToDracoBuffer(U,n);if(h<=0)throw new Error("Draco encoding failed.");const x=new Int8Array(h);for(let v=0;v<h;v++)x[v]=n.GetValue(v);return{data:x,attributeIds:O}}finally{U&&E.destroy(U),Q&&E.destroy(Q),I&&E.destroy(I),n&&E.destroy(n)}}function E(){let o;onmessage=v=>{const V=v.data;switch(V.id){case"init":{V.url&&importScripts(V.url);const v=V.wasmBinary?{wasmBinary:V.wasmBinary}:{};o=DracoEncoderModule(v),postMessage({id:"initDone"});break}case"encodeMesh":if(!o)throw new Error("Draco encoder module is not available");o.then((o=>{const v=g(o,V.attributes,V.indices,V.options);postMessage({id:"encodeMeshDone",encodedMeshData:v},v?[v.data.buffer]:void 0)}))}}}function I(o,v,V,g,E){const I=o;let Q=null,U=null,n=null;try{let o;Q=new I.Decoder,U=new I.DecoderBuffer,U.Init(v,v.byteLength);const O=Q.GetEncodedGeometryType(U);switch(O){case I.TRIANGULAR_MESH:{const v=new I.Mesh;if(o=Q.DecodeBufferToMesh(U,v),!o.ok()||0===v.ptr)throw new Error(o.error_msg());const V=3*v.num_faces(),E=4*V,O=I._malloc(E);try{Q.GetTrianglesUInt32Array(v,E,O);const o=new Uint32Array(V);o.set(new Uint32Array(I.HEAPF32.buffer,O,V)),g(o)}finally{I._free(O)}n=v;break}case I.POINT_CLOUD:{const v=new I.PointCloud;if(o=Q.DecodeBufferToPointCloud(U,v),!o.ok()||!v.ptr)throw new Error(o.error_msg());n=v;break}default:throw new Error(`Invalid geometry type ${O}`)}const h=n.num_points(),x=(o,v,V,g)=>{const Q=g.data_type(),U=g.num_components(),n=g.normalized(),O=g.byte_stride(),x=g.byte_offset(),f={[I.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:I.HEAPF32},[I.DT_INT8]:{typedArrayConstructor:Int8Array,heap:I.HEAP8},[I.DT_INT16]:{typedArrayConstructor:Int16Array,heap:I.HEAP16},[I.DT_INT32]:{typedArrayConstructor:Int32Array,heap:I.HEAP32},[I.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:I.HEAPU8},[I.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:I.HEAPU16},[I.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:I.HEAPU32}}[Q];if(!f)throw new Error(`Invalid data type ${Q}`);const l=h*U,S=l*f.typedArrayConstructor.BYTES_PER_ELEMENT,T=I._malloc(S);try{o.GetAttributeDataArrayForAllPoints(v,g,Q,S,T);const I=new f.typedArrayConstructor(f.heap.buffer,T,l);E(V,I.slice(),U,x,O,n)}finally{I._free(T)}};if(V)for(const v in V){const o=V[v],g=Q.GetAttributeByUniqueId(n,o);x(Q,n,v,g)}else{const o={position:I.POSITION,normal:I.NORMAL,color:I.COLOR,uv:I.TEX_COORD};for(const v in o){const V=Q.GetAttributeId(n,o[v]);if(-1!==V){const o=Q.GetAttribute(n,V);x(Q,n,v,o)}}}return h}finally{n&&I.destroy(n),U&&I.destroy(U),Q&&I.destroy(Q)}}function Q(){let o;onmessage=v=>{const V=v.data;switch(V.id){case"init":{V.url&&importScripts(V.url);const v=V.wasmBinary?{wasmBinary:V.wasmBinary}:{};o=DracoDecoderModule(v),postMessage({id:"initDone"});break}case"decodeMesh":if(!o)throw new Error("Draco decoder module is not available");o.then((o=>{const v=I(o,V.dataView,V.attributes,(o=>{postMessage({id:"indices",data:o},[o.buffer])}),((o,v,V,g,E,I)=>{postMessage({id:"attribute",kind:o,data:v,size:V,byteOffset:g,byteStride:E,normalized:I},[v.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:v})}))}}}async function U(o,v,V){return await new Promise(((g,E)=>{const I=v=>{o.removeEventListener("error",I),o.removeEventListener("message",Q),E(v)},Q=v=>{"initDone"===v.data.id&&(o.removeEventListener("error",I),o.removeEventListener("message",Q),g(o))};if(o.addEventListener("error",I),o.addEventListener("message",Q),v){const g=v.slice(0);o.postMessage({id:"init",url:V,wasmBinary:g},[g])}else o.postMessage({id:"init",url:V})}))}V.d(v,{b:()=>I,c:()=>Q,g:()=>g,j:()=>E,n:()=>U})},12936:(o,v,V)=>{V.d(v,{d:()=>u});var g=V(12473),E=V(12297),I=V(12488),Q=V(12577),U=V(12944),n=V(12928),O=V(12774),h=V(12852),x=V(12766);class f{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new I.cv(0,0,0),this._diffPositionForCollisions=new I.cv(0,0,0),this._collisionResponse=!0}}var l=V(12325),S=V(12870),T=V(12547),c=V(12497),R=V(12706),j=V(12449),t=V(12479),s=V(12381);class L{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=I.cv.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class b{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new L,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new f,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class u extends n.b{static get BILLBOARDMODE_NONE(){return n.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return n.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return n.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return n.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return n.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return n.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(o){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=o}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(o){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=o}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(o){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=o}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(o){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=o}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(o){this._internalAbstractMeshDataInfo._collisionRetryCount=o}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(o){this._internalAbstractMeshDataInfo._morphTargetManager!==o&&(this._internalAbstractMeshDataInfo._morphTargetManager=o,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(o){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==o&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=o,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(o){return!!super._updateNonUniformScalingState(o)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(o){this._internalAbstractMeshDataInfo._rawBoundingInfo=o}set ES(o){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(o)}set onCollisionPositionChange(o){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(o)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(o){if(this._internalAbstractMeshDataInfo._visibility===o)return;const v=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=o,(1===v&&1!==o||1!==v&&1===o)&&this._markSubMeshesAsDirty((o=>{o.markAsMiscDirty(),o.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(o){this._internalAbstractMeshDataInfo._inheritVisibility=o}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let o=this._parentNode;for(;o;){const v=o.isVisible;if("undefined"!==typeof v)return v;o=o.parent}}return this._isVisible}set isVisible(o){this._isVisible=o}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(o){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=o}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(o){this._internalAbstractMeshDataInfo._renderingGroupId=o}get material(){return this._internalAbstractMeshDataInfo._material}set material(o){this._setMaterial(o)}_setMaterial(o){this._internalAbstractMeshDataInfo._material!==o&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=o,o&&o.meshMap&&(o.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.wg&&(this.resetDrawCache(void 0,null==o),this._unBindEffect()))}getMaterialForRenderPass(o){var v;return null===(v=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===v?void 0:v[o]}setMaterialForRenderPass(o,v){var V;this.resetDrawCache(o),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const g=this._internalAbstractMeshDataInfo._materialForRenderPass[o];null!==g&&void 0!==g&&null!==(V=g.meshMap)&&void 0!==V&&V[this.uniqueId]&&(g.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[o]=v,v&&v.meshMap&&(v.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(o){this._internalAbstractMeshDataInfo._receiveShadows!==o&&(this._internalAbstractMeshDataInfo._receiveShadows=o,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(o){this._internalAbstractMeshDataInfo._hasVertexAlpha!==o&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=o,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(o){this._internalAbstractMeshDataInfo._useVertexColors!==o&&(this._internalAbstractMeshDataInfo._useVertexColors=o,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(o){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==o&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=o,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(o){this._internalAbstractMeshDataInfo._numBoneInfluencers!==o&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=o,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(o){this._internalAbstractMeshDataInfo._applyFog!==o&&(this._internalAbstractMeshDataInfo._applyFog=o,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(o){this._internalAbstractMeshDataInfo._enableDistantPicking=o}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(o){o!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=o,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(o){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(o)?-1:o}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(o){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=o}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(o){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(o)?-1:o}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(o){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=o}get lightSources(){return this._lightSources}set skeleton(o){const v=this._internalAbstractMeshDataInfo._skeleton;v&&v.needInitialSkinMatrix&&v._unregisterMeshWithPoseMatrix(this),o&&o.needInitialSkinMatrix&&o._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=o,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(o){var v;let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(o,V,!1),v=this,this._internalAbstractMeshDataInfo=new b,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.wx=u.zx,this.onCollideObservable=new E.e,this.onCollisionPositionChangeObservable=new E.e,this.onMaterialChangedObservable=new E.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.wn=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=T.Lv.Red(),this.outlineWidth=.02,this.overlayColor=T.Lv.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.WO=!1,this.Mo=!1,this.actionManager=null,this.ellipsoid=new I.cv(.5,1,.5),this.ellipsoidOffset=new I.cv(0,0,0),this.edgesWidth=1,this.edgesColor=new T.sU(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,dU:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new E.e,this._onCollisionPositionChange=function(o,V){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.subtractToRef(v._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>s.c.CollisionsEpsilon&&v.position.addInPlace(v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),g&&v.onCollideObservable.notifyObservers(g),v.onCollisionPositionChangeObservable.notifyObservers(v.position)},V=this.Fo(),V.Vh(this),this._resyncLightSources(),this._uniformBuffer=new x.e(this.Fo().getEngine(),void 0,void 0,o,!this.Fo().getEngine().isWebGPU),this._buildUniformLayout(),V.performancePriority){case 2:this.Mo=!0;case 1:this.WO=!0,this.wn=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(o){const v=this._uniformBuffer;v.Bg("world",o),v.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),v.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(o){let v="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");v+=", # of submeshes: "+(this.wg?this.wg.length:0);const V=this._internalAbstractMeshDataInfo._skeleton;return V&&(v+=", skeleton: "+V.name),o&&(v+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],v+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.dU?"YES":"NO")),v}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==n.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(v||this.actionManager.isRecursive)){if(!o)return this.actionManager;if(this.actionManager.hasSpecificTrigger(o))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(o,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.wg){for(const o of this.wg)o._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const o of this.Fo().lights)o.isEnabled()&&o.canAffectMesh(this)&&this._lightSources.push(o);this._markSubMeshesAsLightDirty()}_resyncLightSource(o){const v=o.isEnabled()&&o.canAffectMesh(this),V=this._lightSources.indexOf(o);let g=!1;if(-1===V){if(!v)return;this._lightSources.push(o)}else{if(v)return;g=!0,this._lightSources.splice(V,1)}this._markSubMeshesAsLightDirty(g)}_unBindEffect(){for(const o of this.wg)o.setEffect(null)}_removeLightSource(o,v){const V=this._lightSources.indexOf(o);-1!==V&&(this._lightSources.splice(V,1),this._markSubMeshesAsLightDirty(v))}_markSubMeshesAsDirty(o){if(this.wg)for(const v of this.wg)for(let V=0;V<v._drawWrappers.length;++V){const g=v._drawWrappers[V];g&&g.defines&&g.defines.markAllAsDirty&&o(g.defines)}}_markSubMeshesAsLightDirty(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((v=>v.markAsLightDirty(o)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((o=>o.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((o=>o.markAsMiscDirty()))}eO(o){return this._currentRenderId=Number.MAX_VALUE,super.eO(o),this._isDirty=!0,this}resetDrawCache(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.wg)for(const V of this.wg)V.resetDrawCache(o,v)}get isBlocked(){return!1}getLOD(o){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}QQ(){return null}getVerticesData(o){return null}zo(o,v,V,g){return this}updateVerticesData(o,v,V,g){return this}setIndices(o,v){return this}isVerticesDataPresent(o){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Wo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(o){return this._boundingInfo=o,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(o,v,V){return this._boundingInfo=new h.c(o,v,V),this._boundingInfo}normalizeToUnitCube(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(o,v,V)}get useBones(){return this.skeleton&&this.Fo().skeletonsEnabled&&this.isVerticesDataPresent(Q.e.MatricesIndicesKind)&&this.isVerticesDataPresent(Q.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(o){}_activate(o,v){return this._renderId=o,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===n.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(o,v,V){return this.position.addInPlace(this.calcMovePOV(o,v,V)),this}calcMovePOV(o,v,V){const g=new I.Matrix;(this.rotationQuaternion?this.rotationQuaternion:I.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(g);const E=I.cv.Zero(),Q=this.definedFacingForward?-1:1;return I.cv.TransformCoordinatesFromFloatsToRef(o*Q,v,V*Q,g,E),E}rotatePOV(o,v,V){return this.rotation.addInPlace(this.calcRotatePOV(o,v,V)),this}calcRotatePOV(o,v,V){const g=this.definedFacingForward?1:-1;return new I.cv(o*g,v,V*g)}wo(o,v){if(o){const V=(0,S.c)(o,0,this.getTotalVertices(),v);this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new h.c(V.minimum,V.maximum)}if(this.wg)for(let V=0;V<this.wg.length;V++)this.wg[V].refreshBoundingInfo(o);this.Wo()}_refreshBoundingInfoDirect(o){if(this._boundingInfo?this._boundingInfo.reConstruct(o.minimum,o.maximum):this._boundingInfo=new h.c(o.minimum,o.maximum),this.wg)for(let v=0;v<this.wg.length;v++)this.wg[v].refreshBoundingInfo(null);this.Wo()}static _ApplySkeleton(o,v,V,g,E,U,n){!function(o,v,V,g,E,U,n){const O=I.TmpVectors.cv[0],h=I.TmpVectors.Matrix[0],x=I.TmpVectors.Matrix[1],f=v===Q.e.NormalKind?I.cv.TransformNormalFromFloatsToRef:I.cv.TransformCoordinatesFromFloatsToRef;for(let Q=0,l=0;Q<o.length;Q+=3,l+=4){let v,S;for(h.reset(),v=0;v<4;v++)S=E[l+v],S>0&&(I.Matrix.FromFloat32ArrayToRefScaled(V,Math.floor(16*g[l+v]),S,x),h.addToSelf(x));if(U&&n)for(v=0;v<4;v++)S=n[l+v],S>0&&(I.Matrix.FromFloat32ArrayToRefScaled(V,Math.floor(16*U[l+v]),S,x),h.addToSelf(x));f(o[Q],o[Q+1],o[Q+2],h,O),O.toArray(o,Q)}}(o,v,V,g,E,U,n)}_getData(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.e.PositionKind;const g=o.cache,E=o=>{if(g){const v=g._vertexData||(g._vertexData={});return v[o]||this.copyVerticesData(o,v),v[o]}return this.getVerticesData(o)};if(v||(v=E(V)),!v)return null;if(g?(g._outputData?g._outputData.set(v):g._outputData=new Float32Array(v),v=g._outputData):(o.applyMorph&&this.morphTargetManager||o.applySkeleton&&this.skeleton)&&(v=v.slice()),o.applyMorph&&this.morphTargetManager&&function(o,v,V){let g=null;switch(v){case Q.e.PositionKind:g=o=>o.getPositions();break;case Q.e.NormalKind:g=o=>o.getNormals();break;case Q.e.TangentKind:g=o=>o.getTangents();break;case Q.e.UVKind:g=o=>o.getUVs();break;case Q.e.UV2Kind:g=o=>o.getUV2s();break;case Q.e.ColorKind:g=o=>o.getColors();break;default:return}for(let E=0;E<o.length;E++){let v=o[E];for(let I=0;I<V.numTargets;I++){const Q=V.getTarget(I),U=Q.influence;if(0!==U){const V=g(Q);V&&(v+=(V[E]-o[E])*U)}}o[E]=v}}(v,V,this.morphTargetManager),o.applySkeleton&&this.skeleton){const o=E(Q.e.MatricesIndicesKind),g=E(Q.e.MatricesWeightsKind);if(g&&o){const I=this.numBoneInfluencers>4,U=I?E(Q.e.MatricesIndicesExtraKind):null,n=I?E(Q.e.MatricesWeightsExtraKind):null,O=this.skeleton.getTransformMatrices(this);u._ApplySkeleton(v,V,O,o,g,U,n)}}if(!1!==o.updatePositionsArray&&V===Q.e.PositionKind){const o=this._internalAbstractMeshDataInfo._positions||[],V=o.length;if(o.length=v.length/3,V<o.length)for(let v=V;v<o.length;v++)o[v]=new I.cv;for(let g=0,E=0;g<o.length;g++,E+=3)o[g].RU(v[E],v[E+1],v[E+2]);this._internalAbstractMeshDataInfo._positions=o}return v}getNormalsData(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:o,applyMorph:v,updatePositionsArray:!1},null,Q.e.NormalKind)}qU(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:o,applyMorph:v,updatePositionsArray:!1},V,Q.e.PositionKind)}Wo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new h.c(I.cv.Zero(),I.cv.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(o){if(!this.wg)return this;const v=this.wg.length;for(let V=0;V<v;V++){const g=this.wg[V];(v>1||!g.IsGlobal)&&g.updateBoundingInfo(o)}return this}_afterComputeWorldMatrix(){this.Mo||(this._boundingInfoIsDirty=!0)}isInFrustum(o){return this.getBoundingInfo().isInFrustum(o,this.wx)}isCompletelyInFrustum(o){return this.getBoundingInfo().isCompletelyInFrustum(o)}intersectsMesh(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;const g=this.getBoundingInfo(),E=o.getBoundingInfo();if(g.intersects(E,v))return!0;if(V)for(const I of this.getChildMeshes())if(I.intersectsMesh(o,v,!0))return!0;return!1}intersectsPoint(o){return this.getBoundingInfo().intersectsPoint(o)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(o){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=o}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const V=this.Fo().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=V.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,V.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,o,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,v),this}_collideForSubMesh(o,v,V){var g;if(this._generatePointsArray(),!this._positions)return this;if(!o._lastColliderWorldVertices||!o._lastColliderTransformMatrix.equals(v)){o._lastColliderTransformMatrix=v.clone(),o._lastColliderWorldVertices=[],o._trianglePlanes=[];const V=o.verticesStart,g=o.verticesStart+o.verticesCount;for(let E=V;E<g;E++)o._lastColliderWorldVertices.push(I.cv.TransformCoordinates(this._positions[E],v))}return V._collide(o._trianglePlanes,o._lastColliderWorldVertices,this.QQ(),o.indexStart,o.indexStart+o.indexCount,o.verticesStart,!!o.yo(),this,this._shouldConvertRHS(),7===(null===(g=o.yo())||void 0===g?void 0:g.fillMode)),this}_processCollisionsForSubMeshes(o,v){const V=this._scene.getCollidingSubMeshCandidates(this,o),g=V.length;for(let E=0;E<g;E++){const I=V.data[E];g>1&&!I._checkCollision(o)||this._collideForSubMesh(I,v,o)}return this}_shouldConvertRHS(){return!1}_checkCollision(o){if(!this.getBoundingInfo()._checkCollision(o))return this;const v=I.TmpVectors.Matrix[0],V=I.TmpVectors.Matrix[1];return I.Matrix.ScalingToRef(1/o._radius.x,1/o._radius.y,1/o._radius.z,v),this.worldMatrixFromCache.multiplyToRef(v,V),this._processCollisionsForSubMeshes(o,V),this}_generatePointsArray(){return!1}intersects(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=new O.e,n=this.getClassName(),h="InstancedLinesMesh"===n||"LinesMesh"===n||"GreasedLineMesh"===n?this.intersectionThreshold:0,x=this.getBoundingInfo();if(!this.wg)return U;if(!Q&&(!o.intersectsSphere(x.boundingSphere,h)||!o.intersectsBox(x.boundingBox,h)))return U;if(g)return U.hit=!Q,U.pickedMesh=Q?null:this,U.distance=Q?0:I.cv.Distance(o.origin,x.boundingSphere.center),U.subMeshId=0,U;if(!this._generatePointsArray())return U;let f=null;const l=this._scene.getIntersectingSubMeshCandidates(this,o),S=l.length;let T=!1;for(let I=0;I<S;I++){const o=l.data[I].yo();if(o&&(7==o.fillMode||0==o.fillMode||1==o.fillMode||2==o.fillMode||4==o.fillMode)){T=!0;break}}if(!T)return U.hit=!0,U.pickedMesh=this,U.distance=I.cv.Distance(o.origin,x.boundingSphere.center),U.subMeshId=-1,U;for(let I=0;I<S;I++){const g=l.data[I];if(S>1&&!Q&&!g.canIntersects(o))continue;const E=g.intersects(o,this._positions,this.QQ(),v,V);if(E&&(v||!f||E.distance<f.distance)&&(f=E,f.subMeshId=I,v))break}if(f){const v=E??this.getWorldMatrix(),V=I.TmpVectors.cv[0],g=I.TmpVectors.cv[1];I.cv.TransformCoordinatesToRef(o.origin,v,V),o.direction.scaleToRef(f.distance,g);const Q=I.cv.TransformNormal(g,v).addInPlace(V);return U.hit=!0,U.distance=I.cv.Distance(V,Q),U.pickedPoint=Q,U.pickedMesh=this,U.bu=f.bu||0,U.bv=f.bv||0,U.subMeshFaceId=f.faceId,U.faceId=f.faceId+l.data[f.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),U.subMeshId=f.subMeshId,U}return U}clone(o,v,V){return null}releaseSubMeshes(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.wg)for(;this.wg.length;)this.wg[0].dispose(o);else this.wg=[];return this}dispose(o){let v,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const g=this.Fo();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),g.freeActiveMeshes(),g.freeRenderingGroups(),g.renderingManager.maintainStateBetweenFrames&&g.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((o=>o!==this&&o.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),v=0;v<this._intersectionsInProgress.length;v++){const o=this._intersectionsInProgress[v],V=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(V,1)}this._intersectionsInProgress.length=0;const E=g.lights;for(const Q of E){let o=Q.includedOnlyMeshes.indexOf(this);-1!==o&&Q.includedOnlyMeshes.splice(o,1),o=Q.excludedMeshes.indexOf(this),-1!==o&&Q.excludedMeshes.splice(o,1);const v=Q.getShadowGenerators();if(v){const V=v.values();for(let v=V.next();!0!==v.done;v=V.next()){const V=v.value.getShadowMap();V&&V.renderList&&(o=V.renderList.indexOf(this),-1!==o&&V.renderList.splice(o,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const I=g.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,I.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),I.wipeCaches(),g.oh(this),this._parentContainer){const o=this._parentContainer.meshes.indexOf(this);o>-1&&this._parentContainer.meshes.splice(o,1),this._parentContainer=null}if(V&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!o)for(v=0;v<g.Mf.length;v++)g.Mf[v].lo===this&&(g.Mf[v].dispose(),v--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(o,V)}_initFacetData(){const o=this._internalAbstractMeshDataInfo._facetData;o.facetNormals||(o.facetNormals=[]),o.facetPositions||(o.facetPositions=[]),o.facetPartitioning||(o.facetPartitioning=new Array),o.facetNb=this.QQ().length/3|0,o.partitioningSubdivisions=o.partitioningSubdivisions?o.partitioningSubdivisions:10,o.partitioningBBoxRatio=o.partitioningBBoxRatio?o.partitioningBBoxRatio:1.01;for(let v=0;v<o.facetNb;v++)o.facetNormals[v]=I.cv.Zero(),o.facetPositions[v]=I.cv.Zero();return o.facetDataEnabled=!0,this}updateFacetData(){const o=this._internalAbstractMeshDataInfo._facetData;o.facetDataEnabled||this._initFacetData();const v=this.getVerticesData(Q.e.PositionKind),V=this.QQ(),g=this.getVerticesData(Q.e.NormalKind),E=this.getBoundingInfo();if(o.facetDepthSort&&!o.facetDepthSortEnabled){if(o.facetDepthSortEnabled=!0,V instanceof Uint16Array)o.depthSortedIndices=new Uint16Array(V);else if(V instanceof Uint32Array)o.depthSortedIndices=new Uint32Array(V);else{let v=!1;for(let o=0;o<V.length;o++)if(V[o]>65535){v=!0;break}o.depthSortedIndices=v?new Uint32Array(V):new Uint16Array(V)}if(o.facetDepthSortFunction=function(o,v){return v.sqDistance-o.sqDistance},!o.facetDepthSortFrom){const v=this.Fo().activeCamera;o.facetDepthSortFrom=v?v.position:I.cv.Zero()}o.depthSortedFacets=[];for(let v=0;v<o.facetNb;v++){const V={ind:3*v,sqDistance:0};o.depthSortedFacets.push(V)}o.invertedMatrix=I.Matrix.Identity(),o.facetDepthSortOrigin=I.cv.Zero()}o.bbSize.x=E.maximum.x-E.minimum.x>c.d?E.maximum.x-E.minimum.x:c.d,o.bbSize.y=E.maximum.y-E.minimum.y>c.d?E.maximum.y-E.minimum.y:c.d,o.bbSize.z=E.maximum.z-E.minimum.z>c.d?E.maximum.z-E.minimum.z:c.d;let n=o.bbSize.x>o.bbSize.y?o.bbSize.x:o.bbSize.y;if(n=n>o.bbSize.z?n:o.bbSize.z,o.subDiv.max=o.partitioningSubdivisions,o.subDiv.X=Math.floor(o.subDiv.max*o.bbSize.x/n),o.subDiv.Y=Math.floor(o.subDiv.max*o.bbSize.y/n),o.subDiv.Z=Math.floor(o.subDiv.max*o.bbSize.z/n),o.subDiv.X=o.subDiv.X<1?1:o.subDiv.X,o.subDiv.Y=o.subDiv.Y<1?1:o.subDiv.Y,o.subDiv.Z=o.subDiv.Z<1?1:o.subDiv.Z,o.facetParameters.facetNormals=this.getFacetLocalNormals(),o.facetParameters.facetPositions=this.getFacetLocalPositions(),o.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),o.facetParameters.bInfo=E,o.facetParameters.bbSize=o.bbSize,o.facetParameters.subDiv=o.subDiv,o.facetParameters.ratio=this.partitioningBBoxRatio,o.facetParameters.depthSort=o.facetDepthSort,o.facetDepthSort&&o.facetDepthSortEnabled&&(this.Ag(!0),this._worldMatrix.invertToRef(o.invertedMatrix),I.cv.TransformCoordinatesToRef(o.facetDepthSortFrom,o.invertedMatrix,o.facetDepthSortOrigin),o.facetParameters.distanceTo=o.facetDepthSortOrigin),o.facetParameters.depthSortedFacets=o.depthSortedFacets,g&&U.d.ComputeNormals(v,V,g,o.facetParameters),o.facetDepthSort&&o.facetDepthSortEnabled){o.depthSortedFacets.sort(o.facetDepthSortFunction);const v=o.depthSortedIndices.length/3|0;for(let g=0;g<v;g++){const v=o.depthSortedFacets[g].ind;o.depthSortedIndices[3*g]=V[v],o.depthSortedIndices[3*g+1]=V[v+1],o.depthSortedIndices[3*g+2]=V[v+2]}this.updateIndices(o.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const o=this._internalAbstractMeshDataInfo._facetData;return o.facetNormals||this.updateFacetData(),o.facetNormals}getFacetLocalPositions(){const o=this._internalAbstractMeshDataInfo._facetData;return o.facetPositions||this.updateFacetData(),o.facetPositions}getFacetLocalPartitioning(){const o=this._internalAbstractMeshDataInfo._facetData;return o.facetPartitioning||this.updateFacetData(),o.facetPartitioning}getFacetPosition(o){const v=I.cv.Zero();return this.getFacetPositionToRef(o,v),v}getFacetPositionToRef(o,v){const V=this.getFacetLocalPositions()[o],g=this.getWorldMatrix();return I.cv.TransformCoordinatesToRef(V,g,v),this}getFacetNormal(o){const v=I.cv.Zero();return this.getFacetNormalToRef(o,v),v}getFacetNormalToRef(o,v){const V=this.getFacetLocalNormals()[o];return I.cv.TransformNormalToRef(V,this.getWorldMatrix(),v),this}getFacetsAtLocalCoordinates(o,v,V){const g=this.getBoundingInfo(),E=this._internalAbstractMeshDataInfo._facetData,I=Math.floor((o-g.minimum.x*E.partitioningBBoxRatio)*E.subDiv.X*E.partitioningBBoxRatio/E.bbSize.x),Q=Math.floor((v-g.minimum.y*E.partitioningBBoxRatio)*E.subDiv.Y*E.partitioningBBoxRatio/E.bbSize.y),U=Math.floor((V-g.minimum.z*E.partitioningBBoxRatio)*E.subDiv.Z*E.partitioningBBoxRatio/E.bbSize.z);return I<0||I>E.subDiv.max||Q<0||Q>E.subDiv.max||U<0||U>E.subDiv.max?null:E.facetPartitioning[I+E.subDiv.max*Q+E.subDiv.max*E.subDiv.max*U]}getClosestFacetAtCoordinates(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const U=this.getWorldMatrix(),n=I.TmpVectors.Matrix[5];U.invertToRef(n);const O=I.TmpVectors.cv[8];I.cv.TransformCoordinatesFromFloatsToRef(o,v,V,n,O);const h=this.getClosestFacetAtLocalCoordinates(O.x,O.y,O.z,g,E,Q);return g&&I.cv.TransformCoordinatesFromFloatsToRef(g.x,g.y,g.z,U,g),h}getClosestFacetAtLocalCoordinates(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Q=null,U=0,n=0,O=0,h=0,x=0,f=0,l=0,S=0;const T=this.getFacetLocalPositions(),c=this.getFacetLocalNormals(),R=this.getFacetsAtLocalCoordinates(o,v,V);if(!R)return null;let j,t,s,L=Number.MAX_VALUE,b=L;for(let u=0;u<R.length;u++)j=R[u],t=c[j],s=T[j],h=(o-s.x)*t.x+(v-s.y)*t.y+(V-s.z)*t.z,(!E||E&&I&&h>=0||E&&!I&&h<=0)&&(h=t.x*s.x+t.y*s.y+t.z*s.z,x=-(t.x*o+t.y*v+t.z*V-h)/(t.x*t.x+t.y*t.y+t.z*t.z),f=o+t.x*x,l=v+t.y*x,S=V+t.z*x,U=f-o,n=l-v,O=S-V,b=U*U+n*n+O*O,b<L&&(L=b,Q=j,g&&(g.x=f,g.y=l,g.z=S)));return Q}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const o=this._internalAbstractMeshDataInfo._facetData;return o.facetDataEnabled&&(o.facetDataEnabled=!1,o.facetPositions=[],o.facetNormals=[],o.facetPartitioning=new Array,o.facetParameters={},o.depthSortedIndices=new Uint32Array(0)),this}updateIndices(o,v){return this}createNormals(o){const v=this.getVerticesData(Q.e.PositionKind),V=this.QQ();let g;return g=this.isVerticesDataPresent(Q.e.NormalKind)?this.getVerticesData(Q.e.NormalKind):[],U.d.ComputeNormals(v,V,g,{useRightHandedSystem:this.Fo().useRightHandedSystem}),this.zo(Q.e.NormalKind,g,o),this}async optimizeIndicesAsync(){const o=this.QQ();if(!o)return this;const{OptimizeIndices:v}=await V.e(70).then(V.bind(V,15540));return v(o),this.setIndices(o,this.getTotalVertices()),this}alignWithNormal(o,v){v||(v=R.e.Y);const V=I.TmpVectors.cv[0],g=I.TmpVectors.cv[1];return I.cv.CrossToRef(v,o,g),I.cv.CrossToRef(o,g,V),this.rotationQuaternion?I.Quaternion.RotationQuaternionFromAxisToRef(V,o,g,this.rotationQuaternion):I.cv.RotationFromAxisToRef(V,o,g,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,l.b)("EdgesRenderer")}enableEdgesRendering(o,v,V){throw(0,l.b)("EdgesRenderer")}Wf(){return this._scene.Mf.filter((o=>o.lo===this))}}u.OCCLUSION_TYPE_NONE=0,u.OCCLUSION_TYPE_OPTIMISTIC=1,u.OCCLUSION_TYPE_STRICT=2,u.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,u.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,u.CULLINGSTRATEGY_STANDARD=0,u.zx=1,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,g.c)([t.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g,E,I,Q,U]=v;return!Array.isArray(g)&&!Array.isArray(E)&&!Array.isArray(I)&&!Array.isArray(Q)&&!Array.isArray(U)}))],u,"_ApplySkeleton",null),(0,j.h)("BABYLON.AbstractMesh",u)},13093:(o,v,V)=>{V.d(v,{c:()=>g.e});var g=V(12577)},12970:(o,v,V)=>{V.d(v,{e:()=>c});var g=V(12488),E=V(12547),I=V(12944),Q=V(12577),U=V(12835),n=V(12979),O=V(12852),h=V(12291),x=V(12538),f=V(12870),l=V(12339),S=V(12564),T=V(12585);class c{get boundingBias(){return this._boundingBias}set boundingBias(o){this._boundingBias?this._boundingBias.U(o):this._boundingBias=o.clone(),this.Wo(!0,null)}static CreateGeometryForMesh(o){const v=new c(c.RandomId(),o.Fo());return v.Po(o),v}get meshes(){return this._meshes}constructor(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new g.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new g.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=v||l.d.LastCreatedScene,this._scene&&(this.id=o,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=E,V?this.setAllVerticesData(V,E):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),I&&(this.Po(I),I.Ag(!0)))}get extend(){return this._extend}Fo(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let o=0;o<this._meshes.length;o++)if(!this._meshes[o].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const o=new Set;for(const v in this._vertexBuffers)o.add(this._vertexBuffers[v].getWrapperBuffer());o.forEach((o=>{o._rebuild()}))}setAllVerticesData(o,v){o.applyToGeometry(this,v),this._notifyUpdate()}zo(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0;V&&Array.isArray(v)&&(v=new Float32Array(v));const E=new Q.e(this._engine,v,o,{updatable:V,postponeInternalCreation:0===this._meshes.length,stride:g,label:"Geometry_"+this.id+"_"+o});this.setVerticesBuffer(E)}removeVerticesData(o){this._vertexBuffers[o]&&(this._vertexBuffers[o].dispose(),delete this._vertexBuffers[o]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const E=o.getKind();this._vertexBuffers[E]&&V&&this._vertexBuffers[E].dispose(),o._buffer&&o._buffer._increaseReferences(),this._vertexBuffers[E]=o;const I=this._meshes,U=I.length;if(E===Q.e.PositionKind){this._totalVertices=v??o._maxVerticesCount,this._updateExtend(o.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const V=this._extend&&this._extend.minimum||new g.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),E=this._extend&&this._extend.maximum||new g.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let o=0;o<U;o++){const v=I[o];v.buildBoundingInfo(V,E),v._createGlobalSubMesh(v.isUnIndexed),v.Ag(!0),v.synchronizeInstances()}}this._notifyUpdate(E)}updateVerticesDataDirectly(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getVertexBuffer(o);E&&(E.updateDirectly(v,V,g),this._notifyUpdate(o))}updateVerticesData(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=this.getVertexBuffer(o);g&&(g.update(v),o===Q.e.PositionKind&&this.Wo(V,v),this._notifyUpdate(o))}Wo(o,v){if(o&&this._updateExtend(v),this._resetPointsArrayCache(),o){const o=this._meshes;for(const v of o){v.hasBoundingInfo?v.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):v.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const o=v.wg;for(const v of o)v.refreshBoundingInfo()}}}_bind(o,v,V,g){if(!o)return;void 0===v&&(v=this._indexBuffer);const E=this.getVertexBuffers();if(!E)return;if(v!=this._indexBuffer||!this._vertexArrayObjects&&!g)return void this._engine.bindBuffers(E,v,o,V);const I=g||this._vertexArrayObjects,Q=this._engine;I[o.key]||(I[o.key]=Q.recordVertexArrayObject(E,v,o,V)),Q.bindVertexArrayObject(I[o.key],v)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(o,v,V){const g=this.getVertexBuffer(o);return g?g.getFloatData(this._totalVertices,V||v&&1!==this._meshes.length):null}copyVerticesData(o,v){const V=this.getVertexBuffer(o);if(!V)return;v[o]||(v[o]=new Float32Array(this._totalVertices*V.getSize()));const g=V.getData();g&&(0,T.f)(g,V.getSize(),V.type,V.byteOffset,V.byteStride,V.normalized,this._totalVertices,v[o])}isVertexBufferUpdatable(o){const v=this._vertexBuffers[o];return!!v&&v.isUpdatable()}getVertexBuffer(o){return this.isReady()?this._vertexBuffers[o]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(o){return this._vertexBuffers?void 0!==this._vertexBuffers[o]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(o)}getVerticesDataKinds(){const o=[];let v;if(!this._vertexBuffers&&this._delayInfo)for(v in this._delayInfo)o.push(v);else for(v in this._vertexBuffers)o.push(v);return o}updateIndices(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const g=o.length!==this._indices.length;if(V||(this._indices=o.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,o,v),g)for(const o of this._meshes)o._createGlobalSubMesh(!0)}else this.setIndices(o,null,!0)}setIndexBuffer(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=o,this._totalVertices=v,this._totalIndices=V,o.is32Bits=null===g?v>65535:g;for(const E of this._meshes)E._createGlobalSubMesh(!0),E.synchronizeInstances();this._notifyUpdate()}setIndices(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=o,this._indexBufferIsUpdatable=V,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,V,"Geometry_"+this.id+"_IndexBuffer")),void 0!=v&&(this._totalVertices=v);for(const E of this._meshes)E._createGlobalSubMesh(!g),E.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}QQ(o,v){if(!this.isReady())return null;const V=this._indices;return v||o&&1!==this._meshes.length?V.slice():V}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o&&this._vertexArrayObjects&&this._vertexArrayObjects[o.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[o.key]),delete this._vertexArrayObjects[o.key])}releaseForMesh(o,v){const V=this._meshes,g=V.indexOf(o);-1!==g&&(V.splice(g,1),this._vertexArrayObjects&&o._invalidateInstanceVertexArrayObject(),o._geometry=null,0===V.length&&v&&this.dispose())}Po(o){if(o._geometry===this)return;const v=o._geometry;v&&v.releaseForMesh(o),this._vertexArrayObjects&&o._invalidateInstanceVertexArrayObject();const V=this._meshes;o._geometry=this,o._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),V.push(o),this.isReady()?this._applyToMesh(o):this._boundingInfo&&o.setBoundingInfo(this._boundingInfo)}_updateExtend(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!o&&(o=this.getVerticesData(Q.e.PositionKind),!o))return;this._extend=(0,f.c)(o,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(o){const v=this._meshes.length;for(const V in this._vertexBuffers)1===v&&this._vertexBuffers[V].create(),V===Q.e.PositionKind&&(this._extend||this._updateExtend(),o.buildBoundingInfo(this._extend.minimum,this._extend.maximum),o._createGlobalSubMesh(o.isUnIndexed),o.Wo());1===v&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),o._syncGeometryWithMorphTargetManager(),o.synchronizeInstances()}_notifyUpdate(o){this.onGeometryUpdated&&this.onGeometryUpdated(this,o),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const v of this._meshes)v._markSubMeshesAsAttributesDirty()}load(o,v){2!==this.delayLoadState&&(this.isReady()?v&&v():(this.delayLoadState=2,this._queueLoad(o,v)))}_queueLoad(o,v){this.delayLoadingFile&&(o.addPendingData(this),o._loadFile(this.delayLoadingFile,(V=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(V),this),this.delayLoadState=1,this._delayInfo=[],o.removePendingData(this);const g=this._meshes,E=g.length;for(let o=0;o<E;o++)this._applyToMesh(g[o]);v&&v()}),void 0,!0))}toLeftHanded(){const o=this.QQ(!1);if(null!=o&&o.length>0){for(let v=0;v<o.length;v+=3){const V=o[v+0];o[v+0]=o[v+2],o[v+2]=V}this.setIndices(o)}const v=this.getVerticesData(Q.e.PositionKind,!1);if(null!=v&&v.length>0){for(let o=0;o<v.length;o+=3)v[o+2]=-v[o+2];this.zo(Q.e.PositionKind,v,!1)}const V=this.getVerticesData(Q.e.NormalKind,!1);if(null!=V&&V.length>0){for(let o=0;o<V.length;o+=3)V[o+2]=-V[o+2];this.zo(Q.e.NormalKind,V,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const o=this.getVerticesData(Q.e.PositionKind);if(!o||0===o.length)return!1;for(let v=3*this._positionsCache.length,V=this._positionsCache.length;v<o.length;v+=3,++V)this._positionsCache[V]=g.cv.bv(o,v);for(let v=0,V=0;v<o.length;v+=3,++V)this._positionsCache[V].set(o[0+v],o[1+v],o[2+v]);return this._positionsCache.length=o.length/3,this._positions=this._positionsCache,!0}l(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const V in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[V]);this._vertexArrayObjects={};const o=this._meshes,v=o.length;for(let V=0;V<v;V++)o[V]._invalidateInstanceVertexArrayObject()}}dispose(){const o=this._meshes,v=o.length;let V;for(V=0;V<v;V++)this.releaseForMesh(o[V]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const g in this._vertexBuffers)this._vertexBuffers[g].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const o=this._parentContainer.geometries.indexOf(this);o>-1&&this._parentContainer.geometries.splice(o,1),this._parentContainer=null}this._isDisposed=!0}k(o){const v=new I.d;v.indices=[];const V=this.QQ();if(V)for(let I=0;I<V.length;I++)v.indices.push(V[I]);let g,E=!1,Q=!1;for(g in this._vertexBuffers){const o=this.getVerticesData(g);if(o&&(o instanceof Float32Array?v.set(new Float32Array(o),g):v.set(o.slice(0),g),!Q)){const o=this.getVertexBuffer(g);o&&(E=o.isUpdatable(),Q=!E)}}const U=new c(o,this._scene,v,E);for(g in U.delayLoadState=this.delayLoadState,U.delayLoadingFile=this.delayLoadingFile,U._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)U._delayInfo=U._delayInfo||[],U._delayInfo.push(g);return U._boundingInfo=new O.c(this._extend.minimum,this._extend.maximum),U}serialize(){const o={};return o.id=this.id,o.uniqueId=this.uniqueId,o.updatable=this._updatable,x.e&&x.e.HasTags(this)&&(o.tags=x.e.GetTags(this)),o}_toNumberArray(o){return Array.isArray(o)?o:Array.prototype.slice.call(o)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const o in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,o)&&(this._vertexBuffers[o]._buffer._data=null)}serializeVerticeData(){const o=this.serialize();return this.isVerticesDataPresent(Q.e.PositionKind)&&(o.Jo=this._toNumberArray(this.getVerticesData(Q.e.PositionKind)),this.isVertexBufferUpdatable(Q.e.PositionKind)&&(o.positionsUpdatable=!0)),this.isVerticesDataPresent(Q.e.NormalKind)&&(o.do=this._toNumberArray(this.getVerticesData(Q.e.NormalKind)),this.isVertexBufferUpdatable(Q.e.NormalKind)&&(o.normalsUpdatable=!0)),this.isVerticesDataPresent(Q.e.TangentKind)&&(o.tangents=this._toNumberArray(this.getVerticesData(Q.e.TangentKind)),this.isVertexBufferUpdatable(Q.e.TangentKind)&&(o.tangentsUpdatable=!0)),this.isVerticesDataPresent(Q.e.UVKind)&&(o.Yo=this._toNumberArray(this.getVerticesData(Q.e.UVKind)),this.isVertexBufferUpdatable(Q.e.UVKind)&&(o.uvsUpdatable=!0)),this.isVerticesDataPresent(Q.e.UV2Kind)&&(o.uvs2=this._toNumberArray(this.getVerticesData(Q.e.UV2Kind)),this.isVertexBufferUpdatable(Q.e.UV2Kind)&&(o.uvs2Updatable=!0)),this.isVerticesDataPresent(Q.e.UV3Kind)&&(o.uvs3=this._toNumberArray(this.getVerticesData(Q.e.UV3Kind)),this.isVertexBufferUpdatable(Q.e.UV3Kind)&&(o.uvs3Updatable=!0)),this.isVerticesDataPresent(Q.e.UV4Kind)&&(o.uvs4=this._toNumberArray(this.getVerticesData(Q.e.UV4Kind)),this.isVertexBufferUpdatable(Q.e.UV4Kind)&&(o.uvs4Updatable=!0)),this.isVerticesDataPresent(Q.e.UV5Kind)&&(o.uvs5=this._toNumberArray(this.getVerticesData(Q.e.UV5Kind)),this.isVertexBufferUpdatable(Q.e.UV5Kind)&&(o.uvs5Updatable=!0)),this.isVerticesDataPresent(Q.e.UV6Kind)&&(o.uvs6=this._toNumberArray(this.getVerticesData(Q.e.UV6Kind)),this.isVertexBufferUpdatable(Q.e.UV6Kind)&&(o.uvs6Updatable=!0)),this.isVerticesDataPresent(Q.e.ColorKind)&&(o.No=this._toNumberArray(this.getVerticesData(Q.e.ColorKind)),this.isVertexBufferUpdatable(Q.e.ColorKind)&&(o.colorsUpdatable=!0)),this.isVerticesDataPresent(Q.e.MatricesIndicesKind)&&(o.matricesIndices=this._toNumberArray(this.getVerticesData(Q.e.MatricesIndicesKind)),o.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(Q.e.MatricesIndicesKind)&&(o.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(Q.e.MatricesWeightsKind)&&(o.matricesWeights=this._toNumberArray(this.getVerticesData(Q.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(Q.e.MatricesWeightsKind)&&(o.matricesWeightsUpdatable=!0)),o.indices=this._toNumberArray(this.QQ()),o}static ExtractFromMesh(o,v){const V=o._geometry;return V?V.k(v):null}static RandomId(){return h.Tools.RandomId()}static _GetGeometryByLoadedUniqueId(o,v){for(let V=0;V<v.geometries.length;V++)if(v.geometries[V]._loadedUniqueId===o)return v.geometries[V];return null}static _ImportGeometry(o,v){const V=v.Fo(),g=o.geometryUniqueId,I=o.geometryId;if(g||I){const o=g?this._GetGeometryByLoadedUniqueId(g,V):V.getGeometryById(I);o&&o.Po(v)}else if(o instanceof ArrayBuffer){const V=v._binaryInfo;if(V.positionsAttrDesc&&V.positionsAttrDesc.count>0){const g=new Float32Array(o,V.positionsAttrDesc.offset,V.positionsAttrDesc.count);v.zo(Q.e.PositionKind,g,!1)}if(V.normalsAttrDesc&&V.normalsAttrDesc.count>0){const g=new Float32Array(o,V.normalsAttrDesc.offset,V.normalsAttrDesc.count);v.zo(Q.e.NormalKind,g,!1)}if(V.tangetsAttrDesc&&V.tangetsAttrDesc.count>0){const g=new Float32Array(o,V.tangetsAttrDesc.offset,V.tangetsAttrDesc.count);v.zo(Q.e.TangentKind,g,!1)}if(V.uvsAttrDesc&&V.uvsAttrDesc.count>0){const g=new Float32Array(o,V.uvsAttrDesc.offset,V.uvsAttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UVKind,g,!1)}if(V.uvs2AttrDesc&&V.uvs2AttrDesc.count>0){const g=new Float32Array(o,V.uvs2AttrDesc.offset,V.uvs2AttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UV2Kind,g,!1)}if(V.uvs3AttrDesc&&V.uvs3AttrDesc.count>0){const g=new Float32Array(o,V.uvs3AttrDesc.offset,V.uvs3AttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UV3Kind,g,!1)}if(V.uvs4AttrDesc&&V.uvs4AttrDesc.count>0){const g=new Float32Array(o,V.uvs4AttrDesc.offset,V.uvs4AttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UV4Kind,g,!1)}if(V.uvs5AttrDesc&&V.uvs5AttrDesc.count>0){const g=new Float32Array(o,V.uvs5AttrDesc.offset,V.uvs5AttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UV5Kind,g,!1)}if(V.uvs6AttrDesc&&V.uvs6AttrDesc.count>0){const g=new Float32Array(o,V.uvs6AttrDesc.offset,V.uvs6AttrDesc.count);if(S.e)for(let o=1;o<g.length;o+=2)g[o]=1-g[o];v.zo(Q.e.UV6Kind,g,!1)}if(V.colorsAttrDesc&&V.colorsAttrDesc.count>0){const g=new Float32Array(o,V.colorsAttrDesc.offset,V.colorsAttrDesc.count);v.zo(Q.e.ColorKind,g,!1,V.colorsAttrDesc.stride)}if(V.matricesIndicesAttrDesc&&V.matricesIndicesAttrDesc.count>0){const g=new Int32Array(o,V.matricesIndicesAttrDesc.offset,V.matricesIndicesAttrDesc.count),E=[];for(let o=0;o<g.length;o++){const v=g[o];E.push(255&v),E.push((65280&v)>>8),E.push((16711680&v)>>16),E.push(v>>24&255)}v.zo(Q.e.MatricesIndicesKind,E,!1)}if(V.matricesIndicesExtraAttrDesc&&V.matricesIndicesExtraAttrDesc.count>0){const g=new Int32Array(o,V.matricesIndicesExtraAttrDesc.offset,V.matricesIndicesExtraAttrDesc.count),E=[];for(let o=0;o<g.length;o++){const v=g[o];E.push(255&v),E.push((65280&v)>>8),E.push((16711680&v)>>16),E.push(v>>24&255)}v.zo(Q.e.MatricesIndicesExtraKind,E,!1)}if(V.matricesWeightsAttrDesc&&V.matricesWeightsAttrDesc.count>0){const g=new Float32Array(o,V.matricesWeightsAttrDesc.offset,V.matricesWeightsAttrDesc.count);v.zo(Q.e.MatricesWeightsKind,g,!1)}if(V.indicesAttrDesc&&V.indicesAttrDesc.count>0){const g=new Int32Array(o,V.indicesAttrDesc.offset,V.indicesAttrDesc.count);v.setIndices(g,null)}if(V.subMeshesAttrDesc&&V.subMeshesAttrDesc.count>0){const g=new Int32Array(o,V.subMeshesAttrDesc.offset,5*V.subMeshesAttrDesc.count);v.wg=[];for(let o=0;o<V.subMeshesAttrDesc.count;o++){const V=g[5*o+0],E=g[5*o+1],I=g[5*o+2],Q=g[5*o+3],n=g[5*o+4];U.b.AddToMesh(V,E,I,Q,n,v)}}}else if(o.Jo&&o.do&&o.indices){if(v.zo(Q.e.PositionKind,o.Jo,o.Jo._updatable||o.positionsUpdatable),v.zo(Q.e.NormalKind,o.do,o.do._updatable||o.normalsUpdatable),o.tangents&&v.zo(Q.e.TangentKind,o.tangents,o.tangents._updatable||o.tangentsUpdatable),o.Yo&&v.zo(Q.e.UVKind,o.Yo,o.Yo._updatable||o.uvsUpdatable),o.uvs2&&v.zo(Q.e.UV2Kind,o.uvs2,o.uvs2._updatable||o.uvs2Updatable),o.uvs3&&v.zo(Q.e.UV3Kind,o.uvs3,o.uvs3._updatable||o.uvs3Updatable),o.uvs4&&v.zo(Q.e.UV4Kind,o.uvs4,o.uvs4._updatable||o.uvs4Updatable),o.uvs5&&v.zo(Q.e.UV5Kind,o.uvs5,o.uvs5._updatable||o.uvs5Updatable),o.uvs6&&v.zo(Q.e.UV6Kind,o.uvs6,o.uvs6._updatable||o.uvs6Updatable),o.No&&v.zo(Q.e.ColorKind,E.sU.CheckColors4(o.No,o.Jo.length/3),o.No._updatable),o.matricesIndices)if(o.matricesIndices._isExpanded||o.matricesIndicesExpanded)delete o.matricesIndices._isExpanded,delete o.matricesIndicesExpanded,v.zo(Q.e.MatricesIndicesKind,o.matricesIndices,o.matricesIndices._updatable||o.matricesIndicesUpdatable);else{const V=[];for(let v=0;v<o.matricesIndices.length;v++){const g=o.matricesIndices[v];V.push(255&g),V.push((65280&g)>>8),V.push((16711680&g)>>16),V.push(g>>24&255)}v.zo(Q.e.MatricesIndicesKind,V,o.matricesIndices._updatable||o.matricesIndicesUpdatable)}if(o.matricesIndicesExtra)if(o.matricesIndicesExtraExpanded||o.matricesIndicesExtra._isExpanded)delete o.matricesIndices._isExpanded,delete o.matricesIndicesExtraExpanded,v.zo(Q.e.MatricesIndicesExtraKind,o.matricesIndicesExtra,o.matricesIndicesExtra._updatable||o.matricesIndicesExtraUpdatable);else{const V=[];for(let v=0;v<o.matricesIndicesExtra.length;v++){const g=o.matricesIndicesExtra[v];V.push(255&g),V.push((65280&g)>>8),V.push((16711680&g)>>16),V.push(g>>24&255)}v.zo(Q.e.MatricesIndicesExtraKind,V,o.matricesIndicesExtra._updatable||o.matricesIndicesExtraUpdatable)}o.matricesWeights&&(c._CleanMatricesWeights(o,v),v.zo(Q.e.MatricesWeightsKind,o.matricesWeights,o.matricesWeights._updatable)),o.matricesWeightsExtra&&v.zo(Q.e.MatricesWeightsExtraKind,o.matricesWeightsExtra,o.matricesWeights._updatable),v.setIndices(o.indices,null)}if(o.wg){v.wg=[];for(let V=0;V<o.wg.length;V++){const g=o.wg[V];U.b.AddToMesh(g.materialIndex,g.verticesStart,g.verticesCount,g.indexStart,g.indexCount,v)}}v._shouldGenerateFlatShading&&(v.convertToFlatShadedMesh(),v._shouldGenerateFlatShading=!1),v.Ag(!0),V.onMeshImportedObservable.notifyObservers(v)}static _CleanMatricesWeights(o,v){const V=.001;if(!n.e.CleanBoneMatrixWeights)return;let g=0;if(!(o.skeletonId>-1))return;{const V=v.Fo().getLastSkeletonById(o.skeletonId);if(!V)return;g=V.bones.length}const E=v.getVerticesData(Q.e.MatricesIndicesKind),I=v.getVerticesData(Q.e.MatricesIndicesExtraKind),U=o.matricesWeights,O=o.matricesWeightsExtra,h=o.numBoneInfluencer,x=U.length;for(let Q=0;Q<x;Q+=4){let o=0,v=-1;for(let g=0;g<4;g++){const E=U[Q+g];o+=E,E<V&&v<0&&(v=g)}if(O)for(let g=0;g<4;g++){const E=O[Q+g];o+=E,E<V&&v<0&&(v=g+4)}if((v<0||v>h-1)&&(v=h-1),o>V){const v=1/o;for(let o=0;o<4;o++)U[Q+o]*=v;if(O)for(let o=0;o<4;o++)O[Q+o]*=v}else v>=4?(O[Q+v-4]=1-o,I[Q+v-4]=g):(U[Q+v]=1-o,E[Q+v]=g)}v.zo(Q.e.MatricesIndicesKind,E),o.matricesWeightsExtra&&v.zo(Q.e.MatricesIndicesExtraKind,I)}static Parse(o,v,V){const E=new c(o.id,v,void 0,o.updatable);return E._loadedUniqueId=o.uniqueId,x.e&&x.e.AddTagsTo(E,o.tags),o.delayLoadingFile?(E.delayLoadState=4,E.delayLoadingFile=V+o.delayLoadingFile,E._boundingInfo=new O.c(g.cv.bv(o.boundingBoxMinimum),g.cv.bv(o.boundingBoxMaximum)),E._delayInfo=[],o.hasUVs&&E._delayInfo.push(Q.e.UVKind),o.hasUVs2&&E._delayInfo.push(Q.e.UV2Kind),o.hasUVs3&&E._delayInfo.push(Q.e.UV3Kind),o.hasUVs4&&E._delayInfo.push(Q.e.UV4Kind),o.hasUVs5&&E._delayInfo.push(Q.e.UV5Kind),o.hasUVs6&&E._delayInfo.push(Q.e.UV6Kind),o.hasColors&&E._delayInfo.push(Q.e.ColorKind),o.hasMatricesIndices&&E._delayInfo.push(Q.e.MatricesIndicesKind),o.hasMatricesWeights&&E._delayInfo.push(Q.e.MatricesWeightsKind),E._delayLoadingFunction=I.d.ImportVertexData):I.d.ImportVertexData(o,E),v.pushGeometry(E,!0),E}}},12954:(o,v,V)=>{V.d(v,{e:()=>f});var g=V(12488),E=V(12308),I=V(12936),Q=V(12958),U=V(12313),n=V(12928),O=V(12577),h=V(12291),x=V(12449);Q.e._instancedMeshFactory=(o,v)=>{const V=new f(o,v);if(v.instancedBuffers){V.instancedBuffers={};for(const o in v.instancedBuffers)V.instancedBuffers[o]=v.instancedBuffers[o]}return V};class f extends I.d{constructor(o,v){super(o,v.Fo()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,v.gl(this),this._sourceMesh=v,this._unIndexed=v._unIndexed,this.position.U(v.position),this.rotation.U(v.rotation),this.jU.U(v.jU),v.rotationQuaternion&&(this.rotationQuaternion=v.rotationQuaternion.clone()),this.animations=v.animations.slice();for(const V of v.getAnimationRanges())null!=V&&this.createAnimationRange(V.name,V.from,V.to);if(this.infiniteDistance=v.infiniteDistance,this.setPivotMatrix(v.getPivotMatrix()),v.skeleton||v.morphTargetManager||!v.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const o=v.getBoundingInfo();this.buildBoundingInfo(o.minimum,o.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(o){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.receiveShadows)!==o&&h.Tools.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(o){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.material)!==o&&h.Tools.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(o){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.visibility)!==o&&h.Tools.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(o){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.skeleton)!==o&&h.Tools.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(o){this._sourceMesh&&o!==this._sourceMesh.renderingGroupId&&E.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get kg(){return this._sourceMesh._geometry}createInstance(o){return this._sourceMesh.createInstance(o)}isReady(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(o,!0)}getVerticesData(o,v,V){return this._sourceMesh.getVerticesData(o,v,V)}copyVerticesData(o,v){this._sourceMesh.copyVerticesData(o,v)}zo(o,v,V,g){return this.sourceMesh&&this.sourceMesh.zo(o,v,V,g),this.sourceMesh}updateVerticesData(o,v,V,g){return this.sourceMesh&&this.sourceMesh.updateVerticesData(o,v,V,g),this.sourceMesh}setIndices(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(o,v),this.sourceMesh}isVerticesDataPresent(o){return this._sourceMesh.isVerticesDataPresent(o)}QQ(){return this._sourceMesh.QQ()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let o,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;o="object"===typeof v?v:{applySkeleton:v,applyMorph:V};const g=this._sourceMesh.kg?this._sourceMesh.kg.boundingBias:null;return this.wo(this._sourceMesh._getData(o,null,O.e.PositionKind),g),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(o,v){if(super._activate(o,v),this._sourceMesh.wg||E.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,o),v){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==n.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new g.Matrix);const o=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,g.TmpVectors.cv[7].U(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.U(this._currentLOD.Ag(!0)),this._currentLOD.position.U(g.TmpVectors.cv[7]),this._currentLOD._masterMesh=o,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(o){if(!o)return this;const v=this.sourceMesh.getLODLevels();if(v&&0!==v.length){const v=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(o,v.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(o){return this.sourceMesh._preActivateForIntermediateRendering(o)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.wg)for(let o=0;o<this._sourceMesh.wg.length;o++)this._sourceMesh.wg[o].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Wo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;const g=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(o);if(U.b.DeepCopy(this,g,["name","wg","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Pf","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","kg"],[]),this.refreshBoundingInfo(),v&&(g.parent=v),!V)for(let E=0;E<this.Fo().meshes.length;E++){const o=this.Fo().meshes[E];o.parent===this&&o.clone(o.name,g)}return g.Ag(!0),this.onClonedObservable.notifyObservers(g),g}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Vl(this),super.dispose(o,v)}_serializeAsParent(o){super._serializeAsParent(o),o.parentId=this._sourceMesh.uniqueId,o.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;const g=this.clone("Clone of "+(this.name||this.id),o||this.parent,!0,v&&v.newSourcedMesh);g&&V&&V(this,g);for(const E of this.getChildTransformNodes(!0))E.instantiateHierarchy(g,v,V);return g}}Q.e.prototype.registerInstancedBuffer=function(o,v){var V,g;if(null===(V=this._userInstancedBuffersStorage)||void 0===V||null===(g=V.vertexBuffers[o])||void 0===g||g.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const o of this.instances)o.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[o]=null,this._userInstancedBuffersStorage.strides[o]=v,this._userInstancedBuffersStorage.sizes[o]=32*v,this._userInstancedBuffersStorage.data[o]=new Float32Array(this._userInstancedBuffersStorage.sizes[o]),this._userInstancedBuffersStorage.vertexBuffers[o]=new O.e(this.getEngine(),this._userInstancedBuffersStorage.data[o],o,!0,!1,v,!0);for(const E of this.instances)E.instancedBuffers[o]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Q.e.prototype._processInstancedBuffers=function(o,v){const V=o?o.length:0;for(const g in this.instancedBuffers){let E=this._userInstancedBuffersStorage.sizes[g];const I=this._userInstancedBuffersStorage.strides[g],Q=(V+1)*I;for(;E<Q;)E*=2;this._userInstancedBuffersStorage.data[g].length!=E&&(this._userInstancedBuffersStorage.data[g]=new Float32Array(E),this._userInstancedBuffersStorage.sizes[g]=E,this._userInstancedBuffersStorage.vertexBuffers[g]&&(this._userInstancedBuffersStorage.vertexBuffers[g].dispose(),this._userInstancedBuffersStorage.vertexBuffers[g]=null));const U=this._userInstancedBuffersStorage.data[g];let n=0;if(v){const o=this.instancedBuffers[g];o.toArray?o.toArray(U,n):o.copyToArray?o.copyToArray(U,n):U[n]=o,n+=I}for(let v=0;v<V;v++){const V=o[v].instancedBuffers[g];V.toArray?V.toArray(U,n):V.copyToArray?V.copyToArray(U,n):U[n]=V,n+=I}this._userInstancedBuffersStorage.vertexBuffers[g]?this._userInstancedBuffersStorage.vertexBuffers[g].updateDirectly(U,0):(this._userInstancedBuffersStorage.vertexBuffers[g]=new O.e(this.getEngine(),this._userInstancedBuffersStorage.data[g],g,!0,!1,I,!0),this._invalidateInstanceVertexArrayObject())}},Q.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const o in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[o]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Q.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const o in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[o]&&this._userInstancedBuffersStorage.vertexBuffers[o].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,x.h)("BABYLON.InstancedMesh",f)},13052:(o,v,V)=>{V.d(v,{d:()=>O});var g=V(12547),E=V(12577),I=V(12958),Q=V(12954),U=V(12829),n=V(12745);I.e._LinesMeshParser=(o,v)=>O.Parse(o,v);class O extends I.e{_isShaderMaterial(o){return"ShaderMaterial"===o.getClassName()}constructor(o){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0;super(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v,arguments.length>4?arguments[4]:void 0),this.useVertexColor=I,this.useVertexAlpha=Q,this.color=new g.Lv(1,1,1),this.alpha=1,this._shaderLanguage=0,v&&(this.color=v.color.clone(),this.alpha=v.alpha,this.useVertexColor=v.useVertexColor,this.useVertexAlpha=v.useVertexAlpha),this.intersectionThreshold=.1;const h={attributes:[E.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?h.defines.push("#define VERTEXALPHA"):h.needAlphaBlending=!1,this.useVertexColor?(h.defines.push("#define VERTEXCOLOR"),h.attributes.push(E.e.ColorKind)):(h.uniforms.push("color"),this._color4=new g.sU),U)this.material=U;else{this.Fo().getEngine().isWebGPU&&!O.ForceGLSL&&(this._shaderLanguage=1),h.shaderLanguage=this._shaderLanguage,h.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([V.e(44).then(V.bind(V,15625)),V.e(40).then(V.bind(V,15633))]):await Promise.all([V.e(38).then(V.bind(V,15638)),V.e(37).then(V.bind(V,15646))])},this.material=new n.ShaderMaterial("colorShader",this.Fo(),"color",h,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(o){this._lineMaterial=o,this._lineMaterial.fillMode=U.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(o){}_bind(o,v){if(!this._geometry)return this;const V=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(v,V):this._geometry._bind(v,V,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:o,g:v,b:V}=this.color;this._color4.set(o,v,V,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(o,v,V){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const g=this.Fo().getEngine();return this._unIndexed?g.drawArraysType(U.e.LineListDrawMode,o.verticesStart,o.verticesCount,V):g.drawElementsType(U.e.LineListDrawMode,o.indexStart,o.indexCount,V),this}dispose(o){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(o)}clone(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;if(v&&void 0===v._addToSceneRootNodes){const V=v;return V.source=this,new O(o,this.Fo(),V.parent,V.source,V.doNotCloneChildren)}return new O(o,this.Fo(),v,this,V)}createInstance(o){const v=new h(o,this);if(this.instancedBuffers){v.instancedBuffers={};for(const o in this.instancedBuffers)v.instancedBuffers[o]=this.instancedBuffers[o]}return v}serialize(o){super.serialize(o),o.color=this.color.Dg(),o.alpha=this.alpha}static Parse(o,v){const V=new O(o.name,v);return V.color=g.Lv.bv(o.color),V.alpha=o.alpha,V}}O.ForceGLSL=!1;class h extends Q.e{constructor(o,v){super(o,v),this.intersectionThreshold=v.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},12958:(o,v,V)=>{V.d(v,{e:()=>q,i:()=>F});var g=V(12297),E=V(12291),I=V(12313),Q=V(12538),U=V(12948),n=V(12967),O=V(12488),h=V(12547),x=V(12932),f=V(12577),l=V(12944),S=V(12970),T=V(12936),c=V(12835),R=V(12829),j=V(12981),t=V(12979),s=V(12535),L=V(12308),b=V(12449),u=V(12325),mo=V(12776);class a{constructor(o,v){this.distanceOrScreenCoverage=o,this.mesh=v}}class F{}class i{constructor(){this.visibleInstances={},this.batchCache=new J,this.batchCacheReplacementModeInFrozenMode=new J,this.instancesBufferSize=2048}}class J{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class d{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class N{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const Y={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class q extends T.d{static _GetDefaultSideOrientation(o){return o||q.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(o){this._internalMeshDataInfo._useLODScreenCoverage=o,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(o){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==o&&(o&&this._internalMeshDataInfo._sourcePositions&&(this.zo(f.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.zo(f.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=o,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new g.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new g.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new g.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new g.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new g.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(o){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(o)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(o){this._internalMeshDataInfo._forcedInstanceCount=o}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(o){this._internalMeshDataInfo._sideOrientation=o,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===o||!this._scene.useRightHandedSystem&&0===o}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(o){this.sideOrientation=o,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(o){this._internalMeshDataInfo._overrideRenderingFillMode=o}get material(){return this._internalAbstractMeshDataInfo._material}set material(o){o&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(o.sideOrientation=null),this._setMaterial(o)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(o){this._unIndexed!==o&&(this._unIndexed=o,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(o){this._instanceDataStorage.manualUpdate=o}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(o){this._instanceDataStorage.previousManualUpdate=o}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(o){this._instanceDataStorage.forceMatrixUpdates=o}_copySource(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.Fo();if(o._geometry&&o._geometry.Po(this),I.b.DeepCopy(o,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","kg","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Pf","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=o,E.useClonedMeshMap&&(o._internalMeshDataInfo.meshMap||(o._internalMeshDataInfo.meshMap={}),o._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=o._originalBuilderSideOrientation,this._creationDataStorage=o._creationDataStorage,o._ranges){const v=o._ranges;for(const o in v)Object.prototype.hasOwnProperty.call(v,o)&&v[o]&&this.createAnimationRange(o,v[o].from,v[o].to)}if(o.metadata&&o.metadata.clone?this.metadata=o.metadata.clone():this.metadata=o.metadata,this._internalMetadata=o._internalMetadata,Q.e&&Q.e.HasTags(o)&&Q.e.AddTagsTo(this,Q.e.GetTags(o,!0)),this.eU(o.isEnabled(!1)),this.parent=o.parent,this.setPivotMatrix(o.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+o.id,this.material=o.material,!v){const E=o.getDescendants(!0);for(let o=0;o<E.length;o++){const I=E[o];I._isMesh?(Y.parent=this,Y.doNotCloneChildren=v,Y.clonePhysicsImpostor=V,Y.cloneThinInstances=g,I.clone(this.name+"."+I.name,Y)):I.clone&&I.clone(this.name+"."+I.name,this)}}if(o.morphTargetManager&&(this.morphTargetManager=o.morphTargetManager),E.getPhysicsEngine){const v=E.getPhysicsEngine();if(V&&v)if(1===v.getPluginVersion()){const V=v.getImpostorForPhysicsObject(o);V&&(this.physicsImpostor=V.clone(this))}else 2===v.getPluginVersion()&&o.physicsBody&&o.physicsBody.clone(this)}for(let I=0;I<E.Mf.length;I++){const v=E.Mf[I];v.lo===o&&v.clone(v.name,this)}if(this.skeleton=o.skeleton,g&&(o._thinInstanceDataStorage.matrixData?(this.Hx("matrix",new Float32Array(o._thinInstanceDataStorage.matrixData),16,!o._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=o._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=o._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=o._thinInstanceDataStorage.matrixBufferSize,o._userThinInstanceBuffersStorage)){const v=o._userThinInstanceBuffersStorage;for(const o in v.data){var U,n;this.Hx(o,new Float32Array(v.data[o]),v.strides[o],!(null!==(U=v.vertexBuffers)&&void 0!==U&&null!==(n=U[o])&&void 0!==n&&n.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[o]=v.sizes[o]}}this.refreshBoundingInfo(!0,!0),this.Ag(!0)}constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4?arguments[4]:void 0,Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(o,v),this._internalMeshDataInfo=new N,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new i,this._thinInstanceDataStorage=new d,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=q.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,v=this.Fo(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(o,v,V)=>{o&&V&&(this._uniformBuffer?this.transferToEffect(v):V.bindOnlyWorldMatrix(v))};let U=null,n=!1;if(V&&void 0===V._addToSceneRootNodes){const o=V;U=o.parent??null,E=o.source??null,I=o.doNotCloneChildren??!1,Q=o.clonePhysicsImpostor??!0,n=o.cloneThinInstances??!1}else U=V;E&&this._copySource(E,I,Q,n),null!==U&&(this.parent=U),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=o=>{o.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new g.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),E&&E.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;const g=0===this.getTotalVertices()||v&&v.doNotInstantiate&&(!0===v.doNotInstantiate||v.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),o||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));g.parent=o||this.parent,g.position=this.position.clone(),g.jU=this.jU.clone(),this.rotationQuaternion?g.rotationQuaternion=this.rotationQuaternion.clone():g.rotation=this.rotation.clone(),V&&V(this,g);for(const E of this.getChildTransformNodes(!0))"InstancedMesh"===E.getClassName()&&"Mesh"===g.getClassName()&&E.sourceMesh===this?E.instantiateHierarchy(g,{doNotInstantiate:v&&v.doNotInstantiate||!1,newSourcedMesh:g},V):E.instantiateHierarchy(g,v,V);return g}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(o){let v=super.toString(o);if(v+=", n vertices: "+this.getTotalVertices(),v+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let V=0;V<this.animations.length;V++)v+=", animation[0]: "+this.animations[V].toString(o);if(o)if(this._geometry){const o=this.QQ(),V=this.getVerticesData(f.e.PositionKind);V&&o&&(v+=", flat shading: "+(V.length/3===o.length?"YES":"NO"))}else v+=", flat shading: UNKNOWN";return v}_unBindEffect(){super._unBindEffect();for(const o of this.instances)o._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const o=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((v,V)=>v.distanceOrScreenCoverage<V.distanceOrScreenCoverage?o:v.distanceOrScreenCoverage>V.distanceOrScreenCoverage?-o:0))}addLODLevel(o,v){if(v&&v._masterMesh)return L.b.Warn("You cannot use a mesh as LOD level twice"),this;const V=new a(o,v);return this._internalMeshDataInfo._LODLevels.push(V),v&&(v._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(o){const v=this._internalMeshDataInfo;for(let V=0;V<v._LODLevels.length;V++){const g=v._LODLevels[V];if(g.distanceOrScreenCoverage===o)return g.mesh}return null}removeLODLevel(o){const v=this._internalMeshDataInfo;for(let V=0;V<v._LODLevels.length;V++)v._LODLevels[V].mesh===o&&(v._LODLevels.splice(V,1),o&&(o._masterMesh=null));return this._sortLODLevels(),this}getLOD(o,v){const V=this._internalMeshDataInfo;if(!V._LODLevels||0===V._LODLevels.length)return this;const g=v||this.getBoundingInfo().boundingSphere,E=o.mode===n.e.ORTHOGRAPHIC_CAMERA?o.Xg:g.centerWorld.Rv(o.globalPosition).length();let I=E,Q=1;if(V._useLODScreenCoverage){const v=o.screenArea;let V=g.radiusWorld*o.Xg/E;V=V*V*Math.PI,I=V/v,Q=-1}if(Q*V._LODLevels[V._LODLevels.length-1].distanceOrScreenCoverage>Q*I)return this.onLODLevelSelection&&this.onLODLevelSelection(I,this,this),this;for(let U=0;U<V._LODLevels.length;U++){const o=V._LODLevels[U];if(Q*o.distanceOrScreenCoverage<Q*I){if(o.mesh){if(4===o.mesh.delayLoadState)return o.mesh._checkDelayState(),this;if(2===o.mesh.delayLoadState)return this;o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(I,this,o.mesh),o.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(I,this,this),this}get kg(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(o,v,V,g){var E,I;if(!this._geometry)return null;let Q=g||null===(E=this._userInstancedBuffersStorage)||void 0===E||null===(I=E.vertexBuffers[o])||void 0===I?void 0:I.getFloatData(this.instances.length+1,V||v&&1!==this._geometry.meshes.length);return Q||(Q=this._geometry.getVerticesData(o,v,V)),Q}copyVerticesData(o,v){this._geometry&&this._geometry.copyVerticesData(o,v)}getVertexBuffer(o,v){var V;return this._geometry?(v||null===(V=this._userInstancedBuffersStorage)||void 0===V?void 0:V.vertexBuffers[o])??this._geometry.getVertexBuffer(o):null}isVerticesDataPresent(o,v){var V;return this._geometry?!v&&void 0!==(null===(V=this._userInstancedBuffersStorage)||void 0===V?void 0:V.vertexBuffers[o])||this._geometry.isVerticesDataPresent(o):!!this._delayInfo&&-1!==this._delayInfo.indexOf(o)}isVertexBufferUpdatable(o,v){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(o);if(!v){var V;const v=null===(V=this._userInstancedBuffersStorage)||void 0===V?void 0:V.vertexBuffers[o];if(v)return v.isUpdatable()}return this._geometry.isVertexBufferUpdatable(o)}getVerticesDataKinds(o){if(!this._geometry){const o=[];if(this._delayInfo)for(const v of this._delayInfo)o.push(v);return o}const v=this._geometry.getVerticesDataKinds();if(!o&&this._userInstancedBuffersStorage)for(const V in this._userInstancedBuffersStorage.vertexBuffers)-1===v.indexOf(V)&&v.push(V);return v}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}QQ(o,v){return this._geometry?this._geometry.QQ(o,v):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(o))return!1;if(!this.wg||0===this.wg.length)return!0;if(!o)return!0;const V=this.getEngine(),g=this.Fo(),E=v||V.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Ag();const I=this.material||g.defaultMaterial;if(I)if(I._storeEffectOnSubMeshes)for(const f of this.wg){const o=f.yo();if(o)if(o._storeEffectOnSubMeshes){if(!o.isReadyForSubMesh(this,f,E))return!1}else if(!o.isReady(this,E))return!1}else if(!I.isReady(this,E))return!1;const Q=V.currentRenderPassId;for(const f of this.lightSources){const o=f.getShadowGenerators();if(!o)continue;const v=o.values();for(let g=v.next();!0!==g.done;g=v.next()){var U,n,O,h;const o=g.value;if(o&&(null===(U=o.getShadowMap())||void 0===U||!U.renderList||null!==(n=o.getShadowMap())&&void 0!==n&&n.renderList&&-1!==(null===(O=o.getShadowMap())||void 0===O||null===(h=O.renderList)||void 0===h?void 0:h.indexOf(this)))){const v=o.getShadowMap().renderPassIds??[V.currentRenderPassId];for(let g=0;g<v.length;++g){V.currentRenderPassId=v[g];for(const v of this.wg){var x;if(!o.isReady(v,E,(null===(x=v.yo())||void 0===x?void 0:x.needAlphaBlendingForMesh(this))??!1))return V.currentRenderPassId=Q,!1}}V.currentRenderPassId=Q}}}for(const f of this._internalMeshDataInfo._LODLevels)if(f.mesh&&!f.mesh.isReady(E))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Mh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(o){this._instanceDataStorage.overridenInstanceCount=o}_preActivate(){const o=this._internalMeshDataInfo,v=this.Fo().getRenderId();return o._preActivateId===v||(o._preActivateId=v,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(o){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=o),this}_registerInstanceForRenderId(o,v){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:v,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[v]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=v,this._instanceDataStorage.visibleInstances[v]=new Array),this._instanceDataStorage.visibleInstances[v].push(o),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Mo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let o,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;o="object"===typeof v?v:{applySkeleton:v,applyMorph:V};const g=this.kg?this.kg.boundingBias:null;return this.wo(this._getData(o,null,f.e.PositionKind),g),this}_createGlobalSubMesh(o){const v=this.getTotalVertices();if(!v||!this.QQ())return null;if(this.wg&&this.wg.length>0){const V=this.QQ();if(!V)return null;const g=V.length;let E=!1;if(o)E=!0;else for(const o of this.wg){if(o.indexStart+o.indexCount>g){E=!0;break}if(o.verticesStart+o.verticesCount>v){E=!0;break}}if(!E)return this.wg[0]}return this.releaseSubMeshes(),new c.b(0,0,v,0,this.getTotalIndices()||v,this)}subdivide(o){if(o<1)return;const v=this.getTotalIndices();let V=v/o|0,g=0;for(;V%3!==0;)V++;this.releaseSubMeshes();for(let E=0;E<o&&!(g>=v);E++)c.b.CreateFromIndices(0,g,E===o-1?v-g:V,this,void 0,!1),g+=V;this.refreshBoundingInfo(),this.synchronizeInstances()}zo(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.zo(o,v,V,g);else{const g=new l.d;g.set(v,o);const E=this.Fo();new S.e(S.e.RandomId(),E,g,V,this)}return this}removeVerticesData(o){this._geometry&&this._geometry.removeVerticesData(o)}markVerticesDataAsUpdatable(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this.getVertexBuffer(o);V&&V.isUpdatable()!==v&&this.zo(o,this.getVerticesData(o),v)}setVerticesBuffer(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=S.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(o,null,v),this}updateVerticesData(o,v,V,g){return this._geometry?(g?(this.makeGeometryUnique(),this.updateVerticesData(o,v,V,!1)):this._geometry.updateVerticesData(o,v,V),this):this}updateMeshPositions(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=this.getVerticesData(f.e.PositionKind);if(!V)return this;if(o(V),this.updateVerticesData(f.e.PositionKind,V,!1,!1),v){const o=this.QQ(),v=this.getVerticesData(f.e.NormalKind);if(!v)return this;l.d.ComputeNormals(V,o,v),this.updateVerticesData(f.e.NormalKind,v,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const o=this._geometry,v=this._geometry.k(S.e.RandomId());return o.releaseForMesh(this,!0),v.Po(this),this}setIndexBuffer(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=this._geometry;E||(E=new S.e(S.e.RandomId(),this.Fo(),void 0,void 0,this)),E.setIndexBuffer(o,v,V,g)}setIndices(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(o,v,V,g);else{const v=new l.d;v.indices=o;const g=this.Fo();new S.e(S.e.RandomId(),g,v,V,this)}return this}updateIndices(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(o,v,V),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(o,v,V){let g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const E=this.Fo().getEngine();let I;if(this._unIndexed)if(this._getRenderingFillMode(V)===R.e.WireFrameFillMode)I=o._getLinesIndexBuffer(this.QQ(),E);else I=null;else switch(this._getRenderingFillMode(V)){case R.e.PointFillMode:I=null;break;case R.e.WireFrameFillMode:I=o._getLinesIndexBuffer(this.QQ(),E);break;default:case R.e.TriangleFillMode:I=this._geometry.getIndexBuffer()}return this._bindDirect(v,I,g)}_bindDirect(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(o),V&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(o,v,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(o,v),this):this}_draw(o,v,V){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const g=this.Fo().getEngine();return this._unIndexed&&v!==R.e.WireFrameFillMode||v==R.e.PointFillMode?g.drawArraysType(v,o.verticesStart,o.verticesCount,this.forcedInstanceCount||V):v==R.e.WireFrameFillMode?g.drawElementsType(v,0,o._linesIndexCount,this.forcedInstanceCount||V):g.drawElementsType(v,o.indexStart,o.indexCount,this.forcedInstanceCount||V),this}registerBeforeRender(o){return this.onBeforeRenderObservable.add(o),this}unregisterBeforeRender(o){return this.onBeforeRenderObservable.removeCallback(o),this}registerAfterRender(o){return this.onAfterRenderObservable.add(o),this}unregisterAfterRender(o){return this.onAfterRenderObservable.removeCallback(o),this}_getInstancesRenderList(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(v)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[o]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[o]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const V=this.Fo(),g=V._isInIntermediateRendering(),E=g?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,I=this._instanceDataStorage.batchCache;if(I.mustReturn=!1,I.renderSelf[o]=v||!E&&this.isEnabled()&&this.isVisible,I.visibleInstances[o]=null,this._instanceDataStorage.visibleInstances&&!v){const v=this._instanceDataStorage.visibleInstances,E=V.getRenderId(),Q=g?v.intermediateDefaultRenderId:v.defaultRenderId;I.visibleInstances[o]=v[E],!I.visibleInstances[o]&&Q&&(I.visibleInstances[o]=v[Q])}return I.hardwareInstancedRendering[o]=!v&&this._instanceDataStorage.hardwareInstancedRendering&&null!==I.visibleInstances[o]&&void 0!==I.visibleInstances[o],this._instanceDataStorage.previousBatch=I,I}_updateInstancedBuffers(o,v,V,g,E,I){const Q=v.visibleInstances[o._id],U=Q?Q.length:0,n=this._instanceDataStorage;let h=n.instancesBuffer,x=n.instancesPreviousBuffer,l=0,S=0;const T=v.renderSelf[o._id],c=!h||V!==n.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||n.isFrozen&&!c)S=(T?1:0)+U;else{const v=this.getWorldMatrix();if(T&&(this._scene.needsPreviousWorldMatrices&&(n.masterMeshPreviousWorldMatrix?(n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,l),n.masterMeshPreviousWorldMatrix.U(v)):(n.masterMeshPreviousWorldMatrix=v.clone(),n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,l))),v.copyToArray(n.instancesData,l),l+=16,S++),Q){var R;if(q.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(R=o.yo())&&void 0!==R&&R.needAlphaBlendingForMesh(o.getRenderingMesh())){const o=this._scene.activeCamera.globalPosition;for(let v=0;v<Q.length;v++){const V=Q[v];V._distanceToCamera=O.cv.Distance(V.getBoundingInfo().boundingSphere.centerWorld,o)}Q.sort(((o,v)=>o._distanceToCamera>v._distanceToCamera?-1:o._distanceToCamera<v._distanceToCamera?1:0))}for(let o=0;o<Q.length;o++){const v=Q[o],V=v.getWorldMatrix();V.copyToArray(n.instancesData,l),this._scene.needsPreviousWorldMatrices&&(v._previousWorldMatrix?(v._previousWorldMatrix.copyToArray(n.instancesPreviousData,l),v._previousWorldMatrix.U(V)):(v._previousWorldMatrix=V.clone(),v._previousWorldMatrix.copyToArray(n.instancesPreviousData,l))),l+=16,S++}}}c?(h&&h.dispose(),x&&x.dispose(),h=new f.b(g,n.instancesData,!0,16,!1,!0),n.instancesBuffer=h,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=h.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=h.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=h.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=h.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(x=new f.b(g,n.instancesPreviousData,!0,16,!1,!0),n.instancesPreviousBuffer=x,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=x.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=x.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=x.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=x.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(h.updateDirectly(n.instancesData,0,S),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||x.updateDirectly(n.instancesPreviousData,0,S)),this._processInstancedBuffers(Q,T),I&&void 0!==E&&(this.Fo()._activeIndices.addCount(o.indexCount*S,!1),g._currentDrawContext&&(g._currentDrawContext.useInstancing=!0),this._bind(o,I,E),this._draw(o,E,S)),!this._scene.needsPreviousWorldMatrices||c||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||x.updateDirectly(n.instancesData,0,S)}_renderWithInstances(o,v,V,g,E){const I=V.visibleInstances[o._id],Q=I?I.length:0,U=this._instanceDataStorage,n=U.instancesBufferSize,O=16*(Q+1)*4;for(;U.instancesBufferSize<O;)U.instancesBufferSize*=2;return U.instancesData&&n==U.instancesBufferSize||(U.instancesData=new Float32Array(U.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!U.instancesPreviousData||n!=U.instancesBufferSize)&&(U.instancesPreviousData=new Float32Array(U.instancesBufferSize/4)),this._updateInstancedBuffers(o,V,n,E,v,g),E.unbindInstanceAttributes(),this}_renderWithThinInstances(o,v,V,g){var E;const I=(null===(E=this._thinInstanceDataStorage)||void 0===E?void 0:E.instancesCount)??0;this.Fo()._activeIndices.addCount(o.indexCount*I,!1),g._currentDrawContext&&(g._currentDrawContext.useInstancing=!0),this._bind(o,V,v),this._draw(o,v,I),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,I):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),g.unbindInstanceAttributes()}_processInstancedBuffers(o,v){}_processRendering(o,v,V,g,E,I,Q,U){const n=this.Fo(),O=n.getEngine();if(g=this._getRenderingFillMode(g),I&&v.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(v,g,V,O),this;if(I)this._renderWithInstances(v,g,E,V,O);else{O._currentDrawContext&&(O._currentDrawContext.useInstancing=!1);let V=0;E.renderSelf[v._id]&&(Q&&Q(!1,o.getWorldMatrix(),U),V++,this._draw(v,g,this._instanceDataStorage.overridenInstanceCount));const I=E.visibleInstances[v._id];if(I){const o=I.length;V+=o;for(let V=0;V<o;V++){const o=I[V].getWorldMatrix();Q&&Q(!0,o,U),this._draw(v,g)}}n._activeIndices.addCount(v.indexCount*V,!1)}return this}_rebuild(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(o&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const v in this._userInstancedBuffersStorage.vertexBuffers){const V=this._userInstancedBuffersStorage.vertexBuffers[v];V&&(o&&V.dispose(),this._userInstancedBuffersStorage.vertexBuffers[v]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(o)}_freeze(){if(this.wg){for(let o=0;o<this.wg.length;o++)this._getInstancesRenderList(o);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(o,v,V,g){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const I=this._scene.getEngine(),Q=I.currentRenderPassId;if(void 0!==o&&(I.currentRenderPassId=o),g)(!E||E&&g.isInFrustum(this._scene._frustumPlanes))&&this.render(g,!!v,V);else for(let U=0;U<this.wg.length;U++){const o=this.wg[U];(!E||E&&o.isInFrustum(this._scene._frustumPlanes))&&this.render(o,!!v,V)}return void 0!==o&&(I.currentRenderPassId=Q),this}directRender(){if(!this.wg)return this;for(const o of this.wg)this.render(o,!1);return this}render(o,v,V){var g,E,I;const Q=this.Fo();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const U=(null===(g=Q.activeCameras)||void 0===g?void 0:g.length)??0;if((U>1&&Q.activeCamera===Q.activeCameras[0]||U<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const n=this._getInstancesRenderList(o._id,!!V);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const O=Q.getEngine();let h=0,x=null;this.ignoreCameraMaxZ&&Q.activeCamera&&!Q._isInIntermediateRendering()&&(h=Q.activeCamera.maxZ,x=Q.activeCamera,Q.activeCamera.maxZ=0,Q.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const f=o.getRenderingMesh(),l=n.hardwareInstancedRendering[o._id]||f.hasThinInstances||!!this._userInstancedBuffersStorage&&!o.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,S=this._instanceDataStorage,T=o.yo();if(!T)return x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),this;if(S.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===T){if(T._storeEffectOnSubMeshes&&(null===(E=o._drawWrapper)||void 0===E||!E._wasPreviouslyReady)||!T._storeEffectOnSubMeshes&&!T._getDrawWrapper()._wasPreviouslyReady)return x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),this}else{if(T._storeEffectOnSubMeshes){if(!T.isReadyForSubMesh(this,o,l))return x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),this}else if(!T.isReady(this,l))return x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=T}let c;v&&O.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),c=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?o._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const j=(null===(I=c)||void 0===I?void 0:I.effect)??null;for(const R of Q._beforeRenderingMeshStage)R.action(this,o,n,j);if(!c||!j)return x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),this;const t=V||this;let s;if(S.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.cU&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)s=S.sideOrientation;else{const o=t._getWorldMatrixDeterminant();s=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),o<0&&(s=s===R.e.ClockWiseSideOrientation?R.e.CounterClockWiseSideOrientation:R.e.ClockWiseSideOrientation),S.sideOrientation=s}const L=this._internalMeshDataInfo._effectiveMaterial._preBind(c,s);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&O.setDepthWrite(!0);const b=this._internalMeshDataInfo._effectiveMaterial,u=b.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),l||this._bind(o,j,u,!1);const mo=t.getWorldMatrix();b._storeEffectOnSubMeshes?b.bindForSubMesh(mo,this,o):b.bind(mo,this),!b.cU&&b.separateCullingPass&&(O.setState(!0,b.zOffset,!1,!L,b.cullBackFaces,b.Rg,b.zOffsetUnits),this._processRendering(this,o,j,u,n,l,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),O.setState(!0,b.zOffset,!1,L,b.cullBackFaces,b.Rg,b.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(o)),this._processRendering(this,o,j,u,n,l,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const R of Q._afterRenderingMeshStage)R.action(this,o,n,j);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),x&&(x.maxZ=h,Q.updateTransformMatrix(!0)),2!==Q.performancePriority||S.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(f.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(f.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const o=this.getVerticesData(f.e.MatricesWeightsKind),v=o.length;for(let V=0;V<v;V+=4){const v=o[V]+o[V+1]+o[V+2]+o[V+3];if(0===v)o[V]=1;else{const g=1/v;o[V]*=g,o[V+1]*=g,o[V+2]*=g,o[V+3]*=g}}this.zo(f.e.MatricesWeightsKind,o)}_normalizeSkinWeightsAndExtra(){const o=this.getVerticesData(f.e.MatricesWeightsExtraKind),v=this.getVerticesData(f.e.MatricesWeightsKind),V=v.length;for(let g=0;g<V;g+=4){let V=v[g]+v[g+1]+v[g+2]+v[g+3];if(V+=o[g]+o[g+1]+o[g+2]+o[g+3],0===V)v[g]=1;else{const E=1/V;v[g]*=E,v[g+1]*=E,v[g+2]*=E,v[g+3]*=E,o[g]*=E,o[g+1]*=E,o[g+2]*=E,o[g+3]*=E}}this.zo(f.e.MatricesWeightsKind,v),this.zo(f.e.MatricesWeightsKind,o)}validateSkinning(){const o=this.getVerticesData(f.e.MatricesWeightsExtraKind),v=this.getVerticesData(f.e.MatricesWeightsKind);if(null===v||null==this.skeleton)return{skinned:!1,valid:!0,dg:"not skinned"};const V=v.length;let g=0,E=0,I=0,Q=0;const U=null===o?4:8,n=[];for(let f=0;f<=U;f++)n[f]=0;for(let f=0;f<V;f+=4){let V=v[f],O=V,h=0===O?0:1;for(let E=1;E<U;E++){const I=E<4?v[f+E]:o[f+E-4];I>V&&g++,0!==I&&h++,O+=I,V=I}if(n[h]++,h>I&&(I=h),0===O)E++;else{const V=1/O;let g=0;for(let E=0;E<U;E++)g+=E<4?Math.abs(v[f+E]-v[f+E]*V):Math.abs(o[f+E-4]-o[f+E-4]*V);g>.001&&Q++}}const O=this.skeleton.bones.length,h=this.getVerticesData(f.e.MatricesIndicesKind),x=this.getVerticesData(f.e.MatricesIndicesExtraKind);let l=0;for(let f=0;f<V;f+=4)for(let o=0;o<U;o++){const v=o<4?h[f+o]:x[f+o-4];(v>=O||v<0)&&l++}return{skinned:!0,valid:0===E&&0===Q&&0===l,dg:"Number of Weights = "+V/4+"\nMaximum influences = "+I+"\nMissing Weights = "+E+"\nNot Sorted = "+g+"\nNot Normalized = "+Q+"\nWeightCounts = ["+n+"]\nNumber of bones = "+O+"\nBad Bone Indices = "+l}}_checkDelayState(){const o=this.Fo();return this._geometry?this._geometry.load(o):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(o)),this}_queueLoad(o){o.addPendingData(this);const v=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return E.Tools.LoadFile(this.delayLoadingFile,(v=>{v instanceof ArrayBuffer?this._delayLoadingFunction(v,this):this._delayLoadingFunction(JSON.parse(v),this);for(const o of this.instances)o.refreshBoundingInfo(),o._syncSubMeshes();this.delayLoadState=1,o.removePendingData(this)}),(()=>{}),o.offlineProvider,v),this}isInFrustum(o){return 2!==this.delayLoadState&&(!!super.isInFrustum(o)&&(this._checkDelayState(),!0))}setMaterialById(o){const v=this.Fo().materials;let V;for(V=v.length-1;V>-1;V--)if(v[V].id===o)return this.material=v[V],this;const g=this.Fo().multiMaterials;for(V=g.length-1;V>-1;V--)if(g[V].id===o)return this.material=g[V],this;return this}getAnimatables(){const o=[];return this.material&&o.push(this.material),this.skeleton&&o.push(this.skeleton),o}bakeTransformIntoVertices(o){if(!this.isVerticesDataPresent(f.e.PositionKind))return this;const v=this.wg.splice(0);this._resetPointsArrayCache();let V=this.getVerticesData(f.e.PositionKind);const g=O.cv.Zero();let E;for(E=0;E<V.length;E+=3)O.cv.TransformCoordinatesFromFloatsToRef(V[E],V[E+1],V[E+2],o,g).toArray(V,E);if(this.zo(f.e.PositionKind,V,this.getVertexBuffer(f.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(f.e.NormalKind)){for(V=this.getVerticesData(f.e.NormalKind),E=0;E<V.length;E+=3)O.cv.TransformNormalFromFloatsToRef(V[E],V[E+1],V[E+2],o,g).normalize().toArray(V,E);this.zo(f.e.NormalKind,V,this.getVertexBuffer(f.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(f.e.TangentKind)){for(V=this.getVerticesData(f.e.TangentKind),E=0;E<V.length;E+=4)O.cv.TransformNormalFromFloatsToRef(V[E],V[E+1],V[E+2],o,g).normalize().toArray(V,E);this.zo(f.e.TangentKind,V,this.getVertexBuffer(f.e.TangentKind).isUpdatable())}return o.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.wg=v,this}bakeCurrentTransformIntoVertices(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Ag(!0)),this.resetLocalMatrix(o),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(v&&void 0===v._addToSceneRootNodes){const V=v;return Y.source=this,Y.doNotCloneChildren=V.doNotCloneChildren,Y.clonePhysicsImpostor=V.clonePhysicsImpostor,Y.cloneThinInstances=V.cloneThinInstances,new q(o,this.Fo(),Y)}return new q(o,this.Fo(),v,this,V,g)}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const V=this._internalMeshDataInfo;if(V._onBeforeDrawObservable&&V._onBeforeDrawObservable.clear(),V._onBeforeBindObservable&&V._onBeforeBindObservable.clear(),V._onBeforeRenderObservable&&V._onBeforeRenderObservable.clear(),V._onAfterRenderObservable&&V._onAfterRenderObservable.clear(),V._onBetweenPassObservable&&V._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(V.meshMap)for(const o in V.meshMap){const v=V.meshMap[o];v&&(v._internalMeshDataInfo._source=null,V.meshMap[o]=void 0)}V._source&&V._source._internalMeshDataInfo.meshMap&&(V._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const o=this.Fo().meshes;for(const v of o){const o=v;o._internalMeshDataInfo&&o._internalMeshDataInfo._source&&o._internalMeshDataInfo._source===this&&(o._internalMeshDataInfo._source=null)}}V._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(o,v)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(o,v,V,g,I,Q){let U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0;const O=this.Fo();return E.Tools.LoadImage(o,(o=>{const E=o.width,n=o.height,O=this.getEngine().createCanvas(E,n).getContext("2d");O.drawImage(o,0,0);const h=O.getImageData(0,0,E,n).data;this.applyDisplacementMapFromBuffer(h,E,n,v,V,I,Q,U),g&&g(this)}),n||(()=>{}),O.offlineProvider),this}applyDisplacementMapFromBuffer(o,v,V,g,E,I,Q){let U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(f.e.PositionKind)||!this.isVerticesDataPresent(f.e.NormalKind)||!this.isVerticesDataPresent(f.e.UVKind))return L.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const n=this.getVerticesData(f.e.PositionKind,!0,!0),h=this.getVerticesData(f.e.NormalKind),x=this.getVerticesData(f.e.UVKind);let S=O.cv.Zero();const T=O.cv.Zero(),c=O.Vector2.Zero();I=I||O.Vector2.Zero(),Q=Q||new O.Vector2(1,1);for(let f=0;f<n.length;f+=3){O.cv.FromArrayToRef(n,f,S),O.cv.FromArrayToRef(h,f,T),O.Vector2.FromArrayToRef(x,f/3*2,c);const U=4*((Math.abs(c.x*Q.x+I.x%1)*(v-1)%v|0)+(Math.abs(c.y*Q.y+I.y%1)*(V-1)%V|0)*v),l=.3*(o[U]/255)+.59*(o[U+1]/255)+.11*(o[U+2]/255);T.normalize(),T.scaleInPlace(g+(E-g)*l),S=S.add(T),S.toArray(n,f)}return l.d.ComputeNormals(n,this.QQ(),h),U?(this.zo(f.e.PositionKind,n),this.zo(f.e.NormalKind,h),this.zo(f.e.UVKind,x)):(this.updateVerticesData(f.e.PositionKind,n),this.updateVerticesData(f.e.NormalKind,h)),this}_getFlattenedNormals(o,v){const V=new Float32Array(3*o.length);let g=0;const E=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let I=0;I<o.length;I+=3){const Q=O.cv.bv(v,3*o[I]),U=O.cv.bv(v,3*o[I+1]),n=O.cv.bv(v,3*o[I+2]),h=Q.Rv(U),x=n.Rv(U),f=O.cv.Normalize(O.cv.Cross(h,x));E&&f.scaleInPlace(-1);for(let o=0;o<3;o++)V[g++]=f.x,V[g++]=f.y,V[g++]=f.z}return V}_convertToUnIndexedMesh(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this.getVerticesDataKinds().filter((o=>{var v;return!(null!==(v=this.getVertexBuffer(o))&&void 0!==v&&v.getIsInstanced())})),V=this.QQ(),g={},E=(o,v)=>{const g=new Float32Array(V.length*v);let E=0;for(let I=0;I<V.length;I++)for(let Q=0;Q<v;Q++)g[E++]=o[V[I]*v+Q];return g},I=this.getBoundingInfo(),Q=this.kg?this.wg.slice(0):[];for(const U of v)g[U]=this.getVerticesData(U);for(const U of v){const v=this.getVertexBuffer(U),I=v.getSize();if(o&&U===f.e.NormalKind){const o=this._getFlattenedNormals(V,g[f.e.PositionKind]);this.zo(f.e.NormalKind,o,v.isUpdatable(),I)}else this.zo(U,E(g[U],I),v.isUpdatable(),I)}if(this.morphTargetManager){for(let v=0;v<this.morphTargetManager.numTargets;v++){const g=this.morphTargetManager.getTarget(v),I=g.getPositions();g.setPositions(E(I,3));const Q=g.getNormals();Q&&g.setNormals(o?this._getFlattenedNormals(V,I):E(Q,3));const U=g.getTangents();U&&g.setTangents(E(U,3));const n=g.getUVs();n&&g.setUVs(E(n,2));const O=g.getColors();O&&g.setColors(E(O,4))}this.morphTargetManager.synchronize()}for(let U=0;U<V.length;U++)V[U]=U;this.setIndices(V),this._unIndexed=!0,this.releaseSubMeshes();for(const U of Q){const o=U.getBoundingInfo();c.b.AddToMesh(U.materialIndex,U.indexStart,U.indexCount,U.indexStart,U.indexCount,this).setBoundingInfo(o)}return this.setBoundingInfo(I),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=l.d.ExtractFromMesh(this);let V;if(o&&this.isVerticesDataPresent(f.e.NormalKind)&&v.do){for(V=0;V<v.do.length;V++)v.do[V]*=-1;this.zo(f.e.NormalKind,v.do,this.isVertexBufferUpdatable(f.e.NormalKind))}if(v.indices){let o;for(V=0;V<v.indices.length;V+=3)o=v.indices[V+1],v.indices[V+1]=v.indices[V+2],v.indices[V+2]=o;this.setIndices(v.indices,null,this.isVertexBufferUpdatable(f.e.PositionKind),!0)}return this}increaseVertices(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const v=l.d.ExtractFromMesh(this),V=v.indices&&!Array.isArray(v.indices)&&Array.from?Array.from(v.indices):v.indices,g=v.Jo&&!Array.isArray(v.Jo)&&Array.from?Array.from(v.Jo):v.Jo,E=v.Yo&&!Array.isArray(v.Yo)&&Array.from?Array.from(v.Yo):v.Yo,I=v.do&&!Array.isArray(v.do)&&Array.from?Array.from(v.do):v.do;if(V&&g){v.indices=V,v.Jo=g,E&&(v.Yo=E),I&&(v.do=I);const Q=o+1,U=[];for(let o=0;o<Q+1;o++)U[o]=[];let n,h;const x=new O.cv(0,0,0),l=new O.cv(0,0,0),S=new O.Vector2(0,0),T=[],c=[],R=[];let j,t,s,L=g.length;E&&(t=E.length),I&&(s=I.length);for(let o=0;o<V.length;o+=3){c[0]=V[o],c[1]=V[o+1],c[2]=V[o+2];for(let o=0;o<3;o++)if(n=c[o],h=c[(o+1)%3],void 0===R[n]&&void 0===R[h]?(R[n]=[],R[h]=[]):(void 0===R[n]&&(R[n]=[]),void 0===R[h]&&(R[h]=[])),void 0===R[n][h]&&void 0===R[h][n]){R[n][h]=[],x.x=(g[3*h]-g[3*n])/Q,x.y=(g[3*h+1]-g[3*n+1])/Q,x.z=(g[3*h+2]-g[3*n+2])/Q,I&&(l.x=(I[3*h]-I[3*n])/Q,l.y=(I[3*h+1]-I[3*n+1])/Q,l.z=(I[3*h+2]-I[3*n+2])/Q),E&&(S.x=(E[2*h]-E[2*n])/Q,S.y=(E[2*h+1]-E[2*n+1])/Q),R[n][h].push(n);for(let o=1;o<Q;o++)R[n][h].push(g.length/3),g[L++]=g[3*n]+o*x.x,g[L++]=g[3*n+1]+o*x.y,g[L++]=g[3*n+2]+o*x.z,I&&(I[s++]=I[3*n]+o*l.x,I[s++]=I[3*n+1]+o*l.y,I[s++]=I[3*n+2]+o*l.z),E&&(E[t++]=E[2*n]+o*S.x,E[t++]=E[2*n+1]+o*S.y);R[n][h].push(h),R[h][n]=[],j=R[n][h].length;for(let o=0;o<j;o++)R[h][n][o]=R[n][h][j-1-o]}U[0][0]=V[o],U[1][0]=R[V[o]][V[o+1]][1],U[1][1]=R[V[o]][V[o+2]][1];for(let v=2;v<Q;v++){U[v][0]=R[V[o]][V[o+1]][v],U[v][v]=R[V[o]][V[o+2]][v],x.x=(g[3*U[v][v]]-g[3*U[v][0]])/v,x.y=(g[3*U[v][v]+1]-g[3*U[v][0]+1])/v,x.z=(g[3*U[v][v]+2]-g[3*U[v][0]+2])/v,I&&(l.x=(I[3*U[v][v]]-I[3*U[v][0]])/v,l.y=(I[3*U[v][v]+1]-I[3*U[v][0]+1])/v,l.z=(I[3*U[v][v]+2]-I[3*U[v][0]+2])/v),E&&(S.x=(E[2*U[v][v]]-E[2*U[v][0]])/v,S.y=(E[2*U[v][v]+1]-E[2*U[v][0]+1])/v);for(let o=1;o<v;o++)U[v][o]=g.length/3,g[L++]=g[3*U[v][0]]+o*x.x,g[L++]=g[3*U[v][0]+1]+o*x.y,g[L++]=g[3*U[v][0]+2]+o*x.z,I&&(I[s++]=I[3*U[v][0]]+o*l.x,I[s++]=I[3*U[v][0]+1]+o*l.y,I[s++]=I[3*U[v][0]+2]+o*l.z),E&&(E[t++]=E[2*U[v][0]]+o*S.x,E[t++]=E[2*U[v][0]+1]+o*S.y)}U[Q]=R[V[o+1]][V[o+2]],T.push(U[0][0],U[1][0],U[1][1]);for(let o=1;o<Q;o++){let v;for(v=0;v<o;v++)T.push(U[o][v],U[o+1][v],U[o+1][v+1]),T.push(U[o][v],U[o+1][v+1],U[o][v+1]);T.push(U[o][v],U[o+1][v],U[o+1][v+1])}}v.indices=T,v.Po(this,this.isVertexBufferUpdatable(f.e.PositionKind))}else L.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const o=l.d.ExtractFromMesh(this),v=o.Yo,V=o.indices,g=o.Jo,E=o.No,I=o.matricesIndices,Q=o.matricesWeights,U=o.matricesIndicesExtra,n=o.matricesWeightsExtra;if(void 0===V||void 0===g||null===V||null===g)L.b.Warn("VertexData contains empty entries");else{const O=[],h=[],x=[],S=[],T=[],c=[],R=[],j=[];let t=[],s=0;const L={};let b,u;for(let o=0;o<V.length;o+=3){u=[V[o],V[o+1],V[o+2]],t=[];for(let o=0;o<3;o++){t[o]="";for(let v=0;v<3;v++)Math.abs(g[3*u[o]+v])<1e-8&&(g[3*u[o]+v]=0),t[o]+=g[3*u[o]+v]+"|"}if(t[0]!=t[1]&&t[0]!=t[2]&&t[1]!=t[2])for(let o=0;o<3;o++){if(b=L[t[o]],void 0===b){L[t[o]]=s,b=s++;for(let v=0;v<3;v++)O.push(g[3*u[o]+v]);if(null!==E&&void 0!==E)for(let v=0;v<4;v++)S.push(E[4*u[o]+v]);if(null!==v&&void 0!==v)for(let V=0;V<2;V++)x.push(v[2*u[o]+V]);if(null!==I&&void 0!==I)for(let v=0;v<4;v++)T.push(I[4*u[o]+v]);if(null!==Q&&void 0!==Q)for(let v=0;v<4;v++)c.push(Q[4*u[o]+v]);if(null!==U&&void 0!==U)for(let v=0;v<4;v++)R.push(U[4*u[o]+v]);if(null!==n&&void 0!==n)for(let v=0;v<4;v++)j.push(n[4*u[o]+v])}h.push(b)}}const mo=[];l.d.ComputeNormals(O,h,mo),o.Jo=O,o.indices=h,o.do=mo,null!==v&&void 0!==v&&(o.Yo=x),null!==E&&void 0!==E&&(o.No=S),null!==I&&void 0!==I&&(o.matricesIndices=T),null!==Q&&void 0!==Q&&(o.matricesWeights=c),null!==U&&void 0!==U&&(o.matricesIndicesExtra=R),null!==Q&&void 0!==Q&&(o.matricesWeightsExtra=j),o.Po(this,this.isVertexBufferUpdatable(f.e.PositionKind))}}static _instancedMeshFactory(o,v){throw(0,u.b)("InstancedMesh")}static _PhysicsImpostorParser(o,v,V){throw(0,u.b)("PhysicsImpostor")}createInstance(o){const v=q._instancedMeshFactory(o,this);return v.parent=this.parent,v}synchronizeInstances(){for(let o=0;o<this.instances.length;o++){this.instances[o]._syncSubMeshes()}return this}optimizeIndices(o){const v=this.QQ(),V=this.getVerticesData(f.e.PositionKind);if(!V||!v)return this;const g=[];for(let E=0;E<V.length;E+=3)g.push(O.cv.bv(V,E));const I=[];return E.AsyncLoop.SyncAsyncForLoop(g.length,40,(o=>{const v=g.length-1-o,V=g[v];for(let E=0;E<v;++E){const o=g[E];if(V.equals(o)){I[v]=E;break}}}),(()=>{for(let o=0;o<v.length;++o)v[o]=I[v[o]]||v[o];const V=this.wg.slice(0);this.setIndices(v),this.wg=V,o&&o(this)})),this}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.name=this.name,o.id=this.id,o.uniqueId=this.uniqueId,o.type=this.getClassName(),Q.e&&Q.e.HasTags(this)&&(o.tags=Q.e.GetTags(this)),o.position=this.position.Dg(),this.rotationQuaternion?o.rotationQuaternion=this.rotationQuaternion.Dg():this.rotation&&(o.rotation=this.rotation.Dg()),o.jU=this.jU.Dg(),this._postMultiplyPivotMatrix?o.pivotMatrix=this.getPivotMatrix().Dg():o.localMatrix=this.getPivotMatrix().Dg(),o.isEnabled=this.isEnabled(!1),o.isVisible=this.isVisible,o.infiniteDistance=this.infiniteDistance,o.pickable=this.wn,o.receiveShadows=this.receiveShadows,o.billboardMode=this.billboardMode,o.visibility=this.visibility,o.WO=this.WO,o.checkCollisions=this.checkCollisions,o.ellipsoid=this.ellipsoid.Dg(),o.ellipsoidOffset=this.ellipsoidOffset.Dg(),o.Mo=this.Mo,o.isBlocker=this.isBlocker,o.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(o),o.isUnIndexed=this.isUnIndexed;const v=this._geometry;if(v&&this.wg){o.geometryUniqueId=v.uniqueId,o.geometryId=v.id,o.wg=[];for(let v=0;v<this.wg.length;v++){const V=this.wg[v];o.wg.push({materialIndex:V.materialIndex,verticesStart:V.verticesStart,verticesCount:V.verticesCount,indexStart:V.indexStart,indexCount:V.indexCount})}}if(this.material?this.material.doNotSerialize||(o.materialUniqueId=this.material.uniqueId,o.materialId=this.material.id):(this.material=null,o.materialUniqueId=this._scene.defaultMaterial.uniqueId,o.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(o.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(o.skeletonId=this.skeleton.id,o.numBoneInfluencers=this.numBoneInfluencers),this.Fo()._getComponent(mo.d.NAME_PHYSICSENGINE)){const v=this.getPhysicsImpostor();v&&(o.physicsMass=v.getParam("NE"),o.physicsFriction=v.getParam("friction"),o.physicsRestitution=v.getParam("NE"),o.physicsImpostor=v.type)}this.metadata&&(o.metadata=this.metadata),o.instances=[];for(let V=0;V<this.instances.length;V++){const v=this.instances[V];if(v.doNotSerialize)continue;const g={name:v.name,id:v.id,isEnabled:v.isEnabled(!1),isVisible:v.isVisible,wn:v.wn,checkCollisions:v.checkCollisions,position:v.position.Dg(),jU:v.jU.Dg()};if(v.parent&&v.parent._serializeAsParent(g),v.rotationQuaternion?g.rotationQuaternion=v.rotationQuaternion.Dg():v.rotation&&(g.rotation=v.rotation.Dg()),this.Fo()._getComponent(mo.d.NAME_PHYSICSENGINE)){const o=v.getPhysicsImpostor();o&&(g.physicsMass=o.getParam("NE"),g.physicsFriction=o.getParam("friction"),g.physicsRestitution=o.getParam("NE"),g.physicsImpostor=o.type)}v.metadata&&(g.metadata=v.metadata),v.actionManager&&(g.actions=v.actionManager.serialize(v.name)),o.instances.push(g),s.c.AppendSerializedAnimations(v,g),g.ranges=v.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(o.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.cO},this._userThinInstanceBuffersStorage)){const v={data:{},sizes:{},strides:{}};for(const o in this._userThinInstanceBuffersStorage.data)v.data[o]=Array.from(this._userThinInstanceBuffersStorage.data[o]),v.sizes[o]=this._userThinInstanceBuffersStorage.sizes[o],v.strides[o]=this._userThinInstanceBuffersStorage.strides[o];o.thinInstances.userThinInstance=v}return s.c.AppendSerializedAnimations(this,o),o.ranges=this.serializeAnimationRanges(),o.layerMask=this.layerMask,o.alphaIndex=this.alphaIndex,o.hasVertexAlpha=this.hasVertexAlpha,o.overlayAlpha=this.overlayAlpha,o.overlayColor=this.overlayColor.Dg(),o.renderOverlay=this.renderOverlay,o.applyFog=this.applyFog,this.actionManager&&(o.actions=this.actionManager.serialize(this.name)),o}_syncGeometryWithMorphTargetManager(){if(!this.kg)return;this._markSubMeshesAsAttributesDirty();const o=this._internalAbstractMeshDataInfo._morphTargetManager;if(o&&o.vertexCount){if(o.vertexCount!==this.getTotalVertices())return L.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(o.isUsingTextureForTargets)return;for(let v=0;v<o.numInfluencers;v++){const V=o.getActiveTarget(v),g=V.getPositions();if(!g)return void L.b.Error("Invalid morph target. Target must have positions.");this.kg.zo(f.e.PositionKind+v,g,!1,3);const E=V.getNormals();E&&this.kg.zo(f.e.NormalKind+v,E,!1,3);const I=V.getTangents();I&&this.kg.zo(f.e.TangentKind+v,I,!1,3);const Q=V.getUVs();Q&&this.kg.zo(f.e.UVKind+"_"+v,Q,!1,2);const U=V.getUV2s();U&&this.kg.zo(f.e.UV2Kind+"_"+v,U,!1,2);const n=V.getColors();n&&this.kg.zo(f.e.ColorKind+v,n,!1,4)}}else{let o=0;for(;this.kg.isVerticesDataPresent(f.e.PositionKind+o);)this.kg.removeVerticesData(f.e.PositionKind+o),this.kg.isVerticesDataPresent(f.e.NormalKind+o)&&this.kg.removeVerticesData(f.e.NormalKind+o),this.kg.isVerticesDataPresent(f.e.TangentKind+o)&&this.kg.removeVerticesData(f.e.TangentKind+o),this.kg.isVerticesDataPresent(f.e.UVKind+o)&&this.kg.removeVerticesData(f.e.UVKind+"_"+o),this.kg.isVerticesDataPresent(f.e.UV2Kind+o)&&this.kg.removeVerticesData(f.e.UV2Kind+"_"+o),this.kg.isVerticesDataPresent(f.e.ColorKind+o)&&this.kg.removeVerticesData(f.e.ColorKind+o),o++}}static Parse(o,v,V){let g;if(g=o.type&&"LinesMesh"===o.type?q._LinesMeshParser(o,v):o.type&&"GroundMesh"===o.type?q._GroundMeshParser(o,v):o.type&&"GoldbergMesh"===o.type?q._GoldbergMeshParser(o,v):o.type&&"GreasedLineMesh"===o.type?q._GreasedLineMeshParser(o,v):o.type&&"TrailMesh"===o.type?q._TrailMeshParser(o,v):new q(o.name,v),g.id=o.id,g._waitingParsedUniqueId=o.uniqueId,Q.e&&Q.e.AddTagsTo(g,o.tags),g.position=O.cv.bv(o.position),void 0!==o.metadata&&(g.metadata=o.metadata),o.rotationQuaternion?g.rotationQuaternion=O.Quaternion.bv(o.rotationQuaternion):o.rotation&&(g.rotation=O.cv.bv(o.rotation)),g.jU=O.cv.bv(o.jU),o.localMatrix?g.setPreTransformMatrix(O.Matrix.bv(o.localMatrix)):o.pivotMatrix&&g.setPivotMatrix(O.Matrix.bv(o.pivotMatrix)),g.eU(o.isEnabled),g.isVisible=o.isVisible,g.infiniteDistance=o.infiniteDistance,g.WO=!!o.WO,g.showBoundingBox=o.showBoundingBox,g.showSubMeshesBoundingBox=o.showSubMeshesBoundingBox,void 0!==o.applyFog&&(g.applyFog=o.applyFog),void 0!==o.pickable&&(g.wn=o.pickable),void 0!==o.alphaIndex&&(g.alphaIndex=o.alphaIndex),g.receiveShadows=o.receiveShadows,void 0!==o.billboardMode&&(g.billboardMode=o.billboardMode),void 0!==o.visibility&&(g.visibility=o.visibility),g.checkCollisions=o.checkCollisions,g.Mo=!!o.Mo,o.ellipsoid&&(g.ellipsoid=O.cv.bv(o.ellipsoid)),o.ellipsoidOffset&&(g.ellipsoidOffset=O.cv.bv(o.ellipsoidOffset)),null!=o.overrideMaterialSideOrientation&&(g.sideOrientation=o.overrideMaterialSideOrientation),void 0!==o.sideOrientation&&(g.sideOrientation=o.sideOrientation),void 0!==o.isBlocker&&(g.isBlocker=o.isBlocker),g._shouldGenerateFlatShading=o.useFlatShading,o.dU&&(g._waitingData.dU=o.dU),void 0!==o.parentId&&(g._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(g._waitingParentInstanceIndex=o.parentInstanceIndex),void 0!==o.actions&&(g._waitingData.actions=o.actions),void 0!==o.overlayAlpha&&(g.overlayAlpha=o.overlayAlpha),void 0!==o.overlayColor&&(g.overlayColor=h.Lv.bv(o.overlayColor)),void 0!==o.renderOverlay&&(g.renderOverlay=o.renderOverlay),g.isUnIndexed=!!o.isUnIndexed,g.hasVertexAlpha=o.hasVertexAlpha,o.delayLoadingFile?(g.delayLoadState=4,g.delayLoadingFile=V+o.delayLoadingFile,g.buildBoundingInfo(O.cv.bv(o.boundingBoxMinimum),O.cv.bv(o.boundingBoxMaximum)),o._binaryInfo&&(g._binaryInfo=o._binaryInfo),g._delayInfo=[],o.hasUVs&&g._delayInfo.push(f.e.UVKind),o.hasUVs2&&g._delayInfo.push(f.e.UV2Kind),o.hasUVs3&&g._delayInfo.push(f.e.UV3Kind),o.hasUVs4&&g._delayInfo.push(f.e.UV4Kind),o.hasUVs5&&g._delayInfo.push(f.e.UV5Kind),o.hasUVs6&&g._delayInfo.push(f.e.UV6Kind),o.hasColors&&g._delayInfo.push(f.e.ColorKind),o.hasMatricesIndices&&g._delayInfo.push(f.e.MatricesIndicesKind),o.hasMatricesWeights&&g._delayInfo.push(f.e.MatricesWeightsKind),g._delayLoadingFunction=S.e._ImportGeometry,t.e.ForceFullSceneLoadingForIncremental&&g._checkDelayState()):S.e._ImportGeometry(o,g),o.materialUniqueId?g._waitingMaterialId=o.materialUniqueId:o.materialId&&(g._waitingMaterialId=o.materialId),o.morphTargetManagerId>-1&&(g._waitingMorphTargetManagerId=o.morphTargetManagerId),void 0!==o.skeletonId&&null!==o.skeletonId&&(g.skeleton=v.getLastSkeletonById(o.skeletonId),o.numBoneInfluencers&&(g.numBoneInfluencers=o.numBoneInfluencers)),o.animations){for(let v=0;v<o.animations.length;v++){const V=o.animations[v],E=(0,b.d)("BABYLON.Animation");E&&g.animations.push(E.Parse(V))}x.c.ParseAnimationRanges(g,o,v)}if(o.autoAnimate&&v.beginAnimation(g,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),o.layerMask&&!isNaN(o.layerMask)?g.layerMask=Math.abs(parseInt(o.layerMask)):g.layerMask=268435455,o.physicsImpostor&&(g.physicsImpostor=q._PhysicsImpostorParser(v,g,o)),o.lodMeshIds&&(g._waitingData.lods={ids:o.lodMeshIds,distances:o.lodDistances?o.lodDistances:null,coverages:o.lodCoverages?o.lodCoverages:null}),o.instances)for(let E=0;E<o.instances.length;E++){const V=o.instances[E],I=g.createInstance(V.name);if(V.id&&(I.id=V.id),Q.e&&(V.tags?Q.e.AddTagsTo(I,V.tags):Q.e.AddTagsTo(I,o.tags)),I.position=O.cv.bv(V.position),void 0!==V.metadata&&(I.metadata=V.metadata),void 0!==V.parentId&&(I._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(I._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.isEnabled&&null!==V.isEnabled&&I.eU(V.isEnabled),void 0!==V.isVisible&&null!==V.isVisible&&(I.isVisible=V.isVisible),void 0!==V.wn&&null!==V.wn&&(I.wn=V.wn),V.rotationQuaternion?I.rotationQuaternion=O.Quaternion.bv(V.rotationQuaternion):V.rotation&&(I.rotation=O.cv.bv(V.rotation)),I.jU=O.cv.bv(V.jU),void 0!=V.checkCollisions&&null!=V.checkCollisions&&(I.checkCollisions=V.checkCollisions),void 0!=V.pickable&&null!=V.pickable&&(I.wn=V.pickable),void 0!=V.showBoundingBox&&null!=V.showBoundingBox&&(I.showBoundingBox=V.showBoundingBox),void 0!=V.showSubMeshesBoundingBox&&null!=V.showSubMeshesBoundingBox&&(I.showSubMeshesBoundingBox=V.showSubMeshesBoundingBox),void 0!=V.alphaIndex&&null!=V.showSubMeshesBoundingBox&&(I.alphaIndex=V.alphaIndex),V.physicsImpostor&&(I.physicsImpostor=q._PhysicsImpostorParser(v,I,V)),void 0!==V.actions&&(I._waitingData.actions=V.actions),V.animations){for(let o=0;o<V.animations.length;o++){const v=V.animations[o],g=(0,b.d)("BABYLON.Animation");g&&I.animations.push(g.Parse(v))}x.c.ParseAnimationRanges(I,V,v),V.autoAnimate&&v.beginAnimation(I,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1)}}if(o.thinInstances){const v=o.thinInstances;if(g.cO=!!v.enablePicking,v.matrixData?(g.Hx("matrix",new Float32Array(v.matrixData),16,!1),g._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,g._thinInstanceDataStorage.instancesCount=v.instancesCount):g._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,o.thinInstances.userThinInstance){const v=o.thinInstances.userThinInstance;for(const o in v.data)g.Hx(o,new Float32Array(v.data[o]),v.strides[o],!1),g._userThinInstanceBuffersStorage.sizes[o]=v.sizes[o]}}return g}setPositionsForCPUSkinning(){const o=this._internalMeshDataInfo;if(!o._sourcePositions){const v=this.getVerticesData(f.e.PositionKind);if(!v)return o._sourcePositions;o._sourcePositions=new Float32Array(v),this.isVertexBufferUpdatable(f.e.PositionKind)||this.zo(f.e.PositionKind,v,!0)}return o._sourcePositions}setNormalsForCPUSkinning(){const o=this._internalMeshDataInfo;if(!o._sourceNormals){const v=this.getVerticesData(f.e.NormalKind);if(!v)return o._sourceNormals;o._sourceNormals=new Float32Array(v),this.isVertexBufferUpdatable(f.e.NormalKind)||this.zo(f.e.NormalKind,v,!0)}return o._sourceNormals}applySkeleton(o){if(!this.kg)return this;if(this.kg._softwareSkinningFrameId==this.Fo().getFrameId())return this;if(this.kg._softwareSkinningFrameId=this.Fo().getFrameId(),!this.isVerticesDataPresent(f.e.PositionKind))return this;if(!this.isVerticesDataPresent(f.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(f.e.MatricesWeightsKind))return this;const v=this.isVerticesDataPresent(f.e.NormalKind),V=this._internalMeshDataInfo;if(!V._sourcePositions){const o=this.wg.slice();this.setPositionsForCPUSkinning(),this.wg=o}v&&!V._sourceNormals&&this.setNormalsForCPUSkinning();let g=this.getVerticesData(f.e.PositionKind);if(!g)return this;g instanceof Float32Array||(g=new Float32Array(g));let E=this.getVerticesData(f.e.NormalKind);if(v){if(!E)return this;E instanceof Float32Array||(E=new Float32Array(E))}const I=this.getVerticesData(f.e.MatricesIndicesKind),Q=this.getVerticesData(f.e.MatricesWeightsKind);if(!Q||!I)return this;const U=this.numBoneInfluencers>4,n=U?this.getVerticesData(f.e.MatricesIndicesExtraKind):null,h=U?this.getVerticesData(f.e.MatricesWeightsExtraKind):null,x=o.getTransformMatrices(this),l=O.cv.Zero(),S=new O.Matrix,T=new O.Matrix;let c,R=0;for(let f=0;f<g.length;f+=3,R+=4){let o;for(c=0;c<4;c++)o=Q[R+c],o>0&&(O.Matrix.FromFloat32ArrayToRefScaled(x,Math.floor(16*I[R+c]),o,T),S.addToSelf(T));if(U)for(c=0;c<4;c++)o=h[R+c],o>0&&(O.Matrix.FromFloat32ArrayToRefScaled(x,Math.floor(16*n[R+c]),o,T),S.addToSelf(T));O.cv.TransformCoordinatesFromFloatsToRef(V._sourcePositions[f],V._sourcePositions[f+1],V._sourcePositions[f+2],S,l),l.toArray(g,f),v&&(O.cv.TransformNormalFromFloatsToRef(V._sourceNormals[f],V._sourceNormals[f+1],V._sourceNormals[f+2],S,l),l.toArray(E,f)),S.reset()}return this.updateVerticesData(f.e.PositionKind,g),v&&this.updateVerticesData(f.e.NormalKind,E),this}static MinMax(o){let v=null,V=null;for(const g of o){const o=g.getBoundingInfo().boundingBox;v&&V?(v.minimizeInPlace(o.minimumWorld),V.maximizeInPlace(o.maximumWorld)):(v=o.minimumWorld,V=o.maximumWorld)}return v&&V?{min:v,max:V}:{min:O.cv.Zero(),max:O.cv.Zero()}}static Center(o){const v=o instanceof Array?q.MinMax(o):o;return O.cv.Center(v.min,v.max)}static MergeMeshes(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5?arguments[5]:void 0;return(0,U.m)(q._MergeMeshesCoroutine(o,v,V,g,E,I,!1))}static async MergeMeshesAsync(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],V=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5?arguments[5]:void 0;return await(0,U.j)(q._MergeMeshesCoroutine(o,v,V,g,E,I,!0),(0,U.c)())}static*_MergeMeshesCoroutine(o){let v,V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=arguments.length>2?arguments[2]:void 0,E=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;if(0===(o=o.filter(Boolean)).length)return null;if(!g){let V=0;for(v=0;v<o.length;v++)if(V+=o[v].getTotalVertices(),V>=65536)return L.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}Q&&(I=!1);const n=new Array,O=new Array,h=new Array,x=o[0].sideOrientation;for(v=0;v<o.length;v++){const V=o[v];if(V.isAnInstance)return L.b.Warn("Cannot merge instance meshes."),null;if(x!==V.sideOrientation)return L.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(I&&h.push(V.getTotalIndices()),Q)if(V.material){const o=V.material;if(o instanceof j.e){for(let v=0;v<o.LU.length;v++)n.indexOf(o.LU[v])<0&&n.push(o.LU[v]);for(let v=0;v<V.wg.length;v++)O.push(n.indexOf(o.LU[V.wg[v].materialIndex])),h.push(V.wg[v].indexCount)}else{n.indexOf(o)<0&&n.push(o);for(let v=0;v<V.wg.length;v++)O.push(n.indexOf(o)),h.push(V.wg[v].indexCount)}}else for(let o=0;o<V.wg.length;o++)O.push(0),h.push(V.wg[o].indexCount)}const f=o[0],S=o=>{const v=o.Ag(!0);return{vertexData:l.d.ExtractFromMesh(o,!1,!1),transform:v}},{vertexData:T,transform:R}=S(f);U&&(yield);const t=new Array(o.length-1);for(let l=1;l<o.length;l++)t[l-1]=S(o[l]),U&&(yield);const s=T._mergeCoroutine(R,t,g,U,!V);let b=s.next();for(;!b.done;)U&&(yield),b=s.next();const u=b.value;E||(E=new q(f.name+"_merged",f.Fo()));const mo=u._applyToCoroutine(E,void 0,U);let a=mo.next();for(;!a.done;)U&&(yield),a=mo.next();if(E.checkCollisions=f.checkCollisions,E.sideOrientation=f.sideOrientation,V)for(v=0;v<o.length;v++)o[v].dispose();if(I||Q){E.releaseSubMeshes(),v=0;let o=0;for(;v<h.length;)c.b.CreateFromIndices(0,o,h[v],E,void 0,!1),o+=h[v],v++;for(const v of E.wg)v.refreshBoundingInfo();E.Ag(!0)}if(Q){const o=new j.e(f.name+"_merged",f.Fo());o.LU=n;for(let v=0;v<E.wg.length;v++)E.wg[v].materialIndex=O[v];E.material=o}else E.material=f.material;return E}gl(o){o._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(o)}Vl(o){const v=o._indexInSourceMeshInstanceArray;if(-1!=v){if(v!==this.instances.length-1){const o=this.instances[this.instances.length-1];this.instances[v]=o,o._indexInSourceMeshInstanceArray=v}o._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===R.e.CounterClockWiseSideOrientation}_getRenderingFillMode(o){const v=this.Fo();return v.forcePointsCloud?R.e.PointFillMode:v.forceWireframe?R.e.WireFrameFillMode:this.overrideRenderingFillMode??o}setMaterialByID(o){return this.setMaterialById(o)}static CreateRibbon(o,v,V,g,E,I,Q,U,n){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(o,v,V,g,E,I){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(o,v,V,g,E){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(o,v,V,g,E,I){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(o,v,V,g){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(o,v,V,g,E,I,Q,U,n){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(o,v,V,g,E,I,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(o,v,V,g,E,I,Q,U,n,O){throw new Error("Import MeshBuilder to populate this function")}static TO(o,v,V,g,E){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(o,v,V,g,E,I,Q,U){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(o,v,V,g,E,I,Q){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(o,v,V,g,E,I,Q,U){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(o,v,V,g,E,I,Q,U,n,O){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(o,v,V,g,E,I,Q,U,n,O,h,x){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(o,v,V,g,E,I,Q){throw new Error("Import MeshBuilder to populate this function")}static jO(o,v,V,g,E){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(o,v,V,g,E,I){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(o,v,V,g,E,I,Q,U,n){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(o,v,V,g,E,I,Q,U,n,O,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(o,v,V,g,E,I,Q,U,n,O){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(o,v,V){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(o,v,V){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(o,v,V,g,E,I){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(o,v,V){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(o){throw new Error("Import MeshBuilder to populate this function")}}q.FRONTSIDE=l.d.FRONTSIDE,q.BACKSIDE=l.d.BACKSIDE,q.DOUBLESIDE=l.d.DOUBLESIDE,q.DEFAULTSIDE=l.d.DEFAULTSIDE,q.NO_CAP=0,q.CAP_START=1,q.CAP_END=2,q.CAP_ALL=3,q.NO_FLIP=0,q.FLIP_TILE=1,q.ROTATE_TILE=2,q.FLIP_ROW=3,q.ROTATE_ROW=4,q.FLIP_N_ROTATE_TILE=5,q.FLIP_N_ROTATE_ROW=6,q.CENTER=0,q.LEFT=1,q.RIGHT=2,q.TOP=3,q.BOTTOM=4,q.INSTANCEDMESH_SORT_TRANSPARENT=!1,q._GroundMeshParser=(o,v)=>{throw(0,u.b)("GroundMesh")},q._GoldbergMeshParser=(o,v)=>{throw(0,u.b)("GoldbergMesh")},q._LinesMeshParser=(o,v)=>{throw(0,u.b)("LinesMesh")},q._GreasedLineMeshParser=(o,v)=>{throw(0,u.b)("GreasedLineMesh")},q._GreasedLineRibbonMeshParser=(o,v)=>{throw(0,u.b)("GreasedLineRibbonMesh")},q._TrailMeshParser=(o,v)=>{throw(0,u.b)("TrailMesh")},(0,b.h)("BABYLON.Mesh",q)},12944:(o,v,V)=>{V.d(v,{d:()=>S});var g=V(12473),E=V(12488),I=V(12577),Q=V(12325),U=V(12547),n=V(12308),O=V(12479),h=V(12948),x=V(12354),f=V(12835);class l{}class S{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,h.g)(this._applyToCoroutine.bind(this)),this.uniqueId=S._UniqueIdGenerator,S._UniqueIdGenerator++}set(o,v){switch(o.length||n.b.Warn(`Setting vertex data kind '${v}' with an empty array`),v){case I.e.PositionKind:this.Jo=o;break;case I.e.NormalKind:this.do=o;break;case I.e.TangentKind:this.tangents=o;break;case I.e.UVKind:this.Yo=o;break;case I.e.UV2Kind:this.uvs2=o;break;case I.e.UV3Kind:this.uvs3=o;break;case I.e.UV4Kind:this.uvs4=o;break;case I.e.UV5Kind:this.uvs5=o;break;case I.e.UV6Kind:this.uvs6=o;break;case I.e.ColorKind:this.No=o;break;case I.e.MatricesIndicesKind:this.matricesIndices=o;break;case I.e.MatricesWeightsKind:this.matricesWeights=o;break;case I.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=o;break;case I.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=o}}Po(o,v){return this._applyTo(o,v,!1),this}applyToGeometry(o,v){return this._applyTo(o,v,!1),this}updateMesh(o){return this._update(o),this}updateGeometry(o){return this._update(o),this}*_applyToCoroutine(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;if(this.Jo&&(o.zo(I.e.PositionKind,this.Jo,v),V&&(yield)),this.do&&(o.zo(I.e.NormalKind,this.do,v),V&&(yield)),this.tangents&&(o.zo(I.e.TangentKind,this.tangents,v),V&&(yield)),this.Yo&&(o.zo(I.e.UVKind,this.Yo,v),V&&(yield)),this.uvs2&&(o.zo(I.e.UV2Kind,this.uvs2,v),V&&(yield)),this.uvs3&&(o.zo(I.e.UV3Kind,this.uvs3,v),V&&(yield)),this.uvs4&&(o.zo(I.e.UV4Kind,this.uvs4,v),V&&(yield)),this.uvs5&&(o.zo(I.e.UV5Kind,this.uvs5,v),V&&(yield)),this.uvs6&&(o.zo(I.e.UV6Kind,this.uvs6,v),V&&(yield)),this.No){const g=this.Jo&&this.No.length===this.Jo.length?3:4;o.zo(I.e.ColorKind,this.No,v,g),this.hasVertexAlpha&&void 0!==o.hasVertexAlpha&&(o.hasVertexAlpha=!0),V&&(yield)}if(this.matricesIndices&&(o.zo(I.e.MatricesIndicesKind,this.matricesIndices,v),V&&(yield)),this.matricesWeights&&(o.zo(I.e.MatricesWeightsKind,this.matricesWeights,v),V&&(yield)),this.matricesIndicesExtra&&(o.zo(I.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,v),V&&(yield)),this.matricesWeightsExtra&&(o.zo(I.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,v),V&&(yield)),this.indices?(o.setIndices(this.indices,null,v),V&&(yield)):o.setIndices([],null),o.wg&&this.materialInfos&&this.materialInfos.length>1){const v=o;v.wg=[];for(const o of this.materialInfos)new f.b(o.materialIndex,o.verticesStart,o.verticesCount,o.indexStart,o.indexCount,v)}return this}_update(o,v,V){return this.Jo&&o.updateVerticesData(I.e.PositionKind,this.Jo,v,V),this.do&&o.updateVerticesData(I.e.NormalKind,this.do,v,V),this.tangents&&o.updateVerticesData(I.e.TangentKind,this.tangents,v,V),this.Yo&&o.updateVerticesData(I.e.UVKind,this.Yo,v,V),this.uvs2&&o.updateVerticesData(I.e.UV2Kind,this.uvs2,v,V),this.uvs3&&o.updateVerticesData(I.e.UV3Kind,this.uvs3,v,V),this.uvs4&&o.updateVerticesData(I.e.UV4Kind,this.uvs4,v,V),this.uvs5&&o.updateVerticesData(I.e.UV5Kind,this.uvs5,v,V),this.uvs6&&o.updateVerticesData(I.e.UV6Kind,this.uvs6,v,V),this.No&&o.updateVerticesData(I.e.ColorKind,this.No,v,V),this.matricesIndices&&o.updateVerticesData(I.e.MatricesIndicesKind,this.matricesIndices,v,V),this.matricesWeights&&o.updateVerticesData(I.e.MatricesWeightsKind,this.matricesWeights,v,V),this.matricesIndicesExtra&&o.updateVerticesData(I.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,v,V),this.matricesWeightsExtra&&o.updateVerticesData(I.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,v,V),this.indices&&o.setIndices(this.indices,null),this}static _TransformVector3Coordinates(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.length;const I=E.TmpVectors.cv[0],Q=E.TmpVectors.cv[1];for(let U=V;U<V+g;U+=3)E.cv.FromArrayToRef(o,U,I),E.cv.TransformCoordinatesToRef(I,v,Q),o[U]=Q.x,o[U+1]=Q.y,o[U+2]=Q.z}static _TransformVector3Normals(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.length;const I=E.TmpVectors.cv[0],Q=E.TmpVectors.cv[1];for(let U=V;U<V+g;U+=3)E.cv.FromArrayToRef(o,U,I),E.cv.TransformNormalToRef(I,v,Q),o[U]=Q.x,o[U+1]=Q.y,o[U+2]=Q.z}static _TransformVector4Normals(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.length;const I=E.TmpVectors.Vector4[0],Q=E.TmpVectors.Vector4[1];for(let U=V;U<V+g;U+=4)E.Vector4.FromArrayToRef(o,U,I),E.Vector4.TransformNormalToRef(I,v,Q),o[U]=Q.x,o[U+1]=Q.y,o[U+2]=Q.z,o[U+3]=Q.w}static _FlipFaces(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.length;for(let g=v;g<v+V;g+=3){const v=o[g+1];o[g+1]=o[g+2],o[g+2]=v}}transform(o){const v=o.determinant()<0;return this.Jo&&S._TransformVector3Coordinates(this.Jo,o),this.do&&S._TransformVector3Normals(this.do,o),this.tangents&&S._TransformVector4Normals(this.tangents,o),v&&this.indices&&S._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const o=[];for(const v of this.materialInfos){const V=new S;if(this.Jo&&(V.Jo=this.Jo.slice(3*v.verticesStart,3*(v.verticesCount+v.verticesStart))),this.do&&(V.do=this.do.slice(3*v.verticesStart,3*(v.verticesCount+v.verticesStart))),this.tangents&&(V.tangents=this.tangents.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.No&&(V.No=this.No.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.Yo&&(V.Yo=this.Yo.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs2&&(V.uvs2=this.uvs2.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs3&&(V.uvs3=this.uvs3.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs4&&(V.uvs4=this.uvs4.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs5&&(V.uvs5=this.uvs5.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs6&&(V.uvs6=this.uvs6.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.matricesIndices&&(V.matricesIndices=this.matricesIndices.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesIndicesExtra&&(V.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesWeights&&(V.matricesWeights=this.matricesWeights.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesWeightsExtra&&(V.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.indices){V.indices=[];for(let o=v.indexStart;o<v.indexStart+v.indexCount;o++)V.indices.push(this.indices[o]-v.verticesStart)}const g=new l;g.indexStart=0,g.indexCount=V.indices?V.indices.length:0,g.materialIndex=v.materialIndex,g.verticesStart=0,g.verticesCount=(V.Jo?V.Jo.length:0)/3,V.materialInfos=[g],o.push(V)}return o}merge(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const I=Array.isArray(o)?o.map((o=>({vertexData:o}))):[{vertexData:o}];return(0,h.m)(this._mergeCoroutine(void 0,I,v,!1,V,g,E))}*_mergeCoroutine(o,v){var V,g;let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let h=v.map((o=>o.vertexData)),x=this;if(O)for(const I of h)I&&(I._validate(),!this.do&&I.do&&(this.do=new Float32Array(this.Jo.length)),!this.tangents&&I.tangents&&(this.tangents=new Float32Array(this.Jo.length/3*4)),!this.Yo&&I.Yo&&(this.Yo=new Float32Array(this.Jo.length/3*2)),!this.uvs2&&I.uvs2&&(this.uvs2=new Float32Array(this.Jo.length/3*2)),!this.uvs3&&I.uvs3&&(this.uvs3=new Float32Array(this.Jo.length/3*2)),!this.uvs4&&I.uvs4&&(this.uvs4=new Float32Array(this.Jo.length/3*2)),!this.uvs5&&I.uvs5&&(this.uvs5=new Float32Array(this.Jo.length/3*2)),!this.uvs6&&I.uvs6&&(this.uvs6=new Float32Array(this.Jo.length/3*2)),!this.No&&I.No&&(this.No=new Float32Array(this.Jo.length/3*4),this.No.fill(1)),!this.matricesIndices&&I.matricesIndices&&(this.matricesIndices=new Float32Array(this.Jo.length/3*4)),!this.matricesWeights&&I.matricesWeights&&(this.matricesWeights=new Float32Array(this.Jo.length/3*4)),!this.matricesIndicesExtra&&I.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Jo.length/3*4)),!this.matricesWeightsExtra&&I.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Jo.length/3*4)));for(const I of h)if(I)if(O)this.do&&!I.do&&(I.do=new Float32Array(I.Jo.length)),this.tangents&&!I.tangents&&(I.tangents=new Float32Array(I.Jo.length/3*4)),this.Yo&&!I.Yo&&(I.Yo=new Float32Array(I.Jo.length/3*2)),this.uvs2&&!I.uvs2&&(I.uvs2=new Float32Array(I.Jo.length/3*2)),this.uvs3&&!I.uvs3&&(I.uvs3=new Float32Array(I.Jo.length/3*2)),this.uvs4&&!I.uvs4&&(I.uvs4=new Float32Array(I.Jo.length/3*2)),this.uvs5&&!I.uvs5&&(I.uvs5=new Float32Array(I.Jo.length/3*2)),this.uvs6&&!I.uvs6&&(I.uvs6=new Float32Array(I.Jo.length/3*2)),this.No&&!I.No&&(I.No=new Float32Array(I.Jo.length/3*4),I.No.fill(1)),this.matricesIndices&&!I.matricesIndices&&(I.matricesIndices=new Float32Array(I.Jo.length/3*4)),this.matricesWeights&&!I.matricesWeights&&(I.matricesWeights=new Float32Array(I.Jo.length/3*4)),this.matricesIndicesExtra&&!I.matricesIndicesExtra&&(I.matricesIndicesExtra=new Float32Array(I.Jo.length/3*4)),this.matricesWeightsExtra&&!I.matricesWeightsExtra&&(I.matricesWeightsExtra=new Float32Array(I.Jo.length/3*4));else if(I._validate(),!this.do!==!I.do||!this.tangents!==!I.tangents||!this.Yo!==!I.Yo||!this.uvs2!==!I.uvs2||!this.uvs3!==!I.uvs3||!this.uvs4!==!I.uvs4||!this.uvs5!==!I.uvs5||!this.uvs6!==!I.uvs6||!this.No!==!I.No||!this.matricesIndices!==!I.matricesIndices||!this.matricesWeights!==!I.matricesWeights||!this.matricesIndicesExtra!==!I.matricesIndicesExtra||!this.matricesWeightsExtra!==!I.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(n){let V=0,g=0,E=0;const I=[];let Q=null;const U=[];for(const v of this.splitBasedOnMaterialID())U.push({vertexData:v,transform:o});for(const o of v)if(o.vertexData)for(const v of o.vertexData.splitBasedOnMaterialID())U.push({vertexData:v,transform:o.transform});U.sort(((o,v)=>{const V=o.vertexData.materialInfos?o.vertexData.materialInfos[0].materialIndex:0,g=v.vertexData.materialInfos?v.vertexData.materialInfos[0].materialIndex:0;return V>g?1:V===g?0:-1}));for(const o of U){const v=o.vertexData;if(V=v.materialInfos?v.materialInfos[0].materialIndex:0,Q&&Q.materialIndex===V)Q.indexCount+=v.indices.length,Q.verticesCount+=v.Jo.length/3;else{const o=new l;o.materialIndex=V,o.indexStart=g,o.indexCount=v.indices.length,o.verticesStart=E,o.verticesCount=v.Jo.length/3,I.push(o),Q=o}g+=v.indices.length,E+=v.Jo.length/3}const n=U.splice(0,1)[0];x=n.vertexData,o=n.transform,h=U.map((o=>o.vertexData)),v=U,this.materialInfos=I}const f=h.reduce(((o,v)=>{var V;return o+((null===(V=v.indices)||void 0===V?void 0:V.length)??0)}),(null===(V=x.indices)||void 0===V?void 0:V.length)??0);let T=U||h.some((o=>o.indices===x.indices))?null===(g=x.indices)||void 0===g?void 0:g.slice():x.indices;if(f>0){var c;let V=(null===(c=T)||void 0===c?void 0:c.length)??0;if(T||(T=new Array(f)),T.length!==f){if(Array.isArray(T))T.length=f;else{const o=E||T instanceof Uint32Array?new Uint32Array(f):new Uint16Array(f);o.set(T),T=o}o&&o.determinant()<0&&S._FlipFaces(T,0,V)}let g=x.Jo?x.Jo.length/3:0;for(const{vertexData:o,transform:E}of v)if(o.indices){for(let v=0;v<o.indices.length;v++)T[V+v]=o.indices[v]+g;E&&E.determinant()<0&&S._FlipFaces(T,V,o.indices.length),g+=o.Jo.length/3,V+=o.indices.length,Q&&(yield)}}return this.indices=T,this.Jo=S._MergeElement(I.e.PositionKind,x.Jo,o,v.map((o=>[o.vertexData.Jo,o.transform]))),Q&&(yield),x.do&&(this.do=S._MergeElement(I.e.NormalKind,x.do,o,v.map((o=>[o.vertexData.do,o.transform]))),Q&&(yield)),x.tangents&&(this.tangents=S._MergeElement(I.e.TangentKind,x.tangents,o,v.map((o=>[o.vertexData.tangents,o.transform]))),Q&&(yield)),x.Yo&&(this.Yo=S._MergeElement(I.e.UVKind,x.Yo,o,v.map((o=>[o.vertexData.Yo,o.transform]))),Q&&(yield)),x.uvs2&&(this.uvs2=S._MergeElement(I.e.UV2Kind,x.uvs2,o,v.map((o=>[o.vertexData.uvs2,o.transform]))),Q&&(yield)),x.uvs3&&(this.uvs3=S._MergeElement(I.e.UV3Kind,x.uvs3,o,v.map((o=>[o.vertexData.uvs3,o.transform]))),Q&&(yield)),x.uvs4&&(this.uvs4=S._MergeElement(I.e.UV4Kind,x.uvs4,o,v.map((o=>[o.vertexData.uvs4,o.transform]))),Q&&(yield)),x.uvs5&&(this.uvs5=S._MergeElement(I.e.UV5Kind,x.uvs5,o,v.map((o=>[o.vertexData.uvs5,o.transform]))),Q&&(yield)),x.uvs6&&(this.uvs6=S._MergeElement(I.e.UV6Kind,x.uvs6,o,v.map((o=>[o.vertexData.uvs6,o.transform]))),Q&&(yield)),x.No&&(this.No=S._MergeElement(I.e.ColorKind,x.No,o,v.map((o=>[o.vertexData.No,o.transform]))),(void 0!==x.hasVertexAlpha||v.some((o=>void 0!==o.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=x.hasVertexAlpha||v.some((o=>o.vertexData.hasVertexAlpha))),Q&&(yield)),x.matricesIndices&&(this.matricesIndices=S._MergeElement(I.e.MatricesIndicesKind,x.matricesIndices,o,v.map((o=>[o.vertexData.matricesIndices,o.transform]))),Q&&(yield)),x.matricesWeights&&(this.matricesWeights=S._MergeElement(I.e.MatricesWeightsKind,x.matricesWeights,o,v.map((o=>[o.vertexData.matricesWeights,o.transform]))),Q&&(yield)),x.matricesIndicesExtra&&(this.matricesIndicesExtra=S._MergeElement(I.e.MatricesIndicesExtraKind,x.matricesIndicesExtra,o,v.map((o=>[o.vertexData.matricesIndicesExtra,o.transform]))),Q&&(yield)),x.matricesWeightsExtra&&(this.matricesWeightsExtra=S._MergeElement(I.e.MatricesWeightsExtraKind,x.matricesWeightsExtra,o,v.map((o=>[o.vertexData.matricesWeightsExtra,o.transform])))),this}static _MergeElement(o,v,V,g){const E=g.filter((o=>null!==o[0]&&void 0!==o[0]));if(!v&&0==E.length)return v;if(!v)return this._MergeElement(o,E[0][0],E[0][1],E.slice(1));const Q=E.reduce(((o,v)=>o+v[0].length),v.length),U=o===I.e.PositionKind?S._TransformVector3Coordinates:o===I.e.NormalKind?S._TransformVector3Normals:o===I.e.TangentKind?S._TransformVector4Normals:()=>{};if(v instanceof Float32Array){const o=new Float32Array(Q);o.set(v),V&&U(o,V,0,v.length);let g=v.length;for(const[v,V]of E)o.set(v,g),V&&U(o,V,g,v.length),g+=v.length;return o}{const o=new Array(Q);for(let V=0;V<v.length;V++)o[V]=v[V];V&&U(o,V,0,v.length);let g=v.length;for(const[v,V]of E){for(let V=0;V<v.length;V++)o[g+V]=v[V];V&&U(o,V,g,v.length),g+=v.length}return o}}_validate(){if(!this.Jo)throw new x.i("Positions are required",x.f.MeshInvalidPositionsError);const o=(o,v)=>{const V=I.e.DeduceStride(o);if(v.length%V!==0)throw new Error("The "+o+"s array count must be a multiple of "+V);return v.length/V},v=o(I.e.PositionKind,this.Jo),V=(V,g)=>{const E=o(V,g);if(E!==v)throw new Error("The "+V+"s element count ("+E+") does not match the positions count ("+v+")")};this.do&&V(I.e.NormalKind,this.do),this.tangents&&V(I.e.TangentKind,this.tangents),this.Yo&&V(I.e.UVKind,this.Yo),this.uvs2&&V(I.e.UV2Kind,this.uvs2),this.uvs3&&V(I.e.UV3Kind,this.uvs3),this.uvs4&&V(I.e.UV4Kind,this.uvs4),this.uvs5&&V(I.e.UV5Kind,this.uvs5),this.uvs6&&V(I.e.UV6Kind,this.uvs6),this.No&&V(I.e.ColorKind,this.No),this.matricesIndices&&V(I.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&V(I.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&V(I.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&V(I.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const o=this.serialize();return S.Parse(o)}serialize(){const o={};if(this.Jo&&(o.Jo=Array.from(this.Jo)),this.do&&(o.do=Array.from(this.do)),this.tangents&&(o.tangents=Array.from(this.tangents)),this.Yo&&(o.Yo=Array.from(this.Yo)),this.uvs2&&(o.uvs2=Array.from(this.uvs2)),this.uvs3&&(o.uvs3=Array.from(this.uvs3)),this.uvs4&&(o.uvs4=Array.from(this.uvs4)),this.uvs5&&(o.uvs5=Array.from(this.uvs5)),this.uvs6&&(o.uvs6=Array.from(this.uvs6)),this.No&&(o.No=Array.from(this.No),o.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(o.matricesIndices=Array.from(this.matricesIndices),o.matricesIndicesExpanded=!0),this.matricesWeights&&(o.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(o.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),o.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(o.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),o.indices=this.indices?Array.from(this.indices):[],this.materialInfos){o.materialInfos=[];for(const v of this.materialInfos){const V={indexStart:v.indexStart,indexCount:v.indexCount,materialIndex:v.materialIndex,verticesStart:v.verticesStart,verticesCount:v.verticesCount};o.materialInfos.push(V)}}return o}static ExtractFromMesh(o,v,V){return S._ExtractFrom(o,v,V)}static ExtractFromGeometry(o,v,V){return S._ExtractFrom(o,v,V)}static _ExtractFrom(o,v,V){const g=new S;if(o.isVerticesDataPresent(I.e.PositionKind)&&(g.Jo=o.getVerticesData(I.e.PositionKind,v,V)),o.isVerticesDataPresent(I.e.NormalKind)&&(g.do=o.getVerticesData(I.e.NormalKind,v,V)),o.isVerticesDataPresent(I.e.TangentKind)&&(g.tangents=o.getVerticesData(I.e.TangentKind,v,V)),o.isVerticesDataPresent(I.e.UVKind)&&(g.Yo=o.getVerticesData(I.e.UVKind,v,V)),o.isVerticesDataPresent(I.e.UV2Kind)&&(g.uvs2=o.getVerticesData(I.e.UV2Kind,v,V)),o.isVerticesDataPresent(I.e.UV3Kind)&&(g.uvs3=o.getVerticesData(I.e.UV3Kind,v,V)),o.isVerticesDataPresent(I.e.UV4Kind)&&(g.uvs4=o.getVerticesData(I.e.UV4Kind,v,V)),o.isVerticesDataPresent(I.e.UV5Kind)&&(g.uvs5=o.getVerticesData(I.e.UV5Kind,v,V)),o.isVerticesDataPresent(I.e.UV6Kind)&&(g.uvs6=o.getVerticesData(I.e.UV6Kind,v,V)),o.isVerticesDataPresent(I.e.ColorKind)){const E=o.kg||o,Q=E.getVertexBuffer(I.e.ColorKind),U=E.getVerticesData(I.e.ColorKind,v,V);if(3===Q.getSize()){const o=new Float32Array(4*U.length/3);for(let v=0,V=0;v<U.length;v+=3,V+=4)o[V]=U[v],o[V+1]=U[v+1],o[V+2]=U[v+2],o[V+3]=1;g.No=o}else{if(4!==Q.getSize())throw new Error(`Unexpected number of color components: ${Q.getSize()}`);g.No=U}}return o.isVerticesDataPresent(I.e.MatricesIndicesKind)&&(g.matricesIndices=o.getVerticesData(I.e.MatricesIndicesKind,v,V)),o.isVerticesDataPresent(I.e.MatricesWeightsKind)&&(g.matricesWeights=o.getVerticesData(I.e.MatricesWeightsKind,v,V)),o.isVerticesDataPresent(I.e.MatricesIndicesExtraKind)&&(g.matricesIndicesExtra=o.getVerticesData(I.e.MatricesIndicesExtraKind,v,V)),o.isVerticesDataPresent(I.e.MatricesWeightsExtraKind)&&(g.matricesWeightsExtra=o.getVerticesData(I.e.MatricesWeightsExtraKind,v,V)),g.indices=o.QQ(v,V),g}static CreateRibbon(o){throw(0,Q.b)("ribbonBuilder")}static CreateBox(o){throw(0,Q.b)("boxBuilder")}static CreateTiledBox(o){throw(0,Q.b)("tiledBoxBuilder")}static CreateTiledPlane(o){throw(0,Q.b)("tiledPlaneBuilder")}static CreateSphere(o){throw(0,Q.b)("sphereBuilder")}static CreateCylinder(o){throw(0,Q.b)("cylinderBuilder")}static CreateTorus(o){throw(0,Q.b)("torusBuilder")}static CreateLineSystem(o){throw(0,Q.b)("linesBuilder")}static CreateDashedLines(o){throw(0,Q.b)("linesBuilder")}static CreateGround(o){throw(0,Q.b)("groundBuilder")}static CreateTiledGround(o){throw(0,Q.b)("groundBuilder")}static CreateGroundFromHeightMap(o){throw(0,Q.b)("groundBuilder")}static jO(o){throw(0,Q.b)("planeBuilder")}static CreateDisc(o){throw(0,Q.b)("discBuilder")}static CreatePolygon(o,v,V,g,E,I,U){throw(0,Q.b)("polygonBuilder")}static CreateIcoSphere(o){throw(0,Q.b)("icoSphereBuilder")}static CreatePolyhedron(o){throw(0,Q.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||E.cv.Up();throw(0,Q.b)("capsuleBuilder")}static CreateTorusKnot(o){throw(0,Q.b)("torusKnotBuilder")}static ComputeNormals(o,v,V,g){let I=0,Q=0,U=0,n=0,O=0,h=0,x=0,f=0,l=0,S=0,T=0,c=0,R=0,j=0,t=0,s=0,L=0,b=0,u=0,mo=0,a=!1,F=!1,i=!1,J=!1,d=1,N=0,Y=null;g&&(a=!!g.facetNormals,F=!!g.facetPositions,i=!!g.facetPartitioning,d=!0===g.useRightHandedSystem?-1:1,N=g.ratio||0,J=!!g.depthSort,Y=g.distanceTo,J&&void 0===Y&&(Y=E.cv.Zero()));let q=0,P=0,M=0,W=0;for(i&&g&&g.bbSize&&(q=g.subDiv.X*N/g.bbSize.x,P=g.subDiv.Y*N/g.bbSize.y,M=g.subDiv.Z*N/g.bbSize.z,W=g.subDiv.max*g.subDiv.max,g.facetPartitioning.length=0),I=0;I<o.length;I++)V[I]=0;const w=v.length/3|0;for(I=0;I<w;I++){if(c=3*v[3*I],R=c+1,j=c+2,t=3*v[3*I+1],s=t+1,L=t+2,b=3*v[3*I+2],u=b+1,mo=b+2,Q=o[c]-o[t],U=o[R]-o[s],n=o[j]-o[L],O=o[b]-o[t],h=o[u]-o[s],x=o[mo]-o[L],f=d*(U*x-n*h),l=d*(n*O-Q*x),S=d*(Q*h-U*O),T=Math.sqrt(f*f+l*l+S*S),T=0===T?1:T,f/=T,l/=T,S/=T,a&&g&&(g.facetNormals[I].x=f,g.facetNormals[I].y=l,g.facetNormals[I].z=S),F&&g&&(g.facetPositions[I].x=(o[c]+o[t]+o[b])/3,g.facetPositions[I].y=(o[R]+o[s]+o[u])/3,g.facetPositions[I].z=(o[j]+o[L]+o[mo])/3),i&&g){const v=Math.floor((g.facetPositions[I].x-g.bInfo.minimum.x*N)*q),V=Math.floor((g.facetPositions[I].y-g.bInfo.minimum.y*N)*P),E=Math.floor((g.facetPositions[I].z-g.bInfo.minimum.z*N)*M),Q=Math.floor((o[c]-g.bInfo.minimum.x*N)*q),U=Math.floor((o[R]-g.bInfo.minimum.y*N)*P),n=Math.floor((o[j]-g.bInfo.minimum.z*N)*M),O=Math.floor((o[t]-g.bInfo.minimum.x*N)*q),h=Math.floor((o[s]-g.bInfo.minimum.y*N)*P),x=Math.floor((o[L]-g.bInfo.minimum.z*N)*M),f=Math.floor((o[b]-g.bInfo.minimum.x*N)*q),l=Math.floor((o[u]-g.bInfo.minimum.y*N)*P),S=Math.floor((o[mo]-g.bInfo.minimum.z*N)*M),T=Q+g.subDiv.max*U+W*n,a=O+g.subDiv.max*h+W*x,F=f+g.subDiv.max*l+W*S,i=v+g.subDiv.max*V+W*E;g.facetPartitioning[i]=g.facetPartitioning[i]?g.facetPartitioning[i]:[],g.facetPartitioning[T]=g.facetPartitioning[T]?g.facetPartitioning[T]:[],g.facetPartitioning[a]=g.facetPartitioning[a]?g.facetPartitioning[a]:[],g.facetPartitioning[F]=g.facetPartitioning[F]?g.facetPartitioning[F]:[],g.facetPartitioning[T].push(I),a!=T&&g.facetPartitioning[a].push(I),F!=a&&F!=T&&g.facetPartitioning[F].push(I),i!=T&&i!=a&&i!=F&&g.facetPartitioning[i].push(I)}if(J&&g&&g.facetPositions){const o=g.depthSortedFacets[I];o.ind=3*I,o.sqDistance=E.cv.DistanceSquared(g.facetPositions[I],Y)}V[c]+=f,V[R]+=l,V[j]+=S,V[t]+=f,V[s]+=l,V[L]+=S,V[b]+=f,V[u]+=l,V[mo]+=S}for(I=0;I<V.length/3;I++)f=V[3*I],l=V[3*I+1],S=V[3*I+2],T=Math.sqrt(f*f+l*l+S*S),T=0===T?1:T,f/=T,l/=T,S/=T,V[3*I]=f,V[3*I+1]=l,V[3*I+2]=S}static _ComputeSides(o,v,V,g,I,Q,U){const n=V.length,O=g.length;let h,x;switch(o=o||S.DEFAULTSIDE){case S.FRONTSIDE:break;case S.BACKSIDE:for(h=0;h<n;h+=3){const o=V[h];V[h]=V[h+2],V[h+2]=o}for(x=0;x<O;x++)g[x]=-g[x];break;case S.DOUBLESIDE:{const o=v.length,f=o/3;for(let V=0;V<o;V++)v[o+V]=v[V];for(h=0;h<n;h+=3)V[h+n]=V[h+2]+f,V[h+1+n]=V[h+1]+f,V[h+2+n]=V[h]+f;for(x=0;x<O;x++)g[O+x]=-g[x];const l=I.length;let S=0;for(S=0;S<l;S++)I[S+l]=I[S];for(Q=Q||new E.Vector4(0,0,1,1),U=U||new E.Vector4(0,0,1,1),S=0,h=0;h<l/2;h++)I[S]=Q.x+(Q.z-Q.x)*I[S],I[S+1]=Q.y+(Q.w-Q.y)*I[S+1],I[S+l]=U.x+(U.z-U.x)*I[S+l],I[S+l+1]=U.y+(U.w-U.y)*I[S+l+1],S+=2;break}}}static Parse(o){const v=new S,V=o.Jo;V&&v.set(V,I.e.PositionKind);const g=o.do;g&&v.set(g,I.e.NormalKind);const E=o.tangents;E&&v.set(E,I.e.TangentKind);const Q=o.Yo;Q&&v.set(Q,I.e.UVKind);const n=o.uvs2;n&&v.set(n,I.e.UV2Kind);const O=o.uvs3;O&&v.set(O,I.e.UV3Kind);const h=o.uvs4;h&&v.set(h,I.e.UV4Kind);const x=o.uvs5;x&&v.set(x,I.e.UV5Kind);const f=o.uvs6;f&&v.set(f,I.e.UV6Kind);const T=o.No;T&&(v.set(U.sU.CheckColors4(T,V.length/3),I.e.ColorKind),void 0!==o.hasVertexAlpha&&(v.hasVertexAlpha=o.hasVertexAlpha));const c=o.matricesIndices;c&&v.set(c,I.e.MatricesIndicesKind);const R=o.matricesWeights;R&&v.set(R,I.e.MatricesWeightsKind);const j=o.indices;j&&(v.indices=j);const t=o.materialInfos;if(t){v.materialInfos=[];for(const o of t){const V=new l;V.indexCount=o.indexCount,V.indexStart=o.indexStart,V.verticesCount=o.verticesCount,V.verticesStart=o.verticesStart,V.materialIndex=o.materialIndex,v.materialInfos.push(V)}}return v}static ImportVertexData(o,v){const V=S.Parse(o);v.setAllVerticesData(V,o.updatable)}}S.FRONTSIDE=0,S.BACKSIDE=1,S.DOUBLESIDE=2,S.DEFAULTSIDE=0,S._UniqueIdGenerator=0,(0,g.c)([O.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g]=v;return!Array.isArray(g)}))],S,"_TransformVector3Coordinates",null),(0,g.c)([O.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g]=v;return!Array.isArray(g)}))],S,"_TransformVector3Normals",null),(0,g.c)([O.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g]=v;return!Array.isArray(g)}))],S,"_TransformVector4Normals",null),(0,g.c)([O.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g]=v;return!Array.isArray(g)}))],S,"_FlipFaces",null)},13074:(o,v,V)=>{var g=V(12958),E=V(12577),I=V(12488),Q=V(12308),U=V(12852);g.e.prototype.thinInstanceAdd=function(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.Fo().getEngine().getCaps().instancedArrays)return Q.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(o)?o.length:1);const V=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(o))for(let g=0;g<o.length;++g)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,o[g],g===o.length-1&&v);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,o,v);return V},g.e.prototype.thinInstanceAddSelf=function(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(I.Matrix.IdentityReadOnly,o)},g.e.prototype.thinInstanceRegisterAttribute=function(o,v){o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),this.removeVerticesData(o),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[o]=v,this._userThinInstanceBuffersStorage.sizes[o]=v*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[o]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[o]),this._userThinInstanceBuffersStorage.vertexBuffers[o]=new E.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[o],o,!0,!1,v,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[o])},g.e.prototype.thinInstanceSetMatrixAt=function(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||o>=this._thinInstanceDataStorage.instancesCount)return!1;const g=this._thinInstanceDataStorage.matrixData;return v.copyToArray(g,16*o),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[o]=v),V&&(this.Dx("matrix"),this.Mo||this.thinInstanceRefreshBoundingInfo(!1)),!0},g.e.prototype.thinInstanceSetAttributeAt=function(o,v,V){let g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[o]||v>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(o,0),this._userThinInstanceBuffersStorage.data[o].set(V,v*this._userThinInstanceBuffersStorage.strides[o]),g&&this.Dx(o),!0)},Object.defineProperty(g.e.prototype,"bU",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(o){var v;const V=this._thinInstanceDataStorage.matrixData??(null===(v=this.source)||void 0===v?void 0:v._thinInstanceDataStorage.matrixData);o<=(V?V.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=o)},enumerable:!0,configurable:!0}),g.e.prototype._thinInstanceCreateMatrixBuffer=function(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=new E.b(this.getEngine(),v,!V,16,!1,!0);for(let E=0;E<4;E++)this.setVerticesBuffer(g.createVertexBuffer(o+E,4*E,4));return g},g.e.prototype.Hx=function(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var I;if(V=V||16,"matrix"===o)null===(I=this._thinInstanceDataStorage.matrixBuffer)||void 0===I||I.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=v?v.length:32*V,this._thinInstanceDataStorage.matrixData=v,this._thinInstanceDataStorage.worldMatrices=null,null!==v?(this._thinInstanceDataStorage.instancesCount=v.length/V,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",v,g),this.Mo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Mo||this.refreshBoundingInfo());else if("previousMatrix"===o){var Q;null===(Q=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=v,null!==v&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",v,g))}else{var U;if(o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),null===v)null!==(U=this._userThinInstanceBuffersStorage)&&void 0!==U&&U.data[o]&&(this.removeVerticesData(o),delete this._userThinInstanceBuffersStorage.data[o],delete this._userThinInstanceBuffersStorage.strides[o],delete this._userThinInstanceBuffersStorage.sizes[o],delete this._userThinInstanceBuffersStorage.vertexBuffers[o]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[o]=v,this._userThinInstanceBuffersStorage.strides[o]=V,this._userThinInstanceBuffersStorage.sizes[o]=v.length,this._userThinInstanceBuffersStorage.vertexBuffers[o]=new E.e(this.getEngine(),v,o,!g,!1,V,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[o])}},g.e.prototype.Dx=function(o){var v;if("matrix"===o)this.nl&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(o),null===(v=this._thinInstanceDataStorage.matrixBuffer)||void 0===v||v.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===o){var V;this.nl&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(o),null===(V=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===V||V.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var g;o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),null!==(g=this._userThinInstanceBuffersStorage)&&void 0!==g&&g.vertexBuffers[o]&&(this.nl&&!this._userThinInstanceBuffersStorage.vertexBuffers[o].isUpdatable()&&this._thinInstanceRecreateBuffer(o),this._userThinInstanceBuffersStorage.vertexBuffers[o].updateDirectly(this._userThinInstanceBuffersStorage.data[o],0))}},g.e.prototype.thinInstancePartialBufferUpdate=function(o,v,V){var g;"matrix"===o?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(v,V):(o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),null!==(g=this._userThinInstanceBuffersStorage)&&void 0!==g&&g.vertexBuffers[o]&&this._userThinInstanceBuffersStorage.vertexBuffers[o].updateDirectly(v,V))},g.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const o=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let v=0;v<this._thinInstanceDataStorage.instancesCount;++v)this._thinInstanceDataStorage.worldMatrices[v]=I.Matrix.bv(o,16*v)}return this._thinInstanceDataStorage.worldMatrices},g.e.prototype.thinInstanceRefreshBoundingInfo=function(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const g=this._thinInstanceDataStorage.boundingVectors;if(o||!this.rawBoundingInfo){g.length=0,this.refreshBoundingInfo(v,V);const o=this.getBoundingInfo();this.rawBoundingInfo=new U.c(o.minimum,o.maximum)}const E=this.getBoundingInfo(),Q=this._thinInstanceDataStorage.matrixData;if(0===g.length)for(let I=0;I<E.boundingBox.vectors.length;++I)g.push(E.boundingBox.vectors[I].clone());I.TmpVectors.cv[0].tU(Number.POSITIVE_INFINITY),I.TmpVectors.cv[1].tU(Number.NEGATIVE_INFINITY);for(let U=0;U<this._thinInstanceDataStorage.instancesCount;++U){I.Matrix.FromArrayToRef(Q,16*U,I.TmpVectors.Matrix[0]);for(let o=0;o<g.length;++o)I.cv.TransformCoordinatesToRef(g[o],I.TmpVectors.Matrix[0],I.TmpVectors.cv[2]),I.TmpVectors.cv[0].minimizeInPlace(I.TmpVectors.cv[2]),I.TmpVectors.cv[1].maximizeInPlace(I.TmpVectors.cv[2])}E.reConstruct(I.TmpVectors.cv[0],I.TmpVectors.cv[1]),this.Wo()},g.e.prototype._thinInstanceRecreateBuffer=function(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var V;if("matrix"===o)null===(V=this._thinInstanceDataStorage.matrixBuffer)||void 0===V||V.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,v);else if("previousMatrix"===o){var g;if(this._scene.needsPreviousWorldMatrices)null===(g=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===g||g.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,v)}else{var I;o===E.e.ColorKind&&(o=E.e.ColorInstanceKind),null===(I=this._userThinInstanceBuffersStorage.vertexBuffers[o])||void 0===I||I.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[o]=new E.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[o],o,!v,!1,this._userThinInstanceBuffersStorage.strides[o],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[o])}},g.e.prototype._thinInstanceUpdateBufferSize=function(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o===E.e.ColorKind&&(o=E.e.ColorInstanceKind);const V="matrix"===o;if(!V&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[o]))return;const g=V?16:this._userThinInstanceBuffersStorage.strides[o],I=V?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[o];let Q=V?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[o];const U=(this._thinInstanceDataStorage.instancesCount+v)*g;let n=I;for(;n<U;)n*=2;if(!Q||I!=n){if(Q){const o=new Float32Array(n);o.set(Q,0),Q=o}else Q=new Float32Array(n);var O,h,x;if(V){if(null===(O=this._thinInstanceDataStorage.matrixBuffer)||void 0===O||O.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Q,!1),this._thinInstanceDataStorage.matrixData=Q,this._thinInstanceDataStorage.matrixBufferSize=n,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(h=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Q,!1)}else null===(x=this._userThinInstanceBuffersStorage.vertexBuffers[o])||void 0===x||x.dispose(),this._userThinInstanceBuffersStorage.data[o]=Q,this._userThinInstanceBuffersStorage.sizes[o]=n,this._userThinInstanceBuffersStorage.vertexBuffers[o]=new E.e(this.getEngine(),Q,o,!0,!1,g,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[o])}},g.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},g.e.prototype._disposeThinInstanceSpecificData=function(){var o;null!==(o=this._thinInstanceDataStorage)&&void 0!==o&&o.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},12928:(o,v,V)=>{V.d(v,{b:()=>h});var g=V(12473),E=V(12479),I=V(12535),Q=V(12297),U=V(12488),n=V(12932),O=V(12449);class h extends n.c{get billboardMode(){return this._billboardMode}set billboardMode(o){this._billboardMode!==o&&(this._billboardMode=o,this._cache.useBillboardPosition=0!==(this._billboardMode&h.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(o){this._infiniteDistance!==o&&(this._infiniteDistance=o)}constructor(o){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new U.cv(0,0,1),this._up=new U.cv(0,1,0),this._right=new U.cv(1,0,0),this._position=U.cv.Zero(),this._rotation=U.cv.Zero(),this._rotationQuaternion=null,this._scaling=U.cv.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=h.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.hl=U.Matrix.Zero(),this._usePivotMatrix=!1,this._absolutePosition=U.cv.Zero(),this._absoluteScaling=U.cv.Zero(),this._absoluteRotationQuaternion=U.Quaternion.Identity(),this._pivotMatrix=U.Matrix.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new Q.e,this._nonUniformScaling=!1,v&&this.Fo().addTransformNode(this)}getClassName(){return"Qh"}get position(){return this._position}set position(o){this._position=o,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(o){this._rotation=o,this._rotationQuaternion=null,this._markAsDirtyInternal()}get jU(){return this._scaling}set jU(o){this._scaling=o,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(o){this._rotationQuaternion=o,o&&this._rotation.tU(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return U.cv.TransformNormalFromFloatsToRef(0,0,this.Fo().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return U.cv.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return U.cv.TransformNormalFromFloatsToRef(this.Fo().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(o){return this._poseMatrix?(this._poseMatrix.U(o),this):(this._poseMatrix=o.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=U.Matrix.Identity()),this._poseMatrix}_isSynchronized(){const o=this._cache;return this._billboardMode===o.billboardMode&&this._billboardMode===h.BILLBOARDMODE_NONE&&(!o.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const o=this._cache;o.localMatrixUpdated=!1,o.billboardMode=-1,o.infiniteDistance=!1,o.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(o){return this.setPivotMatrix(o,!1)}setPivotMatrix(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.U(o),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=v,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=U.Matrix.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;const g=this.clone("Clone of "+(this.name||this.id),o||this.parent,!0);g&&V&&V(this,g);for(const E of this.getChildTransformNodes(!0))E.instantiateHierarchy(g,v,V);return g}dU(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.tU(0),this._rotationQuaternion=this._rotationQuaternion||U.Quaternion.Identity(),o.decompose(this._scaling,this._rotationQuaternion,this._position),this.Ag(!0)):(this._worldMatrix=o,this._absolutePosition.RU(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Ag(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Ag(!0),this}get Pf(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Ag(),this._absolutePosition}setAbsolutePosition(o){if(!o)return this;let v,V,g;if(void 0===o.x){if(arguments.length<3)return this;v=arguments[0],V=arguments[1],g=arguments[2]}else v=o.x,V=o.y,g=o.z;if(this.parent){const o=U.TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(o),U.cv.TransformCoordinatesFromFloatsToRef(v,V,g,o,this.position)}else this.position.x=v,this.position.y=V,this.position.z=g;return this._absolutePosition.U(o),this}setPositionWithLocalVector(o){return this.Ag(),this.position=U.cv.TransformNormal(o,this.hl),this}getPositionExpressedInLocalSpace(){this.Ag();const o=U.TmpVectors.Matrix[0];return this.hl.invertToRef(o),U.cv.TransformNormal(this.position,o)}locallyTranslate(o){return this.Ag(!0),this.position=U.cv.TransformCoordinates(o,this.hl),this}lookAt(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const I=h._LookAtVectorCache,Q=0===E?this.position:this.getAbsolutePosition();if(o.subtractToRef(Q,I),this.setDirection(I,v,V,g),1===E&&this.parent)if(this.rotationQuaternion){const o=U.TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(o);const v=U.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(v),v.invert(),o.multiplyToRef(v,o),this.rotationQuaternion.fromRotationMatrix(o)}else{const o=U.TmpVectors.Quaternion[0];U.Quaternion.FromEulerVectorToRef(this.rotation,o);const v=U.TmpVectors.Matrix[0];o.toRotationMatrix(v);const V=U.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.invert(),v.multiplyToRef(V,v),o.fromRotationMatrix(v),o.toEulerAnglesToRef(this.rotation)}return this}jn(o){const v=U.cv.Zero();return this.getDirectionToRef(o,v),v}getDirectionToRef(o,v){return U.cv.TransformNormalToRef(o,this.getWorldMatrix(),v),this}setDirection(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=-Math.atan2(o.z,o.x)+Math.PI/2,I=Math.sqrt(o.x*o.x+o.z*o.z),Q=-Math.atan2(o.y,I);return this.rotationQuaternion?U.Quaternion.RotationYawPitchRollToRef(E+v,Q+V,g,this.rotationQuaternion):(this.rotation.x=Q+V,this.rotation.y=E+v,this.rotation.z=g),this}setPivotPoint(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.Fo().getRenderId()&&this.Ag(!0);const V=this.getWorldMatrix();if(1==v){const v=U.TmpVectors.Matrix[0];V.invertToRef(v),o=U.cv.TransformCoordinates(o,v)}return this.setPivotMatrix(U.Matrix.Translation(-o.x,-o.y,-o.z),!0)}getPivotPoint(){const o=U.cv.Zero();return this.getPivotPointToRef(o),o}getPivotPointToRef(o){return o.x=-this._pivotMatrix.m[12],o.y=-this._pivotMatrix.m[13],o.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const o=U.cv.Zero();return this.getAbsolutePivotPointToRef(o),o}getAbsolutePivotPointToRef(o){return this.getPivotPointToRef(o),U.cv.TransformCoordinatesToRef(o,this.getWorldMatrix(),o),this}eO(o){if(this._isDirty)return this;if(this._children)for(const v of this._children)v.eO(o);return super.eO(o)}setParent(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!o&&!this.parent)return this;const g=U.TmpVectors.Quaternion[0],E=U.TmpVectors.cv[0],I=U.TmpVectors.cv[1],Q=U.TmpVectors.Matrix[1];U.Matrix.IdentityToRef(Q);const n=U.TmpVectors.Matrix[0];this.Ag(!0);let O=this.rotationQuaternion;return O||(O=h._TmpRotation,U.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,O)),U.Matrix.ComposeToRef(this.jU,O,this.position,n),this.parent&&n.multiplyToRef(this.parent.Ag(!0),n),o&&(o.Ag(!0).invertToRef(Q),n.multiplyToRef(Q,n)),n.decompose(I,g,E,v?this:void 0),this.rotationQuaternion?this.rotationQuaternion.U(g):g.toEulerAnglesToRef(this.rotation),this.jU.U(I),this.position.U(E),this.parent=o,V&&this.setPivotMatrix(U.Matrix.Identity()),this}addChild(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o.setParent(this,v),this}removeChild(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o.parent!==this||o.setParent(null,v),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(o){return this._nonUniformScaling!==o&&(this._nonUniformScaling=o,!0)}attachToBone(o,v){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=v,this.parent=o,o.getSkeleton().prepare(!0),o.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=o?this._currentParentWhenAttachingToBone:null,this):(o&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(o,v,V){let g;if(o.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.tU(0)),V&&0!==V){if(this.parent){const V=this.parent.getWorldMatrix(),g=U.TmpVectors.Matrix[0];V.invertToRef(g),o=U.cv.TransformNormal(o,g),V.determinant()<0&&(v*=-1)}g=U.Quaternion.RotationAxisToRef(o,v,h._RotationAxisCache),g.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else g=U.Quaternion.RotationAxisToRef(o,v,h._RotationAxisCache),this.rotationQuaternion.multiplyToRef(g,this.rotationQuaternion);return this}rotateAround(o,v,V){v.normalize(),this.rotationQuaternion||(this.rotationQuaternion=U.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.tU(0));const g=U.TmpVectors.cv[0],E=U.TmpVectors.cv[1],I=U.TmpVectors.cv[2],Q=U.TmpVectors.Quaternion[0],n=U.TmpVectors.Matrix[0],O=U.TmpVectors.Matrix[1],h=U.TmpVectors.Matrix[2],x=U.TmpVectors.Matrix[3];return o.subtractToRef(this.position,g),U.Matrix.TranslationToRef(g.x,g.y,g.z,n),U.Matrix.TranslationToRef(-g.x,-g.y,-g.z,O),U.Matrix.RotationAxisToRef(v,V,h),O.multiplyToRef(h,x),x.multiplyToRef(n,x),x.decompose(E,Q,I),this.position.addInPlace(I),Q.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(o,v,V){const g=o.scale(v);if(V&&0!==V)this.setAbsolutePosition(this.getAbsolutePosition().add(g));else{const o=this.getPositionExpressedInLocalSpace().add(g);this.setPositionWithLocalVector(o)}return this}addRotation(o,v,V){let g;this.rotationQuaternion?g=this.rotationQuaternion:(g=U.TmpVectors.Quaternion[1],U.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,g));const E=U.TmpVectors.Quaternion[0];return U.Quaternion.RotationYawPitchRollToRef(v,o,V,E),g.multiplyInPlace(E),this.rotationQuaternion||g.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==h.BILLBOARDMODE_NONE}Ag(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const V=this.Fo().getRenderId();if(!this._isDirty&&!o&&(this._currentRenderId===V||this.isSynchronized()))return this._currentRenderId=V,this._worldMatrix;v=v||this.Fo().activeCamera,this._updateCache();const g=this._cache;g.pivotMatrixUpdated=!1,g.billboardMode=this.billboardMode,g.infiniteDistance=this.infiniteDistance,g.parent=this._parentNode,this._currentRenderId=V,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const E=this._getEffectiveParent(),I=h._TmpScaling;let Q,n=this._position;if(this._infiniteDistance&&!this.parent&&v){const o=v.getWorldMatrix(),V=new U.cv(o.m[12],o.m[13],o.m[14]);n=h._TmpTranslation,n.RU(this._position.x+V.x,this._position.y+V.y,this._position.z+V.z)}if(I.RU(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,Q=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(U.Quaternion.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.RU(0,0,0))}}else Q=h._TmpRotation,U.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Q);if(this._usePivotMatrix){const o=U.TmpVectors.Matrix[1];U.Matrix.ScalingToRef(I.x,I.y,I.z,o);const v=U.TmpVectors.Matrix[0];Q.toRotationMatrix(v),this._pivotMatrix.multiplyToRef(o,U.TmpVectors.Matrix[4]),U.TmpVectors.Matrix[4].multiplyToRef(v,this.hl),this._postMultiplyPivotMatrix&&this.hl.multiplyToRef(this._pivotMatrixInverse,this.hl),this.hl.addTranslationFromFloats(n.x,n.y,n.z)}else U.Matrix.ComposeToRef(I,Q,n,this.hl);if(E&&E.getWorldMatrix){if(o&&E.Ag(o),this.billboardMode){if(this._transformToBoneReferal){const o=this.parent;o.getSkeleton().prepare(),o.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),U.TmpVectors.Matrix[7])}else U.TmpVectors.Matrix[7].U(E.getWorldMatrix());const o=U.TmpVectors.cv[5],v=U.TmpVectors.cv[6],V=U.TmpVectors.Quaternion[0];U.TmpVectors.Matrix[7].decompose(v,V,o),U.Matrix.ScalingToRef(v.x,v.y,v.z,U.TmpVectors.Matrix[7]),U.TmpVectors.Matrix[7].setTranslation(o),h.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(V,o),this.hl.setTranslation(o)),this.hl.multiplyToRef(U.TmpVectors.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const o=this.parent;o.getSkeleton().prepare(),this.hl.multiplyToRef(o.getFinalMatrix(),U.TmpVectors.Matrix[6]),U.TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.hl.multiplyToRef(E.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.U(this.hl);if(v&&this.billboardMode)if(g.useBillboardPosition){if(g.useBillboardPosition){const o=U.TmpVectors.cv[0];this._worldMatrix.getTranslationToRef(o);const V=v.globalPosition;this._worldMatrix.invertToRef(U.TmpVectors.Matrix[1]);const g=U.TmpVectors.cv[1];U.cv.TransformCoordinatesToRef(V,U.TmpVectors.Matrix[1],g),g.normalize();const E=-Math.atan2(g.z,g.x)+Math.PI/2,I=Math.sqrt(g.x*g.x+g.z*g.z),Q=-Math.atan2(g.y,I);if(U.Quaternion.RotationYawPitchRollToRef(E,Q,0,U.TmpVectors.Quaternion[0]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){const o=U.TmpVectors.cv[1];U.TmpVectors.Quaternion[0].toEulerAnglesToRef(o),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(o.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(o.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(o.z=0),U.Matrix.RotationYawPitchRollToRef(o.y,o.x,o.z,U.TmpVectors.Matrix[0])}else U.Matrix.FromQuaternionToRef(U.TmpVectors.Quaternion[0],U.TmpVectors.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(U.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(U.TmpVectors.cv[0])}}else{const o=U.TmpVectors.cv[0];if(this._worldMatrix.getTranslationToRef(o),U.TmpVectors.Matrix[1].U(v.getViewMatrix()),U.TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0),U.TmpVectors.Matrix[1].invertToRef(U.TmpVectors.Matrix[0]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){U.TmpVectors.Matrix[0].decompose(void 0,U.TmpVectors.Quaternion[0],void 0);const o=U.TmpVectors.cv[1];U.TmpVectors.Quaternion[0].toEulerAnglesToRef(o),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(o.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(o.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(o.z=0),U.Matrix.RotationYawPitchRollToRef(o.y,o.x,o.z,U.TmpVectors.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(U.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(U.TmpVectors.cv[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):E&&E._nonUniformScaling?this._updateNonUniformScalingState(E._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.RU(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=U.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Ag(),o){const o=this.getChildren();for(let v=0;v<o.length;++v){const V=o[v];if(V){V.Ag();const o=U.TmpVectors.Matrix[0];V.hl.multiplyToRef(this.hl,o);const v=U.TmpVectors.Quaternion[0];o.decompose(V.jU,v,V.position),V.rotationQuaternion?V.rotationQuaternion.U(v):v.toEulerAnglesToRef(V.rotation)}}}this.jU.RU(1,1,1),this.position.RU(0,0,0),this.rotation.RU(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=U.Quaternion.Identity()),this._worldMatrix=U.Matrix.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(o){return this.onAfterWorldMatrixUpdateObservable.add(o),this}unregisterAfterWorldMatrixUpdate(o){return this.onAfterWorldMatrixUpdateObservable.removeCallback(o),this}getPositionInCameraSpace(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o||(o=this.Fo().activeCamera),U.cv.TransformCoordinates(this.getAbsolutePosition(),o.getViewMatrix())}getDistanceToCamera(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o||(o=this.Fo().activeCamera),this.getAbsolutePosition().Rv(o.globalPosition).length()}clone(o,v,V){const g=I.c.Clone((()=>new h(o,this.Fo())),this);if(g.name=o,g.id=o,v&&(g.parent=v),!V){const v=this.getDescendants(!0);for(let V=0;V<v.length;V++){const E=v[V];E.clone&&E.clone(o+"."+E.name,g)}}return g}serialize(o){const v=I.c.Serialize(this,o);return v.type=this.getClassName(),v.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(v),v.localMatrix=this.getPivotMatrix().Dg(),v.isEnabled=this.isEnabled(),I.c.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v}static Parse(o,v,V){const g=I.c.Parse((()=>new h(o.name,v)),o,v,V);if(o.localMatrix?g.setPreTransformMatrix(U.Matrix.bv(o.localMatrix)):o.pivotMatrix&&g.setPivotMatrix(U.Matrix.bv(o.pivotMatrix)),g.eU(o.isEnabled),g._waitingParsedUniqueId=o.uniqueId,void 0!==o.parentId&&(g._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(g._waitingParentInstanceIndex=o.parentInstanceIndex),o.animations){for(let v=0;v<o.animations.length;v++){const V=o.animations[v],E=(0,O.d)("BABYLON.Animation");E&&g.animations.push(E.Parse(V))}n.c.ParseAnimationRanges(g,o,v)}return o.autoAnimate&&v.beginAnimation(g,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),g}getChildTransformNodes(o,v){const V=[];return this._getDescendants(V,o,(o=>(!v||v(o))&&o instanceof h)),V}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Fo().stopAnimation(this),this.Fo().removeTransformNode(this),this._parentContainer){const o=this._parentContainer.transformNodes.indexOf(this);o>-1&&this._parentContainer.transformNodes.splice(o,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),o){const o=this.getChildTransformNodes(!0);for(const v of o)v.parent=null,v.Ag(!0)}super.dispose(o,v)}normalizeToUnitCube(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0,g=null,E=null;v&&(this.rotationQuaternion?(E=this.rotationQuaternion.clone(),this.rotationQuaternion.RU(0,0,0,1)):this.rotation&&(g=this.rotation.clone(),this.rotation.RU(0,0,0)));const I=this.getHierarchyBoundingVectors(o,V),Q=I.max.Rv(I.min),U=Math.max(Q.x,Q.y,Q.z);if(0===U)return this;const n=1/U;return this.jU.scaleInPlace(n),v&&(this.rotationQuaternion&&E?this.rotationQuaternion.U(E):this.rotation&&g&&this.rotation.U(g)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}h.BILLBOARDMODE_NONE=0,h.BILLBOARDMODE_X=1,h.BILLBOARDMODE_Y=2,h.BILLBOARDMODE_Z=4,h.BILLBOARDMODE_ALL=7,h.BILLBOARDMODE_USE_POSITION=128,h.BillboardUseParentOrientation=!1,h._TmpRotation=U.Quaternion.Zero(),h._TmpScaling=U.cv.Zero(),h._TmpTranslation=U.cv.Zero(),h._LookAtVectorCache=new U.cv(0,0,0),h._RotationAxisCache=new U.Quaternion,(0,g.c)([(0,E.G)("position")],h.prototype,"_position",void 0),(0,g.c)([(0,E.G)("rotation")],h.prototype,"_rotation",void 0),(0,g.c)([(0,E.A)("rotationQuaternion")],h.prototype,"_rotationQuaternion",void 0),(0,g.c)([(0,E.G)("jU")],h.prototype,"_scaling",void 0),(0,g.c)([(0,E.K)("billboardMode")],h.prototype,"_billboardMode",void 0),(0,g.c)([(0,E.K)()],h.prototype,"scalingDeterminant",void 0),(0,g.c)([(0,E.K)("infiniteDistance")],h.prototype,"_infiniteDistance",void 0),(0,g.c)([(0,E.K)()],h.prototype,"ignoreNonUniformScaling",void 0),(0,g.c)([(0,E.K)()],h.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},13014:(o,v,V)=>{V.d(v,{e:()=>Q});var g=V(12471),E=V(13018);let I=0;const Q=o=>{if(!o.environmentBRDFTexture){const v=o.useDelayedTextureLoading;o.useDelayedTextureLoading=!1;const V=o._blockEntityCollection;o._blockEntityCollection=!1;const Q=g.e.CreateFromBase64String("data:image/png;base64,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","EnvironmentBRDFTexture"+I++,o,!0,!1,g.e.BILINEAR_SAMPLINGMODE);o._blockEntityCollection=V;const U=o.getEngine().getLoadedTexturesCache(),n=U.indexOf(Q.getInternalTexture());-1!==n&&U.splice(n,1),Q.isRGBD=!0,Q.wrapU=g.e.CLAMP_ADDRESSMODE,Q.wrapV=g.e.CLAMP_ADDRESSMODE,o.environmentBRDFTexture=Q,o.useDelayedTextureLoading=v,E.b.ExpandRGBDTexture(Q);const O=o.getEngine().onContextRestoredObservable.add((()=>{Q.isRGBD=!0;const v=o.onBeforeRenderObservable.add((()=>{Q.isReady()&&(o.onBeforeRenderObservable.remove(v),E.b.ExpandRGBDTexture(Q))}))}));o.Tg.add((()=>{o.getEngine().onContextRestoredObservable.remove(O)}))}return o.environmentBRDFTexture}},12948:(o,v,V)=>{function g(o,v,V){try{const g=o.next();g.done?v(g):g.value?g.value.then((()=>{g.value=void 0,v(g)}),V):v(g)}catch(g){V(g)}}function E(){let o,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(V,E,I)=>{const Q=performance.now();void 0===o||Q-o>v?(o=Q,setTimeout((()=>{g(V,E,I)}),0)):g(V,E,I)}}function I(o,v,V,g,E){const I=()=>{let Q;const U=o=>{o.done?V(o.value):void 0===Q?Q=!0:I()};do{Q=void 0,E&&E.aborted?g(new Error("Aborted")):v(o,U,g),void 0===Q&&(Q=!1)}while(Q)};I()}function Q(o,v){let V;return I(o,g,(o=>V=o),(o=>{throw o}),v),V}async function U(o,v,V){return await new Promise(((g,E)=>{I(o,v,g,E,V)}))}function n(o,v){return function(){return Q(o(...arguments),v)}}V.d(v,{c:()=>E,g:()=>n,j:()=>U,m:()=>Q})},13096:(o,v,V)=>{function g(){const o=o=>!!o&&"object"===typeof o;for(var v=arguments.length,V=new Array(v),E=0;E<v;E++)V[E]=arguments[E];return V.reduce(((v,V)=>{const E=Object.keys(V);for(const I of E){const E=v[I],Q=V[I];Array.isArray(E)&&Array.isArray(Q)?v[I]=E.concat(...Q):o(E)&&o(Q)?v[I]=g(E,Q):v[I]=Q}return v}),{})}V.d(v,{c:()=>g})},13085:(o,v,V)=>{V.d(v,{b:()=>E});class g{constructor(o){this._pendingActions=new Array,this._workerInfos=o.map((o=>({workerPromise:Promise.resolve(o),idle:!0})))}dispose(){for(const o of this._workerInfos)o.workerPromise.then((o=>{o.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(o){this._executeOnIdleWorker(o)||this._pendingActions.push(o)}_executeOnIdleWorker(o){for(const v of this._workerInfos)if(v.idle)return this._execute(v,o),!0;return!1}_execute(o,v){o.idle=!1,o.workerPromise.then((V=>{v(V,(()=>{const v=this._pendingActions.shift();v?this._execute(o,v):o.idle=!0}))}))}}class E extends g{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.DefaultOptions;super([]),this._maxWorkers=o,this._createWorkerAsync=v,this._options=V}push(o){if(!this._executeOnIdleWorker(o))if(this._workerInfos.length<this._maxWorkers){const v={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(v),this._execute(v,o)}else this._pendingActions.push(o)}_execute(o,v){o.timeoutId&&(clearTimeout(o.timeoutId),delete o.timeoutId),super._execute(o,((V,g)=>{v(V,(()=>{g(),o.idle&&(o.timeoutId=setTimeout((()=>{o.workerPromise.then((o=>{o.terminate()}));const v=this._workerInfos.indexOf(o);-1!==v&&this._workerInfos.splice(v,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}E.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},13047:(o,v,V)=>{V.d(v,{d:()=>h});var g=V(12473),E=V(12297),I=V(12339),Q=V(12577),U=V(12479),n=V(12535),O=V(12449);class h{get influence(){return this._influence}set influence(o){if(this._influence===o)return;const v=this._influence;this._influence=o,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===v||0===o)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(o){this._animationPropertiesOverride=o}constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=o,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new E.e,this._onDataLayoutChanged=new E.e,this._animationPropertiesOverride=null,this.id=o,this._scene=V||I.d.LastCreatedScene,this.influence=v,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(o){const v=this.hasPositions;this._positions=o,v!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(o){const v=this.hasNormals;this._normals=o,v!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(o){const v=this.hasTangents;this._tangents=o,v!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(o){const v=this.hasUVs;this._uvs=o,v!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(o){const v=this.hasUV2s;this._uv2s=o,v!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(o){const v=this.hasColors;this._colors=o,v!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const o=n.c.Clone((()=>new h(this.name,this.influence,this._scene)),this);return o._positions=this._positions,o._normals=this._normals,o._tangents=this._tangents,o._uvs=this._uvs,o._uv2s=this._uv2s,o._colors=this._colors,o}serialize(){const o={};return o.name=this.name,o.influence=this.influence,o.Jo=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(o.id=this.id),this.hasNormals&&(o.do=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(o.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(o.Yo=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(o.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(o.No=Array.prototype.slice.call(this.getColors())),n.c.AppendSerializedAnimations(this,o),o}getClassName(){return"MorphTarget"}static Parse(o,v){const V=new h(o.name,o.influence);if(V.setPositions(o.Jo),null!=o.id&&(V.id=o.id),o.do&&V.setNormals(o.do),o.tangents&&V.setTangents(o.tangents),o.Yo&&V.setUVs(o.Yo),o.uv2s&&V.setUV2s(o.uv2s),o.No&&V.setColors(o.No),o.animations){for(let v=0;v<o.animations.length;v++){const g=o.animations[v],E=(0,O.d)("BABYLON.Animation");E&&V.animations.push(E.Parse(g))}o.autoAnimate&&v&&v.beginAnimation(V,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1)}return V}static FromMesh(o,v,V){v||(v=o.name);const g=new h(v,V,o.Fo());return g.setPositions(o.getVerticesData(Q.e.PositionKind)),o.isVerticesDataPresent(Q.e.NormalKind)&&g.setNormals(o.getVerticesData(Q.e.NormalKind)),o.isVerticesDataPresent(Q.e.TangentKind)&&g.setTangents(o.getVerticesData(Q.e.TangentKind)),o.isVerticesDataPresent(Q.e.UVKind)&&g.setUVs(o.getVerticesData(Q.e.UVKind)),o.isVerticesDataPresent(Q.e.UV2Kind)&&g.setUV2s(o.getVerticesData(Q.e.UV2Kind)),o.isVerticesDataPresent(Q.e.ColorKind)&&g.setColors(o.getVerticesData(Q.e.ColorKind)),g}}(0,g.c)([(0,U.K)()],h.prototype,"id",void 0)},12932:(o,v,V)=>{V.d(v,{c:()=>x});var g=V(12473),E=V(12488),I=V(12479),Q=V(12297),U=V(12339),n=V(12325),O=V(12535);class h{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new Q.e,this._onClonedObservable=new Q.e}}class x{static AddNodeConstructor(o,v){this._NodeConstructors[o]=v}static Construct(o,v,V,g){const E=this._NodeConstructors[o];return E?E(v,V,g):null}set accessibilityTag(o){this._accessibilityTag=o,this.onAccessibilityTagChangedObservable.notifyObservers(o)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(o){this._nodeDataStorage._doNotSerialize=o}l(){return this._nodeDataStorage._isDisposed}set parent(o){if(this._parentNode===o)return;const v=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const v=this._parentNode._children.indexOf(this);-1!==v&&this._parentNode._children.splice(v,1),o||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=o,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),v||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(o){o.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const o=this._scene.rootNodes,v=o.length-1;o[this._nodeDataStorage._sceneRootNodesIndex]=o[v],o[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(o){this._animationPropertiesOverride=o}getClassName(){return"Node"}set onDispose(o){this._onDisposeObserver&&this.Tg.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tg.add(o)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new h,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Q.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=E.Matrix.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Tg=new Q.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=o,this.id=o,this._scene=v||U.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),V&&this._addToSceneRootNodes()}Fo(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(o)||(o.init(),this._scene.isLoading&&!v?this._scene.onDataLoadedObservable.addOnce((()=>{o.attach(this)})):o.attach(this),this._behaviors.push(o)),this}removeBehavior(o){const v=this._behaviors.indexOf(o);return-1===v||(this._behaviors[v].detach(),this._behaviors.splice(v,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(o){for(const v of this._behaviors)if(v.name===o)return v;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Ag(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(o){!o&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(o){return this.parent?this.parent._getActionManagerForTrigger(o,!1):null}_updateCache(o){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}eO(o){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const o of this._children)o._syncParentEnabledState()}eU(o){this._nodeDataStorage._isEnabled!==o&&(this._nodeDataStorage._isEnabled=o,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(o))}isDescendantOf(o){return!!this.parent&&(this.parent===o||this.parent.isDescendantOf(o))}_getDescendants(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0;if(this._children)for(let g=0;g<this._children.length;g++){const E=this._children[g];V&&!V(E)||o.push(E),v||E._getDescendants(o,!1,V)}}getDescendants(o,v){const V=[];return this._getDescendants(V,o,v),V}getChildMeshes(o,v){const V=[];return this._getDescendants(V,o,(o=>(!v||v(o))&&void 0!==o.wx)),V}getChildren(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(v,o)}_setReady(o){o!==this._nodeDataStorage._isReady&&(o?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(o){for(let v=0;v<this.animations.length;v++){const V=this.animations[v];if(V.name===o)return V}return null}createAnimationRange(o,v,V){if(!this._ranges[o]){this._ranges[o]=x._AnimationRangeFactory(o,v,V);for(let g=0,E=this.animations.length;g<E;g++)this.animations[g]&&this.animations[g].createRange(o,v,V)}}deleteAnimationRange(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let V=0,g=this.animations.length;V<g;V++)this.animations[V]&&this.animations[V].deleteRange(o,v);this._ranges[o]=null}getAnimationRange(o){return this._ranges[o]||null}clone(o,v,V){const g=O.c.Clone((()=>new x(o,this.Fo())),this);if(v&&(g.parent=v),!V){const v=this.getDescendants(!0);for(let V=0;V<v.length;V++){const E=v[V];E.clone(o+"."+E.name,g)}}return g}getAnimationRanges(){const o=[];let v;for(v in this._ranges)o.push(this._ranges[v]);return o}beginAnimation(o,v,V,g){const E=this.getAnimationRange(o);return E?this._scene.beginAnimation(this,E.from,E.to,v,V,g):null}serializeAnimationRanges(){const o=[];for(const v in this._ranges){const V=this._ranges[v];if(!V)continue;const g={};g.name=v,g.from=V.from,g.to=V.to,o.push(g)}return o}Ag(o){return this._worldMatrix||(this._worldMatrix=E.Matrix.Identity()),this._worldMatrix}dispose(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!o){const V=this.getDescendants(!0);for(const g of V)g.dispose(o,v)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Tg.notifyObservers(this),this.Tg.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const V of this._behaviors)V.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(o,v,V){if(v.ranges)for(let g=0;g<v.ranges.length;g++){const V=v.ranges[g];o.createAnimationRange(V.name,V.from,V.to)}}getHierarchyBoundingVectors(){let o,v,V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.Fo().incrementRenderId(),this.Ag(!0);const I=this;if(I.getBoundingInfo&&I.wg){const V=I.getBoundingInfo();o=V.boundingBox.minimumWorld.clone(),v=V.boundingBox.maximumWorld.clone()}else o=new E.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new E.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(V){const V=this.getDescendants(!1);for(const I of V){const V=I;if(V.Ag(!0),g&&!g(V))continue;if(!V.getBoundingInfo||0===V.getTotalVertices())continue;const Q=V.getBoundingInfo().boundingBox,U=Q.minimumWorld,n=Q.maximumWorld;E.cv.CheckExtends(U,o,v),E.cv.CheckExtends(n,o,v)}}return{min:o,max:v}}}x._AnimationRangeFactory=(o,v,V)=>{throw(0,n.b)("AnimationRange")},x._NodeConstructors={},(0,g.c)([(0,I.K)()],x.prototype,"name",void 0),(0,g.c)([(0,I.K)()],x.prototype,"id",void 0),(0,g.c)([(0,I.K)()],x.prototype,"uniqueId",void 0),(0,g.c)([(0,I.K)()],x.prototype,"state",void 0),(0,g.c)([(0,I.K)()],x.prototype,"metadata",void 0)}}]);