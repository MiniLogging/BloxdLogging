"use strict";(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[27],{12845:(y,c,A)=>{A.d(c,{b:()=>s,d:()=>P,g:()=>D,h:()=>O,l:()=>H,p:()=>i,s:()=>L});var l=A(12325),w=A(12375),N=A(12340),p=A(12283),W=A(12847),h=A(12743),I=A(12356),q=A(12182),o=A(12363);const O=Object.freeze(new l.Quaternion(0,0,0,0)),L=Object.freeze(l.gc.Zero()),i=Object.freeze(l.Vector2.Zero()),H=Object.freeze(I.b.Zero()),P=Object.freeze(w.dc.Black()),D=Object.freeze(new w.ip(0,0,0,0)),t={key:0,repeatCount:0,loopMode:2};class s{static _PrepareAnimation(y,c,A,N,p,W,h,q){let o;if(!isNaN(parseFloat(p))&&isFinite(p)?o=s.ANIMATIONTYPE_FLOAT:p instanceof l.Quaternion?o=s.ANIMATIONTYPE_QUATERNION:p instanceof l.gc?o=s.ANIMATIONTYPE_VECTOR3:p instanceof l.Vector2?o=s.ANIMATIONTYPE_VECTOR2:p instanceof w.dc?o=s.ANIMATIONTYPE_COLOR3:p instanceof w.ip?o=s.ANIMATIONTYPE_COLOR4:p instanceof I.b&&(o=s.ANIMATIONTYPE_SIZE),void 0==o)return null;const O=new s(y,c,A,o,h),L=[{frame:0,value:p},{frame:N,value:W}];return O.setKeys(L),void 0!==q&&O.setEasingFunction(q),O}static CreateAnimation(y,c,A,l){const w=new s(y+"Animation",y,A,c,s.ANIMATIONLOOPMODE_CONSTANT);return w.setEasingFunction(l),w}static CreateAndStartAnimation(y,c,A,l,w,N,p,W,h,I,q){const o=s._PrepareAnimation(y,A,l,w,N,p,W,h);return o?(c.mc&&(q=c.mc()),q?q.beginDirectAnimation(c,[o],0,w,o.loopMode!==s.ANIMATIONLOOPMODE_CONSTANT,1,I):null):null}static CreateAndStartHierarchyAnimation(y,c,A,l,w,N,p,W,h,I,q){const o=s._PrepareAnimation(y,l,w,N,p,W,h,I);if(!o)return null;return c.mc().beginDirectHierarchyAnimation(c,A,[o],0,N,1===o.loopMode,1,q)}static CreateMergeAndStartAnimation(y,c,A,l,w,N,p,W,h,I){const q=s._PrepareAnimation(y,A,l,w,N,p,W,h);return q?(c.animations.push(q),c.mc().beginAnimation(c,0,w,1===q.loopMode,1,I)):null}static MakeAnimationAdditive(y,c,A){let w;w="object"===typeof c?c:{referenceFrame:c??0,range:A,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let N=y;if(w.cloneOriginalAnimation&&(N=y.clone(),N.name=w.clonedAnimationName||N.name),!N._keys.length)return N;const p=w.referenceFrame&&w.referenceFrame>=0?w.referenceFrame:0;let W=0;const h=N._keys[0];let I=N._keys.length-1;const q=N._keys[I],o={referenceValue:h.value,referencePosition:l.TmpVectors.gc[0],referenceQuaternion:l.TmpVectors.Quaternion[0],referenceScaling:l.TmpVectors.gc[1],keyPosition:l.TmpVectors.gc[2],keyQuaternion:l.TmpVectors.Quaternion[1],keyScaling:l.TmpVectors.gc[3]};let O=h.frame,L=q.frame;if(w.range){const y=N.getRange(w.range);y&&(O=y.from,L=y.to)}else O=w.fromFrame??O,L=w.toFrame??L;if(O!==h.frame&&(W=N.createKeyForFrame(O)),L!==q.frame&&(I=N.createKeyForFrame(L)),1===N._keys.length){const y=N._getKeyValue(N._keys[0]);o.referenceValue=y.clone?y.clone():y}else if(p<=h.frame){const y=N._getKeyValue(h.value);o.referenceValue=y.clone?y.clone():y}else if(p>=q.frame){const y=N._getKeyValue(q.value);o.referenceValue=y.clone?y.clone():y}else{t.key=0;const y=N._interpolate(p,t);o.referenceValue=y.clone?y.clone():y}N.dataType===s.ANIMATIONTYPE_QUATERNION?o.referenceValue.normalize().conjugateInPlace():N.dataType===s.ANIMATIONTYPE_MATRIX&&(o.referenceValue.decompose(o.referenceScaling,o.referenceQuaternion,o.referencePosition),o.referenceQuaternion.normalize().conjugateInPlace());let i=Number.MAX_VALUE;const H=w.clipKeys?[]:null;for(let P=W;P<=I;P++){let y=N._keys[P];if((H||w.cloneOriginalAnimation)&&(y={frame:y.frame,value:y.value.clone?y.value.clone():y.value,inTangent:y.inTangent,outTangent:y.outTangent,interpolation:y.interpolation,lockedTangent:y.lockedTangent},H&&(i===Number.MAX_VALUE&&(i=y.frame),y.frame-=i,H.push(y))),!P||N.dataType===s.ANIMATIONTYPE_FLOAT||y.value!==h.value)switch(N.dataType){case s.ANIMATIONTYPE_MATRIX:y.value.decompose(o.keyScaling,o.keyQuaternion,o.keyPosition),o.keyPosition.uo(o.referencePosition),o.keyScaling.divideInPlace(o.referenceScaling),o.referenceQuaternion.multiplyToRef(o.keyQuaternion,o.keyQuaternion),l.Matrix.ComposeToRef(o.keyScaling,o.keyQuaternion,o.keyPosition,y.value);break;case s.ANIMATIONTYPE_QUATERNION:o.referenceValue.multiplyToRef(y.value,y.value);break;case s.ANIMATIONTYPE_VECTOR2:case s.ANIMATIONTYPE_VECTOR3:case s.ANIMATIONTYPE_COLOR3:case s.ANIMATIONTYPE_COLOR4:y.value.subtractToRef(o.referenceValue,y.value);break;case s.ANIMATIONTYPE_SIZE:y.value.width-=o.referenceValue.width,y.value.height-=o.referenceValue.height;break;default:y.value-=o.referenceValue}}return H&&N.setKeys(H,!0),N}static TransitionTo(y,c,A,l,w,N,p){let W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(p<=0)return A[y]=c,W&&W(),null;const h=w*(p/1e3);N.setKeys([{frame:0,value:A[y].clone?A[y].clone():A[y]},{frame:h,value:c}]),A.animations||(A.animations=[]),A.animations.push(N);const I=l.beginAnimation(A,0,h,!1);return I.onAnimationEnd=W,I}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const y of this._runtimeAnimations)if(!y.isStopped())return!0;return!1}constructor(y,c,A,l,w,N){this.name=y,this.targetProperty=c,this.framePerSecond=A,this.dataType=l,this.loopMode=w,this.enableBlending=N,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=c.split("."),this.dataType=l,this.loopMode=void 0===w?s.ANIMATIONLOOPMODE_CYCLE:w,this.uniqueId=s._UniqueIdGenerator++}toString(y){let c="Name: "+this.name+", property: "+this.targetProperty;if(c+=", datatype: "+["Float","gc","Quaternion","Matrix","dc","Vector2"][this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),y){c+=", Ranges: {";let y=!0;for(const A in this._ranges)y&&(c+=", ",y=!1),c+=A;c+="}"}return c}addEvent(y){this._events.push(y),this._events.sort(((y,c)=>y.frame-c.frame))}removeEvents(y){for(let c=0;c<this._events.length;c++)this._events[c].frame===y&&(this._events.splice(c,1),c--)}getEvents(){return this._events}createRange(y,c,A){this._ranges[y]||(this._ranges[y]=new W.b(y,c,A))}deleteRange(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this._ranges[y];if(A){if(c){const y=A.from,c=A.to;for(let A=this._keys.length-1;A>=0;A--)this._keys[A].frame>=y&&this._keys[A].frame<=c&&this._keys.splice(A,1)}this._ranges[y]=null}}getRange(y){return this._ranges[y]}getKeys(){return this._keys}getHighestFrame(){let y=0;for(let c=0,A=this._keys.length;c<A;c++)y<this._keys[c].frame&&(y=this._keys[c].frame);return y}getEasingFunction(){return this._easingFunction}setEasingFunction(y){this._easingFunction=y}floatInterpolateFunction(y,c,A){return(0,N.Lerp)(y,c,A)}floatInterpolateFunctionWithTangents(y,c,A,l,w){return(0,N.Hermite)(y,c,A,l,w)}quaternionInterpolateFunction(y,c,A){return l.Quaternion.Slerp(y,c,A)}quaternionInterpolateFunctionWithTangents(y,c,A,w,N){return l.Quaternion.Hermite(y,c,A,w,N).normalize()}vector3InterpolateFunction(y,c,A){return l.gc.Lerp(y,c,A)}vector3InterpolateFunctionWithTangents(y,c,A,w,N){return l.gc.Hermite(y,c,A,w,N)}vector2InterpolateFunction(y,c,A){return l.Vector2.Lerp(y,c,A)}vector2InterpolateFunctionWithTangents(y,c,A,w,N){return l.Vector2.Hermite(y,c,A,w,N)}sizeInterpolateFunction(y,c,A){return I.b.Lerp(y,c,A)}color3InterpolateFunction(y,c,A){return w.dc.Lerp(y,c,A)}color3InterpolateFunctionWithTangents(y,c,A,l,N){return w.dc.Hermite(y,c,A,l,N)}color4InterpolateFunction(y,c,A){return w.ip.Lerp(y,c,A)}color4InterpolateFunctionWithTangents(y,c,A,l,N){return w.ip.Hermite(y,c,A,l,N)}_getKeyValue(y){return"function"===typeof y?y():y}evaluate(y){return t.key=0,this._interpolate(y,t)}_interpolate(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(c.loopMode===s.ANIMATIONLOOPMODE_CONSTANT&&c.repeatCount>0)return c.highLimitValue.clone?c.highLimitValue.clone():c.highLimitValue;const l=this._keys;let w;if(this._coreAnimation)w=this._coreAnimation._key;else{const N=l.length;for(w=c.key;w>=0&&y<l[w].frame;)--w;for(;w+1<=N-1&&y>=l[w+1].frame;)++w;if(c.key=w,w<0)return A?void 0:this._getKeyValue(l[0].value);if(w+1>N-1)return A?void 0:this._getKeyValue(l[N-1].value);this._key=w}const N=l[w],p=l[w+1];if(A&&(y===N.frame||y===p.frame))return;const W=this._getKeyValue(N.value),h=this._getKeyValue(p.value);if(1===N.interpolation)return p.frame>y?W:h;const I=void 0!==N.outTangent&&void 0!==p.inTangent,q=p.frame-N.frame;let o=(y-N.frame)/q;const t=N.easingFunction||this.getEasingFunction();switch(t&&(o=t.ease(o)),this.dataType){case s.ANIMATIONTYPE_FLOAT:{const y=I?this.floatInterpolateFunctionWithTangents(W,N.outTangent*q,h,p.inTangent*q,o):this.floatInterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(c.offsetValue??0)*c.repeatCount+y}break}case s.ANIMATIONTYPE_QUATERNION:{const y=I?this.quaternionInterpolateFunctionWithTangents(W,N.outTangent.scale(q),h,p.inTangent.scale(q),o):this.quaternionInterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.addInPlace((c.offsetValue||O).scale(c.repeatCount))}return y}case s.ANIMATIONTYPE_VECTOR3:{const y=I?this.vector3InterpolateFunctionWithTangents(W,N.outTangent.scale(q),h,p.inTangent.scale(q),o):this.vector3InterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((c.offsetValue||L).scale(c.repeatCount))}break}case s.ANIMATIONTYPE_VECTOR2:{const y=I?this.vector2InterpolateFunctionWithTangents(W,N.outTangent.scale(q),h,p.inTangent.scale(q),o):this.vector2InterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((c.offsetValue||i).scale(c.repeatCount))}break}case s.ANIMATIONTYPE_SIZE:switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(W,h,o);case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(W,h,o).add((c.offsetValue||H).scale(c.repeatCount))}break;case s.ANIMATIONTYPE_COLOR3:{const y=I?this.color3InterpolateFunctionWithTangents(W,N.outTangent.scale(q),h,p.inTangent.scale(q),o):this.color3InterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((c.offsetValue||P).scale(c.repeatCount))}break}case s.ANIMATIONTYPE_COLOR4:{const y=I?this.color4InterpolateFunctionWithTangents(W,N.outTangent.scale(q),h,p.inTangent.scale(q),o):this.color4InterpolateFunction(W,h,o);switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return y;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y.add((c.offsetValue||D).scale(c.repeatCount))}break}case s.ANIMATIONTYPE_MATRIX:switch(c.loopMode){case s.ANIMATIONLOOPMODE_CYCLE:case s.ANIMATIONLOOPMODE_CONSTANT:case s.ANIMATIONLOOPMODE_YOYO:return s.AllowMatricesInterpolation?this.matrixInterpolateFunction(W,h,o,c.workValue):W;case s.ANIMATIONLOOPMODE_RELATIVE:case s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W}}return 0}matrixInterpolateFunction(y,c,A,w){return s.AllowMatrixDecomposeForInterpolation?w?(l.Matrix.DecomposeLerpToRef(y,c,A,w),w):l.Matrix.DecomposeLerp(y,c,A):w?(l.Matrix.LerpToRef(y,c,A,w),w):l.Matrix.Lerp(y,c,A)}clone(){const y=new s(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(y.enableBlending=this.enableBlending,y.blendingSpeed=this.blendingSpeed,this._keys&&y.setKeys(this._keys),this._ranges){y._ranges={};for(const c in this._ranges){const A=this._ranges[c];A&&(y._ranges[c]=A.clone())}}return y}setKeys(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=c?y:y.slice(0)}createKeyForFrame(y){t.key=0;const c=this._interpolate(y,t,!0);if(!c)return this._keys[t.key].frame===y?t.key:t.key+1;const A={frame:y,value:c.clone?c.clone():c};return this._keys.splice(t.key+1,0,A),t.key+1}serialize(){const y={};y.name=this.name,y.property=this.targetProperty,y.framePerSecond=this.framePerSecond,y.dataType=this.dataType,y.loopBehavior=this.loopMode,y.enableBlending=this.enableBlending,y.blendingSpeed=this.blendingSpeed;const c=this.dataType;y.keys=[];const A=this.getKeys();for(let l=0;l<A.length;l++){const w=A[l],N={};switch(N.frame=w.frame,c){case s.ANIMATIONTYPE_FLOAT:N.values=[w.value],void 0!==w.inTangent&&N.values.push(w.inTangent),void 0!==w.outTangent&&(void 0===w.inTangent&&N.values.push(void 0),N.values.push(w.outTangent)),void 0!==w.interpolation&&(void 0===w.inTangent&&N.values.push(void 0),void 0===w.outTangent&&N.values.push(void 0),N.values.push(w.interpolation));break;case s.ANIMATIONTYPE_QUATERNION:case s.ANIMATIONTYPE_MATRIX:case s.ANIMATIONTYPE_VECTOR3:case s.ANIMATIONTYPE_COLOR3:case s.ANIMATIONTYPE_COLOR4:N.values=w.value.fc(),void 0!=w.inTangent&&N.values.push(w.inTangent.fc()),void 0!=w.outTangent&&(void 0===w.inTangent&&N.values.push(void 0),N.values.push(w.outTangent.fc())),void 0!==w.interpolation&&(void 0===w.inTangent&&N.values.push(void 0),void 0===w.outTangent&&N.values.push(void 0),N.values.push(w.interpolation))}y.keys.push(N)}y.ranges=[];for(const l in this._ranges){const c=this._ranges[l];if(!c)continue;const A={};A.name=l,A.from=c.from,A.to=c.to,y.ranges.push(A)}return y}static _UniversalLerp(y,c,A){const l=y.constructor;return l.Lerp?l.Lerp(y,c,A):l.Slerp?l.Slerp(y,c,A):y.toFixed?y*(1-A)+A*c:c}static Parse(y){const c=new s(y.name,y.property,y.framePerSecond,y.dataType,y.loopBehavior),A=y.dataType,N=[];let p,W;for(y.enableBlending&&(c.enableBlending=y.enableBlending),y.blendingSpeed&&(c.blendingSpeed=y.blendingSpeed),W=0;W<y.keys.length;W++){const c=y.keys[W];let h,I,q;switch(A){case s.ANIMATIONTYPE_FLOAT:p=c.values[0],c.values.length>=2&&(h=c.values[1]),c.values.length>=3&&(I=c.values[2]),c.values.length>=4&&(q=c.values[3]);break;case s.ANIMATIONTYPE_QUATERNION:if(p=l.Quaternion.yA(c.values),c.values.length>=8){const y=l.Quaternion.yA(c.values.slice(4,8));y.equals(l.Quaternion.Zero())||(h=y)}if(c.values.length>=12){const y=l.Quaternion.yA(c.values.slice(8,12));y.equals(l.Quaternion.Zero())||(I=y)}c.values.length>=13&&(q=c.values[12]);break;case s.ANIMATIONTYPE_MATRIX:p=l.Matrix.yA(c.values),c.values.length>=17&&(q=c.values[16]);break;case s.ANIMATIONTYPE_COLOR3:p=w.dc.yA(c.values),c.values[3]&&(h=w.dc.yA(c.values[3])),c.values[4]&&(I=w.dc.yA(c.values[4])),c.values[5]&&(q=c.values[5]);break;case s.ANIMATIONTYPE_COLOR4:p=w.ip.yA(c.values),c.values[4]&&(h=w.ip.yA(c.values[4])),c.values[5]&&(I=w.ip.yA(c.values[5])),c.values[6]&&(q=w.ip.yA(c.values[6]));break;case s.ANIMATIONTYPE_VECTOR3:default:p=l.gc.yA(c.values),c.values[3]&&(h=l.gc.yA(c.values[3])),c.values[4]&&(I=l.gc.yA(c.values[4])),c.values[5]&&(q=c.values[5])}const o={};o.frame=c.frame,o.value=p,void 0!=h&&(o.inTangent=h),void 0!=I&&(o.outTangent=I),void 0!=q&&(o.interpolation=q),N.push(o)}if(c.setKeys(N),y.ranges)for(W=0;W<y.ranges.length;W++)p=y.ranges[W],c.createRange(p.name,p.from,p.to);return c}static AppendSerializedAnimations(y,c){o.d.AppendSerializedAnimations(y,c)}static async ParseFromFileAsync(y,c){return await new Promise(((A,l)=>{const w=new q.d;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){let c=JSON.parse(w.responseText);if(c.animations&&(c=c.animations),c.length){const y=[];for(const A of c)y.push(this.Parse(A));A(y)}else{const l=this.Parse(c);y&&(l.name=y),A(l)}}else l("Unable to load the animation")})),w.open("GET",c),w.send()}))}static async ParseFromSnippetAsync(y){return await new Promise(((c,A)=>{const l=new q.d;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const A=JSON.parse(JSON.parse(l.responseText).jsonPayload);if(A.animations){const l=JSON.parse(A.animations),w=[];for(const c of l.animations){const A=this.Parse(c);A.snippetId=y,w.push(A)}c(w)}else{const l=JSON.parse(A.animation),w=this.Parse(l);w.snippetId=y,c(w)}}else A("Unable to load the snippet "+y)})),l.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),l.send()}))}}s._UniqueIdGenerator=0,s.AllowMatricesInterpolation=!1,s.AllowMatrixDecomposeForInterpolation=!0,s.SnippetUrl="https://snippet.babylonjs.com",s.ANIMATIONTYPE_FLOAT=0,s.ANIMATIONTYPE_VECTOR3=1,s.ANIMATIONTYPE_QUATERNION=2,s.ANIMATIONTYPE_MATRIX=3,s.ANIMATIONTYPE_COLOR3=4,s.ANIMATIONTYPE_COLOR4=7,s.ANIMATIONTYPE_VECTOR2=5,s.ANIMATIONTYPE_SIZE=6,s.ANIMATIONLOOPMODE_RELATIVE=0,s.ANIMATIONLOOPMODE_CYCLE=1,s.ANIMATIONLOOPMODE_CONSTANT=2,s.ANIMATIONLOOPMODE_YOYO=4,s.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,s.CreateFromSnippetAsync=s.ParseFromSnippetAsync,(0,p.f)("BABYLON.Animation",s),h.b._AnimationRangeFactory=(y,c,A)=>new W.b(y,c,A)},12847:(y,c,A)=>{A.d(c,{b:()=>l});class l{constructor(y,c,A){this.name=y,this.from=c,this.to=A}clone(){return new l(this.name,this.from,this.to)}}},12775:(y,c,A)=>{A.d(c,{c:()=>P});var l=A(12307),w=A(12310),N=A(12419),p=A(12144),W=A(12153),h=A(12325),I=A(12743),q=A(12161),o=A(12283),O=A(12178),L=A(12440),i=A(12525),H=A(12363);class P extends I.b{get position(){return this._position}set position(y){this._position=y}set upVector(y){this._upVector=y}get upVector(){return this._upVector}get screenArea(){let y=0,c=0;if(this.mode===P.PERSPECTIVE_CAMERA)this.fovMode===P.FOVMODE_VERTICAL_FIXED?(c=2*this.ec*Math.tan(this.fov/2),y=this.getEngine().getAspectRatio(this)*c):(y=2*this.ec*Math.tan(this.fov/2),c=y/this.getEngine().getAspectRatio(this));else{const A=this.getEngine().getRenderWidth()/2,l=this.getEngine().getRenderHeight()/2;y=(this.orthoRight??A)-(this.orthoLeft??-A),c=(this.orthoTop??l)-(this.orthoBottom??-l)}return y*c}set orthoLeft(y){this._orthoLeft=y;for(const c of this._rigCameras)c.orthoLeft=y}get orthoLeft(){return this._orthoLeft}set orthoRight(y){this._orthoRight=y;for(const c of this._rigCameras)c.orthoRight=y}get orthoRight(){return this._orthoRight}set orthoBottom(y){this._orthoBottom=y;for(const c of this._rigCameras)c.orthoBottom=y}get orthoBottom(){return this._orthoBottom}set orthoTop(y){this._orthoTop=y;for(const c of this._rigCameras)c.orthoTop=y}get orthoTop(){return this._orthoTop}setFocalLength(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(c/(2*y))}set mode(y){this._mode=y;for(const c of this._rigCameras)c.mode=y}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(y,c,A){let l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(y,A,!1),this._position=h.gc.Zero(),this._upVector=h.gc.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.ec=1,this.maxZ=1e4,this.inertia=.9,this._mode=P.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new L.d(0,0,1,1),this.layerMask=268435455,this.fovMode=P.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=P.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new W.d,this.onProjectionMatrixChangedObservable=new W.d,this.onAfterCheckInputsObservable=new W.d,this.onRestoreStateObservable=new W.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new h.Matrix,this._postProcesses=new Array,this._activeMeshes=new N.f(256),this._globalPosition=h.gc.Zero(),this._computedViewMatrix=h.Matrix.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=h.Matrix.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=h.Quaternion.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.mc().addCamera(this),l&&!this.mc().activeCamera&&(this.mc().activeCamera=this),this.position=c,this.renderPassId=this.mc().getEngine().createRenderPassId(`Camera ${y}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Yq"}toString(y){let c="Name: "+this.name;if(c+=", type: "+this.getClassName(),this.animations)for(let A=0;A<this.animations.length;A++)c+=", animation[0]: "+this.animations[A].toString(y);return c}applyVerticalCorrection(){const y=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-y.x:y.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(y){return-1!==this._activeMeshes.indexOf(y)}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(y)for(const c of this._postProcesses)if(c&&!c.isReady())return!1;return super.isReady(y)}_initCache(){super._initCache(),this._cache.position=new h.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.ec=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(y){y||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let y=this._cache.mode===this.mode&&this._cache.ec===this.ec&&this._cache.maxZ===this.maxZ;if(!y)return!1;const c=this.getEngine();return this.mode===P.PERSPECTIVE_CAMERA?y=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===c.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(y=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===c.getRenderWidth()&&this._cache.renderHeight===c.getRenderHeight(),this.oblique&&(y=y&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),y}attachControl(y,c){}IO(y){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==P.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let y=0;y<this._postProcesses.length;y++)if(null!==this._postProcesses[y])return this._postProcesses[y];return null}_cascadePostProcessesToRigCams(){const y=this._getFirstPostProcess();y&&y.markTextureDirty();for(let c=0,A=this._rigCameras.length;c<A;c++){const y=this._rigCameras[c],A=y._rigPostProcess;if(A){"pass"===A.getEffectName()&&(y.isIntermediate=0===this._postProcesses.length),y._postProcesses=this._postProcesses.slice(0).concat(A),A.markTextureDirty()}else y._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!y.isReusable()&&this._postProcesses.indexOf(y)>-1?(q.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==c||c<0?this._postProcesses.push(y):null===this._postProcesses[c]?this._postProcesses[c]=y:this._postProcesses.splice(c,0,y),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Bq(),this._postProcesses.indexOf(y))}detachPostProcess(y){const c=this._postProcesses.indexOf(y);-1!==c&&(this._postProcesses[c]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Bq(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return h.Matrix.Identity()}getViewMatrix(y){return!y&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.mc().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(y){this._doNotComputeProjectionMatrix=!0,void 0!==y&&(this._projectionMatrix=y)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(y){if(this._doNotComputeProjectionMatrix||!y&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.ec=this.ec,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),A=this.mc(),l=c.Xc;if(this.mode===P.PERSPECTIVE_CAMERA){let y;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.ec<=0&&(this.ec=.1),y=A.useRightHandedSystem?h.Matrix.PerspectiveFovRHToRef:h.Matrix.PerspectiveFovLHToRef,y(this.fov,c.getAspectRatio(this),l?this.maxZ:this.ec,l?this.ec:this.maxZ,this._projectionMatrix,this.fovMode===P.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,l)}else{var w,N,p;const y=c.getRenderWidth()/2,W=c.getRenderHeight()/2;A.useRightHandedSystem?this.oblique?h.Matrix.ObliqueOffCenterRHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-W,this.orthoTop??W,l?this.maxZ:this.ec,l?this.ec:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):h.Matrix.OrthoOffCenterRHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-W,this.orthoTop??W,l?this.maxZ:this.ec,l?this.ec:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):this.oblique?h.Matrix.ObliqueOffCenterLHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-W,this.orthoTop??W,l?this.maxZ:this.ec,l?this.ec:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):h.Matrix.OrthoOffCenterLHToRef(this.orthoLeft??-y,this.orthoRight??y,this.orthoBottom??-W,this.orthoTop??W,l?this.maxZ:this.ec,l?this.ec:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(w=this.oblique)||void 0===w?void 0:w.angle,this._cache.obliqueLength=null===(N=this.oblique)||void 0===N?void 0:N.length,this._cache.obliqueOffset=null===(p=this.oblique)||void 0===p?void 0:p.offset,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(y){return(this.radius||(this.target?h.gc.Distance(this.position,this.target):this.position.length()))+y}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?i.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=i.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),c&&this.rigCameras.length>0){let c=!1;for(const A of this.rigCameras)A._updateFrustumPlanes(),c=c||y.isInFrustum(A._frustumPlanes);return c}return y.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(y){return this._updateFrustumPlanes(),y.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,O.d)("Ray")}getForwardRayToRef(y){throw(0,O.d)("Ray")}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.mc().stopAnimation(this),this.mc().removeCamera(this);this._rigCameras.length>0;){const y=this._rigCameras.pop();y&&y.dispose()}if(this._parentContainer){const y=this._parentContainer.cameras.indexOf(this);y>-1&&this._parentContainer.cameras.splice(y,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==P.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let y=this._postProcesses.length;for(;--y>=0;){const c=this._postProcesses[y];c&&c.dispose(this)}}let A=this.customRenderTargets.length;for(;--A>=0;)this.customRenderTargets[A].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.mc().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(y,c)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(y,c){if(this.cameraRigMode!==y){for(;this._rigCameras.length>0;){const y=this._rigCameras.pop();y&&y.dispose()}if(this.cameraRigMode=y,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=c.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=p.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==P.RIG_MODE_NONE){const y=this.createRigCamera(this.name+"_L",0);y&&(y._isLeftCamera=!0);const c=this.createRigCamera(this.name+"_R",1);c&&(c._isRightCamera=!0),y&&c&&(this._rigCameras.push(y),this._rigCameras.push(c))}this._setRigMode(c),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(y){}_getVRProjectionMatrix(){return h.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.ec,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(y,c){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[y]=c,"interaxialDistance"===y&&(this._cameraRigParams.stereoHalfAngle=p.Tools.ToRadians(c/.0637))}createRigCamera(y,c){return null}_updateRigCameras(){for(let y=0;y<this._rigCameras.length;y++)this._rigCameras[y].ec=this.ec,this._rigCameras[y].maxZ=this.maxZ,this._rigCameras[y].fov=this.fov,this._rigCameras[y].upVector.p(this.upVector);this.cameraRigMode===P.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const y=H.d.Serialize(this);return y.uniqueId=this.uniqueId,y.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(y),this.inputs&&this.inputs.serialize(y),H.d.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.isEnabled=this.isEnabled(),y}clone(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=H.d.Clone(P.GetConstructorFromName(this.getClassName(),y,this.mc(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return A.name=y,A.parent=c,this.onClonedObservable.notifyObservers(A),A}Zh(y){const c=h.gc.Zero();return this.getDirectionToRef(y,c),c}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(y,c){h.gc.TransformNormalToRef(y,this.getWorldMatrix(),c)}static GetConstructorFromName(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const N=I.b.Construct(y,c,A,{interaxial_distance:l,isStereoscopicSideBySide:w});return N||(()=>P._CreateDefaultParsedCamera(c,A))}Yc(){return this.getWorldMatrix()}static Parse(y,c){const A=y.type,l=P.GetConstructorFromName(A,y.name,c,y.interaxial_distance,y.isStereoscopicSideBySide),w=H.d.Parse(l,y,c);if(void 0!==y.parentId&&(w._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(w._waitingParentInstanceIndex=y.parentInstanceIndex),w.inputs&&(w.inputs.parse(y),w._setupInputs()),y.upVector&&(w.upVector=h.gc.yA(y.upVector)),w.setPosition&&(w.position.Ec(0,0,0),w.setPosition(h.gc.yA(y.position))),y.target&&w.setTarget&&w.setTarget(h.gc.yA(y.target)),y.cameraRigMode){const c=y.interaxial_distance?{interaxialDistance:y.interaxial_distance}:{};w.setCameraRigMode(y.cameraRigMode,c)}if(y.animations){for(let c=0;c<y.animations.length;c++){const A=y.animations[c],l=(0,o.d)("BABYLON.Animation");l&&w.animations.push(l.Parse(A))}I.b.ParseAnimationRanges(w,y,c)}return y.autoAnimate&&c.beginAnimation(w,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),void 0!==y.isEnabled&&w.ph(y.isEnabled),w}_calculateHandednessMultiplier(){let y=this.mc().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(y*=-1),y}}P._CreateDefaultParsedCamera=(y,c)=>{throw(0,O.d)("UniversalCamera")},P.PERSPECTIVE_CAMERA=0,P.ORTHOGRAPHIC_CAMERA=1,P.FOVMODE_VERTICAL_FIXED=0,P.FOVMODE_HORIZONTAL_FIXED=1,P.RIG_MODE_NONE=0,P.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,P.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,P.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,P.RIG_MODE_STEREOSCOPIC_INTERLACED=14,P.RIG_MODE_VR=20,P.RIG_MODE_CUSTOM=22,P.ForceAttachControlToAlwaysPreventDefault=!1,(0,l.b)([(0,w.M)("position")],P.prototype,"_position",void 0),(0,l.b)([(0,w.M)("upVector")],P.prototype,"_upVector",void 0),(0,l.b)([(0,w.P)()],P.prototype,"orthoLeft",null),(0,l.b)([(0,w.P)()],P.prototype,"orthoRight",null),(0,l.b)([(0,w.P)()],P.prototype,"orthoBottom",null),(0,l.b)([(0,w.P)()],P.prototype,"orthoTop",null),(0,l.b)([(0,w.P)()],P.prototype,"fov",void 0),(0,l.b)([(0,w.P)()],P.prototype,"projectionPlaneTilt",void 0),(0,l.b)([(0,w.P)()],P.prototype,"ec",void 0),(0,l.b)([(0,w.P)()],P.prototype,"maxZ",void 0),(0,l.b)([(0,w.P)()],P.prototype,"inertia",void 0),(0,l.b)([(0,w.P)()],P.prototype,"mode",null),(0,l.b)([(0,w.P)()],P.prototype,"layerMask",void 0),(0,l.b)([(0,w.P)()],P.prototype,"fovMode",void 0),(0,l.b)([(0,w.P)()],P.prototype,"cameraRigMode",void 0),(0,l.b)([(0,w.P)()],P.prototype,"interaxialDistance",void 0),(0,l.b)([(0,w.P)()],P.prototype,"isStereoscopicSideBySide",void 0)},12805:(y,c,A)=>{A.d(c,{b:()=>o});var l=A(12307),w=A(12310),N=A(12775),p=A(12325),W=A(12330),h=A(12521);A(12743).b.AddNodeConstructor("TargetCamera",((y,c)=>()=>new o(y,p.gc.Zero(),c)));const I=p.Matrix.Zero(),q=p.Quaternion.Identity();class o extends N.c{constructor(y,c,A){super(y,c,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new p.gc(0,0,0),this.cameraRotation=new p.Vector2(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=p.gc.Zero(),this._initialFocalDistance=1,this._viewMatrix=p.Matrix.Zero(),this._cameraTransformMatrix=p.Matrix.Zero(),this._cameraRotationMatrix=p.Matrix.Zero(),this._transformedReferencePoint=p.gc.Zero(),this._deferredPositionUpdate=new p.gc,this._deferredRotationQuaternionUpdate=new p.Quaternion,this._deferredRotationUpdate=new p.gc,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=p.gc.Forward(this.mc().useRightHandedSystem),this.rotation=new p.gc(0,this.mc().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(y){this.getWorldMatrix();const c=p.TmpVectors.gc[0],A=p.TmpVectors.gc[1];return A.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(A,c),c.scaleInPlace(y),this.globalPosition.add(c)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const y=this.lockedTarget;y.Yc().getTranslationToRef(y.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Ec(0,0,0),this.cameraRotation.Ec(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new p.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new p.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new p.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(y){y||super._updateCache();const c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.p(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const y=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(y):!y)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const y=this.getEngine();return this.speed*Math.sqrt(y.getDeltaTime()/(100*y.getFps()))}setTarget(y){this.upVector.normalize(),this._initialFocalDistance=y.xc(this.position).length(),this.position.z===y.z&&(this.position.z+=W.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.mc().useRightHandedSystem?p.Matrix.LookAtRHToRef(this.position,y,p.gc.UpReadOnly,I):p.Matrix.LookAtLHToRef(this.position,y,p.gc.UpReadOnly,I),I.invert();const c=this.rotationQuaternion||q;p.Quaternion.FromRotationMatrixToRef(I,c),c.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(y){this.setTarget(y)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(p.TmpVectors.Matrix[0]),p.gc.TransformNormalToRef(this.cameraDirection,p.TmpVectors.Matrix[0],p.TmpVectors.gc[0]),this._deferredPositionUpdate.addInPlace(p.TmpVectors.gc[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const y=this.invertRotation?-this.inverseRotationSpeed:1,c=this._decideIfNeedsToMove(),A=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),c&&this._updatePosition(),A){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*y,this._deferredRotationUpdate.y+=this.cameraRotation.y*y,!this.noRotationConstraint){const y=1.570796;this._deferredRotationUpdate.x>y&&(this._deferredRotationUpdate.x=y),this._deferredRotationUpdate.x<-y&&(this._deferredRotationUpdate.x=-y)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(p.Quaternion.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}c&&(Math.abs(this.cameraDirection.x)<this.speed*W.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*W.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*W.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),A&&(Math.abs(this.cameraRotation.x)<this.speed*W.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*W.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):p.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return p.gc.TransformNormalToRef(p.gc.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),p.gc.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(p.Quaternion.FromEulerVectorToRef(this.rotation,q),h.c.Y.rotateByQuaternionToRef(q,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(y,c,A){if(this.mc().useRightHandedSystem?p.Matrix.LookAtRHToRef(y,c,A,this._viewMatrix):p.Matrix.LookAtLHToRef(y,c,A,this._viewMatrix),this.parent){const y=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(y,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(y)}createRigCamera(y,c){if(this.cameraRigMode!==N.c.RIG_MODE_NONE){const c=new o(y,this.position.clone(),this.mc());return c.isRigCamera=!0,c.rigParent=this,this.cameraRigMode===N.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new p.Quaternion),c._cameraRigParams={},c.rotationQuaternion=new p.Quaternion),c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoTop=this.orthoTop,c.orthoBottom=this.orthoBottom,c}return null}_updateRigCameras(){const y=this._rigCameras[0],c=this._rigCameras[1];switch(this.Yc(),this.cameraRigMode){case N.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case N.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const A=this.cameraRigMode===N.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,l=this.cameraRigMode===N.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*A,y),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*l,c);break}case N.c.RIG_MODE_VR:y.rotationQuaternion?(y.rotationQuaternion.p(this.rotationQuaternion),c.rotationQuaternion.p(this.rotationQuaternion)):(y.rotation.p(this.rotation),c.rotation.p(this.rotation)),y.position.p(this.position),c.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(y,c){this.getTarget().subtractToRef(this.position,o._TargetFocalPoint),o._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const A=o._TargetFocalPoint.addInPlace(this.position);p.Matrix.TranslationToRef(-A.x,-A.y,-A.z,o._TargetTransformMatrix),o._TargetTransformMatrix.multiplyToRef(p.Matrix.RotationAxis(c.upVector,y),o._RigCamTransformMatrix),p.Matrix.TranslationToRef(A.x,A.y,A.z,o._TargetTransformMatrix),o._RigCamTransformMatrix.multiplyToRef(o._TargetTransformMatrix,o._RigCamTransformMatrix),p.gc.TransformCoordinatesToRef(this.position,o._RigCamTransformMatrix,c.position),c.setTarget(A)}getClassName(){return"TargetCamera"}}o._RigCamTransformMatrix=new p.Matrix,o._TargetTransformMatrix=new p.Matrix,o._TargetFocalPoint=new p.gc,(0,l.b)([(0,w.P)()],o.prototype,"updateUpVectorFromRotation",void 0),(0,l.b)([(0,w.M)()],o.prototype,"rotation",void 0),(0,l.b)([(0,w.P)()],o.prototype,"speed",void 0),(0,l.b)([(0,w.y)("lockedTargetId")],o.prototype,"lockedTarget",void 0)},12802:(y,c,A)=>{A.d(c,{c:()=>l});class l{}l.AUTOSAMPLERSUFFIX="Sampler",l.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",l.ALPHA_DISABLE=0,l.ALPHA_ADD=1,l.ALPHA_COMBINE=2,l.ALPHA_SUBTRACT=3,l.ALPHA_MULTIPLY=4,l.ALPHA_MAXIMIZED=5,l.ALPHA_ONEONE=6,l.ALPHA_PREMULTIPLIED=7,l.ALPHA_PREMULTIPLIED_PORTERDUFF=8,l.ALPHA_INTERPOLATE=9,l.ALPHA_SCREENMODE=10,l.ALPHA_ONEONE_ONEONE=11,l.ALPHA_ALPHATOCOLOR=12,l.ALPHA_REVERSEONEMINUS=13,l.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,l.ALPHA_ONEONE_ONEZERO=15,l.ALPHA_EXCLUSION=16,l.ALPHA_LAYER_ACCUMULATE=17,l.ALPHA_EQUATION_ADD=0,l.ALPHA_EQUATION_SUBSTRACT=1,l.ALPHA_EQUATION_REVERSE_SUBTRACT=2,l.ALPHA_EQUATION_MAX=3,l.ALPHA_EQUATION_MIN=4,l.ALPHA_EQUATION_DARKEN=5,l.DELAYLOADSTATE_NONE=0,l.DELAYLOADSTATE_LOADED=1,l.DELAYLOADSTATE_LOADING=2,l.DELAYLOADSTATE_NOTLOADED=4,l.NEVER=512,l.ALWAYS=519,l.LESS=513,l.EQUAL=514,l.LEQUAL=515,l.GREATER=516,l.GEQUAL=518,l.NOTEQUAL=517,l.KEEP=7680,l.ZERO=0,l.REPLACE=7681,l.INCR=7682,l.DECR=7683,l.INVERT=5386,l.INCR_WRAP=34055,l.DECR_WRAP=34056,l.TEXTURE_CLAMP_ADDRESSMODE=0,l.TEXTURE_WRAP_ADDRESSMODE=1,l.TEXTURE_MIRROR_ADDRESSMODE=2,l.TEXTURE_CREATIONFLAG_STORAGE=1,l.TEXTUREFORMAT_ALPHA=0,l.TEXTUREFORMAT_LUMINANCE=1,l.TEXTUREFORMAT_LUMINANCE_ALPHA=2,l.TEXTUREFORMAT_RGB=4,l.TEXTUREFORMAT_RGBA=5,l.TEXTUREFORMAT_RED=6,l.TEXTUREFORMAT_R=6,l.TEXTUREFORMAT_R16_UNORM=33322,l.TEXTUREFORMAT_RG16_UNORM=33324,l.TEXTUREFORMAT_RGB16_UNORM=32852,l.TEXTUREFORMAT_RGBA16_UNORM=32859,l.TEXTUREFORMAT_R16_SNORM=36760,l.TEXTUREFORMAT_RG16_SNORM=36761,l.TEXTUREFORMAT_RGB16_SNORM=36762,l.TEXTUREFORMAT_RGBA16_SNORM=36763,l.TEXTUREFORMAT_RG=7,l.TEXTUREFORMAT_RED_INTEGER=8,l.TEXTUREFORMAT_R_INTEGER=8,l.TEXTUREFORMAT_RG_INTEGER=9,l.TEXTUREFORMAT_RGB_INTEGER=10,l.TEXTUREFORMAT_RGBA_INTEGER=11,l.TEXTUREFORMAT_BGRA=12,l.TEXTUREFORMAT_DEPTH24_STENCIL8=13,l.TEXTUREFORMAT_DEPTH32_FLOAT=14,l.TEXTUREFORMAT_DEPTH16=15,l.TEXTUREFORMAT_DEPTH24=16,l.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,l.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,l.TEXTUREFORMAT_STENCIL8=19,l.TEXTUREFORMAT_UNDEFINED=4294967295,l.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,l.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,l.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,l.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,l.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,l.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,l.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,l.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,l.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,l.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,l.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,l.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,l.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,l.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,l.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,l.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,l.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,l.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,l.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,l.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,l.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,l.TEXTURETYPE_UNSIGNED_BYTE=0,l.TEXTURETYPE_UNSIGNED_INT=0,l.TEXTURETYPE_FLOAT=1,l.TEXTURETYPE_HALF_FLOAT=2,l.TEXTURETYPE_BYTE=3,l.TEXTURETYPE_SHORT=4,l.TEXTURETYPE_UNSIGNED_SHORT=5,l.TEXTURETYPE_INT=6,l.TEXTURETYPE_UNSIGNED_INTEGER=7,l.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,l.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,l.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,l.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,l.TEXTURETYPE_UNSIGNED_INT_24_8=12,l.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,l.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,l.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,l.TEXTURETYPE_UNDEFINED=16,l.TEXTURE_2D=3553,l.TEXTURE_2D_ARRAY=35866,l.TEXTURE_CUBE_MAP=34067,l.TEXTURE_CUBE_MAP_ARRAY=3735928559,l.TEXTURE_3D=32879,l.TEXTURE_NEAREST_SAMPLINGMODE=1,l.TEXTURE_NEAREST_NEAREST=1,l.TEXTURE_BILINEAR_SAMPLINGMODE=2,l.TEXTURE_LINEAR_LINEAR=2,l.TEXTURE_TRILINEAR_SAMPLINGMODE=3,l.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,l.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,l.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,l.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,l.TEXTURE_NEAREST_LINEAR=7,l.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,l.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,l.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,l.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,l.TEXTURE_LINEAR_NEAREST=12,l.TEXTURE_EXPLICIT_MODE=0,l.TEXTURE_SPHERICAL_MODE=1,l.TEXTURE_PLANAR_MODE=2,l.TEXTURE_CUBIC_MODE=3,l.TEXTURE_PROJECTION_MODE=4,l.TEXTURE_SKYBOX_MODE=5,l.TEXTURE_INVCUBIC_MODE=6,l.TEXTURE_EQUIRECTANGULAR_MODE=7,l.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,l.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,l.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,l.TEXTURE_FILTERING_QUALITY_HIGH=64,l.TEXTURE_FILTERING_QUALITY_MEDIUM=16,l.TEXTURE_FILTERING_QUALITY_LOW=8,l.SCALEMODE_FLOOR=1,l.SCALEMODE_NEAREST=2,l.SCALEMODE_CEILING=3,l.MATERIAL_TextureDirtyFlag=1,l.MATERIAL_LightDirtyFlag=2,l.MATERIAL_FresnelDirtyFlag=4,l.MATERIAL_AttributesDirtyFlag=8,l.MATERIAL_MiscDirtyFlag=16,l.MATERIAL_PrePassDirtyFlag=32,l.MATERIAL_ImageProcessingDirtyFlag=64,l.MATERIAL_AllDirtyFlag=127,l.MATERIAL_TriangleFillMode=0,l.MATERIAL_WireFrameFillMode=1,l.MATERIAL_PointFillMode=2,l.MATERIAL_PointListDrawMode=3,l.MATERIAL_LineListDrawMode=4,l.MATERIAL_LineLoopDrawMode=5,l.MATERIAL_LineStripDrawMode=6,l.MATERIAL_TriangleStripDrawMode=7,l.MATERIAL_TriangleFanDrawMode=8,l.MATERIAL_ClockWiseSideOrientation=0,l.MATERIAL_CounterClockWiseSideOrientation=1,l.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,l.MATERIAL_DIFFUSE_MODEL_BURLEY=1,l.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,l.MATERIAL_DIFFUSE_MODEL_LEGACY=3,l.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,l.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,l.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,l.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,l.ACTION_NothingTrigger=0,l.ACTION_OnPickTrigger=1,l.ACTION_OnLeftPickTrigger=2,l.ACTION_OnRightPickTrigger=3,l.ACTION_OnCenterPickTrigger=4,l.ACTION_OnPickDownTrigger=5,l.ACTION_OnDoublePickTrigger=6,l.ACTION_OnPickUpTrigger=7,l.ACTION_OnPickOutTrigger=16,l.ACTION_OnLongPressTrigger=8,l.ACTION_OnPointerOverTrigger=9,l.ACTION_OnPointerOutTrigger=10,l.ACTION_OnEveryFrameTrigger=11,l.ACTION_OnIntersectionEnterTrigger=12,l.ACTION_OnIntersectionExitTrigger=13,l.ACTION_OnKeyDownTrigger=14,l.ACTION_OnKeyUpTrigger=15,l.PARTICLES_BILLBOARDMODE_Y=2,l.PARTICLES_BILLBOARDMODE_ALL=7,l.PARTICLES_BILLBOARDMODE_STRETCHED=8,l.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,l.MESHES_CULLINGSTRATEGY_STANDARD=0,l.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,l.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,l.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,l.SCENELOADER_NO_LOGGING=0,l.SCENELOADER_MINIMAL_LOGGING=1,l.SCENELOADER_SUMMARY_LOGGING=2,l.SCENELOADER_DETAILED_LOGGING=3,l.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,l.PREPASS_POSITION_TEXTURE_TYPE=1,l.PREPASS_VELOCITY_TEXTURE_TYPE=2,l.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,l.PREPASS_COLOR_TEXTURE_TYPE=4,l.PREPASS_DEPTH_TEXTURE_TYPE=5,l.PREPASS_NORMAL_TEXTURE_TYPE=6,l.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,l.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,l.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,l.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,l.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,l.PREPASS_ALBEDO_TEXTURE_TYPE=12,l.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,l.BUFFER_CREATIONFLAG_READ=1,l.BUFFER_CREATIONFLAG_WRITE=2,l.BUFFER_CREATIONFLAG_READWRITE=3,l.BUFFER_CREATIONFLAG_UNIFORM=4,l.BUFFER_CREATIONFLAG_VERTEX=8,l.BUFFER_CREATIONFLAG_INDEX=16,l.BUFFER_CREATIONFLAG_STORAGE=32,l.BUFFER_CREATIONFLAG_INDIRECT=64,l.RENDERPASS_MAIN=0,l.INPUT_ALT_KEY=18,l.INPUT_CTRL_KEY=17,l.INPUT_META_KEY1=91,l.INPUT_META_KEY2=92,l.INPUT_META_KEY3=93,l.INPUT_SHIFT_KEY=16,l.SNAPSHOTRENDERING_STANDARD=0,l.SNAPSHOTRENDERING_FAST=1,l.PERSPECTIVE_CAMERA=0,l.ORTHOGRAPHIC_CAMERA=1,l.FOVMODE_VERTICAL_FIXED=0,l.FOVMODE_HORIZONTAL_FIXED=1,l.RIG_MODE_NONE=0,l.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,l.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,l.RIG_MODE_STEREOSCOPIC_INTERLACED=14,l.RIG_MODE_VR=20,l.RIG_MODE_CUSTOM=22,l.MAX_SUPPORTED_UV_SETS=6,l.GL_ALPHA_EQUATION_ADD=32774,l.GL_ALPHA_EQUATION_MIN=32775,l.GL_ALPHA_EQUATION_MAX=32776,l.GL_ALPHA_EQUATION_SUBTRACT=32778,l.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,l.GL_ALPHA_FUNCTION_SRC=768,l.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,l.GL_ALPHA_FUNCTION_SRC_ALPHA=770,l.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,l.GL_ALPHA_FUNCTION_DST_ALPHA=772,l.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,l.GL_ALPHA_FUNCTION_DST_COLOR=774,l.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,l.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,l.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,l.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,l.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,l.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,l.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,l.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,l.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,l.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,l.SnippetUrl="https://snippet.babylonjs.com",l.FOGMODE_NONE=0,l.FOGMODE_EXP=1,l.FOGMODE_EXP2=2,l.FOGMODE_LINEAR=3,l.BYTE=5120,l.UNSIGNED_BYTE=5121,l.SHORT=5122,l.UNSIGNED_SHORT=5123,l.INT=5124,l.UNSIGNED_INT=5125,l.FLOAT=5126,l.PositionKind="position",l.NormalKind="normal",l.TangentKind="tangent",l.UVKind="uv",l.UV2Kind="uv2",l.UV3Kind="uv3",l.UV4Kind="uv4",l.UV5Kind="uv5",l.UV6Kind="uv6",l.ColorKind="color",l.ColorInstanceKind="instanceColor",l.MatricesIndicesKind="matricesIndices",l.MatricesWeightsKind="matricesWeights",l.MatricesIndicesExtraKind="matricesIndicesExtra",l.MatricesWeightsExtraKind="matricesWeightsExtra",l.ANIMATIONTYPE_FLOAT=0,l.ANIMATIONTYPE_VECTOR3=1,l.ANIMATIONTYPE_QUATERNION=2,l.ANIMATIONTYPE_MATRIX=3,l.ANIMATIONTYPE_COLOR3=4,l.ANIMATIONTYPE_COLOR4=7,l.ANIMATIONTYPE_VECTOR2=5,l.ANIMATIONTYPE_SIZE=6,l.ShadowMinZ=0,l.ShadowMaxZ=1e4},12860:(y,c,A)=>{A.d(c,{b:()=>O});var l=A(12307),w=A(12310),N=A(12325),p=A(12375),W=A(12743),h=A(12570),I=A(12283),q=A(12617),o=A(12363);class O extends W.b{get range(){return this._range}set range(y){this._range=y,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(y){this._intensityMode=y,this._computePhotometricScale()}get radius(){return this._radius}set radius(y){this._radius=y,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(y){this._shadowEnabled!==y&&(this._shadowEnabled=y,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(y){this._includedOnlyMeshes=y,this._hookArrayForIncludedOnly(y)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(y){this._excludedMeshes=y,this._hookArrayForExcluded(y)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(y){this._excludeWithLayerMask=y,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(y){this._includeOnlyWithLayerMask=y,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(y){this._lightmapMode!==y&&(this._lightmapMode=y,this._markMeshesAsLightDirty())}getViewMatrix(y){return null}getProjectionMatrix(y,c){return null}constructor(y,c){super(y,c,!1),this.UW=new p.dc(1,1,1),this.gq=new p.dc(1,1,1),this.falloffType=O.FALLOFF_DEFAULT,this.JW=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=O.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.mc().addLight(this),this._uniformBuffer=new h.c(this.mc().getEngine(),void 0,void 0,y),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(y,c){return this}_bindLight(y,c,A,l){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const N=y.toString();let W=!1;if(this._uniformBuffer.bindToEffect(A,"Light"+N),this._renderId!==c.getRenderId()||this._lastUseSpecular!==l||!this._uniformBuffer.useUbo){this._renderId=c.getRenderId(),this._lastUseSpecular=l;const y=this.getScaledIntensity();this.transferToEffect(A,N),this.UW.scaleToRef(y,p.TmpColors.dc[0]),this._uniformBuffer.updateColor4("vLightDiffuse",p.TmpColors.dc[0],this.range,N),l&&(this.gq.scaleToRef(y,p.TmpColors.dc[1]),this._uniformBuffer.updateColor4("vLightSpecular",p.TmpColors.dc[1],this.radius,N)),W=!0}if(this.transferTexturesToEffect(A,N),c.shadowsEnabled&&this.shadowEnabled&&w){const y=this.getShadowGenerator(c.activeCamera)??this.getShadowGenerator();y&&(y.bindShadowLight(N,A),W=!0)}W?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(y){let c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let A=0;A<this.animations.length;A++)c+=", animation[0]: "+this.animations[A].toString(y);return c}_syncParentEnabledState(){super._syncParentEnabledState(),this.I()||this._resyncMeshes()}ph(y){super.ph(y),this._resyncMeshes()}getShadowGenerator(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(y)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return N.gc.Zero()}canAffectMesh(y){return!y||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(y))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(y))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&y.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&y.layerMask)))}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const y=this._shadowGenerators.values();for(let c=y.next();!0!==c.done;c=y.next()){c.value.dispose()}this._shadowGenerators=null}if(this.mc().stopAnimation(this),this._parentContainer){const y=this._parentContainer.lights.indexOf(this);y>-1&&this._parentContainer.lights.splice(y,1),this._parentContainer=null}for(const A of this.mc().meshes)A._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.mc().removeLight(this),super.dispose(y,c)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.JW}clone(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=O.GetConstructorFromName(this.getTypeID(),y,this.mc());if(!A)return null;const l=o.d.Clone(A,this);return y&&(l.name=y),c&&(l.parent=c),l.ph(this.isEnabled()),this.onClonedObservable.notifyObservers(l),l}serialize(){const y=o.d.Serialize(this);if(y.uniqueId=this.uniqueId,y.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(y),this.excludedMeshes.length>0){y.excludedMeshesIds=[];for(const c of this.excludedMeshes)y.excludedMeshesIds.push(c.id)}if(this.includedOnlyMeshes.length>0){y.includedOnlyMeshesIds=[];for(const c of this.includedOnlyMeshes)y.includedOnlyMeshesIds.push(c.id)}return o.d.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.isEnabled=this.isEnabled(),y}static GetConstructorFromName(y,c,A){const l=W.b.Construct("Light_Type_"+y,c,A);return l||null}static Parse(y,c){const A=O.GetConstructorFromName(y.type,y.name,c);if(!A)return null;const l=o.d.Parse(A,y,c);if(y.excludedMeshesIds&&(l._excludedMeshesIds=y.excludedMeshesIds),y.includedOnlyMeshesIds&&(l._includedOnlyMeshesIds=y.includedOnlyMeshesIds),void 0!==y.parentId&&(l._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(l._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.falloffType&&(l.falloffType=y.falloffType),void 0!==y.lightmapMode&&(l.lightmapMode=y.lightmapMode),y.animations){for(let c=0;c<y.animations.length;c++){const A=y.animations[c],w=(0,I.d)("BABYLON.Animation");w&&l.animations.push(w.Parse(A))}W.b.ParseAnimationRanges(l,y,c)}return y.autoAnimate&&c.beginAnimation(l,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),void 0!==y.isEnabled&&l.ph(y.isEnabled),l}_hookArrayForExcluded(y){var c=this;const A=y.push;y.push=function(){for(var l=arguments.length,w=new Array(l),N=0;N<l;N++)w[N]=arguments[N];const p=A.apply(y,w);for(const y of w)y._resyncLightSource(c);return p};const l=y.splice;y.splice=(c,A)=>{const w=l.apply(y,[c,A]);for(const y of w)y._resyncLightSource(this);return w};for(const w of y)w._resyncLightSource(this)}_hookArrayForIncludedOnly(y){var c=this;const A=y.push;y.push=function(){for(var l=arguments.length,w=new Array(l),N=0;N<l;N++)w[N]=arguments[N];const p=A.apply(y,w);return c._resyncMeshes(),p};const l=y.splice;y.splice=(c,A)=>{const w=l.apply(y,[c,A]);return this._resyncMeshes(),w},this._resyncMeshes()}_resyncMeshes(){for(const y of this.mc().meshes)y._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const y of this.mc().meshes)-1!==y.lightSources.indexOf(this)&&y._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.mc().resetCachedMaterial()}_getPhotometricScale(){let y=0;const c=this.getTypeID();let A=this.intensityMode;switch(A===O.INTENSITYMODE_AUTOMATIC&&(A=c===O.LIGHTTYPEID_DIRECTIONALLIGHT?O.INTENSITYMODE_ILLUMINANCE:O.INTENSITYMODE_LUMINOUSINTENSITY),c){case O.LIGHTTYPEID_POINTLIGHT:case O.LIGHTTYPEID_SPOTLIGHT:switch(A){case O.INTENSITYMODE_LUMINOUSPOWER:y=1/(4*Math.PI);break;case O.INTENSITYMODE_LUMINOUSINTENSITY:y=1;break;case O.INTENSITYMODE_LUMINANCE:y=this.radius*this.radius}break;case O.LIGHTTYPEID_DIRECTIONALLIGHT:switch(A){case O.INTENSITYMODE_ILLUMINANCE:y=1;break;case O.INTENSITYMODE_LUMINANCE:{let c=this.radius;c=Math.max(c,.001);y=2*Math.PI*(1-Math.cos(c));break}}break;case O.LIGHTTYPEID_HEMISPHERICLIGHT:y=1}return y}_reorderLightsInScene(){const y=this.mc();0!=this._renderPriority&&(y.requireLightSorting=!0),this.mc().sortLightsByPriority()}_isReady(){return!0}}O.FALLOFF_DEFAULT=q.d.FALLOFF_DEFAULT,O.FALLOFF_PHYSICAL=q.d.FALLOFF_PHYSICAL,O.FALLOFF_GLTF=q.d.FALLOFF_GLTF,O.FALLOFF_STANDARD=q.d.FALLOFF_STANDARD,O.LIGHTMAP_DEFAULT=q.d.LIGHTMAP_DEFAULT,O.LIGHTMAP_SPECULAR=q.d.LIGHTMAP_SPECULAR,O.LIGHTMAP_SHADOWSONLY=q.d.LIGHTMAP_SHADOWSONLY,O.INTENSITYMODE_AUTOMATIC=q.d.INTENSITYMODE_AUTOMATIC,O.INTENSITYMODE_LUMINOUSPOWER=q.d.INTENSITYMODE_LUMINOUSPOWER,O.INTENSITYMODE_LUMINOUSINTENSITY=q.d.INTENSITYMODE_LUMINOUSINTENSITY,O.INTENSITYMODE_ILLUMINANCE=q.d.INTENSITYMODE_ILLUMINANCE,O.INTENSITYMODE_LUMINANCE=q.d.INTENSITYMODE_LUMINANCE,O.LIGHTTYPEID_POINTLIGHT=q.d.LIGHTTYPEID_POINTLIGHT,O.LIGHTTYPEID_DIRECTIONALLIGHT=q.d.LIGHTTYPEID_DIRECTIONALLIGHT,O.LIGHTTYPEID_SPOTLIGHT=q.d.LIGHTTYPEID_SPOTLIGHT,O.LIGHTTYPEID_HEMISPHERICLIGHT=q.d.LIGHTTYPEID_HEMISPHERICLIGHT,O.LIGHTTYPEID_RECT_AREALIGHT=q.d.LIGHTTYPEID_RECT_AREALIGHT,(0,l.b)([(0,w.l)()],O.prototype,"diffuse",void 0),(0,l.b)([(0,w.l)()],O.prototype,"specular",void 0),(0,l.b)([(0,w.P)()],O.prototype,"falloffType",void 0),(0,l.b)([(0,w.P)()],O.prototype,"intensity",void 0),(0,l.b)([(0,w.P)()],O.prototype,"range",null),(0,l.b)([(0,w.P)()],O.prototype,"intensityMode",null),(0,l.b)([(0,w.P)()],O.prototype,"radius",null),(0,l.b)([(0,w.P)()],O.prototype,"_renderPriority",void 0),(0,l.b)([(0,w.d)("_reorderLightsInScene")],O.prototype,"renderPriority",void 0),(0,l.b)([(0,w.P)("shadowEnabled")],O.prototype,"_shadowEnabled",void 0),(0,l.b)([(0,w.P)("excludeWithLayerMask")],O.prototype,"_excludeWithLayerMask",void 0),(0,l.b)([(0,w.P)("includeOnlyWithLayerMask")],O.prototype,"_includeOnlyWithLayerMask",void 0),(0,l.b)([(0,w.P)("lightmapMode")],O.prototype,"_lightmapMode",void 0)},12915:(y,c,A)=>{A.d(c,{d:()=>h});var l=A(12307),w=A(12310),N=A(12325),p=A(12860),W=A(12521);class h extends p.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=N.Matrix.Identity(),this._projectionMatrix=N.Matrix.Identity()}_setPosition(y){this._position=y}get position(){return this._position}set position(y){this._setPosition(y)}_setDirection(y){this._direction=y}get direction(){return this._direction}set direction(y){this._setDirection(y)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(y){this._shadowMinZ=y,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(y){this._shadowMaxZ=y,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=N.gc.Zero()),N.gc.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=N.gc.Zero()),N.gc.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(y){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(y){return this.direction=N.gc.Normalize(y.xc(this.position)),this.direction}getRotation(){this.direction.normalize();const y=N.gc.Cross(this.direction,W.c.Y),c=N.gc.Cross(y,this.direction);return N.gc.RotationFromAxis(y,c,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=N.gc.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Yc(y){return!y&&this.isSynchronized()?(this._currentRenderId=this.mc().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=N.Matrix.Identity()),N.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(y){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===y||void 0===y?void 0:y.ec)||0}getDepthMaxZ(y){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===y||void 0===y?void 0:y.maxZ)||1e4}setShadowProjectionMatrix(y,c,A){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,A,y):this._setDefaultShadowProjectionMatrix(y,c,A),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(y){const c=N.TmpVectors.gc[0];let A=this.position;this.computeTransformedInformation()&&(A=this.transformedPosition),N.gc.NormalizeToRef(this.getShadowDirection(y),c),1===Math.abs(N.gc.Dot(c,N.gc.Up()))&&(c.z=1e-13);const l=N.TmpVectors.gc[1];return A.addToRef(c,l),N.Matrix.LookAtLHToRef(A,l,N.gc.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(y,c){return this.setShadowProjectionMatrix(this._projectionMatrix,y??this._viewMatrix,c??[]),this._projectionMatrix}}(0,l.b)([(0,w.M)()],h.prototype,"position",null),(0,l.b)([(0,w.M)()],h.prototype,"direction",null),(0,l.b)([(0,w.P)()],h.prototype,"shadowMinZ",null),(0,l.b)([(0,w.P)()],h.prototype,"shadowMaxZ",null)},12788:(y,c,A)=>{A.d(c,{e:()=>l});class l{static get ForceFullSceneLoadingForIncremental(){return l._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(y){l._ForceFullSceneLoadingForIncremental=y}static get ShowLoadingScreen(){return l._ShowLoadingScreen}static set ShowLoadingScreen(y){l._ShowLoadingScreen=y}static get loggingLevel(){return l._LoggingLevel}static set loggingLevel(y){l._LoggingLevel=y}static get CleanBoneMatrixWeights(){return l._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(y){l._CleanBoneMatrixWeights=y}}l._ForceFullSceneLoadingForIncremental=!1,l._ShowLoadingScreen=!0,l._CleanBoneMatrixWeights=!1,l._LoggingLevel=0},12827:(y,c,A)=>{A.d(c,{c:()=>Q});var l=A(12307),w=A(12310),N=A(12161),p=A(12419),W=A(12813),h=A(12553),I=A(12325),q=A(12400),o=A(12704),O=A(12725);class L extends o.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class i extends O.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRBRDF",90,new L,c),this._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=i.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=i.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=i.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=i.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=i.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=i.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=i.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=i.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=i.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=i.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=y._dirtyCallbacks[16],this._enable(!0)}prepareDefines(y){y.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,y.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,y.SPHERICAL_HARMONICS=this._useSphericalHarmonics,y.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,y.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,y.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,y.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,y.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,y.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,i.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,i.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,i.DEFAULT_DIFFUSE_MODEL=0,i.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,i.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"mixIblRadianceWithIrradiance",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useLegacySpecularEnergyConservation",void 0),(0,l.b)([(0,w.P)("baseDiffuseModel"),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"baseDiffuseModel",void 0),(0,l.b)([(0,w.P)("dielectricSpecularModel"),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"dielectricSpecularModel",void 0),(0,l.b)([(0,w.P)("conductorSpecularModel"),(0,w.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"conductorSpecularModel",void 0);var H=A(12700),P=A(12375),D=A(12555),t=A(12632),s=A(12625),B=A(12303),X=A(12708),C=(A(12830),A(12619)),K=A(12683);class my extends o.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class T extends O.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRClearCoat",100,new my,c),this._isEnabled=!1,this.isEnabled=!1,this.JW=1,this.roughness=0,this._indexOfRefraction=T._DefaultIndexOfRefraction,this.indexOfRefraction=T._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=P.dc.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,c,A){if(!this._isEnabled)return!0;const l=this._material._disableBumpMap;if(y._areTexturesDirty&&c.texturesEnabled){if(this._texture&&X.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&X.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(A.getCaps().standardDerivatives&&this._bumpTexture&&X.d.ClearCoatBumpTextureEnabled&&!l&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&X.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,c){this._isEnabled?(y.CLEARCOAT=!0,y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,y.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,y._areTexturesDirty&&c.texturesEnabled&&(this._texture&&X.d.ClearCoatTextureEnabled?(0,K.T)(this._texture,y,"CLEARCOAT_TEXTURE"):y.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&X.d.ClearCoatTextureEnabled?(0,K.T)(this._textureRoughness,y,"CLEARCOAT_TEXTURE_ROUGHNESS"):y.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&X.d.ClearCoatBumpTextureEnabled?(0,K.T)(this._bumpTexture,y,"CLEARCOAT_BUMP"):y.CLEARCOAT_BUMP=!1,y.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===T._DefaultIndexOfRefraction,this._isTintEnabled?(y.CLEARCOAT_TINT=!0,this._tintTexture&&X.d.ClearCoatTintTextureEnabled?((0,K.T)(this._tintTexture,y,"CLEARCOAT_TINT_TEXTURE"),y.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):y.CLEARCOAT_TINT_TEXTURE=!1):(y.CLEARCOAT_TINT=!1,y.CLEARCOAT_TINT_TEXTURE=!1))):(y.CLEARCOAT=!1,y.CLEARCOAT_TEXTURE=!1,y.CLEARCOAT_TEXTURE_ROUGHNESS=!1,y.CLEARCOAT_BUMP=!1,y.CLEARCOAT_TINT=!1,y.CLEARCOAT_TINT_TEXTURE=!1,y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,y.CLEARCOAT_DEFAULTIOR=!1,y.CLEARCOAT_TEXTUREDIRECTUV=0,y.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,y.CLEARCOAT_BUMPDIRECTUV=0,y.CLEARCOAT_REMAP_F0=!1,y.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,y.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(y,c,A,l){if(!this._isEnabled)return;const w=l.materialDefines,N=this._material.isFrozen,p=this._material._disableBumpMap,W=this._material._invertNormalMapX,h=this._material._invertNormalMapY;if(!y.useUbo||!N||!y.isSync){var I,q,o,O;if((this._texture||this._textureRoughness)&&X.d.ClearCoatTextureEnabled)y.updateFloat4("vClearCoatInfos",(null===(I=this._texture)||void 0===I?void 0:I.coordinatesIndex)??0,(null===(q=this._texture)||void 0===q?void 0:q.level)??0,(null===(o=this._textureRoughness)||void 0===o?void 0:o.coordinatesIndex)??0,(null===(O=this._textureRoughness)||void 0===O?void 0:O.level)??0),this._texture&&(0,K.q)(this._texture,y,"clearCoat"),this._textureRoughness&&!w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,K.q)(this._textureRoughness,y,"clearCoatRoughness");this._bumpTexture&&A.getCaps().standardDerivatives&&X.d.ClearCoatTextureEnabled&&!p&&(y.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,K.q)(this._bumpTexture,y,"clearCoatBump"),c._mirroredCameraPosition?y.updateFloat2("vClearCoatTangentSpaceParams",W?1:-1,h?1:-1):y.updateFloat2("vClearCoatTangentSpaceParams",W?-1:1,h?-1:1)),this._tintTexture&&X.d.ClearCoatTintTextureEnabled&&(y.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,K.q)(this._tintTexture,y,"clearCoatTint")),y.updateFloat2("vClearCoatParams",this.JW,this.roughness);const l=1-this._indexOfRefraction,N=1+this._indexOfRefraction,L=Math.pow(-l/N,2),i=1/this._indexOfRefraction;y.updateFloat4("vClearCoatRefractionParams",L,i,l,N),this._isTintEnabled&&(y.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),y.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}c.texturesEnabled&&(this._texture&&X.d.ClearCoatTextureEnabled&&y.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&X.d.ClearCoatTextureEnabled&&y.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&A.getCaps().standardDerivatives&&X.d.ClearCoatBumpTextureEnabled&&!p&&y.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&X.d.ClearCoatTintTextureEnabled&&y.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(y){return this._texture===y||(this._textureRoughness===y||(this._bumpTexture===y||this._tintTexture===y))}getActiveTextures(y){this._texture&&y.push(this._texture),this._textureRoughness&&y.push(this._textureRoughness),this._bumpTexture&&y.push(this._bumpTexture),this._tintTexture&&y.push(this._tintTexture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&y.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&y.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&y.push(this._tintTexture)}dispose(y){var c,A,l,w;y&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(A=this._textureRoughness)||void 0===A||A.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(w=this._tintTexture)||void 0===w||w.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(y,c,A){return y.CLEARCOAT_BUMP&&c.addFallback(A++,"CLEARCOAT_BUMP"),y.CLEARCOAT_TINT&&c.addFallback(A++,"CLEARCOAT_TINT"),y.CLEARCOAT&&c.addFallback(A++,"CLEARCOAT"),A}getSamplers(y){y.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}T._DefaultIndexOfRefraction=1.5,(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isEnabled",void 0),(0,l.b)([(0,w.P)()],T.prototype,"intensity",void 0),(0,l.b)([(0,w.P)()],T.prototype,"roughness",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"indexOfRefraction",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"texture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMainTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"textureRoughness",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"remapF0OnInterfaceChange",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"bumpTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isTintEnabled",void 0),(0,l.b)([(0,w.l)()],T.prototype,"tintColor",void 0),(0,l.b)([(0,w.P)()],T.prototype,"tintColorAtDistance",void 0),(0,l.b)([(0,w.P)()],T.prototype,"tintThickness",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"tintTexture",void 0);class z extends o.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class S extends O.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRIridescence",110,new z,c),this._isEnabled=!1,this.isEnabled=!1,this.JW=1,this.minimumThickness=S._DefaultMinimumThickness,this.maximumThickness=S._DefaultMaximumThickness,this.indexOfRefraction=S._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,c){if(!this._isEnabled)return!0;if(y._areTexturesDirty&&c.texturesEnabled){if(this._texture&&X.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&X.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,c){this._isEnabled?(y.IRIDESCENCE=!0,y._areTexturesDirty&&c.texturesEnabled&&(this._texture&&X.d.IridescenceTextureEnabled?(0,K.T)(this._texture,y,"IRIDESCENCE_TEXTURE"):y.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&X.d.IridescenceTextureEnabled?(0,K.T)(this._thicknessTexture,y,"IRIDESCENCE_THICKNESS_TEXTURE"):y.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(y.IRIDESCENCE=!1,y.IRIDESCENCE_TEXTURE=!1,y.IRIDESCENCE_THICKNESS_TEXTURE=!1,y.IRIDESCENCE_TEXTUREDIRECTUV=0,y.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(y,c){if(!this._isEnabled)return;const A=this._material.isFrozen;if(!y.useUbo||!A||!y.isSync){var l,w,N,p;if((this._texture||this._thicknessTexture)&&X.d.IridescenceTextureEnabled)y.updateFloat4("vIridescenceInfos",(null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(w=this._texture)||void 0===w?void 0:w.level)??0,(null===(N=this._thicknessTexture)||void 0===N?void 0:N.coordinatesIndex)??0,(null===(p=this._thicknessTexture)||void 0===p?void 0:p.level)??0),this._texture&&(0,K.q)(this._texture,y,"iridescence"),this._thicknessTexture&&(0,K.q)(this._thicknessTexture,y,"iridescenceThickness");y.updateFloat4("vIridescenceParams",this.JW,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}c.texturesEnabled&&(this._texture&&X.d.IridescenceTextureEnabled&&y.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&X.d.IridescenceTextureEnabled&&y.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(y){return this._texture===y||this._thicknessTexture===y}getActiveTextures(y){this._texture&&y.push(this._texture),this._thicknessTexture&&y.push(this._thicknessTexture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&y.push(this._thicknessTexture)}dispose(y){var c,A;y&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(A=this._thicknessTexture)||void 0===A||A.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(y,c,A){return y.IRIDESCENCE&&c.addFallback(A++,"IRIDESCENCE"),A}getSamplers(y){y.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}S._DefaultMinimumThickness=100,S._DefaultMaximumThickness=400,S._DefaultIndexOfRefraction=1.3,(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isEnabled",void 0),(0,l.b)([(0,w.P)()],S.prototype,"intensity",void 0),(0,l.b)([(0,w.P)()],S.prototype,"minimumThickness",void 0),(0,l.b)([(0,w.P)()],S.prototype,"maximumThickness",void 0),(0,l.b)([(0,w.P)()],S.prototype,"indexOfRefraction",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"texture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"thicknessTexture",void 0);class M extends o.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class k extends O.c{set angle(y){this.direction.x=Math.cos(y),this.direction.y=Math.sin(y)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRAnisotropic",110,new M,c),this._isEnabled=!1,this.isEnabled=!1,this.JW=1,this.direction=new I.Vector2(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=y._dirtyCallbacks[16]}isReadyForSubMesh(y,c){return!this._isEnabled||!(y._areTexturesDirty&&c.texturesEnabled&&this._texture&&X.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(y,c,A){this._isEnabled?(y.ANISOTROPIC=this._isEnabled,this._isEnabled&&!A.isVerticesDataPresent(q.e.TangentKind)&&(y._needUVs=!0,y.MAINUV1=!0),y._areTexturesDirty&&c.texturesEnabled&&(this._texture&&X.d.AnisotropicTextureEnabled?(0,K.T)(this._texture,y,"ANISOTROPIC_TEXTURE"):y.ANISOTROPIC_TEXTURE=!1),y._areMiscDirty&&(y.ANISOTROPIC_LEGACY=this._legacy)):(y.ANISOTROPIC=!1,y.ANISOTROPIC_TEXTURE=!1,y.ANISOTROPIC_TEXTUREDIRECTUV=0,y.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(y,c){if(!this._isEnabled)return;const A=this._material.isFrozen;y.useUbo&&A&&y.isSync||(this._texture&&X.d.AnisotropicTextureEnabled&&(y.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,K.q)(this._texture,y,"anisotropy")),y.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.JW)),c.texturesEnabled&&this._texture&&X.d.AnisotropicTextureEnabled&&y.setTexture("anisotropySampler",this._texture)}hasTexture(y){return this._texture===y}getActiveTextures(y){this._texture&&y.push(this._texture)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture)}dispose(y){y&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(y,c,A){return y.ANISOTROPIC&&c.addFallback(A++,"ANISOTROPIC"),A}getSamplers(y){y.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(y,c,A){super.parse(y,c,A),void 0===y.legacy&&(this.legacy=!0)}}(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isEnabled",void 0),(0,l.b)([(0,w.P)()],k.prototype,"intensity",void 0),(0,l.b)([(0,w.J)()],k.prototype,"direction",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"texture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],k.prototype,"legacy",void 0);class a extends o.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class u extends O.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"Sheen",120,new a,c),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.JW=1,this.color=P.dc.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1]}isReadyForSubMesh(y,c){if(!this._isEnabled)return!0;if(y._areTexturesDirty&&c.texturesEnabled){if(this._texture&&X.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&X.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,c){this._isEnabled?(y.SHEEN=!0,y.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,y.SHEEN_ROUGHNESS=null!==this._roughness,y.SHEEN_ALBEDOSCALING=this._albedoScaling,y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,y._areTexturesDirty&&c.texturesEnabled&&(this._texture&&X.d.SheenTextureEnabled?((0,K.T)(this._texture,y,"SHEEN_TEXTURE"),y.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):y.SHEEN_TEXTURE=!1,this._textureRoughness&&X.d.SheenTextureEnabled?(0,K.T)(this._textureRoughness,y,"SHEEN_TEXTURE_ROUGHNESS"):y.SHEEN_TEXTURE_ROUGHNESS=!1)):(y.SHEEN=!1,y.SHEEN_TEXTURE=!1,y.SHEEN_TEXTURE_ROUGHNESS=!1,y.SHEEN_LINKWITHALBEDO=!1,y.SHEEN_ROUGHNESS=!1,y.SHEEN_ALBEDOSCALING=!1,y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,y.SHEEN_GAMMATEXTURE=!1,y.SHEEN_TEXTUREDIRECTUV=0,y.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(y,c,A,l){if(!this._isEnabled)return;const w=l.materialDefines,N=this._material.isFrozen;if(!y.useUbo||!N||!y.isSync){var p,W,h,I;if((this._texture||this._textureRoughness)&&X.d.SheenTextureEnabled)y.updateFloat4("vSheenInfos",(null===(p=this._texture)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(W=this._texture)||void 0===W?void 0:W.level)??0,(null===(h=this._textureRoughness)||void 0===h?void 0:h.coordinatesIndex)??0,(null===(I=this._textureRoughness)||void 0===I?void 0:I.level)??0),this._texture&&(0,K.q)(this._texture,y,"sheen"),this._textureRoughness&&!w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,K.q)(this._textureRoughness,y,"sheenRoughness");y.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.JW),null!==this._roughness&&y.updateFloat("vSheenRoughness",this._roughness)}c.texturesEnabled&&(this._texture&&X.d.SheenTextureEnabled&&y.setTexture("sheenSampler",this._texture),this._textureRoughness&&!w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&X.d.SheenTextureEnabled&&y.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(y){return this._texture===y||this._textureRoughness===y}getActiveTextures(y){this._texture&&y.push(this._texture),this._textureRoughness&&y.push(this._textureRoughness)}getAnimatables(y){this._texture&&this._texture.animations&&this._texture.animations.length>0&&y.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&y.push(this._textureRoughness)}dispose(y){var c,A;y&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(A=this._textureRoughness)||void 0===A||A.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(y,c,A){return y.SHEEN&&c.addFallback(A++,"SHEEN"),A}getSamplers(y){y.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"linkSheenWithAlbedo",void 0),(0,l.b)([(0,w.P)()],u.prototype,"intensity",void 0),(0,l.b)([(0,w.l)()],u.prototype,"color",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMainTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"textureRoughness",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoScaling",void 0);class G extends o.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class j extends O.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(y){this._scene.enableSubSurfaceForPrePass()&&y&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(y))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(y){this._volumeIndexOfRefraction=y>=1?y:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(y,"PBRSubSurface",130,new G,c),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=P.dc.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=P.dc.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=j.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=j.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=y.mc(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=y._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=y._dirtyCallbacks[32]}isReadyForSubMesh(y,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(y._areTexturesDirty&&c.texturesEnabled){if(this._thicknessTexture&&X.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&X.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&X.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const y=this._getRefractionTexture(c);if(y&&X.d.RefractionTextureEnabled&&!y.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(y,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return y.SUBSURFACE=!1,y.SS_DISPERSION=!1,y.SS_TRANSLUCENCY=!1,y.SS_SCATTERING=!1,y.SS_REFRACTION=!1,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_THICKNESSANDMASK_TEXTURE=!1,y.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,y.SS_HAS_THICKNESS=!1,y.SS_REFRACTIONINTENSITY_TEXTURE=!1,y.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,y.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,y.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,y.SS_REFRACTIONMAP_3D=!1,y.SS_REFRACTIONMAP_OPPOSITEZ=!1,y.SS_LODINREFRACTIONALPHA=!1,y.SS_GAMMAREFRACTION=!1,y.SS_RGBDREFRACTION=!1,y.SS_LINEARSPECULARREFRACTION=!1,y.SS_LINKREFRACTIONTOTRANSPARENCY=!1,y.SS_ALBEDOFORREFRACTIONTINT=!1,y.SS_ALBEDOFORTRANSLUCENCYTINT=!1,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,y.SS_USE_THICKNESS_AS_DEPTH=!1,y.SS_USE_GLTF_TEXTURES=!1,y.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,y.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,y.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(y.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(y._areTexturesDirty){if(y.SUBSURFACE=!0,y.SS_DISPERSION=this._isDispersionEnabled,y.SS_TRANSLUCENCY=this._isTranslucencyEnabled,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,y.SS_SCATTERING=this._isScatteringEnabled,y.SS_THICKNESSANDMASK_TEXTURE=!1,y.SS_REFRACTIONINTENSITY_TEXTURE=!1,y.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,y.SS_HAS_THICKNESS=!1,y.SS_USE_GLTF_TEXTURES=!1,y.SS_REFRACTION=!1,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,y.SS_REFRACTIONMAP_3D=!1,y.SS_GAMMAREFRACTION=!1,y.SS_RGBDREFRACTION=!1,y.SS_LINEARSPECULARREFRACTION=!1,y.SS_REFRACTIONMAP_OPPOSITEZ=!1,y.SS_LODINREFRACTIONALPHA=!1,y.SS_LINKREFRACTIONTOTRANSPARENCY=!1,y.SS_ALBEDOFORREFRACTIONTINT=!1,y.SS_ALBEDOFORTRANSLUCENCYTINT=!1,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,y.SS_USE_THICKNESS_AS_DEPTH=!1,y.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,y.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,y._areTexturesDirty&&c.texturesEnabled&&(this._thicknessTexture&&X.d.ThicknessTextureEnabled&&(0,K.T)(this._thicknessTexture,y,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&X.d.RefractionIntensityTextureEnabled&&(0,K.T)(this._refractionIntensityTexture,y,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&X.d.TranslucencyIntensityTextureEnabled&&(0,K.T)(this._translucencyIntensityTexture,y,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&X.d.TranslucencyColorTextureEnabled&&((0,K.T)(this._translucencyColorTexture,y,"SS_TRANSLUCENCYCOLOR_TEXTURE"),y.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),y.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,y.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,y.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,y.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&c.texturesEnabled){const A=this._getRefractionTexture(c);A&&X.d.RefractionTextureEnabled&&(y.SS_REFRACTION=!0,y.SS_REFRACTIONMAP_3D=A.isCube,y.SS_GAMMAREFRACTION=A.gammaSpace,y.SS_RGBDREFRACTION=A.isRGBD,y.SS_LINEARSPECULARREFRACTION=A.linearSpecularLOD,y.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&A.isCube?!A.invertZ:A.invertZ,y.SS_LODINREFRACTIONALPHA=A.lodLevelInAlpha,y.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,y.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,y.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=A.isCube&&A.boundingBoxSize,y.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(y.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(y,c,A,l){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)y.updateFloat2("vThicknessParam",0,0);else{l.getRenderingMesh().getWorldMatrix().decompose(I.TmpVectors.gc[0]);const c=Math.max(Math.abs(I.TmpVectors.gc[0].x),Math.abs(I.TmpVectors.gc[0].y),Math.abs(I.TmpVectors.gc[0].z));y.updateFloat2("vThicknessParam",this.minimumThickness*c,(this.maximumThickness-this.minimumThickness)*c)}}bindForSubMesh(y,c,A,l){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const w=l.materialDefines,N=this._material.isFrozen,p=this._material.realTimeFiltering,W=w.LODBASEDMICROSFURACE,h=this._getRefractionTexture(c);if(!y.useUbo||!N||!y.isSync){if(this._thicknessTexture&&X.d.ThicknessTextureEnabled&&(y.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,K.q)(this._thicknessTexture,y,"thickness")),this._refractionIntensityTexture&&X.d.RefractionIntensityTextureEnabled&&w.SS_REFRACTIONINTENSITY_TEXTURE&&(y.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,K.q)(this._refractionIntensityTexture,y,"refractionIntensity")),this._translucencyColorTexture&&X.d.TranslucencyColorTextureEnabled&&w.SS_TRANSLUCENCYCOLOR_TEXTURE&&(y.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,K.q)(this._translucencyColorTexture,y,"translucencyColor")),this._translucencyIntensityTexture&&X.d.TranslucencyIntensityTextureEnabled&&w.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(y.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,K.q)(this._translucencyIntensityTexture,y,"translucencyIntensity")),h&&X.d.RefractionTextureEnabled){y.Qc("refractionMatrix",h.getRefractionTextureMatrix());let c=1;h.isCube||h.depth&&(c=h.depth);const A=h.getSize().width,l=this.volumeIndexOfRefraction;if(y.updateFloat4("vRefractionInfos",h.level,1/l,c,this._invertRefractionY?-1:1),y.updateFloat4("vRefractionMicrosurfaceInfos",A,h.lodGenerationScale,h.lodGenerationOffset,1/this.indexOfRefraction),p&&y.updateFloat2("vRefractionFilteringInfo",A,Math.log2(A)),h.boundingBoxSize){const c=h;y.updateVector3("vRefractionPosition",c.boundingBoxPosition),y.updateVector3("vRefractionSize",c.boundingBoxSize)}}this._isScatteringEnabled&&y.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),y.updateColor3("vDiffusionDistance",this.diffusionDistance),y.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),y.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),y.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),y.updateFloat("dispersion",this.dispersion)}c.texturesEnabled&&(this._thicknessTexture&&X.d.ThicknessTextureEnabled&&y.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&X.d.RefractionIntensityTextureEnabled&&w.SS_REFRACTIONINTENSITY_TEXTURE&&y.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&X.d.TranslucencyIntensityTextureEnabled&&w.SS_TRANSLUCENCYINTENSITY_TEXTURE&&y.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&X.d.TranslucencyColorTextureEnabled&&w.SS_TRANSLUCENCYCOLOR_TEXTURE&&y.setTexture("translucencyColorSampler",this._translucencyColorTexture),h&&X.d.RefractionTextureEnabled&&(W?y.setTexture("refractionSampler",h):(y.setTexture("refractionSampler",h._lodTextureMid||h),y.setTexture("refractionSamplerLow",h._lodTextureLow||h),y.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))))}_getRefractionTexture(y){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?y.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(y){X.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&y.push(this._refractionTexture)}hasTexture(y){return this._thicknessTexture===y||(this._refractionTexture===y||(this._refractionIntensityTexture===y||(this._translucencyIntensityTexture===y||this._translucencyColorTexture===y)))}hasRenderTargetTextures(){return!!(X.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(y){this._thicknessTexture&&y.push(this._thicknessTexture),this._refractionTexture&&y.push(this._refractionTexture),this._translucencyColorTexture&&y.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&y.push(this._translucencyIntensityTexture)}getAnimatables(y){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&y.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&y.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&y.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&y.push(this._translucencyIntensityTexture)}dispose(y){y&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(y,c,A){return y.SS_SCATTERING&&c.addFallback(A++,"SS_SCATTERING"),y.SS_TRANSLUCENCY&&c.addFallback(A++,"SS_TRANSLUCENCY"),A}getSamplers(y){y.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}j.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,j.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isRefractionEnabled",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isTranslucencyEnabled",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isDispersionEnabled",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markScenePrePassDirty")],j.prototype,"isScatteringEnabled",void 0),(0,l.b)([(0,w.P)()],j.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,l.b)([(0,w.P)()],j.prototype,"refractionIntensity",void 0),(0,l.b)([(0,w.P)()],j.prototype,"translucencyIntensity",void 0),(0,l.b)([(0,w.P)()],j.prototype,"useAlbedoToTintRefraction",void 0),(0,l.b)([(0,w.P)()],j.prototype,"useAlbedoToTintTranslucency",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"thicknessTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"refractionTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"indexOfRefraction",void 0),(0,l.b)([(0,w.P)()],j.prototype,"_volumeIndexOfRefraction",void 0),(0,l.b)([(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"volumeIndexOfRefraction",null),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"invertRefractionY",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"linkRefractionWithTransparency",void 0),(0,l.b)([(0,w.P)()],j.prototype,"minimumThickness",void 0),(0,l.b)([(0,w.P)()],j.prototype,"maximumThickness",void 0),(0,l.b)([(0,w.P)()],j.prototype,"useThicknessAsDepth",void 0),(0,l.b)([(0,w.l)()],j.prototype,"tintColor",void 0),(0,l.b)([(0,w.P)()],j.prototype,"tintColorAtDistance",void 0),(0,l.b)([(0,w.P)()],j.prototype,"dispersion",void 0),(0,l.b)([(0,w.l)()],j.prototype,"diffusionDistance",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useMaskFromThicknessTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"refractionIntensityTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"translucencyIntensityTexture",void 0),(0,l.b)([(0,w.l)()],j.prototype,"translucencyColor",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"translucencyColorTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useGltfStyleTextures",void 0),(0,l.b)([(0,w.P)()],j.prototype,"applyAlbedoAfterSubSurface",void 0),(0,l.b)([(0,w.P)()],j.prototype,"legacyTransluceny",void 0);var f=A(12717),V=A(12692),J=A(12731);const U={effect:null,subMesh:null};class e extends o.c{constructor(y){super(y),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Q extends s.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(y){this._realTimeFiltering=y,this.Bq(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(y){this._realTimeFilteringQuality=y,this.Bq(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=y||this.mc().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(y,c){super(y,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Q.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new I.Vector4(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=P.dc.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new P.dc(0,0,0),this._albedoColor=new P.dc(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new P.dc(1,1,1),this._reflectionColor=new P.dc(1,1,1),this._emissiveColor=new P.dc(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Q.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new p.f(16),this._globalAmbientColor=new P.dc(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new i(this),this.clearCoat=new T(this),this.iridescence=new S(this),this.anisotropy=new k(this),this.sheen=new u(this),this.subSurface=new j(this),this.detailMap=new f.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),X.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,W.c)(this.mc()),this.prePassConfiguration=new H.e}get hasRenderTargetTextures(){return!!(X.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var y;return this._transparencyMode===Q.PBRMATERIAL_OPAQUE||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST||(null===(y=this.subSurface)||void 0===y?void 0:y.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var y;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(y=this.subSurface)||void 0===y||!y.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Vc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Q.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Vc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(y,c,A){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const l=c._drawWrapper;if(l.effect&&this.isFrozen&&l._wasPreviouslyReady&&l._wasPreviouslyUsingInstances===A)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new e(this._eventInfo.defineNames));const w=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const p=this.mc(),W=p.getEngine();if(w._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,p.texturesEnabled)){if(this._albedoTexture&&X.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&X.d.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&X.d.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&X.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&X.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const y=this._getReflectionTexture();if(y&&X.d.ReflectionTextureEnabled){if(!y.isReadyOrNotBlocking())return!1;var h;if(y.irradianceTexture){if(!y.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!y.sphericalPolynomial&&null!==(h=y.getInternalTexture())&&void 0!==h&&h._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&X.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&X.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(X.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(W.getCaps().standardDerivatives&&this._bumpTexture&&X.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&X.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=w,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(w._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(w.AREALIGHTUSED)for(let N=0;N<y.lightSources.length;N++)if(!y.lightSources[N]._isReady())return!1;W.getCaps().standardDerivatives||y.isVerticesDataPresent(q.e.NormalKind)||(y.createNormals(!0),N.c.Warn("PBRMaterial: Normals have been created for the mesh: "+y.name));const I=c.effect,o=w._areLightsDisposed;let O=this._prepareEffect(y,w,this.onCompiled,this.onError,A,null,c.getRenderingMesh().hasThinInstances),L=!1;if(O)if(this._onEffectCreatedObservable&&(U.effect=O,U.subMesh=c,this._onEffectCreatedObservable.notifyObservers(U)),this.allowShaderHotSwapping&&I&&!O.isReady()){if(O=I,w.markAsUnprocessed(),L=this.isFrozen,o)return w._areLightsDisposed=!0,!1}else p.resetCachedMaterial(),c.setEffect(O,w,this._materialContext);return!(!c.effect||!c.effect.isReady())&&(w._renderId=p.getRenderId(),l._wasPreviouslyReady=!L,l._wasPreviouslyUsingInstances=!!A,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(y,c){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(y,c,N,p,W),!c.isDirty)return null;c.markAsProcessed();const h=this.mc().getEngine(),I=new C.c;let o=0;c.USESPHERICALINVERTEX&&I.addFallback(o++,"USESPHERICALINVERTEX"),c.FOG&&I.addFallback(o,"FOG"),c.SPECULARAA&&I.addFallback(o,"SPECULARAA"),c.POINTSIZE&&I.addFallback(o,"POINTSIZE"),c.LOGARITHMICDEPTH&&I.addFallback(o,"LOGARITHMICDEPTH"),c.PARALLAX&&I.addFallback(o,"PARALLAX"),c.PARALLAX_RHS&&I.addFallback(o,"PARALLAX_RHS"),c.PARALLAXOCCLUSION&&I.addFallback(o++,"PARALLAXOCCLUSION"),c.ENVIRONMENTBRDF&&I.addFallback(o++,"ENVIRONMENTBRDF"),c.TANGENT&&I.addFallback(o++,"TANGENT"),c.BUMP&&I.addFallback(o++,"BUMP"),o=(0,K.u)(c,I,this._maxSimultaneousLights,o++),c.SPECULARTERM&&I.addFallback(o++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&I.addFallback(o++,"USESPHERICALFROMREFLECTIONMAP"),c.USEIRRADIANCEMAP&&I.addFallback(o++,"USEIRRADIANCEMAP"),c.LIGHTMAP&&I.addFallback(o++,"LIGHTMAP"),c.NORMAL&&I.addFallback(o++,"NORMAL"),c.AMBIENT&&I.addFallback(o++,"AMBIENT"),c.EMISSIVE&&I.addFallback(o++,"EMISSIVE"),c.VERTEXCOLOR&&I.addFallback(o++,"VERTEXCOLOR"),c.MORPHTARGETS&&I.addFallback(o++,"MORPHTARGETS"),c.MULTIVIEW&&I.addFallback(0,"MULTIVIEW");const O=[q.e.PositionKind];c.NORMAL&&O.push(q.e.NormalKind),c.TANGENT&&O.push(q.e.TangentKind);for(let A=1;A<=6;++A)c["UV"+A]&&O.push(`uv${1===A?"":A}`);c.VERTEXCOLOR&&O.push(q.e.ColorKind),(0,K.z)(O,y,c,I),(0,K.A)(O,c),(0,K.E)(O,y,c),(0,K.x)(O,y,c);let L="pbr";const i=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],P=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],t=["Material","Scene","Mesh"],s={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=I,this._eventInfo.fallbackRank=o,this._eventInfo.defines=c,this._eventInfo.uniforms=i,this._eventInfo.attributes=O,this._eventInfo.samplers=P,this._eventInfo.uniformBuffersNames=t,this._eventInfo.customCode=void 0,this._eventInfo.mesh=y,this._eventInfo.indexParameters=s,this._callbackPluginEventGeneric(128,this._eventInfo),J.c.AddUniformsAndSamplers(i,P),H.e.AddUniforms(i),H.e.AddSamplers(P),(0,V.d)(i),D.e&&(D.e.PrepareUniforms(i,c),D.e.PrepareSamplers(P,c)),(0,K.ab)({uniformsNames:i,uniformBuffersNames:t,samplers:P,defines:c,maxSimultaneousLights:this._maxSimultaneousLights});const B={};this.customShaderNameResolve&&(L=this.customShaderNameResolve(L,i,t,P,c,O,B));const X=c.toString(),my=h.createEffect(L,{attributes:O,uniformsNames:i,uniformBuffersNames:t,samplers:P,defines:X,fallbacks:I,onCompiled:l,onError:w,indexParameters:s,processFinalCode:B.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:c.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([A.e(41),A.e(71)]).then(A.bind(A,15345)),Promise.all([A.e(39),A.e(72)]).then(A.bind(A,15368))]):await Promise.all([Promise.all([A.e(34),A.e(73)]).then(A.bind(A,15370)),Promise.all([A.e(33),A.e(74)]).then(A.bind(A,15401))]),this._shadersLoaded=!0}},h);return this._eventInfo.customCode=void 0,my}_prepareDefines(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const N=this.mc(),p=N.getEngine();(0,K.R)(N,y,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,(0,K.W)(N,c);const W=this.needAlphaBlendingForMesh(y)&&this.mc().useOrderIndependentTransparency;if((0,K._)(N,c,this.canRenderToMRT&&!W),(0,K.Y)(N,c,W),J.c.PrepareDefines(p.currentRenderPassId,y,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){c._needUVs=!1;for(let y=1;y<=6;++y)c["MAINUV"+y]=!1;if(N.texturesEnabled){c.ALBEDODIRECTUV=0,c.BASE_WEIGHTDIRECTUV=0,c.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,c.AMBIENTDIRECTUV=0,c.OPACITYDIRECTUV=0,c.EMISSIVEDIRECTUV=0,c.REFLECTIVITYDIRECTUV=0,c.MICROSURFACEMAPDIRECTUV=0,c.METALLIC_REFLECTANCEDIRECTUV=0,c.REFLECTANCEDIRECTUV=0,c.BUMPDIRECTUV=0,c.LIGHTMAPDIRECTUV=0,p.getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&X.d.DiffuseTextureEnabled?((0,K.T)(this._albedoTexture,c,"ALBEDO"),c.GAMMAALBEDO=this._albedoTexture.gammaSpace):c.ALBEDO=!1,this._baseWeightTexture&&X.d.BaseWeightTextureEnabled?(0,K.T)(this._baseWeightTexture,c,"BASE_WEIGHT"):c.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&X.d.BaseDiffuseRoughnessTextureEnabled?(0,K.T)(this._baseDiffuseRoughnessTexture,c,"BASE_DIFFUSE_ROUGHNESS"):c.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&X.d.AmbientTextureEnabled?((0,K.T)(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&X.d.OpacityTextureEnabled?((0,K.T)(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;const y=this._getReflectionTexture();if(y&&X.d.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=y.gammaSpace,c.RGBDREFLECTION=y.isRGBD,c.LODINREFLECTIONALPHA=y.lodLevelInAlpha,c.LINEARSPECULARREFLECTION=y.linearSpecularLOD,c.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(c.NUM_SAMPLES=""+this.realTimeFilteringQuality,p._features.needTypeSuffixInShaderConstants&&(c.NUM_SAMPLES=c.NUM_SAMPLES+"u"),c.REALTIME_FILTERING=!0,this.mc().iblCdfGenerator&&(c.IBL_CDF_FILTERING=!0)):c.REALTIME_FILTERING=!1,c.INVERTCUBICMAP=y.coordinatesMode===B.d.INVCUBIC_MODE,c.REFLECTIONMAP_3D=y.isCube,c.REFLECTIONMAP_OPPOSITEZ=c.REFLECTIONMAP_3D&&this.mc().useRightHandedSystem?!y.invertZ:y.invertZ,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,y.coordinatesMode){case B.d.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case B.d.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case B.d.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case B.d.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case B.d.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case B.d.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case B.d.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case B.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case B.d.CUBIC_MODE:case B.d.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!y.boundingBoxSize}y.coordinatesMode!==B.d.SKYBOX_MODE&&(y.irradianceTexture?(c.USEIRRADIANCEMAP=!0,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USESPHERICALINVERTEX=!1,y.irradianceTexture._dominantDirection&&(c.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):y.isCube&&(c.USESPHERICALFROMREFLECTIONMAP=!0,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||p.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0))}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1,c.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&X.d.LightmapTextureEnabled?((0,K.T)(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):c.LIGHTMAP=!1,this._emissiveTexture&&X.d.EmissiveTextureEnabled?((0,K.T)(this._emissiveTexture,c,"EMISSIVE"),c.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):c.EMISSIVE=!1,X.d.SpecularTextureEnabled?(this._metallicTexture?((0,K.T)(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,c.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,K.T)(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,c.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):c.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(c.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,K.T)(this._metallicReflectanceTexture,c,"METALLIC_REFLECTANCE"),c.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):c.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,K.T)(this._reflectanceTexture,c,"REFLECTANCE"),c.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):c.REFLECTANCE=!1):(c.METALLIC_REFLECTANCE=!1,c.REFLECTANCE=!1),this._microSurfaceTexture?(0,K.T)(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),p.getCaps().standardDerivatives&&this._bumpTexture&&X.d.BumpTextureEnabled&&!this._disableBumpMap?((0,K.T)(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&X.d.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAX_RHS=N.useRightHandedSystem,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(c.BUMP=!1,c.PARALLAX=!1,c.PARALLAX_RHS=!1,c.PARALLAXOCCLUSION=!1,c.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&X.d.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Q.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Q.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.nc&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.MIRRORED=!!N._mirroredCameraPosition,c.SPECULARAA=p.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(c._areTexturesDirty||c._areMiscDirty)&&(c.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,c.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,c.ALPHABLEND=this.needAlphaBlendingForMesh(y),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&((0,K.U)(y,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(y),c,this._applyDecalMapAfterDetailMap),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!y.isVerticesDataPresent(q.e.NormalKind),c.DEBUGMODE=this._debugMode),(0,K.O)(N,p,this,c,!!A,l,w),this._eventInfo.defines=c,this._eventInfo.mesh=y,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,K.L)(y,c,!0,!0,!0,this._transparencyMode!==Q.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(y,c,A){const l={clipPlane:!1,useInstances:!1,...A};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const A=new e(this._eventInfo.defineNames),w=this._prepareEffect(y,A,void 0,void 0,l.useInstances,l.clipPlane,y.hasThinInstances);this._onEffectCreatedObservable&&(U.effect=w,U.subMesh=null,this._onEffectCreatedObservable.notifyObservers(U)),w.isReady()?c&&c(this):w.onCompileObservable.add((()=>{c&&c(this)}))})()}buildUniformLayout(){const y=this._uniformBuffer;y.addUniform("vAlbedoInfos",2),y.addUniform("vBaseWeightInfos",2),y.addUniform("vBaseDiffuseRoughnessInfos",2),y.addUniform("vAmbientInfos",4),y.addUniform("vOpacityInfos",2),y.addUniform("vEmissiveInfos",2),y.addUniform("vLightmapInfos",2),y.addUniform("vReflectivityInfos",3),y.addUniform("vMicroSurfaceSamplerInfos",2),y.addUniform("vReflectionInfos",2),y.addUniform("vReflectionFilteringInfo",2),y.addUniform("vReflectionPosition",3),y.addUniform("vReflectionSize",3),y.addUniform("vBumpInfos",3),y.addUniform("albedoMatrix",16),y.addUniform("baseWeightMatrix",16),y.addUniform("baseDiffuseRoughnessMatrix",16),y.addUniform("ambientMatrix",16),y.addUniform("opacityMatrix",16),y.addUniform("emissiveMatrix",16),y.addUniform("lightmapMatrix",16),y.addUniform("reflectivityMatrix",16),y.addUniform("microSurfaceSamplerMatrix",16),y.addUniform("bumpMatrix",16),y.addUniform("vTangentSpaceParams",2),y.addUniform("reflectionMatrix",16),y.addUniform("vReflectionColor",3),y.addUniform("vAlbedoColor",4),y.addUniform("baseWeight",1),y.addUniform("baseDiffuseRoughness",1),y.addUniform("vLightingIntensity",4),y.addUniform("vReflectionMicrosurfaceInfos",3),y.addUniform("vReflectionDominantDirection",3),y.addUniform("pointSize",1),y.addUniform("vReflectivityColor",4),y.addUniform("vEmissiveColor",3),y.addUniform("vAmbientColor",3),y.addUniform("vDebugMode",2),y.addUniform("vMetallicReflectanceFactors",4),y.addUniform("vMetallicReflectanceInfos",2),y.addUniform("metallicReflectanceMatrix",16),y.addUniform("vReflectanceInfos",2),y.addUniform("reflectanceMatrix",16),y.addUniform("vSphericalL00",3),y.addUniform("vSphericalL1_1",3),y.addUniform("vSphericalL10",3),y.addUniform("vSphericalL11",3),y.addUniform("vSphericalL2_2",3),y.addUniform("vSphericalL2_1",3),y.addUniform("vSphericalL20",3),y.addUniform("vSphericalL21",3),y.addUniform("vSphericalL22",3),y.addUniform("vSphericalX",3),y.addUniform("vSphericalY",3),y.addUniform("vSphericalZ",3),y.addUniform("vSphericalXX_ZZ",3),y.addUniform("vSphericalYY_ZZ",3),y.addUniform("vSphericalZZ",3),y.addUniform("vSphericalXY",3),y.addUniform("vSphericalYZ",3),y.addUniform("vSphericalZX",3),y.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(y,c,A){const l=this.mc(),w=A.materialDefines;if(!w)return;const N=A.effect;if(!N)return;this._activeEffect=N,c.getMeshUniformBuffer().bindToEffect(N,"Mesh"),c.transferToEffect(y);const p=l.getEngine();this._uniformBuffer.bindToEffect(N,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,l,c,y,this.isFrozen),J.c.Bind(p.currentRenderPassId,this._activeEffect,c,y,this);const W=l.activeCamera;W?this._uniformBuffer.updateFloat4("cameraInfo",W.ec,W.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=A,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),w.OBJECTSPACE_NORMALMAP&&(y.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const I=this._mustRebind(l,N,A,c.visibility);(0,K.e)(c,this._activeEffect,this.prePassConfiguration);let q=null;const o=this._uniformBuffer;if(I){if(this.bindViewProjection(N),q=this._getReflectionTexture(),!o.useUbo||!this.isFrozen||!o.isSync||A._drawWrapper._forceRebindOnNextCall){var O;if(l.texturesEnabled){if(this._albedoTexture&&X.d.DiffuseTextureEnabled&&(o.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,K.q)(this._albedoTexture,o,"albedo")),this._baseWeightTexture&&X.d.BaseWeightTextureEnabled&&(o.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,K.q)(this._baseWeightTexture,o,"baseWeight")),this._baseDiffuseRoughnessTexture&&X.d.BaseDiffuseRoughnessTextureEnabled&&(o.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,K.q)(this._baseDiffuseRoughnessTexture,o,"baseDiffuseRoughness")),this._ambientTexture&&X.d.AmbientTextureEnabled&&(o.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,K.q)(this._ambientTexture,o,"ambient")),this._opacityTexture&&X.d.OpacityTextureEnabled&&(o.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,K.q)(this._opacityTexture,o,"opacity")),q&&X.d.ReflectionTextureEnabled){if(o.Qc("reflectionMatrix",q.getReflectionTextureMatrix()),o.updateFloat2("vReflectionInfos",q.level*l.iblIntensity,0),q.boundingBoxSize){const y=q;o.updateVector3("vReflectionPosition",y.boundingBoxPosition),o.updateVector3("vReflectionSize",y.boundingBoxSize)}if(this.realTimeFiltering){const y=q.getSize().width;o.updateFloat2("vReflectionFilteringInfo",y,Math.log2(y))}if(w.USEIRRADIANCEMAP)w.USEIRRADIANCEMAP&&w.USE_IRRADIANCE_DOMINANT_DIRECTION&&o.updateVector3("vReflectionDominantDirection",q.irradianceTexture._dominantDirection);else{const y=q.sphericalPolynomial;if(w.USESPHERICALFROMREFLECTIONMAP&&y)if(w.SPHERICAL_HARMONICS){const c=y.preScaledHarmonics;o.updateVector3("vSphericalL00",c.l00),o.updateVector3("vSphericalL1_1",c.l1_1),o.updateVector3("vSphericalL10",c.l10),o.updateVector3("vSphericalL11",c.l11),o.updateVector3("vSphericalL2_2",c.l2_2),o.updateVector3("vSphericalL2_1",c.l2_1),o.updateVector3("vSphericalL20",c.l20),o.updateVector3("vSphericalL21",c.l21),o.updateVector3("vSphericalL22",c.l22)}else o.updateFloat3("vSphericalX",y.x.x,y.x.y,y.x.z),o.updateFloat3("vSphericalY",y.y.x,y.y.y,y.y.z),o.updateFloat3("vSphericalZ",y.z.x,y.z.y,y.z.z),o.updateFloat3("vSphericalXX_ZZ",y.xx.x-y.zz.x,y.xx.y-y.zz.y,y.xx.z-y.zz.z),o.updateFloat3("vSphericalYY_ZZ",y.yy.x-y.zz.x,y.yy.y-y.zz.y,y.yy.z-y.zz.z),o.updateFloat3("vSphericalZZ",y.zz.x,y.zz.y,y.zz.z),o.updateFloat3("vSphericalXY",y.xy.x,y.xy.y,y.xy.z),o.updateFloat3("vSphericalYZ",y.yz.x,y.yz.y,y.yz.z),o.updateFloat3("vSphericalZX",y.zx.x,y.zx.y,y.zx.z)}o.updateFloat3("vReflectionMicrosurfaceInfos",q.getSize().width,q.lodGenerationScale,q.lodGenerationOffset)}this._emissiveTexture&&X.d.EmissiveTextureEnabled&&(o.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,K.q)(this._emissiveTexture,o,"emissive")),this._lightmapTexture&&X.d.LightmapTextureEnabled&&(o.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,K.q)(this._lightmapTexture,o,"lightmap")),X.d.SpecularTextureEnabled&&(this._metallicTexture?(o.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,K.q)(this._metallicTexture,o,"reflectivity")):this._reflectivityTexture&&(o.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,K.q)(this._reflectivityTexture,o,"reflectivity")),this._metallicReflectanceTexture&&(o.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,K.q)(this._metallicReflectanceTexture,o,"metallicReflectance")),this._reflectanceTexture&&w.REFLECTANCE&&(o.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,K.q)(this._reflectanceTexture,o,"reflectance")),this._microSurfaceTexture&&(o.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,K.q)(this._microSurfaceTexture,o,"microSurfaceSampler"))),this._bumpTexture&&p.getCaps().standardDerivatives&&X.d.BumpTextureEnabled&&!this._disableBumpMap&&(o.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,K.q)(this._bumpTexture,o,"bump"),l._mirroredCameraPosition?o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&o.updateFloat("pointSize",this.pointSize),w.METALLICWORKFLOW){var L;P.TmpColors.ip[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,P.TmpColors.ip[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const y=(null===(L=this.subSurface)||void 0===L?void 0:L._indexOfRefraction)??1.5,c=1;P.TmpColors.ip[0].b=y;const A=Math.pow((y-c)/(y+c),2);P.TmpColors.ip[0].a=A,o.updateDirectColor4("vReflectivityColor",P.TmpColors.ip[0]),o.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else o.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);o.updateColor3("vEmissiveColor",X.d.EmissiveTextureEnabled?this._emissiveColor:P.dc.BlackReadOnly),o.updateColor3("vReflectionColor",this._reflectionColor),!w.SS_REFRACTION&&null!==(O=this.subSurface)&&void 0!==O&&O._linkRefractionWithTransparency?o.updateColor4("vAlbedoColor",this._albedoColor,1):o.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),o.updateFloat("baseWeight",this._baseWeight),o.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*l.environmentIntensity,this._lightingInfos.w=this._specularIntensity,o.updateVector4("vLightingIntensity",this._lightingInfos),l.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),o.updateColor3("vAmbientColor",this._globalAmbientColor),o.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(l.texturesEnabled){if(this._albedoTexture&&X.d.DiffuseTextureEnabled&&o.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&X.d.BaseWeightTextureEnabled&&o.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&X.d.BaseDiffuseRoughnessTextureEnabled&&o.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&X.d.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&X.d.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),q&&X.d.ReflectionTextureEnabled){w.LODBASEDMICROSFURACE?o.setTexture("reflectionSampler",q):(o.setTexture("reflectionSampler",q._lodTextureMid||q),o.setTexture("reflectionSamplerLow",q._lodTextureLow||q),o.setTexture("reflectionSamplerHigh",q._lodTextureHigh||q)),w.USEIRRADIANCEMAP&&o.setTexture("irradianceSampler",q.irradianceTexture);const y=this.mc().iblCdfGenerator;this.realTimeFiltering&&y&&o.setTexture("icdfSampler",y.getIcdfTexture())}w.ENVIRONMENTBRDF&&o.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&X.d.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&X.d.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),X.d.SpecularTextureEnabled&&(this._metallicTexture?o.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&o.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&o.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&w.REFLECTANCE&&o.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&o.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&p.getCaps().standardDerivatives&&X.d.BumpTextureEnabled&&!this._disableBumpMap&&o.setTexture("bumpSampler",this._bumpTexture)}this.mc().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.mc().depthPeelingRenderer.bind(N),this._eventInfo.subMesh=A,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,V.g)(this._activeEffect,this,l),this.bindEyePosition(N)}else l.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(I||!this.isFrozen){var i;if(l.lightsEnabled&&!this._disableLighting&&(0,K.i)(l,c,this._activeEffect,w,this._maxSimultaneousLights),(l.fogEnabled&&c.applyFog&&l.fogMode!==h.b.FOGMODE_NONE||q||this.subSurface.refractionTexture||c.receiveShadows||w.PREPASS)&&this.bindView(N),(0,K.f)(l,c,this._activeEffect,!0),w.NUM_MORPH_INFLUENCERS&&(0,K.m)(c,this._activeEffect),w.BAKED_VERTEX_ANIMATION_TEXTURE)null===(i=c.bakedVertexAnimationManager)||void 0===i||i.bind(N,w.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,K.l)(w,this._activeEffect,l)}this._afterBind(c,this._activeEffect,A),o.update()}getAnimatables(){const y=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&y.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&y.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&y.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&y.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&y.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&y.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&y.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?y.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&y.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&y.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&y.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&y.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&y.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&y.push(this._microSurfaceTexture),y}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.mc().environmentTexture}getActiveTextures(){const y=super.getActiveTextures();return this._albedoTexture&&y.push(this._albedoTexture),this._baseWeightTexture&&y.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&y.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&y.push(this._ambientTexture),this._opacityTexture&&y.push(this._opacityTexture),this._reflectionTexture&&y.push(this._reflectionTexture),this._emissiveTexture&&y.push(this._emissiveTexture),this._reflectivityTexture&&y.push(this._reflectivityTexture),this._metallicTexture&&y.push(this._metallicTexture),this._metallicReflectanceTexture&&y.push(this._metallicReflectanceTexture),this._reflectanceTexture&&y.push(this._reflectanceTexture),this._microSurfaceTexture&&y.push(this._microSurfaceTexture),this._bumpTexture&&y.push(this._bumpTexture),this._lightmapTexture&&y.push(this._lightmapTexture),y}hasTexture(y){return!!super.hasTexture(y)||(this._albedoTexture===y||(this._baseWeightTexture===y||(this._baseDiffuseRoughnessTexture===y||(this._ambientTexture===y||(this._opacityTexture===y||(this._reflectionTexture===y||(this._emissiveTexture===y||(this._reflectivityTexture===y||(this._metallicTexture===y||(this._metallicReflectanceTexture===y||(this._reflectanceTexture===y||(this._microSurfaceTexture===y||(this._bumpTexture===y||this._lightmapTexture===y)))))))))))))}setPrePassRenderer(){var y;if(null===(y=this.subSurface)||void 0===y||!y.isScatteringEnabled)return!1;const c=this.mc().enableSubSurfaceForPrePass();return c&&(c.enabled=!0),!0}dispose(y,c){var A,l,w,N,p,W,h,I,q,o,O,L,i,H;(this._breakShaderLoadedCheck=!0,c)&&(this._environmentBRDFTexture&&this.mc().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(A=this._albedoTexture)||void 0===A||A.dispose(),null===(l=this._baseWeightTexture)||void 0===l||l.dispose(),null===(w=this._baseDiffuseRoughnessTexture)||void 0===w||w.dispose(),null===(N=this._ambientTexture)||void 0===N||N.dispose(),null===(p=this._opacityTexture)||void 0===p||p.dispose(),null===(W=this._reflectionTexture)||void 0===W||W.dispose(),null===(h=this._emissiveTexture)||void 0===h||h.dispose(),null===(I=this._metallicTexture)||void 0===I||I.dispose(),null===(q=this._reflectivityTexture)||void 0===q||q.dispose(),null===(o=this._bumpTexture)||void 0===o||o.dispose(),null===(O=this._lightmapTexture)||void 0===O||O.dispose(),null===(L=this._metallicReflectanceTexture)||void 0===L||L.dispose(),null===(i=this._reflectanceTexture)||void 0===i||i.dispose(),null===(H=this._microSurfaceTexture)||void 0===H||H.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(y,c)}}Q.PBRMATERIAL_OPAQUE=t.c.MATERIAL_OPAQUE,Q.PBRMATERIAL_ALPHATEST=t.c.MATERIAL_ALPHATEST,Q.PBRMATERIAL_ALPHABLEND=t.c.MATERIAL_ALPHABLEND,Q.PBRMATERIAL_ALPHATESTANDBLEND=t.c.MATERIAL_ALPHATESTANDBLEND,Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,Q.LIGHTFALLOFF_PHYSICAL=0,Q.LIGHTFALLOFF_GLTF=1,Q.LIGHTFALLOFF_STANDARD=2,Q.ForceGLSL=!1,(0,l.b)([(0,w.s)()],Q.prototype,"_imageProcessingConfiguration",void 0),(0,l.b)([(0,w.d)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"debugMode",void 0)},12808:(y,c,A)=>{A.d(c,{c:()=>o});var l=A(12307),w=A(12310),N=A(12813),p=A(12375),W=A(12827),h=A(12283),I=A(12632),q=A(12363);class o extends W.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(y){this.subSurface.refractionTexture=y,y?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(y){this.subSurface.indexOfRefraction=y}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(y){this.subSurface.invertRefractionY=y}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(y){this.subSurface.linkRefractionWithTransparency=y,y&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===W.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(y){y!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=y?W.c.LIGHTFALLOFF_PHYSICAL:W.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===W.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(y){y!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=y?W.c.LIGHTFALLOFF_GLTF:W.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(y){this.imageProcessingConfiguration.colorCurvesEnabled=y}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(y){this.imageProcessingConfiguration.colorGradingEnabled=y}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(y){this._imageProcessingConfiguration.toneMappingEnabled=y}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(y){this._imageProcessingConfiguration.exposure=y}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(y){this._imageProcessingConfiguration.contrast=y}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(y){this._imageProcessingConfiguration.colorGradingTexture=y}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(y){this._imageProcessingConfiguration.colorCurves=y}constructor(y,c){super(y,c,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=o.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=p.dc.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new p.dc(0,0,0),this.albedoColor=new p.dc(1,1,1),this.baseWeight=1,this.reflectivityColor=new p.dc(1,1,1),this.reflectionColor=new p.dc(1,1,1),this.emissiveColor=new p.dc(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,N.c)(this.mc())}getClassName(){return"PBRMaterial"}clone(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const l=q.d.Clone((()=>new o(y,this.mc())),this,{cloneTexturesOnlyOnce:c});return l.id=y,l.name=y,this.Sc.copyTo(l.Sc),this._clonePlugins(l,A),l}serialize(){const y=super.serialize();return y.customType="BABYLON.PBRMaterial",y}static Parse(y,c,A){const l=q.d.Parse((()=>new o(y.name,c)),y,c,A);return y.Sc&&l.Sc.parse(y.Sc,c,A),I.c._ParsePlugins(y,l,c,A),y.clearCoat&&l.clearCoat.parse(y.clearCoat,c,A),y.anisotropy&&l.anisotropy.parse(y.anisotropy,c,A),y.brdf&&l.brdf.parse(y.brdf,c,A),y.sheen&&l.sheen.parse(y.sheen,c,A),y.subSurface&&l.subSurface.parse(y.subSurface,c,A),y.iridescence&&l.iridescence.parse(y.iridescence,c,A),l}}o.PBRMATERIAL_OPAQUE=W.c.PBRMATERIAL_OPAQUE,o.PBRMATERIAL_ALPHATEST=W.c.PBRMATERIAL_ALPHATEST,o.PBRMATERIAL_ALPHABLEND=W.c.PBRMATERIAL_ALPHABLEND,o.PBRMATERIAL_ALPHATESTANDBLEND=W.c.PBRMATERIAL_ALPHATESTANDBLEND,o.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=W.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"directIntensity",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveIntensity",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"environmentIntensity",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"specularIntensity",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"disableBumpMap",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"albedoTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"baseWeightTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"baseDiffuseRoughnessTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTextureStrength",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"opacityTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectionTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectivityTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallic",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"roughness",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicF0Factor",void 0),(0,l.b)([(0,w.l)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicReflectanceColor",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicReflectanceTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectanceTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"microSurfaceTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"bumpTexture",void 0),(0,l.b)([(0,w.F)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty",null)],o.prototype,"lightmapTexture",void 0),(0,l.b)([(0,w.l)("ambient"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientColor",void 0),(0,l.b)([(0,w.l)("albedo"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"albedoColor",void 0),(0,l.b)([(0,w.P)("baseWeight"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"baseWeight",void 0),(0,l.b)([(0,w.P)("baseDiffuseRoughness"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"baseDiffuseRoughness",void 0),(0,l.b)([(0,w.l)("reflectivity"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectivityColor",void 0),(0,l.b)([(0,w.l)("reflection"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectionColor",void 0),(0,l.b)([(0,w.l)("emissive"),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveColor",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"microSurface",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useLightmapAsShadowmap",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"useAlphaFromAlbedoTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"forceAlphaTest",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"alphaCutOff",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useSpecularOverAlpha",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAmbientInGrayScale",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,l.b)([(0,w.P)()],o.prototype,"usePhysicalLightFalloff",null),(0,l.b)([(0,w.P)()],o.prototype,"useGLTFLightFalloff",null),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRadianceOverAlpha",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useObjectSpaceNormalMap",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallax",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallaxOcclusion",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"parallaxScaleBias",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"disableLighting",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"forceIrradianceInFragment",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"maxSimultaneousLights",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapX",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapY",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"twoSidedLighting",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAlphaFresnel",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useLinearAlphaFresnel",void 0),(0,l.b)([(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"environmentBRDFTexture",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"forceNormalForward",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"enableSpecularAntiAliasing",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useHorizonOcclusion",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRadianceOcclusion",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],o.prototype,"unlit",void 0),(0,l.b)([(0,w.P)(),(0,w.d)("_markAllSubMeshesAsMiscDirty")],o.prototype,"applyDecalMapAfterDetailMap",void 0),(0,h.f)("BABYLON.PBRMaterial",o)},12793:(y,c,A)=>{A.d(c,{b:()=>w});var l=A(12303);class w extends l.d{constructor(y,c,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,q=arguments.length>9?arguments[9]:void 0,o=arguments.length>10?arguments[10]:void 0,O=arguments.length>11?arguments[11]:void 0;super(null,N,!p,W,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q),this.format=w,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==I||(h=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==I||(h=1),this._texture=this._engine.createRawTexture(y,c,A,w,p,W,h,null,I,q??0,o??!1),this.wrapU=l.d.CLAMP_ADDRESSMODE,this.wrapV=l.d.CLAMP_ADDRESSMODE,this._waitingForData=!!O&&!y)}update(y){this._getEngine().updateRawTexture(this._texture,y,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const y=new w(null,this.getSize().width,this.getSize().height,this.format,this.mc(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return y._texture=this._texture,this._texture.incrementReferences(),y}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(y,c,A,l){return new w(y,c,A,1,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(y,c,A,l){return new w(y,c,A,2,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(y,c,A,l){return new w(y,c,A,0,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(y,c,A,l){return new w(y,c,A,4,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(y,c,A,l){return new w(y,c,A,5,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(y,c,A,l){return new w(y,c,A,5,l,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(y,c,A,N){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l.d.TRILINEAR_SAMPLINGMODE;return new w(y,c,A,6,N,p,W,h,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(y,c,A,N){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l.d.TRILINEAR_SAMPLINGMODE;return new w(y,c,A,6,N,p,W,h,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12791:(y,c,A)=>{A.d(c,{c:()=>p});var l=A(12632),w=A(12368),N=A(12283);class p extends l.c{get Up(){return this._subMaterials}set Up(y){this._subMaterials=y,this._hookArray(y)}getChildren(){return this.Up}constructor(y,c){super(y,c,!0),this._waitingSubMaterialsUniqueIds=[],this.mc().addMultiMaterial(this),this.Up=[],this._storeEffectOnSubMeshes=!0}_hookArray(y){var c=this;const A=y.push;y.push=function(){for(var l=arguments.length,w=new Array(l),N=0;N<l;N++)w[N]=arguments[N];const p=A.apply(y,w);return c._markAllSubMeshesAsTexturesDirty(),p};const l=y.splice;y.splice=(c,A)=>{const w=l.apply(y,[c,A]);return this._markAllSubMeshesAsTexturesDirty(),w}}getSubMaterial(y){return y<0||y>=this.Up.length?this.mc().defaultMaterial:this.Up[y]}getActiveTextures(){return super.getActiveTextures().concat(...this.Up.map((y=>y?y.getActiveTextures():[])))}hasTexture(y){if(super.hasTexture(y))return!0;for(let A=0;A<this.Up.length;A++){var c;if(null!==(c=this.Up[A])&&void 0!==c&&c.hasTexture(y))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(y,c,A){for(let l=0;l<this.Up.length;l++){const w=this.Up[l];if(w){if(w._storeEffectOnSubMeshes){if(!w.isReadyForSubMesh(y,c,A))return!1;continue}if(!w.isReady(y))return!1}}return!0}clone(y,c){const A=new p(y,this.mc());for(let l=0;l<this.Up.length;l++){let w=null;const N=this.Up[l];w=c&&N?N.clone(y+"-"+N.name):this.Up[l],A.Up.push(w)}return A}serialize(){const y={};y.name=this.name,y.id=this.id,y.uniqueId=this.uniqueId,w.c&&(y.tags=w.c.GetTags(this)),y.materialsUniqueIds=[],y.materials=[];for(let c=0;c<this.Up.length;c++){const A=this.Up[c];A?(y.materialsUniqueIds.push(A.uniqueId),y.materials.push(A.id)):(y.materialsUniqueIds.push(null),y.materials.push(null))}return y}dispose(y,c,A){const l=this.mc();if(!l)return;if(A)for(let N=0;N<this.Up.length;N++){const A=this.Up[N];A&&A.dispose(y,c)}const w=l.multiMaterials.indexOf(this);w>=0&&l.multiMaterials.splice(w,1),super.dispose(y,c)}static ParseMultiMaterial(y,c){const A=new p(y.name,c);if(A.id=y.id,A._loadedUniqueId=y.uniqueId,w.c&&w.c.AddTagsTo(A,y.tags),y.materialsUniqueIds)A._waitingSubMaterialsUniqueIds=y.materialsUniqueIds;else for(const l of y.materials)A.Up.push(c.getLastMaterialById(l));return A}}(0,N.f)("BABYLON.MultiMaterial",p)},12881:(y,c,A)=>{A.d(c,{e:()=>D,g:()=>t});var l=A(12325),w=A(12375),N=A(12773),p=A(12758),W=A(12161),h=A(12400),I=A(12529),q=A(12330),o=A(12184);class O extends l.Vector2{constructor(y,c){super(y.x,y.y),this.index=c}}class L{constructor(){this.elements=[]}add(y){const c=[];for(const A of y){const y=new O(A,this.elements.length);c.push(y),this.elements.push(y)}return c}computeBounds(){const y=new l.Vector2(this.elements[0].x,this.elements[0].y),c=new l.Vector2(this.elements[0].x,this.elements[0].y);for(const A of this.elements)A.x<y.x?y.x=A.x:A.x>c.x&&(c.x=A.x),A.y<y.y?y.y=A.y:A.y>c.y&&(c.y=A.y);return{min:y,max:c,width:c.x-y.x,height:c.y-y.y}}}class i{_addToepoint(y){for(const c of y)this._epoints.push(c.x,c.y)}constructor(y,c,A){let l,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new L,this._outlinepoints=new L,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=w,this._name=y,this._scene=A||o.c.LastCreatedScene,l=c instanceof I.j?c.getPoints():c,this._addToepoint(l),this._points.add(l),this._outlinepoints.add(l),"undefined"===typeof this.bjsEarcut&&W.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(y){this._points.add(y);const c=new L;return c.add(y),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(y),this}build(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const l=new N.b(this._name,this._scene),w=this.buildVertexData(c,A);return l.Uy(h.e.PositionKind,w.zy,y),l.Uy(h.e.NormalKind,w.Sy,y),l.Uy(h.e.UVKind,w.ky,y),l.setIndices(w.indices),l}buildVertexData(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=new p.b,l=[],w=[],N=[],W=this._points.computeBounds();for(const p of this._points.elements)l.push(0,1,0),w.push(p.x,0,p.y),N.push((p.x-W.min.x)/W.width,(p.y-W.min.y)/W.height);const h=[],I=this.bjsEarcut(this._epoints,this._eholes,2);for(let p=0;p<I.length;p++)h.push(I[p]);if(y>0){const A=w.length/3;for(const c of this._points.elements)l.push(0,-1,0),w.push(c.x,-y,c.y),N.push(1-(c.x-W.min.x)/W.width,1-(c.y-W.min.y)/W.height);const p=h.length;for(let y=0;y<p;y+=3){const c=h[y+0],l=h[y+1],w=h[y+2];h.push(w+A),h.push(l+A),h.push(c+A)}this._addSide(w,l,N,h,W,this._outlinepoints,y,!1,c);for(const I of this._holes)this._addSide(w,l,N,h,W,I,y,!0,c)}return A.indices=h,A.zy=w,A.Sy=l,A.ky=N,A}_addSide(y,c,A,w,N,p,W,h,I){let o=y.length/3,O=0;for(let L=0;L<p.elements.length;L++){const i=p.elements[L],H=p.elements[(L+1)%p.elements.length];y.push(i.x,0,i.y),y.push(i.x,-W,i.y),y.push(H.x,0,H.y),y.push(H.x,-W,H.y);const P=p.elements[(L+p.elements.length-1)%p.elements.length],D=p.elements[(L+2)%p.elements.length];let t=new l.gc(-(H.y-i.y),0,H.x-i.x),s=new l.gc(-(i.y-P.y),0,i.x-P.x),B=new l.gc(-(D.y-H.y),0,D.x-H.x);h||(t=t.scale(-1),s=s.scale(-1),B=B.scale(-1));const X=t.normalizeToNew();let C=s.normalizeToNew(),K=B.normalizeToNew();const my=l.gc.Dot(C,X);C=my>I?my<q.b-1?new l.gc(i.x,0,i.y).xc(new l.gc(H.x,0,H.y)).normalize():s.add(t).normalize():X;const T=l.gc.Dot(B,t);K=T>I?T<q.b-1?new l.gc(H.x,0,H.y).xc(new l.gc(i.x,0,i.y)).normalize():B.add(t).normalize():X,A.push(O/N.width,0),A.push(O/N.width,1),O+=t.length(),A.push(O/N.width,0),A.push(O/N.width,1),c.push(C.x,C.y,C.z),c.push(C.x,C.y,C.z),c.push(K.x,K.y,K.z),c.push(K.x,K.y,K.z),h?(w.push(o),w.push(o+2),w.push(o+1),w.push(o+1),w.push(o+2),w.push(o+3)):(w.push(o),w.push(o+1),w.push(o+2),w.push(o+1),w.push(o+3),w.push(o+2)),o+=4}}}var H=A(12386);function P(y,c,A,N,W,I,q){const o=A||new Array(3),O=N,L=[],i=q||!1;for(let p=0;p<3;p++)void 0===o[p]&&(o[p]=new l.Vector4(0,0,1,1)),O&&void 0===O[p]&&(O[p]=new w.ip(1,1,1,1));const P=y.getVerticesData(h.e.PositionKind),D=y.getVerticesData(h.e.NormalKind),t=y.getVerticesData(h.e.UVKind),s=y.rc(),B=P.length/9;let X=0,C=0,K=0,my=0,T=0;const z=[0];if(i)for(let l=B;l<P.length/3;l+=4)C=P[3*(l+2)]-P[3*l],K=P[3*(l+2)+2]-P[3*l+2],my=Math.sqrt(C*C+K*K),T+=my,z.push(T);let S=0,M=0;for(let l=0;l<D.length;l+=3)Math.abs(D[l+1])<.001&&(M=1),Math.abs(D[l+1]-1)<.001&&(M=0),Math.abs(D[l+1]+1)<.001&&(M=2),S=l/3,1===M?(X=S-B,t[2*S]=X%4<1.5?i?o[M].x+(o[M].z-o[M].x)*z[Math.floor(X/4)]/T:o[M].x:i?o[M].x+(o[M].z-o[M].x)*z[Math.floor(X/4)+1]/T:o[M].z,t[2*S+1]=X%2===0?H.b?1-o[M].w:o[M].w:H.b?1-o[M].y:o[M].y):(t[2*S]=(1-t[2*S])*o[M].x+t[2*S]*o[M].z,t[2*S+1]=(1-t[2*S+1])*o[M].y+t[2*S+1]*o[M].w,H.b&&(t[2*S+1]=1-t[2*S+1])),O&&L.push(O[M].r,O[M].g,O[M].b,O[M].a);p.b._ComputeSides(c,P,s,D,t,W,I);const k=new p.b;if(k.indices=s,k.zy=P,k.Sy=D,k.ky=t,O){const y=c===p.b.DOUBLESIDE?L.concat(L):L;k.My=y}return k}function D(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;c.sideOrientation=N.b._GetDefaultSideOrientation(c.sideOrientation);const p=c.shape,W=c.holes||[],h=c.depth||0,I=c.smoothingThreshold||2,q=[];let O=[];for(let N=0;N<p.length;N++)q[N]=new l.Vector2(p[N].x,p[N].z);q[0].equalsWithEpsilon(q[q.length-1],1e-8)&&q.pop();const L=new i(y,q,A||o.c.LastCreatedScene,w);for(let N=0;N<W.length;N++){O=[];for(let y=0;y<W[N].length;y++)O.push(new l.Vector2(W[N][y].x,W[N][y].z));L.addHole(O)}const H=L.build(!1,h,I);H._originalBuilderSideOrientation=c.sideOrientation;return P(H,c.sideOrientation,c.faceUV,c.faceColors,c.frontUVs,c.backUVs,c.wrap).Gy(H,c.updatable),H}function t(y,c){return D(y,c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}p.b.CreatePolygon=P,N.b.CreatePolygon=function(y,c,A,l,w,N){return D(y,{shape:c,holes:l,updatable:w,sideOrientation:N},A,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},N.b.ExtrudePolygon=function(y,c,A,l,w,N,p){return t(y,{shape:c,holes:w,depth:A,updatable:N,sideOrientation:p},l,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},12876:(y,c,A)=>{A.d(c,{c:()=>q,g:()=>o});var l=A(12529),w=A(12325),N=A(12773),p=A(12737),W=A(12881);class h{constructor(y){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=y}moveTo(y,c){this._currentPath=new l.j(y,c),this._tempPaths.push(this._currentPath)}lineTo(y,c){this._currentPath.addLineTo(y,c)}quadraticCurveTo(y,c,A,l){this._currentPath.addQuadraticCurveTo(y,c,A,l,this._resolution)}bezierCurveTo(y,c,A,l,w,N){this._currentPath.addBezierCurveTo(y,c,A,l,w,N,this._resolution)}extractHoles(){for(const y of this._tempPaths)y.area()>0?this._holes.push(y):this._paths.push(y);if(!this._paths.length&&this._holes.length){const y=this._holes;this._holes=this._paths,this._paths=y}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function I(y,c,A,l,w,N){const p=N.glyphs[y]||N.glyphs["?"];if(!p)return null;const W=new h(w);if(p.o){const y=p.o.split(" ");for(let w=0,N=y.length;w<N;){switch(y[w++]){case"m":{const N=parseInt(y[w++])*c+A,p=parseInt(y[w++])*c+l;W.moveTo(N,p);break}case"l":{const N=parseInt(y[w++])*c+A,p=parseInt(y[w++])*c+l;W.lineTo(N,p);break}case"q":{const N=parseInt(y[w++])*c+A,p=parseInt(y[w++])*c+l,h=parseInt(y[w++])*c+A,I=parseInt(y[w++])*c+l;W.quadraticCurveTo(h,I,N,p);break}case"b":{const N=parseInt(y[w++])*c+A,p=parseInt(y[w++])*c+l,h=parseInt(y[w++])*c+A,I=parseInt(y[w++])*c+l,q=parseInt(y[w++])*c+A,o=parseInt(y[w++])*c+l;W.bezierCurveTo(h,I,q,o,N,p);break}}}}return W.extractHoles(),{offsetX:p.ha*c,shapePath:W}}function q(y,c,A,l){const w=Array.from(y),N=c/l.resolution,p=(l.boundingBox.yMax-l.boundingBox.yMin+l.underlineThickness)*N,W=[];let h=0,q=0;for(let o=0;o<w.length;o++){const y=w[o];if("\n"===y)h=0,q-=p;else{const c=I(y,N,h,q,A,l);c&&(h+=c.offsetX,W.push(c.shapePath))}}return W}function o(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const o=q(c,l.size||50,l.resolution||8,A),O=[];let L=0;for(const p of o){if(!p.paths.length)continue;const c=p.holes.slice();for(const A of p.paths){var i,H;const p=[],q=[],o=A.getPoints();for(const y of o)q.push(new w.gc(y.x,0,y.y));const P=c.slice();for(const y of P){const l=y.getPoints();let N=!1;for(const y of l)if(A.isPointInside(y)){N=!0;break}if(!N)continue;const W=[];for(const y of l)W.push(new w.gc(y.x,0,y.y));p.push(W),c.splice(c.indexOf(y),1)}if(!p.length&&c.length)for(const y of c){const c=y.getPoints(),A=[];for(const y of c)A.push(new w.gc(y.x,0,y.y));p.push(A)}const D=(0,W.g)(y,{shape:q,holes:p.length?p:void 0,depth:l.depth||1,faceUV:l.faceUV||(null===(i=l.perLetterFaceUV)||void 0===i?void 0:i.call(l,L)),faceColors:l.faceColors||(null===(H=l.perLetterFaceColors)||void 0===H?void 0:H.call(l,L)),sideOrientation:N.b._GetDefaultSideOrientation(l.sideOrientation||N.b.DOUBLESIDE)},h,I);O.push(D),L++}}const P=N.b.MergeMeshes(O,!0,!0);if(P){const c=P.getBoundingInfo().boundingBox;P.position.x+=-(c.minimumWorld.x+c.maximumWorld.x)/2,P.position.y+=-(c.minimumWorld.y+c.maximumWorld.y)/2,P.position.z+=-(c.minimumWorld.z+c.maximumWorld.z)/2+c.extendSize.z,P.name=y;const A=new p.d("pivot",h);A.rotation.x=-Math.PI/2,P.parent=A,P.bakeCurrentTransformIntoVertices(),P.parent=null,A.dispose()}return P}},12887:(y,c,A)=>{A.d(c,{b:()=>h,e:()=>p,f:()=>W});var l=A(12144),w=A(12894),N=A(12901);function p(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function W(y){return!!(y.wasmUrl&&(y.wasmBinary||y.wasmBinaryUrl)&&"object"===typeof WebAssembly||y.fallbackUrl)}class h{constructor(y){if(y.workerPool)return void(this._workerPoolPromise=Promise.resolve(y.workerPool));const c=y.wasmBinary,A=y.numWorkers??p(),W=A&&"function"===typeof Worker&&"function"===typeof URL,h=W||!y.jsModule,I=y.wasmUrl&&y.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:h?l.Tools.GetBabylonScriptURL(y.wasmUrl,!0):"",wasmBinaryPromise:c?Promise.resolve(c):l.Tools.LoadFileAsync(l.Tools.GetBabylonScriptURL(y.wasmBinaryUrl,!0))}:{url:h?l.Tools.GetBabylonScriptURL(y.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};W?this._workerPoolPromise=I.wasmBinaryPromise.then((y=>{const c=this._getWorkerContent(),l=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));return new w.b(A,(()=>{const c=new Worker(l);return(0,N.m)(c,y,I.url)}))})):this._modulePromise=I.wasmBinaryPromise.then((async c=>{if(!this._isModuleAvailable()&&!y.jsModule){if(!I.url)throw new Error("Draco codec module is not available");await l.Tools.LoadBabylonScriptAsync(I.url)}return await this._createModuleAsync(c,y.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((y=>{y.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},12901:(y,c,A)=>{function l(y,c,A,l){const w=y;let N=null,p=null,W=null,h=null;const I={},q=c.find((y=>"POSITION"===y.dracoName));if(!q)throw new Error("Position attribute is required for Draco encoding");if(!A){const y=q.data.length/q.size;A=new(y>65535?Uint32Array:Uint16Array)(y);for(let c=0;c<y;c++)A[c]=c}try{N=new w.Encoder,p=new w.MeshBuilder,W=new w.Mesh,p.AddFacesToMesh(W,A.length/3,A);const y=new Map([[Float32Array,(y,c,A,l,w,N)=>y.AddFloatAttribute(c,A,l,w,N)],[Uint32Array,(y,c,A,l,w,N)=>y.AddUInt32Attribute(c,A,l,w,N)],[Uint16Array,(y,c,A,l,w,N)=>y.AddUInt16Attribute(c,A,l,w,N)],[Uint8Array,(y,c,A,l,w,N)=>y.AddUInt8Attribute(c,A,l,w,N)],[Int32Array,(y,c,A,l,w,N)=>y.AddInt32Attribute(c,A,l,w,N)],[Int16Array,(y,c,A,l,w,N)=>y.AddInt16Attribute(c,A,l,w,N)],[Int8Array,(y,c,A,l,w,N)=>y.AddInt8Attribute(c,A,l,w,N)]]);for(const A of c){A.data instanceof Uint8ClampedArray&&(A.data=new Uint8Array(A.data));const c=y.get(A.data.constructor),h=A.data.length/A.size;I[A.kind]=c(p,W,w[A.dracoName],h,A.size,A.data),l.quantizationBits&&l.quantizationBits[A.dracoName]&&N.SetAttributeQuantization(w[A.dracoName],l.quantizationBits[A.dracoName])}l.method&&N.SetEncodingMethod(w[l.method]),void 0!==l.encodeSpeed&&void 0!==l.decodeSpeed&&N.SetSpeedOptions(l.encodeSpeed,l.decodeSpeed),h=new w.DracoInt8Array;const q=N.EncodeMeshToDracoBuffer(W,h);if(q<=0)throw new Error("Draco encoding failed.");const o=new Int8Array(q);for(let c=0;c<q;c++)o[c]=h.GetValue(c);return{data:o,attributeIds:I}}finally{W&&w.destroy(W),p&&w.destroy(p),N&&w.destroy(N),h&&w.destroy(h)}}function w(){let y;onmessage=c=>{const A=c.data;switch(A.id){case"init":{A.url&&importScripts(A.url);const c=A.wasmBinary?{wasmBinary:A.wasmBinary}:{};y=DracoEncoderModule(c),postMessage({id:"initDone"});break}case"encodeMesh":if(!y)throw new Error("Draco encoder module is not available");y.then((y=>{const c=l(y,A.attributes,A.indices,A.options);postMessage({id:"encodeMeshDone",encodedMeshData:c},c?[c.data.buffer]:void 0)}))}}}function N(y,c,A,l,w){const N=y;let p=null,W=null,h=null;try{let y;p=new N.Decoder,W=new N.DecoderBuffer,W.Init(c,c.byteLength);const I=p.GetEncodedGeometryType(W);switch(I){case N.TRIANGULAR_MESH:{const c=new N.Mesh;if(y=p.DecodeBufferToMesh(W,c),!y.ok()||0===c.ptr)throw new Error(y.error_msg());const A=3*c.num_faces(),w=4*A,I=N._malloc(w);try{p.GetTrianglesUInt32Array(c,w,I);const y=new Uint32Array(A);y.set(new Uint32Array(N.HEAPF32.buffer,I,A)),l(y)}finally{N._free(I)}h=c;break}case N.POINT_CLOUD:{const c=new N.PointCloud;if(y=p.DecodeBufferToPointCloud(W,c),!y.ok()||!c.ptr)throw new Error(y.error_msg());h=c;break}default:throw new Error(`Invalid geometry type ${I}`)}const q=h.num_points(),o=(y,c,A,l)=>{const p=l.data_type(),W=l.num_components(),h=l.normalized(),I=l.byte_stride(),o=l.byte_offset(),O={[N.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:N.HEAPF32},[N.DT_INT8]:{typedArrayConstructor:Int8Array,heap:N.HEAP8},[N.DT_INT16]:{typedArrayConstructor:Int16Array,heap:N.HEAP16},[N.DT_INT32]:{typedArrayConstructor:Int32Array,heap:N.HEAP32},[N.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:N.HEAPU8},[N.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:N.HEAPU16},[N.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:N.HEAPU32}}[p];if(!O)throw new Error(`Invalid data type ${p}`);const L=q*W,i=L*O.typedArrayConstructor.BYTES_PER_ELEMENT,H=N._malloc(i);try{y.GetAttributeDataArrayForAllPoints(c,l,p,i,H);const N=new O.typedArrayConstructor(O.heap.buffer,H,L);w(A,N.slice(),W,o,I,h)}finally{N._free(H)}};if(A)for(const c in A){const y=A[c],l=p.GetAttributeByUniqueId(h,y);o(p,h,c,l)}else{const y={position:N.POSITION,normal:N.NORMAL,color:N.COLOR,uv:N.TEX_COORD};for(const c in y){const A=p.GetAttributeId(h,y[c]);if(-1!==A){const y=p.GetAttribute(h,A);o(p,h,c,y)}}}return q}finally{h&&N.destroy(h),W&&N.destroy(W),p&&N.destroy(p)}}function p(){let y;onmessage=c=>{const A=c.data;switch(A.id){case"init":{A.url&&importScripts(A.url);const c=A.wasmBinary?{wasmBinary:A.wasmBinary}:{};y=DracoDecoderModule(c),postMessage({id:"initDone"});break}case"decodeMesh":if(!y)throw new Error("Draco decoder module is not available");y.then((y=>{const c=N(y,A.dataView,A.attributes,(y=>{postMessage({id:"indices",data:y},[y.buffer])}),((y,c,A,l,w,N)=>{postMessage({id:"attribute",kind:y,data:c,size:A,byteOffset:l,byteStride:w,normalized:N},[c.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:c})}))}}}async function W(y,c,A){return await new Promise(((l,w)=>{const N=c=>{y.removeEventListener("error",N),y.removeEventListener("message",p),w(c)},p=c=>{"initDone"===c.data.id&&(y.removeEventListener("error",N),y.removeEventListener("message",p),l(y))};if(y.addEventListener("error",N),y.addEventListener("message",p),c){const l=c.slice(0);y.postMessage({id:"init",url:A,wasmBinary:l},[l])}else y.postMessage({id:"init",url:A})}))}A.d(c,{e:()=>N,h:()=>p,j:()=>l,l:()=>w,m:()=>W})},12752:(y,c,A)=>{A.d(c,{c:()=>K});var l=A(12307),w=A(12153),N=A(12325),p=A(12400),W=A(12758),h=A(12737),I=A(12577),q=A(12654),o=A(12570);class O{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new N.gc(0,0,0),this._diffPositionForCollisions=new N.gc(0,0,0),this._collisionResponse=!0}}var L=A(12178),i=A(12676),H=A(12375),P=A(12330),D=A(12521),t=A(12283),s=A(12310),B=A(12220);class X{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=N.gc.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class C{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new X,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new O,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class K extends h.d{static get BILLBOARDMODE_NONE(){return h.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return h.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return h.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return h.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return h.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return h.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(y){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=y}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(y){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=y}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(y){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=y}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(y){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=y}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(y){this._internalAbstractMeshDataInfo._collisionRetryCount=y}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(y){this._internalAbstractMeshDataInfo._morphTargetManager!==y&&(this._internalAbstractMeshDataInfo._morphTargetManager=y,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(y){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==y&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=y,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(y){return!!super._updateNonUniformScalingState(y)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(y){this._internalAbstractMeshDataInfo._rawBoundingInfo=y}set FL(y){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(y)}set onCollisionPositionChange(y){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(y)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(y){if(this._internalAbstractMeshDataInfo._visibility===y)return;const c=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=y,(1===c&&1!==y||1!==c&&1===y)&&this._markSubMeshesAsDirty((y=>{y.markAsMiscDirty(),y.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(y){this._internalAbstractMeshDataInfo._inheritVisibility=y}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let y=this._parentNode;for(;y;){const c=y.isVisible;if("undefined"!==typeof c)return c;y=y.parent}}return this._isVisible}set isVisible(y){this._isVisible=y}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(y){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=y}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(y){this._internalAbstractMeshDataInfo._renderingGroupId=y}get material(){return this._internalAbstractMeshDataInfo._material}set material(y){this._setMaterial(y)}_setMaterial(y){this._internalAbstractMeshDataInfo._material!==y&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=y,y&&y.meshMap&&(y.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.jc&&(this.resetDrawCache(void 0,null==y),this._unBindEffect()))}getMaterialForRenderPass(y){var c;return null===(c=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===c?void 0:c[y]}setMaterialForRenderPass(y,c){var A;this.resetDrawCache(y),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const l=this._internalAbstractMeshDataInfo._materialForRenderPass[y];null!==l&&void 0!==l&&null!==(A=l.meshMap)&&void 0!==A&&A[this.uniqueId]&&(l.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[y]=c,c&&c.meshMap&&(c.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(y){this._internalAbstractMeshDataInfo._receiveShadows!==y&&(this._internalAbstractMeshDataInfo._receiveShadows=y,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(y){this._internalAbstractMeshDataInfo._hasVertexAlpha!==y&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=y,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(y){this._internalAbstractMeshDataInfo._useVertexColors!==y&&(this._internalAbstractMeshDataInfo._useVertexColors=y,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(y){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==y&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=y,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(y){this._internalAbstractMeshDataInfo._numBoneInfluencers!==y&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=y,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(y){this._internalAbstractMeshDataInfo._applyFog!==y&&(this._internalAbstractMeshDataInfo._applyFog=y,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(y){this._internalAbstractMeshDataInfo._enableDistantPicking=y}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(y){y!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=y,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(y)?-1:y}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=y}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(y){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(y)?-1:y}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(y){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=y}get lightSources(){return this._lightSources}set skeleton(y){const c=this._internalAbstractMeshDataInfo._skeleton;c&&c.needInitialSkinMatrix&&c._unregisterMeshWithPoseMatrix(this),y&&y.needInitialSkinMatrix&&y._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=y,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(y){var c;let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(y,A,!1),c=this,this._internalAbstractMeshDataInfo=new C,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.ro=K.no,this.onCollideObservable=new w.d,this.onCollisionPositionChangeObservable=new w.d,this.onMaterialChangedObservable=new w.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.HI=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=H.dc.Red(),this.outlineWidth=.02,this.overlayColor=H.dc.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Hq=!1,this.jy=!1,this.actionManager=null,this.ellipsoid=new N.gc(.5,1,.5),this.ellipsoidOffset=new N.gc(0,0,0),this.edgesWidth=1,this.edgesColor=new H.ip(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,xW:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new w.d,this._onCollisionPositionChange=function(y,A){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A.subtractToRef(c._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>B.b.CollisionsEpsilon&&c.position.addInPlace(c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),l&&c.onCollideObservable.notifyObservers(l),c.onCollisionPositionChangeObservable.notifyObservers(c.position)},A=this.mc(),A.Gq(this),this._resyncLightSources(),this._uniformBuffer=new o.c(this.mc().getEngine(),void 0,void 0,y,!this.mc().getEngine().isWebGPU),this._buildUniformLayout(),A.performancePriority){case 2:this.jy=!0;case 1:this.Hq=!0,this.HI=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(y){const c=this._uniformBuffer;c.Qc("world",y),c.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),c.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(y){let c="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");c+=", # of submeshes: "+(this.jc?this.jc.length:0);const A=this._internalAbstractMeshDataInfo._skeleton;return A&&(c+=", skeleton: "+A.name),y&&(c+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],c+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.xW?"YES":"NO")),c}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==h.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(c||this.actionManager.isRecursive)){if(!y)return this.actionManager;if(this.actionManager.hasSpecificTrigger(y))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(y,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.jc){for(const y of this.jc)y._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const y of this.mc().lights)y.isEnabled()&&y.canAffectMesh(this)&&this._lightSources.push(y);this._markSubMeshesAsLightDirty()}_resyncLightSource(y){const c=y.isEnabled()&&y.canAffectMesh(this),A=this._lightSources.indexOf(y);let l=!1;if(-1===A){if(!c)return;this._lightSources.push(y)}else{if(c)return;l=!0,this._lightSources.splice(A,1)}this._markSubMeshesAsLightDirty(l)}_unBindEffect(){for(const y of this.jc)y.setEffect(null)}_removeLightSource(y,c){const A=this._lightSources.indexOf(y);-1!==A&&(this._lightSources.splice(A,1),this._markSubMeshesAsLightDirty(c))}_markSubMeshesAsDirty(y){if(this.jc)for(const c of this.jc)for(let A=0;A<c._drawWrappers.length;++A){const l=c._drawWrappers[A];l&&l.defines&&l.defines.markAllAsDirty&&y(l.defines)}}_markSubMeshesAsLightDirty(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((c=>c.markAsLightDirty(y)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((y=>y.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((y=>y.markAsMiscDirty()))}Bq(y){return this._currentRenderId=Number.MAX_VALUE,super.Bq(y),this._isDirty=!0,this}resetDrawCache(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.jc)for(const A of this.jc)A.resetDrawCache(y,c)}get isBlocked(){return!1}getLOD(y){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}rc(){return null}getVerticesData(y){return null}Uy(y,c,A,l){return this}updateVerticesData(y,c,A,l){return this}setIndices(y,c){return this}isVerticesDataPresent(y){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Vy()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(y){return this._boundingInfo=y,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(y,c,A){return this._boundingInfo=new q.d(y,c,A),this._boundingInfo}normalizeToUnitCube(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(y,c,A)}get useBones(){return this.skeleton&&this.mc().skeletonsEnabled&&this.isVerticesDataPresent(p.e.MatricesIndicesKind)&&this.isVerticesDataPresent(p.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(y){}_activate(y,c){return this._renderId=y,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===h.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(y,c,A){return this.position.addInPlace(this.calcMovePOV(y,c,A)),this}calcMovePOV(y,c,A){const l=new N.Matrix;(this.rotationQuaternion?this.rotationQuaternion:N.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(l);const w=N.gc.Zero(),p=this.definedFacingForward?-1:1;return N.gc.TransformCoordinatesFromFloatsToRef(y*p,c,A*p,l,w),w}rotatePOV(y,c,A){return this.rotation.addInPlace(this.calcRotatePOV(y,c,A)),this}calcRotatePOV(y,c,A){const l=this.definedFacingForward?1:-1;return new N.gc(y*l,c,A*l)}Jy(y,c){if(y){const A=(0,i.f)(y,0,this.getTotalVertices(),c);this._boundingInfo?this._boundingInfo.reConstruct(A.minimum,A.maximum):this._boundingInfo=new q.d(A.minimum,A.maximum)}if(this.jc)for(let A=0;A<this.jc.length;A++)this.jc[A].refreshBoundingInfo(y);this.Vy()}_refreshBoundingInfoDirect(y){if(this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new q.d(y.minimum,y.maximum),this.jc)for(let c=0;c<this.jc.length;c++)this.jc[c].refreshBoundingInfo(null);this.Vy()}static _ApplySkeleton(y,c,A,l,w,W,h){!function(y,c,A,l,w,W,h){const I=N.TmpVectors.gc[0],q=N.TmpVectors.Matrix[0],o=N.TmpVectors.Matrix[1],O=c===p.e.NormalKind?N.gc.TransformNormalFromFloatsToRef:N.gc.TransformCoordinatesFromFloatsToRef;for(let p=0,L=0;p<y.length;p+=3,L+=4){let c,i;for(q.reset(),c=0;c<4;c++)i=w[L+c],i>0&&(N.Matrix.FromFloat32ArrayToRefScaled(A,Math.floor(16*l[L+c]),i,o),q.addToSelf(o));if(W&&h)for(c=0;c<4;c++)i=h[L+c],i>0&&(N.Matrix.FromFloat32ArrayToRefScaled(A,Math.floor(16*W[L+c]),i,o),q.addToSelf(o));O(y[p],y[p+1],y[p+2],q,I),I.toArray(y,p)}}(y,c,A,l,w,W,h)}_getData(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.e.PositionKind;const l=y.cache,w=y=>{if(l){const c=l._vertexData||(l._vertexData={});return c[y]||this.copyVerticesData(y,c),c[y]}return this.getVerticesData(y)};if(c||(c=w(A)),!c)return null;if(l?(l._outputData?l._outputData.set(c):l._outputData=new Float32Array(c),c=l._outputData):(y.applyMorph&&this.morphTargetManager||y.applySkeleton&&this.skeleton)&&(c=c.slice()),y.applyMorph&&this.morphTargetManager&&function(y,c,A){let l=null;switch(c){case p.e.PositionKind:l=y=>y.getPositions();break;case p.e.NormalKind:l=y=>y.getNormals();break;case p.e.TangentKind:l=y=>y.getTangents();break;case p.e.UVKind:l=y=>y.getUVs();break;case p.e.UV2Kind:l=y=>y.getUV2s();break;case p.e.ColorKind:l=y=>y.getColors();break;default:return}for(let w=0;w<y.length;w++){let c=y[w];for(let N=0;N<A.numTargets;N++){const p=A.getTarget(N),W=p.influence;if(0!==W){const A=l(p);A&&(c+=(A[w]-y[w])*W)}}y[w]=c}}(c,A,this.morphTargetManager),y.applySkeleton&&this.skeleton){const y=w(p.e.MatricesIndicesKind),l=w(p.e.MatricesWeightsKind);if(l&&y){const N=this.numBoneInfluencers>4,W=N?w(p.e.MatricesIndicesExtraKind):null,h=N?w(p.e.MatricesWeightsExtraKind):null,I=this.skeleton.getTransformMatrices(this);K._ApplySkeleton(c,A,I,y,l,W,h)}}if(!1!==y.updatePositionsArray&&A===p.e.PositionKind){const y=this._internalAbstractMeshDataInfo._positions||[],A=y.length;if(y.length=c.length/3,A<y.length)for(let c=A;c<y.length;c++)y[c]=new N.gc;for(let l=0,w=0;l<y.length;l++,w+=3)y[l].Ec(c[w],c[w+1],c[w+2]);this._internalAbstractMeshDataInfo._positions=y}return c}getNormalsData(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:y,applyMorph:c,updatePositionsArray:!1},null,p.e.NormalKind)}rW(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:y,applyMorph:c,updatePositionsArray:!1},A,p.e.PositionKind)}Vy(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new q.d(N.gc.Zero(),N.gc.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(y){if(!this.jc)return this;const c=this.jc.length;for(let A=0;A<c;A++){const l=this.jc[A];(c>1||!l.IsGlobal)&&l.updateBoundingInfo(y)}return this}_afterComputeWorldMatrix(){this.jy||(this._boundingInfoIsDirty=!0)}isInFrustum(y){return this.getBoundingInfo().isInFrustum(y,this.ro)}isCompletelyInFrustum(y){return this.getBoundingInfo().isCompletelyInFrustum(y)}intersectsMesh(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;const l=this.getBoundingInfo(),w=y.getBoundingInfo();if(l.intersects(w,c))return!0;if(A)for(const N of this.getChildMeshes())if(N.intersectsMesh(y,c,!0))return!0;return!1}intersectsPoint(y){return this.getBoundingInfo().intersectsPoint(y)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(y){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=y}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const A=this.mc().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=A.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,A.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,y,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,c),this}_collideForSubMesh(y,c,A){var l;if(this._generatePointsArray(),!this._positions)return this;if(!y._lastColliderWorldVertices||!y._lastColliderTransformMatrix.equals(c)){y._lastColliderTransformMatrix=c.clone(),y._lastColliderWorldVertices=[],y._trianglePlanes=[];const A=y.verticesStart,l=y.verticesStart+y.verticesCount;for(let w=A;w<l;w++)y._lastColliderWorldVertices.push(N.gc.TransformCoordinates(this._positions[w],c))}return A._collide(y._trianglePlanes,y._lastColliderWorldVertices,this.rc(),y.indexStart,y.indexStart+y.indexCount,y.verticesStart,!!y.ey(),this,this._shouldConvertRHS(),7===(null===(l=y.ey())||void 0===l?void 0:l.fillMode)),this}_processCollisionsForSubMeshes(y,c){const A=this._scene.getCollidingSubMeshCandidates(this,y),l=A.length;for(let w=0;w<l;w++){const N=A.data[w];l>1&&!N._checkCollision(y)||this._collideForSubMesh(N,c,y)}return this}_shouldConvertRHS(){return!1}_checkCollision(y){if(!this.getBoundingInfo()._checkCollision(y))return this;const c=N.TmpVectors.Matrix[0],A=N.TmpVectors.Matrix[1];return N.Matrix.ScalingToRef(1/y._radius.x,1/y._radius.y,1/y._radius.z,c),this.worldMatrixFromCache.multiplyToRef(c,A),this._processCollisionsForSubMeshes(y,A),this}_generatePointsArray(){return!1}intersects(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const W=new I.c,h=this.getClassName(),q="InstancedLinesMesh"===h||"LinesMesh"===h||"GreasedLineMesh"===h?this.intersectionThreshold:0,o=this.getBoundingInfo();if(!this.jc)return W;if(!p&&(!y.intersectsSphere(o.boundingSphere,q)||!y.intersectsBox(o.boundingBox,q)))return W;if(l)return W.hit=!p,W.pickedMesh=p?null:this,W.distance=p?0:N.gc.Distance(y.origin,o.boundingSphere.center),W.subMeshId=0,W;if(!this._generatePointsArray())return W;let O=null;const L=this._scene.getIntersectingSubMeshCandidates(this,y),i=L.length;let H=!1;for(let N=0;N<i;N++){const y=L.data[N].ey();if(y&&(7==y.fillMode||0==y.fillMode||1==y.fillMode||2==y.fillMode||4==y.fillMode)){H=!0;break}}if(!H)return W.hit=!0,W.pickedMesh=this,W.distance=N.gc.Distance(y.origin,o.boundingSphere.center),W.subMeshId=-1,W;for(let N=0;N<i;N++){const l=L.data[N];if(i>1&&!p&&!l.canIntersects(y))continue;const w=l.intersects(y,this._positions,this.rc(),c,A);if(w&&(c||!O||w.distance<O.distance)&&(O=w,O.subMeshId=N,c))break}if(O){const c=w??this.getWorldMatrix(),A=N.TmpVectors.gc[0],l=N.TmpVectors.gc[1];N.gc.TransformCoordinatesToRef(y.origin,c,A),y.direction.scaleToRef(O.distance,l);const p=N.gc.TransformNormal(l,c).addInPlace(A);return W.hit=!0,W.distance=N.gc.Distance(A,p),W.pickedPoint=p,W.pickedMesh=this,W.bu=O.bu||0,W.bv=O.bv||0,W.subMeshFaceId=O.faceId,W.faceId=O.faceId+L.data[O.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),W.subMeshId=O.subMeshId,W}return W}clone(y,c,A){return null}releaseSubMeshes(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.jc)for(;this.jc.length;)this.jc[0].dispose(y);else this.jc=[];return this}dispose(y){let c,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=this.mc();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),l.freeActiveMeshes(),l.freeRenderingGroups(),l.renderingManager.maintainStateBetweenFrames&&l.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((y=>y!==this&&y.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),c=0;c<this._intersectionsInProgress.length;c++){const y=this._intersectionsInProgress[c],A=y._intersectionsInProgress.indexOf(this);y._intersectionsInProgress.splice(A,1)}this._intersectionsInProgress.length=0;const w=l.lights;for(const p of w){let y=p.includedOnlyMeshes.indexOf(this);-1!==y&&p.includedOnlyMeshes.splice(y,1),y=p.excludedMeshes.indexOf(this),-1!==y&&p.excludedMeshes.splice(y,1);const c=p.getShadowGenerators();if(c){const A=c.values();for(let c=A.next();!0!==c.done;c=A.next()){const A=c.value.getShadowMap();A&&A.renderList&&(y=A.renderList.indexOf(this),-1!==y&&A.renderList.splice(y,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const N=l.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,N.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),N.wipeCaches(),l.uq(this),this._parentContainer){const y=this._parentContainer.meshes.indexOf(this);y>-1&&this._parentContainer.meshes.splice(y,1),this._parentContainer=null}if(A&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!y)for(c=0;c<l.MO.length;c++)l.MO[c].Ic===this&&(l.MO[c].dispose(),c--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(y,A)}_initFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;y.facetNormals||(y.facetNormals=[]),y.facetPositions||(y.facetPositions=[]),y.facetPartitioning||(y.facetPartitioning=new Array),y.facetNb=this.rc().length/3|0,y.partitioningSubdivisions=y.partitioningSubdivisions?y.partitioningSubdivisions:10,y.partitioningBBoxRatio=y.partitioningBBoxRatio?y.partitioningBBoxRatio:1.01;for(let c=0;c<y.facetNb;c++)y.facetNormals[c]=N.gc.Zero(),y.facetPositions[c]=N.gc.Zero();return y.facetDataEnabled=!0,this}updateFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;y.facetDataEnabled||this._initFacetData();const c=this.getVerticesData(p.e.PositionKind),A=this.rc(),l=this.getVerticesData(p.e.NormalKind),w=this.getBoundingInfo();if(y.facetDepthSort&&!y.facetDepthSortEnabled){if(y.facetDepthSortEnabled=!0,A instanceof Uint16Array)y.depthSortedIndices=new Uint16Array(A);else if(A instanceof Uint32Array)y.depthSortedIndices=new Uint32Array(A);else{let c=!1;for(let y=0;y<A.length;y++)if(A[y]>65535){c=!0;break}y.depthSortedIndices=c?new Uint32Array(A):new Uint16Array(A)}if(y.facetDepthSortFunction=function(y,c){return c.sqDistance-y.sqDistance},!y.facetDepthSortFrom){const c=this.mc().activeCamera;y.facetDepthSortFrom=c?c.position:N.gc.Zero()}y.depthSortedFacets=[];for(let c=0;c<y.facetNb;c++){const A={ind:3*c,sqDistance:0};y.depthSortedFacets.push(A)}y.invertedMatrix=N.Matrix.Identity(),y.facetDepthSortOrigin=N.gc.Zero()}y.bbSize.x=w.maximum.x-w.minimum.x>P.b?w.maximum.x-w.minimum.x:P.b,y.bbSize.y=w.maximum.y-w.minimum.y>P.b?w.maximum.y-w.minimum.y:P.b,y.bbSize.z=w.maximum.z-w.minimum.z>P.b?w.maximum.z-w.minimum.z:P.b;let h=y.bbSize.x>y.bbSize.y?y.bbSize.x:y.bbSize.y;if(h=h>y.bbSize.z?h:y.bbSize.z,y.subDiv.max=y.partitioningSubdivisions,y.subDiv.X=Math.floor(y.subDiv.max*y.bbSize.x/h),y.subDiv.Y=Math.floor(y.subDiv.max*y.bbSize.y/h),y.subDiv.Z=Math.floor(y.subDiv.max*y.bbSize.z/h),y.subDiv.X=y.subDiv.X<1?1:y.subDiv.X,y.subDiv.Y=y.subDiv.Y<1?1:y.subDiv.Y,y.subDiv.Z=y.subDiv.Z<1?1:y.subDiv.Z,y.facetParameters.facetNormals=this.getFacetLocalNormals(),y.facetParameters.facetPositions=this.getFacetLocalPositions(),y.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),y.facetParameters.bInfo=w,y.facetParameters.bbSize=y.bbSize,y.facetParameters.subDiv=y.subDiv,y.facetParameters.ratio=this.partitioningBBoxRatio,y.facetParameters.depthSort=y.facetDepthSort,y.facetDepthSort&&y.facetDepthSortEnabled&&(this.Yc(!0),this._worldMatrix.invertToRef(y.invertedMatrix),N.gc.TransformCoordinatesToRef(y.facetDepthSortFrom,y.invertedMatrix,y.facetDepthSortOrigin),y.facetParameters.distanceTo=y.facetDepthSortOrigin),y.facetParameters.depthSortedFacets=y.depthSortedFacets,l&&W.b.ComputeNormals(c,A,l,y.facetParameters),y.facetDepthSort&&y.facetDepthSortEnabled){y.depthSortedFacets.sort(y.facetDepthSortFunction);const c=y.depthSortedIndices.length/3|0;for(let l=0;l<c;l++){const c=y.depthSortedFacets[l].ind;y.depthSortedIndices[3*l]=A[c],y.depthSortedIndices[3*l+1]=A[c+1],y.depthSortedIndices[3*l+2]=A[c+2]}this.updateIndices(y.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetNormals||this.updateFacetData(),y.facetNormals}getFacetLocalPositions(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetPositions||this.updateFacetData(),y.facetPositions}getFacetLocalPartitioning(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetPartitioning||this.updateFacetData(),y.facetPartitioning}getFacetPosition(y){const c=N.gc.Zero();return this.getFacetPositionToRef(y,c),c}getFacetPositionToRef(y,c){const A=this.getFacetLocalPositions()[y],l=this.getWorldMatrix();return N.gc.TransformCoordinatesToRef(A,l,c),this}getFacetNormal(y){const c=N.gc.Zero();return this.getFacetNormalToRef(y,c),c}getFacetNormalToRef(y,c){const A=this.getFacetLocalNormals()[y];return N.gc.TransformNormalToRef(A,this.getWorldMatrix(),c),this}getFacetsAtLocalCoordinates(y,c,A){const l=this.getBoundingInfo(),w=this._internalAbstractMeshDataInfo._facetData,N=Math.floor((y-l.minimum.x*w.partitioningBBoxRatio)*w.subDiv.X*w.partitioningBBoxRatio/w.bbSize.x),p=Math.floor((c-l.minimum.y*w.partitioningBBoxRatio)*w.subDiv.Y*w.partitioningBBoxRatio/w.bbSize.y),W=Math.floor((A-l.minimum.z*w.partitioningBBoxRatio)*w.subDiv.Z*w.partitioningBBoxRatio/w.bbSize.z);return N<0||N>w.subDiv.max||p<0||p>w.subDiv.max||W<0||W>w.subDiv.max?null:w.facetPartitioning[N+w.subDiv.max*p+w.subDiv.max*w.subDiv.max*W]}getClosestFacetAtCoordinates(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const W=this.getWorldMatrix(),h=N.TmpVectors.Matrix[5];W.invertToRef(h);const I=N.TmpVectors.gc[8];N.gc.TransformCoordinatesFromFloatsToRef(y,c,A,h,I);const q=this.getClosestFacetAtLocalCoordinates(I.x,I.y,I.z,l,w,p);return l&&N.gc.TransformCoordinatesFromFloatsToRef(l.x,l.y,l.z,W,l),q}getClosestFacetAtLocalCoordinates(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],N=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=null,W=0,h=0,I=0,q=0,o=0,O=0,L=0,i=0;const H=this.getFacetLocalPositions(),P=this.getFacetLocalNormals(),D=this.getFacetsAtLocalCoordinates(y,c,A);if(!D)return null;let t,s,B,X=Number.MAX_VALUE,C=X;for(let K=0;K<D.length;K++)t=D[K],s=P[t],B=H[t],q=(y-B.x)*s.x+(c-B.y)*s.y+(A-B.z)*s.z,(!w||w&&N&&q>=0||w&&!N&&q<=0)&&(q=s.x*B.x+s.y*B.y+s.z*B.z,o=-(s.x*y+s.y*c+s.z*A-q)/(s.x*s.x+s.y*s.y+s.z*s.z),O=y+s.x*o,L=c+s.y*o,i=A+s.z*o,W=O-y,h=L-c,I=i-A,C=W*W+h*h+I*I,C<X&&(X=C,p=t,l&&(l.x=O,l.y=L,l.z=i)));return p}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const y=this._internalAbstractMeshDataInfo._facetData;return y.facetDataEnabled&&(y.facetDataEnabled=!1,y.facetPositions=[],y.facetNormals=[],y.facetPartitioning=new Array,y.facetParameters={},y.depthSortedIndices=new Uint32Array(0)),this}updateIndices(y,c){return this}createNormals(y){const c=this.getVerticesData(p.e.PositionKind),A=this.rc();let l;return l=this.isVerticesDataPresent(p.e.NormalKind)?this.getVerticesData(p.e.NormalKind):[],W.b.ComputeNormals(c,A,l,{useRightHandedSystem:this.mc().useRightHandedSystem}),this.Uy(p.e.NormalKind,l,y),this}async optimizeIndicesAsync(){const y=this.rc();if(!y)return this;const{OptimizeIndices:c}=await A.e(70).then(A.bind(A,15309));return c(y),this.setIndices(y,this.getTotalVertices()),this}alignWithNormal(y,c){c||(c=D.c.Y);const A=N.TmpVectors.gc[0],l=N.TmpVectors.gc[1];return N.gc.CrossToRef(c,y,l),N.gc.CrossToRef(y,l,A),this.rotationQuaternion?N.Quaternion.RotationQuaternionFromAxisToRef(A,y,l,this.rotationQuaternion):N.gc.RotationFromAxisToRef(A,y,l,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,L.d)("EdgesRenderer")}enableEdgesRendering(y,c,A){throw(0,L.d)("EdgesRenderer")}kO(){return this._scene.MO.filter((y=>y.Ic===this))}}K.OCCLUSION_TYPE_NONE=0,K.OCCLUSION_TYPE_OPTIMISTIC=1,K.OCCLUSION_TYPE_STRICT=2,K.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,K.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,K.CULLINGSTRATEGY_STANDARD=0,K.no=1,K.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,K.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,l.b)([s.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l,w,N,p,W]=c;return!Array.isArray(l)&&!Array.isArray(w)&&!Array.isArray(N)&&!Array.isArray(p)&&!Array.isArray(W)}))],K,"_ApplySkeleton",null),(0,t.f)("BABYLON.AbstractMesh",K)},12904:(y,c,A)=>{A.d(c,{e:()=>l.e});var l=A(12400)},12783:(y,c,A)=>{A.d(c,{e:()=>P});var l=A(12325),w=A(12375),N=A(12758),p=A(12400),W=A(12640),h=A(12788),I=A(12654),q=A(12144),o=A(12368),O=A(12676),L=A(12184),i=A(12386),H=A(12410);class P{get boundingBias(){return this._boundingBias}set boundingBias(y){this._boundingBias?this._boundingBias.p(y):this._boundingBias=y.clone(),this.Vy(!0,null)}static CreateGeometryForMesh(y){const c=new P(P.RandomId(),y.mc());return c.Gy(y),c}get meshes(){return this._meshes}constructor(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new l.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new l.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=c||L.c.LastCreatedScene,this._scene&&(this.id=y,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=w,A?this.setAllVerticesData(A,w):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),N&&(this.Gy(N),N.Yc(!0)))}get extend(){return this._extend}mc(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let y=0;y<this._meshes.length;y++)if(!this._meshes[y].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const y=new Set;for(const c in this._vertexBuffers)y.add(this._vertexBuffers[c].getWrapperBuffer());y.forEach((y=>{y._rebuild()}))}setAllVerticesData(y,c){y.applyToGeometry(this,c),this._notifyUpdate()}Uy(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;A&&Array.isArray(c)&&(c=new Float32Array(c));const w=new p.e(this._engine,c,y,{updatable:A,postponeInternalCreation:0===this._meshes.length,stride:l,label:"Geometry_"+this.id+"_"+y});this.setVerticesBuffer(w)}removeVerticesData(y){this._vertexBuffers[y]&&(this._vertexBuffers[y].dispose(),delete this._vertexBuffers[y]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=y.getKind();this._vertexBuffers[w]&&A&&this._vertexBuffers[w].dispose(),y._buffer&&y._buffer._increaseReferences(),this._vertexBuffers[w]=y;const N=this._meshes,W=N.length;if(w===p.e.PositionKind){this._totalVertices=c??y._maxVerticesCount,this._updateExtend(y.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const A=this._extend&&this._extend.minimum||new l.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),w=this._extend&&this._extend.maximum||new l.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let y=0;y<W;y++){const c=N[y];c.buildBoundingInfo(A,w),c._createGlobalSubMesh(c.isUnIndexed),c.Yc(!0),c.synchronizeInstances()}}this._notifyUpdate(w)}updateVerticesDataDirectly(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=this.getVertexBuffer(y);w&&(w.updateDirectly(c,A,l),this._notifyUpdate(y))}updateVerticesData(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=this.getVertexBuffer(y);l&&(l.update(c),y===p.e.PositionKind&&this.Vy(A,c),this._notifyUpdate(y))}Vy(y,c){if(y&&this._updateExtend(c),this._resetPointsArrayCache(),y){const y=this._meshes;for(const c of y){c.hasBoundingInfo?c.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):c.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const y=c.jc;for(const c of y)c.refreshBoundingInfo()}}}_bind(y,c,A,l){if(!y)return;void 0===c&&(c=this._indexBuffer);const w=this.getVertexBuffers();if(!w)return;if(c!=this._indexBuffer||!this._vertexArrayObjects&&!l)return void this._engine.bindBuffers(w,c,y,A);const N=l||this._vertexArrayObjects,p=this._engine;N[y.key]||(N[y.key]=p.recordVertexArrayObject(w,c,y,A)),p.bindVertexArrayObject(N[y.key],c)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(y,c,A){const l=this.getVertexBuffer(y);return l?l.getFloatData(this._totalVertices,A||c&&1!==this._meshes.length):null}copyVerticesData(y,c){const A=this.getVertexBuffer(y);if(!A)return;c[y]||(c[y]=new Float32Array(this._totalVertices*A.getSize()));const l=A.getData();l&&(0,H.i)(l,A.getSize(),A.type,A.byteOffset,A.byteStride,A.normalized,this._totalVertices,c[y])}isVertexBufferUpdatable(y){const c=this._vertexBuffers[y];return!!c&&c.isUpdatable()}getVertexBuffer(y){return this.isReady()?this._vertexBuffers[y]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(y){return this._vertexBuffers?void 0!==this._vertexBuffers[y]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(y)}getVerticesDataKinds(){const y=[];let c;if(!this._vertexBuffers&&this._delayInfo)for(c in this._delayInfo)y.push(c);else for(c in this._vertexBuffers)y.push(c);return y}updateIndices(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const l=y.length!==this._indices.length;if(A||(this._indices=y.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,y,c),l)for(const y of this._meshes)y._createGlobalSubMesh(!0)}else this.setIndices(y,null,!0)}setIndexBuffer(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=y,this._totalVertices=c,this._totalIndices=A,y.is32Bits=null===l?c>65535:l;for(const w of this._meshes)w._createGlobalSubMesh(!0),w.synchronizeInstances();this._notifyUpdate()}setIndices(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=y,this._indexBufferIsUpdatable=A,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,A,"Geometry_"+this.id+"_IndexBuffer")),void 0!=c&&(this._totalVertices=c);for(const w of this._meshes)w._createGlobalSubMesh(!l),w.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}rc(y,c){if(!this.isReady())return null;const A=this._indices;return c||y&&1!==this._meshes.length?A.slice():A}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y&&this._vertexArrayObjects&&this._vertexArrayObjects[y.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[y.key]),delete this._vertexArrayObjects[y.key])}releaseForMesh(y,c){const A=this._meshes,l=A.indexOf(y);-1!==l&&(A.splice(l,1),this._vertexArrayObjects&&y._invalidateInstanceVertexArrayObject(),y._geometry=null,0===A.length&&c&&this.dispose())}Gy(y){if(y._geometry===this)return;const c=y._geometry;c&&c.releaseForMesh(y),this._vertexArrayObjects&&y._invalidateInstanceVertexArrayObject();const A=this._meshes;y._geometry=this,y._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),A.push(y),this.isReady()?this._applyToMesh(y):this._boundingInfo&&y.setBoundingInfo(this._boundingInfo)}_updateExtend(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!y&&(y=this.getVerticesData(p.e.PositionKind),!y))return;this._extend=(0,O.f)(y,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(y){const c=this._meshes.length;for(const A in this._vertexBuffers)1===c&&this._vertexBuffers[A].create(),A===p.e.PositionKind&&(this._extend||this._updateExtend(),y.buildBoundingInfo(this._extend.minimum,this._extend.maximum),y._createGlobalSubMesh(y.isUnIndexed),y.Vy());1===c&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),y._syncGeometryWithMorphTargetManager(),y.synchronizeInstances()}_notifyUpdate(y){this.onGeometryUpdated&&this.onGeometryUpdated(this,y),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const c of this._meshes)c._markSubMeshesAsAttributesDirty()}load(y,c){2!==this.delayLoadState&&(this.isReady()?c&&c():(this.delayLoadState=2,this._queueLoad(y,c)))}_queueLoad(y,c){this.delayLoadingFile&&(y.addPendingData(this),y._loadFile(this.delayLoadingFile,(A=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(A),this),this.delayLoadState=1,this._delayInfo=[],y.removePendingData(this);const l=this._meshes,w=l.length;for(let y=0;y<w;y++)this._applyToMesh(l[y]);c&&c()}),void 0,!0))}toLeftHanded(){const y=this.rc(!1);if(null!=y&&y.length>0){for(let c=0;c<y.length;c+=3){const A=y[c+0];y[c+0]=y[c+2],y[c+2]=A}this.setIndices(y)}const c=this.getVerticesData(p.e.PositionKind,!1);if(null!=c&&c.length>0){for(let y=0;y<c.length;y+=3)c[y+2]=-c[y+2];this.Uy(p.e.PositionKind,c,!1)}const A=this.getVerticesData(p.e.NormalKind,!1);if(null!=A&&A.length>0){for(let y=0;y<A.length;y+=3)A[y+2]=-A[y+2];this.Uy(p.e.NormalKind,A,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const y=this.getVerticesData(p.e.PositionKind);if(!y||0===y.length)return!1;for(let c=3*this._positionsCache.length,A=this._positionsCache.length;c<y.length;c+=3,++A)this._positionsCache[A]=l.gc.yA(y,c);for(let c=0,A=0;c<y.length;c+=3,++A)this._positionsCache[A].set(y[0+c],y[1+c],y[2+c]);return this._positionsCache.length=y.length/3,this._positions=this._positionsCache,!0}I(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const A in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[A]);this._vertexArrayObjects={};const y=this._meshes,c=y.length;for(let A=0;A<c;A++)y[A]._invalidateInstanceVertexArrayObject()}}dispose(){const y=this._meshes,c=y.length;let A;for(A=0;A<c;A++)this.releaseForMesh(y[A]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const l in this._vertexBuffers)this._vertexBuffers[l].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const y=this._parentContainer.geometries.indexOf(this);y>-1&&this._parentContainer.geometries.splice(y,1),this._parentContainer=null}this._isDisposed=!0}j(y){const c=new N.b;c.indices=[];const A=this.rc();if(A)for(let N=0;N<A.length;N++)c.indices.push(A[N]);let l,w=!1,p=!1;for(l in this._vertexBuffers){const y=this.getVerticesData(l);if(y&&(y instanceof Float32Array?c.set(new Float32Array(y),l):c.set(y.slice(0),l),!p)){const y=this.getVertexBuffer(l);y&&(w=y.isUpdatable(),p=!w)}}const W=new P(y,this._scene,c,w);for(l in W.delayLoadState=this.delayLoadState,W.delayLoadingFile=this.delayLoadingFile,W._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)W._delayInfo=W._delayInfo||[],W._delayInfo.push(l);return W._boundingInfo=new I.d(this._extend.minimum,this._extend.maximum),W}serialize(){const y={};return y.id=this.id,y.uniqueId=this.uniqueId,y.updatable=this._updatable,o.c&&o.c.HasTags(this)&&(y.tags=o.c.GetTags(this)),y}_toNumberArray(y){return Array.isArray(y)?y:Array.prototype.slice.call(y)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const y in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,y)&&(this._vertexBuffers[y]._buffer._data=null)}serializeVerticeData(){const y=this.serialize();return this.isVerticesDataPresent(p.e.PositionKind)&&(y.zy=this._toNumberArray(this.getVerticesData(p.e.PositionKind)),this.isVertexBufferUpdatable(p.e.PositionKind)&&(y.positionsUpdatable=!0)),this.isVerticesDataPresent(p.e.NormalKind)&&(y.Sy=this._toNumberArray(this.getVerticesData(p.e.NormalKind)),this.isVertexBufferUpdatable(p.e.NormalKind)&&(y.normalsUpdatable=!0)),this.isVerticesDataPresent(p.e.TangentKind)&&(y.tangents=this._toNumberArray(this.getVerticesData(p.e.TangentKind)),this.isVertexBufferUpdatable(p.e.TangentKind)&&(y.tangentsUpdatable=!0)),this.isVerticesDataPresent(p.e.UVKind)&&(y.ky=this._toNumberArray(this.getVerticesData(p.e.UVKind)),this.isVertexBufferUpdatable(p.e.UVKind)&&(y.uvsUpdatable=!0)),this.isVerticesDataPresent(p.e.UV2Kind)&&(y.uvs2=this._toNumberArray(this.getVerticesData(p.e.UV2Kind)),this.isVertexBufferUpdatable(p.e.UV2Kind)&&(y.uvs2Updatable=!0)),this.isVerticesDataPresent(p.e.UV3Kind)&&(y.uvs3=this._toNumberArray(this.getVerticesData(p.e.UV3Kind)),this.isVertexBufferUpdatable(p.e.UV3Kind)&&(y.uvs3Updatable=!0)),this.isVerticesDataPresent(p.e.UV4Kind)&&(y.uvs4=this._toNumberArray(this.getVerticesData(p.e.UV4Kind)),this.isVertexBufferUpdatable(p.e.UV4Kind)&&(y.uvs4Updatable=!0)),this.isVerticesDataPresent(p.e.UV5Kind)&&(y.uvs5=this._toNumberArray(this.getVerticesData(p.e.UV5Kind)),this.isVertexBufferUpdatable(p.e.UV5Kind)&&(y.uvs5Updatable=!0)),this.isVerticesDataPresent(p.e.UV6Kind)&&(y.uvs6=this._toNumberArray(this.getVerticesData(p.e.UV6Kind)),this.isVertexBufferUpdatable(p.e.UV6Kind)&&(y.uvs6Updatable=!0)),this.isVerticesDataPresent(p.e.ColorKind)&&(y.My=this._toNumberArray(this.getVerticesData(p.e.ColorKind)),this.isVertexBufferUpdatable(p.e.ColorKind)&&(y.colorsUpdatable=!0)),this.isVerticesDataPresent(p.e.MatricesIndicesKind)&&(y.matricesIndices=this._toNumberArray(this.getVerticesData(p.e.MatricesIndicesKind)),y.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(p.e.MatricesIndicesKind)&&(y.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(p.e.MatricesWeightsKind)&&(y.matricesWeights=this._toNumberArray(this.getVerticesData(p.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(p.e.MatricesWeightsKind)&&(y.matricesWeightsUpdatable=!0)),y.indices=this._toNumberArray(this.rc()),y}static ExtractFromMesh(y,c){const A=y._geometry;return A?A.j(c):null}static RandomId(){return q.Tools.RandomId()}static _GetGeometryByLoadedUniqueId(y,c){for(let A=0;A<c.geometries.length;A++)if(c.geometries[A]._loadedUniqueId===y)return c.geometries[A];return null}static _ImportGeometry(y,c){const A=c.mc(),l=y.geometryUniqueId,N=y.geometryId;if(l||N){const y=l?this._GetGeometryByLoadedUniqueId(l,A):A.getGeometryById(N);y&&y.Gy(c)}else if(y instanceof ArrayBuffer){const A=c._binaryInfo;if(A.positionsAttrDesc&&A.positionsAttrDesc.count>0){const l=new Float32Array(y,A.positionsAttrDesc.offset,A.positionsAttrDesc.count);c.Uy(p.e.PositionKind,l,!1)}if(A.normalsAttrDesc&&A.normalsAttrDesc.count>0){const l=new Float32Array(y,A.normalsAttrDesc.offset,A.normalsAttrDesc.count);c.Uy(p.e.NormalKind,l,!1)}if(A.tangetsAttrDesc&&A.tangetsAttrDesc.count>0){const l=new Float32Array(y,A.tangetsAttrDesc.offset,A.tangetsAttrDesc.count);c.Uy(p.e.TangentKind,l,!1)}if(A.uvsAttrDesc&&A.uvsAttrDesc.count>0){const l=new Float32Array(y,A.uvsAttrDesc.offset,A.uvsAttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UVKind,l,!1)}if(A.uvs2AttrDesc&&A.uvs2AttrDesc.count>0){const l=new Float32Array(y,A.uvs2AttrDesc.offset,A.uvs2AttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UV2Kind,l,!1)}if(A.uvs3AttrDesc&&A.uvs3AttrDesc.count>0){const l=new Float32Array(y,A.uvs3AttrDesc.offset,A.uvs3AttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UV3Kind,l,!1)}if(A.uvs4AttrDesc&&A.uvs4AttrDesc.count>0){const l=new Float32Array(y,A.uvs4AttrDesc.offset,A.uvs4AttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UV4Kind,l,!1)}if(A.uvs5AttrDesc&&A.uvs5AttrDesc.count>0){const l=new Float32Array(y,A.uvs5AttrDesc.offset,A.uvs5AttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UV5Kind,l,!1)}if(A.uvs6AttrDesc&&A.uvs6AttrDesc.count>0){const l=new Float32Array(y,A.uvs6AttrDesc.offset,A.uvs6AttrDesc.count);if(i.b)for(let y=1;y<l.length;y+=2)l[y]=1-l[y];c.Uy(p.e.UV6Kind,l,!1)}if(A.colorsAttrDesc&&A.colorsAttrDesc.count>0){const l=new Float32Array(y,A.colorsAttrDesc.offset,A.colorsAttrDesc.count);c.Uy(p.e.ColorKind,l,!1,A.colorsAttrDesc.stride)}if(A.matricesIndicesAttrDesc&&A.matricesIndicesAttrDesc.count>0){const l=new Int32Array(y,A.matricesIndicesAttrDesc.offset,A.matricesIndicesAttrDesc.count),w=[];for(let y=0;y<l.length;y++){const c=l[y];w.push(255&c),w.push((65280&c)>>8),w.push((16711680&c)>>16),w.push(c>>24&255)}c.Uy(p.e.MatricesIndicesKind,w,!1)}if(A.matricesIndicesExtraAttrDesc&&A.matricesIndicesExtraAttrDesc.count>0){const l=new Int32Array(y,A.matricesIndicesExtraAttrDesc.offset,A.matricesIndicesExtraAttrDesc.count),w=[];for(let y=0;y<l.length;y++){const c=l[y];w.push(255&c),w.push((65280&c)>>8),w.push((16711680&c)>>16),w.push(c>>24&255)}c.Uy(p.e.MatricesIndicesExtraKind,w,!1)}if(A.matricesWeightsAttrDesc&&A.matricesWeightsAttrDesc.count>0){const l=new Float32Array(y,A.matricesWeightsAttrDesc.offset,A.matricesWeightsAttrDesc.count);c.Uy(p.e.MatricesWeightsKind,l,!1)}if(A.indicesAttrDesc&&A.indicesAttrDesc.count>0){const l=new Int32Array(y,A.indicesAttrDesc.offset,A.indicesAttrDesc.count);c.setIndices(l,null)}if(A.subMeshesAttrDesc&&A.subMeshesAttrDesc.count>0){const l=new Int32Array(y,A.subMeshesAttrDesc.offset,5*A.subMeshesAttrDesc.count);c.jc=[];for(let y=0;y<A.subMeshesAttrDesc.count;y++){const A=l[5*y+0],w=l[5*y+1],N=l[5*y+2],p=l[5*y+3],h=l[5*y+4];W.c.AddToMesh(A,w,N,p,h,c)}}}else if(y.zy&&y.Sy&&y.indices){if(c.Uy(p.e.PositionKind,y.zy,y.zy._updatable||y.positionsUpdatable),c.Uy(p.e.NormalKind,y.Sy,y.Sy._updatable||y.normalsUpdatable),y.tangents&&c.Uy(p.e.TangentKind,y.tangents,y.tangents._updatable||y.tangentsUpdatable),y.ky&&c.Uy(p.e.UVKind,y.ky,y.ky._updatable||y.uvsUpdatable),y.uvs2&&c.Uy(p.e.UV2Kind,y.uvs2,y.uvs2._updatable||y.uvs2Updatable),y.uvs3&&c.Uy(p.e.UV3Kind,y.uvs3,y.uvs3._updatable||y.uvs3Updatable),y.uvs4&&c.Uy(p.e.UV4Kind,y.uvs4,y.uvs4._updatable||y.uvs4Updatable),y.uvs5&&c.Uy(p.e.UV5Kind,y.uvs5,y.uvs5._updatable||y.uvs5Updatable),y.uvs6&&c.Uy(p.e.UV6Kind,y.uvs6,y.uvs6._updatable||y.uvs6Updatable),y.My&&c.Uy(p.e.ColorKind,w.ip.CheckColors4(y.My,y.zy.length/3),y.My._updatable),y.matricesIndices)if(y.matricesIndices._isExpanded||y.matricesIndicesExpanded)delete y.matricesIndices._isExpanded,delete y.matricesIndicesExpanded,c.Uy(p.e.MatricesIndicesKind,y.matricesIndices,y.matricesIndices._updatable||y.matricesIndicesUpdatable);else{const A=[];for(let c=0;c<y.matricesIndices.length;c++){const l=y.matricesIndices[c];A.push(255&l),A.push((65280&l)>>8),A.push((16711680&l)>>16),A.push(l>>24&255)}c.Uy(p.e.MatricesIndicesKind,A,y.matricesIndices._updatable||y.matricesIndicesUpdatable)}if(y.matricesIndicesExtra)if(y.matricesIndicesExtraExpanded||y.matricesIndicesExtra._isExpanded)delete y.matricesIndices._isExpanded,delete y.matricesIndicesExtraExpanded,c.Uy(p.e.MatricesIndicesExtraKind,y.matricesIndicesExtra,y.matricesIndicesExtra._updatable||y.matricesIndicesExtraUpdatable);else{const A=[];for(let c=0;c<y.matricesIndicesExtra.length;c++){const l=y.matricesIndicesExtra[c];A.push(255&l),A.push((65280&l)>>8),A.push((16711680&l)>>16),A.push(l>>24&255)}c.Uy(p.e.MatricesIndicesExtraKind,A,y.matricesIndicesExtra._updatable||y.matricesIndicesExtraUpdatable)}y.matricesWeights&&(P._CleanMatricesWeights(y,c),c.Uy(p.e.MatricesWeightsKind,y.matricesWeights,y.matricesWeights._updatable)),y.matricesWeightsExtra&&c.Uy(p.e.MatricesWeightsExtraKind,y.matricesWeightsExtra,y.matricesWeights._updatable),c.setIndices(y.indices,null)}if(y.jc){c.jc=[];for(let A=0;A<y.jc.length;A++){const l=y.jc[A];W.c.AddToMesh(l.materialIndex,l.verticesStart,l.verticesCount,l.indexStart,l.indexCount,c)}}c._shouldGenerateFlatShading&&(c.convertToFlatShadedMesh(),c._shouldGenerateFlatShading=!1),c.Yc(!0),A.onMeshImportedObservable.notifyObservers(c)}static _CleanMatricesWeights(y,c){const A=.001;if(!h.e.CleanBoneMatrixWeights)return;let l=0;if(!(y.skeletonId>-1))return;{const A=c.mc().getLastSkeletonById(y.skeletonId);if(!A)return;l=A.bones.length}const w=c.getVerticesData(p.e.MatricesIndicesKind),N=c.getVerticesData(p.e.MatricesIndicesExtraKind),W=y.matricesWeights,I=y.matricesWeightsExtra,q=y.numBoneInfluencer,o=W.length;for(let p=0;p<o;p+=4){let y=0,c=-1;for(let l=0;l<4;l++){const w=W[p+l];y+=w,w<A&&c<0&&(c=l)}if(I)for(let l=0;l<4;l++){const w=I[p+l];y+=w,w<A&&c<0&&(c=l+4)}if((c<0||c>q-1)&&(c=q-1),y>A){const c=1/y;for(let y=0;y<4;y++)W[p+y]*=c;if(I)for(let y=0;y<4;y++)I[p+y]*=c}else c>=4?(I[p+c-4]=1-y,N[p+c-4]=l):(W[p+c]=1-y,w[p+c]=l)}c.Uy(p.e.MatricesIndicesKind,w),y.matricesWeightsExtra&&c.Uy(p.e.MatricesIndicesExtraKind,N)}static Parse(y,c,A){const w=new P(y.id,c,void 0,y.updatable);return w._loadedUniqueId=y.uniqueId,o.c&&o.c.AddTagsTo(w,y.tags),y.delayLoadingFile?(w.delayLoadState=4,w.delayLoadingFile=A+y.delayLoadingFile,w._boundingInfo=new I.d(l.gc.yA(y.boundingBoxMinimum),l.gc.yA(y.boundingBoxMaximum)),w._delayInfo=[],y.hasUVs&&w._delayInfo.push(p.e.UVKind),y.hasUVs2&&w._delayInfo.push(p.e.UV2Kind),y.hasUVs3&&w._delayInfo.push(p.e.UV3Kind),y.hasUVs4&&w._delayInfo.push(p.e.UV4Kind),y.hasUVs5&&w._delayInfo.push(p.e.UV5Kind),y.hasUVs6&&w._delayInfo.push(p.e.UV6Kind),y.hasColors&&w._delayInfo.push(p.e.ColorKind),y.hasMatricesIndices&&w._delayInfo.push(p.e.MatricesIndicesKind),y.hasMatricesWeights&&w._delayInfo.push(p.e.MatricesWeightsKind),w._delayLoadingFunction=N.b.ImportVertexData):N.b.ImportVertexData(y,w),c.pushGeometry(w,!0),w}}},12767:(y,c,A)=>{A.d(c,{b:()=>O});var l=A(12325),w=A(12161),N=A(12752),p=A(12773),W=A(12167),h=A(12737),I=A(12400),q=A(12144),o=A(12283);p.b._instancedMeshFactory=(y,c)=>{const A=new O(y,c);if(c.instancedBuffers){A.instancedBuffers={};for(const y in c.instancedBuffers)A.instancedBuffers[y]=c.instancedBuffers[y]}return A};class O extends N.c{constructor(y,c){super(y,c.mc()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,c.FO(this),this._sourceMesh=c,this._unIndexed=c._unIndexed,this.position.p(c.position),this.rotation.p(c.rotation),this.bc.p(c.bc),c.rotationQuaternion&&(this.rotationQuaternion=c.rotationQuaternion.clone()),this.animations=c.animations.slice();for(const A of c.getAnimationRanges())null!=A&&this.createAnimationRange(A.name,A.from,A.to);if(this.infiniteDistance=c.infiniteDistance,this.setPivotMatrix(c.getPivotMatrix()),c.skeleton||c.morphTargetManager||!c.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const y=c.getBoundingInfo();this.buildBoundingInfo(y.minimum,y.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(y){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.receiveShadows)!==y&&q.Tools.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(y){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.material)!==y&&q.Tools.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(y){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.visibility)!==y&&q.Tools.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(y){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.skeleton)!==y&&q.Tools.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(y){this._sourceMesh&&y!==this._sourceMesh.renderingGroupId&&w.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get Rc(){return this._sourceMesh._geometry}createInstance(y){return this._sourceMesh.createInstance(y)}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(y,!0)}getVerticesData(y,c,A){return this._sourceMesh.getVerticesData(y,c,A)}copyVerticesData(y,c){this._sourceMesh.copyVerticesData(y,c)}Uy(y,c,A,l){return this.sourceMesh&&this.sourceMesh.Uy(y,c,A,l),this.sourceMesh}updateVerticesData(y,c,A,l){return this.sourceMesh&&this.sourceMesh.updateVerticesData(y,c,A,l),this.sourceMesh}setIndices(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(y,c),this.sourceMesh}isVerticesDataPresent(y){return this._sourceMesh.isVerticesDataPresent(y)}rc(){return this._sourceMesh.rc()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let y,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;y="object"===typeof c?c:{applySkeleton:c,applyMorph:A};const l=this._sourceMesh.Rc?this._sourceMesh.Rc.boundingBias:null;return this.Jy(this._sourceMesh._getData(y,null,I.e.PositionKind),l),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(y,c){if(super._activate(y,c),this._sourceMesh.jc||w.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,y),c){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==h.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new l.Matrix);const y=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,l.TmpVectors.gc[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Yc(!0)),this._currentLOD.position.p(l.TmpVectors.gc[7]),this._currentLOD._masterMesh=y,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(y){if(!y)return this;const c=this.sourceMesh.getLODLevels();if(c&&0!==c.length){const c=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(y,c.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(y){return this.sourceMesh._preActivateForIntermediateRendering(y)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.jc)for(let y=0;y<this._sourceMesh.jc.length;y++)this._sourceMesh.jc[y].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Vy(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const l=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(y);if(W.e.DeepCopy(this,l,["name","jc","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","SO","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","Rc"],[]),this.refreshBoundingInfo(),c&&(l.parent=c),!A)for(let w=0;w<this.mc().meshes.length;w++){const y=this.mc().meshes[w];y.parent===this&&y.clone(y.name,l)}return l.Yc(!0),this.onClonedObservable.notifyObservers(l),l}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.xO(this),super.dispose(y,c)}_serializeAsParent(y){super._serializeAsParent(y),y.parentId=this._sourceMesh.uniqueId,y.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const l=this.clone("Clone of "+(this.name||this.id),y||this.parent,!0,c&&c.newSourcedMesh);l&&A&&A(this,l);for(const w of this.getChildTransformNodes(!0))w.instantiateHierarchy(l,c,A);return l}}p.b.prototype.registerInstancedBuffer=function(y,c){var A,l;if(null===(A=this._userInstancedBuffersStorage)||void 0===A||null===(l=A.vertexBuffers[y])||void 0===l||l.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const y of this.instances)y.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[y]=null,this._userInstancedBuffersStorage.strides[y]=c,this._userInstancedBuffersStorage.sizes[y]=32*c,this._userInstancedBuffersStorage.data[y]=new Float32Array(this._userInstancedBuffersStorage.sizes[y]),this._userInstancedBuffersStorage.vertexBuffers[y]=new I.e(this.getEngine(),this._userInstancedBuffersStorage.data[y],y,!0,!1,c,!0);for(const w of this.instances)w.instancedBuffers[y]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},p.b.prototype._processInstancedBuffers=function(y,c){const A=y?y.length:0;for(const l in this.instancedBuffers){let w=this._userInstancedBuffersStorage.sizes[l];const N=this._userInstancedBuffersStorage.strides[l],p=(A+1)*N;for(;w<p;)w*=2;this._userInstancedBuffersStorage.data[l].length!=w&&(this._userInstancedBuffersStorage.data[l]=new Float32Array(w),this._userInstancedBuffersStorage.sizes[l]=w,this._userInstancedBuffersStorage.vertexBuffers[l]&&(this._userInstancedBuffersStorage.vertexBuffers[l].dispose(),this._userInstancedBuffersStorage.vertexBuffers[l]=null));const W=this._userInstancedBuffersStorage.data[l];let h=0;if(c){const y=this.instancedBuffers[l];y.toArray?y.toArray(W,h):y.copyToArray?y.copyToArray(W,h):W[h]=y,h+=N}for(let c=0;c<A;c++){const A=y[c].instancedBuffers[l];A.toArray?A.toArray(W,h):A.copyToArray?A.copyToArray(W,h):W[h]=A,h+=N}this._userInstancedBuffersStorage.vertexBuffers[l]?this._userInstancedBuffersStorage.vertexBuffers[l].updateDirectly(W,0):(this._userInstancedBuffersStorage.vertexBuffers[l]=new I.e(this.getEngine(),this._userInstancedBuffersStorage.data[l],l,!0,!1,N,!0),this._invalidateInstanceVertexArrayObject())}},p.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const y in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[y]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},p.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const y in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[y]&&this._userInstancedBuffersStorage.vertexBuffers[y].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,o.f)("BABYLON.InstancedMesh",O)},12869:(y,c,A)=>{A.d(c,{c:()=>I});var l=A(12375),w=A(12400),N=A(12773),p=A(12767),W=A(12632),h=A(12549);N.b._LinesMeshParser=(y,c)=>I.Parse(y,c);class I extends N.b{_isShaderMaterial(y){return"ShaderMaterial"===y.getClassName()}constructor(y){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,W=arguments.length>7?arguments[7]:void 0;super(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c,arguments.length>4?arguments[4]:void 0),this.useVertexColor=N,this.useVertexAlpha=p,this.color=new l.dc(1,1,1),this.alpha=1,this._shaderLanguage=0,c&&(this.color=c.color.clone(),this.alpha=c.alpha,this.useVertexColor=c.useVertexColor,this.useVertexAlpha=c.useVertexAlpha),this.intersectionThreshold=.1;const q={attributes:[w.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?q.defines.push("#define VERTEXALPHA"):q.needAlphaBlending=!1,this.useVertexColor?(q.defines.push("#define VERTEXCOLOR"),q.attributes.push(w.e.ColorKind)):(q.uniforms.push("color"),this._color4=new l.ip),W)this.material=W;else{this.mc().getEngine().isWebGPU&&!I.ForceGLSL&&(this._shaderLanguage=1),q.shaderLanguage=this._shaderLanguage,q.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([A.e(44).then(A.bind(A,15405)),A.e(40).then(A.bind(A,15407))]):await Promise.all([A.e(38).then(A.bind(A,15414)),A.e(37).then(A.bind(A,15416))])},this.material=new h.ShaderMaterial("colorShader",this.mc(),"color",q,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(y){this._lineMaterial=y,this._lineMaterial.fillMode=W.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(y){}_bind(y,c){if(!this._geometry)return this;const A=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(c,A):this._geometry._bind(c,A,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:y,g:c,b:A}=this.color;this._color4.set(y,c,A,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(y,c,A){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const l=this.mc().getEngine();return this._unIndexed?l.drawArraysType(W.c.LineListDrawMode,y.verticesStart,y.verticesCount,A):l.drawElementsType(W.c.LineListDrawMode,y.indexStart,y.indexCount,A),this}dispose(y){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(y)}clone(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;if(c&&void 0===c._addToSceneRootNodes){const A=c;return A.source=this,new I(y,this.mc(),A.parent,A.source,A.doNotCloneChildren)}return new I(y,this.mc(),c,this,A)}createInstance(y){const c=new q(y,this);if(this.instancedBuffers){c.instancedBuffers={};for(const y in this.instancedBuffers)c.instancedBuffers[y]=this.instancedBuffers[y]}return c}serialize(y){super.serialize(y),y.color=this.color.fc(),y.alpha=this.alpha}static Parse(y,c){const A=new I(y.name,c);return A.color=l.dc.yA(y.color),A.alpha=y.alpha,A}}I.ForceGLSL=!1;class q extends p.b{constructor(y,c){super(y,c),this.intersectionThreshold=c.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},12773:(y,c,A)=>{A.d(c,{b:()=>G,c:()=>z});var l=A(12153),w=A(12144),N=A(12167),p=A(12368),W=A(12765),h=A(12775),I=A(12325),q=A(12375),o=A(12743),O=A(12400),L=A(12758),i=A(12783),H=A(12752),P=A(12640),D=A(12632),t=A(12791),s=A(12788),B=A(12363),X=A(12161),C=A(12283),K=A(12178),my=A(12584);class T{constructor(y,c){this.distanceOrScreenCoverage=y,this.mesh=c}}class z{}class S{constructor(){this.visibleInstances={},this.batchCache=new M,this.batchCacheReplacementModeInFrozenMode=new M,this.instancesBufferSize=2048}}class M{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class k{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class a{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const u={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class G extends H.c{static _GetDefaultSideOrientation(y){return y||G.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(y){this._internalMeshDataInfo._useLODScreenCoverage=y,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(y){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==y&&(y&&this._internalMeshDataInfo._sourcePositions&&(this.Uy(O.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Uy(O.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=y,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new l.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new l.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new l.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new l.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new l.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(y){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(y)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(y){this._internalMeshDataInfo._forcedInstanceCount=y}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(y){this._internalMeshDataInfo._sideOrientation=y,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===y||!this._scene.useRightHandedSystem&&0===y}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(y){this.sideOrientation=y,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(y){this._internalMeshDataInfo._overrideRenderingFillMode=y}get material(){return this._internalAbstractMeshDataInfo._material}set material(y){y&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(y.sideOrientation=null),this._setMaterial(y)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(y){this._unIndexed!==y&&(this._unIndexed=y,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(y){this._instanceDataStorage.manualUpdate=y}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(y){this._instanceDataStorage.previousManualUpdate=y}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(y){this._instanceDataStorage.forceMatrixUpdates=y}_copySource(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=this.mc();if(y._geometry&&y._geometry.Gy(this),N.e.DeepCopy(y,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Rc","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","SO","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=y,w.useClonedMeshMap&&(y._internalMeshDataInfo.meshMap||(y._internalMeshDataInfo.meshMap={}),y._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=y._originalBuilderSideOrientation,this._creationDataStorage=y._creationDataStorage,y._ranges){const c=y._ranges;for(const y in c)Object.prototype.hasOwnProperty.call(c,y)&&c[y]&&this.createAnimationRange(y,c[y].from,c[y].to)}if(y.metadata&&y.metadata.clone?this.metadata=y.metadata.clone():this.metadata=y.metadata,this._internalMetadata=y._internalMetadata,p.c&&p.c.HasTags(y)&&p.c.AddTagsTo(this,p.c.GetTags(y,!0)),this.ph(y.isEnabled(!1)),this.parent=y.parent,this.setPivotMatrix(y.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+y.id,this.material=y.material,!c){const w=y.getDescendants(!0);for(let y=0;y<w.length;y++){const N=w[y];N._isMesh?(u.parent=this,u.doNotCloneChildren=c,u.clonePhysicsImpostor=A,u.cloneThinInstances=l,N.clone(this.name+"."+N.name,u)):N.clone&&N.clone(this.name+"."+N.name,this)}}if(y.morphTargetManager&&(this.morphTargetManager=y.morphTargetManager),w.getPhysicsEngine){const c=w.getPhysicsEngine();if(A&&c)if(1===c.getPluginVersion()){const A=c.getImpostorForPhysicsObject(y);A&&(this.physicsImpostor=A.clone(this))}else 2===c.getPluginVersion()&&y.physicsBody&&y.physicsBody.clone(this)}for(let N=0;N<w.MO.length;N++){const c=w.MO[N];c.Ic===y&&c.clone(c.name,this)}if(this.skeleton=y.skeleton,l&&(y._thinInstanceDataStorage.matrixData?(this.bo("matrix",new Float32Array(y._thinInstanceDataStorage.matrixData),16,!y._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=y._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=y._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=y._thinInstanceDataStorage.matrixBufferSize,y._userThinInstanceBuffersStorage)){const c=y._userThinInstanceBuffersStorage;for(const y in c.data){var W,h;this.bo(y,new Float32Array(c.data[y]),c.strides[y],!(null!==(W=c.vertexBuffers)&&void 0!==W&&null!==(h=W[y])&&void 0!==h&&h.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[y]=c.sizes[y]}}this.refreshBoundingInfo(!0,!0),this.Yc(!0)}constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4?arguments[4]:void 0,p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(y,c),this._internalMeshDataInfo=new a,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new S,this._thinInstanceDataStorage=new k,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=G.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,c=this.mc(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(y,c,A)=>{y&&A&&(this._uniformBuffer?this.transferToEffect(c):A.bindOnlyWorldMatrix(c))};let W=null,h=!1;if(A&&void 0===A._addToSceneRootNodes){const y=A;W=y.parent??null,w=y.source??null,N=y.doNotCloneChildren??!1,p=y.clonePhysicsImpostor??!0,h=y.cloneThinInstances??!1}else W=A;w&&this._copySource(w,N,p,h),null!==W&&(this.parent=W),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=y=>{y.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new l.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),w&&w.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const l=0===this.getTotalVertices()||c&&c.doNotInstantiate&&(!0===c.doNotInstantiate||c.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),y||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));l.parent=y||this.parent,l.position=this.position.clone(),l.bc=this.bc.clone(),this.rotationQuaternion?l.rotationQuaternion=this.rotationQuaternion.clone():l.rotation=this.rotation.clone(),A&&A(this,l);for(const w of this.getChildTransformNodes(!0))"InstancedMesh"===w.getClassName()&&"Mesh"===l.getClassName()&&w.sourceMesh===this?w.instantiateHierarchy(l,{doNotInstantiate:c&&c.doNotInstantiate||!1,newSourcedMesh:l},A):w.instantiateHierarchy(l,c,A);return l}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(y){let c=super.toString(y);if(c+=", n vertices: "+this.getTotalVertices(),c+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let A=0;A<this.animations.length;A++)c+=", animation[0]: "+this.animations[A].toString(y);if(y)if(this._geometry){const y=this.rc(),A=this.getVerticesData(O.e.PositionKind);A&&y&&(c+=", flat shading: "+(A.length/3===y.length?"YES":"NO"))}else c+=", flat shading: UNKNOWN";return c}_unBindEffect(){super._unBindEffect();for(const y of this.instances)y._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const y=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((c,A)=>c.distanceOrScreenCoverage<A.distanceOrScreenCoverage?y:c.distanceOrScreenCoverage>A.distanceOrScreenCoverage?-y:0))}addLODLevel(y,c){if(c&&c._masterMesh)return X.c.Warn("You cannot use a mesh as LOD level twice"),this;const A=new T(y,c);return this._internalMeshDataInfo._LODLevels.push(A),c&&(c._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(y){const c=this._internalMeshDataInfo;for(let A=0;A<c._LODLevels.length;A++){const l=c._LODLevels[A];if(l.distanceOrScreenCoverage===y)return l.mesh}return null}removeLODLevel(y){const c=this._internalMeshDataInfo;for(let A=0;A<c._LODLevels.length;A++)c._LODLevels[A].mesh===y&&(c._LODLevels.splice(A,1),y&&(y._masterMesh=null));return this._sortLODLevels(),this}getLOD(y,c){const A=this._internalMeshDataInfo;if(!A._LODLevels||0===A._LODLevels.length)return this;const l=c||this.getBoundingInfo().boundingSphere,w=y.mode===h.c.ORTHOGRAPHIC_CAMERA?y.ec:l.centerWorld.xc(y.globalPosition).length();let N=w,p=1;if(A._useLODScreenCoverage){const c=y.screenArea;let A=l.radiusWorld*y.ec/w;A=A*A*Math.PI,N=A/c,p=-1}if(p*A._LODLevels[A._LODLevels.length-1].distanceOrScreenCoverage>p*N)return this.onLODLevelSelection&&this.onLODLevelSelection(N,this,this),this;for(let W=0;W<A._LODLevels.length;W++){const y=A._LODLevels[W];if(p*y.distanceOrScreenCoverage<p*N){if(y.mesh){if(4===y.mesh.delayLoadState)return y.mesh._checkDelayState(),this;if(2===y.mesh.delayLoadState)return this;y.mesh._preActivate(),y.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(N,this,y.mesh),y.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(N,this,this),this}get Rc(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(y,c,A,l){var w,N;if(!this._geometry)return null;let p=l||null===(w=this._userInstancedBuffersStorage)||void 0===w||null===(N=w.vertexBuffers[y])||void 0===N?void 0:N.getFloatData(this.instances.length+1,A||c&&1!==this._geometry.meshes.length);return p||(p=this._geometry.getVerticesData(y,c,A)),p}copyVerticesData(y,c){this._geometry&&this._geometry.copyVerticesData(y,c)}getVertexBuffer(y,c){var A;return this._geometry?(c||null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[y])??this._geometry.getVertexBuffer(y):null}isVerticesDataPresent(y,c){var A;return this._geometry?!c&&void 0!==(null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[y])||this._geometry.isVerticesDataPresent(y):!!this._delayInfo&&-1!==this._delayInfo.indexOf(y)}isVertexBufferUpdatable(y,c){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(y);if(!c){var A;const c=null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[y];if(c)return c.isUpdatable()}return this._geometry.isVertexBufferUpdatable(y)}getVerticesDataKinds(y){if(!this._geometry){const y=[];if(this._delayInfo)for(const c of this._delayInfo)y.push(c);return y}const c=this._geometry.getVerticesDataKinds();if(!y&&this._userInstancedBuffersStorage)for(const A in this._userInstancedBuffersStorage.vertexBuffers)-1===c.indexOf(A)&&c.push(A);return c}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}rc(y,c){return this._geometry?this._geometry.rc(y,c):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(y))return!1;if(!this.jc||0===this.jc.length)return!0;if(!y)return!0;const A=this.getEngine(),l=this.mc(),w=c||A.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Yc();const N=this.material||l.defaultMaterial;if(N)if(N._storeEffectOnSubMeshes)for(const O of this.jc){const y=O.ey();if(y)if(y._storeEffectOnSubMeshes){if(!y.isReadyForSubMesh(this,O,w))return!1}else if(!y.isReady(this,w))return!1}else if(!N.isReady(this,w))return!1;const p=A.currentRenderPassId;for(const O of this.lightSources){const y=O.getShadowGenerators();if(!y)continue;const c=y.values();for(let l=c.next();!0!==l.done;l=c.next()){var W,h,I,q;const y=l.value;if(y&&(null===(W=y.getShadowMap())||void 0===W||!W.renderList||null!==(h=y.getShadowMap())&&void 0!==h&&h.renderList&&-1!==(null===(I=y.getShadowMap())||void 0===I||null===(q=I.renderList)||void 0===q?void 0:q.indexOf(this)))){const c=y.getShadowMap().renderPassIds??[A.currentRenderPassId];for(let l=0;l<c.length;++l){A.currentRenderPassId=c[l];for(const c of this.jc){var o;if(!y.isReady(c,w,(null===(o=c.ey())||void 0===o?void 0:o.needAlphaBlendingForMesh(this))??!1))return A.currentRenderPassId=p,!1}}A.currentRenderPassId=p}}}for(const O of this._internalMeshDataInfo._LODLevels)if(O.mesh&&!O.mesh.isReady(w))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}yo(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(y){this._instanceDataStorage.overridenInstanceCount=y}_preActivate(){const y=this._internalMeshDataInfo,c=this.mc().getRenderId();return y._preActivateId===c||(y._preActivateId=c,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(y){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=y),this}_registerInstanceForRenderId(y,c){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:c,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[c]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=c,this._instanceDataStorage.visibleInstances[c]=new Array),this._instanceDataStorage.visibleInstances[c].push(y),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.jy||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let y,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;y="object"===typeof c?c:{applySkeleton:c,applyMorph:A};const l=this.Rc?this.Rc.boundingBias:null;return this.Jy(this._getData(y,null,O.e.PositionKind),l),this}_createGlobalSubMesh(y){const c=this.getTotalVertices();if(!c||!this.rc())return null;if(this.jc&&this.jc.length>0){const A=this.rc();if(!A)return null;const l=A.length;let w=!1;if(y)w=!0;else for(const y of this.jc){if(y.indexStart+y.indexCount>l){w=!0;break}if(y.verticesStart+y.verticesCount>c){w=!0;break}}if(!w)return this.jc[0]}return this.releaseSubMeshes(),new P.c(0,0,c,0,this.getTotalIndices()||c,this)}subdivide(y){if(y<1)return;const c=this.getTotalIndices();let A=c/y|0,l=0;for(;A%3!==0;)A++;this.releaseSubMeshes();for(let w=0;w<y&&!(l>=c);w++)P.c.CreateFromIndices(0,l,w===y-1?c-l:A,this,void 0,!1),l+=A;this.refreshBoundingInfo(),this.synchronizeInstances()}Uy(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Uy(y,c,A,l);else{const l=new L.b;l.set(c,y);const w=this.mc();new i.e(i.e.RandomId(),w,l,A,this)}return this}removeVerticesData(y){this._geometry&&this._geometry.removeVerticesData(y)}markVerticesDataAsUpdatable(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this.getVertexBuffer(y);A&&A.isUpdatable()!==c&&this.Uy(y,this.getVerticesData(y),c)}setVerticesBuffer(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=i.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(y,null,c),this}updateVerticesData(y,c,A,l){return this._geometry?(l?(this.makeGeometryUnique(),this.updateVerticesData(y,c,A,!1)):this._geometry.updateVerticesData(y,c,A),this):this}updateMeshPositions(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this.getVerticesData(O.e.PositionKind);if(!A)return this;if(y(A),this.updateVerticesData(O.e.PositionKind,A,!1,!1),c){const y=this.rc(),c=this.getVerticesData(O.e.NormalKind);if(!c)return this;L.b.ComputeNormals(A,y,c),this.updateVerticesData(O.e.NormalKind,c,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const y=this._geometry,c=this._geometry.j(i.e.RandomId());return y.releaseForMesh(this,!0),c.Gy(this),this}setIndexBuffer(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=this._geometry;w||(w=new i.e(i.e.RandomId(),this.mc(),void 0,void 0,this)),w.setIndexBuffer(y,c,A,l)}setIndices(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(y,c,A,l);else{const c=new L.b;c.indices=y;const l=this.mc();new i.e(i.e.RandomId(),l,c,A,this)}return this}updateIndices(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(y,c,A),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(y,c,A){let l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const w=this.mc().getEngine();let N;if(this._unIndexed)if(this._getRenderingFillMode(A)===D.c.WireFrameFillMode)N=y._getLinesIndexBuffer(this.rc(),w);else N=null;else switch(this._getRenderingFillMode(A)){case D.c.PointFillMode:N=null;break;case D.c.WireFrameFillMode:N=y._getLinesIndexBuffer(this.rc(),w);break;default:case D.c.TriangleFillMode:N=this._geometry.getIndexBuffer()}return this._bindDirect(c,N,l)}_bindDirect(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(y),A&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(y,c,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(y,c),this):this}_draw(y,c,A){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const l=this.mc().getEngine();return this._unIndexed&&c!==D.c.WireFrameFillMode||c==D.c.PointFillMode?l.drawArraysType(c,y.verticesStart,y.verticesCount,this.forcedInstanceCount||A):c==D.c.WireFrameFillMode?l.drawElementsType(c,0,y._linesIndexCount,this.forcedInstanceCount||A):l.drawElementsType(c,y.indexStart,y.indexCount,this.forcedInstanceCount||A),this}registerBeforeRender(y){return this.onBeforeRenderObservable.add(y),this}unregisterBeforeRender(y){return this.onBeforeRenderObservable.removeCallback(y),this}registerAfterRender(y){return this.onAfterRenderObservable.add(y),this}unregisterAfterRender(y){return this.onAfterRenderObservable.removeCallback(y),this}_getInstancesRenderList(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(c)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[y]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[y]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const A=this.mc(),l=A._isInIntermediateRendering(),w=l?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,N=this._instanceDataStorage.batchCache;if(N.mustReturn=!1,N.renderSelf[y]=c||!w&&this.isEnabled()&&this.isVisible,N.visibleInstances[y]=null,this._instanceDataStorage.visibleInstances&&!c){const c=this._instanceDataStorage.visibleInstances,w=A.getRenderId(),p=l?c.intermediateDefaultRenderId:c.defaultRenderId;N.visibleInstances[y]=c[w],!N.visibleInstances[y]&&p&&(N.visibleInstances[y]=c[p])}return N.hardwareInstancedRendering[y]=!c&&this._instanceDataStorage.hardwareInstancedRendering&&null!==N.visibleInstances[y]&&void 0!==N.visibleInstances[y],this._instanceDataStorage.previousBatch=N,N}_updateInstancedBuffers(y,c,A,l,w,N){const p=c.visibleInstances[y._id],W=p?p.length:0,h=this._instanceDataStorage;let q=h.instancesBuffer,o=h.instancesPreviousBuffer,L=0,i=0;const H=c.renderSelf[y._id],P=!q||A!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||h.isFrozen&&!P)i=(H?1:0)+W;else{const c=this.getWorldMatrix();if(H&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,L),h.masterMeshPreviousWorldMatrix.p(c)):(h.masterMeshPreviousWorldMatrix=c.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,L))),c.copyToArray(h.instancesData,L),L+=16,i++),p){var D;if(G.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(D=y.ey())&&void 0!==D&&D.needAlphaBlendingForMesh(y.getRenderingMesh())){const y=this._scene.activeCamera.globalPosition;for(let c=0;c<p.length;c++){const A=p[c];A._distanceToCamera=I.gc.Distance(A.getBoundingInfo().boundingSphere.centerWorld,y)}p.sort(((y,c)=>y._distanceToCamera>c._distanceToCamera?-1:y._distanceToCamera<c._distanceToCamera?1:0))}for(let y=0;y<p.length;y++){const c=p[y],A=c.getWorldMatrix();A.copyToArray(h.instancesData,L),this._scene.needsPreviousWorldMatrices&&(c._previousWorldMatrix?(c._previousWorldMatrix.copyToArray(h.instancesPreviousData,L),c._previousWorldMatrix.p(A)):(c._previousWorldMatrix=A.clone(),c._previousWorldMatrix.copyToArray(h.instancesPreviousData,L))),L+=16,i++}}}P?(q&&q.dispose(),o&&o.dispose(),q=new O.c(l,h.instancesData,!0,16,!1,!0),h.instancesBuffer=q,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=q.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=q.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=q.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=q.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(o=new O.c(l,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=o,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=o.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=o.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=o.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=o.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(q.updateDirectly(h.instancesData,0,i),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||o.updateDirectly(h.instancesPreviousData,0,i)),this._processInstancedBuffers(p,H),N&&void 0!==w&&(this.mc()._activeIndices.addCount(y.indexCount*i,!1),l._currentDrawContext&&(l._currentDrawContext.useInstancing=!0),this._bind(y,N,w),this._draw(y,w,i)),!this._scene.needsPreviousWorldMatrices||P||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||o.updateDirectly(h.instancesData,0,i)}_renderWithInstances(y,c,A,l,w){const N=A.visibleInstances[y._id],p=N?N.length:0,W=this._instanceDataStorage,h=W.instancesBufferSize,I=16*(p+1)*4;for(;W.instancesBufferSize<I;)W.instancesBufferSize*=2;return W.instancesData&&h==W.instancesBufferSize||(W.instancesData=new Float32Array(W.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!W.instancesPreviousData||h!=W.instancesBufferSize)&&(W.instancesPreviousData=new Float32Array(W.instancesBufferSize/4)),this._updateInstancedBuffers(y,A,h,w,c,l),w.unbindInstanceAttributes(),this}_renderWithThinInstances(y,c,A,l){var w;const N=(null===(w=this._thinInstanceDataStorage)||void 0===w?void 0:w.instancesCount)??0;this.mc()._activeIndices.addCount(y.indexCount*N,!1),l._currentDrawContext&&(l._currentDrawContext.useInstancing=!0),this._bind(y,A,c),this._draw(y,c,N),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,N):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),l.unbindInstanceAttributes()}_processInstancedBuffers(y,c){}_processRendering(y,c,A,l,w,N,p,W){const h=this.mc(),I=h.getEngine();if(l=this._getRenderingFillMode(l),N&&c.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(c,l,A,I),this;if(N)this._renderWithInstances(c,l,w,A,I);else{I._currentDrawContext&&(I._currentDrawContext.useInstancing=!1);let A=0;w.renderSelf[c._id]&&(p&&p(!1,y.getWorldMatrix(),W),A++,this._draw(c,l,this._instanceDataStorage.overridenInstanceCount));const N=w.visibleInstances[c._id];if(N){const y=N.length;A+=y;for(let A=0;A<y;A++){const y=N[A].getWorldMatrix();p&&p(!0,y,W),this._draw(c,l)}}h._activeIndices.addCount(c.indexCount*A,!1)}return this}_rebuild(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(y&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const c in this._userInstancedBuffersStorage.vertexBuffers){const A=this._userInstancedBuffersStorage.vertexBuffers[c];A&&(y&&A.dispose(),this._userInstancedBuffersStorage.vertexBuffers[c]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(y)}_freeze(){if(this.jc){for(let y=0;y<this.jc.length;y++)this._getInstancesRenderList(y);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(y,c,A,l){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const N=this._scene.getEngine(),p=N.currentRenderPassId;if(void 0!==y&&(N.currentRenderPassId=y),l)(!w||w&&l.isInFrustum(this._scene._frustumPlanes))&&this.render(l,!!c,A);else for(let W=0;W<this.jc.length;W++){const y=this.jc[W];(!w||w&&y.isInFrustum(this._scene._frustumPlanes))&&this.render(y,!!c,A)}return void 0!==y&&(N.currentRenderPassId=p),this}directRender(){if(!this.jc)return this;for(const y of this.jc)this.render(y,!1);return this}render(y,c,A){var l,w,N;const p=this.mc();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const W=(null===(l=p.activeCameras)||void 0===l?void 0:l.length)??0;if((W>1&&p.activeCamera===p.activeCameras[0]||W<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const h=this._getInstancesRenderList(y._id,!!A);if(h.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const I=p.getEngine();let q=0,o=null;this.ignoreCameraMaxZ&&p.activeCamera&&!p._isInIntermediateRendering()&&(q=p.activeCamera.maxZ,o=p.activeCamera,p.activeCamera.maxZ=0,p.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const O=y.getRenderingMesh(),L=h.hardwareInstancedRendering[y._id]||O.hasThinInstances||!!this._userInstancedBuffersStorage&&!y.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,i=this._instanceDataStorage,H=y.ey();if(!H)return o&&(o.maxZ=q,p.updateTransformMatrix(!0)),this;if(i.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===H){if(H._storeEffectOnSubMeshes&&(null===(w=y._drawWrapper)||void 0===w||!w._wasPreviouslyReady)||!H._storeEffectOnSubMeshes&&!H._getDrawWrapper()._wasPreviouslyReady)return o&&(o.maxZ=q,p.updateTransformMatrix(!0)),this}else{if(H._storeEffectOnSubMeshes){if(!H.isReadyForSubMesh(this,y,L))return o&&(o.maxZ=q,p.updateTransformMatrix(!0)),this}else if(!H.isReady(this,L))return o&&(o.maxZ=q,p.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=H}let P;c&&I.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),P=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?y._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const t=(null===(N=P)||void 0===N?void 0:N.effect)??null;for(const D of p._beforeRenderingMeshStage)D.action(this,y,h,t);if(!P||!t)return o&&(o.maxZ=q,p.updateTransformMatrix(!0)),this;const s=A||this;let B;if(i.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.nc&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)B=i.sideOrientation;else{const y=s._getWorldMatrixDeterminant();B=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),y<0&&(B=B===D.c.ClockWiseSideOrientation?D.c.CounterClockWiseSideOrientation:D.c.ClockWiseSideOrientation),i.sideOrientation=B}const X=this._internalMeshDataInfo._effectiveMaterial._preBind(P,B);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&I.setDepthWrite(!0);const C=this._internalMeshDataInfo._effectiveMaterial,K=C.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),L||this._bind(y,t,K,!1);const my=s.getWorldMatrix();C._storeEffectOnSubMeshes?C.bindForSubMesh(my,this,y):C.bind(my,this),!C.nc&&C.separateCullingPass&&(I.setState(!0,C.zOffset,!1,!X,C.cullBackFaces,C.Sc,C.zOffsetUnits),this._processRendering(this,y,t,K,h,L,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),I.setState(!0,C.zOffset,!1,X,C.cullBackFaces,C.Sc,C.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(y)),this._processRendering(this,y,t,K,h,L,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const D of p._afterRenderingMeshStage)D.action(this,y,h,t);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),o&&(o.maxZ=q,p.updateTransformMatrix(!0)),2!==p.performancePriority||i.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(O.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(O.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const y=this.getVerticesData(O.e.MatricesWeightsKind),c=y.length;for(let A=0;A<c;A+=4){const c=y[A]+y[A+1]+y[A+2]+y[A+3];if(0===c)y[A]=1;else{const l=1/c;y[A]*=l,y[A+1]*=l,y[A+2]*=l,y[A+3]*=l}}this.Uy(O.e.MatricesWeightsKind,y)}_normalizeSkinWeightsAndExtra(){const y=this.getVerticesData(O.e.MatricesWeightsExtraKind),c=this.getVerticesData(O.e.MatricesWeightsKind),A=c.length;for(let l=0;l<A;l+=4){let A=c[l]+c[l+1]+c[l+2]+c[l+3];if(A+=y[l]+y[l+1]+y[l+2]+y[l+3],0===A)c[l]=1;else{const w=1/A;c[l]*=w,c[l+1]*=w,c[l+2]*=w,c[l+3]*=w,y[l]*=w,y[l+1]*=w,y[l+2]*=w,y[l+3]*=w}}this.Uy(O.e.MatricesWeightsKind,c),this.Uy(O.e.MatricesWeightsKind,y)}validateSkinning(){const y=this.getVerticesData(O.e.MatricesWeightsExtraKind),c=this.getVerticesData(O.e.MatricesWeightsKind);if(null===c||null==this.skeleton)return{skinned:!1,valid:!0,ac:"not skinned"};const A=c.length;let l=0,w=0,N=0,p=0;const W=null===y?4:8,h=[];for(let O=0;O<=W;O++)h[O]=0;for(let O=0;O<A;O+=4){let A=c[O],I=A,q=0===I?0:1;for(let w=1;w<W;w++){const N=w<4?c[O+w]:y[O+w-4];N>A&&l++,0!==N&&q++,I+=N,A=N}if(h[q]++,q>N&&(N=q),0===I)w++;else{const A=1/I;let l=0;for(let w=0;w<W;w++)l+=w<4?Math.abs(c[O+w]-c[O+w]*A):Math.abs(y[O+w-4]-y[O+w-4]*A);l>.001&&p++}}const I=this.skeleton.bones.length,q=this.getVerticesData(O.e.MatricesIndicesKind),o=this.getVerticesData(O.e.MatricesIndicesExtraKind);let L=0;for(let O=0;O<A;O+=4)for(let y=0;y<W;y++){const c=y<4?q[O+y]:o[O+y-4];(c>=I||c<0)&&L++}return{skinned:!0,valid:0===w&&0===p&&0===L,ac:"Number of Weights = "+A/4+"\nMaximum influences = "+N+"\nMissing Weights = "+w+"\nNot Sorted = "+l+"\nNot Normalized = "+p+"\nWeightCounts = ["+h+"]\nNumber of bones = "+I+"\nBad Bone Indices = "+L}}_checkDelayState(){const y=this.mc();return this._geometry?this._geometry.load(y):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(y)),this}_queueLoad(y){y.addPendingData(this);const c=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return w.Tools.LoadFile(this.delayLoadingFile,(c=>{c instanceof ArrayBuffer?this._delayLoadingFunction(c,this):this._delayLoadingFunction(JSON.parse(c),this);for(const y of this.instances)y.refreshBoundingInfo(),y._syncSubMeshes();this.delayLoadState=1,y.removePendingData(this)}),(()=>{}),y.offlineProvider,c),this}isInFrustum(y){return 2!==this.delayLoadState&&(!!super.isInFrustum(y)&&(this._checkDelayState(),!0))}setMaterialById(y){const c=this.mc().materials;let A;for(A=c.length-1;A>-1;A--)if(c[A].id===y)return this.material=c[A],this;const l=this.mc().multiMaterials;for(A=l.length-1;A>-1;A--)if(l[A].id===y)return this.material=l[A],this;return this}getAnimatables(){const y=[];return this.material&&y.push(this.material),this.skeleton&&y.push(this.skeleton),y}bakeTransformIntoVertices(y){if(!this.isVerticesDataPresent(O.e.PositionKind))return this;const c=this.jc.splice(0);this._resetPointsArrayCache();let A=this.getVerticesData(O.e.PositionKind);const l=I.gc.Zero();let w;for(w=0;w<A.length;w+=3)I.gc.TransformCoordinatesFromFloatsToRef(A[w],A[w+1],A[w+2],y,l).toArray(A,w);if(this.Uy(O.e.PositionKind,A,this.getVertexBuffer(O.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(O.e.NormalKind)){for(A=this.getVerticesData(O.e.NormalKind),w=0;w<A.length;w+=3)I.gc.TransformNormalFromFloatsToRef(A[w],A[w+1],A[w+2],y,l).normalize().toArray(A,w);this.Uy(O.e.NormalKind,A,this.getVertexBuffer(O.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(O.e.TangentKind)){for(A=this.getVerticesData(O.e.TangentKind),w=0;w<A.length;w+=4)I.gc.TransformNormalFromFloatsToRef(A[w],A[w+1],A[w+2],y,l).normalize().toArray(A,w);this.Uy(O.e.TangentKind,A,this.getVertexBuffer(O.e.TangentKind).isUpdatable())}return y.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.jc=c,this}bakeCurrentTransformIntoVertices(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Yc(!0)),this.resetLocalMatrix(y),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(c&&void 0===c._addToSceneRootNodes){const A=c;return u.source=this,u.doNotCloneChildren=A.doNotCloneChildren,u.clonePhysicsImpostor=A.clonePhysicsImpostor,u.cloneThinInstances=A.cloneThinInstances,new G(y,this.mc(),u)}return new G(y,this.mc(),c,this,A,l)}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const A=this._internalMeshDataInfo;if(A._onBeforeDrawObservable&&A._onBeforeDrawObservable.clear(),A._onBeforeBindObservable&&A._onBeforeBindObservable.clear(),A._onBeforeRenderObservable&&A._onBeforeRenderObservable.clear(),A._onAfterRenderObservable&&A._onAfterRenderObservable.clear(),A._onBetweenPassObservable&&A._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(A.meshMap)for(const y in A.meshMap){const c=A.meshMap[y];c&&(c._internalMeshDataInfo._source=null,A.meshMap[y]=void 0)}A._source&&A._source._internalMeshDataInfo.meshMap&&(A._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const y=this.mc().meshes;for(const c of y){const y=c;y._internalMeshDataInfo&&y._internalMeshDataInfo._source&&y._internalMeshDataInfo._source===this&&(y._internalMeshDataInfo._source=null)}}A._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(y,c)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(y,c,A,l,N,p){let W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0;const I=this.mc();return w.Tools.LoadImage(y,(y=>{const w=y.width,h=y.height,I=this.getEngine().createCanvas(w,h).getContext("2d");I.drawImage(y,0,0);const q=I.getImageData(0,0,w,h).data;this.applyDisplacementMapFromBuffer(q,w,h,c,A,N,p,W),l&&l(this)}),h||(()=>{}),I.offlineProvider),this}applyDisplacementMapFromBuffer(y,c,A,l,w,N,p){let W=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(O.e.PositionKind)||!this.isVerticesDataPresent(O.e.NormalKind)||!this.isVerticesDataPresent(O.e.UVKind))return X.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(O.e.PositionKind,!0,!0),q=this.getVerticesData(O.e.NormalKind),o=this.getVerticesData(O.e.UVKind);let i=I.gc.Zero();const H=I.gc.Zero(),P=I.Vector2.Zero();N=N||I.Vector2.Zero(),p=p||new I.Vector2(1,1);for(let O=0;O<h.length;O+=3){I.gc.FromArrayToRef(h,O,i),I.gc.FromArrayToRef(q,O,H),I.Vector2.FromArrayToRef(o,O/3*2,P);const W=4*((Math.abs(P.x*p.x+N.x%1)*(c-1)%c|0)+(Math.abs(P.y*p.y+N.y%1)*(A-1)%A|0)*c),L=.3*(y[W]/255)+.59*(y[W+1]/255)+.11*(y[W+2]/255);H.normalize(),H.scaleInPlace(l+(w-l)*L),i=i.add(H),i.toArray(h,O)}return L.b.ComputeNormals(h,this.rc(),q),W?(this.Uy(O.e.PositionKind,h),this.Uy(O.e.NormalKind,q),this.Uy(O.e.UVKind,o)):(this.updateVerticesData(O.e.PositionKind,h),this.updateVerticesData(O.e.NormalKind,q)),this}_getFlattenedNormals(y,c){const A=new Float32Array(3*y.length);let l=0;const w=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let N=0;N<y.length;N+=3){const p=I.gc.yA(c,3*y[N]),W=I.gc.yA(c,3*y[N+1]),h=I.gc.yA(c,3*y[N+2]),q=p.xc(W),o=h.xc(W),O=I.gc.Normalize(I.gc.Cross(q,o));w&&O.scaleInPlace(-1);for(let y=0;y<3;y++)A[l++]=O.x,A[l++]=O.y,A[l++]=O.z}return A}_convertToUnIndexedMesh(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.getVerticesDataKinds().filter((y=>{var c;return!(null!==(c=this.getVertexBuffer(y))&&void 0!==c&&c.getIsInstanced())})),A=this.rc(),l={},w=(y,c)=>{const l=new Float32Array(A.length*c);let w=0;for(let N=0;N<A.length;N++)for(let p=0;p<c;p++)l[w++]=y[A[N]*c+p];return l},N=this.getBoundingInfo(),p=this.Rc?this.jc.slice(0):[];for(const W of c)l[W]=this.getVerticesData(W);for(const W of c){const c=this.getVertexBuffer(W),N=c.getSize();if(y&&W===O.e.NormalKind){const y=this._getFlattenedNormals(A,l[O.e.PositionKind]);this.Uy(O.e.NormalKind,y,c.isUpdatable(),N)}else this.Uy(W,w(l[W],N),c.isUpdatable(),N)}if(this.morphTargetManager){for(let c=0;c<this.morphTargetManager.numTargets;c++){const l=this.morphTargetManager.getTarget(c),N=l.getPositions();l.setPositions(w(N,3));const p=l.getNormals();p&&l.setNormals(y?this._getFlattenedNormals(A,N):w(p,3));const W=l.getTangents();W&&l.setTangents(w(W,3));const h=l.getUVs();h&&l.setUVs(w(h,2));const I=l.getColors();I&&l.setColors(w(I,4))}this.morphTargetManager.synchronize()}for(let W=0;W<A.length;W++)A[W]=W;this.setIndices(A),this._unIndexed=!0,this.releaseSubMeshes();for(const W of p){const y=W.getBoundingInfo();P.c.AddToMesh(W.materialIndex,W.indexStart,W.indexCount,W.indexStart,W.indexCount,this).setBoundingInfo(y)}return this.setBoundingInfo(N),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=L.b.ExtractFromMesh(this);let A;if(y&&this.isVerticesDataPresent(O.e.NormalKind)&&c.Sy){for(A=0;A<c.Sy.length;A++)c.Sy[A]*=-1;this.Uy(O.e.NormalKind,c.Sy,this.isVertexBufferUpdatable(O.e.NormalKind))}if(c.indices){let y;for(A=0;A<c.indices.length;A+=3)y=c.indices[A+1],c.indices[A+1]=c.indices[A+2],c.indices[A+2]=y;this.setIndices(c.indices,null,this.isVertexBufferUpdatable(O.e.PositionKind),!0)}return this}increaseVertices(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const c=L.b.ExtractFromMesh(this),A=c.indices&&!Array.isArray(c.indices)&&Array.from?Array.from(c.indices):c.indices,l=c.zy&&!Array.isArray(c.zy)&&Array.from?Array.from(c.zy):c.zy,w=c.ky&&!Array.isArray(c.ky)&&Array.from?Array.from(c.ky):c.ky,N=c.Sy&&!Array.isArray(c.Sy)&&Array.from?Array.from(c.Sy):c.Sy;if(A&&l){c.indices=A,c.zy=l,w&&(c.ky=w),N&&(c.Sy=N);const p=y+1,W=[];for(let y=0;y<p+1;y++)W[y]=[];let h,q;const o=new I.gc(0,0,0),L=new I.gc(0,0,0),i=new I.Vector2(0,0),H=[],P=[],D=[];let t,s,B,X=l.length;w&&(s=w.length),N&&(B=N.length);for(let y=0;y<A.length;y+=3){P[0]=A[y],P[1]=A[y+1],P[2]=A[y+2];for(let y=0;y<3;y++)if(h=P[y],q=P[(y+1)%3],void 0===D[h]&&void 0===D[q]?(D[h]=[],D[q]=[]):(void 0===D[h]&&(D[h]=[]),void 0===D[q]&&(D[q]=[])),void 0===D[h][q]&&void 0===D[q][h]){D[h][q]=[],o.x=(l[3*q]-l[3*h])/p,o.y=(l[3*q+1]-l[3*h+1])/p,o.z=(l[3*q+2]-l[3*h+2])/p,N&&(L.x=(N[3*q]-N[3*h])/p,L.y=(N[3*q+1]-N[3*h+1])/p,L.z=(N[3*q+2]-N[3*h+2])/p),w&&(i.x=(w[2*q]-w[2*h])/p,i.y=(w[2*q+1]-w[2*h+1])/p),D[h][q].push(h);for(let y=1;y<p;y++)D[h][q].push(l.length/3),l[X++]=l[3*h]+y*o.x,l[X++]=l[3*h+1]+y*o.y,l[X++]=l[3*h+2]+y*o.z,N&&(N[B++]=N[3*h]+y*L.x,N[B++]=N[3*h+1]+y*L.y,N[B++]=N[3*h+2]+y*L.z),w&&(w[s++]=w[2*h]+y*i.x,w[s++]=w[2*h+1]+y*i.y);D[h][q].push(q),D[q][h]=[],t=D[h][q].length;for(let y=0;y<t;y++)D[q][h][y]=D[h][q][t-1-y]}W[0][0]=A[y],W[1][0]=D[A[y]][A[y+1]][1],W[1][1]=D[A[y]][A[y+2]][1];for(let c=2;c<p;c++){W[c][0]=D[A[y]][A[y+1]][c],W[c][c]=D[A[y]][A[y+2]][c],o.x=(l[3*W[c][c]]-l[3*W[c][0]])/c,o.y=(l[3*W[c][c]+1]-l[3*W[c][0]+1])/c,o.z=(l[3*W[c][c]+2]-l[3*W[c][0]+2])/c,N&&(L.x=(N[3*W[c][c]]-N[3*W[c][0]])/c,L.y=(N[3*W[c][c]+1]-N[3*W[c][0]+1])/c,L.z=(N[3*W[c][c]+2]-N[3*W[c][0]+2])/c),w&&(i.x=(w[2*W[c][c]]-w[2*W[c][0]])/c,i.y=(w[2*W[c][c]+1]-w[2*W[c][0]+1])/c);for(let y=1;y<c;y++)W[c][y]=l.length/3,l[X++]=l[3*W[c][0]]+y*o.x,l[X++]=l[3*W[c][0]+1]+y*o.y,l[X++]=l[3*W[c][0]+2]+y*o.z,N&&(N[B++]=N[3*W[c][0]]+y*L.x,N[B++]=N[3*W[c][0]+1]+y*L.y,N[B++]=N[3*W[c][0]+2]+y*L.z),w&&(w[s++]=w[2*W[c][0]]+y*i.x,w[s++]=w[2*W[c][0]+1]+y*i.y)}W[p]=D[A[y+1]][A[y+2]],H.push(W[0][0],W[1][0],W[1][1]);for(let y=1;y<p;y++){let c;for(c=0;c<y;c++)H.push(W[y][c],W[y+1][c],W[y+1][c+1]),H.push(W[y][c],W[y+1][c+1],W[y][c+1]);H.push(W[y][c],W[y+1][c],W[y+1][c+1])}}c.indices=H,c.Gy(this,this.isVertexBufferUpdatable(O.e.PositionKind))}else X.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const y=L.b.ExtractFromMesh(this),c=y.ky,A=y.indices,l=y.zy,w=y.My,N=y.matricesIndices,p=y.matricesWeights,W=y.matricesIndicesExtra,h=y.matricesWeightsExtra;if(void 0===A||void 0===l||null===A||null===l)X.c.Warn("VertexData contains empty entries");else{const I=[],q=[],o=[],i=[],H=[],P=[],D=[],t=[];let s=[],B=0;const X={};let C,K;for(let y=0;y<A.length;y+=3){K=[A[y],A[y+1],A[y+2]],s=[];for(let y=0;y<3;y++){s[y]="";for(let c=0;c<3;c++)Math.abs(l[3*K[y]+c])<1e-8&&(l[3*K[y]+c]=0),s[y]+=l[3*K[y]+c]+"|"}if(s[0]!=s[1]&&s[0]!=s[2]&&s[1]!=s[2])for(let y=0;y<3;y++){if(C=X[s[y]],void 0===C){X[s[y]]=B,C=B++;for(let c=0;c<3;c++)I.push(l[3*K[y]+c]);if(null!==w&&void 0!==w)for(let c=0;c<4;c++)i.push(w[4*K[y]+c]);if(null!==c&&void 0!==c)for(let A=0;A<2;A++)o.push(c[2*K[y]+A]);if(null!==N&&void 0!==N)for(let c=0;c<4;c++)H.push(N[4*K[y]+c]);if(null!==p&&void 0!==p)for(let c=0;c<4;c++)P.push(p[4*K[y]+c]);if(null!==W&&void 0!==W)for(let c=0;c<4;c++)D.push(W[4*K[y]+c]);if(null!==h&&void 0!==h)for(let c=0;c<4;c++)t.push(h[4*K[y]+c])}q.push(C)}}const my=[];L.b.ComputeNormals(I,q,my),y.zy=I,y.indices=q,y.Sy=my,null!==c&&void 0!==c&&(y.ky=o),null!==w&&void 0!==w&&(y.My=i),null!==N&&void 0!==N&&(y.matricesIndices=H),null!==p&&void 0!==p&&(y.matricesWeights=P),null!==W&&void 0!==W&&(y.matricesIndicesExtra=D),null!==p&&void 0!==p&&(y.matricesWeightsExtra=t),y.Gy(this,this.isVertexBufferUpdatable(O.e.PositionKind))}}static _instancedMeshFactory(y,c){throw(0,K.d)("InstancedMesh")}static _PhysicsImpostorParser(y,c,A){throw(0,K.d)("PhysicsImpostor")}createInstance(y){const c=G._instancedMeshFactory(y,this);return c.parent=this.parent,c}synchronizeInstances(){for(let y=0;y<this.instances.length;y++){this.instances[y]._syncSubMeshes()}return this}optimizeIndices(y){const c=this.rc(),A=this.getVerticesData(O.e.PositionKind);if(!A||!c)return this;const l=[];for(let w=0;w<A.length;w+=3)l.push(I.gc.yA(A,w));const N=[];return w.AsyncLoop.SyncAsyncForLoop(l.length,40,(y=>{const c=l.length-1-y,A=l[c];for(let w=0;w<c;++w){const y=l[w];if(A.equals(y)){N[c]=w;break}}}),(()=>{for(let y=0;y<c.length;++y)c[y]=N[c[y]]||c[y];const A=this.jc.slice(0);this.setIndices(c),this.jc=A,y&&y(this)})),this}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.name=this.name,y.id=this.id,y.uniqueId=this.uniqueId,y.type=this.getClassName(),p.c&&p.c.HasTags(this)&&(y.tags=p.c.GetTags(this)),y.position=this.position.fc(),this.rotationQuaternion?y.rotationQuaternion=this.rotationQuaternion.fc():this.rotation&&(y.rotation=this.rotation.fc()),y.bc=this.bc.fc(),this._postMultiplyPivotMatrix?y.pivotMatrix=this.getPivotMatrix().fc():y.localMatrix=this.getPivotMatrix().fc(),y.isEnabled=this.isEnabled(!1),y.isVisible=this.isVisible,y.infiniteDistance=this.infiniteDistance,y.pickable=this.HI,y.receiveShadows=this.receiveShadows,y.billboardMode=this.billboardMode,y.visibility=this.visibility,y.Hq=this.Hq,y.checkCollisions=this.checkCollisions,y.ellipsoid=this.ellipsoid.fc(),y.ellipsoidOffset=this.ellipsoidOffset.fc(),y.jy=this.jy,y.isBlocker=this.isBlocker,y.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(y),y.isUnIndexed=this.isUnIndexed;const c=this._geometry;if(c&&this.jc){y.geometryUniqueId=c.uniqueId,y.geometryId=c.id,y.jc=[];for(let c=0;c<this.jc.length;c++){const A=this.jc[c];y.jc.push({materialIndex:A.materialIndex,verticesStart:A.verticesStart,verticesCount:A.verticesCount,indexStart:A.indexStart,indexCount:A.indexCount})}}if(this.material?this.material.doNotSerialize||(y.materialUniqueId=this.material.uniqueId,y.materialId=this.material.id):(this.material=null,y.materialUniqueId=this._scene.defaultMaterial.uniqueId,y.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(y.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(y.skeletonId=this.skeleton.id,y.numBoneInfluencers=this.numBoneInfluencers),this.mc()._getComponent(my.b.NAME_PHYSICSENGINE)){const c=this.getPhysicsImpostor();c&&(y.physicsMass=c.getParam("Lw"),y.physicsFriction=c.getParam("friction"),y.physicsRestitution=c.getParam("Lw"),y.physicsImpostor=c.type)}this.metadata&&(y.metadata=this.metadata),y.instances=[];for(let A=0;A<this.instances.length;A++){const c=this.instances[A];if(c.doNotSerialize)continue;const l={name:c.name,id:c.id,isEnabled:c.isEnabled(!1),isVisible:c.isVisible,HI:c.HI,checkCollisions:c.checkCollisions,position:c.position.fc(),bc:c.bc.fc()};if(c.parent&&c.parent._serializeAsParent(l),c.rotationQuaternion?l.rotationQuaternion=c.rotationQuaternion.fc():c.rotation&&(l.rotation=c.rotation.fc()),this.mc()._getComponent(my.b.NAME_PHYSICSENGINE)){const y=c.getPhysicsImpostor();y&&(l.physicsMass=y.getParam("Lw"),l.physicsFriction=y.getParam("friction"),l.physicsRestitution=y.getParam("Lw"),l.physicsImpostor=y.type)}c.metadata&&(l.metadata=c.metadata),c.actionManager&&(l.actions=c.actionManager.serialize(c.name)),y.instances.push(l),B.d.AppendSerializedAnimations(c,l),l.ranges=c.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(y.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.ZI},this._userThinInstanceBuffersStorage)){const c={data:{},sizes:{},strides:{}};for(const y in this._userThinInstanceBuffersStorage.data)c.data[y]=Array.from(this._userThinInstanceBuffersStorage.data[y]),c.sizes[y]=this._userThinInstanceBuffersStorage.sizes[y],c.strides[y]=this._userThinInstanceBuffersStorage.strides[y];y.thinInstances.userThinInstance=c}return B.d.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y.layerMask=this.layerMask,y.alphaIndex=this.alphaIndex,y.hasVertexAlpha=this.hasVertexAlpha,y.overlayAlpha=this.overlayAlpha,y.overlayColor=this.overlayColor.fc(),y.renderOverlay=this.renderOverlay,y.applyFog=this.applyFog,this.actionManager&&(y.actions=this.actionManager.serialize(this.name)),y}_syncGeometryWithMorphTargetManager(){if(!this.Rc)return;this._markSubMeshesAsAttributesDirty();const y=this._internalAbstractMeshDataInfo._morphTargetManager;if(y&&y.vertexCount){if(y.vertexCount!==this.getTotalVertices())return X.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(y.isUsingTextureForTargets)return;for(let c=0;c<y.numInfluencers;c++){const A=y.getActiveTarget(c),l=A.getPositions();if(!l)return void X.c.Error("Invalid morph target. Target must have positions.");this.Rc.Uy(O.e.PositionKind+c,l,!1,3);const w=A.getNormals();w&&this.Rc.Uy(O.e.NormalKind+c,w,!1,3);const N=A.getTangents();N&&this.Rc.Uy(O.e.TangentKind+c,N,!1,3);const p=A.getUVs();p&&this.Rc.Uy(O.e.UVKind+"_"+c,p,!1,2);const W=A.getUV2s();W&&this.Rc.Uy(O.e.UV2Kind+"_"+c,W,!1,2);const h=A.getColors();h&&this.Rc.Uy(O.e.ColorKind+c,h,!1,4)}}else{let y=0;for(;this.Rc.isVerticesDataPresent(O.e.PositionKind+y);)this.Rc.removeVerticesData(O.e.PositionKind+y),this.Rc.isVerticesDataPresent(O.e.NormalKind+y)&&this.Rc.removeVerticesData(O.e.NormalKind+y),this.Rc.isVerticesDataPresent(O.e.TangentKind+y)&&this.Rc.removeVerticesData(O.e.TangentKind+y),this.Rc.isVerticesDataPresent(O.e.UVKind+y)&&this.Rc.removeVerticesData(O.e.UVKind+"_"+y),this.Rc.isVerticesDataPresent(O.e.UV2Kind+y)&&this.Rc.removeVerticesData(O.e.UV2Kind+"_"+y),this.Rc.isVerticesDataPresent(O.e.ColorKind+y)&&this.Rc.removeVerticesData(O.e.ColorKind+y),y++}}static Parse(y,c,A){let l;if(l=y.type&&"LinesMesh"===y.type?G._LinesMeshParser(y,c):y.type&&"GroundMesh"===y.type?G._GroundMeshParser(y,c):y.type&&"GoldbergMesh"===y.type?G._GoldbergMeshParser(y,c):y.type&&"GreasedLineMesh"===y.type?G._GreasedLineMeshParser(y,c):y.type&&"TrailMesh"===y.type?G._TrailMeshParser(y,c):new G(y.name,c),l.id=y.id,l._waitingParsedUniqueId=y.uniqueId,p.c&&p.c.AddTagsTo(l,y.tags),l.position=I.gc.yA(y.position),void 0!==y.metadata&&(l.metadata=y.metadata),y.rotationQuaternion?l.rotationQuaternion=I.Quaternion.yA(y.rotationQuaternion):y.rotation&&(l.rotation=I.gc.yA(y.rotation)),l.bc=I.gc.yA(y.bc),y.localMatrix?l.setPreTransformMatrix(I.Matrix.yA(y.localMatrix)):y.pivotMatrix&&l.setPivotMatrix(I.Matrix.yA(y.pivotMatrix)),l.ph(y.isEnabled),l.isVisible=y.isVisible,l.infiniteDistance=y.infiniteDistance,l.Hq=!!y.Hq,l.showBoundingBox=y.showBoundingBox,l.showSubMeshesBoundingBox=y.showSubMeshesBoundingBox,void 0!==y.applyFog&&(l.applyFog=y.applyFog),void 0!==y.pickable&&(l.HI=y.pickable),void 0!==y.alphaIndex&&(l.alphaIndex=y.alphaIndex),l.receiveShadows=y.receiveShadows,void 0!==y.billboardMode&&(l.billboardMode=y.billboardMode),void 0!==y.visibility&&(l.visibility=y.visibility),l.checkCollisions=y.checkCollisions,l.jy=!!y.jy,y.ellipsoid&&(l.ellipsoid=I.gc.yA(y.ellipsoid)),y.ellipsoidOffset&&(l.ellipsoidOffset=I.gc.yA(y.ellipsoidOffset)),null!=y.overrideMaterialSideOrientation&&(l.sideOrientation=y.overrideMaterialSideOrientation),void 0!==y.sideOrientation&&(l.sideOrientation=y.sideOrientation),void 0!==y.isBlocker&&(l.isBlocker=y.isBlocker),l._shouldGenerateFlatShading=y.useFlatShading,y.xW&&(l._waitingData.xW=y.xW),void 0!==y.parentId&&(l._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(l._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.actions&&(l._waitingData.actions=y.actions),void 0!==y.overlayAlpha&&(l.overlayAlpha=y.overlayAlpha),void 0!==y.overlayColor&&(l.overlayColor=q.dc.yA(y.overlayColor)),void 0!==y.renderOverlay&&(l.renderOverlay=y.renderOverlay),l.isUnIndexed=!!y.isUnIndexed,l.hasVertexAlpha=y.hasVertexAlpha,y.delayLoadingFile?(l.delayLoadState=4,l.delayLoadingFile=A+y.delayLoadingFile,l.buildBoundingInfo(I.gc.yA(y.boundingBoxMinimum),I.gc.yA(y.boundingBoxMaximum)),y._binaryInfo&&(l._binaryInfo=y._binaryInfo),l._delayInfo=[],y.hasUVs&&l._delayInfo.push(O.e.UVKind),y.hasUVs2&&l._delayInfo.push(O.e.UV2Kind),y.hasUVs3&&l._delayInfo.push(O.e.UV3Kind),y.hasUVs4&&l._delayInfo.push(O.e.UV4Kind),y.hasUVs5&&l._delayInfo.push(O.e.UV5Kind),y.hasUVs6&&l._delayInfo.push(O.e.UV6Kind),y.hasColors&&l._delayInfo.push(O.e.ColorKind),y.hasMatricesIndices&&l._delayInfo.push(O.e.MatricesIndicesKind),y.hasMatricesWeights&&l._delayInfo.push(O.e.MatricesWeightsKind),l._delayLoadingFunction=i.e._ImportGeometry,s.e.ForceFullSceneLoadingForIncremental&&l._checkDelayState()):i.e._ImportGeometry(y,l),y.materialUniqueId?l._waitingMaterialId=y.materialUniqueId:y.materialId&&(l._waitingMaterialId=y.materialId),y.morphTargetManagerId>-1&&(l._waitingMorphTargetManagerId=y.morphTargetManagerId),void 0!==y.skeletonId&&null!==y.skeletonId&&(l.skeleton=c.getLastSkeletonById(y.skeletonId),y.numBoneInfluencers&&(l.numBoneInfluencers=y.numBoneInfluencers)),y.animations){for(let c=0;c<y.animations.length;c++){const A=y.animations[c],w=(0,C.d)("BABYLON.Animation");w&&l.animations.push(w.Parse(A))}o.b.ParseAnimationRanges(l,y,c)}if(y.autoAnimate&&c.beginAnimation(l,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),y.layerMask&&!isNaN(y.layerMask)?l.layerMask=Math.abs(parseInt(y.layerMask)):l.layerMask=268435455,y.physicsImpostor&&(l.physicsImpostor=G._PhysicsImpostorParser(c,l,y)),y.lodMeshIds&&(l._waitingData.lods={ids:y.lodMeshIds,distances:y.lodDistances?y.lodDistances:null,coverages:y.lodCoverages?y.lodCoverages:null}),y.instances)for(let w=0;w<y.instances.length;w++){const A=y.instances[w],N=l.createInstance(A.name);if(A.id&&(N.id=A.id),p.c&&(A.tags?p.c.AddTagsTo(N,A.tags):p.c.AddTagsTo(N,y.tags)),N.position=I.gc.yA(A.position),void 0!==A.metadata&&(N.metadata=A.metadata),void 0!==A.parentId&&(N._waitingParentId=A.parentId),void 0!==A.parentInstanceIndex&&(N._waitingParentInstanceIndex=A.parentInstanceIndex),void 0!==A.isEnabled&&null!==A.isEnabled&&N.ph(A.isEnabled),void 0!==A.isVisible&&null!==A.isVisible&&(N.isVisible=A.isVisible),void 0!==A.HI&&null!==A.HI&&(N.HI=A.HI),A.rotationQuaternion?N.rotationQuaternion=I.Quaternion.yA(A.rotationQuaternion):A.rotation&&(N.rotation=I.gc.yA(A.rotation)),N.bc=I.gc.yA(A.bc),void 0!=A.checkCollisions&&null!=A.checkCollisions&&(N.checkCollisions=A.checkCollisions),void 0!=A.pickable&&null!=A.pickable&&(N.HI=A.pickable),void 0!=A.showBoundingBox&&null!=A.showBoundingBox&&(N.showBoundingBox=A.showBoundingBox),void 0!=A.showSubMeshesBoundingBox&&null!=A.showSubMeshesBoundingBox&&(N.showSubMeshesBoundingBox=A.showSubMeshesBoundingBox),void 0!=A.alphaIndex&&null!=A.showSubMeshesBoundingBox&&(N.alphaIndex=A.alphaIndex),A.physicsImpostor&&(N.physicsImpostor=G._PhysicsImpostorParser(c,N,A)),void 0!==A.actions&&(N._waitingData.actions=A.actions),A.animations){for(let y=0;y<A.animations.length;y++){const c=A.animations[y],l=(0,C.d)("BABYLON.Animation");l&&N.animations.push(l.Parse(c))}o.b.ParseAnimationRanges(N,A,c),A.autoAnimate&&c.beginAnimation(N,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1)}}if(y.thinInstances){const c=y.thinInstances;if(l.ZI=!!c.enablePicking,c.matrixData?(l.bo("matrix",new Float32Array(c.matrixData),16,!1),l._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,l._thinInstanceDataStorage.instancesCount=c.instancesCount):l._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,y.thinInstances.userThinInstance){const c=y.thinInstances.userThinInstance;for(const y in c.data)l.bo(y,new Float32Array(c.data[y]),c.strides[y],!1),l._userThinInstanceBuffersStorage.sizes[y]=c.sizes[y]}}return l}setPositionsForCPUSkinning(){const y=this._internalMeshDataInfo;if(!y._sourcePositions){const c=this.getVerticesData(O.e.PositionKind);if(!c)return y._sourcePositions;y._sourcePositions=new Float32Array(c),this.isVertexBufferUpdatable(O.e.PositionKind)||this.Uy(O.e.PositionKind,c,!0)}return y._sourcePositions}setNormalsForCPUSkinning(){const y=this._internalMeshDataInfo;if(!y._sourceNormals){const c=this.getVerticesData(O.e.NormalKind);if(!c)return y._sourceNormals;y._sourceNormals=new Float32Array(c),this.isVertexBufferUpdatable(O.e.NormalKind)||this.Uy(O.e.NormalKind,c,!0)}return y._sourceNormals}applySkeleton(y){if(!this.Rc)return this;if(this.Rc._softwareSkinningFrameId==this.mc().getFrameId())return this;if(this.Rc._softwareSkinningFrameId=this.mc().getFrameId(),!this.isVerticesDataPresent(O.e.PositionKind))return this;if(!this.isVerticesDataPresent(O.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(O.e.MatricesWeightsKind))return this;const c=this.isVerticesDataPresent(O.e.NormalKind),A=this._internalMeshDataInfo;if(!A._sourcePositions){const y=this.jc.slice();this.setPositionsForCPUSkinning(),this.jc=y}c&&!A._sourceNormals&&this.setNormalsForCPUSkinning();let l=this.getVerticesData(O.e.PositionKind);if(!l)return this;l instanceof Float32Array||(l=new Float32Array(l));let w=this.getVerticesData(O.e.NormalKind);if(c){if(!w)return this;w instanceof Float32Array||(w=new Float32Array(w))}const N=this.getVerticesData(O.e.MatricesIndicesKind),p=this.getVerticesData(O.e.MatricesWeightsKind);if(!p||!N)return this;const W=this.numBoneInfluencers>4,h=W?this.getVerticesData(O.e.MatricesIndicesExtraKind):null,q=W?this.getVerticesData(O.e.MatricesWeightsExtraKind):null,o=y.getTransformMatrices(this),L=I.gc.Zero(),i=new I.Matrix,H=new I.Matrix;let P,D=0;for(let O=0;O<l.length;O+=3,D+=4){let y;for(P=0;P<4;P++)y=p[D+P],y>0&&(I.Matrix.FromFloat32ArrayToRefScaled(o,Math.floor(16*N[D+P]),y,H),i.addToSelf(H));if(W)for(P=0;P<4;P++)y=q[D+P],y>0&&(I.Matrix.FromFloat32ArrayToRefScaled(o,Math.floor(16*h[D+P]),y,H),i.addToSelf(H));I.gc.TransformCoordinatesFromFloatsToRef(A._sourcePositions[O],A._sourcePositions[O+1],A._sourcePositions[O+2],i,L),L.toArray(l,O),c&&(I.gc.TransformNormalFromFloatsToRef(A._sourceNormals[O],A._sourceNormals[O+1],A._sourceNormals[O+2],i,L),L.toArray(w,O)),i.reset()}return this.updateVerticesData(O.e.PositionKind,l),c&&this.updateVerticesData(O.e.NormalKind,w),this}static MinMax(y){let c=null,A=null;for(const l of y){const y=l.getBoundingInfo().boundingBox;c&&A?(c.minimizeInPlace(y.minimumWorld),A.maximizeInPlace(y.maximumWorld)):(c=y.minimumWorld,A=y.maximumWorld)}return c&&A?{min:c,max:A}:{min:I.gc.Zero(),max:I.gc.Zero()}}static Center(y){const c=y instanceof Array?G.MinMax(y):y;return I.gc.Center(c.min,c.max)}static MergeMeshes(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;return(0,W.l)(G._MergeMeshesCoroutine(y,c,A,l,w,N,!1))}static async MergeMeshesAsync(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;return await(0,W.j)(G._MergeMeshesCoroutine(y,c,A,l,w,N,!0),(0,W.e)())}static*_MergeMeshesCoroutine(y){let c,A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,W=arguments.length>6?arguments[6]:void 0;if(0===(y=y.filter(Boolean)).length)return null;if(!l){let A=0;for(c=0;c<y.length;c++)if(A+=y[c].getTotalVertices(),A>=65536)return X.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}p&&(N=!1);const h=new Array,I=new Array,q=new Array,o=y[0].sideOrientation;for(c=0;c<y.length;c++){const A=y[c];if(A.isAnInstance)return X.c.Warn("Cannot merge instance meshes."),null;if(o!==A.sideOrientation)return X.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(N&&q.push(A.getTotalIndices()),p)if(A.material){const y=A.material;if(y instanceof t.c){for(let c=0;c<y.Up.length;c++)h.indexOf(y.Up[c])<0&&h.push(y.Up[c]);for(let c=0;c<A.jc.length;c++)I.push(h.indexOf(y.Up[A.jc[c].materialIndex])),q.push(A.jc[c].indexCount)}else{h.indexOf(y)<0&&h.push(y);for(let c=0;c<A.jc.length;c++)I.push(h.indexOf(y)),q.push(A.jc[c].indexCount)}}else for(let y=0;y<A.jc.length;y++)I.push(0),q.push(A.jc[y].indexCount)}const O=y[0],i=y=>{const c=y.Yc(!0);return{vertexData:L.b.ExtractFromMesh(y,!1,!1),transform:c}},{vertexData:H,transform:D}=i(O);W&&(yield);const s=new Array(y.length-1);for(let L=1;L<y.length;L++)s[L-1]=i(y[L]),W&&(yield);const B=H._mergeCoroutine(D,s,l,W,!A);let C=B.next();for(;!C.done;)W&&(yield),C=B.next();const K=C.value;w||(w=new G(O.name+"_merged",O.mc()));const my=K._applyToCoroutine(w,void 0,W);let T=my.next();for(;!T.done;)W&&(yield),T=my.next();if(w.checkCollisions=O.checkCollisions,w.sideOrientation=O.sideOrientation,A)for(c=0;c<y.length;c++)y[c].dispose();if(N||p){w.releaseSubMeshes(),c=0;let y=0;for(;c<q.length;)P.c.CreateFromIndices(0,y,q[c],w,void 0,!1),y+=q[c],c++;for(const c of w.jc)c.refreshBoundingInfo();w.Yc(!0)}if(p){const y=new t.c(O.name+"_merged",O.mc());y.Up=h;for(let c=0;c<w.jc.length;c++)w.jc[c].materialIndex=I[c];w.material=y}else w.material=O.material;return w}FO(y){y._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(y)}xO(y){const c=y._indexInSourceMeshInstanceArray;if(-1!=c){if(c!==this.instances.length-1){const y=this.instances[this.instances.length-1];this.instances[c]=y,y._indexInSourceMeshInstanceArray=c}y._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===D.c.CounterClockWiseSideOrientation}_getRenderingFillMode(y){const c=this.mc();return c.forcePointsCloud?D.c.PointFillMode:c.forceWireframe?D.c.WireFrameFillMode:this.overrideRenderingFillMode??y}setMaterialByID(y){return this.setMaterialById(y)}static CreateRibbon(y,c,A,l,w,N,p,W,h){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(y,c,A,l,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(y,c,A,l,w){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(y,c,A,l,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(y,c,A,l){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(y,c,A,l,w,N,p,W,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(y,c,A,l,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(y,c,A,l,w,N,p,W,h,I){throw new Error("Import MeshBuilder to populate this function")}static bI(y,c,A,l,w){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(y,c,A,l,w,N,p,W){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(y,c,A,l,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(y,c,A,l,w,N,p,W){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(y,c,A,l,w,N,p,W,h,I){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(y,c,A,l,w,N,p,W,h,I,q,o){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(y,c,A,l,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static dI(y,c,A,l,w){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(y,c,A,l,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(y,c,A,l,w,N,p,W,h){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(y,c,A,l,w,N,p,W,h,I,q){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(y,c,A,l,w,N,p,W,h,I){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(y,c,A){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(y,c,A){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(y,c,A,l,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(y,c,A){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(y){throw new Error("Import MeshBuilder to populate this function")}}G.FRONTSIDE=L.b.FRONTSIDE,G.BACKSIDE=L.b.BACKSIDE,G.DOUBLESIDE=L.b.DOUBLESIDE,G.DEFAULTSIDE=L.b.DEFAULTSIDE,G.NO_CAP=0,G.CAP_START=1,G.CAP_END=2,G.CAP_ALL=3,G.NO_FLIP=0,G.FLIP_TILE=1,G.ROTATE_TILE=2,G.FLIP_ROW=3,G.ROTATE_ROW=4,G.FLIP_N_ROTATE_TILE=5,G.FLIP_N_ROTATE_ROW=6,G.CENTER=0,G.LEFT=1,G.RIGHT=2,G.TOP=3,G.BOTTOM=4,G.INSTANCEDMESH_SORT_TRANSPARENT=!1,G._GroundMeshParser=(y,c)=>{throw(0,K.d)("GroundMesh")},G._GoldbergMeshParser=(y,c)=>{throw(0,K.d)("GoldbergMesh")},G._LinesMeshParser=(y,c)=>{throw(0,K.d)("LinesMesh")},G._GreasedLineMeshParser=(y,c)=>{throw(0,K.d)("GreasedLineMesh")},G._GreasedLineRibbonMeshParser=(y,c)=>{throw(0,K.d)("GreasedLineRibbonMesh")},G._TrailMeshParser=(y,c)=>{throw(0,K.d)("TrailMesh")},(0,C.f)("BABYLON.Mesh",G)},12758:(y,c,A)=>{A.d(c,{b:()=>i});var l=A(12307),w=A(12325),N=A(12400),p=A(12178),W=A(12375),h=A(12161),I=A(12310),q=A(12765),o=A(12193),O=A(12640);class L{}class i{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,q.f)(this._applyToCoroutine.bind(this)),this.uniqueId=i._UniqueIdGenerator,i._UniqueIdGenerator++}set(y,c){switch(y.length||h.c.Warn(`Setting vertex data kind '${c}' with an empty array`),c){case N.e.PositionKind:this.zy=y;break;case N.e.NormalKind:this.Sy=y;break;case N.e.TangentKind:this.tangents=y;break;case N.e.UVKind:this.ky=y;break;case N.e.UV2Kind:this.uvs2=y;break;case N.e.UV3Kind:this.uvs3=y;break;case N.e.UV4Kind:this.uvs4=y;break;case N.e.UV5Kind:this.uvs5=y;break;case N.e.UV6Kind:this.uvs6=y;break;case N.e.ColorKind:this.My=y;break;case N.e.MatricesIndicesKind:this.matricesIndices=y;break;case N.e.MatricesWeightsKind:this.matricesWeights=y;break;case N.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=y;break;case N.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=y}}Gy(y,c){return this._applyTo(y,c,!1),this}applyToGeometry(y,c){return this._applyTo(y,c,!1),this}updateMesh(y){return this._update(y),this}updateGeometry(y){return this._update(y),this}*_applyToCoroutine(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;if(this.zy&&(y.Uy(N.e.PositionKind,this.zy,c),A&&(yield)),this.Sy&&(y.Uy(N.e.NormalKind,this.Sy,c),A&&(yield)),this.tangents&&(y.Uy(N.e.TangentKind,this.tangents,c),A&&(yield)),this.ky&&(y.Uy(N.e.UVKind,this.ky,c),A&&(yield)),this.uvs2&&(y.Uy(N.e.UV2Kind,this.uvs2,c),A&&(yield)),this.uvs3&&(y.Uy(N.e.UV3Kind,this.uvs3,c),A&&(yield)),this.uvs4&&(y.Uy(N.e.UV4Kind,this.uvs4,c),A&&(yield)),this.uvs5&&(y.Uy(N.e.UV5Kind,this.uvs5,c),A&&(yield)),this.uvs6&&(y.Uy(N.e.UV6Kind,this.uvs6,c),A&&(yield)),this.My){const l=this.zy&&this.My.length===this.zy.length?3:4;y.Uy(N.e.ColorKind,this.My,c,l),this.hasVertexAlpha&&void 0!==y.hasVertexAlpha&&(y.hasVertexAlpha=!0),A&&(yield)}if(this.matricesIndices&&(y.Uy(N.e.MatricesIndicesKind,this.matricesIndices,c),A&&(yield)),this.matricesWeights&&(y.Uy(N.e.MatricesWeightsKind,this.matricesWeights,c),A&&(yield)),this.matricesIndicesExtra&&(y.Uy(N.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,c),A&&(yield)),this.matricesWeightsExtra&&(y.Uy(N.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,c),A&&(yield)),this.indices?(y.setIndices(this.indices,null,c),A&&(yield)):y.setIndices([],null),y.jc&&this.materialInfos&&this.materialInfos.length>1){const c=y;c.jc=[];for(const y of this.materialInfos)new O.c(y.materialIndex,y.verticesStart,y.verticesCount,y.indexStart,y.indexCount,c)}return this}_update(y,c,A){return this.zy&&y.updateVerticesData(N.e.PositionKind,this.zy,c,A),this.Sy&&y.updateVerticesData(N.e.NormalKind,this.Sy,c,A),this.tangents&&y.updateVerticesData(N.e.TangentKind,this.tangents,c,A),this.ky&&y.updateVerticesData(N.e.UVKind,this.ky,c,A),this.uvs2&&y.updateVerticesData(N.e.UV2Kind,this.uvs2,c,A),this.uvs3&&y.updateVerticesData(N.e.UV3Kind,this.uvs3,c,A),this.uvs4&&y.updateVerticesData(N.e.UV4Kind,this.uvs4,c,A),this.uvs5&&y.updateVerticesData(N.e.UV5Kind,this.uvs5,c,A),this.uvs6&&y.updateVerticesData(N.e.UV6Kind,this.uvs6,c,A),this.My&&y.updateVerticesData(N.e.ColorKind,this.My,c,A),this.matricesIndices&&y.updateVerticesData(N.e.MatricesIndicesKind,this.matricesIndices,c,A),this.matricesWeights&&y.updateVerticesData(N.e.MatricesWeightsKind,this.matricesWeights,c,A),this.matricesIndicesExtra&&y.updateVerticesData(N.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,c,A),this.matricesWeightsExtra&&y.updateVerticesData(N.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,c,A),this.indices&&y.setIndices(this.indices,null),this}static _TransformVector3Coordinates(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const N=w.TmpVectors.gc[0],p=w.TmpVectors.gc[1];for(let W=A;W<A+l;W+=3)w.gc.FromArrayToRef(y,W,N),w.gc.TransformCoordinatesToRef(N,c,p),y[W]=p.x,y[W+1]=p.y,y[W+2]=p.z}static _TransformVector3Normals(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const N=w.TmpVectors.gc[0],p=w.TmpVectors.gc[1];for(let W=A;W<A+l;W+=3)w.gc.FromArrayToRef(y,W,N),w.gc.TransformNormalToRef(N,c,p),y[W]=p.x,y[W+1]=p.y,y[W+2]=p.z}static _TransformVector4Normals(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.length;const N=w.TmpVectors.Vector4[0],p=w.TmpVectors.Vector4[1];for(let W=A;W<A+l;W+=4)w.Vector4.FromArrayToRef(y,W,N),w.Vector4.TransformNormalToRef(N,c,p),y[W]=p.x,y[W+1]=p.y,y[W+2]=p.z,y[W+3]=p.w}static _FlipFaces(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.length;for(let l=c;l<c+A;l+=3){const c=y[l+1];y[l+1]=y[l+2],y[l+2]=c}}transform(y){const c=y.determinant()<0;return this.zy&&i._TransformVector3Coordinates(this.zy,y),this.Sy&&i._TransformVector3Normals(this.Sy,y),this.tangents&&i._TransformVector4Normals(this.tangents,y),c&&this.indices&&i._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const y=[];for(const c of this.materialInfos){const A=new i;if(this.zy&&(A.zy=this.zy.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.Sy&&(A.Sy=this.Sy.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.tangents&&(A.tangents=this.tangents.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.My&&(A.My=this.My.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.ky&&(A.ky=this.ky.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs2&&(A.uvs2=this.uvs2.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs3&&(A.uvs3=this.uvs3.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs4&&(A.uvs4=this.uvs4.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs5&&(A.uvs5=this.uvs5.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs6&&(A.uvs6=this.uvs6.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.matricesIndices&&(A.matricesIndices=this.matricesIndices.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesIndicesExtra&&(A.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeights&&(A.matricesWeights=this.matricesWeights.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeightsExtra&&(A.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.indices){A.indices=[];for(let y=c.indexStart;y<c.indexStart+c.indexCount;y++)A.indices.push(this.indices[y]-c.verticesStart)}const l=new L;l.indexStart=0,l.indexCount=A.indices?A.indices.length:0,l.materialIndex=c.materialIndex,l.verticesStart=0,l.verticesCount=(A.zy?A.zy.length:0)/3,A.materialInfos=[l],y.push(A)}return y}merge(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const N=Array.isArray(y)?y.map((y=>({vertexData:y}))):[{vertexData:y}];return(0,q.l)(this._mergeCoroutine(void 0,N,c,!1,A,l,w))}*_mergeCoroutine(y,c){var A,l;let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0,W=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],I=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let q=c.map((y=>y.vertexData)),o=this;if(I)for(const N of q)N&&(N._validate(),!this.Sy&&N.Sy&&(this.Sy=new Float32Array(this.zy.length)),!this.tangents&&N.tangents&&(this.tangents=new Float32Array(this.zy.length/3*4)),!this.ky&&N.ky&&(this.ky=new Float32Array(this.zy.length/3*2)),!this.uvs2&&N.uvs2&&(this.uvs2=new Float32Array(this.zy.length/3*2)),!this.uvs3&&N.uvs3&&(this.uvs3=new Float32Array(this.zy.length/3*2)),!this.uvs4&&N.uvs4&&(this.uvs4=new Float32Array(this.zy.length/3*2)),!this.uvs5&&N.uvs5&&(this.uvs5=new Float32Array(this.zy.length/3*2)),!this.uvs6&&N.uvs6&&(this.uvs6=new Float32Array(this.zy.length/3*2)),!this.My&&N.My&&(this.My=new Float32Array(this.zy.length/3*4),this.My.fill(1)),!this.matricesIndices&&N.matricesIndices&&(this.matricesIndices=new Float32Array(this.zy.length/3*4)),!this.matricesWeights&&N.matricesWeights&&(this.matricesWeights=new Float32Array(this.zy.length/3*4)),!this.matricesIndicesExtra&&N.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.zy.length/3*4)),!this.matricesWeightsExtra&&N.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.zy.length/3*4)));for(const N of q)if(N)if(I)this.Sy&&!N.Sy&&(N.Sy=new Float32Array(N.zy.length)),this.tangents&&!N.tangents&&(N.tangents=new Float32Array(N.zy.length/3*4)),this.ky&&!N.ky&&(N.ky=new Float32Array(N.zy.length/3*2)),this.uvs2&&!N.uvs2&&(N.uvs2=new Float32Array(N.zy.length/3*2)),this.uvs3&&!N.uvs3&&(N.uvs3=new Float32Array(N.zy.length/3*2)),this.uvs4&&!N.uvs4&&(N.uvs4=new Float32Array(N.zy.length/3*2)),this.uvs5&&!N.uvs5&&(N.uvs5=new Float32Array(N.zy.length/3*2)),this.uvs6&&!N.uvs6&&(N.uvs6=new Float32Array(N.zy.length/3*2)),this.My&&!N.My&&(N.My=new Float32Array(N.zy.length/3*4),N.My.fill(1)),this.matricesIndices&&!N.matricesIndices&&(N.matricesIndices=new Float32Array(N.zy.length/3*4)),this.matricesWeights&&!N.matricesWeights&&(N.matricesWeights=new Float32Array(N.zy.length/3*4)),this.matricesIndicesExtra&&!N.matricesIndicesExtra&&(N.matricesIndicesExtra=new Float32Array(N.zy.length/3*4)),this.matricesWeightsExtra&&!N.matricesWeightsExtra&&(N.matricesWeightsExtra=new Float32Array(N.zy.length/3*4));else if(N._validate(),!this.Sy!==!N.Sy||!this.tangents!==!N.tangents||!this.ky!==!N.ky||!this.uvs2!==!N.uvs2||!this.uvs3!==!N.uvs3||!this.uvs4!==!N.uvs4||!this.uvs5!==!N.uvs5||!this.uvs6!==!N.uvs6||!this.My!==!N.My||!this.matricesIndices!==!N.matricesIndices||!this.matricesWeights!==!N.matricesWeights||!this.matricesIndicesExtra!==!N.matricesIndicesExtra||!this.matricesWeightsExtra!==!N.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(h){let A=0,l=0,w=0;const N=[];let p=null;const W=[];for(const c of this.splitBasedOnMaterialID())W.push({vertexData:c,transform:y});for(const y of c)if(y.vertexData)for(const c of y.vertexData.splitBasedOnMaterialID())W.push({vertexData:c,transform:y.transform});W.sort(((y,c)=>{const A=y.vertexData.materialInfos?y.vertexData.materialInfos[0].materialIndex:0,l=c.vertexData.materialInfos?c.vertexData.materialInfos[0].materialIndex:0;return A>l?1:A===l?0:-1}));for(const y of W){const c=y.vertexData;if(A=c.materialInfos?c.materialInfos[0].materialIndex:0,p&&p.materialIndex===A)p.indexCount+=c.indices.length,p.verticesCount+=c.zy.length/3;else{const y=new L;y.materialIndex=A,y.indexStart=l,y.indexCount=c.indices.length,y.verticesStart=w,y.verticesCount=c.zy.length/3,N.push(y),p=y}l+=c.indices.length,w+=c.zy.length/3}const h=W.splice(0,1)[0];o=h.vertexData,y=h.transform,q=W.map((y=>y.vertexData)),c=W,this.materialInfos=N}const O=q.reduce(((y,c)=>{var A;return y+((null===(A=c.indices)||void 0===A?void 0:A.length)??0)}),(null===(A=o.indices)||void 0===A?void 0:A.length)??0);let H=W||q.some((y=>y.indices===o.indices))?null===(l=o.indices)||void 0===l?void 0:l.slice():o.indices;if(O>0){var P;let A=(null===(P=H)||void 0===P?void 0:P.length)??0;if(H||(H=new Array(O)),H.length!==O){if(Array.isArray(H))H.length=O;else{const y=w||H instanceof Uint32Array?new Uint32Array(O):new Uint16Array(O);y.set(H),H=y}y&&y.determinant()<0&&i._FlipFaces(H,0,A)}let l=o.zy?o.zy.length/3:0;for(const{vertexData:y,transform:w}of c)if(y.indices){for(let c=0;c<y.indices.length;c++)H[A+c]=y.indices[c]+l;w&&w.determinant()<0&&i._FlipFaces(H,A,y.indices.length),l+=y.zy.length/3,A+=y.indices.length,p&&(yield)}}return this.indices=H,this.zy=i._MergeElement(N.e.PositionKind,o.zy,y,c.map((y=>[y.vertexData.zy,y.transform]))),p&&(yield),o.Sy&&(this.Sy=i._MergeElement(N.e.NormalKind,o.Sy,y,c.map((y=>[y.vertexData.Sy,y.transform]))),p&&(yield)),o.tangents&&(this.tangents=i._MergeElement(N.e.TangentKind,o.tangents,y,c.map((y=>[y.vertexData.tangents,y.transform]))),p&&(yield)),o.ky&&(this.ky=i._MergeElement(N.e.UVKind,o.ky,y,c.map((y=>[y.vertexData.ky,y.transform]))),p&&(yield)),o.uvs2&&(this.uvs2=i._MergeElement(N.e.UV2Kind,o.uvs2,y,c.map((y=>[y.vertexData.uvs2,y.transform]))),p&&(yield)),o.uvs3&&(this.uvs3=i._MergeElement(N.e.UV3Kind,o.uvs3,y,c.map((y=>[y.vertexData.uvs3,y.transform]))),p&&(yield)),o.uvs4&&(this.uvs4=i._MergeElement(N.e.UV4Kind,o.uvs4,y,c.map((y=>[y.vertexData.uvs4,y.transform]))),p&&(yield)),o.uvs5&&(this.uvs5=i._MergeElement(N.e.UV5Kind,o.uvs5,y,c.map((y=>[y.vertexData.uvs5,y.transform]))),p&&(yield)),o.uvs6&&(this.uvs6=i._MergeElement(N.e.UV6Kind,o.uvs6,y,c.map((y=>[y.vertexData.uvs6,y.transform]))),p&&(yield)),o.My&&(this.My=i._MergeElement(N.e.ColorKind,o.My,y,c.map((y=>[y.vertexData.My,y.transform]))),(void 0!==o.hasVertexAlpha||c.some((y=>void 0!==y.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=o.hasVertexAlpha||c.some((y=>y.vertexData.hasVertexAlpha))),p&&(yield)),o.matricesIndices&&(this.matricesIndices=i._MergeElement(N.e.MatricesIndicesKind,o.matricesIndices,y,c.map((y=>[y.vertexData.matricesIndices,y.transform]))),p&&(yield)),o.matricesWeights&&(this.matricesWeights=i._MergeElement(N.e.MatricesWeightsKind,o.matricesWeights,y,c.map((y=>[y.vertexData.matricesWeights,y.transform]))),p&&(yield)),o.matricesIndicesExtra&&(this.matricesIndicesExtra=i._MergeElement(N.e.MatricesIndicesExtraKind,o.matricesIndicesExtra,y,c.map((y=>[y.vertexData.matricesIndicesExtra,y.transform]))),p&&(yield)),o.matricesWeightsExtra&&(this.matricesWeightsExtra=i._MergeElement(N.e.MatricesWeightsExtraKind,o.matricesWeightsExtra,y,c.map((y=>[y.vertexData.matricesWeightsExtra,y.transform])))),this}static _MergeElement(y,c,A,l){const w=l.filter((y=>null!==y[0]&&void 0!==y[0]));if(!c&&0==w.length)return c;if(!c)return this._MergeElement(y,w[0][0],w[0][1],w.slice(1));const p=w.reduce(((y,c)=>y+c[0].length),c.length),W=y===N.e.PositionKind?i._TransformVector3Coordinates:y===N.e.NormalKind?i._TransformVector3Normals:y===N.e.TangentKind?i._TransformVector4Normals:()=>{};if(c instanceof Float32Array){const y=new Float32Array(p);y.set(c),A&&W(y,A,0,c.length);let l=c.length;for(const[c,A]of w)y.set(c,l),A&&W(y,A,l,c.length),l+=c.length;return y}{const y=new Array(p);for(let A=0;A<c.length;A++)y[A]=c[A];A&&W(y,A,0,c.length);let l=c.length;for(const[c,A]of w){for(let A=0;A<c.length;A++)y[l+A]=c[A];A&&W(y,A,l,c.length),l+=c.length}return y}}_validate(){if(!this.zy)throw new o.f("Positions are required",o.d.MeshInvalidPositionsError);const y=(y,c)=>{const A=N.e.DeduceStride(y);if(c.length%A!==0)throw new Error("The "+y+"s array count must be a multiple of "+A);return c.length/A},c=y(N.e.PositionKind,this.zy),A=(A,l)=>{const w=y(A,l);if(w!==c)throw new Error("The "+A+"s element count ("+w+") does not match the positions count ("+c+")")};this.Sy&&A(N.e.NormalKind,this.Sy),this.tangents&&A(N.e.TangentKind,this.tangents),this.ky&&A(N.e.UVKind,this.ky),this.uvs2&&A(N.e.UV2Kind,this.uvs2),this.uvs3&&A(N.e.UV3Kind,this.uvs3),this.uvs4&&A(N.e.UV4Kind,this.uvs4),this.uvs5&&A(N.e.UV5Kind,this.uvs5),this.uvs6&&A(N.e.UV6Kind,this.uvs6),this.My&&A(N.e.ColorKind,this.My),this.matricesIndices&&A(N.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&A(N.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&A(N.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&A(N.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const y=this.serialize();return i.Parse(y)}serialize(){const y={};if(this.zy&&(y.zy=Array.from(this.zy)),this.Sy&&(y.Sy=Array.from(this.Sy)),this.tangents&&(y.tangents=Array.from(this.tangents)),this.ky&&(y.ky=Array.from(this.ky)),this.uvs2&&(y.uvs2=Array.from(this.uvs2)),this.uvs3&&(y.uvs3=Array.from(this.uvs3)),this.uvs4&&(y.uvs4=Array.from(this.uvs4)),this.uvs5&&(y.uvs5=Array.from(this.uvs5)),this.uvs6&&(y.uvs6=Array.from(this.uvs6)),this.My&&(y.My=Array.from(this.My),y.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(y.matricesIndices=Array.from(this.matricesIndices),y.matricesIndicesExpanded=!0),this.matricesWeights&&(y.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(y.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),y.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(y.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),y.indices=this.indices?Array.from(this.indices):[],this.materialInfos){y.materialInfos=[];for(const c of this.materialInfos){const A={indexStart:c.indexStart,indexCount:c.indexCount,materialIndex:c.materialIndex,verticesStart:c.verticesStart,verticesCount:c.verticesCount};y.materialInfos.push(A)}}return y}static ExtractFromMesh(y,c,A){return i._ExtractFrom(y,c,A)}static ExtractFromGeometry(y,c,A){return i._ExtractFrom(y,c,A)}static _ExtractFrom(y,c,A){const l=new i;if(y.isVerticesDataPresent(N.e.PositionKind)&&(l.zy=y.getVerticesData(N.e.PositionKind,c,A)),y.isVerticesDataPresent(N.e.NormalKind)&&(l.Sy=y.getVerticesData(N.e.NormalKind,c,A)),y.isVerticesDataPresent(N.e.TangentKind)&&(l.tangents=y.getVerticesData(N.e.TangentKind,c,A)),y.isVerticesDataPresent(N.e.UVKind)&&(l.ky=y.getVerticesData(N.e.UVKind,c,A)),y.isVerticesDataPresent(N.e.UV2Kind)&&(l.uvs2=y.getVerticesData(N.e.UV2Kind,c,A)),y.isVerticesDataPresent(N.e.UV3Kind)&&(l.uvs3=y.getVerticesData(N.e.UV3Kind,c,A)),y.isVerticesDataPresent(N.e.UV4Kind)&&(l.uvs4=y.getVerticesData(N.e.UV4Kind,c,A)),y.isVerticesDataPresent(N.e.UV5Kind)&&(l.uvs5=y.getVerticesData(N.e.UV5Kind,c,A)),y.isVerticesDataPresent(N.e.UV6Kind)&&(l.uvs6=y.getVerticesData(N.e.UV6Kind,c,A)),y.isVerticesDataPresent(N.e.ColorKind)){const w=y.Rc||y,p=w.getVertexBuffer(N.e.ColorKind),W=w.getVerticesData(N.e.ColorKind,c,A);if(3===p.getSize()){const y=new Float32Array(4*W.length/3);for(let c=0,A=0;c<W.length;c+=3,A+=4)y[A]=W[c],y[A+1]=W[c+1],y[A+2]=W[c+2],y[A+3]=1;l.My=y}else{if(4!==p.getSize())throw new Error(`Unexpected number of color components: ${p.getSize()}`);l.My=W}}return y.isVerticesDataPresent(N.e.MatricesIndicesKind)&&(l.matricesIndices=y.getVerticesData(N.e.MatricesIndicesKind,c,A)),y.isVerticesDataPresent(N.e.MatricesWeightsKind)&&(l.matricesWeights=y.getVerticesData(N.e.MatricesWeightsKind,c,A)),y.isVerticesDataPresent(N.e.MatricesIndicesExtraKind)&&(l.matricesIndicesExtra=y.getVerticesData(N.e.MatricesIndicesExtraKind,c,A)),y.isVerticesDataPresent(N.e.MatricesWeightsExtraKind)&&(l.matricesWeightsExtra=y.getVerticesData(N.e.MatricesWeightsExtraKind,c,A)),l.indices=y.rc(c,A),l}static CreateRibbon(y){throw(0,p.d)("ribbonBuilder")}static CreateBox(y){throw(0,p.d)("boxBuilder")}static CreateTiledBox(y){throw(0,p.d)("tiledBoxBuilder")}static CreateTiledPlane(y){throw(0,p.d)("tiledPlaneBuilder")}static CreateSphere(y){throw(0,p.d)("sphereBuilder")}static CreateCylinder(y){throw(0,p.d)("cylinderBuilder")}static CreateTorus(y){throw(0,p.d)("torusBuilder")}static CreateLineSystem(y){throw(0,p.d)("linesBuilder")}static CreateDashedLines(y){throw(0,p.d)("linesBuilder")}static CreateGround(y){throw(0,p.d)("groundBuilder")}static CreateTiledGround(y){throw(0,p.d)("groundBuilder")}static CreateGroundFromHeightMap(y){throw(0,p.d)("groundBuilder")}static dI(y){throw(0,p.d)("planeBuilder")}static CreateDisc(y){throw(0,p.d)("discBuilder")}static CreatePolygon(y,c,A,l,w,N,W){throw(0,p.d)("polygonBuilder")}static CreateIcoSphere(y){throw(0,p.d)("icoSphereBuilder")}static CreatePolyhedron(y){throw(0,p.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||w.gc.Up();throw(0,p.d)("capsuleBuilder")}static CreateTorusKnot(y){throw(0,p.d)("torusKnotBuilder")}static ComputeNormals(y,c,A,l){let N=0,p=0,W=0,h=0,I=0,q=0,o=0,O=0,L=0,i=0,H=0,P=0,D=0,t=0,s=0,B=0,X=0,C=0,K=0,my=0,T=!1,z=!1,S=!1,M=!1,k=1,a=0,u=null;l&&(T=!!l.facetNormals,z=!!l.facetPositions,S=!!l.facetPartitioning,k=!0===l.useRightHandedSystem?-1:1,a=l.ratio||0,M=!!l.depthSort,u=l.distanceTo,M&&void 0===u&&(u=w.gc.Zero()));let G=0,j=0,f=0,V=0;for(S&&l&&l.bbSize&&(G=l.subDiv.X*a/l.bbSize.x,j=l.subDiv.Y*a/l.bbSize.y,f=l.subDiv.Z*a/l.bbSize.z,V=l.subDiv.max*l.subDiv.max,l.facetPartitioning.length=0),N=0;N<y.length;N++)A[N]=0;const J=c.length/3|0;for(N=0;N<J;N++){if(P=3*c[3*N],D=P+1,t=P+2,s=3*c[3*N+1],B=s+1,X=s+2,C=3*c[3*N+2],K=C+1,my=C+2,p=y[P]-y[s],W=y[D]-y[B],h=y[t]-y[X],I=y[C]-y[s],q=y[K]-y[B],o=y[my]-y[X],O=k*(W*o-h*q),L=k*(h*I-p*o),i=k*(p*q-W*I),H=Math.sqrt(O*O+L*L+i*i),H=0===H?1:H,O/=H,L/=H,i/=H,T&&l&&(l.facetNormals[N].x=O,l.facetNormals[N].y=L,l.facetNormals[N].z=i),z&&l&&(l.facetPositions[N].x=(y[P]+y[s]+y[C])/3,l.facetPositions[N].y=(y[D]+y[B]+y[K])/3,l.facetPositions[N].z=(y[t]+y[X]+y[my])/3),S&&l){const c=Math.floor((l.facetPositions[N].x-l.bInfo.minimum.x*a)*G),A=Math.floor((l.facetPositions[N].y-l.bInfo.minimum.y*a)*j),w=Math.floor((l.facetPositions[N].z-l.bInfo.minimum.z*a)*f),p=Math.floor((y[P]-l.bInfo.minimum.x*a)*G),W=Math.floor((y[D]-l.bInfo.minimum.y*a)*j),h=Math.floor((y[t]-l.bInfo.minimum.z*a)*f),I=Math.floor((y[s]-l.bInfo.minimum.x*a)*G),q=Math.floor((y[B]-l.bInfo.minimum.y*a)*j),o=Math.floor((y[X]-l.bInfo.minimum.z*a)*f),O=Math.floor((y[C]-l.bInfo.minimum.x*a)*G),L=Math.floor((y[K]-l.bInfo.minimum.y*a)*j),i=Math.floor((y[my]-l.bInfo.minimum.z*a)*f),H=p+l.subDiv.max*W+V*h,T=I+l.subDiv.max*q+V*o,z=O+l.subDiv.max*L+V*i,S=c+l.subDiv.max*A+V*w;l.facetPartitioning[S]=l.facetPartitioning[S]?l.facetPartitioning[S]:[],l.facetPartitioning[H]=l.facetPartitioning[H]?l.facetPartitioning[H]:[],l.facetPartitioning[T]=l.facetPartitioning[T]?l.facetPartitioning[T]:[],l.facetPartitioning[z]=l.facetPartitioning[z]?l.facetPartitioning[z]:[],l.facetPartitioning[H].push(N),T!=H&&l.facetPartitioning[T].push(N),z!=T&&z!=H&&l.facetPartitioning[z].push(N),S!=H&&S!=T&&S!=z&&l.facetPartitioning[S].push(N)}if(M&&l&&l.facetPositions){const y=l.depthSortedFacets[N];y.ind=3*N,y.sqDistance=w.gc.DistanceSquared(l.facetPositions[N],u)}A[P]+=O,A[D]+=L,A[t]+=i,A[s]+=O,A[B]+=L,A[X]+=i,A[C]+=O,A[K]+=L,A[my]+=i}for(N=0;N<A.length/3;N++)O=A[3*N],L=A[3*N+1],i=A[3*N+2],H=Math.sqrt(O*O+L*L+i*i),H=0===H?1:H,O/=H,L/=H,i/=H,A[3*N]=O,A[3*N+1]=L,A[3*N+2]=i}static _ComputeSides(y,c,A,l,N,p,W){const h=A.length,I=l.length;let q,o;switch(y=y||i.DEFAULTSIDE){case i.FRONTSIDE:break;case i.BACKSIDE:for(q=0;q<h;q+=3){const y=A[q];A[q]=A[q+2],A[q+2]=y}for(o=0;o<I;o++)l[o]=-l[o];break;case i.DOUBLESIDE:{const y=c.length,O=y/3;for(let A=0;A<y;A++)c[y+A]=c[A];for(q=0;q<h;q+=3)A[q+h]=A[q+2]+O,A[q+1+h]=A[q+1]+O,A[q+2+h]=A[q]+O;for(o=0;o<I;o++)l[I+o]=-l[o];const L=N.length;let i=0;for(i=0;i<L;i++)N[i+L]=N[i];for(p=p||new w.Vector4(0,0,1,1),W=W||new w.Vector4(0,0,1,1),i=0,q=0;q<L/2;q++)N[i]=p.x+(p.z-p.x)*N[i],N[i+1]=p.y+(p.w-p.y)*N[i+1],N[i+L]=W.x+(W.z-W.x)*N[i+L],N[i+L+1]=W.y+(W.w-W.y)*N[i+L+1],i+=2;break}}}static Parse(y){const c=new i,A=y.zy;A&&c.set(A,N.e.PositionKind);const l=y.Sy;l&&c.set(l,N.e.NormalKind);const w=y.tangents;w&&c.set(w,N.e.TangentKind);const p=y.ky;p&&c.set(p,N.e.UVKind);const h=y.uvs2;h&&c.set(h,N.e.UV2Kind);const I=y.uvs3;I&&c.set(I,N.e.UV3Kind);const q=y.uvs4;q&&c.set(q,N.e.UV4Kind);const o=y.uvs5;o&&c.set(o,N.e.UV5Kind);const O=y.uvs6;O&&c.set(O,N.e.UV6Kind);const H=y.My;H&&(c.set(W.ip.CheckColors4(H,A.length/3),N.e.ColorKind),void 0!==y.hasVertexAlpha&&(c.hasVertexAlpha=y.hasVertexAlpha));const P=y.matricesIndices;P&&c.set(P,N.e.MatricesIndicesKind);const D=y.matricesWeights;D&&c.set(D,N.e.MatricesWeightsKind);const t=y.indices;t&&(c.indices=t);const s=y.materialInfos;if(s){c.materialInfos=[];for(const y of s){const A=new L;A.indexCount=y.indexCount,A.indexStart=y.indexStart,A.verticesCount=y.verticesCount,A.verticesStart=y.verticesStart,A.materialIndex=y.materialIndex,c.materialInfos.push(A)}}return c}static ImportVertexData(y,c){const A=i.Parse(y);c.setAllVerticesData(A,y.updatable)}}i.FRONTSIDE=0,i.BACKSIDE=1,i.DOUBLESIDE=2,i.DEFAULTSIDE=0,i._UniqueIdGenerator=0,(0,l.b)([I.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l]=c;return!Array.isArray(l)}))],i,"_TransformVector3Coordinates",null),(0,l.b)([I.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l]=c;return!Array.isArray(l)}))],i,"_TransformVector3Normals",null),(0,l.b)([I.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l]=c;return!Array.isArray(l)}))],i,"_TransformVector4Normals",null),(0,l.b)([I.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l]=c;return!Array.isArray(l)}))],i,"_FlipFaces",null)},12885:(y,c,A)=>{var l=A(12773),w=A(12400),N=A(12325),p=A(12161),W=A(12654);l.b.prototype.thinInstanceAdd=function(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.mc().getEngine().getCaps().instancedArrays)return p.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(y)?y.length:1);const A=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(y))for(let l=0;l<y.length;++l)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,y[l],l===y.length-1&&c);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,y,c);return A},l.b.prototype.thinInstanceAddSelf=function(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(N.Matrix.IdentityReadOnly,y)},l.b.prototype.thinInstanceRegisterAttribute=function(y,c){y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),this.removeVerticesData(y),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[y]=c,this._userThinInstanceBuffersStorage.sizes[y]=c*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[y]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[y]),this._userThinInstanceBuffersStorage.vertexBuffers[y]=new w.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[y],y,!0,!1,c,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])},l.b.prototype.thinInstanceSetMatrixAt=function(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||y>=this._thinInstanceDataStorage.instancesCount)return!1;const l=this._thinInstanceDataStorage.matrixData;return c.copyToArray(l,16*y),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[y]=c),A&&(this.Zo("matrix"),this.jy||this.thinInstanceRefreshBoundingInfo(!1)),!0},l.b.prototype.thinInstanceSetAttributeAt=function(y,c,A){let l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[y]||c>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(y,0),this._userThinInstanceBuffersStorage.data[y].set(A,c*this._userThinInstanceBuffersStorage.strides[y]),l&&this.Zo(y),!0)},Object.defineProperty(l.b.prototype,"dp",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(y){var c;const A=this._thinInstanceDataStorage.matrixData??(null===(c=this.source)||void 0===c?void 0:c._thinInstanceDataStorage.matrixData);y<=(A?A.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=y)},enumerable:!0,configurable:!0}),l.b.prototype._thinInstanceCreateMatrixBuffer=function(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=new w.c(this.getEngine(),c,!A,16,!1,!0);for(let w=0;w<4;w++)this.setVerticesBuffer(l.createVertexBuffer(y+w,4*w,4));return l},l.b.prototype.bo=function(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var N;if(A=A||16,"matrix"===y)null===(N=this._thinInstanceDataStorage.matrixBuffer)||void 0===N||N.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=c?c.length:32*A,this._thinInstanceDataStorage.matrixData=c,this._thinInstanceDataStorage.worldMatrices=null,null!==c?(this._thinInstanceDataStorage.instancesCount=c.length/A,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",c,l),this.jy||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.jy||this.refreshBoundingInfo());else if("previousMatrix"===y){var p;null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=c,null!==c&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",c,l))}else{var W;if(y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),null===c)null!==(W=this._userThinInstanceBuffersStorage)&&void 0!==W&&W.data[y]&&(this.removeVerticesData(y),delete this._userThinInstanceBuffersStorage.data[y],delete this._userThinInstanceBuffersStorage.strides[y],delete this._userThinInstanceBuffersStorage.sizes[y],delete this._userThinInstanceBuffersStorage.vertexBuffers[y]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[y]=c,this._userThinInstanceBuffersStorage.strides[y]=A,this._userThinInstanceBuffersStorage.sizes[y]=c.length,this._userThinInstanceBuffersStorage.vertexBuffers[y]=new w.e(this.getEngine(),c,y,!l,!1,A,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},l.b.prototype.Zo=function(y){var c;if("matrix"===y)this.bO&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(y),null===(c=this._thinInstanceDataStorage.matrixBuffer)||void 0===c||c.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===y){var A;this.bO&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(y),null===(A=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===A||A.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var l;y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),null!==(l=this._userThinInstanceBuffersStorage)&&void 0!==l&&l.vertexBuffers[y]&&(this.bO&&!this._userThinInstanceBuffersStorage.vertexBuffers[y].isUpdatable()&&this._thinInstanceRecreateBuffer(y),this._userThinInstanceBuffersStorage.vertexBuffers[y].updateDirectly(this._userThinInstanceBuffersStorage.data[y],0))}},l.b.prototype.thinInstancePartialBufferUpdate=function(y,c,A){var l;"matrix"===y?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(c,A):(y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),null!==(l=this._userThinInstanceBuffersStorage)&&void 0!==l&&l.vertexBuffers[y]&&this._userThinInstanceBuffersStorage.vertexBuffers[y].updateDirectly(c,A))},l.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const y=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let c=0;c<this._thinInstanceDataStorage.instancesCount;++c)this._thinInstanceDataStorage.worldMatrices[c]=N.Matrix.yA(y,16*c)}return this._thinInstanceDataStorage.worldMatrices},l.b.prototype.thinInstanceRefreshBoundingInfo=function(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const l=this._thinInstanceDataStorage.boundingVectors;if(y||!this.rawBoundingInfo){l.length=0,this.refreshBoundingInfo(c,A);const y=this.getBoundingInfo();this.rawBoundingInfo=new W.d(y.minimum,y.maximum)}const w=this.getBoundingInfo(),p=this._thinInstanceDataStorage.matrixData;if(0===l.length)for(let N=0;N<w.boundingBox.vectors.length;++N)l.push(w.boundingBox.vectors[N].clone());N.TmpVectors.gc[0].vc(Number.POSITIVE_INFINITY),N.TmpVectors.gc[1].vc(Number.NEGATIVE_INFINITY);for(let W=0;W<this._thinInstanceDataStorage.instancesCount;++W){N.Matrix.FromArrayToRef(p,16*W,N.TmpVectors.Matrix[0]);for(let y=0;y<l.length;++y)N.gc.TransformCoordinatesToRef(l[y],N.TmpVectors.Matrix[0],N.TmpVectors.gc[2]),N.TmpVectors.gc[0].minimizeInPlace(N.TmpVectors.gc[2]),N.TmpVectors.gc[1].maximizeInPlace(N.TmpVectors.gc[2])}w.reConstruct(N.TmpVectors.gc[0],N.TmpVectors.gc[1]),this.Vy()},l.b.prototype._thinInstanceRecreateBuffer=function(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var A;if("matrix"===y)null===(A=this._thinInstanceDataStorage.matrixBuffer)||void 0===A||A.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,c);else if("previousMatrix"===y){var l;if(this._scene.needsPreviousWorldMatrices)null===(l=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===l||l.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,c)}else{var N;y===w.e.ColorKind&&(y=w.e.ColorInstanceKind),null===(N=this._userThinInstanceBuffersStorage.vertexBuffers[y])||void 0===N||N.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[y]=new w.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[y],y,!c,!1,this._userThinInstanceBuffersStorage.strides[y],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},l.b.prototype._thinInstanceUpdateBufferSize=function(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;y===w.e.ColorKind&&(y=w.e.ColorInstanceKind);const A="matrix"===y;if(!A&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[y]))return;const l=A?16:this._userThinInstanceBuffersStorage.strides[y],N=A?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[y];let p=A?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[y];const W=(this._thinInstanceDataStorage.instancesCount+c)*l;let h=N;for(;h<W;)h*=2;if(!p||N!=h){if(p){const y=new Float32Array(h);y.set(p,0),p=y}else p=new Float32Array(h);var I,q,o;if(A){if(null===(I=this._thinInstanceDataStorage.matrixBuffer)||void 0===I||I.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,!1),this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.matrixBufferSize=h,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(q=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===q||q.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,!1)}else null===(o=this._userThinInstanceBuffersStorage.vertexBuffers[y])||void 0===o||o.dispose(),this._userThinInstanceBuffersStorage.data[y]=p,this._userThinInstanceBuffersStorage.sizes[y]=h,this._userThinInstanceBuffersStorage.vertexBuffers[y]=new w.e(this.getEngine(),p,y,!0,!1,l,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[y])}},l.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},l.b.prototype._disposeThinInstanceSpecificData=function(){var y;null!==(y=this._thinInstanceDataStorage)&&void 0!==y&&y.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},12737:(y,c,A)=>{A.d(c,{d:()=>q});var l=A(12307),w=A(12310),N=A(12363),p=A(12153),W=A(12325),h=A(12743),I=A(12283);class q extends h.b{get billboardMode(){return this._billboardMode}set billboardMode(y){this._billboardMode!==y&&(this._billboardMode=y,this._cache.useBillboardPosition=0!==(this._billboardMode&q.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(y){this._infiniteDistance!==y&&(this._infiniteDistance=y)}constructor(y){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new W.gc(0,0,1),this._up=new W.gc(0,1,0),this._right=new W.gc(1,0,0),this._position=W.gc.Zero(),this._rotation=W.gc.Zero(),this._rotationQuaternion=null,this._scaling=W.gc.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=q.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.vO=W.Matrix.Zero(),this._usePivotMatrix=!1,this._absolutePosition=W.gc.Zero(),this._absoluteScaling=W.gc.Zero(),this._absoluteRotationQuaternion=W.Quaternion.Identity(),this._pivotMatrix=W.Matrix.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new p.d,this._nonUniformScaling=!1,c&&this.mc().addTransformNode(this)}getClassName(){return"Nh"}get position(){return this._position}set position(y){this._position=y,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(y){this._rotation=y,this._rotationQuaternion=null,this._markAsDirtyInternal()}get bc(){return this._scaling}set bc(y){this._scaling=y,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(y){this._rotationQuaternion=y,y&&this._rotation.vc(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return W.gc.TransformNormalFromFloatsToRef(0,0,this.mc().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return W.gc.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return W.gc.TransformNormalFromFloatsToRef(this.mc().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(y){return this._poseMatrix?(this._poseMatrix.p(y),this):(this._poseMatrix=y.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=W.Matrix.Identity()),this._poseMatrix}_isSynchronized(){const y=this._cache;return this._billboardMode===y.billboardMode&&this._billboardMode===q.BILLBOARDMODE_NONE&&(!y.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const y=this._cache;y.localMatrixUpdated=!1,y.billboardMode=-1,y.infiniteDistance=!1,y.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(y){return this.setPivotMatrix(y,!1)}setPivotMatrix(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(y),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=c,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=W.Matrix.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const l=this.clone("Clone of "+(this.name||this.id),y||this.parent,!0);l&&A&&A(this,l);for(const w of this.getChildTransformNodes(!0))w.instantiateHierarchy(l,c,A);return l}xW(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.vc(0),this._rotationQuaternion=this._rotationQuaternion||W.Quaternion.Identity(),y.decompose(this._scaling,this._rotationQuaternion,this._position),this.Yc(!0)):(this._worldMatrix=y,this._absolutePosition.Ec(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Yc(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Yc(!0),this}get SO(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Yc(),this._absolutePosition}setAbsolutePosition(y){if(!y)return this;let c,A,l;if(void 0===y.x){if(arguments.length<3)return this;c=arguments[0],A=arguments[1],l=arguments[2]}else c=y.x,A=y.y,l=y.z;if(this.parent){const y=W.TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(y),W.gc.TransformCoordinatesFromFloatsToRef(c,A,l,y,this.position)}else this.position.x=c,this.position.y=A,this.position.z=l;return this._absolutePosition.p(y),this}setPositionWithLocalVector(y){return this.Yc(),this.position=W.gc.TransformNormal(y,this.vO),this}getPositionExpressedInLocalSpace(){this.Yc();const y=W.TmpVectors.Matrix[0];return this.vO.invertToRef(y),W.gc.TransformNormal(this.position,y)}locallyTranslate(y){return this.Yc(!0),this.position=W.gc.TransformCoordinates(y,this.vO),this}lookAt(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const N=q._LookAtVectorCache,p=0===w?this.position:this.getAbsolutePosition();if(y.subtractToRef(p,N),this.setDirection(N,c,A,l),1===w&&this.parent)if(this.rotationQuaternion){const y=W.TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(y);const c=W.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),y.multiplyToRef(c,y),this.rotationQuaternion.fromRotationMatrix(y)}else{const y=W.TmpVectors.Quaternion[0];W.Quaternion.FromEulerVectorToRef(this.rotation,y);const c=W.TmpVectors.Matrix[0];y.toRotationMatrix(c);const A=W.TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(A),A.invert(),c.multiplyToRef(A,c),y.fromRotationMatrix(c),y.toEulerAnglesToRef(this.rotation)}return this}Zh(y){const c=W.gc.Zero();return this.getDirectionToRef(y,c),c}getDirectionToRef(y,c){return W.gc.TransformNormalToRef(y,this.getWorldMatrix(),c),this}setDirection(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const w=-Math.atan2(y.z,y.x)+Math.PI/2,N=Math.sqrt(y.x*y.x+y.z*y.z),p=-Math.atan2(y.y,N);return this.rotationQuaternion?W.Quaternion.RotationYawPitchRollToRef(w+c,p+A,l,this.rotationQuaternion):(this.rotation.x=p+A,this.rotation.y=w+c,this.rotation.z=l),this}setPivotPoint(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.mc().getRenderId()&&this.Yc(!0);const A=this.getWorldMatrix();if(1==c){const c=W.TmpVectors.Matrix[0];A.invertToRef(c),y=W.gc.TransformCoordinates(y,c)}return this.setPivotMatrix(W.Matrix.Translation(-y.x,-y.y,-y.z),!0)}getPivotPoint(){const y=W.gc.Zero();return this.getPivotPointToRef(y),y}getPivotPointToRef(y){return y.x=-this._pivotMatrix.m[12],y.y=-this._pivotMatrix.m[13],y.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const y=W.gc.Zero();return this.getAbsolutePivotPointToRef(y),y}getAbsolutePivotPointToRef(y){return this.getPivotPointToRef(y),W.gc.TransformCoordinatesToRef(y,this.getWorldMatrix(),y),this}Bq(y){if(this._isDirty)return this;if(this._children)for(const c of this._children)c.Bq(y);return super.Bq(y)}setParent(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!y&&!this.parent)return this;const l=W.TmpVectors.Quaternion[0],w=W.TmpVectors.gc[0],N=W.TmpVectors.gc[1],p=W.TmpVectors.Matrix[1];W.Matrix.IdentityToRef(p);const h=W.TmpVectors.Matrix[0];this.Yc(!0);let I=this.rotationQuaternion;return I||(I=q._TmpRotation,W.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,I)),W.Matrix.ComposeToRef(this.bc,I,this.position,h),this.parent&&h.multiplyToRef(this.parent.Yc(!0),h),y&&(y.Yc(!0).invertToRef(p),h.multiplyToRef(p,h)),h.decompose(N,l,w,c?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(l):l.toEulerAnglesToRef(this.rotation),this.bc.p(N),this.position.p(w),this.parent=y,A&&this.setPivotMatrix(W.Matrix.Identity()),this}addChild(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.setParent(this,c),this}removeChild(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y.parent!==this||y.setParent(null,c),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(y){return this._nonUniformScaling!==y&&(this._nonUniformScaling=y,!0)}attachToBone(y,c){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=c,this.parent=y,y.getSkeleton().prepare(!0),y.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=y?this._currentParentWhenAttachingToBone:null,this):(y&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(y,c,A){let l;if(y.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.vc(0)),A&&0!==A){if(this.parent){const A=this.parent.getWorldMatrix(),l=W.TmpVectors.Matrix[0];A.invertToRef(l),y=W.gc.TransformNormal(y,l),A.determinant()<0&&(c*=-1)}l=W.Quaternion.RotationAxisToRef(y,c,q._RotationAxisCache),l.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else l=W.Quaternion.RotationAxisToRef(y,c,q._RotationAxisCache),this.rotationQuaternion.multiplyToRef(l,this.rotationQuaternion);return this}rotateAround(y,c,A){c.normalize(),this.rotationQuaternion||(this.rotationQuaternion=W.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.vc(0));const l=W.TmpVectors.gc[0],w=W.TmpVectors.gc[1],N=W.TmpVectors.gc[2],p=W.TmpVectors.Quaternion[0],h=W.TmpVectors.Matrix[0],I=W.TmpVectors.Matrix[1],q=W.TmpVectors.Matrix[2],o=W.TmpVectors.Matrix[3];return y.subtractToRef(this.position,l),W.Matrix.TranslationToRef(l.x,l.y,l.z,h),W.Matrix.TranslationToRef(-l.x,-l.y,-l.z,I),W.Matrix.RotationAxisToRef(c,A,q),I.multiplyToRef(q,o),o.multiplyToRef(h,o),o.decompose(w,p,N),this.position.addInPlace(N),p.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(y,c,A){const l=y.scale(c);if(A&&0!==A)this.setAbsolutePosition(this.getAbsolutePosition().add(l));else{const y=this.getPositionExpressedInLocalSpace().add(l);this.setPositionWithLocalVector(y)}return this}addRotation(y,c,A){let l;this.rotationQuaternion?l=this.rotationQuaternion:(l=W.TmpVectors.Quaternion[1],W.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,l));const w=W.TmpVectors.Quaternion[0];return W.Quaternion.RotationYawPitchRollToRef(c,y,A,w),l.multiplyInPlace(w),this.rotationQuaternion||l.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==q.BILLBOARDMODE_NONE}Yc(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const A=this.mc().getRenderId();if(!this._isDirty&&!y&&(this._currentRenderId===A||this.isSynchronized()))return this._currentRenderId=A,this._worldMatrix;c=c||this.mc().activeCamera,this._updateCache();const l=this._cache;l.pivotMatrixUpdated=!1,l.billboardMode=this.billboardMode,l.infiniteDistance=this.infiniteDistance,l.parent=this._parentNode,this._currentRenderId=A,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const w=this._getEffectiveParent(),N=q._TmpScaling;let p,h=this._position;if(this._infiniteDistance&&!this.parent&&c){const y=c.getWorldMatrix(),A=new W.gc(y.m[12],y.m[13],y.m[14]);h=q._TmpTranslation,h.Ec(this._position.x+A.x,this._position.y+A.y,this._position.z+A.z)}if(N.Ec(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(W.Quaternion.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Ec(0,0,0))}}else p=q._TmpRotation,W.Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){const y=W.TmpVectors.Matrix[1];W.Matrix.ScalingToRef(N.x,N.y,N.z,y);const c=W.TmpVectors.Matrix[0];p.toRotationMatrix(c),this._pivotMatrix.multiplyToRef(y,W.TmpVectors.Matrix[4]),W.TmpVectors.Matrix[4].multiplyToRef(c,this.vO),this._postMultiplyPivotMatrix&&this.vO.multiplyToRef(this._pivotMatrixInverse,this.vO),this.vO.addTranslationFromFloats(h.x,h.y,h.z)}else W.Matrix.ComposeToRef(N,p,h,this.vO);if(w&&w.getWorldMatrix){if(y&&w.Yc(y),this.billboardMode){if(this._transformToBoneReferal){const y=this.parent;y.getSkeleton().prepare(),y.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),W.TmpVectors.Matrix[7])}else W.TmpVectors.Matrix[7].p(w.getWorldMatrix());const y=W.TmpVectors.gc[5],c=W.TmpVectors.gc[6],A=W.TmpVectors.Quaternion[0];W.TmpVectors.Matrix[7].decompose(c,A,y),W.Matrix.ScalingToRef(c.x,c.y,c.z,W.TmpVectors.Matrix[7]),W.TmpVectors.Matrix[7].setTranslation(y),q.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(A,y),this.vO.setTranslation(y)),this.vO.multiplyToRef(W.TmpVectors.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const y=this.parent;y.getSkeleton().prepare(),this.vO.multiplyToRef(y.getFinalMatrix(),W.TmpVectors.Matrix[6]),W.TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.vO.multiplyToRef(w.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.vO);if(c&&this.billboardMode)if(l.useBillboardPosition){if(l.useBillboardPosition){const y=W.TmpVectors.gc[0];this._worldMatrix.getTranslationToRef(y);const A=c.globalPosition;this._worldMatrix.invertToRef(W.TmpVectors.Matrix[1]);const l=W.TmpVectors.gc[1];W.gc.TransformCoordinatesToRef(A,W.TmpVectors.Matrix[1],l),l.normalize();const w=-Math.atan2(l.z,l.x)+Math.PI/2,N=Math.sqrt(l.x*l.x+l.z*l.z),p=-Math.atan2(l.y,N);if(W.Quaternion.RotationYawPitchRollToRef(w,p,0,W.TmpVectors.Quaternion[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){const y=W.TmpVectors.gc[1];W.TmpVectors.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(y.z=0),W.Matrix.RotationYawPitchRollToRef(y.y,y.x,y.z,W.TmpVectors.Matrix[0])}else W.Matrix.FromQuaternionToRef(W.TmpVectors.Quaternion[0],W.TmpVectors.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(W.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(W.TmpVectors.gc[0])}}else{const y=W.TmpVectors.gc[0];if(this._worldMatrix.getTranslationToRef(y),W.TmpVectors.Matrix[1].p(c.getViewMatrix()),W.TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0),W.TmpVectors.Matrix[1].invertToRef(W.TmpVectors.Matrix[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){W.TmpVectors.Matrix[0].decompose(void 0,W.TmpVectors.Quaternion[0],void 0);const y=W.TmpVectors.gc[1];W.TmpVectors.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(y.z=0),W.Matrix.RotationYawPitchRollToRef(y.y,y.x,y.z,W.TmpVectors.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(W.TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(W.TmpVectors.gc[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):w&&w._nonUniformScaling?this._updateNonUniformScalingState(w._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Ec(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=W.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Yc(),y){const y=this.getChildren();for(let c=0;c<y.length;++c){const A=y[c];if(A){A.Yc();const y=W.TmpVectors.Matrix[0];A.vO.multiplyToRef(this.vO,y);const c=W.TmpVectors.Quaternion[0];y.decompose(A.bc,c,A.position),A.rotationQuaternion?A.rotationQuaternion.p(c):c.toEulerAnglesToRef(A.rotation)}}}this.bc.Ec(1,1,1),this.position.Ec(0,0,0),this.rotation.Ec(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=W.Quaternion.Identity()),this._worldMatrix=W.Matrix.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(y){return this.onAfterWorldMatrixUpdateObservable.add(y),this}unregisterAfterWorldMatrixUpdate(y){return this.onAfterWorldMatrixUpdateObservable.removeCallback(y),this}getPositionInCameraSpace(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y||(y=this.mc().activeCamera),W.gc.TransformCoordinates(this.getAbsolutePosition(),y.getViewMatrix())}getDistanceToCamera(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y||(y=this.mc().activeCamera),this.getAbsolutePosition().xc(y.globalPosition).length()}clone(y,c,A){const l=N.d.Clone((()=>new q(y,this.mc())),this);if(l.name=y,l.id=y,c&&(l.parent=c),!A){const c=this.getDescendants(!0);for(let A=0;A<c.length;A++){const w=c[A];w.clone&&w.clone(y+"."+w.name,l)}}return l}serialize(y){const c=N.d.Serialize(this,y);return c.type=this.getClassName(),c.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(c),c.localMatrix=this.getPivotMatrix().fc(),c.isEnabled=this.isEnabled(),N.d.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c}static Parse(y,c,A){const l=N.d.Parse((()=>new q(y.name,c)),y,c,A);if(y.localMatrix?l.setPreTransformMatrix(W.Matrix.yA(y.localMatrix)):y.pivotMatrix&&l.setPivotMatrix(W.Matrix.yA(y.pivotMatrix)),l.ph(y.isEnabled),l._waitingParsedUniqueId=y.uniqueId,void 0!==y.parentId&&(l._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(l._waitingParentInstanceIndex=y.parentInstanceIndex),y.animations){for(let c=0;c<y.animations.length;c++){const A=y.animations[c],w=(0,I.d)("BABYLON.Animation");w&&l.animations.push(w.Parse(A))}h.b.ParseAnimationRanges(l,y,c)}return y.autoAnimate&&c.beginAnimation(l,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),l}getChildTransformNodes(y,c){const A=[];return this._getDescendants(A,y,(y=>(!c||c(y))&&y instanceof q)),A}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.mc().stopAnimation(this),this.mc().removeTransformNode(this),this._parentContainer){const y=this._parentContainer.transformNodes.indexOf(this);y>-1&&this._parentContainer.transformNodes.splice(y,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),y){const y=this.getChildTransformNodes(!0);for(const c of y)c.parent=null,c.Yc(!0)}super.dispose(y,c)}normalizeToUnitCube(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,l=null,w=null;c&&(this.rotationQuaternion?(w=this.rotationQuaternion.clone(),this.rotationQuaternion.Ec(0,0,0,1)):this.rotation&&(l=this.rotation.clone(),this.rotation.Ec(0,0,0)));const N=this.getHierarchyBoundingVectors(y,A),p=N.max.xc(N.min),W=Math.max(p.x,p.y,p.z);if(0===W)return this;const h=1/W;return this.bc.scaleInPlace(h),c&&(this.rotationQuaternion&&w?this.rotationQuaternion.p(w):this.rotation&&l&&this.rotation.p(l)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}q.BILLBOARDMODE_NONE=0,q.BILLBOARDMODE_X=1,q.BILLBOARDMODE_Y=2,q.BILLBOARDMODE_Z=4,q.BILLBOARDMODE_ALL=7,q.BILLBOARDMODE_USE_POSITION=128,q.BillboardUseParentOrientation=!1,q._TmpRotation=W.Quaternion.Zero(),q._TmpScaling=W.gc.Zero(),q._TmpTranslation=W.gc.Zero(),q._LookAtVectorCache=new W.gc(0,0,0),q._RotationAxisCache=new W.Quaternion,(0,l.b)([(0,w.M)("position")],q.prototype,"_position",void 0),(0,l.b)([(0,w.M)("rotation")],q.prototype,"_rotation",void 0),(0,l.b)([(0,w.C)("rotationQuaternion")],q.prototype,"_rotationQuaternion",void 0),(0,l.b)([(0,w.M)("bc")],q.prototype,"_scaling",void 0),(0,l.b)([(0,w.P)("billboardMode")],q.prototype,"_billboardMode",void 0),(0,l.b)([(0,w.P)()],q.prototype,"scalingDeterminant",void 0),(0,l.b)([(0,w.P)("infiniteDistance")],q.prototype,"_infiniteDistance",void 0),(0,l.b)([(0,w.P)()],q.prototype,"ignoreNonUniformScaling",void 0),(0,l.b)([(0,w.P)()],q.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12813:(y,c,A)=>{A.d(c,{c:()=>p});var l=A(12303),w=A(12820);let N=0;const p=y=>{if(!y.environmentBRDFTexture){const c=y.useDelayedTextureLoading;y.useDelayedTextureLoading=!1;const A=y._blockEntityCollection;y._blockEntityCollection=!1;const p=l.d.CreateFromBase64String("data:image/png;base64,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","EnvironmentBRDFTexture"+N++,y,!0,!1,l.d.BILINEAR_SAMPLINGMODE);y._blockEntityCollection=A;const W=y.getEngine().getLoadedTexturesCache(),h=W.indexOf(p.getInternalTexture());-1!==h&&W.splice(h,1),p.isRGBD=!0,p.wrapU=l.d.CLAMP_ADDRESSMODE,p.wrapV=l.d.CLAMP_ADDRESSMODE,y.environmentBRDFTexture=p,y.useDelayedTextureLoading=c,w.e.ExpandRGBDTexture(p);const I=y.getEngine().onContextRestoredObservable.add((()=>{p.isRGBD=!0;const c=y.onBeforeRenderObservable.add((()=>{p.isReady()&&(y.onBeforeRenderObservable.remove(c),w.e.ExpandRGBDTexture(p))}))}));y.zc.add((()=>{y.getEngine().onContextRestoredObservable.remove(I)}))}return y.environmentBRDFTexture}},12765:(y,c,A)=>{function l(y,c,A){try{const l=y.next();l.done?c(l):l.value?l.value.then((()=>{l.value=void 0,c(l)}),A):c(l)}catch(l){A(l)}}function w(){let y,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(A,w,N)=>{const p=performance.now();void 0===y||p-y>c?(y=p,setTimeout((()=>{l(A,w,N)}),0)):l(A,w,N)}}function N(y,c,A,l,w){const N=()=>{let p;const W=y=>{y.done?A(y.value):void 0===p?p=!0:N()};do{p=void 0,w&&w.aborted?l(new Error("Aborted")):c(y,W,l),void 0===p&&(p=!1)}while(p)};N()}function p(y,c){let A;return N(y,l,(y=>A=y),(y=>{throw y}),c),A}async function W(y,c,A){return await new Promise(((l,w)=>{N(y,c,l,w,A)}))}function h(y,c){return function(){return p(y(...arguments),c)}}A.d(c,{e:()=>w,f:()=>h,j:()=>W,l:()=>p})},12913:(y,c,A)=>{function l(){const y=y=>!!y&&"object"===typeof y;for(var c=arguments.length,A=new Array(c),w=0;w<c;w++)A[w]=arguments[w];return A.reduce(((c,A)=>{const w=Object.keys(A);for(const N of w){const w=c[N],p=A[N];Array.isArray(w)&&Array.isArray(p)?c[N]=w.concat(...p):y(w)&&y(p)?c[N]=l(w,p):c[N]=p}return c}),{})}A.d(c,{d:()=>l})},12894:(y,c,A)=>{A.d(c,{b:()=>w});class l{constructor(y){this._pendingActions=new Array,this._workerInfos=y.map((y=>({workerPromise:Promise.resolve(y),idle:!0})))}dispose(){for(const y of this._workerInfos)y.workerPromise.then((y=>{y.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(y){this._executeOnIdleWorker(y)||this._pendingActions.push(y)}_executeOnIdleWorker(y){for(const c of this._workerInfos)if(c.idle)return this._execute(c,y),!0;return!1}_execute(y,c){y.idle=!1,y.workerPromise.then((A=>{c(A,(()=>{const c=this._pendingActions.shift();c?this._execute(y,c):y.idle=!0}))}))}}class w extends l{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.DefaultOptions;super([]),this._maxWorkers=y,this._createWorkerAsync=c,this._options=A}push(y){if(!this._executeOnIdleWorker(y))if(this._workerInfos.length<this._maxWorkers){const c={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(c),this._execute(c,y)}else this._pendingActions.push(y)}_execute(y,c){y.timeoutId&&(clearTimeout(y.timeoutId),delete y.timeoutId),super._execute(y,((A,l)=>{c(A,(()=>{l(),y.idle&&(y.timeoutId=setTimeout((()=>{y.workerPromise.then((y=>{y.terminate()}));const c=this._workerInfos.indexOf(y);-1!==c&&this._workerInfos.splice(c,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}w.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12852:(y,c,A)=>{A.d(c,{b:()=>q});var l=A(12307),w=A(12153),N=A(12184),p=A(12400),W=A(12310),h=A(12363),I=A(12283);class q{get influence(){return this._influence}set influence(y){if(this._influence===y)return;const c=this._influence;this._influence=y,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===c||0===y)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=y,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new w.d,this._onDataLayoutChanged=new w.d,this._animationPropertiesOverride=null,this.id=y,this._scene=A||N.c.LastCreatedScene,this.influence=c,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(y){const c=this.hasPositions;this._positions=y,c!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(y){const c=this.hasNormals;this._normals=y,c!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(y){const c=this.hasTangents;this._tangents=y,c!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(y){const c=this.hasUVs;this._uvs=y,c!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(y){const c=this.hasUV2s;this._uv2s=y,c!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(y){const c=this.hasColors;this._colors=y,c!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const y=h.d.Clone((()=>new q(this.name,this.influence,this._scene)),this);return y._positions=this._positions,y._normals=this._normals,y._tangents=this._tangents,y._uvs=this._uvs,y._uv2s=this._uv2s,y._colors=this._colors,y}serialize(){const y={};return y.name=this.name,y.influence=this.influence,y.zy=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(y.id=this.id),this.hasNormals&&(y.Sy=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(y.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(y.ky=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(y.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(y.My=Array.prototype.slice.call(this.getColors())),h.d.AppendSerializedAnimations(this,y),y}getClassName(){return"MorphTarget"}static Parse(y,c){const A=new q(y.name,y.influence);if(A.setPositions(y.zy),null!=y.id&&(A.id=y.id),y.Sy&&A.setNormals(y.Sy),y.tangents&&A.setTangents(y.tangents),y.ky&&A.setUVs(y.ky),y.uv2s&&A.setUV2s(y.uv2s),y.My&&A.setColors(y.My),y.animations){for(let c=0;c<y.animations.length;c++){const l=y.animations[c],w=(0,I.d)("BABYLON.Animation");w&&A.animations.push(w.Parse(l))}y.autoAnimate&&c&&c.beginAnimation(A,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1)}return A}static FromMesh(y,c,A){c||(c=y.name);const l=new q(c,A,y.mc());return l.setPositions(y.getVerticesData(p.e.PositionKind)),y.isVerticesDataPresent(p.e.NormalKind)&&l.setNormals(y.getVerticesData(p.e.NormalKind)),y.isVerticesDataPresent(p.e.TangentKind)&&l.setTangents(y.getVerticesData(p.e.TangentKind)),y.isVerticesDataPresent(p.e.UVKind)&&l.setUVs(y.getVerticesData(p.e.UVKind)),y.isVerticesDataPresent(p.e.UV2Kind)&&l.setUV2s(y.getVerticesData(p.e.UV2Kind)),y.isVerticesDataPresent(p.e.ColorKind)&&l.setColors(y.getVerticesData(p.e.ColorKind)),l}}(0,l.b)([(0,W.P)()],q.prototype,"id",void 0)},12743:(y,c,A)=>{A.d(c,{b:()=>o});var l=A(12307),w=A(12325),N=A(12310),p=A(12153),W=A(12184),h=A(12178),I=A(12363);class q{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new p.d,this._onClonedObservable=new p.d}}class o{static AddNodeConstructor(y,c){this._NodeConstructors[y]=c}static Construct(y,c,A,l){const w=this._NodeConstructors[y];return w?w(c,A,l):null}set accessibilityTag(y){this._accessibilityTag=y,this.onAccessibilityTagChangedObservable.notifyObservers(y)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(y){this._nodeDataStorage._doNotSerialize=y}I(){return this._nodeDataStorage._isDisposed}set parent(y){if(this._parentNode===y)return;const c=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1),y||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=y,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),c||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(y){y.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const y=this._scene.rootNodes,c=y.length-1;y[this._nodeDataStorage._sceneRootNodesIndex]=y[c],y[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}getClassName(){return"Node"}set onDispose(y){this._onDisposeObserver&&this.zc.remove(this._onDisposeObserver),this._onDisposeObserver=this.zc.add(y)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new q,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new p.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=w.Matrix.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.zc=new p.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=y,this.id=y,this._scene=c||W.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),A&&this._addToSceneRootNodes()}mc(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(y)||(y.init(),this._scene.isLoading&&!c?this._scene.onDataLoadedObservable.addOnce((()=>{y.attach(this)})):y.attach(this),this._behaviors.push(y)),this}removeBehavior(y){const c=this._behaviors.indexOf(y);return-1===c||(this._behaviors[c].detach(),this._behaviors.splice(c,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(y){for(const c of this._behaviors)if(c.name===y)return c;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Yc(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(y){!y&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(y){return this.parent?this.parent._getActionManagerForTrigger(y,!1):null}_updateCache(y){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Bq(y){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const y of this._children)y._syncParentEnabledState()}ph(y){this._nodeDataStorage._isEnabled!==y&&(this._nodeDataStorage._isEnabled=y,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(y))}isDescendantOf(y){return!!this.parent&&(this.parent===y||this.parent.isDescendantOf(y))}_getDescendants(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;if(this._children)for(let l=0;l<this._children.length;l++){const w=this._children[l];A&&!A(w)||y.push(w),c||w._getDescendants(y,!1,A)}}getDescendants(y,c){const A=[];return this._getDescendants(A,y,c),A}getChildMeshes(y,c){const A=[];return this._getDescendants(A,y,(y=>(!c||c(y))&&void 0!==y.ro)),A}getChildren(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(c,y)}_setReady(y){y!==this._nodeDataStorage._isReady&&(y?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(y){for(let c=0;c<this.animations.length;c++){const A=this.animations[c];if(A.name===y)return A}return null}createAnimationRange(y,c,A){if(!this._ranges[y]){this._ranges[y]=o._AnimationRangeFactory(y,c,A);for(let l=0,w=this.animations.length;l<w;l++)this.animations[l]&&this.animations[l].createRange(y,c,A)}}deleteAnimationRange(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,l=this.animations.length;A<l;A++)this.animations[A]&&this.animations[A].deleteRange(y,c);this._ranges[y]=null}getAnimationRange(y){return this._ranges[y]||null}clone(y,c,A){const l=I.d.Clone((()=>new o(y,this.mc())),this);if(c&&(l.parent=c),!A){const c=this.getDescendants(!0);for(let A=0;A<c.length;A++){const w=c[A];w.clone(y+"."+w.name,l)}}return l}getAnimationRanges(){const y=[];let c;for(c in this._ranges)y.push(this._ranges[c]);return y}beginAnimation(y,c,A,l){const w=this.getAnimationRange(y);return w?this._scene.beginAnimation(this,w.from,w.to,c,A,l):null}serializeAnimationRanges(){const y=[];for(const c in this._ranges){const A=this._ranges[c];if(!A)continue;const l={};l.name=c,l.from=A.from,l.to=A.to,y.push(l)}return y}Yc(y){return this._worldMatrix||(this._worldMatrix=w.Matrix.Identity()),this._worldMatrix}dispose(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!y){const A=this.getDescendants(!0);for(const l of A)l.dispose(y,c)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.zc.notifyObservers(this),this.zc.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const A of this._behaviors)A.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(y,c,A){if(c.ranges)for(let l=0;l<c.ranges.length;l++){const A=c.ranges[l];y.createAnimationRange(A.name,A.from,A.to)}}getHierarchyBoundingVectors(){let y,c,A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.mc().incrementRenderId(),this.Yc(!0);const N=this;if(N.getBoundingInfo&&N.jc){const A=N.getBoundingInfo();y=A.boundingBox.minimumWorld.clone(),c=A.boundingBox.maximumWorld.clone()}else y=new w.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new w.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(A){const A=this.getDescendants(!1);for(const N of A){const A=N;if(A.Yc(!0),l&&!l(A))continue;if(!A.getBoundingInfo||0===A.getTotalVertices())continue;const p=A.getBoundingInfo().boundingBox,W=p.minimumWorld,h=p.maximumWorld;w.gc.CheckExtends(W,y,c),w.gc.CheckExtends(h,y,c)}}return{min:y,max:c}}}o._AnimationRangeFactory=(y,c,A)=>{throw(0,h.d)("AnimationRange")},o._NodeConstructors={},(0,l.b)([(0,N.P)()],o.prototype,"name",void 0),(0,l.b)([(0,N.P)()],o.prototype,"id",void 0),(0,l.b)([(0,N.P)()],o.prototype,"uniqueId",void 0),(0,l.b)([(0,N.P)()],o.prototype,"state",void 0),(0,l.b)([(0,N.P)()],o.prototype,"metadata",void 0)}}]);