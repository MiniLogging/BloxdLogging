"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[5],{2311:(t,q,S)=>{S.d(q,{b:()=>O});var o=S(653),B=S(658),z=S(485),L=S(678),r=S(523),e=S(624),C=(S(527),S(2289));class Z{get wrapU(){return this._wrapU}set wrapU(t){this._wrapU=t}get wrapV(){return this._wrapV}set wrapV(t){this._wrapV=t}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(t){this._texture&&(this._texture.isCube=t)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(t){this._texture&&(this._texture.is3D=t)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(t){this._texture&&(this._texture.is2DArray=t)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(t){return void 0!==(null===t||void 0===t?void 0:t.shareDepth)}constructor(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=C.d.Zero(),this._cachedBaseSize=C.d.Zero(),this._initialSamplingMode=2,this._texture=Z._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(t){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(t,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var b=S(701);class O extends Z{set Lj(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get Lj(){return this._hasAlpha}set getAlphaFromRGB(t){this._getAlphaFromRGB!==t&&(this._getAlphaFromRGB=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(t){this._coordinatesIndex!==t&&(this._coordinatesIndex=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(t){this._wrapU=t}get wrapV(){return this._wrapV}set wrapV(t){this._wrapV=t}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(t){this._texture?this._texture.isCube=t:this._isCube=t}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(t){this._texture&&(this._texture.is3D=t)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(t){this._texture&&(this._texture.is2DArray=t)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(t){var q;if(this._texture){if(this._texture._gammaSpace===t)return;this._texture._gammaSpace=t}else{if(this._gammaSpace===t)return;this._gammaSpace=t}null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(t){var q;t!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=t),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(t){this._texture&&(this._texture._lodGenerationOffset=t)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(t){this._texture&&(this._texture._lodGenerationScale=t)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(t){this._texture&&(this._texture._linearSpecularLOD=t)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(t){this._texture&&(this._texture._irradianceTexture=t)}get uid(){return this._uid||(this._uid=(0,e.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(t){this._onDisposeObserver&&this.Qi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qi.add(t)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=O.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Qi=new z.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?O._IsScene(t)?this._scene=t:this._engine=t:this._scene=r.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=q,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return L.e.IdentityReadOnly}getReflectionTextureMatrix(){return L.e.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(t){}get canRescale(){return!1}_getFromCache(t,q,S,o,B,z){const L=this._getEngine();if(!L)return null;const r=L._getUseSRGBBuffer(!!B,q),e=L.getLoadedTexturesCache();for(let C=0;C<e.length;C++){const L=e[C];if((void 0===B||r===L._useSRGBBuffer)&&(void 0===o||o===L.invertY)&&L.url===t&&L.generateMipMaps===!q&&(!S||S===L.samplingMode)&&(void 0===z||z===L.isCube))return L.incrementReferences(),L}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const t=this.va();t&&t.markAllMaterialsAsDirty(1)}readPixels(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const C=this._getEngine();if(!C)return null;const Z=this.getSize();let b=Z.width,O=Z.height;0!==q&&(b/=Math.pow(2,q),O/=Math.pow(2,q),b=Math.round(b),O=Math.round(O)),r=Math.min(b,r),e=Math.min(O,e);try{return this._texture.isCube?C._readTexturePixels(this._texture,r,e,t,q,S,o,B,z,L):C._readTexturePixels(this._texture,r,e,-1,q,S,o,B,z,L)}catch(i){return null}}_readPixelsSync(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const z=this.getSize();let L=z.width,r=z.height;const e=this._getEngine();if(!e)return null;0!=q&&(L/=Math.pow(2,q),r/=Math.pow(2,q),L=Math.round(L),r=Math.round(r));try{return this._texture.isCube?e._readTexturePixelsSync(this._texture,L,r,t,q,S,o,B):e._readTexturePixelsSync(this._texture,L,r,-1,q,S,o,B)}catch(C){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const t=this._scene.textures.indexOf(this);if(t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.Qi.notifyObservers(this),this.Qi.clear(),this.metadata=null,super.dispose()}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!t)return null;const q=b.b.Serialize(this);return b.b.AppendSerializedAnimations(this,q),q}static WhenAllReady(t,q){let S=t.length;if(0!==S)for(let o=0;o<t.length;o++){const B=t[o];if(B.isReady())0===--S&&q();else{const t=B.onLoadObservable;t?t.addOnce((()=>{0===--S&&q()})):0===--S&&q()}}else q()}static _IsScene(t){return"Scene"===t.getClassName()}}O.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,o.e)([(0,B.C)()],O.prototype,"uniqueId",void 0),(0,o.e)([(0,B.C)()],O.prototype,"name",void 0),(0,o.e)([(0,B.C)()],O.prototype,"displayName",void 0),(0,o.e)([(0,B.C)()],O.prototype,"metadata",void 0),(0,o.e)([(0,B.C)("Lj")],O.prototype,"_hasAlpha",void 0),(0,o.e)([(0,B.C)("getAlphaFromRGB")],O.prototype,"_getAlphaFromRGB",void 0),(0,o.e)([(0,B.C)()],O.prototype,"level",void 0),(0,o.e)([(0,B.C)("coordinatesIndex")],O.prototype,"_coordinatesIndex",void 0),(0,o.e)([(0,B.C)()],O.prototype,"optimizeUVAllocation",void 0),(0,o.e)([(0,B.C)("coordinatesMode")],O.prototype,"_coordinatesMode",void 0),(0,o.e)([(0,B.C)()],O.prototype,"wrapU",null),(0,o.e)([(0,B.C)()],O.prototype,"wrapV",null),(0,o.e)([(0,B.C)()],O.prototype,"wrapR",void 0),(0,o.e)([(0,B.C)()],O.prototype,"anisotropicFilteringLevel",void 0),(0,o.e)([(0,B.C)()],O.prototype,"isCube",null),(0,o.e)([(0,B.C)()],O.prototype,"is3D",null),(0,o.e)([(0,B.C)()],O.prototype,"is2DArray",null),(0,o.e)([(0,B.C)()],O.prototype,"gammaSpace",null),(0,o.e)([(0,B.C)()],O.prototype,"invertZ",void 0),(0,o.e)([(0,B.C)()],O.prototype,"lodLevelInAlpha",void 0),(0,o.e)([(0,B.C)()],O.prototype,"lodGenerationOffset",null),(0,o.e)([(0,B.C)()],O.prototype,"lodGenerationScale",null),(0,o.e)([(0,B.C)()],O.prototype,"linearSpecularLOD",null),(0,o.e)([(0,B.v)()],O.prototype,"irradianceTexture",null),(0,o.e)([(0,B.C)()],O.prototype,"isRenderTarget",void 0)},2306:(t,q,S)=>{S.d(q,{b:()=>M});var o=S(653),B=S(658),z=S(485),L=S(678),r=S(2311),e=S(622),C=S(518),Z=S(555),b=S(618),O=S(714),i=S(544);function h(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=q.width,B=q.height;if(t instanceof Float32Array){let q=t.byteLength/t.BYTES_PER_ELEMENT;const S=new Uint8Array(q);for(;--q>=0;){let o=t[q];o<0?o=0:o>1&&(o=1),S[q]=255*o}t=S}const z=document.createElement("canvas");z.width=o,z.height=B;const L=z.getContext("2d");if(!L)return null;const r=L.createImageData(o,B);if(r.data.set(t),L.putImageData(r,0,0),S){const t=document.createElement("canvas");t.width=o,t.height=B;const q=t.getContext("2d");return q?(q.translate(0,B),q.scale(1,-1),q.drawImage(z,0,0),t.toDataURL("image/png")):null}return z.toDataURL("image/png")}function l(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=t.getInternalTexture();if(!o)return null;const B=t._readPixelsSync(q,S);return B?h(B,t.getSize(),o.invertY):null}async function I(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=t.getInternalTexture();if(!o)return null;const B=await t.readPixels(q,S);return B?h(B,t.getSize(),o.invertY):null}var a=S(788),v=S(701);class M extends r.b{static _CreateVideoTexture(t,q,S){arguments.length>5&&void 0!==arguments[5]||M.TRILINEAR_SAMPLINGMODE;throw(0,C.d)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(t){this._isBlocking=t}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(t,q,S,o){let B,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M.TRILINEAR_SAMPLINGMODE,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9?arguments[9]:void 0,i=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,l=arguments.length>12?arguments[12]:void 0,I=arguments.length>13?arguments[13]:void 0;super(q),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new z.b,this._isBlocking=!0,this.name=t||"",this.url=t;let v=!1,x=null,k=!0;"object"===typeof S&&null!==S?(B=S.noMipmap??!1,o=S.invertY??!a.b,L=S.samplingMode??M.TRILINEAR_SAMPLINGMODE,r=S.X??null,e=S.onError??null,C=S.buffer??null,b=S.deleteBuffer??!1,O=S.format,i=S.mimeType,h=S.loaderOptions,l=S.creationFlags,v=S.useSRGBBuffer??!1,x=S.internalTexture??null,k=S.gammaSpace??k,I=S.forcedExtension??I):B=!!S,this._gammaSpace=k,this._noMipmap=B,this._invertY=void 0===o?!a.b:o,this._initialSamplingMode=L,this._buffer=C,this._deleteBuffer=b,this._mimeType=i,this._loaderOptions=h,this._creationFlags=l,this._useSRGBBuffer=v,this._forcedExtension=I,void 0!==O&&(this._format=O);const V=this.va(),J=this._getEngine();if(!J)return;J.onBeforeTextureInitObservable.notifyObservers(this);const U=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),r&&r(),!this.isBlocking&&V&&V.resetCachedMaterial()},H=(t,q)=>{this._loadingError=!0,this._errorObject={message:t,exception:q},e&&e(t,q),M.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!x)return this._delayedOnLoad=U,void(this._delayedOnError=H);if(this._texture=x??this._getFromCache(this.url,B,L,this._invertY,v,this.isCube),this._texture)if(this._texture.isReady)Z.c.SetImmediate((()=>U()));else{const t=this._texture.onLoadedObservable.add(U);this._texture.onErrorObservable.add((q=>{var S;H(q.message,q.exception),null===(S=this._texture)||void 0===S||S.onLoadedObservable.remove(t)}))}else if(V&&V.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=U,this._delayedOnError=H;else{try{this._texture=J.createTexture(this.url,B,this._invertY,V,L,U,H,this._buffer,void 0,this._format,this._forcedExtension,i,h,l,v)}catch(j){throw H("error loading",j),j}b&&(this._buffer=null)}}updateURL(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(t=>t.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,this._buffer=q,this._forcedExtension=o,this.delayLoadState=4,S&&(this._delayedOnLoad=S),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const t=this.va();t&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?Z.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=t.getEngine().createTexture(this.url,this._noMipmap,this._invertY,t,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(t,q,S,o){t*=this._cachedUScale,q*=this._cachedVScale,t-=this.uRotationCenter*this._cachedUScale,q-=this.vRotationCenter*this._cachedVScale,S-=this.wRotationCenter,L.o.TransformCoordinatesFromFloatsToRef(t,q,S,this._rowGenerationMatrix,o),o.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,o.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,o.z+=this.wRotationCenter}getTextureMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=L.e.Zero(),this._rowGenerationMatrix=new L.e,this._t0=L.o.Zero(),this._t1=L.o.Zero(),this._t2=L.o.Zero()),L.e.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(L.e.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,L.j.Matrix[0]),L.e.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,L.j.Matrix[1]),L.e.ScalingToRef(this._cachedUScale,this._cachedVScale,0,L.j.Matrix[2]),L.e.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,L.j.Matrix[3]),L.j.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.j.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.j.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.j.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Yi(this._t0),this._t2.Yi(this._t0),L.e.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const q=this.va();if(!q)return this._cachedTextureMatrix;const S=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&S!==this._cachedIdentity3x2&&q.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const t=this.va();if(!t)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==M.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=L.e.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=L.e.Zero());const q=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case M.PLANAR_MODE:L.e.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case M.PROJECTION_MODE:{L.e.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const q=t.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=q.updateFlag,q.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:L.e.IdentityToRef(this._cachedReflectionTextureMatrix)}return q&&t.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return v.b.Clone((()=>new M(this._texture?this._texture.url:null,this.va(),t)),this)}serialize(){var t;const q=this.name;M.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const S=super.serialize(M._SerializeInternalTextureUniqueId);if(!S)return null;if(M.SerializeBuffers||M.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))S.base64String=this._buffer,S.name=S.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const t=this.mimeType||"image/png";S.base64String=`data:${t};base64,${(0,i.k)(this._buffer)}`}else(M.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(S.base64String=!this._engine||this._engine._features.supportSyncTextureRead?l(this):I(this));var o;(S.invertY=this._invertY,S.samplingMode=this.samplingMode,S._creationFlags=this._creationFlags,S._useSRGBBuffer=this._useSRGBBuffer,M._SerializeInternalTextureUniqueId)&&(S.internalTextureUniqueId=null===(o=this._texture)||void 0===o?void 0:o.uniqueId);return S.internalTextureLabel=null===(t=this._texture)||void 0===t?void 0:t.label,S.noMipmap=this._noMipmap,this.name=q,S}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(t,q,S){if(t.customType){const o=b.d.Instantiate(t.customType).Parse(t,q,S);return t.samplingMode&&o.updateSamplingMode&&o._samplingMode&&o._samplingMode!==t.samplingMode&&o.updateSamplingMode(t.samplingMode),o}if(t.isCube&&!t.isRenderTarget)return M._CubeTextureParser(t,q,S);const o=void 0!==t.internalTextureUniqueId;if(!t.name&&!t.isRenderTarget&&!o)return null;let B;if(o){const S=q.getEngine().getLoadedTexturesCache();for(const q of S)if(q.uniqueId===t.internalTextureUniqueId){B=q;break}}const z=q=>{if(q&&q._texture&&(q._texture._cachedWrapU=null,q._texture._cachedWrapV=null,q._texture._cachedWrapR=null),t.samplingMode){const S=t.samplingMode;q&&q.samplingMode!==S&&q.updateSamplingMode(S)}if(q&&t.animations)for(let S=0;S<t.animations.length;S++){const o=t.animations[S],B=(0,e.b)("BABYLON.Animation");B&&q.animations.push(B.Parse(o))}q&&q._texture&&(o&&!B&&q._texture._setUniqueId(t.internalTextureUniqueId),q._texture.label=t.internalTextureLabel)};return v.b.Parse((()=>{let o=!0;if(t.noMipmap&&(o=!1),t.mirrorPlane){const S=M._CreateMirror(t.name,t.renderTargetSize,q,o);return S._waitingRenderList=t.renderList,S.mirrorPlane=O.c.ti(t.mirrorPlane),z(S),S}if(t.isRenderTarget){let S=null;if(t.isCube){if(q.reflectionProbes)for(let o=0;o<q.reflectionProbes.length;o++){const S=q.reflectionProbes[o];if(S.name===t.name)return S.cubeTexture}}else S=M._CreateRenderTargetTexture(t.name,t.renderTargetSize,q,o,t._creationFlags??0),S._waitingRenderList=t.renderList;return z(S),S}if(t.isVideo){const B=M._CreateVideoTexture(S+(t.url||t.name),S+(t.src||t.url),q,o,t.invertY,t.samplingMode,t.settings||{});return z(B),B}{let L;if(t.base64String&&!B)L=M.CreateFromBase64String(t.base64String,t.base64String,q,!o,t.invertY,t.samplingMode,(()=>{z(L)}),t._creationFlags??0,t._useSRGBBuffer??!1),L.name=t.name;else{let r;r=t.name&&(t.name.indexOf("://")>0||t.name.startsWith("data:"))?t.name:S+t.name,t.url&&(t.url.startsWith("data:")||M.UseSerializedUrlIfAny)&&(r=t.url);const e={noMipmap:!o,invertY:t.invertY,samplingMode:t.samplingMode,X:()=>{z(L)},internalTexture:B};L=new M(r,q,e)}return L}}),t,q)}static CreateFromBase64String(t,q,S,o,B){let z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:M.TRILINEAR_SAMPLINGMODE;return new M("data:"+q,S,o,B,z,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:M.TRILINEAR_SAMPLINGMODE,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,Z=arguments.length>10?arguments[10]:void 0,b=arguments.length>11?arguments[11]:void 0;return"data:"!==t.substring(0,5)&&(t="data:"+t),new M(t,S,B,z,L,r,e,q,o,C,void 0,void 0,Z,b)}}M.SerializeBuffers=!0,M.ForceSerializeBuffers=!1,M.OnTextureLoadErrorObservable=new z.b,M._SerializeInternalTextureUniqueId=!1,M._CubeTextureParser=(t,q,S)=>{throw(0,C.d)("CubeTexture")},M._CreateMirror=(t,q,S,o)=>{throw(0,C.d)("MirrorTexture")},M._CreateRenderTargetTexture=(t,q,S,o,B)=>{throw(0,C.d)("RenderTargetTexture")},M.NEAREST_SAMPLINGMODE=1,M.NEAREST_NEAREST_MIPLINEAR=8,M.BILINEAR_SAMPLINGMODE=2,M.LINEAR_LINEAR_MIPNEAREST=11,M.TRILINEAR_SAMPLINGMODE=3,M.LINEAR_LINEAR_MIPLINEAR=3,M.NEAREST_NEAREST_MIPNEAREST=4,M.NEAREST_LINEAR_MIPNEAREST=5,M.NEAREST_LINEAR_MIPLINEAR=6,M.NEAREST_LINEAR=7,M.NEAREST_NEAREST=1,M.LINEAR_NEAREST_MIPNEAREST=9,M.LINEAR_NEAREST_MIPLINEAR=10,M.LINEAR_LINEAR=2,M.LINEAR_NEAREST=12,M.EXPLICIT_MODE=0,M.SPHERICAL_MODE=1,M.PLANAR_MODE=2,M.CUBIC_MODE=3,M.PROJECTION_MODE=4,M.SKYBOX_MODE=5,M.INVCUBIC_MODE=6,M.EQUIRECTANGULAR_MODE=7,M.FIXED_EQUIRECTANGULAR_MODE=8,M.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,M.CLAMP_ADDRESSMODE=0,M.WRAP_ADDRESSMODE=1,M.MIRROR_ADDRESSMODE=2,M.UseSerializedUrlIfAny=!1,(0,o.e)([(0,B.C)()],M.prototype,"url",void 0),(0,o.e)([(0,B.C)()],M.prototype,"uOffset",void 0),(0,o.e)([(0,B.C)()],M.prototype,"vOffset",void 0),(0,o.e)([(0,B.C)()],M.prototype,"uScale",void 0),(0,o.e)([(0,B.C)()],M.prototype,"vScale",void 0),(0,o.e)([(0,B.C)()],M.prototype,"uAng",void 0),(0,o.e)([(0,B.C)()],M.prototype,"vAng",void 0),(0,o.e)([(0,B.C)()],M.prototype,"wAng",void 0),(0,o.e)([(0,B.C)()],M.prototype,"uRotationCenter",void 0),(0,o.e)([(0,B.C)()],M.prototype,"vRotationCenter",void 0),(0,o.e)([(0,B.C)()],M.prototype,"wRotationCenter",void 0),(0,o.e)([(0,B.C)()],M.prototype,"homogeneousRotationInUVTransform",void 0),(0,o.e)([(0,B.C)()],M.prototype,"isBlocking",null),(0,e.c)("BABYLON.Texture",M),v.b._TextureParser=M.Parse},2289:(t,q,S)=>{S.d(q,{d:()=>o});class o{constructor(t,q){this.width=t,this.height=q}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let t=0|this.width;return t=397*t^this.height,t}p(t){this.width=t.width,this.height=t.height}ni(t,q){return this.width=t,this.height=q,this}set(t,q){return this.ni(t,q)}multiplyByFloats(t,q){return new o(this.width*t,this.height*q)}clone(){return new o(this.width,this.height)}equals(t){return!!t&&(this.width===t.width&&this.height===t.height)}get surface(){return this.width*this.height}static Zero(){return new o(0,0)}add(t){return new o(this.width+t.width,this.height+t.height)}Kg(t){return new o(this.width-t.width,this.height-t.height)}scale(t){return new o(this.width*t,this.height*t)}static Lerp(t,q,S){const B=t.width+(q.width-t.width)*S,z=t.height+(q.height-t.height)*S;return new o(B,z)}}}}]);